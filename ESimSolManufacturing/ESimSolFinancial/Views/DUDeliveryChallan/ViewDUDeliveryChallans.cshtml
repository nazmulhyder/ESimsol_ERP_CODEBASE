@{
    ViewBag.Title = "Delivery Challan(s)";
}

@model IEnumerable<ESimSol.BusinessObjects.DUDeliveryChallan>
    
    <head>
        <title>Lab Dip Orders</title>      
    </head>

    <body>
        <div id="progressbarParent" style="width:100%;height:100%;margin:0 auto;text-align:center; margin-left: auto;margin-right: auto;left: 0;right: 0;z-index: 1;">
            <div style="margin: 0px auto;margin-top: 251px;text-align:center;width:390px;">
                <label style="font-size:18px;">Please wait</label>
                <div id="progressbar" style="width:100%;height:37px;"></div>
            </div>
        </div>

        <div id="winDUDeliveryChallanImage" class="easyui-window winstyle" title=" Informations" data-options="modal:true,closed:true,collapsible:false,minimizable:false,maximizable:false,closable:false">
            <div>
                <fieldset>
                    <table class="tbl" cellpadding="4">
                        
                        <tr>
                            <td style="width:20%; font-family:Tahoma">
                                <label>Name :</label>
                            </td>
                            <td style="width:30%; font-family:Tahoma">
                                <input type="text" id="txtName" style="width:100%" placeholder="Enter Name" />
                            </td>
                            <td style="width:20%; font-family:Tahoma; text-align:right">
                                <label>Contact No :</label>
                            </td>
                            <td style="width:30%; font-family:Tahoma">
                                <input type="text" id="txtContactNo" style="width:100%" placeholder="Enter Contact No " />
                            </td>
                        </tr>
                        <tr>
                            <td style="width:20%; font-family:Tahoma">
                                <label>Note :</label>
                            </td>
                            <td colspan="3" style="width:80%; font-family:Tahoma">
                                <input type="text" id="txtNote" style="width:100%" placeholder="Enter Note" />
                            </td>
                        </tr>
                        <tr>
                            <td style="width:20%; font-family:Tahoma;padding-bottom:120px;">
                                <label>Photo :</label>
                            </td>
                            <td colspan="3" style="width:80%; font-family:Tahoma">
                                <div style="height: 160px;width:100%;background-color:1px solid black;">
                                    <img id="imgPad" src="" alt="" style="height: 160px;width:35%;background-color:1px solid black;" />
                                </div>
                            </td>
                        </tr>
                        <tr>
                            <td style="width:20%; font-family:Tahoma"></td>
                            <td colspan="3" style="width:80%; font-family:Tahoma">
                                <input type="file" id="fileInput" accept="image/*" name="file" onchange="readURLImg(this);" style="width:100%" />
                            </td>
                        </tr>

                    </table>
                </fieldset>
                <fieldset class="actionfieldsetstyle">
                    <legend>Actions : </legend>
                    <a id="btnSaveDUDeliveryChallanImage" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-save" plain="true">Save</a>
                    @*<input id="btnSubmit" type="submit" value="Save" />*@
                    <a id="btnCloseDUDeliveryChallanImage" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-cancel" plain="true">Close</a>
                </fieldset>
            </div>
        </div>

        <div class="menuMainCollectionTable" >
            <table id="tblDUDeliveryChallan" title="DUDeliveryChallan List" class="easyui-datagrid" fit="true" fitcolumn="true" rownumbers="true" pagination="true" singleselect="true" autorowheight="false" toolbar="#toolbarDUDeliveryChallan" >
                <thead>
                    <tr>
                        @*<th data-options=" field:'selected',checkbox:true"></th>*@
                        <th field="ChallanNo" width="12%">Challan No</th>
                        <th field="ChallanDateSt" width="12%">Date</th>
                        <th field="ContractorName" width="25%">DeliveryTo</th>
                        <th field="OrderTypeSt" width="10%">Type</th>
                        <th field="Qty" formatter="formatPrice" width="10%" align="right">Qty<label id="lblMunit"></label></th>
                        <th field="PreaperByName" width="10%">Preaper Name</th>
                        <th field="ApproveByName" width="10%">Disburse By</th>

                    </tr>
                </thead>

            </table>>

            <div id="toolbarDUDeliveryChallan">
                <a href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-reload" plain="true" id="btnReload"></a>
                <input type="text" id="txtSearchByChallanNo" placeholder="challan No" style="width:80px;text-align:left" />
                <input type="text" id="txtSearchByDONo" placeholder="SDO No" style="width:80px;text-align:left" />
                <input type="text" id="txtSearchByOrderNo" placeholder="Order No" style="width:70px;text-align:left" />
                <input type="text" id="txtSearchByLotNo" placeholder="Lot/Batch No" style="width:70px;text-align:left" />
                <a id="btnAdvSearch" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-search" plain="true">Adv. Search</a>
                <a id="btnAdd" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-add" plain="true">Add</a>
                <a id="btnEdit" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-edit" plain="true">Edit</a>
                <a id="btnDelete" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-remove" plain="true">Delete</a>
                <a id="btnView" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-details" plain="true">View</a>
                <a id="btnDisburse" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-approved" plain="true"> <label id="lblOrderStatus">Disburse</label> </a>
                @*<a id="btnCancel" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-cancel" plain="true">Cancel</a>*@
                @*<a id="btnRevise" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-add" plain="true">Revise</a>*@
              
                <a id="btnPrint" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-print" plain="true">Print</a>
                <a id="btnPrintFormat" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-setting" plain="true">Print Format</a>
                <a id="btnPhoto" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-ok" plain="true">Photo</a>
                <a id="btnPrintPackingList" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-print" plain="true">Packing List</a>
            </div>
        </div>
        <div id="winAdvSearch" class="easyui-window winClass" style=" width:500px;" title=" adv. search" data-options="modal:true,closed:true,collapsible:false,minimizable:false,maximizable:false,closable:false">
            <table style="width:100%;">
                <tr>
                    <td>
                        <fieldset style="margin-bottom: 0px;">
                            <legend>Searching Criteria</legend>
                            <table>

                                <tr>
                                    <td style=" width:20%;text-align:right;">
                                        <label>Deliver To </label>
                                    </td>
                                    <td colspan="3" style=" width:80%;text-align:left;">
                                        <input id="txtDeliverToAdvS" style="width:75%;" type="text" placeholder="Type & Press Enter" />
                                        <a id="btnPickDeliverToAdvS" href="javascript:void(0)" class="easyui-linkbutton ics-pick" iconcls="icon-pick" plain="true"></a>
                                        <a id="btnClrDeliverToAdvS" href="javascript:void(0)" class="easyui-linkbutton ics-pick" iconcls="icon-clear" plain="true"></a>
                                    </td>
                                </tr>
                                @*<tr>
                                    <td style=" width:20%;text-align:right;">
                                        <label>Issue To </label>
                                    </td>
                                    <td colspan="3" style=" width:80%;text-align:left;">
                                        <input id="txtContractorAdvS" style="width:75%;" type="text" placeholder="Type & Press Enter" />
                                        <a id="btnPickContractorAdvS" href="javascript:void(0)" class="easyui-linkbutton ics-pick" iconcls="icon-pick" plain="true"></a>
                                        <a id="btnClrContractorAdvS" href="javascript:void(0)" class="easyui-linkbutton ics-pick" iconcls="icon-clear" plain="true"></a>

                                    </td>
                                </tr>*@
                                <tr>
                                    <td style=" width:20%;text-align:right;">
                                        <label>Yarn </label>
                                    </td>
                                    <td colspan="3" style=" width:80%;text-align:left;">
                                        <input id="txtProductName" style="width:75%;" type="text" placeholder="Type & Press Enter" />
                                        <a id="btnProductPiker" href="javascript:void(0)" class="easyui-linkbutton ics-pick" iconcls="icon-pick" plain="true"></a>
                                        <a id="btnClrProductPiker" href="javascript:void(0)" class="easyui-linkbutton ics-pick" iconcls="icon-clear" plain="true"></a>
                                    </td>
                                </tr>


                                <tr>
                                    <td style=" width:20%;text-align:right;">
                                        <label>Challan Date </label>
                                    </td>
                                    <td colspan="3">
                                        <select id="cboChallanDateAdvS" style="width:30%;" onchange=" DateActionsDeliveryDateAdvSearch(); "></select>
                                        <input id="txtFromChallanDateAdvSearch" type="text" style="width: 100px;" class="easyui-datebox" required="required" data-options="formatter:icsdateformat,parser:icsdateparser" />To
                                        <input id="txtToChallanDateAdvSearch" type="text" style="width: 100px;" class="easyui-datebox" required="required" data-options="formatter:icsdateformat,parser:icsdateparser" />
                                    </td>
                                </tr>
                                <tr>
                                    <td style=" width:20%;text-align:right;">
                                        <label>DO Date </label>
                                    </td>
                                    <td colspan="3">
                                        <select id="cboDODateAdvS" style="width:30%;" onchange="DateActionsOrderDateAdvSearch();"></select>
                                        <input id="txtFromDODateAdvSearch" type="text" style="width: 100px;" class="easyui-datebox" required="required" data-options="formatter:icsdateformat,parser:icsdateparser" />To
                                        <input id="txtToDODateAdvSearch" type="text" style="width: 100px;" class="easyui-datebox" required="required" data-options="formatter:icsdateformat,parser:icsdateparser" />
                                    </td>
                                </tr>
                                <tr>
                                    <td style=" width:20%;text-align:right;">
                                        <label>Challan No </label>
                                    </td>
                                    <td style=" width:30%;text-align:left;">
                                        <input id="txtChallanNo" type="text" style="width:100%" />
                                    </td>
                                    <td style=" width:20%;text-align:right;"></td>
                                    <td style=" width:30%;text-align:left;"></td>
                                </tr>
                                <tr>
                                    <td style=" width:20%;text-align:right;">
                                        <label>Order Type </label>
                                    </td>
                                    <td style=" width:30%;text-align:left;">
                                        <select id="cboOrderType" style="width: 100%;"></select>
                                    </td>
                                    <td style=" width:20%;text-align:right;">
                                        <label>Invoice No </label>
                                    </td>
                                    <td style=" width:30%;text-align:left;">
                                        <input id="txtInvoiceNo" type="text" style="width:100%" />
                                    </td>
                                </tr>
                                <tr>
                                    <td style=" width:20%;text-align:right;">
                                        <label>Order No </label>
                                    </td>
                                    <td style=" width:30%;text-align:left;">
                                        <input id="txtPONo" type="text" style="width:100%" />
                                    </td>
                                    <td style=" width:20%;text-align:right;">
                                        <label>P/I No </label>
                                    </td>
                                    <td style=" width:30%;text-align:left;">
                                        <input id="txtPINo" type="text" style="width:95%" />
                                    </td>
                                </tr>
                                <tr>
                                    <td style=" width:20%;text-align:right;">
                                        <label>Lot No </label>
                                    </td>
                                    <td style=" width:30%;text-align:left;">
                                        <input id="txtLot" type="text" style="width:100%" />
                                    </td>
                                    <td style=" width:20%;text-align:right;"></td>
                                    <td style=" width:30%;text-align:left;"></td>
                                </tr>

                                <tr>
                                    <td height="5px" colspan="4"></td>
                                </tr>
                                @*<tr>
                                    <td class="btnResetSearch" colspan="4">
                                        <a id="btnSearchAdvSearch" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-search" plain="true">Search</a>
                                        <a id="btnResetAdvSearch" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-reload" plain="true">Reset</a>
                                    </td>
                                </tr>*@
                            </table>
                        </fieldset>
                    </td>
                </tr>
            </table>

            <fieldset class="actionfieldsetstyle">
                <legend>Actions : </legend>
                <label class="lblLoadingMessage" style="float: left;">Loading Please Wait...</label>
                <a id="btnResetAdvSearch" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-reload" plain="true">Reset</a>
                <a id="btnSearchAdvSearch" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-search" plain="true">Search</a>
                <a id="btnCloseAdvSearch" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-cancel" plain="true">Close</a>
            </fieldset>
        </div>
        <div id="winPrintFormat2" style="width:550px;" class="easyui-window winstyle" title="Adv. Search" data-options="modal:true,closed:true,collapsible:false,minimizable:false,maximizable:false,closable:false">
            <fieldset>
                <legend>Print Setup</legend>
                <table style="width:100%;">
                    <tr>
                        <td style="text-align:right;">
                            Qty Fromat :
                        </td>
                        <td>
                            <input id="chkInKg" type="checkbox" onclick="if(this.checked){IsLBSFormat(false)}else{IsLBSFormat(true)}" /> <label id="lblMunitTwo"></label>
                        </td>
                        <td>
                            <input id="chkInLBS" type="checkbox" checked onclick="if(this.checked){IsLBSFormat(true)}else{IsLBSFormat(false)}" /> <label id="lblMunitOne"></label>
                        </td>
                        <td style="width:30%;">
                            &nbsp;&nbsp;&nbsp;
                        </td>
                    </tr>
                    <tr>
                        <td style="text-align:right;">
                            Print Title :
                        </td>
                        <td>
                            <input id="chkPrintTitleInNormalFormat" type="checkbox" checked onclick="if(this.checked){PrintTitleFormat(1)}" /> Normal Format
                        </td>
                        <td>
                            <input id="chkPrintTitlePadFormat" type="checkbox" onclick="if(this.checked){PrintTitleFormat(2)}" /> Pad Format
                        </td>
                        <td>
                            <input id="chkPrintTitleImageFormat" type="checkbox" onclick="if(this.checked){PrintTitleFormat(3)}" /> Image Format
                        </td>

                    </tr>
                </table>
            </fieldset>
            <fieldset class="actionfieldsetstyle">
                <legend>Actions : </legend>
                <a id="btnOkPrintFormat2" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-ok" plain="true">Ok</a>
                <a id="btnClosePrintFormat2" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-cancel" plain="true">Close</a>
            </fieldset>
        </div>
    </body>

    
    <script type="text/javascript">
    var _sBaseAddress="";
    var _oDUDeliveryChallans=[];
    var _sMessage='';
    var _nNextStatus=-1;
    var _sMenuID=0;
    var _nContractorIDs="";
    var _sMenuID=0;
    var _nBUID = 0;
    var _sContractorIds = '';
    var _sProductIds = '';
    var _sDeliverToIDs = '';
    var _oWorkingUnits=[];
    var _oOrderTypes=[];
    var _oDUDeliveryChallanImage={};
    var _oAuthorizationRolesMapping=[];
    $(document).ready(function () {
        _sBaseAddress = @Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(HttpContext.Current.Session[SessionInfo.BaseAddress]));
        _oAuthorizationRolesMapping = @Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(HttpContext.Current.Session[SessionInfo.AuthorizationRolesMapping]));
        _oDUDeliveryChallans =@Html.Raw( new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(Model));

        _sMenuID =@Html.Raw( new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(HttpContext.Current.Session[SessionInfo.MenuID]));
        _nBUID = @Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(ViewBag.BUID));
        _oCompareOperators = @Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(ViewBag.CompareOperators));
        _oMktPersons = @Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(ViewBag.MktPersons));

        _oOrderTypes = @Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(ViewBag.OrderTypes));

        if(sessionStorage.getItem("DUDeliveryChallans")!=null && sessionStorage.getItem("DUDeliveryChallans").length>0){
            _oDUDeliveryChallans= jQuery.parseJSON(sessionStorage.getItem('DUDeliveryChallans'));
            var nIndex= sessionStorage.getItem('SelectedRowIndex');
            DynamicRefreshList(_oDUDeliveryChallans, 'tblDUDeliveryChallan');
            if(nIndex>-1){
                $('#tblDUDeliveryChallan').datagrid('selectRow',nIndex);
            }
        }
        else{
            DynamicRefreshList(_oDUDeliveryChallans, 'tblDUDeliveryChallan');
        }
        if(_oOrderTypes.length>0)
        {
            $('#lblMunit').html("("+_oOrderTypes[0].MUName+")");
            $('#lblMunitOne').html("In "+_oOrderTypes[0].MUName+"");
            $('#lblMunitTwo').html("In "+_oOrderTypes[0].MUName_Alt+"");
        }

        $("#progressbar").progressbar({ value: 0 });
        $("#progressbarParent").hide();
        $(".lblLoadingMessage").hide();
        LoadComboAdv();
        sessionStorage.setItem("QtyFormat",true);//default set
        sessionStorage.setItem("ImageFormat",2);//default set
    });

    $(document).keydown(function (e) { if (e.keyCode == 27) { $('#winDUDeliveryChallanOrder').icsWindow('close'); } });

    function RefreshControlLayout()
    {
       
        $("#btnAdd,#btnEdit,#btnDelete,#btnDisburse").hide();

        if (PermissionChecker('Add', 'DUDeliveryChallan',_oAuthorizationRolesMapping)) {$("#btnAdd").show();}
        if (PermissionChecker('Edit', 'DUDeliveryChallan',_oAuthorizationRolesMapping)) {$("#btnEdit").show();}
        //if (PermissionChecker('View', 'DUClaimOrder',_oAuthorizationRolesMapping)) {$("#btnView").show();}
        if (PermissionChecker('Delete', 'DUDeliveryChallan',_oAuthorizationRolesMapping)) {$("#btnDelete").show();}
        if (PermissionChecker('Disburse', 'DUDeliveryChallan',_oAuthorizationRolesMapping)) {$("#btnDisburse").show();}
       
    }
    $('#tblDUDeliveryChallan').datagrid({ onSelect: function (rowIndex, rowData) { OperationPerforms(rowIndex, rowData); } });

    function OperationPerforms(rowIndex, rowData)
    {
        if (rowData != null && rowData.DUDeliveryChallanID > 0)
        {
            if (rowData.OrderStatus==1 )  //Initialized = 1,
            {

            }
            //$('#btnCancel,#btnUndo,#btnAdd,#btnEdit,#btnDelete').hide();
            ////if (rowData.OrderStatus==1 )  //Initialized = 1,
            ////{
            //$('#btnAdd,#btnEdit,#btnDelete,#btnOrderStatus').show();
            //_nNextStatus=2;
            //_sMessage="send an approval request.";
            //$('#lblOrderStatus').text(' Approve');
        }
    }




    /*------------------------------------*/

    $("#btnAdd").click(function(){
        debugger;
        sessionStorage.setItem("Operation", "New");
        sessionStorage.setItem("SelectedRowIndex", -1);
        sessionStorage.setItem("DOHeader", "Add Order");
        sessionStorage.setItem("DUDeliveryChallans", JSON.stringify($('#tblDUDeliveryChallan').datagrid('getRows')));
        sessionStorage.setItem("BackLink", window.location.href);
        var tsv=((new Date()).getTime())/1000;
        window.location.href = _sBaseAddress+ "/DUDeliveryChallan/ViewDUDeliveryChallan?nId=0&ts="+tsv;
    });

    $('#btnEdit').click(function (e)
    {

        var oDUDeliveryChallan = $('#tblDUDeliveryChallan').datagrid('getSelected');
        if (oDUDeliveryChallan ==null || oDUDeliveryChallan.DUDeliveryChallanID <=0 ) { alert("Please select an item from list."); return ; }
        var nIndex=$('#tblDUDeliveryChallan').datagrid('getRowIndex',oDUDeliveryChallan);

        sessionStorage.setItem("Operation", "Edit");
        sessionStorage.setItem("SelectedRowIndex", nIndex);
        sessionStorage.setItem("DOHeader", "Edit Order");
        sessionStorage.setItem("DUDeliveryChallans", JSON.stringify($('#tblDUDeliveryChallan').datagrid('getRows')));
        sessionStorage.setItem("BackLink", window.location.href);
        var tsv=((new Date()).getTime())/1000;
        window.location.href = _sBaseAddress+ "/DUDeliveryChallan/ViewDUDeliveryChallan?nId="+oDUDeliveryChallan.DUDeliveryChallanID+"&ts="+tsv;

    });
    $('#btnRevise').click(function (e)
    {

        var oDUDeliveryChallan = $('#tblDUDeliveryChallan').datagrid('getSelected');
        if (oDUDeliveryChallan ==null || oDUDeliveryChallan.DUDeliveryChallanID <=0 ) { alert("Please select an item from list."); return ; }

        var nIndex=$('#tblDUDeliveryChallan').datagrid('getRowIndex',oDUDeliveryChallan);
        sessionStorage.setItem("Operation", "Revise");
        sessionStorage.setItem("SelectedRowIndex", nIndex);
        sessionStorage.setItem("DUDeliveryChallanHeader", "Revise Production");
        sessionStorage.setItem("DUDeliveryChallans", JSON.stringify($('#tblDUDeliveryChallan').datagrid('getRows')));
        sessionStorage.setItem("BackLink", window.location.href);
        var tsv=((new Date()).getTime())/1000;
        window.location.href = _sBaseAddress+ "/DUDeliveryChallan/ViewDUDeliveryChallan?nId="+oDUDeliveryChallan.DUDeliveryChallanID+"&ts="+tsv;
    });
    $("#btnCancel").click(function(){

        var oDUDeliveryChallan = $('#tblDUDeliveryChallan').datagrid('getSelected');
        if (oDUDeliveryChallan ==null || oDUDeliveryChallan.DUDeliveryChallanID <=0 ) { alert("Please select an item from list."); return ; }

        var nIndex=$('#tblDUDeliveryChallan').datagrid('getRowIndex',oDUDeliveryChallan);
        sessionStorage.setItem("Operation", "Cancel");
        sessionStorage.setItem("SelectedRowIndex", nIndex);
        sessionStorage.setItem("DUDeliveryChallanHeader", "Cancel Production");
        sessionStorage.setItem("DUDeliveryChallans", JSON.stringify($('#tblDUDeliveryChallan').datagrid('getRows')));
        sessionStorage.setItem("BackLink", window.location.href);
        var tsv=((new Date()).getTime())/1000;
        window.location.href = _sBaseAddress+ "/DUDeliveryChallan/ViewDUDeliveryChallan?nId="+oDUDeliveryChallan.DUDeliveryChallanID+"&ts="+tsv;

    });
    $('#btnDelete').click(function(e){
        var oDUDeliveryChallan = $('#tblDUDeliveryChallan').datagrid('getSelected');
        if (oDUDeliveryChallan ==null || oDUDeliveryChallan.DUDeliveryChallanID <=0 ) { alert("Please select an item from list."); return ; }
        if (!confirm("Confirm to delete?")) return;
        sessionStorage.clear();
        var obj =
        {
            BaseAddress: _sBaseAddress,
            Object: oDUDeliveryChallan,
            ControllerName: "DUDeliveryChallan",
            ActionName: "Delete",
            TableId: "tblDUDeliveryChallan",
            IsWinClose: false
        };
        $.icsDelete(obj);

    });

    $('#btnView').click(function (e)
    {
        var oDUDeliveryChallan = $('#tblDUDeliveryChallan').datagrid('getSelected');
        if (oDUDeliveryChallan ==null || oDUDeliveryChallan.DUDeliveryChallanID <=0 ) { alert("Please select an item from list."); return ; }

        var nIndex=$('#tblDUDeliveryChallan').datagrid('getRowIndex',oDUDeliveryChallan);

        sessionStorage.clear();
        sessionStorage.setItem("Operation", "View");
        sessionStorage.setItem("SelectedRowIndex", nIndex);
        sessionStorage.setItem("DOHeader", "View Order");
        sessionStorage.setItem("DUDeliveryChallans", JSON.stringify($('#tblDUDeliveryChallan').datagrid('getRows')));
        sessionStorage.setItem("BackLink", window.location.href);
        var tsv=((new Date()).getTime())/1000;
        window.location.href = _sBaseAddress+ "/DUDeliveryChallan/ViewDUDeliveryChallan?nId="+oDUDeliveryChallan.DUDeliveryChallanID+"&ts="+tsv;;
    });

    $('#btnDisburse').click(function(e){
        debugger;
        var oDUDeliveryChallan = $('#tblDUDeliveryChallan').datagrid('getSelected');
        if (oDUDeliveryChallan ==null || oDUDeliveryChallan.DUDeliveryChallanID <=0 ) { alert("Please select an item from list."); return ; }

        var nIndex=$('#tblDUDeliveryChallan').datagrid('getRowIndex',oDUDeliveryChallan);
        sessionStorage.clear();
        sessionStorage.setItem("Operation", "Approve");
        sessionStorage.setItem("SelectedRowIndex", nIndex);
        sessionStorage.setItem("DOHeader", "Approve");
        sessionStorage.setItem("DUDeliveryChallans", JSON.stringify($('#tblDUDeliveryChallan').datagrid('getRows')));
        sessionStorage.setItem("BackLink", window.location.href);
        var tsv=((new Date()).getTime())/1000;
        window.location.href = _sBaseAddress+ "/DUDeliveryChallan/ViewDUDeliveryChallan?nId="+oDUDeliveryChallan.DUDeliveryChallanID+"&ts="+tsv;;

    });



    //*Print Setup*//
    $("#btnPrintFormat").click(function () {
        debugger;
        if(sessionStorage.getItem("QtyFormat")=="true")
        {
            $("#chkInKg").prop( "checked", false );
            $("#chkInLBS").prop( "checked", true );
        }else{
            $("#chkInLBS").prop( "checked", false );
            $("#chkInKg").prop( "checked", true );
        }
        if(parseInt(sessionStorage.getItem("ImageFormat"))==1)
        {
            $("#chkPrintTitleInNormalFormat").prop( "checked",true);
            $("#chkPrintTitlePadFormat").prop( "checked", false );
            $("#chkPrintTitleImageFormat").prop( "checked", false );
        }else if(parseInt(sessionStorage.getItem("ImageFormat"))==2)
        {
            $("#chkPrintTitleInNormalFormat").prop( "checked",false);
            $("#chkPrintTitlePadFormat").prop( "checked", true );
            $("#chkPrintTitleImageFormat").prop( "checked", false );
        }else
        {
            $("#chkPrintTitleInNormalFormat").prop( "checked",false);
            $("#chkPrintTitlePadFormat").prop( "checked", false );
            $("#chkPrintTitleImageFormat").prop( "checked", true );
        }
        $("#winPrintFormat2").icsWindow("open"," Print Format Setup");
    });
    function IsLBSFormat(bIstrue)
    {
        if(bIstrue)
        {
            $("#chkInKg").prop( "checked", false );
            $("#chkInLBS").prop( "checked", true );
        }else{
            $("#chkInKg").prop( "checked", true );
            $("#chkInLBS").prop( "checked", false );
        }
    }
    $("#btnClosePrintFormat2").click(function () {
        $("#winPrintFormat2").icsWindow("close");
    });

    $("#btnOkPrintFormat2").click(function () {
        debugger;
        $("#winPrintFormat2").icsWindow("close");

        if ($("#chkInLBS").is(':checked'))
        {
            sessionStorage.setItem("QtyFormat",true);
        }else{
            sessionStorage.setItem("QtyFormat",false);
        }

        if ($("#chkPrintTitleInNormalFormat").is(':checked'))
        {
            sessionStorage.setItem("ImageFormat",1);//normal
        }else if ($("#chkPrintTitlePadFormat").is(':checked'))
        {
            sessionStorage.setItem("ImageFormat",2);//pad
        }else if ($("#chkPrintTitleImageFormat").is(':checked'))
        {
            sessionStorage.setItem("ImageFormat",3);//with Image
        }
    });

    function PrintTitleFormat(nPrintTitleFormat)
    {
        if(parseInt(nPrintTitleFormat)==1)//normal
        {
            $("#chkPrintTitleInNormalFormat").prop( "checked", true );
            $("#chkPrintTitlePadFormat").prop( "checked", false );
            $("#chkPrintTitleImageFormat").prop( "checked", false );
        }else  if(parseInt(nPrintTitleFormat)==2)//pad
        {
            $("#chkPrintTitleInNormalFormat").prop( "checked", false );
            $("#chkPrintTitlePadFormat").prop( "checked", true );
            $("#chkPrintTitleImageFormat").prop( "checked", false );
        }else
        {
            $("#chkPrintTitleInNormalFormat").prop( "checked", false );
            $("#chkPrintTitlePadFormat").prop( "checked", false );
            $("#chkPrintTitleImageFormat").prop( "checked", true );
        }
    }
    //*End Print Setup*//
    $('#btnPrint').click(function (e)
    {
        var oDUDeliveryChallan = $('#tblDUDeliveryChallan').datagrid('getSelected');
        if (oDUDeliveryChallan ==null || oDUDeliveryChallan.DUDeliveryChallanID <=0 ) { alert("Please select an item from list."); return ; }
        var tsv=((new Date()).getTime())/1000;


        window.open(_sBaseAddress+ "/DUDeliveryChallan/PrintDUDeliveryChallanNew?nId="+oDUDeliveryChallan.DUDeliveryChallanID+"&nts="+tsv+ "&bPrintFormat="+sessionStorage.getItem("QtyFormat") + "&nTitleType="+sessionStorage.getItem("ImageFormat"), "_blank");
        window.open(_sBaseAddress+ "/DUDeliveryChallan/PrintDUDeliveryChallan?nId="+oDUDeliveryChallan.DUDeliveryChallanID+"&nts="+tsv+ "&bPrintFormat="+sessionStorage.getItem("QtyFormat") + "&nTitleType="+sessionStorage.getItem("ImageFormat"), "_blank");
    });

    $('#btnPrintPackingList').click(function (e)
    {
        var oDUDeliveryChallan = $('#tblDUDeliveryChallan').datagrid('getSelected');
        if (oDUDeliveryChallan ==null || oDUDeliveryChallan.DUDeliveryChallanID <=0 ) { alert("Please select an item from list."); return ; }
        var tsv=((new Date()).getTime())/1000;

        window.open(_sBaseAddress+ "/DUDeliveryChallan/PrintPackingList?nId="+oDUDeliveryChallan.DUDeliveryChallanID+"&bPrintFormat="+sessionStorage.getItem("QtyFormat") + "&nTitleType="+sessionStorage.getItem("ImageFormat"), "_blank");
    });


    /*----------Order Status Change----------------*/

    //$("#btnOrderStatus").click(function () {
    //    ChangeOrderState();
    //});

    //$("#btnUndo").click(function () {
    //    _nNextStatus=1;
    //    _sMessage="undo.";
    //    ChangeOrderState();
    //});

    //$("#btnCancel").click(function () {
    //    _nNextStatus=10;
    //    _sMessage="cancel.";
    //    ChangeOrderState();
    //});

    //function ChangeOrderState(){
    //    var oDUDeliveryChallan = $('#tblDUDeliveryChallan').datagrid('getSelected');
    //    if (oDUDeliveryChallan ==null || oDUDeliveryChallan.DUDeliveryChallanID <=0 ) { alert("Please select an item from list."); return ; }

    //    if(!confirm("Confirm to "+_sMessage)) return false;
    //    oDUDeliveryChallan.Params=_nNextStatus;

    //    var obj = {
    //        BaseAddress: _sBaseAddress,
    //        Object: oDUDeliveryChallan,
    //        ObjectId: oDUDeliveryChallan.DUDeliveryChallanID,
    //        ControllerName: "DUDeliveryChallan",
    //        ActionName: "ChangeOrderStatus",
    //        TableId: "tblDUDeliveryChallan",
    //        IsWinClose: false,
    //        Message: _sMessage.charAt(0).toUpperCase()+_sMessage.slice(1) +" Successfully."
    //    };
    //    $.icsSave(obj, function (response) {
    //        if (response.status && response.obj != null) {
    //            if (response.obj.DUDeliveryChallanID > 0) {
    //                OperationPerforms(-1, response.obj);
    //            }
    //        }
    //    });
    //}




    //// Add Details

    $("#txtSearchByDONo").keydown(function (e) {
        var nkeyCode = e.keyCode || e.which;
        if(nkeyCode==13){

            var oDUDeliveryChallan= {
                DONos: $.trim($("#txtSearchByDONo").val())
            };
            GetsOrders(oDUDeliveryChallan);
        }
        else if(nkeyCode==8){
            $("#txtSearchByDONo").val("");

        }
    });


    $("#txtSearchByChallanNo").keydown(function (e) {
        var nkeyCode = e.keyCode || e.which;
        if(nkeyCode==13){

            var oDUDeliveryChallan= {
                ChallanNo: $.trim($("#txtSearchByChallanNo").val())
            };
            GetsOrders(oDUDeliveryChallan);
        }
        else if(nkeyCode==8){
            $("#txtSearchByChallanNo").val("");

        }
    });




    function GetsOrders(oDUDeliveryChallan)
    {
        $.ajax
          ({
              type: "POST",
              dataType: "json",
              url : _sBaseAddress+"/DUDeliveryChallan/GetbyNo",
              data:  JSON.stringify(oDUDeliveryChallan),
              contentType: "application/json; charset=utf-8",
              success: function (data) {
                  //debugger;
                  var oDUDeliveryChallans = jQuery.parseJSON(data);
                  if (oDUDeliveryChallans.length>0)
                  {
                      DynamicRefreshList(oDUDeliveryChallans, "tblDUDeliveryChallan");
                  }
                  else
                  {
                      alert("Data Not found");
                      DynamicRefreshList([], "tblDUDeliveryChallan");
                  }
              },
              error: function (xhr, status, error)
              {
                  alert(error);
              }
          });
    }
    $("#btnReload").click(function() {
        window.location.href = _sBaseAddress+ '/DUDeliveryChallan/ViewDUDeliveryChallans?'+"buid="+_nBUID+"&menuid="+_sMenuID; ;
    });



    ////Start adv Searching

    function updateProgress() {
        var value =$('#progressbar').progressbar('getValue');
        if (value < 96){
            value += Math.floor(Math.random() * 10);
            $('#progressbar').progressbar('setValue', value);
        }
    }
    function hideShow(miliseconds) {
        $("#progressbarParent").hide();
    }
    //Account Of Picker

    $("#txtContractorAdvS").keydown(function (e) {
        if (e.keyCode === 13) // Enter Press
        {
            PickContractors_AdvS();
        }
        else if (e.keyCode === 08) {
            $("#txtContractorAdvS").removeClass("fontColorOfPickItem");
            _sContractorIds = '';
        }
    });

    $("#btnClrContractorAdvS").click(function () {
        $("#txtContractorAdvS").removeClass("fontColorOfPickItem");
        $("#txtContractorAdvS").val("");
        _sContractorIds = '';
    });

    $("#btnPickContractorAdvS").click(function () {
        PickContractors_AdvS();
    });
    $("#txtSearchByAccountNamePickerAdvSearch").keydown(function (e) {
        var obj = {
            Event: e,
            SearchProperty: "Name",
            GlobalObjectList: _oAccountsOf,
            TableId: "tblAccountsPickerAdvSearch"
        };
        $('#txtSearchByAccountNamePickerAdvSearch').icsSearchByText(obj);
    });
    //End Account Of Picker
    $("#txtDeliverToAdvS").keydown(function (e) {
        if (e.keyCode === 13) // Enter Press
        {
            PickDeliverTo_AdvS();
        }
        else if (e.keyCode === 08) {
            $("#txtDeliverToAdvS").removeClass("fontColorOfPickItem");
            _sDeliverToIDs ="";
        }
    });

    $("#btnClrDeliverToAdvS").click(function () {
        $("#txtDeliverToAdvS").removeClass("fontColorOfPickItem");
        $("#txtDeliverToAdvS").val("");
        _sDeliverToIDs ="";
    });

    $("#btnPickDeliverToAdvS").click(function () {
        PickDeliverTo_AdvS();
    });

    //Product Pick
    $("#txtProductName").keydown(function (e) {
        debugger;
        var code = (e.keyCode ? e.keyCode : e.which);
        if (code == 13) // Enter Press
        {
            if($('#txtProductName').val()==null || $('#txtProductName').val()=="")
            {
                alert("Please Type Product and Press Enter.");
                $('#txtProductName').focus();
                return;
            }
            PickProduct($('#txtProductName').val());
        }
        if (code == 8) //backspace=8
        {
            //debugger;
            $("#txtProductName").removeClass("fontColorOfPickItem");
            _sProductIds= [];
        }
    });
    $("#btnProductPiker").click(function () {
        PickProduct("");
    });
    $("#btnClrProductPiker").click(function () {
        $("#txtProductName").val('');
        $("#txtProductName").removeClass("fontColorOfPickItem");
        _sProductIds= [];
    });
    function PickProduct(sProductName)
    {
        var oProduct = { BUID:sessionStorage.getItem("BUID"),ProductName:sProductName};
        var obj = {
            BaseAddress: _sBaseAddress,
            Object: oProduct,
            ControllerName: "Product",
            ActionName: "SearchByProductBUWise",
            IsWinClose: false
        };
        $.icsDataGets(obj, function (response) {
            debugger;
            if (response.status && response.objs.length > 0) {
                if (response.objs[0].ProductID > 0) {
                    var tblColums = [];
                    var oColumn = { field: "ProductCode", title: "Code", width: 100, align: "left" }; tblColums.push(oColumn);
                    oColumn = { field: "ProductName", title: "Name", width: 300, align: "left" }; tblColums.push(oColumn);
                    oColumn = { field: "MUnit", title: "Unit", width: 70, align: "left" }; tblColums.push(oColumn);
                    var oPickerParam = {
                        winid: 'winProductPicker',
                        winclass: 'clsProductPicker',
                        winwidth: 600,
                        winheight: 460,
                        tableid: 'tblProductPicker',
                        tablecolumns: tblColums,
                        datalist: response.objs,
                        multiplereturn: true,
                        searchingbyfieldName: 'NameCode',
                        windowTittle: 'Product List'
                    };
                    $.icsPicker(oPickerParam);
                    IntializePickerbutton(oPickerParam);
                }
                else {
                    alert(response.objs[0].ErrorMessage);
                }

            }else{
                alert("Data Not Found.");
            }
        });
    }


    //End Buyer Search
    $("#btnResetAdvSearch").click(function () {
        ResetAdvSearchWindow();
        DateActionsOrderDateAdvSearch();
        DateActionsInvoiceDateAdvSearch();
        DateActionsDeliveryDateAdvSearch();
        DateActionsStatusDateAdvSearch();
    });

    $("#btnSearchAdvSearch").click(function () {
        debugger;

        $(".lblLoadingMessage").show();

        var checkDate = CheckFromAndToDateValidation("cboDODateAdvS", "txtFromDODateAdvSearch", "txtToDODateAdvSearch");
        if (!checkDate) {
            alert("Start date must be greater than end date.");
            return false;
        }

        checkDate = CheckFromAndToDateValidation("cboChallanDateAdvS", "txtFromChallanDateAdvSearch", "txtToChallanDateAdvSearch");
        if (!checkDate) {
            alert("Start date must be greater than end date.");
            return false;
        }

        var ncboChallanDate = parseInt($("#cboChallanDateAdvS").val());
        var dFromChallanDate = $('#txtFromChallanDateAdvSearch').datebox('getValue');
        var dToChallanDate = $('#txtToChallanDateAdvSearch').datebox('getValue');

        var nCboDODate = parseInt($("#cboDODateAdvS").val());
        var dFromDODate = $('#txtFromDODateAdvSearch').datebox('getValue');
        var dToDODate = $('#txtToDODateAdvSearch').datebox('getValue');

        var nOrderType = parseInt($("#cboOrderType").val());

        var sPINo = $.trim($("#txtPINo").val());
        var sInvoiceNo = $.trim($("#txtInvoiceNo").val());
        var sPONo = $.trim($("#txtPONo").val());
        var sChallanNo =$.trim($("#txtChallanNo").val());
        var sLot =$.trim($("#txtLot").val());


        var sParams = _sDeliverToIDs + "~" +
                      _sProductIds + "~" +
                      ncboChallanDate + "~" +
                      dFromChallanDate + "~" +
                      dToChallanDate + "~" +
                       nCboDODate + "~" +
                      dFromDODate + "~" +
                      dToDODate + "~" +
                      nOrderType + "~" +
                      sPINo+"~"+
                      sInvoiceNo+"~"+
                      sPONo+"~"+
                      sChallanNo+"~"+
                       sLot+"~"+
                      _nBUID;
        var oDUDeliveryChallan = {
            Note : sParams
        };
        GetsAdvSearch(oDUDeliveryChallan);
    });
    function GetsAdvSearch(oDUDeliveryChallan)
    {
        $.ajax({
            type: "POST",
            dataType: "json",
            url: _sBaseAddress + "/DUDeliveryChallan/AdvSearch",
            traditional: true,
            data: JSON.stringify(oDUDeliveryChallan),
            contentType: "application/json; charset=utf-8",
            success: function (data) {
                var oDUDeliveryChallans = jQuery.parseJSON(data);
                debugger;
                if (oDUDeliveryChallans != null) {
                    if (oDUDeliveryChallans.length > 0)
                    {

                        DynamicRefreshList(oDUDeliveryChallans, "tblDUDeliveryChallan");
                        $("#winAdvSearch").icsWindow("close");

                    }
                    else
                    {
                        alert("Sorry, No data found.");
                        DynamicRefreshList([], "tblDUDeliveryChallan");
                    }

                } else {
                    alert("Sorry, No data found.");
                    DynamicRefreshList([], "tblDUDeliveryChallan");
                }
                $(".lblLoadingMessage").hide();
            }
        });
    }

   
 
    $('#txtSearchByOrderNo').keypress(function (e) {

        var code = (e.keyCode ? e.keyCode : e.which);
        if (code == 13)//Enter key-13
        {
            $(".lblLoadingMessage").show();
     
            var ncboChallanDate =0;
            var dFromChallanDate = icsdateformat(new Date());
            var dToChallanDate = icsdateformat(new Date());

            var nCboDODate = 0;
            var dFromDODate = icsdateformat(new Date());
            var dToDODate = icsdateformat(new Date());

            var nOrderType = 0;

            var sPINo = "";
            var sInvoiceNo = "";
            var sPONo = $.trim($("#txtSearchByOrderNo").val());
            var sChallanNo ="";
            var sLot ="";
            if(sPONo=="" || sPONo==null){ alert("Type Order No for search."); return ; }
            var sParams = _sDeliverToIDs + "~" +
                          _sProductIds + "~" +
                          ncboChallanDate + "~" +
                          dFromChallanDate + "~" +
                          dToChallanDate + "~" +
                           nCboDODate + "~" +
                          dFromDODate + "~" +
                          dToDODate + "~" +
                          nOrderType + "~" +
                          sPINo+"~"+
                          sInvoiceNo+"~"+
                          sPONo+"~"+
                          sChallanNo+"~"+
                           sLot+"~"+
                          _nBUID;
            var oDUDeliveryChallan = {
                Note : sParams
            };
            GetsAdvSearch(oDUDeliveryChallan);
        }

    });

    $('#txtSearchByLotNo').keypress(function (e) {

        var code = (e.keyCode ? e.keyCode : e.which);
        if (code == 13)//Enter key-13
        {
           
            $(".lblLoadingMessage").show();

     
            var ncboChallanDate =0;
            var dFromChallanDate = icsdateformat(new Date());
            var dToChallanDate = icsdateformat(new Date());

            var nCboDODate = 0;
            var dFromDODate = icsdateformat(new Date());
            var dToDODate = icsdateformat(new Date());

            var nOrderType = 0;

            var sPINo = "";
            var sInvoiceNo = "";
            var sPONo = "";
            var sChallanNo ="";
            var sLot =$.trim($("#txtSearchByLotNo").val());

            if(sLot=="" || sLot==null){ alert("Type Batch/Lot No for search."); return ; }

            var sParams = _sDeliverToIDs + "~" +
                          _sProductIds + "~" +
                          ncboChallanDate + "~" +
                          dFromChallanDate + "~" +
                          dToChallanDate + "~" +
                           nCboDODate + "~" +
                          dFromDODate + "~" +
                          dToDODate + "~" +
                          nOrderType + "~" +
                          sPINo+"~"+
                          sInvoiceNo+"~"+
                          sPONo+"~"+
                          sChallanNo+"~"+
                           sLot+"~"+
                          _nBUID;
            var oDUDeliveryChallan = {
                Note : sParams
            };
            GetsAdvSearch(oDUDeliveryChallan);
        }

    });


    function LoadComboAdv()
    {
        $("#cboOrderType").icsLoadCombo({
            List: _oOrderTypes,
            OptionValue: "OrderType",
            DisplayText: "ShortName",
        });
        $("#cboDODateAdvS,  #cboChallanDateAdvS").icsLoadCombo({
            List: _oCompareOperators,
            OptionValue: "id",
            DisplayText: "Value"
        });
    }
    function CheckFromAndToDateValidation(OperationComboId, FromDateId, ToDateId) {
        $("#" + OperationComboId).parent().parent().parent().find("select").removeClass("errorFieldBorder");
        var nCboVal = $("#" + OperationComboId).val();
        if (parseInt(nCboVal) == 5 || parseInt(nCboVal) == 6) {
            var fromDate = $("#" + FromDateId).datebox("getValue");
            var toDate = $("#" + ToDateId).datebox("getValue");
            if (new Date(fromDate) > new Date(toDate)) {
                $("#" + ToDateId).focus();
                $("#" + OperationComboId).addClass("errorFieldBorder");
                $(".lblLoadingMessage").hide();
                return false;
            } else {
                $("#" + OperationComboId).removeClass("errorFieldBorder");
                return true;
            }
        } else {
            return true;
        }
    }

    function ResetAdvSearchWindow() {
        _sContractorIds = '';
        _sDeliverToIDs = "";
        $("#winAdvSearch input").not("input[type='button']").val("");
        $("#winAdvSearch input").removeClass("fontColorOfPickItem");
        $("#winAdvSearch select").val(0);
        DateActionsOrderDateAdvSearch();
        DateActionsInvoiceDateAdvSearch();
        DateActionsDeliveryDateAdvSearch();
        $("#txtFromDODateAdvSearch,#txtToDODateAdvSearch,#txtToInvoiceDateAdvSearch,#txtFromChallanDateAdvSearch,#txtToChallanDateAdvSearch").datebox({ disabled: true });
        $("#txtFromDODateAdvSearch,#txtToDODateAdvSearch,#txtToInvoiceDateAdvSearch,#txtFromChallanDateAdvSearch,#txtToChallanDateAdvSearch").datebox("setValue", icsdateformat(new Date()));
    }

    function PickContractors_AdvS() {
        var oContractor = {
            Params: '2,3' + '~' + $.trim($("#txtContractorAdvS").val()+"~"+_nBUID)
        };
        var obj = {
            BaseAddress: _sBaseAddress,
            Object: oContractor,
            ControllerName: "Contractor",
            ActionName: "ContractorSearchByNameType",
            IsWinClose: false
        };

        $("#progressbar").progressbar({ value: 0 });
        $("#progressbarParent").show();
        var intervalID = setInterval(updateProgress, 250);

        DynamicRefreshList([], "tblAccountsPickerAdvSearch");
        $.icsDataGets(obj, function (response) {
            clearInterval(intervalID);
            $("#progressbarParent").hide();
            if (response.status && response.objs.length > 0) {
                if (response.objs[0].ContractorID > 0) {
                    var tblColums = []; var oColumn = { field: "ContractorID", title: "Code", width: 50, align: "left" }; tblColums.push(oColumn);
                    oColumn = { field: "Name", title: "Name", width: 280, align: "left" }; tblColums.push(oColumn);

                    var oPickerParam = {
                        winid: 'winContractorPicker',
                        winclass: 'clsAccountOf',
                        winwidth: 400,
                        winheight: 460,
                        tableid: 'tblAccountOfs',
                        tablecolumns: tblColums,
                        datalist: response.objs,
                        multiplereturn: true,
                        searchingbyfieldName: 'Name',
                        windowTittle: 'Contactor List'
                    };
                    $.icsPicker(oPickerParam);
                    IntializePickerbutton(oPickerParam);
                }
                else {
                    alert(response.objs[0].ErrorMessage);
                }
            }
            else {
                alert("Sorry, No Contactor Found.");
            }
        });
    }

    function PickDeliverTo_AdvS() {
        var oContractor = {
            Params: '2' + '~' + $.trim($("#txtDeliverToAdvS").val()+"~"+_nBUID)
        };
        var obj = {
            BaseAddress: _sBaseAddress,
            Object: oContractor,
            ControllerName: "Contractor",
            ActionName: "ContractorSearchByNameType",
            IsWinClose: false
        };
        $("#progressbar").progressbar({ value: 0 });
        $("#progressbarParent").show();
        var intervalID = setInterval(updateProgress, 250);
        DynamicRefreshList([], "tblContractorsPickerAdvSearch");
        $.icsDataGets(obj, function (response) {
            clearInterval(intervalID);
            $("#progressbarParent").hide();
            if (response.status && response.objs.length > 0) {
                if (response.objs[0].ContractorID > 0) {
                    var tblColums = []; var oColumn = { field: "ContractorID", title: "Code", width: 50, align: "left" }; tblColums.push(oColumn);
                    oColumn = { field: "Name", title: "Name", width: 280, align: "left" }; tblColums.push(oColumn);
                    var oPickerParam = {
                        winid: 'winBuyers',
                        winclass: 'clsBuyer',
                        winwidth: 400,
                        winheight: 460,
                        tableid: 'tblBuyers',
                        tablecolumns: tblColums,
                        datalist: response.objs,
                        multiplereturn: true,
                        searchingbyfieldName: 'Name',
                        windowTittle: 'Buyer List'
                    };
                    $.icsPicker(oPickerParam);
                    IntializePickerbutton(oPickerParam);
                }
                else {
                    alert(response.objs[0].ErrorMessage);
                }
            }
            else {
                alert("Sorry, No Contactor Found.");
            }
        });
    }

    function DateActionsOrderDateAdvSearch() {
        DynamicDateActions("cboDODateAdvS", "txtFromDODateAdvSearch", "txtToDODateAdvSearch");
    }

    function DateActionsDeliveryDateAdvSearch() {
        DynamicDateActions("cboChallanDateAdvS", "txtFromChallanDateAdvSearch", "txtToChallanDateAdvSearch");
    }

    $("#btnCloseAdvSearch").click(function () {
        $("#winAdvSearch").icsWindow("close");
    });
    $("#btnAdvSearch").click(function () {
        debugger;
        $("#winAdvSearch").icsWindow("open", "Delivery Order Advance Search");
        //DynamicRefreshList([], "tblExportPIAdvSearch");
        DynamicResetAdvSearchWindow("winAdvSearch");
        DynamicDateActions("cboDateOptionAdvSearch", "txtFromDateAdvSearch", "txtToDateAdvSearch");

        DynamicDateActions("cboChallanDateAdvS", "txtFromChallanDateAdvSearch", "txtToChallanDateAdvSearch");
        ResetAdvSearchWindow();
    });

    function IntializePickerbutton(oPickerobj) {
        $("#" + oPickerobj.winid).find("#btnOk").click(function () {
            SetPickerValueAssign(oPickerobj);
        });
        $(document).find('.' + oPickerobj.winclass).keydown(function (e) {
            if (e.which === 13) {
                SetPickerValueAssign(oPickerobj);
            }
        });
    }

    function SetPickerValueAssign(oPickerobj) {
        var oreturnObj = null, oreturnObjs = [];
        if (oPickerobj.multiplereturn) {
            oreturnObjs = $('#' + oPickerobj.tableid).datagrid('getChecked');
        } else {
            oreturnObj = $('#' + oPickerobj.tableid).datagrid('getSelected');
        }

        if (oPickerobj.winid == 'winContractorPicker')
        {
            if (oreturnObjs != null && oreturnObjs.length> 0)
            {

                _sContractorIds=''; var sMessage='';
                sMessage=(oreturnObjs.length>1)? oreturnObjs.length +" Contractors Selected" : oreturnObjs[0].Name;
                $('#txtContractorAdvS').val(sMessage);
                $("#txtContractorAdvS").addClass("fontColorOfPickItem");

                for(var i=0;i<oreturnObjs.length;i++){
                    _sContractorIds=_sContractorIds+oreturnObjs[i].ContractorID+',';
                }
                _sContractorIds=_sContractorIds.substring(0,_sContractorIds.length-1);

            }
            else
            {
                alert("Please select a contractor.");
                return false;
            }
        }

        else if (oPickerobj.winid == 'winBuyers') {
            if (oreturnObjs != null && oreturnObjs.length> 0)
            {
                _sDeliverToIDs='';
                var sMessage='';
                sMessage=(oreturnObjs.length>1)? oreturnObjs.length +" Contractors Selected" : oreturnObjs[0].Name;
                $('#txtDeliverToAdvS').val(sMessage);
                $("#txtDeliverToAdvS").addClass("fontColorOfPickItem");

                for(var i=0;i<oreturnObjs.length;i++){
                    _sDeliverToIDs=_sDeliverToIDs+oreturnObjs[i].ContractorID+',';
                }
                _sDeliverToIDs=_sDeliverToIDs.substring(0,_sDeliverToIDs.length-1);



            }
            else
            {
                alert("Please select a buyer.");
                return false;
            }
        }
        else if (oPickerobj.winid == 'winProductPicker')
        {
            if (oreturnObjs!= null && oreturnObjs.length> 0)
            {
                _sProductIds=''; var sMessage='';
                sMessage=(oreturnObjs.length>1)? oreturnObjs.length +" ProductName Selected" : oreturnObjs[0].ProductName;
                $('#txtProductName').val(sMessage);
                $("#txtProductName").addClass("fontColorOfPickItem");

                for(var i=0;i<oreturnObjs.length;i++){
                    _sProductIds=_sProductIds+oreturnObjs[i].ProductID+',';
                }
                _sProductIds=_sProductIds.substring(0,_sProductIds.length-1);

            }
            else
            {
                alert("Please select a Product.");
                return false;
            }

        }
        $("#" + oPickerobj.winid).icsWindow("close");
        $("#" + oPickerobj.winid).remove();
    }
    /// end Adv Searching

    //Photo start
    $("#btnPhoto").click(function () {
        var oDUDeliveryChallan = $('#tblDUDeliveryChallan').datagrid('getSelected');
        if (oDUDeliveryChallan ==null || oDUDeliveryChallan.DUDeliveryChallanID <=0 ) { alert("Please select an item from list."); return ; }

        //var SelectedRowIndex=$('#tblDUDeliveryChallan').datagrid('getRowIndex',oDUDeliveryChallan);
        //sessionStorage.setItem("SelectedRowIndex", SelectedRowIndex);
        $("#winDUDeliveryChallanImage").icsWindow('open', "Deliver Challan Image");
        //RefreshDUDeliveryChallanLayout("btnEditDUDeliveryChallan");
        GetDUDeliveryChallanImageInformation(oDUDeliveryChallan);
    });

    function GetDUDeliveryChallanImageInformation(oDUDeliveryChallan) {
        var obj =
        {
            BaseAddress: _sBaseAddress,
            Object: oDUDeliveryChallan,
            ControllerName: "DUDeliveryChallan",
            ActionName: "Get",
            IsWinClose: false
        };

        $.icsDataGet(obj, function (response) {
            debugger;
            if (response.status && response.obj!=null) {
                if (response.obj.DUDeliveryChallanID > 0) { RefreshDUDeliveryChallanImageControl(response.obj); }
                else {
                    _oDUDeliveryChallanImage = {DUDeliveryChallanImageID:0}
                    document.getElementById("imgPad").src=null;
                }
            }
            else
            {
                alert("No information found.");
            }
        });
    }

    function RefreshDUDeliveryChallanImageControl(oDUDeliveryChallanImage)
    {
        debugger;
        _oDUDeliveryChallanImage = oDUDeliveryChallanImage;
        $("#txtName").val(_oDUDeliveryChallanImage.Name);
        $("#txtContactNo").val(_oDUDeliveryChallanImage.ContractNo);
        $("#txtNote").val(_oDUDeliveryChallanImage.Note);
        if(_oDUDeliveryChallanImage.ByteInString!=""){document.getElementById("imgPad").src =  _oDUDeliveryChallanImage.ByteInString;}
        else {document.getElementById("imgPad").src=null;}
    }

    function readURLImg(input) {
        if (input.files && input.files[0]) {
            var reader = new FileReader();

            reader.onload = function (e) {
                $('#imgPad')
                    .attr('src', e.target.result)
                    .width(160)
                    .height(160);
            };

            reader.readAsDataURL(input.files[0]);
        }
    }

    $("#btnCloseDUDeliveryChallanImage").click(function () {
        $("#winDUDeliveryChallanImage").icsWindow("close");
        $("#winDUDeliveryChallanImage input").val("");
        $("#winDUDeliveryChallanImage select").val(0);
    });

    $("#btnSaveDUDeliveryChallanImage").click(function (e) {
        debugger;
        var sName = $("#txtName").val();
        if(sName == "" || sName == null){
            alert("Please enter Name!!");
            $("#txtName").focus();
            return;
        }
        var oDUDeliveryChallan = $('#tblDUDeliveryChallan').datagrid('getSelected');
        var IsImg = true;
        var  oFormdata = new FormData();
        var fileInput = document.getElementById("fileInput");
        if(fileInput.files[0]!=null){oFormdata.append(fileInput.files[0].name, fileInput.files[0]);} else IsImg=false;

        var nts=((new Date()).getTime())/1000;
        var xhr = new XMLHttpRequest();
        xhr.open('POST',_sBaseAddress+'/DUDeliveryChallan/SaveDUDeliveryChallanImage?nts='+ nts);

        xhr.setRequestHeader('DUDeliveryChallanImageID', (_oDUDeliveryChallanImage != null) ? _oDUDeliveryChallanImage.DUDeliveryChallanImageID : 0);
        xhr.setRequestHeader('DUDeliveryChallanID', oDUDeliveryChallan.DUDeliveryChallanID);
        xhr.setRequestHeader('Name', $.trim($("#txtName").val()));
        xhr.setRequestHeader('ContractNo', $.trim($("#txtContactNo").val()));
        xhr.setRequestHeader('Note', $.trim($("#txtNote").val()));
        xhr.setRequestHeader('IsImg', IsImg);

        xhr.send(oFormdata);

        xhr.onreadystatechange = function () {
            if (xhr.readyState == 4 && xhr.status == 200) {  //the response is ready
                var oDUDeliveryChallanImage= MakeObject(xhr.responseText);
                if (oDUDeliveryChallanImage.DUDeliveryChallanImageID>0)
                {
                    $("#fileInput")[0].value=null;
                    alert("Data Saved sucessfully");
                    $("#winDeliverySetup").icsWindow("close");
                    $("#winDeliverySetup input").val("");
                    $("#winDeliverySetup select").val(0);
                    //if(sessionStorage.getItem('ChallanOperation') == "ADD"){
                    //    $('#tblDeliverySetups').datagrid('appendRow', oDeliverySetup);
                    //}else{
                    //    $('#tblDeliverySetups').datagrid('updateRow',{index:parseInt(sessionStorage.getItem("SelectedRowIndex")), row : oDeliverySetup});
                    //}
                }
                else
                {
                    $("#fileInput")[0].value=null;
                    alert(oDUDeliveryChallanImage.ErrorMessage);
                }
            }
        }

    });

    function MakeObject(sResponseValue)
    {
        sResponseValue=sResponseValue.split('\\"')[1]
        //var nEmployeeDocID=sResponseValue.split('~')[0];
        var oDS=
            {
                ErrorMessage: sResponseValue.split('~')[0],
                DUDeliveryChallanImageID : sResponseValue.split('~')[1],
                DUDeliveryChallanID : sResponseValue.split('~')[2],
                Name :sResponseValue.split('~')[3],
                ContractNo : sResponseValue.split('~')[4],
                Note : sResponseValue.split('~')[5]
            };
        return oDS;
    }

    //photo end


</script>
