    @model IEnumerable<ESimSol.BusinessObjects.ReportingObject.ExportLCReport>
    @{
        ViewBag.Title = "Export LC Report";
    }
    <html>        
        <body>
            <div id="progbarParent" style="width:100%;height:100%;margin:0 auto;text-align:center; margin-left: auto;margin-right: auto;left: 0;right: 0;z-index: 1;">
                <div style="margin: 0px auto;margin-top: 251px;text-align:center;width:390px;">
                    <label style="font-size:18px;">Please wait</label>
                    <div id="progbar" style="width:100%;height:37px;"></div>
                </div>
            </div>
            <div class="menuMainCollectionTable">
                <div id="tabLCReport" class="easyui-tabs" style="width:100%; height:100%">
                    <div title="L/C(Amendment) View" id="divLCVersion" style="width:100%;height:92%">
                        <table id="tblVersionView" style="width:100%; height:100%" class="easyui-datagrid" fit="true" fitcolumns="false" rownumbers="true" pagination="false" showfooter="true" singleselect="true" autorowheight="false" toolbar="#toolbar_LCVersion" data-options="rowStyler: function(index,row){
                                         if (row.ProductName=='Total'){
                                            return 'color:#016B18; font-weight:bold;';
                                        }
                                    }
                    ">
                            <thead>
                                <tr>

                                    <th field="LCOpenDateSt" width="10%" align="center">LC Open Date</th>
                                    <th field="AmendmentDateSt" width="10%" align="center">Amendment Date</th>
                                    <th field="LCNo" width="10%">L/C No</th>
                                    <th field="AmendmentNoWithExportLCID" width="6%" align="right" formatter="AmendmentNoWithExportLCID">A No</th>
                                    <th field="ContractorName" width="15%">Buyer Name</th>
                                    <th field="QtySt" width="10%" align="right">Qty</th>
                                    <th field="AmountSt" width="10%" align="right">Value</th>
                                    <th field="MKTPersonName" width="15%">Concern Person</th>
                                    <th field="LCReceiveDateSt" width="10%" align="center">L/C Receive Date</th>
                                    <th field="BankName_Nego" width="20%">Negotiate Bank</th>
                                    <th field="BankName_Issue" width="20%">Issue Bank</th>

                                </tr>
                            </thead>
                        </table>
                        <div id="toolbar_LCVersion">
                            <a id="btnAdvanceSearchLC_VersonView" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-search" plain="true">Adv. Search</a>
                            @*<a id="btnViewLCLog" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-details" plain="true">View LC</a>*@
                            <a id="btnPrint_VersonView" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-print" plain="true">Print</a>
                            <a id="btnExcel_VersonView" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-excel" plain="true">Excel</a>
                           

                        </div>

                    </div>
                    <div title="L/C View" id="divLCView" style="width:100%;height:92%">
                        <table id="tblLCView" style="width:100%; height:100%" class="easyui-datagrid" fit="true" fitcolumns="false" showfooter="true" rownumbers="true" pagination="false" singleselect="true" autorowheight="false" toolbar="#toolbar_LCView" data-options="rowStyler: function(index,row){
                                        if (row.ProductName=='Total'){
                                            return 'color:#016B18; font-weight:bold;';
                                        }
                                    }
                    ">
                            <thead>
                                <tr>

                                    <th field="LCOpenDateSt" width="10%" align="center">LC Open Date</th>
                                    <th field="LCNo" width="10%">L/C No</th>
                                    <th field="ContractorName" width="15%">Buyer Name</th>
                                    <th field="QtySt" width="10%" align="right">Qty</th>
                                    <th field="AmountSt" width="10%" align="right">Value</th>
                                    <th field="MKTPersonName" width="15%">Concern Person</th>
                                    <th field="LCReceiveDateSt" width="10%" align="center">L/C Receive Date</th>
                                    <th field="BankName_Nego" width="20%">Negotiate Bank</th>
                                    <th field="BankName_Issue" width="20%">Issue Bank</th>
                                </tr>
                            </thead>
                        </table>

                        <div id="toolbar_LCView">
                            <a id="btnAdvanceSearchLC_LCView" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-search" plain="true">Adv. Search</a>
                            <a id="btnPrint_LCView" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-print" plain="true">Print</a>
                            <a id="btnExcel_LCView" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-excel" plain="true">Excel</a>
                        </div>
                    </div>
                    <div title="P/I View" id="divPIView" style="width:100%;height:92%">
                        <table id="tblPIView" style="width:100%; height:100%" class="easyui-datagrid" fit="true" fitcolumns="false" rownumbers="true" showfooter="true"  pagination="false" singleselect="true" autorowheight="false" toolbar="#toolbar_PIView" data-options="rowStyler: function(index,row){
                                        if (row.ProductName=='Total'){
                                            return 'color:#016B18; font-weight:bold;';
                                        }
                                    }
                    ">
                            <thead>
                                <tr>
                                    <th field="LCOpenDateSt" width="10%" align="center">LC Open Date</th>
                                    <th field="AmendmentDateSt" width="10%" align="center">Amendment Date</th>
                                    <th field="LCNo" width="10%">L/C No</th>
                                    <th field="AmendmentNoWithExportLCID" width="6%" align="right" formatter="AmendmentNoWithExportLCID">A No</th>
                                    <th field="PINo" width="10%">P/I No</th>
                                    <th field="ContractorName" width="15%">Buyer Name</th>
                                    <th field="QtySt" width="10%" align="right">Qty</th>
                                    <th field="AmountSt" width="10%" align="right">Value</th>
                                    <th field="MKTPersonName" width="15%">Concern Person</th>
                                    <th field="LCReceiveDateSt" width="10%" align="center">L/C Receive Date</th>
                                    <th field="BankName_Nego" width="20%">Negotiate Bank</th>
                                    <th field="BankName_Issue" width="20%">Issue Bank</th>
                                </tr>
                            </thead>
                        </table>

                        <div id="toolbar_PIView">
                            <a id="btnAdvanceSearchLC_PIView" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-search" plain="true">Adv. Search</a>
                            @*<a id="btnViewLCLog" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-details" plain="true">View LC</a>*@
                           
                            <a id="btnPrint_PIView" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-print" plain="true">Print</a>
                            <a id="btnExcel_PIView" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-excel" plain="true">Excel</a>
                        </div>
                    </div>
                    <div title="Product View" id="divDetailView" style="width:100%;height:92%">
                        <table id="tblDetailView" style="width:100%; height:100%" class="easyui-datagrid" fit="true" fitcolumns="false" showfooter="true" rownumbers="true" pagination="false" singleselect="true" autorowheight="false" toolbar="#toolbar_DetailView" data-options="rowStyler: function(index,row){
                                        if (row.ProductName=='Total'){
                                            return 'color:#016B18; font-weight:bold;';
                                        }
                                    }
                    ">
                            <thead>
                                <tr>
                                    <th field="LCOpenDateSt" width="10%" align="center">LC Open Date</th>
                                    <th field="AmendmentDateSt" width="10%" align="center">Amendment Date</th>
                                    <th field="LCNo" width="10%">L/C No</th>
                                    <th field="AmendmentNoWithExportLCID" width="6%" align="right" formatter="AmendmentNoWithExportLCID">A No</th>
                                    <th field="PINo" width="10%">P/I No</th>
                                    <th field="ContractorName" width="15%">Buyer Name</th>
                                    <th field="ProductCode" width="5%">Product Code</th>
                                    <th field="ProductName" width="20%">Product Name</th>
                                    <th field="QtySt" width="10%" align="right">Qty</th>
                                    <th field="UnitPrice" width="10%" align="right" formatter="formatPrice">Unit Price</th>
                                    <th field="AmountSt" width="10%" align="right">Value</th>
                                    <th field="MKTPersonName" width="15%">Concern Person</th>
                                    <th field="LCReceiveDateSt" width="10%" align="center">L/C Receive Date</th>
                                    <th field="BankName_Nego" width="20%">Negotiate Bank</th>
                                    <th field="BankName_Issue" width="20%">Issue Bank</th>



                                </tr>
                            </thead>
                        </table>

                        <div id="toolbar_DetailView">
                            <a id="btnAdvanceSearchLC_DetailView" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-search" plain="true">Adv. Search</a>
                            <a id="btnPrint_DetailView" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-print" plain="true">Print</a>
                            <a id="btnExcel_DetailView" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-excel" plain="true">Excel</a>
                        </div>
                    </div>
                </div>             
            </div>

            <div id="winAdvSearchExportLC" style="width:650px" class="easyui-window winClass" title="Adv. Search" data-options="modal:true,closed:true,collapsible:false,minimizable:false,maximizable:false,closable:false">
                <table style="width:100%">
                    <tr>
                        <td>
                            <fieldset>
                                <legend>Searching Criteria</legend>
                                <table>
                                    <tr>
                                        <td style="width:25%;text-align:right;">
                                            <label>L/C Open/Amt Date </label>
                                        </td>
                                        <td style=" width:75%;text-align:left;">
                                            <select id="cboLCOpenDate" style="width:30%;" onchange="DateActions_LCOpenDate();"></select>
                                            <input id="txtLCOpenStartDate" type="text" style="width: 100px;" class="easyui-datebox" required="required" data-options="formatter:icsdateformat,parser:icsdateparser" />To
                                            <input id="txtLCOpenEndDate" type="text" style="width: 100px;" class="easyui-datebox" required="required" data-options="formatter:icsdateformat,parser:icsdateparser" />
                                        </td>
                                    </tr>
                                    <tr>
                                        <td style=" width:25%;text-align:right;">
                                            <label>L/C Received Date </label>
                                        </td>
                                        <td style=" width:75%;text-align:left;">
                                            <select id="cboLCReceivedDate" style="width:30%;" onchange="DateActions_LCReceivedDate();"></select>
                                            <input id="txtLCReceivedStartDate" type="text" style="width: 100px;" class="easyui-datebox" required="required" data-options="formatter:icsdateformat,parser:icsdateparser" />To
                                            <input id="txtLCReceivedEndDate" type="text" style="width: 100px;" class="easyui-datebox" required="required" data-options="formatter:icsdateformat,parser:icsdateparser" />
                                        </td>
                                    </tr>
                                    <tr>
                                        <td style=" width:25%;text-align:right;">
                                            <label>Party Name :</label>
                                        </td>
                                        <td style=" width:75%;text-align:left;">
                                            <input id="txtContractorAdvS" style="width:75%;" type="text" placeholder="Type & Press Enter" />
                                            <a id="btnPickContractorAdvS" href="javascript:void(0)" class="easyui-linkbutton ics-pick" iconcls="icon-pick" plain="true"></a>
                                            <a id="btnClrContractorAdvS" href="javascript:void(0)" class="easyui-linkbutton ics-pick" iconcls="icon-clear" plain="true"></a>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td style=" width:25%;text-align:right;">
                                            <label>Mkt Concern Person :</label>
                                        </td>
                                        <td style=" width:75%;text-align:left;"><select id="cboMktPersons" style="width:75%;"></select></td>
                                    </tr>
                                    <tr>
                                        <td style=" width:25%;text-align:right;">
                                            <label>Nego Bank:</label>
                                        </td>
                                        <td style=" width:75%;text-align:left;">
                                            <select id="cboBankBranch_Nego" style="width:75%"></select>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td style=" width:25%;text-align:right;">
                                            <label>Issue Bank :</label>
                                        </td>
                                        <td style=" width:75%;text-align:left;">
                                            <input id="txtBankBranch_Issue" style="width:75%;" type="text" placeholder="Type & Press Enter" />
                                            <a id="btnPickBankBranch_Issue" href="javascript:void(0)" class="easyui-linkbutton ics-pick" iconcls="icon-pick" plain="true"></a>
                                            <a id="btnClrBankBranch_Issue" href="javascript:void(0)" class="easyui-linkbutton ics-pick" iconcls="icon-clear" plain="true"></a>

                                        </td>
                                    </tr>

                                </table>
                            </fieldset>

                        </td>
                    </tr>
                </table>

                <fieldset>
                    <legend>Actions : </legend>
                    <table border="0" cellspacing="2" cellpadding="2" style="width:100%;font-size:11px; font-weight:bold;">
                        <tr>
                            <td style="width:60%;text-align:left">
                                <a id="btnAdvSearchReset" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-reload" plain="true"> Reset</a>
                                <label class="lblLoadingMessage" style="float: left;">Loading Please Wait...</label>
                            </td>
                            <td style="width:40%; text-align: right">
                                <a id="btnSearch" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-search" plain="true">Search</a>
                                <a id="btnAdvSearchClose" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-cancel" plain="true">Close</a>
                            </td>
                        </tr>
                    </table>
                </fieldset>
            </div>
            

             
            
        </body>
    </html>
                        
    <script type="text/javascript">
    var _oExportLCReports=[];
    var _oLCStatus=[];
    var _oBankBranchs=[];
    var _oTextileUnits=[];
    var _sContractorIds="";
    var _sBankBranch_IssueIds="";
    var _oCompareOperators=[];
    var _oCompanys=[];
    var _oBankBranchs_Nego=[];
    var _oCurrencys=[];
    var _oCompareOperators=[];
    var _nLCReportLevel=0;
    var _nBUID=0;
    var _oMarketingAccounts = [];
    $(document).ready(function () {
        _oExportLCReports =@Html.Raw( new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(Model));
        var oLCReportLevelObjs = @Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(@ViewBag.LCReportLevelObjs));
        _oBankBranchs_Nego = @Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(@ViewBag.NegoBanks));
        var oAdviceBanks = @Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(@ViewBag.AdviceBanks));
        var oExportLCStatus = @Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(@ViewBag.ExportLCStatus));
        _oCompareOperators = @Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(@ViewBag.CompareOperators));
        _oMarketingAccounts  = @Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(@ViewBag.MarketingAccounts));
        _nBUID = @Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(ViewBag.BUID));
        sessionStorage.setItem('BUID', _nBUID);
        sessionStorage.setItem("Params", "");
        $("#progbar").progressbar({ value: 0 });
        $("#progbarParent").hide();
        // RefreshCommoboBox();
        //DefineDataGridColumns();
        RefreshSearchComboBoxControls();
        DynamicRefreshList(_oExportLCReports, "tblVersionView");
        MakeFooterColumn("tblVersionView");
    });
    function ValidateSearch()
    {
        var sFileNo =$.trim($('#txtFileNo').val());
        var oApplicants= $('#txtApplicantName').data('Applicants');
        var nNegoBank = parseInt($('#cboNegoBank').val());
        var nAdviseBank = parseInt($('#cboAdviseBank').val());
        var oIssueBanks = $('#txtIssueBankName').data('IssueBanks');

        var nLCOpenDate = parseInt($('#cboLCOpenDate').val());
        if(nLCOpenDate===1 || nLCOpenDate===2 || nLCOpenDate===3 || nLCOpenDate===4)
        {
            var sLCOpenDateStartDate   = $('#txtLCOpenStartDate').datebox('getValue');
            if(sLCOpenDateStartDate===null || sLCOpenDateStartDate==="")
            {
                alert("Please select LCOpenDate start date!");
                $('#txtLCOpenStartDate').focus();
                return false;
            }
        }
        if(nLCOpenDate===5 || nLCOpenDate===6)
        {
            var sLCOpenDateStartDate   = $('#txtLCOpenStartDate').datebox('getValue');
            var sLCOpenDateEndDate   = $('#txtLCOpenEndDate').datebox('getValue');
            if(sLCOpenDateStartDate===null || sLCOpenDateStartDate==="")
            {
                alert("Please select LCOpenDate start date!");
                $('#txtLCOpenStartDate').focus();
                return false;
            }
            if(sLCOpenDateEndDate===null || sLCOpenDateEndDate==="")
            {
                alert("Please select LCOpenDate end date!");
                $('#txtLCOpenEndDate').focus();
                return false;
            }
            if(new Date(sLCOpenDateStartDate) > new Date(sLCOpenDateEndDate))
            {
                alert("LC Open Start date must be smallar than or equal end date!");
                $('#txtLCOpenStartDate').focus();
                return false;
            }
        }


        var nLCReceivedDate = parseInt($('#cboLCReceivedDate').val());
        if(nLCReceivedDate===1 || nLCReceivedDate===2 || nLCReceivedDate===3 || nLCReceivedDate===4)
        {
            var sLCReceivedStartDate   = $('#txtLCReceivedStartDate').datebox('getValue');
            if(sLCReceivedStartDate===null || sLCReceivedStartDate==="")
            {
                alert("Please select LCReceived start date!");
                $('#txtLCReceivedStartDate').focus();
                return false;
            }
        }
        if(nLCReceivedDate===5 || nLCReceivedDate===6)
        {
            var sLCReceivedStartDate   = $('#txtLCReceivedStartDate').datebox('getValue');
            var sLCReceivedEndDate   = $('#txtLCReceivedEndDate').datebox('getValue');
            if(sLCReceivedStartDate===null || sLCReceivedStartDate==="")
            {
                alert("Please select LCReceived start date!");
                $('#txtLCReceivedStartDate').focus();
                return false;
            }
            if(sLCReceivedEndDate===null || sLCReceivedEndDate==="")
            {
                alert("Please select LCReceived end date!");
                $('#txtLCReceivedEndDate').focus();
                return false;
            }
            if(new Date(sLCReceivedStartDate) > new Date(sLCReceivedEndDate))
            {
                alert("LC Received Start date must be smallar than or equal end date!");
                $('#txtLCReceivedStartDate').focus();
                return false;
            }
        }

        var nShipmentDate = parseInt($('#cboShipmentDate').val());
        if(nShipmentDate===1 || nShipmentDate===2 || nShipmentDate===3 || nShipmentDate===4)
        {
            var sShipmentStartDate   = $('#txtShipmentStartDate').datebox('getValue');
            if(sShipmentStartDate===null || sShipmentStartDate==="")
            {
                alert("Please select Shipment start date!");
                $('#txtShipmentStartDate').focus();
                return false;
            }
        }
        if(nShipmentDate===5 || nShipmentDate===6)
        {
            var sShipmentStartDate   = $('#txtShipmentStartDate').datebox('getValue');
            var sShipmentEndDate   = $('#txtShipmentEndDate').datebox('getValue');
            if(sShipmentStartDate===null || sShipmentStartDate==="")
            {
                alert("Please select Shipment start date!");
                $('#txtShipmentStartDate').focus();
                return false;
            }
            if(sShipmentEndDate===null || sShipmentEndDate==="")
            {
                alert("Please select Shipment end date!");
                $('#txtShipmentEndDate').focus();
                return false;
            }
            if(new Date(sShipmentStartDate) > new Date(sShipmentEndDate))
            {
                alert("Shipment Start date must be smallar than or equal end date!");
                $('#txtShipmentStartDate').focus();
                return false;
            }
        }


        var nExpireDate = parseInt($('#cboExpireDate').val());
        if(nExpireDate===1 || nExpireDate===2 || nExpireDate===3 || nExpireDate===4)
        {
            var sExpireStartDate   = $('#txtExpireStartDate').datebox('getValue');
            if(sExpireStartDate===null || sExpireStartDate==="")
            {
                alert("Please select Expire start date!");
                $('#txtExpireStartDate').focus();
                return false;
            }
        }
        if(nExpireDate===5 || nExpireDate===6)
        {
            var sExpireStartDate   = $('#txtExpireStartDate').datebox('getValue');
            var sExpireEndDate   = $('#txtExpireEndDate').datebox('getValue');
            if(sExpireStartDate===null || sExpireStartDate==="")
            {
                alert("Please select Expire start date!");
                $('#txtExpireStartDate').focus();
                return false;
            }
            if(sExpireEndDate===null || sExpireEndDate==="")
            {
                alert("Please select Expire end date!");
                $('#txtExpireEndDate').focus();
                return false;
            }
            if(new Date(sExpireStartDate) > new Date(sExpireEndDate))
            {
                alert("Expire Start date must be smallar than or equal end date!");
                $('#txtExpireStartDate').focus();
                return false;
            }
        }
        var bOriginalCopy= $('#chkGetOriginalCopy').is(':checked');
        var bExportDoIsntCreateYet= $('#chkExportDoIsntCreateYet').is(':checked');
        var bDeliveryChallanIssueButBillNotCreated= $('#chkDeliveryChallanIssueButBillNotCreated').is(':checked');
        var bExportPIIsntCreateYet= $('#chkExportPIIsntCreateYet').is(':checked');
        var oExportLCStatus=$('#tblExportLCStatus').datagrid('getChecked');
        var nMkTPerson = parseInt($('#cboMktPersons').val());

        if(sFileNo==='' && oApplicants.length<=0 && nNegoBank===0 && nAdviseBank===0 && oIssueBanks.length<=0 && nLCOpenDate===0 && nLCReceivedDate ===0 && nShipmentDate ===0 && nExpireDate ===0 && bOriginalCopy===false && bExportDoIsntCreateYet===false && bDeliveryChallanIssueButBillNotCreated===false && bExportPIIsntCreateYet===false && oExportLCStatus.length<=0 && nMkTPerson==0)
        {
            alert("Please select atleast one searching criteriea!");
            return false;
        }
        return true;
    }
    $('#btnSearch').click(function(e)
    {
        debugger;
        var nLCOpenDate = parseInt($('#cboLCOpenDate').val());
        var sLCOpenDateStartDate   = $('#txtLCOpenStartDate').datebox('getValue');
        var sLCOpenDateEndDate   = $('#txtLCOpenEndDate').datebox('getValue');
        var nLCReceivedDate = parseInt($('#cboLCReceivedDate').val());
        var sLCReceivedStartDate   = $('#txtLCReceivedStartDate').datebox('getValue');
        var sLCReceivedEndDate   = $('#txtLCReceivedEndDate').datebox('getValue');
        var nBankBranchID_Nego=parseInt($("#cboBankBranch_Nego").val());
        var nMkTPerson = parseInt($('#cboMktPersons').val());
        var sParams =    nLCOpenDate + "~" +
                         sLCOpenDateStartDate + "~" +
                         sLCOpenDateEndDate + "~" +
                         nLCReceivedDate + "~" +
                         sLCReceivedStartDate + "~" +
                         sLCReceivedEndDate + "~" +
                        _sContractorIds + "~" +
                        _sBankBranch_IssueIds + "~" +
                        nBankBranchID_Nego+ "~" +nMkTPerson;
        var oExportLCReport = {
            SearchingCriteria : sParams,
            BUID : parseInt(sessionStorage.getItem("BUID")),
            LCReportLevelInt : _nLCReportLevel
        };
        sessionStorage.setItem("Params", sParams);
        $.ajax({
            type: "POST",
            dataType: "JSON",
            url: sessionStorage.getItem("BaseAddress")+  "/ExportLCReport/AdvanchSearch",
            data:  JSON.stringify(oExportLCReport),
            contentType: "application/json; charset=utf-8",
            success: function (data) {
                var  oExportLCReports = data;
                if (oExportLCReports != null) {
                    if(oExportLCReports.length>0)
                    {
                        if(_nLCReportLevel==0)
                        {
                            DynamicRefreshList(oExportLCReports, "tblLCView");
                            MakeFooterColumn("tblLCView");
                        }
                        else if(_nLCReportLevel==1)
                        {
                            DynamicRefreshList(oExportLCReports, "tblVersionView");
                            MakeFooterColumn("tblVersionView");
                        }
                        else if(_nLCReportLevel==2)
                        {
                            DynamicRefreshList(oExportLCReports, "tblPIView");
                            MakeFooterColumn("tblPIView");
                        }
                        else if(_nLCReportLevel==3)
                        {
                            DynamicRefreshList(oExportLCReports, "tblDetailView");
                            MakeFooterColumn("tblDetailView");
                        }
                        $("#winAdvSearchExportLC").icsWindow('close');
                    }
                    else
                    {
                        alert("Data not found!!");
                    }
                }
            },
            error: function (xhr, status, error) {
                alert(error);
            }
        });
    });
    $("#btnAdvanceSearchLC_VersonView").click(function () {
        $(".lblLoadingMessage").hide();
        $("#winAdvSearchExportLC").icsWindow("open", "Advance Search");
        _nLCReportLevel=1;
    });
    $("#btnAdvanceSearchLC_LCView").click(function () {
        $(".lblLoadingMessage").hide();
        $("#winAdvSearchExportLC").icsWindow("open", "Advance Search");
        _nLCReportLevel=0;
    });
    $("#btnAdvanceSearchLC_PIView").click(function () {
        $(".lblLoadingMessage").hide();
        $("#winAdvSearchExportLC").icsWindow("open", "Advance Search");
        _nLCReportLevel=2;
    });
    $("#btnAdvanceSearchLC_DetailView").click(function () {
        $(".lblLoadingMessage").hide();
        $("#winAdvSearchExportLC").icsWindow("open", "Advance Search");
        _nLCReportLevel=3;
    });

    function MakeFooterColumn(sTable)
    {
        debugger;
        var FooterField=[];
        var obj=new Object();
        var FieldNames=["Amount","Qty"];
        obj['LCOpenDateSt']="Gross Total: ";
        obj['AmendmentNoWithExportLCID'] = "";
        for(var j=0; j<FieldNames.length;j++)
        {
            obj[FieldNames[j]+'St']=formatPrice(GetSum(FieldNames[j],sTable),1);
        }

        FooterField.push(obj);
        $('#'+sTable).datagrid('reloadFooter',FooterField);
    }
    function GetSum(sFieldName,sTable)
    {
        debugger;
        var data=$('#'+sTable).datagrid('getRows').select(sFieldName);
        var sum = 0;
        if(data!=null && data.length>0)
        {
            for (i = 0; i < data.length; i++)
            {
                sum+=parseFloat(data[i]);
            }
        }
        return sum;
    }

    $('#btnAdvSearchReset').click(function(e){
        $("#winAdvSearchExportLC input").not("input[type='button']").val("");
        RefreshSearchComboBoxControls();
        _sContractorIds ="";
        _sBankBranch_IssueIds="";
        $('#txtLCOpenStartDate').datebox({ disabled : true });
        $('#txtLCOpenEndDate').datebox({ disabled : true });
        $('#txtLCOpenStartDate').datebox('setValue', icsdateformat(new Date()));
        $('#txtLCOpenEndDate').datebox('setValue', icsdateformat(new Date()));

        $('#txtLCReceivedStartDate').datebox({ disabled : true });
        $('#txtLCReceivedEndDate').datebox({ disabled : true });
        $('#txtLCReceivedStartDate').datebox('setValue', icsdateformat(new Date()));
        $('#txtLCReceivedEndDate').datebox('setValue', icsdateformat(new Date()));

        $('#txtShipmentStartDate').datebox({ disabled : true });
        $('#txtShipmentEndDate').datebox({ disabled : true });
        $('#txtShipmentStartDate').datebox('setValue', icsdateformat(new Date()));
        $('#txtShipmentEndDate').datebox('setValue', icsdateformat(new Date()));

        $('#txtExpireStartDate').datebox({ disabled : true });
        $('#txtExpireEndDate').datebox({ disabled : true });
        $('#txtExpireStartDate').datebox('setValue', icsdateformat(new Date()));
        $('#txtExpireEndDate').datebox('setValue', icsdateformat(new Date()));

        $('#txtApplicantName').data('Applicants', []);
        $('#txtIssueBankName').data('IssueBanks', []);

        $('#chkGetOriginalCopy').attr('checked', false);
        $('#chkExportDoIsntCreateYet').attr('checked', false);
        $('#chkDeliveryChallanIssueButBillNotCreated').attr('checked', false);
        $('#chkExportPIIsntCreateYet').attr('checked', false);


        $('#cboNegoBank').val(0);
        $('#cboAdviseBank').val(0);
        $('#cboLCOpenDate').val(0);
        $('#cboLCReceivedDate').val(0);
        $('#cboShipmentDate').val(0);
        $('#cboExpireDate').val(0);
    });
    $('#btnAdvSearchClose').click(function(e){
        $("#winAdvSearchExportLC").icsWindow('close');
    });

    function RefreshSearchComboBoxControls()
    {
        $("#cboLCOpenDate, #cboLCReceivedDate").icsLoadCombo({
            List: _oCompareOperators,
            OptionValue: "id",
            DisplayText: "Value"
        });

        $("#cboBankBranch_Nego").icsLoadCombo({
            List: _oBankBranchs_Nego,
            OptionValue: "BankBranchID",
            DisplayText: "BankBranchName"
        });
        $("#cboMktPersons").icsLoadCombo({List: _oMarketingAccounts,OptionValue: "MarketingAccountID",DisplayText: "Name"});

    }
    function DateActions_LCOpenDate() {
        DynamicDateActions("cboLCOpenDate", "txtLCOpenStartDate", "txtLCOpenEndDate");
    }
    function DateActions_LCReceivedDate() {
        DynamicDateActions("cboLCReceivedDate", "txtLCReceivedStartDate", "txtLCReceivedEndDate");
    }
    //Account Of Picker

    $("#txtContractorAdvS").keydown(function (e) {
        if (e.keyCode === 13) // Enter Press
        {
            PickContractors_AdvS();
        }
        else if (e.keyCode === 08) {
            $("#txtContractorAdvS").removeClass("fontColorOfPickItem");
            _sContractorIds = '';
        }
    });
    $("#btnClrContractorAdvS").click(function () {
        $("#txtContractorAdvS").removeClass("fontColorOfPickItem");
        $("#txtContractorAdvS").val("");
        _sContractorIds = '';
    });
    $("#btnPickContractorAdvS").click(function () {
        PickContractors_AdvS();
    });
    function PickContractors_AdvS() {
        var oContractor = {
            Params: '2,3' + '~' + $.trim($("#txtContractorAdvS").val()+"~"+_nBUID)
        };
        var obj = {
            BaseAddress: _sBaseAddress,
            Object: oContractor,
            ControllerName: "Contractor",
            ActionName: "ContractorSearchByNameType",
            IsWinClose: false
        };

        $("#progressbar").progressbar({ value: 0 });
        $("#progressbarParent").show();
        var intervalID = setInterval(updateProgress, 250);

        DynamicRefreshList([], "tblAccountsPickerAdvSearch");
        $.icsDataGets(obj, function (response) {
            clearInterval(intervalID);
            $("#progressbarParent").hide();
            if (response.status && response.objs.length > 0) {
                if (response.objs[0].ContractorID > 0) {
                    var tblColums = []; var oColumn = { field: "ContractorID", title: "Code", width: 50, align: "left" }; tblColums.push(oColumn);
                    oColumn = { field: "Name", title: "Name", width: 280, align: "left" }; tblColums.push(oColumn);

                    var oPickerParam = {
                        winid: 'winContractorPicker',
                        winclass: 'clsAccountOf',
                        winwidth: 400,
                        winheight: 460,
                        tableid: 'tblAccountOfs',
                        tablecolumns: tblColums,
                        datalist: response.objs,
                        multiplereturn: true,
                        searchingbyfieldName: 'Name',
                        windowTittle: 'Contactor List'
                    };
                    $.icsPicker(oPickerParam);
                    IntializePickerbutton(oPickerParam);
                }
                else {
                    alert(response.objs[0].ErrorMessage);
                }
            }
            else {
                alert("Sorry, No Contactor Found.");
            }
        });
    }

    
    //End Account Of Picker
    $("#txtBankBranch_Issue").keydown(function (e) {
        if (e.keyCode === 13) // Enter Press
        {
            if($("#txtBankBranch_Issue").val()=="" || $("#txtBankBranch_Issue").val()==null)
            {
                $("#txtBankBranch_Issue").removeClass("fontColorOfPickItem");
                _sBankBranch_IssueIds = '';
                alert("Please, Type name")
                return;
            }

            var oBankBranch = {
                BUID: _nBUID,
                DeptIDs: '5',//EnumOperationalDept : Export_Party=5
                BankName: $.trim($("#txtBankBranch_Issue").val())
            };
            PickBanks_AdvS(oBankBranch);
        }
        else if (e.keyCode === 08) {
            $("#txtBankBranch_Issue").removeClass("fontColorOfPickItem");
            _sBankBranch_IssueIds = '';
        }
    });
    $("#btnClrBankBranch_Issue").click(function () {
        $("#txtBankBranch_Issue").removeClass("fontColorOfPickItem");
        $("#txtBankBranch_Issue").val("");
        _sBankBranch_IssueIds = '';
    });
    $("#btnPickBankBranch_Issue").click(function () {
        var oBankBranch = {
            BUID: _nBUID,
            DeptIDs: '5',//EnumOperationalDept : Export_Party=5
            BankName: $.trim($("#txtBankBranch_Issue").val())
        };
        PickBanks_AdvS(oBankBranch);
    });
    function PickBanks_AdvS(oBankBranch) {

        var obj = {
            BaseAddress: _sBaseAddress,
            Object: oBankBranch,
            ControllerName: "BankBranch",
            ActionName: "GetsBankBranchSearchByBankName",
            IsWinClose: false
        };

        $("#progressbar").progressbar({ value: 0 });
        $("#progressbarParent").show();
        var intervalID = setInterval(updateProgress, 250);

        $.icsDataGets(obj, function (response) {
            clearInterval(intervalID);
            $("#progressbarParent").hide();
            if (response.status && response.objs.length > 0) {
                if (response.objs[0].BankBranchID > 0) {
                    var tblColums = []; var oColumn = { field: "BankName", title: "Bank Name", width: 200, align: "left" }; tblColums.push(oColumn);
                    oColumn = { field: "BranchName", title: "Branch Name", width: 280, align: "left" }; tblColums.push(oColumn);
                    oColumn = { field: "Address", title: "Address", width: 280, align: "left" }; tblColums.push(oColumn);

                    var oPickerParam = {
                        winid: 'winBankBranch_IssuePicker',
                        winclass: 'clsBankBranch_Issue',
                        winwidth: 500,
                        winheight: 460,
                        tableid: 'tblBankBranch_Issues',
                        tablecolumns: tblColums,
                        datalist: response.objs,
                        multiplereturn: true,
                        searchingbyfieldName: 'BranchName',
                        windowTittle: 'Bank List'
                    };
                    $.icsPicker(oPickerParam);
                    IntializePickerbutton(oPickerParam);
                }
                else {
                    alert(response.objs[0].ErrorMessage);
                }
            }
            else {
                alert("Sorry, No Contactor Found.");
            }
        });
    }

    //EndIssue Bank

    function IntializePickerbutton(oPickerobj) {
        $("#" + oPickerobj.winid).find("#btnOk").click(function () {
            SetPickerValueAssign(oPickerobj);
        });
        $(document).find('.' + oPickerobj.winclass).keydown(function (e) {
            if (e.which === 13) {
                SetPickerValueAssign(oPickerobj);
            }
        });
    }
    function SetPickerValueAssign(oPickerobj) {
        var oreturnObj = null, oreturnObjs = [];
        if (oPickerobj.multiplereturn) {
            oreturnObjs = $('#' + oPickerobj.tableid).datagrid('getChecked');
        } else {
            oreturnObj = $('#' + oPickerobj.tableid).datagrid('getSelected');
        }

        if (oPickerobj.winid == 'winContractorPicker')
        {
            if (oreturnObjs != null && oreturnObjs.length> 0)
            {

                _sContractorIds=''; var sMessage='';
                sMessage=(oreturnObjs.length>1)? oreturnObjs.length +" Contractors Selected" : oreturnObjs[0].Name;
                $('#txtContractorAdvS').val(sMessage);
                $("#txtContractorAdvS").addClass("fontColorOfPickItem");

                for(var i=0;i<oreturnObjs.length;i++){
                    _sContractorIds=_sContractorIds+oreturnObjs[i].ContractorID+',';
                }
                _sContractorIds=_sContractorIds.substring(0,_sContractorIds.length-1);

            }
            else
            {
                alert("Please select a contractor.");
                return false;
            }
        }

        else if (oPickerobj.winid == 'winBankBranch_IssuePicker') {
            if (oreturnObjs != null && oreturnObjs.length> 0)
            {
                var sMessage='';
                sMessage=(oreturnObjs.length>1)? oreturnObjs.length +" Bank(s) Selected" : oreturnObjs[0].BankName;
                $('#txtBankBranch_Issue').val(sMessage);
                $("#txtBankBranch_Issue").addClass("fontColorOfPickItem");

                for(var i=0;i<oreturnObjs.length;i++){
                    _sBankBranch_IssueIds=_sBankBranch_IssueIds+oreturnObjs[i].BankBranchID+',';
                }
                _sBankBranch_IssueIds=_sBankBranch_IssueIds.substring(0,_sBankBranch_IssueIds.length-1);
            }
            else
            {
                alert("Please select a Bank Branch.");
                return false;
            }
        }

        $("#" + oPickerobj.winid).icsWindow("close");
        $("#" + oPickerobj.winid).remove();
    }
    function updateProgress() {
        var value =$('#progbar').progressbar('getValue');
        if (value < 96){
            value += Math.floor(Math.random() * 10);
            $('#progbar').progressbar('setValue', value);
        }
    }
    function hideShow(miliseconds) {
        $("#progbarParent").hide();
    }


    $("#btnPrint_VersonView,#btnPrint_LCView,#btnPrint_PIView,#btnPrint_DetailView").click(function () {
        var bPrintWithMLC = false;
        if (confirm("Print With Master LC?")){ bPrintWithMLC = true ;}
        var sParams=sessionStorage.getItem("Params");
        window.open(sessionStorage.getItem("BaseAddress") + '/ExportLCReport/ExportReportPrintList?sParams='+sParams+'&nBUID='+_nBUID+'&nLCReportLevel=' +_nLCReportLevel+'&bPrintWithMLC='+bPrintWithMLC, "_blank");
    });

    $("#btnExcel_VersonView,#btnExcel_LCView,#btnExcel_PIView,#btnExcel_DetailView").click(function(){
        var sParams=sessionStorage.getItem("Params");
        window.open(sessionStorage.getItem("BaseAddress") + '/ExportLCReport/ExportReportPrintListInExcel?sParams='+sParams+'&nBUID='+_nBUID+'&nLCReportLevel=' +_nLCReportLevel, "_blank");
    });





















    $(document).keydown(function (e) { if (e.keyCode === 27) { $("div").icsWindow("close")}});

    $("#cboDateSearchType").change(function(){
        if($(this).val() == 1)
        {
            $("#spnToAmendmentDate").hide();
        }else{
            $("#spnToAmendmentDate").show();
        }
    });

    $("#btnPrintExportPISummary").click(function () {
        //var sRecDateFrom = '', sRecDateTo = '';

        //if ($("#chkAmendmentDate").is(':checked')) {
        //    if (new Date($('#txtToAmendmentDate').datebox("getValue")) < new Date($('#txtFromAmendmentDate').datebox("getValue"))) { alert("LC Rec End date must be greater than start date."); return false; }
        //    sRecDateFrom = $('#txtFromAmendmentDate').datebox("getValue");
        //    sRecDateTo = $('#txtToAmendmentDate').datebox("getValue");
        //}

        //var sParams = $("#cboTextileUnits").val() + "~"
        //             + "" + "~"
        //             + 0 + "~"
        //             + 0 + "~"
        //             + false + "~"
        //             + "" + "~"
        //             + "" + "~"
        //             + $("#chkAmendmentDate").is(':checked') + "~"
        //             + sRecDateFrom + "~"
        //             + sRecDateTo + "~"
        //             + false + "~"
        //             + "" + "~"
        //             + "";


        //if(sParams == false)
        //{
        //    return false;
        //}
        //var nts = ((new Date()).getTime()) / 1000;

        var   Params = $("#chkAmendmentDate").is(':checked') + "~" + $('#txtFromAmendmentDate').datebox('getValue') + "~" + $('#txtToAmendmentDate').datebox('getValue') + "~" + parseInt($("#cboDateSearchType").val())+ "~" + parseInt($("#cboTextileUnitsTwo").val());

        window.open(sessionStorage.getItem("BaseAddress") + '/ExportPI/PrintExportPISummaryReport?sParams='+sParams+"&nts=" + nts, "_blank");
    });



    $("#btnViewLCLog").click(function(){
        $('#tabExportLCTabsExportLC').tabs('select', 0);
        $(".amendmentDateFields").hide();
        var oExportLCReport = $("#tblExportLCReports").datagrid("getSelected");
        if (oExportLCReport == null || parseInt(oExportLCReport.ExportLCID) <= 0) { alert("Please select an item from list!"); return; }
        $("#winExportLC").icsWindow('open', "View ExportLC");
        RefreshExportLCLayout("btnViewExportLC");
        GetExportLCLog(oExportLCReport);
        SetAmendmentDate("btnViewExportLC");
    });

    function RefreshExportLcLogControl(oExportLC) {
        DynamicRefreshList(oExportLC.ExportPILCMappings, "tblExportPILCMappings");
        DynamicRefreshList(oExportLC.MasterLCMappings, "tblMasterLCs");

        $("#txtAmount").prop("disabled", true);
        $("#txtLCStatusInString").prop("disabled", true);

        if (oExportLC.LiborRate == true) {
            $('#chkLIBORRateYes').prop('checked', true);
            $('#chkLIBORRateNo').prop('checked', false);
        } else {
            $('#chkLIBORRateYes').prop('checked', false);
            $('#chkLIBORRateNo').prop('checked', true);
        }
        if (oExportLC.BBankFDD == true) {
            $('#chkBankFDDYes').prop('checked', true);
            $('#chkBankFDDNo').prop('checked', false);
        } else {
            $('#chkBankFDDYes').prop('checked', false);
            $('#chkBankFDDNo').prop('checked', true);
        }
        if (oExportLC.PartialShipmentAllowed == true) {
            $('#chkPartialShipmentAllow').prop('checked', true);
            $('#chkPartialShipmentNotAllow').prop('checked', false);
        } else {
            $('#chkPartialShipmentAllow').prop('checked', false);
            $('#chkPartialShipmentNotAllow').prop('checked', true);
        }
        if (oExportLC.TransShipmentAllowed == true) {
            $('#chkTransshipmentAllow').prop('checked', true);
            $('#chkTransshipmentNotAllow').prop('checked', false);
        } else {
            $('#chkTransshipmentAllow').prop('checked', false);
            $('#chkTransshipmentNotAllow').prop('checked', true);
        }
        if (oExportLC.IsForeignBank == true) {
            $('#chkIsBFDD_Foreign').prop('checked', true);
            $('#chkIsBFDD_Local').prop('checked', false);
        } else {
            $('#chkIsBFDD_Foreign').prop('checked', false);
            $('#chkIsBFDD_Local').prop('checked', true);
        }

        $("#txtFileNo").val(oExportLC.FileNo);
        $("#txtExportLCNo").val(oExportLC.ExportLCNo);
        $("#txtNegoDays").val(oExportLC.NegoDays);
        $("#txtAmount").val(oExportLC.AmountSt);
        $("#lblTotalValue_LC").text(oExportLC.AmountSt);
        $("#txtNote").val(oExportLC.Remark);
        $("#txtHSCode").val(oExportLC.HSCode);
        $("#txtAreaCode").val(oExportLC.AreaCode);
        $("#txtLCStatusInString").val(oExportLC.CurrentStatusInST);
        $("#txtLCStatus_Update").val(oExportLC.CurrentStatusInST);

        if (oExportLC.OpeningDateST != "-") {
            $('#txtOpeningDate').datebox('setValue', oExportLC.OpeningDateST);
        }
        if (oExportLC.LCRecivedDateST != "-") {
            $('#txtReceiveDate').datebox('setValue', oExportLC.LCRecivedDateST);
        }
        if (oExportLC.ShipmentDateST != "-") {
            $('#txtShipmentDate').datebox('setValue', oExportLC.ShipmentDateST);
        }
        if (oExportLC.ExpiryDateST != "-") {
            $('#txtExpireDate').datebox('setValue', oExportLC.ExpiryDateST);
        }
        $("#cboBankBranch_Advice").val(oExportLC.BBranchID_Advice);
        $("#cboBankBranch_Nego").val(oExportLC.BBranchID_Nego);
        $("#cboTextileUnitExportLC").val(oExportLC.TextileUnitInInt);
        $("#cboCurrency").val(oExportLC.CurrencyID);
        $("#cboLCTerm").val(oExportLC.LCTramsID);
        $("#cboBenificiary").val(1); // for one company , if multi company please change it
        $('#txtOverDueRate').numberbox('setValue', oExportLC.OverDueRate);
        $('#txtDiscrepancyCharge').numberbox('setValue', oExportLC.DCharge);
        $("#txtShipmentFrom").val(oExportLC.ShipmentFrom);
        $("#txtGarmentsQty").val(oExportLC.GarmentsQty);
        $("#txtIRC").val(oExportLC.IRC);
        $("#txtERC").val(oExportLC.ERC);
        $("#txtFrightPrepaid").val(oExportLC.FrightPrepaid);
        if (oExportLC.ExportLCID > 0) {
            $("#txtSearchByBankBranch_Issue").val(oExportLC.BankName_Issue + "[" + oExportLC.BBranchName_Issue + "]");
            $("#txtSearchByContractor_ELC").val(oExportLC.ApplicantName);
            $("#txtSearchByContractor_ELC").addClass("fontColorOfPickItem");
        }
        else
        {
            $("#txtSearchByContractor_ELC").removeClass("fontColorOfPickItem");

            $("#txtSearchByBankBranch_Issue,#txtSearchByContractor_ELC,#txtSearchByDeliveryTo_ELC").val();
        }

        if (oExportLC.DeliveryToID > 0) {
            $("#txtSearchByDeliveryTo_ELC").val(oExportLC.DeliveryToName);
            $("#txtSearchByDeliveryTo_ELC").addClass("fontColorOfPickItem");
        } else {
            $("#txtSearchByDeliveryTo_ELC").removeClass("fontColorOfPickItem");
            $("#txtSearchByDeliveryTo_ELC").val("");
        }


        $("#txtAmendmentDate").datebox('setValue', oExportLC.AmendmentDateSt);
        CalculateTotalEPIDetail();
        $("#cboBenificiary").val(1);

        GetContractorInfoELC(oExportLC.ApplicantID);

        CheckDisburseDate(oExportLC.NegoDays, oExportLC.ExportLCID);
        TextileUnitOffNo();
    }

    function TextileUnitOffNo()
    {
        var oRows = $("#tblExportPILCMappings").datagrid("getRows");
        if (oRows.length > 0) {
            $("#cboTextileUnitExportLC").prop("disabled", true);
        } else {
            $("#cboTextileUnitExportLC").prop("disabled", false);
        }
    }

    function SetNegoDate(nTotalDays, dDate) {
        $("#txtNegoDate").prop("disabled", true);
        if (nTotalDays > 0) {
            //var dShipmentDate = $('#txtShipmentDate').datebox('getValue');
            var oDate = new Date(dDate);
            oDate = oDate.setDate(oDate.getDate() + nTotalDays);
            var monthNames = ["Jan", "Feb", "Mar", "Apr", "May", "Jun", "Jul", "Aug", "Sep", "Oct", "Nov", "Dec"];
            var sDate = new Date(oDate).getDate() + " " + monthNames[new Date(oDate).getMonth()] + " " + new Date(oDate).getFullYear();
            $('#txtNegoDate').val(sDate);
        }
        else {
            $('#txtNegoDate').val("");
        }

        if ($("#txtNegoDate").val() == "NaN undefined NaN")
        {
            $('#txtNegoDate').val("");
        }
    }

    function CheckDisburseDate(nTotalDays, nExportLCID)
    {
        if (nExportLCID > 0) {
            var oExportLC = {
                ExportLCID: nExportLCID
            };

            var obj =
            {
                BaseAddress: sessionStorage.getItem("BaseAddress"),
                Object: oExportLC,
                ControllerName: "ExportLC",
                ActionName: "CheckSUDeliveryChallanDateForLC",
                IsWinClose: false
            };
            $.icsDataGet(obj, function (response) {

                if (response.status && response.obj != null) {
                    if (response.obj.SUDeliveryChallanID > 0) {
                        SetNegoDate(nTotalDays, response.obj.ChallanDateSt);
                    }
                    else {
                        SetNegoDate(nTotalDays, $('#txtShipmentDate').datebox('getValue'));
                    }
                }
                else {
                    SetNegoDate(nTotalDays, $('#txtShipmentDate').datebox('getValue'));
                }
            });
        }
        else
        {
            SetNegoDate(nTotalDays, $('#txtShipmentDate').datebox('getValue'));
        }

    }

    function GetContractorInfoELC(nApplicantID)
    {
        var oContractor = {
            ContractorID: nApplicantID,
        };
        var obj =
        {
            BaseAddress: sessionStorage.getItem("BaseAddress"),
            Object: oContractor,
            ControllerName: "Contractor",
            ActionName: "Get",
            IsWinClose: false
        };

        $.icsDataGet(obj, function (response) {
            if (response.status && response.obj != null) {
                if (response.obj.ContractorID > 0) {
                    $("#txtVatAndReg").val(response.obj.VatAndReg);
                    $("#txtTin").val(response.obj.TIN);
                    AddVatRegBtnHideShow();
                }
            }
        });
    }

    function AddVatRegBtnHideShow()
    {
        var sVal = $("#txtVatAndReg").val();
        var sRegistration = $("#txtTin").val();

        if ($.trim(sVal) == "" && $.trim(sRegistration) == "") {
            $("#btnAddNewVatReg").show();
        } else {
            $("#btnAddNewVatReg").hide();
        }
    }

    function CalculateTotalEPIDetail()
    {

        var nTotalAmount = 0;
        var oExportPIDetails = $("#tblExportPILCMappings").datagrid("getRows");
        for (var i = 0; i < oExportPIDetails.length; i++) {
            nTotalAmount = parseFloat(nTotalAmount) + parseFloat(oExportPIDetails[i].Amount);
        }
        var sCurrency = $("#cboCurrency option:selected").text();
        $("#lblCurrency").text((sCurrency == "--Select One--" ? "" : sCurrency) + " ");
        $("#lblTotalValue_LC").text(formatPrice(nTotalAmount, 2));
        $("#txtAmount").val((sCurrency == "--Select One--" ? "" : sCurrency) + " " + formatPrice(nTotalAmount));
    }

    function GetExportLCLog(oExportLCReport) {
        var obj =
        {
            BaseAddress: sessionStorage.getItem("BaseAddress"),
            Object: oExportLCReport,
            ControllerName: "ExportLC",
            ActionName: "GetExportLCLog",
            IsWinClose: false
        };
        $.icsDataGet(obj, function (response) {
            if (response.status && response.obj != null) {
                if (response.obj.ExportLCID > 0) { RefreshExportLcLogControl(response.obj); }
                else { alert(response.obj.ErrorMessage); }
            }
            else { alert("No information found."); }
        });
    }

    function RefreshExportLCLayout(buttonId) {
        if (buttonId == "btnViewExportLC") {
            $("#txtVatAndReg").val("");
            $("#txtTin").val("");
            $("#winExportLC").find("input, select").prop("disabled", true);
            $("#btnSaveExportLC,#btnSaveExportLCTnC").hide();

        }
        else if (buttonId == "btnAddBills") {
            $("#winExportLC").find("input, select").prop("disabled", false);
            $("#tblExportBills_Info").prop("disabled", true);

        }
        else {
            $("#txtVatAndReg").val("");
            $("#txtTin").val("");
            $("#winExportLC input").prop("disabled", false);
            $("#winExportLC select").prop("disabled", false);
            $("#btnSaveExportLC,#btnSaveExportLCTnC").show();
            $("#txtFileNo").prop("disabled", true);
            $("#txtAmount").prop("disabled", true);
            $("#txtLCStatusInString").prop("disabled", true);
        }

        $("#txtSearchByContractor_ELC,#txtSearchByDeliveryTo_ELC,#txtSearchByBankBranch_Issue").removeClass("fontColorOfPickItem");
        $("#txtFileNo,#txtLCStatusInString,#txtAmount").prop("disabled", true);
        $("#cboBenificiary,#cboBenificiary01").val(1);
        $(".allTimeDisbaled").prop("disabled", true);
        $("#txtNegoDate").prop("disabled", true);
        $("#txtNegoDate").val("");

    }




    function PINoWithExportPIID(value)
    {
        var sPINo = value.split('~')[0];
        var nPIID = value.split('~')[1];

        return '<a href="javascript:void(0)" onclick="GetListByPIID('+nPIID+')">'+sPINo+'</a>';
    }

    function GetListByPIID(nPIID)
    {
        if(parseInt(nPIID) > 0)
        {
            var oExportLCReport={
                ExportPIID : parseInt(nPIID)
            };
            ShowDetailAtNewPage(oExportLCReport, 'ExportPIID', 0, 0);
        }
        else
        {
            alert("Invalid PI.");
        }
    }

    function ShowDetailAtNewPage(oExportLCReport, sID, nPIID, nVersionNo)
    {
        oExportLCReports = $("#tblExportLCReports").datagrid("getRows");
        var nIndex=0;
        var nExportPIID = 0;
        if(sID == "ExportPIID")
        {
            nExportPIID = oExportLCReport.ExportPIID;
        }
        else if(sID == "ExportLCID")
        {
            var nExportLCID = oExportLCReport.ExportPIID; //ExportPIID is currect.
            nExportPIID = nPIID;

            oExportLCReport.ExportPIID = oExportLCReport.ExportPIID + "~" + nVersionNo;

            for(var i=0;i<oExportLCReports.length;i++)
            {
                if(oExportLCReports[i].ExportLCID == nExportLCID && oExportLCReports[i].ExportPIID == parseInt(nPIID))
                {
                    nIndex=i;
                    break;
                }
            }
        }

        if(nExportPIID>0)
        {
            for(var i=0;i<oExportLCReports.length;i++)
            {
                if(oExportLCReports[i].ExportPIID == nExportPIID)
                {
                    nIndex=i;
                    break;
                }
            }
            var SelectedRowIndex=$('#tblExportLCReports').datagrid('getRowIndex',nIndex);
            sessionStorage.setItem("ExportLCReports", JSON.stringify(oExportLCReports));
            sessionStorage.setItem("ExportPIID", nExportPIID);
            sessionStorage.setItem("ExportLCReportHeader", "Export LC Report");
        }

        var obj = {
            BaseAddress: sessionStorage.getItem("BaseAddress"),
            TableId: "",
            OpenedPageTitle: "Export LC Report",
            Object: oExportLCReport,
            ObjectId: oExportLCReport.ExportPIID,
            PrimaryKeyName: "ExportPIID",
            ControllerName: "ExportLCReport",
            ActionName: "View_ExportLCReportDetails",
            BtnID : sID
        };
        $.icsOpenPickerInNewPage(obj);
    }

    function LCNoWithExportLCID(value)
    {
        var sLCNo = value.split('~')[0];
        var nLCID = value.split('~')[1];
        var nPIID = value.split('~')[2];
        var nVersionNo = value.split('~')[3];

        return '<a href="javascript:void(0)" onclick="GetListByLCID('+nLCID+','+nPIID+','+nVersionNo+')">'+sLCNo+'</a>';
    }


    function GetListByLCID(nLCID,nPIID,nVersionNo)
    {
        if(parseInt(nLCID) > 0)
        {
            var oExportLCReport={
                ExportPIID : parseInt(nLCID) //ExportPIID used as ExportLCID
            };
            ShowDetailAtNewPage(oExportLCReport, 'ExportLCID', nPIID, nVersionNo);
        }
        else
        {
            alert("Invalid LC.");
        }
    }

    function AmendmentNoWithExportLCID(value)
    {
        var sAmendmentNo = value.split('~')[0];
        var nLCID = value.split('~')[1];
        var nPIID = value.split('~')[2];
        var nVersionNo = value.split('~')[3];

        return '<a href="javascript:void(0)" onclick="GetListByLCID('+nLCID+','+nPIID+','+nVersionNo+')">'+sAmendmentNo+'</a>';
    }

    $("#txtPINo1").keydown(function(e){
        if(e.keyCode === 13)
        {
            var oExportLCReport={
                PINo : $.trim($("#txtPINo1").val())
            };
            GetSearchList(oExportLCReport);
        }
        else if(e.keyCode === 8)
        {
            DynamicRefreshList(oExportLCReports,"tblExportLCReports");
        }
    });

    $("#txtLCNo").keydown(function(e){
        if(e.keyCode === 13)
        {
            var oExportLCReport={
                LCNo : $.trim($("#txtLCNo").val())
            };
            GetSearchList(oExportLCReport);
        }
        else if(e.keyCode === 8)
        {
            DynamicRefreshList(oExportLCReports,"tblExportLCReports");
        }
    });

    //$("#txtApplicantName").keydown(function(e){
    //    if(e.keyCode === 13)
    //    {
    //        var oExportLCReport={
    //            ApplicantName : $.trim($("#txtApplicantName").val())
    //        };
    //        GetSearchList(oExportLCReport);
    //    }
    //    else if(e.keyCode === 8)
    //    {
    //        DynamicRefreshList(oExportLCReports,"tblExportLCReports");
    //    }
    //});

    //$("#btnSearch").click(function(){
    //    var oExportLCReport = {
    //        Params :  $("#chkAmendmentDate").is(':checked') + "~" + $('#txtFromAmendmentDate').datebox('getValue') + "~" + $('#txtToAmendmentDate').datebox('getValue') + "~" + parseInt($("#cboDateSearchType").val())+ "~" + parseInt($("#cboTextileUnitsTwo").val())
    //    };
    //    GetSearchList(oExportLCReport);
    //});

    function GetSearchList(oExportLCReport)
    {
        var obj = {
            BaseAddress: sessionStorage.getItem("BaseAddress"),
            Object: oExportLCReport,
            ControllerName: "ExportLCReport",
            ActionName: "SearchBySearchingCritaria",
            IsWinClose: false
        };

        $.icsMaxDataGets(obj, function (response) {
            if (response.status && response.objs.length > 0)
            {
                if($.trim(response.objs[0].ErrorMessage) == "")
                {
                    DynamicRefreshList(response.objs,"tblExportLCReports");
                }
                else
                {
                    alert(response.objs[0].ErrorMessage);
                    DynamicRefreshList([],"tblExportLCReports");
                }
            }
            else {
                DynamicRefreshList([],"tblExportLCReports");
            }
        });
    }

    function RefreshFields()
    {
        $("#cboDateSearchType").val(5);
        $(".easyui-datebox").datebox({ disabled: false });
        $(".easyui-datebox").datebox("setValue", icsdateformat(new Date()));
        DynamicRefreshList(_oLCStatus,"tblExportLCStatusAdvSearch");
    }

    $("#chkAmendmentDate").change(function(){
        if(this.checked){
            $("#lblDateType").text("Receive Date : ");
        }
        else{
            $("#lblDateType").text("LC Date : ");
        }
    });

    $("#btnCloseExportLC,#btnCloseExportLCTnCC").click(function () {
        $("#winExportBills").icsWindow("close");
    });



    function LoadStatusTableAdvSearch() {
        var oLCStatus = [];
        for (var i = 1; i < _oLCStatus.length; i++) {
            oLCStatus.push(_oLCStatus[i]);
        }
        DynamicRefreshListForMultipleSelection(oLCStatus, "tblExportLCStatusAdvSearch");
    }

    $("#chkLCOpenDate").change(function () {
        if (this.checked) {
            $("#txtOpeningDateStart,#txtOpeningDateEnd").datebox({ disabled: false });
        } else {
            $("#txtOpeningDateStart,#txtOpeningDateEnd").datebox({ disabled: true });
        }
        $("#txtOpeningDateStart,#txtOpeningDateEnd").datebox("setValue", icsdateformat(new Date()));
    });

    $("#chkReceiveDate").change(function () {
        if (this.checked) {
            $("#txtReceiveStartDate,#txtReceiveEndDate").datebox({ disabled: false });
        } else {
            $("#txtReceiveStartDate,#txtReceiveEndDate").datebox({ disabled: true });
        }
        $("#txtReceiveStartDate,#txtReceiveEndDate").datebox("setValue", icsdateformat(new Date()));
    });

    $("#chkShipmentDate").change(function () {
        if (this.checked) {
            $("#txtShipmentStartDateDate,#txtShipmentEndDate").datebox({ disabled: false });
        } else {
            $("#txtShipmentStartDateDate,#txtShipmentEndDate").datebox({ disabled: true });
        }
        $("#txtShipmentStartDateDate,#txtShipmentEndDate").datebox("setValue", icsdateformat(new Date()));
    });

    $("#chkExpireDate").change(function () {
        if (this.checked) {
            $("#txtExpireStartDate,#txtExpireEndDate").datebox({ disabled: false });
        } else {
            $("#txtExpireStartDate,#txtExpireEndDate").datebox({ disabled: true });
        }
        $("#txtExpireStartDate,#txtExpireEndDate").datebox("setValue", icsdateformat(new Date()));
    });



    function MakeStringIDs(StringIDs) {

        var IDs = "";
        for (var i = 0; i < StringIDs.length; i++) {
            IDs = StringIDs[i].id + "," + IDs;
        }
        var length = 0;
        length = parseInt(IDs.length) - 1;
        IDs = IDs.substring(0, parseInt(length));
        return IDs;
    }


    function ResetAdvSearch()
    {
        _nContractorIDAdvSearch = 0;
        _nIssueBankAdvSearch = 0;

        $('#chkLCOpenDate,#chkReceiveDate,#chkShipmentDate,#chkExpireDate,#chkGetOriginalCopy,#chkExportDoIsntCreateYet,#chkDeliveryChallanIssueButBillNotCreated,#chkExportPIIsntCreateYet').prop('checked', false);
        $("#txtExportLCNoAS,#txtFileNoAS,#txtSearchByAccountOfAdvSearch,#txtSearchByBuyerAdvSearch").val("");
        $("#winAdvSearchExportLC select").val(0);
        $("#cboTextileUnitAdv").val(0);
        $("#txtSearchByAccountOfAdvSearch,#txtSearchByBuyerAdvSearch").removeClass("fontColorOfPickItem");
        $("#winAdvSearchExportLC").find(".easyui-datebox").datebox({ disabled: true });
        $("#winAdvSearchExportLC").find(".easyui-datebox").datebox("setValue", "");
        DynamicRefreshList([], "tblExportLCAdvSearch");
        $(".lblLoadingMessage").hide();
        LoadStatusTableAdvSearch();
    }

    $("#btnResetAdvSearch").click(function() {
        ResetAdvSearch();
    });

    $("#btnCloseAdvSearch").click(function() {
        $("#winAdvSearchExportLC").icsWindow("close");
    });




</script>
