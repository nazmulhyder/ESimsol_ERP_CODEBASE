@{
    ViewBag.Title = "Sales Contract List";
}
@model IEnumerable<ESimSol.BusinessObjects.ExportSC>
<head>
    
</head>
<body>
    <div id="progressbarParent" style="width:100%;height:100%;margin:0 auto;text-align:center; margin-left: auto;margin-right: auto;left: 0;right: 0;z-index: 1;">
        <div style="margin: 0px auto;margin-top: 251px;text-align:center;width:390px;">
            <label style="font-size:18px;">Please wait</label>
            <div id="progressbar" style="width:100%;height:37px;"></div>
        </div>
    </div>
    <div class="menuMainCollectionTable">
        <table style="width:100%;height:100%;" id="tblExportSCs" title="ExportSC List" class="easyui-datagrid" fit="true" fitcolumns="true" rownumbers="true" pagination="true" singleselect="true" autorowheight="false" toolbar="#toolbarExportSC">
            <thead>
                <tr>
                    <th field="PINo_Full" width="15%">PI No</th>
                    <th field="PIStatusSt" width="10%">PI Status</th>
                    @*<th field="PaymentTypeSt" width="70">PI Type</th>*@
                    <th field="IssueDateSt" width="10%" align="center">Issue Date</th>
                    <th field="ContractorNameCode" width="20%">Account of</th>
                    <th field="MKTPName" width="20%">Mkt. Person</th>
                    <th field="BuyerName" width="15%">Buying House</th>
                    <th field="AmountSt" width="10%" align="right">Total Value</th>
                    <th field="IsRevisePISt" width="18%" align="right"></th>
                    <th field="ApprovedName" width="10%" align="left"></th>
                    <th field="ELCNo" width="10%" align="left">L/C No</th>
                    <th field="IsCloseSt" width="10%" align="left"></th>
                    
                </tr>
            </thead>
        </table>
        <div id="toolbarExportSC">
            <table>
                <tr>
                    <td>
                        <a href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-reload" plain="true" id="btnRefreshAll">Refresh</a>
                        <input type="text" id="txtSearchByPINo" placeholder="Search by PI No" style="width:100px" />
                        <a id="btnAdvSearch" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-search" plain="true">Adv. Search</a>
                        
                        @*<a id="btnAdd" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-add" plain="true">New</a>*@
                        <a id="btnEdit" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-edit" plain="true">Convertion </a>
                        <a id="btnCreateLog" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-approved" plain="true"> Convertion Order</a>
                        @*<a id="btnAdjustSettle" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-edit" plain="true">Adjustment Settle</a>*@
                        <a id="btnView" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-details" plain="true">View</a>
                        <a id="btnApproved" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-approved" plain="true"> Approve</a>
                        <a id="btnPrintPreview" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-print" plain="true">Print Preview</a>
                        <a id="btnSalesCommission" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-details" plain="true"> Commission assign </a>
                        <a id="btnSAN" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-details" plain="true"> SAN</a>
                        <a id="btnIsClose" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-save" plain="true">Close/Running</a>
                    </td>

                </tr>
            </table>
        </div>


    </div>
    
    <div id="winAdvSearch" class="easyui-window winClass" title="Adv. Search" data-options="modal:true,closed:true,collapsible:false,minimizable:false,maximizable:false,closable:false">
        <table style="width:100%;">
            <tr>
                <td>
                    <fieldset style="margin-bottom: 0px;">
                        <legend>Searching Criteria</legend>
                        <table>
                            <tr>
                                <td style=" width:20%;text-align:right;">
                                    <label>Account Of :</label>
                                </td>
                                <td colspan="3" style=" width:80%;text-align:left;">
                                    <input id="txtContractorAdvS" style="width:75%;" type="text" placeholder="Type & Press Enter" />
                                    <a id="btnPickContractorAdvS" href="javascript:void(0)" class="easyui-linkbutton ics-pick" iconcls="icon-pick" plain="true"></a>
                                    <a id="btnClrContractorAdvS" href="javascript:void(0)" class="easyui-linkbutton ics-pick" iconcls="icon-clear" plain="true"></a>

                                </td>
                            </tr>
                            <tr>
                                <td style=" width:20%;text-align:right;">
                                    <label>Buying House :</label>
                                </td>
                                <td colspan="3" style=" width:80%;text-align:left;">
                                    <input id="txtBuyersAdvS" style="width:75%;" type="text" placeholder="Type & Press Enter" />
                                    <a id="btnPickBuyersAdvSearch" href="javascript:void(0)" class="easyui-linkbutton ics-pick" iconcls="icon-pick" plain="true"></a>
                                    <a id="btnClrBuyersAdvSearch" href="javascript:void(0)" class="easyui-linkbutton ics-pick" iconcls="icon-clear" plain="true"></a>
                                </td>
                            </tr>
                            <tr>
                                <td style=" width:20%;text-align:right;">
                                    <label>Issue Date :</label>
                                </td>
                                <td colspan="3">
                                    <select id="cboIssueDateAdvSearch" style="width:30%;" onchange="DateActionsIssueDateAdvSearch();"></select>
                                    <input id="txtFromIssueDateAdvSearch" type="text" style="width: 100px;" class="easyui-datebox" required="required" data-options="formatter:icsdateformat,parser:icsdateparser" />To
                                    <input id="txtToIssueDateAdvSearch" type="text" style="width: 100px;" class="easyui-datebox" required="required" data-options="formatter:icsdateformat,parser:icsdateparser" />
                                </td>
                            </tr>
                            <tr>
                                <td style=" width:20%;text-align:right;">
                                    <label>Validity Date :</label>
                                </td>
                                <td colspan="3">
                                    <select id="cboValidityDateAdvSearch" style="width:30%;" onchange=" DateActionsValidityDateAdvSearch(); "></select>
                                    <input id="txtFromValidityDateAdvSearch" type="text" style="width: 100px;" class="easyui-datebox" required="required" data-options="formatter:icsdateformat,parser:icsdateparser" />To
                                    <input id="txtToValidityDateAdvSearch" type="text" style="width: 100px;" class="easyui-datebox" required="required" data-options="formatter:icsdateformat,parser:icsdateparser" />
                                </td>
                            </tr>
                            <tr>
                                <td style=" width:20%;text-align:right;">
                                    <label>LC Date :</label>
                                </td>
                                <td colspan="3">
                                    <select id="cboLCDateAdvSearch" style="width:30%;" onchange=" DateActionsLCDateAdvSearch(); "></select>
                                    <input id="txtFromLCDateAdvSearch" type="text" style="width: 100px;" class="easyui-datebox" required="required" data-options="formatter:icsdateformat,parser:icsdateparser" />To
                                    <input id="txtToLCDateAdvSearch" type="text" style="width: 100px;" class="easyui-datebox" required="required" data-options="formatter:icsdateformat,parser:icsdateparser" />
                                </td>
                            </tr>
                            <tr>
                                <td style=" width:20%;text-align:right;">
                                    <label>Payment Type </label>
                                </td>
                                <td>
                                    <select id="cboPaymentType" style="width: 100%;"></select>
                                </td>
                                <td style="text-align:right;">
                                    <label>PI Type :</label>
                                </td>
                                <td>
                                    <select id="cboPITypeAdv" style="width: 100%;float:right;"><option value="-1">None</option><option value="0">Open</option><option value="1">Order Sheet</option></select>
                                </td>
                            </tr>
                            <tr>
                                <td style=" width:20%;text-align:right;">
                                    <label>Bank :</label>
                                </td>
                                <td colspan="3">
                                    <select id="cboPIBankAdvSearch" style="width:100%;"></select>
                                </td>
                            </tr>
                            <tr>
                                <td style=" width:20%;text-align:right;">
                                    <label>Mkt. Person :</label>
                                </td>
                                <td colspan="3">
                                    <select id="cboMkPersonAdvSearch" style="width:100%;"></select>
                                </td>
                            </tr>

                            <tr>
                                <td style="text-align:right;">
                                    <label>Style No :</label>
                                </td>
                                <td colspan="3">
                                    <input id="txtSearchByStyleNoAdvSearch" type="text" style="width:100%" />
                                </td>
                            </tr>
                            <tr>
                                <td style=" width:20%;text-align:right;">
                                    <label>Status By Date :</label>
                                </td>
                                <td colspan="3">
                                    <select id="cboStatusAdvSearch" style="width:30%;" onchange=" DateActionsStatusDateAdvSearch(); "></select>
                                    <input id="txtFromStatusDateAdvSearch" type="text" style="width: 100px;" class="easyui-datebox" required="required" data-options="formatter:icsdateformat,parser:icsdateparser" />To
                                    <input id="txtToStatusDateAdvSearch" type="text" style="width: 100px;" class="easyui-datebox" required="required" data-options="formatter:icsdateformat,parser:icsdateparser" />
                                </td>
                            </tr>
                            <tr>
                                <td style="text-align:right;">
                                    <label>Status :</label>
                                </td>
                                <td colspan="3">
                                    <table id="tblCurrentStatusAdvSearch" class="easyui-datagrid" title="" style="width:100%; height: 130px;" data-options="singleSelect: false,fitColumns:false, rownumbers:true, pagination:false, autoRowHeight:false">
                                        <thead>
                                            <tr>
                                                <th data-options="field:'Selected',checkbox:true"></th>
                                                <th field="Value" width="80%">Status Name</th>
                                            </tr>
                                        </thead>
                                    </table>
                                </td>
                            </tr>
                            @*<tr>
                                    <td style="text-align:right;"></td>
                                    <td>
                                        <input id="chkExportLCIsntCreateYet" type="checkbox" style="width:5%;" />
                                        <label>LC Pending</label>
                                    </td>
                                    <td colspan="2" style="text-align:right;">
                                        <input id="chkYetNotMakeFEO" type="checkbox" style="width:5%;" />
                                        <label>Yet not make FEO</label>
                                    </td>
                                </tr>*@
                            <tr>
                                <td height="5px" colspan="4"></td>
                            </tr>
                            @*<tr>
                                    <td class="btnResetSearch" colspan="4">
                                        <a id="btnSearchAdvSearch" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-search" plain="true">Search</a>
                                        <a id="btnResetAdvSearch" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-reload" plain="true">Reset</a>
                                    </td>
                                </tr>*@
                        </table>
                    </fieldset>
                </td>
            </tr>
        </table>
      
        <fieldset class="actionfieldsetstyle">
            <legend>Actions : </legend>
            <label class="lblLoadingMessage" style="float: left;">Loading Please Wait...</label>
            <a id="btnResetAdvSearch" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-reload" plain="true">Reset</a>
            <a id="btnSearchAdvSearch" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-search" plain="true">Search</a>
            <a id="btnCloseAdvSearch" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-cancel" plain="true">Close</a>
        </fieldset>
    </div>
</body>

<script type="text/javascript">
    var _oExportSC = null;
    var _oExportSCs = [];
    var _sBaseAddress = "";
    var _oAuthorizationRolesMapping = [];
    var _oExportSCBranch = null;
    var _nID=null;
    var _nContractorIDs="";
    var _sProductIDs="";
    var _sMenuID=0;
    var _nBUID = 0;
    var _sContractorIds = '';
    var _sBuyerIDsAdvSearch = '';

    $(document).ready(function() {
        
        _sMenuID =@Html.Raw( new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(HttpContext.Current.Session[SessionInfo.MenuID]));
        _oExportSCs = @Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(Model));
        _oAuthorizationRolesMapping = @Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(HttpContext.Current.Session[SessionInfo.AuthorizationRolesMapping]));
        _sBaseAddress = @Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(HttpContext.Current.Session[SessionInfo.BaseAddress]));

        _oCompareOperators = @Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(ViewBag.CompareOperators));
        _nBUID = @Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(ViewBag.BUID));
        _oPIStatusObjs = @Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(ViewBag.PIStatusObjs));
        _oBankBranchs = @Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(ViewBag.BankBranchs));
        _oMktPersons = @Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(ViewBag.MktPersons));
        _oPIPaymentTypes = @Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(ViewBag.PIPaymentTypes));
      debugger
        RefreshControlLayout();
        debugger;
        var nIndex =parseInt(sessionStorage.getItem("SelectedRowIndex"));
        var oExportSCs =sessionStorage.getItem("ExportSCs");
        if(oExportSCs!=null)
        {
            oExportSCs = jQuery.parseJSON(oExportSCs);
        }
        else
        {
            oExportSCs=_oExportSCs;
        }
        DynamicRefreshList(oExportSCs, 'tblExportSCs');
        if(nIndex!=-1)
        {
            $('#tblExportSCs').datagrid('selectRow', nIndex);
            if(nIndex>-1)
            {
                $('#tblExportSCs').datagrid('selectRow',nIndex);
                OperationPerforms(nIndex, oExportSCs[nIndex]);
            }
        }
        $("#tblCurrentStatusAdvSearch").datagrid("checkAll");
        $("#progressbar").progressbar({ value: 0 });
        $("#progressbarParent").hide();
        $(".lblLoadingMessage").hide();
        LoadComboAdv();
    });

    $('#tblExportSCs').datagrid({ onSelect: function (rowIndex, rowData) { OperationPerforms(rowIndex, rowData); } });

    function OperationPerforms(rowIndex, rowData) {
        if (rowData != null && rowData.ExportSCID > 0) {
            debugger;
            $('#btnCreateLog,#btnApproved,#btnEdit').hide();
            if (rowData.IsRevisePI==1)  //Initialized = 1,
            {
                $('#btnEdit,#btnApproved').show();
              
            }
            else
            {
                $('#btnCreateLog').show();

            }

        }
    }
    
  
    $("#btnEdit").click(function(){
        var oExportSC= $('#tblExportSCs').datagrid('getSelected');
        if(oExportSC==null || oExportSC.ExportSCID<=0)
        {
            alert("Please select a item from list!");
            return false;
        }
        if(oExportSC.IsRevisePI==false)
        {
            alert("Selected item is already Approved!");
            return false;
        }

        var SelectedRowIndex=$('#tblExportSCs').datagrid('getRowIndex',oExportSC);
        var oExportSCs= $('#tblExportSCs').datagrid('getRows');
        sessionStorage.setItem("ExportSCs", JSON.stringify(oExportSCs));
        sessionStorage.setItem("SelectedRowIndex", SelectedRowIndex);
        sessionStorage.setItem("ExportSCHeader", "Edit ExportSC");

        sessionStorage.setItem("BackLink", window.location.href);
        window.location.href = _sBaseAddress+  "/ExportSC/ViewExportSC?id="+oExportSC.ExportSCID;
    });
    $("#btnView").click(function(){
        var oExportSC= $('#tblExportSCs').datagrid('getSelected');
        if(oExportSC==null || oExportSC.ExportSCID<=0)
        {
            alert("Please select a item from list!");
            return false;
        }


        var SelectedRowIndex=$('#tblExportSCs').datagrid('getRowIndex',oExportSC);
        var oExportSCs= $('#tblExportSCs').datagrid('getRows');
        sessionStorage.setItem("ExportSCs", JSON.stringify(oExportSCs));
        sessionStorage.setItem("SelectedRowIndex", SelectedRowIndex);
        sessionStorage.setItem("ExportSCHeader", "View ExportSC");

        sessionStorage.setItem("BackLink", window.location.href);
        window.location.href = _sBaseAddress+  "/ExportSC/ViewExportSC?id="+oExportSC.ExportSCID;
    });
    $("#btnCreateLog").click(function() {

        var oExportSC= $('#tblExportSCs').datagrid('getSelected');
        if(oExportSC==null || oExportSC.ExportSCID<=0)
        {
            alert("Please select a item from list!");
            return false;
        }
        if(oExportSC.IsRevisePI==true)
        {
            alert("Yet Not Approve!");
            return false;
        }
        var SelectedRowIndex=$('#tblExportSCs').datagrid('getRowIndex',oExportSC);
        var oExportSCs= $('#tblExportSCs').datagrid('getRows');
        sessionStorage.setItem("ExportSCs", JSON.stringify(oExportSCs));
        sessionStorage.setItem("SelectedRowIndex", SelectedRowIndex);
        sessionStorage.setItem("ExportSCHeader", "Change ExportSC");

        sessionStorage.setItem("BackLink", window.location.href);
        window.location.href = _sBaseAddress+  "/ExportSC/ViewExportSC?id="+oExportSC.ExportSCID;


       
    });

     
    $("#btnAdjustSettle").click(function(){
        var oExportSC= $('#tblExportSCs').datagrid('getSelected');
        if(oExportSC==null || oExportSC.ExportSCID<=0)
        {
            alert("Please select a item from list!");
            return false;
        }


        var SelectedRowIndex=$('#tblExportSCs').datagrid('getRowIndex',oExportSC);
        var oExportSCs= $('#tblExportSCs').datagrid('getRows');
        sessionStorage.setItem("ExportSCs", JSON.stringify(oExportSCs));
        sessionStorage.setItem("SelectedRowIndex", SelectedRowIndex);
        sessionStorage.setItem("ExportSCHeader", "AdjustmenSttle");

        sessionStorage.setItem("BackLink", window.location.href);
        window.location.href = _sBaseAddress+  "/ExportSC/ViewExportSC?id="+oExportSC.ExportSCID;
    });
 
    $("#btnApproved").click(function(){
        var oExportSC= $('#tblExportSCs').datagrid('getSelected');
        if(oExportSC==null || oExportSC.ExportSCID<=0)
        {
            alert("Please select a item from list!");
            return false;
        }
        if(oExportSC.IsRevisePI==false)
        {
            alert("Selected item is already Approved!");
            return false;
        }

        var SelectedRowIndex=$('#tblExportSCs').datagrid('getRowIndex',oExportSC);
        var oExportSCs= $('#tblExportSCs').datagrid('getRows');
        sessionStorage.setItem("ExportSCs", JSON.stringify(oExportSCs));
        sessionStorage.setItem("SelectedRowIndex", SelectedRowIndex);
        sessionStorage.setItem("ExportSCHeader", "Approve ExportSC");

        sessionStorage.setItem("BackLink", window.location.href);
        window.location.href = _sBaseAddress+  "/ExportSC/ViewExportSC?id="+oExportSC.ExportSCID;
    });
    
    $("#btnSalesCommission").click(function(){
        var oExportSC= $('#tblExportSCs').datagrid('getSelected');
        if(oExportSC==null || oExportSC.ExportSCID<=0)
        {
            alert("Please select a item from list!");
            return false;
        }
       

        var SelectedRowIndex=$('#tblExportSCs').datagrid('getRowIndex',oExportSC);
        var oExportSCs= $('#tblExportSCs').datagrid('getRows');
        sessionStorage.setItem("ExportSCs", JSON.stringify(oExportSCs));
        sessionStorage.setItem("SelectedRowIndex", SelectedRowIndex);
        sessionStorage.setItem("ExportSCHeader", "Commission ExportSC");

        sessionStorage.setItem("BackLink", window.location.href);
        window.location.href = _sBaseAddress+  "/ExportSC/ViewExportSCCom?id="+oExportSC.ExportPIID;
    });
    $("#btnSAN").click(function(){
        var oExportSC= $('#tblExportSCs').datagrid('getSelected');
        if(oExportSC==null || oExportSC.ExportSCID<=0)
        {
            alert("Please select a item from list!");
            return false;
        }
       

        var SelectedRowIndex=$('#tblExportSCs').datagrid('getRowIndex',oExportSC);
        var oExportSCs= $('#tblExportSCs').datagrid('getRows');
        sessionStorage.setItem("ExportSCs", JSON.stringify(oExportSCs));
        sessionStorage.setItem("SelectedRowIndex", SelectedRowIndex);
        sessionStorage.setItem("ExportSCHeader", "Commission ExportSC");

        sessionStorage.setItem("BackLink", window.location.href);
        window.location.href = _sBaseAddress+  "/ExportSC/ViewExportPISAN?id="+oExportSC.ExportPIID;
    });

    $('#btnPrintExportSC').click(function(){
        var oExportSCs=$('#tblExportSCs').datagrid('getRows');
        if(oExportSCs==null||oExportSCs.length<=0){return false;}
        $("#txtExportSCCollectionList").val(JSON.stringify(oExportSCs));
    });
    function RefreshControlLayout() {
        //ExportSC
        $("#btnIsClose").hide();
        if (PermissionChecker('Running', 'ExportPI',_oAuthorizationRolesMapping)) {$("#btnIsClose").show();}
    }

    @*function HavePermission(sOperationType,sDbObject) {
        var nUserId = @Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(HttpContext.Current.Session[SessionInfo.currentUserID]));
        if(nUserId === -9) //check SuperUser
        {
            return true;
        }
        else
        {
            for(var i =0; i<_oAuthorizationRolesMapping.length; i++)
            {
                if(_oAuthorizationRolesMapping[i].OperationTypeInString === sOperationType && _oAuthorizationRolesMapping[i].DBObjectName === sDbObject)
                    return  true;
            }
            return false;
        }
    }*@



   
 
    $("#btnPrintPreview").click(function() {
        var oExportSC= $('#tblExportSCs').datagrid('getSelected');
        if(oExportSC==null || oExportSC.ExportSCID<=0)
        {
            alert("Please select a item from list!");
            return;
        }
        var nts = ((new Date()).getTime()) / 1000;
        window.open(_sBaseAddress + '/ExportSCDO/PrintStatement_DOBalance?nExportSCID=' + parseInt(oExportSC.ExportSCID) + "&nDOID=" + parseInt(0) + "&nProductID=" + parseInt(0) + "&nts=" + nts, "_blank");
    });

    // wise Start
   
    $(document).keydown(function (e) {
        //debugger;
        if (e.which == 27)//escape=27
        {
            //debugger;
            $("#winPRAdvanceSearch").icsWindow('close');
        }
    });
    ///Serch

    //Search By No
    $("#txtSearchByPINo").keydown(function (e) {
        var nkeyCode = e.keyCode || e.which;
        if(nkeyCode==13){

            var sTemp=$("#txtSearchByPINo").val();
            var oExportSC= {
                PINo :sTemp,
                BUID:_nBUID
            };
            GetsOrders(oExportSC);
        }
        else if(nkeyCode==8){
            $("#txtSearchByPINo").val("");

        }
    });


    function GetsOrders(oExportSC)
    {
        $.ajax
          ({
              type: "POST",
              dataType: "json",
              url : _sBaseAddress+"/ExportSC/GetbyNo",
              data:  JSON.stringify(oExportSC),
              contentType: "application/json; charset=utf-8",
              success: function (data) {
                  //debugger;
                  var oExportSCs = jQuery.parseJSON(data);
                  if (oExportSCs.length>0)
                  {
                      DynamicRefreshList(oExportSCs, 'tblExportSCs');
                  }
                  else
                  {
                      alert("Data Not found");
                      DynamicRefreshList([], 'tblExportSCs');
                  }
              },
              error: function (xhr, status, error)
              {
                  alert(error);
              }
          });
    }
    /// end Search By No
    $("#btnRefreshAll").click(function() {
        window.location.href = _sBaseAddress+ '/ExportSC/ViewExportSCs?'+"buid="+_nBUID+"&menuid="+_sMenuID; 
    });

   

       

  
    ////Searching

    //Search Control

    function updateProgress() {
        var value =$('#progressbar').progressbar('getValue');
        if (value < 96){
            value += Math.floor(Math.random() * 10);
            $('#progressbar').progressbar('setValue', value);
        }
    }
    function hideShow(miliseconds) {
        $("#progressbarParent").hide();
    }
    //Account Of Picker

    $("#txtContractorAdvS").keydown(function (e) {
        if (e.keyCode === 13) // Enter Press
        {
            PickAccountOfPIAdvSearch();
        }
        else if (e.keyCode === 08) {
            $("#txtContractorAdvS").removeClass("fontColorOfPickItem");
            _sContractorIds = '';
        }
    });

    $("#btnClrContractorAdvS").click(function () {
        $("#txtContractorAdvS").removeClass("fontColorOfPickItem");
        $("#txtContractorAdvS").val("");
        _sContractorIds = '';
    });

    $("#btnPickContractorAdvS").click(function () {
        PickAccountOfPIAdvSearch();
    });
    $("#txtSearchByAccountNamePickerAdvSearch").keydown(function (e) {
        var obj = {
            Event: e,
            SearchProperty: "Name",
            GlobalObjectList: _oAccountsOf,
            TableId: "tblAccountsPickerAdvSearch"
        };
        $('#txtSearchByAccountNamePickerAdvSearch').icsSearchByText(obj);
    });

    //End Account Of Picker
    $("#txtBuyersAdvS").keydown(function (e) {
        if (e.keyCode === 13) // Enter Press
        {
            PickBuyerPIAdvSearch();
        }
        else if (e.keyCode === 08) {
            $("#txtBuyersAdvS").removeClass("fontColorOfPickItem");
            _sBuyerIDsAdvSearch ="";
        }
    });

    $("#btnClrBuyersAdvSearch").click(function () {
        $("#txtBuyersAdvS").removeClass("fontColorOfPickItem");
        $("#txtBuyersAdvS").val("");
        _sBuyerIDsAdvSearch ="";
    });

    $("#btnPickBuyersAdvSearch").click(function () {
        PickBuyerPIAdvSearch();
    });

    $("#txtSearchByBuyerNamePickerAdvSearch").keydown(function (e) {
        var obj = {
            Event: e,
            SearchProperty: "Name",
            GlobalObjectList: _oBuyers,
            TableId: "tblBuyersPickerAdvSearch"
        };
        $('#txtSearchByBuyerNamePickerAdvSearch').icsSearchByText(obj);
    });

    //End Buyer Search
    $("#btnResetAdvSearch").click(function () {
        ResetAdvSearchWindow();
        DateActionsIssueDateAdvSearch();
        DateActionsValidityDateAdvSearch();
        DateActionsLCDateAdvSearch();
        DateActionsStatusDateAdvSearch();
    });

    $("#btnSearchAdvSearch").click(function () {
        debugger;
        $('#tblExportPIAdvSearch').datagrid({ selectOnCheck: false, checkOnSelect: true });
      
        $(".lblLoadingMessage").show();
        DynamicRefreshList([], "tblExportPIAdvSearch");
        var checkDate = CheckFromAndToDateValidation("cboIssueDateAdvSearch", "txtFromIssueDateAdvSearch", "txtToIssueDateAdvSearch");
        if (!checkDate) {
            alert("Start date must be greater than end date.");
            return false;
        }
        checkDate = CheckFromAndToDateValidation("cboValidityDateAdvSearch", "txtFromIssueDateAdvSearch", "txtToValidityDateAdvSearch");
        if (!checkDate) {
            alert("Start date must be greater than end date.");
            return false;
        }
        checkDate = CheckFromAndToDateValidation("cboLCDateAdvSearch", "txtFromLCDateAdvSearch", "txtToLCDateAdvSearch");
        if (!checkDate) {
            alert("Start date must be greater than end date.");
            return false;
        }
        checkDate = CheckFromAndToDateValidation("cboStatusAdvSearch", "txtFromStatusDateAdvSearch", "txtToStatusDateAdvSearch");
        if (!checkDate) {
            alert("Start date must be greater than end date.");
            return false;
        }

        //var nContractorID = parseInt(_sContractorIds);
        //var nBuyerID = parseInt(_sBuyerIDsAdvSearch);
        var nCboIssueDate = parseInt($("#cboIssueDateAdvSearch").val());
        var dFromIssueDate = $('#txtFromIssueDateAdvSearch').datebox('getValue');
        var dToIssueDate = $('#txtToIssueDateAdvSearch').datebox('getValue');

        var nCboValidityDate = parseInt($("#cboValidityDateAdvSearch").val());
        var dFromValidityDate = $('#txtFromValidityDateAdvSearch').datebox('getValue');
        var dToValidityDate = $('#txtToValidityDateAdvSearch').datebox('getValue');

        var nCboLCDate = parseInt($("#cboLCDateAdvSearch").val());
        var dFromLCDate = $('#txtFromLCDateAdvSearch').datebox('getValue');
        var dToLCDate = $('#txtToLCDateAdvSearch').datebox('getValue');

        var nCboPIBank = parseInt($("#cboPIBankAdvSearch").val());
        var ncboPaymentType = parseInt($("#cboPaymentType").val());
        var nCboMkPerson = parseInt($("#cboMkPersonAdvSearch").val());

        var sCurrentStatus = "";
        var oPIStatus = $("#tblCurrentStatusAdvSearch").datagrid("getChecked");
        for (var i = 0; i < oPIStatus.length; i++) {
            sCurrentStatus = oPIStatus[i].id + "," +sCurrentStatus;
        }
        sCurrentStatus = sCurrentStatus.substring(0, sCurrentStatus.length - 1);

        //var bExportLCIsntCreateYet = $("#chkExportLCIsntCreateYet").is(':checked');

        var nPIType = parseInt($("#cboPITypeAdv").val());
        var sFEONo = $.trim($("#txtSearchByFEONoAdvSearch").val());
        var sConstruction = $.trim($("#txtSearchByConstructionAdvSearch").val());

        var sStyleNo = $.trim($("#txtSearchByStyleNoAdvSearch").val());

        var nCboStatusDate = parseInt($("#cboStatusAdvSearch").val());
        var dFromStatusDate = $('#txtFromStatusDateAdvSearch').datebox('getValue');
        var dToStatusDate = $('#txtToStatusDateAdvSearch').datebox('getValue');

        //var bYetNotMakeFEO = $("#chkYetNotMakeFEO").is(':checked');
        var sParams = _sContractorIds + "~" +
                      _sBuyerIDsAdvSearch + "~" +
                      nCboIssueDate + "~" +
                      dFromIssueDate + "~" +
                      dToIssueDate + "~" +
                      nCboValidityDate + "~" +
                      dFromValidityDate + "~" +
                      dToValidityDate + "~" +
                      nCboLCDate + "~" +
                      dFromLCDate + "~" +
                      dToLCDate + "~" +
                      nCboPIBank + "~" +
                      nCboMkPerson + "~" +
                      sCurrentStatus + "~" +
                      ncboPaymentType + "~" +
                      nPIType + "~" +
                      sStyleNo+"~"+
                      nCboStatusDate + "~" +
                      dFromStatusDate + "~" +
                      dToStatusDate + "~" +
                      _nBUID;
        var oExportSC = {
            Note : sParams
        };

        $.ajax({
            type: "POST",
            dataType: "json",
            url: _sBaseAddress + "/ExportSC/AdvSearch",
            traditional: true,
            data: JSON.stringify(oExportSC),
            contentType: "application/json; charset=utf-8",
            success: function (data) {
                var oExportSCs = jQuery.parseJSON(data);
                debugger;
                if (oExportSCs != null) {
                    if (oExportSCs.length > 0) 
                    {
                      
                        DynamicRefreshList(oExportSCs, "tblExportSCs");
                       $("#winAdvSearch").icsWindow("close");
                      
                    } 
                    else
                    {
                        alert("Sorry, No data found.");
                        DynamicRefreshList([], "tblExportSCs");
                    }

                } else {
                    alert("Sorry, No data found.");
                    DynamicRefreshList([], "tblExportSCs");
                }
                $(".lblLoadingMessage").hide();
            }
        });
    });

    //$("#btnOkAdvSearch").click(function() {
    //    var oExportSCs = $("#tblExportPIAdvSearch").datagrid('getChecked');
    //    if (oExportSCs.length > 0) {
    //        $("#winAdvSearch").icsWindow("close");
    //        if (_sControllerName == "ExportPIReport") {
    //            DynamicRefreshList(oExportSCs, "tblExportPIReports");
    //        }
    //        else {
    //            DynamicRefreshList(oExportSCs, "tblExportSCs");
    //        }
    //    }
    //    else {
    //        alert("Please select minimum one item from list.");
    //        return false;
    //    }
    //});


    function LoadComboAdv()
    {
        //$("#cboPITypeAdv").icsLoadCombo({
        //    List: _oPIPaymentTypes,
        //    OptionValue: "id",
        //    DisplayText: "Value"
        //});
      
        $('#cboPITypeAdv').val(-1);//reset None

        $("#cboPaymentType").icsLoadCombo({
            List: _oPIPaymentTypes,
            OptionValue: "id",
            DisplayText: "Value"
        });

        $("#cboIssueDateAdvSearch, #cboValidityDateAdvSearch, #cboLCDateAdvSearch,#cboStatusAdvSearch").icsLoadCombo({
            List: _oCompareOperators,
            OptionValue: "id",
            DisplayText: "Value"
        });

        $("#cboPIBankAdvSearch").icsLoadCombo({
            List: _oBankBranchs,
            OptionValue: "BankBranchID",
            DisplayText: "BankBranchName"
        });

        $("#cboMkPersonAdvSearch").icsLoadCombo({
            List: _oMktPersons,
            OptionValue: "EmployeeID",
            DisplayText: "Name"
        });
    }
    function CheckFromAndToDateValidation(OperationComboId, FromDateId, ToDateId) {
        $("#" + OperationComboId).parent().parent().parent().find("select").removeClass("errorFieldBorder");
        var nCboVal = $("#" + OperationComboId).val();
        if (parseInt(nCboVal) == 5 || parseInt(nCboVal) == 6) {
            var fromDate = $("#" + FromDateId).datebox("getValue");
            var toDate = $("#" + ToDateId).datebox("getValue");
            if (new Date(fromDate) > new Date(toDate)) {
                $("#" + ToDateId).focus();
                $("#" + OperationComboId).addClass("errorFieldBorder");
                $(".lblLoadingMessage").hide();
                return false;
            } else {
                $("#" + OperationComboId).removeClass("errorFieldBorder");
                return true;
            }
        } else {
            return true;
        }
    }

    function ResetAdvSearchWindow() {
        _sContractorIds = '';
        _sBuyerIDsAdvSearch = "";
        $("#winAdvSearch input").not("input[type='button']").val("");
        $("#winAdvSearch input").removeClass("fontColorOfPickItem");
        $("#winAdvSearch select").val(0);
        $('#cboPITypeAdv').val(-1);//reset None
        DateActionsIssueDateAdvSearch();
        DateActionsValidityDateAdvSearch();
        DateActionsLCDateAdvSearch();
        DynamicRefreshList([],"tblExportPIAdvSearch");
        //$('#chkExportLCIsntCreateYet,#chkYetNotMakeFEO').prop('checked', false);
        $("#txtFromIssueDateAdvSearch,#txtToIssueDateAdvSearch,#txtFromValidityDateAdvSearch,#txtToValidityDateAdvSearch,#txtFromLCDateAdvSearch,#txtToLCDateAdvSearch").datebox({ disabled: true });
        $("#txtFromIssueDateAdvSearch,#txtToIssueDateAdvSearch,#txtFromValidityDateAdvSearch,#txtToValidityDateAdvSearch,#txtFromLCDateAdvSearch,#txtToLCDateAdvSearch").datebox("setValue", icsdateformat(new Date()));
        DynamicRefreshList([], "tblCurrentStatusAdvSearch");
        DynamicRefreshList(_oPIStatusObjs, "tblCurrentStatusAdvSearch");
    }

    function PickAccountOfPIAdvSearch() {
        var oContractor = {
            Params: '2,3' + '~' + $.trim($("#txtContractorAdvS").val()+"~"+_nBUID)
        };
        var obj = {
            BaseAddress: _sBaseAddress,
            Object: oContractor,
            ControllerName: "Contractor",
            ActionName: "ContractorSearchByNameType",
            IsWinClose: false
        };

        $("#progressbar").progressbar({ value: 0 });
        $("#progressbarParent").show();
        var intervalID = setInterval(updateProgress, 250);

        DynamicRefreshList([], "tblAccountsPickerAdvSearch");
        $.icsDataGets(obj, function (response) {
            clearInterval(intervalID);
            $("#progressbarParent").hide();
            if (response.status && response.objs.length > 0) {
                if (response.objs[0].ContractorID > 0) {
                    var tblColums = []; var oColumn = { field: "ContractorID", title: "Code", width: 50, align: "left" }; tblColums.push(oColumn);
                    oColumn = { field: "Name", title: "Name", width: 280, align: "left" }; tblColums.push(oColumn);

                    var oPickerParam = {
                        winid: 'winContractorPicker',
                        winclass: 'clsAccountOf',
                        winwidth: 400,
                        winheight: 460,
                        tableid: 'tblAccountOfs',
                        tablecolumns: tblColums,
                        datalist: response.objs,
                        multiplereturn: true,
                        searchingbyfieldName: 'Name',
                        windowTittle: 'Contactor List'
                    };
                    $.icsPicker(oPickerParam);
                    IntializePickerbutton(oPickerParam);
                }
                else {
                    alert(response.objs[0].ErrorMessage);
                }
            }
            else {
                alert("Sorry, No Contactor Found.");
            }
        });
    }

    function PickBuyerPIAdvSearch() {
        var oContractor = {
            Params: '2' + '~' + $.trim($("#txtBuyersAdvS").val()+"~"+_nBUID)
        };
        var obj = {
            BaseAddress: _sBaseAddress,
            Object: oContractor,
            ControllerName: "Contractor",
            ActionName: "ContractorSearchByNameType",
            IsWinClose: false
        };
        $("#progressbar").progressbar({ value: 0 });
        $("#progressbarParent").show();
        var intervalID = setInterval(updateProgress, 250);
        DynamicRefreshList([], "tblContractorsPickerAdvSearch");
        $.icsDataGets(obj, function (response) {
            clearInterval(intervalID);
            $("#progressbarParent").hide();
            if (response.status && response.objs.length > 0) {
                if (response.objs[0].ContractorID > 0) {
                    var tblColums = []; var oColumn = { field: "ContractorID", title: "Code", width: 50, align: "left" }; tblColums.push(oColumn);
                    oColumn = { field: "Name", title: "Name", width: 280, align: "left" }; tblColums.push(oColumn);
                    var oPickerParam = {
                        winid: 'winBuyers',
                        winclass: 'clsBuyer',
                        winwidth: 400,
                        winheight: 460,
                        tableid: 'tblBuyers',
                        tablecolumns: tblColums,
                        datalist: response.objs,
                        multiplereturn: true,
                        searchingbyfieldName: 'Name',
                        windowTittle: 'Buyer List'
                    };
                    $.icsPicker(oPickerParam);
                    IntializePickerbutton(oPickerParam);
                }
                else {
                    alert(response.objs[0].ErrorMessage);
                }
            }
            else {
                alert("Sorry, No Contactor Found.");
            }
        });
    }

    function DateActionsIssueDateAdvSearch() {
        DynamicDateActions("cboIssueDateAdvSearch", "txtFromIssueDateAdvSearch", "txtToIssueDateAdvSearch");
    }

    function DateActionsValidityDateAdvSearch() {
        DynamicDateActions("cboValidityDateAdvSearch", "txtFromValidityDateAdvSearch", "txtToValidityDateAdvSearch");
    }

    function DateActionsLCDateAdvSearch() {
        DynamicDateActions("cboLCDateAdvSearch", "txtFromLCDateAdvSearch", "txtToLCDateAdvSearch");
    }
    function DateActionsStatusDateAdvSearch() {
        DynamicDateActions("cboStatusAdvSearch", "txtFromStatusDateAdvSearch", "txtToStatusDateAdvSearch");
    }

    $("#btnCloseAdvSearch").click(function () {
        $("#winAdvSearch").icsWindow("close");
    });
    $("#btnAdvSearch").click(function () {
        debugger;
        $("#winAdvSearch").icsWindow("open", "Export PI Advance Search");
        DynamicRefreshList([], "tblExportPIAdvSearch");
        DynamicResetAdvSearchWindow("winAdvSearch");
        DynamicDateActions("cboDateOptionAdvSearch", "txtFromDateAdvSearch", "txtToDateAdvSearch");
        DynamicDateActions("cboValidityDateAdvSearch", "txtFromValidityDateAdvSearch", "txtToValidityDateAdvSearch");
        DynamicDateActions("cboLCDateAdvSearch", "txtFromLCDateAdvSearch", "txtToLCDateAdvSearch");
        DynamicDateActions("cboStatusAdvSearch", "txtFromStatusDateAdvSearch", "txtToStatusDateAdvSearch");
        ResetAdvSearchWindow();
    });

    function IntializePickerbutton(oPickerobj) {
        $("#" + oPickerobj.winid).find("#btnOk").click(function () {
            SetPickerValueAssign(oPickerobj);
        });
        $(document).find('.' + oPickerobj.winclass).keydown(function (e) {
            if (e.which === 13) {
                SetPickerValueAssign(oPickerobj);
            }
        });
    }

    function SetPickerValueAssign(oPickerobj) {
        var oreturnObj = null, oreturnObjs = [];
        if (oPickerobj.multiplereturn) {
            oreturnObjs = $('#' + oPickerobj.tableid).datagrid('getChecked');
        } else {
            oreturnObj = $('#' + oPickerobj.tableid).datagrid('getSelected');
        }

        if (oPickerobj.winid == 'winContractorPicker')
        {
            if (oreturnObjs != null && oreturnObjs.length> 0)
            {
              
                _sContractorIds=''; var sMessage='';
                sMessage=(oreturnObjs.length>1)? oreturnObjs.length +" Contractors Selected" : oreturnObjs[0].Name;
                $('#txtContractorAdvS').val(sMessage);
                $("#txtContractorAdvS").addClass("fontColorOfPickItem");

                for(var i=0;i<oreturnObjs.length;i++){
                    _sContractorIds=_sContractorIds+oreturnObjs[i].ContractorID+',';
                }
                _sContractorIds=_sContractorIds.substring(0,_sContractorIds.length-1);

            }
            else
            {
                alert("Please select a contractor.");
                return false;
            }
        }
        else if (oPickerobj.winid == 'winBuyers') {
            if (oreturnObjs != null && oreturnObjs.length> 0)
            {
                _sBuyerIDsAdvSearch='';
                var sMessage='';
                sMessage=(oreturnObjs.length>1)? oreturnObjs.length +" Contractors Selected" : oreturnObjs[0].Name;
                $('#txtBuyersAdvS').val(sMessage);
                $("#txtBuyersAdvS").addClass("fontColorOfPickItem");

                for(var i=0;i<oreturnObjs.length;i++){
                    _sBuyerIDsAdvSearch=_sBuyerIDsAdvSearch+oreturnObjs[i].ContractorID+',';
                }
                _sBuyerIDsAdvSearch=_sBuyerIDsAdvSearch.substring(0,_sBuyerIDsAdvSearch.length-1);
                
                
            
            }
            else
            {
                alert("Please select a buyer.");
                return false;
            }
        }

        $("#" + oPickerobj.winid).icsWindow("close");
        $("#" + oPickerobj.winid).remove();
    }
    /// end Searchinh
    $("#btnIsClose").click(function () {
        debugger;
       
        var oExportSC= $('#tblExportSCs').datagrid('getSelected');
        if(oExportSC==null || oExportSC.ExportSCID<=0)
        {
            alert("Please select a item from list!");
            return false;
        }
        var SelectedRowIndex=$('#tblExportSCs').datagrid('getRowIndex',oExportSC);

        //if (!confirm("Confirm to Close?")) return false;
     
        var obj = {
            BaseAddress: _sBaseAddress,
            Object: oExportSC,
            ObjectId: oExportSC.ExportSCID,
            ControllerName: "ExportSC",
            ActionName: "OrderClose",
            TableId: "tblExportSCs",
            IsWinClose: false
        };
        $.icsSave(obj, function (response)
        {
            if (response.status && response.obj != null) {
                if (response.obj.ExportSCID > 0)
                {
                    debugger;
                  
                }
            }
        });
    });

</script>