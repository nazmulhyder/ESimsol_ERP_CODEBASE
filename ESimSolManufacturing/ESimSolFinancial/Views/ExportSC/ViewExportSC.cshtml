@{
    ViewBag.Title = "Sales Contract";
}
<html>

<body>

    @model ESimSol.BusinessObjects.ExportSC
    <div id="progressbarParent" style="width:100%;height:100%;margin:0 auto;text-align:center; margin-left: auto;margin-right: auto;left: 0;right: 0;z-index: 1;">
        <div style="margin: 0px auto;margin-top: 251px;text-align:center;width:390px;">
            <label style="font-size:18px;">Please wait</label>
            <div id="progressbar" style="width:100%;height:37px;"></div>
        </div>
    </div>

    <div id="divExportSC" class="easyui-panel menuMainCollectionTable" style="font-family:Tahoma; height:100%; width:100%;overflow:hidden;">
        <div id="tabSalesContract" class="easyui-tabs" style="width:100%;height:100%">
            <div title="Sales Contract" style="padding:2px">
                <div style="height:83%;width:100%;overflow:hidden;">
                    <div style="width:100%;">
                        <fieldset>
                            <legend style="text-align:left; font-weight:bold;"> Sales Contract Informations : </legend>
                            <table style="width: 100%;" cellspacing="1" cellpadding="1">
                                <tr>
                                    <td style="width:10%; text-align:right">
                                        <label>
                                            PI No
                                        </label>
                                    </td>
                                    <td style="width:20%; text-align:left">
                                        <input type="text" id="txtPINo" style="width:100%;" readonly="readonly" />
                                    </td>

                                    <td style="width:10%; text-align:right">
                                        <label>
                                            PI Date
                                        </label>
                                    </td>
                                    <td style="width:20%; text-align:left">
                                        <input type="text" id="txtIssueDate" style="width:100%;" readonly="readonly" />
                                    </td>
                                    <td style="width:10%; text-align:right">
                                        <label>
                                            MKT Person
                                        </label>
                                    </td>
                                    <td style="width:30%; text-align:left">
                                        <input type="text" id="txtMKTPerson" style="width:86%;" readonly="readonly" />
                                    </td>

                                </tr>
                                <tr>
                                    <td style="width:10%; text-align:right">
                                        <label>
                                            Account Of:
                                        </label>
                                    </td>
                                    <td colspan="2" style="width:30%; text-align:left">
                                        <input type="text" id="txtContractorName" style="width:100%;" readonly="readonly" />
                                    </td>
                                    <td style="width:20%; text-align:right">
                                        <label>
                                            Buying House:
                                        </label>
                                    </td>
                                    <td colspan="2" style="width:40%; text-align:left">
                                        <input type="text" id="txtBuyerName" style="width:67%;"/>
                                   <a id="btnPickBuyerPI" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-pick" plain="true"></a>
                                   <a id="btnUpdateBuyer" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-add" plain="true"></a>
                                    </td>
                                </tr>
                              
                            </table>
                            <table style="width: 100%;" cellspacing="1" cellpadding="1">
                                <tr>
                                    <td style="width:10%; text-align:right">
                                        <label>PI Value</label> <span class="lblCurrency"></span>:
                                    </td>
                                    <td style="width:15%; text-align:left">
                                        <input type="text" id="txtPIValue" style="width:100%;" readonly="readonly" />
                                    </td>

                                    <td style="width:10%; text-align:right">
                                        <label>Adj Value</label><span class="lblCurrency"></span>:
                                    </td>
                                    <td style="width:15%; text-align:left">
                                        <input type="text" id="txtAdjAmount" style="width:100%;" readonly="readonly" />
                                    </td>
                                    <td style="width:13%; text-align:right">
                                        <label>
                                            Actule Value
                                        </label><span class="lblCurrency"></span>:
                                    </td>
                                    <td style="width:12%; text-align:left">
                                        <input type="text" id="txtActualValue" style="width:100%;" readonly="readonly" />
                                    </td>
                                    <td style="width:8%; text-align:right">
                                        <label>
                                            L/C No
                                        </label>
                                    </td>
                                    <td style="width:13%; text-align:left">
                                        <input type="text" id="txtLCNo" style="width:100%;" readonly="readonly" />
                                    </td>
                                    <td style="width:5%; text-align:left"></td>
                                </tr>
                                <tr>
                                    <td style="width:10%; text-align:right">
                                        <label>
                                            PI Qty
                                        </label><span class="lblMUnit"></span>:
                                    </td>
                                    <td style="width:15%; text-align:left">
                                        <input type="text" id="txtPIQty" style="width:100%;" readonly="readonly" />
                                    </td>

                                    <td style="width:10%; text-align:right">
                                        <label>
                                            Adj Qty
                                        </label><span class="lblMUnit"></span>:
                                    </td>
                                    <td style="width:15%; text-align:left">
                                        <input type="text" id="txtAdjQty" style="width:100%;" readonly="readonly" />
                                    </td>
                                    <td style="width:13%; text-align:right">
                                        <label> Net Dyeing  </label><span class="lblMUnit"></span>:
                                    </td>
                                    <td style="width:12%; text-align:left">
                                        <input type="text" id="txtNetDyeing" style="width:100%;" readonly="readonly" />
                                    </td>
                                    <td style="width:8%; text-align:right">
                                        <label>
                                            L/C Date
                                        </label>
                                    </td>
                                    <td style="width:13%; text-align:left">
                                        <input type="text" id="txtLCDate" style="width:100%;" readonly="readonly" />
                                    </td>
                                    <td style="width:5%; text-align:left"></td>
                                </tr>
                            </table>
                        </fieldset>
                    </div>
                    <div style="width:100%;height:320px;">
                        <fieldset>
                            <legend style="text-align:left; font-weight:bold;">  </legend>
                            <table style="width:100% ;height:320px">
                                <tr>
                                    <td style="width:65% ;height:275px; vertical-align:top">
                                        <table id="tblSCDetails" class="easyui-datagrid" style="width:100%;height:275px;"
                                               data-options="singleSelect: true,fitColumns:false, rownumbers:true, pagination:false, autoRowHeight:false, toolbar: '#toolbarExportSCDetail',onClickRow:onClickRow ">
                                            <thead>
                                                <tr>
                                                    <th field="ProductionTypeST" width="8%" align="left"> Type</th>
                                                    <th field="ProductCode" width="8%" align="left"> Code</th>
                                                    <th field="ProductName" width="25%" align="left">Item Name</th>
                                                    @*<th field="QtySt" width="8%" align="left">Qty(Lbs)</th>
                                                    <th field="UnitPriceSt" width="8%" align="left">UnitPrice($)</th>*@
                                                    <th data-options="field:'Qty',align:'right',editor:{type:'numberbox',options:{precision:8}}" width="12%">Edit Qty</th>
                                                    <th data-options="field:'UnitPrice',align:'right',editor:{type:'numberbox',options:{precision:6}}" width="10%"> Edit UnitPrice($)</th>
                                                    <th field="AmountSt" width="8%" align="left">Amount</th>
                                                    <th field="POQty" width="8%" align="right" formatter="formatPrice">P.O.Qty</th>
                                                    <th field="YetToPO" width="8%" align="right" formatter="formatPrice">Balance</th>
                                                    <th data-options="field:'StyleNo',width:100,height:60 ,align:'Left',editor:{type:'text'}" align="Left">Style No</th>
                                                    <th data-options="field:'BuyerRef',width:100,height:60 ,align:'Left',editor:{type:'text'}" align="Left">B.Ref</th>
                                                    <th data-options="field:'ColorInfo',width:100,height:60 ,align:'Left',editor:{type:'text'}" align="Left">ColorInfo</th>
                                                    <th field="DOQty" width="8%" align="right" formatter="formatPrice">D.O.Qty</th>
                                                    <th field="YetToDO" width="8%" align="right" formatter="formatPrice">Balance</th>

                                                </tr>
                                            </thead>
                                        </table>
                                        <div id="toolbarExportSCDetail">
                                            <select id="cboProductionType" style="width:112px;"></select>
                                            <a id="btnUpdatePType" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-edit" plain="true"></a>
                                            @*<td style="width:100px">  <input type="checkbox" id="chkLocal"  />COGS </td>*@
                                            <label id="lblProduct">Product</label>
                                            <input type="text" id="txtProductName" placeholder="Enter Product" style="width:130px;" /><a id="btnProductPick" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-pick" plain="true">Pick</a>
                                            <a id="btnPickDetail" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-edit" plain="true">Edit</a>
                                            <a id="btnDeleteDetail" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-remove" plain="true">Remove</a>
                                            <a id="btnRefresh" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-reload" plain="true">Refresh</a>
                                            <a id="btnCopyDetail" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-ok" onclick="CopyDetail()" plain="true">Copy</a>
                                            @*<a id="btnProductionType" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-remove" plain="true">PickType</a>*@
                                        </div>
                                        <table border="0" cellpadding="01" cellspacing="1" style="width:100%;">
                                            <tr>
                                                <td style="width:25%;  text-align:right;font-weight:bold;">Total:</td>
                                                <td style="width:20%;  text-align:right;font-weight:bold;"><label id="lblTotalQty">0</label><span class="lblMUnit"></span> </td>
                                                <td style="width:25%; text-align:center; font-weight:bold;"><label id="lblTotalAmount"> </label> </td>
                                                <td style="width:30%; text-align:left; font-weight:bold;"><span class="lblBalanceText"></span><label id="lblBalancePI"> </label> </td>
                                            </tr>
                                        </table>

                                    </td>
                                    <td style="width:25% ;height:275px;vertical-align:top" >

                                        <table id="tblDyeingOrder" title="Sample Invoice Detail" class="easyui-datagrid" style="width:100%;height:275px;"
                                               data-options="singleSelect: true,fitColumns:false, rownumbers:true, pagination:false, autoRowHeight:false, toolbar:toolbarDyeingOrderDetail">
                                            <thead>
                                                <tr>
                                                    <th field="SampleInvocieNo" width="55%" align="center">Invoice No</th>
                                                    <th field="Amount" width="30%" align="right" formatter="formatPrice">Amount</th>
                                                    <th field="Qty" width="30%" align="right" formatter="formatPrice">Qty(Lbs)</th>
                                                    <th field="OrderNoFull" width="55%" align="center">Invoice No</th>
                                                    
                                                    
                                                </tr>
                                            </thead>
                                        </table>
                                        <div id="toolbarDyeingOrderDetail">
                                            <input id="txtSampleInvoice" class="reset-text" placeholder="Search Dyeing Order By Invoice" style="width:55%" />
                                            <a id="btnPickDyeingOrder" href="javascript:void(0)" class="easyui-linkbutton ics-pick" iconcls="icon-pick" plain="true"></a>
                                            @*<a id="btnResetDyeingOrder" href="javascript:void(0)" class="easyui-linkbutton ics-pick" iconcls="icon-clear" plain="true"></a>*@
                                            <a id="btnDeleteDyeingOrder" href="javascript:void(0)" class="easyui-linkbutton ics-pick" iconcls="icon-remove" plain="true"></a>
                                        </div>
                                        <table border="0" cellpadding="01" cellspacing="1" style="width:100%;">
                                            <tr>
                                                <td style="width:25%;  text-align:right;font-weight:bold;">Total:</td>
                                                <td style="width:20%;  text-align:right;font-weight:bold;"><label id="lblTotalInvoiceAmount">0</label></td>
                                              
                                            </tr>
                                        </table>
                                    </td>

                                </tr>
                            </table>
                            </fieldset>
</div>
                </div>
                <div style="width:100%; height:10%">
                    <fieldset>
                        <legend style="font-weight: bold">Action : </legend>
                        <table border="0" cellspacing="2" cellpadding="2" style="font-size: 11px; font-weight: bold; width:100%">
                            <tr>
                               
                                <td style="width: 10%;text-align:right">
                                    <a id="btnPrintPreview" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-print" plain="true">Preview</a>
                                </td>
                                <td style="width:40%; text-align:right"></td>
                                <td style="width: 20%;text-align:right">
                                    @*<a id="btnSaveUP" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-approved"  plain="true">Rate Change</a>*@
                                    @*<a id="btnSaveServiseCon" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-save" plain="true">Save(Servise)</a>*@
                                </td>
                                <td style="width: 20%;text-align:right">
                                    <a id="btnSave" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-save" plain="true">Save</a>
                                    <a id="btnSaveLog" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-save" plain="true">Save(Revise)</a>
                                    <a id="btnApprove" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-approved" onclick="Approve()" plain="true">Approve</a>
                                </td>
                                <td style="width: 10%;text-align:right">
                                    <a id="btnClose" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-cancel" plain="true">Close</a>
                                </td>
                            </tr>
                        </table>
                    </fieldset>
                </div>
            </div>
            <div title="Adjustment Settle" style="padding:2px">
                <div style="width:100%;height:270px;">
                    <table id="tblExportPIDetail" title="Export PI Detail" class="easyui-datagrid" style="width:100%;height:250px;"
                           data-options="singleSelect: true,fitColumns:false, rownumbers:true, pagination:false, autoRowHeight:false">
                        <thead>
                            <tr>
                                <th rowspan="2" field="ProductNameCode" width="15%" align="left">Product Name</th>
                                <th rowspan="2" field="StyleNo" width="8%" align="center">Style</th>
                                <th rowspan="2" field="ColorInfo" width="8%" align="center">Color</th>
                                <th colspan="3" width="24%" align="center">PI Info</th>
                                <th colspan="4" width="24%" align="center">Adj Info</th>
                                <th colspan="2" width="16%" align="center">Actual Dyeing Info</th>
                            </tr>
                            <tr>
                                <th field="Qty" width="8%" align="right" >Qty</th>
                                <th field="UnitPrice" width="8%" align="right" formatter="formatPrice">Unit Price</th>
                                <th field="Amount" width="8%" align="right" formatter="formatPrice">Amount</th>
                                
                                <th field="AdjQty" width="8%" align="right" formatter="formatPrice">Qty(Adj)</th>
                                <th field="AdjRate" width="8%" align="right" >UP(Adj)</th>
                                <th field="AdjValue" width="8%" align="right" formatter="formatPrice">Amount(Adj)</th>
                                <th field="DocCharge" width="8%" align="right" >Doc Charge</th>

                                <th field="ActualQty" width="8%" align="right" formatter="formatPrice">Qty</th>
                                <th field="ActualAmount" width="8%" align="right" formatter="formatPrice">Amount</th>
                            </tr>
                        </thead>
                    </table>

                    <div style="float:left; width:100%;">
                        <div style="float:left; width:32%;" class="align-right">
                            <b>Total</b>
                        </div>
                        <div style="float:left; width:8%;" class="align-right">
                            <label id="lbl-td-TotalQty">0</label><span class="lblMUnitTwo"></span>
                        </div>
                        <div style="float:left; width:16%;" class="align-right">
                            <span class="lblCurrencyTwo"></span> <label id="lbl-td-TotalAmount">0</label>
                        </div>
                        <div style="float:left; width:8%;" class="align-right">
                            <label id="lbl-td-TotalAdjQty">0</label><span class="lblMUnitTwo"></span>
                        </div>
                        <div style="float:left; width:15%;" class="align-right">
                            <span class="lblCurrencyTwo"></span><label id="lbl-td-TotalAdjValue">0</label>
                        </div>
                        <div style="float:left; width:8%;" class="align-right">
                            <label id="lbl-td-TotalActualQty">0</label><span class="lblMUnitTwo"></span>
                        </div>
                        <div style="float:left; width:8%;" class="align-right">
                            <span class="lblCurrencyTwo"></span> <label id="lbl-td-TotalActualAmount">0</label>
                        </div>
                    </div>

                </div>

                <div style="float:left; width:100%">
                    <div style="float:left; width:50%">
                        <table id="tblDyeingOrder2" title="Sample Invoice Detail" class="easyui-datagrid" style="width:100%;height:202px;"
                               data-options="singleSelect: true,fitColumns:false, rownumbers:true, pagination:false, autoRowHeight:false">
                            <thead>
                                <tr>
                                    <th field="SampleInvocieNo" width="25%" align="center">Invoice No</th>
                                    <th field="OrderNo" width="25%" align="center">Order No</th>
                                    <th field="Qty" width="20%" align="right" formatter="formatPrice">Qty</th>
                                    <th field="Amount" width="20%" align="right" formatter="formatPrice">Amount</th>
                                </tr>
                            </thead>
                        </table>
                    </div>
                    <div style="float:left; width:49%; border:1px solid; height:200px;" >
                        <table cellpadding="1" cellspacing="1" style="padding-top:10px;">
                            <tr> 
                                <td class="td-summary-one" align="right">PI Amount: </td>
                                <td class="td-summary-one" align="left"><span class="lblCurrencyTwo"></span><label id="lblPIAmount"></label></td>
                                <td class="td-summary-two" align="right">Actual Amount: </td>
                                <td class="td-summary-one" align="left"><span class="lblCurrencyTwo"></span><label id="lblActualAmount"></label></td>
                                <td class="td-summary-one" align="right">Adj Value: </td>
                                <td class="td-summary-one" align="left"><span class="lblCurrencyTwo"></span><label id="lblAdjValue"></label></td>
                            </tr>
                            <tr>
                                <td class="td-summary-one" align="right">PI Qty<span class="lblMUnit"></span>: </td>
                                <td class="td-summary-one" align="left"><label id="lblPIQty"></label></td>
                                <td class="td-summary-two" align="right">Actual Qty: </td>
                                <td class="td-summary-one" align="left"><label id="lblActualQty"></label></td>
                                <td class="td-summary-one" align="right">Adj Qty: </td>
                                <td class="td-summary-one" align="left"><label id="lblAdjQty"></label></td>
                            </tr>
                            <tr>
                                <td colspan="6">
                                    <hr />
                                </td>
                            </tr>
                            <tr>
                                <td class="td-summary-one" align="right">Adj Value: </td>
                                <td class="td-summary-one" align="left"><span class="lblCurrencyTwo"></span><label id="lblAdjAmount"></label></td>
                                <td class="td-summary-two" align="right">Invoice Value: </td>
                                <td class="td-summary-one" align="left"><span class="lblCurrencyTwo"></span><label id="lblInvoiceValue"></label></td>
                                <td class="td-summary-one" align="right">Balance: </td>
                                <td class="td-summary-one" align="left"><span class="lblCurrencyTwo"></span><label id="lblBalance"></label></td>
                            </tr>
                        </table>
                        
                    </div>
                    @*<div id="toolbarDyeingOrderDetail">
                        <input id="txtSampleInvoice" class="reset-text" placeholder="Search Dyeing Order By Invoice" style="width:70%" />
                        <a id="btnPickDyeingOrder" href="javascript:void(0)" class="easyui-linkbutton ics-pick" iconcls="icon-pick" plain="true"></a>
                        <a id="btnResetDyeingOrder" href="javascript:void(0)" class="easyui-linkbutton ics-pick" iconcls="icon-clear" plain="true"></a>
                        <a id="btnDeleteDyeingOrder" href="javascript:void(0)" class="easyui-linkbutton ics-pick" iconcls="icon-remove" plain="true">Delete</a>
                    </div>*@
                </div>

                <fieldset>
                    <legend>Action</legend>
                    <div class="align-right">
                        <a id="btnSaveAdjustment" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-save" plain="true">Save</a>
                        <a id="btnCloseAdjustment" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-cancel" plain="true">Close</a>
                    </div>
                </fieldset>
            </div>
            <div title="Production and Delivery Specification" style="padding:2px">
                <div style="width:100%;height:270px;">
                    <table id="tblSCDetailsTwo" title="Detail" class="easyui-datagrid" style="width:100%;height:270px;"
                           data-options="singleSelect: true,fitColumns:false, rownumbers:true, pagination:false, autoRowHeight:false">
                        <thead>
                            <tr>
                                <th field="ProductCode" width="8%" align="left"> Code</th>
                                <th field="ProductName" width="30%" align="left">Item Name</th>
                                <th field="MUName" width="8%" align="left">Unit</th>
                                <th data-options="field:'Qty',align:'right',editor:{type:'numberbox',options:{precision:2}}" width="10%"> Qty</th>
                                <th data-options="field:'UnitPrice',align:'right',editor:{type:'numberbox',options:{precision:4}}" width="10%"> UnitPrice</th>
                                <th field="AmountSt" width="8%" align="left">Amount</th>
                            </tr>
                        </thead>
                    </table>
                    <div style="float:left; width:100%;">
                        <div style="float:left; width:30%;" class="align-right">
                            <b>Total</b>
                        </div>
                        <div style="float:left; width:20%;" class="align-right">
                            <label id="lbl-td-TotalQty">0</label>
                        </div>
                        <div style="float:left; width:16%;" class="align-right">
                        </div>
                        <div style="float:left; width:20%;" class="align-right">
                            <span class="lblCurrencyTwo"></span>  <label id="lbl-td-TotalAmount">0</label>
                        </div>
                        <div style="float:left; width:30%;" class="align-right">
                         
                        </div>
                    </div>
                </div>
                <div style="float:left; width:100%">
                    <div style="float:left; width:100%">
                        <table style="width:100% ;height:150px">
                            <tr>
                                <td style="width:20% ;height:150px">
                                    <fieldset>
                                        <legend style="text-align:left; font-weight:bold;"> Production Control : </legend>
                                        <table style="width:100% ;height:140px;">

                                            <tr>
                                                <td style="width:100%"><input type="checkbox" id="chkPIIssue_Pro" value="value" onclick="if(this.checked){IsPIIssue_Pro()}" />After PI Issue </td>
                                            </tr>
                                            <tr>
                                                <td style="width:100%"><input type="checkbox" id="chkLCOpen_Pro" value="value" onclick="if(this.checked){IsLCOpen_Pro()}" />After LC Open </td>
                                            </tr>
                                            <tr>
                                                <td style="width:100%"><input type="checkbox" id="chkBillAcceptance_Pro" value="value" onclick="if(this.checked){IsBillAcceptance_Pro()}else{IsProductionControl()}" />After Bill Acceptance </td>
                                            </tr>
                                            <tr>
                                                <td style="width:100%"><input type="checkbox" id="chkUDReceive_Pro" value="value" onclick="if(this.checked){IsUDReceive_Pro()}else{IsProductionControl()}" />After UD Receive </td>
                                            </tr>
                                            <tr>
                                                <td style="width:100%"><input type="checkbox" id="chkBillMaturity_Pro" value="value" onclick="if(this.checked){IsBillMaturity_Pro()}else{IsProductionControl()}" />After Bill Maturity</td>
                                            </tr>
                                        </table>
                                    </fieldset>
                                </td>
                                <td style ="width:20% ;height:150px">
                                    <fieldset>
                                        <legend style="text-align:left; font-weight:bold;"> Delivery Control : </legend>
                                        <table style="width:100%;height:140px">

                                            <tr>
                                                <td style="width:100%"><input type="checkbox" id="chkPIIssue_Del" value="value" onclick="if(this.checked){IsPIIssue_Del()}" />After PI Issue </td>
                                            </tr>
                                            <tr>
                                                <td style="width:100%"><input type="checkbox" id="chkLCOpen_Del" value="value" onclick="if(this.checked){IsLCOpen_Del()}" />After LC Open </td>
                                            </tr>
                                            <tr>
                                                <td style="width:100%"><input type="checkbox" id="chkBillAcceptance_Del" value="value" onclick="if(this.checked){IsBillAcceptance_Del()}else{IsProductionControl()}" />After Bill Acceptance </td>
                                            </tr>
                                            <tr>
                                                <td style="width:100%"><input type="checkbox" id="chkUDReceive_Del" value="value" onclick="if(this.checked){IsUDReceive_Del()}else{IsProductionControl()}" />After UD Receive </td>
                                            </tr>
                                            <tr>
                                                <td style="width:100%"><input type="checkbox" id="chkBillMaturity_Del" value="value" onclick="if(this.checked){IsBillMaturity_Del()}else{IsProductionControl()}" />After Bill Maturity</td>
                                            </tr>
                                        </table>
                                    </fieldset>
                                    </td>
                                <td style="width:55% ;height:150px">
                                    <fieldset>
                                        <legend style="text-align:left; font-weight:bold;">Adjustment Distribution : </legend>
                                        <table cellpadding="2"  style="width:100% ;height:140px">
                                            <tr id="rtAdjRate" style="vertical-align:top">
                                                <td style="width: 30%; text-align: right">
                                                    <label>Rate Adjust goes to:</label>
                                                </td>
                                                <td style="width:10%; text-align: left">
                                                    <input type="text" id="txtAdj_Rate" style="width:100%;text-align:right" disabled="disabled" />
                                                </td>
                                                <td style="width: 50%; text-align: left">
                                                    <select style="width:80%;" id="cboContractor_Rate"></select>
                                                </td>
                                                <td style="width:10%; text-align: left"></td>
                                            </tr>
                                            <tr id="rtAdjQty" style="vertical-align:top">
                                                <td style="width: 30%; text-align: right">
                                                    <label>Qty Adjust goes to:</label>
                                                </td>
                                                <td style="width:10%; text-align: left">
                                                    <input type="text" id="txtAdj_Qty" style="width:100%;text-align:right" disabled="disabled" />
                                                </td>
                                                <td style="width: 50%; text-align: left">
                                                    <select style="width:80%;" id="cboContractor_Qty"></select>
                                                </td>
                                                <td style="width:10%; text-align: left"></td>
                                            </tr>
                                            <tr id="rtAdjDocCharge" style="vertical-align:top">
                                                <td style="width: 30%; text-align: right">
                                                    <label>Doc Charge Adjust goes to:</label>
                                                </td>
                                                <td style="width:10%; text-align: right">
                                                    <input type="text" id="txtAdj_DocCharge" style="width:100%;text-align:right" disabled="disabled" />
                                                </td>
                                                <td style="width: 50%; text-align: left">
                                                    <select style="width:80%;" id="cboContractor_DocCharge"></select>
                                                </td>
                                                <td style="width:10%; text-align: left"></td>
                                            </tr>
                                           
                                        </table>
                                    </fieldset>
                                </td>
                            </tr>
                        </table>
                    </div>
                    
                </div>
                <fieldset>
                    <legend>Action</legend>
                    <table border="0" cellspacing="2" cellpadding="2" style="font-size: 11px; font-weight: bold; width:100%">
                        <tr>
                            <td style="width: 40%;text-align:right">
                            </td>
                            <td style="width:40%; text-align:right"></td>
                            <td style="width: 20%;text-align:right">
                                <a id="btnSaveTerms" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-save" plain="true">Save</a>
                                <a id="btnCloseTerms" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-cancel" plain="true">Close</a>
                            </td>
                        </tr>
                    </table>
                </fieldset>
            </div>
            <div title="P/I Transfer" style="padding:2px">
              
                    <div style="width:100%;">
                        <fieldset>
                            <legend style="text-align:left; font-weight:bold;"> P/I to P/I Transfer : </legend>
                            <table style="width: 100%;height:300px" cellspacing="1" cellpadding="1">
                                <tr>
                                    <td style="width:10%; text-align:right">
                                        <label>
                                            PI No
                                        </label>
                                    </td>
                                    <td style="width:20%; text-align:left">
                                        <input type="text" id="txtExportPINoFrom" style="width:67%;" />
                                        <a id="btnPickExportPINoFrom" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-pick" plain="true"></a>
                                        <a id="btnUpdateExportPINoFrom" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-add" plain="true"></a>
                                    </td>

                                </tr>
                                

                            </table>
                            
                        </fieldset>
                    </div>
             
                <fieldset>
                    <legend style="font-weight:bold"> Action : </legend>
                    <table border="0" cellspacing="2" cellpadding="2" style="width:100%; font-size:11px; font-weight:bold;">
                        <tr>
                            <td style="width:100%;text-align:right;">
                                <a id="btnClosePITrans" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-cancel" plain="true">Close</a>
                            </td>

                        </tr>
                    </table>
                </fieldset>
            </div>
        </div>
    </div>
    <div id="winExportSCDetailEdit" style="width:900px;" class="easyui-window" title="Edit Detail" data-options="modal:true,closed:true,collapsible:false,minimizable:false,maximizable:false,closable:false">
        <div>
            <fieldset>
                <legend style="font-weight:bold"> Detail info : </legend>
                <table border="0" cellspacing="2" cellpadding="2" style="width:100%; font-size: 11px; font-weight: bold">
                    <tr>
                        <td style="width: 12%; text-align: right">
                            Yarn Type(PI):
                        </td>
                        <td colspan="9" style="width:88%; text-align: left">
                            <select id="cboExportPIDetail" onchange="ChangeExportPIDetail()" style="width:90%"></select>

                        </td>

                    </tr>
                    <tr>
                        <td style="width: 12%; text-align: right">
                            PI Qty (<span class="lblMUnitOne"></span>):
                        </td>
                        <td style="width:10%; text-align: left">
                            <input type="text" style="width:100%; text-align:right" id="txtQty_PI" />
                        </td>
                        <td style="width: 12%; text-align: right">
                            Actual Qty (<span class="lblMUnitTwo"></span>):
                        </td>
                        <td style="width: 10%; text-align: left">
                            <input type="text" style="width:100%; text-align:right" id="txtQty_SC" />
                        </td>
                        <td style="width: 12%; text-align: right">
                           Adj Rate ($):
                        </td>
                        <td style="width: 8%; text-align: left">
                            <input type="text" style="width:100%; text-align:right" id="txtAdjRatePI" />
                        </td>
                        <td style="width: 10%; text-align: right">
                            Adj Qty (<span class="lblMUnitTwo"></span>):
                        </td>
                        <td style="width: 8%; text-align: left">
                            <input type="text" style="width:100%; text-align:right" id="txtAdjQtyPI" />
                        </td>
                        <td style="width: 10%; text-align: right">
                            Adj Value ($):
                        </td>
                        <td style="width: 8%; text-align: left">
                            <input type="text" style="width:100%; text-align:right" id="txtAdjValuePI" />
                        </td>
                    </tr>
                    <tr>
                        <td style="width: 12%;  border-bottom:1px solid black;text-align: right">
                            PI Value ($):
                        </td>
                        <td style="width:10%; border-bottom:1px solid black; text-align: left">
                            <input type="text" style="width:100%; text-align:right" id="txtAmount_PI" />
                        </td>
                        <td style="width: 12%; border-bottom:1px solid black; text-align: right">
                           AC Value (<span class="lblMUnitTwo"></span>):
                        </td>
                        <td style="width: 10%; border-bottom:1px solid black; text-align: left">
                            <input type="text" style="width:100%; text-align:right" id="txtAmount_SC" />
                        </td>
                        <td style="width: 12%; border-bottom:1px solid black; text-align: right">
                            UP ($/<span class="lblMUnitTwo"></span>):
                        </td>
                        <td style="width: 8%; border-bottom:1px solid black; text-align: left">
                            <input type="text" style="width:100%; text-align:right" id="txtUP_PI" />
                        </td>
                        <td style="width: 10%; border-bottom:1px solid black; text-align: right">
                            Balance ($):
                        </td>
                        <td style="width: 8%; border-bottom:1px solid black; text-align: left">
                            <input type="text" style="width:100%; text-align:right" id="txtBal_Val_SC" />
                        </td>
                        <td style="width: 10%; border-bottom:1px solid black; text-align: right">
                          
                        </td>
                        <td style="width: 8%; border-bottom:1px solid black; text-align: left">
                         
                        </td>
                    </tr>
                  
                </table>
                <table border="0" cellspacing="2" cellpadding="2" style="width:100%; font-size:11px; font-weight:bold">
                    <tr>
                        <td style="width:20%;text-align:right">
                            Product:
                        </td>
                        <td style="width:80%;text-align:left">
                            <input type="text" id="txtProduct_Edit" style="width:75%" />
                            <a id="btnPickProduct" href="javascript:void(0)" class="easyui-linkbutton ics-pick" iconcls="icon-pick" plain="true"></a>
                        </td>
                    </tr>


                </table>
                <table border="0" cellspacing="2" cellpadding="2" style="width:100%; font-size: 11px; font-weight: bold">

                    <tr>
                        <td style="width: 20%; text-align: right">
                            Qty in Weight(<span class="lblMUnitOne"></span>):

                        </td>

                        <td style="width: 30%; text-align: left">
                            <input type="text" style="width: 80%; text-align:right" id="txtQtyInOne" />
                        </td>
                        <td style="width: 20%; text-align: right">
                            @*Qty(<span class="lblMUnitTwo"></span>):*@
                        </td>
                        <td style="width: 30%; text-align: left">
                            @*<input type="text" style="width:80%; text-align:right" id="txtQtyInTwo" />*@
                        </td>
                    </tr>
                    <tr>
                        <td style="width: 20%; text-align: right">
                            Unit Price ($/<span class="lblMUnitOne"></span>):
                        </td>
                        <td style="width:30%; text-align: left">
                            <input type="text" style="width:80%; text-align:right" id="txtUnitPriceInOne" />
                        </td>
                        <td style="width: 20%; text-align: right">
                            @*Unit Price ($/<span class="lblMUnitTwo"></span>):*@
                        </td>
                        <td style="width: 30%; text-align: left">
                            @*<input type="text" style="width:80%; text-align:right" id="txtUnitPriceInTwo" />*@
                        </td>
                    </tr>
                    <tr>
                        <td style="width: 20%; border-bottom:1px solid black; text-align: right">
                            Amount(USD):
                        </td>
                        <td style="width:30%; border-bottom:1px solid black; text-align: left">
                            <input type="text" style="width:80%; text-align:right" id="txtAmount" disabled="disabled" />
                        </td>
                        <td style="width: 20%; border-bottom:1px solid black; text-align: right">Balance</td>
                        <td style="width: 30%; border-bottom:1px solid black;text-align: left"></td>
                    </tr>
                  
                </table>
                <table border="0" cellspacing="2" cellpadding="2" style="width:100%; font-size: 11px; font-weight: bold">
                    <tr>
                        <td style="width: 15%; text-align: right">
                            Buyer Ref:
                        </td>
                        <td style="width: 20%;">
                            <input type="text" style="width: 100%;" id="txtBuyerReference" />
                        </td>
                        <td style="width: 15%; text-align: right">
                            ColorInfo:
                        </td>
                        <td style="width:20%;">
                            <input type="text" style="width: 100%;" id="txtColorEdit" />
                        </td>
                        <td style="width: 15%; text-align: right">
                            Style No:
                        </td>
                        <td style="width: 15%">
                            <input type="text" style="width: 100%;" id="txtStyleNo" />
                        </td>
                    </tr>
                  
                </table>
            </fieldset>
            <fieldset>
                <legend style="font-weight:bold"> Sales info : </legend>
                <table border="0" cellspacing="2" cellpadding="2" style="width:100%; font-size: 11px; font-weight: bold">
                    <tr>
                        <td style="width: 15%; text-align: right">
                            Sale Type:
                        </td>
                        <td style="width: 20%;">
                            <select id="cboProductionTypeTwo" style="width:112px;"></select>
                        </td>
                        <td style="width: 15%; text-align: right">
                            Dyeing Process:
                        </td>
                        <td style="width:20%;">
                            <select id="cboDyeingType" style="width:112px;"></select>
                        </td>
                        <td style="width: 15%; text-align: right">
                            Qty in Piece:
                        </td>
                        <td style="width: 15%">
                            <input type="text" style="width: 100%;" id="txtBagCount" />
                        </td>
                    </tr>
                    <tr>
                        <td style="width: 15%; text-align: right">
                            Yarn Owner:
                        </td>
                            <td style="width: 20%;">
                                <table>
                                    <tr>
                                        <td style="font-size: 11px; font-weight: normal;text-align:left;"><input id="chkIsBuyerYarnYes" type="checkbox" onclick="if(this.checked){IsBuyerYarnYes()}else{IsBuyerYarnNo()}" /> BYDL</td>
                                        <td style="font-size: 11px; font-weight: normal;text-align:left;"><input id="chkIsBuyerYarnNo" type="checkbox" onclick="if(this.checked){IsBuyerYarnNo()}else{IsBuyerYarnYes()}" /> Buyer</td>
                                    </tr>
                                </table>
                                
                            </td>
                            <td style="width: 15%; text-align: right">
                               Dyes Owner
                            </td>
                            <td style="width:20%;">
                                <table>
                                    <tr>
                                        <td style="font-size: 11px; font-weight: normal;text-align:left;"><input id="chkIsBuyerDyesYes" type="checkbox" onclick="if(this.checked){IsBuyerDyesYes()}else{IsBuyerDyesNo()}" /> BYDL</td>
                                        <td style="font-size: 11px; font-weight: normal;text-align:left;"><input id="chkIsBuyerDyesNo" type="checkbox" onclick="if(this.checked){IsBuyerDyesNo()}else{IsBuyerDyesYes()}" /> Buyer</td>
                                    </tr>
                                </table>
                            </td>
                            <td style="width: 15%; text-align: right">
                                Chemical Owner
                            </td>
                            <td style="width: 15%">
                                <table>
                                    <tr>
                                        <td style="font-size: 11px; font-weight: normal;text-align:left;"><input id="chkIsBuyerChemicalYes" type="checkbox" onclick="if(this.checked){IsBuyerChemicalYes()}else{IsBuyerChemicalNo()}" /> BYDL</td>
                                        <td style="font-size: 11px; font-weight: normal;text-align:left;"><input id="chkIsBuyerChemicalNo" type="checkbox" onclick="if(this.checked){IsBuyerChemicaleNo()}else{IsBuyerChemicalYes()}" /> Buyer</td>
                                    </tr>
                                </table>
                            </td>
                        </tr>
                    </table>
                </fieldset>
    </div>
            <fieldset>
                <legend style="font-weight:bold"> Action : </legend>
                <table border="0" cellspacing="2" cellpadding="2" style="width:100%; font-size:11px; font-weight:bold;">
                    <tr>
                        <td style="width:100%;text-align:right;">
                            <a id="btnUpdateEPIDetail" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-save" plain="true">OK</a>
                            <a id="btnCloseEPIDetail" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-cancel" plain="true">Close</a>
                        </td>

                    </tr>
                </table>
            </fieldset>
        </div>
    </body>
    </html>
    <style type="text/css">
        .td-summary-one{
            width:17%;
        }
        .td-summary-two{
            width:19%;
        }
    </style>
    <script type="text/javascript">
    var _oExportSC=null;
    var _sBaseAddress="";
    var _sExportSCHeader="";
    var _nMenuid=0;
    var _sBackLink="";
    var _nTotalAmount=0;
    var _oExportPIDetails=[];
    var _oDyeingOrders=[];
    var _oProductionType=[];
    var _oProduct = null;
    var _nExportPIID=0;
    $(document).ready(function () {
        debugger;
        _nMenuid = @Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(HttpContext.Current.Session[SessionInfo.MenuID]));
        _sBaseAddress =@Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(HttpContext.Current.Session[SessionInfo.BaseAddress]));
        _oExportSC =@Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(Model));
        _oExportPIDetails =@Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(@ViewBag.ExportPIDetails));
        _oDyeingOrders =@Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(@ViewBag.DyeingOrders));
        var oDyeingTypes = @Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(ViewBag.DyeingTypes));
        _oProductionType= @Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(ViewBag.ProductionType));
        var oAuthorizationRolesMapping = @Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(HttpContext.Current.Session[SessionInfo.AuthorizationRolesMapping]));
        var oExportPIsTR = @Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(ViewBag.ExportPIsTR));
            $("#cboDyeingType").icsLoadCombo({List: oDyeingTypes, OptionValue: "DyeingTypeInt", DisplayText: "Name"});

            _sBackLink=sessionStorage.getItem("BackLink");
            RefreshControlLayout(oAuthorizationRolesMapping);
            RefreshAdjustmentDistribution();
            _sExportSCHeader=sessionStorage.getItem("ExportSCHeader");
            // $('#divExportSC').panel({ title:_sExportSCHeader});
            $("#progressbar").progressbar({ value: 0 });
            $("#progressbarParent").hide();
            $('#btnApprove,#btnSaveLog,#btnSaveAdjustment').hide();
            if(_sExportSCHeader=="View ExportSC")
            {
                $('#btnSave,#btnSaveAdjustment').hide();
                $('#btnApprove').hide();
                $('#btnProductPick').hide();
                $('#btnDeleteDetail').hide();
                //$('#btnPickDetail').hide();
            }
            if(_sExportSCHeader=="AdjustmenSttle")
            {
                $('#btnSave').hide();
                $('#btnApprove').hide();
                $('#btnProductPick').hide();
                $('#btnDeleteDetail').hide();
                //$('#btnPickDetail').hide();
                $('#tabSalesContract').tabs('select', 1);
            }

            if(_sExportSCHeader=="Approve ExportSC")
            {
                $('#btnSave,#btnSaveAdjustment').hide();
                $('#btnApprove').show();
            }
            if(_sExportSCHeader=="Change ExportSC")
            {
                $('#btnSave,#btnSaveAdjustment').hide();
                $('#btnSaveLog').show();
            }
            if(_oDyeingOrders.length)
            {
                DynamicRefreshList(_oDyeingOrders, "tblDyeingOrder");
            }
            debugger;
            RefreshControl();
            RefreshControlAdjSettle();
            _oExportSC.Production_ControlBy=1;
            RefreshProductionControl();
            RefreshDeliveryControl();
            RefreshSummary_Inv();
            if(oExportPIsTR.length>0)
            {
                $('#txtExportPINoFrom').val(oExportPIsTR[0].PINo_Full);
            }
        });
        function RefreshControlLayout(oAuthorizationRolesMapping)
        {
            $("#btnUpdateExportPINoFrom").hide();
            if(oAuthorizationRolesMapping!=null){
                if(PermissionChecker('Transfer', 'ExportPI',oAuthorizationRolesMapping)) {$("#btnUpdateExportPINoFrom").show();}
            }
        }

        function updateProgress() {
            var value =$('#progressbar').progressbar('getValue');
            if (value < 96){
                value += Math.floor(Math.random() * 10);
                $('#progressbar').progressbar('setValue', value);
            }
        }
        function hideShow(miliseconds) {
            $("#progressbarParent").hide();
        }
        function RefreshControl()
        {

            $("#cboProductionType,#cboProductionTypeTwo").icsLoadCombo({
                List: _oProductionType,
                OptionValue: "id",
                DisplayText: "Value"
            });

            $(".lblCurrency").html("("+_oExportSC.Currency+")");

            $(".lblCurrencyTwo").html(_oExportSC.Currency);
            $('#txtPINo').val(_oExportSC.PINo_Full);
            $('#txtIssueDate').val(_oExportSC.IssueDateSt);
            $('#txtMKTPerson').val(_oExportSC.MKTPName);
            $('#txtContractorName').val(_oExportSC.ContractorName);
           // $('#txtPaymentType').val(_oExportSC.PaymentTypeSt);
            $('#txtBuyerName').val(_oExportSC.BuyerName);

            $('#txtPIValue').val(formatPrice(_oExportSC.Amount_PI,null));
            $('#txtAdjAmount').val(formatPrice(_oExportSC.AmountToBeAdjusted,null));
            $('#txtActualValue').val(formatPrice((_oExportSC.Amount_PI-_oExportSC.AmountToBeAdjusted),null));

            $('#txtPIQty').val(formatPrice(_oExportSC.Qty_PI,null));
            $('#txtAdjQty').val(formatPrice(_oExportSC.AdjQty,null));
            $('#txtNetDyeing').val(formatPrice(_oExportSC.TotalQty,null));
            $('#txtLCDate').val(_oExportSC.ExportLCDateSt);

            $('#txtLCNo').val(_oExportSC.ELCNo);

            if(_oExportSC.ExportSCDetails!=null && _oExportSC.ExportSCDetails.length>0)
            {
                RefreshExportSCDetails(_oExportSC.ExportSCDetails)
                $(".lblMUnit").html("("+_oExportSC.ExportSCDetails[0].MUName+")");
                $(".lblMUnitTwo,.lblMUnitOne").html(" "+_oExportSC.ExportSCDetails[0].MUName);
            }
            RefreshSummary();

        }

        function RefreshControlAdjSettle(){
            debugger;
            DynamicRefreshList(_oExportPIDetails, "tblExportPIDetail");
            var nQty=0, nAmount=0, nAdjQty=0, nAdjValue=0, nActualQty=0, nActualAmount=0;
            for(var i=0; i<_oExportPIDetails.length;i++){
                nQty=parseFloat(nQty)+ parseFloat(_oExportPIDetails[i].Qty);
                nAmount=parseFloat(nAmount)+ parseFloat(_oExportPIDetails[i].Amount);
                nAdjQty=parseFloat(nAdjQty)+ parseFloat(_oExportPIDetails[i].AdjQty);
                nAdjValue=parseFloat(nAdjValue)+ parseFloat(_oExportPIDetails[i].AdjValue);
                nActualQty=parseFloat(nActualQty)+ parseFloat(_oExportPIDetails[i].ActualQty);
                nActualAmount=parseFloat(nActualAmount)+ parseFloat(_oExportPIDetails[i].ActualAmount);
            }

            $('#lbl-td-TotalQty,#lblPIQty').text(formatPrice(nQty));
            $('#lbl-td-TotalAmount,#lblPIAmount').text(formatPrice(nAmount));
            $('#lbl-td-TotalAdjQty,#lblAdjQty').text(formatPrice(nAdjQty));

            $('#lbl-td-TotalActualQty,#lblActualQty').text(formatPrice(nActualQty));
            $('#lbl-td-TotalActualAmount,#lblActualAmount').text(formatPrice(nActualAmount));


            _oDyeingOrders=$('#tblDyeingOrder').datagrid('getRows');

            var nInvoiceValue=0;
            for(var i=0; i<_oDyeingOrders.length;i++)
            {
                nInvoiceValue= parseFloat(nInvoiceValue)+ _oDyeingOrders[i].Amount;
            }

            //if(nAdjValue<nInvoiceValue)
            //{
            //    nAdjValue=nInvoiceValue;
            //}
            _oExportSC.SampleInvoiceAdjAmount=parseFloat(nInvoiceValue);
            _oExportSC.AmountToBeAdjusted=parseFloat(nAdjValue)+parseFloat(nInvoiceValue);

            $('#lbl-td-TotalAdjValue,#lblAdjValue,#lblAdjAmount').text(formatPrice(_oExportSC.AmountToBeAdjusted));

            $('#lblInvoiceValue').text(formatPrice(nInvoiceValue));
            $('#lblBalance').text(formatPrice(_oExportSC.AmountToBeAdjusted- nInvoiceValue));
            $('#txtActualValue').val(formatPrice((_oExportSC.Amount_PI-_oExportSC.AmountToBeAdjusted),null));
            $('#txtAdjAmount').val(formatPrice(_oExportSC.AmountToBeAdjusted,null));
            //var oDyeingOrders = $('#tblDyeingOrder').datagrid('getRows');

        }


        function RefreshExportSCDetails(oExportSCDetails)
        {
            var data={"total":""+oExportSCDetails.length+"","rows":oExportSCDetails};
            $('#tblSCDetails').datagrid('loadData',data);

            var data={"total":""+oExportSCDetails.length+"","rows":oExportSCDetails};
            $('#tblSCDetailsTwo').datagrid('loadData',data);
        }

        function ValidateInput()
        {
            debugger;
            var oESCDetails=$("#tblSCDetails").datagrid('getRows');
            if ( oESCDetails.length>0)
            {
                for (var i = 0; i < oESCDetails.length; i++) {
                    if(parseFloat(oESCDetails[i].ProductionType)<=0)
                    {
                        alert("Please Select a Type from list .");
                        $('#cboProductionType').focus();
                        return false;
                    }
                }
                //alert("Please Add Product(s).");
                //return false;
            }
            //if(_oExportSC.AdjAmount<_oExportSC.SampleInvoiceAdjAmount)
            //{
            //    _oExportSC.AmountToBeAdjusted=_oExportSC.SampleInvoiceAdjAmount;
            //}
            _oExportSC.AmountToBeAdjusted=_oExportSC.AdjAmount+_oExportSC.SampleInvoiceAdjAmount;

            var nActualAmount=(_oExportSC.Amount_PI-_oExportSC.AmountToBeAdjusted);
            nActualAmount=_nTotalAmount-nActualAmount;

            if (nActualAmount<-0.1)
            {
                alert(" your actual amount must be "+formatPrice(_oExportSC.Amount_PI-_oExportSC.AmountToBeAdjusted) +". Your entry amount is :"+ formatPrice(_nTotalAmount)+", Sample Adjusted Amount:"+ _oExportSC.SampleInvoiceAdjAmount);
                return false;
            }

            if (Math.round(nActualAmount,2)>0.2)
            {
                alert("You can not exced PI Amount. your actual amount must be "+formatPrice(_oExportSC.Amount_PI-_oExportSC.AmountToBeAdjusted) +". Your entry amount is :"+ formatPrice(_nTotalAmount));
                return false;
            }


            return true;
        }

        function RefreshObject()
        {
            var oExportSC= {
                ExportSCID :_oExportSC.ExportSCID,
                ExportPIID :_oExportSC.ExportPIID,
                BuyerID: _oExportSC.BuyerID,
                ExportSCDetails:$("#tblSCDetails").datagrid('getRows')
            };
            return oExportSC;
        }

        $("#btnSave").click(function(){
            debugger;
            endEditing();
            RefreshSummary();
            if(!ValidateInput()) return false;

            var oExportSC=RefreshObject();

            $.icsSave({
                BaseAddress: _sBaseAddress,
                Object: oExportSC,
                ObjectId: oExportSC.ExportSCID,
                ControllerName: "ExportSC",
                ActionName: "Save",
                TableId: "",
                IsWinClose: false,
                Message: "Data Saved Successfully."

            },function (response){
                if(response.status && response.obj!=null){
                    if(response.obj.ExportSCID>0){
                        var oExportSC =response.obj;
                        var oExportSCs =sessionStorage.getItem("ExportSCs");
                        var nIndex= parseInt(sessionStorage.getItem("SelectedRowIndex"));
                        debugger;
                        if(oExportSCs!=null)
                        {
                            oExportSCs = jQuery.parseJSON(oExportSCs);
                        }
                        else
                        {
                            oExportSCs=[];
                        }
                        if(nIndex!=-1)
                        {
                            oExportSCs[nIndex]=oExportSC;
                        }
                        else
                        {
                            sessionStorage.setItem("SelectedRowIndex", oExportSCs.length);
                            oExportSCs.push(oExportSC);
                        }
                        sessionStorage.setItem("ExportSCs", JSON.stringify(oExportSCs));
                        window.location.href =_sBackLink; //_sBaseAddress+ "/ExportSC/ViewExportSCs?menuid="+_nMenuid;
                    }
                }
            });

        });
        $("#btnSaveLog").click(function(){
            debugger;
            endEditing();
            RefreshSummary();
            if(!ValidateInput()) return false;

            var oExportSC=RefreshObject();

            $.icsSave({
                BaseAddress: _sBaseAddress,
                Object: oExportSC,
                ObjectId: oExportSC.ExportSCID,
                ControllerName: "ExportSC",
                ActionName: "SaveLog",
                TableId: "",
                IsWinClose: false,
                Message: "Data Saved Successfully."

            },function (response){
                if(response.status && response.obj!=null){
                    if(response.obj.ExportSCID>0){
                        var oExportSC =response.obj;
                        var oExportSCs =sessionStorage.getItem("ExportSCs");
                        var nIndex= parseInt(sessionStorage.getItem("SelectedRowIndex"));
                        debugger;
                        if(oExportSCs!=null)
                        {
                            oExportSCs = jQuery.parseJSON(oExportSCs);
                        }
                        else
                        {
                            oExportSCs=[];
                        }
                        if(nIndex!=-1)
                        {
                            oExportSCs[nIndex]=oExportSC;
                        }
                        else
                        {
                            sessionStorage.setItem("SelectedRowIndex", oExportSCs.length);
                            oExportSCs.push(oExportSC);
                        }
                        sessionStorage.setItem("ExportSCs", JSON.stringify(oExportSCs));
                        window.location.href =_sBackLink; //_sBaseAddress+ "/ExportSC/ViewExportSCs?menuid="+_nMenuid;
                    }
                }
            });

        });
        function Approve()
        {
            //debugger;

            if(_oExportSC==null || _oExportSC.ExportSCID<=0)
            {
                alert("without save can't Approve!");
                return false;
            }
            if(_oExportSC.IsRevisePI==false)
            {
                alert("Sorry, Already Approved");
                return false;
            }
            //if(parseInt(_oExportSC.BUID)!=0)
            //{
            //    alert("Select Business unit");
            //    return false;
            //}
            RefreshSummary();

            if (!confirm("Confirm to Approve?")) return ;
            debugger;
            if(!ValidateInput()) return;
            var oExportSC=RefreshObject();

            $.icsSave({
                BaseAddress: _sBaseAddress,
                Object: oExportSC,
                ObjectId: oExportSC.ExportSCID,
                ControllerName: "ExportSC",
                ActionName: "Approved",
                TableId: "",
                IsWinClose: false,
                Message: "Data Saved Successfully."

            },function (response){
                if(response.status && response.obj!=null){
                    debugger;
                    if(response.obj.ExportSCID>0){
                        var oExportSC =response.obj;
                        var oExportSCs =sessionStorage.getItem("ExportSCs");
                        var nIndex= parseInt(sessionStorage.getItem("SelectedRowIndex"));
                        debugger;
                        if(oExportSCs!=null)
                        {
                            oExportSCs = jQuery.parseJSON(oExportSCs);
                        }
                        else
                        {
                            oExportSCs=[];
                        }
                        if(nIndex!=-1)
                        {
                            oExportSCs[nIndex]=oExportSC;
                        }
                        else
                        {
                            sessionStorage.setItem("SelectedRowIndex", oExportSCs.length);
                            oExportSCs.push(oExportSC);
                        }
                        sessionStorage.setItem("ExportSCs", JSON.stringify(oExportSCs));
                        window.location.href =_sBackLink; //_sBaseAddress+ "/ExportSC/ViewExportSCs?menuid="+_nMenuid;
                    }
                }
            });
        }
        $("#btnSaveUP").click(function(){
            debugger;
            endEditing();
            if(_oExportSC==null || _oExportSC.ExportSCID<=0)
            {
                alert("without save can't Approve!");
                return false;
            }
            //if(_oExportSC.IsRevisePI==false)
            //{
            //    alert("Sorry, Already Approved");
            //    return false;
            //}
            //if(parseInt(_oExportSC.BUID)!=0)
            //{
            //    alert("Select Business unit");
            //    return false;
            //}
            RefreshSummary();

            if (!confirm("Confirm to Approve?")) return ;
            debugger;
            if(!ValidateInput()) return;
            var oExportSC=RefreshObject();

            $.icsSave({
                BaseAddress: _sBaseAddress,
                Object: oExportSC,
                ObjectId: oExportSC.ExportSCID,
                ControllerName: "ExportSC",
                ActionName: "Save_UP",
                TableId: "",
                IsWinClose: false,
                Message: "Data Saved Successfully."

            },function (response){
                if(response.status && response.obj!=null){
                    if(response.obj.ExportSCID>0){
                        var oExportSC =response.obj;
                        var oExportSCs =sessionStorage.getItem("ExportSCs");
                        var nIndex= parseInt(sessionStorage.getItem("SelectedRowIndex"));
                        debugger;
                        if(oExportSCs!=null)
                        {
                            oExportSCs = jQuery.parseJSON(oExportSCs);
                        }
                        else
                        {
                            oExportSCs=[];
                        }
                        if(nIndex!=-1)
                        {
                            oExportSCs[nIndex]=oExportSC;
                        }
                        else
                        {
                            sessionStorage.setItem("SelectedRowIndex", oExportSCs.length);
                            oExportSCs.push(oExportSC);
                        }
                        sessionStorage.setItem("ExportSCs", JSON.stringify(oExportSCs));
                        window.location.href =_sBackLink; //_sBaseAddress+ "/ExportSC/ViewExportSCs?menuid="+_nMenuid;
                    }
                }
            });

        });

        $("#btnSaveServiseCon").click(function(){
            debugger;
            endEditing();
            RefreshSummary();
            if(!ValidateInput()) return false;

            var oExportSC=RefreshObject();
            if(oExportSC.ExportSCID<=0)
            {
                alert("Please First Save Sales Contract");
                return ;
            }

            $.icsSave({
                BaseAddress: _sBaseAddress,
                Object: oExportSC,
                ObjectId: oExportSC.ExportSCID,
                ControllerName: "ImportPI",
                ActionName: "SaveAuto_ServisePI",
                TableId: "",
                IsWinClose: false,
                Message: "Data Saved Successfully."

            },function (response){
                if(response.status && response.obj!=null){
                    if(response.obj.ExportSCID>0){
                        var oExportSC =response.obj;
                        var oExportSCs =sessionStorage.getItem("ExportSCs");
                        var nIndex= parseInt(sessionStorage.getItem("SelectedRowIndex"));
                        debugger;
                        if(oExportSCs!=null)
                        {
                            oExportSCs = jQuery.parseJSON(oExportSCs);
                        }
                        else
                        {
                            oExportSCs=[];
                        }
                        if(nIndex!=-1)
                        {
                            oExportSCs[nIndex]=oExportSC;
                        }
                        else
                        {
                            sessionStorage.setItem("SelectedRowIndex", oExportSCs.length);
                            oExportSCs.push(oExportSC);
                        }
                        sessionStorage.setItem("ExportSCs", JSON.stringify(oExportSCs));
                        //window.location.href =_sBackLink; //_sBaseAddress+ "/ExportSC/ViewExportSCs?menuid="+_nMenuid;
                    }
                }
            });

        });

        $("#btnClose,#btnCloseAdjustment,#btnCloseTerms,#btnClosePITrans").click(function(){
            window.location.href =_sBackLink;// _sBaseAddress+ "/ExportSC/ViewExportSCs?menuid="+_nMenuid;
        });


        /////////////End /////////////////////


        /////End

        //////////// Detail ////////
        var editIndex = undefined;
        function endEditing() {
            if (editIndex == undefined) { return true }
            if ($('#tblSCDetails').datagrid('validateRow', editIndex)) {
                $('#tblSCDetails').datagrid('endEdit', editIndex);
                $('#tblSCDetails').datagrid('selectRow', editIndex);
                var oESCDetail = $('#tblSCDetails').datagrid('getSelected');
                debugger;
                if(oESCDetail!=null)
                {
                    oESCDetail.Amount=parseFloat(oESCDetail.Qty* oESCDetail.UnitPrice);
                    oESCDetail.AmountSt=_oExportSC.Currency+''+(oESCDetail.Qty* oESCDetail.UnitPrice);
                    $('#tblSCDetails').datagrid('updateRow', { index: editIndex, row: oESCDetail });
                }
                RefreshSummary();
                editIndex = undefined;
                return true;
            }
            else {
                return false;
            }
        }

        function onClickRow(index) {

            if (editIndex != index) {
                if (endEditing()) {
                    $('#tblSCDetails').datagrid('selectRow', index).datagrid('beginEdit', index);
                    var oPRDetail= $('#tblSCDetails').datagrid('getSelected');

                    editIndex = index;
                }
                else {
                    $('#tblSCDetails').datagrid('selectRow', editIndex);
                }
            }
        }


        function IsExist(nProductID)
        {
            var oPRDetails = $('#tblSCDetails').datagrid('getRows');

                for (var i = 0; i < oPRDetails.length; i++) {
                    if (parseInt(oPRDetails[i].ProductID) == parseInt(nProductID))
                    {
                        return true;
                    }
                }

            return false;
        }

        //Product Part
        $("#txtProductName").keydown(function (e) {
            debugger;
            var code = (e.keyCode ? e.keyCode : e.which);

            if (code == 13) // Enter Press
            {
                if(parseInt($("#cboProductionType").val())<=0)
                {
                    alert("Invalid Selection!!! please select a valid Type!");
                    $('#cboProductionType').focus();
                    return ;
                }

                var oProduct = { BUID:sessionStorage.getItem("BUID"),ProductName:$('#txtProductName').val()};
                var obj = {
                    BaseAddress: _sBaseAddress,
                    Object: oProduct,
                    ControllerName: "Product",
                    ActionName: "SearchByProductBUWise",
                    IsWinClose: false
                };


                $.icsDataGets(obj, function (response) {
                    debugger;
                    if (response.status && response.objs.length > 0)
                    {
                        if (response.objs[0].ProductID > 0) {
                            var tblColums = [];var oColumn ={};
                            oColumn= { field: "ProductCode", title: "Code", width: 100, align: "left" }; tblColums.push(oColumn);
                            oColumn = { field: "ProductName", title: "Item Name", width: 350, align: "left" }; tblColums.push(oColumn);

                            var oPickerParam = {
                                winid: 'winProductPicker',
                                winclass: 'clsProductPicker',
                                winwidth: 600,
                                winheight: 460,
                                tableid: 'tblProductPicker',
                                tablecolumns: tblColums,
                                datalist: response.objs,
                                multiplereturn: true,
                                searchingbyfieldName: 'NameCode',
                                windowTittle: 'Product List'
                            };
                            $.icsPicker(oPickerParam);
                            IntializePickerbutton(oPickerParam);//multiple return
                        }
                        else {
                            alert("Data Not Found");
                            return;
                        }

                    }
                    else
                    {
                        alert("Data Not Found");
                        return;

                    }
                });
            }
            if (code == 8) //backspace=8
            {
                var txtProductName = document.getElementById("txtProductName");
                txtProductName.value = '';
                txtProductName.style.color = "black";
                txtProductName.style.fontWeight = "normal";

            }
        });
        //Load for button click
        $("#btnProductPick").click(function () {
            if(parseInt($("#cboProductionType").val())<=0)
            {
                alert("Invalid Selection!!! please select a valid Type!");
                $('#cboProductionType').focus();
                return ;
            }
            var oProduct = { BUID:sessionStorage.getItem("BUID"),ProductName:$('#txtProductName').val()};
            var obj = {
                BaseAddress: _sBaseAddress,
                Object: oProduct,
                ControllerName: "Product",
                ActionName: "SearchByProductBUWise",
                IsWinClose: false
            };

            $.icsDataGets(obj, function (response) {
                debugger;
                if (response.status && response.objs.length > 0)
                {
                    if (response.objs[0].ProductID > 0) {
                        var tblColums = [];var oColumn ={};
                            oColumn= { field: "ProductCode", title: "Code", width: 100, align: "left" }; tblColums.push(oColumn);
                            oColumn = { field: "ProductName", title: "Item Name", width: 350, align: "left" }; tblColums.push(oColumn);


                        var oPickerParam = {
                            winid: 'winProductPicker',
                            winclass: 'clsProductPicker',
                            winwidth: 600,
                            winheight: 460,
                            tableid: 'tblProductPicker',
                            tablecolumns: tblColums,
                            datalist: response.objs,
                            multiplereturn: true,
                            searchingbyfieldName: 'NameCode',
                            windowTittle: 'Product List'
                        };
                        $.icsPicker(oPickerParam);
                        IntializePickerbutton(oPickerParam);//multiple return
                    }
                    else {
                        alert("Data Not Found");
                        return;
                    }

                }
                else{
                    alert("Data Not Found");
                    return;
                }
            });

        });

        function IntializePickerbutton(oPickerobj) {
            debugger;
            $("#" + oPickerobj.winid).find("#btnOk").click(function () {
                debugger;
                //for Single Select
                SetPickerValueAssign(oPickerobj);
            });
            $(document).find('.' + oPickerobj.winclass).keydown(function (e) {
                if (e.which == 13)//enter=13
                {
                    SetPickerValueAssign(oPickerobj);

                }
            });
        }
        function SetPickerValueAssign(oPickerobj) {
            var oreturnObj = null, oreturnobjs = [];
            if (oPickerobj.multiplereturn) {
                oreturnobjs = $('#' + oPickerobj.tableid).datagrid('getChecked');
            } else {
                oreturnObj = $('#' + oPickerobj.tableid).datagrid('getSelected');
            }
            $("#" + oPickerobj.winid).icsWindow("close");
            $("#" + oPickerobj.winid).remove();
            if (oPickerobj.winid == 'winProductPicker')
            {
                debugger;

                if (oreturnobjs!=null && oreturnobjs.length > 0) {
                    $("#txtProductName").val(oreturnobjs.length+' item(s) selected');
                    $("#txtProductName").addClass('fontColorOfPickItem');

                    ProductMapping(oreturnobjs);
                }
            }
            else if (oPickerobj.winid == 'winBuyers') {
                if (oreturnObj != null && oreturnObj.ContractorID > 0) {
                    var oContractor = oreturnObj;
                    $('#txtBuyerName').val(oContractor.Name);
                    $("#txtBuyerName").addClass("fontColorOfPickItem");
                    _oExportSC.BuyerID = oContractor.ContractorID;
                    //alert(_oExportSC.BuyerID);
                    //GetContactPerson(_oExportPI.BuyerID,true);
                }
                else {
                    alert("Please select a buyer.");
                    return false;
                }
            }
            else if (oPickerobj.winid == 'winExportPIs') {
                if (oreturnObj != null && oreturnObj.ExportPIID > 0) {
                    $('#txtExportPINoFrom').val(oreturnObj.PINo_Full);
                    $("#txtExportPINoFrom").addClass("fontColorOfPickItem");
                    _nExportPIID = oreturnObj.ExportPIID;
                    //alert(_oExportSC.BuyerID);
                    //GetContactPerson(_oExportPI.BuyerID,true);
                }
                else {
                    alert("Please select a buyer.");
                    return false;
                }
            }
            else if (oPickerobj.winid == 'winProductionTypePicker')
            {
                debugger;

                if (oreturnObj!=null) {
                    var oESCDetail = $('#tblSCDetails').datagrid('getSelected');
                    if (oESCDetail == null) {
                        alert("Invalid Selection!!! please select a valid Item!");
                        return ;
                    }
                    oESCDetail.ProductionType=parseInt($("#cboPaymentType").val()),
                    oESCDetail.ProductionTypeST=$("#cboPaymentType").Te()

                    $('#tblSCDetails').datagrid('updateRow', { index: editIndex, row: oESCDetail });
                }
            }
        }
        function ProductMapping(oProducts)
        {
            debugger;
            var bExists=false;
            var oESCDetail=null;
            //alert(oProducts.length);
            var ncboPaymentType = document.getElementById("cboProductionType");
            if(parseInt($("#cboProductionType").val())<=0)
            {
                alert("Invalid Selection!!! please select a valid Type!");
                $('#cboProductionType').focus();
                return ;
            }
            var selectedText = ncboPaymentType.options[ncboPaymentType.selectedIndex].text;
            for (i=0; i<oProducts.length;i++)
            {
                oESCDetail={ ExportSCDetailID: 0,
                    ProductID:oProducts[i].ProductID,
                    ProductCode :oProducts[i].ProductCode,
                    ProductName:oProducts[i].ProductName,
                    MUnitID :oProducts[i].MeasurementUnitID,
                    MUName :oProducts[i].MUnit,
                    Qty:0,
                    UnitPrice:0,
                    Amount:0,
                    AmountSt:_oExportSC.Currency+''+(0),
                    ProductionType:parseInt($("#cboProductionType").val()),
                    ProductionTypeST:selectedText,
                };

                //var bExists= IsExist(oProducts[i].ProductID)
                //if(!bExists)
                //{
                    $('#tblSCDetails').datagrid('appendRow',oESCDetail);
                //}

            }


        }
        function RefreshSummary()
        {
            debugger;
            var oESCDetails = $('#tblSCDetails').datagrid('getRows');
            var nTotalQty = 0;
            var nBalancePI = 0;
            _nTotalAmount=0;
            for(var i = 0; i<oESCDetails.length;i++)
            {
                nTotalQty+=parseFloat(oESCDetails[i].Qty);
                _nTotalAmount+=parseFloat(oESCDetails[i].Amount);
            }
            nBalancePI=(_oExportSC.Amount_PI-_oExportSC.AmountToBeAdjusted-_nTotalAmount);
            if(nBalancePI>0)
            {
                $(".lblBalanceText").html("Due Convert: ");
            }
            else{
                nBalancePI=(-1)*nBalancePI;
                $(".lblBalanceText").html(" Over Converted: ");
            }
            document.getElementById('lblTotalQty').innerHTML = formatPrice(nTotalQty,0);
            document.getElementById('lblTotalAmount').innerHTML = _oExportSC.Currency+''+formatPrice(_nTotalAmount,0);
            document.getElementById('lblBalancePI').innerHTML = _oExportSC.Currency+''+formatPrice( nBalancePI,0);
        }
        function RefreshSummary_Inv()
        {
            var oDyeingOrders = $('#tblDyeingOrder').datagrid('getRows');
            var nTotalInvAmount = 0;
            for(var i = 0; i<oDyeingOrders.length;i++)
            {
                nTotalInvAmount+=parseFloat(oDyeingOrders[i].Amount);
            }
            document.getElementById('lblTotalInvoiceAmount').innerHTML = _oExportSC.Currency+''+formatPrice(nTotalInvAmount,0);
        }

        $("#btnDeleteDetail").click(function () {
            var oESCDetails = $('#tblSCDetails').datagrid('getSelected');
            if (oESCDetails == null) {
                alert("Invalid Selection!!! please select a valid Item!");
                return false;
            }
            if (!confirm("Confirm to Remove?")) return;
            var SelectedRowIndex = $('#tblSCDetails').datagrid('getRowIndex', oESCDetails);
            $('#tblSCDetails').datagrid('deleteRow',SelectedRowIndex);
            RefreshSummary();

            editIndex = undefined;
        });
        $("#btnRefresh").click(function () {
            endEditing();
            //RefreshSummary();
        });

        $("#btnUpdatePType").click(function () {
            debugger;
            var oESCDetail = $('#tblSCDetails').datagrid('getSelected');
            if (oESCDetail == null || oESCDetail.ExportSCDetailID<=0) {
                alert("Invalid Selection!!! please select a valid Item!");
                return false;
            }

            if(parseInt($("#cboProductionType").val())<=0)
            {
                alert("Invalid Selection!!! please select a valid Type!");
                $('#cboProductionType').focus();
                return ;
            }
            if(oESCDetail.POQty>0)
            {
                alert("Invalid Operation!!! Production Order already issue. You can't change it!");
                $('#cboProductionType').focus();
                return ;
            }
            var SelectedRowIndex=$('#tblSCDetails').datagrid('getRowIndex',oESCDetail);
            var ncboPaymentType = document.getElementById("cboProductionType");
            var selectedText = ncboPaymentType.options[ncboPaymentType.selectedIndex].text;
            oESCDetail.ProductionType=parseInt($("#cboProductionType").val());
            oESCDetail.ProductionTypeST=selectedText;
            $('#tblSCDetails').datagrid('updateRow', { index: SelectedRowIndex, row: oESCDetail });
        });
        /*--------------------- Adjustment Settle---------------------*/
        function GetDyeingOrderIDs(){
            var oDyeingOrders=$('#tblDyeingOrder').datagrid('getRows');
            var sIds="";
            if(oDyeingOrders.length>0){
                for(var i=0;i<oDyeingOrders.length;i++){
                    sIds=sIds+oDyeingOrders[i].DyeingOrderID+",";
                }
                sIds=sIds.substring(0,sIds.length-1);
            }
            return sIds;
        }

        $("#btnResetDyeingOrder").click(function () {

            $("#txtSampleInvoice").val("");
        });

        $("#btnPickDyeingOrder").click(function () {

            var sSampleInvoiceNo=$.trim($("#txtSampleInvoice").val());
            GetDyeingOrders(sSampleInvoiceNo);
        });

        $("#txtSampleInvoice").keydown(function (e) {
            var nkeyCode = e.keyCode || e.which;
            if(nkeyCode==13){
                var sSampleInvoiceNo=$.trim($("#txtSampleInvoice").val());
                GetDyeingOrders(sSampleInvoiceNo);
            }
            else if(nkeyCode==8){
                $("#txtSampleInvoice").val("");
            }
        });

        function GetDyeingOrders(sSampleInvoiceNo){

            var oDyeingOrder = {
                SampleInvocieNo: sSampleInvoiceNo,
                ContractorID:_oExportSC.ContractorID,
                Params: GetDyeingOrderIDs()
            };
            var obj = {
                BaseAddress: _sBaseAddress,
                Object: oDyeingOrder,
                ControllerName: "DyeingOrder",
                ActionName: "GetsDyeingOrderByInvoice",
                IsWinClose: false
            };

            $.icsDataGets(obj, function (response) {

                if (response.status && response.objs.length > 0) {
                    if (response.objs[0].DyeingOrderID > 0) {
                        debugger;
                        var tblColums = [];
                        var oColumn = { field: "OrderNo", title: "Order No", width: 85, align: "left" };tblColums.push(oColumn);
                        oColumn = { field: "SampleInvocieNo", title: "invoice No", width: 85, align: "left" };tblColums.push(oColumn);
                        oColumn = { field: "Qty", title: "TotalQty", width: 70, align: "right", formatter:formatPrice };tblColums.push(oColumn);
                        oColumn = { field: "Amount", title: "Amount", width: 90, align: "right", formatter:formatPrice };tblColums.push(oColumn);

                        var oPickerParam = {
                            winid: 'winDyeingOrder',
                            winclass:'clsDyeingOrder',
                            winwidth: 450,
                            winheight: 460,
                            tableid: 'tblDyeingOrderPicker',
                            tablecolumns: tblColums,
                            datalist: response.objs,
                            multiplereturn: true,
                            searchingbyfieldName:'OrderNo',
                            windowTittle: 'Dyeing Order List'
                        };
                        $.icsPicker(oPickerParam);
                        IntializeDyeingOrderPickerbutton(oPickerParam);//multiplereturn, winclassName
                    }
                    else { alert(response.objs[0].ErrorMessage); }
                }
                else{
                    alert("No dyeing order found.");
                }
            });


        }

        function IntializeDyeingOrderPickerbutton(oPickerobj)
        {
            $("#" + oPickerobj.winid).find("#btnOk").click(function () {
                DyeingOrderSelect(oPickerobj);
            });
            $(document).find('.' +oPickerobj.winclass).keydown(function (e) {
                if (e.which == 13)//enter=13
                {
                    DyeingOrderSelect(oPickerobj);
                }
            });
        }

        function DyeingOrderSelect(oPickerobj){
            var oDyeingOrders = $('#'+oPickerobj.tableid).datagrid('getChecked');
            if (oPickerobj.winid == 'winDyeingOrder')
            {
                debugger;
                if(oDyeingOrders.length>0 && oDyeingOrders[0].DyeingOrderID>0){
                    $("#"+oPickerobj.winid).icsWindow("close");
                    $("#" + oPickerobj.winid).remove();

                    //for(var i=0;i<oDyeingOrders.length;i++){
                    //    _oDyeingOrders.push(oDyeingOrders[i]);
                    //}
                    //RefreshControlAdjSettle();

                    UpdateDyeingOrder(oDyeingOrders);
                }
                else{
                    alert("Please select order.");
                }
            }
        }

        function UpdateDyeingOrder(oDyeingOrders)
        {
            var sIds='';
            for(var i=0;i<oDyeingOrders.length;i++){
                sIds=sIds+oDyeingOrders[i].DyeingOrderID+",";
            }
            sIds=sIds.substring(0,sIds.length-1);


            var oDyeingOrder={
                DyeingOrderID:0,
                Params: sIds+'~'+_oExportSC.ExportPIID
            }


                $.ajax({
                    type: "POST",
                    dataType: "json",
                    url: _sBaseAddress + "/DyeingOrder/SaveDyeingOrderAdjustmentForExportPI",
                    traditional: true,
                    data: JSON.stringify(oDyeingOrder),
                    contentType: "application/json; charset=utf-8",
                    success: function (data) {
                        var oDyeingOrder = jQuery.parseJSON(data);
                        if (oDyeingOrder.DyeingOrders[0].ErrorMessage==""||oDyeingOrder.DyeingOrders[0].ErrorMessage==null)
                        {
                            alert("Data Saved sucessfully");
                            for (i = 0; i < oDyeingOrders.length; ++i)
                            {
                                $('#tblDyeingOrder').datagrid('appendRow',oDyeingOrders[i]);
                            }
                            RefreshSummary_Inv();
                            RefreshControlAdjSettle();
                        }
                        else {
                            alert(oDyeingOrder.DyeingOrders[0].ErrorMessage);
                        }
                    },
                    error: function (xhr, status, error) {
                        alert(error);
                    }
                });


        }

        $("#btnSaveAdjustment").click(function(){
            debugger;
            var DyeingOrderIDs=GetDyeingOrderIDs();

            if(DyeingOrderIDs.trim()==""){
                alert("No item found for adjustment."); return false;
            }

            var oDyeingOrder={
                DyeingOrderID:0,
                Params: DyeingOrderIDs+'~'+_oExportSC.ExportPIID
            }

            $.icsSave({
                BaseAddress: _sBaseAddress,
                Object: oDyeingOrder,
                ObjectId: oDyeingOrder.DyeingOrderID,
                ControllerName: "DyeingOrder",
                ActionName: "SaveDyeingOrderAdjustmentForExportPI",
                TableId: "",
                IsWinClose: false,
                Message: "Data Saved Successfully."

            },function (response){
                if(response.status && response.obj!=null){
                    debugger;
                    if(response.obj.DyeingOrders.length>0){

                        if(response.obj.DyeingOrders[0].DyeingOrderID>0){

                            DynamicRefreshList(response.obj.DyeingOrders, "tblDyeingOrder");

                        }
                        else{
                            alert(response.obj.DyeingOrders[0].ErrorMessage);
                        }
                        RefreshControlAdjSettle();

                    }
                    else{
                        alert("Unable to adjust. Please refresh & try again.");
                    }
                }
            });

        });

        $('#btnDeleteDyeingOrder').click(function(e){

            var oDyeingOrder=$('#tblDyeingOrder').datagrid('getSelected');

            if(oDyeingOrder==null && oDyeingOrder.DyeingOrderID<=0){
                alert("Please select an item to delete."); return false;
            }
            if(oDyeingOrder.DyeingOrderID<=0){
                alert("This is Adjustment Invoice, Please delete Sample adjustment Note."); return false;
            }
            var nIndex=$('#tblDyeingOrder').datagrid('getRowIndex',oDyeingOrder);
            if(oDyeingOrder.ExportPIID>0)
            {

                if(!confirm("Are you sure to delete.")) return false;

                var obj =
               {
                   BaseAddress: _sBaseAddress,
                   Object: oDyeingOrder,
                   ControllerName: "DyeingOrder",
                   ActionName: "DeleteDyeingOrderAdjustmentForExportPI",
                   TableId: "tblDyeingOrder",
                   IsWinClose: false
               };

                $.icsDelete(obj, function (response) {
                    if (response.status && response.Message=='deleted')
                    {
                        debugger;
                        $("#tblDyeingOrder").datagrid("deleteRow", nIndex);
                        _oDyeingOrders=$('#tblDyeingOrder').datagrid('getRows');
                        RefreshControlAdjSettle();
                        RefreshSummary_Inv();
                    }
                });
            }
            else{

                $("#tblDyeingOrder").datagrid("deleteRow", nIndex);
                RefreshControlAdjSettle();

            }

        });

        $("#btnPrintPreview").click(function() {

            if(_oExportSC==null || _oExportSC.ExportSCID<=0)
            {
                alert("Please select a item from list!");
                return;
            }
            var nts = ((new Date()).getTime()) / 1000;
            window.open(_sBaseAddress + '/ExportSCDO/PrintStatement_DOBalance?nExportSCID=' + parseInt(_oExportSC.ExportSCID) + "&nDOID=" + parseInt(0) + "&nProductID=" + parseInt(0) + "&nts=" + nts, "_blank");
        });

        function RefreshProductionControl() {
            debugger;
            document.getElementById("chkPIIssue_Pro").checked = false;
            document.getElementById("chkLCOpen_Pro").checked = false;
            document.getElementById("chkBillAcceptance_Pro").checked = false;
            document.getElementById("chkUDReceive_Pro").checked = false;
            document.getElementById("chkBillMaturity_Pro").checked = false;
            if(_oExportSC.Production_ControlBy==1)
            {
                document.getElementById("chkPIIssue_Pro").checked = true;
            }
            if(_oExportSC.Production_ControlBy==2)
            {
                document.getElementById("chkLCOpen_Pro").checked = true;
            }
            if(_oExportSC.Production_ControlBy==3)
            {
                document.getElementById("chkBillAcceptance_Pro").checked = true;
            }
            if(_oExportSC.Production_ControlBy==4)
            {
                document.getElementById("chkUDReceive_Pro").checked = true;
            }
            if(_oExportSC.Production_ControlBy==5)
            {
                document.getElementById("chkBillMaturity_Pro").checked = true;
            }
        }
        function IsPIIssue_Pro() {
            debugger;
            _oExportSC.Production_ControlBy=0;
            if(document.getElementById("chkPIIssue_Pro").checked)
            {
                _oExportSC.Production_ControlBy=1;
            }
            RefreshProductionControl();
        }
        function IsLCOpen_Pro() {
            debugger;
            if(document.getElementById("chkLCOpen_Pro").checked)
            {
                _oExportSC.Production_ControlBy=2;
            }
            RefreshProductionControl();
        }
        function IsBillAcceptance_Pro() {
           if(document.getElementById("chkBillAcceptance_Pro").checked)
            {
                _oExportSC.Production_ControlBy=3;
            }
            RefreshProductionControl();
        }
        function IsUDReceive_Pro() {
            if(document.getElementById("chkUDReceive_Pro").checked)
            {
                _oExportSC.Production_ControlBy=4;
            }
            RefreshProductionControl();
        }
        function IsBillMaturity_Pro() {
            if(document.getElementById("chkBillMaturity_Pro").checked)
            {
                _oExportSC.Production_ControlBy=5;
            }
            RefreshProductionControl();
        }
        ///
        function RefreshDeliveryControl() {

            document.getElementById("chkPIIssue_Del").checked = false;
            document.getElementById("chkLCOpen_Del").checked = false;
            document.getElementById("chkBillAcceptance_Del").checked = false;
            document.getElementById("chkUDReceive_Del").checked = false;
            document.getElementById("chkBillMaturity_Del").checked = false;
            if(_oExportSC.Delivery_ControlBy==1)
            {
                document.getElementById("chkPIIssue_Del").checked = true;
            }
            if(_oExportSC.Delivery_ControlBy==2)
            {
                document.getElementById("chkLCOpen_Del").checked = true;
            }
            if(_oExportSC.Delivery_ControlBy==3)
            {
                document.getElementById("chkBillAcceptance_Del").checked = true;
            }
            if(_oExportSC.Delivery_ControlBy==4)
            {
                document.getElementById("chkUDReceive_Del").checked = true;
            }
            if(_oExportSC.Delivery_ControlBy==5)
            {
                document.getElementById("chkBillMaturity_Del").checked = true;
            }
        }
        function IsPIIssue_Del() {
            debugger;
            _oExportSC.Delivery_ControlBy=0;
            if(document.getElementById("chkPIIssue_Del").checked)
            {
                _oExportSC.Delivery_ControlBy=1;
            }
            RefreshDeliveryControl();
        }
        function IsLCOpen_Del() {
            debugger;
            if(document.getElementById("chkLCOpen_Del").checked)
            {
                _oExportSC.Delivery_ControlBy=2;
            }
            RefreshDeliveryControl();
        }
        function IsBillAcceptance_Del() {
            if(document.getElementById("chkBillAcceptance_Del").checked)
            {
                _oExportSC.Delivery_ControlBy=3;
            }
            RefreshDeliveryControl();
        }
        function IsUDReceive_Del() {
            if(document.getElementById("chkUDReceive_Del").checked)
            {
                _oExportSC.Delivery_ControlBy=4;
            }
            RefreshDeliveryControl();
        }
        function IsBillMaturity_Del() {
            if(document.getElementById("chkBillMaturity_Del").checked)
            {
                _oExportSC.Delivery_ControlBy=5;
            }
            RefreshDeliveryControl();
        }

        $("#btnSaveTerms").click(function(){
            debugger;
            //endEditing();
            //RefreshSummary();
           // if(!ValidateInput()) return false;

            if (_oExportSC.ExportSCID<=0 || _oExportSC==null)
            {
                alert("Please Select a valid Sales Contract.");
                return ;
            }

            //if (_oExportSC.LCID>0)
            //{
            //    alert("Already L/C Received. You Can't Change it.");
            //    return ;
            //}

            var oExportSC= {
                ExportSCID :_oExportSC.ExportSCID,
                ExportPIID :_oExportSC.ExportPIID,
                Production_ControlBy:_oExportSC.Production_ControlBy,
                Delivery_ControlBy:_oExportSC.Delivery_ControlBy,
                RateAdjConID:$("#cboContractor_Rate").val(),
                QtyAdjConID:$("#cboContractor_Qty").val(),
                DicChargeAdjConID:$("#cboContractor_DocCharge").val(),

            };

            $.icsSave({
                BaseAddress: _sBaseAddress,
                Object: oExportSC,
                ObjectId: oExportSC.ExportSCID,
                ControllerName: "ExportSC",
                ActionName: "UpdateExportSC",
                TableId: "",
                IsWinClose: false,
                Message: "Data Saved Successfully."

            },function (response){
                if(response.status && response.obj!=null){
                    if(response.obj.ExportSCID>0){
                        var oExportSC =response.obj;
                        var oExportSCs =sessionStorage.getItem("ExportSCs");
                        var nIndex= parseInt(sessionStorage.getItem("SelectedRowIndex"));
                        debugger;
                        if(oExportSCs!=null)
                        {
                            oExportSCs = jQuery.parseJSON(oExportSCs);
                        }
                        else
                        {
                            oExportSCs=[];
                        }
                        if(nIndex!=-1)
                        {
                            oExportSCs[nIndex]=oExportSC;
                        }
                        else
                        {
                            sessionStorage.setItem("SelectedRowIndex", oExportSCs.length);
                            oExportSCs.push(oExportSC);
                        }
                        sessionStorage.setItem("ExportSCs", JSON.stringify(oExportSCs));
                       // window.location.href =_sBackLink; //_sBaseAddress+ "/ExportSC/ViewExportSCs?menuid="+_nMenuid;
                    }
                }
            });

        });
        function RefreshAdjustmentDistribution()
        {
            debugger;
            var nQty=0, nAmount=0, nAdjQty=0, nAdjValue_Rate=0, nAdjValue_DocCharge=0, nActualAmount=0;
            for(var i=0; i<_oExportPIDetails.length;i++){
                nQty=parseFloat(nQty)+ parseFloat(_oExportPIDetails[i].Qty);
                nAmount=parseFloat(nAmount)+ parseFloat(_oExportPIDetails[i].Amount);
                nAdjQty=parseFloat(nAdjQty)+ parseFloat(_oExportPIDetails[i].AdjQty*(parseFloat(_oExportPIDetails[i].UnitPrice)-parseFloat(_oExportPIDetails[i].AdjRate)));

                //nAdjValue=parseFloat(nAdjValue)+ parseFloat(_oExportPIDetails[i].AdjValue);
                nAdjValue_Rate=parseFloat(nAdjValue_Rate)+ parseFloat((_oExportPIDetails[i].Qty)*_oExportPIDetails[i].AdjRate);
                nAdjValue_DocCharge=parseFloat(nAdjValue_DocCharge)+ parseFloat((_oExportPIDetails[i].Qty-_oExportPIDetails[i].AdjQty)*_oExportPIDetails[i].DocCharge);
            }

            $("#txtAdj_Rate").val(_oExportSC.Currency+" "+formatPrice(nAdjValue_Rate));
            $("#txtAdj_Qty").val(_oExportSC.Currency+" "+formatPrice(nAdjQty));
            $("#txtAdj_DocCharge").val(_oExportSC.Currency+" "+formatPrice(nAdjValue_DocCharge));

            $('#cboContractor_Rate').empty();
            $('#cboContractor_Qty').empty();
            $('#cboContractor_DocCharge').empty();
            var listDates = "<option value='"+_oExportSC.ContractorID+"'>" + "A/C Of:"+_oExportSC.ContractorName + "</option>";
            listDates+= "<option value='"+_oExportSC.BuyerID+"'>" +"B/H:"+_oExportSC.BuyerName + "</option>";

            $("#cboContractor_Rate").html(listDates);
            $("#cboContractor_Qty").html(listDates);
            $("#cboContractor_DocCharge").html(listDates);

            $("#cboContractor_Rate").val(_oExportSC.RateAdjConID);
            $("#cboContractor_Qty").val(_oExportSC.QtyAdjConID);
            $("#cboContractor_DocCharge").val(_oExportSC.DicChargeAdjConID);

            if(parseFloat(nAdjValue_Rate)<=0)
            {
                $("#rtAdjRate").hide();
                $("#cboContractor_Rate").html(0);
                _oExportSC.RateAdjConID=0;
            }
            if(parseFloat(nAdjQty)<=0)
            {
                $("#rtAdjQty").hide();
                $("#cboContractor_Qty").html(0);
                _oExportSC.QtyAdjConID=0;
            }

            if(parseFloat(nAdjValue_DocCharge)<=0)
            {
                $("#rtAdjDocCharge").hide();
                $("#cboContractor_DocCharge").html(0);
                _oExportSC.DicChargeAdjConID=0;
            }

        }
        function PickBuyerPI() {
            var oContractor = {
                Params: '2' + '~' + $.trim($("#txtBuyerName").val()+'~'+sessionStorage.getItem("BUID"))
            };
            var obj = {
                BaseAddress: _sBaseAddress,
                Object: oContractor,
                ControllerName: "Contractor",
                ActionName: "ContractorSearchByNameType",
                IsWinClose: false
            };
            $("#progressbar").progressbar({ value: 0 });
            $("#progressbarParent").show();
            var intervalID = setInterval(updateProgress, 250);

            $.icsDataGets(obj, function (response) {
                clearInterval(intervalID);
                $("#progressbarParent").hide();
                if (response.status && response.objs.length > 0) {
                    if (response.objs[0].ContractorID > 0) {
                        var tblColums = []; var oColumn = { field: "ContractorID", title: "Code", width: 70, align: "left" }; tblColums.push(oColumn);
                        oColumn = { field: "Name", title: "Name", width: 200, align: "left" }; tblColums.push(oColumn);
                        oColumn = { field: "Address", title: "Address", width: 120, align: "left" }; tblColums.push(oColumn);
                        var oPickerParam = {
                            winid: 'winBuyers',
                            winclass: 'clsBuyers',
                            winwidth: 500,
                            winheight: 460,
                            tableid: 'tblBuyers',
                            tablecolumns: tblColums,
                            datalist: response.objs,
                            multiplereturn: false,
                            searchingbyfieldName: 'Name',
                            windowTittle: 'Buyer List'
                        };
                        $.icsPicker(oPickerParam);
                        IntializePickerbutton(oPickerParam);
                    }
                    else {
                        alert(response.objs[0].ErrorMessage);
                    }
                }
                else {
                    alert("Sorry, No Buyer Found.");
                }
            });
        }

        $("#txtBuyerName").keydown(function (e) {
            if (e.keyCode === 13) // Enter Press
            {
                PickBuyerPI();
            }
            else if (e.keyCode === 08) {
                $("#txtBuyerName").removeClass("fontColorOfPickItem");
                _oExportSC.BuyerID = 0;
            }
        });

        $("#btnPickBuyerPI").click(function () {
            PickBuyerPI();
        });

        $("#txtExportPINoFrom").keydown(function (e) {
            if (e.keyCode === 13) // Enter Press
            {
                PickExportPINo();
            }
            else if (e.keyCode === 08) {
                $("#txtExportPINoFrom").removeClass("fontColorOfPickItem");
               _nExportPIID= 0;
            }
        });

        $("#btnPickExportPINoFrom").click(function () {
            debugger;
            PickExportPINo();
        });
        function PickExportPINo() {

            if($("#txtExportPINoFrom").val()==null || $("#txtExportPINoFrom").val()=='')
            {alert("Type P/I No");
            $("#txtExportPINoFrom").focus()

            }
            var oExportPI = {
                PINo:  $.trim($("#txtExportPINoFrom").val()),
                BUID:sessionStorage.getItem("BUID")
            };
            var obj = {
                BaseAddress: _sBaseAddress,
                Object: oExportPI,
                ControllerName: "ExportPI",
                ActionName: "GetsBySearchKey",
                IsWinClose: false
            };
            $("#progressbar").progressbar({ value: 0 });
            $("#progressbarParent").show();
            var intervalID = setInterval(updateProgress, 250);

            $.icsDataGets(obj, function (response) {
                clearInterval(intervalID);
                $("#progressbarParent").hide();
                if (response.status && response.objs.length > 0) {
                    if (response.objs[0].ExportPIID > 0) {
                        var tblColums = []; var oColumn = { field: "PINo", title: "P/I No", width: 100, align: "left" }; tblColums.push(oColumn);
                        oColumn = { field: "ContractorName", title: "Buyer Name", width: 200, align: "left" }; tblColums.push(oColumn);
                        oColumn = { field: "BuyerName", title: "Buying House", width: 120, align: "left" }; tblColums.push(oColumn);
                        var oPickerParam = {
                            winid: 'winExportPIs',
                            winclass: 'clsExportPIs',
                            winwidth: 500,
                            winheight: 460,
                            tableid: 'tblExportPIs',
                            tablecolumns: tblColums,
                            datalist: response.objs,
                            multiplereturn: false,
                            searchingbyfieldName: 'PINo',
                            windowTittle: 'P/I List'
                        };
                        $.icsPicker(oPickerParam);
                        IntializePickerbutton(oPickerParam);
                    }
                    else {
                        alert(response.objs[0].ErrorMessage);
                    }
                }
                else {
                    alert("Sorry, No Buyer Found.");
                }
            });
        }

        function ChangeExportPIDetail()
        {
            debugger;
            var oExportPIDetail=null;
            var nQty=0;
            var nVal=0;
            var ncboExportPIDetailID= parseInt($('#cboExportPIDetail').val());
            if(ncboExportPIDetailID>0)
            {
                for(var i = 0;i<_oExportPIDetails.length;i++)
                {
                    if(parseInt(ncboExportPIDetailID)===_oExportPIDetails[i].ExportPIDetailID)
                    {
                        oExportPIDetail=_oExportPIDetails[i];
                    }
                }

                var oESCDetails=$("#tblSCDetails").datagrid('getRows');
                for(var i = 0;i<oESCDetails.length;i++)
                {
                    if(parseInt(ncboExportPIDetailID)===oESCDetails[i].ExportPIDetailID)
                    {
                        nQty=nQty+parseFloat(oESCDetails[i].Qty);
                        nVal=nVal+parseFloat(oESCDetails[i].UnitPrice)*parseFloat(oESCDetails[i].Qty);
                    }
                }

                $('#txtQty_PI').val(parseFloat(oExportPIDetail.Qty).toFixed(2));
                $('#txtQty_SC').val(parseFloat(nQty).toFixed(4));
                $('#txtAdjRatePI').val(parseFloat(oExportPIDetail.AdjRate).toFixed(4));
                $('#txtAdjQtyPI').val(parseFloat(oExportPIDetail.AdjQty).toFixed(2));
                $('#txtAdjValuePI').val(parseFloat(oExportPIDetail.AdjValue).toFixed(4));
                $('#txtAmount_PI').val(oExportPIDetail.AmountSt);
                $('#txtAmount_SC').val("$"+nVal);
                $('#txtUP_PI').val("$"+oExportPIDetail.UnitPrice);
                $('#txtBal_Val_SC').val("$"+parseFloat(oExportPIDetail.Amount-nVal).toFixed(2));
            }
        }
        /// Edit Detail
        ////Quality
        $("#btnPickDetail").click(function () {
            debugger;
            $("#cboExportPIDetail").icsLoadCombo({List: _oExportPIDetails,OptionValue: "ExportPIDetailID",DisplayText: "ProductName"});
            _oProduct={ProductID:0,ProductName:"",ProductCode:""}
            $("#winExportSCDetailEdit input").val("");

            var oESCDetail = $('#tblSCDetails').datagrid('getSelected');
            if (oESCDetail == null) {
                alert("Invalid Selection!!! please select a valid Item!");
                return false;
            }

            //$('#txtProduct_Edit').prop('disabled',true);
            _oProduct.ProductID=oESCDetail.ProductID;
            _oProduct.ProductName=oESCDetail.ProductName;
            _oProduct.ProductCode=oESCDetail.ProductCode;
            $('#txtProduct_Edit').val(oESCDetail.ProductName);
            //$("#cboEQuality").val(oESCDetail.ExportQualityID);

            $("#cboExportPIDetail").val(oESCDetail.ExportPIDetailID);
            ChangeExportPIDetail() ;
            $("#cboProductionTypeTwo").val(oESCDetail.ProductionType);

            $('#txtBuyerReference').val(oESCDetail.BuyerRef);
            $('#txtStyleNo').val(oESCDetail.StyleNo);
            $('#txtColorEdit').val(oESCDetail.ColorInfo);

            $('#txtAdjQty').val(parseFloat(oESCDetail.AdjQty).toFixed(4));
            $('#txtAdjRate').val(parseFloat(oESCDetail.AdjRate).toFixed(4));
            $('#txtDocCharge').val(parseFloat(oESCDetail.DocCharge).toFixed(4));
            $('#txtCRate').val(parseFloat(oESCDetail.CRate).toFixed(4));
            $('#txtAdjQty').val(parseFloat(oESCDetail.AdjQty).toFixed(4));
            $('#txtAmount').val("$"+oESCDetail.AmountSt);
            //$('#txtAdjAmount').val("$"+parseFloat(oESCDetail.AdjValue.toFixed(4)));
            //$('#txtCAmount').val("$"+parseFloat(oESCDetail.Qty*oESCDetail.CRate).toFixed(2));

            $('#txtQtyInOne').val(parseFloat(oESCDetail.Qty).toFixed(4));
            $('#txtUnitPriceInOne').val(parseFloat(oESCDetail.UnitPrice).toFixed(4));
            $('#chkIsBuyerYarnYes').prop('checked', !oESCDetail.IsBuyerYarn);
            $('#chkIsBuyerYarnNo').prop('checked', oESCDetail.IsBuyerYarn);
            $('#chkIsBuyerDyesYes').prop('checked', !oESCDetail.IsBuyerDyes);
            $('#chkIsBuyerDyesNo').prop('checked', oESCDetail.IsBuyerDyes);
            $('#chkIsBuyerChemicalYes').prop('checked', !oESCDetail.IsBuyerChemical);
            $('#chkIsBuyerChemicalNo').prop('checked', oESCDetail.IsBuyerChemical);
            $("#cboDyeingType").val(oESCDetail.DyeingType);
            $("#txtBagCount").val(parseInt(oESCDetail.BagCount));



            //ConvertIntoKgs_UnitPrice();
            //ConvertIntoKg_Qty();
            $("#winExportSCDetailEdit").icsWindow("open","Edit");
        });
        $("#btnUpdateEPIDetail").click(function () {
            debugger;
            var oESCDetail = $('#tblSCDetails').datagrid('getSelected');
            if (oESCDetail ==null ) { alert("Please select an item from list."); return ; }
            var nSelectedRowIndex=$('#tblSCDetails').datagrid('getRowIndex',oESCDetail);



            //oESCDetail.ExportQualityID=$("#cboEQuality").val();

            //var ncboQty = document.getElementById("cboEQuality");
            //var selectedText = ncboQty.options[ncboQty.selectedIndex].text;
            //oESCDetail.ExportQualityID=$("#cboEQuality").val();
            oESCDetail.ProductID=_oProduct.ProductID;
            oESCDetail.ProductName=$.trim($('#txtProduct_Edit').val());
            oESCDetail.ProductCode=_oProduct.ProductCode;
            oESCDetail.Qty=parseFloat($('#txtQtyInOne').val()).toFixed(4);
            oESCDetail.UnitPrice=parseFloat($('#txtUnitPriceInOne').val()).toFixed(4);

            //oESCDetail.AdjQty=parseFloat($('#txtAdjQty').val()).toFixed(4);
            //oESCDetail.AdjRate=parseFloat($('#txtAdjRate').val()).toFixed(4);
            //oESCDetail.DocCharge=parseFloat($('#txtDocCharge').val()).toFixed(4);
            //oESCDetail.CRate=parseFloat($('#txtCRate').val()).toFixed(4);

            oESCDetail.Amount=parseFloat(oESCDetail.Qty* oESCDetail.UnitPrice);
            oESCDetail.AmountSt=_oExportSC.Currency+''+(oESCDetail.Qty* oESCDetail.UnitPrice);

            oESCDetail.BuyerRef=$.trim($('#txtBuyerReference').val());
            oESCDetail.StyleNo=$.trim($('#txtStyleNo').val());
            oESCDetail.ColorInfo=$.trim($('#txtColorEdit').val());
            oESCDetail.DyeingType=parseInt($("#cboDyeingType").val());
            oESCDetail.BagCount=$("#txtBagCount").val();
            oESCDetail.IsBuyerYarn= $("#chkIsBuyerYarnNo").is(":checked"),
            oESCDetail.IsBuyerDyes= $("#chkIsBuyerDyesNo").is(":checked"),
            oESCDetail.IsBuyerChemical= $("#chkIsBuyerChemicalNo").is(":checked"),

            //if(oExportPIDetail.ExportPIDetailID>0)
            //{
            //    var obj = {
            //        BaseAddress: _sBaseAddress,
            //        Object: oExportPIDetail,
            //        ObjectId: oExportPIDetail.ExportPIDetailID,
            //        ControllerName: "ExportDocSetup",
            //        ActionName: "UpdateQuality",
            //        TableId: "tblExportPIDetail",
            //        IsWinClose: false
            //    };
            //    $.icsSave(obj);
            //}
            $('#tblSCDetails').datagrid('updateRow', { index: nSelectedRowIndex, row: oESCDetail });
            editIndex=nSelectedRowIndex;
            endEditing();
            $("#winExportSCDetailEdit").icsWindow("close");
            editIndex = undefined;

        });
        $("#btnCloseEPIDetail").click(function () {
            debugger;
            $("#winExportSCDetailEdit").icsWindow("close");

        });

        function IsBuyerYarnYes() {
            $('#chkIsBuyerYarnYes').prop('checked', true);
            $('#chkIsBuyerYarnNo').prop('checked', false);
        }

        function IsBuyerYarnNo() {
            $('#chkIsBuyerYarnYes').prop('checked', false);
            $('#chkIsBuyerYarnNo').prop('checked', true);
        }
        function IsBuyerDyesYes() {
            $('#chkIsBuyerDyesYes').prop('checked', true);
            $('#chkIsBuyerDyesNo').prop('checked', false);
        }
        function IsBuyerDyesNo() {
            $('#chkIsBuyerDyesYes').prop('checked', false);
            $('#chkIsBuyerDyesNo').prop('checked', true);
        }
        function IsBuyerChemicalYes() {
            $('#chkIsBuyerChemicalYes').prop('checked', true);
            $('#chkIsBuyerChemicalNo').prop('checked', false);
        }

        function IsBuyerChemicaleNo() {
            $('#chkIsBuyerChemicalYes').prop('checked', false);
            $('#chkIsBuyerChemicalNo').prop('checked', true);
        }
        function CopyDetail()
        {
            debugger;
            var oESCDetail = $("#tblSCDetails").datagrid("getSelected");
            if (oESCDetail == null) { alert("Please select an item from list!"); return false; }
            if (!confirm("Confirm to copy?")) return false;
            var SelectedRowIndex=$('#tblSCDetails').datagrid('getRowIndex',oESCDetail);

            var oESCDetailNew={
                ExportSCDetailID:0,
                ExportPIDetailID:oESCDetail.ExportPIDetailID,
                ExportSCID: (_oExportSC!=null && _oExportSC.ExportSCID>0)? _oExportSC.ExportSCID:0,
                ProductID:oESCDetail.ProductID,
                Qty: oESCDetail.Qty,
                MUnitID:oESCDetail.MUnitID,
                UnitPrice:oESCDetail.UnitPrice,
                Amount:oESCDetail.Amount,
                ProductCode:oESCDetail.ProductCode,
                ProductName:oESCDetail.ProductName,
                MUName:oESCDetail.MUName,
                Currency:oESCDetail.Currency,
                ProductionType:oESCDetail.ProductionType,
                ProductionTypeST:oESCDetail.ProductionTypeST,
                ColorInfo:oESCDetail.ColorInfo,
                BuyerRef:oESCDetail.BuyerRef,
                StyleNo:oESCDetail.StyleNo,
                POQty:oESCDetail.POQty,
                DOQty:oESCDetail.DOQty,
                ColorID: 0,
                ProductDescription: oESCDetail.ProductDescription,
                ColorQty:0,
                ColorName:oESCDetail.ColorName,
                ModelReferenceName:oESCDetail.ModelReferenceName,
                OrderSheetID:oESCDetail.OrderSheetID,
                ProductDescription:oESCDetail.ProductDescription,
                IsApplySizer:oESCDetail.IsApplySizer,
                SizeName :oESCDetail.SizeName,
                DyeingType :oESCDetail.DyeingType,
                BagCount:oESCDetail.BagCount,
                IsBuyerYarn :oESCDetail.IsBuyerYarn,
                IsBuyerDyes:oESCDetail.IsBuyerDyes,
                IsBuyerChemical:oESCDetail.IsBuyerChemical

            }
            var oESCDetails = $('#tblSCDetails').datagrid('getRows');
            var nLength = oESCDetails.length;
            $('#tblSCDetails').datagrid('appendRow',oESCDetailNew);
            $('#tblSCDetails').datagrid('selectRow', nLength);
            //endEditing();
            //editIndex = undefined;
        }
        $("#btnUpdateBuyer").click(function () {
            debugger;

            if(_oExportSC==null || _oExportSC.ExportSCID<=0)
            {
                alert("Invalid Name!");
                return false;
            }
            if(_oExportSC.ExportPIID<=0)
            {
                alert("PI not found!");
                return false;
            }

           // if(!ValidateInput()) return;
            var oExportSC=RefreshObject();

            if (!confirm("Confirm to Update End Buyer Name?")) return false;

            var obj = {
                BaseAddress: _sBaseAddress,
                Object: oExportSC,
                ObjectId: oExportSC.ExportSCID,
                ControllerName: "ExportSC",
                ActionName: "UpdateBuyer",
                TableId: "",
                IsWinClose: false
            };
            $.icsSave(obj, function (response)
            {
                if (response.status && response.obj != null) {
                    if (response.obj.ExportSCID > 0)
                    {
                        alert("Buyer name changed successfully!");

                    }
                }
            });
        });
        $("#btnUpdateExportPINoFrom").click(function () {
            debugger;

            if(_oExportSC==null || _oExportSC.ExportSCID<=0)
            {
                alert("Invalid Name!");
                return false;
            }
            if(_oExportSC.ExportPIID<=0)
            {
                alert("PI not found!");
                return false;
            }
            if(_nExportPIID<=0)
            {
                alert("PI not found!");
                return false;
            }
            // if(!ValidateInput()) return;

            if (!confirm("Confirm to Transfer all order from PI:"+ $('#txtExportPINoFrom').val()+" to PI: "+_oExportSC.PINo +"?")) return false;

            debugger;
            $.ajax({
                type: "POST",
                dataType: "json",
                url : _sBaseAddress+  "/ExportSC/ExportPIToPIOrderTransfer",
                traditional: true,
                data:  JSON.stringify({nExportPIID_TO: _oExportSC.ExportPIID, nExportPIID_From:_nExportPIID}),
                contentType: "application/json; charset=utf-8",
                success: function (data)
                {
                    //debugger;
                    var oExportSC = jQuery.parseJSON(data);
                    if(oExportSC.ErrorMessage=="")
                    {
                        _oExportSC=oExportSC;
                        RefreshControl();
                    }
                    else{
                        alert(oExportSC.ErrorMessage);
                    }


                },
                error: function (xhr, status, error)
                {
                    alert(error);
                }


            });

        });

    </script>