@{
    ViewBag.Title = "Yarn Receive";
}
<html>

<body>
    @model ESimSol.BusinessObjects.RPT_Dispo

    <div id="winDUFabricSizingPlan" style="width:800px;height:500px" class="easyui-window winstyle" title="Schedule Informations" data-options="modal:true,closed:true,collapsible:false,minimizable:false,maximizable:false,closable:false">
        <div style="padding-left:0px; padding-right:0px; padding-top:2px;">
            <fieldset>
                <legend>Order Info:</legend>
                <div>
                    <table cellpadding="1" cellspacing="1" style="font-size: 12px;width: 100%">
                        <tr>
                            <td style="width:15%;text-align:right;">
                                Dispo No:
                            </td>
                            <td style="width:35%;text-align:left;">
                                <input id="txtOrderNoFSP" class="reset-text" placeholder="" disabled="disabled" style="width:100%" />
                                @*<a id="btnPickOrderNoFSP" href="javascript:void(0)" class="easyui-linkbutton ics-pick" iconcls="icon-pick" plain="true"></a>*@
                            </td>
                            <td style="width:15%;text-align:right;">
                                Buyer Name:
                            </td>
                            <td style="padding-left: 2px;width:35%;text-align:left">
                                <input id="txtBuyerNameFSP" type="text" style="width:100%" disabled="disabled" />
                            </td>
                        </tr>
                        <tr>
                            <td style="width:15%;text-align:right;">
                                Construction:
                            </td>
                            <td style="width:35%;text-align:left;">
                                <input id="txtConstructionFSP" class="reset-text" placeholder="Construction" style="width:100%" disabled="disabled" />
                            </td>
                            <td style="width:15%;text-align:right;">
                                Composition:
                            </td>
                            <td style="padding-left: 2px;width:35%;text-align:left">
                                <input id="txtCompositionFSP" type="text" style="width:100%" disabled="disabled" />
                            </td>
                        </tr>
                        <tr>
                            <td style="width:15%;text-align:right;">
                                Design:
                            </td>
                            <td style="width:35%;text-align:left;">
                                <input id="txtDesignFSP" class="reset-text" style="width:100%" disabled="disabled" />
                            </td>
                            <td style="width:15%;text-align:right;">
                                Req. WarpLength:
                            </td>
                            <td style="padding-left: 2px;width:35%;text-align:left">
                                <input id="txtRequiredWarpLengthFSP" type="text" style="width:100%" disabled="disabled" />
                            </td>
                        </tr>
                    </table>
                </div>
            </fieldset>
        </div>
        <div>
            <fieldset>
                <legend>Schedule Info:</legend>
                <div>
                    <table cellpadding="1" cellspacing="1" style="font-size: 12px;width: 100%">
                        <tr>
                            <td style="width:5%;text-align:right;"></td>
                            <td style="width:10%;text-align:right;">
                                Machine:
                            </td>
                            <td style="padding-left: 0px;width:30%;text-align:left">
                                <input id="txtMachineFSP" style="width: 60% ; font-size: 11px;" placeholder="Search Machine" />
                                <a id="btnPickMachineFSP" href="javascript:void(0)" class="easyui-linkbutton ics-pick" iconcls="icon-pick" plain="true"></a>
                                <a id="btnResetMachineFSP" href="javascript:void(0)" class="easyui-linkbutton ics-pick" iconcls="icon-clear" plain="true"></a>
                            </td>
                            <td colspan="2" style="padding-right: 2px;width:50%;text-align:right;">
                                <div style="float: right; width:100%;">

                                    <span>
                                        <input type="button" id="btnScheduleLastTimeFSP" value="Default Time" style="font-size: 11px;
                                            height: 23px; width: 80px;" />
                                    </span><span>
                                        <input type="button" id="btnCurrenttimeFSP" value="Current Time" style="font-size: 11px;
                                            height: 23px; width: 80px;" />
                                    </span><span>
                                        <input id="tptimeSpinnerFSP" class="easyui-timespinner" style="width: 75px; height:20px; font-size: 11px;" required="required"
                                               data-options="showSeconds:false" />
                                    </span>
                                    <span>
                                        <input type="button" id="btnAddSpinnerTimeFSP" value="Add" style="font-size: 11px;
                                            height: 23px; width: 30px;" />
                                    </span>
                                </div>
                            </td>
                            <td style="width:5%;text-align:right;"></td>
                        </tr>
                        <tr>
                            <td style="width:5%;text-align:right;"></td>
                            <td style="width:10%;text-align:right;">
                                Start Time:
                            </td>
                            <td style="width:30%;">
                                @*<input id="txtStartDate" type="text" class="easyui-datetimebox" style="width:100%" data-options="showSeconds:false" />*@
                                <input id="txtStartDateFSP" style="width:100px;" type="text" class="easyui-datebox" required="required" data-options="formatter:icsdateformat,parser:icsdateparser" />
                                <input id="tpStartTimeFSP" class="easyui-timespinner" style="width:60px;" required="required" />
                            </td>

                            <td style="width:20%;text-align:right;">
                                End Time:
                            </td>
                            <td style="padding-left: 2px;width:30%;">
                                @*<input id="txtEndDate" type="text" class="easyui-datetimebox" style="width:100%" data-options="showSeconds:false" />*@
                                <input id="txtEndDateFSP" style="width:100px;" type="text" class="easyui-datebox" required="required" data-options="formatter:icsdateformat,parser:icsdateparser" />
                                <input id="tpEndTimeFSP" class="easyui-timespinner" style="width:60px;" required="required" />
                            </td>

                            <td style="width:5%;text-align:right;"></td>
                        </tr>

                    </table>

                </div>
            </fieldset>
            <fieldset>
                <legend>Beam Info:</legend>
                <div>
                    <table id="tblFSPDetail" class="easyui-datagrid" style="width:99.95%;height:130px;"
                           data-options="singleSelect: true,fitColumns:false, rownumbers:true, pagination:false, autoRowHeight:false, toolbar: '#toolbarPS',onClickRow:onClickRow ">
                            <thead>
                                <tr>
                                    <th field="BeamName" width="15%" align="left">
                                        Beam
                                    </th>
                                    <th data-options="field:'SizingBeamNo',align:'right',editor:{type:'numberbox',options:{precision:0}}" width="10%"> Szing Beam </th>
                                </tr>
                            </thead>
                        </table>
                    <div>
                        <div id="toolbarPS">
                            <input id="txtBeam" class="reset-text" placeholder="Search by Beam" style="width:20%" />
                            <a id="btnPickBeam" href="javascript:void(0)" class="easyui-linkbutton ics-pick" iconcls="icon-pick" plain="true"></a>
                            <a id="btnResetBeam" href="javascript:void(0)" class="easyui-linkbutton ics-pick" iconcls="icon-clear" plain="true"></a>
                            <a id="btnDeleteDetail" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-remove" plain="true">Remove</a>
                        </div>

                    </div>
                </div>
                <div>
                    <table style="font-size: 12px;width: 100%">
                        <tr>
                            <td style="width:10%;text-align:right;">
                                Remarks:
                            </td>
                            <td colspan="5" style="width:90%;">
                                <input id="txtNoteFSP" class="reset-text" style="width:99%;" placeholder="Remarks.." />
                            </td>
                        </tr>
                    </table>

                </div>
            </fieldset>
        </div>

        <fieldset class="actionfieldsetstyle">
            <legend>Actions : </legend>
            <table border="0" cellspacing="2" cellpadding="2" style="width:100%; font-size:11px; font-weight:bold;">
                <tr>
                    <td style="width:60%;text-align:left;">
                        @*<a id="btnDelete" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-remove" plain="true">Delete</a>
                            <a id="btnSaveRS" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-save" plain="true" style=" height:22px;">Dyeing Card</a>
                            <a id="btnCut" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-cut" plain="true" style=" height:22px;">Cut</a>
                            <a id="btnPaste1" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-paste" plain="true" style=" height:22px;">Paste</a>

                            <select style="width:25%" id="cboScheduleStatus">
                                <option value="">--Select Status--</option>
                            </select>
                            <a id="btnUpdateStatus" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-ok" plain="true" style=" height:22px;">Update</a>*@
                    </td>
                    <td style="width:40%;text-align:right;">
                        <a id="btnSave" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-save" plain="true" style=" height:22px;" onclick="SaveFSP(false)">Save</a>
                        <a id="btnCloseFSP" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-cancel" plain="true">Close</a>
                    </td>
                </tr>
            </table>
        </fieldset>
    </div>

    <div id="winDUFabricWarpPlan" style="width:800px;height:500px" class="easyui-window winstyle" title="Schedule Informations" data-options="modal:true,closed:true,collapsible:false,minimizable:false,maximizable:false,closable:false">
        <div style="padding-left:0px; padding-right:0px; padding-top:2px;">
            <fieldset>
                <legend>Order Info:</legend>
                <div>
                    <table cellpadding="1" cellspacing="1" style="font-size: 12px;width: 100%">
                        <tr>
                            <td style="width:15%;text-align:right;">
                                Dispo No:
                            </td>
                            <td style="width:35%;text-align:left;">
                                <input id="txtOrderNo" class="reset-text" placeholder="Search by Dispo No" style="width:100%" disabled="disabled" />
                            </td>
                            <td style="width:15%;text-align:right;">
                                Buyer Name:
                            </td>
                            <td style="padding-left: 2px;width:35%;text-align:left">
                                <input id="txtBuyerName" type="text" style="width:100%" disabled="disabled" />
                            </td>
                        </tr>
                        <tr>
                            <td style="width:15%;text-align:right;">
                                Construction:
                            </td>
                            <td style="width:35%;text-align:left;">
                                <input id="txtConstruction" class="reset-text" placeholder="Construction" style="width:100%" disabled="disabled" />
                            </td>
                            <td style="width:15%;text-align:right;">
                                Composition:
                            </td>
                            <td style="padding-left: 2px;width:35%;text-align:left">
                                <input id="txtComposition" type="text" style="width:100%" disabled="disabled" />
                            </td>
                        </tr>
                        <tr>
                            <td style="width:15%;text-align:right;">
                                Design:
                            </td>
                            <td style="width:35%;text-align:left;">
                                <input id="txtDesign" class="reset-text" style="width:100%" disabled="disabled" />
                            </td>
                            <td style="width:15%;text-align:right;">
                                Color :
                            </td>
                            <td style="padding-left: 2px;width:35%;text-align:left">
                                @*<input id="txtRequiredWarpLength" type="text" style="width:100%" />*@
                                <table>
                                    <tr>
                                        <td style="text-align:right;width:20%;">
                                            Warp:
                                        </td>
                                        <td style="width:30%;">
                                            <input id="txtWarpColor" type="text" style="width:80%;" disabled="disabled" />
                                        </td>
                                        <td style="text-align:right;width:20%;">
                                            Weft:
                                        </td>
                                        <td style="width:30%;">
                                            <input id="txtWeftColor" type="text" style="width:80%;" disabled="disabled" />
                                        </td>
                                    </tr>
                                </table>

                            </td>
                        </tr>
                    </table>
                </div>
                <div>
                    <table cellpadding="2" cellspacing="2" style="width:100%;">

                        <tr>
                            <td style="text-align:right;width:20%; border-top:1px solid black">
                                <label>Order Qty:</label>
                            </td>
                            <td style="width:30%;border-top:1px solid black">
                                <input id="txtQtyOrderY" type="text" style="width:59%;text-align:right;" value="0.00" disabled="disabled" />(Y)
                            </td>
                            <td style="width:30%;border-top:1px solid black">
                                <input id="txtQtyOrderM" type="text" style="width:59%;text-align:right;" value="0.00" disabled="disabled" />(M)
                            </td>
                            <td style="text-align:right;width:20%;border-top:1px solid black"></td>
                        </tr>

                        <tr>
                            <td style="text-align:right;width:20%;">
                                <label>Grey Target Qty :</label>
                            </td>
                            <td style="width:30%;">
                                <input id="txtGreyTargetQtyUS" type="text" style="width:59%;text-align:right;" value="0.00" disabled="disabled" />(Y)
                            </td>
                            <td style="width:30%;">
                                <input id="txtGreyTargetQtyUSInMeter" type="text" style="width:59%;text-align:right;" value="0.00" disabled="disabled" />(M)
                            </td>
                            <td style="text-align:right;width:20%;"></td>
                        </tr>

                        <tr>
                            <td style="text-align:right;width:20%;">
                                <label>Require Warp Length :</label>
                            </td>
                            <td style="width:30%;">
                                <input id="txtRequireWarpLengthY" type="text" style="width:59%;text-align:right;" value="0.00" disabled="disabled" />(Y)
                            </td>
                            <td style="width:30%;">
                                <input id="txtRequireWarpLengthUSInMeter" type="text" style="width:59%;text-align:right;" value="0.00" disabled="disabled" />(M)
                            </td>
                            <td style="text-align:right;width:20%;"></td>
                        </tr>
                        <tr>
                            <td style="text-align:right;width:20%;">
                                <label>Per Cone Length :</label>
                            </td>
                            <td style="width:30%;">
                                <input id="txtLengthInWeavingY" type="text" style="width:59%;text-align:right;" value="0.00" disabled="disabled" />(Y)
                            </td>
                            <td style="width:30%;">
                                <input id="txtLengthInWeavingM" type="text" style="width:59%;text-align:right;" value="0.00" disabled="disabled" />(M)
                            </td>
                            <td style="text-align:right;width:20%;"></td>
                        </tr>


                    </table>
                </div>
            </fieldset>
        </div>
        <div>
            <fieldset>
                <legend>Schedule Info:</legend>
                <div>
                    <table cellpadding="1" cellspacing="1" style="font-size: 12px;width: 100%">
                        <tr>
                            <td style="width:5%;text-align:right;"></td>
                            <td style="width:10%;text-align:right;">
                                Machine:
                            </td>
                            <td style="padding-left: 0px;width:30%;text-align:left">
                                <input id="txtMachine" style="width: 60% ; font-size: 11px;" placeholder="Search Machine" />
                                <a id="btnPickMachine" href="javascript:void(0)" class="easyui-linkbutton ics-pick" iconcls="icon-pick" plain="true"></a>
                                <a id="btnResetMachine" href="javascript:void(0)" class="easyui-linkbutton ics-pick" iconcls="icon-clear" plain="true"></a>
                            </td>
                            <td colspan="2" style="padding-right: 2px;width:50%;text-align:right;">
                                <div style="float: right; width:100%;">

                                    <span>
                                        <input type="button" id="btnScheduleLastTime" value="Default Time" style="font-size: 11px;
                                            height: 23px; width: 80px;" />
                                    </span><span>
                                        <input type="button" id="btnCurrenttime" value="Current Time" style="font-size: 11px;
                                            height: 23px; width: 80px;" />
                                    </span><span>
                                        <input id="tptimeSpinner" class="easyui-timespinner" style="width: 75px; height:20px; font-size: 11px;" required="required"
                                               data-options="showSeconds:false" />
                                    </span>
                                    <span>
                                        <input type="button" id="btnAddSpinnerTime" value="Add" style="font-size: 11px;
                                            height: 23px; width: 30px;" />
                                    </span>
                                </div>
                            </td>
                            <td style="width:5%;text-align:right;"></td>
                        </tr>
                        <tr>
                            <td style="width:5%;text-align:right;"></td>
                            <td style="width:10%;text-align:right;">
                                Start Time:
                            </td>
                            <td style="width:30%;">
                                @*<input id="txtStartDate" type="text" class="easyui-datetimebox" style="width:100%" data-options="showSeconds:false" />*@
                                <input id="txtStartDate" style="width:100px;" type="text" class="easyui-datebox" required="required" data-options="formatter:icsdateformat,parser:icsdateparser" />
                                <input id="tpStartTime" class="easyui-timespinner" style="width:60px;" required="required" />
                            </td>

                            <td style="width:20%;text-align:right;">
                                End Time:
                            </td>
                            <td style="padding-left: 2px;width:30%;">
                                @*<input id="txtEndDate" type="text" class="easyui-datetimebox" style="width:100%" data-options="showSeconds:false" />*@
                                <input id="txtEndDate" style="width:100px;" type="text" class="easyui-datebox" required="required" data-options="formatter:icsdateformat,parser:icsdateparser" />
                                <input id="tpEndTime" class="easyui-timespinner" style="width:60px;" required="required" />
                            </td>

                            <td style="width:5%;text-align:right;"></td>
                        </tr>

                    </table>

                </div>
            </fieldset>
            <fieldset>
                <legend></legend>

                <div>
                    <table style="font-size: 12px;width: 100%">
                        <tr>
                            <td style="text-align:right;width:10%;">
                                <label>Qty :</label>
                            </td>
                            <td style="text-align:left;width:30%;">
                                <input id="txtQty" type="text" class="form-control number" />(M)
                            </td>
                            <td style="width:10%;">
                                <label class="control-label">Qty(Y):</label>
                            </td>
                            <td style="text-align:left;width:30%;">
                                <input id="txtYardQty" type="text" class="form-control number" disabled />(Y)
                            </td>
                            <td style="width:20%;"></td>
                        </tr>
                        <tr>
                            <td style="width:10%;text-align:right;">
                                Remarks:
                            </td>
                            <td colspan="4" style="width:90%;">
                                <input id="txtNote" class="reset-text" style="width:99%;" placeholder="Remarks.." />
                            </td>
                        </tr>
                    </table>

                </div>
            </fieldset>
        </div>

        <fieldset class="actionfieldsetstyle">
            <legend>Actions : </legend>
            <table border="0" cellspacing="2" cellpadding="2" style="width:100%; font-size:11px; font-weight:bold;">
                <tr>
                    <td style="width:60%;text-align:left;">
                    </td>
                    <td style="width:40%;text-align:right;">
                        <a id="btnAddFB" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-add" plain="true">Fabric Batch</a>
                        <a id="btnSaveFWP" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-save" plain="true" style=" height:22px;" onclick="SaveFWP(false)">Save</a>
                        <a id="btnClosePS" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-cancel" plain="true">Close</a>
                    </td>
                </tr>
            </table>
        </fieldset>
        <fieldset id="region-fabric-batch">
            <legend>Fabric Batch</legend>
            <div class="row">
                <div class="col-lg-3 col-md-3 col-sm-3 text-right">
                    <label class="control-label">Fabric Batch(s):</label>
                </div>
                <div class="col-lg-8 col-md-8 col-sm-8">
                    <select id="cboFabricBatch" class="form-control"></select>
                    <label id="lblSingleFB" class="control-label"></label>
                    <a id="btnBatchCardPrint" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-print" plain="true"></a>
                </div>
            </div>
        </fieldset>
    </div>

    <div id="divRPT_Dispo" class="menuMainCollectionTable" style="font-family:Tahoma; height:auto; width:100%;overflow:hidden;">
        
            <div title="Plane" style="padding:2px">
                <div style="height:auto;width:100%;overflow:hidden;">
                   
                    <div style="width:100%;">
                        <fieldset>
                            <legend style="text-align:center; font-weight:bold;"> <label style="color:green" id="lblHeader">Yarn Receiving Info</label> </legend>
                            <table id="tblFabricExecutionOrderYarnReceive" class="easyui-datagrid" style="width:100%;height:150px;"
                                   data-options="singleSelect: true,fitColumns:false, rownumbers:true, pagination:false, autoRowHeight:false, toolbar: '#toolbarRPT_DispoDetail_Com'">
                                <thead>
                                    <tr>
                                        <th field="RequisitionNo" width="12%" align="left"> Req. No </th>
                                        <th field="ReceiveDateInStr" width="13%" align="left"> Receive Date </th>
                                        <th field="BeamNo" width="13%" align="left"> Beam No </th>
                                        <th field="ProductNameCode" width="20%" align="left"> Product </th>
                                        @*<th field="BuyerName" width="13%" align="left"> Buyer </th>*@
                                        <th field="TFLength" width="10%" align="right" formatter="formatPrice">TF Length</th>
                                        <th field="ReqQty" width="10%" align="right" formatter="formatPrice">Req. Qty</th>
                                        <th field="ReceiveByName" width="13%" align="left"> ReceiveBy </th>
                                        
                                    </tr>
                                </thead>
                            </table>
                            <div id="toolbarRPT_DispoDetail_Com">
                                <a id="btnReceive" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-ok" plain="true">Receive</a>
                                @*<a id="btnHold" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-cancel" plain="true">Hold</a>*@
                            </div>
                        </fieldset>
                    </div>


                    <div style="width:100%;">
                        <div id="divFabricWarpPlan" style="width:100%;">
                            <fieldset>
                                <legend style="text-align:left; font-weight:bold;"> Fabric Warp Plan </legend>
                                <table id="tblFabricWarpPlan" class="easyui-datagrid" style="width:100%;height:180px;"
                                       data-options="singleSelect: true,fitColumns:false, rownumbers:true, pagination:false, autoRowHeight:false, toolbar: '#toolbartblFabricWarpPlan'">
                                    <thead>
                                        <tr>
                                            <th field="StartTimeSt" width="12%">Date</th>
                                            <th field="MachineName" width="12%">Sizing M/C</th>
                                            @*<th field="ContractorName" width="18%">Customer</th>
                                            <th field="Construction" width="10%">Construction</th>
                                            <th field="Composition" width="10%">Composition</th>
                                            <th field="ExeNo" width="10%">Dispo No</th>
                                            <th field="Weave" width="10%">Design</th>*@
                                            <th field="WarpColor" width="8%">WarpColor</th>
                                            <th field="WeftColor" width="8%">WeftColor</th>
                                            <th field="ReedNo" width="8%">ReedNo</th>
                                            <th field="REEDWidth" formatter="formatPrice" width="10%" align="right">R.Width</th>
                                            <th field="WarpLength" formatter="formatPrice" width="10%" align="right">Warp Length</th>
                                            <th field="WarpBeam" formatter="formatPrice" width="10%" align="right">Sizing Beam</th>
                                            <th field="BeamName" width="10%" align="right">Beam Name</th>
                                            <th field="BeamName2" width="10%" align="right">Status</th>
                                            <th field="L" width="10%" align="right">L/F</th>
                                        </tr>
                                    </thead>
                                </table>
                                <div id="toolbartblFabricWarpPlan">
                                    @*<input id="txtMachine" style="width: 150px; font-size: 11px;" placeholder="Search Machine" />
                                    <a id="btnPickMachine" href="javascript:void(0)" class="easyui-linkbutton ics-pick" iconcls="icon-pick" plain="true"></a>
                                    <a id="btnResetMachine" href="javascript:void(0)" class="easyui-linkbutton ics-pick" iconcls="icon-clear" plain="true"></a>                                    
                                    Qty(M):
                                    <input id="txtQty" style="width:60px;height:22px;" type="text" class="number" />
                                    Remarks:
                                    <input id="txtNote" class="reset-text" style="width:400px;" placeholder="Remarks.." />
                                    <a id="btnSaveFWP" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-save" plain="true" style=" height:22px;" onclick="SaveFWP()">Save</a>*@
                                    <a id="btnAdd" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-add" plain="true">New</a>
                                    <a id="btnEdit" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-edit" plain="true">Edit</a>
                                </div>
                            </fieldset>
                        </div>

                        <div style="width:100%;">
                            <fieldset>
                                <legend style="text-align:left; font-weight:bold;"> Fabric Sizing Plan </legend>
                                <table id="tblFabricSizingPlan" class="easyui-datagrid" style="width:100%;height:160px;"
                                       data-options="singleSelect: true,fitColumns:false, rownumbers:true, pagination:false, autoRowHeight:false, toolbar: '#toolbartblFabricSizingPlan'">
                                    <thead>
                                        <tr>
                                            <th field="StartTimeSt" width="12%">Date</th>
                                            <th field="MachineName" width="12%">Sizing M/C</th>
                                            @*<th field="ContractorName" width="18%">Customer</th>
                                            <th field="Construction" width="10%">Construction</th>
                                            <th field="Composition" width="10%">Composition</th>
                                            <th field="ExeNo" width="10%">Dispo No</th>
                                            <th field="Weave" width="10%">Design</th>*@
                                            <th field="WarpColor" width="8%">WarpColor</th>
                                            <th field="WeftColor" width="8%">WeftColor</th>
                                            <th field="ReedNo" width="8%">ReedNo</th>
                                            <th field="REEDWidth" formatter="formatPrice" width="10%" align="right">R.Width</th>
                                            <th field="WarpLength" formatter="formatPrice" width="10%" align="right">Warp Length</th>
                                            <th field="WarpBeam" formatter="formatPrice" width="10%" align="right">Sizing Beam</th>
                                            <th field="BeamName" width="10%" align="right">Beam Name</th>
                                            <th field="BeamName2" width="10%" align="right">Status</th>
                                            <th field="L" width="10%" align="right">L/F</th>
                                        </tr>
                                    </thead>
                                </table>
                                <div id="toolbartblFabricSizingPlan">
                                    <a id="btnAddFSP" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-add" plain="true">New</a>
                                    <a id="btnEditFSP" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-edit" plain="true">Edit</a>
                                </div>
                            </fieldset>
                        </div>

                    </div>


                </div>
                <div style="width:100%; height:10%">
                    <fieldset>
                        <legend style="font-weight: bold">Action : </legend>
                        <table border="0" cellspacing="2" cellpadding="2" style="font-size: 11px; font-weight: bold; width:100%">
                            <tr>
                                <td style="width: 12%;text-align:right">
                                    @*<a id="btnPrintPreview1" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-print" plain="true">Preview (All)</a>*@
                                </td>
       
                                <td style="width: 10%;text-align:right">
                                    <a id="btnClose" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-cancel" plain="true">Close</a>
                                </td>
                            </tr>
                        </table>
                    </fieldset>
                </div>
            </div>
            

       
    </div>
    <div id="winRPT_DispoDetailEdit" style="width:600px;" class="easyui-window" title="Edit Detail" data-options="modal:true,closed:true,collapsible:false,minimizable:false,maximizable:false,closable:false">
        <div>
            <fieldset>
                <legend style="font-weight:bold"> Detail info : </legend>
                <table border="0" cellspacing="2" cellpadding="2" style="width:100%; font-size:11px; font-weight:bold">
                    <tr>
                        <td style="width:20%;text-align:right">
                            Product:
                        </td>
                        <td style="width:80%;text-align:left">
                            <input type="text" id="txtProduct_Edit" style="width:75%" disabled="disabled" />

                        </td>
                    </tr>


                </table>
                <table border="0" cellspacing="2" cellpadding="2" style="width:100%; font-size: 11px; font-weight: bold">

                    <tr>
                        <td style="width: 20%; text-align: right">
                            Qty(<span class="lblMUnitOne"></span>):

                        </td>

                        <td style="width: 30%; text-align: left">
                            <input type="text" style="width: 80%; text-align:right" id="txtQtyInOne" disabled="disabled" />
                        </td>
                        <td style="width: 20%; text-align: right">
                            Qty(<span class="lblMUnitTwo"></span>):
                        </td>

                        <td style="width: 30%; text-align: left">
                            <input type="text" style="width:80%; text-align:right" id="txtQtyInTwo" disabled="disabled" />
                        </td>
                    </tr>
                    <tr>
                        <td style="width: 20%; text-align: right">
                            Unit Price ($/<span class="lblMUnitOne"></span>):
                        </td>
                        <td style="width:30%; text-align: left">
                            <input type="text" style="width:80%; text-align:right" id="txtUnitPriceInOne" disabled="disabled" />
                        </td>
                        <td style="width: 20%; text-align: right">
                            Unit Price ($/<span class="lblMUnitTwo"></span>):
                        </td>
                        <td style="width: 30%; text-align: left">
                            <input type="text" style="width:80%; text-align:right" id="txtUnitPriceInTwo" disabled="disabled" />
                        </td>
                    </tr>
                    <tr>
                        <td style="width: 20%; text-align: right">
                            Amount(USD):
                        </td>
                        <td style="width:30%; text-align: left">
                            <input type="text" style="width:80%; text-align:right" id="txtAmount" disabled="disabled" />
                        </td>
                        <td style="width: 20%; text-align: right">
                            ColorInfo
                        </td>
                        <td style="width: 30%;">
                            <input type="text" style="width: 100%;" id="txtColorEdit" disabled="disabled" />
                        </td>
                    </tr>

                    <tr>
                        <td style="width: 20%; text-align: right">
                            Com. Qty(<span class="lblMUnitOne"></span>):
                        </td>
                        <td style="width: 30%;">
                            <input type="text" style="width:80%; text-align:right" id="txtQtyCom" />
                        </td>
                        <td style="width: 20%; text-align: right">
                            Style No
                        </td>
                        <td style="width: 30%">
                            <input type="text" style="width: 100%;" id="txtStyleNo" disabled="disabled" />
                        </td>
                    </tr>


                    <tr>

                        <td style="width: 20%; text-align: right">
                            Com. Rate($/<span class="lblMUnitOne"></span>):
                        </td>
                        <td style="width: 30%; text-align: left">
                            <input type="text" style="width:80%; text-align:right" id="txtCRate" onkeyup="SetComAmount(1)" />
                        </td>
                        <td style="width: 20%; text-align: right">
                            Com. Amount(USD):
                        </td>
                        <td style="width: 30%; text-align: left">
                            <input type="text" style="width: 80%; text-align:right" id="txtCAmount" disabled="disabled" />
                        </td>
                    </tr>
                    <tr>
                        <td style="width: 20%; text-align: right">
                            Buyer Rate($/<span class="lblMUnitOne"></span>):
                        </td>
                        <td style="width: 30%; text-align: left">
                            <input type="text" style="width:80%; text-align:right" id="txtCRateTwo" onkeyup="SetComAmount(2)" />
                        </td>
                        <td style="width: 20%; text-align: right">
                            Buyer Com.(USD):
                        </td>
                        <td style="width: 30%; text-align: left">
                            <input type="text" style="width: 80%; text-align:right" id="txtCAmount2" disabled="disabled" />
                        </td>
                    </tr>
                    <tr>
                        <td style="width: 20%; text-align: right"></td>
                        <td style="width: 30%; text-align: left"></td>
                        <td style="width: 20%; text-align: right">
                            Total Com.(USD):
                        </td>
                        <td style="width: 30%; text-align: left">
                            <input type="text" style="width: 80%; text-align:right" id="txtCAmountTotal" disabled="disabled" />
                        </td>
                    </tr>
                </table>
            </fieldset>
        </div>
        <fieldset>
            <legend style="font-weight:bold"> Action : </legend>
            <table border="0" cellspacing="2" cellpadding="2" style="width:100%; font-size:11px; font-weight:bold;">
                <tr>
                    <td style="width:100%;text-align:right;">
                        <a id="btnUpdateEPIDetail" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-save" plain="true">OK</a>
                        <a id="btnCloseEPIDetail" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-cancel" plain="true">Close</a>
                    </td>

                </tr>
            </table>
        </fieldset>
    </div>
</body>
</html>
<style type="text/css">
    .td-summary-one {
        width: 17%;
    }

    .td-summary-two {
        width: 19%;
    }
</style>
<script type="text/javascript">
    var _oRPT_Dispo=null;
    var _sBaseAddress="";
    var _sRPT_DispoHeader="";
    var _nMenuid=0;
    var _sBackLink="";
    var _oFabricEOYarnReceives=[];
    var _oFabricExecutionOrderSpecification=null;
    var _oFabricWarpPlans=[];
    var _oFabricWarpPlan={};
    var _StartDate = "";
    var _StartTime = "";
    var _EndDate = "";
    var _EndTime = "";
    var _oFabricSizingPlan = {};
    var _oIsAdd=false;
    var _nSelectedRowIndex = 0;
    var _nSelectedRowIndexFWP = 0;
    var _oFabricSizingPlans = [];
    var _nFBID=0;
    $(document).ready(function () {
        debugger;
        _nMenuid = @Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(HttpContext.Current.Session[SessionInfo.MenuID]));
        _sBaseAddress =@Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(HttpContext.Current.Session[SessionInfo.BaseAddress]));
        _oRPT_Dispo =@Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(Model));
        _oFabricEOYarnReceives =@Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(@ViewBag.FabricEOYarnReceives));
        _oFabricExecutionOrderSpecification =@Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(@ViewBag.FabricExecutionOrderSpecification));
        _oFabricWarpPlans =@Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(@ViewBag.FabricWarpPlans));
        _oFabricSizingPlans =@Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(@ViewBag.FabricSizingPlans));
        _sBackLink=sessionStorage.getItem("BackLink");
        //_sRPT_DispoHeader=sessionStorage.getItem("RPT_DispoHeader");
        $('#lblHeader').text('[Dispo No: '+_oFabricExecutionOrderSpecification.ExeNo+'] [Buyer: ' + _oFabricExecutionOrderSpecification.BuyerName + '] [Contruction: ' + _oFabricExecutionOrderSpecification.Construction + '] [Composition: ' +_oFabricExecutionOrderSpecification.Composition + ']');
        debugger;
        RefreshControl();
        RefreshFabricEOYarnReceives(_oFabricEOYarnReceives);

        //Fabric Warp plan
        DynamicRefreshList(_oFabricWarpPlans, "tblFabricWarpPlan");
        $("#divFabricWarpPlan").data("MachineID",0);

        //fabric sizing plan
        DynamicRefreshList(_oFabricSizingPlans, "tblFabricSizingPlan");
        $("#winDUFabricSizingPlan").data("MachineID",0);
    });

    function RefreshFabricEOYarnReceives(oFabricEOYarnReceives)
    {
        var data={"total":""+oFabricEOYarnReceives.length+"","rows":oFabricEOYarnReceives};
        $('#tblFabricExecutionOrderYarnReceive').datagrid('loadData',data);
    }

    function RefreshControl()
    {
    }

    $('#btnReceive').click(function(e){
        var oFEOY = $('#tblFabricExecutionOrderYarnReceive').datagrid('getSelected');
        if (oFEOY ==null || oFEOY.FEOYID <=0 ) { alert("Please select an item from list."); return ; }
        var nRowIndex=$('#tblFabricExecutionOrderYarnReceive').datagrid('getRowIndex',oFEOY);

        $.ajax({
            type: "POST",
            url: _sBaseAddress + "/WYRequisition/ReceiveFEOY",
            traditional: true,
            data: JSON.stringify(oFEOY),
            contentType: "application/json; charset=utf-8",
            success: function (data) {
                debugger;
                var oFEOY = jQuery.parseJSON(data);
                if(oFEOY.FEOYID > 0){
                    alert("Received Succesfully!!");
                }
                else{
                    alert(oFEOY.ErrorMessage);
                }
            },
            error: function (xhr, status, error) {
                alert(error);
            }
        });

    });

    $('#btnClose').click(function(e){
        window.location.href = sessionStorage.getItem("BackLink");
    })

    //Start Fabric Warp plan
    $("#btnAdd").click(function(){
        _oIsAdd=true;
        _oFabricWarpPlan = { ErrorMessage: "", FabricWarpPlanID: 0, FMID: 0 };

        $.ajax({
            type: "POST",
            url: _sBaseAddress + "/FabricWarpPlan/GetPS",
            traditional: true,
            data: JSON.stringify(_oFabricWarpPlan),
            contentType: "application/json; charset=utf-8",
            success: function (data) {
                debugger;
                _oFabricWarpPlan = { ErrorMessage: "", FabricWarpPlanID: 0, FMID: 0 };
                var oFabricWarpPlan = jQuery.parseJSON(data);

                RefreshControlFWP(oFabricWarpPlan);

                $("#winDUFabricWarpPlan").icsWindow("open", "Schedule Entry");

            }
        });


    });

    $('#btnEdit').click(function (e)
    {
        _oIsAdd=false;
        var oFabricWarpPlan = $('#tblFabricWarpPlan').datagrid('getSelected');
        if (oFabricWarpPlan ==null || oFabricWarpPlan.FabricWarpPlanID <=0 ) { alert("Please select an item from list."); return ; }
        var nIndex=$('#tblFabricWarpPlan').datagrid('getRowIndex',oFabricWarpPlan);
        _nSelectedRowIndexFWP=nIndex;
        $.ajax({
            type: "POST",
            url: _sBaseAddress + "/FabricWarpPlan/GetPS",
            traditional: true,
            data: JSON.stringify(oFabricWarpPlan),
            contentType: "application/json; charset=utf-8",
            success: function (data) {
                debugger;
                var oFabricWarpPlan = jQuery.parseJSON(data);
                RefreshControlFWP(oFabricWarpPlan);
                $("#winDUFabricWarpPlan").icsWindow("open", "Schedule Entry");

            }
        });

    });

    function RefreshControlFWP(oFabricWarpPlan)
    {
        debugger;
        _oFabricWarpPlan=oFabricWarpPlan;
        if(oFabricWarpPlan.FabricWarpPlanID>0)
        {
            $('#tpStartTime').timespinner('setValue', oFabricWarpPlan.StartTimeTS);
            $('#txtStartDate').datebox('setValue', oFabricWarpPlan.StartDateSt);

            $('#tpEndTime').timespinner('setValue', oFabricWarpPlan.EndTimeTS);
            $('#txtEndDate').datebox('setValue', oFabricWarpPlan.EndDateSt);

            //$("#txtScheduleNo").val(oFabricWarpPlan.ScheduleNo);
            $("#divFabricWarpPlan").data("MachineID",oFabricWarpPlan.FMID);
            $("#txtMachine").val(oFabricWarpPlan.MachineName);
            $("#txtNote").val(oFabricWarpPlan.Note);
        }
        else{
            $("#txtMachine").val("");
            $("#divFabricWarpPlan").data("MachineID",0);
            $("#txtNote").val("");
        }

        $("#txtOrderNo").val(_oFabricExecutionOrderSpecification.ExeNo);
        $("#txtBuyerName").val(_oFabricExecutionOrderSpecification.ContractorName);
        $("#txtConstruction").val(_oFabricExecutionOrderSpecification.Construction);
        $("#txtComposition").val(_oFabricExecutionOrderSpecification.Composition);
        $("#txtDesign").val(_oFabricExecutionOrderSpecification.Weave);
        $('#txtWeftColor').val(_oFabricExecutionOrderSpecification.WeftColor);
        $('#txtWarpColor').val(_oFabricExecutionOrderSpecification.WarpColor);
      
        $("#txtQtyOrderY").val(formatPrice(_oFabricExecutionOrderSpecification.Qty));
        $("#txtQtyOrderM").val(formatPrice(GetMeter(_oFabricExecutionOrderSpecification.Qty,2)));

        $("#txtGreyTargetQtyUSInMeter").val(formatPrice(parseFloat(_oFabricExecutionOrderSpecification.GreigeDemand).toFixed(1)));
        $("#txtGreyTargetQtyUS").val(formatPrice(parseFloat(_oFabricExecutionOrderSpecification.GreigeDemand*1.09361).toFixed(1)));

        $("#txtRequireWarpLengthUSInMeter").val(_oFabricExecutionOrderSpecification.RequiredWarpLength);
        $("#txtRequireWarpLengthY").val(formatPrice(parseFloat(_oFabricExecutionOrderSpecification.RequiredWarpLength*1.09361).toFixed(1)));

        $("#txtLengthInWeavingM").val(_oFabricExecutionOrderSpecification.PerConeLength);
        $("#txtLengthInWeavingY").val(formatPrice(parseFloat(_oFabricExecutionOrderSpecification.PerConeLength*1.09361).toFixed(1)));
       
        //$('#txtQty').numberbox({min:0, precision:2 });
        $('#txtQty').numberbox({onChange:ConvertIntoYards,min:0, precision:2 });
        $('#txtYardQty').numberbox({min:0, precision:2 });

        $('#txtQty').numberbox('setValue',oFabricWarpPlan.Qty); 
        $('#txtYardQty').numberbox('setValue',GetYard(oFabricWarpPlan.Qty,2)); 

        $('#region-fabric-batch').hide();
        $('#btnBatchCardPrint').hide();
        if(oFabricWarpPlan.FabricWarpPlanID>0){
            GetsFabricBatch(oFabricWarpPlan.FabricWarpPlanID);
            $("#btnAddFB").show();
        }
        else{
                    
            $("#btnAddFB").hide();
        }
    }

    function GetsFabricBatch(nFWPDID){
        _nFBID = 0;
        $("#cboFabricBatch").empty();
        $("#lblSingleFB").text("");
        $("#btnAddFB,#cboFabricBatch,#lblSingleFB").hide();

        var obj = {
            BaseAddress: _sBaseAddress,
            Object: { FWPDID:nFWPDID },
            ControllerName: "FabricBatch",
            ActionName: "GetsFabricBatchByFWPD",
            IsWinClose: false
        };
        $.icsMaxDataGets(obj, function (response) {
            if (response.status && response.objs.length > 0) {
                $("#region-fabric-batch").show();
                $('#btnBatchCardPrint').show();
                $('#btnAddFB').hide();
                if(response.objs.length > 1)
                {
                    $("#cboFabricBatch").icsLoadCombo({
                        List: response.objs,
                        OptionValue: "FBID",
                        DisplayText: "FabricBatchWithStatus",
                        InitialValue:""
                    });
                    $("#cboFabricBatch").show();
                 
                }else{
                    $("#lblSingleFB").show();
                    $("#lblSingleFB").text(response.objs[0].FabricBatchWithStatus);
                    $('#btnBatchCardPrint').show();
                    _nFBID =response.objs[0].FBID;
                }
            }
        });
    }
    
    $('#btnScheduleLastTime').click(function(e)
    {
        SetLastScheduleTime();
    });
    function SetLastScheduleTime()
    {

        if(parseInt($("#divFabricWarpPlan").data("MachineID"))>0 )
        {
            var nts=(new Date()).getTime()/1000;
            $.ajax({
                type: "GET",
                dataType: "json",
                url: _sBaseAddress + "/FabricWarpPlan/GetPSByMachine",
                data: { nFMID: $("#divFabricWarpPlan").data("MachineID") ,  nts:nts },
                contentType: "application/json; charset=utf-8",
                success: function(data)
                {
                    ////debugger;
                    var sStratTime = jQuery.parseJSON(data);
                    if ($.trim(sStratTime)!='')
                    {
                        SetStartTime(new Date(sStratTime));
                        AddTime(new Date(sStratTime));
                    }
                    else
                    {
                        var oDate=new Date();
                        oDate.setMinutes(oDate.getMinutes()+5);
                        SetStartTime(oDate);
                        AddTime(oDate);
                    }
                },
                error: function(xhr, status, error)
                {
                    alert(error);
                }
            });
        }

    }

    function SetStartTime(oDate)
    {
        //debugger;
        $('#txtStartDate').datebox('setValue', icsdateformat(oDate));
        var nHour=oDate.getHours();
        var nMin=oDate.getMinutes();
        if(isNaN(nHour))
        {
            nHour=0;
        }
        if(isNaN(nMin))
        {
            nMin=0;
        }
        $('#tpStartTime').timespinner('setValue', nHour+":"+nMin);

    }

    function AddTime(sDate)
    {
        var nhr=$('#tpStartTime').timespinner('getHours');
        var nmin=$('#tpStartTime').timespinner('getMinutes');
        if(isNaN(nhr))
        {
            nhr=0;
        }
        if(isNaN(nmin))
        {
            nmin=0;
        }
        var oDate=new Date(sDate);
        oDate.setHours(oDate.getHours()+nhr);
        oDate.setMinutes(oDate.getMinutes()+nmin);
        $('#txtEndDate').datebox('setValue', icsdateformat(oDate));
        var nHour=oDate.getHours();
        var nMin=oDate.getMinutes();
        if(isNaN(nHour))
        {
            nHour=0;
        }
        if(isNaN(nMin))
        {
            nMin=0;
        }
        $('#tpEndTime').timespinner('setValue', nHour+":"+nMin);

    }

    $('#btnCurrenttime').click(function(e)
    {
        var oDate=new Date();
        oDate.setMinutes(oDate.getMinutes()+5);
        SetStartTime(oDate);
        AddTime(oDate);
    });
    
    $('#btnAddSpinnerTime').click(function(e)
    {
        var dStartDate =$('#txtStartDate').datebox('getValue');
        var nhr=$('#tptimeSpinner').timespinner('getHours');
        var nmin=$('#tptimeSpinner').timespinner('getMinutes');
        if(isNaN(nhr))
        {
            nhr=0;
        }
        if(isNaN(nmin))
        {
            nmin=0;
        }
        var oDate=new Date(dStartDate);
        oDate.setHours(oDate.getHours()+nhr);
        oDate.setMinutes(oDate.getMinutes()+nmin);
        AddTime(oDate);
        if(!ValidationOfStartTime())return;
    });
    function ConvertIntoYards()
    {
   
        var nQtyInMeter= $('#txtQty').numberbox('getValue');
        var nQtyInYards= nQtyInMeter*1.09361;
        $('#txtYardQty').numberbox('setValue',nQtyInYards.toFixed(2));    
    }
    function ValidationOfStartTime()
    {
        if(parseInt($("#divFabricWarpPlan").data("MachineID")) <=0)
        {
            alert("Please, first select a Machine.");
            return false;
        }
        if(new Date($('#txtStartDate').datebox('getValue'))> new Date($('#txtEndDate').datebox('getValue'))){
            alert("Start time must be later than End time.");
            return false;
        }
        return true;
    }

    function RefreshObjectFWP()
    {
        debugger;
        var dStartDate =$('#txtStartDate').datebox('getValue');
        var startTime= $('#tpStartTime').timespinner('getValue');
        var sTime=startTime.split(':');
        var hStartTime= parseFloat(sTime[0]);
        var mStartTime= parseFloat(sTime[1]);
        dStartDate = new Date(dStartDate);
        dStartDate.setHours(hStartTime);
        dStartDate.setMinutes(mStartTime);

        var dEndtDate =$('#txtEndDate').datebox('getValue');
        var EndtTime= $('#tpEndTime').timespinner('getValue');
        var sTime=EndtTime.split(':');
        var hEndtTime= parseFloat(sTime[0]);
        var mEndtTime= parseFloat(sTime[1]);
        dEndtDate = new Date(dEndtDate);
        dEndtDate.setHours(hEndtTime);
        dEndtDate.setMinutes(mEndtTime);

        var oFabricWarpPlan = {
            FabricWarpPlanID       : (_oFabricWarpPlan!=null && _oFabricWarpPlan.FabricWarpPlanID>0)? _oFabricWarpPlan.FabricWarpPlanID:0,
            FMID                   : $("#divFabricWarpPlan").data("MachineID"),
            FEOSID                 : _oFabricExecutionOrderSpecification.FEOSID,
            FSCDID                 : _oFabricExecutionOrderSpecification.FSCDID,
            //BatchNo                : "",
            BUID                   :sessionStorage.getItem('BUID'),
            Qty :                   $('#txtQty').val(),
            //ScheduleType           : 0,
            StartTime	           : dStartDate,
            EndTime                : dEndtDate,
            Note                   :  $("#txtNote").val()

        };

        return oFabricWarpPlan;
    }

    function SaveFWP(isDUPSLot)
    {
        debugger;
        if(!ValidationOfStartTime())return;
        
        var oFabricWarpPlan=RefreshObjectFWP();
        var nts=(new Date()).getTime()/1000;

        $.ajax({
            type: "POST",
            dataType: "json",
            url: _sBaseAddress + "/FabricWarpPlan/ScheduleInTimePeriod",
            data: JSON.stringify({oFabricWarpPlan:oFabricWarpPlan, nts: nts}),
            contentType: "application/json; charset=utf-8",
            success: function(data)
            {
                ////debugger;
                var nCount = jQuery.parseJSON(data);
                if (nCount>0)
                {
                    if(confirm("Are you sure to increase time from next all schedules."))
                    {
                        oFabricWarpPlan.IsIncreaseTime=true;
                        SaveProductionScheduleFWP(oFabricWarpPlan, isDUPSLot);
                        //$("#winDUFabricWarpPlan").icsWindow("close");
                        //$('#btnSave').show();
                    }
                }
                else if(nCount==0)
                {
                    oFabricWarpPlan.IsIncreaseTime=false;
                    SaveProductionScheduleFWP(oFabricWarpPlan, isDUPSLot);
                    //$("#winDUFabricWarpPlan").icsWindow("close");
                    //$('#btnSave').show();
                }
            },
            error: function(xhr, status, error)
            {
                alert(error);
                $('#btnSave').show();
            }
        });
    }

    function SaveProductionScheduleFWP(oFabricWarpPlan,isDUPSLot)
    {
        $.ajax({
            type: "POST",
            dataType: "json",
            url : _sBaseAddress+  "/FabricWarpPlan/Save",
            traditional: true,
            data:  JSON.stringify(oFabricWarpPlan),
            contentType: "application/json; charset=utf-8",
            success: function (data) {
                ////debugger;
                var oDUPS = jQuery.parseJSON(data);
                if (oDUPS.ErrorMessage=="")
                {
                    _oFabricWarpPlan=oDUPS;
                    alert("Data Saved successfully");
                    if(_oIsAdd==true)
                    {
                        var oFabricWarpPlans= $('#tblFabricWarpPlan').datagrid('getRows');
                        var nIndex=oFabricWarpPlans.length;
                        $('#tblFabricWarpPlan').datagrid('appendRow', _oFabricWarpPlan);
                        $('#tblFabricWarpPlan').datagrid('selectRow', nIndex);
                    }
                    else
                    {
                        $('#tblFabricWarpPlan').datagrid('updateRow', { index: _nSelectedRowIndexFWP, row: _oFabricWarpPlan });
                        $('#tblFabricWarpPlan').datagrid('selectRow', _nSelectedRowIndexFWP);
                    }
                    $("#winDUFabricWarpPlan").icsWindow("close");
                }
                else {
                    alert(oDUPS.ErrorMessage);
                }
                $('#btnSave').show();
            },
            error: function (xhr, status, error) {
                alert(error);
            }


        });
    }
    $("#btnClosePS").click(function () {
        $("#winDUFabricWarpPlan").icsWindow("close");
    });
    $("#btnResetMachine").click(function () {

        $("#txtMachine").val("");
        $("#divFabricWarpPlan").data("MachineID",0);
    });
    $("#btnPickMachine").click(function () {

        var sMachineName=$.trim($("#txtMachine").val());
        //if(sMachineName==""){ alert("Type machine name to search."); return false; }
        GetMachines(sMachineName);
    });
    $("#txtMachine").keydown(function (e) {
        var nkeyCode = e.keyCode || e.which;
        if(nkeyCode==13){
            var sMachineName=$.trim($("#txtMachine").val());
            //if(sMachineName==""){ alert("Type machine name to search."); return false; }
            GetMachines(sMachineName);
        }
        else if(nkeyCode==8){
            $("#txtMachine").val("");
            $("#divFabricWarpPlan").data("MachineID",0);
        }
    });
    function GetMachines(sMachineName){

        var oMachine = {
            BUID:sessionStorage.getItem('BUID'),
            //ResourcesTypeInInt:2,
            Name:sMachineName
        };
        var obj = {
            BaseAddress: _sBaseAddress,
            Object: oMachine,
            ControllerName: "FabricWarpPlan",
            ActionName: "GetsMachine",
            IsWinClose: false
        };

        $.icsDataGets(obj, function (response) {

            if (response.status && response.objs.length > 0) {
                if (response.objs[0].FMID > 0) {
                    //debugger;
                    var tblColums = [];
                    var oColumn = { field: "Code", title: "Code", width: 100, align: "left" };tblColums.push(oColumn);
                    oColumn = { field: "Name", title: "Machine Name", width: 150, align: "left" };tblColums.push(oColumn);
                    //oColumn = { field: "Capacity", title: "Capacity", width: 90, align: "left" };tblColums.push(oColumn);
                    //oColumn = { field: "SequenceNo", title: "SL No", width: 150, align: "left" };tblColums.push(oColumn);

                    var oPickerParam = {
                        winid: 'winMachinePicker',
                        winclass:'clsMachinePicker',
                        winwidth: 480,
                        winheight: 460,
                        tableid: 'tblMachinePicker',
                        tablecolumns: tblColums,
                        datalist: response.objs,
                        multiplereturn: false,
                        searchingbyfieldName:'Name',
                        windowTittle: 'Machine List'
                    };
                    $.icsPicker(oPickerParam);
                    IntializePickerbutton(oPickerParam);//multiplereturn, winclassName
                }
                else { alert(response.objs[0].ErrorMessage); }
            }
            else{
                alert("No machine found.");
            }
        });

    }

    $('#btnAddFB').click(function(e){
        debugger;
        var oFabricWarpPlan = $('#tblFabricWarpPlan').datagrid('getSelected');
        if(oFabricWarpPlan == null || parseInt(oFabricWarpPlan.FabricWarpPlanID)<=0){
            alert("Planning yet not created.");
            return false;
        }
        if(!confirm("Are you sure to create fabric batch?"))
            return false;

        var oFabricBatch={
            FWPDID:oFabricWarpPlan.FabricWarpPlanID
        }
        var obj = {
            BaseAddress: _sBaseAddress,
            Object: oFabricBatch,
            ControllerName: "FabricBatch",
            ActionName: "GetLastFabricBatchByWarpPlane",
            IsWinClose: false
        };
        $.icsDataGet(obj, function (response)
        {
            debugger;
            var oFabricBatchTemp=response.obj;
            var oFabricBatch={
                FBID:oFabricBatchTemp.FBID,
                FWPDID:oFabricWarpPlan.FabricWarpPlanID,
                FabricSalesContractDetailID:oFabricWarpPlan.FSCDID,
                Qty:oFabricWarpPlan.Qty,
                FMID:oFabricWarpPlan.FMID,
                TotalEnds:0
                //Params:$('#tblFabricWarpPlan').data('FWPDID')
            }
            var obj =
            {
                BaseAddress: _sBaseAddress,
                Object: oFabricBatch,
                ObjectId: oFabricBatch.FBID,
                ControllerName: "FabricBatch",
                ActionName: "SaveFabricBatchFromWarpPlan",
                TableId: "",
                IsWinClose: false,
                Message: "Fabric Batch Create Successfully."
            };
            $.icsSave(obj, function (response) {
                if (response.status && response.obj != null) {
                    if (response.obj.FBID>0)
                    {
                        $("#winDUFabricWarpPlan").icsWindow("close");
                    }
                }
            });
      
           
        });


    });
    //End Fabric Warp plan



    //Start Fabric sizing plan
    $("#btnAddFSP").click(function(){
        _oIsAdd=true;
        _oFabricSizingPlan = { ErrorMessage: "", FabricSizingPlanID: 0, FMID: 0 };

        $.ajax({
            type: "POST",
            url: _sBaseAddress + "/FabricSizingPlan/GetPS",
            traditional: true,
            data: JSON.stringify(_oFabricSizingPlan),
            contentType: "application/json; charset=utf-8",
            success: function (data) {
                debugger;
                _oFabricSizingPlan = { ErrorMessage: "", FabricSizingPlanID: 0, FMID: 0 };
                var oFabricSizingPlan = jQuery.parseJSON(data);

                RefreshControlFSP(oFabricSizingPlan);

                $("#winDUFabricSizingPlan").icsWindow("open", "Schedule Entry");

            }
        });
    });

    $('#btnEditFSP').click(function (e)
    {
        _oIsAdd=false;
        var oFabricSizingPlan = $('#tblFabricSizingPlan').datagrid('getSelected');
        if (oFabricSizingPlan ==null || oFabricSizingPlan.FabricSizingPlanID <=0 ) { alert("Please select an item from list."); return ; }
        _nSelectedRowIndex=$('#tblFabricSizingPlan').datagrid('getRowIndex',oFabricSizingPlan);

        $.ajax({
            type: "POST",
            url: _sBaseAddress + "/FabricSizingPlan/GetPS",
            traditional: true,
            data: JSON.stringify(oFabricSizingPlan),
            contentType: "application/json; charset=utf-8",
            success: function (data) {
                debugger;
                var oFabricSizingPlan = jQuery.parseJSON(data);
                RefreshControlFSP(oFabricSizingPlan);
                $("#winDUFabricSizingPlan").icsWindow("open", "Schedule Entry");

            }
        });

    });

    $("#btnCloseFSP").click(function () {
        $("#winDUFabricSizingPlan").icsWindow("close");

    });

    function RefreshObjectFSP()
    {
        debugger;
        var dStartDate =$('#txtStartDateFSP').datebox('getValue');
        var startTime= $('#tpStartTimeFSP').timespinner('getValue');
        var sTime=startTime.split(':');
        var hStartTime= parseFloat(sTime[0]);
        var mStartTime= parseFloat(sTime[1]);
        dStartDate = new Date(dStartDate);
        dStartDate.setHours(hStartTime);
        dStartDate.setMinutes(mStartTime);

        var dEndtDate =$('#txtEndDateFSP').datebox('getValue');
        var EndtTime= $('#tpEndTimeFSP').timespinner('getValue');
        var sTime=EndtTime.split(':');
        var hEndtTime= parseFloat(sTime[0]);
        var mEndtTime= parseFloat(sTime[1]);
        dEndtDate = new Date(dEndtDate);
        dEndtDate.setHours(hEndtTime);
        dEndtDate.setMinutes(mEndtTime);


        var oFabricSizingPlan = {
            FabricSizingPlanID     : (_oFabricSizingPlan!=null && _oFabricSizingPlan.FabricSizingPlanID>0)? _oFabricSizingPlan.FabricSizingPlanID:0,
            FMID                   : $("#winDUFabricSizingPlan").data("MachineID"),
            FEOSID                 : _oFabricExecutionOrderSpecification.FEOSID,
            FSCDID                 : _oFabricExecutionOrderSpecification.FSCDID,
            //BatchNo                : _oFabricSizingPlan.BatchNo,
            BUID                   :sessionStorage.getItem('BUID'),
            Qty                    : 0,
            //ScheduleType           : _oFabricSizingPlan.ScheduleType,
            StartTime	           : dStartDate,
            EndTime                : dEndtDate,
            Note                   :  $("#txtNoteFSP").val(),
            //StatusInt              :  $("#cboScheduleStatus").val(),
            FabricSizingPlanDetails :  $('#tblFSPDetail').datagrid('getRows')

        };
        return oFabricSizingPlan;
    }

    function SaveFSP(isDUPSLot)
    {
        debugger;
        endEditing();
        if(!ValidationOfStartTimeFSP())return;

        var oFabricSizingPlan=RefreshObjectFSP();
        var nts=(new Date()).getTime()/1000;

        $.ajax({
            type: "POST",
            dataType: "json",
            url: _sBaseAddress + "/FabricSizingPlan/ScheduleInTimePeriod",
            data: JSON.stringify({oFabricSizingPlan:oFabricSizingPlan, nts: nts}),
            contentType: "application/json; charset=utf-8",
            success: function(data)
            {
                ////debugger;
                var nCount = jQuery.parseJSON(data);
                if (nCount>0)
                {
                    if(confirm("Are you sure to increase time from next all schedules."))
                    {
                        oFabricSizingPlan.IsIncreaseTime=true;
                        SaveProductionScheduleFSP(oFabricSizingPlan, isDUPSLot);
                        //$("#winDUFabricSizingPlan").icsWindow("close");
                        //$('#btnSave').show();
                    }
                }
                else if(nCount==0)
                {
                    oFabricSizingPlan.IsIncreaseTime=false;
                    SaveProductionScheduleFSP(oFabricSizingPlan, isDUPSLot);
                    //$("#winDUFabricSizingPlan").icsWindow("close");
                    //$('#btnSave').show();
                }
            },
            error: function(xhr, status, error)
            {
                alert(error);
                $('#btnSave').show();
            }
        });
    }
    function SaveProductionScheduleFSP(oFabricSizingPlan,isDUPSLot)
    {
        $.ajax({
            type: "POST",
            dataType: "json",
            url : _sBaseAddress+  "/FabricSizingPlan/Save",
            traditional: true,
            data:  JSON.stringify(oFabricSizingPlan),
            contentType: "application/json; charset=utf-8",
            success: function (data) {
                ////debugger;
                var oDUPS = jQuery.parseJSON(data);
                if (oDUPS.ErrorMessage=="")
                {
                    _oFabricSizingPlan=oDUPS;
                    alert("Data Saved successfully");

                    DynamicRefreshList(_oFabricSizingPlan.FabricSizingPlanDetails, "tblFSPDetail");

                    if(_oIsAdd==true)
                    {
                        var oFabricSizingPlans= $('#tblFabricSizingPlan').datagrid('getRows');
                        var nIndex=oFabricSizingPlans.length;
                        $('#tblFabricSizingPlan').datagrid('appendRow', _oFabricSizingPlan);
                        $('#tblFabricSizingPlan').datagrid('selectRow', nIndex);
                    }
                    else
                    {
                        $('#tblFabricSizingPlan').datagrid('updateRow', { index: _nSelectedRowIndex, row: _oFabricSizingPlan });
                        $('#tblFabricSizingPlan').datagrid('selectRow', _nSelectedRowIndex);
                    }
                    $("#winDUFabricSizingPlan").icsWindow("close");
                }
                else {
                    alert(oDUPS.ErrorMessage);
                }
            },
            error: function (xhr, status, error) {
                alert(error);
            }


        });
    }

    function RefreshControlFSP(oFabricSizingPlan)
    {
        debugger;
        _oFabricSizingPlan=oFabricSizingPlan;
        if(oFabricSizingPlan.FabricSizingPlanID>0)
        {
            $('#tpStartTimeFSP').timespinner('setValue', oFabricSizingPlan.StartTimeTS);
            $('#txtStartDateFSP').datebox('setValue', oFabricSizingPlan.StartDateSt);

            $('#tpEndTimeFSP').timespinner('setValue', oFabricSizingPlan.EndTimeTS);
            $('#txtEndDateFSP').datebox('setValue', oFabricSizingPlan.EndDateSt);

            $("#txtScheduleNoFSP").val(oFabricSizingPlan.ScheduleNo);
            $("#winDUFabricSizingPlan").data("MachineID",oFabricSizingPlan.FMID);
            $("#txtMachineFSP").val(oFabricSizingPlan.MachineName);
            $("#txtNoteFSP").val(oFabricSizingPlan.Note);
        }
        else{
            $("#txtMachineFSP").val(oFabricSizingPlan.MachineName);
            $("#winDUFabricSizingPlan").data("MachineID",0);
            $("#txtNoteFSP").val(oFabricSizingPlan.Note);
            DynamicRefreshList([], "tblFSPDetail");
        }

        $("#txtOrderNoFSP").val(_oFabricExecutionOrderSpecification.ExeNo);
        $("#txtBuyerNameFSP").val(_oFabricExecutionOrderSpecification.BuyerName);
        $("#txtConstructionFSP").val(_oFabricExecutionOrderSpecification.Construction);
        $("#txtCompositionFSP").val(_oFabricExecutionOrderSpecification.Composition);
        $("#txtDesignFSP").val(_oFabricExecutionOrderSpecification.Weave);
        $("#txtRequiredWarpLengthFSP").val(_oFabricExecutionOrderSpecification.RequiredWarpLength);
        if(oFabricSizingPlan.FabricSizingPlanDetails.length>0)
        {
            DynamicRefreshList(oFabricSizingPlan.FabricSizingPlanDetails, "tblFSPDetail");
        }
    }

    $('#btnScheduleLastTimeFSP').click(function(e)
    {
        SetLastScheduleTimeFSP();
    });
    $('#btnCurrenttimeFSP').click(function(e)
    {
        var oDate=new Date();
        oDate.setMinutes(oDate.getMinutes()+5);
        SetStartTimeFSP(oDate);
        AddTimeFSP(oDate);
    });
    $('#btnAddSpinnerTimeFSP').click(function(e)
    {
        var dStartDate =$('#txtStartDateFSP').datebox('getValue');
        var nhr=$('#tptimeSpinnerFSP').timespinner('getHours');
        var nmin=$('#tptimeSpinnerFSP').timespinner('getMinutes');
        if(isNaN(nhr))
        {
            nhr=0;
        }
        if(isNaN(nmin))
        {
            nmin=0;
        }
        var oDate=new Date(dStartDate);
        oDate.setHours(oDate.getHours()+nhr);
        oDate.setMinutes(oDate.getMinutes()+nmin);
        AddTimeFSP(oDate);
        if(!ValidationOfStartTimeFSP())return;
    });

    function SetLastScheduleTimeFSP()
    {
        if(parseInt($("#winDUFabricSizingPlan").data("MachineID"))>0 )
        {
            var nts=(new Date()).getTime()/1000;
            $.ajax({
                type: "GET",
                dataType: "json",
                url: _sBaseAddress + "/FabricSizingPlan/GetPSByMachine",
                data: { nFMID: $("#winDUFabricSizingPlan").data("MachineID") ,  nts:nts },
                contentType: "application/json; charset=utf-8",
                success: function(data)
                {
                    ////debugger;
                    var sStratTime = jQuery.parseJSON(data);
                    if ($.trim(sStratTime)!='')
                    {
                        SetStartTimeFSP(new Date(sStratTime));
                        AddTimeFSP(new Date(sStratTime));
                    }
                    else
                    {
                        var oDate=new Date();
                        oDate.setMinutes(oDate.getMinutes()+5);
                        SetStartTimeFSP(oDate);
                        AddTimeFSP(oDate);
                    }
                },
                error: function(xhr, status, error)
                {
                    alert(error);
                }
            });
        }

    }

    function SetStartTimeFSP(oDate)
    {
        //debugger;
        $('#txtStartDateFSP').datebox('setValue', icsdateformat(oDate));
        var nHour=oDate.getHours();
        var nMin=oDate.getMinutes();
        if(isNaN(nHour))
        {
            nHour=0;
        }
        if(isNaN(nMin))
        {
            nMin=0;
        }
        $('#tpStartTimeFSP').timespinner('setValue', nHour+":"+nMin);

    }

    function AddTimeFSP(sDate)
    {
        //debugger;
        var nhr=$('#tpStartTimeFSP').timespinner('getHours');
        var nmin=$('#tpStartTimeFSP').timespinner('getMinutes');
        if(isNaN(nhr))
        {
            nhr=0;
        }
        if(isNaN(nmin))
        {
            nmin=0;
        }
        var oDate=new Date(sDate);
        oDate.setHours(oDate.getHours()+nhr);
        oDate.setMinutes(oDate.getMinutes()+nmin);
        $('#txtEndDateFSP').datebox('setValue', icsdateformat(oDate));
        var nHour=oDate.getHours();
        var nMin=oDate.getMinutes();
        if(isNaN(nHour))
        {
            nHour=0;
        }
        if(isNaN(nMin))
        {
            nMin=0;
        }
        $('#tpEndTimeFSP').timespinner('setValue', nHour+":"+nMin);

    }

    function ValidationOfStartTimeFSP()
    {
        if(parseInt($("#winDUFabricSizingPlan").data("MachineID")) <=0)
        {
            alert("Please, first select a Machine.");
            return false;
        }
        if(new Date($('#txtStartDateFSP').datebox('getValue'))> new Date($('#txtEndDateFSP').datebox('getValue'))){
            alert("Start time must be later than End time.");
            return false;
        }
        return true;
    }

    $("#btnResetMachineFSP").click(function () {

        $("#txtMachineFSP").val("");
        $("#winDUFabricSizingPlan").data("MachineID",0);
    });
    $("#btnPickMachineFSP").click(function () {

        var sMachineName=$.trim($("#txtMachineFSP").val());
        //if(sMachineName==""){ alert("Type machine name to search."); return false; }
        GetMachinesFSP(sMachineName);
    });
    $("#txtMachineFSP").keydown(function (e) {
        var nkeyCode = e.keyCode || e.which;
        if(nkeyCode==13){
            var sMachineName=$.trim($("#txtMachineFSP").val());
            //if(sMachineName==""){ alert("Type machine name to search."); return false; }
            GetMachinesFSP(sMachineName);
        }
        else if(nkeyCode==8){
            $("#txtMachineFSP").val("");
            $("#winDUFabricSizingPlan").data("MachineID",0);
        }
    });
    function GetMachinesFSP(sMachineName){

        var oMachine = {
            BUID:sessionStorage.getItem('BUID'),
            //ResourcesTypeInInt:2,
            Name:sMachineName
        };
        var obj = {
            BaseAddress: _sBaseAddress,
            Object: oMachine,
            ControllerName: "FabricSizingPlan",
            ActionName: "GetsMachine",
            IsWinClose: false
        };

        $.icsDataGets(obj, function (response) {

            if (response.status && response.objs.length > 0) {
                if (response.objs[0].FMID > 0) {
                    //debugger;
                    var tblColums = [];
                    var oColumn = { field: "Code", title: "Code", width: 100, align: "left" };tblColums.push(oColumn);
                    oColumn = { field: "Name", title: "Machine Name", width: 150, align: "left" };tblColums.push(oColumn);
                    //oColumn = { field: "Capacity", title: "Capacity", width: 90, align: "left" };tblColums.push(oColumn);
                    //oColumn = { field: "SequenceNo", title: "SL No", width: 150, align: "left" };tblColums.push(oColumn);

                    var oPickerParam = {
                        winid: 'winMachinePickerFSP',
                        winclass:'clsMachinePickerFSP',
                        winwidth: 480,
                        winheight: 460,
                        tableid: 'tblMachinePickerFSP',
                        tablecolumns: tblColums,
                        datalist: response.objs,
                        multiplereturn: false,
                        searchingbyfieldName:'Name',
                        windowTittle: 'Machine List'
                    };
                    $.icsPicker(oPickerParam);
                    IntializePickerbutton(oPickerParam);//multiplereturn, winclassName
                }
                else { alert(response.objs[0].ErrorMessage); }
            }
            else{
                alert("No machine found.");
            }
        });

    }

    $("#btnDeleteDetail").click(function () {

        var oFabricSizingPlanDetail = $("#tblFSPDetail").datagrid("getSelected");
        if (oFabricSizingPlanDetail == null) { alert("Please select an item from list!"); return false; }
        var nIndex=$('#tblFSPDetail').datagrid('getRowIndex',oFabricSizingPlanDetail);
        if (!confirm("Confirm to Delete?")) return false;

        if(oFabricSizingPlanDetail.FSPDID<=0)
        {
            $("#tblFSPDetail").datagrid("deleteRow", nIndex);
        }
        else
        {
            var obj =
                     {
                         BaseAddress: _sBaseAddress,
                         Object: oFabricSizingPlanDetail,
                         ControllerName: "FabricSizingPlan",
                         ActionName: "DeleteDetail",
                         TableId: "tblFSPDetail",
                         IsWinClose: false
                     };
            $.icsDelete(obj);
        }
        //RefreshSummary();
        editIndex = undefined;
    });

    $("#btnResetBeam").click(function () {

        $("#txtMachine").val("");
        //_oFabricSizingPlan.FMID=0;
    });

    $("#btnPickBeam").click(function () {

        var sMachineName=$.trim($("#txtBeam").val());
        //if(sMachineName==""){ alert("Type machine name to search."); return false; }
        GetBeams(sMachineName);
    });

    $("#txtBeam").keydown(function (e) {
        var nkeyCode = e.keyCode || e.which;
        if(nkeyCode==13){
            var sMachineName=$.trim($("#txtBeam").val());
            //if(sMachineName==""){ alert("Type machine name to search."); return false; }
            GetBeams(sMachineName);
        }
        else if(nkeyCode==8){
            $("#txtBeam").val("");
            //_oFabricSizingPlan.FMID=0;
        }
    });
    function GetBeams(sMachineName){

        var oMachine = {
            BUID:sessionStorage.getItem('BUID'),
            //ResourcesTypeInInt:2,
            Name:sMachineName
        };
        var obj = {
            BaseAddress: _sBaseAddress,
            Object: oMachine,
            ControllerName: "FabricSizingPlan",
            ActionName: "GetBeams",
            IsWinClose: false
        };

        $.icsDataGets(obj, function (response) {

            if (response.status && response.objs.length > 0) {
                if (response.objs[0].FMID > 0) {
                    //debugger;
                    var tblColums = [];
                    var oColumn = { field: "Code", title: "Code", width: 100, align: "left" };tblColums.push(oColumn);
                    oColumn = { field: "Name", title: "Machine Name", width: 150, align: "left" };tblColums.push(oColumn);
                    //oColumn = { field: "Capacity", title: "Capacity", width: 90, align: "left" };tblColums.push(oColumn);
                    //oColumn = { field: "SequenceNo", title: "SL No", width: 150, align: "left" };tblColums.push(oColumn);

                    var oPickerParam = {
                        winid: 'winBeamsPicker',
                        winclass:'clsBeamsPicker',
                        winwidth: 480,
                        winheight: 460,
                        tableid: 'tblBeamsPicker',
                        tablecolumns: tblColums,
                        datalist: response.objs,
                        multiplereturn: true,
                        searchingbyfieldName:'Name',
                        windowTittle: 'Beam List'
                    };
                    $.icsPicker(oPickerParam);
                    IntializePickerbutton(oPickerParam);//multiplereturn, winclassName
                }
                else { alert(response.objs[0].ErrorMessage); }
            }
            else{
                alert("No Beam found.");
            }
        });


    }

    function IsExist(oFSPD)
    {
        var oDUDCD = $('#tblFSPDetail').datagrid('getRows');
        for (var i = 0; i < oDUDCD.length; i++) {
            if (parseInt(oDUDCD[i].BeamID) == parseInt(oFSPD.BeamID) )
            {
                return true;
            }
        }
        return false;
    }

    _nBagCount=0;
    _nQtyPerBag=0;
    var editIndex = undefined;
    function endEditing() {
        if (editIndex == undefined) { return true }
        if ($('#tblFSPDetail').datagrid('validateRow', editIndex)) {
            $('#tblFSPDetail').datagrid('endEdit', editIndex);
            $('#tblFSPDetail').datagrid('selectRow', editIndex);
            var oDUPSDetail = $('#tblFSPDetail').datagrid('getSelected');

            if(oDUPSDetail==undefined){editIndex == undefined; return;}
            //debugger;

            if(_nBagCount!=parseFloat(oDUPSDetail.BagCount) || _nQtyPerBag!=parseFloat(oDUPSDetail.QtyPerBag))
            {
                if(parseFloat(oDUPSDetail.BagCount)>0 && parseFloat(oDUPSDetail.QtyPerBag)>0)
                {
                    oDUPSDetail.Qty= oDUPSDetail.BagCount*oDUPSDetail.QtyPerBag;
                }
                _nBagCount=parseFloat(oDUPSDetail.BagCount);
                _nQtyPerBag=parseFloat(oDUPSDetail.QtyPerBag);
            }


            $('#tblFSPDetail').datagrid('updateRow', { index: editIndex, row: oDUPSDetail });

            //RefreshSummary();
            editIndex = undefined;
            return true;
        }
        else {
            return false;
        }
    }

    function onClickRow(index) {

        if (editIndex != index) {
            if (endEditing()) {
                $('#tblFSPDetail').datagrid('selectRow', index).datagrid('beginEdit', index);


                var oDUPSDetail= $('#tblFSPDetail').datagrid('getSelected');
                _nBagCount=parseFloat(oDUPSDetail.BagCount);
                _nQtyPerBag=parseFloat(oDUPSDetail.QtyPerBag);

                editIndex = index;
            }
            else {
                $('#tblFSPDetail').datagrid('selectRow', editIndex);
            }
        }
    }
    //end fabric sizing plan


    function IntializePickerbutton(oPickerobj) {
        $("#" + oPickerobj.winid).find("#btnOk").click(function () {
            //for Single Select
            SetPickerValueAssign(oPickerobj);
        });
        $(document).find('.' + oPickerobj.winclass).keydown(function (e) {
            if (e.which == 13)//enter=13
            {
                SetPickerValueAssign(oPickerobj);

            }
        });
    }

    function SetPickerValueAssign(oPickerobj) {
        //debugger;
        var oreturnObj = null, oreturnobjs = [];
        if (oPickerobj.multiplereturn) {
            oreturnobjs = $('#' + oPickerobj.tableid).datagrid('getChecked');
        } else {
            oreturnObj = $('#' + oPickerobj.tableid).datagrid('getSelected');
        }
        $("#" + oPickerobj.winid).icsWindow("close");
        $("#" + oPickerobj.winid).remove();

        if (oPickerobj.winid == 'winMachinePicker')
        {debugger;
            if(oreturnObj !=null  && oreturnObj.FMID>0){

                $('#txtMachine').val(oreturnObj.Name);
                //_oFabricWarpPlan.FMID= oreturnObj.FMID;
                $("#divFabricWarpPlan").data("MachineID",oreturnObj.FMID);
                SetLastScheduleTime();
            }
            else{
                alert("Please select machine.");
            }
        }
        else if (oPickerobj.winid == 'winMachinePickerFSP')
        {debugger;
            if(oreturnObj !=null  && oreturnObj.FMID>0){

                $('#txtMachineFSP').val(oreturnObj.Name);
                //_oFabricWarpPlan.FMID= oreturnObj.FMID;
                $("#winDUFabricSizingPlan").data("MachineID",oreturnObj.FMID);
                SetLastScheduleTimeFSP();
            }
            else{
                alert("Please select machine.");
            }
        }
        else if (oPickerobj.winid == 'winBeamsPicker')
        {
            if(oreturnobjs !=null  && oreturnobjs.length>0){
                debugger;
                //endEditing();
                $('#txtBeam').val("");
                for (i=0; i<oreturnobjs.length;i++)
                {
                    var  oFSPD={FabricSizingPlanID:_oFabricSizingPlan.FabricSizingPlanID, FSPDID:0, BeamName:oreturnobjs[i].MachineCodeWithName ,BeamID:oreturnobjs[i].FMID,SizingBeamNo:""};
                    var bExists= IsExist(oFSPD)
                    if(!bExists)
                    {
                        $('#tblFSPDetail').datagrid('appendRow', oFSPD);
                    }
                    else
                    {
                        alert("Already Exists");
                        return;
                    }

                }
            }
            else{
                alert("Data not found!!");
            }
        }

    }



</script>