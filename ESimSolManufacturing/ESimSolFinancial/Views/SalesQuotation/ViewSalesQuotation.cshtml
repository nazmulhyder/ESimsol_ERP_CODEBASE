<html>
@{
    ViewBag.Title = "Sales Quotation Entry";
}
<body>
    @model ESimSol.BusinessObjects.SalesQuotation
    <script src="~/Views/VehicleChassis/VehicleChassiss.js"></script>
    <script src="~/Views/VehicleEngine/VehicleEngine.js"></script>
    <div id="winNewFeature" class="easyui-window" title="New Feature" style="width:600px" data-options="modal:true,closed:true,collapsible:false,minimizable:false,maximizable:false,closable:false">
        <div style="font-family:Tahoma">
            <fieldset>
                <legend style="font-weight:bold; font-size:12px">Fature Info: </legend>
                <table border="0" cellpadding="2" cellspacing="2" style=" width:100%; font-size:12px">
                    <tr>
                        <td style=" width:10%; text-align:right; padding-right:5px">Code:</td>
                        <td style=" width:25%">
                            <input type="text" id="txtNewFeatureCode" style="width:100%; " />
                        </td>
                        <td style=" width:20%; text-align:right">Feature Name:</td>
                        <td style=" width:45%">
                            <input type="text" id="txtNewFeatureName" style="width:100%;" />
                        </td>
                       
                    </tr>
                    <tr>
                         <td style=" width:10%; text-align:right;  padding-right:5px;">Price:</td>
                        <td style=" width:25%">
                            <input type="text" id="txtNewFeaturePrice" style="width:100%; " />
                        </td>
                        <td style=" width:20%; text-align:right;">Remarks:</td>
                        <td style=" width:45%">
                            <input type="text" id="txtNewFeatureRemarks" style="width:100%; " />
                        </td>
                    </tr>
                </table>
            </fieldset>
            <fieldset>
                <legend style="font-weight:bold; font-size:12px"> Actions : </legend>
                <table border="0" cellpadding="2" cellspacing="2" style=" width:100%; font-size:12px">
                    <tr>
                        <td style="width:60%; text-align:center; font-weight: bold"></td>
                        <td style=" width:40%; text-align:right; font-weight: bold">
                            <input type="button" id="btnSaveNewFeatureWin" value="Save" />
                            <input type="button" id="btnCloseFeatureWin" value="Close" />
                        </td>
                    </tr>
                </table>
            </fieldset>
        </div>
    </div>

    <div class="menuMainCollectionTable" ng-app="SalesQuotationApp" ng-controller="SalesQuotationController as MLCC" id="divSalesQuotation" style="height:97%">
        <div style="height:5%; overflow:hidden; padding-left:5px;" class="ui-grid-top-panel">
            <label style="">Sales Quotation Entry :</label>
        </div>
        <div style="height:87%; overflow:scroll; padding-top:10px">
        <div style="font-family:Tahoma;text-align:center;height:90%" class="regionVR">
            <div class="col-md-12">
                <div class="col-md-7 align-left">
                    <div class="col-md-12">
                        <div class="col-md-4 text-right">
                            <label class="control-label">Ref No:</label>
                        </div>
                        <div class="col-md-8 text-left">
                            <div class="col-md-3">
                                <input ng-model="SalesQuotation.RefNo" class="form-control" disabled />
                            </div>
                            <div class="col-md-3" style="text-align:right;">
                                <label class="control-label">Quotation Date:</label>
                            </div>
                            <div class="col-md-3">
                                <div class="input-group date date-container">
                                    <input type="text" class="form-control" ng-model="SalesQuotation.QuotationDateInString"><span class="input-group-addon"><i class="glyphicon glyphicon-th"></i></span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="col-md-12">
                        <div class="col-md-4 text-right">
                            <label class="control-label">Market Person:</label>
                        </div>
                        <div class="col-md-8 text-left">
                            <div class="col-md-3">
                                <select ng-model="SalesQuotation.MarketingPerson" class="form-control" ng-options="oItem.MarketingAccountID as oItem.Name for oItem in MarketingAccounts">
                                    <option value="">--Select One--</option>
                                </select>
                            </div>
                            <div class="col-md-3" style="text-align:right;">
                                <label class="control-label">Quotation Type:</label>
                            </div>
                            <div class="col-md-3">
                                <select ng-model="SalesQuotation.QuotationTypeInInt" ng-change="ChangeQuotationType()" class="form-control" ng-options="oItem.id as oItem.Value for oItem in QuotationTypes"></select>
                            </div>
                        </div>
                    </div>

                    <div class="col-md-12">
                        <div class="col-md-4 text-right">
                            <label class="control-label">Customer Name:</label>
                        </div>
                        <div class="col-md-8 text-left">
                            <div class="input-group">
                                <input type="text" ng-model="SalesQuotation.BuyerName" class="form-control" ng-keydown="SearchKeyDownBuyer($event)" placeholder="Type Customer Name & Press Enter" required />
                                <span class="input-group-btn">
                                    <button style="margin-left:3px" type="button" class="btn btn-sm" aria-label="left Align" ng-click="ClearBuyer()">C </button>
                                    <button style="margin-left:3px" type="button" class="btn btn-sm" aria-label="Left Align" ng-click="PickBuyer()"> <span class="glyphicon glyphicon-search" aria-hidden="true"></span></button>
                                </span>
                            </div>
                        </div>
                    </div>

                    <div class="col-md-12">
                        <div class="col-md-4 text-right">
                            <label class="control-label">Komm No:</label>
                        </div>
                        <div class="col-md-8 text-left">
                            <div class="input-group">
                                <input ng-model="SalesQuotation.KommNo" class="form-control" ng-disabled="KommFileControl" ng-keydown="SearchKeyDownKommFile($event)" placeholder="Type Komm No & Press Enter" required />
                                <span class="input-group-btn">
                                    <button style="margin-left:3px" type="button" class="btn btn-sm" aria-label="left Align" ng-disabled="KommFileControl" ng-click="ClearKommFile()"> C </button>
                                    <button style="margin-left:3px" type="button" class="btn btn-sm" aria-label="Left Align" ng-disabled="KommFileControl" ng-click="PickKommFile()"> <span class="glyphicon glyphicon-search" aria-hidden="true"></span></button>
                                </span>
                            </div>

                        </div>
                    </div>

                    <div class="col-md-12">
                        <div class="col-md-4 text-right">
                            <label class="control-label">Model No:</label>
                        </div>
                        <div class="col-md-8 text-left">
                            <div class="input-group">
                                <input ng-model="SalesQuotation.ModelNo" class="form-control" ng-disabled="ModelControl" ng-keydown="SearchKeyVehicleModelNo($event)" placeholder="Model No" disabled />
                                <span class="input-group-btn">
                                    <button style="margin-left:3px" type="button" class="btn btn-sm" aria-label="left Align" ng-disabled="ModelControl" ng-click="ClearModel()"> C </button>
                                    <button style="margin-left:3px" type="button" class="btn btn-sm" aria-label="Left Align" ng-disabled="ModelControl" ng-click="PickVehicleModel()"> <span class="glyphicon glyphicon-search" aria-hidden="true"></span></button>
                                </span>
                            </div>
                        </div>
                    </div>

                    <div class="col-md-12">
                        <div class="col-md-4 text-right">
                            <label class="control-label">Model Year:</label>
                        </div>
                        <div class="col-md-8 text-left">
                            <div class="col-md-3">
                                <input ng-model="SalesQuotation.ModelSessionName" class="form-control" disabled />
                            </div>
                            <div class="col-md-3" style="text-align:right;">
                                <label class="control-label">Seating Capacity:</label>
                            </div>
                            <div class="col-md-3">
                                <input ng-model="SalesQuotation.SeatingCapacity" class="form-control" disabled />
                            </div>
                        </div>
                    </div>

                    <div class="col-md-12">
                        <div class="col-md-4 text-right">
                            <label class="control-label">Exterior Color:</label>
                        </div>
                        <div class="col-md-8 text-left">
                            <div class="input-group">
                                <input ng-model="SalesQuotation.ExteriorColorName" ng-disabled="ModelControl" ng-keydown="SearchKeyDownExteriorColor($event)" placeholder="Type Exterior Color Name" class="form-control" />
                                <span class="input-group-btn">
                                    <button style="margin-left:3px" type="button" class="btn btn-sm" aria-label="left Align" ng-disabled="ModelControl" ng-click="ClearExteriorColor()"> C </button>
                                    <button type="button" class="btn btn-sm" aria-label="Left Align" ng-disabled="ModelControl" ng-click="PickColorName(1)"> <span class="glyphicon glyphicon-search" aria-hidden="true"></span></button>
                                </span>
                            </div>
                        </div>
                    </div>

                    <div class="col-md-12">
                        <div class="col-md-4 text-right">
                            <label class="control-label">Interior Color:</label>
                        </div>
                        <div class="col-md-8 text-left">
                            <div class="input-group">
                                <input ng-model="SalesQuotation.InteriorColorName" class="form-control" ng-keydown="SearchKeyDownInteriorColor($event)" placeholder="Type Interior Color Name" ng-disabled="ModelControl" />
                                <span class="input-group-btn">
                                    <button style="margin-left:3px" type="button" class="btn btn-sm" ng-disabled="ModelControl" aria-label="left Align" ng-click="ClearInteriorColor()"> C </button>
                                    <button type="button" class="btn btn-sm" aria-label="Left Align" ng-disabled="ModelControl" ng-click="PickColorName(2)"> <span class="glyphicon glyphicon-search" aria-hidden="true"></span></button>
                                </span>
                            </div>
                        </div>
                    </div>

                    <div class="col-md-12">
                        <div class="col-md-4 text-right">
                            <label class="control-label">Upholstery:</label>
                        </div>
                        <div class="col-md-8 text-left">
                            <div class="input-group">
                                <input ng-model="SalesQuotation.Upholstery" ng-disabled="ModelControl" class="form-control" ng-keydown="SearchKeyDownUpholstery($event)" placeholder="Type Upholstery & Press Enter" required />
                                <span class="input-group-btn">
                                    <button type="button" class="btn btn-sm" ng-disabled="ModelControl" aria-label="Left Align" ng-click="PickColorName(3)"> <span class="glyphicon glyphicon-search" aria-hidden="true"></span></button>
                                </span>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-12">
                        <div class="col-md-4 text-right">
                            <label class="control-label">Trim:</label>
                        </div>
                        <div class="col-md-8 text-left">
                            <div class="input-group">
                                <input ng-model="SalesQuotation.Trim" class="form-control" ng-disabled="ModelControl" ng-keydown="SearchKeyDownTrim($event)" placeholder="Type Code or Name & Press Enter" required />
                                <span class="input-group-btn">
                                    <button type="button" class="btn btn-sm" ng-disabled="ModelControl" aria-label="Left Align" ng-click="PickParts(1)"> <span class="glyphicon glyphicon-search" aria-hidden="true"></span></button>
                                </span>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-12">
                        <div class="col-md-4 text-right">
                            <label class="control-label">Wheels:</label>
                        </div>
                        <div class="col-md-8 text-left">
                            <div class="input-group">
                                <input ng-model="SalesQuotation.Wheels" class="form-control" ng-disabled="ModelControl" ng-keydown="SearchKeyDownWheels($event)" placeholder="Type Code or Name & Press Enter" required />
                                <span class="input-group-btn">
                                    <button type="button" class="btn btn-sm" ng-disabled="ModelControl" aria-label="Left Align" ng-click="PickParts(2)"> <span class="glyphicon glyphicon-search" aria-hidden="true"></span></button>
                                </span>
                            </div>
                        </div>
                    </div>

                    <div class="col-md-12">
                        <div class="col-md-4 text-right">
                            <label class="control-label">Chassis No:</label>
                        </div>
                        <div class="col-md-8 text-left">
                            <div class="input-group">
                                <input ng-model="SalesQuotation.ChassisNo" class="form-control" ng-keydown="SearchKeyDownChassis($event)" ng-disabled="ModelControl" placeholder="Chassis No" />
                                <span class="input-group-btn">
                                    <button style="margin-left:3px" type="button" class="btn btn-sm" ng-disabled="ModelControl" aria-label="left Align" ng-click="ClearChassis()">C </button>
                                    <button type="button" class="btn btn-sm" aria-label="Left Align" ng-disabled="ModelControl" ng-click="PickChassisNo()"> <span class="glyphicon glyphicon-search" aria-hidden="true"></span></button>
                                </span>
                            </div>
                        </div>
                    </div>

                    <div class="col-md-12">
                        <div class="col-md-4 text-right">
                            <label class="control-label">Engine No:</label>
                        </div>
                        <div class="col-md-8 text-left">
                            <div class="input-group">
                                <input ng-model="SalesQuotation.EngineNo" class="form-control" ng-keydown="SearchKeyDownEngine($event)" ng-disabled="ModelControl" placeholder="Engine No" />
                                <span class="input-group-btn">
                                    <button style="margin-left:3px" type="button" class="btn btn-sm" ng-disabled="ModelControl" aria-label="left Align" ng-click="ClearEngine()">C </button>
                                    <button type="button" class="btn btn-sm" aria-label="Left Align" ng-disabled="ModelControl" ng-click="PickEngineNo()"> <span class="glyphicon glyphicon-search" aria-hidden="true"></span></button>
                                </span>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-md-5">
                    <fieldset style="height:268px;">
                        <legend>Image</legend>
                        <div class="col-md-12">
                            <img id="imgOrderImage" src="@Url.Action("GetLargeImage", "SalesQuotation", new { id = Model.VehicleOrderImageID, SQImageid = Model.SalesQuotationImageID })" alt="Photo" style="width:90%; height:240px; vertical-align:middle; text-align:center;" />
                        </div>
                    </fieldset>
                </div>
            </div>
            <div class="col-md-12">
                <div class="col-md-7 align-left">
                    <div class="col-md-4 text-right">
                        <label class="control-label">Manufacturer:</label>
                    </div>
                    <div class="col-md-8 align-left">
                        <input ng-model="SalesQuotation.ManufacturerName" class="form-control" placeholder="EManufacturer" disabled />
                    </div>
                </div>
                <div class="col-md-5">
                    <div class="col-md-5 text-right">
                        <label class="control-label">Year of Manufacture:</label>
                    </div>
                    <div class="col-md-7 align-left">
                        <input ng-model="SalesQuotation.YearOfManufacture" class="form-control" placeholder="year of Manufacture" disabled />
                    </div>
                </div>

            </div>
            <div class="col-md-12">
                <div class="col-md-7 align-left">
                    <div class="col-md-4 text-right">
                        <label style="font-size:9px;">Max Output(Ps/Rpm):</label>
                    </div>
                    <div class="col-md-8 text-left">
                        <div class="col-md-3">
                            <input ng-model="SalesQuotation.MaxPowerOutput" class="form-control" disabled />
                        </div>
                        <div class="col-md-3" style="text-align:right;">
                            <label style="font-size:9px;">Max Torque(Nm/Rpm):</label>
                        </div>
                        <div class="col-md-3">
                            <input ng-model="SalesQuotation.MaximumTorque" class="form-control" disabled />
                        </div>
                    </div>
                </div>
                <div class="col-md-5">
                    <div class="col-md-5 text-right">
                        <label class="control-label">Country of Origin:</label>
                    </div>
                    <div class="col-md-7 align-left">
                        <input ng-model="SalesQuotation.CountryOfOrigin" class="form-control" disabled />
                    </div>
                </div>
            </div>
            <div class="col-md-12">
                <div class="col-md-7 align-left">
                    <div class="col-md-4 text-right">
                        <label class="control-label">Engine Type :</label>
                    </div>
                    <div class="col-md-8 align-left">
                        <input ng-model="SalesQuotation.EngineType" class="form-control" placeholder="Engine No" disabled />
                    </div>
                </div>
                <div class="col-md-5">
                    <div class="col-md-5 text-right">
                        <label class="control-label">Transmission :</label>
                    </div>
                    <div class="col-md-7 align-left">
                        <input ng-model="SalesQuotation.Transmission" class="form-control" placeholder="Engine No" disabled />
                    </div>
                </div>

            </div>
            <div class="col-md-12">
                <div class="col-md-2 text-right">
                    <label class="control-label">Remarks :</label>
                </div>
                <div class="col-md-10 align-left">
                    <input type="text" ng-model="SalesQuotation.Remarks" class="form-control" />
                </div>
            </div>
            <div class="col-md-12">
                <div class="col-md-7 align-left">
                    <div class="col-md-4 text-right">
                        <label class="control-label">Feature :</label>
                    </div>
                    <div class="col-md-8 align-left">
                        <input type="text" id="FeatureSetupName" ng-model="SalesQuotation.FeatureSetupName" class="form-control" />
                    </div>
                </div>
                <div class="col-md-5">
                    <div class="col-md-5 text-right">
                        <label class="control-label">Currency :</label>
                    </div>
                    <div class="col-md-7 align-left">
                        <select ng-model="SalesQuotation.CurrencyID" class="form-control" ng-options="oItem.CurrencyID as oItem.CurrencyName for oItem in CurrencyList" >
                            <option value="">--Select Currency--</option>
                        </select>
                    </div>
                </div>

            </div>
            <div class="col-md-12">
                <div class="col-md-7">
                    <div class="ui-grid-panel col-md-12" style="text-align:left;">
                        <label>Feature:</label><input ng-model="txtFeatureName" placeholder="Type Feature & Press Enter" ng-keydown="SearchKeyFeatureNo($event)" style="width:210px; height:24px;" required />
                        <button type="button" class="btn btn-default btn-xs" aria-label="right Align" ng-click="PickFeature()"><span class="glyphicon glyphicon-ok" aria-hidden="true"> Pick</span></button>
                        <button type="button" class="btn btn-default btn-xs" aria-label="right Align" ng-click="NewFeature()"><span class="glyphicon glyphicon-ok" aria-hidden="true"> New</span></button>
                        <button type="button" class="btn btn-default btn-xs" aria-label="right Align" ng-click="RemoveDetail()"><span class="glyphicon glyphicon-remove" aria-hidden="true"> Remove</span></button>
                        <button type="button" class="btn btn-default btn-xs" aria-label="right Align" ng-click="RefreshDetail(2)"><span class="glyphicon glyphicon-refresh" aria-hidden="true"></span></button>
                    </div>
                    <div style="width: 100%; height:214px; margin-right:0" class="col-md-12" ui-grid="gridOptionsSalesQuotationDetail" ui-grid-selection ui-grid-edit ui-grid-cellnav></div>
                    <div class="col-md-12">
                            <div class="col-md-3" style="text-align:right; margin-left:15px">
                                <label style="font-size:9px;">Discount(%):</label>
                            </div>
                            <div class="col-md-2">
                                <input type="text" ng-model="SalesQuotation.DiscountPercent" ng-change="SetOptionTotal(1)" class="form-control number" style="text-align:right;" />
                            </div> 
                            <div class="col-md-2" style="text-align:right; margin-left:10px">
                                <label style="font-size:9px;">Amount:</label>
                            </div>
                            <div class="col-md-3 text-left">
                                <input type="text" ng-model="SalesQuotation.DiscountAmount" ng-change="SetOptionTotal(2)" class="form-control number" style="text-align:right;" step="0.01" />
                            </div>
                    </div>
                    <div class="col-md-12">
                        <div class="col-md-12 text-left">
                            <div class="col-md-8" style="text-align:right;">
                                <label style="font-size:9px;">Total Optional Items Price after <label style="font-size:9px;" ng-bind="SalesQuotation.DiscountPercent"></label>% Discount(Rounded up):</label>
                            </div>
                            <div class="col-md-4">
                                <input id="OptionalTotalDiscountAmount" ng-model="SalesQuotation.OptionalTotalDiscountAmount | number:2" ng-change="SetOptionTotal(0)" class="form-control number" disabled />
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-md-5 regionVR" style="text-align:right; margin-top:25px; height:218px">
                    <fieldset style="height:100%; margin-left:10px">
                        <div class="col-md-12">
                            <div class="col-md-3 text-right">
                                <label class="control-label">Offer Price:</label>
                            </div>
                            <div class="col-md-11 text-left">
                                <div class="input-group">
                                    <input ng-model="SalesQuotation.OfferPrice | number:2" class="form-control number input-sm text-right" style="height:25px; width:50%" ng-change="SetTotal()" disabled />
                                    <input type="text" ng-model="SalesQuotation.NewOfferPrice" class="form-control number input-sm text-right" style="height:25px; width:50%" ng-change="SetTotal()" />
                                </div>
                            </div>
                        </div>
                        <div class="col-md-12">
                            <div class="col-md-3 text-right">
                                <label class="control-label">Option Total:</label>
                            </div>
                            <div class="col-md-11 text-right">
                                <input type="text" ng-model="SalesQuotation.OptionTotal | number:2" class="form-control input-sm text-right number" style="height:22px;" disabled />
                            </div>
                        </div>
                        
                        <div class="col-md-12">
                            <div class="col-md-3 text-right">
                                <label class="control-label">Vat Amount:</label>
                            </div>
                            <div class="col-md-11 text-right">
                                <input type="text" ng-model="SalesQuotation.VatAmount" class="form-control input-sm  number text-right" style="height:22px" ng-change="SetTotal()" />
                            </div>
                        </div>

                        <div class="col-md-12">
                            <div class="col-md-3 text-right">
                                <label class="control-label">TDS Amount:</label>
                            </div>
                            <div class="col-md-11 text-right">
                                <input type="text" ng-model="SalesQuotation.TDSAmount" class="form-control input-sm  number text-right" style="height:22px" ng-change="SetTotal()" />
                            </div>
                        </div>

                        <div class="col-md-12">
                            <div class="col-md-3 text-right">
                                <label class="control-label">Reg Fee:</label>
                            </div>
                            <div class="col-md-11 text-right">
                                <input type="text" ng-model="SalesQuotation.RegistrationFee" class="form-control input-sm  number text-right" style="height:22px" ng-keyup="SetTotal()" />
                            </div>
                        </div>

                        <div class="col-md-12">
                            <div class="col-md-3 text-right">
                                <label class="control-label">Total Amount:</label>
                            </div>
                            <div class="col-md-11 text-right">
                                <input type="text" ng-model="SalesQuotation.TotalAmount | number:2" class="form-control input-sm text-right number" style="height:22px" disabled />
                            </div>
                        </div>

                        <div class="col-md-12">
                            <div class="col-md-3 text-right">
                                <label class="control-label">Discount Price:</label>
                            </div>
                            <div class="col-md-11 text-left">
                                <input type="text" ng-model="SalesQuotation.DiscountPrice" class="form-control number input-sm text-right" style="height:25px" ng-change="SetTotal()" />
                            </div>
                        </div>

                        <div class="col-md-12">
                            <div class="col-md-3 text-right">
                                <label class="control-label">OTR Amount:</label>
                            </div>
                            <div class="col-md-11 text-right">
                                <input ng-model="SalesQuotation.OTRAmount | number:2" class="form-control input-sm text-right number" style="height:22px" disabled />
                            </div>
                        </div>

                        @*<div class="col-md-12">
                            <div class="col-md-3 text-right">
                                <label class="control-label">Unit Price:</label>
                            </div>
                            <div class="col-md-11 text-left">
                                <input ng-model="SalesQuotation.UnitPrice" class="form-control number input-sm text-right" style="height:25px" ng-change="SetTotal()" disabled />
                            </div>
                        </div>*@
                        
                    </fieldset>
                </div>
            </div>
            @*Seals Terms*@
            <div class="col-md-12">
                <fieldset style="height:auto;">
                    <legend>Seals Terms</legend>
                    <div class="col-md-12">
                        <div class="col-md-7 align-left">
                            <div class="col-md-4 text-right">
                                <label class="control-label">Warranty :</label>
                            </div>
                            <div class="col-md-8 align-left">
                                <input type="text" ng-model="SalesQuotation.Warranty" class="form-control" />
                            </div>
                        </div>
                        <div class="col-md-5">
                            <div class="col-md-5 text-right">
                                <label class="control-label">Delivery :</label>
                            </div>
                            <div class="col-md-7 align-left">
                                <input type="text" ng-model="SalesQuotation.DeliveryDate" class="form-control" />
                            </div>
                        </div>
                    </div>
                    <div class="col-md-12">
                        <div class="col-md-2 text-right">
                            <label class="control-label">Advance Payment :</label>
                        </div>
                        <div class="col-md-10 align-left">
                            <div class="col-md-2 text-right" style="margin-left:-10px">
                                <div class="col-md-10">
                                    <input type="text" id="AdvancePaymentInPercent" ng-model="SalesQuotation.AdvancePaymentInPercent" ng-change="AdvancePaymentChange(0)" ng-keyup="AdvancePaymentChange(0)" class="form-control number" />
                                </div>
                                <div>
                                    <label>%</label>
                                </div>
                            </div>
                            <div class="col-md-4 text-right">
                                <input type="text" ng-model="SalesQuotation.AdvancePayment" id="AdvancePayment" ng-change="AdvancePaymentChange(1)" ng-keyup="AdvancePaymentChange(1)" class="form-control number" />
                            </div>
                            <div class="col-md-1 text-right">
                                <input ng-model="SalesQuotation.CurrencyName" class="form-control" disabled />
                            </div>
                            <div class="col-md-5 text-right">
                                <input ng-model="SalesQuotation.AdvancePaymentInWords" class="form-control" disabled />
                            </div>
                        </div>
                    </div>
                    <div class="col-md-12">
                        <div class="col-md-2 text-right">
                            <label class="control-label">Payment Term :</label>
                        </div>
                        <div class="col-md-10 align-left">
                            <input type="text" ng-model="SalesQuotation.PaymentTerm" class="form-control" />
                        </div>
                    </div>
                    <div class="col-md-12">
                        <div class="col-md-2 text-right">
                            <label class="control-label">Validity of Offer :</label>
                        </div>
                        <div class="col-md-10 align-left">
                            <input type="text" ng-model="SalesQuotation.ValidityOfOffer" class="form-control" />
                        </div>
                    </div>
                    <div class="col-md-12">
                        <div class="col-md-2 text-right">
                            <label class="control-label">After Sales Service :</label>
                        </div>
                        <div class="col-md-10 align-left">
                            <input type="text" ng-model="SalesQuotation.AfterSalesService" class="form-control" />
                        </div>
                    </div>
                </fieldset>
            </div>
            <div class="col-md-12">
                <fieldset style="height:auto;">
                    <legend>Other Terms & Condition</legend>
                    <div class="col-md-12" style="text-align: left; ">
                        <label style="text-align:left; text-decoration:underline;">Acceptance:</label>
                    </div>
                    <div class="col-md-12">
                        <textarea ng-model="SalesQuotation.Acceptance" class="form-control" style="width:100%; resize:none; height:100%"></textarea>
                    </div>
                    <div class="col-md-12" style="text-align: left; ">
                        <label style="text-align:left; text-decoration:underline;">Offer Validity:</label>
                    </div>                    <div class="col-md-12">
                        <textarea ng-model="SalesQuotation.OfferValidity" class="form-control" style="width:100%; resize:none; height:100%"></textarea>
                    </div>
                    <div class="col-md-12" style="text-align: left; ">
                        <label style="text-align:left; text-decoration:underline;">Order Specifications:</label>
                    </div>
                    <div class="col-md-12">
                        <textarea ng-model="SalesQuotation.OrderSpecifications" class="form-control" style="width:100%; resize:none; height:100%"></textarea>
                    </div>
                    <div class="col-md-12" style="text-align: left; ">
                        <label style="text-align:left; text-decoration:underline;">Vehicle Inspection:</label>
                    </div>
                    <div class="col-md-12">
                        <textarea ng-model="SalesQuotation.VehicleInspection" class="form-control" style="width:100%; resize:none; height:100%"></textarea>
                    </div>
                    <div class="col-md-12" style="text-align: left; ">
                        <label style="text-align:left; text-decoration:underline;">Cancelling or Changing the Order:</label>
                    </div>
                    <div class="col-md-12">
                        <textarea ng-model="SalesQuotation.CancelOrChangeOrder" class="form-control" style="width:100%; resize:none; height:100%"></textarea>
                    </div>
                    <div class="col-md-12" style="text-align: left; ">
                        <label style="text-align:left; text-decoration:underline;">Vehicle Specifications:</label>
                    </div>
                    <div class="col-md-12">
                        <textarea ng-model="SalesQuotation.VehicleSpecification" class="form-control" style="width:100%; resize:none; height:100%"></textarea>
                    </div>
                    <div class="col-md-12" style="text-align: left; ">
                        <label style="text-align:left; text-decoration:underline;">Mode of Payment:</label>
                    </div>
                    <div class="col-md-12">
                        <textarea ng-model="SalesQuotation.PaymentMode" class="form-control" style="width:100%; resize:none; height:100%"></textarea>
                    </div>
                    <div class="col-md-12" style="text-align: left; ">
                        <label style="text-align:left; text-decoration:underline;">Complementary:</label>
                    </div>
                    <div class="col-md-12">
                        <textarea ng-model="SalesQuotation.Complementary" class="form-control" style="width:100%; resize:none; height:100%"></textarea>
                    </div>
                    <div class="col-md-12" style="text-align: left; ">
                        <label style="text-align:left; text-decoration:underline;">Delivery:</label>
                    </div>
                    <div class="col-md-12">
                        <textarea ng-model="SalesQuotation.DeliveryDescription" class="form-control" style="width:100%; resize:none; height:100%"></textarea>
                    </div>
                    <div class="col-md-12" style="text-align: left; ">
                        <label style="text-align:left; text-decoration:underline;">Price Fluctuation Clause:</label>
                    </div>
                    <div class="col-md-12">
                        <textarea ng-model="SalesQuotation.PriceFluctuationClause" class="form-control" style="width:100%; resize:none; height:100%"></textarea>
                    </div>
                    <div class="col-md-12" style="text-align: left; ">
                        <label style="text-align:left; text-decoration:underline;">Customs Clearance:</label>
                    </div>
                    <div class="col-md-12">
                        <textarea ng-model="SalesQuotation.CustomsClearance" class="form-control" style="width:100%; resize:none; height:100%"></textarea>
                    </div>
                    <div class="col-md-12" style="text-align: left; ">
                        <label style="text-align:left; text-decoration:underline;">Insurance:</label>
                    </div>
                    <div class="col-md-12">
                        <textarea ng-model="SalesQuotation.Insurance" class="form-control" style="width:100%; resize:none; height:100%"></textarea>
                    </div>
                    <div class="col-md-12" style="text-align: left; ">
                        <label style="text-align:left; text-decoration:underline;">Force Majeure:</label>
                    </div>
                    <div class="col-md-12">
                        <textarea ng-model="SalesQuotation.ForceMajeure" class="form-control" style="width:100%; resize:none; height:100%"></textarea>
                    </div>
                    <div class="col-md-12" style="text-align: left; ">
                        <label style="text-align:left; text-decoration:underline;">Fuel Quality:</label>
                    </div>
                    <div class="col-md-12">
                        <textarea ng-model="SalesQuotation.FuelQuality" class="form-control" style="width:100%; resize:none; height:100%"></textarea>
                    </div>
                    <div class="col-md-12" style="text-align: left; ">
                        <label style="text-align:left; text-decoration:underline;">Warranty:</label>
                    </div>
                    <div class="col-md-12">
                        <textarea ng-model="SalesQuotation.WarrantyTerms" class="form-control" style="width:100%; resize:none; height:100%"></textarea>
                    </div>
                    <div class="col-md-12" style="text-align: left; ">
                        <label style="text-align:left; text-decoration:underline;">Special Instruction:</label>
                    </div>
                    <div class="col-md-12">
                        <textarea ng-model="SalesQuotation.SpecialInstruction" class="form-control" style="width:100%; resize:none; height:100%"></textarea>
                    </div>
                </fieldset>
            </div>
        </div>
        </div>
        <div style="font-family:Tahoma;text-align:center;height:10%" class="regionVR">
            <fieldset style="height:60px;">
                <legend>Action</legend>
                <div class="row col-md-12 text-right">
                    <button type="button" class="btn btn-sm" aria-label="Left Align" ng-show="btnSave" ng-click="Save()"> <span class="glyphicon glyphicon-floppy-disk" aria-hidden="true"> <label id="lblSave">Save</label></span> </button>
                    <button type="button" class="btn btn-sm" aria-label="Left Align" ng-show="btnRevise" ng-click="Revise()"> <span class="glyphicon glyphicon-floppy-disk" aria-hidden="true"> <label id="lblSave">Revise</label></span> </button>
                    <button type="button" id="btnclose" class="btn btn-sm" aria-label="Left Align" ng-click="Close()"> <span class="glyphicon glyphicon-remove" aria-hidden="true"> Close</span> </button>
                </div>
            </fieldset>
        </div>
    </div>
</body>
</html>
<style type="text/css">
    .regionVR .form-horizontal .control-label {
        padding-top: 1px;
    }

    .regionVR .form-control {
        height: 24px;
        padding: 0px 6px;
        font-size: 12px;
    }

    .regionVR .col-md-12 {
        width: 100%;
        padding-right: 5px;
        padding-left: 5px;
        margin-bottom: 3px;
    }

    .regionVR .col-md-7 {
        width: 60%;
        padding-right: 5px;
        padding-left: 5px;
    }
    .regionVR .col-md-5 {
        width: 40%;
        padding-right: 5px;
        padding-left: 5px;
    }


     .regionVR .col-md-4 {
        width: 23%;
        padding-right: 5px;
        padding-left: 5px;
    }
    
      .regionVR .col-md-2 {
        width: 14%;
        padding-right:5px;
        padding-left:5px;
    }
         .regionVR .col-md-1 {
        width: 17%;
        padding-right:5px;
        padding-left:5px;
    }
       .regionVR .col-md-10 {
        width: 86%;
        padding-right:8px;
        padding-left: 5px;
    }
    
    .regionVR .col-md-8 {
        width: 77%;
        padding-right: 5px;
        padding-left: 5px;
    }
 
     .regionVR .col-md-3 {
        width: 33.33%;
        padding-right:3px;
        padding-left:3px;
    }
     .regionVR .col-md-6 {
        width: 66.66%;
        padding-right:3px;
        padding-left:3px;
    }
     
     .regionVR .col-md-11 {
        width: 65.66%;
        padding-right:3px;
        padding-left:3px;
    }
     
    .regionVR .btn-sm {
        padding: 2px 8px;
    }

    .regionVR .input-group-addon {
        padding: 2px 5px;
    }

    .ui-grid-top-panel {
        background: linear-gradient(to bottom,#EFF5FF 0,#E0ECFF 100%);
    }
</style>
<script type="text/javascript">
    var oSalesQuotation =@Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(Model));
    var oQuotationTypes = @Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(ViewBag.QuotationTypes));
    var oCurrencyList = @Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(ViewBag.CurrencyList));
    var oMarketingAccounts = @Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(ViewBag.MarketingAccounts));
    var oSalesQuotationDetails= oSalesQuotation.SalesQuotationDetails;    
    var nBaseCurrencyID = @Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(ViewBag.BaseCurrencyID));

    var SalesQuotationApp = angular.module('SalesQuotationApp', ['ngAnimate', 'ui.bootstrap','ui.grid', 'ui.grid.selection', 'ui.grid.edit', 'ui.grid.rowEdit','ui.grid.cellNav', 'ms.service','chassis.service','engine.service']);
    SalesQuotationApp.controller('SalesQuotationController', function ($scope,$http,$uibModal,$log,uiGridConstants,msModal,userSession,icsMethod,msGridControl, chassisservice, engineservice) {
        debugger;
        $('#AdvancePayment').icsCurrencyBox();
        $('#AdvancePaymentInPercent').icsCurrencyBox();
        $('#DiscountAmount').icsCurrencyBox();

        $('.date-container').datepicker({
            format: "dd M yyyy",
            calendarWeeks: true,
            autoclose: true,
            todayHighlight: true
        });
        $scope.SalesQuotation=oSalesQuotation;
        $scope.SalesQuotation.BUID=sessionStorage.getItem('BUID');
        //$scope.selectedOption = $scope.options[1];

        if($scope.SalesQuotation.CurrencyID==0)
            $scope.SalesQuotation.CurrencyID= nBaseCurrencyID;


        if(sessionStorage.getItem("SalesQuotationHeader")=="Copy Sales Quotation")
        {
            $('#lblSave').html('Paste');
            //Reset IDs
            $scope.SalesQuotation.SalesQuotationID = 0;
            for(var i = 0;i<oSalesQuotationDetails.length;i++)
            {
                oSalesQuotationDetails[i].SalesQuotationDetailID = 0;
                oSalesQuotationDetails[i].SalesQuotationID = 0;
            }
        }
        $scope.btnSave=true;
        if(sessionStorage.getItem("SalesQuotationHeader")=="Revise Sales Quotation")
        {
            $scope.btnSave=false;
            $scope.btnRevise=true;
        }
        $scope.SalesQuotationDetails=oSalesQuotationDetails;
        $scope.QuotationTypes = oQuotationTypes;
        $scope.CurrencyList = oCurrencyList;
        $scope.MarketingAccounts = oMarketingAccounts;
        //$scope.SalesQuotation.QuotationTypeInInt = 1;
        debugger;

        $scope.ChangeQuotationType = function()
        {
            $scope.KommFileControl =true;
            $scope.ModelControl = false;
            debugger;
            if($scope.SalesQuotation.QuotationTypeInInt==0)//stock Item
            {
                $scope.KommFileControl = false;
                $scope.ModelControl = true; //Disabled all model control
            }
            else if($scope.SalesQuotation.QuotationTypeInInt==2 && $scope.SalesQuotation.SalesQuotationID>0)
            {
                $scope.KommFileControl = true;
                $scope.ClearBuyer();
                $scope.ClearChassis();
                $scope.ClearModel();
                $scope.ClearKommFile();
                $scope.ClearExteriorColor();
                $scope.ClearInteriorrColor();
                $scope.ModelControl = false; //Enable all model control
            }
        }
        $scope.AdvancePaymentChange= function(nAPC)
        {
            if(nAPC==0)
                $scope.SalesQuotation.AdvancePayment= $scope.SalesQuotation.OTRAmount*($scope.SalesQuotation.AdvancePaymentInPercent/100);
            if(nAPC==1)
                $scope.SalesQuotation.AdvancePaymentInPercent= parseFloat($scope.SalesQuotation.AdvancePayment/$scope.SalesQuotation.OTRAmount)*100;
            $scope.SalesQuotation.AdvancePaymentInWords= TakaWords(parseFloat($scope.SalesQuotation.AdvancePayment));
        }
        $scope.AdvancePaymentChange(1);
        $scope.MakeSalesQuotationDetail= function()
        {
            var oDetailColumns = [];
            var oColumn = { field: 'FeatureCode', name:'Code', width:'20%',cellClass: 'text-left', enableCellEdit:false };oDetailColumns.push(oColumn);
            oColumn ={ field: 'FeatureName', name:'Feature Description', width:'40%',cellClass: 'text-left',enableCellEdit:false };oDetailColumns.push(oColumn);
            oColumn ={ field: 'Remarks', name: 'Remarks', width: '15%', cellClass: 'text-center',enableSorting: false ,enableCellEdit:true};oDetailColumns.push(oColumn);
            oColumn ={ field: 'Price', name: $scope.PriceSymbol, width: '17%',align:'left',cellClass: 'text-right', cellFilter: 'number: 2', enableSorting: false ,enableCellEdit:true, aggregationType: uiGridConstants.aggregationTypes.sum,aggregationHideLabel: true,footerCellClass: 'text-right',footerCellFilter: 'number:2'};oDetailColumns.push(oColumn);

            $scope.gridOptionsSalesQuotationDetail = {
                showColumnFooter: true,
                multiSelect: false,
                enableRowSelection: true,
                enableSelectAll: false,
                columnDefs:oDetailColumns,
                data:oSalesQuotationDetails,
                onRegisterApi: function (gridApi) {

                    $scope.gridDetailApi = gridApi;
                    gridApi.edit.on.afterCellEdit($scope,
                     function (rowEntity, colDef, newValue, oldValue)
                     {
                         $scope.SetOptionTotal(2);
                         //$scope.SalesQuotation.VatAmount   = (parseFloat($scope.SalesQuotation.OptionTotal)*($scope.SalesQuotation.VATPercentage/100)).toFixed(2);
                         return rowEntity;
                     });
                }
            };
            $scope.gridOptionsSalesQuotationDetail.data=$scope.SalesQuotationDetails;
        }
        $scope.MakeSalesQuotationDetail();

        //$scope.SalesQuotation.OptionalTotalDiscountAmount=0;
        $scope.SetOptionTotal=function (nSet)
        {
            debugger;
            var oGriddata = $scope.gridOptionsSalesQuotationDetail.data;
            $scope.OptionTotal = 0;
            if(oGriddata.length>0)
            {
                for(var i =0;i<oGriddata.length;i++)
                {
                    $scope.OptionTotal+= parseFloat(oGriddata[i].Price,0);
                }
            }
            $scope.SalesQuotation.OptionTotal= $scope.OptionTotal;

            if(nSet==1)
            {
                $scope.SalesQuotation.DiscountAmount = (parseFloat($scope.SalesQuotation.OptionTotal * (($scope.SalesQuotation.DiscountPercent)/100))).toFixed(2);
                $scope.SalesQuotation.OptionalTotalDiscountAmount=(parseFloat($scope.OptionTotal)-parseFloat($scope.SalesQuotation.DiscountAmount)).toFixed(2);
            }
            if(nSet==2){
                //$scope.SalesQuotation.DiscountAmount = (parseFloat($scope.SalesQuotation.OptionalTotalDiscountAmount)).toFixed(2);
                if(!isNaN(parseFloat($scope.OptionTotal)) && parseFloat($scope.OptionTotal)>0)
                    $scope.SalesQuotation.DiscountPercent= ((parseFloat($scope.SalesQuotation.DiscountAmount)*100)/parseFloat($scope.OptionTotal)).toFixed(2);
                else  $scope.SalesQuotation.DiscountPercent=0;
                $scope.SalesQuotation.OptionalTotalDiscountAmount=(parseFloat($scope.OptionTotal)-parseFloat($scope.SalesQuotation.DiscountAmount)).toFixed(2);
            }
            //else
            //    $scope.SalesQuotation.OptionalTotalDiscountAmount=parseFloat($scope.OptionTotal)-parseFloat($scope.SalesQuotation.DiscountAmount);

            //$scope.SalesQuotation.OptionTotal= parseFloat($scope.SalesQuotation.DiscountAmount);

            // }
            $scope.SalesQuotation.OptionTotal =  $scope.SalesQuotation.OptionalTotalDiscountAmount;            
            //$scope.SalesQuotation.TotalAmount = (parseFloat($scope.SalesQuotation.OptionTotal) + (parseFloat($scope.SalesQuotation.NewOfferPrice)-parseFloat($scope.SalesQuotation.DiscountPrice))).toFixed(2);
            $scope.SalesQuotation.TotalAmount = (parseFloat($scope.SalesQuotation.NewOfferPrice) + parseFloat($scope.SalesQuotation.OptionTotal) + parseFloat($scope.SalesQuotation.VatAmount)  + parseFloat($scope.SalesQuotation.RegistrationFee) + parseFloat($scope.SalesQuotation.TDSAmount)).toFixed(2);
            $scope.SalesQuotation.OTRAmount   = (parseFloat($scope.SalesQuotation.TotalAmount) - parseFloat($scope.SalesQuotation.DiscountPrice)).toFixed(2);
        }
        $scope.SetTotal = function()
        {
            debugger;
            //if(!isNaN($scope.SalesQuotation.DiscountPrice))
            //    $scope.SalesQuotation.UnitPrice=parseFloat($scope.SalesQuotation.NewOfferPrice)-parseFloat($scope.SalesQuotation.DiscountPrice);

            $scope.SetOptionTotal(2);
            //$scope.TotalAmountInFloat=parseFloat(icsRemoveComma($scope.SalesQuotation.OptionTotal,2),0)+parseFloat($scope.SalesQuotation.UnitPrice,0);
            //$scope.TotalAmount=formatPrice($scope.TotalAmountInFloat)+" ("+$scope.CurrencySymbol+")";
            //$scope.SalesQuotation.VatAmount=(parseFloat($scope.TotalAmountInFloat)-parseFloat($scope.SalesQuotation.UnitPrice))*($scope.VATPercentage/100);
            //$scope.OTRAmount= parseFloat($scope.TotalAmountInFloat,0)+parseFloat($scope.SalesQuotation.VatAmount,0)+parseFloat($scope.SalesQuotation.RegistrationFee,0);
            //$scope.OTRAmount=formatPrice($scope.OTRAmount,0)+" ("+$scope.CurrencySymbol+")";
        }
        $scope.VatReg_Change=function()
        {
            debugger;
            //$scope.SalesQuotation.OTRAmount   = parseFloat($scope.SalesQuotation.TotalAmount,0)+parseFloat($scope.SalesQuotation.VatAmount,0)+parseFloat($scope.SalesQuotation.RegistrationFee,0);
            $scope.SalesQuotation.OTRAmount   = (parseFloat($scope.SalesQuotation.TotalAmount) - parseFloat($scope.SalesQuotation.DiscountPrice)).toFixed(2);
        }
        //$scope.SetTotal();

        $scope.GetSalesQuotationDetails= function()
        {
            debugger;
            var oKommFile= {
                KommFileID:$scope.SalesQuotation.KommFileID
            };
            var config = { headers: { 'Content-Type': 'application/x-www-form-urlencoded;charset=utf-8;' } };
            $http.post(sessionStorage.getItem('BaseAddress')+'/SalesQuotation/GetSalesQuotationDetailsByKommFileID',$.param(oKommFile), config).then(
                                function (response)
                                {
                                    $scope.gridOptionsSalesQuotationDetail.data=[];
                                    result=jQuery.parseJSON(response.data);
                                    $scope.gridOptionsSalesQuotationDetail.data=(result);
                                    $scope.SalesQuotationDetails=result;
                                    $scope.RefreshDetail(2);
                                    $scope.SetOptionTotal(2);
                                    //$scope.SetTotal();
                                }, function () {
                                    $log.info('GetSalesQuotationDetails Dismissed at: ' + new Date());
                                });
        }

        //customer
        $scope.PickBuyer= function ()
        {
            var oContractor = {
                Params: '2' + '~' + $.trim($scope.SalesQuotation.BuyerName)+'~'+sessionStorage.getItem('BUID')
            };
            var config = { headers: { 'Content-Type': 'application/x-www-form-urlencoded;charset=utf-8;' } };
            $http.post(_sBaseAddress+'/Contractor/ContractorSearchByNameType',$.param(oContractor), config).then(
                                function (response)
                                {
                                    var oColumns = [];
                                    var oColumn = { field: 'ContractorID', name: 'Code',width: '20%'  };oColumns.push(oColumn);
                                    oColumn = { field: 'Name', name: 'Applicant Name',width: '50%', enableSorting: false  };oColumns.push(oColumn);
                                    oColumn = { field: 'Address', name: 'Address',width: '30%', enableSorting: false  };oColumns.push(oColumn);
                                    var results=response.data;
                                    var modalObj={
                                        size:'md',
                                        modalcontroller:'ModalCommonListCtrl',
                                        appcontroller:'SalesQuotationController',
                                        objs:results,
                                        multiSelect:false,
                                        pickertitle:'Applicant List',
                                        searchingbyfieldName:'Name',
                                        columns:oColumns
                                    }
                                    var modalInstance=msModal.Instance(modalObj);
                                    modalInstance.result.then(function (result)
                                    {
                                        debugger;
                                        $scope.SalesQuotation.BuyerName=result.Name;
                                        $scope.SalesQuotation.BuyerID=result.ContractorID;
                                    }, function () {
                                        $log.info('Modal dismissed at: ' + new Date());
                                    });
                                },
                                  function (response) { alert(jQuery.parseJSON(response.data).Message);}
                            );

        };
        $scope.SearchKeyDownBuyer = function (e){
            //debugger;
            var code = (e.keyCode ? e.keyCode : e.which);
            if (code == 13) {
                var RefNo = $.trim($scope.SalesQuotation.BuyerName);
                if(RefNo=="" || RefNo==null)
                {
                    alert("Type Buyer and Press Enter");
                    return;
                }
                $scope.PickBuyer();
            }else if (code == 8) //backspace=8
            {
                //debugger;
                $scope.SalesQuotation.BuyerID=0;
            }
        };
        $scope.ClearBuyer= function ()
        {
            $scope.SalesQuotation.BuyerID=0;
            $scope.SalesQuotation.BuyerName='';
        }
        //koomfile
        $scope.PickKommFile= function ()
        {
            var oKommFile = {
                KommNo:$.trim($scope.SalesQuotation.KommNo),
                BUID:sessionStorage.getItem('BUID')
            };
            var config = { headers: { 'Content-Type': 'application/x-www-form-urlencoded;charset=utf-8;' } };
            $http.post(_sBaseAddress+'/KommFile/KommFileSearchByNo',$.param(oKommFile), config).then(
                                function (response)
                                {
                                    var oColumns = [];
                                    var oColumn = { field: 'KommNo', name: 'Komm No',width: '20%'  };oColumns.push(oColumn);
                                    oColumn = { field: 'ModelNo', name: 'Model No',width: '50%', enableSorting: false  };oColumns.push(oColumn);
                                    oColumn = { field: 'InteriorColorName', name: 'Interior Color',width: '30%', enableSorting: false  };oColumns.push(oColumn);
                                    oColumn = { field: 'ExteriorColorName', name: 'Exterior Color',width: '30%', enableSorting: false  };oColumns.push(oColumn);
                                    var results=jQuery.parseJSON(response.data);
                                    var modalObj={
                                        size:'md',
                                        modalcontroller:'ModalCommonListCtrl',
                                        appcontroller:'SalesQuotationController',
                                        objs:results,
                                        multiSelect:false,
                                        pickertitle:'KommFile List',
                                        searchingbyfieldName:'KommNo',
                                        columns:oColumns
                                    }
                                    var modalInstance=msModal.Instance(modalObj);
                                    modalInstance.result.then(function (result)
                                    {
                                        debugger;
                                        $scope.SalesQuotation.KommNo=result.KommNo;
                                        $scope.SalesQuotation.KommFileID=result.KommFileID;
                                        //model
                                        $scope.SalesQuotation.ModelNo=result.ModelNo;
                                        $scope.SalesQuotation.VehicleModelID=result.VehicleModelID;
                                        $scope.SalesQuotation.ModelSessionName=result.ModelSessionName;
                                        $scope.SalesQuotation.SeatingCapacity=result.SeatingCapacity;
                                        //color
                                        $scope.SalesQuotation.ExteriorColorName=result.ExteriorColorName;
                                        $scope.SalesQuotation.ExteriorColorID=result.ExteriorColorID;
                                        $scope.SalesQuotation.InteriorColorName=result.InteriorColorName;
                                        $scope.SalesQuotation.InteriorColorID=result.InteriorColorID;
                                        $scope.SalesQuotation.Upholstery=result.Upholstery;
                                        $scope.SalesQuotation.UpholsteryID=result.UpholsteryID;
                                        //VehicleChassis
                                        $scope.SalesQuotation.VehicleChassisID=result.ChassisID;
                                        $scope.SalesQuotation.ChassisNo=result.ChassisNo;
                                        //VehicleParts
                                        $scope.SalesQuotation.Trim=result.Trim;
                                        $scope.SalesQuotation.TrimID=result.TrimID;
                                        $scope.SalesQuotation.Wheels=result.Wheels;
                                        $scope.SalesQuotation.WheelsID=result.WheelsID;

                                        //VehicleEngine
                                        $scope.SalesQuotation.VehicleEngineID=result.EngineID;
                                        $scope.SalesQuotation.EngineNo=result.EngineNo;
                                        $scope.SalesQuotation.ManufacturerName=result.ManufacturerName;
                                        $scope.SalesQuotation.YearOfManufacture=result.YearOfManufacture;
                                        $scope.SalesQuotation.MaxPowerOutput=result.MaxPowerOutput;
                                        $scope.SalesQuotation.MaximumTorque=result.MaximumTorque;
                                        $scope.SalesQuotation.CountryOfOrigin=result.CountryOfOrigin;
                                        $scope.SalesQuotation.EngineType=result.EngineType;
                                        $scope.SalesQuotation.Transmission=result.Transmission;
                                        $scope.SalesQuotation.CurrencyID=result.Currency
                                        $scope.SalesQuotation.CurrencyName = result.CurrencyName;
                                        $scope.SalesQuotation.OfferPrice = result.UnitPrice;
                                        $scope.SalesQuotation.NewOfferPrice = result.UnitPrice;
                                        $scope.SalesQuotation.VatAmount = result.VatInPercent;

                                        $scope.SalesQuotation.VATPercentage=result.VATPercentage;
                                        $scope.SalesQuotation.ExShowroomPriceBC=result.ExShowroomPriceBC;
                                        $scope.SalesQuotation.RegistrationFee = result.RegistrationFeePercent;
                                       // $scope.SalesQuotation.TotalAmount = result.TotalAmount;
                                        $scope.GetVehicleOrderImage(result.VehicleOrderImageID);
                                        $scope.GetSalesQuotationDetails();

                                    }, function () {
                                        $log.info('Modal dismissed at: ' + new Date());
                                    });
                                },
                                  function (response) { alert(jQuery.parseJSON(response.data).Message);}
                            );

        };
        $scope.SearchKeyDownKommFile = function (e) {
            //debugger;
            var code = (e.keyCode ? e.keyCode : e.which);
            if (code == 13) {
                var RefNo = $.trim($scope.SalesQuotation.KommNo);
                if(RefNo=="" || RefNo==null)
                {
                    alert("Type KommFile and Press Enter");
                    return;
                }
                $scope.PickKommFile();
            }else if (code == 8) //backspace=8
            {
                //debugger;
                $scope.ClearKommFile();
            }
        };
        $scope.ClearKommFile= function ()
        {
            $scope.SalesQuotation.KommNo='';
            $scope.SalesQuotation.KommFileID=0;
            $scope.SalesQuotation.ModelNo='';
            $scope.SalesQuotation.VehicleModelID=0;
            $scope.SalesQuotation.ModelSessionName='';
            $scope.SalesQuotation.SeatingCapacity='';
            //color
            $scope.SalesQuotation.ExteriorColorName='';
            $scope.SalesQuotation.ExteriorColorID=0;
            $scope.SalesQuotation.InteriorColorName='';
            $scope.SalesQuotation.InteriorColorID=0;
            //VehicleChassis
            $scope.SalesQuotation.VehicleChassisID=0;
            $scope.SalesQuotation.ChassisNo='';
            //VehicleEngine
            $scope.SalesQuotation.VehicleEngineID=0;
            $scope.SalesQuotation.EngineNo='';
            $scope.SalesQuotation.ManufacturerName='';
            $scope.SalesQuotation.YearOfManufacture='';
            $scope.SalesQuotation.MaxPowerOutput='';
            $scope.SalesQuotation.MaximumTorque='';
            $scope.SalesQuotation.CountryOfOrigin='';
            $scope.SalesQuotation.EngineType='';
            $scope.SalesQuotation.Transmission='';
            $scope.SalesQuotation.CurrencyID=0;
            $scope.GetSalesQuotationDetails();
            $scope.GetVehicleOrderImage(0);
        }
        //vehicle model
        //$scope.VATPercentage=0;
        //$scope.ExShowroomPriceBC=0;
        $scope.PickVehicleModel= function ()
        {
            debugger;
            var oVehicleModel = {
                ModelNo: $.trim($scope.SalesQuotation.ModelNo)
            };
            var config = { headers: { 'Content-Type': 'application/x-www-form-urlencoded;charset=utf-8;' } };
            $http.post(sessionStorage.getItem('BaseAddress')+'/VehicleModel/GetVehicleModels',$.param(oVehicleModel), config).then(
                        function (response)
                        {
                            var oColumns = [];
                            var oColumn = { field: 'ModelNo', name: 'ModelNo',width: '30%'  };oColumns.push(oColumn);
                            oColumn = { field: 'CategoryName', name: 'CategoryName',width: '40%', enableSorting: false  };oColumns.push(oColumn);
                            var results=jQuery.parseJSON(response.data);
                            var modalObj={
                                size:'md',
                                modalcontroller:'',
                                appcontroller:'',
                                objs:results,
                                multiSelect:false,
                                pickertitle:'Model List',
                                searchingbyfieldName:'ModelNo',
                                columns:oColumns
                            }
                            var modalInstance=msModal.Instance(modalObj);
                            modalInstance.result.then(function (result)
                            {
                                debugger;
                                $scope.SalesQuotation.ModelNo=result.ModelNo;
                                $scope.SalesQuotation.VehicleModelID=result.VehicleModelID;
                                $scope.SalesQuotation.ModelNo=result.ModelNo;
                                $scope.SalesQuotation.VehicleModelID=result.VehicleModelID;
                                $scope.SalesQuotation.ModelSessionName=result.ModelSessionName;
                                $scope.SalesQuotation.SeatingCapacity=result.SeatingCapacity;

                                $scope.SalesQuotation.VATPercentage=result.VATPercentage;
                                $scope.SalesQuotation.ExShowroomPriceBC=result.ExShowroomPriceBC;
                                $scope.SalesQuotation.OfferPrice = result.OfferPrice;
                                $scope.SalesQuotation.NewOfferPrice = result.OfferPrice;
                                $scope.SetOptionTotal(2);
                               // GetVehicleModelImage(result.VehicleModelImageID);//Get Model Image
                            }, function () {
                                $log.info('Modal dismissed at: ' + new Date());
                            });
                        },
                            function (response) { alert(jQuery.parseJSON(response.data).Message);}
                    );

        };
        $scope.SearchKeyVehicleModelNo = function (e) {
            //debugger;
            var code = (e.keyCode ? e.keyCode : e.which);
            if (code == 13) {
                var ModelNo = $.trim($scope.SalesQuotation.ModelNo);
                if(ModelNo=="" || ModelNo==null)
                {
                    alert("Type Model No and Press Enter");
                    return;
                }
                $scope.PickVehicleModel();
            }else if (code == 8) //backspace=8
            {
                //debugger;
                $scope.ClearModel();
            }
        };
        $scope.ClearModel= function ()
        {
            $scope.SalesQuotation.ModelNo='';
            $scope.SalesQuotation.VehicleModelID=0;
            $scope.SalesQuotation.ModelSessionName='';
            $scope.SalesQuotation.SeatingCapacity='';
        }
        //chasis
        $scope.PickChassisNo= function ()
        {
            var oVehicleChassis = {
                ChassisNo: $.trim($scope.SalesQuotation.ChassisNo)
            };
            var config = { headers: { 'Content-Type': 'application/x-www-form-urlencoded;charset=utf-8;' } };
            $http.post(sessionStorage.getItem('BaseAddress')+'/VehicleChassis/SearchByChassisNo',$.param(oVehicleChassis), config).then(
                        function (response)
                        {
                            var oColumns = [];
                            var oColumn = { field: 'FileNo', name: 'File No',width: '30%'  };oColumns.push(oColumn);
                            oColumn = { field: 'ChassisNo', name: 'ChassisNo',width: '60%', enableSorting: false  };oColumns.push(oColumn);
                            var results=jQuery.parseJSON(response.data);
                            var modalObj={
                                size:'sm',
                                modalcontroller:'',
                                appcontroller:'',
                                objs:results,
                                multiSelect:false,
                                pickertitle:'Chassis List',
                                searchingbyfieldName:'ChassisNo',
                                columns:oColumns
                            }
                            var modalInstance=msModal.Instance(modalObj);
                            modalInstance.result.then(function (result)
                            {
                                debugger;
                                $scope.SalesQuotation.ChassisNo=result.ChassisNo;
                                $scope.SalesQuotation.VehicleChassisID=result.VehicleChassisID;

                            }, function () {
                                $log.info('Modal dismissed at: ' + new Date());
                            });
                        },
                            function (response) { alert(jQuery.parseJSON(response.data).Message);}
                    );

        };
        $scope.SearchKeyDownChassis = function (e) {
            //debugger;
            var code = (e.keyCode ? e.keyCode : e.which);
            if (code == 13) {
                var ChassisNo = $.trim($scope.SalesQuotation.ChassisNo);
                if(ChassisNo=="" || ChassisNo==null)
                {
                    alert("Type Chassis No and Press Enter");
                    return;
                }
                $scope.PickChassisNo();
            }else if (code == 8) //backspace=8
            {
                //debugger;
                $scope.ClearChassis();
            }
        };
        $scope.ClearChassis = function () {
            //debugger;
            $scope.SalesQuotation.ChassisNo='';
            $scope.SalesQuotation.VehicleChassisID=0;

        };


        //Engine
        $scope.PickEngineNo= function ()
        {
            var oVehicleEngine = {
                EngineNo: $.trim($scope.SalesQuotation.EngineNo)
            };
            var config = { headers: { 'Content-Type': 'application/x-www-form-urlencoded;charset=utf-8;' } };
            $http.post(sessionStorage.getItem('BaseAddress')+'/VehicleEngine/SearchByEngineNo',$.param(oVehicleEngine), config).then(
                        function (response)
                        {
                            var oColumns = [];
                            var oColumn = { field: 'FileNo', name: 'File No',width: '30%'  };oColumns.push(oColumn);
                            oColumn = { field: 'EngineNo', name: 'EngineNo',width: '60%', enableSorting: false  };oColumns.push(oColumn);
                            var results=jQuery.parseJSON(response.data);
                            var modalObj={
                                size:'sm',
                                modalcontroller:'',
                                appcontroller:'',
                                objs:results,
                                multiSelect:false,
                                pickertitle:'Engine List',
                                searchingbyfieldName:'EngineNo',
                                columns:oColumns
                            }
                            var modalInstance=msModal.Instance(modalObj);
                            modalInstance.result.then(function (result)
                            {
                                debugger;
                                $scope.SalesQuotation.EngineNo=result.EngineNo;
                                $scope.SalesQuotation.VehicleEngineID=result.VehicleEngineID;
                                $scope.SalesQuotation.ManufacturerName=result.ManufacturerName;
                                $scope.SalesQuotation.YearOfManufacture=result.YearOfManufacture;
                                $scope.SalesQuotation.MaxPowerOutput=result.MaxPowerOutput;
                                $scope.SalesQuotation.MaximumTorque=result.MaximumTorque;
                                $scope.SalesQuotation.CountryOfOrigin=result.CountryOfOrigin;
                                $scope.SalesQuotation.EngineType=result.EngineType;
                                $scope.SalesQuotation.Transmission=result.Transmission;
                                $scope.SalesQuotation.CurrencyID=result.CurrencyID;

                            }, function () {
                                $log.info('Modal dismissed at: ' + new Date());
                            });
                        },
                            function (response) { alert(jQuery.parseJSON(response.data).Message);}
                    );

        };
        $scope.SearchKeyDownEngine = function (e) {
            //debugger;
            var code = (e.keyCode ? e.keyCode : e.which);
            if (code == 13) {
                var EngineNo = $.trim($scope.SalesQuotation.EngineNo);
                if(EngineNo=="" || EngineNo==null)
                {
                    alert("Type Engine No and Press Enter");
                    return;
                }
                $scope.PickEngineNo();
            }else if (code == 8) //backspace=8
            {
                //debugger;
                $scope.ClearEngine();
            }
        };
        $scope.ClearEngine = function () {
            //debugger;
            $scope.SalesQuotation.EngineNo='';
            $scope.SalesQuotation.VehicleEngineID=0;
            $scope.SalesQuotation.ManufacturerName='';
            $scope.SalesQuotation.YearOfManufacture='';
            $scope.SalesQuotation.MaxPowerOutput='';
            $scope.SalesQuotation.MaximumTorque='';
            $scope.SalesQuotation.CountryOfOrigin='';
            $scope.SalesQuotation.EngineType='';
            $scope.SalesQuotation.Transmission='';
            $scope.SalesQuotation.CurrencyID=0;
        };
        //Color get
        $scope.PickColorName= function (nColorType)
        {
            var sColorName ="";
            if(nColorType==1)//Exterior
            {
                sColorName =  $.trim($scope.SalesQuotation.ExteriorColorName);
            }else if(nColorType==2)
            {
                sColorName =  $.trim($scope.SalesQuotation.InteriorColorName);
            }else if(nColorType==3)
            {
                sColorName =  $.trim($scope.SalesQuotation.Upholstery);
            }

            var oVehicleColor = {
                ColorName:sColorName,
                ColorType:nColorType
            };
            var config = { headers: { 'Content-Type': 'application/x-www-form-urlencoded;charset=utf-8;' } };
            $http.post(sessionStorage.getItem('BaseAddress')+'/VehicleColor/SearchColor',$.param(oVehicleColor), config).then(
                        function (response)
                        {
                            var oColumns = [];
                            var oColumn = { field: 'ColorCode', name: 'Code',width: '35%'  };oColumns.push(oColumn);
                            oColumn = { field: 'ColorName', name: 'Name',width: '50%', enableSorting: false  };oColumns.push(oColumn);
                            var results=jQuery.parseJSON(response.data);
                            var modalObj={
                                size:'sm',
                                modalcontroller:'',
                                appcontroller:'',
                                objs:results,
                                multiSelect:false,
                                pickertitle:'Color List',
                                searchingbyfieldName:'ColorName',
                                columns:oColumns
                            }
                            var modalInstance=msModal.Instance(modalObj);
                            modalInstance.result.then(function (result)
                            {
                                debugger;
                                if(nColorType==1)//Exterior
                                {
                                    $scope.SalesQuotation.ExteriorColorName = result.ColorName;
                                    $scope.SalesQuotation.ExteriorColorID = result.VehicleColorID;
                                }else if(nColorType==2)//Interior
                                {
                                    $scope.SalesQuotation.InteriorColorName = result.ColorName;
                                    $scope.SalesQuotation.InteriorColorID = result.VehicleColorID;
                                }else if(nColorType==3)//Upholstery
                                {
                                    $scope.SalesQuotation.Upholstery = result.ColorName;
                                    $scope.SalesQuotation.UpholsteryID = result.VehicleColorID;
                                }

                            }, function () {
                                $log.info('Modal dismissed at: ' + new Date());
                            });
                        },
                            function (response) { alert(jQuery.parseJSON(response.data).Message);}
                    );

        };
        $scope.SearchKeyDownExteriorColor = function (e) {
            //debugger;
            var code = (e.keyCode ? e.keyCode : e.which);
            if (code == 13) {
                var ExteriorColorName = $.trim($scope.SalesQuotation.ExteriorColorName);
                if(ExteriorColorName=="" || ExteriorColorName==null)
                {
                    alert("Type Exterior Color and Press Enter");
                    return;
                }
                $scope.PickColorName(1);//Exterior
            }else if (code == 8) //backspace=8
            {
                //debugger;
                $scope.ClearExteriorColor();
            }
        };
        $scope.ClearExteriorColor = function ()
        {
                //debugger;
                $scope.SalesQuotation.ExteriorColorName = '';
                $scope.SalesQuotation.ExteriorColorID = 0;
        }
        $scope.SearchKeyDownInteriorColor = function (e) {
            //debugger;
            var code = (e.keyCode ? e.keyCode : e.which);
            if (code == 13) {
                var InteriorColorName = $.trim($scope.SalesQuotation.InteriorColorName);
                if(InteriorColorName=="" || InteriorColorName==null)
                {
                    alert("Type Interior Color and Press Enter");
                    return;
                }
                $scope.PickColorName(2);//InteriorColorName
            }else if (code == 8) //backspace=8
            {
                //debugger;
                $scope.ClearInteriorrColor();
            }
        };
        $scope.ClearInteriorrColor = function ()
        {
            //debugger;
            $scope.SalesQuotation.InteriorColorName = '';
            $scope.SalesQuotation.InteriorColorID = 0;
        }
        $scope.SearchKeyDownUpholstery = function (e) {
            //debugger;
            var code = (e.keyCode ? e.keyCode : e.which);
            if (code == 13) {
                var Upholstery = $.trim($scope.SalesQuotation.Upholstery);
                if(Upholstery=="" || Upholstery==null)
                {
                    alert("Type Upholstery and Press Enter");
                    return;
                }
                $scope.PickColorName(3);//InteriorColorName
            }else if (code == 8) //backspace=8
            {
                //debugger;
                $scope.ClearUpholstery();
            }
        };
        $scope.ClearUpholstery = function ()
        {
            //debugger;
            $scope.SalesQuotation.Upholstery = '';
            $scope.SalesQuotation.UpholsteryID = 0;
        }
        //Parts
        $scope.PickParts= function (nPartsType)
        {
            var sPartsName ="";
            if(nPartsType==1)//Trim
            {
                sPartsName =  $.trim($scope.SalesQuotation.Trim);
            }else
            {
                sPartsName =  $.trim($scope.SalesQuotation.Wheels);
            }

            var oSalesQuotations = {
                PartsName:sPartsName,
                PartsType:nPartsType
            };
            var config = { headers: { 'Content-Type': 'application/x-www-form-urlencoded;charset=utf-8;' } };
            $http.post(sessionStorage.getItem('BaseAddress')+'/VehicleParts/SearchParts',$.param(oSalesQuotations), config).then(
                        function (response)
                        {
                            var oColumns = [];
                            var oColumn = { field: 'PartsCode', name: 'Code',width: '35%'  };oColumns.push(oColumn);
                            oColumn = { field: 'PartsName', name: 'Name',width: '50%', enableSorting: false  };oColumns.push(oColumn);
                            var results=jQuery.parseJSON(response.data);
                            var modalObj={
                                size:'sm',
                                modalcontroller:'',
                                appcontroller:'',
                                objs:results,
                                multiSelect:false,
                                pickertitle:'Parts List',
                                searchingbyfieldName:'PartsName',
                                columns:oColumns
                            }
                            var modalInstance=msModal.Instance(modalObj);
                            modalInstance.result.then(function (result)
                            {
                                debugger;
                                if(nPartsType==1)//Trim (VehicleParts)
                                {
                                    $scope.SalesQuotation.Trim = result.PartsName;
                                    $scope.SalesQuotation.TrimID = result.VehiclePartsID;
                                }else
                                {
                                    $scope.SalesQuotation.Wheels = result.PartsName;
                                    $scope.SalesQuotation.WheelsID = result.VehiclePartsID;
                                }

                            }, function () {
                                $log.info('Modal dismissed at: ' + new Date());
                            });
                        },
                            function (response) { alert(jQuery.parseJSON(response.data).Message);}
                    );

        };
        $scope.SearchKeyDownTrim = function (e) {
            //debugger;
            var code = (e.keyCode ? e.keyCode : e.which);
            if (code == 13) {
                var Trim = $.trim($scope.SalesQuotation.Trim);
                if(Trim=="" || Trim==null)
                {
                    alert("Type Trim Name/Code and Press Enter");
                    return;
                }
                $scope.PickParts(1);//Exterior color
            }else if (code == 8) //backspace=8
            {
                //debugger;
                $scope.SalesQuotation.Trim = '';
                $scope.SalesQuotation.TrimID = 0;
            }
        }
        $scope.SearchKeyDownWheels = function (e) {
            //debugger;
            var code = (e.keyCode ? e.keyCode : e.which);
            if (code == 13) {
                var Wheels = $.trim($scope.SalesQuotation.Wheels);
                if(Wheels=="" || Wheels==null)
                {
                    alert("Type Wheels Name/Code and Press Enter");
                    return;
                }
                $scope.PickParts(2);//Wheels Part
            }else if (code == 8) //backspace=8
            {
                //debugger;
                $scope.SalesQuotation.Wheels = '';
                $scope.SalesQuotation.WheelsID = 0;
            }
        }

        //Feature
        $scope.RefreshDetail = function (nSet)
        {
            debugger;
            var oList = $scope.gridOptionsSalesQuotationDetail.data;
            $scope.gridOptionsSalesQuotationDetail.data =  oList;
            //$scope.SetOptionTotal(nSet);
            //$scope.SetTotal();
        };
        $scope.PickFeature= function ()
        {
            debugger;
            var oFeature = {
                FeatureName:$scope.txtFeatureName==undefined?"":$scope.txtFeatureName,
                Remarks:'6',//optional feature
            };
            var config = { headers: { 'Content-Type': 'application/x-www-form-urlencoded;charset=utf-8;' } };
            $http.post(sessionStorage.getItem('BaseAddress')+'/VehicleOrder/GetFeatures',$.param(oFeature), config).then(
                        function (response)
                        {
                            var oColumns = [];
                            var oColumn = { field: 'FeatureCode', name: 'Code',width: '30%'  };oColumns.push(oColumn);
                            oColumn = { field: 'FeatureName', name: 'Name',width: '40%', enableSorting: false  };oColumns.push(oColumn);
                            oColumn = { field: 'FeatureTypeST', name: 'Type',width: '30%', enableSorting: false  };oColumns.push(oColumn);
                            var results=jQuery.parseJSON(response.data);
                            var modalObj={
                                size:'md',
                                modalcontroller:'',
                                appcontroller:'',
                                objs:results,
                                multiSelect:true,
                                pickertitle:'Feature List',
                                searchingbyfieldName:'FeatureName',
                                columns:oColumns
                            }
                            var modalInstance=msModal.Instance(modalObj);
                            modalInstance.result.then(function (result)
                            {
                                debugger;
                                if(result.length>0)
                                {

                                    for(var i=0;i<result.length;i++)
                                    {
                                        var oSalesQuotationDetails = $scope.gridOptionsSalesQuotationDetail.data;
                                        if(!icsMethod.ICS_IsExist(oSalesQuotationDetails,'FeatureID', result[i].FeatureID))
                                        {
                                            var oSalesQuotationDetail = {
                                                SalesQuotationDetailID:0,
                                                SalesQuotationID:$scope.SalesQuotation.SalesQuotationID,
                                                FeatureID :result[i].FeatureID,
                                                Remarks : '',
                                                CurrencyID:0,
                                                CurrencyName:'-Select Currency-',
                                                FeatureCode:result[i].FeatureCode,
                                                FeatureName :result[i].FeatureName,
                                                Price:result[i].Price
                                            };
                                            $scope.gridOptionsSalesQuotationDetail.data.push(oSalesQuotationDetail);
                                        }
                                    }
                                }
                                $scope.txtFeatureName='';
                            }, function () {
                                $log.info('Modal dismissed at: ' + new Date());
                            });
                        },
                            function (response) { alert(jQuery.parseJSON(response.data).Message);}
                    );
        };
        $scope.SearchKeyFeatureNo = function (e) {
            //debugger;
            var code = (e.keyCode ? e.keyCode : e.which);
            if (code == 13) {
                var txtFeatureName = $.trim($scope.txtFeatureName);
                if(txtFeatureName=="" || txtFeatureName==null)
                {
                    alert("Type Feature Name and Press Enter");
                    return;
                }
                $scope.PickFeature();
            }else if (code == 8) //backspace=8
            {
                //debugger;
                $scope.txtFeatureName='';
            }
        };


        $scope.NewFeature = function()
        {
            $('#txtNewFeaturePrice').icsCurrencyBox(null, null, 2);
            $('#txtNewFeaturePrice').val(0);
            $('#txtNewFeatureCode,#txtNewFeatureName,#txtNewFeatureRemarks').val('');
            $("#winNewFeature").icsWindow('open', "New Feature Entry");
        }
        
        $('#btnSaveNewFeatureWin').click(function(e) {   
            debugger;
            if($.trim($('#txtNewFeatureCode').val())=="" || $.trim($('#txtNewFeatureCode').val())==null)
            {
                alert("Please Type Feature Code.");
                $('#txtNewFeatureCode').focus();
            }
            if($.trim($('#txtNewFeatureName').val())=="" || $.trim($('#txtNewFeatureName').val())==null)
            {
                alert("Please Type Feature Name.");
                $('#txtNewFeatureName').focus();
            }
            var nNewFeaturePrice = parseFloat(icsRemoveComma($("#txtNewFeaturePrice").val()));
            if(nNewFeaturePrice<=0)
            {
                alert("Price Should be Greater than 0.");
                $('#txtNewFeaturePrice').focus();
            }
            var oTempSalesQuotationDetail = {
                SalesQuotationDetailID:0,
                SalesQuotationID:$scope.SalesQuotation.SalesQuotationID,
                FeatureID :0,
                Remarks :$('#txtNewFeatureRemarks').val(),
                CurrencyID:0,
                CurrencyName:'-Select Currency-',
                FeatureCode:$('#txtNewFeatureCode').val(),
                FeatureName :$('#txtNewFeatureName').val(),
                Price:nNewFeaturePrice
            };
            $scope.gridOptionsSalesQuotationDetail.data.push(oTempSalesQuotationDetail);
            $("#winNewFeature").icsWindow('close');
        });

        $('#btnCloseFeatureWin').click(function(e) {        
            $("#winNewFeature").icsWindow('close');
        });

        $scope.RemoveDetail = function ()
        {
            debugger;
            var oMLCDetail = $scope.gridDetailApi.selection.getSelectedRows()[0];
            if(oMLCDetail==null)
            {
                alert("Select At least One item !");
                return;
            }
            var SelectedRowIndex=$scope.gridOptionsSalesQuotationDetail.data.indexOf(oMLCDetail);
            if (!confirm("Confirm to Delete?")) return ;
            $scope.gridOptionsSalesQuotationDetail.data.splice(SelectedRowIndex,1);
            $scope.RefreshDetail(2);
        };
        $scope.Save = function ()
        {
            debugger;
            //$scope.SetTotal();
            if(!$scope.ValidateInput()) return;
            var oSalesQuotation= $scope.SalesQuotation;
            oSalesQuotation.QuotationDate = new Date($scope.SalesQuotation.QuotationDateInString);
            oSalesQuotation.OrderStatusInInt = 1;//intialize
            oSalesQuotation.SalesQuotationDetails = $scope.gridOptionsSalesQuotationDetail.data;

            $http.post(sessionStorage.getItem('BaseAddress')+'/SalesQuotation/Save',oSalesQuotation).then(
                        function (response)
                        {
                            var oSalesQuotation= jQuery.parseJSON(response.data);
                            if (oSalesQuotation.ErrorMessage=="" || oSalesQuotation.ErrorMessage==null)
                            {
                                debugger;
                                alert("Data Save Successfully!!");
                                var oSalesQuotations = sessionStorage.getItem("SalesQuotationList");
                                var nIndex = parseInt(sessionStorage.getItem("SelectedRowIndex"));
                                if (oSalesQuotations != null) {
                                    oSalesQuotations = jQuery.parseJSON(oSalesQuotations);
                                }
                                else {
                                    oSalesQuotations = [];
                                }
                                if (nIndex != -1) {
                                    oSalesQuotations[nIndex] = oSalesQuotation;
                                }
                                else {
                                    sessionStorage.setItem("SelectedRowIndex", oSalesQuotations.length);
                                    oSalesQuotations.push(oSalesQuotation);
                                }
                                sessionStorage.setItem("SalesQuotations", JSON.stringify(oSalesQuotations));
                                //userSession.setData('SalesQuotations',oSalesQuotations);
                                window.location.href = sessionStorage.getItem("BackLink");
                            }
                            else
                            {
                                alert(oSalesQuotation.ErrorMessage);
                            }

                        },
                            function (response) { alert(jQuery.parseJSON(response.data).Message);$scope.MeasurementUnits=[];}
                    );

        };
        $scope.ValidateInput =  function ()
        {
            debugger;
            if($scope.SalesQuotation.BuyerID==0)
            {
                alert('Please Pick Buyer.');
                return false;
            }
            if($scope.SalesQuotation.VehicleModelID==0)
            {
                alert('Please Pick Komm File or Vehicle Model');
                return false;
            }
            if($scope.SalesQuotation.CurrencyID==0)
            {
                alert('Please Select Currency and Try Again-');
                return false;
            }
            //if($scope.SalesQuotation.FeatureSetupName=="")
            //{
            //    alert('Please Select Feature Setup Name and Try Again-');
            //    angular.element('#FeatureSetupName').focus()
            //    return false;
            //}
            return true;
        };

        $scope.Revise = function ()
        {
            debugger;
            if(!$scope.ValidateInput()) return;
            var oSalesQuotation= $scope.SalesQuotation;
            oSalesQuotation.QuotationDate = new Date($scope.SalesQuotation.QuotationDateInString);
            oSalesQuotation.OrderStatusInInt = 1;//intialize
            oSalesQuotation.SalesQuotationDetails = $scope.gridOptionsSalesQuotationDetail.data;

            $http.post(sessionStorage.getItem('BaseAddress')+'/SalesQuotation/Revise',oSalesQuotation).then(
                        function (response)
                        {
                            var oSalesQuotation= jQuery.parseJSON(response.data);
                            if (oSalesQuotation.ErrorMessage=="" || oSalesQuotation.ErrorMessage==null)
                            {
                                debugger;
                                alert("Revised Successfully!!");
                                userSession.setData('SalesQuotations',oSalesQuotation);
                                userSession.previousPage();
                            }
                            else
                            {
                                alert(oSalesQuotation.ErrorMessage);
                            }

                        },
                            function (response) { alert(jQuery.parseJSON(response.data).Message);$scope.MeasurementUnits=[];}
                    );

        };

        $scope.RefreshDetail(2);
        if(sessionStorage.getItem("SalesQuotationHeader")=="View Sales Quotation")
        {
            $("#divSalesQuotation :input").prop('disabled', true);
            $('#btnclose').prop('disabled', false);
            //$scope.btnSave=true;
            //$scope.btnRevise=false;
        }
        $scope.ChangeQuotationType();
        $scope.Close=function ()
        {
            debugger;
            window.location.href = sessionStorage.getItem("BackLink");
        };

        $scope.GetVehicleOrderImage =function (nVehicleOrderImageID)
        {
            debugger;
            $.ajax({
                cache:true,
                type: "GET",
                url: "@(Url.Action("GetImageInBase64", "VehicleOrder"))",
                data: "id=" + nVehicleOrderImageID,
                success: function (data) {
                    $('#imgOrderImage').attr('src', "data:image/jpg;base64," + data.base64imgage );
                }
            });
        }

    });

</script>