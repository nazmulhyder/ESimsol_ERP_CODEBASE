@model IEnumerable<ESimSol.BusinessObjects.LabDipDetail>
    @{
        ViewBag.Title = " LabDip";
    }
<body>
    <div id="progressbarParent" style="width:100%;height:100%;margin:0 auto;text-align:center; margin-left: auto;margin-right: auto;left: 0;right: 0;z-index: 1;">
        <div style="margin: 0px auto;margin-top: 251px;text-align:center;width:390px;">
            <label style="font-size:18px;">Please wait</label>
            <div id="progressbar" style="width:100%;height:37px;"></div>
        </div>
    </div>

    <div id="winPO" style="width:90%;height: 420px;" class="easyui-window winstyle" title="Add PO" data-options="modal:true,closed:true,collapsible:false,minimizable:false,maximizable:false,closable:false">
        <fieldset>
            <legend>PO</legend>
            <div class="col-md-12">
                <table id="tblLabDipDetailFabric" class="easyui-datagrid" style="height:300px;"
                       data-options="singleSelect: true,fitColumns:false, rownumbers:true, pagination:false, autoRowHeight:false, toolbar: '#toolbarFabric' ">
                    <thead>
                        <tr>
                            <th field="SCNoFull" width="8%" align="center">PO No</th>
                            <th field="FabricNo" width="8%" align="center"><label id="lblLabdipOrderNo">P Number</label></th>
                            <th field="ExeNo" width="8%" align="left">Dispo No</th>
                            <th field="ProductName" width="20%" align="left">Composition</th>
                            <th field="Construction" width="20%" align="center">Construction</th>
                            <th field="BuyerReference" width="15%" align="center">Buyer Ref</th>
                            <th field="WarpWeftTypeSt" width="8%" align="center">Type</th>
                            <th field="ColorName" width="8%" align="center">Color Name</th>
                        </tr>
                    </thead>
                </table>
                <div id="toolbarFabric">
                    @*Is For All? <input type="checkbox" id="chkForAll">*@
                    <label style="padding-left:10px">PO</label>
                    <select style="width:12%;" id="cboPOType"></select>
                    <input id="txtPO" style="width:20%;" class="reset-text" placeholder="Search PO" />
                    <a id="btnPickPO" href="javascript:void(0)" class="easyui-linkbutton ics-pick" iconcls="icon-pick" plain="true"></a>
                    <a id="btnResetPO" href="javascript:void(0)" class="easyui-linkbutton ics-pick" iconcls="icon-clear" plain="true"></a>

                    <input id="txtFabricNo" style="width:20%" class="reset-text" placeholder="P Number " disaled />
                    <input id="txtExeNo" style="width:20%" class="reset-text" placeholder="Dispo Number " disaled />
                    <a id="btnPickFabricExportPIDetail" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-add" plain="true">Pick</a>
                    <a id="btnRemoveDetailFabric" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-remove" plain="true">Remove</a>
                </div>
            </div>
            @*<div class="col-md-12">
                    <div class="col-md-6">
                        <table id="tblColors" class="easyui-datagrid" style="height:200px;" fitcolumns="true" rownumbers="true" pagination="false" singleselect="true" autorowheight="false"  data-options="onLoadSuccess: onLoadSuccess">
                            <thead>
                                <tr>
                                    <th field="ColorCode" width="20%" align="center">Code</th>
                                    <th field="ColorNo" width="20%" align="center">Color No</th>
                                    <th field="LDNo" width="20%" align="center">LD No</label></th>
                                    <th field="ColorName" width="20%" align="center">Color Name</th>
                                    <th field="PantonNo" width="20%" align="center">Panton No</th>
                                </tr>
                            </thead>
                        </table>
                    </div>
                    <div class="col-md-1">
                        <button id="btnAddColor"  <span class="glyphicon glyphicon-arrow-right">  </a>
                        <a id="btnRemoveColor" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-remove" plain="true"></a>
                    </div>
                    <div class="col-md-6">
                        <table id="tblFSCs" class="easyui-datagrid" style="height:200px;" fitcolumns="true" rownumbers="true" pagination="false" singleselect="true" autorowheight="false" data-options="onLoadSuccess: onLoadSuccess">
                            <thead>
                                <tr>
                                    <th field="SCNoFull" width="20%" align="center">PO No</th>
                                    <th field="ExeNo" width="20%" align="left">Dispo No</th>
                                    <th field="Construction" width="20%" align="center">Construction</th>
                                    <th field="LDNo" width="20%" align="center">LD No</label></th>
                                    <th field="ColorName" width="20%" align="center">Color Name</th>
                                </tr>
                            </thead>
                        </table>
                    </div>
                </div>*@
        </fieldset>
        <fieldset class="actionfieldsetstyle">
            <legend>Actions : </legend>
            @*<a id="btnSaveDetailFabric" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-save" plain="true">Save</a>*@
            <a id="btnClosePO" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-cancel" plain="true">Close</a>
        </fieldset>
    </div>
   
    <div class="menuMainCollectionTable">
        <table id="tblLabDipDetail" title="LabDip List" class="easyui-datagrid" style="width: 100%; height:100%; margin: 0;" data-options="singleSelect: true,fitColumns:false, rownumbers:true, pagination:false, autoRowHeight:false, toolbar: '#toolbarLabDipDetail' ">
            <thead>
                <tr>
                    <th field="OrderDateSt" width="8%" align="left">IssueDate</th>
                    <th field="FabricNo" width="10%" align="left">Mkt Ref</th>
                    <th field="ProductName" width="15%" align="left">Yarn Type </th>
                    <th field="OrderTypeSt" width="15%" align="left">OrderType</th>
                    <th field="OrderNo" width="12%" align="left">OrderNo</th>
                    <th field="LabdipNo" width="10%" align="left">Labdip Order No</th>
                    <th field="LDNo" width="10%" align="left">ColorNo(Mkt)</th>
                    <th field="ColorNo" width="10%" align="left">ColorNo</th>
                    <th field="ColorName" width="10%" align="left">ColorName</th>
                    <th field="PantonNo" width="10%" align="left">PantonNo</th>
                    <th field="TwistedSt" width="10%" align="left">Twisted Group</th>
                    <th field="Status" width="10%" align="left">Status</th>
                </tr>
            </thead>
        </table>

        <div id="toolbarLabDipDetail">
            <input id="txtSearchByOrderNo" type="text" placeholder="Order No" style="width:80px" />
            <input id="txtSearchByFabricNo" type="text" placeholder="Mkt Ref No" style="width:80px" />
            <input id="txtSearchByLDOrderNo" type="text" placeholder="LD Order No" style="width:80px" />
            <input id="txtSearchByLDNo" type="text" placeholder="Color No(Mkt)" style="width:80px" />
            <input id="txtSearchByColorNo" type="text" placeholder="Color No" style="width:80px" />
            <input id="txtSearchByPantonNo" type="text" placeholder="Panton No" style="width:80px" />
            <a id="btnAdvSearch" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-search" plain="true">Adv. Search</a>
            <a id="btnReceived" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-ok" plain="true">Receive</a>
            <a id="btnColorNo" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-add" plain="true">Entry Color No</a>
            <a id="btnPantonNo" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-add" plain="true">Entry Panton No</a>
            @*<a id="btnMultipleColor" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-ok" plain="true">Multiple Color</a>*@
            <a id="btnSahdeReceipe" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-add" plain="true">Receipe</a>
            <a id="btnViewSahdeReceipe" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-details" plain="true">Receipe</a>
            <a id="btnViewPO" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-details" plain="true">View PO</a>
            <a id="btnPrint" href="javascript:void(0)" class="easyui-linkbutton initial-state" iconcls="icon-print" plain="true">Print</a>
            <a id="btnPrintRecipe" href="javascript:void(0)" class="easyui-linkbutton initial-state" iconcls="icon-print" plain="true">Preview(Recipe)</a>
            <a id="btnLabdipDone" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-ok" plain="true">LabdipDone</a>
            <a id="btnReviseDetail" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-redo" plain="true">Re-Lab</a>
            <a id="btnSubmit" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-ok" plain="true">Submit</a>
            <a id="btnPrint" href="javascript:void(0)" class="easyui-linkbutton initial-state" iconcls="icon-print" plain="true">Preview(Color)</a>
            <a id="btnPrint_Excel" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-excel" plain="true">Excel</a>
        </div>
    </div>
    <div id="winAdvSearch" class="easyui-window winClass" title="Adv. Search" style="width:500px;" data-options=" modal:true,closed:true,collapsible:false,minimizable:false,maximizable:false,closable:false">
        <table cellpadding="2" cellspacing="2" style="width:100%;">
            <tr>
                <td>
                    <fieldset style="margin-bottom: 0px;">
                        <legend>Searching Criteria</legend>
                        <table cellpadding="2" cellspacing="2">
                            <tr>
                                <td style="width:20%;text-align:right;">
                                    <label>Issue To:</label>
                                </td>
                                <td colspan="3" style=" width:80%;text-align:left;">
                                    <input id="txtContractorAdvS" style="width:75%;" type="text" placeholder="Type & Press Enter" />
                                    <a id="btnPickContractorAdvS" href="javascript:void(0)" class="easyui-linkbutton ics-pick" iconcls="icon-pick" plain="true"></a>
                                    <a id="btnClrContractorAdvS" href="javascript:void(0)" class="easyui-linkbutton ics-pick" iconcls="icon-clear" plain="true"></a>

                                </td>
                            </tr>
                                             
                            <tr>
                                <td style=" width:20%;text-align:right;">
                                    <label>Composition: </label>
                                </td>
                                <td colspan="3" style="width:80%;text-align:left;">
                                    <input id="txtProductName" style="width:75%;" type="text" placeholder="Type & Press Enter" />
                                    <a id="btnProductPiker" href="javascript:void(0)" class="easyui-linkbutton ics-pick" iconcls="icon-pick" plain="true"></a>
                                    <a id="btnClrProductPiker" href="javascript:void(0)" class="easyui-linkbutton ics-pick" iconcls="icon-clear" plain="true"></a>
                                </td>
                            </tr>
                            <tr>
                                <td style=" width:20%;text-align:right;">
                                    <label>Issue Date: </label>
                                </td>
                                <td colspan="3" style="width:80%;text-align:left;">
                                    <select id="cboIssueDateAdvS" style="width:30%;" onchange="DateActionsIssueDateAdv();"></select>
                                    <input id="txtFromIssueDateAdv" type="text" style="width: 100px;" class="easyui-datebox" required="required" data-options="formatter:icsdateformat,parser:icsdateparser" />To
                                    <input id="txtToIssueDateAdv" type="text" style="width: 100px;" class="easyui-datebox" required="required" data-options="formatter:icsdateformat,parser:icsdateparser" />
                                </td>
                            </tr>
                            <tr>
                                <td style=" width:20%;text-align:right;">
                                    <label>Receive Date: </label>
                                </td>
                                <td colspan="3" style="width:80%;text-align:left;">
                                    <select id="cboReceiveDateAdv" style="width:30%;" onchange=" DateActionsReceiveDateAdv(); "></select>
                                    <input id="txtFromReceiveDateAdv" type="text" style="width: 100px;" class="easyui-datebox" required="required" data-options="formatter:icsdateformat,parser:icsdateparser" />To
                                    <input id="txtToReceiveDateAdvSearch" type="text" style="width: 100px;" class="easyui-datebox" required="required" data-options="formatter:icsdateformat,parser:icsdateparser" />
                                </td>
                            </tr>
                            <tr>
                                <td style=" width:20%;text-align:right;">
                                    <label>Submit Date: </label>
                                </td>
                                <td colspan="3" style="width:80%;text-align:left;">
                                    <select id="cboSubmitDateAdvS" style="width:30%;" onchange=" DateActionsSubmitDateAdv(); "></select>
                                    <input id="txtFromSubmitDateAdv" type="text" style="width: 100px;" class="easyui-datebox" required="required" data-options="formatter:icsdateformat,parser:icsdateparser" />To
                                    <input id="txtToSubmitDateAdv" type="text" style="width: 100px;" class="easyui-datebox" required="required" data-options="formatter:icsdateformat,parser:icsdateparser" />
                                </td>
                            </tr>
                                             
                            <tr>
                                <td style=" width:20%;text-align:right;">
                                    <label>Fabric ID: </label>
                                </td>
                                <td style=" width:30%;text-align:left;">
                                    <input id="txtFabricNoAdv" type="text" style="width:100%" />
                                </td>
                                <td style=" width:20%;text-align:right;">
                                    <label>Labdip No </label>
                                </td>
                                <td style=" width:30%;text-align:left;">
                                    <input id="txtLabdipNoAdv" type="text" style="width:95%" />
                                </td>
                            </tr>
                            <tr>
                                <td style=" width:20%;text-align:right;">
                                    <label>Color Name:</label>
                                </td>
                                <td style=" width:30%;text-align:left;">
                                    <input id="txtColorNameAdv" type="text" style="width:100%" />
                                </td>
                                <td style=" width:20%;text-align:right;">
                                    <label>Construction:</label>
                                </td>
                                <td style=" width:30%;text-align:left;">
                                    <input id="txtConstruction" type="text" style="width:95%" />
                                </td>
                            </tr>
                            <tr>
                                <td style=" width:20%;text-align:right;">
                                    <label>In/Out:</label>
                                </td>
                                <td style=" width:30%;text-align:left;">

                                    <select style="width: 120px;" id="cboInOutSide">
                                        <option value="0">-Select-</option>
                                        <option value="1">In House</option>
                                        <option value="2">Out Side</option>
                                    </select>
                                </td>
                                <td style=" width:20%;text-align:right;">
                                    <label>Status:</label>
                                </td>
                                <td style=" width:30%;text-align:left;">
                                    <select style="width: 120px;" id="cboStatus"></select>
                                </td>
                            </tr>

                            <tr>
                                <td height="8px" colspan="4"></td>
                            </tr>
                            @*<tr>
                <td class="btnResetSearch" colspan="4">
                    <a id="btnSearchAdvSearch" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-search" plain="true">Search</a>
                    <a id="btnResetAdvSearch" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-reload" plain="true">Reset</a>
                </td>
            </tr>*@
                        </table>
                    </fieldset>
                </td>
            </tr>
        </table>

        <fieldset class="actionfieldsetstyle">
            <legend>Actions : </legend>
            <label class="lblLoadingMessage" style="float: left;">Loading Please Wait...</label>
            <a id="btnResetAdvSearch" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-reload" plain="true">Reset</a>
            <a id="btnSearchAdvSearch" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-search" plain="true">Search</a>
            <a id="btnCloseAdvSearch" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-cancel" plain="true">Close</a>
        </fieldset>
    </div>
    <div id="WinShadeRecipe" class="easyui-window" title="Sahde & Recipe" data-options="modal:true,closed:true,collapsible:false,minimizable:false,maximizable:false,closable:false">
        <div id="divWinShadeRecipe" tabindex="-1">
            <fieldset>
                <legend style="font-weight:bold"> Color info: </legend>
                <table cellpadding="2" cellspacing="2" style="width:100%">
                    <tr>
                        <td style="width:5% " align="right">
                            <label>Yarn</label>
                        </td>
                        <td style="width:35%; text-align: left" align="left">
                            <input id="txtYarn_LDD" style="width:90%" disabled />
                        </td>
                        <td style="width:6%" align="right">
                            <label>Color</label>
                        </td>
                        <td style="width:24%; text-align: left">
                            <input id="txtColor_LDD" style="width:90%" disabled />
                        </td>
                        <td style="width:10%" align="right">
                            <label>Ref Lot</label>
                        </td>
                        <td style="width:20%">
                            <input id="txtLot_LDD" style="width:95%" />
                        </td>
                    </tr>
                </table>
            </fieldset>
            <fieldset>
                <legend>Labdip Shade</legend>
                <table id="tblLabdipShade" class="easyui-datagrid" style="height: 180px; width:90%;" fitcolumns="false" rownumbers="true" pagination="false" singleselect="true" autorowheight="false" toolbar="#toolLabdipSahde">
                    <thead>
                        <tr>
                            <th field="ShadeStr" width="10%" align="left">Shade</th>
                            <th field="Qty" width="10%" align="center">Qty</th>
                            <th field="ShadePercentage" width="10%" align="center">Shade(%)</th>
                            <th field="Note" width="50%" align="center">Note</th>
                            <th field="ApproveByName" width="25%" align="center">Approved By</th>
                        </tr>
                    </thead>
                </table>

                <div id="toolLabdipSahde">
                    <span>Shade: </span>
                    <select id="cboSahde" style="width:11%"></select>
                    <span>Qty: </span>
                    <input id="txtQty_Shade" placeholder="" class="number" min="0" max="100" style="width:40px" />
                    <span>Percentage(%): </span>
                    <input id="txtShadePercentage" placeholder="" class="number" min="0" max="100" style="width:40px" />
                    <span>Note: </span>
                    <input id="txtNoteShade" placeholder="Note" style="width:15%" />
                    <a id="btnAddShade" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-add" plain="true"></a>
                    <a id="btnDeleteShade" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-remove" plain="true"></a>
                    <a id="btnApproveShade" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-ok" plain="true"></a>
                    <a id="btnCopyShade" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-copy" plain="true"></a>
                </div>
            </fieldset>
            <div style="width:100%; float:left;">
                <div style="width:50%; float:left;">
                    <fieldset>
                        <legend>Labdip Recipe With Dyes</legend>
                        <table id="tblRecipeDyes" class="easyui-datagrid" style="height: 160px; width:490px;" fitcolumns="false" rownumbers="true" pagination="false" singleselect="true" autorowheight="false" toolbar="#toolbarDyes" data-options="onClickRow: onClickRowDyes">
                            <thead>
                                <tr>
                                    <th field="ProductNameCode" width="50%" align="left">Product Name</th>
                                    <th data-options="field:'Qty',align:'right',editor:{type:'numberbox',options:{precision:5}}" width="15%">Qty(g)</th>
                                    <th field="PerTage" width="6%" align="center">%</th>
                                    <th field="Note" width="25%" align="center">Note</th>
                                </tr>
                            </thead>
                        </table>

                        <div id="toolbarDyes">
                            <input id="txtProductDyes" placeholder="Search Dyes" />
                            <a id="btnPickDyes" href="javascript:void(0)" class="easyui-linkbutton ics-pick" iconcls="icon-pick" plain="true"></a>
                            <a id="btnResetDyes" href="javascript:void(0)" class="easyui-linkbutton ics-pick" iconcls="icon-clear" plain="true"></a>
                            <span>Qty: </span>
                            <input id="txtQtyDyes" placeholder="Qty" class="number" style="width:12%" />
                            <input id="txtPerDyes" placeholder="%" class="number" style="width:8%" />
                            <span>%</span>
                            <input id="txtNoteDyes" placeholder="Note" style="width:15%" />
                            <a id="btnAddDyes" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-add" plain="true"></a>
                            <a id="btnDeleteDyes" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-remove" plain="true"></a>
                        </div>
                    </fieldset>
                </div>
                <div style="width:50%; float:left;">
                    <fieldset>
                        <legend>Labdip Recipe With Chemicals</legend>
                        <table id="tblRecipeChemical" class="easyui-datagrid" style="height: 160px; width:485px;" fitcolumns="false" rownumbers="true" pagination="false" singleselect="true" autorowheight="false" toolbar="#toolbarChemicals" data-options="onClickRow: onClickRowChemical">
                            <thead>
                                <tr>
                                    <th field="ProductNameCode" width="50%" align="left">Product Name</th>
                                    <th data-options="field:'Qty',align:'right',editor:{type:'numberbox',options:{precision:5}}" width="15%">Qty(g)</th>
                                    <th field="IsGLSt" width="6%" align="center">Note</th>
                                    <th field="Note" width="24%" align="center">Note</th>

                                </tr>
                            </thead>
                        </table>

                        <div id="toolbarChemicals">
                            <input id="txtProductChemical" placeholder="Search Chemicals" />
                            <a id="btnPickChemical" href="javascript:void(0)" class="easyui-linkbutton ics-pick" iconcls="icon-pick" plain="true"></a>
                            <a id="btnResetChemical" href="javascript:void(0)" class="easyui-linkbutton ics-remove" iconcls="icon-clear" plain="true"></a>
                            <input id="txtQtyChemical" placeholder="Qty" class="number" style="width:12%" />
                            <input id="chkIsGL" type="checkbox" /> Is GL?
                            <input id="txtNoteChemical" placeholder="Note" style="width:15%" />
                            <a id="btnAddChemical" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-add" plain="true"></a>
                            <a id="btnDeleteChemical" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-remove" plain="true"></a>
                        </div>
                    </fieldset>
                </div>
            </div>


        </div>

        <fieldset class="actionfieldsetstyle">
            <legend>Actions : </legend>
            <a id="btnSaveWinShadeRecipe" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-save" plain="true">Save</a>
            <a id="btnCloseWinShadeRecipe" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-cancel" plain="true">Close</a>
        </fieldset>
    </div>
    <div id="winColorNoEntry" style="width:300px;" class="easyui-window" title="Color No Change" data-options="modal:true,closed:true,collapsible:false,minimizable:false,maximizable:false,closable:true">
        <div id="divInvoiceStatusUpdate">
            <table>
                <tr>
                    <td style="width:30%;text-align:right">
                        LD/Color No:
                    </td>
                    <td colspan="3" style="width:50%">
                        <input type="text" id="txtColorNoLD" style="width:100%" />
                    </td>
                </tr>
                <tr>
                    <td style="width:30%;text-align:right">
                        Color Name:
                    </td>
                    <td colspan="3" style="width:50%">
                        <input type="text" style="width:150px;" id="txtColorName_LD" />
                    </td>
                </tr>
                <tr>
                    <td style="width:30%;text-align:right">
                        Color Code:
                    </td>
                    <td colspan="3" style="width:50%">
                        <input id="txtLDCode" class="reset-text" style="width:60%;" placeholder="Code search" />
                        <a id="btnPickLDCode" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-pick" plain="true"></a>
                    </td>
                </tr>
                <tr>
                    <td style="width:30%;text-align:right">
                        new LD No:
                    </td>
                    <td colspan="3" style="width:50%">
                        <input type="text" style="width:150px;" id="txtColorNew" />
                    </td>
                </tr>
            </table>
        </div>
        <fieldset class="actionfieldsetstyle">
            <legend>Actions : </legend>
            <a id="btnSaveColorNo" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-save" plain="true">Save</a>
            <a id="btnCloseColorNo" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-cancel" plain="true">Close</a>
        </fieldset>
    </div>       
    
    <div id="winPantonEntry" style="width:300px;" class="easyui-window" title="Color No Change" data-options="modal:true,closed:true,collapsible:false,minimizable:false,maximizable:false,closable:true">
        <div id="divPanton">
            <table>
                <tr>
                    <td style="width:30%;text-align:right">
                        LD/Color No:
                    </td>
                    <td colspan="3" style="width:50%">
                        <input type="text" id="txtColorNo_PT" style="width:100%" />
                    </td>
                </tr>
                <tr>
                    <td style="width:30%;text-align:right">
                        Color Name:
                    </td>
                    <td colspan="3" style="width:50%">
                        <input type="text" style="width:150px;" id="txtColorName_PT" />
                    </td>
                </tr>
                <tr>
                    <td style="width:30%;text-align:right">
                        Panton No:
                    </td>
                    <td colspan="3" style="width:50%">
                        <input type="text" style="width:150px;" id="txtPantonNo" />
                    </td>
                </tr>
                <tr>
                    <td style="width:30%;text-align:right">
                        Page No:
                    </td>
                    <td colspan="3" style="width:50%">
                        <input type="text" style="width:150px;" id="txtPantonPageNo" />
                    </td>
                </tr>
            </table>

        </div>
        <fieldset class="actionfieldsetstyle">
            <legend>Actions : </legend>
            <a id="btnSavePantonNo" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-save" plain="true">Save</a>
            <a id="btnClosePantonNo" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-cancel" plain="true">Close</a>
        </fieldset>
    </div>

    @*<div id="winPO" class="easyui-window winClass" title="View PO " style="width:90%;height: 380px;" data-options=" modal:true,closed:true,collapsible:false,minimizable:false,maximizable:false,closable:false">
        <fieldset>
            <table id="tblLabDipDetailFabric" title="PO Details" class="easyui-datagrid" style="height: 270px; width:100%;" fitcolumns="false" rownumbers="true" pagination="false" singleselect="false" autorowheight="false" toolbar="">

                <thead>
                    <tr>
                        <th field="SCNoFull" width="15%" align="center">PO No</th>
                        <th field="FabricNo" width="10%" align="center"><label id="lblLabdipOrderNo">P Number</label></th>
                        <th field="ExeNo" width="15%" align="left">Dispo No</th>
                        <th field="ProductName" width="20%" align="left">Composition</th>
                        <th field="Construction" width="20%" align="center">Construction</th>
                        <th field="BuyerReference" width="15%" align="center">Buyer Ref</th>
                    </tr>
                </thead>
            </table>
        </fieldset>
        <fieldset class="actionfieldsetstyle">
            <legend>Actions : </legend>
            <a id="btnClosePO" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-cancel" plain="true">Close</a>
        </fieldset>
    </div>*@
</body>
 <style type="text/css">
    /*.lines-no .datagrid-body td {
        border-right: 1px dotted transparent;
        border-bottom: 1px dotted transparent;
    }*/
 
</style>

 <script type="text/javascript">
    var _sBaseAddress="";
    var _oLabDipDetail=null;
    var _oLabDipDetails=[];
    var _oCompareOperators=[];
    var _nBUID = 0;
    var _sContractorIds = '';
    var _sBuyerIDsAdvSearch = '';
    var _oBU = null;
    var _nReportType=0;
    var _sProductIds="";
    var _oLabdipDetail=null;
    var _oFNLabdipShade=null;
    var _nProductIDDyes=0;
    var _nProductIDChemicals=0;
    var _nLabdipColorID=0;
    var _nEmployeeID=0;
    var _oShades=[];
    var _oTempShades=[];
    var _oRecipeDyes=[];
    var _oRecipeChemicals=[];
    var _oOrderStatus=[];
    var _sOperation="";
    $(document).ready(function () {

        _sBaseAddress =@Html.Raw( new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(HttpContext.Current.Session[SessionInfo.BaseAddress]));
        _oLabDipDetails =@Html.Raw( new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(Model));
        _oCompareOperators = @Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(ViewBag.CompareOperators));
        _nBUID = @Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(ViewBag.BUID));
        _oShades= @Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(@ViewBag.EnumShades));
        _oBU = @Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(ViewBag.BU));
        var oLabDipSetup =@Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(@ViewBag.LabDipSetup));
        _oFabricRequestType=@Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(@ViewBag.FabricRequestType));;

        $('#tblLabDipDetail').datagrid({onSelect: function(rowIndex, rowData){ RowSelect(rowIndex, rowData);}});
        debugger;
        if(sessionStorage.getItem("LabDipDetails")!=null && sessionStorage.getItem("LabDipDetails").length>0)
        {
            _oLabDipDetails= jQuery.parseJSON(sessionStorage.getItem('LabDipDetails'));

            var nIndex= sessionStorage.getItem('SelectedRowIndex');
            DynamicRefreshList(_oLabDipDetails, 'tblLabDipDetail');

            if(nIndex>-1){
                $('#tblLabDipDetail').datagrid('selectRow',nIndex);
            }
        }
        else{
            DynamicRefreshList(_oLabDipDetails, 'tblLabDipDetail');
        }

        //$(".lblBUSName").html(_oBU.ShortName);
        DynamicRefreshList([],'tblLabDipDetailFabric');
        $("#progressbar").progressbar({ value: 0 });
        $("#progressbarParent").hide();
        $(".lblLoadingMessage").hide();
        LoadComboAdv();
        debugger;
        //LabdipSetup(oLabDipSetup)
        console.log(oLabDipSetup);
        $('#btnViewPO').hide();
        if(oLabDipSetup.IsApplyPO)
            $('#btnViewPO').show();

        $("#cboPOType").icsLoadCombo({
            List: _oFabricRequestType,
            OptionValue: "id",
            DisplayText: "Value",
        });

        
        var orderStatus={ id:0, Value:'--Select One--' }; _oOrderStatus.push(orderStatus);
        orderStatus={ id:1, Value:'Initialized' }; _oOrderStatus.push(orderStatus);
        orderStatus={ id:2, Value:'Issue' }; _oOrderStatus.push(orderStatus);
        orderStatus={ id:3, Value:'Received' }; _oOrderStatus.push(orderStatus);
        orderStatus={ id:4, Value:'Lab Dip Done' }; _oOrderStatus.push(orderStatus);
        orderStatus={ id:8, Value:'Send To Buyer' }; _oOrderStatus.push(orderStatus);
       
        sessionStorage.setItem("ParamsSO", "");
    });
     function LabdipSetup(oLabDipSetup)
     {
         $('#lblColorNoName').html(oLabDipSetup.ColorNoName);
         $('#lblLabdipOrderNo').html(oLabDipSetup.OrderName);

         if(oLabDipSetup.IsApplyCode)
         {
             $('#btnColorNo').show();
             $("#tblLabDipDetail").datagrid("showColumn", "ColorCode");
             $("#tblLabDipDetail").datagrid("showColumn", "LDNo");
         }
         else{
             $('#btnColorNo').hide();
             $("#tblLabDipDetail").datagrid("hideColumn", "ColorCode");
             $("#tblLabDipDetail").datagrid("hideColumn", "LDNo");
         }
     }
    $(document).keydown(function (e) { if (e.keyCode == 27) { $('div').icsWindow('close'); } });


    function RowSelect(rowIndex, rowData)
    {
        debugger;
        $('#btnViewSahdeReceipe,#btnLabdipDone,#btnColorNo,#btnReceived,#btnSahdeReceipe,#btnSubmit, #btnReviseDetail').hide();
        if(parseInt(rowData.ColorCreateBy)==0)//Initialize
        {
            $('#btnReceived,#btnColorNo').show();
        }
        else  if(parseInt(rowData.ColorCreateBy)!=0 && parseInt(rowData.SubmitBy)==0)//Initialize
        {
            $('#btnSahdeReceipe,#btnLabdipDone,#btnColorNo,#btnReviseDetail').show();
        }
        else  if(parseInt(rowData.ColorCreateBy)!=0 && parseInt(rowData.SubmitBy)!=0)//Initialize
        {
            $('#btnViewSahdeReceipe,#btnSubmit,#btnReviseDetail').show();
        }

    }

    $('#tblLabDipDetailFabric').datagrid({
        fitColumns: true
    });

    //FSC DETAIL
    $("#txtFabricNo").keydown(function (e) {

        var nkeyCode = e.keyCode || e.which;
        if(nkeyCode==13){

            var oLabDipDetail= $('#tblLabDipDetail').datagrid('getSelected');
            var sPONo=$.trim($("#txtFabricNo").val());

            if(_nFSCID<=0 && sPONo==""){ alert("Type P Number to search."); $("#txtFabricNo").focus(); return false; }
            if($("#cboPOType").val()<=0) {  alert("Select PO Type And Try Again."); return false; }

            var oFabricSalesContractDetail = {
                FabricNo:$('#txtFabricNo').val(),
                FabricSalesContractID:oLabDipDetail.FabricSalesContractID,
                ErrorMessage:'',
                ExportPIID:0,
                OrderType: $("#cboPOType").val()
            };
            PickFabricInExportPI(oFabricSalesContractDetail);
        }
    });
    $("#txtExeNo").keydown(function (e) {

        var nkeyCode = e.keyCode || e.which;
        if(nkeyCode==13){
            
            var oLabDipDetail= $('#tblLabDipDetail').datagrid('getSelected');
            var sPONo=$.trim($("#txtExeNo").val());

            if(_nFSCID<=0 && sPONo==""){ alert("Type DisPo Number to search."); $("#txtExeNo").focus(); return false; }
            if($("#cboPOType").val()<=0) {  alert("Select PO Type And Try Again."); return false; }

            var oFabricSalesContractDetail = {
                ExeNo:$('#txtExeNo').val(),
                FabricSalesContractID:oLabDipDetail.FabricSalesContractID,
                ErrorMessage:'',
                ExportPIID:0,
                OrderType: $("#cboPOType").val()
            };
            PickFabricInExportPI(oFabricSalesContractDetail);
        }
    });
    $("#btnPickFabricExportPIDetail").click(function () {

        if(_nFSCID<=0)
        {
            alert("Please First Pick PO No.");
            $('#txtPO').focus();
            return;
        }

        var oFabricSalesContractDetail = {
            FabricNo:'',
            FabricSalesContractID:_nFSCID,
            ErrorMessage:'',
            ExportPIID:0
        };
        PickFabricInExportPI(oFabricSalesContractDetail);
    });
    function PickFabricInExportPI(oFabricSalesContractDetail) {

        var obj = {
            BaseAddress: _sBaseAddress,
            Object: oFabricSalesContractDetail,
            ControllerName: "LabDip",
            ActionName: "GetsDetailForPI",
            IsWinClose: false
        };
        $.icsDataGets(obj, function (response)
        {
            debugger;
            if (response.status && response.objs.length > 0) {
                if (response.objs[0].FabricID > 0) {

                    var tblColums = [];
                    var oColumn = { field: "FabricNo", title: "Mkt Ref No", width: 100, align: "left" }; tblColums.push(oColumn);
                    oColumn = { field: "ExeNo", title: "Dispo NO", width: 150, align: "left" }; tblColums.push(oColumn);
                    oColumn = { field: "Construction", title: "Construction", width: 150, align: "left" }; tblColums.push(oColumn);
                    oColumn = { field: "ColorInfo", title: "ColorInfo", width: 100, align: "left" }; tblColums.push(oColumn);
                    oColumn = { field: "StyleNo", title: "StyleNo", width: 100, align: "left" }; tblColums.push(oColumn);
                    oColumn = { field: "Qty", title: "Qty(Y)", width: 70, align: "left" ,formatter:formatPrice }; tblColums.push(oColumn);
                    oColumn = { field: "Qty_PI", title: "Use Qty another PI(Y)", width: 70, align: "left" ,formatter:formatPrice }; tblColums.push(oColumn);
                    oColumn = { field: "FabricWeaveName", title: "Weave", width: 80, align: "left" }; tblColums.push(oColumn);
                    oColumn = { field: "FinishTypeName", title: "FinishType", width: 80, align: "left" }; tblColums.push(oColumn);
                    oColumn = { field: "FabricWidth", title: "Width", width: 100, align: "left" }; tblColums.push(oColumn);
                    oColumn = { field: "MKTPName", title: "MKTP Name", width: 100, align: "left" }; tblColums.push(oColumn);


                    var oPickerParam = {
                        winid: 'winFabricPicker',
                        winclass: 'clsFabricPicker',
                        winwidth: 900,
                        winheight: 460,
                        tableid: 'tblFabricPicker',
                        tablecolumns: tblColums,
                        datalist: response.objs,
                        multiplereturn: false,
                        searchingbyfieldName: 'FabricNo',
                        windowTittle: 'Fabric List'
                    };
                    $.icsPicker(oPickerParam);
                    IntializeProductPickerbutton(oPickerParam);
                }
                else {
                    alert(response.objs[0].ErrorMessage);
                }

            }else{
                alert("Data Not Found.");
            }
        });
    }

    //PO PICKER
    $("#btnResetPO").click(function () {

        $("#txtPO").val("");
        _nFSCID=0;
    });
    $("#btnPickPO").click(function () {

        
        var oLabDipDetail= $('#tblLabDipDetail').datagrid('getSelected');
        if($("#cboPOType").val()<=0){
            alert("Select PO Type And Try Again."); return false;
        }
        var sPONo=$.trim($("#txtPO").val());
        //if(sPONo==""){ alert("Type PO No to search."); return false; }
        var oFabricSalesContract = {
            SCNo: sPONo,
            ContractorName:oLabDipDetail.ContractorID,
            BuyerName:0,
            PINo:'',
            ApproveBy:1,
            OrderType: $("#cboPOType").val()
        };
        PickFabricSC(oFabricSalesContract);
    });
    $("#txtPO").keydown(function (e) {
        var nkeyCode = e.keyCode || e.which;
        if(nkeyCode==13){

            var oLabDipDetail= $('#tblLabDipDetail').datagrid('getSelected');
            var sPONo=$.trim($("#txtPO").val());

            if($("#cboPOType").val()<=0){
                alert("Select PO Type And Try Again."); return false;
            }
            if(sPONo==""){ alert("Type PO No to search."); return false; }
            var oFabricSalesContract = {
                SCNo: sPONo,
                ContractorName:oLabDipDetail.ContractorID,
                BuyerName:0,
                PINo:'',
                ApproveBy:1,
                OrderType:$("#cboPOType").val()
            };
            PickFabricSC(oFabricSalesContract);
        }
        else if(nkeyCode==8){
            $("#txtPO").val("");
            _nFSCID=0;
        }
    });
    function PickFabricSC(oFabricSalesContract) {
        debugger;
        var obj = {
            BaseAddress: _sBaseAddress,
            Object: oFabricSalesContract,
            ControllerName: "FabricSalesContract",
            ActionName: "GetbySCNo",
            IsWinClose: false
        };
        $.icsDataGets(obj, function (response)
        {
            debugger;
            if (response.status && response.objs.length > 0) {
                if (response.objs[0].FabricSalesContractID > 0) {
                    var tblColums = [];
                    var oColumn = { field: "SCNoFull", title: "PO No", width: 100, align: "left" }; tblColums.push(oColumn);
                    oColumn = { field: "Qty", title: "Qty(Y)", width: 60, align: "left", formatter:formatPrice }; tblColums.push(oColumn);
                    oColumn = { field: "ContractorName", title: "Buyer Name", width: 140, align: "left" }; tblColums.push(oColumn);
                    oColumn = { field: "BuyerName", title: "Buying House", width: 140, align: "left" }; tblColums.push(oColumn);
                    oColumn = { field: "OrderTypeSt", title: "Order Type", width: 50, align: "left" }; tblColums.push(oColumn);

                    var oPickerParam = {
                        winid: 'winPOPicker',
                        winclass: 'clsPOPicker',
                        winwidth: 600,
                        winheight: 460,
                        tableid: 'tblPOPicker',
                        tablecolumns: tblColums,
                        datalist: response.objs,
                        multiplereturn: false,
                        searchingbyfieldName: 'SCNo',
                        windowTittle: 'PO List'
                    };
                    $.icsPicker(oPickerParam);
                    IntializeProductPickerbutton(oPickerParam);
                }
                else {
                    alert(response.objs[0].ErrorMessage);
                }

            }else{
                alert("Data Not Found.");
            }
        });
    }


      
    function Save_FabricDetail(oLDDF)
    {    
        debugger;
       
        var obj = {
            BaseAddress: _sBaseAddress,
            Object: oLDDF,
            ObjectId: oLDDF.LDFID,
            ControllerName: "LabDip",
            ActionName: "Save_FabricDetail",
            TableId: "",
            IsWinClose: false,
            Message: (oLDDF.LDFID>0)?"Update Successfully." : "Save Successfully."
        };
        $.icsSave(obj, function (response) {
            if (response.status && response.obj != null) 
            {
                //if(response.obj.ErrorMessage!=null || response.obj.ErrorMessage!='')
                //{
                //    console.log(response.obj);
                //    alert(response.obj.ErrorMessage); return;
                //}
                //alert(" Saved Successfully. ");
                //$("#winPO").icsWindow("close");
            }
        });
    }
     
    $("#btnRemoveDetailFabric").click(function () 
    {
        debugger;
        var oLabDipDetail = $("#tblLabDipDetailFabric").datagrid("getSelected");
        if (oLabDipDetail == null || oLabDipDetail.FSCDetailID <= 0) { alert("Please select an item from list!"); return false; }

        if (!confirm("Confirm to Delete?")) return false;

        Delete_FabricDetail(oLabDipDetail);

    });
    function Delete_FabricDetail(oLDDF)
    {    
        debugger;
        console.log(oLDDF);
        var obj = {
            BaseAddress: _sBaseAddress,
            Object: oLDDF,
            ObjectId: oLDDF.LDFID,
            ControllerName: "LabDip",
            ActionName: "Delete_FabricDetail",
            TableId: "",
            IsWinClose: false,
            Message: (oLDDF.LDFID>0)?"Update Successfully." : "Save Successfully."
        };
        $.icsSave(obj, function (response) {
            if (response.status && response.obj != null) 
            {
                var index= $("#tblLabDipDetailFabric").datagrid("getRowIndex",oLDDF); console.log(index);
                $('#tblLabDipDetailFabric').datagrid('deleteRow', index);
            }
        });
    }


    ////Start adv Searching

    function updateProgress() {
        var value =$('#progressbar').progressbar('getValue');
        if (value < 96){
            value += Math.floor(Math.random() * 10);
            $('#progressbar').progressbar('setValue', value);
        }
    }
    function hideShow(miliseconds) {
        $("#progressbarParent").hide();
    }
    //Account Of Picker

    $("#txtContractorAdvS").keydown(function (e) {
        if (e.keyCode === 13) // Enter Press
        {
            PickContractors_AdvS();
        }
        else if (e.keyCode === 08) {
            $("#txtContractorAdvS").removeClass("fontColorOfPickItem");
            _sContractorIds = '';
        }
    });

    $("#btnClrContractorAdvS").click(function () {
        $("#txtContractorAdvS").removeClass("fontColorOfPickItem");
        $("#txtContractorAdvS").val("");
        _sContractorIds = '';
    });

    $("#btnPickContractorAdvS").click(function () {
        PickContractors_AdvS();
    });

    //End Account Of Picker

    //Product Pick
    $("#txtProductName").keydown(function (e) {
        debugger;
        var code = (e.keyCode ? e.keyCode : e.which);
        if (code == 13) // Enter Press
        {
            if($('#txtProductName').val()==null || $('#txtProductName').val()=="")
            {
                alert("Please Type Product and Press Enter.");
                $('#txtProductName').focus();
                return;
            }
            PickProduct($('#txtProductName').val());
        }
        if (code == 8) //backspace=8
        {
            //debugger;
            $("#txtProductName").removeClass("fontColorOfPickItem");
            _sProductIds= [];
        }
    });
    $("#btnProductPiker").click(function () {
        PickProduct("");
    });
    $("#btnClrProductPiker").click(function () {
        $("#txtProductName").val('');
        $("#txtProductName").removeClass("fontColorOfPickItem");
        _sProductIds= [];
    });
    function PickProduct(sProductName)
    {
        var oProduct = { BUID:sessionStorage.getItem("BUID"),ProductName:sProductName};
        var obj = {
            BaseAddress: _sBaseAddress,
            Object: oProduct,
            ControllerName: "Product",
            ActionName: "SearchByProductBUWise",
            IsWinClose: false
        };
        $.icsDataGets(obj, function (response) {
            debugger;
            if (response.status && response.objs.length > 0) {
                if (response.objs[0].ProductID > 0) {
                    var tblColums = [];
                    var oColumn = { field: "ProductCode", title: "Code", width: 100, align: "left" }; tblColums.push(oColumn);
                    oColumn = { field: "ProductName", title: "Name", width: 300, align: "left" }; tblColums.push(oColumn);
                    oColumn = { field: "MUnit", title: "Unit", width: 70, align: "left" }; tblColums.push(oColumn);
                    var oPickerParam = {
                        winid: 'winProductPicker',
                        winclass: 'clsProductPicker',
                        winwidth: 600,
                        winheight: 460,
                        tableid: 'tblProductPicker',
                        tablecolumns: tblColums,
                        datalist: response.objs,
                        multiplereturn: true,
                        searchingbyfieldName: 'NameCode',
                        windowTittle: 'Product List'
                    };
                    $.icsPicker(oPickerParam);
                    IntializePickerbutton(oPickerParam);
                }
                else {
                    alert(response.objs[0].ErrorMessage);
                }

            }else{
                alert("Data Not Found.");
            }
        });
    }


    //End Buyer Search

    /////

    $("#btnResetAdvSearch").click(function () {
        ResetAdvSearchWindow();
        DateActionsIssueDateAdv();
        DateActionsReceiveDateAdv();
        DateActionsSubmitDateAdv();
        DateActionsStatusDateAdvSearch();
    });

    $("#btnSearchAdvSearch").click(function () {
        debugger;

        $(".lblLoadingMessage").show();

        var checkDate = CheckFromAndToDateValidation("cboIssueDateAdvS", "txtFromIssueDateAdv", "txtToIssueDateAdv");
        if (!checkDate) {
            alert("Start date must be greater than end date.");
            return false;
        }
        checkDate = CheckFromAndToDateValidation("cboReceiveDateAdv", "txtFromIssueDateAdv", "txtToReceiveDateAdvSearch");
        if (!checkDate) {
            alert("Start date must be greater than end date.");
            return false;
        }
        checkDate = CheckFromAndToDateValidation("cboSubmitDateAdvS", "txtFromSubmitDateAdv", "txtToSubmitDateAdv");
        if (!checkDate) {
            alert("Start date must be greater than end date.");
            return false;
        }


        var ncboIssueDate = parseInt($("#cboIssueDateAdvS").val());
        var dFromIssueDate = $('#txtFromIssueDateAdv').datebox('getValue');
        var dToIssueDate = $('#txtToIssueDateAdv').datebox('getValue');

        var ncboReceiveDate = parseInt($("#cboReceiveDateAdv").val());
        var dFromReceiveDate = $('#txtFromReceiveDateAdv').datebox('getValue');
        var dToReceiveDate = $('#txtToReceiveDateAdvSearch').datebox('getValue');

        var ncboSubmitDateDate = parseInt($("#cboSubmitDateAdvS").val());
        var dFromSubmitDateDate = $('#txtFromSubmitDateAdv').datebox('getValue');
        var dToSubmitDate = $('#txtToSubmitDateAdv').datebox('getValue');

        var sLabdipNo = $.trim($("#txtLabdipNoAdv").val());
        var sFabricNoAdv = $.trim($("#txtFabricNoAdv").val());
        var sColorNameAdv= $.trim($("#txtColorNameAdv").val());
        var sConstruction= $.trim($("#txtConstruction").val());
        var sOrderNoAdv = "";
        var nCboMkPerson=0;
        var sLDNo = "";
        var sColorNo="";
        var nInOutSide = parseInt($("#cboInOutSide").val());
        var nOrderStatus= parseInt($("#cboStatus").val());
        var sParams = _sContractorIds + "~" +
                      _sProductIds+"~"+
                      ncboIssueDate + "~" +
                      dFromIssueDate + "~" +
                      dToIssueDate + "~" +
                      ncboReceiveDate + "~" +
                      dFromReceiveDate + "~" +
                      dToReceiveDate + "~" +
                      ncboSubmitDateDate + "~" +
                      dFromSubmitDateDate + "~" +
                      dToSubmitDate + "~" +
                      nCboMkPerson + "~" +
                      sLabdipNo+"~"+
                      sFabricNoAdv+"~"+
                      sColorNameAdv+"~"+
                      sConstruction+"~"+
                      sOrderNoAdv+"~"+
                      sLDNo+"~"+
                      sColorNo+"~"+
                      nInOutSide+"~"+nOrderStatus;

        sessionStorage.setItem("ParamsSO", sParams);
        var oLabDipDetail = {
            ErrorMessage : sParams
        };

        $.ajax({
            type: "POST",
            dataType: "json",
            url: _sBaseAddress + "/LabDip/AdvSearch",
            traditional: true,
            data: JSON.stringify(oLabDipDetail),
            contentType: "application/json; charset=utf-8",
            success: function (data) {
                var oLabDipDetails = data;
                debugger;
                if (oLabDipDetails != null) {
                    if (oLabDipDetails.length > 0)
                    {
                        DynamicRefreshList(oLabDipDetails, "tblLabDipDetail");
                        $("#winAdvSearch").icsWindow("close");
                    }
                    else
                    {
                        alert("Sorry, No data found.");
                        DynamicRefreshList([], "tblLabDipDetail");
                    }

                } else {
                    alert("Sorry, No data found.");
                    DynamicRefreshList([], "tblLabDipDetail");
                }
                $(".lblLoadingMessage").hide();
            }
        });
    });

    $('#txtSearchByLDOrderNo').keypress(function (e) {
        var code = (e.keyCode ? e.keyCode : e.which);
        if (code == 13)//Enter key-13
        {
            _sContractorIds="";

            _sProductIds="";
            var ncboIssueDate = 0;
            var dFromIssueDate = $('#txtFromIssueDateAdv').datebox('getValue');
            var dToIssueDate = $('#txtToIssueDateAdv').datebox('getValue');

            var ncboReceiveDate =0;
            var dFromReceiveDate = $('#txtFromReceiveDateAdv').datebox('getValue');
            var dToReceiveDate = $('#txtToReceiveDateAdvSearch').datebox('getValue');

            var ncboSubmitDateDate =0;
            var dFromSubmitDateDate = $('#txtFromSubmitDateAdv').datebox('getValue');
            var dToSubmitDate = $('#txtToSubmitDateAdv').datebox('getValue');

            var sLabdipNo = $.trim($("#txtSearchByLDOrderNo").val());
            var sFabricNoAdv = "";
            var sColorNameAdv="";
            var sConstruction="";
            var sOrderNoAdv ="";
            var sLDNo = "";
            var sColorNo="";

            var nCboMkPerson=0;
            var nInOutSide = 0;

            var sParams = _sContractorIds + "~" +
                          _sProductIds+"~"+
                          ncboIssueDate + "~" +
                          dFromIssueDate + "~" +
                          dToIssueDate + "~" +
                          ncboReceiveDate + "~" +
                          dFromReceiveDate + "~" +
                          dToReceiveDate + "~" +
                          ncboSubmitDateDate + "~" +
                          dFromSubmitDateDate + "~" +
                          dToSubmitDate + "~" +
                          nCboMkPerson + "~" +
                          sLabdipNo+"~"+
                          sFabricNoAdv+"~"+
                          sColorNameAdv+"~"+
                          sConstruction+"~"+
                            sOrderNoAdv+"~"+
                                  sLDNo+"~"+
                               sColorNo+"~"+
                              nInOutSide;

            sessionStorage.setItem("ParamsSO", sParams);
            var oLabDipDetail = {
                ErrorMessage : sParams
            };
            SearchByNo(oLabDipDetail);

        }
        else if (code === 8) {
            DynamicRefreshList([], "tblLabDipDetail");
        }
    });

    $('#txtSearchByFabricNo').keypress(function (e) {
        var code = (e.keyCode ? e.keyCode : e.which);
        if (code == 13)//Enter key-13
        {
            _sContractorIds="";

            _sProductIds="";
            var ncboIssueDate = 0;
            var dFromIssueDate = $('#txtFromIssueDateAdv').datebox('getValue');
            var dToIssueDate = $('#txtToIssueDateAdv').datebox('getValue');

            var ncboReceiveDate =0;
            var dFromReceiveDate = $('#txtFromReceiveDateAdv').datebox('getValue');
            var dToReceiveDate = $('#txtToReceiveDateAdvSearch').datebox('getValue');

            var ncboSubmitDateDate =0;
            var dFromSubmitDateDate = $('#txtFromSubmitDateAdv').datebox('getValue');
            var dToSubmitDate = $('#txtToSubmitDateAdv').datebox('getValue');

            var sLabdipNo = "";
            var sFabricNoAdv = $.trim($("#txtSearchByFabricNo").val());
            var sColorNameAdv="";
            var sConstruction="";
            var nCboMkPerson=0;
            var sOrderNoAdv ="";
            var sLDNo = "";
            var sColorNo="";
            var nInOutSide =0;
            var sParams = _sContractorIds + "~" +
                          _sProductIds+"~"+
                          ncboIssueDate + "~" +
                          dFromIssueDate + "~" +
                          dToIssueDate + "~" +
                          ncboReceiveDate + "~" +
                          dFromReceiveDate + "~" +
                          dToReceiveDate + "~" +
                          ncboSubmitDateDate + "~" +
                          dFromSubmitDateDate + "~" +
                          dToSubmitDate + "~" +
                          nCboMkPerson + "~" +
                          sLabdipNo+"~"+
                          sFabricNoAdv+"~"+
                          sColorNameAdv+"~"+
                           sConstruction+"~"+
                            sOrderNoAdv+"~"+
                            sLDNo+"~"+
                               sColorNo+"~"+
                              nInOutSide;

            sessionStorage.setItem("ParamsSO", sParams);
            var oLabDipDetail = {
                ErrorMessage : sParams
            };
            SearchByNo(oLabDipDetail);

        }
        else if (code === 8) {
            DynamicRefreshList([], "tblLabDipDetail");
        }
    });
    $('#txtSearchByOrderNo').keypress(function (e) {
        var code = (e.keyCode ? e.keyCode : e.which);
        if (code == 13)//Enter key-13
        {
            _sContractorIds="";

            _sProductIds="";
            var ncboIssueDate = 0;
            var dFromIssueDate = $('#txtFromIssueDateAdv').datebox('getValue');
            var dToIssueDate = $('#txtToIssueDateAdv').datebox('getValue');

            var ncboReceiveDate =0;
            var dFromReceiveDate = $('#txtFromReceiveDateAdv').datebox('getValue');
            var dToReceiveDate = $('#txtToReceiveDateAdvSearch').datebox('getValue');

            var ncboSubmitDateDate =0;
            var dFromSubmitDateDate = $('#txtFromSubmitDateAdv').datebox('getValue');
            var dToSubmitDate = $('#txtToSubmitDateAdv').datebox('getValue');

            var sLabdipNo = "";
            var sFabricNoAdv = '';
            var sColorNameAdv="";
            var sConstruction="";
            var nCboMkPerson=0;
            var sOrderNoAdv = $.trim($("#txtSearchByOrderNo").val());
            var sLDNo = "";
            var sColorNo="";
            var nInOutSide =0;
            var sParams = _sContractorIds + "~" +
                          _sProductIds+"~"+
                          ncboIssueDate + "~" +
                          dFromIssueDate + "~" +
                          dToIssueDate + "~" +
                          ncboReceiveDate + "~" +
                          dFromReceiveDate + "~" +
                          dToReceiveDate + "~" +
                          ncboSubmitDateDate + "~" +
                          dFromSubmitDateDate + "~" +
                          dToSubmitDate + "~" +
                          nCboMkPerson + "~" +
                          sLabdipNo+"~"+
                          sFabricNoAdv+"~"+
                          sColorNameAdv+"~"+
                          sConstruction+"~"+
                           sOrderNoAdv+"~"+
                            sLDNo+"~"+
                              sColorNo+"~"+
                              nInOutSide;

            sessionStorage.setItem("ParamsSO", sParams);
            var oLabDipDetail = {
                ErrorMessage : sParams
            };
            SearchByNo(oLabDipDetail);

        }
        else if (code === 8) {
            DynamicRefreshList([], "tblLabDipDetail");
        }
    });
    $('#txtSearchByLDNo').keypress(function (e) {
        var code = (e.keyCode ? e.keyCode : e.which);
        if (code == 13)//Enter key-13
        {
            _sContractorIds="";

            _sProductIds="";
            var ncboIssueDate = 0;
            var dFromIssueDate = $('#txtFromIssueDateAdv').datebox('getValue');
            var dToIssueDate = $('#txtToIssueDateAdv').datebox('getValue');

            var ncboReceiveDate =0;
            var dFromReceiveDate = $('#txtFromReceiveDateAdv').datebox('getValue');
            var dToReceiveDate = $('#txtToReceiveDateAdvSearch').datebox('getValue');

            var ncboSubmitDateDate =0;
            var dFromSubmitDateDate = $('#txtFromSubmitDateAdv').datebox('getValue');
            var dToSubmitDate = $('#txtToSubmitDateAdv').datebox('getValue');

            var sLabdipNo = "";
            var sFabricNoAdv = '';
            var sColorNameAdv="";
            var sConstruction="";
            var nCboMkPerson=0;
            var sOrderNoAdv ="";
            var sLDNo = $.trim($("#txtSearchByLDNo").val());
            var sColorNo="";
            var nInOutSide =0;
            var sParams = _sContractorIds + "~" +
                          _sProductIds+"~"+
                          ncboIssueDate + "~" +
                          dFromIssueDate + "~" +
                          dToIssueDate + "~" +
                          ncboReceiveDate + "~" +
                          dFromReceiveDate + "~" +
                          dToReceiveDate + "~" +
                          ncboSubmitDateDate + "~" +
                          dFromSubmitDateDate + "~" +
                          dToSubmitDate + "~" +
                          nCboMkPerson + "~" +
                          sLabdipNo+"~"+
                          sFabricNoAdv+"~"+
                          sColorNameAdv+"~"+
                          sConstruction+"~"+
                            sOrderNoAdv+"~"+
                            sLDNo+"~"+
                                sColorNo+"~"+
                              nInOutSide;

            sessionStorage.setItem("ParamsSO", sParams);
            var oLabDipDetail = {
                ErrorMessage : sParams
            };
            SearchByNo(oLabDipDetail);

        }
        else if (code === 8) {
            DynamicRefreshList([], "tblLabDipDetail");
        }
    });
    $('#txtSearchByColorNo').keypress(function (e) {
        var code = (e.keyCode ? e.keyCode : e.which);
        if (code == 13)//Enter key-13
        {
            _sContractorIds="";

            _sProductIds="";
            var ncboIssueDate = 0;
            var dFromIssueDate = $('#txtFromIssueDateAdv').datebox('getValue');
            var dToIssueDate = $('#txtToIssueDateAdv').datebox('getValue');

            var ncboReceiveDate =0;
            var dFromReceiveDate = $('#txtFromReceiveDateAdv').datebox('getValue');
            var dToReceiveDate = $('#txtToReceiveDateAdvSearch').datebox('getValue');

            var ncboSubmitDateDate =0;
            var dFromSubmitDateDate = $('#txtFromSubmitDateAdv').datebox('getValue');
            var dToSubmitDate = $('#txtToSubmitDateAdv').datebox('getValue');

            var sLabdipNo = "";
            var sFabricNoAdv = '';
            var sColorNameAdv="";
            var sConstruction="";
            var nCboMkPerson=0;
            var sOrderNoAdv = "";
            var sLDNo = "";
            var sColorNo= $.trim($("#txtSearchByColorNo").val());
            var nInOutSide = 0;

            var sParams = _sContractorIds + "~" +
                          _sProductIds+"~"+
                          ncboIssueDate + "~" +
                          dFromIssueDate + "~" +
                          dToIssueDate + "~" +
                          ncboReceiveDate + "~" +
                          dFromReceiveDate + "~" +
                          dToReceiveDate + "~" +
                          ncboSubmitDateDate + "~" +
                          dFromSubmitDateDate + "~" +
                          dToSubmitDate + "~" +
                          nCboMkPerson + "~" +
                          sLabdipNo+"~"+
                          sFabricNoAdv+"~"+
                          sColorNameAdv+"~"+
                          sConstruction+"~"+
                          sOrderNoAdv+"~"+
                            sLDNo+"~"+
                              sColorNo+"~"+
                              nInOutSide;

            sessionStorage.setItem("ParamsSO", sParams);
            var oLabDipDetail = {
                ErrorMessage : sParams
            };
            SearchByNo(oLabDipDetail);

        }
        else if (code === 8) {
            DynamicRefreshList([], "tblLabDipDetail");
        }
    });
    $('#txtSearchByPantonNo').keypress(function (e) {
        var code = (e.keyCode ? e.keyCode : e.which);
        if (code == 13)//Enter key-13
        {
            _sContractorIds="";

            _sProductIds="";
            var ncboIssueDate = 0;
            var dFromIssueDate = $('#txtFromIssueDateAdv').datebox('getValue');
            var dToIssueDate = $('#txtToIssueDateAdv').datebox('getValue');

            var ncboReceiveDate =0;
            var dFromReceiveDate = $('#txtFromReceiveDateAdv').datebox('getValue');
            var dToReceiveDate = $('#txtToReceiveDateAdvSearch').datebox('getValue');

            var ncboSubmitDateDate =0;
            var dFromSubmitDateDate = $('#txtFromSubmitDateAdv').datebox('getValue');
            var dToSubmitDate = $('#txtToSubmitDateAdv').datebox('getValue');

            var sLabdipNo = "";
            var sFabricNoAdv = '';
            var sColorNameAdv="";
            var sConstruction="";
            var nCboMkPerson=0;
            var sOrderNoAdv = "";
            var sLDNo = "";
            var sColorNo= '';//$.trim($("#txtSearchByColorNo").val());
            var sPantonNo= $.trim($("#txtSearchByPantonNo").val());
            var nInOutSide = 0;

            var sParams = _sContractorIds + "~" +
                          _sProductIds+"~"+
                          ncboIssueDate + "~" +
                          dFromIssueDate + "~" +
                          dToIssueDate + "~" +
                          ncboReceiveDate + "~" +
                          dFromReceiveDate + "~" +
                          dToReceiveDate + "~" +
                          ncboSubmitDateDate + "~" +
                          dFromSubmitDateDate + "~" +
                          dToSubmitDate + "~" +
                          nCboMkPerson + "~" +
                          sLabdipNo+"~"+
                          sFabricNoAdv+"~"+
                          sColorNameAdv+"~"+
                          sConstruction+"~"+
                          sOrderNoAdv+"~"+
                          sLDNo+"~"+
                          sColorNo+"~"+
                          nInOutSide+"~0~"+sPantonNo;

            sessionStorage.setItem("ParamsSO", sParams);
            var oLabDipDetail = {
                ErrorMessage : sParams
            };
            SearchByNo(oLabDipDetail);

        }
        else if (code === 8) {
            DynamicRefreshList([], "tblLabDipDetail");
        }
    });
    function SearchByNo(oLabDipDetail)
    {
        $.ajax({
            type: "POST",
            dataType: "json",
            url: _sBaseAddress + "/LabDip/AdvSearch",
            traditional: true,
            data: JSON.stringify(oLabDipDetail),
            contentType: "application/json; charset=utf-8",
            success: function (data) {
                var oLabDipDetails = data;
                debugger;

                if (oLabDipDetails != null) {
                    if (oLabDipDetails.length > 0 && oLabDipDetails[0].LabDipDetailID>0)
                    {

                        DynamicRefreshList(oLabDipDetails, "tblLabDipDetail");
                        $("#winAdvSearch").icsWindow("close");

                    }
                    else
                    {
                        console.log(oLabDipDetails[0].ErrorMessage);
                        alert("Sorry, No data found.");
                        DynamicRefreshList([], "tblLabDipDetail");
                    }

                } else {
                    alert("Sorry, No data found.");
                    DynamicRefreshList([], "tblLabDipDetail");
                }
                $(".lblLoadingMessage").hide();
            }
        });
    }

    function Search(oLabDipDetail)
    {
        $.ajax({
            type: "POST",
            dataType: "json",
            url: _sBaseAddress + "/LabDip/AdvSearch",
            traditional: true,
            data: JSON.stringify(oLabDipDetail),
            contentType: "application/json; charset=utf-8",
            success: function (data) {
                var oLabDipDetails = data;
                debugger;
                if (oLabDipDetails != null) {
                    if (oLabDipDetails.length > 0)
                    {
                        DynamicRefreshList(oLabDipDetails, "tblLabDipDetail");
                        $("#winAdvSearch").icsWindow("close");
                    }
                    else
                    {
                        alert("Sorry, No data found.");
                        DynamicRefreshList([], "tblLabDipDetail");
                    }

                } else {
                    alert("Sorry, No data found.");
                    DynamicRefreshList([], "tblLabDipDetail");
                }
                $(".lblLoadingMessage").hide();
            }
        });
    }
    function LoadComboAdv()
    {
        $("#cboIssueDateAdvS, #cboReceiveDateAdv, #cboSubmitDateAdvS").icsLoadCombo({
            List: _oCompareOperators,
            OptionValue: "id",
            DisplayText: "Value"
        });
        $("#cboStatus").icsLoadCombo({
            List: _oOrderStatus,
            OptionValue: "id",
            DisplayText: "Value"
        });
        //$("#cboMkPersonAdvSearch").icsLoadCombo({
        //    List: _oMktPersons,
        //    OptionValue: "MarketingAccountID",
        //    DisplayText: "Name"
        //});
    }
    function CheckFromAndToDateValidation(OperationComboId, FromDateId, ToDateId) {
        $("#" + OperationComboId).parent().parent().parent().find("select").removeClass("errorFieldBorder");
        var nCboVal = $("#" + OperationComboId).val();
        if (parseInt(nCboVal) == 5 || parseInt(nCboVal) == 6) {
            var fromDate = $("#" + FromDateId).datebox("getValue");
            var toDate = $("#" + ToDateId).datebox("getValue");
            if (new Date(fromDate) > new Date(toDate)) {
                $("#" + ToDateId).focus();
                $("#" + OperationComboId).addClass("errorFieldBorder");
                $(".lblLoadingMessage").hide();
                return false;
            } else {
                $("#" + OperationComboId).removeClass("errorFieldBorder");
                return true;
            }
        } else {
            return true;
        }
    }

    function ResetAdvSearchWindow() {
        _sContractorIds = '';
        _sDeliverToIDs = "";
        _sCPersonnelIds="";
        $("#winAdvSearch input").not("input[type='button']").val("");
        $("#winAdvSearch input").removeClass("fontColorOfPickItem");
        $("#winAdvSearch select").val(0);
        DateActionsIssueDateAdv();
        DateActionsReceiveDateAdv();
        DateActionsSubmitDateAdv();
        $("#txtFromIssueDateAdv,#txtToIssueDateAdv,#txtFromReceiveDateAdv,#txtToReceiveDateAdvSearch,#txtFromSubmitDateAdv,#txtToSubmitDateAdv").datebox({ disabled: true });
        $("#txtFromIssueDateAdv,#txtToIssueDateAdv,#txtFromReceiveDateAdv,#txtToReceiveDateAdvSearch,#txtFromSubmitDateAdv,#txtToSubmitDateAdv").datebox("setValue", icsdateformat(new Date()));
    }

    function PickContractors_AdvS() {
        var oContractor = {
            Params: '2,3' + '~' + $.trim($("#txtContractorAdvS").val())+"~"+_nBUID
        };
        var obj = {
            BaseAddress: _sBaseAddress,
            Object: oContractor,
            ControllerName: "Contractor",
            ActionName: "ContractorSearchByNameType",
            IsWinClose: false
        };

        $("#progressbar").progressbar({ value: 0 });
        $("#progressbarParent").show();
        var intervalID = setInterval(updateProgress, 250);

        DynamicRefreshList([], "tblAccountsPickerAdvSearch");
        $.icsDataGets(obj, function (response) {
            clearInterval(intervalID);
            $("#progressbarParent").hide();
            if (response.status && response.objs.length > 0) {
                if (response.objs[0].ContractorID > 0) {
                    var tblColums = []; var oColumn = { field: "ContractorID", title: "Code", width: 50, align: "left" }; tblColums.push(oColumn);
                    oColumn = { field: "Name", title: "Name", width: 280, align: "left" }; tblColums.push(oColumn);

                    var oPickerParam = {
                        winid: 'winContractorPicker',
                        winclass: 'clsAccountOf',
                        winwidth: 400,
                        winheight: 460,
                        tableid: 'tblAccountOfs',
                        tablecolumns: tblColums,
                        datalist: response.objs,
                        multiplereturn: true,
                        searchingbyfieldName: 'Name',
                        windowTittle: 'Contactor List'
                    };
                    $.icsPicker(oPickerParam);
                    IntializePickerbutton(oPickerParam);
                }
                else {
                    alert(response.objs[0].ErrorMessage);
                }
            }
            else {
                alert("Sorry, No Contactor Found.");
            }
        });
    }



    function DateActionsIssueDateAdv() {
        DynamicDateActions("cboIssueDateAdvS", "txtFromIssueDateAdv", "txtToIssueDateAdv");
    }
    function DateActionsReceiveDateAdv() {
        DynamicDateActions("cboReceiveDateAdv", "txtFromReceiveDateAdv", "txtToReceiveDateAdvSearch");
    }
    function DateActionsSubmitDateAdv() {
        DynamicDateActions("cboSubmitDateAdvS", "txtFromSubmitDateAdv", "txtToSubmitDateAdv");
    }

    $("#btnCloseAdvSearch").click(function () {
        $("#winAdvSearch").icsWindow("close");
    });
    $("#btnAdvSearch").click(function () {
        debugger;
        $("#winAdvSearch").icsWindow("open", "Sample Order Advance Search");
        LoadComboAdv();
        DynamicResetAdvSearchWindow("winAdvSearch");
        DynamicDateActions("cboDateOptionAdvSearch", "txtFromDateAdvSearch", "txtToDateAdvSearch");
        DynamicDateActions("cboReceiveDateAdv", "txtFromReceiveDateAdv", "txtToReceiveDateAdvSearch");
        DynamicDateActions("cboSubmitDateAdvS", "txtFromSubmitDateAdv", "txtToSubmitDateAdv");
        ResetAdvSearchWindow();
    });

    function IntializePickerbutton(oPickerobj) {
        $("#" + oPickerobj.winid).find("#btnOk").click(function () {
            SetPickerValueAssign(oPickerobj);
        });
        $(document).find('.' + oPickerobj.winclass).keydown(function (e) {
            if (e.which === 13) {
                SetPickerValueAssign(oPickerobj);
            }
        });
    }

    function SetPickerValueAssign(oPickerobj) {
        var oreturnObj = null, oreturnObjs = [];
        if (oPickerobj.multiplereturn) {
            oreturnObjs = $('#' + oPickerobj.tableid).datagrid('getChecked');
        } else {
            oreturnObj = $('#' + oPickerobj.tableid).datagrid('getSelected');
        }

        if (oPickerobj.winid == 'winContractorPicker')
        {
            if (oreturnObjs != null && oreturnObjs.length> 0)
            {

                _sContractorIds=''; var sMessage='';
                sMessage=(oreturnObjs.length>1)? oreturnObjs.length +" Contractors Selected" : oreturnObjs[0].Name;
                $('#txtContractorAdvS').val(sMessage);
                $("#txtContractorAdvS").addClass("fontColorOfPickItem");

                for(var i=0;i<oreturnObjs.length;i++){
                    _sContractorIds=_sContractorIds+oreturnObjs[i].ContractorID+',';
                }
                _sContractorIds=_sContractorIds.substring(0,_sContractorIds.length-1);

            }
            else
            {
                alert("Please select a contractor.");
                return false;
            }
        }


        else if (oPickerobj.winid == 'winProductPicker')
        {
            if (oreturnObjs!= null && oreturnObjs.length> 0)
            {
                _sProductIds=''; var sMessage='';
                sMessage=(oreturnObjs.length>1)? oreturnObjs.length +" ProductName Selected" : oreturnObjs[0].ProductName;
                $('#txtProductName').val(sMessage);
                $("#txtProductName").addClass("fontColorOfPickItem");

                for(var i=0;i<oreturnObjs.length;i++){
                    _sProductIds=_sProductIds+oreturnObjs[i].ProductID+',';
                }
                _sProductIds=_sProductIds.substring(0,_sProductIds.length-1);

            }
            else
            {
                alert("Please select a Product.");
                return false;
            }

        }

        
        $("#" + oPickerobj.winid).icsWindow("close");
        $("#" + oPickerobj.winid).remove();
    }
     /// end Adv Searching


    ////////////////////////////////
    /*----------------  Labdip Shade & Recipe --------------- */

    //$('#tblLabDipDetail').datagrid({selectOnCheck:false, checkOnSelect:false});


    function Initialization(oLabDip, sOperation){
        ResetControll();
        _sOperation=sOperation;
        if(sOperation=='New'){
            $('#btnViewSahdeReceipe').hide();
            $('#btnIssueColor, #btnMultipleColor, #btnAssignPerson, #btnSahdeReceipe').show();
        }
        else{
            $('#btnIssueColor, #btnMultipleColor, #btnAssignPerson, #btnSahdeReceipe').hide();
            $('#btnViewSahdeReceipe').show();
        }

        if(oLabDip.LabDipID>0){
            RefreshControl(oLabDip);
        }

        $('input,select').not('#WinAssigendPerson input,#WinShadeRecipe input, #WinShadeRecipe select,#labDipDetail input[type="checkbox"]').prop('disabled',true);
    }

    function LoadIssueContactPersonnel(oCPs){
        $("#cboCPIssueTo").icsLoadCombo({
            List: oCPs,
            OptionValue: "ContactPersonnelID",
            DisplayText: "Name",
            InitialValue:""
        });
    }

    function LoadDeliveredContactPersonnel(oCPs){
        $("#cboCPDeliverTo").icsLoadCombo({
            List: oCPs,
            OptionValue: "ContactPersonnelID",
            DisplayText: "Name",
            InitialValue:""
        });
    }

    function ResetControll(){
        _oLabDip=null;
        $('.reset-text').val("");
        $('#dtOrderDate,#dtSeekingDate').datebox('setValue', icsdateformat(new Date()));
        LoadIssueContactPersonnel(_oCPIssueTos);
        LoadDeliveredContactPersonnel(_oCPDeliveryTos);
        $('.number').val("0.00");
        DynamicRefreshList([], 'tblLabDipDetail');
    }

    function RefreshControl(oLabDip){
        _oLabDip=oLabDip;

        $('#txtLabdipNo').val(oLabDip.LabdipNo);
        $('#dtOrderDate').datebox('setValue',oLabDip.OrderDateStr);
        $('#cboFormat').val(oLabDip.LabDipFormat);
        $('#txtMktPerson').val(oLabDip.MktPerson);


        $('#txtIssueTo').val(oLabDip.ContractorName);
        $('#txtDeliverTo').val(oLabDip.DeliveryToName);

        $('#cboCPIssueTo').val(oLabDip.ContactPersonnelID);
        $('#cboCPDeliverTo').val(oLabDip.DeliveryToContactPersonnelID);

        $('#dtSeekingDate').datebox('setValue',oLabDip.SeekingDateStr);
        $('#cboPriorityLevel').val(oLabDip.PriorityLevel);

        $('#txtPH').val(oLabDip.PH);
        $('#cboLightSource').val(oLabDip.LightSourceID);
        $('#txtBuyerRef').val(oLabDip.BuyerRefNo);
        $('#txtNote').val(oLabDip.Note);

        DynamicRefreshList(oLabDip.LabDipDetails, 'tblLabDipDetail');
        HideMultipleColorIssue();
    }

    $('#btnClose').click(function(e){
        window.location.href = sessionStorage.getItem("BackLink");
    });

    function SetIntoSessionStorage(){

        var sBackLink=sessionStorage.getItem('BackLink');
        var nIndex=sessionStorage.getItem('SelectedRowIndex');
        var oLabDips= (sessionStorage.getItem('Labdips').length>0)? jQuery.parseJSON(sessionStorage.getItem('Labdips')):[] ;
        if(_oLabDip!=null && _oLabDip.LabDipID>0){

            if(nIndex>=0){
                oLabDips[nIndex]=_oLabDip;
            }
            else{
                oLabDips.push(_oLabDip);
            }
        }
        sessionStorage.clear();
        sessionStorage.setItem("BackLink", sBackLink);
        sessionStorage.setItem("SelectedRowIndex", nIndex);
        sessionStorage.setItem("Labdips", JSON.stringify(oLabDips));
    }


    /*-----------------Issue Color ----------------*/

    function HideMultipleColorIssue(){

        $('#tblLabDipDetail').datagrid('checkAll');
        if($('#tblLabDipDetail').datagrid('getChecked').length<=0){
            $('#btnIssueColor,#btnMultipleColor').hide();
            $('#tblLabDipDetail').datagrid('hideColumn','Selected');
        }
        else{
            $('#tblLabDipDetail').datagrid('uncheckAll');
            $('#btnIssueColor,#btnMultipleColor').show();
            $('#tblLabDipDetail').datagrid('showColumn','Selected');
        }

    }

    function PreventSelectColeredItem(oLabdipDetails)
    {
        debugger;
        for(var i=0;i<oLabdipDetails.length;i++){
            if(oLabdipDetails[i].ColorNo!=""){
                $('#tblLabDipDetail').datagrid('uncheckRow', i);
            }
        }
    }

    function CheckUncheck(rowIndex, rowData){
        if(rowData.ColorNo!=""){
            $('#tblLabDipDetail').datagrid('uncheckRow', rowIndex);
        }
    }

    $('#btnIssueColor').click(function(e){


        _oLabdipDetail = $("#tblLabDipDetail").datagrid("getSelected");
        if (_oLabdipDetail == null || _oLabdipDetail.LabDipDetailID <= 0) { alert("Please select an item from list."); return false; }
        if(_oLabdipDetail.ColorNo!=""){
            alert("Already color issued.");
            return false;
        }

        var obj = {
            BaseAddress: _sBaseAddress,
            Object: _oLabdipDetail,
            ObjectId: _oLabdipDetail.LabDipDetailID,
            ControllerName: "LabDip",
            ActionName: "IssueColor",
            TableId: "tblLabDipDetail",
            IsWinClose: false,
            Message: "Color Issued Successfully."
        };
        $.icsSave(obj, function (response) {

            debugger;
            if (response.status && response.obj.LabDipDetailID>0 && response.obj.ColorNo>0) {
                var nIndex = $("#tblLabDipDetail").datagrid("getRowIndex", _oLabdipDetail);
                OperationPerforms(nIndex, response.obj);
                CheckUncheck(nIndex, response.obj);
                HideMultipleColorIssue();
            }
        });
    });

    $('#tblLabDipDetail').datagrid({ onCheckAll: function (rows) { PreventSelectColeredItem(rows); } });

    $('#tblLabDipDetail').datagrid({ onUncheckAll: function (rows) { PreventSelectColeredItem(rows); } });

    $('#tblLabDipDetail').datagrid({ onCheck: function (rowIndex, rowData) { CheckUncheck(rowIndex, rowData); } });

    $('#btnMultipleColor').click(function(e){

        var oLabDipDetails= $('#tblLabDipDetail').datagrid('getChecked');
        debugger;
        if(oLabDipDetails.length<=0){ alert("please select at least one item."); return false; }

        for(var i=0; i<oLabDipDetails.length;i++){
            if(oLabDipDetails[i].ColorNo!=''){
                alert("Please unchecked the color item of row no - "+ (i+1).toString());
                return;
            }
        }

        var oLabDip={
            LabDipDetails:oLabDipDetails
        }

        var obj = {
            BaseAddress: _sBaseAddress,
            Object: oLabDip,
            ObjectId: 0,
            ControllerName: "LabDip",
            ActionName: "IssueColorMultiple",
            TableId: "",
            IsWinClose: false,
            Message: ""
        };
        $.icsSave(obj, function (response) {

            if (response.status && response.obj != null) {
                if (response.obj.LabDipDetails.length>0 && response.obj.LabDipDetails[0].LabDipDetailID>0) {
                    alert("Color Assigned successfully");
                    for(var i=0; i<oLabDipDetails.length;i++){
                        var nIndex = $("#tblLabDipDetail").datagrid("getRowIndex", oLabDipDetails[i]);
                        $("#tblLabDipDetail").datagrid("updateRow", { index: nIndex, row: response.obj.LabDipDetails[i] });
                        CheckUncheck(nIndex,response.obj.LabDipDetails[i]);
                        HideMultipleColorIssue();
                    }
                }
            }
        });

    });




    /*----------------- Assigned Person ----------------*/



    $('#btnAssignPerson').click(function(e){


        _oLabdipDetail = $("#tblLabDipDetail").datagrid("getSelected");
        if (_oLabdipDetail == null || _oLabdipDetail.LabDipDetailID <= 0) { alert("Please select an item from list."); return false; }
        if(_oLabdipDetail.ColorNo ==""){
            alert("Please issue color for this item..");
            return false;
        }
        var obj = {
            BaseAddress: _sBaseAddress,
            Object: _oLabdipDetail,
            ControllerName: "LabDip",
            ActionName: "GetsLabdipAssignedPersonnel",
            IsWinClose: false
        };
        $.icsDataGets(obj, function (response) {

            debugger;
            if (response.status && response.objs.length>0 && response.objs[0].LabdipAssignedPersonnelID>0) {
                DynamicRefreshList(response.objs, 'tblLabdipAssignedPersonnel');
            }
            _nEmployeeID=0;
            $('#txtEmployeeName').val("");
            $('#WinAssigendPerson').icsWindow('open');
        });

    });

    $('#btnCloseWinAssigendPerson').click(function(e){

        $('#WinAssigendPerson').icsWindow('close');
    });


    function AddAssignedPerson(){
        if(_nEmployeeID<=0){
            $('#txtEmployeeName').focus();
            $('#txtEmployeeName').addClass("errorFieldBorder");
            alert('No employee found.');
            return false;
        }
        else{
            $('#txtEmployeeName').removeClass("errorFieldBorder");
        }

        var oLabdipAssignedPersonnel={
            LabdipAssignedPersonnelID : 0,
            LabDipDetailID : _oLabdipDetail.LabDipDetailID,
            EmployeeID : _nEmployeeID
        };

        var obj = {
            BaseAddress: _sBaseAddress,
            Object: oLabdipAssignedPersonnel,
            ObjectId: oLabdipAssignedPersonnel.LabdipAssignedPersonnelID,
            ControllerName: "LabDip",
            ActionName: "SaveLabdipAssignedPersonnel",
            TableId: "tblLabdipAssignedPersonnel",
            IsWinClose: false,
            Message: (oLabdipAssignedPersonnel.LabdipAssignedPersonnelID>0)?"Update Successfully." : "Save Successfully."
        };
        $.icsSave(obj, function (response) {
            if (response.status && response.obj != null) {
                if (response.obj.LabdipAssignedPersonnelID > 0) {
                    $('#txtEmployeeName').val("");
                    _nEmployeeID=0;
                }
            }
        });
    }

    $("#btnDeleteAssigendPerson").click(function () {

        var oLabdipAssignedPersonnel = $("#tblLabdipAssignedPersonnel").datagrid("getSelected");
        if (oLabdipAssignedPersonnel == null || oLabdipAssignedPersonnel.LabdipAssignedPersonnelID <= 0) { alert("Please select an item from list."); return false; }

        if (!confirm("Confirm to Delete?")) return false;

        var obj =
        {
            BaseAddress: _sBaseAddress,
            Object: oLabdipAssignedPersonnel,
            ControllerName: "LabDip",
            ActionName: "DeleteLabdipAssignedPersonnel",
            TableId: "tblLabdipAssignedPersonnel",
            IsWinClose: false,
            Message:''
        };
        $.icsDelete(obj);

    });

    $("#btnResetAssigendPerson").click(function () {

        $("#txtEmployeeName").val("");
        _nEmployeeID=0;
    });

    $("#btnPickAssigendPerson").click(function () {

        var sEmployeeName=$.trim($("#txtEmployeeName").val());
        if(sEmployeeName==""){ alert("Type employee name to search."); return false; }
        GetEmployees(sEmployeeName);
    });

    $("#txtEmployeeName").keydown(function (e) {
        var nkeyCode = e.keyCode || e.which;
        if(nkeyCode==13){
            var sEmployeeName=$.trim($("#txtEmployeeName").val());
            if(sEmployeeName==""){ alert("Type employee name to search."); return false; }
            GetEmployees(sEmployeeName);
        }
        else if(nkeyCode==8){
            $("#txtEmployeeName").val("");
            _nEmployeeID=0;
        }
    });

    function GetEmployees(sEmployeeName){

        var oLabDipDetail = {
            LabDipDetailID:_oLabdipDetail.LabDipDetailID,
            Params:sEmployeeName
        };
        var obj = {
            BaseAddress: _sBaseAddress,
            Object: oLabDipDetail,
            ControllerName: "LabDip",
            ActionName: "GetsEmployeeForLabdipAssignedPersonnel",
            IsWinClose: false
        };

        $.icsDataGets(obj, function (response) {

            if (response.status && response.objs.length > 0) {
                if (response.objs[0].EmployeeID > 0) {
                    debugger;
                    var tblColums = [];
                    var oColumn = { field: "NameCode", title: "Employee Name", width: 160, align: "left" };tblColums.push(oColumn);

                    var oPickerParam = {
                        winid: 'winEmployeePicker',
                        winclass:'clsEmployeePicker',
                        winwidth: 180,
                        winheight: 350,
                        tableid: 'tblEmployeePicker',
                        tablecolumns: tblColums,
                        datalist: response.objs,
                        multiplereturn: false,
                        searchingbyfieldName:'NameCode',
                        windowTittle: 'Employee List'
                    };
                    $.icsPicker(oPickerParam);
                    IntializeEmployeePickerbutton(oPickerParam);//multiplereturn, winclassName
                }
                else { alert(response.objs[0].ErrorMessage); }
            }
            else{
                alert("No Employee found.");
            }
        });


    }

    function IntializeEmployeePickerbutton(oPickerobj)
    {
        $("#" + oPickerobj.winid).find("#btnOk").click(function () {
            EmployeeSelect(oPickerobj);
        });
        $(document).find('.' +oPickerobj.winclass).keydown(function (e) {
            if (e.which == 13)//enter=13
            {
                EmployeeSelect(oPickerobj);
            }
        });
    }

    function EmployeeSelect(oPickerobj){
        var oEmployee = $('#'+oPickerobj.tableid).datagrid('getSelected');
        if (oPickerobj.winid == 'winEmployeePicker')
        {
            if(oEmployee !=null  && oEmployee.EmployeeID>0){
                $("#"+oPickerobj.winid).icsWindow("close");
                $("#" + oPickerobj.winid).remove();
                $('#txtEmployeeName').val(oEmployee.NameCode);
                _nEmployeeID= oEmployee.EmployeeID;
                AddAssignedPerson();
            }
            else{
                alert("Please select employee.");
            }
        }
    }

    /*----------------  Labdip Shade & Recipe --------------- */

    $('#tblLabdipShade').datagrid({ onSelect: function (rowIndex, rowData) { LabdipShadeOperationPerforms(rowIndex, rowData); } });

    function LabdipShadeOperationPerforms(rowIndex, rowData){
        var nTotalPerTage=0;
        ResetGridCellEdit();
        var oRecipeDyes=[], oRecipeChemicals=[];
        if(rowData!=null && rowData.LabdipShadeID>0){
            nTotalPerTage=0;
            for(var i=0; i<_oRecipeDyes.length;i++)
            {
                if(_oRecipeDyes[i].LabdipShadeID==rowData.LabdipShadeID)
                {
                    _oRecipeDyes[i].PerTage=(_oRecipeDyes[i].Qty*100)/rowData.Qty;
                    nTotalPerTage=nTotalPerTage+_oRecipeDyes[i].PerTage;
                    oRecipeDyes.push(_oRecipeDyes[i]);
                }
            }
            rowData.ShadePercentage=nTotalPerTage;
            $("#tblLabdipShade").datagrid("updateRow", { index: rowIndex, row: rowData });
            for(var i=0; i<_oRecipeChemicals.length;i++){
                if(_oRecipeChemicals[i].LabdipShadeID==rowData.LabdipShadeID){
                    oRecipeChemicals.push(_oRecipeChemicals[i]);
                }
            }
        }
        DynamicRefreshList(oRecipeDyes, 'tblRecipeDyes');
        DynamicRefreshList(oRecipeChemicals, 'tblRecipeChemical');
    }

    function ResetLabdipShadeRecipe(nShadeCount){
        _oLabdipShade=null;
        _nProductIDDyes=0;
        _nProductIDChemicals=0;
        $('#cboSahde').val(0);
        $('#txtNoteShade, #txtProductDyes, #txtNoteDyes,  #txtProductChemical, #txtNoteChemical').val("");
        $('#txtQtyDyes, #txtQtyChemical').val("0.00");

        nShadeCount= (nShadeCount>_oShades.length)?_oShades.length:nShadeCount;
        _oTempShades=[];
        for(var i=0;i<=nShadeCount;i++){
            _oTempShades.push(_oShades[i]);
        }

        $("#cboSahde").icsLoadCombo({
            List: _oTempShades,
            OptionValue: "id",
            DisplayText: "Value",
            InitialValue:"Default"
        });

        _oRecipeDyes=[];
        _oRecipeChemicals=[];
        DynamicRefreshList([], 'tblLabdipShade');
        DynamicRefreshList(_oRecipeDyes, 'tblRecipeDyes');
        DynamicRefreshList(_oRecipeChemicals, 'tblRecipeChemical');
        ResetGridCellEdit();
    }

    function ResetGridCellEdit(){
        _nDyesQty=0;
        _nChamicalQty=0;
        editIndexDyes=undefined;
        editIndexChemical=undefined;
        nDyesIndex=-1;
        nChemicalIndex=-1;
    }


    function GetShadeReceipe(sOperation){
        debugger;
        _oLabdipDetail = $("#tblLabDipDetail").datagrid("getSelected");
        if (_oLabdipDetail == null || _oLabdipDetail.LabDipDetailID <= 0) { alert("Please select an item from list."); return false; }
        if(_oLabdipDetail.ColorNo ==""){
            alert(((sOperation=="View")? "Color yet no issued." : "Please issue color for this item."));
            return false;
        }
        $('#txtYarn_LDD').val(_oLabdipDetail.ProductName);
        $('#txtColor_LDD').val(_oLabdipDetail.ColorName);
        $('#txtLot_LDD').val(_oLabdipDetail.LotNo);
        ResetLabdipShadeRecipe(_oLabdipDetail.ShadeCount);

        if(_sOperation=="View"){
            $('#toolLabdipSahde,#toolbarChemicals,#toolbarDyes,#btnSaveWinShadeRecipe').hide();
        }
        else{
            $('#toolLabdipSahde,#toolbarChemicals,#toolbarDyes,#btnSaveWinShadeRecipe').show();
        }
        var obj = {
            BaseAddress: _sBaseAddress,
            Object: _oLabdipDetail,
            ControllerName: "LabDip",
            ActionName: "GetsLabdipShade",
            IsWinClose: false
        };
        $.icsDataGet(obj, function (response) {

            debugger;
            if (response.status && response.obj.LabdipShades.length>0) {
                _oRecipeDyes=response.obj.RecipeDyes;
                _oRecipeChemicals=response.obj.RecipeChemicals;

                DynamicRefreshList(response.obj.LabdipShades, 'tblLabdipShade');
                DynamicRefreshList([], 'tblRecipeDyes');
                DynamicRefreshList([], 'tblRecipeChemical');
            }

            $('#WinShadeRecipe').icsWindow('open');
        });
    }

    $('#btnViewSahdeReceipe').click(function(e){

        GetShadeReceipe();
    });


    $('#btnSahdeReceipe').click(function(e){

        GetShadeReceipe();

    });

    $('#btnCloseWinShadeRecipe').click(function(e){

        $('#WinShadeRecipe').icsWindow('close');
    });

    $('#btnSaveWinShadeRecipe').click(function(e){


        debugger;
        endEditing('tblRecipeDyes');
        endEditing('tblRecipeChemical');
        _oLabdipDetail.LotNo =  $('#txtLot_LDD').val();

        var obj = {
            BaseAddress: _sBaseAddress,
            Object: _oLabdipDetail,
            ObjectId: _oLabdipDetail.LabDipDetailID,
            ControllerName: "LabDip",
            ActionName: "UpdateLot",
            TableId: "",
            IsWinClose: false,
            Message: ""// (oLabDipDetail.LabDipDetailID>0)?"Update Successfully." : "Save Successfully."
        };
        $.icsSave(obj, function (response) {
            if (response.status && response.obj != null) {
                debugger;
                if (response.obj.LabDipDetailID > 0) {
                    alert("Data Save Successfully")
                }
            }
        });



    });

    function ValidationShade(){

        if($('#cboSahde').val()<=0){
            $('#cboSahde').focus();
            $('#cboSahde').addClass("errorFieldBorder");
            alert('Select Shade.');
            return false;
        }
        else{
            $('#cboSahde').removeClass("errorFieldBorder");
        }

        //if($.trim($('#txtShadePercentage').val())==""){
        //    $('#txtShadePercentage').focus();
        //    $('#txtShadePercentage').addClass("errorFieldBorder");
        //    alert('Please enter shade percentage.');
        //    return false;
        //}
        //else{
        //    $('#txtShadePercentage').removeClass("errorFieldBorder");
        //}

        //if(parseFloat(icsRemoveComma($('#txtShadePercentage').val()))<=0){
        //    $('#txtShadePercentage').focus();
        //    $('#txtShadePercentage').addClass("errorFieldBorder");
        //    alert('Shade percentage must be greater than zero.');
        //    return false;
        //}
        //else{
        //    $('#txtShadePercentage').removeClass("errorFieldBorder");
        //}

        var oLabdipShades = $("#tblLabdipShade").datagrid("getRows");
        if(oLabdipShades.length>0){
            for(var i=0;i<oLabdipShades.length;i++){
                if(oLabdipShades[i].ShadeID==$('#cboSahde').val()){
                    alert("Already this added.");
                    return false;
                }
            }

            if(oLabdipShades.length>=_oTempShades.length){
                alert("No remaining shade found to add.");
                return false;
            }

            if(parseInt(oLabdipShades[oLabdipShades.length-1].ShadeID)+1!=$('#cboSahde').val()){
                $('#cboSahde').focus();
                $('#cboSahde').addClass("errorFieldBorder");
                alert('Please select '+ _oTempShades[oLabdipShades.length].Value +' shade qq');
                return false;
            }
        }
        else{

            if(_oTempShades.length==0){
                $('#cboSahde').focus();
                $('#cboSahde').addClass("errorFieldBorder");
                alert('No shade found.');
                return false;
            }
            //else if($('#cboSahde').val()!=_oTempShades[0].Value){
            //    $('#cboSahde').focus();
            //    $('#cboSahde').addClass("errorFieldBorder");
            //    alert('Please select '+ _oTempShades[0].Value +' shade aa');
            //    return false;
            //}
            //else{
            //    $('#cboSahde').removeClass("errorFieldBorder");
            //}
        }

        return true;
    }

    function RefreshObjectShade()
    {

        var oLabdipShade={
            LabdipShadeID : 0,
            LabDipDetailID : _oLabdipDetail.LabDipDetailID,
            ShadeID : $('#cboSahde').val(),
            ShadePercentage: parseFloat(icsRemoveComma($('#txtShadePercentage').val())),
            Qty: parseFloat(icsRemoveComma($('#txtQty_Shade').val())),
            Note : $('#txtNoteShade').val()

        };
        return oLabdipShade;
    }

    $("#btnAddShade").click(function (){
        if(!ValidationShade()) return false;

        var oLabdipShade=RefreshObjectShade();
        var obj = {
            BaseAddress: _sBaseAddress,
            Object: oLabdipShade,
            ObjectId: oLabdipShade.LabdipShadeID,
            ControllerName: "LabDip",
            ActionName: "SaveLabdipShade",
            TableId: "tblLabdipShade",
            IsWinClose: false,
            Message: (oLabdipShade.LabdipShadeID>0)?"Update Successfully." : "Save Successfully."
        };
        $.icsSave(obj, function (response) {
            if (response.status && response.obj != null) {
                if (response.obj.LabdipShadeID > 0) {

                }
            }
        });
    });

    $("#btnDeleteShade").click(function () {

        var oLabdipShades = $("#tblLabdipShade").datagrid("getRows");
        var oLabdipShade = $("#tblLabdipShade").datagrid("getSelected");
        if (oLabdipShade == null || oLabdipShade.LabdipShadeID <= 0) { alert("Please select an item from list."); return false; }

        if(oLabdipShades[oLabdipShades.length-1].LabdipShadeID!=oLabdipShade.LabdipShadeID){ alert("Please delete last item first."); return false; }

        if (oLabdipShade.ApproveBy > 0) { alert("Already Approvd. Unable to delete."); return false; }

        if (!confirm("Confirm to Delete?")) return false;

        var obj =
        {
            BaseAddress: _sBaseAddress,
            Object: oLabdipShade,
            ControllerName: "LabDip",
            ActionName: "DeleteLabdipShade",
            TableId: "tblLabdipShade",
            IsWinClose: false,
            Message:''
        };
        $.icsDelete(obj, function (response) {
            if (response.status && response.Message == 'deleted') {

                var oRecipeDyes=[], oRecipeChemicals=[];
                for(var i=0; i<_oRecipeDyes.length;i++){
                    if(_oRecipeDyes[i].LabdipShadeID!=oLabdipShade.LabdipShadeID){
                        oRecipeDyes.push(_oRecipeDyes[i]);
                    }
                }
                for(var i=0; i<_oRecipeChemicals.length;i++){
                    if(_oRecipeChemicals[i].LabdipShadeID!=oLabdipShade.LabdipShadeID){
                        oRecipeChemicals.push(_oRecipeChemicals[i]);
                    }
                }
                _oRecipeDyes=oRecipeDyes;
                _oRecipeChemicals=oRecipeChemicals;
                DynamicRefreshList([], 'tblRecipeDyes');
                DynamicRefreshList([], 'tblRecipeChemical');
            }
        });

    });

    $("#btnApproveShade").click(function (){

        var oLabdipShade = $("#tblLabdipShade").datagrid("getSelected");
        if (oLabdipShade == null || oLabdipShade.LabdipShadeID <= 0) { alert("Please select an item from list."); return false; }
        if (oLabdipShade.ApproveBy > 0) { alert("Already Approved."); return false; }

        if (!confirm("Confirm to Approve?")) return false;

        var obj = {
            BaseAddress: _sBaseAddress,
            Object: oLabdipShade,
            ObjectId: oLabdipShade.LabdipShadeID,
            ControllerName: "LabDip",
            ActionName: "ApproveLabdipShade",
            TableId: "tblLabdipShade",
            IsWinClose: false,
            Message: "Approved Successfully."
        };
        $.icsSave(obj);
    });

    $("#btnCopyShade").click(function (){

        var oLabdipShade = $("#tblLabdipShade").datagrid("getSelected");
        if (oLabdipShade == null || oLabdipShade.LabdipShadeID <= 0) { alert("Please select an item from list."); return false; }

        var oLabdipShades=$("#tblLabdipShade").datagrid("getRows");
        if(oLabdipShades.length>=_oTempShades.length){
            alert("No remaining shade found to add.");
            return false;
        }

        if (!confirm("Confirm to copy this item as new shade?")) return false;

        var obj = {
            BaseAddress: _sBaseAddress,
            Object: oLabdipShade,
            ObjectId: oLabdipShade.LabdipShadeID,
            ControllerName: "LabDip",
            ActionName: "CopyLabdipShade",
            TableId: "",
            IsWinClose: false,
            Message: "Copy Successfully."
        };
        $.icsSave(obj, function (response) {
            if (response.status && response.obj != null && response.obj.LabdipShadeID>0) {

                $("#tblLabdipShade").datagrid('appendRow',response.obj);
                $("#tblLabdipShade").datagrid("selectRow", oLabdipShades.length);
                for(var i=0; i<response.obj.RecipeDyes.length;i++){
                    _oRecipeDyes.push(response.obj.RecipeDyes[i]);
                }
                for(var i=0; i<response.obj.RecipeChemicals.length;i++){
                    _oRecipeChemicals.push(response.obj.RecipeChemicals[i]);
                }
                DynamicRefreshList(response.obj.RecipeDyes, 'tblRecipeDyes');
                DynamicRefreshList(response.obj.RecipeChemicals, 'tblRecipeChemical');
            }
        });
    });




    function ValidationRecipe(bIsDyes){

        _oLabdipShade = $("#tblLabdipShade").datagrid("getSelected");
        if (_oLabdipShade == null || _oLabdipShade.LabdipShadeID <= 0) { alert("Please select an item from list."); return false; }
        //if (_oLabdipShade.ApproveBy == 0) { alert("Yet not approved. Please approve labdip shade first."); return false; }


        if(bIsDyes){
            if(_nProductIDDyes<=0){
                $('#txtProductDyes').focus();
                $('#txtProductDyes').addClass("errorFieldBorder");
                alert('No dyes found to add.');
                return false;
            }
            else{
                $('#txtProductDyes').removeClass("errorFieldBorder");
            }

            if($.trim($('#txtQtyDyes').val())==""){
                $('#txtQtyDyes').focus();
                $('#txtQtyDyes').addClass("errorFieldBorder");
                alert('Please enter quantity.');
                return false;
            }
            else{
                $('#txtQtyDyes').removeClass("errorFieldBorder");
            }

            ////if(parseFloat(icsRemoveComma($('#txtQtyDyes').val()))<=0){
            ////    $('#txtQtyDyes').focus();
            ////    $('#txtQtyDyes').addClass("errorFieldBorder");
            ////    alert('Quantity must be greater than zero.');
            ////    return false;
            ////}
            ////else{
            ////    $('#txtQtyDyes').removeClass("errorFieldBorder");
            ////}
        }
        else{
            if(_nProductIDChemicals<=0){
                $('#txtProductChemical').focus();
                $('#txtProductChemical').addClass("errorFieldBorder");
                alert('No chemical found to add.');
                return false;
            }
            else{
                $('#txtProductChemical').removeClass("errorFieldBorder");
            }

            if($.trim($('#txtQtyChemical').val())==""){
                $('#txtQtyChemical').focus();
                $('#txtQtyChemical').addClass("errorFieldBorder");
                alert('Please enter quantity.');
                return false;
            }
            else{
                $('#txtQtyChemical').removeClass("errorFieldBorder");
            }

            if(parseFloat($('#txtQtyChemical').val())<=0){
                $('#txtQtyChemical').focus();
                $('#txtQtyChemical').addClass("errorFieldBorder");
                alert('Quantity must be greater than zero.');
                return false;
            }
            else{
                $('#txtQtyChemical').removeClass("errorFieldBorder");
            }
        }


        return true;
    }

    function RefreshObjectRecipe(bIsDyes)
    {
        var bIsGL=false;
        bIsGL= (bIsDyes)? 0:$("#chkIsGL").is(":checked");
        var oLabdipRecipe={
            LabdipRecipeID : 0,
            LabdipShadeID : _oLabdipShade.LabdipShadeID,
            ProductID : (bIsDyes)? _nProductIDDyes:_nProductIDChemicals,
            IsGL : bIsGL,
            PerTage: (bIsDyes)? parseFloat($('#txtPerDyes').val()):0,
            Qty : (bIsDyes)? parseFloat($('#txtQtyDyes').val()):parseFloat($('#txtQtyChemical').val()),
            IsGLSt:(bIsGL)? "GL":"%",
            Note : (bIsDyes)? $.trim($('#txtNoteDyes').val()):$.trim($('#txtNoteChemical').val()),
            IsDyes : bIsDyes
        };
        return oLabdipRecipe;
    }


    $("#btnAddDyes").click(function (){
        if(!ValidationRecipe(true)) return false;
        var oLabdipRecipe=RefreshObjectRecipe(true);
        SaveLabdipRecipe(oLabdipRecipe, 'tblRecipeDyes');
    });

    $("#btnDeleteDyes").click(function () {

        var oLabdipRecipe = $("#tblRecipeDyes").datagrid("getSelected");
        if (oLabdipRecipe == null || oLabdipRecipe.LabdipRecipeID <= 0) { alert("Please select an item from list."); return false; }
        DeleteLabdipRecipe(oLabdipRecipe,'tblRecipeDyes');
    });


    $("#btnAddChemical").click(function (){
        if(!ValidationRecipe(false)) return false;
        var oLabdipRecipe=RefreshObjectRecipe(false);
        SaveLabdipRecipe(oLabdipRecipe, 'tblRecipeChemical');
    });

    $("#btnDeleteChemical").click(function () {

        var oLabdipRecipe = $("#tblRecipeChemical").datagrid("getSelected");
        if (oLabdipRecipe == null || oLabdipRecipe.LabdipRecipeID <= 0) { alert("Please select an item from list."); return false; }
        DeleteLabdipRecipe(oLabdipRecipe,'tblRecipeChemical');
    });


    function SaveLabdipRecipe(oLabdipRecipe, tableID){

        var obj = {
            BaseAddress: _sBaseAddress,
            Object: oLabdipRecipe,
            ObjectId: oLabdipRecipe.LabdipRecipeID,
            ControllerName: "LabDip",
            ActionName: "SaveLabdipRecipe",
            TableId: tableID,
            IsWinClose: false,
            Message: (oLabdipRecipe.LabdipRecipeID>0)?"Update Successfully." : "Save Successfully."
        };
        $.icsSave(obj, function (response) {
            if (response.status && response.obj != null) {
                if (response.obj.LabdipRecipeID > 0) {

                    if(response.obj.IsDyes){

                        _oRecipeDyes.push(response.obj);
                        $('#txtProductDyes').val("");
                        $('#txtProductDyes').focus();
                        $('#txtProductDyes').addClass("errorFieldBorder");
                    }
                    else{
                        _oRecipeChemicals.push(response.obj);
                        $('#txtProductChemical').val("");
                        $('#txtProductChemical').focus();
                        $('#txtProductChemical').addClass("errorFieldBorder");
                    }
                }
            }
        });

    }

    function DeleteLabdipRecipe(oLabdipRecipe, tableID){

        if (!confirm("Confirm to Delete?")) return false;
        var obj =
        {
            BaseAddress: _sBaseAddress,
            Object: oLabdipRecipe,
            ControllerName: "LabDip",
            ActionName: "DeleteLabdipRecipe",
            TableId: tableID,
            IsWinClose: false,
            Message:''
        };
        $.icsDelete(obj, function (response) {
            if (response.status && response.Message =='deleted') {

                if(tableID=='tblRecipeDyes'){
                    _nDyesQty=0;
                    _nChamicalQty=0;
                    editIndexDyes=undefined;
                }
                else if(tableID=='tblRecipeChemical'){
                    editIndexChemical=undefined;
                    nDyesIndex=-1;
                    nChemicalIndex=-1;
                }

            }
        });
    }



    /*--------------- Grid Edit--------------*/

    var _nDyesQty=0;
    var _nChamicalQty=0;
    var editIndexDyes=undefined;
    var editIndexChemical=undefined;
    var nDyesIndex=-1;
    var nChemicalIndex=-1;


    function endEditing(tblId) {

        debugger;
        var editIndex = ((tblId == 'tblRecipeDyes')?editIndexDyes:editIndexChemical);

        if (editIndex == undefined) {
            return true;
        }
        if ($('#'+tblId).datagrid('validateRow', editIndex)) {

            $('#'+tblId).datagrid('endEdit', editIndex);
            $('#'+tblId).datagrid('selectRow', editIndex);
            var oLabdipRecipe = $('#'+tblId).datagrid('getSelected');
            if ( parseFloat(oLabdipRecipe.Qty)<=0 || parseFloat(oLabdipRecipe.Qty)== ((tblId == 'tblRecipeDyes')?parseFloat(_nDyesQty):parseFloat(_nChamicalQty)) ) {
                editIndex = undefined;
                return true;
            }
            else {
                var obj = {
                    BaseAddress: _sBaseAddress,
                    Object: oLabdipRecipe,
                    ObjectId: oLabdipRecipe.LabdipRecipeID,
                    ControllerName: "LabDip",
                    ActionName: "SaveLabdipRecipe",
                    TableId: tblId,
                    IsWinClose: false,
                    Message: ""
                };

                $.icsSave(obj, function (response) {

                    if(tblId == 'tblRecipeDyes'){
                        if(editIndex==nDyesIndex){
                            editIndexDyes = undefined;
                        }
                        else{
                            editIndexDyes = nDyesIndex;
                            $('#'+tblId).datagrid('selectRow', editIndexDyes).datagrid('beginEdit', editIndexDyes);
                            var oLabdipRecipe=$('#'+tblId).datagrid('getSelected');
                            _nDyesQty =  parseFloat(oLabdipRecipe.Qty);
                        }
                    }
                    else{
                        if(editIndex==nChemicalIndex){
                            editIndexChemical = undefined;
                        }
                        else{
                            editIndexChemical = nChemicalIndex;
                            $('#'+tblId).datagrid('selectRow', editIndexChemical).datagrid('beginEdit', editIndexChemical);
                            var oLabdipRecipe=$('#'+tblId).datagrid('getSelected');
                            _nChamicalQty =  parseFloat(oLabdipRecipe.Qty);
                        }
                    }
                    return true;
                });
            }
        }
        else { return false; }
    }

    function onClickRowDyes(index) {
        if (editIndexDyes != index && _sOperation!="View") {
            nDyesIndex=index;
            if (endEditing('tblRecipeDyes')) {
                debugger;
                $('#tblRecipeDyes').datagrid('selectRow', index).datagrid('beginEdit', index);
                var oLabdipRecipe=$('#tblRecipeDyes').datagrid('getSelected');
                _nDyesQty = parseFloat(oLabdipRecipe.Qty);
                editIndexDyes = index;
            }
            else {
                $('#tblRecipeDyes').datagrid('selectRow', editIndexDyes);
            }
        }
    }

    function onClickRowChemical(index) {

        if (editIndexChemical != index) {
            nChemicalIndex=index;
            if (endEditing('tblRecipeChemical')) {
                $('#tblRecipeChemical').datagrid('selectRow', index).datagrid('beginEdit', index);
                var oLabdipRecipe=$('#tblRecipeChemical').datagrid('getSelected');
                _nChamicalQty = parseFloat(oLabdipRecipe.Qty);
                editIndexChemical = index;
            }
            else {
                $('#tblRecipeChemical').datagrid('selectRow', editIndexChemical);
            }
        }
    }

    /*-------------------- Product ---------------*/
    $("#btnResetDyes").click(function () {
        $("#txtProductDyes").val("");
        _nProductIDDyes=0;
    });

    $("#btnPickDyes").click(function () {
        var sProductName=$.trim($("#txtProductDyes").val());
        GetProducts(sProductName, true);
    });

    $("#txtProductDyes").keydown(function (e) {
        var nkeyCode = e.keyCode || e.which;
        if(nkeyCode==13){
            var sProductName=$.trim($("#txtProductDyes").val());
            GetProducts(sProductName,true);
        }
        else if(nkeyCode==8){
            $("#txtProductDyes").val("");
            _nProductIDDyes=0;
        }
    });



    $("#btnResetChemical").click(function () {
        $("#txtProductChemical").val("");
        _nProductIDChemicals=0;
    });

    $("#btnPickChemical").click(function () {
        var sProductName=$.trim($("#txtProductChemical").val());
        GetProducts(sProductName, false);
    });

    $("#txtProductChemical").keydown(function (e) {
        var nkeyCode = e.keyCode || e.which;
        if(nkeyCode==13){
            var sProductName=$.trim($("#txtProductChemical").val());
            GetProducts(sProductName,false);
        }
        else if(nkeyCode==8){
            $("#txtProductChemical").val("");
            _nProductIDChemicals=0;
        }
    });

    function GetProducts(sProductName, bIsDyes){
        var bProductCategoryID=0;
        if(bIsDyes)
        {
            bProductCategoryID=25;
        }
        else{
            bProductCategoryID=26;
        }

        var oProduct = {
            BUID:_nBUID,
            ProductName:sProductName,
            ProductCategoryName: (bIsDyes)? 'Dyes':'Chemicals',
            ProductCategoryID:bProductCategoryID

        };

        var obj = {
            BaseAddress: _sBaseAddress,
            Object: oProduct,
            ControllerName: "RouteSheet",
            ActionName: "GetProducts",
            IsWinClose: false
        };

        $.icsDataGets(obj, function (response) {

            if (response.status && response.objs.length > 0) {
                if (response.objs[0].ProductID > 0) {
                    debugger;
                    var tblColums = [];
                    var oColumn = { field: "ProductCode", title: "Code", width: 100, align: "left" };tblColums.push(oColumn);
                    oColumn = { field: "ProductName", title: "Name", width: 160, align: "left" };tblColums.push(oColumn);
                    oColumn = { field: "ProductCategoryName", title: "Category Name", width: 270, align: "left" };tblColums.push(oColumn);
                    oColumn = { field: "MUnit", title: "Unit", width: 70, align: "left" };tblColums.push(oColumn);

                    var oPickerParam = {
                        winid: 'winProductPicker',
                        winclass:'clsProductPicker',
                        winwidth: 460,
                        winheight: 460,
                        tableid: 'tblProductPicker',
                        tablecolumns: tblColums,
                        datalist: response.objs,
                        multiplereturn: false,
                        searchingbyfieldName:'ProductName',
                        windowTittle: 'Product List'
                    };
                    $.icsPicker(oPickerParam);
                    IntializeProductPickerbutton(oPickerParam,bIsDyes);//multiplereturn, winclassName
                }
                else { alert(response.objs[0].ErrorMessage); }
            }
            else{
                alert("No product found.");
            }
        });


    }

    function IntializeProductPickerbutton(oPickerobj, bIsDyes)
    {
        $("#" + oPickerobj.winid).find("#btnOk").click(function () {
            ProductSelect(oPickerobj, bIsDyes);
        });
        $(document).find('.' +oPickerobj.winclass).keydown(function (e) {
            if (e.which == 13)//enter=13
            {
                ProductSelect(oPickerobj, bIsDyes);
            }
        });
    }

    function ProductSelect(oPickerobj, bIsDyes){
        var oProduct = $('#'+oPickerobj.tableid).datagrid('getSelected');
        if (oPickerobj.winid == 'winProductPicker')
        {
            if(oProduct !=null  && oProduct.ProductID>0){
                $("#"+oPickerobj.winid).icsWindow("close");
                $("#" + oPickerobj.winid).remove();
                debugger;
                if(bIsDyes){
                    $('#txtProductDyes').val(oProduct.ProductNameCode);
                    _nProductIDDyes= oProduct.ProductID;
                    $('#txtQtyDyes').focus();
                }
                else{
                    $('#txtProductChemical').val(oProduct.ProductNameCode);
                    _nProductIDChemicals= oProduct.ProductID;
                    $('#txtQtyChemical').focus();
                }

            }
            else{
                alert("Please select product.");
            }
        }
        else if (oPickerobj.winid == 'winLDColorPicker')
        {
            if(oProduct !=null  && oProduct.LabdipColorID>0){
                $("#"+oPickerobj.winid).icsWindow("close");
                $("#" + oPickerobj.winid).remove();
                $('#txtLDCode').val(oProduct.Code+""+oProduct.CodeNo);
                _nLabdipColorID= oProduct.LabdipColorID;
                $('#txtColorName').focus().select();
                SaveColorNo();
            }
            else{
                alert("Please select product.");
            }
        }

        
        else if (oPickerobj.winid == 'winPOPicker')
        {
            if (oProduct != null && oProduct.ContractorID > 0)
            {
                $("#"+oPickerobj.winid).icsWindow("close");
                $("#" + oPickerobj.winid).remove();
                var oFabricSalesContract = oProduct;
                $('#txtPO').val(oFabricSalesContract.SCNo);
                $("#txtPO").addClass("fontColorOfPickItem");
                $('#txtIssueTo').val(oProduct.ContractorName);
                $('#txtDeliverTo').val(oProduct.BuyerName);
                $('#txtFabricNo').focus();
                _nDeliveryToID= oProduct.BuyerID;
                _nContractorID= oProduct.ContractorID;
                _nFSCID = oFabricSalesContract.FabricSalesContractID;
            }
            else {
                alert("Please select an item from.");
                return false;
            }
        }
        
        else if (oPickerobj.winid == 'winFabricPicker')
        {
            if (oProduct!= null && oProduct.FabricSalesContractDetailID> 0)
            {
                var oLabDipDetails= $('#tblLabDipDetail').datagrid('getSelected');
               
                sLabDipDetailIDs=oLabDipDetails.LabDipDetailID;

                var obj={
                    LDFID:0,
                    LabDipID: oLabDipDetails.LabDipID,
                    LabDipDetailID:oLabDipDetails.LabDipDetailID,
                    FabricID: oProduct.FabricID,
                    FabricNo: oProduct.FabricNo,
                    FSCDetailID: oProduct.FabricSalesContractDetailID,
                    Construction:oProduct.Construction,
                    ProductName:oProduct.ProductName,
                    Construction:oProduct.Construction,
                    BuyerReference: oProduct.BuyerReference,
                    SCNoFull:oProduct.SCNoFull,
                    IsForAll: $("#chkForAll").is(':checked'),
                    Remarks:'',
                    Params: sLabDipDetailIDs
                };
                
                if(!IsExistFabric(obj))
                {
                    Save_FabricDetail(obj);
                    $('#tblLabDipDetailFabric').datagrid('appendRow',obj);  
                   
                    $('#txtFabricNo').val('');
                    $('#txtExeNo').val('');
                    $('#txtFabricNo').focus();
                }
                //_nFSCDetailID = oProduct.FabricSalesContractDetailID;
                //$('#txtConstruction').val(oProduct.Construction);
                //$('#txtComposition').val(oProduct.ProductName);
                //debugger;
                ////$('#txtFabricNo').focus();

                /*
               
                */
                $("#" + oPickerobj.winid).icsWindow("close");
                $("#" + oPickerobj.winid).remove();
            }
        }

    }
     
    function IsExistFabric(oLabDipDetail)
    {
        var oLDpDetail = $('#tblLabDipDetailFabric').datagrid('getRows');
        for (var i = 0; i < oLDpDetail.length; i++) {
            if (parseInt(oLDpDetail[i].FSCDetailID) ==parseInt(oLabDipDetail.FSCDetailID))
            {
                return true;
            }
        }
        return false;
    }

     ///////
    $('#btnPrint').click(function (e)
    {
        var oLabDip = $('#tblLabDipDetail').datagrid('getSelected');
        if (oLabDip ==null || oLabDip.LabDipID <=0 ) { alert("Please select an item from list."); return ; }
        var tsv=((new Date()).getTime())/1000;
        window.open(_sBaseAddress+ "/LabDip/PrintLabDip?nId="+oLabDip.LabDipID+"&nts="+tsv, "_blank");
    });
    $('#btnPrintRecipe').click(function (e)
    {
        _oLabDipDetail = $("#tblLabDipDetail").datagrid("getSelected");
        if (_oLabDipDetail == null || _oLabDipDetail.LabDipDetailID <= 0) { alert("Please select an item from list."); return false; }
        var tsv=((new Date()).getTime())/1000;

        window.open(_sBaseAddress+ "/LabDip/PrintLabDipRecipe?nId="+ _oLabDipDetail.LabDipID+"&nDetailID="+_oLabDipDetail.LabDipDetailID+"&nts="+tsv, "_blank");
    });


     /// Update Color No
    $("#txtColorNew").keypress(function (e) {
        if (e.which ==13) {
            SaveColorNo();
        }
    });
    $("#btnColorNo").click(function () {
        var oLabDipDetail = $('#tblLabDipDetail').datagrid('getSelected');
        var nSelectedIndex= $('#tblLabDipDetail').datagrid('getRowIndex',oLabDipDetail);
        if (oLabDipDetail ==null || oLabDipDetail.LabDipDetailID<=0) { alert("Please select an item from list."); return ; }
        $('#txtLDCode').val("");
        $('#txtColorName_LD').val(oLabDipDetail.ColorName);
        _nLabdipColorID=oLabDipDetail.LabdipColorID;
        $('#txtColorNoLD').val(oLabDipDetail.ColorNo);
        $('#txtLDCode').val(oLabDipDetail.ColorCode);
        $('#txtColorName_LD').prop('disabled',true);
        $('#txtColorNoLD').prop('disabled',true);
        $('#txtLDCode').prop('disabled',false);
        $('#txtColorNew').prop('disabled',false);
        $('#txtColorNew').val('');
        $("#winColorNoEntry").icsWindow('open', "Update Color Entry");
    });
    $("#btnSaveColorNo").click(function (e) {
        SaveColorNo();
    });
    function SaveColorNo()
    {
        var oLabDipDetail=$('#tblLabDipDetail').datagrid('getSelected');
        var nSelectedIndex= $('#tblLabDipDetail').datagrid('getRowIndex',oLabDipDetail);
        if(oLabDipDetail==null || oLabDipDetail.LabDipDetailID<=0)
        {
            alert("Please select a item from list!");
            return;
        }
        if(_nLabdipColorID==null || _nLabdipColorID<=0)
        {
            alert("Please Pick color code!");
            return;
        }
        var nSelectedIndex= $('#tblLabDipDetail').datagrid('getRowIndex',oLabDipDetail);
        oLabDipDetail.ColorNo= $('#txtColorNew').val();
        oLabDipDetail.LabdipColorID=_nLabdipColorID;

        var obj =
            {
                BaseAddress: _sBaseAddress,
                Object: oLabDipDetail,
                ObjectId: oLabDipDetail.LabDipDetailID,
                ControllerName: "LabDip",
                ActionName: "Save_ColorNo",
                TableId: "tblLabDipDetail",
                IsWinClose: true
            };
        $.icsSave(obj, function (response) {
            if (response.status) {
                //OperationPerformsExportLC(nRowIndex, response.obj);
            }
        });
    }
    $("#btnCloseColorNo").click(function () {
        $("#winColorNoEntry").icsWindow("close");
    }); 

    ///
    ///Color Code
    $("#txtColorNew").keypress(function (e) {
        if (e.which != 8 && e.which != 0  && e.which != 46  && (e.which < 48 || e.which > 57)) {
            return false;
        }
    });
    $("#btnPickLDCode").click(function () {

        var sLDCode=$.trim($("#txtLDCode").val());
        if(sLDCode==""){ alert("Type Code to search."); return false; }
        GetLDColorCodes(sLDCode);
    });
    $("#txtLDCode").keydown(function (e) {
        var nkeyCode = e.keyCode || e.which;
        if(nkeyCode==13){
            var sLDCode=$.trim($("#txtLDCode").val());
            if(sLDCode==""){ alert("Type Code to search."); return false; }
            GetLDColorCodes(sLDCode);
        }
        else if(nkeyCode==8){
            $("#txtLDCode").val("");
            _nLabdipColorID=0;
        }
    });
    function GetLDColorCodes(sLDCode){
        var oLabdipColor = { Code:sLDCode};

        var obj = {
            BaseAddress: _sBaseAddress,
            Object: oLabdipColor,
            ControllerName: "LabDip",
            ActionName: "GetLabDipLolors",
            IsWinClose: false
        };

        $.icsDataGets(obj, function (response) {
            debugger;
            if (response.status && response.objs.length > 0) {
                if (response.objs[0].LabdipColorID > 0) {
                    debugger;
                    var tblColums = [];
                    var oColumn = { field: "Code", title: "Code", width: 80, align: "left" };tblColums.push(oColumn);
                    oColumn = { field: "CodeNo", title: "Name", width: 50, align: "left" };tblColums.push(oColumn);
                    oColumn = { field: "Name", title: "Unit", width: 100, align: "left" };tblColums.push(oColumn);

                    var oPickerParam = {
                        winid: 'winLDColorPicker',
                        winclass:'clsLDColorPicker',
                        winwidth: 520,
                        winheight: 460,
                        tableid: 'tblLDColorPicker',
                        tablecolumns: tblColums,
                        datalist: response.objs,
                        multiplereturn: false,
                        searchingbyfieldName:'Code',
                        windowTittle: 'Code List'
                    };
                    $.icsPicker(oPickerParam);
                    IntializeProductPickerbutton(oPickerParam);//multiplereturn, winclassName
                }
                else { alert(response.objs[0].ErrorMessage); }
            }
            else{
                alert("No Code found.");
            }
        });

    }

    //End Update Color No

    //START PANTON NO EDIT
     
    $("#txtPantonNo").keypress(function (e) {
        if (e.which ==13) {
            $("#txtPantonPageNo").focus();
        }
    });
    $("#txtPantonPageNo").keypress(function (e) {
        if (e.which ==13) {
            SavePantonNo();
        }
    });
    $("#btnPantonNo").click(function () {
        var oLabDipDetail = $('#tblLabDipDetail').datagrid('getSelected');
        var nSelectedIndex= $('#tblLabDipDetail').datagrid('getRowIndex',oLabDipDetail);
        if (oLabDipDetail ==null || oLabDipDetail.LabDipDetailID<=0) { alert("Please select an item from list."); return ; }
       
        $('#txtColorName_PT').val(oLabDipDetail.ColorName);
        $('#txtColorNo_PT').val(oLabDipDetail.ColorNo);
        //$('#txtLDCode').val(oLabDipDetail.ColorCode);
        $('#txtColorName_PT').prop('disabled',true);
        $('#txtColorNo_PT').prop('disabled',true);
       // $('#txtLDCode').prop('disabled',false);
        $('#txtPantonNo').prop('disabled',false);
        $('#txtPantonPageNo').prop('disabled',false);
        $('#txtPantonNo').val(oLabDipDetail.PantonNo);
        $('#txtPantonPageNo').val(oLabDipDetail.PantonPageNo);
        $("#winPantonEntry").icsWindow('open', "Update Panton No");

    });
    $("#btnSavePantonNo").click(function (e) {
        SavePantonNo();
    });
    function SavePantonNo()
    {
        var oLabDipDetail=$('#tblLabDipDetail').datagrid('getSelected');
        var nSelectedIndex= $('#tblLabDipDetail').datagrid('getRowIndex',oLabDipDetail);
        if(oLabDipDetail==null || oLabDipDetail.LabDipDetailID<=0)
        {
            alert("Please select a item from list!");
            return;
        }
        if($('#txtPantonNo').val()==null || $('#txtPantonNo').val()=='')
        {
            alert("Please type panton no & try again!!");
            return;
        }
        var nSelectedIndex= $('#tblLabDipDetail').datagrid('getRowIndex',oLabDipDetail);
        oLabDipDetail.PantonNo= $('#txtPantonNo').val();
        oLabDipDetail.PantonPageNo= $('#txtPantonPageNo').val();

        var obj =
            {
                BaseAddress: _sBaseAddress,
                Object: oLabDipDetail,
                ObjectId: oLabDipDetail.LabDipDetailID,
                ControllerName: "LabDip",
                ActionName: "Save_PantonNo",
                TableId: "tblLabDipDetail",
                IsWinClose: true
            };
        $.icsSave(obj, function (response) {
            if (response.status) {
                //OperationPerformsExportLC(nRowIndex, response.obj);
            }
        });
    }
    $("#btnClosePantonNo").click(function () {
        $("#winPantonEntry").icsWindow("close");
    }); 
     //END PANTON 


    $("#btnReceived").click(function (e) {

        if (!confirm("Confirm to Receive?")) return false;
        //alert("");
        var oLabDipDetail=$('#tblLabDipDetail').datagrid('getSelected');
        var nSelectedIndex= $('#tblLabDipDetail').datagrid('getRowIndex',oLabDipDetail);
        if(oLabDipDetail==null || oLabDipDetail.LabDipDetailID<=0)
        {
            alert("Please select a item from list!");
            return;
        }
        //if(oLabDipDetail.ReceiveBY!=0)
        //{
        //    alert("Already Received!");
        //    return;
        //}
        //if(oLabDipDetail.SubmitBy!=0)
        //{
        //    alert("Already Submited!");
        //    return;
        //}
        var nSelectedIndex= $('#tblLabDipDetail').datagrid('getRowIndex',oLabDipDetail);
        //oLabDipDetail.LDNo= $('#txtColorNew').val();
        //oLabDipDetail.ReceiveBY=1; // Up
        var obj =
          {
              BaseAddress: _sBaseAddress,
              Object: oLabDipDetail,
              ObjectId: oLabDipDetail.LabDipDetailID,
              ControllerName: "LabDip",
              ActionName: "Save_Receive",
              TableId: "tblLabDipDetail",
              IsWinClose: true
          };
        $.icsSave(obj, function (response) {
            if (response.status) {
                RowSelect(nSelectedIndex, response.obj);
            }
        });
    });
    $("#btnLabdipDone").click(function (e) {

        if (!confirm("Confirm to Receive?")) return false;
        //alert("");
        var oLabDipDetail=$('#tblLabDipDetail').datagrid('getSelected');
        var nSelectedIndex= $('#tblLabDipDetail').datagrid('getRowIndex',oLabDipDetail);
        if(oLabDipDetail==null || oLabDipDetail.LabDipDetailID<=0)
        {
            alert("Please select a item from list!");
            return;
        }
        if(oLabDipDetail.ColorCreateBy==0)
        {
            alert("This Labdip yet not Receive In Lab!");
            return;
        }
        if(oLabDipDetail.SubmitBy!=0)
        {
            alert("Already Labdip Done!");
            return;
        }
        var nSelectedIndex= $('#tblLabDipDetail').datagrid('getRowIndex',oLabDipDetail);

        var obj =
          {
              BaseAddress: _sBaseAddress,
              Object: oLabDipDetail,
              ObjectId: oLabDipDetail.LabDipDetailID,
              ControllerName: "LabDip",
              ActionName: "Save_LabDipDone",
              TableId: "tblLabDipDetail",
              IsWinClose: true
          };
        $.icsSave(obj, function (response) {
            if (response.status) {
                RowSelect(nSelectedIndex, response.obj);
            }
        });
    });

    $("#btnSubmit").click(function (e) {

        if (!confirm("Confirm to Receive?")) return false;
        //alert("");
        var oLabDipDetail=$('#tblLabDipDetail').datagrid('getSelected');
        var nSelectedIndex= $('#tblLabDipDetail').datagrid('getRowIndex',oLabDipDetail);
        if(oLabDipDetail==null || oLabDipDetail.LabDipDetailID<=0)
        {
            alert("Please select a item from list!");
            return;
        }
        if(oLabDipDetail.ColorCreateBy==0)
        {
            alert("This Labdip yet not Receive In Lab!");
            return;
        }
        if(oLabDipDetail.SubmitBy==0)
        {
            alert("Labdip yet not  Done!");
            return;
        }
        var nSelectedIndex= $('#tblLabDipDetail').datagrid('getRowIndex',oLabDipDetail);

        var obj =
          {
              BaseAddress: _sBaseAddress,
              Object: oLabDipDetail,
              ObjectId: oLabDipDetail.LabDipDetailID,
              ControllerName: "LabDip",
              ActionName: "Save_Submit",
              TableId: "tblLabDipDetail",
              IsWinClose: true
          };
        $.icsSave(obj, function (response) {
            if (response.status) {
                RowSelect(nSelectedIndex, response.obj);

                var oLDetails=$('#tblLabDipDetail').datagrid('getRows');
                if(oLDetails.length>0)
                {
                    for(var i=0;i<oLDetails.length;i++)
                    {
                        if(response.obj.LabDipDetailID!=oLDetails[i].LabDipDetailID && oresponse.obj.LabDipID!=oLDetails[i].LabDipID)
                        {
                            SelectedRowIndex = $('#tblLabDipDetail').datagrid('getRowIndex', oLDetails[i]);
                            oLDetails[i].Status='Release From Lab'
                            $('#tblLabDipDetail').datagrid('updateRow', { index: SelectedRowIndex, row:  oLDetails[i]});
                        }
                    }
                }
            }
        });
    });
     
    $("#btnReviseDetail").click(function () {

        var oLabDipDetail = $("#tblLabDipDetail").datagrid("getSelected");
        if (oLabDipDetail == null || oLabDipDetail.LabDipDetailID <= 0) { alert("Please select an item from list!"); return false; }

        if (!confirm("Confirm to Revise?")) return false;
        var nIndex = $("#tblLabDipDetail").datagrid("getRowIndex", oLabDipDetail);
        var obj =
        {
            BaseAddress: _sBaseAddress,
            Object: oLabDipDetail,
            ControllerName: "LabDip",
            ActionName: "ReviseDetail",
            IsWinClose: false,
            Message:'Revised Successfully.'
        };
        $.icsSave(obj, function (response) {
            if (response.status && response.obj.LabDipDetailID>0) 
            {
                var oLabdipdetails=$('#tblLabDipDetail').datagrid('getRows');
                $('#tblLabDipDetail').datagrid('appendRow', response.obj);
                $('#tblLabDipDetail').datagrid('selectRow',oLabdipdetails.length-1);
            }
        });



    });
    

    $("#btnPrint_Excel").click(function ()
    {
        var Params= sessionStorage.getItem("ParamsSO");
        var tsv=((new Date()).getTime())/1000;
        window.open(_sBaseAddress+ "/LabDip/PrintLabDipsXLTwo?Params="+(Params==null?"":Params)+"&nts="+tsv, "_blank");
    });

    $('#btnPrint').click(function (e)
    {
        var oLabDipDetail = $('#tblLabDipDetail').datagrid('getSelected');
        if (oLabDipDetail ==null || oLabDipDetail.LabDipID <=0 ) { alert("Please select an item from list."); return ; }
        var tsv=((new Date()).getTime())/1000;
        window.open(_sBaseAddress+ "/LabDip/PrintLabDipWU?nId="+oLabDipDetail.LabDipID+"&nView=2&nts="+tsv, "_blank");
    });


    $("#txtQtyDyes").keyup(function (e)
    {
        var oLabdipShade = $("#tblLabdipShade").datagrid("getSelected");
        if (oLabdipShade != null && oLabdipShade.LabdipShadeID > 0)
        {
            $('#txtPerDyes').val( parseFloat(icsRemoveComma($('#txtQtyDyes').val()))*100/oLabdipShade.Qty);
        }
    });
    $("#txtPerDyes").keyup(function (e){

        var oLabdipShade = $("#tblLabdipShade").datagrid("getSelected");
        if (oLabdipShade != null && oLabdipShade.LabdipShadeID > 0)
        {
            $('#txtQtyDyes').val( parseFloat((icsRemoveComma($('#txtPerDyes').val()))*oLabdipShade.Qty)/100);
        }
    });


    $('#btnViewPO').click(function(e){
        var oLabDipDetails= $('#tblLabDipDetail').datagrid('getSelected');

        if(oLabDipDetails==null || oLabDipDetails.LabDipDetailID<=0)
        {
            alert("Please select an item and Try Again."); return false;
        }

        DynamicRefreshList([],'tblLabDipDetailFabric');

        var Obj={Params:oLabDipDetails.LabDipDetailID};
        GetLDDetailFabric(Obj);

        $("#winPO").icsWindow('open', "View PO");
    });

    function GetLDDetailFabric(oLabDipDetail)
    {
        $.ajax({
            type: "POST",
            dataType: "json",
            url : _sBaseAddress+  "/LabDip/GetLDDetailFabric",
            traditional: true,
            data:  JSON.stringify(oLabDipDetail),
            contentType: "application/json; charset=utf-8",
            success: function (data) {
                //debugger;
                var oresult = jQuery.parseJSON(data);
                if(oresult.length>0)
                {
                    DynamicRefreshList(oresult,'tblLabDipDetailFabric');
                }
            },
            error: function (xhr, status, error) {
                alert(error);
            }

        });
    }

    $("#btnClosePO").click(function () {
        $("#winPO").icsWindow("close");
    });

 </script>


