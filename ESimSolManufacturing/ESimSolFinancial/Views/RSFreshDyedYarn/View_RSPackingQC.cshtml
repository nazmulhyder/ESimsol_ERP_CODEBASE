@model IEnumerable<ESimSol.BusinessObjects.RSFreshDyedYarn>
    @{
        ViewBag.Title = "Daily Fresh Dyed Yarn Receive Report(For Production)";
    }
   
<div id="progressbarParent" style="width:100%;height:100%;margin:0 auto;text-align:center; margin-left: auto;margin-right: auto;left: 0;right: 0;z-index: 1;">
    <div style="margin: 0px auto;margin-top: 251px;text-align:center;width:390px;">
        <label style="font-size:18px;">Please wait</label>
        <div id="progressbar" style="width:100%;height:37px;"></div>
    </div>
</div>
<div class="menuMainCollectionTable">
    <div id="tabRSApproves"  style="width:100%; height:98%">
        <div style="width:100%;height:100%">
            <table id="tblRSWise" style="width:100%; height:100%" class="easyui-datagrid" fit="true" fitcolumns="false" rownumbers="true" pagination="false" singleselect="true" autorowheight="false" showfooter="true" toolbar="#toolbarRSWise" data-options="rowStyler: function(index,row){
                                                                        if (row.ProductName=='Total'){
                                                                        return 'color:#016B18; font-weight:bold;'; } }">
                <thead>
                  
                            <tr>

                                <th field="RouteSheetNo" width="10%">Batch No.</th>
                                <th field="OrderNo" width="12%">Order No</th>
                                <th field="ContractorName" width="20%">Buyer Name</th>
                                <th field="ProductName" width="20%">Yarn</th>
                                <th field="ColorName" width="10%">Color</th>
                                <th field="Qty_RS" width="8%" align="right" formatter="formatPrice">Dyeing Qty</th>
                                <th field="FreshDyedYarnQty" width="8%" align="right" formatter="formatPrice">Total Packing Qty</th>
                                <th field="PackingQty" width="8%" align="right" formatter="formatPrice">Packing Qty</th>
                                <th field="WIPQty" width="8%" align="right" formatter="formatPrice">WIP Qty</th>
                                <th field="BagCount" width="8%">B/Q</th>
                                <th field="RecycleQty" width="8%" align="right" formatter="formatPrice">Recycle Qty</th>
                                <th field="WastageQty" width="8%" align="right" formatter="formatPrice">Wastage Qty</th>
                                <th field="ManagedQty" width="8%" align="right" formatter="formatPrice">ManagedQty</th>
                                @*<th field="UnManagedQty" width="8%" align="right" formatter="formatPrice">UnManagedQty</th>*@
                                <th field="Loss" width="8%" align="right" formatter="formatPrice">Actual Short Qty</th>
                                <th field="TotalShort" width="8%" align="right" formatter="formatPrice">Total Short Qty</th>

                                <th field="Gain" width="6%" align="right" formatter="formatPrice">Gain Qty</th>
                                <th field="LossPer" width="6%" align="right" formatter="formatPrice">Loss%</th>
                                <th field="DCAddCount" width="8%" align="right" formatter="formatPrice">Add DC</th>
                                <th field="DyeingType" width="12%">Dyeing Type</th>
                                <th field="IsReDyeingSt" width="12%">IsRedyeing</th>
                                <th field="RequestByName" width="12%">QC By</th>
                                <th field="WUName" width="12%">Store Name</th>
                                <th field="RSStateStr" width="12%">Status</th>
                                <th field="RSShiftName" width="10%">Shift</th>
                                <th field="RSPartQC" width="10%">QCStatus</th>

                            </tr>
                        </thead>
                    </table>
                    <div id="toolbarRSWise">
                        <input type="text" id="txtRouteSheetNo" placeholder="Search by Batch No" style="width:10%;" />
                        <input type="text" id="txtOrderNo" placeholder="Search by Order" style="width:10%;" />
                        <a id="btnAdvSearch" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-search" plain="true">Adv Search</a>
                        <a href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-ok" plain="true" id="btnQC">Packing Done</a>
                        @*<a id="btnAdd_Requeste" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-redo" plain="true">QC Update</a>*@
                        @*<a id="btnSendToSubStore" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-ok" plain="true">Send to Hard winding</a>*@
                        @*<a href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-ok" plain="true" id="btnPacking">Print (Packing)</a>*@
                        @*<a id="btnDelete_Cancel" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-undo" plain="true">Undo Cancel Req.</a>
                        <a id="btnApprove_Cancel" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-ok" plain="true">Cancel</a>*@
                        <a id="btnExcel_RSQC" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-excel" plain="true">Export Excel</a>
                        <a id="btnByForceQC" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-ok" plain="true">By Force QC</a>
                        @*<a href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-reload" plain="true" id="btnSearch_RS">Refresh</a>*@
                        @*<a id="btnView" href="javascript:void(0)" class="easyui-linkbutton initial-state" iconcls="icon-details" plain="true">View</a>*@
                        @*<a id="btnPrintXL" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-excel" plain="true">ExportXL</a>*@
                    </div>
        </div>
    </div>
</div>
                      
<div id="winAdvSearch" class="easyui-window winClass" style="width:620px" title="Adv. Search" data-options="modal:true,closed:true,collapsible:false,minimizable:false,maximizable:false,closable:false">
    <div>
        <fieldset style="margin-bottom: 0px;">
            <legend>Searching Criteria</legend>
            <table style="width:100%;text-align:right;">
                <tr>
                    <td style=" width:20%;text-align:right;">
                        <label> Batch Date:</label>
                    </td>
                    <td colspan="3" style=" width:80%;text-align:left;">
                        <select id="cboRSDateAdvS" style="width:15%;" onchange="DateActions();"></select>
                        <input id="dtRouteSheetDateFromAdv" type="text" style="width: 100px;" class="easyui-datebox" required="required" data-options="formatter:icsdateformat,parser:icsdateparser" />To
                        <input id="dtRouteSheetDateToAdv" type="text" style="width: 100px;" class="easyui-datebox" required="required" data-options="formatter:icsdateformat,parser:icsdateparser" />
                    </td>
                </tr>
                <tr>
                    <td style=" width:20%;text-align:right;">
                        <label>Machine:</label>
                    </td>
                    <td colspan="3" style=" width:80%;text-align:left;">
                        <input id="txtMachine" style="width:70%;" placeholder="Search Machine" />
                        <a id="btnPickMachine" href="javascript:void(0)" class="easyui-linkbutton ics-pick" iconcls="icon-pick" plain="true"></a>
                        <a id="btnResetMachine" href="javascript:void(0)" class="easyui-linkbutton ics-pick" iconcls="icon-clear" plain="true"></a>

                    </td>
                </tr>
                <tr>
                    <td style=" width:20%;text-align:right;">
                        <label>Customer:</label>
                    </td>
                    <td colspan="3" style=" width:80%;text-align:left;">
                        <input id="txtBuyer" style="width:70%;" placeholder=" search issue to" />
                        <a id="btnPickBuyer" href="javascript:void(0)" class="easyui-linkbutton ics-pick" iconcls="icon-pick" plain="true"></a>
                        <a id="btnResetBuyer" href="javascript:void(0)" class="easyui-linkbutton ics-pick" iconcls="icon-clear" plain="true"></a>

                    </td>
                </tr>
                <tr>
                    <td style=" width:20%;text-align:right;">
                        <label>Yarn:</label>
                    </td>
                    <td colspan="3" style=" width:80%;text-align:left;">
                        <input id="txtProductName" style="width:70%;" type="text" placeholder="Type & Press Enter" />
                        <a id="btnProductPiker" href="javascript:void(0)" class="easyui-linkbutton ics-pick" iconcls="icon-pick" plain="true"></a>
                        <a id="btnClrProductPiker" href="javascript:void(0)" class="easyui-linkbutton ics-pick" iconcls="icon-clear" plain="true"></a>
                    </td>
                </tr>
                <tr>
                    <td style=" width:20%;text-align:right;">
                        <label>Order Type:</label>
                    </td>
                    <td style=" width:30%;text-align:left;">
                        <select id="cboOrderType" class="cbo-styler"></select>
                    </td>
                    <td style=" width:20%;text-align:right;"></td>
                    <td style=" width:30%;text-align:left;"></td>
                </tr>
                <tr>
                    <td style=" width:20%;text-align:right;">
                        <label>Order No:</label>
                    </td>
                    <td colspan="3" style=" width:80%;text-align:left;">
                        <input id="txtOrderNoAdv" style="width:70%;" placeholder="Search Issue To" />
                        <a id="btnPickOrderNo" href="javascript:void(0)" class="easyui-linkbutton ics-pick" iconcls="icon-pick" plain="true"></a>
                        <a id="btnResetOrder" href="javascript:void(0)" class="easyui-linkbutton ics-pick" iconcls="icon-clear" plain="true"></a>

                    </td>
                </tr>
                <tr>
                    <td style=" width:20%;text-align:right;">
                        <label>PI No:</label>
                    </td>
                    <td colspan="3" style=" width:80%;text-align:left;">
                        <input id="txtPI" style="width:70%;" placeholder="Type PI No" />
                        <a id="btnPickPI" href="javascript:void(0)" class="easyui-linkbutton ics-pick" iconcls="icon-pick" plain="true"></a>
                        <a id="btnResetPI" href="javascript:void(0)" class="easyui-linkbutton ics-pick" iconcls="icon-clear" plain="true"></a>
                    </td>
                </tr>
                <tr>
                    <td style=" width:20%;text-align:right;">
                        <label>Status:</label>
                    </td>
                    <td colspan="3" style=" width:70%;text-align:left;">
                        <table id="tblRSStatus" class="easyui-datagrid" style="height:200px;" fitcolumn="true" rownumbers="true" pagination="false" multiselect="true" autorowheight="false">
                            <thead>
                                <tr>
                                    <th data-options="field:'Selected',checkbox:true"> </th>
                                    <th field="Value" width="80%">Status</th>
                                </tr>
                            </thead>

                        </table>
                    </td>
                </tr>
                <tr>
                    <td style=" width:20%;text-align:right;">
                        <label> Date by Status:</label>
                    </td>
                    <td colspan="3" style=" width:80%;text-align:left;">
                        <select id="cboRSDateAdvS_His" style="width:15%;" onchange="DateActionsRSDateAdvSearch_His();"></select>
                        <input id="dtRouteSheetDateFromAdv_His" type="text" style="width: 100px;" class="easyui-datebox" required="required" data-options="formatter:icsdateformat,parser:icsdateparser" />
                        <input id="tpRouteSheetDateFromAdv_His" class="easyui-timespinner" style="width:60px;" required="required" />
                        To
                        <input id="dtRouteSheetDateToAdv_His" type="text" style="width: 100px;" class="easyui-datebox" required="required" data-options="formatter:icsdateformat,parser:icsdateparser" />
                        <input id="tpRouteSheetDateToAdv_His" class="easyui-timespinner" style="width:60px;" required="required" />
                    </td>
                </tr>
                <tr>
                    <td style=" width:20%;text-align:right;">
                        <label> QC Date:</label>
                    </td>
                    <td colspan="3" style=" width:80%;text-align:left;">
                        <select id="cboQCdate" style="width:15%;" onchange="DateActionsQCdateAdvSearch();"></select>
                       
                        <input id="dtQCdateFromAdv" type="text" style="width: 100px;" class="easyui-datebox" required="required" data-options="formatter:icsdateformat,parser:icsdateparser" />
                        <input id="tpQCdateFromAdv" class="easyui-timespinner" style="width:60px;" required="required" />
                        To
                        <input id="dtQCdateToAdv" type="text" style="width: 100px;" class="easyui-datebox" required="required" data-options="formatter:icsdateformat,parser:icsdateparser" />
                        <input id="tpQCdateToAdv" class="easyui-timespinner" style="width:60px;" required="required" />
                    </td>
                </tr>
                <tr>
                    <td style=" width:20%;text-align:right;">
                        <label>Dye Type:</label>
                    </td>
                    <td  style=" width:30%;text-align:left;">
                        <select id="cboDUDyeingType" class="cbo-styler" style="width:100%"></select>
                    </td>
                    <td style=" width:20%;text-align:right;">
                        <label>Is Re-Dyeing ?</label>
                    </td>
                    <td style=" width:30%;text-align:left;" colspan="3">
                        <input id="chkIsReDyeing" type="checkbox" />
                    </td>
                </tr>
                <tr>
                    <td style=" width:20%;text-align:right;">
                        <label>QC State:</label>
                    </td>
                    <td  style=" width:30%;text-align:left;">
                        <select style="width: 80px;" id="cboRSSubState_Adv">
                            <option value="0">-Select One-</option>
                            <option value="1">In WIP</option>
                            <option value="2">In Part QC</option>
                           
                        </select>
                    </td>
                    <td style=" width:20%;text-align:right;">
                        <label> Shift :</label>
                    </td>
                    <td style=" width:30%;text-align:left;" colspan="3">
                        <select id="cboRSShift" class="cbo-styler" style="width:100%"></select>
                    </td>

                </tr>
                <tr>
                    <td height="1px" colspan="4"></td>
                </tr>
            </table>
        </fieldset>

        <fieldset>
            <legend>Actions : </legend>
            <table style="width:100%;text-align:right;">
                <tr>
                    <td style="width:20%;text-align:right;">
                        <a id="btnResetAdvSearch" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-reload" plain="true">Reset</a>
                    </td>
                    <td style="width:80%;text-align:right;">
                        <label class="lblLoadingMessage" style="float: left;">Loading Please Wait...</label>
                        <a id="btnSearchAdvSearch" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-search" plain="true">Search</a>
                        <a id="btnCloseAdvSearch" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-cancel" plain="true">Close</a>
                    </td>
                </tr>
            </table>

        </fieldset>
    </div>
</div>

<div id="winPacking" class="easyui-window winstyle" title="Add  ff Packing" style="width:900px; height:auto" data-options="modal:true,closed:true,collapsible:false,minimizable:false,maximizable:false,closable:false">
       <fieldset>
            <table class="tbl-Win">
                <tr class="region-cone">
                    <td style="text-align:right;width:12%">
                        <label>Shade Type:</label>
                    </td>
                    <td colspan="3" style="width:34%">
                        <select id="cboRSInQCSetups" class="reset-select" style="width:100%"></select>
                    </td>
                    <td colspan="5"></td>
                </tr>
                <tr>
                    <td style="text-align:right;width:12%">
                        <label id="lblBag">No of Bags:</label>
                    </td>
                    <td style="width:11%">
                        <input type="text" id="txtNumberBags" style="width:100%" class="reset-text txt-styler number" onkeyup="CalculateNetWeight()" />  @*CalculatePackingWeight(1)*@
                    </td>
                    <td style="text-align:right;width:12%">
                        <label>
                            Total Wt
                        </label><span class="lbsPerBag"></span>:
                       
                        @*<label>T. Weight(KG):</label>*@
                    </td>
                    <td style="width:11%">
                        <input id="txtTotalWeight" class="reset-text number txt-styler" style="width:100%" onkeyup="CalculatePackingWeight(3)" />
                    </td>
                    <td colspan="5"></td>
                </tr>
                <tr>
                    <td style="text-align:right;width:12%">
                        <label>
                           NW
                        </label><span class="lbsPerBag"></span>:
                      
                    </td>
                    <td style="width:11%">
                        <input id="txtQty" class="reset-text number txt-styler" style="width:100%" onkeyup="CalculatePackingWeight(2)" />
                    </td>
                    <td style="text-align:right;width:12%">
                        <label>
                            NW
                        </label><span class="lbsPerBagTwo"></span>:
                    </td>
                    <td style="width:11%">
                        <input id="txtQtyTwo" class="reset-text number txt-styler" style="width:100%" onkeyup="CalculatePackingWeight(1)" />
                    </td>
                    <td style="width:11%">
                        @*<label id="lblHeaderHankCone-Picker">No of Hanks:</label>*@
                        <label>Bobbin Count:</label>
                    </td>
                    <td style="width:11%">
                        @*<label id="lbsPerBag">Bag Weight:</label>*@
                        <label>Cone(G):</label>
                    </td>
                    <td style="width:11%">
                        <label>LDPE(G):</label>
                    </td>
                    <td style="width:11%"><label>HDPE(G):</label></td>
                    <td style="width:11%"><label>CTN(G):</label></td>
                </tr>

                <tr>
                    <td style="text-align:right;width:12%">
                        <label>
                            GW
                        </label><span class="lbsPerBag"></span>:
                    </td>
                    <td style="width:11%">
                        <input id="txtQtyGW" style="width:100%" class="reset-text number txt-styler"  />  @**onkeyup="CalculateNetWeight()"*@
                    </td>
                    <td style="text-align:right;width:12%">
                        <label>
                            GW
                        </label><span class="lbsPerBagTwo"></span>:
                    </td>
                    <td style="width:11%">
                        <input id="txtQtyGWLbs" style="width:100%" class="reset-text number txt-styler" onkeyup="CalculateNetWeight()" />
                    </td>
                    <td style="width:11%">
                        <input id="txtHanksCone" style="width:100%" class="reset-text number txt-styler" onkeyup="CalculateNetWeight()" />
                    </td>
                    <td style="width:11%">
                        <input id="txtBagWeight" style="width:100%" class="reset-text number txt-styler" onkeyup="CalculateNetWeight()" />
                    </td>
                    <td style="width:11%">
                        <input id="txtLDPE" style="width:100%" class="reset-text number txt-styler" onkeyup="CalculateNetWeight()" />
                    </td>
                    <td style="width:11%">
                        <input id="txtHDPE" style="width:100%" class="reset-text number txt-styler" onkeyup="CalculateNetWeight()" />
                    </td>
                    <td style="width:11%">
                        <input id="txtCTN" style="width:100%" class="reset-text number txt-styler" onkeyup="CalculateNetWeight()" />
                    </td>
                </tr>

                <tr>
                    <td style="text-align:right;width:12%">
                        <label>Note:</label>
                    </td>
                    <td colspan="8" style="width:88%">
                        <input id="txtNote_Packing" class="reset-text txt-styler" style="width:100%" />
                    </td>
                </tr>
                
                @*<tr>
                    <td class="td-col-2 align-right">
                        <label>Bag Type:</label>
                    </td>
                    <td class="td-styler td-col-8">
                        <select id="cboBagType" style="width:100%" class="reset-select"></select>
                    </td>
                </tr>
                <tr class="region-cone">
                    <td class="td-col-2 align-right">
                        <label>Warp/Weft:</label>
                    </td>
                    <td class="td-styler td-col-8">
                        <select id="cboWarpWeft" class="reset-select" style="width:100%"></select>
                    </td>
                    <td class="td-styler td-col-1"></td>
                </tr>
                <tr class="region-cone">
                    <td class="td-col-2 align-right">
                        <label>Dia:</label>
                    </td>
                    <td class="td-styler td-col-10">
                        <input id="txtLength" class="reset-text txt-styler" style="width:100%" />
                    </td>
                </tr>*@
                        
            </table>
       </fieldset>
       <fieldset >
           <legend style="font-weight:bold;font-size:11px"> Action : </legend>
           <table style="width:100%" border="0" cellspacing="2" cellpadding="2">
               <tr>
                   <td style=" float:left;  width:40%;text-align:left"></td>
                   <td style="width:30%"></td>
                   <td style="width:30%;text-align:right">
                       <a id="btnSavePacking" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-save" plain="true">Save</a>
                       <a id="btnClosePacking" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-cancel" plain="true">Close</a>
                   </td>
               </tr>
           </table>
       </fieldset>
  </div>

<div id="winSendToHW" class=" easyui-window winclass" title="Send To Hard Winding" data-options="modal:true,closed:true,collapsible:false,minimizable:false,maximizable:false,closable:false">
    <fieldset>
        <legend>Dye Line Info</legend>
        <table cellpadding="2" class="tbl-Win routesheet-info">
            <tr>
                <td class="td-col-2 align-right">
                    <label id="lblRSNo_HW" class="header-text">Batch No :</label>
                </td>
                <td class="td-col-3 align-left">
                    <input id="txtRouteSheet_HW" class="reset-text txt-styler" placeholder="Search DL" disabled />
                </td>
                <td class="td-col-2 align-right">
                    <label class="header-text">Customer :</label>
                </td>
                <td class="td-col-5 align-left">
                    <label id="lblBuyerName_HW"></label>
                </td>
                <td class="td-col-2 align-right">
                    <label class="header-text"> Status :</label>
                </td>
                <td class="td-col-5 align-left">
                    <label id="lblRSState_HW"></label>
                </td>
            </tr>
            <tr>
                <td class="td-col-2 align-right">
                    <label class="header-text">Machine No :</label>
                </td>
                <td class="td-col-3 align-left">
                    <label id="lblMachineNo_HW"></label>
                </td>
                <td class="td-col-2 align-right">
                    <label class="header-text">Order No:</label>

                </td>
                <td class="td-col-5 align-left">
                    <label id="lblDyeingOrderNo_HW"></label>
                </td>

                <td class="td-col-2 align-right">
                    <label class="header-text">Product :</label>
                </td>
                <td class="td-col-5 align-left">
                    <label id="lblProduct_HW"></label>
                </td>
            </tr>
            <tr>
                <td class="td-col-2 align-right">
                    <label class="header-text">Color & Shade :</label>
                </td>
                <td class="td-col-4 align-left" colspan="3">
                    <label id="lblColorShade_HW"></label>
                </td>
                <td class="td-col-2 align-right">
                    <label id="lblHeaderHanksCone_HW" class="header-text">Hanks/Cone :</label>
                </td>
                <td class="td-col-5 align-left">
                    <label id="lblNoOfHanksCone_HW"></label>
                </td>
              
            </tr>
        </table>
    </fieldset>

    <table id="tblITransections" class="easyui-datagrid" style="width:100%;height:200px;" fitcolumns="true" rownumbers="false" pagination="false" singleselect="true" autorowheight="false" autorowwidth="false" toolbar="#toolbarITransections">
        <thead>
            <tr>
                
                <th field="DyeingOrderNo" width="12%">Order No</th>
                <th field="LotNo" width="12%">Batch No</th>
                @*<th data-options="field:'Qty',align:'right',editor:{type:'numberbox',options:{precision:2}}" width="15%">Qty</th>
                <th data-options="field:'Note',align:'left',editor:{type:'text'}" width="30%">Note</th>*@
                @*<th field="RSInQCDetailID" width="10%" align="center" formatter="formatInspection"></th>*@
               
                <th field="Qty" width="12%" formatter="formatPrice" align="right">Qty</th>
                <th field="Balance" width="10%" formatter="formatPrice" align="right">Curr.Balance</th>
                @*<th field="Note" width="15%" align="left">Note</th>*@
                <th field="ProductName" width="20%" align="left">Yarn Type</th>
                <th field="DBServerDateTimeST" width="18%" align="left">DateTime</th>
                <th field="EntryByName" width="10%">Name</th>
                
                
            </tr>
        </thead>
    </table>
    <div id="toolbarITransections">
        <table style="width:100%;">
            <tr>
                <td class="align-left">
                    <input id="txtDyeingOrderDetail" style="width:20%;" placeholder="Order No.." disabled/>
                    <a id="btnDyeingOrderDetail" href="javascript:void(0)" class="easyui-linkbutton ics-pick" iconcls="icon-pick" plain="true"> Pick</a>
                    Order Qty:
                    <input id="txtDyeingOrderDetailQty_Order" style="width:10%;" placeholder="Batch Qty.." disabled />
                    Batch Qty: 
                    <input id="txtDyeingOrderDetailQty_RS" style="width:10%;" placeholder="Batch Qty.." disabled />
                    Issue Qty: 
                    <input id="txtDyeingOrderDetailQty_Pro" style="width:10%;" placeholder="Issue Qty.." class="number"/>

                    <a id="btnDyeingOrderDetailAdd" href="javascript:void(0)" class="easyui-linkbutton ics-pick" iconcls="icon-add" plain="true"> Add</a>
                </td>
            </tr>
        </table>
    </div>
    <div style="width:100%;">
        <fieldset>
            <legend style="font-weight: bold">Action : </legend>
            <table border="0" cellspacing="2" cellpadding="2" style="font-size: 11px; font-weight: bold; width:100%">
                <tr>
                    <td style="width:85%; text-align:right"></td>
                    <td style="width: 15%; text-align:right">
                        <a id="btnClose_HW" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-cancel" plain="true">Close</a>
                    </td>
                </tr>
            </table>
        </fieldset>
    </div>
</div>
           
<div id="winQC" class=" easyui-window winclass" title="QC " data-options="modal:true,closed:true,collapsible:false,minimizable:false,maximizable:false,closable:false">
    <fieldset>
        <legend>Dye Line Info</legend>
        <table cellpadding="2" class="tbl-Win routesheet-info">
            <tr>
                <td class="td-col-2 align-right">
                    <label id="lblRSNo" class="header-text">Batch No :</label>
                </td>
                <td class="td-col-3 align-left">
                    <input id="txtRouteSheet" class="reset-text txt-styler" placeholder="Search DL" disabled/>
                </td>
                <td class="td-col-2 align-right">
                    <label class="header-text">Buyer :</label>
                </td>
                <td class="td-col-5 align-left">
                    <label id="lblBuyerName"></label>
                </td>
                <td class="td-col-2 align-right">
                    <label class="header-text"> Status :</label>
                </td>
                <td class="td-col-5 align-left">
                    <label id="lblRSState"></label>
                </td>
            </tr>
            <tr>
                <td class="td-col-2 align-right">
                    <label class="header-text">Machine No :</label>
                </td>
                <td class="td-col-3 align-left">
                    <label id="lblMachineNo"></label>
                </td>
                <td class="td-col-2 align-right">
                    <label class="header-text">Order No:</label>

                </td>
                <td class="td-col-5 align-left">
                    <label id="lblDyeingOrderNo"></label>
                </td>

                <td class="td-col-2 align-right">
                    <label class="header-text">Product :</label>
                </td>
                <td class="td-col-5 align-left">
                    <label id="lblProduct"></label>
                </td>
            </tr>
            <tr>
                <td class="td-col-2 align-right">
                    <label class="header-text">Color & Shade :</label>
                </td>
                <td class="td-col-3 align-left">
                    <label id="lblColorShade"></label>
                </td>
                <td class="td-col-2 align-right">
                    <label id="lblHeaderHanksCone" class="header-text">Hanks/Cone :</label>
                </td>
                <td class="td-col-5 align-left">
                    <label id="lblNoOfHanksCone"></label>
                </td>
                <td class="td-col-2 align-right">
                    <label class="header-text">Weight :</label>
                </td>
                <td class="td-col-5 align-left">
                    <label id="lblWeight"></label>
                </td>
            </tr>
            <tr>
                <td class="td-col-2 align-right">
                    <label class="header-text">Received Qty :</label>
                </td>
                <td class="td-col-3 align-left">
                    <label id="lblQty_Received"></label>
                </td>
                <td class="td-col-2 align-right">
                    @*<label id="lblHeaderHanksCone" class="header-text">Hanks/Cone :</label>*@
                </td>
                <td class="td-col-5 align-left"></td>
                <td class="td-col-2 align-right"></td>
                <td class="td-col-5 align-left"></td>

            </tr>
        </table>
    </fieldset>
    <div id="tabPackingQC" style="width:100%;" class="easyui-tabs">
        <div title="Packing" id="tabPacking" style="width:100%">
            <fieldset>
                <table id="tblRouteSheetPacking" class="easyui-datagrid" style="width:100%;height:220px;" fitcolumns="true" showfooter="true" rownumbers="true" pagination="false" singleselect="true" autorowheight="false" autorowwidth="false" toolbar="#toolbarPacking">
                    <thead>
                        <tr>
                            <th field="BagNo" width="10%">BagNo</th>
                            <th field="Weight" width="12%" formatter="formatPrice" align="right">Weight(<label id="lblMUOne"></label>)</th>
                            <th field="WeightTwo" width="12%" formatter="formatPrice" align="right">Weight(<label id="lblMUTwo"></label>)</th>
                            <th field="NoOfHankCone" width="10%" formatter="formatPrice" align="right">Hanks/Cone</th>
                            <th field="Note" width="15%" align="left">Note</th>
                            <th field="QCBYName" width="8%" align="left">QC By</th>
                            <th field="QCDateSt" width="8%" align="left">QCDate</th>
                            <th field="YarnTypeSt" width="8%" align="left">YarnType</th>
                            
                            <th field="WarpStr" width="8%" align="left">Warp/Weft</th>
                            <th field="Length" width="6%" align="left">Length</th>
                        </tr>
                       
                    </thead>
                </table>
                
            </fieldset>
            <div id="toolbarPacking">
                <table style="width:100%;">
                    <tr>
                        <td style="width:60%" class="align-left">
                            <a id="btnAddPacking" href="javascript:void(0)" class="easyui-linkbutton active-QC" iconcls="icon-add" plain="true">Add</a>
                            <a id="btnEditPacking" href="javascript:void(0)" class="easyui-linkbutton active-QC" iconcls="icon-edit" plain="true">Edit</a>
                            <a id="btnDeletePacking" href="javascript:void(0)" class="easyui-linkbutton active-QC" iconcls="icon-remove" plain="true">Delete</a>

                            <a id="btnPrintLabelDynamic" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-print" plain="true">Print(Dynamic Label)</a>
                            <a id="btnPrintCardDynamic" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-print" plain="true">Print(Dynamic Card)</a>
                            @*<a id="btnSave_Packing" href="javascript:void(0)" style="float:right" class="easyui-linkbutton" iconcls="icon-ok" plain="true">Save</a>*@
                        </td>
                        <td style="width:40%" class="align-right">
                            <label id="lblPackingRemarks"></label>
                        </td>
                    </tr>
                </table>
            </div>
        </div>
        <div title="QC" id="tabReportDetail" style="width:100%">
            <table id="tblRouteSheetQC" class="easyui-datagrid" style="width:100%;height:200px;" fitcolumns="true" rownumbers="false" pagination="false" singleselect="true" autorowheight="false" autorowwidth="false" toolbar="#toolbarQC" data-options="onClickRow: onClickRow">
                <thead>
                    <tr>
                        <th field="QCSetupName" width="20%">Type</th>
                        <th data-options="field:'Qty',align:'right',editor:{type:'numberbox',options:{precision:2}}" width="15%">Qty</th>
                        <th data-options="field:'Note',align:'left',editor:{type:'text'}" width="30%">Note</th>
                        <th field="RSInQCDetailID" width="10%" align="center" formatter="formatInspection"></th>
                    </tr>
                </thead>
            </table>
            <div id="toolbarQC">
                <table style="width:100%;">
                    <tr>
                        <td style="width:50%" class="align-left">
                            <a id="btnRefresh" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-reload" plain="true">Refresh</a>
                            <a id="btnDeleteQCItem" href="javascript:void(0)" class="easyui-linkbutton active-QC" iconcls="icon-remove" plain="true">Remove</a>
                            @*<a id="btnAddMoreFreshDyedYarn" href="javascript:void(0)" class="easyui-linkbutton active-QC" iconcls="icon-ok" plain="true">Add More</a>*@
                        </td>
                        <td style="width:50%" class="align-right">
                            <label id="lblQCRemarks"></label>
                        </td>
                    </tr>
                </table>
            </div>
            <div class="active-QC">
                <fieldset>
                    <legend> QC Pass </legend>
                    <div class="form-inline ">
                        @*<label>Shift:</label>*@
                       
                        <input type="text" id="txtRemark_QC" style="width:40%">
                        <a id="btnSave_QC" href="javascript:void(0)" class="easyui-linkbutton active-QC" iconcls="icon-ok" plain="true">Save</a>
                        <select style="width: 80px;" id="cboQCRSState">
                            <option value="13">Full QC</option>
                            <option value="14">Part QC</option>
                            <option value="13">ForManage</option>
                           
                        </select>
                        <label id="lblShortQty"></label>
                        <input type="number" id="txtShortQty" style="width:13%" class="number" />
                        <a id="btnQCDone" href="javascript:void(0)" class="easyui-linkbutton active-QC" iconcls="icon-ok" plain="true">QC Passed</a>
                    </div>
                </fieldset>
            </div>
        </div>
        @*<div title="Hardwinding/Sub Store" id="tabReportDetail" style="width:100%">
            <div title="Packing" style="padding:2px; width:100%;">
                <table id="tblITs" class="easyui-datagrid" style="width:100%;height:200px;" fitcolumns="true" rownumbers="true" pagination="false" singleselect="true" autorowheight="false" autorowwidth="false" toolbar="#toolbarQCTwo">
                    <thead>
                        <tr>
                            <th field="StoreName" width="20%">Store Name</th>
                            <th field="ProductName" width="20%" align="left">Yarn Type</th>
                            <th field="Qty" width="12%" formatter="formatPrice" align="right">Qty</th>
                            <th field="CurrentBalance" width="10%" formatter="formatPrice" align="right">Balance</th>
                            <th field="Note" width="15%" align="left">Note</th>
                        </tr>
                    </thead>
                </table>
                <div id="toolbarQCTwo">
                    <table style="width:100%;">
                        <tr>
                            @*<td style="width:20%" class="align-right">
                                <table border="0" cellpadding="0" cellspacing="0" style="width:100%;text-align:left">
                                    <tr>
                                        <td style="width:10%"><input type="checkbox" id="chkFully" onclick="if(this.checked){IsFull()}else{IsPartial()}" />Fully </td>
                                        <td style="width:15%;text-align:left"><input type="checkbox" id="chkPartial" onclick="if(this.checked){IsPartial()}else{IsFull()}" />Partial</td>
                                    </tr>
                                </table>
                            </td>
                            <td style="width:80%" class="align-left">
                                <input type="text" style="width:26%;" id="txtNote" placeholder="Note" />

                                <label id="lblDeliveryQty" style="margin-left:10px;">Qty:</label>
                                <input type="text" style="width:15%;" id="txtQty_Rec" class="number" placeholder="Qty" />
                                <a id="btnAddInSubFinishing" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-add" plain="true">Forward to HardWinding Store</a>
                                <a id="btnSendToTrReq" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-ok" plain="true">Forward to Delivery Store</a>
                            </td>
                        </tr>
                    </table>
                </div>
            </div>        
        </div>*@    
    </div>
    <div style="width:100%;">
        <fieldset>
            <legend style="font-weight: bold">Action : </legend>
            <table border="0" cellspacing="2" cellpadding="2" style="font-size: 11px; font-weight: bold; width:100%">
                <tr>
                    <td style="width:85%; text-align:right"></td>
                    <td style="width: 15%; text-align:right">
                        <a id="btnClose_QC" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-cancel" plain="true">Close</a>
                    </td>
                </tr>
            </table>
        </fieldset>
    </div>
</div>

<div id="winRouteSheetCancel" class="easyui-window winstyle" title="RouteSheet Cancel" style="width:700px; height:auto" data-options="modal:true,closed:true,collapsible:false,minimizable:false,maximizable:false,closable:false">
    <div style="width: 100%; font-family: Tahoma;">
        <div>
            <fieldset>
                <legend>Batch info</legend>
                <table class="tbl-Win" cellpadding="2">
                    <tr>
                        <td class="td-col-3 align-right">
                            <label id="lblRSNo2"></label>
                            
                        </td>
                        <td class="td-styler td-col-7">
                            <input id="txtRSNo_Cancel" class="reset-text txt-styler" placeholder="Search RouteSheet" disabled />
                        </td>
                        <td class="td-styler td-col-4 align-right">
                            <label>Status :</label>
                        </td>
                        <td class="td-styler td-col-6">
                            <label id="lblRSState_Cancel" class="reset-lbl"></label>
                        </td>
                    </tr>
                    <tr>
                        <td class="td-col-3 align-right">
                            <label>Order No :</label>
                        </td>
                        <td class="td-styler td-col-7">
                            <label id="lblPISample_Cancel" class="reset-lbl"></label>
                        </td>
                        <td class="td-col-4 align-right">
                            <label>Raw Lot No :</label>
                        </td>
                        <td class="td-styler td-col-6">
                            <label id="lblLot_Cancel"></label>
                        </td>
                    </tr>
                    <tr>
                        <td class="td-col-3 align-right">
                            <label>Yarn :</label>
                        </td>
                        <td class="td-styler td-col-7">
                            <label id="lblYarn_Cancel" style="width:100%" class="reset-lbl"></label>
                        </td>
                        <td class="td-col-4 align-right">
                            <label>Shift :</label>
                        </td>
                        <td class="td-styler td-col-6">
                            <label id="lblShift" class="reset-lbl"></label>
                        </td>
                    </tr>
                    <tr>
                        <td class="td-col-3 align-right">
                            <label>Color :</label>
                        </td>
                        <td class="td-styler td-col-7">
                            <label id="lblColor_Cancel" ></label>
                        </td>
                        <td class="td-col-4 align-right">
                            <label>Color Shade :</label>
                        </td>
                        <td class="td-styler td-col-6">
                            <label id="lblColorShade_Cancel" class="reset-lbl"></label>
                        </td>
                    </tr>
                    <tr>
                        <td class="td-col-3 align-right">
                            <label>Qty :</label>
                        </td>
                        <td class="td-styler td-col-7">
                            <label id="lblQty_Cancel" class="reset-lbl"></label>
                        </td>
                        <td class="td-col-4 align-right">
                            <label id="lblHanksCone_Cancel">No of Bales :</label>
                        </td>
                        <td class="td-styler td-col-6">
                            <label id="lblBalesCone_Cancel" class="reset-lbl"></label>
                        </td>
                    </tr>
                </table>
            </fieldset>
        </div>

        <div class="divRSSubState">
            <fieldset>
                <legend>Request Info</legend>
                <table style="width:100%" cellpadding="2">
                    <tr>
                        <td class="td-col-4 align-right">
                            <label>Request Type:</label>
                        </td>
                        <td class="td-styler td-col-6">
                            <select id="cboRSSubState" class="cbo-styler" onchange="chngRSState()" ></select> @*onchange="chngRSState()"*@
                        </td>
                        <td class="td-col-2 align-right">Remarks</td>
                        <td class="td-col-8 align-right">
                            <input id="txtRSSubNote" style="width:100%" />
                        </td>
                       
                    </tr>
                </table>
            </fieldset>
        </div>

        <div class="divRSCancel">
            <fieldset>
                <legend>Cancel Info</legend>
                <table class="tbl-Win" cellpadding="2">
                    <tr>
                        <td class="td-col-2 align-right"></td>
                        <td class="td-col-8 align-right">
                            <input type="checkbox" id="chkMainLot" />
                            <span> <label>Goto Main Lot</label> </span>
                            <input type="checkbox" id="chkNewLot" />
                            <span> <label>Create New Lot</label> </span>
                        </td>
                        <td class="td-col-4 align-right">
                            <label>Receive Store :</label>
                        </td>
                        <td class="td-styler td-col-6">
                            <select id="cboStore" class="cbo-styler reset-select"></select>
                        </td>
                    </tr>
                </table>

                <table style="width:100%" cellpadding="2">
                    @*style="width:15%"*@
                    <tr>
                        <td class="align-right">
                            <label>Note :</label>
                        </td>
                        <td>
                            <input id="txtRemarks" style="width:100%" />
                        </td>
                    </tr>
                    <tr class="region-approval">
                        <td class="align-right">
                            <label>Comment :</label>
                        </td>
                        <td style="width:85%">
                            <input id="txtApprovalRemarks" style="width:100%" />
                        </td>
                    </tr>
                </table>
            </fieldset>
        </div>

        <fieldset>
            <legend>Action</legend>
            <table style="width:100%" cellpadding="2">
                <tr>
                    <td class="align-left td-col-6">
                        <label id="lblRequestedBy" class="reset-lbl"></label>
                    </td>
                    <td class="align-left td-col-5">
                        <label id="lblApprovedBy" class="reset-lbl"></label>
                    </td>
                    <td class="align-right td-col-9">
                        <a id="btnDone_Cancel" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-ok" plain="true">Cancel</a>
                        @*<a id="btnFreeze" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-freeze" plain="true">Freeze</a>*@
                        <a id="btnSaveRouteSheetCancel" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-save" plain="true">Save</a>
                      
                        <a id="btnCloseRouteSheetCancel" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-cancel" plain="true">Close</a>
                    </td>
                </tr>
            </table>
        </fieldset>
    </div>
</div>

<div id="winCardPrint" class="easyui-window winstyle" title="Card Print" style="width:250px; height:auto" data-options="modal:true,closed:true,collapsible:false,minimizable:false,maximizable:false,closable:false">
        <table class="tbl-Win">
            <tr>
                <td class="td-col-2 align-right">
                    <label>Type :</label>
                </td>
                <td class="td-styler td-col-8">
                    <select id="cboCardType" style="width:100%;"></select>
                </td>
                @*<td class="td-col-1 align-right"></td>*@
            </tr>
            <tr>
                <td colspan="3" style="text-align:right; padding-top:10px; padding-bottom:10px;">
                    <a id="btnCardPrintOk" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-print" plain="true">Preview</a>
                    <a id="btnCardPrintClose" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-cancel" plain="true">Close</a>
                </td>
            </tr>
        </table>
    </div>

    <div id="winPrintDynamicLabel" class="easyui-window winstyle" title="" style="width:810px; height:600px" data-options="modal:true,closed:true,collapsible:false,minimizable:false,maximizable:false,closable:false">
        <div style="font-family:Tahoma"> 
            <table border="0" cellpadding="0" cellspacing="0">
                <tr style="height:100%">
                    <td style="width:790px">
                        <fieldset>
                            <table id="tblRouteSheetPacking2" class="easyui-datagrid" style="width:100%;height:480px;" fitcolumns="true" showfooter="true" rownumbers="true" pagination="false" singleselect="true" autorowheight="false" autorowwidth="false" selectoncheck="false" checkonselect="false" toolbar="#toolbarPacking2">
                                <thead>
                                    <tr>
                                        <th data-options="field:'Selected',checkbox:true"></th>
                                        <th field="BagNo" width="10%">BagNo</th>
                                        <th field="Weight" width="10%" formatter="formatPrice" align="right">Weight</th>
                                        <th field="WeightTwo" width="12%" formatter="formatPrice" align="right">Weight</th>
                                        <th field="NoOfHankCone" width="10%" formatter="formatPrice" align="right">Hanks/Cone</th>
                                        <th field="QCBYName" width="20%" align="left">QC By</th>
                                        <th field="QCDateSt" width="12%" align="left">QCDate</th>
                                        <th field="YarnTypeSt" width="15%" align="left">YarnType</th>

                                    </tr>

                                </thead>
                            </table>
                            <div id="toolbarPacking2">
                                Date : <select id="cboSearchDate"></select>
                                QC By : <select id="cboSearchQCBy"></select>
                                All : <input type="checkbox" id="chkSearchAll" />
                            </div>
                        </fieldset>
                        <fieldset>
                            <table style="float:right;">
                                <tr>
                                    <td>
                                        <label>Type :</label>
                                    </td>
                                    <td style="width:250px;">
                                        <select id="cboLabelType" style="width:100%;"></select>
                                    </td>
                                    <td>
                                        <a id="btnOkLabelPrintForSelected" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-print" plain="true">Preview</a>
                                        <a id="btnLabelPrintOk" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-print" plain="true">Preview All</a>
                                        <a id="btnCancelLabelPrint" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-cancel" plain="true">Close</a>
                                    </td>
                                </tr>
                            </table>
                        </fieldset>
                    </td>
                </tr>
            </table>
        </div>
    </div>

 <style type="text/css">
    .lines-no .datagrid-body td {
        border-right: 1px dotted transparent;
        border-bottom: 1px dotted transparent;
    }
 
</style>

 <script type="text/javascript">
    var _sBaseAddress="";
    var _oRSFreshDyedYarn=null;
    var _oRSFreshDyedYarns=[];
    var _oCompanys=[];
    var _oCompareOperators=[];
    var _nBUID = 0;
    var _oBU = null;
    var _oRSStatuss=[];
    var _sDODIDs="";
    var _sContractorIDs="";
    var _sMachineIDs="";
    var _sProductIds="";
    var _nReportType=0;
    var _oRouteSheet=null;
    _oRouteSheetCancel=null;
    _oRSSubState=null;
    var _oRouteSheetSetup=null;
    var _nMUnit="";
    var _sUserName="";
    var _bIsNewLot=false;
    var _bIsQCChange=false;
    var _IsQtyGWLbs=false;
    var _oAuthorizationRolesMapping=[];
    $(document).ready(function () {

        _sBaseAddress =@Html.Raw( new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(HttpContext.Current.Session[SessionInfo.BaseAddress]));
        _oRSFreshDyedYarns =@Html.Raw( new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(Model));
        _oCompareOperators = @Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(ViewBag.CompareOperators));
        _oRSStatuss=@Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(@ViewBag.RSStatuss));
        var oOrderTypes=@Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(@ViewBag.OrderTypes));
        oWorkingUnits =@Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(@ViewBag.WorkingUnits));
        oRSShifts =@Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(ViewBag.RSShifts));
        oRSSubStatuss =@Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(ViewBag.RSSubStatuss));
        _oRouteSheetSetup =@Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(ViewBag.RouteSheetSetup));
        _sUserName =@Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(ViewBag.UserName));
        var  oRSInQCSetups =@Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(ViewBag.RSInQCSetup));
        var oWarpWeftTypes =@Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(ViewBag.WarpWeftType));
        var oDUDyeingTypes =@Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(@ViewBag.DUDyeingTypes));
        var oRSBagType =@Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(ViewBag.RSBagType));
        _oAuthorizationRolesMapping = @Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(HttpContext.Current.Session[SessionInfo.AuthorizationRolesMapping]));
        oRSSubStatuss =@Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(ViewBag.RSSubStatuss));
        debugger;
        $('#lblRSNo,#lblRSNo2').html(_oRouteSheetSetup.RSShortName+":");
        //_oRouteSheetSetup.MUnit = "Lbs";
        //_oRouteSheetSetup.MUnitTwo = "Kg";
        _nMUnit=_oRouteSheetSetup.MUnit;
        _nMUnitTwo=_oRouteSheetSetup.MUnitTwo;
    
        $("#progressbar").progressbar({ value: 0 });
        $("#progressbarParent").hide();
        $(".lblLoadingMessage").hide();

        DynamicRefreshList(_oRSStatuss, 'tblRSStatus');
        $('#tblRSWise').data('FDPs',_oRSFreshDyedYarns)
        DynamicRefreshList(_oRSFreshDyedYarns,'tblRSWise');
        $.icsMakeFooterColumn('tblRSWise',['ColorName','Qty_RS','FreshDyedYarnQty','PackingQty','WIPQty','BagCount','RecycleQty','WastageQty','ManagedQty','TotalShort','Loss','Gain']);

        $("#cboOrderType").icsLoadCombo({
            List: oOrderTypes,
            OptionValue: "OrderType",
            DisplayText: "ShortName",
        });
        $("#cboRSDateAdvS,#cboRSDateAdvS_His,#cboQCdate").icsLoadCombo({
            List: _oCompareOperators,
            OptionValue: "id",
            DisplayText: "Value",
        });
        $("#cboRSSubState").icsLoadCombo({
            List: oRSSubStatuss,
            OptionValue: "id",
            DisplayText: "Value",
        });
        $("#cboWarpWeft").icsLoadCombo({
            List: oWarpWeftTypes,
            OptionValue: "id",
            DisplayText: "Value",
        });
        $("#cboBagType").icsLoadCombo({
            List: oRSBagType,
            OptionValue: "id",
            DisplayText: "Value",
        });
        $("#cboRSInQCSetups").icsLoadCombo({
            List: oRSInQCSetups,
            OptionValue: "YarnType",
            DisplayText: "Name",
        });
        $("#cboDUDyeingType").icsLoadCombo({
            List: oDUDyeingTypes,
            OptionValue: "DyeingType",
            DisplayText: "Name",
        });
        debugger;
        $('#txtShortQty').val(0);

        RefreshMUnit(_oRouteSheetSetup);
        RefreshControlLayout();
    });
    $(document).keydown(function (e) { if (e.keyCode == 27) { $('div').icsWindow('close'); } });


    function RefreshMUnit(oRouteSheetSetup)
    {
        if(oRouteSheetSetup==undefined)return;

        _nMUnit=oRouteSheetSetup.MUnit;
        _nMUnitTwo=oRouteSheetSetup.MUnitTwo;
        $('#lblMUOne').html(_nMUnit);
        $('#lblMUTwo').html(_nMUnitTwo);
        $(".lbsPerBag").html("("+_nMUnit+")");
        $(".lbsPerBagTwo").html("("+_nMUnitTwo+")");
       // alert(_nMUnit);

        $('#lblRSNo').html(oRouteSheetSetup.RSShortName+":");
        $("#txtRouteSheetNo").attr("placeholder", "Type "+oRouteSheetSetup.RSShortName);
        $('#tpQCdateToAdv,#tpQCdateFromAdv,#tpRouteSheetDateFromAdv_His,#tpRouteSheetDateToAdv_His').timespinner('setValue', oRouteSheetSetup.BatchTimeSt);

    }
    ////Start adv Searching
    function updateProgress() {
        var value =$('#progressbar').progressbar('getValue');
        if (value < 96){
            value += Math.floor(Math.random() * 10);
            $('#progressbar').progressbar('setValue', value);
        }
    }
    function hideShow(miliseconds) {
        $("#progressbarParent").hide();
    }
    function ResetAdvSearchWindow() {
        _sContractorIds = '';
        _sMachineIDs = "";
        _sProductIds = "";
        _sDODIDs = "";
        $("#txtPI").data("PIID","");
        $(".lblLoadingMessage").hide();
        $("#winAdvSearch input").not("input[type='button']").val("");
        $("#winAdvSearch input").removeClass("fontColorOfPickItem");
        $("#winAdvSearch select").val(0);
        DateActions();
        DateActionsQCdateAdvSearch();
        DateActionsRSDateAdvSearch_His();
        $("#dtRouteSheetDateFromAdv,#dtRouteSheetDateToAdv,#dtRouteSheetDateFromAdv_His,#dtRouteSheetDateToAdv_His").datebox({ disabled: true });
        $("#dtRouteSheetDateFromAdv,#dtRouteSheetDateToAdv,#dtRouteSheetDateFromAdv_His,#dtRouteSheetDateToAdv_His").datebox("setValue", icsdateformat(new Date()));
        $('#tpQCdateToAdv,#tpQCdateFromAdv,#tpRouteSheetDateFromAdv_His,#tpRouteSheetDateToAdv_His').timespinner('setValue', _oRouteSheetSetup.BatchTimeSt);

    }
    function DateActions() {
        DynamicDateActions("cboRSDateAdvS", "dtRouteSheetDateFromAdv", "dtRouteSheetDateToAdv");
    }
    function DateActionsRSDateAdvSearch_His() {
        DynamicDateActions("cboRSDateAdvS_His", "dtRouteSheetDateFromAdv_His", "dtRouteSheetDateToAdv_His");
    }
    function DateActionsQCdateAdvSearch() {
        DynamicDateActions("cboQCdate", "dtQCdateFromAdv", "dtQCdateToAdv");
        debugger;
        //var dtEventTime = icsdateformat(new Date())+" 00:00:00";
        //$('#dtQCdateFromAdv').datetimebox('setValue', dtEventTime);
        //$('#dtQCdateToAdv').datetimebox('setValue',dtEventTime);
    }

    $("#btnAdvSearch").click(function () {
        debugger;
        $(".lblLoadingMessage").hide();

        $("#winAdvSearch").icsWindow("open", "Advance Search");
        //DynamicRefreshList([], "tblExportPIAdvSearch");
        DynamicResetAdvSearchWindow("winAdvSearch");
        ResetAdvSearchWindow();
    });
    $("#txtRouteSheetNo").keyup(function (e) {
        var oRouteSheets =[];
        var keyCode = e.keyCode || e.which;
        $('#txtRouteSheetNo').removeClass("errorFieldBorder");
        //if (keyCode == 8) { oRouteSheets = _oRouteSheets; }
        //else{ oRouteSheets = $('#tblRouteSheet').datagrid('getRows'); }
        if (e.keyCode == 13) // Enter Press
        {
            if (!$.trim($("#txtRouteSheetNo").val()).length) {

                alert("Please enter Batch/Dyeing Card No no to search.");
                $('#txtRouteSheetNo').focus();
                $('#txtRouteSheetNo').val("");
                return;
            }

            var sRSNo =$.trim($("#txtRouteSheetNo").val());
            var sOrderNo = "";
            var sRSStatus="";
            _sMachineIDs="";
            _sContractorIDs="";
            _sProductIds="";
            _sDODIDs="";



            var sTempString =0+ '~'
                + $('#dtRouteSheetDateFromAdv').datebox('getValue')+'~'
                + $('#dtRouteSheetDateToAdv').datebox('getValue')+'~'
                +_sMachineIDs +'~'
                + _sContractorIDs + '~'
                +_sProductIds + '~'
                +parseInt($("#cboOrderType").val()) + '~'
                + _sDODIDs +'~'
                + sRSStatus+'~'
            + sRSNo+'~'
            + sOrderNo+'~'
            + 0+'~'
            + $('#dtRouteSheetDateFromAdv_His').datebox('getValue')+'~'
            + $('#dtRouteSheetDateToAdv_His').datebox('getValue')+'~'
              + 0+'~';

            sessionStorage.setItem("ParamsP", sTempString);
            debugger;
            var oRSFreshDyedYarn = {
                ErrorMessage: sTempString
            }
            Search(oRSFreshDyedYarn);
        }

    });
    $("#txtOrderNo").keyup(function (e) {
        var oRouteSheets =[];
        var keyCode = e.keyCode || e.which;
        $('#txtOrderNo').removeClass("errorFieldBorder");
        //if (keyCode == 8) { oRouteSheets = _oRouteSheets; }
        //else{ oRouteSheets = $('#tblRouteSheet').datagrid('getRows'); }
        if (e.keyCode == 13) // Enter Press
        {
            if (!$.trim($("#txtOrderNo").val()).length) {

                alert("Please enter order no no to search.");
                $('#txtOrderNo').focus();
                $('#txtOrderNo').val("");
                return;
            }

            var sRSNo ="";
            var sOrderNo =$.trim($("#txtOrderNo").val());
            var sRSStatus="";
            _sMachineIDs="";
            _sContractorIDs="";
            _sProductIds="";
            _sDODIDs="";

            var sTempString =0+ '~'
                + $('#dtRouteSheetDateFromAdv').datebox('getValue')+'~'
                + $('#dtRouteSheetDateToAdv').datebox('getValue')+'~'
                +_sMachineIDs +'~'
                + _sContractorIDs + '~'
                +_sProductIds + '~'
                +parseInt($("#cboOrderType").val()) + '~'
                + _sDODIDs +'~'
                + sRSStatus+'~'
            + sRSNo+'~'
            + sOrderNo+'~'
            + 0+'~'
            + $('#dtRouteSheetDateFromAdv_His').datebox('getValue')+'~'
            + $('#dtRouteSheetDateToAdv_His').datebox('getValue')+'~'
              + 0+'~';

            sessionStorage.setItem("ParamsP", sTempString);
            debugger;
            var oRSFreshDyedYarn = {
                ErrorMessage: sTempString
            }
            Search(oRSFreshDyedYarn);
        }

    });

    $("#btnSearchAdvSearch").click(function ()
    {
        $(".lblLoadingMessage").show();
        var sRSNo = "";
        var sOrderNo = "";
        var sRSStatus="";
        var oRSStatus=$('#tblRSStatus').datagrid('getChecked');

        if(oRSStatus.length>0){
            for(var i=0;i<oRSStatus.length;i++){
                sRSStatus= sRSStatus + oRSStatus[i].id+","
            }
            sRSStatus=sRSStatus.substring(0,sRSStatus.length-1);
        }
        debugger;

        var dRouteSheetDateFromAdv =$('#dtRouteSheetDateFromAdv_His').datebox('getValue');
        var startTime= $('#tpRouteSheetDateFromAdv_His').timespinner('getValue');
        var sTime=startTime.split(':');
        var hStartTime= parseFloat(sTime[0]);
        var mStartTime= parseFloat(sTime[1]);
        if(isNaN(hStartTime))
        {
            hStartTime="00";
            mStartTime="00";
        }
        dRouteSheetDateFromAdv=dRouteSheetDateFromAdv+" "+hStartTime+":"+mStartTime;

        var dRouteSheetDateToAdv =$('#dtRouteSheetDateToAdv_His').datebox('getValue');
         startTime= $('#tpRouteSheetDateToAdv_His').timespinner('getValue');
         sTime=startTime.split(':');
         hStartTime= parseFloat(sTime[0]);
         mStartTime= parseFloat(sTime[1]);
         //dRouteSheetDateToAdv = new Date(dRouteSheetDateToAdv);
         if(isNaN(hStartTime))
         {
             hStartTime="00";
             mStartTime="00";
         }
         dRouteSheetDateToAdv=dRouteSheetDateToAdv+" "+hStartTime+":"+mStartTime;
         debugger;
         var dQCdateFromAdv =$('#dtQCdateFromAdv').datebox('getValue');
         startTime= $('#tpQCdateFromAdv').timespinner('getValue');
         sTime=startTime.split(':');
         hStartTime= parseFloat(sTime[0]);
         mStartTime= parseFloat(sTime[1]);

         if(isNaN(hStartTime))
         {
             hStartTime="00";
             mStartTime="00";
         }
         dQCdateFromAdv=dQCdateFromAdv+" "+hStartTime+":"+mStartTime;

         var dQCdateToAdv =$('#dtQCdateToAdv').datebox('getValue');
         startTime= $('#tpQCdateToAdv').timespinner('getValue');
         sTime=startTime.split(':');
         hStartTime= parseFloat(sTime[0]);
         mStartTime= parseFloat(sTime[1]);
         if(isNaN(hStartTime))
         {
             hStartTime="00";
             mStartTime="00";
         }
         dQCdateToAdv=dQCdateToAdv+" "+hStartTime+":"+mStartTime;

         var sTempString =
             +parseInt($("#cboRSDateAdvS").val())+ '~'
             + $('#dtRouteSheetDateFromAdv').datebox('getValue')+'~'
             + $('#dtRouteSheetDateToAdv').datebox('getValue')+'~'
             +_sMachineIDs +'~'
             + _sContractorIDs + '~'
             +_sProductIds + '~'
             +parseInt($("#cboOrderType").val()) + '~'
             + _sDODIDs +'~'
             + sRSStatus+'~'
         + sRSNo+'~'
         + sOrderNo+'~'
         + parseInt($("#cboRSDateAdvS_His").val())+'~'
         + dRouteSheetDateFromAdv+'~'
         + dRouteSheetDateToAdv+'~'
         + parseInt($("#cboQCdate").val())+'~'
         + dQCdateFromAdv+'~'
         + dQCdateToAdv+'~'
          + parseInt($("#cboRSSubState_Adv").val())+'~'
         + parseInt($("#cboDUDyeingType").val())+'~'
         +parseInt($("#cboRSShift").val())+    '~'
          + $('#chkIsReDyeing').prop('checked')+'~'
         + $("#txtPI").data("PIID") +'~';

         sessionStorage.setItem("ParamsP", sTempString);
        debugger;
        var oRSFreshDyedYarn = {
            ErrorMessage: sTempString,

        }
        Search(oRSFreshDyedYarn);
    });
    function Search(oRSFreshDyedYarn)
    {
        $.ajax({
            type: "POST",
            dataType: "json",
            url: _sBaseAddress + "/RSFreshDyedYarn/AdvSearch_RSPackingQC",
            traditional: true,
            data: JSON.stringify(oRSFreshDyedYarn),
            contentType: "application/json; charset=utf-8",
            success: function (data) {
                debugger;
                var oResult = data;
                if(oResult.length<=0){
                    alert("No data found");
                }
                else{
                    $('#tblRSWise').data('FDPs',oResult)
                    DynamicRefreshList(oResult,'tblRSWise');
                    $.icsMakeFooterColumn('tblRSWise',['ColorName','Qty_RS','FreshDyedYarnQty','PackingQty','WIPQty','BagCount','RecycleQty','WastageQty','ManagedQty','TotalShort','Loss','Gain','LossPer','DCAddCount']);
                    $("#winAdvSearch").icsWindow("close");
                    $(".lblLoadingMessage").hide();
                }
            }
        });
    }
    $("#btnCloseAdvSearch").click(function (e) {
        $("#winAdvSearch").icsWindow("close");
    });

    function gridAction(value,row,index)
    {
        console.log(row.RSSubStates);
        if(row.RSSubStates<=0)
            return '<div">'+value+'</div> ';
        else
            return '<a href="javascript:void(0)" onclick="ShowSubStatus('+index+')">'+value+'</a> ';
    }
    function ShowSubStatus(index){

        debugger;
        var oRSs = $("#tblRSWise").datagrid("getRows");

        if(oRSs.length<=0){ alert("No Data Found!"); return; }

        var oRS = oRSs[index];

        var obj = {
            BaseAddress: _sBaseAddress,
            Object: oRS,
            ControllerName: "RSFreshDyedYarn",
            ActionName: "Gets_RSSubState",
            IsWinClose: false
        };
        $("#progressbar").progressbar({ value: 0 });
        $("#progressbarParent").show();
        var intervalID = setInterval(updateProgress, 250);
        $.icsDataGets(obj, function (response) {
            clearInterval(intervalID);
            $("#progressbarParent").hide();
            if (response.status && response.objs.length > 0) {
                if (response.objs[0].RouteSheetID > 0) {
                    debugger;
                    var tblColums = [];

                    var oColumn = { field: "LastUpdateDateTimeStr", title: "Update Time", width: 100, align: "left" };tblColums.push(oColumn);
                    oColumn = { field: "RSSubStateStr", title: "RS State", width: 160, align: "left" };tblColums.push(oColumn);
                    oColumn = { field: "Note", title: "Note", width: 180, align: "left" };tblColums.push(oColumn);
                    oColumn = { field: "UpdateByName", title: "Update By", width: 180, align: "left" };tblColums.push(oColumn);
                    var oPickerParam = {
                        winid: 'winRSInQCPicker',
                        winclass:'clsOrderPicker',
                        winwidth: 700,
                        winheight: 460,
                        tableid: 'tblOrderPicker',
                        tablecolumns: tblColums,
                        datalist: response.objs,
                        multiplereturn: false,
                        searchingbyfieldName:'UpdateByName',
                        windowTittle: 'Status History ['+oRS.RouteSheetNo+']'
                    };
                    $.icsPicker(oPickerParam);
                    IntializePickerbutton(oPickerParam);
                }
                else { alert(response.objs[0].ErrorMessage); }
            }
            else{
                alert("No History found.");
            }
        });


    }

    /*-------------Pick Pro------*/
    //Product Pick
    $("#txtProductName").keydown(function (e) {
        debugger;
        var code = (e.keyCode ? e.keyCode : e.which);
        if (code == 13) // Enter Press
        {
            if($('#txtProductName').val()==null || $('#txtProductName').val()=="")
            {
                alert("Please Type Product and Press Enter.");
                $('#txtProductName').focus();
                return;
            }
            PickProduct($('#txtProductName').val());
        }
        if (code == 8) //backspace=8
        {
            //debugger;
            $("#txtProductName").removeClass("fontColorOfPickItem");
            _sProductIds= "";
        }
    });
    $("#btnProductPiker").click(function () {

        if($('#txtProductName').val()==null || $('#txtProductName').val()=="")
        {
            alert("Please Type Product and Press Enter.");
            $('#txtProductName').focus();
            return;
        }
        PickProduct($('#txtProductName').val());
    });
    $("#btnClrProductPiker").click(function () {
        $("#txtProductName").val('');
        $("#txtProductName").removeClass("fontColorOfPickItem");
        _sProductIds= [];
    });
    function PickProduct(sProductName)
    {
        var oProduct = { BUID:sessionStorage.getItem("BUID"),ProductName:sProductName};

        var obj = {
            BaseAddress: _sBaseAddress,
            Object: oProduct,
            ControllerName: "Product",
            ActionName: "SearchByProductBUWise",
            IsWinClose: false
        };
        $("#progressbar").progressbar({ value: 0 });
        $("#progressbarParent").show();
        var intervalID = setInterval(updateProgress, 250);
        $.icsDataGets(obj, function (response) {
            clearInterval(intervalID);
            $("#progressbarParent").hide();
            if (response.status && response.objs.length > 0) {
                if (response.objs[0].ProductID > 0) {
                    var tblColums = [];
                    var oColumn = { field: "ProductCode", title: "Code", width: 100, align: "left" }; tblColums.push(oColumn);
                    oColumn = { field: "ProductName", title: "Name", width: 300, align: "left" }; tblColums.push(oColumn);
                    oColumn = { field: "MUnit", title: "Unit", width: 70, align: "left" }; tblColums.push(oColumn);
                    var oPickerParam = {
                        winid: 'winProductPicker',
                        winclass: 'clsProductPicker',
                        winwidth: 600,
                        winheight: 460,
                        tableid: 'tblProductPicker',
                        tablecolumns: tblColums,
                        datalist: response.objs,
                        multiplereturn: true,
                        searchingbyfieldName: 'NameCode',
                        windowTittle: 'Product List'
                    };
                    $.icsPicker(oPickerParam);
                    IntializePickerbutton(oPickerParam);
                }
                else {
                    alert(response.objs[0].ErrorMessage);
                }

            }else{
                alert("Data Not Found.");
            }
        });
    }
    /*..........PI Pick ............. */
    $("#btnResetPI").click(function () {
        $("#txtPI").val("");
        $("#txtPI").data("PIID","");
    });
    $("#btnPickPI").click(function () {
        var sPINo=$.trim($("#txtPI").val());
        GetPIs(sPINo);
    });
    $("#txtPI").keydown(function (e) {
        var nkeyCode = e.keyCode || e.which;
        if(nkeyCode==13){
            var sPINo=$.trim($("#txtPI").val());
            GetPIs(sPINo);
        }
        else if(nkeyCode==8){
            $("#txtPI").val("");
            $("#txtPI").data("PIID","");

        }
    });

    function GetPIs(sPINo){

        var oExportPI = {
            BUID: sessionStorage.getItem("BUID"),
            PINo: sPINo
        };
        var obj = {
            BaseAddress: _sBaseAddress,
            Object: oExportPI,
            ControllerName: "ExportPI",
            ActionName: "GetsBySearchKey",
            IsWinClose: false
        };
        $("#progressbar").progressbar({ value: 0 });
        $("#progressbarParent").show();
        var intervalID = setInterval(updateProgress, 250);

        $.icsDataGets(obj, function (response) {
            clearInterval(intervalID);
            $("#progressbarParent").hide();
            if (response.status && response.objs.length > 0) {
                if (response.objs[0].ExportPIID > 0) {
                    debugger;
                    var tblColums = [];
                    var oColumn = { field: "PINo", title: "PI No", width: 200, align: "left" };tblColums.push(oColumn);
                    oColumn = { field: "PIStatusSt", title: "Status", width: 150, align: "left" };tblColums.push(oColumn);
                    //oColumn = { field: "Phone", title: "Phone", width: 140, align: "left" };tblColums.push(oColumn);
                    var oPickerParam = {
                        winid: 'winPIPicker',
                        winclass:'clsPIPicker',
                        winwidth: 460,
                        winheight: 460,
                        tableid: 'tblPIPicker',
                        tablecolumns: tblColums,
                        datalist: response.objs,
                        multiplereturn: true,
                        searchingbyfieldName:'PINo',
                        windowTittle: 'PI List'
                    };
                    $.icsPicker(oPickerParam);
                    IntializePickerbutton(oPickerParam);//multiplereturn, winclassName
                }
                else { alert(response.objs[0].ErrorMessage); }
            }
            else{
                alert("No contractor found.");
            }
        });
    }


    /*..........Pick Order ............. */
    $("#btnPickOrderNo").click(function () {
        debugger;
        if (parseInt($("#cboOrderType").val())<=0 ) {

            alert("Please Select Order Type.");
            $('#cboOrderType').focus();
            $('#cboOrderType').addClass("errorFieldBorder");
            return;
        }
        else{
            $('#cboOrderType').removeClass("errorFieldBorder");
        }

        var oPSDetail = {
            OrderType:$('#cboOrderType').val(),
            OrderNo:$('#txtOrderNo').val(),
            LabDipDetailID:0,
            ContractorName:_sContractorIDs
        };

        GetOrders(oPSDetail);
    });
    $("#txtOrderNoAdv").keydown(function (e) {
        var nkeyCode = e.keyCode || e.which;
        if(nkeyCode==13){
            var sorderNo=$.trim($("#txtOrderNoAdv").val());
            if (parseInt($("#cboOrderType").val())<=0 ) {

                alert("Please Select Order Type.");
                $('#cboOrderType').focus();
                $('#cboOrderType').addClass("errorFieldBorder");
                return;
            }
            else{
                $('#cboOrderType').removeClass("errorFieldBorder");
            }

            var oPSDetail = {
                OrderType:$('#cboOrderType').val(),
                OrderNo:$('#txtOrderNoAdv').val(),
                LabDipDetailID:0
            };
            GetOrders(oPSDetail);
        }
        else if(nkeyCode==8){
            $("#txtOrderNoAdv").val("");

        }
    });
    function GetOrders(oPSDetail){

        var obj = {
            BaseAddress: _sBaseAddress,
            Object: oPSDetail,
            ControllerName: "DUPSchedule",
            ActionName: "GetsDyeingOrder",
            IsWinClose: false
        };
        $("#progressbar").progressbar({ value: 0 });
        $("#progressbarParent").show();
        var intervalID = setInterval(updateProgress, 250);
        $.icsDataGets(obj, function (response) {
            clearInterval(intervalID);
            $("#progressbarParent").hide();
            if (response.status && response.objs.length > 0) {
                if (response.objs[0].DODID > 0) {
                    debugger;
                    var tblColums = [];

                    var oColumn = { field: "OrderNo", title: "OrderNo", width: 100, align: "left" };tblColums.push(oColumn);

                    oColumn = { field: "OrderQty", title: "OrderQty", width: 75, align: "right",formatter:formatPrice };tblColums.push(oColumn);
                    oColumn = { field: "Qty_Pro", title: "Prod Qty", width: 75, align: "right",formatter:formatPrice };tblColums.push(oColumn);
                    oColumn = { field: "Qty_RS", title: "Yet To Pro", width: 75, align: "right" };tblColums.push(oColumn);
                    oColumn = { field: "ProductName", title: "Yarn", width: 225, align: "left" };tblColums.push(oColumn);
                    oColumn = { field: "ColorName", title: "ColorName", width: 100, align: "left" };tblColums.push(oColumn);
                    oColumn = { field: "ShadeSt", title: "Shade", width: 40, align: "left" };tblColums.push(oColumn);
                    oColumn = { field: "ColorNo", title: "ColorNo", width: 80, align: "left" };tblColums.push(oColumn);
                    oColumn = { field: "LabdipNo", title: "LabdipNo", width: 100, align: "left" };tblColums.push(oColumn);
                    oColumn = { field: "OrderTypeSt", title: "OrderType", width: 100, align: "left" };tblColums.push(oColumn);
                    var oPickerParam = {
                        winid: 'winOrderPicker',
                        winclass:'clsOrderPicker',
                        winwidth: 1000,
                        winheight: 660,
                        tableid: 'tblOrderPicker',
                        tablecolumns: tblColums,
                        datalist: response.objs,
                        multiplereturn: true,
                        searchingbyfieldName:'ColorName',
                        windowTittle: 'Color List'
                    };
                    $.icsPicker(oPickerParam);
                    IntializePickerbutton(oPickerParam);//multiplereturn, winclassName
                }
                else { alert(response.objs[0].ErrorMessage); }
            }
            else{
                alert("No order found.");
            }
        });


    }

    $('#btnPrintCard').click(function(){
        var oRouteSheet = $('#tblRSWise').datagrid('getSelected');
        if (oRouteSheet ==null || oRouteSheet.RouteSheetID <=0 )
        {
            alert("Please select an item from list.");
            return ;
        }
        sessionStorage.setItem("BUID", _nBUID);
      //  window.location.href = _sBaseAddress+ "/RouteSheet/PrintCard?nId="+oRouteSheet.RouteSheetID+"&buid="+_nBUID;
        window.open(_sBaseAddress+ "/RouteSheet/PrintRSPackingCard?nId="+ oRouteSheet.RouteSheetID, "_blank");
    });
    $("#btnResetOrder").click(function () {
        $('#txtOrderNoAdv').val("");
        _sDODIDs="";
    });

    /*..........Contractor Pick ............. */
    $("#btnResetBuyer").click(function () {
        $("#txtBuyer").val("");
        _sContractorIDs="";
    });
    $("#btnPickBuyer").click(function () {

        var sContractorName=$.trim($("#txtBuyer").val());
        GetContractors(sContractorName);
    });
    $("#txtBuyer").keydown(function (e) {
        var nkeyCode = e.keyCode || e.which;
        if(nkeyCode==13){
            var sContractorName=$.trim($("#txtBuyer").val());
            GetContractors(sContractorName);
        }
        else if(nkeyCode==8){
            $("#txtBuyer").val("");
            _sContractorIDs=0;
        }
    });
    function GetContractors(sContractorName){

        var oContractor = {
            Params: '2,3' +'~'+sContractorName+'~'+sessionStorage.getItem("BUID"),
        };
        var obj = {
            BaseAddress: _sBaseAddress,
            Object: oContractor,
            ControllerName: "Contractor",
            ActionName: "ContractorSearchByNameType",
            IsWinClose: false
        };
        $("#progressbar").progressbar({ value: 0 });
        $("#progressbarParent").show();
        var intervalID = setInterval(updateProgress, 250);

        $.icsDataGets(obj, function (response) {
            clearInterval(intervalID);
            $("#progressbarParent").hide();
            if (response.status && response.objs.length > 0) {
                if (response.objs[0].ContractorID > 0) {
                    debugger;
                    var tblColums = [];
                    var oColumn = { field: "ContractorID", title: "Code", width: 50, align: "center" };tblColums.push(oColumn);
                    oColumn = { field: "Name", title: "Name", width: 190, align: "left" };tblColums.push(oColumn);
                    oColumn = { field: "Phone", title: "Phone", width: 140, align: "left" };tblColums.push(oColumn);
                    var oPickerParam = {
                        winid: 'winContractorPicker',
                        winclass:'clsContractorPicker',
                        winwidth: 460,
                        winheight: 460,
                        tableid: 'tblContractorPicker',
                        tablecolumns: tblColums,
                        datalist: response.objs,
                        multiplereturn: true,
                        searchingbyfieldName:'Name',
                        windowTittle: 'Contractor List'
                    };
                    $.icsPicker(oPickerParam);
                    IntializePickerbutton(oPickerParam);//multiplereturn, winclassName
                }
                else { alert(response.objs[0].ErrorMessage); }
            }
            else{
                alert("No contractor found.");
            }
        });


    }

    /*---------------- Machine Pick --------------*/
    $("#btnResetMachine").click(function () {

        $("#txtMachine").val("");
        _sMachineIDs="";
    });
    $("#btnPickMachine").click(function () {

        var sMachineName=$.trim($("#txtMachine").val());
        if(sMachineName==""){ alert("Type machine name to search."); return false; }
        GetMachines(sMachineName);
    });
    $("#txtMachine").keydown(function (e) {
        var nkeyCode = e.keyCode || e.which;
        if(nkeyCode==13){
            var sMachineName=$.trim($("#txtMachine").val());
            if(sMachineName==""){ alert("Type machine name to search."); return false; }
            GetMachines(sMachineName);
        }
        else if(nkeyCode==8){
            $("#txtMachine").val("");
            _sMachineIDs="";
        }
    });
    function GetMachines(sMachineName){

        var oCapitalResource = {
            BUID:sessionStorage.getItem("BUID"),
            ResourcesTypeInInt:2,
            Name:sMachineName
        };
        var obj = {
            BaseAddress: _sBaseAddress,
            Object: oCapitalResource,
            ControllerName: "CapitalResource",
            ActionName: "GetsCapitalResourceLastLayer",
            IsWinClose: false
        };
        $("#progressbar").progressbar({ value: 0 });
        $("#progressbarParent").show();
        var intervalID = setInterval(updateProgress, 250);
        $.icsDataGets(obj, function (response) {
            clearInterval(intervalID);
            $("#progressbarParent").hide();
            if (response.status && response.objs.length > 0) {
                if (response.objs[0].CRID > 0) {
                    debugger;
                    var tblColums = [];
                    var oColumn = { field: "Name", title: "Machine Name", width: 130, align: "left" };tblColums.push(oColumn);
                    oColumn = { field: "MachineCapacity", title: "Capacity", width: 90, align: "left" };tblColums.push(oColumn);
                    oColumn = { field: "OperationUnitName", title: "Store", width: 185, align: "left" };tblColums.push(oColumn);

                    var oPickerParam = {
                        winid: 'winMachinePicker',
                        winclass:'clsMachinePicker',
                        winwidth: 500,
                        winheight: 460,
                        tableid: 'tblMachinePicker',
                        tablecolumns: tblColums,
                        datalist: response.objs,
                        multiplereturn: true,
                        searchingbyfieldName:'Name',
                        windowTittle: 'Machine List'
                    };
                    $.icsPicker(oPickerParam);
                    IntializePickerbutton(oPickerParam);//multiplereturn, winclassName
                }
                else { alert(response.objs[0].ErrorMessage); }
            }
            else{
                alert("No machine found.");
            }
        });


    }

    function IntializePickerbutton(oPickerobj) {
        $("#" + oPickerobj.winid).find("#btnOk").click(function () {
            SetPickerValueAssign(oPickerobj);
        });
        $(document).find('.' + oPickerobj.winclass).keydown(function (e) {
            if (e.which === 13) {
                SetPickerValueAssign(oPickerobj);
            }
        });
    }
    function SetPickerValueAssign(oPickerobj) {
        var oreturnObj = null, oreturnObjs = [];
        if (oPickerobj.multiplereturn) {
            oreturnObjs = $('#' + oPickerobj.tableid).datagrid('getChecked');
        } else {
            oreturnObj = $('#' + oPickerobj.tableid).datagrid('getSelected');
        }

        if (oPickerobj.winid == 'winRSInQCPicker')
        {
            $("#" + oPickerobj.winid).icsWindow("close");
            $("#" + oPickerobj.winid).remove();
            return;
        }
        if (oPickerobj.winid == 'winContractorPicker')
        {
            if (oreturnObjs != null && oreturnObjs.length> 0)
            {

                _sContractorIDs=''; var sMessage='';
                sMessage=(oreturnObjs.length>1)? oreturnObjs.length +" Buyers Selected" : oreturnObjs[0].Name;
                $('#txtBuyer').val(sMessage);
                $("#txtBuyer").addClass("fontColorOfPickItem");

                for(var i=0;i<oreturnObjs.length;i++){
                    _sContractorIDs=_sContractorIDs+oreturnObjs[i].ContractorID+',';
                }
                _sContractorIDs=_sContractorIDs.substring(0,_sContractorIDs.length-1);

            }
            else
            {
                alert("Please select a contractor.");
                return false;
            }
        }

        else if (oPickerobj.winid == 'winBuyers') {
            if (oreturnObjs != null && oreturnObjs.length> 0)
            {
                _sDeliverToIDs='';
                var sMessage='';
                sMessage=(oreturnObjs.length>1)? oreturnObjs.length +" Contractors Selected" : oreturnObjs[0].Name;
                $('#txtDeliverToAdvS').val(sMessage);
                $("#txtDeliverToAdvS").addClass("fontColorOfPickItem");

                for(var i=0;i<oreturnObjs.length;i++){
                    _sDeliverToIDs=_sDeliverToIDs+oreturnObjs[i].ContractorID+',';
                }
                _sDeliverToIDs=_sDeliverToIDs.substring(0,_sDeliverToIDs.length-1);
            }
            else
            {
                alert("Please select a buyer.");
                return false;
            }
        }
        else if (oPickerobj.winid == 'winProductPicker')
        {
            if (oreturnObjs!= null && oreturnObjs.length> 0)
            {
                _sProductIds=''; var sMessage='';
                sMessage=(oreturnObjs.length>1)? oreturnObjs.length +" ProductName Selected" : oreturnObjs[0].ProductName;
                $('#txtProductName').val(sMessage);
                $("#txtProductName").addClass("fontColorOfPickItem");

                for(var i=0;i<oreturnObjs.length;i++){
                    _sProductIds=_sProductIds+oreturnObjs[i].ProductID+',';
                }
                _sProductIds=_sProductIds.substring(0,_sProductIds.length-1);

            }
            else
            {
                alert("Please select a Product.");
                return false;
            }

        }
        else  if (oPickerobj.winid == 'winMachinePicker')
        {
            if (oreturnObjs!= null && oreturnObjs.length> 0)
            {
                _sMachineIDs=''; var sMessage='';
                sMessage=(oreturnObjs.length>1)? oreturnObjs.length +" Machine Selected" : oreturnObjs[0].Name;
                $('#txtMachine').val(sMessage);
                $("#txtMachine").addClass("fontColorOfPickItem");

                for(var i=0;i<oreturnObjs.length;i++){
                    _sMachineIDs=_sMachineIDs+oreturnObjs[i].CRID+',';
                }
                _sMachineIDs=_sMachineIDs.substring(0,_sMachineIDs.length-1);
            }
            else
            {
                alert("Please select a Machine.");
                return false;
            }
        }
        else  if (oPickerobj.winid == 'winOrderPicker')
        {
            if (oreturnObjs!= null && oreturnObjs.length> 0)
            {
                _sDODIDs=''; var sMessage='';
                sMessage=(oreturnObjs.length>1)? oreturnObjs.length +" Order Selected" : oreturnObjs[0].OrderNo;
                $('#txtOrderNoAdv').val(sMessage);
                $("#txtOrderNoAdv").addClass("fontColorOfPickItem");

                for(var i=0;i<oreturnObjs.length;i++){
                    _sDODIDs=_sDODIDs+oreturnObjs[i].DODID+',';
                }
                _sDODIDs=_sDODIDs.substring(0,_sDODIDs.length-1);
            }
            else
            {
                alert("Please select a order.");
                return false;
            }
        }
        else if(oPickerobj.winid == 'winPIPicker'){
            if (oreturnObjs!= null && oreturnObjs.length> 0)
            {
                var sPIIDs=''; var sMessage='';
                sMessage=(oreturnObjs.length>1)? oreturnObjs.length +" PI Selected" : oreturnObjs[0].PINo;
                $('#txtPI').val(sMessage);
                $("#txtPI").addClass("fontColorOfPickItem");

                for(var i=0;i<oreturnObjs.length;i++){
                    sPIIDs=sPIIDs+oreturnObjs[i].ExportPIID+',';
                }
                sPIIDs=sPIIDs.substring(0,sPIIDs.length-1);
                $("#txtPI").data("PIID",sPIIDs);
            }
            else
            {
                alert("Please select PI.");
                return false;
            }
        }
        $("#" + oPickerobj.winid).icsWindow("close");
        $("#" + oPickerobj.winid).remove();
    }
    /// print
    $("#btnPrintXL,#btnPrintXL_Product").click(function ()
    {
        var sParams=sessionStorage.getItem("ParamsInvPro");
        window.open(_sBaseAddress + '/RSFreshDyedYarn/PrintRpt_Excel?sTempString=' + sParams, "_blank");
    });
    $('#btnPrint').click(function (e)
    {
        var oRouteSheet = $('#tblRSWise').datagrid('getSelected');
        if (oRouteSheet ==null || oRouteSheet.RouteSheetID <=0 ) { alert("Please select an item from list."); return ; }
        var tsv=((new Date()).getTime())/1000;
      //  window.open(_sBaseAddress+ "/RouteSheet/PrintRouteSheet?nId="+oRouteSheet.RouteSheetID+"&bIsCommon="+$("#chkIsCommon").is(":checked")+"&nts="+tsv, "_blank");
        window.open(_sBaseAddress+ "/RouteSheet/PrintRSPacking?nId="+oRouteSheet.RouteSheetID, "_blank");
    });
    function RefreshSummary(nPeportType)
    {

        if(nPeportType==1)
        {
            var oRows = $('#tblRSWise').datagrid('getRows');

        }
        else
        {
            var oRows = $('#tblRS_Product').datagrid('getRows');
        }
        if(oRows.length>0)
        {
            var nQty_RS = 0,nFreshDyedYarnQty=0,nBagCount=0,nUnManagedQty=0,nManagedQty=0,nGain=0,nLoss=0;
            for(var i=0;i<oRows.length;i++)
            {
                nQty_RS = parseFloat(nQty_RS)+parseFloat(oRows[i].Qty_RS);
                nFreshDyedYarnQty = parseFloat(nFreshDyedYarnQty)+parseFloat(oRows[i].FreshDyedYarnQty);
                nBagCount = parseFloat(nBagCount)+parseFloat(oRows[i].BagCount);
                nUnManagedQty = parseFloat(nUnManagedQty)+parseFloat(oRows[i].UnManagedQty);
                nManagedQty = parseFloat(nManagedQty)+parseFloat(oRows[i].ManagedQty);
                nGain = parseFloat(nGain)+parseFloat(oRows[i].Gain);
                nLoss = parseFloat(nLoss)+parseFloat(oRows[i].Loss);
                nGainPer = parseFloat(nGain)+parseFloat(oRows[i].GainPer);
                nLossPer = parseFloat(nLoss)+parseFloat(oRows[i].LossPer);
            }

            nQty_RS = parseFloat(nQty_RS).toFixed(2);
            nFreshDyedYarnQty = parseFloat(nFreshDyedYarnQty).toFixed(2);
            nBagCount = parseFloat(nBagCount).toFixed(2);
            nUnManagedQty = parseFloat(nUnManagedQty).toFixed(2);
            nManagedQty = parseFloat(nManagedQty).toFixed(2);
            nGain = parseFloat(nGain).toFixed(2);
            nLoss = parseFloat(nLoss).toFixed(2);
            nGainPer = parseFloat(nGainPer).toFixed(2);
            nLossPer = parseFloat(nLossPer).toFixed(2);

            debugger
            var oRow =
            {
                ProductName : 'Total',
                Qty_RS:nQty_RS,
                FreshDyedYarnQty:nFreshDyedYarnQty,
                BagCount:nBagCount,
                UnManagedQty:nUnManagedQty,
                ManagedQty:nManagedQty,
                Gain:nGain,
                Loss:nLoss,
                GainPer:nGainPer,
                LossPer:nLossPer
            }
            if(nPeportType==1)
            {
                $('#tblRSWise').datagrid('appendRow',oRow);
            }
            else
            {
                $('#tblRS_Product').datagrid('appendRow',oRow);
            }

        }

    }

    ///QC//
    function formatInspection(value){

        if(value<=0){
            return '<label style="color:red"> Yet Not Added </label>';
        }
        else{
            return '<label style="color:green"> Added </label>';
        }

    }
    $("#btnQC").click(function () {
        debugger;

        _oRouteSheet=null;
        var oRS = $('#tblRSWise').datagrid('getSelected');

        if (oRS == null || oRS.RouteSheetID <= 0) {
            alert("Invalid Field!!! please select a valid Field!");
            return false;
        }
        //$("#cboRSShift").icsLoadCombo({
        //    List: oRSShifts,
        //    OptionValue: "RSShiftID",
        //    DisplayText: "Name",
        //});
        SetRouteSheet(oRS);

       // endEditing();
        $("#winQC").icsWindow("open", "QC Operation");
    });
    function SetRouteSheet (oRS)
    {
        var oRouteSheet={RouteSheetID:oRS.RouteSheetID,DyeingOrderDetailID:oRS.DyeingOrderDetailID};

        if(oRouteSheet.RouteSheetID<=0)
        {
            alert("Not Found")
            return;
        }

        var obj =
         {
             BaseAddress: _sBaseAddress,
             Object: oRouteSheet,
             ControllerName: "RouteSheet",
             ActionName: "GetRouteSheetWithPackingDOD",
             IsWinClose: false
         };
        debugger;
        $.icsDataGet(obj, function (response) {

            if (response.status && response.obj != null) {
                if (response.obj.RouteSheetID > 0) {
                    _oRouteSheet=response.obj;
                    GetITs(oRouteSheet);
                    debugger;
                    // $('#lblHeaderHanksCone').text(((response.obj.HanksCone)?"No of Hanks :":"No of Cone :"));
                    $('#lblHeaderHanksCone').text("No of "+_oRouteSheet.DyeingType+": ");
                    $('#txtRouteSheet').val(response.obj.RouteSheetNo);
                    $('#lblMachineNo').text(response.obj.MachineName);
                    $('#lblRSState').text(response.obj.RSStateStr);

                    $('#lblDyeingOrderNo').text(response.obj.OrderNoFull);
                    $('#lblBuyerName').text(oRS.ContractorName);
                    $('#lblProduct').text(oRS.ProductName);

                    $('#lblQty_Received').text(formatPrice(response.obj.RouteSheetDOs[0].Qty_Finish)+ " "+_nMUnit);

                    $('#lblColorShade').text(oRS.ColorName);
                    $('#lblNoOfHanksCone').text(response.obj.NoOfHanksCone);
                    $('#lblWeight').text(formatPrice(parseFloat(oRS.Qty_RS).toFixed(2))+ " "+_nMUnit);

                    $('#txtRemark_QC').val(response.obj.Note);
                    //$('#cboRSShift').val(response.obj.RSShiftID);

                    if(response.obj.HanksCone)
                    {
                        $("#tblRouteSheetPacking").datagrid("hideColumn", "WarpStr");
                        $("#tblRouteSheetPacking").datagrid("hideColumn", "Length");
                    }
                    else
                    {
                        $("#tblRouteSheetPacking").datagrid("showColumn", "WarpStr");
                        $("#tblRouteSheetPacking").datagrid("showColumn", "Length");
                    }

                    debugger;
                    DynamicRefreshList(response.obj.RouteSheetPackings, 'tblRouteSheetPacking');
                    DynamicRefreshList(response.obj.RSInQCDetails, 'tblRouteSheetQC');
                    //PackingQtyRemarks(GetPackingQty());
                    UpdateQC(oRS);
                    GenerateGainLoss(oRS);

                    $.icsMakeFooterColumn('tblRouteSheetPacking',['BagNo','Weight','WeightTwo','NoOfHankCone']);
                    $('.active-QC').show();

                    if(_oRouteSheet.Params=='QCDone')
                    {
                        $('.active-QC').hide();
                        $('#btnSave_QC,#btnQCDone').hide();
                    }

                }
                else { alert(response.obj.ErrorMessage); }
            }
        });
    }
    $("#btnClose_QC").click(function (e) {
        $("#btnQC").icsWindow("close");
    });

    $("#btnRefresh").click(function () {
        endEditing();
    });


    function GenerateGainLoss(oRS){
        debugger;
        var oRSInQCDetails= $('#tblRouteSheetQC').datagrid('getRows');
        var nShort=0, nLoss=0, nGain=0;
        var nTotalQty= 0;
        var stext="";
        if(oRSInQCDetails.length>0)
        {
            for(var i=0; i<oRSInQCDetails.length;i++){
                nTotalQty= parseFloat(nTotalQty) + parseFloat(oRSInQCDetails[i].Qty);
            }

            debugger;
            // nTotalQty= parseFloat(nProduction) + parseFloat(nLoss);
            nGain= parseFloat((parseFloat(nTotalQty - oRS.Qty_RS)*100)/parseFloat(oRS.Qty_RS)).toFixed(2);
            nLoss= parseFloat((parseFloat(oRS.Qty_RS - nTotalQty)*100)/parseFloat(oRS.Qty_RS)).toFixed(2);
            nShort=parseFloat(nTotalQty - oRS.Qty_RS).toFixed(2);
            if(nShort<0){nShort=nShort*-1;    $('#lblShortQty').html("Short Qty:"); } else {$('#lblShortQty').html("Gain Qty:");}
            stext= "<b>Weight: </b>"+ parseFloat(nTotalQty)  +" "+_nMUnit+ (((nTotalQty)>oRS.Qty_RS)? ("<b>  Gain Qty: "+ nShort +" Gain: </b>"+ nGain +"%") : ("<b>  Short Qty: "+ nShort +" Loss: </b>"+ nLoss +"%")) ;
        }
        $('#lblQCRemarks').html(stext);
        $('#lblPackingRemarks').html(stext);
    }
    function ResetGridEdit(){
        _nIndex=-1;
        _sNote='';
        _nQty=0;
        editIndex=undefined;
    }
    //
    var editIndex = undefined;
    function endEditing() {
        debugger;
        if (editIndex == undefined) {
            return true;
        }
        if ($('#tblRouteSheetQC').datagrid('validateRow', editIndex)) {

            $('#tblRouteSheetQC').datagrid('endEdit', editIndex);
            $('#tblRouteSheetQC').datagrid('selectRow', editIndex);
            var oRSInQCDetail = $('#tblRouteSheetQC').datagrid('getSelected');

            var nAllowedQty=GetInspectionQty() + parseFloat(oRSInQCDetail.Qty);

            //if (parseFloat(oRSInQCDetail.Qty)== _nQty && oRSInQCDetail.Note ==_sNote)
            //{
            //    editIndex = undefined;
            //    return true;
            //}

            //if(parseFloat(nAllowedQty)<parseFloat(oRSInQCDetail.Qty)){
            //    alert("Maximum allowed quantity "+ formatPrice(nAllowedQty)  +" "+_nMUnit );
            //    _nQty =  parseFloat(nAllowedQty);
            //    oRSInQCDetail.Qty=parseFloat(nAllowedQty);
            //    $('#tblRouteSheetQC').datagrid("updateRow", { index: editIndex, row: oRSInQCDetail });
            //    $('#tblRouteSheetQC').datagrid('selectRow', editIndex).datagrid('endEdit', editIndex);
            //    return false;
            //}

            //if(nAllowedQty<0)
            //    _nQty=0;
            //else _nQty=oRSInQCDetail.Qty;
            _bIsQCChange=true;
            oRSInQCDetail.RouteSheetID=_oRouteSheet.RouteSheetID;
            $('#tblRouteSheetQC').datagrid("updateRow", { index: editIndex, row: oRSInQCDetail });
            $('#tblRouteSheetQC').datagrid('selectRow', editIndex).datagrid('endEdit', editIndex);
            var oRS = $('#tblRSWise').datagrid('getSelected');
            GenerateGainLoss(oRS);
            editIndex = undefined;
        }
        else { return false; }
    }
    var _nQty = 0.00;
    var _sNote = "";
    function onClickRow(index) {

        if (editIndex != index) {
            if (endEditing()) {
                $('#tblRouteSheetQC').datagrid('selectRow', index).datagrid('beginEdit', index);
                _nQty =  parseFloat($('#tblRouteSheetQC').datagrid('getSelected').Qty);
                _sNote =  $('#tblRouteSheetQC').datagrid('getSelected').Note;
                editIndex = index;
            }
            else {
                $('#tblRouteSheetQC').datagrid('selectRow', editIndex);
            }
        }
    }
    function GetInspectionQty(){

        var oRows=$('#tblRouteSheetQC').datagrid('getRows');
        var nMaxAllowedQty= parseFloat((_oRouteSheet.Qty)) + parseFloat((((_oRouteSheet.Qty)*10)/100).toFixed(2));

        var nQty=0;
        if(oRows.length>0){
            for(var i=0; i<oRows.length;i++){
                nQty=parseFloat(nQty)+parseFloat(oRows[i].Qty);
            }
        }

        return parseFloat(nMaxAllowedQty)-parseFloat(nQty);
    }

     /*------------PACKING OPT---------------*/

    function GetPackingQty(nYarnType){
        debugger;
        var oRouteSheetPackings= $('#tblRouteSheetPacking').datagrid('getRows');
        var nPackingQty=0.0;
        if(oRouteSheetPackings.length>0)
        {
            for(var i=0; i<oRouteSheetPackings.length;i++){

                if(parseInt(oRouteSheetPackings[i].YarnType)== parseInt(nYarnType) && parseInt(nYarnType)>0 && parseInt(oRouteSheetPackings[i].YarnType)>0)
                {
                    nPackingQty= parseFloat(nPackingQty.toFixed(2)) + parseFloat(oRouteSheetPackings[i].Weight.toFixed(2));
                }
                if(parseInt(nYarnType) <=0)
                {
                    nPackingQty= parseFloat(nPackingQty.toFixed(2)) + parseFloat(oRouteSheetPackings[i].Weight.toFixed(2));
                }
            }
            nPackingQty=nPackingQty.toFixed(2);

        }

        return nPackingQty;
    }
    //function PackingQtyRemarks(nPackingQty){
    //    var stext="";
    //    if(parseFloat(nPackingQty)>0){
    //        stext= "<b>Weight: </b>"+ formatPrice(parseFloat(nPackingQty)) +""+_nMUnit+"  "+"<b> Or   </b>"+ formatPrice(parseFloat(nPackingQty*_oRouteSheetSetup.SMUnitValue)) +" "+_nMUnitTwo ;
    //    }
    //    $('#lblPackingRemarks').html(stext);
    //}
    function GetUseableWeight(oRS){
        var oRows=$('#tblRouteSheetPacking').datagrid('getRows');
        var nMaxAllowedQty= parseFloat(oRS.Qty_RS);
        var nQty=0;
        if(oRows.length>0){
            for(var i=0; i<oRows.length;i++){
                nQty=parseFloat(nQty)+parseFloat(oRows[i].Weight);
            }
        }

        return (nMaxAllowedQty>nQty)? parseFloat(nMaxAllowedQty)-parseFloat(nQty):0;
    }
    function ResetRouteSheetPacking(bIsHank,oRS){

        $('#winPacking .reset-text').val("");
        $('#winPacking .reset-select').val(0);
        _oRouteSheetPacking=null;
        $("#txtNumberBags").prop('disabled',false);
        $("#txtNumberBags").val(1);

        _nUsableQty=GetUseableWeight(oRS);
        $('#txtQty').val(formatPrice(_nUsableQty));
        //$('#txtQtyTwo').val(formatPrice(GetKG(icsRemoveComma($('#txtQty').val()) ,2)));
        //$('#txtQtyTwo').val(formatPrice((icsRemoveComma($('#txtQty').val())*_oRouteSheetSetup.SMUnitValue)));

        //  $('#lblHeaderHankCone-Picker').text(((bIsHank)?"No of Hanks :": "No of Cone :"));
        $('#lblHeaderHankCone-Picker').text(_oRouteSheet.DyeingType);

        //if(bIsHank==2)
        //{
        //    $('.region-cone').show();
        //    $("#tblRouteSheetPacking").datagrid("showColumn", "WarpStr");
        //    $("#tblRouteSheetPacking").datagrid("showColumn", "Length");
        //}
        //else
        //{
        //    $('.region-cone').hide();
        //    $("#tblRouteSheetPacking").datagrid("hideColumn", "WarpStr");
        //    $("#tblRouteSheetPacking").datagrid("hideColumn", "Length");

        //}

            $('.region-cone').show();
            $("#tblRouteSheetPacking").datagrid("showColumn", "WarpStr");
            $("#tblRouteSheetPacking").datagrid("showColumn", "Length");

        $('#cboRSInQCSetups').val(1);
    }

    function Validate(bIsHank)
    {
        debugger;
        if($.trim($('#txtNumberBags').val())==""){
            $('#txtNumberBags').focus();
            $('#txtNumberBags').addClass("errorFieldBorder");
            alert('Bag no required.');
            return false;
        }
        else{
            $('#txtNumberBags').removeClass("errorFieldBorder");
        }
        if($.trim($('#txtNumberBags').val())<0){
            $('#txtNumberBags').focus();
            $('#txtNumberBags').addClass("errorFieldBorder");
            alert('Bag no must be non negative.');
            return false;
        }
        else{
            $('#txtNumberBags').removeClass("errorFieldBorder");
        }

        if($.trim($('#txtQty').val())==""){
            $('#txtQty').focus();
            $('#txtQty').addClass("errorFieldBorder");
            alert('Quantity required.');
            return false;
        }
        else{
            $('#txtQty').removeClass("errorFieldBorder");
        }

        if( parseFloat(icsRemoveComma($('#txtQty').val()))<=0){
            $('#txtQty').focus();
            $('#txtQty').addClass("errorFieldBorder");
            alert('Quantity required.');
            return false;
        }
        else{
            $('#txtQty').removeClass("errorFieldBorder");
        }
        if(_oRouteSheetPacking!=null && _oRouteSheetPacking.PackingID>0){
            var nQty= parseFloat(_oRouteSheet.Qty) + parseFloat(_oRouteSheet.Qty*10/100) ;
            if(nQty< parseFloat(icsRemoveComma($('#txtQty').val())) ){
                $('#txtQty').focus();
                $('#txtQty').addClass("errorFieldBorder");
                alert("Maximum allowed quantity per bag "+ formatPrice(nQty) +" "+_nMUnit);
                return false;
            }
            else{
                $('#txtQty').removeClass("errorFieldBorder");
            }
        }
        else if(_oRouteSheetPacking==null){
            var nQty= parseFloat(_oRouteSheet.Qty) + parseFloat(_oRouteSheet.Qty*10/100) ;
            if(nQty< parseFloat($('#txtNumberBags').val())*parseFloat(icsRemoveComma($('#txtQty').val())) ){
                $('#txtQty').focus();
                $('#txtQty').addClass("errorFieldBorder");
                alert("Maximum allowed quantity per bag "+ formatPrice((nQty/$('#txtNumberBags').val()).toFixed(2)) +" "+_nMUnit);
                return false;
            }
            else{
                $('#txtQty').removeClass("errorFieldBorder");
            }
        }

        if(!bIsHank && $('#cboWarpWeft').val()==0){
            $('#cboWarpWeft').focus();
            $('#cboWarpWeft').addClass("errorFieldBorder");
            alert('Select warp/ weft');
            return false;
        }
        else{
            $('#cboWarpWeft').removeClass("errorFieldBorder");
        }

        if( $('#cboRSInQCSetups').val()==0){
            $('#cboRSInQCSetups').focus();
            $('#cboRSInQCSetups').addClass("errorFieldBorder");
            alert('Select Yarn Type');
            return false;
        }
        else{
            $('#cboRSInQCSetups').removeClass("errorFieldBorder");
        }

        return true;
    }
    function RefreshObject_Packing(){
        var oRouteSheetPacking={
            PackingID: (_oRouteSheetPacking==null)? 0: _oRouteSheetPacking.PackingID,
            RouteSheetID: _oRouteSheet.RouteSheetID,
            Weight:parseFloat(icsRemoveComma($('#txtQty').val())),
            BagWeight:parseFloat(icsRemoveComma($('#txtBagWeight').val())),
            NoOfHankCone:parseFloat(icsRemoveComma($('#txtHanksCone').val())),
            Warp: $("#cboWarpWeft").val(),
            YarnType: parseInt($("#cboRSInQCSetups").val()),
            BagType:parseInt($('#cboBagType').val()),
            DyeingOrderDetailID : 0,
            Length:$.trim($('#txtLength').val()),
            Note:$.trim($('#txtNote_Packing').val()),
            Params:(_oRouteSheetPacking ==null)? $("#txtNumberBags").val(): 0,
            QtyGW:parseFloat(icsRemoveComma($('#txtQtyGW').val())),
            LDPE:parseFloat(icsRemoveComma($('#txtLDPE').val())),
            HDPE:parseFloat(icsRemoveComma($('#txtHDPE').val())),
            CTN:parseFloat(icsRemoveComma($('#txtCTN').val()))
        };
        return oRouteSheetPacking;
    }
    function GetRouteSheetPacking(stitle)
    {
        var oRouteSheetPacking=$('#tblRouteSheetPacking').datagrid('getSelected');
        if (oRouteSheetPacking==null || oRouteSheetPacking.PackingID<=0) { alert('Please select an item from list.'); return false;}

        var obj =
       {
           BaseAddress: _sBaseAddress,
           Object: oRouteSheetPacking,
           ControllerName: "RouteSheet",
           ActionName: "GetRouteSheetPacking",
           IsWinClose: false
       };

        $.icsDataGet(obj, function (response) {

            if (response.status && response.obj != null) {
                if (response.obj.PackingID > 0) {
                    _oRouteSheetPacking=response.obj;
                    $("#txtNumberBags").prop('disabled',true);
                    $("#txtNumberBags").val(_oRouteSheetPacking.BagNo);
                    $("#txtQty").val(_oRouteSheetPacking.Weight);
                    $("#txtBagWeight").val(_oRouteSheetPacking.BagWeight);
                    //$("#txtQtyTwo").val(formatPrice(_oRouteSheetPacking.Weight*_oRouteSheetSetup.SMUnitValue));
                    $("#txtHanksCone").val(formatPrice(_oRouteSheetPacking.NoOfHankCone,2));
                    $('#cboWarpWeft').val(_oRouteSheetPacking.Warp);
                    $('#cboBagType').val(_oRouteSheetPacking.BagType);
                    $('#cboRSInQCSetups').val(parseInt(_oRouteSheetPacking.YarnType));
                    $("#txtLength").val(_oRouteSheetPacking.length);
                    $('#txtNote').val(_oRouteSheetPacking.Note);
                    $("#txtQtyGW").val(_oRouteSheetPacking.QtyGW);
                    $("#txtLDPE").val(_oRouteSheetPacking.LDPE);
                    $("#txtHDPE").val(_oRouteSheetPacking.HDPE);
                    $("#txtCTN").val(_oRouteSheetPacking.CTN);
                    $('#txtQtyTwo').val(parseFloat(_oRouteSheetPacking.Weight*_oRouteSheetSetup.SMUnitValue).toFixed(2));
                    $('#txtQtyGWLbs').val((_oRouteSheetPacking.QtyGW*_oRouteSheetSetup.SMUnitValue).toFixed(2));

                    $("#winPacking").icsWindow("open", stitle);
                }
                else { alert(response.obj.ErrorMessage); }
            }
        });
    }

    $("#btnAddPacking").click(function (e) {
        if(_oRouteSheet==null || _oRouteSheet.RouteSheetID<=0){
            alert(_oRouteSheetSetup.RSShortName+" required to add packing."); return false;
        }
        var oRS = $('#tblRSWise').datagrid('getSelected');
        if (oRS ==null || oRS.RouteSheetID <=0 )
        {
            alert("Please select an item from list.");
            return ;
        }
        ResetRouteSheetPacking(_oRouteSheet.HanksCone,oRS);

        var oRows = $('#tblRouteSheetPacking').datagrid('getRows');
        $('#txtHanksCone').val((oRows.length > 0) ? oRows[oRows.length-1].NoOfHankCone : "");
        $('#txtBagWeight').val((oRows.length > 0) ? oRows[oRows.length-1].BagWeight : "");
        $('#txtLDPE').val((oRows.length > 0) ? oRows[oRows.length-1].LDPE : "");
        $('#txtHDPE').val((oRows.length > 0) ? oRows[oRows.length-1].HDPE : "");
        $('#txtCTN').val((oRows.length > 0) ? oRows[oRows.length-1].CTN : "");

        $('#lblBag').text("No of Bags :");
        $("#winPacking").icsWindow("open", "Add Packing Items");
    });
    $('#btnEditPacking').click(function (e)
    {
        if(_oRouteSheet==null || _oRouteSheet.RouteSheetID<=0){
            alert( _oRouteSheetSetup.RSShortName+" required to add packing."); return false;
        }
        var oRS = $('#tblRSWise').datagrid('getSelected');
        if (oRS ==null || oRS.RouteSheetID <=0 )
        {
            alert("Please select an item from list.");
            return ;
        }
        ResetRouteSheetPacking(_oRouteSheet.HanksCone,oRS);
        $('#lblBag').text("Bag No :");
        GetRouteSheetPacking("Edit Packing Item");
    });
    $('#btnDeletePacking').click(function (e)
    {
        var oRouteSheetPacking=$('#tblRouteSheetPacking').datagrid('getSelected');
        if (oRouteSheetPacking==null || oRouteSheetPacking.PackingID<=0) { alert('Please select an item from list.'); return false;}

        var oRS = $('#tblRSWise').datagrid('getSelected');
        if (oRS ==null || oRS.RouteSheetID <=0 )
        {
            alert("Please select an item from list.");
            return ;
        }

        if (!confirm("Confirm to Delete?")) return ;
        var obj =
        {
            BaseAddress: _sBaseAddress,
            Object: oRouteSheetPacking,
            ControllerName: "RouteSheet",
            ActionName: "DeletePacking",
            TableId: "tblRouteSheetPacking",
            IsWinClose: false
        };
        $.icsDelete(obj, function (response) {
            if (response.status && response.Message =='deleted') {
                UpdateQC(oRS);
                GenerateGainLoss(oRS);
            }
        });
    });
    $("#btnSavePacking").click(function (e) {
        debugger;
        var oRS = $('#tblRSWise').datagrid('getSelected');

        if (oRS == null || oRS.RouteSheetID <= 0) {
            alert("Invalid Field!!! please select a valid Field!");
            return false;
        }
        if (!Validate(_oRouteSheet.HanksCone)) return false;
        var oRouteSheetPacking=RefreshObject_Packing();
        oRouteSheetPacking.DyeingOrderDetailID=oRS.DyeingOrderDetailID;
        if(!oRouteSheetPacking.DyeingOrderDetailID > 0)
        {
            alert("Invalid Order!"); return;
        }

        var obj = {
            BaseAddress: _sBaseAddress,
            Object: oRouteSheetPacking,
            ObjectId: oRouteSheetPacking.PackingID,
            ControllerName: "RouteSheet",
            ActionName: (oRouteSheetPacking.PackingID>0)? "SavePacking" : "PackingMultiple",
            TableId: (oRouteSheetPacking.PackingID>0)? "tblRouteSheetPacking" : "",
            IsWinClose: true,
            Message: "Save Successfully."
        };
        $.icsSave(obj, function (response) {
            if (response.status && response.obj != null) {
                if (response.obj.RouteSheetPackings.length > 0 && response.obj.RouteSheetPackings[0].PackingID>0) {
                    for(var i=0; i<response.obj.RouteSheetPackings.length;i++){
                        $('#tblRouteSheetPacking').datagrid('appendRow',response.obj.RouteSheetPackings[i]);
                    }

                    $.icsMakeFooterColumn('tblRouteSheetPacking',['BagNo','Weight','WeightTwo','NoOfHankCone']);
                    ResetRouteSheetPacking(false,oRS);
                }
                else if(response.obj.PackingID>0){
                    ResetRouteSheetPacking(false,oRS);
                }
                //PackingQtyRemarks(GetPackingQty(0));
                UpdateQC(oRS);
                GenerateGainLoss(oRS);
            }
        });
    });
    //$('#tabPackingQC').tabs({

    //    onSelect:function(title){

    //        if(title=="QC")
    //        {
    //            UpdateQC();

    //        }
    //    }
    //});
    function UpdateQC(oRS){
        debugger;
        var nPackingQty= 0;//parseFloat(GetPackingQty());
        var oRSInQCDetails = $('#tblRouteSheetQC').datagrid('getRows');
        var oRSInQCDetail=null;
        var nIndex=-1;
        for(var i=0;i<oRSInQCDetails.length;i++){
            if(oRSInQCDetails[i].YarnType==1)
            {
                nPackingQty= parseFloat(GetPackingQty(oRSInQCDetails[i].YarnType));
                nIndex=i;
                //oRSInQCDetail=oRSInQCDetails[i];
                oRSInQCDetails[i].Qty=parseFloat(nPackingQty);
                $('#tblRouteSheetQC').datagrid("updateRow", { index: nIndex, row:oRSInQCDetails[i]});

            }
             if(oRSInQCDetails[i].YarnType==4 || oRSInQCDetails[i].YarnType==5 || oRSInQCDetails[i].YarnType==6 )
            {
                nPackingQty= parseFloat(GetPackingQty(oRSInQCDetails[i].YarnType));
                nIndex=i;
                 //oRSInQCDetail=oRSInQCDetails[i];
                if(nPackingQty>0)
                {
                    oRSInQCDetails[i].Qty=parseFloat(nPackingQty);
                    oRSInQCDetails[i].RouteSheetID=parseInt(oRS.RouteSheetID);
                    oRSInQCDetails[i].DyeingOrderDetailID=parseInt(oRS.DyeingOrderDetailID);
                    $('#tblRouteSheetQC').datagrid("updateRow", { index: nIndex, row:oRSInQCDetails[i]});
                }
            }
        }
        //editIndex = 0;
        //DynamicRefreshList([], 'tblRouteSheetQC');
        //DynamicRefreshList(oRSInQCDetails, 'tblRouteSheetQC');

    }
    $("#btnClosePacking").click(function (e) {
        $("#winPacking").icsWindow("close");
    });

    /*.............QC OPERATION.............. */
    $("#btnSave_QC").click(function (){

        endEditing();
        if($('#tblRouteSheetQC').datagrid('getRows').length<=0){
            alert("No packing items found. Please add packing items.");
            return false;
        }
        var oRSInQCDetails = $('#tblRouteSheetQC').datagrid('getRows');

        var oRS = $('#tblRSWise').datagrid('getSelected');

        if (oRS == null || oRS.RouteSheetID <= 0) {
            alert("Invalid Field!!! please select a valid Field!");
            return false;
        }
        if (oRS == null || oRS.DyeingOrderDetailID <= 0) {
            alert("Invalid Field!!! please select a valid Field!");
            return false;
        }

        for(var i=0;i<oRSInQCDetails.length;i++){
            if(parseFloat(oRSInQCDetails[i].Qty)>0)
            {
                oRSInQCDetails[i].RouteSheetID=oRS.RouteSheetID;
                oRSInQCDetails[i].DyeingOrderDetailID=oRS.DyeingOrderDetailID;
            }
        }

        GenerateGainLoss(oRS);

        $.ajax({
            type: "POST",
            dataType: "json",
            url : _sBaseAddress+"/RouteSheet/SaveRSInQCDetailAll",
            traditional: true,
            data:  JSON.stringify(oRSInQCDetails),
            contentType: "application/json; charset=utf-8",
            success: function (data) {

                var oRSInQCDetails= jQuery.parseJSON(data);
                if (oRSInQCDetails.length>0 && oRSInQCDetails[0].ErrorMessage=='')
                {
                    DynamicRefreshList(oRSInQCDetails, 'tblRouteSheetQC');
                    _bIsQCChange=false;
                    _oRSInQCDetails=oRSInQCDetails;
                    alert("Data Save Succesfully!!");
                }
                else
                {
                    alert(oRSInQCDetails[0].ErrorMessage);
                }
            },
            error: function (xhr, status, error)
            {
                alert(error);
            }
        });
    });
    $('#btnDeleteQCItem').click(function (e)
    {
        var oRSInQCDetail = $('#tblRouteSheetQC').datagrid('getSelected');
        if (oRSInQCDetail==null || oRSInQCDetail.PackingID<=0) { alert('Please select an item from list.'); return false;}

        if (!confirm("Confirm to Delete?")) return ;
        DeleteQCItem(oRSInQCDetail);
    });
    $('#btnQCDone').click(function (e)
    {
        var nTotalQty=0;
        var nLossGain=0;
        endEditing();
        if($('#tblRouteSheetQC').datagrid('getRows').length<=0){
            alert("No items found. Please add QC items.");
            return false;
        }
        var oRSInQCDetails = $('#tblRouteSheetQC').datagrid('getRows');

        debugger;
        var oRS = $('#tblRSWise').datagrid('getSelected');
        if (oRS == null || oRS.RouteSheetID <= 0) {
            alert("Invalid Field!!! please select a valid Field!");
            return false;
        }

        for(var i=0; i<oRSInQCDetails.length;i++){

            nTotalQty= parseFloat(nTotalQty) + parseFloat(oRSInQCDetails[i].Qty);
        }
        nLossGain=parseFloat($('#txtShortQty').val());

        if(parseFloat($('#txtShortQty').val()<=0))
        {
            alert("Please Entry Short Qty.");
            $('#txtShortQty').focus();
            $('#txtShortQty').addClass("errorFieldBorder");
            return false;
        }
        if(isNaN(nLossGain))
        {
            nLossGain = 0;
        }
        if(parseFloat(oRS.Qty_RS)<parseFloat(nTotalQty)) // Gain
        {
            nLossGain=parseFloat(oRS.Qty_RS)-(parseFloat(nTotalQty)-parseFloat(nLossGain));
        }
        else
        {
            nLossGain=parseFloat(oRS.Qty_RS)-(parseFloat(nTotalQty)+parseFloat(nLossGain));
        }

        if(parseInt($('#cboQCRSState').val())==13)
        {
            if(_bIsQCChange==true)
            {
                alert("First Save By-products list(Westage,Recycle etc)" );
                $("#btnSave_QC").focus();
                return false;
            }

            if(parseFloat(nLossGain.toFixed(2))<0.00)
            {
                alert("Dyeing quantity must be equal to packing quantity. Confirm Gain/Short Qty:"+ nLossGain.toFixed(2) );
                return false;
            }
            if(parseFloat(nLossGain.toFixed(2))>0.00)
            {
                alert("Dyeing quantity must be equal to packing quantity. Confirm Gain/Short Qty:"+ nLossGain.toFixed(2) );
                return false;
            }
        }
        else
        {
            var bIsQCDone=false;
            var oRouteSheetPackings= $('#tblRouteSheetPacking').datagrid('getRows');
            if(oRouteSheetPackings.length<=0)
            {
                alert("Please Entry Short Qty.");
                $('#txtShortQty').focus();
                $('#txtShortQty').addClass("errorFieldBorder");
                return false;
            }

            if(oRouteSheetPackings.length>0)
            {
                for(var i=0; i<oRouteSheetPackings.length;i++){
                    if(parseInt(oRouteSheetPackings[i].PackedByEmpID)==0)
                    {
                        bIsQCDone=false;
                        break;
                    }
                    else{
                        bIsQCDone=true;
                    }
                }

                if(bIsQCDone){
                    alert("Packing item not found.");
                    return false;
                }
            }
        }



        if (!confirm("Confirm to QC passed? No way to back again.")) return ;

        var oRouteSheetDO={
            RouteSheetID : _oRouteSheet.RouteSheetID,
            DyeingOrderDetailID:parseInt(oRS.DyeingOrderDetailID),
            RSState: $("#cboQCRSState").val(),
            Note: $("#txtRemark_QC").val()

        };
        var obj = {
            BaseAddress: _sBaseAddress,
            Object: oRouteSheetDO,
            ObjectId: oRouteSheetDO.RouteSheetID,
            ControllerName: "RouteSheet",
            ActionName:"RSQCDOne",
            TableId: "",
            IsWinClose: false,
            Message: "QC Passed successfully."
        };
        $.icsSave(obj, function (response) {
            if (response.status && response.obj != null) {
                if (response.obj.RouteSheetID> 0 && response.obj.RSState==13) {
                    _oRouteSheet.RSState=response.obj.RSState;

                    var oRS = $('#tblRSWise').datagrid('getSelected');
                    var nSelectedIndex = $('#tblRSWise').datagrid('getRowIndex',oRS);
                    $('#tblRSWise').datagrid("updateRow", { index: nSelectedIndex, row: _oRouteSheet });
                    $('.active-QC').hide();  $("#btnQC").icsWindow("close");
                }
            }
        });

    });
    function DeleteQCItem(oRSInQCDetail){
        var oRS = $('#tblRSWise').datagrid('getSelected');

        if (oRS == null || oRS.RouteSheetID <= 0) {
            alert("Invalid Field!!! please select a valid Field!");
            return false;
        }
        var obj =
        {
            BaseAddress: _sBaseAddress,
            Object: oRSInQCDetail,
            ControllerName: "RouteSheet",
            ActionName: "DeleteRSInQCDetail",
            TableId: "",
            ShowMessage:false,
            IsWinClose: false
        };
        $.icsDelete(obj, function (response) {
            if (response.status && response.Message =='deleted') {
                var obj={
                    RSInQCDetailID : 0,
                    RouteSheetID : 0,
                    ColorGroupID : 0,
                    RSInQCSetupID : oRSInQCDetail.RSInQCSetupID,
                    Qty : 0,
                    Note : '',
                    ColorName : '',
                    QCSetupName : oRSInQCDetail.QCSetupName,
                    YarnType : oRSInQCDetail.YarnType
                };
                var nIndex = $("#tblRouteSheetQC").datagrid("getRowIndex", oRSInQCDetail);
                $('#tblRouteSheetQC').datagrid("updateRow", { index: nIndex, row: obj });
                GenerateGainLoss(oRS);
                ResetGridEdit();
                endEditing();
            }
        });
    }

    /*.............BUYER CHECK OPERATION.............. */
    function GetITs(oRouteSheet)
    {
        var oRouteSheet = $('#tblRSWise').datagrid('getSelected');
        $.ajax
          ({
              type: "POST",
              dataType: "json",
              url : _sBaseAddress+"/RouteSheet/GetsITransactionBYRS",
              data:  JSON.stringify(oRouteSheet),
              contentType: "application/json; charset=utf-8",
              success: function (data) {
                  //debugger;
                  var oITs = jQuery.parseJSON(data);
                  if (oITs.length>0)
                  {
                      DynamicRefreshList(oITs, 'tblITs');
                  }
                  else
                  {
                      DynamicRefreshList([], 'tblITs');
                  }
              },
              error: function (xhr, status, error)
              {
                  alert(error);
              }
          });
    }
    $("#btnAddInSubFinishing").click(function () {


        debugger;

        var oITransaction = {
            ITransactionID: 0,
            TriggerParentID:_oRouteSheet.RouteSheetID,
            ProductID: _oRouteSheet.ProductID,
            StoreName:"SubFinishingStore",
            ProductName:_oRouteSheet.ProductName,
            Qty: parseFloat(icsRemoveComma($('#txtQty_Rec').val())),
            WorkingUnitID:0,
            Description:$('#txtNote').val()
        };
        var oRouteSheet = {
            RouteSheetID: _oRouteSheet.RouteSheetID,
            ProductID: _oRouteSheet.ProductID,
            Qty: parseFloat(icsRemoveComma($('#txtQty_Rec').val())),
            WorkingUnitID:0,
            RSState:14,
            Note:$('#txtNote').val()
        };

        $.ajax({
            type: "POST",
            dataType: "json",
            url: _sBaseAddress + "/RouteSheet/RSInRSInSubFinishing",
            traditional: true,
            data: JSON.stringify(oRouteSheet),
            contentType: "application/json; charset=utf-8",
            success: function (data) {
                var oRS = jQuery.parseJSON(data); debugger;
                if (oRS.ErrorMessage=="" || oRS.ErrorMessage==null)
                {
                    var oITransactions = $("#tblITs").datagrid("getRows");
                    var nIndex = oITransactions.length;
                    $("#tblITs").datagrid("appendRow", oITransaction);
                    $("#tblITs").datagrid("selectRow", nIndex);

                    $("#txtQty_Rec").attr("placeholder", "Entry Qty");
                    $("#txtQty_Rec").val("");
                    $("#txtNote").val("");

                }
                else {
                    alert(oRS.ErrorMessage);
                }
            },
            error: function (xhr, status, error) {
                alert(error);
            }
        });

    });
    $('#btnSendToTrReq').click(function(e){
        debugger;
        //var oDUDeliveryStock = $('#tblDelStocks').datagrid('getSelected');
        if(_oRouteSheet.RouteSheetID<=0)
        {
            alert("Please Select a valid Lot.");
            return;
        }
        if (!confirm("Confirm to Receive in Delivery Store?")) return;
        //var nSelectedIndex = $('#tblDelStocks').datagrid('getRowIndex',oDUDeliveryStock);


        $.ajax({
            type: "POST",
            dataType: "json",
            url : _sBaseAddress+"/RSFreshDyedYarn/SendToRequsitionToDelivery",
            traditional: true,
            data:  JSON.stringify(_oRouteSheet),
            contentType: "application/json; charset=utf-8",
            success: function (data) {
                var  sReturnMessage = jQuery.parseJSON(data);
                debugger;
                if (sReturnMessage == '' || sReturnMessage == null)
                {
                    alert("Received Successfuly");
                    //debugger;
                    //$('#tblDelStocks').datagrid('deleteRow', nSelectedIndex);
                    //RefreshSummary();
                }
                else
                {
                    alert(sReturnMessage);
                }
            },
            error: function (xhr, status, error)
            {
                alert(xhr+'~' +status+'~'+error);
            }
        });
    });

    /*----------Routesheet Cancel----------------*/
    $('#chkNewLot').change(function(e){
        if($('#chkNewLot').is(':checked')){
            $('#chkMainLot').prop('checked',false);
            $('#cboStore').prop('disabled',false);
            _bIsNewLot=true;
        }
        else{
            $('#chkMainLot').prop('checked',true);
            $('#cboStore').val(0);
            $('#cboStore').prop('disabled',true);
            _bIsNewLot=false;
        }
    });
    $('#chkMainLot').change(function(e){

        if($('#chkMainLot').is(':checked')){
            $('#chkNewLot').prop('checked',false);
            $('#cboStore').val(0);
            $('#cboStore').prop('disabled',true);
            _bIsNewLot=false;
        }
        else{
            $('#chkNewLot').prop('checked',true);
            $('#cboStore').prop('disabled',false);
            _bIsNewLot=true;
        }

    });

    function Validation(){
        debugger;
        if(_oRouteSheet==null || _oRouteSheet.RouteSheetID<=0){
            $('#txtRSNo_Cancel').focus();
            $('#txtRSNo_Cancel').addClass("errorFieldBorder");
            alert('Routesheet required.');
            return false;
        }
        else{
            $('#txtRSNo_Cancel').removeClass("errorFieldBorder");
        }
        if($('#chkMainLot').is(':checked')==false && $('#chkNewLot').is(':checked')==false)
        {
            $('#chkNewLot').focus();
            $('#chkNewLot').addClass("errorFieldBorder");
            alert('Please Checked one(Main lot or New Lot).');
            return false;
        }
        else{
            $('#chkNewLot').addClass("errorFieldBorder");
        }

        if($('#chkNewLot').is(':checked') && $('#cboStore').val()<=0){
            $('#cboStore').focus();
            $('#cboStore').addClass("errorFieldBorder");
            alert('Please select store.');
            return false;
        }
        else{
            $('#cboStore').removeClass("errorFieldBorder");
        }
        return true;
    }
    function RefreshObject(){
        var oRouteSheetCancel={
            RouteSheetID : (_oRouteSheetCancel==null || _oRouteSheetCancel.RouteSheetID<=0)? 0 : _oRouteSheet.RouteSheetID,
            IsNewLot :( _bIsNewLot==undefined?   false : _bIsNewLot),
            WorkingUnitID : $('#cboStore').val(),
            Remarks : $.trim($('#txtRemarks').val()),
            ApprovalRemarks : $.trim($('#txtApprovalRemarks').val()),
            Params: (_oRouteSheetCancel==null || _oRouteSheetCancel.RouteSheetID<=0)? _oRouteSheet.RouteSheetID : "",
        };
        return oRouteSheetCancel;
    }

    function Save_RSCancel(sActionName, IsApprove){

        if(IsApprove){
            if(!confirm('Are you sure to approve?')) return false;
        }
        if (!Validation()) return false;
        var oRouteSheetCancel=RefreshObject();
        var obj = {
            BaseAddress: _sBaseAddress,
            Object: oRouteSheetCancel,
            ObjectId: oRouteSheetCancel.RouteSheetID,
            ControllerName: "RouteSheet",
            ActionName: sActionName,
            TableId: '',
            IsWinClose: true,
            Message: (IsApprove)? "Approved Successfuly." : "Save Successfully."
        };
        $.icsSave(obj, function (response) {
            if (response.status && response.obj != null) {
                if (response.obj.RouteSheetID>0)
                {
                    $('#cboRSSubState').val()

                    if(IsApprove){
                        OperationPerforms(-1,response.obj);
                    }

                    if(response.obj.ErrorMessage=="")
                    {
                        SaveRSSubState('Save_RSSubState',false);
                    }
                }
            }
        });
    }
    function Delete_RSCancel(oRouteSheetCancel, sActionName, bIsWinOpen){
        var obj = {
            BaseAddress: _sBaseAddress,
            Object: oRouteSheetCancel,
            ControllerName: "RouteSheet",
            ActionName: sActionName,
            TableId: "",
            IsWinClose: (bIsWinOpen)? true:false
        };
        $.icsDelete(obj, function (response) {
            if (response.status && response.Message =='deleted' && bIsWinOpen) {
                ResetRouteSheetCancel();
            }
        });
    }

    $('#btnDelete_Cancel').click(function (e)
    {
        var oRouteSheetCancel=$('#tblRSWise').datagrid('getSelected');
        if (oRouteSheetCancel==null || oRouteSheetCancel.RouteSheetID<=0) { alert('Please select an item from list.'); return false;}
        if(!confirm('Are you sure to cancel request?')) return false;
        Delete_RSCancel(oRouteSheetCancel,'DeleteRouteSheetCancel',false);
    });

    function chngRSState()
    {
        var nSubState= $('#cboRSSubState').val();
        if(nSubState!=undefined && nSubState>0)
        {
            if(nSubState==2 || nSubState==3 || nSubState==4)
            {
                //$('#btnSendToSubStore').hide();
                $('.divRSCancel').show();
            }
            else
            {
                $('.divRSCancel').hide();
               // $('#btnSendToSubStore').show();

            }
        }
    }

    function GetRSSubState(oRSSubState){
        var obj =
       {
           BaseAddress: _sBaseAddress,
           Object: oRSSubState,
           ControllerName: "RSFreshDyedYarn",
           ActionName: "GetRSSubState",
           IsWinClose: false
       };

        $.icsDataGet(obj, function (response) {
            debugger;
            if (response.status && response.obj != null) {
                if (response.obj.RouteSheetID > 0)
                {
                    _oRSSubState=response.obj;
                    $('#cboRSSubState').val(response.obj.RSSubStatusInt);
                    $('#txtRSSubNote').val(response.obj.Note);
                    chngRSState();
                }
                else if (response.obj.ErrorMessage!="")
                {
                    _oRSSubState=null;
                    alert(response.obj.ErrorMessage);
                }
            }
        });
    }

    function GetTextValue(nid)
    {
        //oRSSubStatuss.Select(id=$('#cboRSSubState').val()).Value
        for(var i=0; i<oRSSubStatuss.length;i++)
        {
            if(oRSSubStatuss[i].id==nid)
                return oRSSubStatuss[i].Value;
        }
        return "";
    }

    function SaveRSSubState(sActionName, IsApprove){

        if(IsApprove)
            if(!confirm('Are you sure to send request?')) return false;

        if ($('#cboRSSubState').val()<=0)
        {
            alert("Please select a state and try again!!");
            return false;
        }

        _oRSSubState.RSSubStatusInt= $('#cboRSSubState').val() ;
        _oRSSubState.Note=$.trim($("#txtRSSubNote").val());
        debugger;
        var obj = {
            BaseAddress: _sBaseAddress,
            Object: _oRSSubState,
            ObjectId: _oRSSubState.RouteSheetID,
            ControllerName: "RSFreshDyedYarn",
            ActionName: sActionName,
            TableId: '',
            IsWinClose: false,
            Message: "Request Sent Successfuly."
        };
        $.icsSave(obj, function (response) {
            if (response.status && response.obj != null)
            {
                if (response.obj.RouteSheetID>0)
                {
                    var oRSInQCDetail = $('#tblRSWise').datagrid('getSelected');
                    var nIndex =$('#tblRSWise').datagrid('getRowIndex',oRSInQCDetail);
                    oRSInQCDetail.RSSubStatesSt=GetTextValue($('#cboRSSubState').val());
                    oRSInQCDetail.RSSubNote=$('#txtRSSubNote').val();
                    $('#tblRSWise').datagrid("updateRow", { index: nIndex,row: oRSInQCDetail});

                    //if(parseInt($('#cboRSSubState').val())==1 || parseInt($('#cboRSSubState').val())==5 || parseInt($('#cboRSSubState').val())==6) //OK
                    //{
                    //    $('#btnSendToSubStore').show();
                    //}

                    //if(IsApprove){
                    //    OperationPerforms(-1,response.obj);
                    //}


                }
            }
        });
    }
    $('#btnApprove_Cancel').click(function (e)
    {
        _oRouteSheet=null;
        var oRS = $('#tblRSWise').datagrid('getSelected');

        if (oRS == null || oRS.RouteSheetID <= 0) {
            alert("Invalid Field!!! please select a valid Field!");
            return false;
        }
        ResetRouteSheetCancel();
        RefreshControlRouteSheet(oRS);
        $("#cboStore").icsLoadCombo({
            List: oWorkingUnits,
            OptionValue: "WorkingUnitID",
            DisplayText: "WorkingUnitName",
            InitialValue:"Default"
        });

        //GetRouteSheetCancel(oRS,"Req. For Cancel",false, false);

        ResetRouteSheetCancel();
        GetRouteSheetCancel(oRS,"Approval For Routesheet Cancel",true, false);

        $('#btnDone_Cancel').show();
        $('#btnSave_Cancel').hide();
        //$("#winRouteSheetCancel").icsWindow("open", "Req. For Cancel");
    });
    $("#btnSaveRouteSheetCancel").click(function (e)
    {
        var nSubState= $('#cboRSSubState').val();
        if(nSubState==undefined || nSubState<=0){
            alert("Please Select a sub State and try again!"); return false;
        }

        if(_oRSSubState==null)
        {
            _oRSSubState={
                RouteSheetID:0,
                Param: _oRouteSheet.RouteSheetID+""
            };
        }
        debugger;
        if(nSubState==4)
            Save_RSCancel('SaveRouteSheetCancel',false);
        else if(nSubState==2)
            Save_RSCancel('SaveRouteSheetCancel',false);
        else if(nSubState>0)
            SaveRSSubState('Save_RSSubState',true);
        else
            alert("Under Construction!");
    });
    $("#btnDone_Cancel").click(function (e) {
        Save_RSCancel('ApproveRouteSheetCancel',true);
    });

    $("#btnCloseRouteSheetCancel").click(function (e) {
        $("#winRouteSheetCancel").icsWindow("close");
    });
    $("#btnExcel_RSQC").click(function () {
        debugger;
        var sTemp=sessionStorage.getItem("ParamsP");

        sTemp= (sTemp==null? "" : sTemp);

        window.open(_sBaseAddress + '/RSFreshDyedYarn/PrintRpt_Excel?sTempString='+sTemp, "_blank");
    });

    /// Request Send//
    $('#btnAdd_Requeste').click(function (e)
    {
        debugger;
        _oRouteSheet=null;
        var oRS = $('#tblRSWise').datagrid('getSelected');

        if (oRS == null || oRS.RouteSheetID <= 0) {
            alert("Invalid Field!!! please select a valid Field!");
            return false;
        }
        $('#lblLot_Cancel').text(oRS.RawLotNo);
        $('#lblColor_Cancel').text(oRS.ColorName);
        $('#lblShift').text(oRS.RSShiftName);
        ResetRouteSheetCancel();
        RefreshControlRouteSheet(oRS);
        $("#cboStore").icsLoadCombo({
            List: oWorkingUnits,
            OptionValue: "WorkingUnitID",
            DisplayText: "WorkingUnitName",
            InitialValue:"Default"
        });
        //$("#winRouteSheetCancel").icsWindow("open", "Req. For Cancel");

        //$('#btnSendToSubStore').hide();
        GetRouteSheetCancel(oRS,"QC Request",false, false);

    });
    function ResetRouteSheetCancel(){
        _oRouteSheet=null;
        _oRouteSheetCancel=null;
        _bIsNewLot=false;
        $('#winRouteSheetCancel input,select').prop('disabled',false);

        $('#winRouteSheetCancel .reset-text').val("");
        $('#winRouteSheetCancel .reset-lbl').text("");
        $('#winRouteSheetCancel .reset-select').val(0);

        $('#chkMainLot').prop('checked',true);
        $('#chkNewLot').prop('checked',false);
        $('#cboStore').prop('disabled',true);
        $('.region-approval').hide();
        $('#btnDone_Cancel').hide();
        $('#btnSaveRouteSheetCancel').show();

        _oRSSubState=null;
        $('.divRSCancel').hide();
        $('#cboRSSubState').val(0);
        $('#txtRSSubNote').val("");
    }
    function GetRouteSheetCancel(oRouteSheetCancel,sTitle, IsApprove, IsView){
        var obj =
       {
           BaseAddress: _sBaseAddress,
           Object: oRouteSheetCancel,
           ControllerName: "RouteSheet",
           ActionName: "GetRouteSheetCancel",
           IsWinClose: false
       };

        $.icsDataGet(obj, function (response) {
            debugger;
            if (response.status && response.obj != null) {
                if (response.obj.RouteSheetID > 0)
                {
                    RefreshControlRouteSheetCancel(response.obj, IsApprove, IsView);

                    if(IsApprove && response.obj.ApproveBy!=0)
                    {
                        alert("Already canceled"); return false;
                    }
                    GetRSSubState(response.obj);
                    $("#winRouteSheetCancel").icsWindow("open", sTitle);
                }else if (response.obj.ErrorMessage=="")
                {
                    var oRS = $('#tblRSWise').datagrid('getSelected');
                    response.obj.RouteSheet=oRS;
                    RefreshControlRouteSheetCancel(response.obj, IsApprove, IsView);
                    GetRSSubState(oRS);
                    $("#winRouteSheetCancel").icsWindow("open", sTitle);
                }
                else { alert(response.obj.ErrorMessage); }
            }
        });
    }
    function RefreshControlRouteSheetCancel(oRouteSheetCancel, IsApprove, IsView)
    {
        _oRouteSheetCancel=oRouteSheetCancel;

        _bIsNewLot=oRouteSheetCancel.IsNewLot;
        if(oRouteSheetCancel.IsNewLot){
            $('#chkNewLot').prop('checked',true);
            $('#chkMainLot').prop('checked',false);
            $('#cboStore').prop('disabled',false);
        }
        else{
            $('#chkNewLot').prop('checked',false);
            $('#chkMainLot').prop('checked',true);
        }
        $('#cboStore').val(oRouteSheetCancel.WorkingUnitID);
        $('#txtRemarks').val(oRouteSheetCancel.Remarks);
        $('#txtApprovalRemarks').val(oRouteSheetCancel.ApprovalRemarks);


        $('#lblApprovedBy').text(((oRouteSheetCancel.ApproveBy!=0)?"Approved By: "+ oRouteSheetCancel.ApprovedByName : ""));
        if(IsApprove)
        {
            $('.region-approval').show();
            $('#btnSaveRouteSheetCancel').hide();
        }

        if(IsView){
            $('.region-approval').show();
            $('#winRouteSheetCancel input,select').prop('disabled',true);
        }
    }
    function RefreshControlRouteSheet(oRouteSheet){

        debugger;
        _oRouteSheet=oRouteSheet;
        $('#txtRSNo_Cancel').val(oRouteSheet.RouteSheetNo);
        $('#lblRSState_Cancel').text(oRouteSheet.RSStateStr);

        $('#lblPISample_Cancel').text(oRouteSheet.OrderNo);
        $('#lblStore_Cancel').text(oRouteSheet.StoreName);

        $('#lblYarn_Cancel').text(oRouteSheet.ProductName);

        $('#lblColor_Cancel').text(oRouteSheet.ColorNo);
        $('#lblColorShade_Cancel').text(oRouteSheet.ColorNameShade);

        $('#lblQty_Cancel').text( formatPrice(oRouteSheet.Qty_RS) +" "+_oRouteSheetSetup.MUnit);
        //$('#lblHanksCone_Cancel').text("No Of "+oRouteSheet.DyeingType);
        //$('#lblBalesCone_Cancel').text(formatPrice(oRouteSheet.NoOfHanksCone));
        $('#lblRequestedBy').text(((oRouteSheet.RequestByName=="")?"Requested By: "+_sUserName : "Requested By: "+oRouteSheet.RequestByName));
        //$('#lblRequestedBy').text("Requested By: "+ _oRouteSheet.RequestedByName);
    }
     /////

    $('#btnSendToSubStore').click(function(e){
        debugger;
        _oRouteSheet=null;
        var oRS = $('#tblRSWise').datagrid('getSelected');

        if (oRS == null || oRS.RouteSheetID <= 0) {
            alert("Invalid Field!!! please select a valid Field!");
            return false;
        }

        if(oRS.RouteSheetID<=0)
        {
            alert("Please Select a valid Lot.");
            return;
        }
        _oRouteSheet= oRS;

        ResetDyeingOrderDetail();
        GetsITransactionBYRS(oRS);
    });

    function GetsITransactionBYRS(oRS)
    {
        var oRouteSheet=oRS;

        if(oRouteSheet.RouteSheetID<=0)
        {
            alert("Not Found")
            return;
        }

        //$("#cboDyeingOrderDetails").icsLoadCombo({
        //    List: [],
        //    OptionValue: "DyeingOrderDetailID",
        //    DisplayText: "Name",
        //});

        var obj =
         {
             BaseAddress: _sBaseAddress,
             Object: oRouteSheet,
             ControllerName: "RSFreshDyedYarn",
             ActionName: "GetsITransactionBYRS",
             IsWinClose: false
         };

        $.icsDataGet(obj, function (response) {

            if (response.status && response.obj != null) {

                    var oITransections =  response.obj;

                    $('#lblHeaderHanksCone_HW').text("No of "+oRouteSheet.DyeingType+" : ");
                    $('#txtRouteSheet_HW').val(oRouteSheet.RouteSheetNo);
                    $('#lblMachineNo_HW').text(oRouteSheet.MachineName);
                    $('#lblRSState_HW').text(oRouteSheet.RSStateStr);

                    $('#lblDyeingOrderNo_HW').text(oRouteSheet.OrderNo);
                    $('#lblBuyerName_HW').text(oRouteSheet.ContractorName);
                    $('#lblProduct_HW').text(oRouteSheet.ProductName);

                   // $('#lblQty_Received_HW').text(formatPrice(oRouteSheet.Qty_Finish)+ " "+_nMUnit);

                    $('#lblColorShade_HW').text(oRouteSheet.ColorName);
                    $('#lblNoOfHanksCone_HW').text(oRouteSheet.NoOfHanksCone);
                    $('#lblWeight_HW').text(formatPrice(parseFloat(oRouteSheet.Qty).toFixed(2))+ " "+_nMUnit);

                    DynamicRefreshList(oITransections, 'tblITransections');
                    $("#winSendToHW").icsWindow("open", "Send To Hard Winding");

                //else { alert(response.obj.ErrorMessage); }
            }
        });
    }
    function SendToHardWing(oRSDO)
    {
        var oRS = $('#tblRSWise').datagrid('getSelected');

        if (oRS == null || oRS.RouteSheetID <= 0) {
            alert("Invalid Field!!! please select a valid Field!");
            return false;
        }
        var nIndex =$('#tblRSWise').datagrid('getRowIndex',oRS);
        //_oRouteSheet.Qty=  oRS.Qty_RS;
        if (!confirm("Confirm to Send in Hard winding Store?")) return;

        var oIssueQty = $('#txtDyeingOrderDetailQty_Pro').val();
        oRS.RouteSheetDOs=[oRSDO];
        oRS.Qty = oIssueQty;


        $.ajax({
            type: "POST",
            dataType: "json",
            url : _sBaseAddress+"/RSFreshDyedYarn/SendToSubStorePartially",
            traditional: true,
            data:  JSON.stringify(_oRouteSheet),
            contentType: "application/json; charset=utf-8",
            success: function (data) {
                var  sReturnMessage = jQuery.parseJSON(data);
                debugger;
                if (sReturnMessage == '' || sReturnMessage == null)
                {
                    oRS.RSStateStr="InHW_Sub_Store";
                    ResetDyeingOrderDetail();
                    $('#tblRSWise').datagrid("updateRow", { index: nIndex,row: oRS});

                    oRSDO.Qty = oIssueQty;
                    oRSDO.LotNo = oRSDO.OrderNo;
                    $('#tblITransections').datagrid("appendRow", oRSDO);

                    alert("Received Successfuly");
                }
                else
                {
                    alert(sReturnMessage);
                }
            },
            error: function (xhr, status, error)
            {
                alert(xhr+'~' +status+'~'+error);
            }
        });
    }

    $("#btnDyeingOrderDetailAdd").click(function ()
    {
        var oSelectedDOD =  $('#txtDyeingOrderDetail').data('DyeingOrderDetail');
        var oIssueQty = $('#txtDyeingOrderDetailQty_Pro').val();

        if(oSelectedDOD==null || oSelectedDOD==undefined){ alert("Please first select a order to send!"); return;}

        if(parseFloat(oSelectedDOD.Qty_Pro)<=0 || parseFloat(oSelectedDOD.Qty_Pro)<parseFloat(oIssueQty)) { alert("Invalid Issue Qty!"); return; }

        //alert("This Operation is under construction!");
        SendToHardWing(oSelectedDOD);
    });

    $("#btnClose_HW").click(function (e) {
        $("#winSendToHW").icsWindow("close");
    });

    function SetDyeingOrderDetail(oResult)
    {
        if(oResult.DyeingOrderDetailID>0)
        {
            $('#txtDyeingOrderDetail').val(oResult.OrderNo);
            $('#txtDyeingOrderDetailQty_Order').val(oResult.OrderQty);
            $('#txtDyeingOrderDetailQty_RS').val(oResult.Qty_RS);
            $('#txtDyeingOrderDetailQty_Pro').val(oResult.Qty_Pro);
            $('#txtDyeingOrderDetail').data('DyeingOrderDetail',oResult);
        }
    }

    function ResetDyeingOrderDetail()
    {
        $('#txtDyeingOrderDetail').val("");
        $('#txtDyeingOrderDetailQty_Order').val("");
        $('#txtDyeingOrderDetailQty_RS').val("");
        $('#txtDyeingOrderDetailQty_Pro').val("");
        $('#txtDyeingOrderDetail').data('DyeingOrderDetail',null);
    }
    $("#btnDyeingOrderDetail").click(function () {
        GetRouteSheetDO()
    });
    function GetRouteSheetDO()
    {
        var obj =
            {
            BaseAddress: _sBaseAddress,
            Object: _oRouteSheet,
            ControllerName: "RouteSheet",
            ActionName: "GetsRouteSheetDO_HW",
            IsWinClose: false
        };

        debugger;
        //SELECT Qty_RS, ProductName, ColorName, OrderNo, ContractorName, OrderQty FROM View_RouteSheetDO
        var tblColums = []; var oColumn = { field: "OrderNo", title: "Order No", width: 80, align: "left" }; tblColums.push(oColumn);

        oColumn = { field: "ProductName", title: "Product Name", width: 140, align: "left" }; tblColums.push(oColumn);
        oColumn = { field: "ColorName", title: "Color Name", width: 80, align: "left" }; tblColums.push(oColumn);

        oColumn = { field: "OrderQty", title: "Order Qty", width: 80, align: "right" }; tblColums.push(oColumn);
        oColumn = { field: "Qty_RS", title: "Batch Qty", width: 80, align: "right" }; tblColums.push(oColumn);
        oColumn = { field: "Qty_Pro", title: "Yet To Transfer", width: 100, align: "right" }; tblColums.push(oColumn);
        //oColumn = { field: "ProductName", title: "Product Name", width: 120, align: "left" }; tblColums.push(oColumn);

        var oPickerParam = {
            winid: 'winProducts',
            winclass: 'clsProduct',
            winwidth: 800,
            winheight: 460,
            tableid: 'tblProducts',
            tablecolumns: tblColums,
            multiplereturn: false,
            searchingbyfieldName: 'ColorName',
            windowTittle: 'Order List',
            paramObj: obj,
            pkID: 'DyeingOrderDetailID',
            callBack: SetDyeingOrderDetail
        };

        $.icsDynamicPicker(oPickerParam);
    }
    function CalculatePackingWeight(nField)
    {
        debugger;
        var nQty = parseFloat($('#txtQty').val());
        var nQtyTwo = parseFloat($('#txtQtyTwo').val());
        var nBags = parseFloat($('#txtNumberBags').val());
        var nTotalWeight = parseFloat($('#txtTotalWeight').val());

        nQty = (isNaN(nQty) ? 0 : nQty);
        nQtyTwo = (isNaN(nQtyTwo) ? 0 : nQtyTwo);
        nBags = (isNaN(nBags) ? 0 : nBags);
        nTotalWeight = (isNaN(nTotalWeight) ? 0 : nTotalWeight);

        if(nField==1) //--- WEIGHT  txtQtyTwo
        {
            if(_nMUnit.toUpperCase() == "LBS"){
                nQty = (nQtyTwo/_oRouteSheetSetup.SMUnitValue);
            }else{
                nQty = (nQtyTwo/_oRouteSheetSetup.SMUnitValue);
            }
            $('#txtQty').val(nQty.toFixed(5));
            $('#txtTotalWeight').val((nQty*nBags).toFixed(5));
            if(_nMUnit.toUpperCase() == "LBS")
                nQty = (nQty*_oRouteSheetSetup.SMUnitValue);

        }
        else if(nField==2) //--- WEIGHT  txtQty
        {
            $('#txtTotalWeight').val(nQty*nBags);
            if(_nMUnit.toUpperCase() == "LBS")
                nQty = (nQty*_oRouteSheetSetup.SMUnitValue);

        }
        else if(nField==3)  //--- Total_WEIGHT   txtTotalWeight
        {
            if(nBags>0) {
                nQty = parseFloat(nTotalWeight / nBags).toFixed(5);
                if(_nMUnit.toUpperCase() == "LBS"){
                    $('#txtQty').val(nQty);
                    nQty = (nQty*_oRouteSheetSetup.SMUnitValue);
                }else{
                    $('#txtQty').val(nQty);
                }
            }
        }

        if(nField == 2 || nField == 3){
            if(_nMUnit.toUpperCase() == "LBS")
                $('#txtQtyTwo').val(parseFloat(nQty).toFixed(5));
            else
                $('#txtQtyTwo').val(parseFloat(nQty*_oRouteSheetSetup.SMUnitValue).toFixed(5));
        }

        var nHanksCone = parseFloat($('#txtHanksCone').val());
        var nBagWeight = parseFloat($('#txtBagWeight').val());
        var nLDPE = parseFloat($('#txtLDPE').val());
        var nHDPE = parseFloat($('#txtHDPE').val());
        var nCTN = parseFloat($('#txtCTN').val());

        nHanksCone = (isNaN(nHanksCone) ? 0 : nHanksCone);
        nBagWeight = (isNaN(nBagWeight) ? 0 : nBagWeight);
        nLDPE = (isNaN(nLDPE) ? 0 : nLDPE);
        nHDPE = (isNaN(nHDPE) ? 0 : nHDPE);
        nCTN = (isNaN(nCTN) ? 0 : nCTN);

        var nConePoly = (nHanksCone*(nBagWeight+nLDPE));
        var nQtyGW = ((nQty*1000) + (nConePoly+nHDPE+nCTN))/1000;   //((nQty - (nConePoly+nHDPE+nCTN)) / 1000)*1000;

        if(_nMUnit.toUpperCase() == "LBS"){
            $('#txtQtyGW').val((nQtyGW/_oRouteSheetSetup.SMUnitValue).toFixed(5));
            $('#txtQtyGWLbs').val(nQtyGW.toFixed(5));
        }else{
            $('#txtQtyGW').val(nQtyGW.toFixed(5));
            $('#txtQtyGWLbs').val((nQtyGW*_oRouteSheetSetup.SMUnitValue).toFixed(5));
        }
    }

    function CalculateNetWeight(){
        debugger;
        var nHanksCone = parseFloat($('#txtHanksCone').val());
        var nBagWeight = parseFloat($('#txtBagWeight').val());
        var nLDPE = parseFloat($('#txtLDPE').val());
        var nHDPE = parseFloat($('#txtHDPE').val());
        var nCTN = parseFloat($('#txtCTN').val());
        var nQtyGW = parseFloat($('#txtQtyGWLbs').val());
        var nBags = parseFloat($('#txtNumberBags').val());

        nHanksCone = (isNaN(nHanksCone) ? 0 : nHanksCone);
        nBagWeight = (isNaN(nBagWeight) ? 0 : nBagWeight);
        nLDPE = (isNaN(nLDPE) ? 0 : nLDPE);
        nHDPE = (isNaN(nHDPE) ? 0 : nHDPE);
        nCTN = (isNaN(nCTN) ? 0 : nCTN);
        nBags = (isNaN(nBags) ? 0 : nBags);
        nQtyGW = (isNaN(nQtyGW) ? 0 : nQtyGW);

        if(_nMUnit.toUpperCase() == "LBS"){
            nQtyGW = (nQtyGW/_oRouteSheetSetup.SMUnitValue);
            if(_IsQtyGWLbs == false)
            $('#txtQtyGW').val(nQtyGW.toFixed(5));
        }else{
            if(_IsQtyGWLbs == false)
            $('#txtQtyGW').val((nQtyGW/_oRouteSheetSetup.SMUnitValue).toFixed(5));
        }

        var nConePoly = (nHanksCone*(nBagWeight+nLDPE));
        //var nNW = ((nQtyGW*1000) - (nConePoly+nHDPE+nCTN))/1000;
        var nNW = 0;

        if(_nMUnit.toUpperCase() == "LBS"){
            nNW = (nQtyGW*_oRouteSheetSetup.SMUnitValue) - ((nConePoly+nHDPE+nCTN)/1000);
            $('#txtQty').val((nNW/_oRouteSheetSetup.SMUnitValue).toFixed(5));
            $('#txtQtyTwo').val((nNW).toFixed(5));
            $('#txtTotalWeight').val(((nNW/_oRouteSheetSetup.SMUnitValue)*nBags).toFixed(5));
        }else{
            nNW = (nQtyGW/_oRouteSheetSetup.SMUnitValue) - ((nConePoly+nHDPE+nCTN)/1000);
            $('#txtQty').val(nNW.toFixed(5));
            $('#txtQtyTwo').val(parseFloat(nNW*_oRouteSheetSetup.SMUnitValue).toFixed(5));
            $('#txtTotalWeight').val((nNW*nBags).toFixed(5));
        }

        _IsQtyGWLbs=false;
    }

    $('#txtQtyGW').keyup(function(e){
        debugger;
        var nQtyGW = parseFloat($('#txtQtyGW').val());
        nQtyGW = (isNaN(nQtyGW) ? 0 : nQtyGW);

        if(_nMUnit.toUpperCase() == "LBS"){
            $('#txtQtyGWLbs').val((nQtyGW*_oRouteSheetSetup.SMUnitValue).toFixed(5));
        }else{
            $('#txtQtyGWLbs').val((nQtyGW*_oRouteSheetSetup.SMUnitValue).toFixed(5));
        }
        _IsQtyGWLbs = true;
        CalculateNetWeight();
    });


    //$("#txtQty").keyup(function (e) {
    //    if($.trim($('#txtQty').val())!="" && parseFloat(icsRemoveComma($('#txtQty').val()))>=0){
    //        $('#txtQtyTwo').val(formatPrice((parseFloat(icsRemoveComma($('#txtQty').val())))*_oRouteSheetSetup.SMUnitValue));
    //    }
    //    else{
    //        $('#txtQtyTwo').val("");
    //    }
    //});

    //$("#txtQtyTwo").keyup(function (e) {
    //    if($.trim($('#txtQtyTwo').val())!="" && parseFloat(icsRemoveComma($('#txtQtyTwo').val()))>=0){
    //        debugger
    //        //$('#txtQty').val(formatPrice(GetLBS(parseFloat(icsRemoveComma($('#txtQtyTwo').val())),4)));
    //        $('#txtQty').val(formatPrice((parseFloat(icsRemoveComma($('#txtQtyTwo').val())))/_oRouteSheetSetup.SMUnitValue));
    //    }
    //    else{
    //        $('#txtQty').val("");
    //    }
    //});

    //$('#btnPrintLabelDynamic').click(function (e)
    //{
    //    if(_oRouteSheet==null || _oRouteSheet.RouteSheetID<=0){
    //        alert(_oRouteSheetSetup.RSShortName+ " required to add packing."); return false;
    //    }
    //    //RouteSheet = 172
    //    var oDocument = { ModuleID : 172 };

    //    var obj =
    //    {
    //        BaseAddress: _sBaseAddress,
    //        Object: oDocument,
    //        ControllerName: "DocPrintEngine",
    //        ActionName: "GetStickerDocumentsByModule",//GetsDocumentByModule
    //        IsWinClose: false
    //    };

    //    $.icsDataGet(obj, function (response)
    //    {
    //        debugger;
    //        if (response.status && response.obj != null && response.obj.length>0)
    //        {
    //            if (response.obj[0].DocPrintEngineID > 0)
    //            {
    //                if(response.obj.length==1)
    //                {
    //                    window.open(_sBaseAddress+ "/RouteSheet/PrintDynamicLabel?nId="+_oRouteSheet.RouteSheetID+"&docId="+response.obj[0].DocPrintEngineID, "_blank");
    //                }else
    //                {
    //                    $("#cboCardType").icsLoadCombo({
    //                        List: response.obj,
    //                        OptionValue: "DocPrintEngineID",
    //                        DisplayText: "LetterName",
    //                        InitialValue:"Default"
    //                    });
    //                    $('#cboCardType').val(0);

    //                    $("#winCardPrint").icsWindow("open", "Select Type");
    //                }
    //            }
    //            else { alert(response.obj[0].ErrorMessage); }
    //        }
    //        else alert("No Document Setup Found To print!");
    //    });

     //});

    $('#btnPrintLabelDynamic').click(function (e)
    {
        if(_oRouteSheet==null || _oRouteSheet.RouteSheetID<=0){
            alert(_oRouteSheetSetup.RSShortName+ " required to add packing."); return false;
        }
        var oRouteSheetPackings= $('#tblRouteSheetPacking').datagrid('getRows');
        if(oRouteSheetPackings.length > 0){
            DynamicRefreshList(oRouteSheetPackings, 'tblRouteSheetPacking2');
        }else{
            alert("No Data Found!!");
            return;
        }
        $("#cboSearchDate").icsLoadCombo({List: "",OptionValue: "",DisplayText: ""});
        $("#cboSearchQCBy").icsLoadCombo({List: "",OptionValue: "",DisplayText: ""});

        var flags = [], output = [];
        for(var i=0; i<oRouteSheetPackings.length; i++) {
            if( flags[oRouteSheetPackings[i].QCDateSt]) continue;
            flags[oRouteSheetPackings[i].QCDateSt] = true;
            output.push(oRouteSheetPackings[i].QCDateSt);
        }
        for (var i = 0; i < output.length; i++) {
            $('#cboSearchDate').append(new Option(output[i], output[i]));
        }

        flags = [], output = [];
        for(var i=0; i<oRouteSheetPackings.length; i++) {
            if( flags[oRouteSheetPackings[i].QCBYName]) continue;
            flags[oRouteSheetPackings[i].QCBYName] = true;
            output.push(oRouteSheetPackings[i].QCBYName);
        }
        for (var i = 0; i < output.length; i++) {
            $('#cboSearchQCBy').append(new Option(output[i], output[i]));
        }


        var oDocument = { ModuleID : 172 };
        var obj =
        {
            BaseAddress: _sBaseAddress,
            Object: oDocument,
            ControllerName: "DocPrintEngine",
            ActionName: "GetStickerDocumentsByModule",//GetsDocumentByModule
            IsWinClose: false
        };
        $.icsDataGet(obj, function (response)
        {
            debugger;
            if (response.status && response.obj != null && response.obj.length>0)
            {
                if (response.obj[0].DocPrintEngineID > 0)
                {
                    if(response.obj.length==1)
                    {
                        window.open(_sBaseAddress+ "/RouteSheet/PrintDynamicLabel?nId="+_oRouteSheet.RouteSheetID+"&docId="+response.obj[0].DocPrintEngineID, "_blank");
                    }else
                    {
                        $("#cboLabelType").icsLoadCombo({
                            List: response.obj,
                            OptionValue: "DocPrintEngineID",
                            DisplayText: "LetterName",
                            InitialValue:"Default"
                        });
                        $('#cboLabelType').val(0);
                    }
                }
                else { alert(response.obj[0].ErrorMessage); }
            }
            else alert("No Document Setup Found To print!");
        });

        $("#winPrintDynamicLabel").icsWindow("open", "Print Label");
    });


    $('#chkSearchAll').click(function() {
        if ($(this).is(':checked')) {
            var oRouteSheetPackings= $('#tblRouteSheetPacking').datagrid('getRows');
            DynamicRefreshList(oRouteSheetPackings, 'tblRouteSheetPacking2');
        }
    });
    $('#btnLabelPrintOk').click(function (e)
    {
        debugger;
        if($('#cboLabelType').val()==null || $('#cboLabelType').val()<=0){
            alert("Please select a type & try again."); return false;
        }
        window.open(_sBaseAddress+ "/RouteSheet/PrintDynamicLabel?nId="+_oRouteSheet.RouteSheetID+"&docId="+$('#cboLabelType').val(), "_blank");
    });

    $('#btnOkLabelPrintForSelected').click(function (e)
    {
        debugger;
        if($('#cboLabelType').val()==null || $('#cboLabelType').val()<=0){
            alert("Please select a type & try again."); return false;
        }
        var oRows =  $('#tblRouteSheetPacking2').datagrid('getChecked');
        if(oRows.length <= 0){
            alert("Please select Items!!");
            return;
        }
        var sPackingIDs = "";
        for(var i=0;i<oRows.length;i++){
            sPackingIDs+=oRows[i].PackingID+","
        }
        if(sPackingIDs.length > 0) sPackingIDs = sPackingIDs.substring(0,sPackingIDs.length-1);
        window.open(_sBaseAddress+ "/RouteSheet/PrintDynamicLabelForSelectedItems?nId="+_oRouteSheet.RouteSheetID+"&docId="+$('#cboLabelType').val()+"&sPackingIDs="+sPackingIDs, "_blank");
    });

    $('#btnCancelLabelPrint').click(function (e)
    {
        $("#winPrintDynamicLabel").icsWindow("close");
    });

    $('#cboSearchDate').change(function(e){
        var sDate =   $('#cboSearchDate').val();
        if(sDate != "0"){
            var oRouteSheetPackings= $('#tblRouteSheetPacking').datagrid('getRows');
            var oSearchedList = [];
            for(i=0;i<oRouteSheetPackings.length;++i)
            {
                sTempName=oRouteSheetPackings[i].QCDateSt;
                n=sTempName.indexOf(sDate)
                if(n!=-1)
                {
                    oSearchedList.push(oRouteSheetPackings[i]);
                }
            }
            DynamicRefreshList(oSearchedList, 'tblRouteSheetPacking2');
            document.getElementById("chkSearchAll").checked = false;
        }
    });

    $('#cboSearchQCBy').change(function(e){
        debugger;
        var sQCBy =   $('#cboSearchQCBy').val();
        if(sQCBy != "0"){
            var oRouteSheetPackings= $('#tblRouteSheetPacking').datagrid('getRows');
            var oSearchedList = [];
            for(i=0;i<oRouteSheetPackings.length;++i)
            {
                sTempName=oRouteSheetPackings[i].QCBYName;
                n=sTempName.indexOf(sQCBy)
                if(n!=-1)
                {
                    oSearchedList.push(oRouteSheetPackings[i]);
                }
            }
            DynamicRefreshList(oSearchedList, 'tblRouteSheetPacking2');
            document.getElementById("chkSearchAll").checked = false;
        }

    });

    //$('#btnPrintCardDynamic').click(function (e)
    //{
    //    if(_oRouteSheet==null || _oRouteSheet.RouteSheetID<=0){
    //        alert(_oRouteSheetSetup.RSShortName+ " required to add packing."); return false;
    //    }
    //    //RouteSheet = 172
    //    //var oDocument = { ModuleID : 172 };

    //    window.open(_sBaseAddress+ "/RouteSheet/PrintDynamicCard?nId="+_oRouteSheet.RouteSheetID+"&docId=11", "_blank");

     //});

    $('#btnPrintCardDynamic').click(function (e)
    {
        if(_oRouteSheet==null || _oRouteSheet.RouteSheetID<=0){
            alert(_oRouteSheetSetup.RSShortName+ " required to add packing."); return false;
        }
        //RouteSheet = 172
        var oDocument = { ModuleID : 172 };
        var obj =
        {
            BaseAddress: _sBaseAddress,
            Object: oDocument,
            ControllerName: "DocPrintEngine",
            ActionName: "GetCardDocumentsByModule",
            IsWinClose: false
        };

        $.icsDataGet(obj, function (response)
        {
            debugger;
            if (response.status && response.obj != null && response.obj.length>0)
            {
                if (response.obj[0].DocPrintEngineID > 0)
                {
                    window.open(_sBaseAddress+ "/RouteSheet/PrintDynamicCard?nId="+_oRouteSheet.RouteSheetID+"&docId="+response.obj[0].DocPrintEngineID, "_blank");
                }
                else { alert(response.obj[0].ErrorMessage); }
            }
            else alert("No Document Setup Found To print!");
        });


    });

    $('#btnCardPrintOk').click(function (e)
    {
        debugger;
        if($('#cboCardType').val()==null || $('#cboCardType').val()<=0){
            alert("Please select a type & try again."); return false;
        }
        window.open(_sBaseAddress+ "/RouteSheet/PrintDynamicLabel?nId="+_oRouteSheet.RouteSheetID+"&docId="+$('#cboCardType').val(), "_blank");
    });

    $('#btnCardPrintClose').click(function (e)
    {
        $("#winCardPrint").icsWindow("close");
    });


    $("#btnByForceQC").click(function () {
        debugger;
        var oRS = $('#tblRSWise').datagrid('getSelected');
        if (oRS == null || oRS.RouteSheetID <= 0) {
            alert("Invalid Field!!! please select a valid Field!");
            return false;
        }
        if (!confirm("Confirm to Forsc QC Done ?")) return false;

        var obj = {
            BaseAddress: _sBaseAddress,
            Object: oRS,
            ObjectId: oRS.RouteSheetID,
            ControllerName: "RSFreshDyedYarn",
            ActionName: "RSQCDOneByForce",
            TableId: "tblRSWise",
            IsWinClose: false
        };
        $.icsSave(obj);
        var SelectedRowIndex = $('#tblRSWise').datagrid('getRowIndex', oRS);
        $('#tblRSWise').datagrid('updateRow', { index: SelectedRowIndex, row: oRS });
    });

    function RefreshControlLayout()
    {
        $("#btnByForceQC").hide();
        if (PermissionChecker('Lock', 'RouteSheet',_oAuthorizationRolesMapping)) {$("#btnByForceQC").show();}

    }

 </script>


