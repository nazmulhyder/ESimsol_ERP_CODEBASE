@model IEnumerable<ESimSol.BusinessObjects.RSFreshDyedYarn>
    @{
        ViewBag.Title = "Daily Fresh Dyed Yarn Receive Report(For Production)";
    }
   
<div id="progressbarParent" style="width:100%;height:100%;margin:0 auto;text-align:center; margin-left: auto;margin-right: auto;left: 0;right: 0;z-index: 1;">
    <div style="margin: 0px auto;margin-top: 251px;text-align:center;width:390px;">
        <label style="font-size:18px;">Please wait</label>
        <div id="progressbar" style="width:100%;height:37px;"></div>
    </div>
</div>
 
  <div class="menuMainCollectionTable">
      <table style="width:100%;"  border="0" cellpadding="2" cellspacing="2">
          <tr>
              <td style="width:60%;  font-size:12px; text-align:left;vertical-align:top">
                  Date : <select id="cboDateSearch" style="width:16%;" onchange="DateActions();"></select>
                  <input id="txtStartDate" type="text" style="width:16%;height:20px" class="easyui-datebox" required="required" data-options="formatter:icsdateformat,parser:icsdateparser" />
                  <input id="tpStartDate" class="easyui-timespinner" style="width:60px;" required="required" />
                  To
                  <input id="txtEndDate" type="text" style="width:16%;height:20px" class="easyui-datebox" required="required" data-options="formatter:icsdateformat,parser:icsdateparser" />
                  <input id="tpEndDate" class="easyui-timespinner" style="width:60px;" required="required" />
                  <a id="btnAdvSearch" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-search" plain="true">Adv Search</a>
               </td>
              @*<td style="width:20%;  font-size:12px; text-align:left">
                  <select id="cboOrderType" style="width:90%" />
              </td>*@
              <td style="width:40%;  font-size:12px; text-align:left"></td>
          </tr>
      </table>
        <div id="tabRSApproves" class="easyui-tabs" style="width:100%; height:98%">
            <div title="Dyed Lot View" id="divRSWise" style="width:100%;height:90%">
                <div style="width:100%;height:100%">
                    <table id="tblRSWise" style="width:100%; height:100%" class="easyui-datagrid" fit="true" fitcolumns="false" rownumbers="true" pagination="false" singleselect="true" autorowheight="false" toolbar="#toolbarRSWise" data-options="rowStyler: function(index,row){
                                        if (row.ProductName=='Total'){
                                        return 'color:#016B18; font-weight:bold;';
                                    }
                                }
                                ">
                        <thead>
                            <tr>
                                <th field="ContractorName" width="20%">Buyer Name</th>
                                <th field="ProductName" width="20%">Yarn</th>
                                <th field="ColorName" width="10%">Color</th>
                                <th field="OrderNo" width="12%">Order No</th>
                                <th field="RouteSheetNo" width="10%">Dye Lot No</th>
                                @*<th field="RSShiftName" width="10%">Shift</th>*@
                                <th field="IsReDyeingSt" width="12%">IsRedyeing</th>
                                <th field="Qty_RS" width="8%" align="right" formatter="formatPrice">Dyeing Qty</th>
                              
                                @*<th field="Qty_ReDye" width="8%" align="right" formatter="formatPrice">Re-DyeQty</th>*@
                                <th field="FreshDyedYarnQty" width="8%" align="right" formatter="formatPrice">Total Packing Qty</th>
                                <th field="PackingQty" width="8%" align="right" formatter="formatPrice">Packing Qty</th>
                                <th field="WIPQty" width="8%" align="right" formatter="formatPrice">WIP Qty</th>
                                <th field="BagCount" width="8%">B/Q</th>
                                <th field="RecycleQty" width="8%" align="right" formatter="formatPrice">Recycle Qty</th>
                                <th field="WastageQty" width="8%" align="right" formatter="formatPrice">Wastage Qty</th>
                                <th field="ManagedQty" width="8%" align="right" formatter="formatPrice">ManagedQty</th>
                                @*<th field="UnManagedQty" width="8%" align="right" formatter="formatPrice">UnManagedQty</th>*@
                                <th field="Loss" width="8%" align="right" formatter="formatPrice">Actual Short Qty</th>
                                <th field="TotalShort" width="8%" align="right" formatter="formatPrice">Total Short Qty</th>
                                
                                <th field="Gain" width="6%" align="right" formatter="formatPrice">Gain Qty</th>
                                <th field="LossPer" width="6%" align="right" formatter="formatPrice">Loss%</th>
                                <th field="DCAddCount" width="8%" align="right" formatter="formatPrice">Add DC</th>
                                <th field="DyeingType" width="12%">Dyeing Type</th>
                                @*<th field="IsReDyeingSt" width="12%">IsRedyeing</th>*@
                                <th field="RequestByName" width="12%">QC By</th>
                                <th field="WUName" width="12%">Store Name</th>
                                <th field="RSStateStr" width="12%">Status</th>
                                <th field="RSShiftName" width="10%">Shift</th>
                                <th field="RSPartQC" width="10%">QCStatus</th>
                                
                            </tr>
                        </thead>
                    </table>
                    <div id="toolbarRSWise">
                        <a href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-reload" plain="true" id="btnSearch_RS">Refresh</a>
                        @*<a id="btnView" href="javascript:void(0)" class="easyui-linkbutton initial-state" iconcls="icon-details" plain="true">View</a>*@
                        <a id="btnPrintXL" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-excel" plain="true">ExportXL</a>
                        <a id="btnPrintPreview" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-print" plain="true">Preview</a>

                    </div>
                </div>
            </div>
            <div title="Product View" id="divLCRecedDOnotRecd" style="width:100%;height:90%">
                @*<table id="tblRS_Product" style="width:100%; height:100%" class="easyui-datagrid" fit="true" fitcolumns="false" rownumbers="true" pagination="false" singleselect="true" autorowheight="false" toolbar="#toolbarProduct" data-options="rowStyler: function(index,row){
            <thead>
                <tr>*@
                <table id="tblRS_Product" style="width:100%; height:100%" class="easyui-datagrid" fit="true" fitcolumns="false" rownumbers="true" pagination="false" singleselect="true" autorowheight="false" toolbar="#toolbarProduct" data-options="rowStyler: function(index,row){
                if (row.ProductName=='Total'){
                return 'color:#016B18; font-weight:bold;';
            }
        }
        ">
                    <thead>
                        <tr>
                            <th field="ProductName" width="20%" formatter="FormatStyleTwo">Yarn</th>
                            <th field="Qty_RS" width="8%" align="right" formatter="formatPrice"> Dyeing Qty</th>
                            <th field="FreshDyedYarnQty" width="8%" align="right" formatter="formatPrice">Total Packing Qty</th>
                            <th field="PackingQty" width="8%" align="right" formatter="formatPrice">Packing Qty</th>
                            <th field="WIPQtyTwo" width="8%" align="right" formatter="formatPrice">WIP Qty</th>
                            <th field="BagCount" width="8%">B/Q</th>
                            <th field="RecycleQty" width="8%" align="right" formatter="formatPrice">RecycleQty</th>
                            <th field="WastageQty" width="8%" align="right" formatter="formatPrice">WastageQty</th>
                            <th field="Loss" width="6%" align="right" formatter="formatPrice">Short</th>
                            <th field="Gain" width="6%" align="right" formatter="formatPrice">Gain</th>
                        </tr>
                    </thead>
                </table>

                <div id="toolbarProduct">
                    <a href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-reload" plain="true" id="btnSearch_Pro">Refresh</a>
                    @*<a id="btnView" href="javascript:void(0)" class="easyui-linkbutton initial-state" iconcls="icon-details" plain="true">View</a>*@

                    @*<a id="btnPrint" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-print" plain="true">Print</a>*@
                    <a id="btnPrintXL_Product" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-excel" plain="true">ExportXL</a>
                    <a id="btnProductListPreview" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-print" plain="true">Product Preview</a>
                    <a id="btnPrintPreview_Detail" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-print" plain="true">Preview(Detail)</a>

                </div>
            </div>
        </div>
</div>
  
  <div id="winAdvSearch" class="easyui-window winClass" style="width:620px" title="Adv. Search" data-options="modal:true,closed:true,collapsible:false,minimizable:false,maximizable:false,closable:false">
    <div>
        <fieldset style="margin-bottom: 0px;">
            <legend>Searching Criteria</legend>
            <table style="width:100%;text-align:right;">
                <tr>
                    <td style=" width:20%;text-align:right;">
                        <label> Batch Date:</label>
                    </td>
                    <td colspan="3" style=" width:80%;text-align:left;">
                        <select id="cboRSDateAdvS" style="width:15%;" onchange="DateActions();"></select>
                        <input id="dtRouteSheetDateFromAdv" type="text" style="width: 100px;" class="easyui-datebox" required="required" data-options="formatter:icsdateformat,parser:icsdateparser" />To
                        <input id="dtRouteSheetDateToAdv" type="text" style="width: 100px;" class="easyui-datebox" required="required" data-options="formatter:icsdateformat,parser:icsdateparser" />
                    </td>
                </tr>
                <tr>
                    <td style=" width:20%;text-align:right;">
                        <label>Machine:</label>
                    </td>
                    <td colspan="3" style=" width:80%;text-align:left;">
                        <input id="txtMachine" style="width:70%;" placeholder="Search Machine" />
                        <a id="btnPickMachine" href="javascript:void(0)" class="easyui-linkbutton ics-pick" iconcls="icon-pick" plain="true"></a>
                        <a id="btnResetMachine" href="javascript:void(0)" class="easyui-linkbutton ics-pick" iconcls="icon-clear" plain="true"></a>

                    </td>
                </tr>
                <tr>
                    <td style=" width:20%;text-align:right;">
                        <label>Customer:</label>
                    </td>
                    <td colspan="3" style=" width:80%;text-align:left;">
                        <input id="txtBuyer" style="width:70%;" placeholder=" search issue to" />
                        <a id="btnPickBuyer" href="javascript:void(0)" class="easyui-linkbutton ics-pick" iconcls="icon-pick" plain="true"></a>
                        <a id="btnResetBuyer" href="javascript:void(0)" class="easyui-linkbutton ics-pick" iconcls="icon-clear" plain="true"></a>

                    </td>
                </tr>
                <tr>
                    <td style=" width:20%;text-align:right;">
                        <label>Yarn:</label>
                    </td>
                    <td colspan="3" style=" width:80%;text-align:left;">
                        <input id="txtProductName" style="width:70%;" type="text" placeholder="Type & Press Enter" />
                        <a id="btnProductPiker" href="javascript:void(0)" class="easyui-linkbutton ics-pick" iconcls="icon-pick" plain="true"></a>
                        <a id="btnClrProductPiker" href="javascript:void(0)" class="easyui-linkbutton ics-pick" iconcls="icon-clear" plain="true"></a>
                    </td>
                </tr>
                <tr>
                    <td style=" width:20%;text-align:right;">
                        <label>Order Type:</label>
                    </td>
                    <td style=" width:30%;text-align:left;">
                        <select id="cboOrderType" class="cbo-styler"></select>
                    </td>
                    <td style=" width:20%;text-align:right;"></td>
                    <td style=" width:30%;text-align:left;"></td>
                </tr>
                <tr>
                    <td style=" width:20%;text-align:right;">
                        <label>Order No:</label>
                    </td>
                    <td colspan="3" style=" width:80%;text-align:left;">
                        <input id="txtOrderNoAdv" style="width:70%;" placeholder="Type Order No" />
                        <a id="btnPickOrderNo" href="javascript:void(0)" class="easyui-linkbutton ics-pick" iconcls="icon-pick" plain="true"></a>
                        <a id="btnResetOrder" href="javascript:void(0)" class="easyui-linkbutton ics-pick" iconcls="icon-clear" plain="true"></a>

                    </td>
                </tr>
                <tr>
                    <td style=" width:20%;text-align:right;">
                        <label>PI No:</label>
                    </td>
                    <td colspan="3" style=" width:80%;text-align:left;">
                        <input id="txtPI" style="width:70%;" placeholder="Type PI No" />
                        <a id="btnPickPI" href="javascript:void(0)" class="easyui-linkbutton ics-pick" iconcls="icon-pick" plain="true"></a>
                        <a id="btnResetPI" href="javascript:void(0)" class="easyui-linkbutton ics-pick" iconcls="icon-clear" plain="true"></a>
                    </td>
                </tr>
                <tr>
                    <td style=" width:20%;text-align:right;">
                        <label>Status:</label>
                    </td>
                    <td colspan="3" style=" width:70%;text-align:left;">
                        <table id="tblRSStatus" class="easyui-datagrid" style="height:200px;" fitcolumn="true" rownumbers="true" pagination="false" multiselect="true" autorowheight="false">
                            <thead>
                                <tr>
                                    <th data-options="field:'Selected',checkbox:true"> </th>
                                    <th field="Value" width="80%">Status</th>
                                </tr>
                            </thead>

                        </table>
                    </td>
                </tr>
                <tr>
                    <td style=" width:20%;text-align:right;">
                        <label> Date by Status:</label>
                    </td>
                    <td colspan="3" style=" width:80%;text-align:left;">
                        <select id="cboRSDateAdvS_His" style="width:15%;" onchange="DateActionsRSDateAdvSearch_His();"></select>
                        <input id="dtRouteSheetDateFromAdv_His" type="text" style="width: 100px;" class="easyui-datebox" required="required" data-options="formatter:icsdateformat,parser:icsdateparser" />
                        <input id="tpRouteSheetDateFromAdv_His" class="easyui-timespinner" style="width:60px;" required="required" />
                        To
                        <input id="dtRouteSheetDateToAdv_His" type="text" style="width: 100px;" class="easyui-datebox" required="required" data-options="formatter:icsdateformat,parser:icsdateparser" />
                        <input id="tpRouteSheetDateToAdv_His" class="easyui-timespinner" style="width:60px;" required="required" />
                    </td>
                </tr>
                <tr>
                    <td style=" width:20%;text-align:right;">
                        <label> QC Date:</label>
                    </td>
                    <td colspan="3" style=" width:80%;text-align:left;">
                        <select id="cboQCdate" style="width:15%;" onchange="DateActionsQCdateAdvSearch();"></select>

                        <input id="dtQCdateFromAdv" type="text" style="width: 100px;" class="easyui-datebox" required="required" data-options="formatter:icsdateformat,parser:icsdateparser" />
                        <input id="tpQCdateFromAdv" class="easyui-timespinner" style="width:60px;" required="required" />
                        To
                        <input id="dtQCdateToAdv" type="text" style="width: 100px;" class="easyui-datebox" required="required" data-options="formatter:icsdateformat,parser:icsdateparser" />
                        <input id="tpQCdateToAdv" class="easyui-timespinner" style="width:60px;" required="required" />
                    </td>
                </tr>
                <tr>
                    <td style=" width:20%;text-align:right;">
                        <label>Dye Type:</label>
                    </td>
                    <td style=" width:30%;text-align:left;">
                        <select id="cboDUDyeingType" class="cbo-styler" style="width:100%"></select>
                    </td>
                    <td style=" width:20%;text-align:right;">
                        <label>Is Re-Dyeing ?</label>
                    </td>
                    <td style=" width:30%;text-align:left;" colspan="3">
                        <input id="chkIsReDyeing" type="checkbox" />
                    </td>
                </tr>
                <tr>
                    <td style=" width:20%;text-align:right;">
                        <label>QC State:</label>
                    </td>
                    <td style=" width:30%;text-align:left;">
                        <select style="width: 80px;" id="cboRSSubState_Adv">
                            <option value="0">-Select One-</option>
                            <option value="1">In WIP</option>
                            <option value="2">In Part QC</option>

                        </select>
                    </td>
                    <td style=" width:20%;text-align:right;">
                        <label> Shift :</label>
                    </td>
                    <td style=" width:30%;text-align:left;" colspan="3">
                        <select id="cboRSShift" class="cbo-styler" style="width:100%"></select>
                    </td>

                </tr>
                <tr>
                    <td height="1px" colspan="4"></td>
                </tr>
            </table>
        </fieldset>

        <fieldset>
            <legend>Actions : </legend>
            <table style="width:100%;text-align:right;">
                <tr>
                    <td style="width:20%;text-align:right;">
                        <a id="btnResetAdvSearch" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-reload" plain="true">Reset</a>
                    </td>
                    <td style="width:80%;text-align:right;">
                        <label class="lblLoadingMessage" style="float: left;">Loading Please Wait...</label>
                        <a id="btnSearchAdvSearch" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-search" plain="true">Search</a>
                        <a id="btnCloseAdvSearch" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-cancel" plain="true">Close</a>
                    </td>
                </tr>
            </table>

        </fieldset>
    </div>
</div>


  <div id="winReportDetail" class=" easyui-window winclass" title="Production Order List" data-options="modal:true,closed:true,collapsible:false,minimizable:false,maximizable:false,closable:false">
    <table style="width: 99%;" cellspacing="2" cellpadding="2">
        <tr>
            <td style="width:5%; text-align:right"></td>
            <td style="width:10%; text-align:right">
                <label>
                    Yarn
                </label>
            </td>
            <td colspan="3" style="width:80%; text-align:left">
                <input type="text" id="txtProductNamePTU" style="width:100%;" readonly="readonly" />
            </td>
            <td style="width:5%; text-align:right">
                                      
            </td>
        </tr>
        <tr>
            <td style="width:5%; text-align:right"></td>
            <td style="width:10%; text-align:right">
                <label>
                    Stock Qty
                </label><span class="lblMUnit"></span>
            </td>
            <td style="width:15%; text-align:left">
                <input type="text" id="txtStockQty" style="width:100%;" readonly="readonly" />
            </td>

            <td style="width:25%; text-align:right">
                <label>
                    Production Booking
                </label><span class="lblMUnit"></span>
            </td>
            <td style="width:15%; text-align:left">
                <input type="text" id="txtProBookingQty" style="width:100%;" readonly="readonly" />
            </td>
            <td style="width:10%; text-align:right">
                <label>
                    Usable Qty
                </label><span class="lblMUnit"></span>
            </td>
            <td style="width:15%; text-align:left">
                <input type="text" id="txtBalance" style="width:100%;" readonly="readonly" />
            </td>
            <td style="width:5%; text-align:right"></td>
        </tr>
    </table>
    <div id="tabReportDetail" class="easyui-tabs" style="width:100%">
        <div title="Stock Order" style="padding:2px">
            <div style="width:100%">
                <fieldset>
                    <table style="width:100%;height:300px;" id="tblLots" class="easyui-datagrid" toolbar="#toolbarLot">
                        <thead>
                            <tr>
                                <th field="LotNo" width="20%">Lot No</th>
                                <th field="WUnit" width="20%">Store</th>
                                <th field="RSCount" width="5%" align="right">Dye line Count</th>
                                <th field="MUName" width="10%">Unit</th>
                                <th field="StockQty" width="10%" align="right" formatter="formatPrice">Stock Qty</th>
                                <th field="RSQty" width="12%" align="right" formatter="formatPrice">Issue Qty</th>
                                <th field="Qty_Booking" width="10%" align="right" formatter="formatPrice">Booking Qty</th>
                                <th field="Balance" width="10%" align="right">Usable Qty</th>
                                                    
                            </tr>
                        </thead>
                    </table>
                </fieldset>
                <div id="toolbarLot">
                    <table>
                        <tr>
                            <td>
                                <a id="btnLoad_Lot" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-reload" plain="true"></a>
                            </td>
                        </tr>
                    </table>
                </div>
            </div>
        </div>
        <div title="Dyeing Card " style="padding:2px">
            <div style="width:100%">
                <fieldset>
                    <table style="width:100%;height:300px;" id="tblRSs" class="easyui-datagrid" toolbar="#toolbarRS">
                        <thead>
                            <tr>
                                <th field="RouteSheetNo" width="20%">Dye Line No</th>
                                <th field="Qty" formatter="formatPrice" width="10%" align="right">Balance</th>
                                <th field="LotNo" width="10%">Lot No</th>
                                <th field="RSStateStr" width="10%">Status</th>
                            </tr>
                        </thead>
                    </table>
                </fieldset>
                <div id="toolbarRS">
                    <table>
                        <tr>
                            <td>
                                <a id="btnLoad_RS" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-reload" plain="true"></a>
                            </td>

                        </tr>
                    </table>
                </div>

            </div>
        </div>
    </div>
    <div style="width:100%;">
        <fieldset>
            <legend style="font-weight: bold">Action : </legend>
            <table border="0" cellspacing="2" cellpadding="2" style="font-size: 11px; font-weight: bold; width:100%">
                <tr>
                    <td style="width:85%; text-align:right"></td>
                    <td style="width: 15%; text-align:right">
                        <a id="btnClose_Detail" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-cancel" plain="true">Close</a>
                    </td>
                </tr>
            </table>
        </fieldset>
    </div>
</div>

 <style type="text/css">
    .lines-no .datagrid-body td {
        border-right: 1px dotted transparent;
        border-bottom: 1px dotted transparent;
    }
 
</style>

 <script type="text/javascript">
    var _sBaseAddress="";
    var _oRSFreshDyedYarn=null;
    var _oRSFreshDyedYarns=[];
    var _oCompanys=[];
    var _oCompareOperators=[];
    var _nBUID = 0;
    var _sDODIDs="";
   
    var _sContractorIDs="";
    var _sMachineIDs="";
    var _sProductIds="";
    var _oRouteSheetSetup=null;
    var _oBU = null;
    var _sMessage="";
    var _nReportType=0;
    $(document).ready(function () {
        debugger;
        _sBaseAddress =@Html.Raw( new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(HttpContext.Current.Session[SessionInfo.BaseAddress]));
        _oRSFreshDyedYarns =@Html.Raw( new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(Model));
        _oCompareOperators = @Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(ViewBag.CompareOperators));

        _oRSStatuss=@Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(@ViewBag.RSStatuss));
        var OrderTypes = @Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(ViewBag.OrderTypes));
        var oRSShifts =@Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(@ViewBag.RSShifts));
        var oDUDyeingTypes =@Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(@ViewBag.DUDyeingTypes));
        _oRouteSheetSetup =@Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(ViewBag.RouteSheetSetup));
        debugger;
        $("#progressbar").progressbar({ value: 0 });
        $("#progressbarParent").hide();
        $(".lblLoadingMessage").hide();

        $("#cboDateSearch").icsLoadCombo({
            List: _oCompareOperators,
            OptionValue: "id",
            DisplayText: "Value"
        });

        $("#txtStartDate,#txtEndDate").datebox({ disabled: false });
        $("#txtStartDate,#txtEndDate").datebox("setValue", icsdateformat(new Date()));

        //if(sessionStorage.getItem("RouteSheets")!=null && sessionStorage.getItem("RouteSheets").length>0)
        //{
        //    _oRSFreshDyedYarns= jQuery.parseJSON(sessionStorage.getItem('RouteSheets'));
        //    var nIndex= sessionStorage.getItem('SelectedRowIndex');
        //    DynamicRefreshList(_oRSFreshDyedYarns, 'tblRSApprove');
        //    if(nIndex>-1){
        //        $('#tblRSApprove').datagrid('selectRow',nIndex);
        //        //OperationPerforms(nIndex, _oRSFreshDyedYarns[nIndex]);
        //    }
        //}
        //else{
        //    DynamicRefreshList(_oRSFreshDyedYarns, 'tblRSApprove');
        //}
        //RefreshSummary(1);


        DynamicRefreshList(_oRSStatuss, 'tblRSStatus');

        $("#cboOrderType").icsLoadCombo({
            List: OrderTypes,
            OptionValue: "OrderType",
            DisplayText: "ShortName",
        });
        $("#cboRSShift").icsLoadCombo({
            List: oRSShifts,
            OptionValue: "RSShiftID",
            DisplayText: "Name",
        });
        $("#cboDUDyeingType").icsLoadCombo({
            List: oDUDyeingTypes,
            OptionValue: "DyeingType",
            DisplayText: "Name",
        });

        $("#cboRSDateAdvS,#cboRSDateAdvS_His,#cboQCdate").icsLoadCombo({
            List: _oCompareOperators,
            OptionValue: "id",
            DisplayText: "Value",
        });

        sessionStorage.setItem("ParamsInvPro", "");
        $("#txtPI").data("PIID","");
        $('#tpStartDate,#tpEndDate').timespinner('setValue', _oRouteSheetSetup.BatchTimeSt);
    });

    $(document).keydown(function (e) { if (e.keyCode == 27) { $('div').icsWindow('close'); } });

    function DateActions() {
        DynamicDateActions("cboDateSearch", "txtStartDate", "txtEndDate");
    }
    function DateActionsRSDateAdvSearch_His() {
        DynamicDateActions("cboRSDateAdvS_His", "dtRouteSheetDateFromAdv_His", "dtRouteSheetDateToAdv_His");
    }
    function DateActionsQCdateAdvSearch() {
        DynamicDateActions("cboQCdate", "dtQCdateFromAdv", "dtQCdateToAdv");
        debugger;
    }
    
    ////Start adv Searching
    function updateProgress() {
        var value =$('#progressbar').progressbar('getValue');
        if (value < 96){
            value += Math.floor(Math.random() * 10);
            $('#progressbar').progressbar('setValue', value);
        }
    }
    function hideShow(miliseconds) {
        $("#progressbarParent").hide();
    }

    $("#btnSearch_RS").click(function ()
    {
        nOrderType=0;
        var ncboDateSearch = parseInt($("#cboDateSearch").val());
        if(ncboDateSearch == 0){
            alert("Please select Date!!");
            $("#cboDateSearch").focus()
            return;
        }
        _nReportType =1;
        _sMachineIDs="";
        _sContractorIDs="";
        _sProductIds="";
        _sDODIDs="";
        var sRSStatus="";
        var sRSNo="";
        var sOrderNo="";

        debugger;
        var dQCdateFromAdv =$('#txtStartDate').datebox('getValue');
       
        var startTime= $('#tpStartDate').timespinner('getValue');
        
        var sTime=startTime.split(':');
        var hStartTime= parseFloat(sTime[0]);
       var mStartTime= parseFloat(sTime[1]);
        
        if(isNaN(hStartTime))
        {
            hStartTime="00";
            mStartTime="00";
        }
        dQCdateFromAdv=dQCdateFromAdv+" "+hStartTime+":"+mStartTime;

        var dQCdateToAdv =$('#txtEndDate').datebox('getValue');
        startTime= $('#tpEndDate').timespinner('getValue');
         sTime=startTime.split(':');
        hStartTime= parseFloat(sTime[0]);
        mStartTime= parseFloat(sTime[1]);
        if(isNaN(hStartTime))
        {
            hStartTime="00";
            mStartTime="00";
        }
        dQCdateToAdv=dQCdateToAdv+" "+hStartTime+":"+mStartTime;

        var sTempString =
            +0+ '~'
            + icsdateformat(new Date())+'~'
            + icsdateformat(new Date())+'~'
            +_sMachineIDs +'~'
            + _sContractorIDs + '~'
            +_sProductIds + '~'
            +parseInt($("#cboOrderType").val()) + '~'
            + _sDODIDs +'~'
            + sRSStatus+'~'
        + sRSNo+'~'
        + sOrderNo+'~'
        + 0+'~'
        + icsdateformat(new Date())+'~'
        + icsdateformat(new Date())+'~'
        + parseInt($("#cboDateSearch").val())+'~'
        + dQCdateFromAdv+'~'
        + dQCdateToAdv+'~'
        + 0+'~'
        + 0+'~'
        +0+    '~'
        + 0+'~';
       
        sessionStorage.setItem("ParamsP", sTempString);
        debugger;
        var oRSFreshDyedYarn = {
            ErrorMessage: sTempString,
            ReportType:_nReportType
        }
        Search(oRSFreshDyedYarn);
    });
    $("#btnSearch_Pro").click(function () {
        //var nBuyerID = parseInt(_sDeliverToIDs);
        nOrderType=0;
        var ncboDateSearch = parseInt($("#cboDateSearch").val());
        if(ncboDateSearch == 0){
            alert("Please select Date!!");
            $("#cboDateSearch").focus()
            return;
        }
        _nReportType =2;
        _sMachineIDs="";
        _sContractorIDs="";
        _sProductIds="";
        _sDODIDs="";
        var sRSStatus="";
        var sRSNo="";
        var sOrderNo="";

        debugger;
        var dQCdateFromAdv =$('#txtStartDate').datebox('getValue');
        //var startTime= $('#txtStartDate').timespinner('getValue');
        startTime ="08:00";
        sTime=startTime.split(':');
        hStartTime= parseFloat(sTime[0]);
        mStartTime= parseFloat(sTime[1]);
        
        if(isNaN(hStartTime))
        {
            hStartTime="00";
            mStartTime="00";
        }
        dQCdateFromAdv=dQCdateFromAdv+" "+hStartTime+":"+mStartTime;

        var dQCdateToAdv =$('#txtEndDate').datebox('getValue');
        //startTime= $('#txtEndDate').timespinner('getValue');
        startTime ="08:00";
        sTime=startTime.split(':');
        hStartTime= parseFloat(sTime[0]);
        mStartTime= parseFloat(sTime[1]);
        if(isNaN(hStartTime))
        {
            hStartTime="00";
            mStartTime="00";
        }
        dQCdateToAdv=dQCdateToAdv+" "+hStartTime+":"+mStartTime;

        var sTempString =
            +0+ '~'
            + icsdateformat(new Date())+'~'
            + icsdateformat(new Date())+'~'
            +_sMachineIDs +'~'
            + _sContractorIDs + '~'
            +_sProductIds + '~'
            +parseInt($("#cboOrderType").val()) + '~'
            + _sDODIDs +'~'
            + sRSStatus+'~'
        + sRSNo+'~'
        + sOrderNo+'~'
        + 0+'~'
        + icsdateformat(new Date())+'~'
        + icsdateformat(new Date())+'~'
        + parseInt($("#cboDateSearch").val())+'~'
        + dQCdateFromAdv+'~'
        + dQCdateToAdv+'~'
        + 0+'~'
        + 0+'~'
        +0+    '~'
        + 0+'~';
       
        sessionStorage.setItem("ParamsP", sTempString);
        debugger;
        var oRSFreshDyedYarn = {
            ErrorMessage: sTempString,
            ReportType:_nReportType
        }
        Search(oRSFreshDyedYarn);
    });
  

    $("#btnView_Detail").click(function () {
        debugger;
        var oIRP= $('#tblRS_Product').datagrid('getSelected');
        if(oIRP==null)
        {
            alert("Please select a item from list!");
            return ;
        }
        DynamicRefreshList([], 'tblLots');
        GetsLots(oIRP);
        RefreshControl(oIRP);
        $("#winReportDetail").icsWindow('open', "Color Information");
        $('#tabReportDetail').tabs({ onSelect: function () {TabClick();} });
    });

    function RefreshControl(oIRP)
    {
        $('#txtProductNamePTU').val(oIRP.ProductName);
        $('#txtStockQty').val(formatPrice(oIRP.StockQty,null));
        $('#txtProBookingQty').val(formatPrice(oIRP.RSQty,null));
        $('#txtBalance').val(oIRP.Balance);
    }
    $("#btnClose_Detail").click(function () {
        debugger;

        $("#winReportDetail").icsWindow('close');
    });
    //// Lots Gets
    $("#btnLoad_Lot").click(function () {
        debugger;
        var oIRP= $('#tblRS_Product').datagrid('getSelected');
        if(oIRP==null)
        {
            alert("Please select a item from list!");
            return ;
        }
        DynamicRefreshList([], 'tblLots');
        GetsLots(oIRP);
        RefreshControl(oIRP)
    });
    function GetsLots(oIRP)
    {
        var obj = {
            BaseAddress: _sBaseAddress,
            Object: oIRP,
            ControllerName: "RSFreshDyedYarn",
            ActionName: "GetsLots",
            IsWinClose: false
        };
        $.icsDataGets(obj, function (response) {
            debugger;
            if (response.status && response.objs.length > 0)
            {
                var oLotDetails= response.objs;
                DynamicRefreshList(oLotDetails, 'tblLots');
            }
        });
    }
    //RS Gets
    $("#btnLoad_RS").click(function () {
        LoadRS();
    });
    function LoadRS()
    {
        var oIRP= $('#tblRS_Product').datagrid('getSelected');
        if(oIRP==null)
        {
            alert("Please select a item from list!");
            return ;
        }
        DynamicRefreshList([], 'tblLots');
        GetsRS(oIRP);
        RefreshControl(oIRP)
    }
    function GetsRS(oIRP)
    {
        var obj = {
            BaseAddress: _sBaseAddress,
            Object: oIRP,
            ControllerName: "RSFreshDyedYarn",
            ActionName: "GetsRSs",
            IsWinClose: false
        };
        $.icsDataGets(obj, function (response) {
            debugger;
            if (response.status && response.objs.length > 0)
            {
                var oRSs= response.objs;
                DynamicRefreshList(oRSs, 'tblRSs');
            }
        });
    }
    function TabClick()
    {
        debugger;
        var tab = $('#tabReportDetail').tabs('getSelected');
        var index = $('#tabReportDetail').tabs('getTabIndex', tab);
        if (parseInt(index)==1)
        {
            LoadRS();
        }
    }

    /// print

    $("#btnPrintXL,#btnPrintXL_Product").click(function ()
    {
        debugger;


        //var ncboDateSearch = parseInt($("#cboDateSearch").val());
        //var dStartDate = $('#txtStartDate').datebox('getValue');
        //var dEndDate= $('#txtEndDate').datebox('getValue');
        //var nOrderType = parseInt($("#cboOrderType").val());
        _nReportType =1;
        //var sParams =
        //             ncboDateSearch + "~" +
        //             dStartDate + "~" +
        //             dEndDate + "~" +
        //             nOrderType + "~" +
        //             _nReportType
        //sessionStorage.setItem("ParamsP", sParams);
        var sParams=sessionStorage.getItem("ParamsP");
        if(sParams=="" || sParams==null)
        {
            alert("No Searchaing Critria found ");
            return;
        }
        window.open(_sBaseAddress + '/RSFreshDyedYarn/PrintRpt_Excel?sTempString=' + sParams, "_blank");
    });
    $("#btnPrintPreview,#btnPrintPreview_Product").click(function ()
    {
        //var ncboDateSearch = parseInt($("#cboDateSearch").val());
        //var dStartDate = $('#txtStartDate').datebox('getValue');
        //var dEndDate= $('#txtEndDate').datebox('getValue');
        //var nOrderType = parseInt($("#cboOrderType").val());
        //_nReportType =1;
        //var sParams =
        //             ncboDateSearch + "~" +
        //             dStartDate + "~" +
        //             dEndDate + "~" +
        //             nOrderType + "~" +
        //             _nReportType
        //sessionStorage.setItem("ParamsInvPro", sParams);
        var sParams=sessionStorage.getItem("ParamsP");
        if(sParams=="" || sParams==null)
        {
            alert("No Searchaing Critria found ");
            return;
        }
        window.open(_sBaseAddress + '/RSFreshDyedYarn/PrintRpt_Preview?sTempString=' + sParams, "_blank");
    });

    $("#btnPrintPreview_Detail").click(function ()
    {
        debugger;
        var oRSFreshDyedYarn = $('#tblRS_Product').datagrid('getSelected');
        if (oRSFreshDyedYarn ==null || oRSFreshDyedYarn.ProductID <=0 ) { alert("Please select an item from list."); return ; }
        var nIndex=$('#tblRS_Product').datagrid('getRowIndex',oRSFreshDyedYarn);

        var ncboDateSearch = parseInt($("#cboDateSearch").val());
        var dStartDate = $('#txtStartDate').datebox('getValue');
        var dEndDate= $('#txtEndDate').datebox('getValue');
        var nOrderType = parseInt($("#cboOrderType").val());
        _nReportType =1;
        var sParams =
                     ncboDateSearch + "~" +
                     dStartDate + "~" +
                     dEndDate + "~" +
                     nOrderType + "~" +
                     _nReportType
        sessionStorage.setItem("ParamsInvPro", sParams);
        var sParams=sessionStorage.getItem("ParamsInvPro");
        window.open(_sBaseAddress + '/RSFreshDyedYarn/PrintRpt_PreviewProductDetail?sTempString=' + sParams+"&ProductID="+ oRSFreshDyedYarn.ProductID, "_blank");
    });

    /* =================== ADV SEARCH ==================*/
    function updateProgress() {
        var value =$('#progressbar').progressbar('getValue');
        if (value < 96){
            value += Math.floor(Math.random() * 10);
            $('#progressbar').progressbar('setValue', value);
        }
    }
    function hideShow(miliseconds) {
        $("#progressbarParent").hide();
    }
    $('#tblRouteSheet').datagrid({ onSelect: function (rowIndex, rowData) { OperationPerforms(rowIndex, rowData); } });

    function OperationPerforms(rowIndex, rowData) {
        $('#btnEdit,#btnDelete,#btnCopy,#btnPrint,#btnPrintRS_Custom,#btnRSState,#btnUndo,btnReDyeing').hide();
        if (rowData != null && rowData.RouteSheetID > 0) {
            _nNextStatus=-1;
            _sMessage="";
            $('#btnPrint,#btnPrintRS_Custom').show();
            if (rowData.RSState==1 || rowData.RSState==2)  //Initialized = 1,
            {


                // $('#btnEdit,#btnDelete,#btnRSState').show();
                _nNextStatus=3;
                _sMessage="Send to Floor";
                $('#lblRSState').text('Send to Floor');

                if (PermissionChecker('Add', 'RouteSheet',_oAuthorizationRolesMapping)) {$("#btnAdd").show();}
                if (PermissionChecker('Edit', 'RouteSheet',_oAuthorizationRolesMapping)) {$("#btnEdit").show();}
                if (PermissionChecker('Delete', 'RouteSheet',_oAuthorizationRolesMapping)) {$("#btnDelete").show();}
                if (PermissionChecker('Approved', 'RouteSheet',_oAuthorizationRolesMapping)) {$("#btnRSState").show();}

            }
            else if (rowData.RSState==3)  //In Floor
            {
                $('#btnCopy,#btnUndo').show();
                if (PermissionChecker('UnApproved', 'RouteSheet',_oAuthorizationRolesMapping)) {$("#btnUndo").show();}
                if (PermissionChecker('Copy', 'RouteSheet',_oAuthorizationRolesMapping)) {$("#btnCopy").show();}
            }
            else if (rowData.RSState>3)
            {
                //$('#btnCopy').show();
                if (PermissionChecker('Copy', 'RouteSheet',_oAuthorizationRolesMapping)) {$("#btnCopy").show();}
                if (PermissionChecker('Edit', 'RouteSheet',_oAuthorizationRolesMapping)) {$("#btnReDyeing").show();}
            }

            //if (rowData.RSState>=14 && rowData.RSState<=17)  //Sub Finishing Store to Finish
            //{
            //    $('#btnCancel').hide();
            //}
        }
    }

    /*.......... Searching ............. */
    $("#txtRouteSheetNo").keyup(function (e) {
        var oRouteSheets =[];
        var keyCode = e.keyCode || e.which;
        $('#txtRouteSheetNo').removeClass("errorFieldBorder");
        if (keyCode == 8) { oRouteSheets = _oRouteSheets; }
        else{ oRouteSheets = $('#tblRouteSheet').datagrid('getRows'); }
        if (e.keyCode == 13) // Enter Press
        {
            if (!$.trim($("#txtRouteSheetNo").val()).length) {

                alert("Please enter routesheet no to search.");
                $('#txtRouteSheetNo').focus();
                $('#txtRouteSheetNo').val("");
                return;
            }
            else { $('#txtRouteSheetNo').removeClass("errorFieldBorder"); }

            ResetAdvSearchPicker();

            var oRouteSheet={
                Params:   $.trim($("#txtRouteSheetNo").val())+'~'+0+ '~'+ icsdateformat(new Date())+'~'+ icsdateformat(new Date())+'~'+ _sDODIDs +'~'+ _sContractorIDs + '~'+_sMachineIDs +'~'+ ''+'~'+''+'~'+_sProductIds+'~'+0+''

            };
            GetsRouteSheet(oRouteSheet,false);
        }
        else {
            var sTempName="";
            var oSearchedData = [];
            for(i=0;i<oRouteSheets.length;++i)
            {
                sTempName=oRouteSheets[i]['RouteSheetNo'];
                if(sTempName.toUpperCase().indexOf($('#txtRouteSheetNo').val().toUpperCase())>-1)
                {
                    oSearchedData.push(oRouteSheets[i]);
                }
            }
            $('#tblRouteSheet').empty();
            if (oSearchedData.length == 0) { DynamicRefreshList(_oRouteSheets, "tblRouteSheet");}
            else { DynamicRefreshList(oSearchedData, "tblRouteSheet"); }

        }
    });
    $("#txtOrderNo").keyup(function (e) {
        var oRouteSheets =[];
        var keyCode = e.keyCode || e.which;
        $('#txtOrderNo').removeClass("errorFieldBorder");
        if (keyCode == 8) { oRouteSheets = _oRouteSheets; }
        else{ oRouteSheets = $('#tblRouteSheet').datagrid('getRows'); }
        if (e.keyCode == 13) // Enter Press
        {
          



        }
        else {
            var sTempName="";
            var oSearchedData = [];
            for(i=0;i<oRouteSheets.length;++i)
            {
                sTempName=oRouteSheets[i]['RouteSheetNo'];
                if(sTempName.toUpperCase().indexOf($('#txtOrderNo').val().toUpperCase())>-1)
                {
                    oSearchedData.push(oRouteSheets[i]);
                }
            }
            $('#tblRouteSheet').empty();
            if (oSearchedData.length == 0) { DynamicRefreshList(_oRouteSheets, "tblRouteSheet");}
            else { DynamicRefreshList(oSearchedData, "tblRouteSheet"); }

        }
    });

    /*..........Adv Searching ............. */
    function ResetAdvSearchPicker()
    {
        _sContractorIDs="";
        _sDODIDs="";
        _sMachineIDs="";
        _sProductIds="";
        $('#txtOrderNoAdv,#txtBuyer,#txtMachine,#txtProductName').val("");
        $('#cboOrderType,#cboRSDateAdvS,#cboRSDateAdvS_His,#cboDUDyeingType,#cboRSShift').val(0);

        $('#dtRouteSheetDateFromAdv,#dtRouteSheetDateToAdv').datebox({disabled:true});
        $('#dtRouteSheetDateFromAdv,#dtRouteSheetDateToAdv').datebox('setValue',icsdateformat(new Date()));
        $('#tblRSStatus').datagrid('uncheckAll');
        $('#tpQCdateToAdv,#tpQCdateFromAdv,#tpRouteSheetDateFromAdv_His,#tpRouteSheetDateToAdv_His').timespinner('setValue', _oRouteSheetSetup.BatchTimeSt);
    }

    function DateActionsRSDateAdvSearch() {
        DynamicDateActions("cboRSDateAdvS", "dtRouteSheetDateFromAdv", "dtRouteSheetDateToAdv");
    }
    function DateActionsRSDateAdvSearch_His() {
        DynamicDateActions("cboRSDateAdvS_His", "dtRouteSheetDateFromAdv_His", "dtRouteSheetDateToAdv_His");
        var dtEventTime =new Date(_oRouteSheetSetup.BatchTime);
        dtEventTime = icsdateformat(new Date())+" "+ _oRouteSheetSetup.BatchTimeTT;
        $('#dtRouteSheetDateFromAdv_His').datetimebox('setValue',dtEventTime);
        $('#dtRouteSheetDateToAdv_His').datetimebox('setValue',dtEventTime);
    }

    //function GetOrderStatus(){

    //    var sOrderStatus="";

    //    var oOrderStatus=$('#tblRSStatus').datagrid('getChecked');

    //    if(oOrderStatus.length>0){
    //        for(var i=0;i<oOrderStatus.length;i++){
    //            sOrderStatus= sOrderStatus + oOrderStatus[i].Value+","
    //        }
    //        sOrderStatus=sOrderStatus.substring(0,sOrderStatus.length-1);
    //    }
    //    return sOrderStatus;
    //}

    $("#btnAdvSearch").click(function (e) {
        ResetAdvSearchPicker();
        $("#winAdvSearch").icsWindow("open", "Adv Search");
    });
    $("#btnCloseAdvSearch").click(function (e) {
        $("#winAdvSearch").icsWindow("close");
    });

    $("#btnSearchAdvSearch").click(function (e) {

        _nReportType=1;
        $(".lblLoadingMessage").show();
        var sRSNo = "";
        var sOrderNo = "";
        var sRSStatus="";
        var oRSStatus=$('#tblRSStatus').datagrid('getChecked');

        if(oRSStatus.length>0){
            for(var i=0;i<oRSStatus.length;i++){
                sRSStatus= sRSStatus + oRSStatus[i].id+","
            }
            sRSStatus=sRSStatus.substring(0,sRSStatus.length-1);
        }
        debugger;

        var dRouteSheetDateFromAdv =$('#dtRouteSheetDateFromAdv_His').datebox('getValue');
        var startTime= $('#tpRouteSheetDateFromAdv_His').timespinner('getValue');
        var sTime=startTime.split(':');
        var hStartTime= parseFloat(sTime[0]);
        var mStartTime= parseFloat(sTime[1]);
        if(isNaN(hStartTime))
        {
            hStartTime="00";
            mStartTime="00";
        }
        dRouteSheetDateFromAdv=dRouteSheetDateFromAdv+" "+hStartTime+":"+mStartTime;

        var dRouteSheetDateToAdv =$('#dtRouteSheetDateToAdv_His').datebox('getValue');
        startTime= $('#tpRouteSheetDateToAdv_His').timespinner('getValue');
        sTime=startTime.split(':');
        hStartTime= parseFloat(sTime[0]);
        mStartTime= parseFloat(sTime[1]);
        //dRouteSheetDateToAdv = new Date(dRouteSheetDateToAdv);
        if(isNaN(hStartTime))
        {
            hStartTime="00";
            mStartTime="00";
        }
        dRouteSheetDateToAdv=dRouteSheetDateToAdv+" "+hStartTime+":"+mStartTime;
        debugger;
        var dQCdateFromAdv =$('#dtQCdateFromAdv').datebox('getValue');
        startTime= $('#tpQCdateFromAdv').timespinner('getValue');
        sTime=startTime.split(':');
        hStartTime= parseFloat(sTime[0]);
        mStartTime= parseFloat(sTime[1]);
        
        if(isNaN(hStartTime))
        {
            hStartTime="00";
            mStartTime="00";
        }
        dQCdateFromAdv=dQCdateFromAdv+" "+hStartTime+":"+mStartTime;

        var dQCdateToAdv =$('#dtQCdateToAdv').datebox('getValue');
        startTime= $('#tpQCdateToAdv').timespinner('getValue');
        sTime=startTime.split(':');
        hStartTime= parseFloat(sTime[0]);
        mStartTime= parseFloat(sTime[1]);
        if(isNaN(hStartTime))
        {
            hStartTime="00";
            mStartTime="00";
        }
        dQCdateToAdv=dQCdateToAdv+" "+hStartTime+":"+mStartTime;

        var sTempString =
            +parseInt($("#cboRSDateAdvS").val())+ '~'
            + $('#dtRouteSheetDateFromAdv').datebox('getValue')+'~'
            + $('#dtRouteSheetDateToAdv').datebox('getValue')+'~'
            +_sMachineIDs +'~'
            + _sContractorIDs + '~'
            +_sProductIds + '~'
            +parseInt($("#cboOrderType").val()) + '~'
            + _sDODIDs +'~'
            + sRSStatus+'~'
        + sRSNo+'~'
        + sOrderNo+'~'
        + parseInt($("#cboRSDateAdvS_His").val())+'~'
        + dRouteSheetDateFromAdv+'~'
        + dRouteSheetDateToAdv+'~'
        + parseInt($("#cboQCdate").val())+'~'
        + dQCdateFromAdv+'~'
        + dQCdateToAdv+'~'
         + parseInt($("#cboRSSubState_Adv").val())+'~'
        + parseInt($("#cboDUDyeingType").val())+'~'
        +parseInt($("#cboRSShift").val())+    '~'
        + $('#chkIsReDyeing').prop('checked')+'~'
        + $("#txtPI").data("PIID") +'~';
       
        sessionStorage.setItem("ParamsP", sTempString);
        debugger;
        var oRSFreshDyedYarn = {
            ErrorMessage: sTempString,
            ReportType:_nReportType
        }
        Search(oRSFreshDyedYarn);
    });
    function Search(oRSFreshDyedYarn)
    {
        $("#progressbar").progressbar({ value: 0 });
        $("#progressbarParent").show();
        var intervalID = setInterval(updateProgress, 250);
        $.ajax({
            type: "POST",
            dataType: "json",
            url: _sBaseAddress + "/RSFreshDyedYarn/AdvSearch_RSPackingQC",
            traditional: true,
            data: JSON.stringify(oRSFreshDyedYarn),
            contentType: "application/json; charset=utf-8",
            success: function (data) {
                debugger;
                var oRSFreshDyedYarns = data;
                debugger;
                if (oRSFreshDyedYarns != null)
                {
                    if (oRSFreshDyedYarns.length > 0)
                    {
                        if(_nReportType==1)
                        {
                            DynamicRefreshList(oRSFreshDyedYarns, "tblRSWise");
                           
                        }
                        else  if(_nReportType==2)
                        {
                            DynamicRefreshList(oRSFreshDyedYarns, "tblRS_Product");
                        }
                        RefreshSummary(_nReportType);
                    }
                    else
                    {
                        alert("Sorry, No data found.");
                        DynamicRefreshList([], "tblRSWise");
                        DynamicRefreshList([], "tblRS_Product");
                    }

                } 
                else {
                    alert("Sorry, No data found.");
                    DynamicRefreshList([], "tblRSWise");
                    DynamicRefreshList([], "tblRS_Product");
                }
                clearInterval(intervalID);
                $("#progressbarParent").hide();
                $(".lblLoadingMessage").hide();
                    $("#winAdvSearch").icsWindow("close");
                    $(".lblLoadingMessage").hide();
                //var oResult = data;
                //if(oResult.length<=0){
                //    alert("No data found");
                //}
                //else{
                //    $('#tblRSWise').data('FDPs',oResult)
                //    DynamicRefreshList(oResult,'tblRSWise');
                //    $.icsMakeFooterColumn('tblRSWise',['ColorName','Qty_RS','FreshDyedYarnQty','BagCount','RecycleQty','WastageQty','ManagedQty','TotalShort']);
                //    $("#winAdvSearch").icsWindow("close");
                //    $(".lblLoadingMessage").hide();
                //}
            }
        });
    }
    function GetsRouteSheet(oRouteSheet, bIsAdvSearch)
    {
        var obj =
        {
            BaseAddress: _sBaseAddress,
            Object: oRouteSheet,
            ControllerName: "RSFreshDyedYarn",
            ActionName: "AdvSearch_RSFDYarn",
            IsWinClose: bIsAdvSearch
        };

        $(".lblLoadingMessage").show();
        $.icsMaxDataGets(obj, function (response) {

            if (response.status && response.objs != null) {
                //if(bIsAdvSearch){
                //    ResetAdvSearchPicker();
                //    $("#winAdvSearch").icsWindow("close");
                //}
                if (response.objs.length > 0)
                {
                    if(response.objs[0].RouteSheetID>0)
                    {
                        _oRouteSheets=response.objs;
                        DynamicRefreshList(response.objs, "tblRSWise");
                        $(".lblLoadingMessage").hide();
                    }
                    else
                    {
                        DynamicRefreshList([], "tblRSWise"); alert(response.objs[0].ErrorMessage);
                        $(".lblLoadingMessage").hide();
                    }
                }
                else
                {
                    DynamicRefreshList([], "tblRSWise"); alert("No Dyeing Card/Batch found.");
                    $(".lblLoadingMessage").hide();
                }
            }
        });
    }

    /* =============== PICKER 4 ADV SEARCH ==============*/

    /*-------------Pick Pro------*/
    //Product Pick
    $("#txtProductName").keydown(function (e) {
        debugger;
        var code = (e.keyCode ? e.keyCode : e.which);
        if (code == 13) // Enter Press
        {
            if($('#txtProductName').val()==null || $('#txtProductName').val()=="")
            {
                alert("Please Type Product and Press Enter.");
                $('#txtProductName').focus();
                return;
            }
            PickProduct($('#txtProductName').val());
        }
        if (code == 8) //backspace=8
        {
            //debugger;
            $("#txtProductName").removeClass("fontColorOfPickItem");
            _sProductIds= "";
        }
    });
    $("#btnProductPiker").click(function () {

        if($('#txtProductName').val()==null || $('#txtProductName').val()=="")
        {
            alert("Please Type Product and Press Enter.");
            $('#txtProductName').focus();
            return;
        }
        PickProduct($('#txtProductName').val());
    });
    $("#btnClrProductPiker").click(function () {
        $("#txtProductName").val('');
        $("#txtProductName").removeClass("fontColorOfPickItem");
        _sProductIds= [];
    });
    function PickProduct(sProductName)
    {
        var oProduct = { BUID:sessionStorage.getItem("BUID"),ProductName:sProductName};

        var obj = {
            BaseAddress: _sBaseAddress,
            Object: oProduct,
            ControllerName: "Product",
            ActionName: "SearchByProductBUWise",
            IsWinClose: false
        };
        $("#progressbar").progressbar({ value: 0 });
        $("#progressbarParent").show();
        var intervalID = setInterval(updateProgress, 250);
        $.icsDataGets(obj, function (response) {
            clearInterval(intervalID);
            $("#progressbarParent").hide();
            if (response.status && response.objs.length > 0) {
                if (response.objs[0].ProductID > 0) {
                    var tblColums = [];
                    var oColumn = { field: "ProductCode", title: "Code", width: 100, align: "left" }; tblColums.push(oColumn);
                    oColumn = { field: "ProductName", title: "Name", width: 300, align: "left" }; tblColums.push(oColumn);
                    oColumn = { field: "MUnit", title: "Unit", width: 70, align: "left" }; tblColums.push(oColumn);
                    var oPickerParam = {
                        winid: 'winProductPicker',
                        winclass: 'clsProductPicker',
                        winwidth: 600,
                        winheight: 460,
                        tableid: 'tblProductPicker',
                        tablecolumns: tblColums,
                        datalist: response.objs,
                        multiplereturn: true,
                        searchingbyfieldName: 'NameCode',
                        windowTittle: 'Product List'
                    };
                    $.icsPicker(oPickerParam);
                    IntializePickerbutton(oPickerParam);
                }
                else {
                    alert(response.objs[0].ErrorMessage);
                }

            }else{
                alert("Data Not Found.");
            }
        });
    }
    /*..........Pick Order ............. */

    $("#btnPickOrderNo").click(function () {
        debugger;
        if (parseInt($("#cboOrderType").val())<=0 ) {

            alert("Please Select Order Type.");
            $('#cboOrderType').focus();
            $('#cboOrderType').addClass("errorFieldBorder");
            return;
        }
        else{
            $('#cboOrderType').removeClass("errorFieldBorder");
        }

        var oPSDetail = {
            OrderType:$('#cboOrderType').val(),
            OrderNo:$('#txtOrderNo').val(),
            LabDipDetailID:0,
            ContractorName:_sContractorIDs
        };

        GetOrders(oPSDetail);
    });
    $("#txtOrderNoAdv").keydown(function (e) {
        var nkeyCode = e.keyCode || e.which;
        if(nkeyCode==13){
            var sorderNo=$.trim($("#txtOrderNoAdv").val());
            if (parseInt($("#cboOrderType").val())<=0 ) {

                alert("Please Select Order Type.");
                $('#cboOrderType').focus();
                $('#cboOrderType').addClass("errorFieldBorder");
                return;
            }
            else{
                $('#cboOrderType').removeClass("errorFieldBorder");
            }

            var oPSDetail = {
                OrderType:$('#cboOrderType').val(),
                OrderNo:$('#txtOrderNoAdv').val(),
                LabDipDetailID:0
            };
            GetOrders(oPSDetail);
        }
        else if(nkeyCode==8){
            $("#txtOrderNoAdv").val("");

        }
    });
    function GetOrders(oPSDetail){

        var obj = {
            BaseAddress: _sBaseAddress,
            Object: oPSDetail,
            ControllerName: "DUPSchedule",
            ActionName: "GetsDyeingOrder",
            IsWinClose: false
        };
        $("#progressbar").progressbar({ value: 0 });
        $("#progressbarParent").show();
        var intervalID = setInterval(updateProgress, 250);
        $.icsDataGets(obj, function (response) {
            clearInterval(intervalID);
            $("#progressbarParent").hide();
            if (response.status && response.objs.length > 0) {
                if (response.objs[0].DODID > 0) {
                    debugger;
                    var tblColums = [];

                    var oColumn = { field: "OrderNo", title: "OrderNo", width: 100, align: "left" };tblColums.push(oColumn);

                    oColumn = { field: "OrderQty", title: "OrderQty", width: 75, align: "right",formatter:formatPrice };tblColums.push(oColumn);
                    oColumn = { field: "Qty_Pro", title: "Prod Qty", width: 75, align: "right",formatter:formatPrice };tblColums.push(oColumn);
                    oColumn = { field: "Qty_RS", title: "Yet To Pro", width: 75, align: "right" };tblColums.push(oColumn);
                    oColumn = { field: "ProductName", title: "Yarn", width: 225, align: "left" };tblColums.push(oColumn);
                    oColumn = { field: "ColorName", title: "ColorName", width: 100, align: "left" };tblColums.push(oColumn);
                    oColumn = { field: "ShadeSt", title: "Shade", width: 40, align: "left" };tblColums.push(oColumn);
                    oColumn = { field: "ColorNo", title: "ColorNo", width: 80, align: "left" };tblColums.push(oColumn);
                    oColumn = { field: "LabdipNo", title: "LabdipNo", width: 100, align: "left" };tblColums.push(oColumn);
                    oColumn = { field: "OrderTypeSt", title: "OrderType", width: 100, align: "left" };tblColums.push(oColumn);
                    var oPickerParam = {
                        winid: 'winOrderPicker',
                        winclass:'clsOrderPicker',
                        winwidth: 1000,
                        winheight: 660,
                        tableid: 'tblOrderPicker',
                        tablecolumns: tblColums,
                        datalist: response.objs,
                        multiplereturn: true,
                        searchingbyfieldName:'ColorName',
                        windowTittle: 'Color List'
                    };
                    $.icsPicker(oPickerParam);
                    IntializePickerbutton(oPickerParam);//multiplereturn, winclassName
                }
                else { alert(response.objs[0].ErrorMessage); }
            }
            else{
                alert("No order found.");
            }
        });

    }

    $('#btnPrintCard').click(function(){

        var oRouteSheet = $('#tblRouteSheet').datagrid('getSelected');
        if (oRouteSheet ==null || oRouteSheet.RouteSheetID <=0 ) { alert("Please select an item from list."); return ; }
        var tsv=((new Date()).getTime())/1000;
        window.open(_sBaseAddress+ "/RouteSheet/PrintCard?nId="+oRouteSheet.RouteSheetID+"&buid="+_nBUID, "_blank");
    });
    $("#btnResetOrder").click(function () {
        $('#txtOrderNoAdv').val("");
        _sDODIDs="";
    });


    /*..........Contractor Pick ............. */
    $("#btnResetBuyer").click(function () {
        $("#txtBuyer").val("");
        _sContractorIDs="";
    });
    $("#btnPickBuyer").click(function () {

        var sContractorName=$.trim($("#txtBuyer").val());
        GetContractors(sContractorName);
    });
    $("#txtBuyer").keydown(function (e) {
        var nkeyCode = e.keyCode || e.which;
        if(nkeyCode==13){
            var sContractorName=$.trim($("#txtBuyer").val());
            GetContractors(sContractorName);
        }
        else if(nkeyCode==8){
            $("#txtBuyer").val("");
            _sContractorIDs=0;
        }
    });

    function GetContractors(sContractorName){

        var oContractor = {
            Params: '2,3' +'~'+sContractorName+'~'+sessionStorage.getItem("BUID"),
        };
        var obj = {
            BaseAddress: _sBaseAddress,
            Object: oContractor,
            ControllerName: "Contractor",
            ActionName: "ContractorSearchByNameType",
            IsWinClose: false
        };
        $("#progressbar").progressbar({ value: 0 });
        $("#progressbarParent").show();
        var intervalID = setInterval(updateProgress, 250);

        $.icsDataGets(obj, function (response) {
            clearInterval(intervalID);
            $("#progressbarParent").hide();
            if (response.status && response.objs.length > 0) {
                if (response.objs[0].ContractorID > 0) {
                    debugger;
                    var tblColums = [];
                    var oColumn = { field: "ContractorID", title: "Code", width: 50, align: "center" };tblColums.push(oColumn);
                    oColumn = { field: "Name", title: "Name", width: 190, align: "left" };tblColums.push(oColumn);
                    oColumn = { field: "Phone", title: "Phone", width: 140, align: "left" };tblColums.push(oColumn);
                    var oPickerParam = {
                        winid: 'winContractorPicker',
                        winclass:'clsContractorPicker',
                        winwidth: 460,
                        winheight: 460,
                        tableid: 'tblContractorPicker',
                        tablecolumns: tblColums,
                        datalist: response.objs,
                        multiplereturn: true,
                        searchingbyfieldName:'Name',
                        windowTittle: 'Contractor List'
                    };
                    $.icsPicker(oPickerParam);
                    IntializePickerbutton(oPickerParam);//multiplereturn, winclassName
                }
                else { alert(response.objs[0].ErrorMessage); }
            }
            else{
                alert("No contractor found.");
            }
        });


    }

    /*..........PI Pick ............. */
    $("#btnResetPI").click(function () {
        $("#txtPI").val("");
        $("#txtPI").data("PIID","");
    });
    $("#btnPickPI").click(function () {
        var sPINo=$.trim($("#txtPI").val());
        GetPIs(sPINo);
    });
    $("#txtPI").keydown(function (e) {
        var nkeyCode = e.keyCode || e.which;
        if(nkeyCode==13){
            var sPINo=$.trim($("#txtPI").val());
            GetPIs(sPINo);
        }
        else if(nkeyCode==8){
            $("#txtPI").val("");
            $("#txtPI").data("PIID","");
            
        }
    });

    function GetPIs(sPINo){

        

        var oExportPI = {
            BUID: sessionStorage.getItem("BUID"),
            PINo: sPINo
        };
        var obj = {
            BaseAddress: _sBaseAddress,
            Object: oExportPI,
            ControllerName: "ExportPI",
            ActionName: "GetsBySearchKey",
            IsWinClose: false
        };
        $("#progressbar").progressbar({ value: 0 });
        $("#progressbarParent").show();
        var intervalID = setInterval(updateProgress, 250);

        $.icsDataGets(obj, function (response) {
            clearInterval(intervalID);
            $("#progressbarParent").hide();
            if (response.status && response.objs.length > 0) {
                if (response.objs[0].ExportPIID > 0) {
                    debugger;
                    var tblColums = [];
                    var oColumn = { field: "PINo", title: "PI No", width: 200, align: "left" };tblColums.push(oColumn);
                    oColumn = { field: "PIStatusSt", title: "Status", width: 150, align: "left" };tblColums.push(oColumn);
                    //oColumn = { field: "Phone", title: "Phone", width: 140, align: "left" };tblColums.push(oColumn);
                    var oPickerParam = {
                        winid: 'winPIPicker',
                        winclass:'clsPIPicker',
                        winwidth: 460,
                        winheight: 460,
                        tableid: 'tblPIPicker',
                        tablecolumns: tblColums,
                        datalist: response.objs,
                        multiplereturn: true,
                        searchingbyfieldName:'PINo',
                        windowTittle: 'PI List'
                    };
                    $.icsPicker(oPickerParam);
                    IntializePickerbutton(oPickerParam);//multiplereturn, winclassName
                }
                else { alert(response.objs[0].ErrorMessage); }
            }
            else{
                alert("No contractor found.");
            }
        });


    }

    /*---------------- Machine Pick --------------*/

    $("#btnResetMachine").click(function () {

        $("#txtMachine").val("");
        _sMachineIDs="";
    });

    $("#btnPickMachine").click(function () {

        var sMachineName=$.trim($("#txtMachine").val());
        if(sMachineName==""){ alert("Type machine name to search."); return false; }
        GetMachines(sMachineName);
    });

    $("#txtMachine").keydown(function (e) {
        var nkeyCode = e.keyCode || e.which;
        if(nkeyCode==13){
            var sMachineName=$.trim($("#txtMachine").val());
            if(sMachineName==""){ alert("Type machine name to search."); return false; }
            GetMachines(sMachineName);
        }
        else if(nkeyCode==8){
            $("#txtMachine").val("");
            _sMachineIDs="";
        }
    });

    function GetMachines(sMachineName){

        var oCapitalResource = {
            BUID:sessionStorage.getItem("BUID"),
            ResourcesTypeInInt:2,
            Name:sMachineName
        };
        var obj = {
            BaseAddress: _sBaseAddress,
            Object: oCapitalResource,
            ControllerName: "CapitalResource",
            ActionName: "GetsCapitalResourceLastLayer",
            IsWinClose: false
        };
        $("#progressbar").progressbar({ value: 0 });
        $("#progressbarParent").show();
        var intervalID = setInterval(updateProgress, 250);
        $.icsDataGets(obj, function (response) {
            clearInterval(intervalID);
            $("#progressbarParent").hide();
            if (response.status && response.objs.length > 0) {
                if (response.objs[0].CRID > 0) {
                    debugger;
                    var tblColums = [];
                    var oColumn = { field: "Name", title: "Machine Name", width: 130, align: "left" };tblColums.push(oColumn);
                    oColumn = { field: "MachineCapacity", title: "Capacity", width: 90, align: "left" };tblColums.push(oColumn);
                    oColumn = { field: "OperationUnitName", title: "Store", width: 185, align: "left" };tblColums.push(oColumn);

                    var oPickerParam = {
                        winid: 'winMachinePicker',
                        winclass:'clsMachinePicker',
                        winwidth: 500,
                        winheight: 460,
                        tableid: 'tblMachinePicker',
                        tablecolumns: tblColums,
                        datalist: response.objs,
                        multiplereturn: true,
                        searchingbyfieldName:'Name',
                        windowTittle: 'Machine List'
                    };
                    $.icsPicker(oPickerParam);
                    IntializePickerbutton(oPickerParam);//multiplereturn, winclassName
                }
                else { alert(response.objs[0].ErrorMessage); }
            }
            else{
                alert("No machine found.");
            }
        });


    }



    function IntializePickerbutton(oPickerobj) {
        $("#" + oPickerobj.winid).find("#btnOk").click(function () {
            SetPickerValueAssign(oPickerobj);
        });
        $(document).find('.' + oPickerobj.winclass).keydown(function (e) {
            if (e.which === 13) {
                SetPickerValueAssign(oPickerobj);
            }
        });
    }

    function SetPickerValueAssign(oPickerobj) {
        var oreturnObj = null, oreturnObjs = [];
        if (oPickerobj.multiplereturn) {
            oreturnObjs = $('#' + oPickerobj.tableid).datagrid('getChecked');
        } else {
            oreturnObj = $('#' + oPickerobj.tableid).datagrid('getSelected');
        }

        if (oPickerobj.winid == 'winContractorPicker')
        {
            if (oreturnObjs != null && oreturnObjs.length> 0)
            {

                _sContractorIDs=''; var sMessage='';
                sMessage=(oreturnObjs.length>1)? oreturnObjs.length +" Buyers Selected" : oreturnObjs[0].Name;
                $('#txtBuyer').val(sMessage);
                $("#txtBuyer").addClass("fontColorOfPickItem");

                for(var i=0;i<oreturnObjs.length;i++){
                    _sContractorIDs=_sContractorIDs+oreturnObjs[i].ContractorID+',';
                }
                _sContractorIDs=_sContractorIDs.substring(0,_sContractorIDs.length-1);

            }
            else
            {
                alert("Please select a contractor.");
                return false;
            }
        }

        else if (oPickerobj.winid == 'winBuyers') {
            if (oreturnObjs != null && oreturnObjs.length> 0)
            {
                _sDeliverToIDs='';
                var sMessage='';
                sMessage=(oreturnObjs.length>1)? oreturnObjs.length +" Contractors Selected" : oreturnObjs[0].Name;
                $('#txtDeliverToAdvS').val(sMessage);
                $("#txtDeliverToAdvS").addClass("fontColorOfPickItem");

                for(var i=0;i<oreturnObjs.length;i++){
                    _sDeliverToIDs=_sDeliverToIDs+oreturnObjs[i].ContractorID+',';
                }
                _sDeliverToIDs=_sDeliverToIDs.substring(0,_sDeliverToIDs.length-1);
            }
            else
            {
                alert("Please select a buyer.");
                return false;
            }
        }
        else if (oPickerobj.winid == 'winProductPicker')
        {
            if (oreturnObjs!= null && oreturnObjs.length> 0)
            {
                _sProductIds=''; var sMessage='';
                sMessage=(oreturnObjs.length>1)? oreturnObjs.length +" ProductName Selected" : oreturnObjs[0].ProductName;
                $('#txtProductName').val(sMessage);
                $("#txtProductName").addClass("fontColorOfPickItem");

                for(var i=0;i<oreturnObjs.length;i++){
                    _sProductIds=_sProductIds+oreturnObjs[i].ProductID+',';
                }
                _sProductIds=_sProductIds.substring(0,_sProductIds.length-1);

            }
            else
            {
                alert("Please select a Product.");
                return false;
            }

        }
        else  if (oPickerobj.winid == 'winMachinePicker')
        {
            if (oreturnObjs!= null && oreturnObjs.length> 0)
            {
                _sMachineIDs=''; var sMessage='';
                sMessage=(oreturnObjs.length>1)? oreturnObjs.length +" Machine Selected" : oreturnObjs[0].Name;
                $('#txtMachine').val(sMessage);
                $("#txtMachine").addClass("fontColorOfPickItem");

                for(var i=0;i<oreturnObjs.length;i++){
                    _sMachineIDs=_sMachineIDs+oreturnObjs[i].CRID+',';
                }
                _sMachineIDs=_sMachineIDs.substring(0,_sMachineIDs.length-1);
            }
            else
            {
                alert("Please select a Machine.");
                return false;
            }
        }
        else  if (oPickerobj.winid == 'winOrderPicker')
        {
            if (oreturnObjs!= null && oreturnObjs.length> 0)
            {
                _sDODIDs=''; var sMessage='';
                sMessage=(oreturnObjs.length>1)? oreturnObjs.length +" Order Selected" : oreturnObjs[0].OrderNo;
                $('#txtOrderNoAdv').val(sMessage);
                $("#txtOrderNoAdv").addClass("fontColorOfPickItem");

                for(var i=0;i<oreturnObjs.length;i++){
                    _sDODIDs=_sDODIDs+oreturnObjs[i].DODID+',';
                }
                _sDODIDs=_sDODIDs.substring(0,_sDODIDs.length-1);
            }
            else
            {
                alert("Please select a order.");
                return false;
            }
        }
        else if(oPickerobj.winid == 'winPIPicker'){
            if (oreturnObjs!= null && oreturnObjs.length> 0)
            {
                var sPIIDs=''; var sMessage='';
                sMessage=(oreturnObjs.length>1)? oreturnObjs.length +" PI Selected" : oreturnObjs[0].PINo;
                $('#txtPI').val(sMessage);
                $("#txtPI").addClass("fontColorOfPickItem");

                for(var i=0;i<oreturnObjs.length;i++){
                    sPIIDs=sPIIDs+oreturnObjs[i].ExportPIID+',';
                }
                sPIIDs=sPIIDs.substring(0,sPIIDs.length-1);
                $("#txtPI").data("PIID",sPIIDs);
            }
            else
            {
                alert("Please select PI.");
                return false;
            }
        }
        $("#" + oPickerobj.winid).icsWindow("close");
        $("#" + oPickerobj.winid).remove();
    }

    /*------------------------------------*/



    /* ===================== END =======================*/

    function FormatStyleTwo(value,row,index){

        var sReturn = "";
        if(row.ProductID > 0)
        {
            sReturn = '<label id="lblDetail~'+index+'" style="color:Blue;cursor:pointer;text-decoration:underline;" onclick="ShowDetail('+row.ProductID+')">'+value+'</label>';
        }
        else
        {
            sReturn = '<label>'+value+'</label>';
        }
        return sReturn;

        //var values=value.split("~");
        //var nRSCount = values[0];
        //var nProductID = values[1];

        //var s = '<label id="lblOpening~'+nProductID+'" style="color:Blue;cursor:pointer" class="lblOpening'+nProductID+'" onclick="ShowDetail('+nProductID+')">'+nRSCount+'</label>';
        //return s;
    }
    function ShowDetail(nProductID)
    {


        var ncboDateSearch = parseInt($("#cboDateSearch").val());
        var dStartDate = $('#txtStartDate').datebox('getValue');
        var dEndDate= $('#txtEndDate').datebox('getValue');
        var nOrderType = parseInt($("#cboOrderType").val());
        _nReportType =1;
        var sParams =
                     ncboDateSearch + "~" +
                     dStartDate + "~" +
                     dEndDate + "~" +
                     nOrderType + "~" +
                     _nReportType
        sessionStorage.setItem("ParamsInvPro", sParams);
        var sParams=sessionStorage.getItem("ParamsInvPro");
        window.open(_sBaseAddress + '/RSFreshDyedYarn/PrintRpt_PreviewProductDetail?sTempString=' + sParams+"&ProductID="+ nProductID, "_blank");
    }

    ////First Tab
    $('#btnView').click(function (e)
    {
        var oRouteSheet = $('#tblRSWise').datagrid('getSelected');
        if (oRouteSheet ==null || oRouteSheet.RouteSheetID <=0 ) { alert("Please select an item from list."); return ; }
        var nIndex=$('#tblRSWise').datagrid('getRowIndex',oRouteSheet);
        //sessionStorage.clear();
        sessionStorage.setItem("Operation", "View");
        sessionStorage.setItem("SelectedRowIndex", nIndex);
        sessionStorage.setItem("RouteSheetHeader", "View Production");
        sessionStorage.setItem("RouteSheets", JSON.stringify($('#tblRSWise').datagrid('getRows')));
        sessionStorage.setItem("BackLink", window.location.href);
        var tsv=((new Date()).getTime())/1000;
        window.location.href = _sBaseAddress+ "/RouteSheet/ViewRouteSheet?nId="+oRouteSheet.RouteSheetID+"&ts="+tsv;;
    });

    $('#btnPrint').click(function (e)
    {
        var oRouteSheet = $('#tblRSWise').datagrid('getSelected');
        if (oRouteSheet ==null || oRouteSheet.RouteSheetID <=0 ) { alert("Please select an item from list."); return ; }
        var tsv=((new Date()).getTime())/1000;
        window.open(_sBaseAddress+ "/RouteSheet/PrintRouteSheet?nId="+oRouteSheet.RouteSheetID+"&bIsCommon="+$("#chkIsCommon").is(":checked")+"&nts="+tsv, "_blank");

    });

    function RefreshSummary(nPeportType)
    {
        if(nPeportType==1)
        {
            var oRows = $('#tblRSWise').datagrid('getRows');
        }
        else
        {
            var oRows = $('#tblRS_Product').datagrid('getRows');
        }
        if(oRows.length>0)
        {
            var nQty_RS = 0,nFreshDyedYarnQty=0,nBagCount=0,nUnManagedQty=0,nManagedQty=0,nGain=0,nLoss=0,nRecycleQty=0 ,nWastageQty=0,nWIPQty=0,nPackingQty=0,nLossPer=0,nTotalShort=0,nWIPQtyTwo=0;
            for(var i=0;i<oRows.length;i++)
            {
                nQty_RS = parseFloat(nQty_RS)+parseFloat(oRows[i].Qty_RS);
                nFreshDyedYarnQty = parseFloat(nFreshDyedYarnQty)+parseFloat(oRows[i].FreshDyedYarnQty);
                nBagCount = parseFloat(nBagCount)+parseFloat(oRows[i].BagCount);
                nUnManagedQty = parseFloat(nUnManagedQty)+parseFloat(oRows[i].UnManagedQty);
                nManagedQty = parseFloat(nManagedQty)+parseFloat(oRows[i].ManagedQty);
                nGain = parseFloat(nGain)+parseFloat(oRows[i].Gain);
                nLoss = parseFloat(nLoss)+parseFloat(oRows[i].Loss);
                nGainPer = parseFloat(nGain)+parseFloat(oRows[i].GainPer);
                nLossPer = parseFloat(nLossPer)+parseFloat(oRows[i].LossPer);

                nRecycleQty = parseFloat(nRecycleQty)+parseFloat(oRows[i].RecycleQty);
                nWastageQty = parseFloat(nWastageQty)+parseFloat(oRows[i].WastageQty);
                nPackingQty= parseFloat(nPackingQty)+parseFloat(oRows[i].PackingQty);
                nTotalShort= parseFloat(nTotalShort)+parseFloat(oRows[i].TotalShort);
                nWIPQty= parseFloat(nWIPQty)+parseFloat(oRows[i].WIPQty);
                nWIPQtyTwo=parseFloat(nWIPQtyTwo)+parseFloat(oRows[i].WIPQtyTwo);
            }

            nQty_RS = parseFloat(nQty_RS).toFixed(2);
            nFreshDyedYarnQty = parseFloat(nFreshDyedYarnQty).toFixed(2);
            nBagCount = parseFloat(nBagCount).toFixed(2);
            nUnManagedQty = parseFloat(nUnManagedQty).toFixed(2);
            nManagedQty = parseFloat(nManagedQty).toFixed(2);
            nGain = parseFloat(nGain).toFixed(2);
            nLoss = parseFloat(nLoss).toFixed(2);
            nGainPer = parseFloat(nGainPer).toFixed(2);
            nLossPer = parseFloat(nLossPer).toFixed(2);
            nRecycleQty = parseFloat(nRecycleQty).toFixed(2);
            nWastageQty = parseFloat(nWastageQty).toFixed(2);
            nWIPQty = parseFloat(nWIPQty).toFixed(2);
            nPackingQty=parseFloat(nPackingQty).toFixed(2);
            nWIPQtyTwo=parseFloat(nWIPQtyTwo).toFixed(2);

            debugger
            var oRow =
            {
                ProductName : 'Total',
                Qty_RS:nQty_RS,
                FreshDyedYarnQty:nFreshDyedYarnQty,
                PackingQty:nPackingQty,
                BagCount:nBagCount,
                UnManagedQty:nUnManagedQty,
                ManagedQty:nManagedQty,
                Gain:nGain,
                Loss:nLoss,
                GainPer:nGainPer,
                LossPer:nLossPer,
                RecycleQty:nRecycleQty,
                WastageQty:nWastageQty,
                WIPQty:nWIPQty,
                TotalShort:nTotalShort,
                WIPQtyTwo:nWIPQtyTwo
            }
            if(nPeportType==1)
            {
                $('#tblRSWise').datagrid('appendRow',oRow);
            }
            else
            {
                $('#tblRS_Product').datagrid('appendRow',oRow);
            }

        }

    }

     //Nazmul 11/09/2019
    $("#btnProductListPreview").click(function () {
        //var nBuyerID = parseInt(_sDeliverToIDs);
        nOrderType=0;
        var ncboDateSearch = parseInt($("#cboDateSearch").val());
        if(ncboDateSearch == 0){
            alert("Please select Date!!");
            $("#cboDateSearch").focus()
            return;
        }
        _nReportType =2;
        _sMachineIDs="";
        _sContractorIDs="";
        _sProductIds="";
        _sDODIDs="";
        var sRSStatus="";
        var sRSNo="";
        var sOrderNo="";

        debugger;
        var dQCdateFromAdv =$('#txtStartDate').datebox('getValue');
        //var startTime= $('#txtStartDate').timespinner('getValue');
        startTime ="08:00";
        sTime=startTime.split(':');
        hStartTime= parseFloat(sTime[0]);
        mStartTime= parseFloat(sTime[1]);
        
        if(isNaN(hStartTime))
        {
            hStartTime="00";
            mStartTime="00";
        }
        dQCdateFromAdv=dQCdateFromAdv+" "+hStartTime+":"+mStartTime;

        var dQCdateToAdv =$('#txtEndDate').datebox('getValue');
        //startTime= $('#txtEndDate').timespinner('getValue');
        startTime ="08:00";
        sTime=startTime.split(':');
        hStartTime= parseFloat(sTime[0]);
        mStartTime= parseFloat(sTime[1]);
        if(isNaN(hStartTime))
        {
            hStartTime="00";
            mStartTime="00";
        }
        dQCdateToAdv=dQCdateToAdv+" "+hStartTime+":"+mStartTime;

        var sTempString =
            +0+ '~'
            + icsdateformat(new Date())+'~'
            + icsdateformat(new Date())+'~'
            +_sMachineIDs +'~'
            + _sContractorIDs + '~'
            +_sProductIds + '~'
            +parseInt($("#cboOrderType").val()) + '~'
            + _sDODIDs +'~'
            + sRSStatus+'~'
        + sRSNo+'~'
        + sOrderNo+'~'
        + 0+'~'
        + icsdateformat(new Date())+'~'
        + icsdateformat(new Date())+'~'
        + parseInt($("#cboDateSearch").val())+'~'
        + dQCdateFromAdv+'~'
        + dQCdateToAdv+'~'
        + 0+'~'
        + 0+'~'
        +0+    '~'
        + 0+'~';      
        sessionStorage.setItem("ParamsP", sTempString);     
        window.open(_sBaseAddress + '/RSFreshDyedYarn/ProductListPreview?sTempString='+sTempString+"&nRpoertType="+_nReportType, "_blank");       
    });
   
</script>


