<html>
@{
    ViewBag.Title = "Export LC Registers";
}
<body>
    @model ESimSol.BusinessObjects.ExportLCRegister
    <div id="progbarParent" style="width:100%;height:100%;margin:0 auto;text-align:center; margin-left: auto;margin-right: auto;left: 0;right: 0;z-index: 1;">
        <div style="margin: 0px auto;margin-top: 251px;text-align:center;width:390px;">
            <label style="font-size:18px;">Please wait</label>
            <div id="progbar" style="width:100%;height:37px;"></div>
        </div>
    </div>
    <div class="menuMainCollectionTable">
        <div class="easyui-panel" title="Import LC Registers" style="font-family:Tahoma; text-align:center; width:100%; height:89.5%;">
            <fieldset style="margin-bottom: 0px;">
                <legend>Searching Criteria</legend>
                <table style="width:100%;text-align:right;">
                    <tr>
                        <td style="width:20%;text-align:right;">
                            <label>P/I No :</label>
                        </td>
                        <td style=" width:20%;text-align:left;">
                            <input id="txtExportPINoAS" style="width:100%;" type="text" />
                        </td>
                        @*<td style=" width:20%;text-align:right;">
                            <label>File No :</label>
                        </td>
                        <td style=" width:20%;text-align:left;">
                            <input id="txtFileNoAS" style="width:80%;" type="text" />
                        </td>*@
                        <td style=" width:20%;text-align:right;">
                            <label>Applicant :</label>
                        </td>
                        <td style=" width:60%;text-align:left;">
                            <input id="txtContractorAdvS" style="width:59%;" type="text" placeholder="Type & Press Enter" />
                            <a id="btnPickContractorAdvS" href="javascript:void(0)" class="easyui-linkbutton ics-pick" iconcls="icon-pick" plain="true"></a>
                            <a id="btnClrContractorAdvS" href="javascript:void(0)" class="easyui-linkbutton ics-pick" iconcls="icon-clear" plain="true"></a>
                        </td>
                    </tr>

                    <tr>
                        <td style=" width:20%;text-align:right;">
                            <label>Business Unit:</label>
                        </td>
                        <td style=" width:30%;text-align:left;">
                            <select id="cboBusinessUnit" style="width:100%;"></select>
                        </td>
                        <td style=" width:20%;text-align:right;">
                            <label>Buyer :</label>
                        </td>
                        <td style=" width:60%;text-align:left;">
                            <input id="txtBuyer" style="width:59%;" type="text" placeholder="Type & Press Enter" />
                            <a id="btnPickBuyer" href="javascript:void(0)" class="easyui-linkbutton ics-pick" iconcls="icon-pick" plain="true"></a>
                            <a id="btnClrBuyer" href="javascript:void(0)" class="easyui-linkbutton ics-pick" iconcls="icon-clear" plain="true"></a>
                        </td>
                    </tr>
                    <tr>
                        <td style=" width:20%;text-align:right;">
                            <label>Issue Bank :</label>
                        </td>
                        <td style=" width:30%;text-align:left;">
                            <input id="txtBankBranch_Issue" style="width:74%;" type="text" placeholder="Type & Press Enter" />
                            <a id="btnPickBankBranch_Issue" href="javascript:void(0)" class="easyui-linkbutton ics-pick" iconcls="icon-pick" plain="true"></a>
                            <a id="btnClrBankBranch_Issue" href="javascript:void(0)" class="easyui-linkbutton ics-pick" iconcls="icon-clear" plain="true"></a>
                        </td>
                       
                        <td style=" width:20%;text-align:right;">
                            <label>Delivery To :</label>
                        </td>
                        <td style=" width:60%;text-align:left;">
                            <input id="txtDeliveryTo" style="width:59%;" type="text" placeholder="Type & Press Enter" />
                            <a id="btnPickDeliveryTo" href="javascript:void(0)" class="easyui-linkbutton ics-pick" iconcls="icon-pick" plain="true"></a>
                            <a id="btnClrDeliveryTo" href="javascript:void(0)" class="easyui-linkbutton ics-pick" iconcls="icon-clear" plain="true"></a>
                        </td>

                    </tr>
                    @*style="display:none"*@
                    <tr>
                        <td style=" width:20%;text-align:right;">
                            <label>Advise Bank:</label>
                        </td>
                        <td style=" width:30%;text-align:left;">
                            <select id="cboBankBranch_Advise" style="width:90%;"></select>
                        </td>
                        <td style=" width:20%;text-align:right;">
                            <label>Nego Bank:</label>
                        </td>
                        <td style=" width:40%;text-align:left;">
                            <select id="cboBankBranch_Nego" style="width:75%;"></select>
                        </td>

                    </tr>
                    <tr>
                        <td style=" width:20%;text-align:right;">
                            <label>L/C Open Date:</label>
                        </td>
                        <td colspan="3" style=" width:60%;text-align:left;">
                            <table style="width:100%">
                                <tr >
                                    <td style="width:17%;">
                                        <select style="width:23%;" id="cboDateOpening" onchange="DateActions_LCOpen(); "></select>
                                        <input id="txtFromOpeningDate" type="text" style="width: 110px;" class="easyui-datebox" required="required" data-options="formatter:icsdateformat,parser:icsdateparser" />To
                                        <input id="txtToOpeningDate" type="text" style="width: 110px;" class="easyui-datebox" required="required" data-options="formatter:icsdateformat,parser:icsdateparser" />
                                    </td>
                                    <td style="width:5%;text-align:right;">
                                        <label>UD Receive:</label>
                                    </td>
                                    <td style=" width:10%;text-align:left;">
                                        <select style="width: 66%;" id="cboUDRecd">
                                            <option value="0">Default</option>
                                            <option value="1">Yet No Recv</option>
                                            <option value="2">Receive</option>
                                        </select>
                                    </td>
                                </tr>
                            </table>
                        </td>
                    </tr>
                    <tr>
                        <td style="width:20%;text-align:right;">
                            <label style="font-size:11px">L/C Open & Amt Date:</label>
                        </td>
                        <td colspan="3" style=" width:60%;text-align:left;">
                            <table style="width:100%">
                                <tr>
                                    <td style="width:17%;">
                                        <select style="width:23%;" id="cboAmendmentDate" onchange="DateActions_AmendmentDate(); "></select>
                                        <input id="txtFromAmendmentDate" type="text" style="width: 110px;" class="easyui-datebox" required="required" data-options="formatter:icsdateformat,parser:icsdateparser" />To
                                        <input id="txtToAmendmentDate" type="text" style="width: 110px;" class="easyui-datebox" required="required" data-options="formatter:icsdateformat,parser:icsdateparser" />
                                    </td>
                                    <td style="width:5%;text-align:right;">
                                        <label>Have Query:</label>
                                    </td>
                                    <td style=" width:10%;text-align:left;">
                                        <select style="width: 66%;" id="cboHaveQuery">
                                            <option value="0">Default</option>
                                            <option value="1">Yes</option>
                                            <option value="2">No</option>
                                        </select>
                                    </td>
                                </tr>
                            </table>
                        </td>
                    </tr>
                    <tr>
                        <td style="width:20%;text-align:right;">
                            <label>Receive Date:</label>
                        </td>
                        <td colspan="3" style=" width:80%;text-align:left;">
                            <table style="width:100%">
                                <tr>
                                    <td style="width:17%">
                                        <select style="width:23%" id="cboLCRecivedDate" onchange="DateActions_LCRecivedDate(); "></select>
                                        <input id="txtFromLCRecivedDate" type="text" style="width: 110px;" class="easyui-datebox" required="required" data-options="formatter:icsdateformat,parser:icsdateparser" />To
                                        <input id="txtToLCRecivedDate" type="text" style="width: 110px;" class="easyui-datebox" required="required" data-options="formatter:icsdateformat,parser:icsdateparser" />
                                    </td>
                                    <td style=" width:5%;text-align:right;">
                                        <label>Original Copy:</label>
                                    </td>
                                    <td style="width:10%;text-align:left;">
                                        <select style="width:66%;" id="cboGetOriginalCopy">
                                            <option value="0">Default</option>
                                            <option value="1">Yet No Recv</option>
                                            <option value="2">Receive</option>

                                        </select>
                                    </td>
                                </tr>
                            </table>
                        </td>
                    </tr>
                    <tr>
                        <td style="width:20%;text-align:right;">
                            <label>Shipment Date:</label>
                        </td>
                        <td colspan="3" style=" width:80%;text-align:left;">
                            <table style="width:100%">
                                <tr>
                                    <td style="width:17%">
                                        <select id="cboShipmentDate" style="width:23%" onchange="DateActions_ShipmentDate(); "></select>
                                        <input id="txtfromShipmentDate" type="text" style="width: 110px;" class="easyui-datebox" required="required" data-options="formatter:icsdateformat,parser:icsdateparser" />To
                                        <input id="txtTofromShipmentDate" type="text" style="width: 110px;" class="easyui-datebox" required="required" data-options="formatter:icsdateformat,parser:icsdateparser" />
                                    </td>
                                    <td style=" width:5%;text-align:right;">
                                        <label>L/C Type:</label>
                                    </td>
                                    <td style="width:10%;text-align:left;">
                                        <select style="width:66%;" id="cboLCType"></select>
                                    </td>
                                </tr>
                            </table>
                        </td>
                    </tr>
                    <tr>
                        <td style="width:20%;text-align:right;">
                            <label>Expire Date:</label>
                        </td>
                        <td colspan="3" style="width:60%;text-align:left;">
                            <table>
                                <tr>

                                    <td>
                                        <select id="cboExpireDate" onchange="DateActions_ExpireDate(); "></select>
                                        <input id="txtFromExpireDate" type="text" style="width: 110px;" class="easyui-datebox" required="required" data-options="formatter:icsdateformat,parser:icsdateparser" />To
                                        <input id="txtToExpireDate" type="text" style="width: 110px;" class="easyui-datebox" required="required" data-options="formatter:icsdateformat,parser:icsdateparser" />

                                    </td>
                                </tr>
                            </table>
                        </td>
                    </tr>
                    
                    <tr>
                        <td style=" width:20%;text-align:right;">
                            <label>Yet Not Create:</label>
                        </td>
                        <td style="width:30%;text-align:left;">
                            <input id="chkExportDoIsntCreateYet" type="checkbox" style="margin-left: 7px;" />
                        </td>
                        <td style="width:30%;text-align:right;">
                            <label style=" font-size:9px">Delivery Challan Issue Bill Not created:</label>
                        </td>
                        <td style="width:20%;text-align:left;">
                            <input id="chkDeliveryChallanIssueButBillNotCreated" type="checkbox" style="margin-left: 7px;" />
                        </td>
                    </tr>
                    <tr>
                        <td style=" width:20%;text-align:right;">
                            <label>Status : </label>
                        </td>
                        <td colspan="3" style="width:60%;text-align:left;">
                            <div style="margin-top: 2px;" >
                                <table id="tblExportLCStatusAdv" class="easyui-datagrid" title="" style="width:85%; height: 140px;" data-options="singleSelect: false,fitColumns:false, rownumbers:true, pagination:false, autoRowHeight:false, ">
                                    <thead>
                                        <tr>
                                            <th data-options="field:'Selected',checkbox:true"></th>
                                            <th field="Value" width="85%"></th>
                                        </tr>
                                    </thead>
                                </table>
                            </div>
                        </td>
                    </tr>
                    <tr>
                        <td style=" width:20%;text-align:right;">
                            <label>Report Layout :</label>
                        </td>
                        <td colspan="3" style="width:60%;text-align:left;">
                            <select id="cboReportLayout" style="width:100%; height:22px">  </select>
                        </td>
                    </tr>
                </table>
            </fieldset>
        </div>
        <fieldset>
            <legend style="font-weight:bold"> Action : </legend>
            <table border="0" cellspacing="2" cellpadding="2" style="font-size:11px; font-weight:bold; width:100%;">
                <tr>
                    <td style="width:20%;text-align:right">  
                    </td>
                    <td style="width:80%;text-align:right">
                        <a id="btnPreviewSummary" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-print" plain="true">Preview(Summary)</a>
                        <a id="btnPreview" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-print" plain="true">Preview</a>
                        <a id="btnExportToExcel" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-excel" plain="true">Export to Excel</a>
                    </td>
                </tr>
            </table>
        </fieldset>
    </div>
</body>
</html>


<script type="text/javascript">
    var _oBankBranchs=[];
    var _oBusinessUnits=[];
    var _oCompareOperators=[];
    var _oLCStatus=[];
    var _nBUID=[];
    var _oNotifyBy=[];
    var _oReportLayouts=[];
    var _oBusinessUnits=[];
    var _nBuyerIDs="";
    var _nDeliveryToIDs="";
    var _oLCTypes = [];
    $(document).ready(function () {
        @*var oApprovalUsers = @Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(ViewBag.ApprovalUsers));
        var oExportLCTypes = @Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(ViewBag.ExportLCTypes));*@

        $("#progbar").progressbar({ value: 0 });
        $("#progbarParent").hide();

        _oBankBranchs = @Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(ViewBag.BankBranchs));
        _oBusinessUnits= @Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(ViewBag.BusinessUnits));
        _oCompareOperators = @Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(ViewBag.CompareOperators));
        _oLCStatus = @Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(ViewBag.LCStatus));
        _nBUID = @Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(ViewBag.BUID));
        _oNotifyBy = @Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(ViewBag.NotifyBy));
        _oReportLayouts = @Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(ViewBag.ReportLayouts));
        _oBusinessUnits = @Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(ViewBag.BusinessUnits));
        _oLCTypes = @Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(ViewBag.LCTypes));
        $("#cboLCType").icsLoadCombo({List: _oLCTypes, OptionValue: "id", DisplayText: "Value"});

        LoadComboAdv();   ResetAdvSearchWindow();
    });


    $("#txtContractorAdvS").keydown(function (e) {
        if (e.keyCode === 13) // Enter Press
        {
            PickContractors_AdvS(1);
        }
        else if (e.keyCode === 08) {
            $("#txtContractorAdvS").removeClass("fontColorOfPickItem");
            _sContractorIds = '';
        }
    });
    $("#btnClrContractorAdvS").click(function () {
        $("#txtContractorAdvS").removeClass("fontColorOfPickItem");
        $("#txtContractorAdvS").val("");
        _sContractorIds = '';
    });
    $("#btnPickContractorAdvS").click(function () {
        PickContractors_AdvS(1);
    });

    $("#txtBuyer").keydown(function (e) {
        if (e.keyCode === 13) // Enter Press
        {
            PickContractors_AdvS(2);
        }
        else if (e.keyCode === 08) {
            $("#txtBuyer").removeClass("fontColorOfPickItem");
            _nBuyerIDs = '';
        }
    });
    $("#btnClrBuyer").click(function () {
        $("#txtBuyer").removeClass("fontColorOfPickItem");
        $("#txtBuyer").val("");
        _nBuyerIDs = '';
    });
    $("#btnPickBuyer").click(function () {
        PickContractors_AdvS(2);
    });

    $("#txtDeliveryTo").keydown(function (e) {
        if (e.keyCode === 13) // Enter Press
        {
            PickContractors_AdvS(3);
        }
        else if (e.keyCode === 08) {
            $("#txtDeliveryTo").removeClass("fontColorOfPickItem");
            _nDeliveryToIDs = '';
        }
    });
    $("#btnClrDeliveryTo").click(function () {
        $("#txtDeliveryTo").removeClass("fontColorOfPickItem");
        $("#txtDeliveryTo").val("");
        _nDeliveryToIDs = '';
    });
    $("#btnPickDeliveryTo").click(function () {
        PickContractors_AdvS(3);
    });

    var _nRef=0;
    function PickContractors_AdvS(nRef) {

        _nRef=nRef;
        var txtContractorName="";
        if(nRef==1)
            txtContractorName= $.trim($("#txtContractorAdvS").val());
        if(nRef==2)
            txtContractorName= $.trim($("#txtBuyer").val());
        if(nRef==3)
            txtContractorName= $.trim($("#txtDeliveryTo").val());

        var oContractor = {
        Params: '2,3' + '~' + txtContractorName+"~"+_nBUID
        };

        var obj = {
            BaseAddress: _sBaseAddress,
            Object: oContractor,
            ControllerName: "Contractor",
            ActionName: "ContractorSearchByNameType",
            IsWinClose: false
        };

        $("#progressbar").progressbar({ value: 0 });
        $("#progressbarParent").show();
        var intervalID = setInterval(updateProgress, 250);

        DynamicRefreshList([], "tblAccountsPickerAdvSearch");
        $.icsDataGets(obj, function (response) {

            if (response.status && response.objs.length > 0) {
                if (response.objs[0].ContractorID > 0) {
                    var tblColums = []; var oColumn = { field: "ContractorID", title: "Code", width: 50, align: "left" }; tblColums.push(oColumn);
                    oColumn = { field: "Name", title: "Name", width: 280, align: "left" }; tblColums.push(oColumn);

                    var oPickerParam = {
                        winid: 'winContractorPicker',
                        winclass: 'clsAccountOf',
                        winwidth: 400,
                        winheight: 460,
                        tableid: 'tblAccountOfs',
                        tablecolumns: tblColums,
                        datalist: response.objs,
                        multiplereturn: true,
                        searchingbyfieldName: 'Name',
                        windowTittle: 'Contactor List'
                    };
                    $.icsPicker(oPickerParam);
                    IntializePickerbutton(oPickerParam);
                }
                else {
                    alert(response.objs[0].ErrorMessage);
                }
            }
            else {
                alert("Sorry, No Contactor Found.");
            }

            clearInterval(intervalID);
            $("#progressbarParent").hide();
        });
    }
    //End Account Of Picker
    $("#txtBankBranch_Issue").keydown(function (e) {
        if (e.keyCode === 13) // Enter Press
        {
            if($("#txtBankBranch_Issue").val()=="" || $("#txtBankBranch_Issue").val()==null)
            {
                $("#txtBankBranch_Issue").removeClass("fontColorOfPickItem");
                _sBankBranch_IssueIds = '';
                alert("Please, Type name")
                return;
            }

            var oBankBranch = {
                BUID: _nBUID,
                DeptIDs: '5',//EnumOperationalDept : Export_Party=5
                BankName: $.trim($("#txtBankBranch_Issue").val())
            };
            PickBanks_AdvS(oBankBranch);
        }
        else if (e.keyCode === 08) {
            $("#txtBankBranch_Issue").removeClass("fontColorOfPickItem");
            _sBankBranch_IssueIds = '';
        }
    });

    $("#btnClrBankBranch_Issue").click(function () {
        $("#txtBankBranch_Issue").removeClass("fontColorOfPickItem");
        $("#txtBankBranch_Issue").val("");
        _sBankBranch_IssueIds = '';
    });

    $("#btnPickBankBranch_Issue").click(function () {
        var oBankBranch = {
            BUID: _nBUID,
            DeptIDs: '5',//EnumOperationalDept : Export_Party=5
            BankName: $.trim($("#txtBankBranch_Issue").val())
        };
        PickBanks_AdvS(oBankBranch);
    });
    function PickBanks_AdvS(oBankBranch) {

        var obj = {
            BaseAddress: _sBaseAddress,
            Object: oBankBranch,
            ControllerName: "BankBranch",
            ActionName: "GetsBankBranchSearchByBankName",
            IsWinClose: false
        };

        $("#progressbar").progressbar({ value: 0 });
        $("#progressbarParent").show();
        var intervalID = setInterval(updateProgress, 250);

        $.icsDataGets(obj, function (response) {
            clearInterval(intervalID);
            $("#progressbarParent").hide();
            if (response.status && response.objs.length > 0) {
                if (response.objs[0].BankBranchID > 0) {
                    var tblColums = []; var oColumn = { field: "BankName", title: "Bank Name", width: 200, align: "left" }; tblColums.push(oColumn);
                    oColumn = { field: "BranchName", title: "Branch Name", width: 280, align: "left" }; tblColums.push(oColumn);
                    oColumn = { field: "Address", title: "Address", width: 280, align: "left" }; tblColums.push(oColumn);

                    var oPickerParam = {
                        winid: 'winBankBranch_IssuePicker',
                        winclass: 'clsBankBranch_Issue',
                        winwidth: 500,
                        winheight: 460,
                        tableid: 'tblBankBranch_Issues',
                        tablecolumns: tblColums,
                        datalist: response.objs,
                        multiplereturn: true,
                        searchingbyfieldName: 'BranchName',
                        windowTittle: 'Bank List'
                    };
                    $.icsPicker(oPickerParam);
                    IntializePickerbutton(oPickerParam);
                }
                else {
                    alert(response.objs[0].ErrorMessage);
                }
            }
            else {
                alert("Sorry, No Contactor Found.");
            }
        });
    }

    //EndIssue Bank

    function IntializePickerbutton(oPickerobj) {
        $("#" + oPickerobj.winid).find("#btnOk").click(function () {
            SetPickerValueAssign(oPickerobj);
        });
        $(document).find('.' + oPickerobj.winclass).keydown(function (e) {
            if (e.which === 13) {
                SetPickerValueAssign(oPickerobj);
            }
        });
    }

    function SetPickerValueAssign(oPickerobj) {
        var oreturnObj = null, oreturnObjs = [];
        if (oPickerobj.multiplereturn) {
            oreturnObjs = $('#' + oPickerobj.tableid).datagrid('getChecked');
        } else {
            oreturnObj = $('#' + oPickerobj.tableid).datagrid('getSelected');
        }

        if (oPickerobj.winid == 'winContractorPicker')
        {
            if (oreturnObjs != null && oreturnObjs.length> 0)
            {
                if(_nRef==1)
                {
                    _sContractorIds=''; var sMessage='';
                    sMessage=(oreturnObjs.length>1)? oreturnObjs.length +" Contractors Selected" : oreturnObjs[0].Name;
                    $('#txtContractorAdvS').val(sMessage);
                    $("#txtContractorAdvS").addClass("fontColorOfPickItem");

                    for(var i=0;i<oreturnObjs.length;i++){
                        _sContractorIds=_sContractorIds+oreturnObjs[i].ContractorID+',';
                    }
                    _sContractorIds=_sContractorIds.substring(0,_sContractorIds.length-1);
                }else if(_nRef==2)
                {
                    _nBuyerIDs=''; var sMessage='';
                    sMessage=(oreturnObjs.length>1)? oreturnObjs.length +" Buyers Selected" : oreturnObjs[0].Name;
                    $('#txtBuyer').val(sMessage);
                    $("#txtBuyer").addClass("fontColorOfPickItem");

                    for(var i=0;i<oreturnObjs.length;i++){
                        _nBuyerIDs=_nBuyerIDs+oreturnObjs[i].ContractorID+',';
                    }
                    _nBuyerIDs=_nBuyerIDs.substring(0,_nBuyerIDs.length-1);
                }else if(_nRef==3)
                {
                    _nDeliveryToIDs=''; var sMessage='';
                    sMessage=(oreturnObjs.length>1)? oreturnObjs.length +" Contractors Selected" : oreturnObjs[0].Name;
                    $('#txtDeliveryTo').val(sMessage);
                    $("#txtDeliveryTo").addClass("fontColorOfPickItem");

                    for(var i=0;i<oreturnObjs.length;i++){
                        _nDeliveryToIDs=_nDeliveryToIDs+oreturnObjs[i].ContractorID+',';
                    }
                    _nDeliveryToIDs=_nDeliveryToIDs.substring(0,_nDeliveryToIDs.length-1);
                }
            }
            else
            {
                alert("Please select a contractor.");
                return false;
            }
        }

        else if (oPickerobj.winid == 'winBankBranch_IssuePicker') {
            if (oreturnObjs != null && oreturnObjs.length> 0)
            {
                var sMessage='';
                sMessage=(oreturnObjs.length>1)? oreturnObjs.length +" Bank(s) Selected" : oreturnObjs[0].BankName;
                $('#txtBankBranch_Issue').val(sMessage);
                $("#txtBankBranch_Issue").addClass("fontColorOfPickItem");

                for(var i=0;i<oreturnObjs.length;i++){
                    _sBankBranch_IssueIds=_sBankBranch_IssueIds+oreturnObjs[i].BankBranchID+',';
                }
                _sBankBranch_IssueIds=_sBankBranch_IssueIds.substring(0,_sBankBranch_IssueIds.length-1);
            }
            else
            {
                alert("Please select a Bank Branch.");
                return false;
            }
        }

        $("#" + oPickerobj.winid).icsWindow("close");
        $("#" + oPickerobj.winid).remove();
    }

    //End Buyer Search
    $("#btnResetAdvSearch").click(function () {
        ResetAdvSearchWindow();
        LoadComboAdv();
    });

    function RefreshObject()
    {
        $(".lblLoadingMessage").show();
        var sStatusIds = "";
        var sLCNo = "";
        var oLCStatus = $("#tblExportLCStatusAdv").datagrid("getChecked");
        if (oLCStatus.length > 0)
        {
            for (var i = 0;i<oLCStatus.length; i++){
                sStatusIds = oLCStatus[i].id + "," + sStatusIds;
            }
            sStatusIds = sStatusIds.substring(0, sStatusIds.length - 1);
        }

        var sTempString = $.trim($("#txtExportPINoAS").val()) + '~'
                        + $.trim($("#txtFileNoAS").val()) + '~'
                        + _sContractorIds + '~'
                        + $("#cboBankBranch_Nego").val() + '~'
                        + $("#cboBankBranch_Advise").val() + '~'
                        + _sBankBranch_IssueIds + '~'
                        + $("#cboDateOpening").val() + '~'
                        + $("#txtFromOpeningDate").datebox("getValue") + '~'
                        + $("#txtToOpeningDate").datebox("getValue") + '~'
                        + $("#cboLCRecivedDate").val() + '~'
                        + $("#txtFromLCRecivedDate").datebox("getValue") + '~'
                        + $("#txtToLCRecivedDate").datebox("getValue") + '~'
                        + $("#cboShipmentDate").val() + '~'
                        + $("#txtfromShipmentDate").datebox("getValue") + '~'
                        + $("#txtTofromShipmentDate").datebox("getValue") + '~'
                        + $("#cboExpireDate").val() + '~'
                        + $("#txtFromExpireDate").datebox("getValue") + '~'
                        + $("#txtToExpireDate").datebox("getValue") + "~"
                        + $("#cboAmendmentDate").val() + '~'
                        + $("#txtFromAmendmentDate").datebox("getValue") + '~'
                        + $("#txtToAmendmentDate").datebox("getValue") + "~"  //20
                        + sStatusIds + "~"
                        + $("#cboBusinessUnit").val() + "~"
                        + parseInt($("#cboUDRecd").val()) + "~"
                        + parseInt($("#cboHaveQuery").val()) + "~"
                        + parseInt($("#cboGetOriginalCopy").val()) + "~"
                        + $("#chkExportDoIsntCreateYet").is(':checked') + "~"
                        + $("#chkDeliveryChallanIssueButBillNotCreated").is(':checked') + "~"
                        + sLCNo + "~" + parseInt($('#cboReportLayout').val()) + "~"
                        + _nBuyerIDs  + "~" + _nDeliveryToIDs + "~"+ parseInt($("#cboLCType").val());//;
        var oExportLCRegister=
        {
            ErrorMessage:sTempString
        };
        return oExportLCRegister
    }
    function LoadComboAdv()
    {
        $("#cboBankBranch_Nego,#cboBankBranch_Advise").icsLoadCombo({
            List: _oBankBranchs,
            OptionValue: "BankBranchID",
            DisplayText: "BankBranchName"
        });
        DynamicRefreshList(_oLCStatus, "tblExportLCStatusAdv");
        $("#cboDateOpening, #cboAmendmentDate, #cboLCRecivedDate,#cboShipmentDate,#cboExpireDate").icsLoadCombo({
            List: _oCompareOperators,
            OptionValue: "id",
            DisplayText: "Value"
        });
        $("#cboReportLayout").icsLoadCombo({ List: _oReportLayouts, OptionValue: "id", DisplayText: "Value" });
        $("#cboBusinessUnit").icsLoadCombo({ List: _oBusinessUnits, OptionValue: "BusinessUnitID", DisplayText: "ShortName" });
        $("#cboBusinessUnit").val(_nBUID);
    }
    function ResetAdvSearchWindow() {
        _sContractorIds = _nBuyerIDs=_nDeliveryToIDs= '';
        _sBankBranch_IssueIds = "";
        $(".lblLoadingMessage").hide();
        $("#winAdvSearch input").not("input[type='button']").val("");
        $("#winAdvSearch input").removeClass("fontColorOfPickItem");
        $("#winAdvSearch select").val(0);
        DateActions_LCOpen();
        DateActions_AmendmentDate();
        DateActions_LCRecivedDate();
        DateActions_ShipmentDate();
        DateActions_ExpireDate();
        $("#txtFromOpeningDate,#txtToOpeningDate,#txtFromAmendmentDate,#txtToAmendmentDate,#txtFromLCRecivedDate,#txtToLCRecivedDate,#txtfromShipmentDate,#txtTofromShipmentDate,#txtFromExpireDate,#txtToExpireDate").datebox({ disabled: true });
        $("#txtFromOpeningDate,#txtToOpeningDate,#txtFromAmendmentDate,#txtToAmendmentDate,#txtFromLCRecivedDate,#txtToLCRecivedDate,#txtfromShipmentDate,#txtTofromShipmentDate,#txtFromExpireDate,#txtToExpireDate").datebox("setValue", icsdateformat(new Date()));
    }

    function MakeStringIDs(StringIDs) {

        var IDs = "";
        for (var i = 0; i < StringIDs.length; i++) {
            IDs = StringIDs[i].id + "," + IDs;
        }
        var length = 0;
        length = parseInt(IDs.length) - 1;
        IDs = IDs.substring(0, parseInt(length));
        return IDs;
    }

    function CheckFromAndToDateValidation(OperationComboId, FromDateId, ToDateId) {
        $("#" + OperationComboId).parent().parent().parent().find("select").removeClass("errorFieldBorder");
        var nCboVal = $("#" + OperationComboId).val();
        if (parseInt(nCboVal) == 5 || parseInt(nCboVal) == 6) {
            var fromDate = $("#" + FromDateId).datebox("getValue");
            var toDate = $("#" + ToDateId).datebox("getValue");
            if (new Date(fromDate) > new Date(toDate)) {
                $("#" + ToDateId).focus();
                $("#" + OperationComboId).addClass("errorFieldBorder");
                $(".lblLoadingMessage").hide();
                return false;
            } else {
                $("#" + OperationComboId).removeClass("errorFieldBorder");
                return true;
            }
        } else {
            return true;
        }
    }

    function DateActions_LCOpen() {
        DynamicDateActions("cboDateOpening", "txtFromOpeningDate", "txtToOpeningDate");
    }
    function DateActions_AmendmentDate() {
        DynamicDateActions("cboAmendmentDate", "txtFromAmendmentDate", "txtToAmendmentDate");
    }
    function DateActions_LCRecivedDate() {
        DynamicDateActions("cboLCRecivedDate", "txtFromLCRecivedDate", "txtToLCRecivedDate");
    }
    function DateActions_ShipmentDate() {
        DynamicDateActions("cboShipmentDate", "txtfromShipmentDate", "txtTofromShipmentDate");
    }
    function DateActions_ExpireDate() {
        DynamicDateActions("cboExpireDate", "txtFromExpireDate", "txtToExpireDate");
    }

    //$("#btnCloseAdvSearch").click(function () {
    //    $("#winAdvSearch").icsWindow("close");
    //});
    //$("#btnAdvSearch").click(function () {
    //    debugger;
    //    $("#winAdvSearch").icsWindow("open", "Export L/C Advance Search");
    //    DynamicRefreshList([], "tblExportPIAdvSearch");
    //    DynamicResetAdvSearchWindow("winAdvSearch");
    //    ResetAdvSearchWindow();
    //    LoadComboAdv();
    //});
    /// end Adv Searching

    $('#btnPreviewSummary').click(function(e){
        debugger;
        if($('#cboBusinessUnit').val()<=0)
        {
            alert("Please Select A Business Unit!!");
            $('#cboBusinessUnit').focus();
            return null;
        }

        //if($('#cboReportLayout').val()<=0)
        //{
        //    alert("Please Select A Report Layout!!");
        //    $('#cboReportLayout').focus();
        //    return null;
        //}

        var oExportLCRegister = RefreshObject();

        if(oExportLCRegister==null)
            return;
        $.ajax({
            type: "POST",
            dataType: "json",
            url : _sBaseAddress+  "/ExportLCRegister/SetSessionSearchCriteria",
            traditional: true,
            data:  JSON.stringify(oExportLCRegister),
            contentType: "application/json; charset=utf-8",
            success: function (data) {
                var sFeedBackMessage = jQuery.parseJSON(data);
                if (sFeedBackMessage==="Successful") {
                    var tsv=((new Date()).getTime())/1000;
                    window.open(_sBaseAddress+'/ExportLCRegister/PrintExportLCRegisterSummary?ts='+tsv,"_blank");
                }
            },
            error: function (xhr, status, error) {
                alert(error);
            }
        });
    });
    $('#btnPreview').click(function(e){
        debugger;
        if($('#cboBusinessUnit').val()<=0)
        {
            alert("Please Select A Business Unit!!");
            $('#cboBusinessUnit').focus();
            return null;
        }

        if($('#cboReportLayout').val()<=0)
        {
            alert("Please Select A Report Layout!!");
            $('#cboReportLayout').focus();
            return null;
        }

        var oExportLCRegister = RefreshObject();

        if(oExportLCRegister==null)
            return;
        $.ajax({
            type: "POST",
            dataType: "json",
            url : _sBaseAddress+  "/ExportLCRegister/SetSessionSearchCriteria",
            traditional: true,
            data:  JSON.stringify(oExportLCRegister),
            contentType: "application/json; charset=utf-8",
            success: function (data) {
                var sFeedBackMessage = jQuery.parseJSON(data);
                if (sFeedBackMessage==="Successful") {
                    var tsv=((new Date()).getTime())/1000;
                    window.open(_sBaseAddress+'/ExportLCRegister/PrintExportLCRegister?ts='+tsv,"_blank");
                }
            },
            error: function (xhr, status, error) {
                alert(error);
            }
        });
    });

    $('#btnExportToExcel').click(function(e){
        if($('#cboBusinessUnit').val()<=0)
        {
            alert("Please Select A Business Unit!!");
            $('#cboBusinessUnit').focus();
            return null;
        }
        var oExportLCRegister = RefreshObject();
        if(oExportLCRegister==null)
            return;

        if($('#cboBusinessUnit').val()<=0)
        {
            alert("Please Select A Business Unit!!");
            $('#cboBusinessUnit').focus();
            return null;
        }

        $.ajax({
            type: "POST",
            dataType: "json",
            url : _sBaseAddress+  "/ExportLCRegister/SetSessionSearchCriteria",
            traditional: true,
            data:  JSON.stringify(oExportLCRegister),
            contentType: "application/json; charset=utf-8",
            success: function (data) {
                var sFeedBackMessage = jQuery.parseJSON(data);
                if (sFeedBackMessage==="Successful") {
                    var tsv=((new Date()).getTime())/1000;
                    window.open(_sBaseAddress+'/ExportLCRegister/Print_ExportLCRegisterXL?ts='+tsv,"_blank");
                }
            },
            error: function (xhr, status, error) {
                alert(error);
            }
        });
    });

    function updateProgress() {
        var value =$('#progbar').progressbar('getValue');
        if (value < 96){
            value += Math.floor(Math.random() * 10);
            $('#progbar').progressbar('setValue', value);
        }
    }

    function hideShow(miliseconds) {
        $("#progbarParent").hide();
    }
</script>