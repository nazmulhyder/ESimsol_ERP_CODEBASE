<html>
<head>
    <link href="@Url.Content("~/Content/CSS/icon.css")" rel="stylesheet" type="text/css" />
    <link href="@Url.Content("~/Content/CSS/easyui.css")" rel="stylesheet" type="text/css" />
    <link href="@Url.Content("~/Content/CSS/Pikerstyle.css")" rel="stylesheet" type="text/css" />
    <script src="@Url.Content("~/Scripts/jquery-1.7.1.min.js")" type="text/javascript"></script>
    <script src="@Url.Content("~/Scripts/jquery.ics.customize.js")" type="text/javascript"></script>
    <script src="@Url.Content("~/Scripts/jquery.easyui.min.js")" type="text/javascript"></script>
    <script src="@Url.Content("~/Scripts/jquery-ui.min.js")" type="text/javascript"></script>
    <script src="@Url.Content("~/Scripts/json2.js")" type="text/javascript"></script>

</head>
<body>

    @model ESimSol.BusinessObjects.EmployeeDoc
    <div style="font-family:Tahoma">
        <table border="0" cellspacing="2" cellpadding="2">
            <tr>
                <td style="background-color:#CFB53B; text-align:center; width:495px; color:White">
                    <label id="lblHeaderName" style="font-size:15px; font-weight:bold; text-decoration:Underline"></label>
                </td>
            </tr>
        </table>
        @using (Html.BeginForm("ViewEmployeeAttatchment", "Employee", FormMethod.Post, new { enctype = "multipart/form-data" }))
        {
            <table border="0" cellspacing="2" cellpadding="2" style="font-size:11px; font-weight:bold">
                <tr>
                    @Html.HiddenFor(model => model.EmployeeDocID)
                    @Html.TextBoxFor(model => model.EmployeeID, new { type = "hidden", id = "txtEmployeeID" })
                    @Html.TextBoxFor(model => model.DocTypeInt, new { type = "hidden", id = "txtDocTypeInt" })
                    @Html.TextBoxFor(model => model.DocTypeID, new { type = "hidden", id = "txtDocTypeID" })
                    @Html.TextBoxFor(model => model.IssueDate, new { type = "hidden", id = "dateIssue" })
                    @Html.TextBoxFor(model => model.ExpireDate, new { type = "hidden", id = "dateExpire" })

                    <td style="width:100px; text-align:right">Description : </td>
                    <td style="width:370px">@Html.TextBoxFor(model => model.Description, new { style = "width: 380px;", id = "txtDescription" }) </td>
                </tr>
                <tr>
                    <td style="width:100px; text-align:right">Issue Date : </td>
                    <td style="width:390px">
                        <input type="text" class="easyui-datebox" style="width: 105px;" data-options="formatter:icsdateformat,parser:icsdateparser" id="txtIssueDate" />
                        <span style="padding-left:30px;">Expire Date :</span><span style="padding-left:8px;"><input type="text" class="easyui-datebox" style="width: 105px;" data-options="formatter:icsdateformat,parser:icsdateparser" id="txtEndDate" /></span>
                    </td>
                </tr>
                <tr>
                    <td style="width:100px; text-align:right">Add File : </td>
                    <td style="width:270px"><input type="file" name="file" onchange="readURL(this);" /></td>
                </tr>
                <tr>
                    <td style="width:100px; text-align:right"> </td>
                    <td style="width:270px">
                        <input id="btnSubmit" type="submit" value="Upload" style="width:75px; font-weight:bold" />
                        @*<span style="padding-left:30px;"> Search By: </span><span style="padding-left:8px;">
                            <select id="cboFileStatus" style="width:130px;">
                                <option value="1">Active</option>
                                <option value="0">Inactive</option>
                            </select>
                        </span>
                        <a href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-search" plain="true" id="btnSearch"></a>*@
                    </td>
                </tr>
            </table>
        }
        <fieldset>
            <legend style="font-weight:bold;font-size:11px;"> Attachment List : </legend>
            <div id="ImagContaiiner" style="width:470px; height:20px;">
                <table border="1" cellpadding="1" cellspacing="1">
                    <tr>
                        <td style="text-align:center;font-size:12px;width: 70px;min-width:70px;max-width:70px;font-weight:bold;">SL No</td>
                        <td style=" text-align:center;font-size:12px;width: 200px;min-width:200px;max-width:200px;font-weight:bold;">File Name</td>
                        <td style=" text-align:center;font-size:12px;width: 182px;min-width:182px;max-width:182px;font-weight:bold;">Action</td>
                    </tr>
                </table>
            </div>
            <div style="width:480px; height:140px;overflow:auto">
                @*<table id="tblAttatchment" class="easyui-datagrid" style="width:480px;height:140px" toolbar="#toolbarEmployee" fitcolumns="false" rownumbers="true" pagination="false"  autorowheight="false">
                        <thead>
                            <tr>
                                <th data-options="field:'Selected',checkbox:true"></th>
                                <th field="IssueDateInString" width="100">Issue Date</th>
                                <th field="ExpireDateInString" width="100">Expired Date</th>
                                <th field="Description" width="120">Description</th>
                                <th field="FileStatus" width="80">Status</th>
                            </tr>
                        </thead>
                    </table>
                    <div id="toolbarEmployee" style="font-family:Tahoma; margin-left:0px;">
                        <a href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-reload" plain="true" id="btnDownload">Download</a>
                        <a href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-remove" plain="true" id="btnDelete">Delete</a>
                    </div>*@

                <table border="1" cellpadding="1" cellspacing="1">

                    @{
                        int nSLNo = 0;
                    }
                    @if (Model.EmployeeDocs != null)
                    {
                        foreach (ESimSol.BusinessObjects.EmployeeDoc oItem in Model.EmployeeDocs)
                        {
                            nSLNo++;
                            <tr>
                                <td style="text-align: center; font-size:12px;width: 70px;min-width:70px;max-width:70px;">
                                    @nSLNo.ToString()
                                </td>
                                <td style="text-align: left; font-size:12px;width: 200px;min-width:200px;max-width:200px;overflow:hidden;">
                                    @oItem.Description
                                </td>
                                <td style=" text-align:center;font-size:12px;width: 182px;min-width:182px;max-width:182px;">
                                    @Html.ActionLink("Download", "DownloadEmployeeAttachment", new { id = oItem.EmployeeDocID })/@Html.ActionLink("Delete", "DeleteEmployeeAttachment", new { id = oItem.EmployeeDocID })
                                </td>
                            </tr>

                        }
                    }

                </table>
            </div>
        </fieldset>
        <fieldset>
            <legend style="font-weight:bold"> Action : </legend>
            <table border="0" cellspacing="2" cellpadding="2" style="font-size:11px; font-weight:bold">
                <tr>
                    <td style="width:500px; text-align:right"></td>

                    <td style="width:50px"></td>
                    <td style="width:50px">
                        <a href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-cancel" plain="true" onclick="Close()">Close</a>
                    </td>
                </tr>
            </table>
        </fieldset>
    </div>
</body>
</html>

<script type="text/javascript">

    var _sBaseAddress="";
    var _oAttachmentList=[];
    var _bMultipleItemReturn=false;
    $(document).ready(function () {
        //debugger;
        var obj = window.dialogArguments;
        _sBaseAddress =@Html.Raw( new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(HttpContext.Current.Session[SessionInfo.BaseAddress]));
        _oAttachmentList=@Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(Model.EmployeeDocs));
        _sMessage=@Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(TempData["message"]));
        $('#lblHeaderName').html(obj.Name);
        _bMultipleItemReturn=obj.MultipleItemReturn;
        //if (_bMultipleItemReturn == false)
        //{
        //    $('#tblAttatchment').datagrid('hideColumn', 'Selected');
        //    $('#tblAttatchment').datagrid({ onDblClickRow: function (rowIndex, rowData) { RowDoubleClickEvent(rowIndex, rowData); } });
        //}
        LoadAttachment(_oAttachmentList);
        $('#txtEmployeeID').val(obj.EmployeeID);
        $('#txtDocTypeInt').val(obj.DocTypeInt);
        $('#txtDocTypeID').val(obj.DocTypeID);
        $('#txtIssueDate').datebox('setValue',icsdateformat(new Date()));
        $('#txtEndDate').datebox('setValue',icsdateformat(new Date()));
        if(_sMessage!=null && _sMessage!="")
        {
            alert(_sMessage);
        }
    });

    function LoadAttachment(oAttachments)
    {
        data = oAttachments;
        data = { "total": "" + data.length + "", "rows": data };
        $('#tblAttatchment').datagrid('loadData', data);
    }
    function readURL(input) {
        if (input.files && input.files[0]) {
            var reader = new FileReader();

            reader.onload = function (e) {
                $('#imgSample')
                    .attr('src', e.target.result)
                    .width(250)
                    .height(250);
            };
            reader.readAsDataURL(input.files[0]);
        }
    }
    function formatAction()
    {
        var e = "'"+'<a href="#" onclick="Download(this)">Download</a>'+ "/" +'<a href="#" onclick="Delete(this)">Delete</a>'+"'";
        return e;
    }
    $('#btnSubmit').click(function (e) {
        $('#dateIssue').val($('#txtIssueDate').datebox('getValue'));
        $('#dateExpire').val($('#txtEndDate').datebox('getValue'));
        if(document.getElementById("txtDescription").value==null || document.getElementById("txtDescription").value=="")
        {
            alert("Please enter Purpose!");
            $('#txtDescription').focus();

            return false;
        }
    });

    function Download(target)
    {
        $('#tt').datagrid('beginEdit', getRowIndex(target));
    }
    function Delete(target){
        $.messager.confirm('Confirm','Are you sure?',function(r){
            if (r){
                $('#tt').datagrid('deleteRow', getRowIndex(target));
            }
        });
    }



    function Close()
    {
        window.returnValue= _oAttachmentList;
        window.close();
    }


    $(document).keydown(function(e) {
        //debugger;
        if(e.which == 27)//escape=27
        {
            //debugger;
            window.close();
        }
    });

    //$('#btnDelete').click(function(e)
    //{

    //    var oAttachments= $('#tblAttatchment').datagrid('getChecked');
    //    var oSelectedRowIndexs=[];
    //    if(oAttachments==null || oAttachments.length<=0)
    //    {
    //        alert("Please select at least one item.");
    //        return false;
    //    }
    //    var sDocIDS="";
    //    for(var i=0; i<oAttachments.length;i++)
    //    {
    //        oSelectedRowIndexs.push($('#tblAttatchment').datagrid('getRowIndex', oAttachments))
    //        sDocIDS=sDocIDS+oAttachments[i].EmployeeDocID+',';
    //    }
    //    sDocIDS=sDocIDS.substring(0,sDocIDS.length-1);
    //    var nts = ((new Date()).getTime()) / 1000;
    //    $.ajax
    //    ({
    //        type: "POST",
    //        dataType: "json",
    //        url : _sBaseAddress+  "/Employee/DeleteAttachment",
    //        data: JSON.stringify({sIDs:sDocIDS,nts:nts}),
    //        contentType: "application/json; charset=utf-8",
    //        success: function (data) {
    //            //debugger;
    //            var sMessage = jQuery.parseJSON(data);
    //            if(sMessage=="Delete Successfully")
    //            {
    //                alert(sMessage);
    //                for(var i=0; i<oSelectedRowIndexs.length;i++)
    //                {
    //                    $('#tblAttatchment').datagrid('deleteRow', oSelectedRowIndexs[i]);
    //                }

    //            }
    //            else
    //            {
    //                alert(sMessage);
    //            }



    //        },
    //        error: function (xhr, status, error)
    //        {
    //            alert(error);
    //        }

    //    });
    //});

</script>