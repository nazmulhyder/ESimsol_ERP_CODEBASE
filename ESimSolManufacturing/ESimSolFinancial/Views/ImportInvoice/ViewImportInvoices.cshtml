@model IEnumerable<ESimSol.BusinessObjects.ImportInvoice>
  @{
        ViewBag.Title = "View Import Invoice(s)";
   }
<div id="divImportInvoices" class="menuMainCollectionTable" style="margin-left: 0px; height:100%; width:100%">
    <table id="tblImportInvoice" title="Import Invoice" class="easyui-datagrid" style="width:100%;height:100%" fitcolumns="false" rownumbers="true" pagination="true" singleselect="true" autorowheight="false" toolbar="#toolbar" showfooter="true">
        <thead>
            <tr>
                @*<th field="FileNo" width="100" align="left">File No</th>*@
                <th field="ImportInvoiceNo" width="12%" align="left">Invoice No</th>
                <th field="InvoiceDateInString" width="10%" align="center">Invoice Date</th>
                <th field="InvoiceTypeSt" width="10%" align="center">Invoice Type</th>
                <th field="CurrentStatusInSt" width="12%" align="left">Current Status</th>
                <th field="BankStatusInSt" width="12%" align="left">Bank Status</th>
                <th field="LCPaymentType" width="10%" align="left">Payment Type</th>

                <th field="ImportLCNo" width="12%" align="left">L/C No</th>
                <th field="AmountSt" width="10%" align="right"> Value</th>
                <th field="ImportLCDateInString" width="10%" align="center">L/C Date</th>
                <th field="ContractorName" width="20%" align="left">Applicant Name</th>
                <th field="BankName_Nego" width="15%" align="left">Negotiate Bank</th>

                <th field="BLNo" width="10%" align="left">BL No</th>
                <th field="BLDateSt" width="10%" align="center">BL Date</th>
                <th field="ETADateSt" width="10%" align="center">ETA Date</th>
                <th field="DateofNegotiationInST" width="12%" align="center">Negotiation Date</th>
                <th field="DateofAcceptanceSt" width="15%" align="left">Acceptance Date</th>
                <th field="AcceptedByName" width="10%" align="left">Accepted By</th>
                <th field="DateofMaturityST" width="10%" align="center">Maturity Date</th>
                <th field="DateofPaymentSt" width="10%" align="center">Bill Payment Date</th>
            </tr>
        </thead>
    </table>
    <div id="toolbar">
        <a id="btnReload" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-reload" plain="true"></a>
        <input type="text" id="txtSearchbyLCNo" placeholder="Search by LC No" style="width:120px" />
        <input type="text" id="txtSearchbyInvoiceNo" placeholder="Search by Invoice No" style="width:120px" />
        <a id="btnSearch" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-search" plain="true">Adv. Search</a>
        @*<a id="btnAdd" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-add" plain="true" onclick="Add()">Add</a>*@
        <a id="btnEdit" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-edit" plain="true" onclick="Edit()">Edit</a>
        <a id="btnView" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-details" plain="true" onclick="View()">View</a>
        <a id="btnDelete" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-remove" plain="true" onclick="Delete()">Delete</a>
        <a id="btnDocRelease" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-ok" plain="true">Doc Release</a>
        <a id="btnAcceptanceApprove" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-approved" plain="true">Acceptance</a>
        <a id="btnPackingList" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-add" plain="true">Packing List</a>
        <a id="btnImportBL" href="javascript:void(0)"  class="easyui-linkbutton" iconcls="icon-ok" plain="true">BL Entry</a>
        <a id="btnSendToCnF" href="javascript:void(0)"  class="easyui-linkbutton" iconcls="icon-ok" plain="true">Send To Cnf</a>
        <a id="btnCustomInfo" href="javascript:void(0)"  class="easyui-linkbutton" iconcls="icon-edit" plain="true">Custom Info</a>
        <a id="btnPrintGRN" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-print" plain="true">Print Challan</a>
        <a id="btnAttachment" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-attachment" plain="true" onclick="Attchment()">Attchment</a>
        <a id="btnInvoiceStatusUpdate" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-add" plain="true">Status Change</a>
        <a id="btnInvoiceCommissionUpdate" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-edit" plain="true">Commission</a>
    </div>
</div>
<div id="winAdvSearchImportInvoice" class="easyui-window winClass" title="Advance Search" data-options="modal:true,closed:true,collapsible:false,minimizable:false,maximizable:false,closable:false">
    <div style="width:800px; float: left;">
        <table border="0" cellpadding="2" cellspacing="2" style="font-size: 12px;width:100%">
            <tr>
                <td style="width:100%;">
                    <fieldset>
                        <legend style="font-weight: bold; font-size: 12px">Searching Criteria : </legend>
                        <table border="0" cellpadding="2" cellspacing="2" style="width:100%; font-size: 12px">
                            <tr>
                                <td style="width:15%; text-align: right; font-weight: bold">
                                    Invoice No:
                                </td>
                                <td style="width:50%; text-align: left">
                                    @Html.TextBox("txtImportInvoiceNo_Adv", "", new { style = "width:90%", id = "txtImportInvoiceNo_Adv" })
                                </td>
                                @*<td style="width: 7%; text-align: right; font-weight: bold" rowspan="9">
                                   
                                </td>*@
                                <td style="width: 30%; text-align: left; font-size: 12px" rowspan="12">
                                    <table id="tblCurrentStatusAdvSearch" class="easyui-datagrid" title=" Status " style="width:100%; height:320px;" data-options="singleSelect: false,fitColumns:false, rownumbers:true, pagination:false, autoRowHeight:false">
                                        <thead>
                                            <tr>
                                                <th data-options="field:'Selected',checkbox:true"></th>
                                                <th field="Value" width="80%">Status Name</th>
                                            </tr>
                                        </thead>
                                    </table>
                                </td>
                            </tr>
                            <tr>
                                <td style="width:15%; text-align: right; font-weight: bold">
                                    L/C No:
                                </td>
                                <td style="width: 50%; text-align: left">
                                    @Html.TextBox("txtImportLCNo_Adv", "", new { style = "width:90%", id = "txtImportLCNo_Adv" })
                                </td>
                            </tr>
                            <tr>

                                <td style="width: 15%; text-align: right; font-weight: bold">
                                    Supplier :
                                </td>
                                <td style="width: 50%; text-align: left">
                                    @Html.TextBox("txtSupplier", "", new { style = "width: 72%", id = "txtSupplier", placeholder = "Type Supplier & Press Enter" }) <input type="button" style="width:20px; font-size: 12px" id="btnClnSupplier" value="C" /> <input type="button" style="width:33px; font-size: 12px" id="btnSupplierPicker" value="Pick" />
                                </td>
                            </tr>
                                                  
                                                  
                            <tr>
                                <td style="width: 15%; text-align: right; font-weight: bold">
                                    Invoice Date:
                                </td>
                                <td style="width:50%; text-align: left; font-size: 12px">
                                    <select id="cboDateSearch" onchange="DateActionsInvoiceDateAdvSearch()" style="width:100px;text-align:left"></select>
                                    <input id="txtStartDate" type="text" class="easyui-datebox" required="required" data-options="formatter:icsdateformat,parser:icsdateparser" style="width: 98px;" />To
                                    <input id="txtEndDate" type="text" class="easyui-datebox" required="required" data-options="formatter:icsdateformat,parser:icsdateparser" style="width: 98px;" />
                                </td>
                            </tr>


                            <tr>
                                <td style="width: 15%; text-align: right; font-weight: bold">
                                    Receive Date:
                                </td>
                                <td style="width: 50%; text-align: left; font-size: 12px">
                                    <select id="cboReceiveDateSearch" onchange="DateActionsReceiveDateAdvSearch()" style="width:100px;text-align:left"></select>
                                    <input id="txtReceiveStartDate" type="text" class="easyui-datebox" required="required" data-options="formatter:icsdateformat,parser:icsdateparser" style="width: 98px;" />To
                                    <input id="txtReceiveEndDate" type="text" class="easyui-datebox" required="required" data-options="formatter:icsdateformat,parser:icsdateparser" style="width: 98px;" />
                                </td>

                            </tr>
                                                  
                            <tr>
                                <td style="width: 15%; text-align: right; font-weight: bold">
                                    Maturity Date:
                                </td>
                                <td style="width: 50%; text-align: left; font-size: 12px">
                                    <select id="cboMaturityDateSearch" onchange="DateActionsMaturityDateAdvSearch()" style="width:100px;text-align:left"></select>
                                    <input id="txtMaturityStartDate" type="text" class="easyui-datebox" required="required" data-options="formatter:icsdateformat,parser:icsdateparser" style="width: 98px;" />To
                                    <input id="txtMaturityEndDate" type="text" class="easyui-datebox" required="required" data-options="formatter:icsdateformat,parser:icsdateparser" style="width: 98px;" />
                                </td>
                            </tr>
                                           
                            <tr>
                                <td style="width: 15%; text-align: right; font-weight: bold">
                                    Negotiation Date:
                                </td>
                                <td style="width: 50%; text-align: left; font-size: 12px">
                                    <select id="cboNegotiationDateSearch" onchange="DateActionsNegotiationDateAdvSearch()" style="width:100px;text-align:left"></select>
                                    <input id="txtNegotiationStartDate" type="text" class="easyui-datebox" required="required" data-options="formatter:icsdateformat,parser:icsdateparser" style="width: 98px;" />To
                                    <input id="txtNegotiationEndDate" type="text" class="easyui-datebox" required="required" data-options="formatter:icsdateformat,parser:icsdateparser" style="width: 98px;" />
                                </td>
                            </tr>

                            <tr>
                                <td style="width: 15%; text-align: right; font-weight: bold">
                                    Acceptance Date:
                                </td>
                                <td style="width: 50%; text-align: left; font-size: 12px">
                                    <select id="cboAcceptanceDateSearch" onchange="DateActionsAcceptanceDateAdvSearch()" style="width:100px;text-align:left"></select>
                                    <input id="txtAcceptanceStartDate" type="text" class="easyui-datebox" required="required" data-options="formatter:icsdateformat,parser:icsdateparser" style="width: 98px;" />To
                                    <input id="txtAcceptanceEndDate" type="text" class="easyui-datebox" required="required" data-options="formatter:icsdateformat,parser:icsdateparser" style="width: 98px;" />
                                </td>
                            </tr>

                            <tr>
                                <td style="width: 15%; text-align: right; font-weight: bold">
                                    Amount:
                                </td>
                                <td style="width: 50%; text-align: left; font-size: 12px">
                                    <select id="cboAmountSearch" onchange="ActionsAmountAdvSearch()" style="width:100px;text-align:left"></select>
                                    <input id="txtAmountStart" type="text" style="width: 94px;" />To
                                    <input id="txtAmountEnd" type="text" style="width: 94px;" />
                                </td>
                            </tr>
                            <tr>
                                <td style="width: 15%; text-align: right; font-weight: bold">
                                    Product Type:
                                </td>
                                <td style="width: 50%; text-align: left; font-size: 12px">
                                    <select id="cboImportProducts" style="width:80%"></select>
                                </td>
                            </tr>
                            <tr>
                                <td style="width: 15%; text-align: right; font-weight: bold">
                                    PI Type:
                                </td>
                                <td style="width: 50%; text-align: left; font-size: 12px">
                                    <select id="cboImportPIType" style="width:80%"></select>
                                </td>
                            </tr>
                            <tr>
                                <td style="width: 15%; text-align: right; font-weight: bold">
                                    Bank Status:
                                </td>
                                <td style="width: 50%; text-align: left; font-size: 12px">
                                    <input id="cboBankStatusAdv" class="easyui-combobox" data-options="valueField: 'id',textField: 'text',multiple:true" style="width:82%" />
                                </td>
                            </tr>
                            <tr>
                                <td style="width: 15%; text-align: right; font-size: 11px;font-weight: bold">
                                    Waiting For Maturity:
                                </td>
                                <td style="width: 50%; text-align: left; ">
                                    <input type="checkbox" id="chkIsWaiting" />
                                </td>
                            </tr>
                            <tr>
                                <td style="width: 65%; text-align: left; font-weight: bold" colspan="2">
                                    <fieldset style="width:465px;">
                                        <legend style="font-weight: bold">Criteria : </legend>
                                        <table id="tblDateType">
                                            <tr>
                                                <td style="font-size:12px;text-align:right;">
                                                    <label>Date Type :</label>
                                                </td>
                                                <td>
                                                    <select id="cboDateCriteria" style="width: 352px;">
                                                        <option value="None">--Select One--</option>
                                                        <option value="DateOfTakeOutDoc">Doc Release Date</option>
                                                        <option value="DateofApplication">Application Date</option>
                                                        <option value="DateofBankInfo">Letter Issue Date</option>
                                                        <option value="DateofPayment">Payment Date</option>
                                                        <option value="DeliveryDate">Delivery Date</option>
                                                      
                                                        <option value="ImportLCDate">LC Date</option>

                                                        <option value="CnFSendDate">CnF Send Date</option>
                                                        <option value="PackDate">Packing Date</option>

                                                        <option value="ETADate">ETA Date</option>
                                                        <option value="ShipmentDate">Shipment Date</option>
                                                        <option value="BLDate">BL Date</option>

                                                        <option value="PositionJTDate">Position on JT</option>
                                                        <option value="PositionOuterDate">Position on Outer</option>
                                                        <option value="NotingDate">Noting Date</option>
                                                        <option value="BillofEntryDate">Bill of Entry</option>
                                                        <option value="AssesmentDate">Assesment Date</option>
                                                        <option value="ExamineDate">Examine Date</option>
                                                        <option value="DOReceiveFromDate">Indent for Delivery</option>
                                                        <option value="DeliveryNoticeDate">Delivery Notice Date</option>
                                                    </select>
                                                </td>
                                            </tr>
                                            <tr>
                                                <td style="font-size:12px;text-align:right;width:100px;">
                                                    <label>Date :</label>
                                                </td>
                                                <td>
                                                    <select id="cboImportDate" onchange="DateActions_Import()" style="width:100px;font-size:12px;"></select>
                                                    <input id="txtImportDateStart" type="text" style="width: 110px;" class="easyui-datebox" required="required" data-options="formatter:icsdateformat,parser:icsdateparser" />
                                                    To
                                                    <input id="txtImportDateEnd" type="text" style="width: 110px;" class="easyui-datebox" required="required" data-options="formatter:icsdateformat,parser:icsdateparser" />
                                                </td>
                                            </tr>
                                        </table>
                                    </fieldset>
                                </td>
                            </tr>
                        </table>
                    </fieldset>
                </td>
            </tr>
        </table>

        <fieldset class="actionfieldsetstyle">
            <legend>Actions : </legend>
            <a id="btnExcel" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-excel" plain="true">Import To Excel</a>
            <label class="lblLoadingMessage" style="float:left;">Loading Please Wait...</label>
            <a id="btnReset" href="javascript:void(0)" class="easyui-linkbutton" onclick="Reset()" iconcls="icon-reload" plain="true">Reset</a>
            <a id="btnRefresh" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-search" plain="true">Search</a>
            <a id="btnSearchClose" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-cancel" plain="true">Close</a>
        </fieldset>
    </div>
</div>
   <div id="winImportInvoiceStatus" class="easyui-window" title="Invoice Status Change" data-options="modal:true,closed:true,collapsible:false,minimizable:false,maximizable:false,closable:true">

                          <div id="divInvoiceStatusUpdate">
                              <table>
                                  <tr>
                                      <td style="width:120px; text-align:right">
                                          Current Status
                                      </td>
                                      <td style="width:150px;text-align:left">
                                          <select id="cboInvoiceStatus" style="width: 150px;"></select>
                                      </td>
                                  </tr>
                                  <tr>

                                      <td style="width:120px; text-align:right">
                                          Bank Status
                                      </td>
                                      <td style="width:150px;text-align:left">
                                          <select id="cboBankStatus" style="width: 150px;"></select>
                                      </td>

                                  </tr>
                                  <tr>
                                      <td style="width:120px; text-align:right">
                                          Remark
                                      </td>
                                      <td style="width:150px">
                                          <input type="text" style="width:150px;" id="txtNoteUpdateStatus" />
                                      </td>
                                  </tr>
                              </table>

                          </div>
                          <fieldset class="actionfieldsetstyle">
                              <legend>Actions : </legend>
                              <a id="btnSaveImportInvoiceStatus" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-save" plain="true">Save</a>
                              <a id="btnCloseImportInvoiceStatus" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-cancel" plain="true">Close</a>
                          </fieldset>
                      </div>
                      <div id="winImportInvoiceCommission" class="easyui-window" title="Invoice Commission Change" data-options="modal:true,closed:true,collapsible:false,minimizable:false,maximizable:false,closable:true">
                          <div id="divInvoiceCommissionUpdate">
                              <table border="0" cellpadding="1" cellspacing="1" width="100%" >
                                  <tr>
                                      <td style="width:120px; text-align:right">
                                          LC No
                                      </td>
                                      <td style="width:300px;text-align:left">
                                          <input type="text" style="width:300px;" id="txtLCNo" disabled />
                                      </td>
                                  </tr>
                                  <tr>
                                      <td style="width:120px; text-align:right">
                                          LC Value
                                      </td>
                                      <td style="width:300px;text-align:left">
                                          <table border="0" cellpadding="0" cellspacing="0">
                                              <tr>
                                                  <td style="width:10%;"><input type="text" style="width:100%;text-align:right;" id="txtLCCurrency" disabled /></td>
                                                  <td style="width:90%;"><input type="text" style="width:100%;text-align:right;" id="txtLCValue" disabled /></td>
                                               </tr>
                                          </table>
                                      </td>
                                  </tr>
                                  <tr>
                                      <td style="width:120px; text-align:right">
                                          Invoice No
                                      </td>
                                      <td style="width:300px;text-align:left">
                                          <input type="text" style="width:300px;" id="txtInvoiceNo" disabled />
                                      </td>
                                  </tr>
                                  <tr>
                                      <td style="width:120px; text-align:right">
                                          Supplier
                                      </td>
                                      <td style="width:300px;text-align:left">
                                          <input type="text" style="width:300px;" id="txtSupplierName" disabled />
                                      </td>
                                  </tr>
                                  <tr>
                                      <td style="width:120px; text-align:right">
                                          Invoice Amount
                                      </td>
                                      <td style="width:300px;text-align:left">
                                          <table border="0" cellpadding="0" cellspacing="0">
                                              <tr>
                                                  <td style="width:10%;"><input type="text" style="width:100%;text-align:right;" id="txtInvoiceCurrency" disabled /></td>
                                                  <td style="width:90%;"><input type="text" style="width:100%;text-align:right;" id="txtInvoiceValue" disabled /></td>
                                              </tr>
                                          </table>
                                      </td>
                                  </tr>
                                  <tr>
                                      <td style="width:120px; text-align:right">
                                          Commission
                                      </td>
                                      <td style="width:300px;text-align:left">
                                          <table border="0" cellpadding="0" cellspacing="0">
                                              <tr>
                                                  <td style="width:10%;"><input type="text" style="width:100%;text-align:right;" id="txtCommissionCurrency" disabled /></td>
                                                  <td style="width:40%;"><input type="text" style="width:100%;text-align:right;" id="txtCommission" /></td>
                                                  <td style="width:10%;"><input type="text" style="width:100%;text-align:right;" id="txtInvoiceCPercent" value="%" disabled /></td>
                                                  <td style="width:40%;"><input type="text" style="width:100%;text-align:right;" id="txtCommissionInPercent" /></td>
                                              </tr>
                                          </table>
                                      </td>
                                  </tr>
                                  <tr>
                                      <td style="width:120px; text-align:right">
                                          Remarks
                                      </td>
                                      <td style="width:300px;text-align:left">
                                          <input type="text" style="width:300px;" id="txtCommissionRemarks"  />
                                      </td>
                                  </tr>
                              </table>

                          </div>
                          <fieldset class="actionfieldsetstyle">
                              <legend>Actions : </legend>
                              <a id="btnSaveImportInvoiceCommission" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-save" plain="true">Save</a>
                              <a id="btnCloseImportInvoiceCommission" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-cancel" plain="true">Close</a>
                          </fieldset>
                      </div>


    <script type="text/javascript">
    var _sBaseAddress="";
    var _oImportInvoices=[];
    var _oImportInvoice=null;
    var _ImportInvoices =[];
    var _oAuthorizationRolesMappings =[];
    var _nContractorIDs="";
    $(document).ready(function()
    {
        _sBaseAddress =@Html.Raw( new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(HttpContext.Current.Session[SessionInfo.BaseAddress]));
        _oAuthorizationRolesMappings =@Html.Raw( new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(HttpContext.Current.Session[SessionInfo.AuthorizationRolesMapping]));
        _oImportInvoices =@Html.Raw( new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(Model));
        var BUID=@Html.Raw( new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(ViewBag.BUID));
        var oInvoiceStatusObjs = @Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(ViewBag.InvoiceStatusObjs));
        var oInvoiceBankStatusObjs = @Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(ViewBag.InvoiceBankStatusObjs));
        var oImportProducts = @Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(ViewBag.ImportProducts));
        var oImportPITypes= @Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(ViewBag.ImportPITypeObj));
        DynamicRefreshList(oInvoiceStatusObjs, "tblCurrentStatusAdvSearch");
        $("#cboInvoiceStatus").icsLoadCombo({List: oInvoiceStatusObjs,  OptionValue: "id", DisplayText: "Value"});
        $("#cboBankStatus").icsLoadCombo({List: oInvoiceBankStatusObjs,  OptionValue: "id", DisplayText: "Value"});
        LoadBankStatusAdv(oInvoiceBankStatusObjs);
        $("#cboImportProducts").icsLoadCombo({ List: oImportProducts, OptionValue: "ProductTypeInt", DisplayText: "Name" });
        $("#cboImportPIType").icsLoadCombo({List: oImportPITypes,OptionValue: "id",DisplayText: "Value"});
        sessionStorage.setItem('BUID',BUID);
        debugger;
        $('#txtAmountStart,#txtAmountEnd').icsCurrencyBox();
        var oImportInvoices =sessionStorage.getItem("ImportInvoices");
        var nIndex =sessionStorage.getItem("SelectedRowIndex");

        if(oImportInvoices!=null)
        {
            oImportInvoices = jQuery.parseJSON(oImportInvoices);
        }
        else
        {
            oImportInvoices = _oImportInvoices;
        }

        DynamicRefreshList(oImportInvoices,'tblImportInvoice');
        LoadFooter(oImportInvoices);
        $('#tblImportInvoice').datagrid({onSelect: function(rowIndex, rowData){ RowSelect(rowIndex, rowData);}});
        if(nIndex!=null && nIndex!=-1)
        {
            $('#tblImportInvoice').datagrid('selectRow', nIndex);
        }

        debugger;
        //var oImportInvoice = JSON.parse(sessionStorage.getItem("ImportInvoice"));
        //if(oImportInvoice !=null)
        //{
        //    $('#tblImportInvoice').datagrid('updateRow',{
        //        index: nIndex, row:oImportInvoice});
        //}
        $('#divImportInvoices').data('InvoiceStatus',oInvoiceStatusObjs);
        $('#divImportInvoices').data('SupplierIDs',"");
        $(".lblLoadingMessage").hide();
        //$('#btnSendToCnF,#btnImportBL,#btnCustomInfo,#btnAcceptanceApprove').hide();
        $('#btnInvoiceCommissionUpdate').hide();
        if(PermissionChecker('Commission','ImportInvoice',_oAuthorizationRolesMappings)){$('#btnInvoiceCommissionUpdate').show();}
    });

        function LoadBankStatusAdv(oInvoiceBankStatusObjs)
        {
            var oStyleTypes = [];
            for(var i = 0;i<oInvoiceBankStatusObjs.length;i++)
            {
                var oStyleType = {id:''+oInvoiceBankStatusObjs[i].id, text:''+oInvoiceBankStatusObjs[i].Value};
                oStyleTypes.push(oStyleType);
            }
            $('#cboBankStatusAdv').combobox('loadData',oStyleTypes);
        }

    function RowSelect(rowIndex, rowData)
    {
        debugger;
        console.log(rowData);
        $('#btnSendToCnF,#btnImportBL,#btnCustomInfo,#btnAcceptanceApprove').hide();
        $('#btnDocRelease').show();
        //if(parseInt(rowData.InvoiceStatusInt)>=2)//Shipment Done
        //{
        //    $('#btnImportBL').show();
        //    $("lblBLEntry").css("color", "green");
        //}

        if(parseInt(rowData.InvoiceStatusInt)==1)//Initialize
        {
            $('#btnAcceptanceApprove').hide();
            $('#btnDelete').show();
        }
        else if(parseInt(rowData.InvoiceStatusInt)==2)//Shipment Done
        {
            $('#btnInvoiceAcceptance,#btnSendToCnF').show();
            $('#btnDelete').hide();
        }
        else if(parseInt(rowData.InvoiceStatusInt)>=2)//Doc Receive by Bank
        {
            $('#btnDelete').hide();
        }

        if(parseInt(rowData.InvoiceTypeInt)==1)
        {
            if(parseInt(rowData.InvoiceStatusInt)>=1)//Shipment Done
            {
                $('#btnImportBL').show();
            }
            if(parseInt(rowData.InvoiceStatusInt)>=2)//Shipment Done
            {
                $('#btnSendToCnF').show();

            }
            if(parseInt(rowData.InvoiceStatusInt)>=5)//Doc In CnF
            {
                $('#btnCustomInfo').show();
            }
        }
        if(parseInt(rowData.InvoiceTypeInt)==1||parseInt(rowData.InvoiceTypeInt)==2|| parseInt(rowData.InvoiceTypeInt)==3|| parseInt(rowData.InvoiceTypeInt)==6)
        {
            $('#btnDocRelease,#btnAcceptanceApprove').show();
        }
        //if(parseInt(rowData.LCPaymentTypeInt)==1)
        //{
        //    $('#btnDocRelease').show();
        //}
    }

    $('#btnReload').click(function(e){
        window.location.href =window.location.href;
    });

    $('#btnAdd').click(function(e){
        sessionStorage.setItem("ImportLCHeader", "Add Invoice");
        sessionStorage.setItem("BackLink", window.location.href);
        window.location.href = _sBaseAddress+ "/ImportInvoice/ViewLCWiseInvoices?nLCID=0";
    });

    $('#btnEdit').click(function(e){
        var oImportInvoice=$('#tblImportInvoice').datagrid('getSelected');
        var nSelectedIndex= $('#tblImportInvoice').datagrid('getRowIndex',oImportInvoice);
        if(oImportInvoice==null || oImportInvoice.ImportInvoiceID<=0)
        {
            alert("Please select a item from list!");
            return;
        }
        if(parseInt(oImportInvoice.BankStatusInt)>=3)
        {
            alert("You Can't Edit this Moment. Already IBP Create.");
            return;
        }
        var oImportInvoices= $('#tblImportInvoice').datagrid('getRows');
        sessionStorage.setItem("ImportInvoices", JSON.stringify(oImportInvoices));
        sessionStorage.setItem("SelectedRowIndex", nSelectedIndex);
        sessionStorage.setItem("ImportInvoiceHeader", "Edit Import Invoice");
        sessionStorage.setItem("BackLinkForInvoice", window.location.href);
        window.location.href = _sBaseAddress+ "/ImportInvoice/ViewImportInvoice?id="+oImportInvoice.ImportInvoiceID+"&nLCID=0";
    });

    $('#btnView').click(function(e){
        var oImportInvoice=$('#tblImportInvoice').datagrid('getSelected');
        var nSelectedIndex= $('#tblImportInvoice').datagrid('getRowIndex',oImportInvoice);

        if(oImportInvoice==null || oImportInvoice.ImportInvoiceID<=0)
        {
            alert("Please select a item from list!");
            return;
        }
        var tsv=((new Date()).getTime())/1000;
        var oImportInvoices= $('#tblImportInvoice').datagrid('getRows');
        sessionStorage.setItem("ImportInvoices", JSON.stringify(oImportInvoices));
        sessionStorage.setItem("SelectedRowIndex", nSelectedIndex);
        sessionStorage.setItem("ImportInvoiceHeader", "View Import Invoice");
        sessionStorage.setItem("BackLinkForInvoice", window.location.href);
        window.location.href = _sBaseAddress+ "/ImportInvoice/ViewImportInvoice?id="+oImportInvoice.ImportInvoiceID+"&nLCID=0";
    });

    $('#btnDelete').click(function(e){
        var oImportInvoice=$('#tblImportInvoice').datagrid('getSelected');
        var nSelectedIndex= $('#tblImportInvoice').datagrid('getRowIndex',oImportInvoice);
        if(oImportInvoice==null || oImportInvoice.ImportInvoiceID<=0)
        {
            alert("Please select a item from list!");
            return;
        }
        if(parseInt(oImportInvoice.InvoiceStatusInt)>1)
        {
            alert("Please select Only Initialize Item from List.");
            return;
        }
        if (!confirm("Confirm to Delete?")) return ;
        var SelectedRowIndex=$('#tblImportInvoice').datagrid('getRowIndex',oImportInvoice);
        if (oImportInvoice.ImportInvoiceID > 0)
        {
            $.ajax
            ({
                type: "POST",
                dataType: "json",
                url : _sBaseAddress+  "/ImportInvoice/Delete",
                traditional: true,
                data:  JSON.stringify(oImportInvoice),
                contentType: "application/json; charset=utf-8",
                success: function (data) {
                    feedbackmessage = jQuery.parseJSON(data);
                    if (feedbackmessage == "Deleted")
                    {
                        $('#tblImportInvoice').datagrid('deleteRow',SelectedRowIndex);
                        alert("Delete sucessfully");
                    }
                    else
                    {
                        alert(feedbackmessage);
                    }
                },
                error: function (xhr, status, error)
                {
                    alert(error);
                }
            });
        }
    });

    $("#btnSendToCnF").click(function(){
        var oInvoice = $('#tblImportInvoice').datagrid('getSelected');
        if(oInvoice===null || parseInt(oInvoice.ImportInvoiceID)<=0)
        {
            alert("Please select an Invoice from List!");
            return;
        }

        var tsv=((new Date()).getTime())/1000;
        var SelectedRowIndex=$('#tblImportInvoice').datagrid('getRowIndex',oInvoice);
        var oInvoices = $('#tblImportInvoice').datagrid('getRows');
        sessionStorage.setItem("ImportInvoices", JSON.stringify(oInvoices));
        sessionStorage.setItem("SelectedRowIndex", SelectedRowIndex);
        sessionStorage.setItem("SelectedRowIndexInvoiceHeader", "SendToCnf");
        sessionStorage.setItem("BackLink", window.location.href);
        window.location.href = _sBaseAddress+  "/ImportInvoice/ViewSendToCnf?id="+parseInt(oInvoice.ImportInvoiceID)+"&ts="+tsv;
    });
    $("#btnDocRelease").click(function(){
        var oInvoice = $('#tblImportInvoice').datagrid('getSelected');
        if(oInvoice===null || parseInt(oInvoice.ImportInvoiceID)<=0)
        {
            alert("Please select an Invoice from List!");
            return;
        }

        var tsv=((new Date()).getTime())/1000;
        var SelectedRowIndex=$('#tblImportInvoice').datagrid('getRowIndex',oInvoice);
        var oInvoices = $('#tblImportInvoice').datagrid('getRows');
        sessionStorage.setItem("ImportInvoices", JSON.stringify(oInvoices));
        sessionStorage.setItem("SelectedRowIndex", SelectedRowIndex);
        sessionStorage.setItem("SelectedRowIndexInvoiceHeader", "Doc Release");
        sessionStorage.setItem("BackLink", window.location.href);
        window.location.href = _sBaseAddress+  "/ImportInvoice/ViewDocRelease?id="+parseInt(oInvoice.ImportInvoiceID)+"&ts="+tsv;
    });

    $("#btnImportBL").click(function(){
        var oInvoice = $('#tblImportInvoice').datagrid('getSelected');
        if(oInvoice===null || parseInt(oInvoice.ImportInvoiceID)<=0)
        {
            alert("Please select an Invoice from List!");
            return;
        }

        var tsv=((new Date()).getTime())/1000;
        var SelectedRowIndex=$('#tblImportInvoice').datagrid('getRowIndex',oInvoice);
        var oInvoices = $('#tblImportInvoice').datagrid('getRows');
        sessionStorage.setItem("ImportInvoices", JSON.stringify(oInvoices));
        sessionStorage.setItem("SelectedRowIndex", SelectedRowIndex);
        sessionStorage.setItem("SelectedRowIndexInvoiceHeader", "Doc Release");
        sessionStorage.setItem("BackLink", window.location.href);
        window.location.href = _sBaseAddress+  "/ImportInvoice/ViewImportBL?id="+parseInt(oInvoice.ImportInvoiceID)+"&ts="+tsv;
    });

    $("#btnCustomInfo").click(function(){
        var oInvoice = $('#tblImportInvoice').datagrid('getSelected');
        if(oInvoice===null || parseInt(oInvoice.ImportInvoiceID)<=0)
        {
            alert("Please select an Invoice from List!");
            return;
        }
        //if(parseInt(oInvoice.InvoiceStatusInt)<5)// Send to cnf
        //{
        //    alert("Sorry, This Invoice yet to not Send Cnf.");
        //    return;
        //}
        var SelectedRowIndex=$('#tblImportInvoice').datagrid('getRowIndex',oInvoice);
        var oInvoices = $('#tblImportInvoice').datagrid('getRows');
        sessionStorage.setItem("ImportInvoices", JSON.stringify(oInvoices));
        sessionStorage.setItem("SelectedRowIndex", SelectedRowIndex);
        sessionStorage.setItem("SelectedRowIndexInvoiceHeader", "SendToCnf");
        sessionStorage.setItem("BackLink", window.location.href);
        window.location.href = _sBaseAddress+  "/ImportInvoice/ViewUpdateCustomInfo?id="+parseInt(oInvoice.ImportInvoiceID);
    });

    $("#btnPackingList").click(function(){
        var oInvoice = $('#tblImportInvoice').datagrid('getSelected');
        if(oInvoice===null || parseInt(oInvoice.ImportInvoiceID)<=0)
        {
            alert("Please select an Invoice from List!");
            return;
        }
        var SelectedRowIndex=$('#tblImportInvoice').datagrid('getRowIndex',oInvoice);
        var oInvoices = $('#tblImportInvoice').datagrid('getRows');
        sessionStorage.setItem("ImportInvoices", JSON.stringify(oInvoices));
        sessionStorage.setItem("SelectedRowIndex", SelectedRowIndex);
        sessionStorage.setItem("Header", "Packing List");
        sessionStorage.setItem("BackLink", window.location.href);
        window.location.href = _sBaseAddress+  "/ImportInvoice/ViewImportInvoicePackingList?id="+parseInt(oInvoice.ImportInvoiceID);
    });

    $("#btnAcceptanceApprove").click(function(){
        var oInvoice = $('#tblImportInvoice').datagrid('getSelected');
        if(oInvoice===null || parseInt(oInvoice.ImportInvoiceID)<=0)
        {
            alert("Please select an Invoice from List!");
            return;
        }

        var tsv=((new Date()).getTime())/1000;
        var SelectedRowIndex=$('#tblImportInvoice').datagrid('getRowIndex',oInvoice);
        var oInvoices = $('#tblImportInvoice').datagrid('getRows');
        sessionStorage.setItem("ImportInvoices", JSON.stringify(oInvoices));
        sessionStorage.setItem("SelectedRowIndex", SelectedRowIndex);
        sessionStorage.setItem("SelectedRowIndexInvoiceHeader", "InvoiceWaitForApprove");
        sessionStorage.setItem("BackLink", window.location.href);
        window.location.href = _sBaseAddress+  "/ImportInvoice/ViewImportInvoiceAcceptance?id="+oInvoice.ImportInvoiceID+"&bIsApprove=false&ts=" + tsv;
    });
    //function InvoiceAcceptance() {

    //    var oInvoice = $('#tblImportInvoice').datagrid('getSelected');
    //    if(oInvoice===null || parseInt(oInvoice.ImportInvoiceID)<=0)
    //    {
    //        alert("Please select an Invoice from List!");
    //        return;
    //    }
    //    var tsv=((new Date()).getTime())/1000;
    //    var SelectedRowIndex=$('#tblImportInvoice').datagrid('getRowIndex',oInvoice);
    //    var oInvoices = $('#tblImportInvoice').datagrid('getRows');
    //    sessionStorage.setItem("ImportInvoices", JSON.stringify(oInvoices));
    //    sessionStorage.setItem("SelectedRowIndexInvoice", SelectedRowIndex);
    //    sessionStorage.setItem("SelectedRowIndexInvoiceHeader", "InvoiceAcceptance");
    //    sessionStorage.setItem("BackLink", window.location.href);
    //    window.location.href = _sBaseAddress+  "/ImportInvoice/ViewImportInvoiceAcceptance?id="+oInvoice.ImportInvoiceID+"&bIsMaturity=true&ts=" + tsv;
    //}
    //function InvoiceAcceptance_WaitForMaturity() {

    //    var oInvoice = $('#tblImportInvoice').datagrid('getSelected');
    //    if(oInvoice===null || parseInt(oInvoice.ImportInvoiceID)<=0)
    //    {
    //        alert("Please select an Invoice from List!");
    //        return;
    //    }
    //    var tsv=((new Date()).getTime())/1000;
    //    var SelectedRowIndex=$('#tblImportInvoice').datagrid('getRowIndex',oInvoice);
    //    var oInvoices = $('#tblImportInvoice').datagrid('getRows');
    //    sessionStorage.setItem("ImportInvoices", JSON.stringify(oInvoices));
    //    sessionStorage.setItem("SelectedRowIndexInvoice", SelectedRowIndex);
    //    sessionStorage.setItem("SelectedRowIndexInvoiceHeader", "InvoiceWaitForMaturity");
    //    sessionStorage.setItem("BackLink", window.location.href);
    //    window.location.href = _sBaseAddress+  "/ImportInvoice/ViewImportInvoiceAcceptance?id="+oInvoice.ImportInvoiceID+"&bIsMaturity=false&ts=" + tsv;
    //}



    $('#txtSearchbyInvoiceNo').keypress(function (e)
    {
        var code = (e.keyCode ? e.keyCode : e.which);
        var spInvoiceNo=document.getElementById("txtSearchbyInvoiceNo").value;
        if (code == 13)//Enter key-13
        {
            if(spInvoiceNo=="")
            {
                alert("Please Enter Invoice No !");
                return;
            }
            var tsv=((new Date()).getTime())/1000;

            $.ajax
            ({
                type: "GET",
                dataType: "json",
                url : _sBaseAddress+  "/ImportInvoice/GetbyPInvoiceNo",
                data: { PInvoiceNo:spInvoiceNo,BUID:sessionStorage.getItem('BUID'), ts:parseFloat(tsv)},
                contentType: "application/json; charset=utf-8",
                success: function (data) {
                    //
                    var oImportInvoices = jQuery.parseJSON(data);
                    if (oImportInvoices.length>0)
                    {
                        DynamicRefreshList(oImportInvoices,'tblImportInvoice');
                        // LoadGrid(oImportInvoices);
                        LoadFooter(oImportInvoices);
                    }
                    else
                    {
                        oImportInvoices=[];
                        //LoadintoGrid(oImportInvoices);
                        DynamicRefreshList(oImportInvoices,'tblImportInvoice');
                        LoadFooter(oImportInvoices);
                        alert("Not found");
                    }

                },
                error: function (xhr, status, error)
                {
                    alert(error);
                }

            });


        }
    });

    $('#txtSearchbyLCNo').keypress(function (e)
    {
        var code = (e.keyCode ? e.keyCode : e.which);
        var sPLCNo=document.getElementById("txtSearchbyLCNo").value;

        if (code == 13)//Enter key-13
        {
            if(sPLCNo=="")
            {
                alert("Please Enter LC No !");
                return;
            }
            var tsv=((new Date()).getTime())/1000;

            $.ajax
            ({
                type: "GET",
                dataType: "json",
                url : _sBaseAddress+  "/ImportInvoice/GetbyLCNo",
                data: { PLCNo:sPLCNo,BUID:sessionStorage.getItem('BUID'),ts:parseFloat(tsv)},
                contentType: "application/json; charset=utf-8",
                success: function (data) {
                    //
                    var oImportInvoices = jQuery.parseJSON(data);
                    if (oImportInvoices.length>0)
                    {
                        DynamicRefreshList(oImportInvoices,'tblImportInvoice');
                        // LoadGrid(oImportInvoices);
                        LoadFooter(oImportInvoices);
                    }
                    else
                    {
                        oImportInvoices=[];
                        LoadintoGrid(oImportInvoices);
                        LoadFooter(oImportInvoices);
                        alert("Not found");
                    }

                },
                error: function (xhr, status, error)
                {
                    alert(error);
                }

            });
        }
    });

    function Attchment()
    {
        var oImportInvoice = $('#tblImportInvoice').datagrid('getSelected');
        if(oImportInvoice==null || parseInt(oImportInvoice.ImportInvoiceID)<=0)
        {
            alert("Please select a item from list!");
            return;
        }
        //EnumReftype
        window.open(_sBaseAddress + '/AttachDocument/Attachment?id='+oImportInvoice.ImportInvoiceID+'&RefType=14&OperationInfo= Attachment of Import Invoice No : '+oImportInvoice.ImportInvoiceNo, '_blank');
    }

    function LoadGrid(oImportInvoices) {
        var data = oImportInvoices;
        data = { "total": "" + data.length + "", "rows": data };
        $('#tblImportInvoice').datagrid('loadData', data);
        $('#tblImportInvoice').datagrid({ selectOnCheck: false, checkOnSelect: false });
    }

    function BankInfoCollect() {
        var oImportInvoice = $('#tblImportInvoice').datagrid('getSelected');
        var nSelectedIndex = $('#tblImportInvoice').datagrid('getRowIndex', oImportInvoice);
        var tsv = ((new Date()).getTime()) / 1000;
        var oParameter = new Object();
        oParameter.Name = " Import Invoice";
        var url = _sBaseAddress + "/ImportInvoice/ViewBankInfoCollect?id="+oImportInvoice.ImportInvoiceID+"&ts=" + tsv;
        var oImportInvoice = window.showModalDialog(url, oParameter, 'dialogHeight:360px;dialogWidth:520px;dialogLeft:400;dialogTop:100;center:yes;resizable:no;status:no;scroll:yes');
        if (oImportInvoice != null) {
            if (oImportInvoice.ImportInvoiceID > 0)
            {
                $('#tblImportInvoice').datagrid('updateRow', { index: nSelectedIndex, row: oImportInvoice });
                $('#tblImportInvoice').datagrid('selectRow', nSelectedIndex);
            }
        }
    }

    function TakeOutOrginalDoc() {
        var oImportInvoice = $('#tblImportInvoice').datagrid('getSelected');
        var nSelectedIndex = $('#tblImportInvoice').datagrid('getRowIndex', oImportInvoice);
        var tsv = ((new Date()).getTime()) / 1000;
        var oParameter = new Object();
        oParameter.Name = " Import Invoice";
        var url = _sBaseAddress + "/ImportInvoice/ViewTakeOutOrginalDoc?id="+oImportInvoice.ImportInvoiceID+"&ts=" + tsv;
        var oImportInvoice = window.showModalDialog(url, oParameter, 'dialogHeight:360px;dialogWidth:520px;dialogLeft:400;dialogTop:100;center:yes;resizable:no;status:no;scroll:yes');
        if (oImportInvoice != null) {

            if (oImportInvoice.ImportInvoiceID > 0)
            {

                $('#tblImportInvoice').datagrid('updateRow', { index: nSelectedIndex, row: oImportInvoice });
                $('#tblImportInvoice').datagrid('selectRow', nSelectedIndex);
            }
        }
    }




    $("#btnSearch").click(function () {
        $("#winAdvSearchImportInvoice").icsWindow('open', "Advance Search");
        Reset();
    });
    function RefreshDateSearch()
    {
        SetTodayDate();
        $('#cboDateCriteria').val(0);
        $('#cboDateSearch,#cboReceiveDateSearch,#cboMaturityDateSearch,#cboNegotiationDateSearch,#cboAcceptanceDateSearch,#cboAmountSearch,#cboImportDate').empty();
        var listDates = "<option value='"+"0"+"'>" + "None" + "</option>";
        listDates+= "<option value='"+"1"+"'>" + "EqualTo" + "</option>";
        listDates+= "<option value='"+"2"+"'>" + "Not EqualTo" + "</option>";
        listDates+= "<option value='"+"3"+"'>" + "Greater Than" + "</option>";
        listDates+= "<option value='"+"4"+"'>" + "Less Than" + "</option>";
        listDates+= "<option value='"+"5"+"'>" + "Between" + "</option>";
        $('#cboDateSearch,#cboReceiveDateSearch,#cboMaturityDateSearch,#cboNegotiationDateSearch,#cboAcceptanceDateSearch,#cboAmountSearch,#cboImportDate').html(listDates);
    }
    //Pick Supplier
    $("#txtSupplier").keydown(function (e) {

        var code = (e.keyCode ? e.keyCode : e.which);
        if (code == 13) // Enter Press
        {
            GetSuppliers($.trim($('#txtSupplier').val()));
        }
    });
    $("#btnSupplierPicker").click(function () {
        GetSuppliers("");
    });
    $('#txtSupplier').keydown(function (e) {
        var code = (e.keyCode ? e.keyCode : e.which);
        if (code == 8) //backspace=8
        {
            //
            var txtSupplierName = document.getElementById("txtSupplier");
            txtSupplierName.style.color = "black";
            txtSupplierName.style.fontWeight = "normal";
            $('#divImportInvoices').data('SupplierIDs',"");
        }
    });
    function GetSuppliers(sSuplierName)
    {
        var oContractor = { Params:1+'~'+sSuplierName+'~'+sessionStorage.getItem('BUID') };
        var obj = {
            BaseAddress: sessionStorage.getItem('BaseAddress'),
            Object: oContractor,
            ControllerName: "Contractor",
            ActionName: "ContractorSearchByNameType",
            IsWinClose: false
        };
        $.icsDataGets(obj, function (response) {

            if (response.status && response.objs.length > 0) {
                if (response.objs[0].ContractorID > 0) {

                    var tblColums = []; var oColumn = { field: "Name", title: "Name", width: 200, align: "left" }; tblColums.push(oColumn);
                    oColumn = { field: "ContractorTypeInString", title: "Type", width: 150, align: "left" }; tblColums.push(oColumn);
                    var oPickerParam = {
                        winid: 'winSupplier',
                        winclass: 'clsSupplier',
                        winwidth: 450,
                        winheight: 460,
                        tableid: 'tblBuyers',
                        tablecolumns: tblColums,
                        datalist: response.objs,
                        multiplereturn: true,
                        searchingbyfieldName: 'Name',
                        windowTittle: 'Contractor List'
                    };
                    $.icsPicker(oPickerParam);
                    IntializePickerbutton(oPickerParam);
                }
                else { alert(response.objs[0].ErrorMessage); }
            }
        });
    }

    //Refresh
    $('#btnRefresh').click(function () {
        debugger;
        /* Issue Date*/
        var nInvoiceDate = $('#cboDateSearch').val();
        var dIssueStartDate = $('#txtStartDate').datebox('getValue');
        var dIssueEndDate = $('#txtEndDate').datebox('getValue');

        /* Receive Date*/
        var nReceiveDate = $('#cboReceiveDateSearch').val();
        var dReceiveStartDate = $('#txtReceiveStartDate').datebox('getValue');
        var dReceiveEndDate = $('#txtReceiveEndDate').datebox('getValue');

        /* Maturity Date*/
        var nMaturityDate = $('#cboMaturityDateSearch').val();
        var dMaturityStartDate = $('#txtMaturityStartDate').datebox('getValue');
        var dMaturityEndDate = $('#txtMaturityEndDate').datebox('getValue');


        //DynamicDateActions("cboImportDate", "txtImportDateStart", "txtImportDateEnd");

        /* Negotiation Date*/
        var nNegotiationDate = $('#cboNegotiationDateSearch').val();
        var dNegotiationStartDate = $('#txtNegotiationStartDate').datebox('getValue');
        var dNegotiationEndDate = $('#txtNegotiationEndDate').datebox('getValue');

        /* Import Date*/
        var cboImportDate = $('#cboDateCriteria').val();
        var nImportDate = $('#cboImportDate').val();
        var dImportStartDate = $('#txtImportDateStart').datebox('getValue');
        var dImportEndDate = $('#txtImportDateEnd').datebox('getValue');

        /* Acceptance Date*/
        var nAcceptanceDate = $('#cboAcceptanceDateSearch').val();
        var dAcceptanceStartDate = $('#txtAcceptanceStartDate').datebox('getValue');
        var dAcceptanceEndDate = $('#txtAcceptanceEndDate').datebox('getValue');

        /* Amount*/
        var ncboAmount = $('#cboAmountSearch').val();
        var nProductType =  $('#cboImportProducts').val();
        var nAmountStart = $('#txtAmountStart').val();
        var nAmountEnd= $('#txtAmountEnd').val();

        var sImportInvoiceNo = $("#txtImportInvoiceNo_Adv").val();
        var sImportLCNo = $("#txtImportLCNo_Adv").val();
        var nImportPIType = $("#cboImportPIType").val();
        var bIsWaiting = false;
        if($('#chkIsWaiting').attr("checked"))
            bIsWaiting=true;

        var chkResult = CheckEmpty();
        if (chkResult!= true) {
            alert("Please Select at lease one Criteria !!");
            return;
        }
        $(".lblLoadingMessage").show();
        var sCurrentStatus = "";
        var oInvoiceStatus = $("#tblCurrentStatusAdvSearch").datagrid("getChecked");
        for (var i = 0; i < oInvoiceStatus.length; i++) {
            sCurrentStatus = oInvoiceStatus[i].id + "," +sCurrentStatus;
        }
        sCurrentStatus = sCurrentStatus.substring(0, sCurrentStatus.length - 1);

        var sBankStatusIDs = "";
        var oBankStatus = $('#cboBankStatusAdv').combobox('getValues');
        if(oBankStatus.length > 0){
            for(var i= 0;i<oBankStatus.length;i++){
                if(oBankStatus[i] != "" && oBankStatus[i] != null){
                    sBankStatusIDs += oBankStatus[i] + ",";
                }
            }
            if(sBankStatusIDs.length > 0)
                sBankStatusIDs = sBankStatusIDs.substring(0,sBankStatusIDs.length-1);
        }


        var sTempString = nInvoiceDate + '~' + dIssueStartDate + '~' + dIssueEndDate + '~' +nReceiveDate + '~' + dReceiveStartDate+ '~' + dReceiveEndDate+ '~' +nMaturityDate+ '~' + dMaturityStartDate + '~' + dMaturityEndDate+ '~' +nNegotiationDate+ '~' + dNegotiationStartDate+ '~' + dNegotiationEndDate+ '~'+nAcceptanceDate+ '~' + dAcceptanceStartDate+ '~' + dAcceptanceEndDate+'~'+ncboAmount+ '~' + nAmountStart+ '~' + nAmountEnd+ '~'  + sImportInvoiceNo + '~' +sImportLCNo+'~'+ $('#divImportInvoices').data('SupplierIDs')
                                       + '~' + sCurrentStatus+'~'+sessionStorage.getItem('BUID')+'~'+nProductType
                                       + '~' + cboImportDate+'~'+ nImportDate +'~'+ dImportStartDate+'~'+ dImportEndDate
                                       + '~' + nImportPIType+ '~' + bIsWaiting+ '~' + sBankStatusIDs;
        var oImportInvoice={ErrorMessage:sTempString};
        $.ajax({
            type: "POST",
            dataType: "json",
            url : _sBaseAddress+"/ImportInvoice/GetsSearchedData",
            traditional: true,
            data:  JSON.stringify(oImportInvoice),
            contentType: "application/json; charset=utf-8",
            success: function (data) {
                var oImportInvoices = jQuery.parseJSON(data);
                var oImportInvoices = data;
                if (oImportInvoices != null)
                {
                    if (oImportInvoices.length > 0)
                    {
                        DynamicRefreshList(oImportInvoices,'tblImportInvoice');
                        $("#winAdvSearchImportInvoice").icsWindow("close");
                        LoadFooter(oImportInvoices);
                    }
                    else {
                        alert("Data not found!!");
                        DynamicRefreshList([],'tblImportInvoice');
                        LoadFooter([]);
                    }
                }
                $(".lblLoadingMessage").hide();
            },
            error: function (xhr, status, error) {
                alert(error);
            }
        });

    });

    //Excel
    $('#btnExcel').click(function () {
        /* Issue Date*/
        var nInvoiceDate = $('#cboDateSearch').val();
        var dIssueStartDate = $('#txtStartDate').datebox('getValue');
        var dIssueEndDate = $('#txtEndDate').datebox('getValue');

        /* Receive Date*/
        var nReceiveDate = $('#cboReceiveDateSearch').val();
        var dReceiveStartDate = $('#txtReceiveStartDate').datebox('getValue');
        var dReceiveEndDate = $('#txtReceiveEndDate').datebox('getValue');

        /* Maturity Date*/
        var nMaturityDate = $('#cboMaturityDateSearch').val();
        var dMaturityStartDate = $('#txtMaturityStartDate').datebox('getValue');
        var dMaturityEndDate = $('#txtMaturityEndDate').datebox('getValue');

        /* Negotiation Date*/
        var nNegotiationDate = $('#cboNegotiationDateSearch').val();
        var dNegotiationStartDate = $('#txtNegotiationStartDate').datebox('getValue');
        var dNegotiationEndDate = $('#txtNegotiationEndDate').datebox('getValue');

        //Import Date
        var cboImportDate = $('#cboDateCriteria').val();
        var nImportDate = $('#cboImportDate').val();
        var dImportStartDate = $('#txtImportDateStart').datebox('getValue');
        var dImportEndDate = $('#txtImportDateEnd').datebox('getValue');

        /* Acceptance Date*/
        var nAcceptanceDate = $('#cboAcceptanceDateSearch').val();
        var dAcceptanceStartDate = $('#txtAcceptanceStartDate').datebox('getValue');
        var dAcceptanceEndDate = $('#txtAcceptanceEndDate').datebox('getValue');

        /* Amount*/
        var ncboAmount = $('#cboAmountSearch').val();
        var nProductType =  $('#cboImportProducts').val();
        var nAmountStart = $('#txtAmountStart').val();
        var nAmountEnd= $('#txtAmountEnd').val();

        var sImportInvoiceNo = $("#txtImportInvoiceNo_Adv").val();
        var sImportLCNo = $("#txtImportLCNo_Adv").val();
        var nImportPIType = $("#cboImportPIType").val();
        var bIsWaiting = false;
        if($('#chkIsWaiting').attr("checked"))
            bIsWaiting=true;

        var chkResult = CheckEmpty();
        if (chkResult!= true) {
            alert("Please Select at lease one Criteria !!");
            return;
        }
        //$(".lblLoadingMessage").show();
        var sCurrentStatus = "";
        var oInvoiceStatus = $("#tblCurrentStatusAdvSearch").datagrid("getChecked");
        for (var i = 0; i < oInvoiceStatus.length; i++) {
            sCurrentStatus = oInvoiceStatus[i].id + "," +sCurrentStatus;
        }

        var sBankStatusIDs = "";
        var oBankStatus = $('#cboBankStatusAdv').combobox('getValues');
        if(oBankStatus.length > 0){
            for(var i= 0;i<oBankStatus.length;i++){
                if(oBankStatus[i] != "" && oBankStatus[i] != null){
                    sBankStatusIDs += oBankStatus[i] + ",";
                }
            }
            if(sBankStatusIDs.length > 0)
                sBankStatusIDs = sBankStatusIDs.substring(0,sBankStatusIDs.length-1);
        }

        sCurrentStatus = sCurrentStatus.substring(0, sCurrentStatus.length - 1);
        var sTempString = nInvoiceDate + '~' + dIssueStartDate + '~' + dIssueEndDate + '~' +nReceiveDate + '~' + dReceiveStartDate+ '~' + dReceiveEndDate+ '~' +nMaturityDate+ '~' + dMaturityStartDate + '~' + dMaturityEndDate+ '~' +nNegotiationDate+ '~' + dNegotiationStartDate+ '~' + dNegotiationEndDate+ '~'+nAcceptanceDate+ '~' + dAcceptanceStartDate+ '~' + dAcceptanceEndDate+'~'+ncboAmount+ '~' + nAmountStart+ '~' + nAmountEnd+ '~'  + sImportInvoiceNo + '~' +sImportLCNo+'~'+ $('#divImportInvoices').data('SupplierIDs')+'~'+sCurrentStatus+'~'+sessionStorage.getItem('BUID')+'~'+nProductType
        + '~' + cboImportDate+'~'+ nImportDate +'~'+ dImportStartDate+'~'+ dImportEndDate + '~' + nImportPIType + '~' + bIsWaiting + '~' + sBankStatusIDs;
        //var oImportInvoice={ErrorMessage:sTempString};

        window.open(_sBaseAddress+ "/ImportInvoice/ImportExcel?sTempString="+sTempString);


    });


    //Reset
    function Reset() {

        DynamicRefreshList([],'tblImportInvoice');
        $("#txtImportInvoiceNo_Adv,#txtSupplier,#txtImportLCNo_Adv").val('');
        RefreshDateSearch();
        $("#txtSupplier ").removeClass("fontColorOfPickItem");
        var oInvoiceStatusObjs= $('#divImportInvoices').data('InvoiceStatus');
        DynamicRefreshList(oInvoiceStatusObjs, "tblCurrentStatusAdvSearch");
        $('#divImportInvoices').data('SupplierIDs',"");
        $('#txtAmountStart,#txtAmountEnd').val(0.0);
        $("#cboImportPIType").val(0)
        $('#chkIsWaiting').prop('checked', false);
        $('#cboBankStatusAdv').combobox('reset');
    }


    //Close Picker
    $('#btnSearchClose').click(function () {
        $("#winAdvSearchImportInvoice").icsWindow('close');
    });

    function DateActions_Import() {
        DynamicDateActions("cboImportDate", "txtImportDateStart", "txtImportDateEnd");
    }
    function DateActionsInvoiceDateAdvSearch() {
        DynamicDateActions("cboDateSearch", "txtStartDate", "txtEndDate");
    }
    function DateActionsReceiveDateAdvSearch() {
        DynamicDateActions("cboReceiveDateSearch", "txtReceiveStartDate", "txtReceiveEndDate");
    }
    function DateActionsMaturityDateAdvSearch() {
        DynamicDateActions("cboMaturityDateSearch", "txtMaturityStartDate", "txtMaturityEndDate");
    }
    function DateActionsNegotiationDateAdvSearch()
    {
        DynamicDateActions("cboNegotiationDateSearch", "txtNegotiationStartDate", "txtNegotiationEndDate");
    }
    function DateActionsAcceptanceDateAdvSearch()
    {
        DynamicDateActions("cboAcceptanceDateSearch", "txtAcceptanceStartDate", "txtAcceptanceEndDate");
    }
    function ActionsAmountAdvSearch() {
        DynamicValueActions("cboAmountSearch", "txtAmountStart", "txtAmountEnd");
    }

    function SetTodayDate() {
        $('#txtStartDate,#txtEndDate,#txtReceiveStartDate,#txtReceiveEndDate,#txtMaturityStartDate,#txtMaturityEndDate,#txtAcceptanceStartDate,#txtAcceptanceEndDate,#txtNegotiationStartDate,#txtNegotiationEndDate,#txtImportDateStart,#txtImportDateEnd').datebox('setValue', icsdateformat(new Date()));
    }

    function CheckEmpty() {

        var nInvoiceDate = $("#cboDateSearch").val();
        var nReceiveDate = $("#cboReceiveDateSearch").val();
        var nMaturityDate = $("#cboMaturityDateSearch").val();
        var nNegotiationDate = $("#cboNegotiationDateSearch").val();
        var nAcceptanceDate = $("#cboAcceptanceDateSearch").val();
        var sInvoiceNo = $("#txtImportInvoiceNo_Adv").val();
        var sLCNo = $("#txtImportLCNo_Adv").val();
        var nProductType =  $('#cboImportProducts').val();
        var oInvoiceStatus = $("#tblCurrentStatusAdvSearch").datagrid("getChecked");
        var bIsWaiting = false;
        if($('#chkIsWaiting').attr("checked"))
            bIsWaiting=true;
        if (nInvoiceDate == 0 && nReceiveDate==0 && nMaturityDate==0 && nNegotiationDate ==0 && nAcceptanceDate ==0  && sInvoiceNo=="" && sLCNo =="" && $('#divImportInvoices').data('SupplierIDs')== ""&& $('#cboAmountSearch').val()==0 && oInvoiceStatus==null && nProductType==0 && $("#cboImportPIType").val() == 0 && bIsWaiting == false)
        {
            return false;
        }
        return true;
    }

    function IntializePickerbutton(oPickerobj) {

        $("#" + oPickerobj.winid).find("#btnOk").click(function () {

            //for Single Select
            PickerEvents(oPickerobj);
        });
        $(document).find('.' + oPickerobj.winclass).keydown(function (e) {
            if (e.which == 13)//enter=13
            {
                PickerEvents(oPickerobj);
            }
        });
    }
    function PickerEvents(oPickerobj) {
        var oreturnobj = null, oreturnobjs = [];
        if (oPickerobj.multiplereturn)
        {
            oreturnobjs = $('#' + oPickerobj.tableid).datagrid('getChecked');
        } else
        {
            oreturnobj = $('#' + oPickerobj.tableid).datagrid('getSelected');
        }

        $("#" + oPickerobj.winid).icsWindow("close");
        $("#" + oPickerobj.winid).remove();
        if (oPickerobj.winclass == 'clsSupplier')
        {
            $('#divImportInvoices').data('SupplierIDs',"");
            var nSupplierIDs = "";
            if (oPickerobj.multiplereturn)
            {
                var ncount = 0;
                for (var i = 0; i <oreturnobjs.length; i++) {
                    var nSupplierID = oreturnobjs[i].ContractorID;
                    nSupplierIDs = nSupplierIDs + nSupplierID + ',';
                    ncount++;
                }
                if (ncount > 1)
                {
                    $('#txtSupplier').val("Select " + ncount + " Supplier's");
                } else
                {
                    $('#txtSupplier').val(oreturnobjs[0].Name);
                }
                nSupplierIDs = nSupplierIDs.substring(0, nSupplierIDs.length - 1);

            } else
            {
                $('#txtSupplier').val(oreturnobj.Name);
                nSupplierIDs = "" + oreturnobj.ContractorID + "";
                $('#txtSupplier').focus();
            }
            $('#divImportInvoices').data('SupplierIDs',nSupplierIDs);
            $("#txtSupplier").addClass('fontColorOfPickItem');
        }
    }

    $("#btnPrintGRN").click(function () {
        debugger;
        var oImportInvoice=$('#tblImportInvoice').datagrid('getSelected');
        var nSelectedIndex= $('#tblImportInvoice').datagrid('getRowIndex',oImportInvoice);
        if(oImportInvoice==null || oImportInvoice.ImportInvoiceID<=0)
        {
            alert("Please select a item from list!");
            return;
        }
        window.open(_sBaseAddress + '/ImportInvoice/PrintInvoice_GRN?id='+ oImportInvoice.ImportInvoiceID, "_blank");
    });


    /// Update Status
    $("#btnInvoiceStatusUpdate").click(function () {
        var oImportInvoice=$('#tblImportInvoice').datagrid('getSelected');
        var nSelectedIndex= $('#tblImportInvoice').datagrid('getRowIndex',oImportInvoice);
        if(oImportInvoice==null || oImportInvoice.ImportInvoiceID<=0)
        {
            alert("Please select a item from list!");
            return;
        }
        $('#cboBankStatus').val(oImportInvoice.BankStatusInt);
        $('#cboInvoiceStatus').val(oImportInvoice.InvoiceStatusInt);
        $("#winImportInvoiceStatus").icsWindow('open', "Invoice Status Change");


    });
    $("#btnSaveImportInvoiceStatus").click(function (e) {
        var oImportInvoice=$('#tblImportInvoice').datagrid('getSelected');
        var nSelectedIndex= $('#tblImportInvoice').datagrid('getRowIndex',oImportInvoice);
        if(oImportInvoice==null || oImportInvoice.ImportInvoiceID<=0)
        {
            alert("Please select a item from list!");
            return;
        }
        var nSelectedIndex= $('#tblImportInvoice').datagrid('getRowIndex',oImportInvoice);

        var oImportInvoiceTemp = {
            ImportInvoiceID:oImportInvoice.ImportInvoiceID,
            BankStatusInt: parseInt($("#cboBankStatus").val()),
            InvoiceStatusInt: parseInt($("#cboInvoiceStatus").val()),
            CommonRemarks: $("#txtNoteUpdateStatus").val()
        };
        var obj =
            {
                BaseAddress: _sBaseAddress,
                Object: oImportInvoiceTemp,
                ObjectId: oImportInvoiceTemp.ImportInvoiceID,
                ControllerName: "ImportInvoice",
                ActionName: "Save_UpdateStatus",
                TableId: "tblImportInvoice",
                IsWinClose: true
            };
        $.icsSave(obj, function (response) {
            if (response.status) {
                //OperationPerformsExportLC(nRowIndex, response.obj);
            }
        });
    });
    $("#btnCloseImportInvoiceStatus").click(function () {
        $("#winImportInvoiceStatus").icsWindow("close");
    });




        
    /// Commission Status
    $("#btnInvoiceCommissionUpdate").click(function () {
        var oImportInvoice=$('#tblImportInvoice').datagrid('getSelected');
        var nSelectedIndex= $('#tblImportInvoice').datagrid('getRowIndex',oImportInvoice);
        if(oImportInvoice==null || oImportInvoice.ImportInvoiceID<=0)
        {
            alert("Please select a item from list!");
            return;
        }
        $('#txtCommissionInPercent,#txtCommission,#txtLCValue,#txtInvoiceValue').icsCurrencyBox(null, null, 2);
        $('#txtLCValue').val(icsFormatPrice(oImportInvoice.Amount_LC, null,2));
        $("#txtLCNo").val(oImportInvoice.ImportLCNo);
        $("#txtInvoiceNo").val(oImportInvoice.ImportInvoiceNo);
        $("#txtSupplierName").val(oImportInvoice.ContractorName);
        $("#txtInvoiceCurrency,#txtCommissionCurrency,#txtLCCurrency").val(oImportInvoice.Currency);

        $('#txtInvoiceValue').val(icsFormatPrice(oImportInvoice.Amount, null,2));
        $('#txtCommissionInPercent').val(icsFormatPrice(oImportInvoice.CommissionInPercent, null,2));
        $('#txtCommission').val(icsFormatPrice(oImportInvoice.Commission, null,2));
        $("#txtCommissionRemarks").val(oImportInvoice.CommissionRemarks);
        if(oImportInvoice.PaymentExist)
        {
            $("#btnSaveImportInvoiceCommission").hide();
        }
        $("#winImportInvoiceCommission").icsWindow('open', "Commission");
        
    });
    $("#btnSaveImportInvoiceCommission").click(function (e) {
        var oImportInvoice=$('#tblImportInvoice').datagrid('getSelected');
        var nSelectedIndex= $('#tblImportInvoice').datagrid('getRowIndex',oImportInvoice);
        if(oImportInvoice==null || oImportInvoice.ImportInvoiceID<=0)
        {
            alert("Please select a item from list!");
            return;
        }
        if(parseFloat(icsRemoveComma($("#txtCommission").val()))>parseFloat(icsRemoveComma($("#txtInvoiceValue").val())))
        {
            alert("Sorry, Commission Amount Should be Less than Invoice value!");
            return;
        }
        var nSelectedIndex= $('#tblImportInvoice').datagrid('getRowIndex',oImportInvoice);
        var oImportInvoiceTemp = {
            ImportInvoiceID:oImportInvoice.ImportInvoiceID,
            CommissionInPercent:parseFloat(icsRemoveComma($("#txtCommissionInPercent").val())),
            Commission:parseFloat(icsRemoveComma($("#txtCommission").val())),
            CommissionRemarks :$("#txtCommissionRemarks").val()
        };

        var obj =
            {
                BaseAddress: _sBaseAddress,
                Object: oImportInvoiceTemp,
                ObjectId: oImportInvoiceTemp.ImportInvoiceID,
                ControllerName: "ImportInvoice",
                ActionName: "UpdateCommission",
                TableId: "tblImportInvoice",
                IsWinClose: true
            };
        $.icsSave(obj, function (response) {
            if (response.status) {
                //OperationPerformsExportLC(nRowIndex, response.obj);
            }
        });
    });
    $('#txtCommissionInPercent').change(function(){
        if(parseFloat(icsRemoveComma($('#txtCommissionInPercent').val()))>0 && parseFloat(icsRemoveComma($('#txtInvoiceValue').val()))>0)
        {
            $('#txtCommission').val(icsFormatPrice(parseFloat(icsRemoveComma($('#txtInvoiceValue').val()))*parseFloat(icsRemoveComma($('#txtCommissionInPercent').val()))/100 , null,2));
        }else{
            $('#txtCommission').val(0);//Reset 0
        }
    });
    $('#txtCommission').change(function(){
        if(parseFloat(icsRemoveComma($('#txtCommission').val()))>0 && parseFloat(icsRemoveComma($('#txtInvoiceValue').val()))>0)
        {
             $('#txtCommissionInPercent').val(icsFormatPrice(parseFloat(icsRemoveComma($('#txtCommission').val())/ parseFloat(icsRemoveComma($('#txtInvoiceValue').val())))*100 , null,2));
        }else{
            $('#txtCommissionInPercent').val(0);
        }
    });
    $("#btnCloseImportInvoiceCommission").click(function () {
        $("#winImportInvoiceCommission").icsWindow("close");
    });

    function LoadFooter(oList){
        var nSum = 0;
        for(var i=0;i<oList.length;i++)
            nSum+=oList[i].Amount;

        var oFooters = [];
        var oFooter = {
            ImportInvoiceNo: '',
            InvoiceDateInString: '',
            InvoiceTypeSt: '',
            CurrentStatusInSt: '',
            BankStatusInSt: '',
            LCPaymentType: '',
            ImportLCNo: 'Total',
            AmountSt:  TempFormatPrice(nSum),
            ImportLCDateInString: '',
            ContractorName: '',
            BankName_Nego: '',
            BLNo: '',
            BLDateSt: '',
            ETADateSt: '',
            DateofNegotiationInST: '',
            DateofAcceptanceSt: '',
            AcceptedByName: '',
            DateofMaturityST: '',
            DateofPaymentSt: '',
        };
        oFooters.push(oFooter);
        $('#tblImportInvoice').datagrid('reloadFooter', oFooters);
    }

    function TempFormatPrice(val, row) {
        if (val == null) {
            val = 0.00;
        }
        val = parseFloat(val);
        if (isNaN(val) || val === undefined) { return 0.00; }
        var test = val.toFixed(2);
        var tests = TempAddComma(test);
        return tests;
    }

    function TempAddComma(nStr) {
        nStr += '';
        x = nStr.split('.');
        x1 = x[0];
        x2 = x.length > 1 ? '.' + x[1] : '';
        var process = /(\d+)(\d{3})/;
        while (process.test(x1)) {
            x1 = x1.replace(process, '$1' + ',' + '$2');
        }
        return x1 + x2;
    }

</script>


