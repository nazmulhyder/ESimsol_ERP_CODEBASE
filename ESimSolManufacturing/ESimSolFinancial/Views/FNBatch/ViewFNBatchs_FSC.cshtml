@{
    ViewBag.Title = "FN Batch";
}
@model IEnumerable<ESimSol.BusinessObjects.FabricSCReport>

<body>
    <div class="menuMainCollectionTable">
        <table id="tblFabricSCReport" title="Fabric SC Report List" class="easyui-datagrid" fit="true" fitcolumn="true" rownumbers="true" pagination="true" singleselect="true" autorowheight="false" toolbar="#toolbarFabricSCReport">
            <thead>
                <tr>
                    <th field="ExeNo" width="12%"> Dispo No</th>
                    <th field="SCNoFull" width="12%"> PO No</th>
                    <th field="FabricNo" width="12%"> Fabric Number</th>
                    <th field="BuyerName" width="20%"> Buyer Name</th>
                    <th field="Qty" width="12%" align="right"> Qty (Y)</th>
                    <th field="Qty_PRO" width="12%" align="right"> Total Batch (Y)</th>
                    <th field="Qty_Balance" width="12%" align="right">Balance (Y)</th>
                </tr>
            </thead>
        </table>
        <div id="toolbarFabricSCReport">
            <input type="text" id="txtFNExeNoSearch" placeholder="Search Dispo No" style="width:15%;" />
            <input type="text" id="txtBatchNoSearch" placeholder="Search By PO " style="width:15%;" />
            <a id="btnAdvSearch" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-search" plain="true">Adv. Search</a>
            <a id="btnEdit" href="javascript:void(0)" class="easyui-linkbutton initial-state" iconcls="icon-edit" plain="true">Add Batch</a>
            <a id="btnPrintPB" href="javascript:void(0)" class="easyui-linkbutton initial-state" iconcls="icon-print" plain="true">Print Batch</a>
            @*<a id="btnProcess" href="javascript:void(0)" class="easyui-linkbutton initial-state" iconcls="icon-edit" plain="true">Update Process</a>*@
        </div>
    </div>

    <div id="winAdvSearch" class="easyui-window winClass" style="width:620px" title="Adv. Search" data-options="modal:true,closed:true,collapsible:false,minimizable:false,maximizable:false,closable:false">
        <div>
            <fieldset style="margin-bottom: 0px;">
                <legend>Searching Criteria</legend>
                <table style="width:100%;text-align:right;">
                    <tr>
                        <td style=" width:20%;text-align:right;">
                            <label id="lblFabricNoAdv"> PO No :</label>
                        </td>
                        <td style=" width:30%;text-align:left;" colspan="3">
                            <input id="txtSCNo" style="width:80%;" type="text" />
                        </td>
                    </tr>

                    <tr>
                        <td style=" width:20%;text-align:right;">
                            <label>Issue To :</label>
                        </td>
                        <td colspan="3" style=" width:80%;text-align:left;">
                            <input id="txtContractorAdvS" style="width:80%;" type="text" placeholder="Type & Press Enter" />
                            <a id="btnPickContractorAdvS" href="javascript:void(0)" class="easyui-linkbutton ics-pick" iconcls="icon-pick" plain="true"></a>
                            <a id="btnClrContractorAdvS" href="javascript:void(0)" class="easyui-linkbutton ics-pick" iconcls="icon-clear" plain="true"></a>
                        </td>
                    </tr>

                    <tr>
                        <td style=" width:20%;text-align:right;">
                            <label>Buying House :</label>
                        </td>
                        <td colspan="3" style=" width:80%;text-align:left;">
                            <input id="txtDeliverTo" style="width:80%;" type="text" placeholder="Type & Press Enter" />
                            <a id="btnPickDeliverTo" href="javascript:void(0)" class="easyui-linkbutton ics-pick" iconcls="icon-pick" plain="true"></a>
                            <a id="btnClrDeliverTo" href="javascript:void(0)" class="easyui-linkbutton ics-pick" iconcls="icon-clear" plain="true"></a>
                        </td>
                    </tr>
                    @*<tr>
                        <td style=" width:20%;text-align:right;">
                            <label>Mkt Account:</label>
                        </td>
                        <td colspan="3" style=" width:80%;text-align:left;">
                            <input id="txtMktAccount" class="reset-text" placeholder="Search Concern Person" style="width:80%" />
                            <a id="btnPickMktAccount" href="javascript:void(0)" class="easyui-linkbutton ics-pick" iconcls="icon-pick" plain="true"></a>
                            <a id="btnResetMktPerson" href="javascript:void(0)" class="easyui-linkbutton ics-pick" iconcls="icon-clear" plain="true"></a>
                        </td>
                    </tr>*@
                    <tr>
                        <td style=" width:20%;text-align:right;">
                            <label>PO Date:</label>
                        </td>
                        <td colspan="3" style=" width:80%;text-align:right;">
                            <div style="float:left; width:100%">
                                <div style="float:left; width:30%">
                                    <select style="width:95%;" id="cboPODate" onchange="DateActions_OPDate(); "></select>
                                </div>
                                <div style="float:left; width:25%; padding-left:5px;">
                                    <input id="txtFromPODate" type="text" style="width: 110px;" class="easyui-datebox" required="required" data-options="formatter:icsdateformat,parser:icsdateparser" />
                                </div>
                                <div style="float:left; width:5%; text-align:center">to</div>
                                <div style="float:left; width:25%; padding-left:5px;">
                                    <input id="txtToPODate" type="text" style="width: 110px;" class="easyui-datebox" required="required" data-options="formatter:icsdateformat,parser:icsdateparser" />
                                </div>
                            </div>
                        </td>
                    </tr>
                    <tr>
                        <td style=" width:20%;text-align:right;">
                            <label>Approve Date:</label>
                        </td>
                        <td colspan="3" style=" width:80%;text-align:right;">
                            <div style="float:left; width:100%">
                                <div style="float:left; width:30%">
                                    <select style="width:95%;" id="cboApproveDate" onchange="DateActions_ApproveDate(); "></select>
                                </div>
                                <div style="float:left; width:25%; padding-left:5px;">
                                    <input id="txtFromApproveDate" type="text" style="width: 110px;" class="easyui-datebox" required="required" data-options="formatter:icsdateformat,parser:icsdateparser" />
                                </div>
                                <div style="float:left; width:5%; text-align:center">to</div>
                                <div style="float:left; width:25%; padding-left:5px;">
                                    <input id="txtToApproveDate" type="text" style="width: 110px;" class="easyui-datebox" required="required" data-options="formatter:icsdateformat,parser:icsdateparser" />
                                </div>
                            </div>
                        </td>
                    </tr>
                    <tr>
                        <td style=" width:20%;text-align:right;">
                            <label>Received Date:</label>
                        </td>
                        <td colspan="3" style=" width:80%;text-align:right;">
                            <div style="float:left; width:100%">
                                <div style="float:left; width:30%">
                                    <select style="width:95%;" id="cboReceivedDate" onchange="DateActions_ReceivedDate(); "></select>
                                </div>
                                <div style="float:left; width:25%; padding-left:5px;">
                                    <input id="txtFromReceivedDate" type="text" style="width: 110px;" class="easyui-datebox" required="required" data-options="formatter:icsdateformat,parser:icsdateparser" />
                                </div>
                                <div style="float:left; width:5%; text-align:center">to</div>
                                <div style="float:left; width:25%; padding-left:5px;">
                                    <input id="txtToReceivedDate" type="text" style="width: 110px;" class="easyui-datebox" required="required" data-options="formatter:icsdateformat,parser:icsdateparser" />
                                </div>
                            </div>
                        </td>
                    </tr>
                    <tr>
                        <td style=" width:20%;text-align:right;">
                            <label>Exc Date:</label>
                        </td>
                        <td colspan="3" style=" width:80%;text-align:right;">
                            <div style="float:left; width:100%">
                                <div style="float:left; width:30%">
                                    <select style="width:95%;" id="cboExcDate" onchange="DateActions_ExcDate(); "></select>
                                </div>
                                <div style="float:left; width:25%; padding-left:5px;">
                                    <input id="txtFromExcDate" type="text" style="width: 110px;" class="easyui-datebox" required="required" data-options="formatter:icsdateformat,parser:icsdateparser" />
                                </div>
                                <div style="float:left; width:5%; text-align:center">to</div>
                                <div style="float:left; width:25%; padding-left:5px;">
                                    <input id="txtToExcDate" type="text" style="width: 110px;" class="easyui-datebox" required="required" data-options="formatter:icsdateformat,parser:icsdateparser" />
                                </div>
                            </div>
                        </td>
                    </tr>
                    @*<tr>
                        <td style=" width:20%;text-align:right;">
                            <label>Production Type:</label>
                        </td>
                        <td style=" width:30%;text-align:left;">
                            <select id="cboProductionType" style="width:90%;"><option value="0">All</option><option value="1">In House</option><option value="2">Sub Contract</option></select>
                        </td>
                        <td style=" width:20%;text-align:right;">
                            <label>Print PO:</label>
                        </td>
                        <td style=" width:30%;text-align:left;">
                            <select style="width:80%;" id="cboIsPrinting">
                                <option value="0">Default</option>
                                <option value="1">Print</option>
                                <option value="2">Not Print</option>
                            </select>
                        </td>
                    </tr>*@
                    @*<tr>
                        <td colspan="4" style="width:95%;text-align:left;">
                            <div style="margin-top: 2px;">
                                <table style="width:100%; height: 150px;">
                                    <tr>
                                        <td style="width:35%;">
                                            <table id="tblOrderTypes" class="easyui-datagrid" title="Order Type" style="width:99%; height: 150px;" data-options="singleSelect: false,fitColumns:false, rownumbers:true, pagination:false, autoRowHeight:false, ">
                                                <thead>
                                                    <tr>
                                                        <th data-options="field:'Selected',checkbox:true"></th>
                                                        <th field="Value" width="80%"></th>
                                                    </tr>
                                                </thead>
                                            </table>
                                        </td>
                                        <td style="width:30%;">
                                            <table id="tblCurrentStatuss" class="easyui-datagrid" title="Order Status" style="width:99%; height: 150px;" data-options="singleSelect: false,fitColumns:false, rownumbers:true, pagination:false, autoRowHeight:false, ">
                                                <thead>
                                                    <tr>
                                                        <th data-options="field:'Selected',checkbox:true"></th>
                                                        <th field="Value" width="80%"></th>
                                                    </tr>
                                                </thead>
                                            </table>
                                        </td>
                                        <td style="width:35%;">
                                            <table id="tblLabStatuss" class="easyui-datagrid" title="Lab Status" style="width:99%; height: 150px;" data-options="singleSelect: false,fitColumns:false, rownumbers:true, pagination:false, autoRowHeight:false, ">
                                                <thead>
                                                    <tr>
                                                        <th data-options="field:'Selected',checkbox:true"></th>
                                                        <th field="Value" width="80%"></th>
                                                    </tr>
                                                </thead>
                                            </table>
                                        </td>
                                    </tr>
                                </table>


                            </div>
                        </td>
                    </tr>*@
                    <tr>
                        <td colspan="4" style="width:50%;text-align:left;">
                            <div style="margin-top: 0px;">
                                <table style="width:100%;">
                                    <tr>
                                        <td style=" width:10%;text-align:right;"></td>
                                        <td style="width:40%; text-align:left;">
                                            <div style="float:left"><input type="checkbox" id="chkYetToBatch" /> <span><label>Yet To Batch</label></span></div>
                                            @*<div><input type="checkbox" id="chkReceived" /> <span><label>Received</label></span></div>
                                            <div><input type="checkbox" id="chkBatch" /><span><label>Submitted HO</label></span></div>*@
                                        </td>

                                        @*<td style="width:40%;text-align:left;">
                                            <div><input type="checkbox" id="chkWatingForLab" /> <span><label>Waiting For Lab</label></span></div>
                                            <div><input type="checkbox" id="chkYetToBatch" /> <span><label>Yet To Submit HO</label></span></div>
                                        </td>*@
                                    </tr>
                                </table>


                            </div>
                        </td>



                    </tr>

                </table>
            </fieldset>

            <fieldset>
                <legend>Actions : </legend>
                <table style="width:100%;text-align:right;">
                    <tr>
                        <td style="width:20%;text-align:right;">
                            <a id="btnResetAdvSearch" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-reload" plain="true">Reset</a>
                        </td>
                        <td style="width:80%;text-align:right;">
                            <label class="lblLoadingMessage" style="float: left;">Loading Please Wait...</label>
                            <a id="btnSearchAdvSearch" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-search" plain="true">Search</a>
                            <a id="btnCloseAdvSearch" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-cancel" plain="true">Close</a>
                        </td>
                    </tr>
                </table>

            </fieldset>
        </div>
    </div>
</body>
<style type="text/css">
    .cbo-styler {
        width: 92%;
    }
    .txt-styler {
        width: 90%;
    }
    .spacing-bottom {
        padding-bottom: 2px;
    }
    .txt-styler-two {
        width: 44%;
    }
    table tr td {
        padding: 2px;
    }
</style>
<script type="text/javascript">
    var _sBaseAddress="";
    var _oFabricSCReports=[];
    var _nBUID=0
    $(document).ready(function () {
        _sBaseAddress = @Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(HttpContext.Current.Session[SessionInfo.BaseAddress]));
        _oFabricSCReports =@Html.Raw( new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(Model));
        _nBUID = @Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(ViewBag.BUID));
        _oCompareOperators = @Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(ViewBag.CompareOperators));
        var oFabricPOSetup = @Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(ViewBag.FabricPOSetup));
        debugger;
        if(sessionStorage.getItem("FabricSCReports")!=null && sessionStorage.getItem("FabricSCReports").length>0){
            var nIndex= sessionStorage.getItem('SelectedRowIndex');
            DynamicRefreshList(_oFabricSCReports, 'tblFabricSCReport');
            if(nIndex>-1){
                $('#tblFabricSCReport').datagrid('selectRow',nIndex);
            }
        }
        else{
            DynamicRefreshList(_oFabricSCReports, 'tblFabricSCReport');
        }
        $('#dtIssueFrom,#dtIssueTo').datebox({'disabled':true});
        $('#dtIssueFrom,#dtIssueTo').datebox('setValue', icsdateformat(new Date()));

    });

    $(document).keydown(function (e) { if (e.keyCode == 27) { $('div').icsWindow('close'); } });
    $('#chkDate').change(function(e){
        debugger;
        if($('#chkDate').is(':checked')){
            $('#dtIssueFrom,#dtIssueTo').datebox({'disabled':false});
        }
        else{
            $('#dtIssueFrom,#dtIssueTo').datebox({'disabled':true});
        }
        $('#dtIssueFrom,#dtIssueTo').datebox('setValue', icsdateformat(new Date()));
    });
    /*.......... Searching ............. */

    /*----------------ADV SEARCH START-------------------*/
    function updateProgress() {
        var value =$('#progressbar').progressbar('getValue');
        if (value < 96){
            value += Math.floor(Math.random() * 10);
            $('#progressbar').progressbar('setValue', value);
        }
    }
    function hideShow(miliseconds) {
        $("#progressbarParent").hide();
    }
    //Account Of Picker
    $("#txtContractorAdvS").keydown(function (e) {
        if (e.keyCode === 13) // Enter Press
        {
            PickContractors_AdvS();
        }
        else if (e.keyCode === 08) {
            $("#txtContractorAdvS").removeClass("fontColorOfPickItem");
            _sContractorIds = '';
        }
    });
    $("#btnClrContractorAdvS").click(function () {
        $("#txtContractorAdvS").removeClass("fontColorOfPickItem");
        $("#txtContractorAdvS").val("");
        _sContractorIds = '';
    });
    $("#btnPickContractorAdvS").click(function () {
        PickContractors_AdvS();
    });
    function PickContractors_AdvS() {
        var oContractor = {
            Params: '2,3' + '~' + $.trim($("#txtContractorAdvS").val()+"~"+_nBUID)
        };
        var obj = {
            BaseAddress: _sBaseAddress,
            Object: oContractor,
            ControllerName: "Contractor",
            ActionName: "ContractorSearchByNameType",
            IsWinClose: false
        };

        $("#progressbar").progressbar({ value: 0 });
        $("#progressbarParent").show();
        var intervalID = setInterval(updateProgress, 250);

        DynamicRefreshList([], "tblAccountsPickerAdvSearch");
        $.icsDataGets(obj, function (response) {
            clearInterval(intervalID);
            $("#progressbarParent").hide();
            if (response.status && response.objs.length > 0) {
                if (response.objs[0].ContractorID > 0) {
                    var tblColums = []; var oColumn = { field: "ContractorID", title: "Code", width: 50, align: "left" }; tblColums.push(oColumn);
                    oColumn = { field: "Name", title: "Name", width: 280, align: "left" }; tblColums.push(oColumn);

                    var oPickerParam = {
                        winid: 'winContractorPicker',
                        winclass: 'clsAccountOf',
                        winwidth: 400,
                        winheight: 460,
                        tableid: 'tblAccountOfs',
                        tablecolumns: tblColums,
                        datalist: response.objs,
                        multiplereturn: true,
                        searchingbyfieldName: 'Name',
                        windowTittle: 'Contactor List'
                    };
                    $.icsPicker(oPickerParam);
                    IntializePickerbutton(oPickerParam);
                }
                else {
                    alert(response.objs[0].ErrorMessage);
                }
            }
            else {
                alert("Sorry, No Contactor Found.");
            }
        });
    }
    //End Account Of Picker
    $("#btnClrDeliverTo").click(function () {
        $("#txtDeliverTo").val("");
        _sBuyerIds="";
    });
    $("#btnPickDeliverTo").click(function () {

        var oContractor = {
            Params: '2,3' + '~' + $.trim($("#txtDeliverTo").val()+'~'+_nBUID)
        };
        GetDeliverTo(oContractor);
    });
    $("#txtDeliverTo").keydown(function (e) {
        var nkeyCode = e.keyCode || e.which;
        if(nkeyCode==13){
            var sContractorName=$.trim($("#txtDeliverTo").val());
            if(sContractorName=="" || sContractorName==null)
            {
                alert("Please, Type name or part of Name");
                $("#txtDeliverTo").focus();
                $("#txtDeliverTo").addClass("errorFieldBorder");
                return;
            }
            var oContractor = {
                Params: '2,3' + '~' + $.trim($("#txtDeliverTo").val()+'~'+_nBUID)
            };
            GetDeliverTo(oContractor);
        }
        else if(nkeyCode==8){
            $("#txtDeliverTo").val("");
            _sBuyerIds="";

        }
    });
    function GetDeliverTo(oContractor){


        var obj = {
            BaseAddress: _sBaseAddress,
            Object: oContractor,
            ControllerName: "Contractor",
            ActionName: "ContractorSearchByNameType",
            IsWinClose: false
        };
        $("#progressbar").progressbar({ value: 0 });
        $("#progressbarParent").show();
        var intervalID = setInterval(updateProgress, 250);
        $.icsDataGets(obj, function (response) {
            clearInterval(intervalID);
            $("#progressbarParent").hide();
            if (response.status && response.objs.length > 0)
            {
                if (response.objs[0].ContractorID > 0) {
                    debugger;
                    var tblColums = [];
                    var oColumn = { field: "ContractorID", title: "Code", width: 50, align: "center" };tblColums.push(oColumn);
                    oColumn = { field: "Name", title: "Name", width: 190, align: "left" };tblColums.push(oColumn);
                    oColumn = { field: "Phone", title: "Phone", width: 140, align: "left" };tblColums.push(oColumn);

                    var oPickerParam = {
                        winid: 'winDeliverToPicker',
                        winclass:'clsDeliverToPicker',
                        winwidth: 460,
                        winheight: 460,
                        tableid: 'tblDeliverToPicker',
                        tablecolumns: tblColums,
                        datalist: response.objs,
                        multiplereturn: true,
                        searchingbyfieldName:'Name',
                        windowTittle: 'Deliver To List'
                    };
                    $.icsPicker(oPickerParam);
                    IntializePickerbutton(oPickerParam);//multiplereturn, winclassName
                }
                else { alert(response.objs[0].ErrorMessage); }
            }
            else{
                alert("No contractor found.");
            }
        });
    }

    function IntializePickerbutton(oPickerobj) {
        $("#" + oPickerobj.winid).find("#btnOk").click(function () {
            SetPickerValueAssign(oPickerobj);
        });
        $(document).find('.' + oPickerobj.winclass).keydown(function (e) {
            if (e.which === 13) {
                SetPickerValueAssign(oPickerobj);
            }
        });
    }
    function SetPickerValueAssign(oPickerobj) {
        var oreturnObj = null, oreturnObjs = [];
        if (oPickerobj.multiplereturn) {
            oreturnObjs = $('#' + oPickerobj.tableid).datagrid('getChecked');
        } else {
            oreturnObj = $('#' + oPickerobj.tableid).datagrid('getSelected');
        }

        if (oPickerobj.winid == 'winContractorPicker')
        {
            if (oreturnObjs != null && oreturnObjs.length> 0)
            {

                _sContractorIds=''; var sMessage='';
                sMessage=(oreturnObjs.length>1)? oreturnObjs.length +" Contractors Selected" : oreturnObjs[0].Name;
                $('#txtContractorAdvS').val(sMessage);
                $("#txtContractorAdvS").addClass("fontColorOfPickItem");

                for(var i=0;i<oreturnObjs.length;i++){
                    _sContractorIds=_sContractorIds+oreturnObjs[i].ContractorID+',';
                }
                _sContractorIds=_sContractorIds.substring(0,_sContractorIds.length-1);

            }
            else
            {
                alert("Please select a contractor.");
                return false;
            }
        }

        else if (oPickerobj.winid == 'winDeliverToPicker')
        {
            if (oreturnObjs != null && oreturnObjs.length> 0)
            {
                var sMessage='';
                _sBuyerIds="";
                sMessage=(oreturnObjs.length>1)? oreturnObjs.length +" Buying House(s) Selected" : oreturnObjs[0].Name;
                $('#txtDeliverTo').val(sMessage);
                $("#txtDeliverTo").addClass("fontColorOfPickItem");

                for(var i=0;i<oreturnObjs.length;i++){
                    _sBuyerIds=_sBuyerIds+oreturnObjs[i].ContractorID+',';
                }
                _sBuyerIds=_sBuyerIds.substring(0,_sBuyerIds.length-1);

            }
            else
            {
                alert("Please select a Buying House.");
                return false;
            }
        }
        else if (oPickerobj.winid == 'winMktAccount')
        {
            if (oreturnObjs != null && oreturnObjs.length> 0)
            {
                var sMessage='';
                _sMAccountIds="";
                sMessage=(oreturnObjs.length>1)? oreturnObjs.length +"MKT Account(s) Selected" : oreturnObjs[0].Name;
                $('#txtMktAccount').val(sMessage);
                $("#txtMktAccount").addClass("fontColorOfPickItem");
                for(var i=0;i<oreturnObjs.length;i++){
                    _sMAccountIds=_sMAccountIds+oreturnObjs[i].MarketingAccountID+',';
                }
                _sMAccountIds=_sMAccountIds.substring(0,_sMAccountIds.length-1);
            }
            else
            {
                alert("Please select a MKt Account.");
                return false;
            }
        }

        $("#" + oPickerobj.winid).icsWindow("close");
        $("#" + oPickerobj.winid).remove();
    }
    //End Buyer Search
    $("#btnResetAdvSearch").click(function () {
        ResetAdvSearchWindow();
        LoadComboAdv();
    });
    $("#btnSearchAdvSearch").click(function ()
    {
        $(".lblLoadingMessage").show();
        var sOrderTypeIDs = "";
        var _sBuyerIds = "";
        var sPONo="";
        var sCurrentStatus = "";
        var sLabStatus = "";
        var sTempString = _sContractorIds + '~'
                        + _sBuyerIds + '~'
                        + $("#cboPODate").val() + '~'
                        + $("#txtFromPODate").datebox("getValue") + '~'
                        + $("#txtToPODate").datebox("getValue") + '~'
                        + $("#cboApproveDate").val() + '~'
                        + $("#txtFromApproveDate").datebox("getValue") + '~'
                        + $("#txtToApproveDate").datebox("getValue") + '~'
                        + _nBUID + '~'
                        + $("#txtSCNo").val() + '~'
                        + $('#chkYetToBatch').is(':checked')+'~'
                        + $("#cboReceivedDate").val() + '~'
                        + $("#txtFromReceivedDate").datebox("getValue") + '~'
                        + $("#txtToReceivedDate").datebox("getValue") + '~'
                        + $("#cboExcDate").val() + '~'
                        + $("#txtFromExcDate").datebox("getValue") + '~'
                        + $("#txtToExcDate").datebox("getValue") ;

        debugger;
        var oFabricSCReport = {
            ErrorMessage: sTempString
        }
        sessionStorage.setItem("ParamsP", sTempString);
        $.ajax({
            type: "POST",
            dataType: "json",
            url: _sBaseAddress + "/FNBatch/AdvanchSearch_FSC",
            traditional: true,
            data: JSON.stringify(oFabricSCReport),
            contentType: "application/json; charset=utf-8",
            success: function (data) {
                debugger;
                var oResult = data;

                var oResult = data;
                if(oResult.length<=0){
                    alert("No data found");
                }
                else
                {
                    if(oResult[0].ErrorMessage!=""){
                        alert(oResult[0].ErrorMessage);return;
                    }
                    $('#tblFabricSCReport').data('FDPs',oResult)
                    DynamicRefreshList(oResult,'tblFabricSCReport');
                    //SetGridData();
                    $("#winAdvSearch").icsWindow("close");
                    $(".lblLoadingMessage").hide();
                }


            }
        });
    });
    ////Start adv Searching
    /// Search By No and Date
    $('#txtSearchbyPONo').keypress(function (e) {

        var code = (e.keyCode ? e.keyCode : e.which);
        if (code == 13)//Enter key-13
        {
            if ($.trim($("#txtSearchbyPONo").val()) == "")
            {
                alert("Please give PO No.");
                return false;
            }
            var sPONo=$.trim($("#txtSearchbyPONo").val());
            var sOrderTypeIDs = "";
            var sCurrentStatus = "";
            _sContractorIds="";
            debugger;
            var sTempString = "" + '~'
                            + "" + '~'//$.trim($("#txtFabricID").val()) + '~'
                            + _sContractorIds + '~'
                            + _sBuyerIds + '~'
                            + _sMAccountIds + '~'
                            + 0 + '~'
                            + icsdateformat(new Date())+ '~'
                            + icsdateformat(new Date())+ '~'
                            + 0+ '~'
                            + icsdateformat(new Date()) + '~'
                            + icsdateformat(new Date())+ '~'
                            + 0 + '~'
                            + 0 + '~'
                            + sOrderTypeIDs  + '~'
                            + sCurrentStatus  + '~'
                            + _nBUID  + '~'
                            + sPONo+'~'
                            + _typeOfReceive +'~'
                            + "";




            var oFabricSCReport = {
                SCNoFull:$.trim($("#txtSearchbyPONo").val()),
                ErrorMessage: sTempString
            }
            sessionStorage.setItem("ParamsP", sTempString);
            $.ajax({
                type: "POST",
                dataType: "json",
                url: _sBaseAddress + "/FabricSCReport/AdvanchSearchTwo",
                traditional: true,
                data: JSON.stringify(oFabricSCReport),
                contentType: "application/json; charset=utf-8",
                success: function (data)
                {
                    var oResult = data;
                    if(oResult.length<=0){
                        alert("No data found");
                    }
                    else{
                        $('#tblFabricSCReport').data('FDPs',oResult)
                        DynamicRefreshList(oResult,'tblFabricSCReport');
                        SetGridData();
                        $(".lblLoadingMessage").hide();

                    }



                }
            });
        }
    });
    $('#txtSearchbyFabricNo').keypress(function (e) {

        var code = (e.keyCode ? e.keyCode : e.which);
        if (code == 13)//Enter key-13
        {
            if ($.trim($("#txtSearchbyFabricNo").val()) == "")
            {
                alert("Please give Ref No.");
                return false;
            }
            var sOrderTypeIDs = "";
            var sCurrentStatus = "";
            _sContractorIds="";
            var sPONo="";
            debugger;
            var sTempString = "" + '~'
                            + $.trim($("#txtSearchbyFabricNo").val()) + '~'
                            + _sContractorIds + '~'
                            + _sBuyerIds + '~'
                            + _sMAccountIds + '~'
                            + 0 + '~'
                            + icsdateformat(new Date())+ '~'
                            + icsdateformat(new Date())+ '~'
                            + 0+ '~'
                            + icsdateformat(new Date()) + '~'
                            + icsdateformat(new Date())+ '~'
                            + 0 + '~'
                              + 0 + '~'
                            + sOrderTypeIDs  + '~'
                            + sCurrentStatus  + '~'
                            + _nBUID  + '~'
                            + sPONo+'~'
                            + _typeOfReceive +'~'
                            + "";




            var oFabricSCReport = {
                SCNoFull:"",
                ErrorMessage: sTempString
            }
            sessionStorage.setItem("ParamsP", sTempString);
            $.ajax({
                type: "POST",
                dataType: "json",
                url: _sBaseAddress + "/FabricSCReport/AdvanchSearchTwo",
                traditional: true,
                data: JSON.stringify(oFabricSCReport),
                contentType: "application/json; charset=utf-8",
                success: function (data)
                {
                    var oResult = data;
                    if(oResult.length<=0){
                        alert("No data found");
                    }
                    else{
                        $('#tblFabricSCReport').data('FDPs',oResult)
                        DynamicRefreshList(oResult,'tblFabricSCReport');
                        SetGridData();
                        $(".lblLoadingMessage").hide();

                    }


                }
            });
        }
    });
    $('#txtHLNO').keypress(function (e) {

        var code = (e.keyCode ? e.keyCode : e.which);
        if (code == 13)//Enter key-13
        {
            if ($.trim($("#txtHLNO").val()) == "")
            {
                alert("Please give HL No.");
                return false;
            }
            var sOrderTypeIDs = "";
            var sCurrentStatus = "";
            _sContractorIds="";
            var sPONo="";
            debugger;
            var sTempString = _sContractorIds + '~'
                            + _sBuyerIds + '~'
                            + 0 + '~'
                            + icsdateformat(new Date())+ '~'
                            + icsdateformat(new Date())+ '~'
                            + 0+ '~'
                            + icsdateformat(new Date()) + '~'
                            + icsdateformat(new Date())+ '~'
                            + 0 + '~'
                            + 0 + '~'
                            + sOrderTypeIDs  + '~'
                            + sCurrentStatus  + '~'
                            + _nBUID  + '~'
                            + sPONo+'~'
                            + _typeOfReceive +'~'
                            + $.trim($("#txtHLNO").val());

            console.log(sTempString.split('~'))
            var oFabricSCReport = {
                SCNoFull:"",
                ErrorMessage: sTempString
            }
            sessionStorage.setItem("ParamsP", sTempString);
            $.ajax({
                type: "POST",
                dataType: "json",
                url: _sBaseAddress + "/FabricSCReport/AdvanchSearchTwo",
                traditional: true,
                data: JSON.stringify(oFabricSCReport),
                contentType: "application/json; charset=utf-8",
                success: function (data)
                {
                    var oResult = data;
                    if(oResult.length<=0){
                        alert("No data found");
                    }
                    else{
                        $('#tblFabricSCReport').data('FDPs',oResult)
                        DynamicRefreshList(oResult,'tblFabricSCReport');
                        SetGridData();
                        $(".lblLoadingMessage").hide();
                    }
                }
            });
        }
    });

    function RefreshSetup(oFabricPOSetup)
    {
        $('#lblFabricNoTwo,#lblFabricNo,#lblFabricNoAdv').html(oFabricPOSetup.FabricCode);
        $("#txtSearchbyFabricNo,#txtFabricID").attr("placeholder","Search by "+oFabricPOSetup.NoCode+" No");
        $("#txtFabricID").attr("placeholder",""+oFabricPOSetup.NoCode+" No");
        $("#txtP").attr("placeholder",oFabricPOSetup.NoCode);
        //if(oFabricPOSetup.IsLDApply==false)
        //{
        //    $('#btnAddFNLabdipDetail,#btnAddFNLabdipColor').hide();
        //}

    }

    function LoadComboboxesFabric() {

        //            $('#txtFabricNoFabric,#txtDateFabric,#txtMktPersonsFabric,#txtContractorName,#txtBuyerReferenceFabric,#txtStyleNoFabric,#txtConstructionFabricPI,#cboPriorityLevelFabric,#txtHLNo,#txtNoteFabric,#tdInputDateBox,#txtHandLoomDate,#chkIsSample,#chkIsHandLoom, #chkIsBulk,#chkIsAnalysis ,#chkIsCAD,,#chkIsColor,#chkIsLabdip ,#chkIsYarnSkein').prop('disabled',true);

        $("#cboFinishTypeFabric").icsLoadCombo({ List: _oFinishTypes,OptionValue: "FabricProcessID",   DisplayText: "Name" });
        $("#cboProductFabric").icsLoadCombo({    List: _oProducts,    OptionValue: "ProductID",    DisplayText: "ProductName"   });
        $("#cboPriorityLevelFabric").icsLoadCombo({    List: _oPriorityLevels,    OptionValue: "Value",   DisplayText: "Text" });
        $("#cboProcessTypeFabric,#cboProcessTypeEnt").icsLoadCombo({  List: _oProcessTypes, OptionValue: "FabricProcessID",  DisplayText: "Name" });
        $("#cboWeaveFabric").icsLoadCombo({  List: _oFabricWeaves,   OptionValue: "FabricProcessID",   DisplayText: "Name" });
        $("#cboFabricDesign").icsLoadCombo({  List: _oFabricDesigns,   OptionValue: "FabricProcessID",    DisplayText: "Name"  });
        $("#cboPrimaryLightSource,#cboSecondaryLightSource").icsLoadCombo({ List: _oLightSources,   OptionValue: "LightSourceID",   DisplayText: "Descriptions" });
    }
    function LoadComboAdv()
    {
        //DynamicRefreshList(_oOrderTypes, "tblOrderTypes");
        //DynamicRefreshList(_oLabdipStatus, "tblLabStatuss");
        //DynamicRefreshList(_oFabricPOStatus, "tblCurrentStatuss");
        $("#cboPODate,#cboApproveDate,#cboReceivedDate,#cboExcDate").icsLoadCombo({
            List: _oCompareOperators,
            OptionValue: "id",
            DisplayText: "Value"
        });
    }
    function CheckFromAndToDateValidation(OperationComboId, FromDateId, ToDateId) {
        $("#" + OperationComboId).parent().parent().parent().find("select").removeClass("errorFieldBorder");
        var nCboVal = $("#" + OperationComboId).val();
        if (parseInt(nCboVal) == 5 || parseInt(nCboVal) == 6) {
            var fromDate = $("#" + FromDateId).datebox("getValue");
            var toDate = $("#" + ToDateId).datebox("getValue");
            if (new Date(fromDate) > new Date(toDate)) {
                $("#" + ToDateId).focus();
                $("#" + OperationComboId).addClass("errorFieldBorder");
                $(".lblLoadingMessage").hide();
                return false;
            } else {
                $("#" + OperationComboId).removeClass("errorFieldBorder");
                return true;
            }
        } else {
            return true;
        }
    }

    function ResetAdvSearchWindow() {
        _sContractorIds = '';
        _sBankBranch_IssueIds = "";
        $(".lblLoadingMessage").hide();
        $("#winAdvSearch input").not("input[type='button']").val("");
        $("#winAdvSearch input").removeClass("fontColorOfPickItem");
        $("#winAdvSearch select").val(0);
        DateActions_OPDate();
        DateActions_ApproveDate();
        DateActions_ReceivedDate();
        $("#txtFromPODate,#txtToPODate").datebox({ disabled: true });
        $("#txtFromPODate,#txtToPODate").datebox("setValue", icsdateformat(new Date()));

        $("#txtFromApproveDate,#txtToApproveDate").datebox({ disabled: true });
        $("#txtFromApproveDate,#txtToApproveDate").datebox("setValue", icsdateformat(new Date()));

        $('#chkReceived,#chkBatch,#chkWatingForLab').prop('checked',false);
    }

    function DateActions_OPDate() {
        DynamicDateActions("cboPODate", "txtFromPODate", "txtToPODate");
    }
    function DateActions_ApproveDate() {
        DynamicDateActions("cboApproveDate", "txtFromApproveDate", "txtToApproveDate");
    }
    function DateActions_ReceivedDate() {
        DynamicDateActions("cboReceivedDate", "txtFromReceivedDate", "txtToReceivedDate");
    }
    function DateActions_ExcDate() {
        DynamicDateActions("cboExcDate", "txtFromExcDate", "txtToExcDate");
    }

    $("#btnCloseAdvSearch").click(function () {
        $("#winAdvSearch").icsWindow("close");
    });
    $("#btnAdvSearch").click(function () {
        debugger;
        $(".lblLoadingMessage").hide();
        $("#winAdvSearch").icsWindow("open", "Production Request Advance Search");
        //DynamicRefreshList([], "tblExportPIAdvSearch");
        DynamicResetAdvSearchWindow("winAdvSearch");
        ResetAdvSearchWindow();
        LoadComboAdv();
    });
    /*-----------------END ADV SEARCH-----------------*/


    $('#txtBatchNoSearch').keypress(function (e) {

        var code = (e.keyCode ? e.keyCode : e.which);
        if (code == 13)//Enter key-13
        {
            if ($.trim($("#txtBatchNoSearch").val()) == "")
            {
                alert("Please give PO No.");
                return false;
            }

            Search();
        }

    });
    $('#txtFNExeNoSearch').keypress(function (e) {

        var code = (e.keyCode ? e.keyCode : e.which);
        if (code == 13)//Enter key-13
        {
            if ($.trim($("#txtFNExeNoSearch").val()) == "")
            {
                alert("Please give Dispo No.");
                return false;
            }

            Search();
        }

    });

    function Search()
    {
        var oFabricSCReport = {
            ExeNo : $('#txtFNExeNoSearch').val(),
            SCNoFull : $('#txtBatchNoSearch').val()
        }
        var obj =
       {
           BaseAddress: _sBaseAddress,
           Object: oFabricSCReport,
           ControllerName: "FNBatch",
           ActionName: "Search",
           IsWinClose: false
       };
        $.icsDataGets(obj, function (response) {
            if (response.status && response.objs.length > 0) {
                if (response.objs.length > 0) {
                    DynamicRefreshList(response.objs, "tblFabricSCReport");
                }
                else {
                    DynamicRefreshList([], "tblFabricSCReport");
                }
            } else {
                DynamicRefreshList([], "tblFabricSCReport");
            }
        });
    }

    $('#btnEdit').click(function (e)
    {
        debugger;
        var oFabricSCReport = $('#tblFabricSCReport').datagrid('getSelected');
        if (parseFloat(oFabricSCReport.OutQty)>0 ) { alert("Unable to modify. Already fabric out."); return ; }
        var nIndex=$('#tblFabricSCReport').datagrid('getRowIndex',oFabricSCReport);
        sessionStorage.setItem("Operation", "Edit");
        sessionStorage.setItem("SelectedRowIndex", nIndex);
        sessionStorage.setItem("FabricSCReportHeader", "Edit FabricSCReport");
        sessionStorage.setItem("FabricSalesContractID", oFabricSCReport.FabricSalesContractID);
        sessionStorage.setItem("FabricSCReports", JSON.stringify($('#tblFabricSCReport').datagrid('getRows')));
        sessionStorage.setItem("BackLink", window.location.href);
        var tsv=((new Date()).getTime())/1000;
        window.location.href = _sBaseAddress+ "/FNBatch/ViewFNBatch_FSC?nId="+oFabricSCReport.FabricSalesContractDetailID+"&buid="+_nBUID;
    });
    $('#btnProcess').click(function (e)
    {
        debugger;
        var oFabricSCReport = $('#tblFabricSCReport').datagrid('getSelected');
        if (parseFloat(oFabricSCReport.OutQty)>0 ) { alert("Unable to modify. Already fabric out."); return ; }
        var nIndex=$('#tblFabricSCReport').datagrid('getRowIndex',oFabricSCReport);
        sessionStorage.setItem("Operation", "Edit");
        sessionStorage.setItem("SelectedRowIndex", nIndex);
        sessionStorage.setItem("FabricSCReportHeader", "Edit FabricSCReport");
        sessionStorage.setItem("FabricSalesContractID", oFabricSCReport.FabricSalesContractID);
        sessionStorage.setItem("FabricSCReports", JSON.stringify($('#tblFabricSCReport').datagrid('getRows')));
        sessionStorage.setItem("BackLink", window.location.href);
        var tsv=((new Date()).getTime())/1000;
        window.location.href = _sBaseAddress+ "/FNBatch/ViewFNBatch_PS?nId="+oFabricSCReport.FabricSalesContractDetailID+"&buid="+_nBUID;
    });
    $('#btnDelete').click(function(e){
        var oFabricSCReport = $('#tblFabricSCReport').datagrid('getSelected');
        if (oFabricSCReport ==null || oFabricSCReport.FabricSCReportID <=0 ) { alert("Please select an item from list."); return ; }
        if (parseFloat(oFabricSCReport.OutQty)>0 ) { alert("Unable to delete. Already fabric out."); return ; }

        if (!confirm("Confirm to delete?")) return;
        sessionStorage.clear();
        var obj =
        {
            BaseAddress: _sBaseAddress,
            Object: oFabricSCReport,
            ControllerName: "FabricSCReport",
            ActionName: "DeleteOrder",
            TableId: "tblFabricSCReport",
            IsWinClose: false
        };
        $.icsDelete(obj);
    });
    $('#btnView').click(function (e)
    {
        var oFabricSCReport = $('#tblFabricSCReport').datagrid('getSelected');
        if (oFabricSCReport ==null || oFabricSCReport.FabricSCReportID <=0 ) { alert("Please select an item from list."); return ; }

        var nIndex=$('#tblFabricSCReport').datagrid('getRowIndex',oFabricSCReport);

        sessionStorage.clear();
        sessionStorage.setItem("Operation", "View");
        sessionStorage.setItem("SelectedRowIndex", nIndex);
        sessionStorage.setItem("FabricSCReportHeader", "View FabricSCReport");
        sessionStorage.setItem("FabricSCReports", JSON.stringify($('#tblFabricSCReport').datagrid('getRows')));
        sessionStorage.setItem("BackLink", window.location.href);
        var tsv=((new Date()).getTime())/1000;
        window.location.href = _sBaseAddress+ "/FabricSCReport/ViewFabricSCReport?nId="+oFabricSCReport.FabricSCReportID+"&ts="+tsv;;
    });
    $('#btnPrintPB').click(function (e)
    {
        var oFabricSCReport = $('#tblFabricSCReport').datagrid('getSelected');
        if (oFabricSCReport ==null || oFabricSCReport.FabricID <=0 ) { alert("Please select an item from list."); return ; }
        var tsv=((new Date()).getTime())/1000;
        window.open(_sBaseAddress+ "/FNBatch/Print_FNPProcess?nFabricID="+oFabricSCReport.FabricID+"&nBUID="+_nBUID+"&nts="+tsv, "_blank");
    });
    $('#btnPrintBack').click(function (e)
    {
        var tsv=((new Date()).getTime())/1000;
        window.open(_sBaseAddress+ "/FabricSCReport/PrintFabricSCReportCardDetail?&nts="+tsv, "_blank");
    });
    /*****************Fabric Out*****************/
    function SummaryCalculation(oFNBRMs){
        var nTotalBalance=0, nOutQty=0;
        for(var i=0; i<oFNBRMs.length;i++){
            nTotalBalance+= parseFloat(oFNBRMs[i].Balance);
            nOutQty+= parseFloat(oFNBRMs[i].Qty);
        }
        $('#lblTotalBalance').text(formatPrice(nTotalBalance));
        $('#lblTotalOutQty').text(formatPrice(nOutQty));

        var nQty=icsRemoveComma($('#txtYetToOutQty').val());

        if(parseFloat(nTotalBalance)< parseFloat(nQty)){
            $('#lblRemarks').html('<span style="color:red">Insufficient Lot Balance, partially out can be possible.<span>');
        }
        else if(nQty>0){
            $('#lblRemarks').html('<span style="color:Green">Fully out can be possible.<span>');
        }
        else{
            $('#lblRemarks').html('<span style="color:Red">No remaining qty found.<span>');
        }
    }
    $("#btnFabricOut").click(function () {
        editIndex = undefined;
        $('#cboStore').val($("#cboStore").data("WorkingUnitID"));
        $('#lblRemarks').html('');
        $('#txtBatchNo').data('FabricSCReportID',0);
        DynamicRefreshList([],'tblFabricSCReportRawMaterail');
        var oFabricSCReport = $('#tblFabricSCReport').datagrid('getSelected');
        if (oFabricSCReport ==null || oFabricSCReport.FabricSCReportID <=0 ) { alert("Please select an item from list."); return ; }
        var obj =
        {
            BaseAddress: _sBaseAddress,
            Object: oFabricSCReport,
            ControllerName: "FabricSCReport",
            ActionName: "Get",
            IsWinClose: false
        };
        $.icsDataGet(obj, function (response) {
            if (response.status && response.obj != null) {
                if(response.obj.FabricSCReportID>0)
                {
                    $('#txtBatchNo').data('FabricSCReportID',response.obj.FabricSCReportID);
                    $('#txtBatchNo').val(response.obj.BatchNo);
                    $('#dtIssue,#dtExpDelivery').datebox({'disabled':true})
                    $('#dtIssue').datebox('setValue',response.obj.IssueDateStr);
                    $('#dtExpDelivery').datebox('setValue',response.obj.ExpectedDeliveryDateStr);
                    $('#txtCount').val(response.obj.CountName);
                    $('#txtConstruction').val(response.obj.Construction);
                    $('#txtIssueQty').val(formatPrice(response.obj.Qty));
                    $('#txtIssueQtyMtr').val(formatPrice(GetMeter(response.obj.Qty,2)));
                    $('#txtYetToOutQty').val(formatPrice(response.obj.YetToOutQty));
                    $('#txtYetToOutQtyMtr').val(formatPrice(GetMeter(response.obj.YetToOutQty,2)));
                    $("#winFabricOut").icsWindow('open', "Fabric Out");
                }
                else
                {
                    alert("No FN batch found.");
                }
            }
        });
    });
    $('#cboStore').change(function(e) {
        GetFabricSCReportRawMaterial(false);
    });
    function GetFabricSCReportRawMaterial(bIsInitailOpen){
        if($('#cboStore').val()>0){
            if($('#txtBatchNo').data('FabricSCReportID')<=0){
                alert("FN batch required");
                return false;
            }
            DynamicRefreshList([],'tblFabricSCReportRawMaterail');
            SummaryCalculation([]);
            $('#lblRemarks').html('');
            var oFabricSCReport = {
                FabricSCReportID:$('#txtBatchNo').data('FabricSCReportID'),
                Params:$('#cboStore').val()
            }
            var obj =
            {
                BaseAddress: _sBaseAddress,
                Object: oFabricSCReport,
                ControllerName: "FabricSCReport",
                ActionName: "GetsLotByFabricSCReport",
                IsWinClose: false
            };
            $.icsDataGets(obj, function (response) {

                if (response.status && response.objs != null && response.objs.length>0 && response.objs[0].LotID>0) {
                    var nQty=icsRemoveComma($('#txtYetToOutQty').val());
                    for(var i=0; i<response.objs.length;i++)
                    {
                        if(parseFloat(response.objs[i].Balance)>=nQty && nQty>0){
                            response.objs[i].Qty = nQty;
                            nQty-=nQty;
                        }
                        else if (parseFloat(response.objs[i].Balance)<nQty && nQty>0){
                            response.objs[i].Qty = parseFloat(response.objs[i].Balance);
                            nQty-=parseFloat(response.objs[i].Balance);
                        }
                    }

                    DynamicRefreshList(response.objs,'tblFabricSCReportRawMaterail');
                    SummaryCalculation(response.objs);
                }
                else{
                    if(!bIsInitailOpen)
                        alert("No lot found.");
                }
            });
        }
        else{
            DynamicRefreshList([],'tblFabricSCReportRawMaterail');
        }
    }
    $('#btnSaveFabricOut').click(function(e){

        if($('#cboStore').val()<=0){
            alert("Please select a store.");
            $('#cboStore').focus();
            return false;
        }
        if(!endEditing())
            return false;
        debugger;
        var oRows = $('#tblFabricSCReportRawMaterail').datagrid('getRows');
        var oFNBRMs=[];
        var nQty=0;
        for(var i=0;i<oRows.length;i++){
            if(oRows[i].Qty>0){
                nQty+=parseFloat(oRows[i].Qty);
                oFNBRMs.push(oRows[i]);
            }
        }
        var oFabricSCReport = {
            FabricSCReportID:0,
            FabricSCReportRawMaterials : oFNBRMs,
        };
        var obj = {
            BaseAddress: _sBaseAddress,
            Object: oFabricSCReport,
            ObjectId:"FabricSCReportID",
            ControllerName: "FabricSCReport",
            ActionName: "FabricOut",
            TableId:"",
            IsWinClose: false,
            Message: ""
        };

        debugger;
        $.icsSave(obj, function (response) {

            debugger;
            if (response.status && response.obj!=null) {
                if (response.obj.FabricSCReportRawMaterials.length > 0 && response.obj.FabricSCReportRawMaterials[0].FBRMID>0) {
                    alert("Fabric out successfully.");
                    $("#winFabricOut").icsWindow('close');
                    var nOutQty=0;
                    for(var i=0;i<response.obj.FabricSCReportRawMaterials.length;i++){
                        nOutQty=nOutQty+parseFloat(response.obj.FabricSCReportRawMaterials[i].Qty);
                    }
                    var oFabricSCReport=$('#tblFabricSCReport').datagrid('getSelected');
                    var nIndex=$('#tblFabricSCReport').datagrid('getRowIndex',oFabricSCReport);
                    oFabricSCReport.OutQty= parseFloat(oFabricSCReport.OutQty)+ parseFloat(nOutQty);
                    oFabricSCReport.OutQtyInMtr=GetMeter(parseFloat(oFabricSCReport.OutQty),2);

                    $("#tblFabricSCReport").datagrid("updateRow", { index: nIndex, row: oFabricSCReport });
                }
            }
            else{
                alert("Unable to fabric out.");
            }
        });
    });
    $("#btnCloseFabricOut").click(function () {
        $("#winFabricOut").icsWindow('close');
    });
    var editIndex = undefined;
    function endEditing() {
        debugger;
        if (editIndex == undefined) { return true }
        if ($('#tblFabricSCReportRawMaterail').datagrid('validateRow', editIndex)) {
            $('#tblFabricSCReportRawMaterail').datagrid('endEdit', editIndex);
            $('#tblFabricSCReportRawMaterail').datagrid('selectRow', editIndex);
            var oFNBRM = $('#tblFabricSCReportRawMaterail').datagrid('getSelected');
            if(oFNBRM.Balance<oFNBRM.Qty)
            {
                alert("Maximum allowed qty "+ formatPrice(oFNBRM.Balance));
                $('#tblFabricSCReportRawMaterail').datagrid('selectRow', editIndex).datagrid('beginEdit', editIndex);
                return false;
            }
            SummaryCalculation($('#tblFabricSCReportRawMaterail').datagrid('getRows'));
            editIndex = undefined;
            return true;
        } else {
            return false;
        }
    }
    function onClickRow(index) {

        if (editIndex != index) {
            if (endEditing()) {
                $('#tblFabricSCReportRawMaterail').datagrid('selectRow', index)
                        .datagrid('beginEdit', index);
                editIndex = index;
            } else {
                $('#tblFabricSCReportRawMaterail').datagrid('selectRow', editIndex);
            }
        }
    }
    $("#btnFNBQCSticker").click(function () {

        var oFabricSCReport = $('#tblFabricSCReport').datagrid('getSelected');
        if (oFabricSCReport ==null || oFabricSCReport.FabricSCReportID <=0 ) { alert("Please select an item from list."); return ; }
        var obj =
        {
            BaseAddress: _sBaseAddress,
            Object: oFabricSCReport,
            ControllerName: "FabricSCReport",
            ActionName: "Get",
            IsWinClose: false
        };
        $.icsDataGet(obj, function (response) {
            if (response.status && response.obj != null) {
                if(response.obj.FabricSCReportID>0)
                {
                    $('#txtFabricSCReportNo').data('FabricSCReportID',response.obj.FabricSCReportID);
                    $('#txtFabricSCReportNo').val(response.obj.BatchNo);
                    $('#txtFabricSCReportQty').val(formatPrice(response.obj.Qty));
                    $('#txtFNOutQty').val(formatPrice(response.obj.OutQty));
                    $('#txtFNQCQty').val(formatPrice(response.obj.QCQty));
                    obj =
                    {
                        BaseAddress: _sBaseAddress,
                        Object: {FabricSCReportID:response.obj.FabricSCReportID},
                        ControllerName: "FabricSCReport",
                        ActionName: "GetLastFabricSCReportQCDetail",
                        IsWinClose: false
                    };
                    $.icsDataGet(obj, function (response) {
                        if (response.status && response.obj != null) {
                            if(response.obj.FabricSCReportQCDetailID>0)
                            {
                                $('#txtLastRollNo').val(response.obj.LotNo);
                            }
                        }
                    });
                    $("#winFNBQCProcess").icsWindow('open');
                }
                else
                {
                    alert("No FN batch found.");
                }
            }
        });
    });
    $('#btnPrintFNBQCProcess').click(function(e){

        if(parseInt($('#txtFabricSCReportNo').data('FabricSCReportID'))<=0)
        {
            alert("FN Batch not found.!");
            $('#txtFabricSCReportNo').focus();
            return false;
        }
        if($.trim($('#txtFNRollNo').val())=='')
        {
            alert("Roll no required.!");
            $('#txtFNRollNo').focus();
            return false;
        }
        if(parseInt($('#txtFNStickerCount').val())<=0)
        {
            alert("No of sticker count required.!");
            $('#txtFNRollNo').focus();
            return false;
        }
        var tsv=((new Date()).getTime())/1000;
        var sParams=parseInt($('#txtFabricSCReportNo').data('FabricSCReportID'))+'~'+$.trim($('#txtFNRollNo').val())+'~'+$('#txtFNROllSequence').val()+'~'+$('#txtFNStickerCount').val();
        window.open(_sBaseAddress+ "/FabricSCReport/PrintFabricSCReportQCWithProcessSticker?sParams="+sParams+"&nts="+tsv, "_blank");
    });
    $("#btnCloseFNBQCProcess").click(function () {
        $("#winFNBQCProcess").icsWindow('close');
    });
                      </script>













