
@model IEnumerable<ESimSol.BusinessObjects.NOA>
@{
    ViewBag.Title = ViewBag.NOAOperationType.Value + " List";
}

<head>
</head>
 <body>
    <div id="winNOAAdvanceSearch" class="easyui-window winClass" title="Advance Search" data-options="modal:true,closed:true,collapsible:false,minimizable:false,maximizable:false,closable:false">
        <div style="width:730px; float: left;">
            <table border="0" cellpadding="0" cellspacing="0" style="font-size: 12px">
                <tr style="height: 200px">
                    <td style="width: 300px">
                        <table border="0" cellpadding="0" cellspacing="0" style="font-size: 12px">
                            <tr style="height: 200px">
                                <td style="width: 400px; vertical-align: top; height: 200px">
                                    <fieldset>
                                        <legend style="font-weight: bold; font-size: 12px">Searching Criteria : </legend>
                                        <table border="0" cellpadding="0" cellspacing="0" style="width: 340px; font-size: 12px">
                                            <tr>
                                                <td style="width: 130px; text-align: left; font-weight: bold">
                                                    @ViewBag.NOAOperationType.Value No:
                                                </td>
                                            </tr>
                                            <tr>
                                                <td style="width: 325px; text-align: left">
                                                    @Html.TextBox("txtSearchNOANo", "", new { style = "width: 325px", id = "txtSearchNOANo" })
                                                </td>
                                            </tr>

                                            <tr>
                                                <td style="width:25%; text-align:left;">
                                                    <label style="font-weight:bold;">Department  :</label> <br />
                                                    <input id="txtDepartmentName" style="width:80%" type="text" placeholder="Pick Department" />
                                                    <input id="btnDepartmentPicker_Collection" style="width: 14%;" type="button" value="Pick" />
                                                </td>
                                            </tr>
                                           
                                            <tr>
                                                <td style="width: 130px; text-align: left; font-weight: bold">
                                                    @ViewBag.NOAOperationType.Value Date:
                                                </td>
                                            </tr>
                                            <tr>
                                                <td style="width: 325px; text-align: left; font-size: 12px">
                                                    <table border="0" style="font-size: 12px">
                                                        <tr>
                                                            <td style="width: 100px; font-size: 12px; text-align: left">
                                                                @Html.DropDownList("cboNOADate", new SelectList(Enum.GetValues(typeof(ESimSol.BusinessObjects.EnumCompareOperator))), new { id = "cboNOADate", style = "width: 100px;font-size:12px;text-align:left", @class = "_select_changeA" })
                                                            </td>
                                                            <td style="width: 98px; font-size: 12px">
                                                                <input id="txtNOAStartDate" type="text" class="easyui-datebox" required="required" data-options="formatter:icsdateformat,parser:icsdateparser" style="width: 98px;" />
                                                            </td>

                                                            <td style="width: 9px; font-size: 12px" id="enddateT">
                                                                To
                                                            </td>
                                                            <td style="width: 97px; font-size: 12px" id="enddate">
                                                                <input id="txtNOAEndDate" type="text" class="easyui-datebox" required="required" data-options="formatter:icsdateformat,parser:icsdateparser" style="width: 98px;" />
                                                            </td>

                                                        </tr>
                                                    </table>
                                                </td>
                                            </tr>

                                            <tr>
                                                <td style="width: 130px; text-align: left; font-weight: bold">
                                                    Approve Date:
                                                </td>
                                            </tr>
                                            <tr>
                                                <td style="width: 325px; text-align: left; font-size: 12px">
                                                    <table border="0" style="font-size: 12px">
                                                        <tr>
                                                            <td style="width: 100px; font-size: 12px; text-align: left">
                                                                @Html.DropDownList("cboApproveDate", new SelectList(Enum.GetValues(typeof(ESimSol.BusinessObjects.EnumCompareOperator))), new { id = "cboApproveDate", style = "width: 100px;font-size:12px;text-align:left", @class = "_select_changeB" })
                                                            </td>
                                                            <td style="width: 98px; font-size: 12px">
                                                                <input id="txtApproveStartDate" type="text" class="easyui-datebox" required="required" data-options="formatter:icsdateformat,parser:icsdateparser" style="width: 98px;" />
                                                            </td>

                                                            <td style="width: 9px; font-size: 12px" id="enddateTA">
                                                                To
                                                            </td>
                                                            <td style="width: 97px; font-size: 12px" id="enddateA">
                                                                <input id="txtApproveEndDate" type="text" class="easyui-datebox" required="required" data-options="formatter:icsdateformat,parser:icsdateparser" style="width: 98px;" />
                                                            </td>

                                                        </tr>
                                                    </table>
                                                </td>
                                            </tr>
                                            <tr>
                                                <td style="width:25%; text-align:left;">
                                                    <label style="font-weight:bold;">Product  :</label> <br />
                                                    <input type="text" id="txtProductName" placeholder="Type Product Name & Press Enter" style="width:226px;" />
                                                    <a id="btnProductPick" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-search" plain="true" onclick="PickProduct()">Pick Product</a>
                                                </td>
                                            </tr>

                                            <tr>
                                                <td style="width: 130px; text-align: left; font-weight: bold">
                                                    MPR No:
                                                </td>
                                            </tr>
                                            <tr>
                                                <td style="width: 325px; text-align: left">
                                                    @Html.TextBox("txtMPRNo", "", new { style = "width: 325px", id = "txtMPRNo" })
                                                </td>
                                            </tr>
                                            <tr>
                                                <td style="width: 130px; text-align: left; font-weight: bold">
                                                    Quotation No:
                                                </td>
                                            </tr>
                                            <tr>
                                                <td style="width: 325px; text-align: left">
                                                    @Html.TextBox("txtQuotationNo", "", new { style = "width: 325px", id = "txtQuotationNo" })
                                                </td>
                                            </tr>
                                            <tr>
                                                <td style="width:25%; text-align:left;">
                                                    <label style="font-weight:bold;">Supplier  :</label> <br />
                                                    <input type="text" id="txtSupplierName" placeholder="Type Supplier Name & Press Enter" style="width:226px;" />
                                                    <a id="btnSupplierPick" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-search" plain="true" onclick="PickSupplier()">Pick Supplier</a>
                                                </td>
                                            </tr>

                                            <tr style="height:50px; vertical-align: bottom">
                                                <td style=" text-align:left; width:325px;">
                                                    <table border="0" cellpadding="0" cellspacing="0">
                                                        <tr>
                                                            <td style=" text-align:left;"><input type="button" value="Reset" id="btnReset" style="width:70px; text-align:left;" /></td>
                                                           
                                                            <td style=" text-align:right; width:50%;padding-bottom:10px;"><a href="javascript:void(0)" id="btnPrintExcel" class="easyui-linkbutton" iconcls="icon-print" plain="true">Excel</a></td>
                                                            <td style=" text-align:right; width:255px;"><input type="button" value="Search" id="btnRefresh" style="width:70px; text-align:right;" /></td>
                                                        </tr>
                                                    </table>
                                                </td>
                                            </tr>
                                        </table>
                                    </fieldset>
                                </td>
                                <td style="width: 323px; height: 340px;  vertical-align:top;">
                                    <div style="margin-left:0px; margin-top:6px; height:310px">
                                        <table id="tblNOAList" title="@ViewBag.NOAOperationType.Value List" class="easyui-datagrid" style="width: 358px;height:415px; font-size: 12px" fitcolumns="false" rownumbers="true" pagination="false" singleselect="false" autorowheight="false" data-options="resizehandle:'right', resizable:true ">
                                            <thead>
                                                <tr>
                                                    <th data-options="field:'Selected',checkbox:true"></th>
                                                    <th field="NOANo" width="80" align="left">@ViewBag.NOAOperationType.Value No</th>
                                                    <th field="NOADateInString" width="60" align="left">Date</th>
                                                    <th field="PrepareByName" width="100" align="left">Prepare By</th>
                                                    <th field="ApprovedByName" width="130" align="left">Approved By</th>
                                                </tr>
                                            </thead>
                                        </table>
                                    </div>
                                </td>
                            </tr>
                        </table>
                    </td>
                </tr>
                <tr style="height:30px">
                    <td style="width: 650px; text-align: right">
                        <a href="javascript:void(0)" id="btnOkButtonClick" class="easyui-linkbutton" iconcls="icon-ok" plain="true">Ok</a>
                        <a href="javascript:void(0)" id="btnSearchClose" class="easyui-linkbutton" iconcls="icon-cancel" plain="true">Close</a>
                    </td>
                </tr>
            </table>
        </div>
    </div>
     <div id="winAttachPurchaseQuoation" class="easyui-window" title="Attach Purchase Quotation" data-options="modal:true,closed:true,collapsible:false,minimizable:false,maximizable:false,closable:false">
         <div style="height: 250px; width:100%">
             <table id="tblNOAQuotation" class="easyui-datagrid" fit="true" fitcolumns="true" rownumbers="true" pagination="false" singleselect="true" , autorowheight="false" toolbar="#toolbarNOAQuotation">
                 <thead>
                     <tr>
                         <th field="PQNo" width="60">PQ NO</th>
                         <th field="SupplierName" width="150">Supplier</th>
                     </tr>
                 </thead>
             </table>
             <div id="toolbarNOAQuotation">
                 <input type="text" id="txtPQNo" placeholder="Type PQ NO & Press Enter" style="width:150px" />
                 <a id="btnPickPQ" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-ok" plain="true">Pick</a>
                 <a id="btnAddNOAQuotation" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-add" plain="true">Add</a>
                 <a id="btnRemoveNOAQuotation" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-remove" plain="true">Remove</a>
             </div>
         </div>

         <fieldset style="font-family:Tahoma">
             <legend style="font-weight:bold"> Action : </legend>
             <table border="0" cellspacing="2" cellpadding="2" style="font-size:11px;width:100%; font-weight:bold;font-size:12">
                 <tr>
                     <td style="width:250px; text-align:right"></td>
                     <td style="width:60px;font-size:13px;text-align:right"><a id="btnClose" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-cancel" plain="true" onclick="CloseNOAQuotation()">Close</a></td>
                 </tr>
             </table>
         </fieldset>
     </div>
     <div id="winAttachPurchaseRequisition" class="easyui-window" title="Attach Purchase Requisition" data-options="modal:true,closed:true,collapsible:false,minimizable:false,maximizable:false,closable:false">
         <div style="height: 250px; width:100%">
             <table id="tblNOARequisition" class="easyui-datagrid" fit="true" fitcolumns="true" rownumbers="true" pagination="false" singleselect="true" , autorowheight="false" toolbar="#toolbarNOARequisition">
                 <thead>
                     <tr>
                         <th field="PRNo" width="60">PR NO</th>
                         <th field="PrepareByName" width="150">Prepare By</th>
                     </tr>
                 </thead>
             </table>
             <div id="toolbarNOARequisition">
                 <input type="text" id="txtPRNo" placeholder="Type PR NO & Press Enter" style="width:150px" />
                 <a id="btnPickPR" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-ok" plain="true">Pick</a>
                 <a id="btnAddNOARequisition" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-add" plain="true">Add</a>
                 <a id="btnRemoveNOARequisition" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-remove" plain="true">Remove</a>
             </div>
         </div>

         <fieldset style="font-family:Tahoma">
             <legend style="font-weight:bold"> Action : </legend>
             <table border="0" cellspacing="2" cellpadding="2" style="font-size:11px;width:100%; font-weight:bold;font-size:12">
                 <tr>
                     <td style="width:250px; text-align:right"></td>
                     <td style="width:60px;font-size:13px;text-align:right"><a id="btnClose" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-cancel" plain="true" onclick="CloseNOARequisition()">Close</a></td>
                 </tr>
             </table>
         </fieldset>
     </div>
    <div  class="menuMainCollectionTable" id="mdiv" style="margin-left: 0px; height:100%; width:100%">
        <div style="margin-left: 0px; height:100%; width:100%">
            <table id="tblNOAs" title="(Note of Approval)/CS List" style="width:100%" class="easyui-datagrid" fit="true" fitcolumns="false"
                   rownumbers="true" pagination="true" singleselect="true" autorowheight="false" toolbar="#toolbar" data-options="resizable:true">
                <thead>
                    <tr>
                        <th field="NOANo" width="15%" align="left">@ViewBag.NOAOperationType.Value No</th>
                        <th field="NOADateInString" width="12%" align="left">Date</th>
                        <th field="PrepareByName" width="15%" align="left">Prepare By</th>
                        <th field="ApprovalHead" width="10%" align="left">State</th>
                        <th field="ApprovedByName" width="15%" align="left">Approved By</th>
                        <th field="BUName" width="10%" align="left">Business Unit</th>
                    </tr>
                </thead>
            </table>
            <div id="toolbar">
                <input type="text" id="txtNOANo" placeholder="Type @ViewBag.NOAOperationType.Value No & Press Enter" style="width: 150px;" />
                <a id="btnSearch" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-search" plain="true">Search</a>
                <a id="btnAdd" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-add" plain="true" onclick="Add()">New</a>
                <a id="btnEdit" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-edit" plain="true" onclick="Edit()">Edit</a>
                <a id="btnDelete" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-remove" plain="true" onclick="Delete()">Delete</a>
                <a id="btnView" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-details" plain="true" onclick="Details()">View</a>
                <a id="btnRequestFor" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-approved" plain="true" >Request</a>
                <a id="btnApproved" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-approved" plain="true" onclick="Approve()">Approval View </a>
                @*<a id="btnUndoApproved" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-undo" plain="true" onclick="UndoApprove()">Undo Approve</a>*@
                <a id="btnAttachPQ" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-add" plain="true" onclick="AttachPQ()">Attach PQ</a>
                @*<a id="btnAttachPR" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-add" plain="true" onclick="AttachPR()">Attach PR</a>*@                
                <a id="btnCopyNOA" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-copy" plain="true">Copy @ViewBag.NOAOperationType.Value</a>
                <a id="btnPrintPreview" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-print" plain="true" onclick="PrintPreview()">Preview</a>
                <a id="btnPrintPreviewWithoutTechHead" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-print" plain="true" onclick="PrintPreviewWithoutTechHead()">Preview Without Tech Head</a>
                <a id="btnPrintPreviewNormal" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-print" plain="true" onclick="PrintPreviewNormal()">Preview(Normal)</a>
                <a id="btnPrintList" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-print" plain="true" onclick="PrintList()"> Print List</a>
                <a id="btnRequestRevise" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-request" plain="true">Request Revise</a>
                <a id="btnAcceptRevise" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-ok" plain="true">Accept Revise</a>
                <a id="btnReviseHistory" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-details" plain="true">Revise History</a>
            </div>
        </div>
    </div>
 </body>
<script type="text/javascript">
    var _oNOAs=[];
    var _sBaseAddress="";
    var _oAuthorizationRolesMapping=[];
    var _oLoadNOAStatus=[];
    var _oEmployees = [];
    var _sProductIDs = "";
    var _nPRIDs = "";
    var _oNOAQuotations = [];
    var _oPQs = [];
    var _oPRs = [];
    var _nNOAID = 0;
    var _nDepartmentIDs="";
    var _sSupplierIDs="";
    $(document).ready(function () {
        //debugger;
        _oNOAs =@Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(Model));
        _sBaseAddress =@Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(HttpContext.Current.Session[SessionInfo.BaseAddress]));
        _oAuthorizationRolesMapping =@Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(HttpContext.Current.Session[SessionInfo.AuthorizationRolesMapping]));
        var nBUID = @Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(ViewBag.BUID));
        var oNOAOperationType = @Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(ViewBag.NOAOperationType));
        debugger;
        sessionStorage.setItem("BUID",nBUID);
        var oNOAs =sessionStorage.getItem("NOAs");
        if(oNOAs!=null )
        {
            oNOAs = jQuery.parseJSON(oNOAs);
        }
        else
        {
            oNOAs=_oNOAs;
        }
        RefreshList(oNOAs);
        RefreshControlLayout();
        $('#tblNOAs').datagrid({onSelect: function(rowIndex, rowData){ RowSelect(rowData);}});

    });

    function RowSelect(oNOAs)
    {
        debugger;
        ////Commercial Invoice Status:
        //document.getElementById("btnIC").style.display = 'none';
        //document.getElementById("btnSendToBuyer").style.display = 'none';
        //document.getElementById("btnBuyerAccepted").style.display = 'none';
        //document.getElementById("btnEncashment").style.display = 'none';
        //document.getElementById("btnBillClosed").style.display = 'none';
        //document.getElementById("btnUndoStatus").style.display = 'none';

        //if(parseInt(oNOAs.ApproveBy)!=0)
        //{
        //    document.getElementById("btnApproved").style.display = 'none';
        //}
        //if(parseInt(oNOAs.ApproveBy)==0)
        //{
        //    document.getElementById("btnApproved").style.display = '';
        //}

    }
    $("#btnRequestRevise").click(function(e){
        debugger;
        
        var oNOA= $('#tblNOAs').datagrid('getSelected');
        if(oNOA==null || oNOA.NOAID<=0)
        {
            alert("Please select a item from list!");
            return;
        }

        if(parseInt(oNOA.ApproveBy)==0)
        {
            alert("First Approve this item then request for revise!");
            return false;
        }
        if (!confirm("Confirm to Request?")) return ;
        debugger;
        var obj={
            NOAID:oNOA.NOAID
        };

        var SelectedRowIndex=$('#tblNOAs').datagrid('getRowIndex',oNOA);
        $.ajax({
            type: "POST",
            dataType: "json",
            url : _sBaseAddress+"/NOA/RequestRevise",
            traditional: true,
            data:  JSON.stringify(obj),
            contentType: "application/json; charset=utf-8",
            success: function (data) {
                debugger;
                var oNofA= jQuery.parseJSON(data);
                if (oNofA.ErrorMessage=="" || oNofA.ErrorMessage==null)
                {
                    alert("Request Revise Succesful!!");
                    if(oNofA.NOAID>0)
                    {
                        $('#tblNOAs').datagrid('updateRow', { index: SelectedRowIndex, row: oNofA });
                    }
                }
                else
                {
                    alert(oNofA.ErrorMessage);

                }
            },
            error: function (xhr, status, error)
            {
                alert(error);
            }
        });
    });
    $("#btnAcceptRevise").click(function(){
        debugger;
        var oNOA= $('#tblNOAs').datagrid('getSelected');
        if(oNOA==null || oNOA.NOAID<=0)
        {
            alert("Please select a item from list!");
            return;
        }

        var SelectedRowIndex=$('#tblNOAs').datagrid('getRowIndex',oNOA);
        var oNOAs= $('#tblNOAs').datagrid('getRows');
        sessionStorage.setItem("NOAs", JSON.stringify(oNOAs));
        sessionStorage.setItem("SelectedRowIndex", SelectedRowIndex);
        sessionStorage.setItem("NOAReviseHeader", "NOA");
        sessionStorage.setItem("BackLink",window.location.href);
        var tsv=((new Date()).getTime())/1000;
        window.location.href = _sBaseAddress+  "/NOA/ViewNOARevise?id="+oNOA.NOAID;
    });
    $("#btnReviseHistory").click(function(){
        var oNOA= $('#tblNOAs').datagrid('getSelected');
        if(oNOA==null || oNOA.NOAID<=0)
        {
            alert("Please select a item from list!");
            return;
        }
        var SelectedRowIndex=$('#tblNOAs').datagrid('getRowIndex',oNOA);
        var oPurchaseQuotations= $('#tblNOAs').datagrid('getRows');
        sessionStorage.setItem("NOA", JSON.stringify(oNOA));
        sessionStorage.setItem("SelectedRowIndex", SelectedRowIndex);
        sessionStorage.setItem("NOAReviseHistoryHeader", "ReviseHistory NOA");
        sessionStorage.setItem("BackLink",window.location.href);
        var tsv=((new Date()).getTime())/1000;
        window.location.href = _sBaseAddress+  "/NOA/ViewNOAReviseHistory?id="+oNOA.NOAID;
    });

    $("#btnCopyNOA").click(function () {
        
        var oNOA= $('#tblNOAs').datagrid('getSelected');
        if(oNOA==null || oNOA.NOAID<=0)
        {
            alert("Please select a item from list!");
            return;
        }

        if (!confirm("Confirm to Copy?")) return ;

        $.ajax({
            type: "POST",
            dataType: "json",
            url : _sBaseAddress+"/NOA/Copy",
            traditional: true,
            data:  JSON.stringify(oNOA),
            contentType: "application/json; charset=utf-8",
            success: function (data) {
                debugger;
                var oNOA= jQuery.parseJSON(data);
                if (oNOA.ErrorMessage=="" || oNOA.ErrorMessage==null)
                {

                    alert("Data Save Succesfully!!");
                    if(oNOA.NOAID>0)
                    {
                        var oNOAs = $('#tblNOAs').datagrid('getRows');
                        var nIndex=oNOAs.length;

                        $('#tblNOAs').datagrid('appendRow',oNOA);
                        $('#tblNOAs').datagrid('selectRow', nIndex);
                    }

                }
                else
                {
                    alert(oNOA.ErrorMessage);

                }
            },
            error: function (xhr, status, error)
            {
                alert(error);
            }
        });



    });


    $("#btnDepartmentPicker_Collection").click(function(e){
        debugger;
        DepartmentPicker("");
    });
    $("#txtDepartmentName").keydown(function(e)
    {
        var code = (e.keyCode ? e.keyCode : e.which);
        if (e.which == 13)//enter=13
        {
            DepartmentPicker($("#txtDepartmentName").val());
        }else if (code == 8) //backspace=8
        {
            //debugger;
            var txttProductName = document.getElementById("txtDepartmentName");
            txttProductName.style.color = "black";
            txttProductName.style.fontWeight = "normal";
            _nDepartmentIDs = "";
        }
    });

    function DepartmentPicker(DepartmentName)
    {
        debugger;
        var oTDepartment={id:1, text:DepartmentName};
        var obj = {
            BaseAddress: _sBaseAddress,
            Object: oTDepartment,
            ControllerName:"Department",
            ActionName: "getchildren",
            IsWinClose: false
        };

        $.icsDataGets(obj, function (response) {

            if (response.status && response.objs.length > 0) {
                if (response.objs[0].DepartmentID > 0) {
                    var tblColums = [];
                    var oColumn = { field: "Name", title: "Departmen tName", width: 230, align: "left" };tblColums.push(oColumn);
                    var bmultiplereturn=true;
                    var oPickerParam = {
                        winid: 'winDept',
                        winclass:'clsDept',
                        winwidth: 320,
                        winheight: 460,
                        tableid: 'tblDept',
                        tablecolumns: tblColums,
                        datalist: response.objs,
                        multiplereturn: bmultiplereturn,
                        searchingbyfieldName:'Name',
                        windowTittle: 'Department List'
                    };
                    $.icsPicker(oPickerParam);
                    IntializePickerbutton(oPickerParam);//multiplereturn, winclassName
                }
                else { alert(response.objs[0].ErrorMessage); }
            }
        });
    }
    $("#txtProductName").keydown(function (e) {
        debugger;
        var code = (e.keyCode ? e.keyCode : e.which);
        if (code == 13) // Enter Press
        {
            PickProduct();
        }
        if (code == 8) //backspace=8
        {
            var txtProductName = document.getElementById("txtProductName");
            txtProductName.style.color = "black";
            txtProductName.style.fontWeight = "normal";
            _sProductIDs="";
        }
    });

    function PickProduct()
    {
        if (!$.trim($("#txtProductName").val()).length) {
            alert("Please type Name or part of Name!");
            $('#txtProductName').val("");
            $('#txtProductName').focus();
            $('#txtProductName').addClass("errorFieldBorder");
            return false;
        } else {
            $('#txtProductName').removeClass("errorFieldBorder");
        }

        var oProduct={
            BUID: sessionStorage.getItem('BUID'),
            ProductName:$("#txtProductName").val()
        };
        var obj = {
            BaseAddress: _sBaseAddress,
            Object: oProduct,
            ControllerName: "NOA",
            ActionName: "GetProductsAdv",
            IsWinClose: false
        };
        $.icsDataGets(obj, function (response) {
            debugger;
            if (response.status && response.objs.length > 0)
            {
                if (response.objs[0].ProductID > 0) {

                    var tblColums = [];var oColumn ={};
                    oColumn= { field: "ProductCode", title: "Code", width: 100, align: "left" }; tblColums.push(oColumn);
                    oColumn = { field: "ProductName", title: "Item Name", width: 250, align: "left" }; tblColums.push(oColumn);
                    oColumn = { field: "GroupName", title: "Group Name", width: 250, align: "left" }; tblColums.push(oColumn);

                    var oPickerParam = {
                        winid: 'winProductPicker',
                        winclass: 'clsProductPicker',
                        winwidth: 600,
                        winheight: 460,
                        tableid: 'tblProductPicker',
                        tablecolumns: tblColums,
                        datalist: response.objs,
                        multiplereturn: true,
                        searchingbyfieldName: 'NameCode',
                        windowTittle: 'Product List'
                    };
                    $.icsPicker(oPickerParam);
                    IntializePickerbutton(oPickerParam);//multiple return
                }
                else {
                    alert("Data Not Found");
                    return;
                }
            }
            else
            {
                alert("Data Not Found");
                return;

            }
        });
    }


    $("#txtSupplierName").keydown(function (e) {
        debugger;
        var code = (e.keyCode ? e.keyCode : e.which);
        if (code == 13) // Enter Press
        {
            PickSupplier();
        }
        if (code == 8) //backspace=8
        {
            var txtSupplierName = document.getElementById("txtSupplierName");
            txtSupplierName.style.color = "black";
            txtSupplierName.style.fontWeight = "normal";
            _sSupplierIDs="";
        }
    });

    function PickSupplier()
    {
        if (!$.trim($("#txtSupplierName").val()).length) {
            alert("Please type Name or part of Name!");
            $('#txtSupplierName').val("");
            $('#txtSupplierName').focus();
            $('#txtSupplierName').addClass("errorFieldBorder");
            return false;
        } else {
            $('#txtSupplierName').removeClass("errorFieldBorder");
        }

        var oSupplier={
            Params: 1 + '~' + $.trim($('#txtSupplierName').val())+'~'+ sessionStorage.getItem('BUID')
        };
        var obj = {
            BaseAddress: _sBaseAddress,
            Object: oSupplier,
            ControllerName: "Contractor",
            ActionName: "ContractorSearchByNameType",
            IsWinClose: false
        };
        $.icsDataGets(obj, function (response) {
            debugger;
            if (response.status && response.objs.length > 0)
            {
                if (response.objs[0].ContractorID > 0) {

                    var tblColums = [];
                    var oColumn = { field: "Name", title: "Name", width: 200, align: "left" }; tblColums.push(oColumn);
                    oColumn = { field: "Address", title: "Address", width: 120, align: "left" }; tblColums.push(oColumn);
                    oColumn = { field: "Email", title: "Email", width: 90, align: "left" }; tblColums.push(oColumn);
                    oColumn = { field: "ShortName", title: "Short Name", width: 90, align: "left" }; tblColums.push(oColumn);

                    var oPickerParam = {
                        winid: 'winSuppliers',
                        winclass: 'clsSupplier',
                        winwidth: 600,
                        winheight: 460,
                        tableid: 'tblSuppliers',
                        tablecolumns: tblColums,
                        datalist: response.objs,
                        multiplereturn: true,
                        searchingbyfieldName: 'Name',
                        windowTittle: 'Supplier List'
                    };
                    $.icsPicker(oPickerParam);
                    IntializePickerbutton(oPickerParam);//multiple return
                }
                else {
                    alert("Data Not Found");
                    return;
                }
            }
            else
            {
                alert("Data Not Found");
                return;

            }
        });
    }

    $("#btnSearch").click(function () {

        $("#winNOAAdvanceSearch").icsWindow('open', "Advance Search");
        $("#winNOAAdvanceSearch input").not("input[type='button']").val("");
        //  $("#winNOAAdvanceSearch select").val(0);
        Reset();

    });

    //attach PQ
    function AttachPQ()
    {
        //debugger;
       
        var oNOA= $('#tblNOAs').datagrid('getSelected');
        if(oNOA==null || oNOA.NOAID<=0)
        {
            alert("Please select a item from list!");
            return;
        }
        if(parseInt(oNOA.ApproveBy)!=0)
        {
            alert("Please select Only Initialize Item form List!");
            return false;
        }
        var SelectedRowIndex=$('#tblNOAs').datagrid('getRowIndex',oNOA);
        var tsv=((new Date()).getTime())/1000;
        var oNOAs= $('#tblNOAs').datagrid('getRows');
        sessionStorage.setItem("NOAs", JSON.stringify(oNOAs));
        sessionStorage.setItem("SelectedRowIndex", SelectedRowIndex);
        sessionStorage.setItem("NOAHeader", "Attach PQ");
        sessionStorage.setItem("BackLink", window.location.href);
        window.location.href = _sBaseAddress+  "/NOA/ViewNOAEntry?id="+oNOA.NOAID+"&ts="+tsv;



    
    }
    function CloseNOAQuotation()
    {
        $('#winAttachPurchaseQuoation').icsWindow('close');
    }
    $("#txtPQNo").keydown(function (e) {
        debugger;
        var code = (e.keyCode ? e.keyCode : e.which);
        if (code == 13) // Enter Press
        {
            GetPQs($.trim($('#txtPQNo').val()));
        }
        if (code == 8) //backspace=8
        {
            $('#txtPQNo').removeClass("fontColorOfPickItem");
            _oPQs = [];
        }
    });
    $('#btnPickPQ').click(function(){
        GetPQs("");
    });
    function GetPQs(sPQNo)
    {
        debugger;
        if(sPQNo != "") {
            var oPurchaseQuotation={
                BUID:sessionStorage.getItem("BUID"),
                PurchaseQuotationNo:sPQNo
            };
        }
        else {
            var oPurchaseQuotation={
                BUID:sessionStorage.getItem("BUID"),
                PurchaseQuotationNo:sPQNo,
                ErrorMessage:_nNOAID
            };
        }

        var obj = {
            BaseAddress: _sBaseAddress,
            Object: oPurchaseQuotation,
            ControllerName: "PurchaseQuotation",
            ActionName: "GetNonExpiredPQs",
            IsWinClose: false
        };
        $.icsDataGets(obj, function (response) {
            debugger;
            if (response.status && response.objs.length > 0)
            {
                if (response.objs[0].PurchaseQuotationID > 0) {

                    var tblColums = [];var oColumn ={};
                    oColumn= { field: "PurchaseQuotationNo", title: "Code", width: 100, align: "left" }; tblColums.push(oColumn);
                    oColumn = { field: "SupplierName", title: "Item Name", width: 250, align: "left" }; tblColums.push(oColumn);
                    oColumn = { field: "RateCollectDateInString", title: "Collect Date", width: 125, align: "left" }; tblColums.push(oColumn);
                    oColumn = { field: "ExpiredDateInString", title: "Expired Date", width: 125, align: "left" }; tblColums.push(oColumn);

                    var oPickerParam = {
                        winid: 'winPurchaseQuotationPicker',
                        winclass: 'clsPurchaseQuotationPicker',
                        winwidth: 600,
                        winheight: 460,
                        tableid: 'tblPurchaseQuotationPicker',
                        tablecolumns: tblColums,
                        datalist: response.objs,
                        multiplereturn: true,
                        searchingbyfieldName: 'PurchaseQuotationNo',
                        windowTittle: 'Purchase Quotation List'
                    };
                    $.icsPicker(oPickerParam);
                    IntializePickerbutton(oPickerParam);
                }
                else {
                    alert("Data Not Found");
                    return;
                }
            }
            else
            {
                alert("Data Not Found");
                return;

            }
        });
    }
    $("#btnAddNOAQuotation").click(function(){
        debugger;
        var oNOA= $('#tblNOAs').datagrid('getSelected');
        if(_oPQs==null || _oPQs.length<=0)
        {
            alert("Please Select PQ.");
            return;
        }
        var oPriviousNOAQs = $('#tblNOAQuotation').datagrid('getRows');
        var oNOAQuotations = [];
        for(var i = 0;i<_oPQs.length;i++)
        {
            if(!ICS_IsExist(oPriviousNOAQs,'PQID', _oPQs[i].PurchaseQuotationID))
            {
                var oNOAQuotation= {
                    NOAQuotationID:0,
                    NOAID:oNOA.NOAID,
                    PQID : _oPQs[i].PurchaseQuotationID
                };
                oNOAQuotations.push(oNOAQuotation);
            }
        }
        if(oNOAQuotations.length<=0)
        {
            alert("Sorry, there is no Purchase Quotation. Select Purchase Quotation.");
            return;
        }

        var oNOAQuotation = {NOAQuotations:oNOAQuotations};

        $.ajax({
            type: "POST",
            dataType: "json",
            url : _sBaseAddress+  "/NOA/SaveNOAQuotation",
            traditional: true,
            data:  JSON.stringify(oNOAQuotation),
            contentType: "application/json; charset=utf-8",
            success: function (data) {
                var _oNOAQuotations = jQuery.parseJSON(data);
                if (_oNOAQuotations.length>0 && (_oNOAQuotations[0].ErrorMessage=="" || _oNOAQuotations[0].ErrorMessage==null))
                {
                    alert("Data Saved Succefully.");
                    DynamicRefreshList(_oNOAQuotations, 'tblNOAQuotation');
                    $('#txtPQNo').removeClass("fontColorOfPickItem");
                    $('#txtPQNo').val('');
                    _oPQs = [];
                }
                else {
                    alert(_oNOAQuotations[0].ErrorMessage);
                }
            },
            error: function (xhr, status, error) {
                alert(error);
            }
        });


    });
    $("#btnRemoveNOAQuotation").click(function()
    {
        var oNOAQuotation= $('#tblNOAQuotation').datagrid('getSelected');
        if(oNOAQuotation==null || oNOAQuotation.NOAQuotationID<=0)
        {
            alert("Invalid Field!!! please select a valid Field!");
            return false;
        }
        if (!confirm("Confirm to Delete?")) return ;
        var SelectedRowIndex=$('#tblNOAQuotation').datagrid('getRowIndex',oNOAQuotation);
        if (oNOAQuotation.NOAQuotationID > 0)
        {
            debugger
            $.ajax
            ({
                type: "GET",
                dataType: "json",
                url : _sBaseAddress+  "/NOA/RemoveNOAQuotation",
                data: { id: oNOAQuotation.NOAQuotationID},
                contentType: "application/json; charset=utf-8",
                success: function (data) {
                    var feedbackmessage = jQuery.parseJSON(data);
                    if (feedbackmessage == "Succefully Deleted")
                    {
                        alert("Delete sucessfully");
                        $('#tblNOAQuotation').datagrid('deleteRow',SelectedRowIndex);
                        $('#txtPQNo').focus();
                    }
                    else
                    {
                        alert(feedbackmessage);
                    }
                },
                error: function (xhr, status, error)
                {
                    alert(error);
                }
            });
        }
    });
    //end attach PQ


    //attach PR
    function AttachPR()
    {
        debugger;
        var oNOA= $('#tblNOAs').datagrid('getSelected');
        if(oNOA==null || oNOA.NOAID<=0)
        {
            alert("Please select a item from list!");
            return;
        }
        var SelectedRowIndex=$('#tblNOAs').datagrid('getRowIndex',oNOA);
        $.ajax
        ({
            type: "POST",
            dataType: "json",
            url : _sBaseAddress+ "/NOA/GetNOARequisitions",
            traditional: true,
            data: JSON.stringify(oNOA),
            contentType: "application/json; charset=utf-8",
            success: function (data) {
                debugger;
                oNOARequisitions = jQuery.parseJSON(data);
                if (oNOARequisitions.length>0 )
                {
                    if(oNOARequisitions[0].ErrorMessage==null || oNOARequisitions[0].ErrorMessage=="")
                    {
                        DynamicRefreshList(oNOARequisitions, 'tblNOARequisition');
                    }
                    else
                    {
                        alert(oNOARequisition[0].ErrorMessage);
                    }
                }
                $("#winAttachPurchaseRequisition").icsWindow('open', "Purchase Requisition for NOA No : "+oNOA.NOANo);
            },
            error: function (xhr, status, error)
            {
                alert(error);
            }

        });
    }
    function CloseNOARequisition()
    {
        $('#winAttachPurchaseQuoation').icsWindow('close');
    }
    $("#txtPRNo").keydown(function (e) {
        debugger;
        var code = (e.keyCode ? e.keyCode : e.which);
        if (code == 13) // Enter Press
        {
            GetPRs($.trim($('#txtPRNo').val()));
        }
        if (code == 8) //backspace=8
        {
            $('#txtPRNo').removeClass("fontColorOfPickItem");
            _oPRs = [];
        }
    });
    $('#btnPickPR').click(function(){
        GetPRs("");
    });
    function GetPRs(sPRNo)
    {
        var oPurchaseRequisition={
            BUID:sessionStorage.getItem("BUID"),
            PurchaseRequisitionNo:sPRNo
        };
        var obj = {
            BaseAddress: _sBaseAddress,
            Object: oPurchaseRequisition,
            ControllerName: "PurchaseRequisition",
            ActionName: "GetYetToAttachPRs",
            IsWinClose: false
        };
        $.icsDataGets(obj, function (response) {
            debugger;
            if (response.status && response.objs.length > 0)
            {
                if (response.objs[0].PRID > 0) {

                    var tblColums = [];var oColumn ={};
                    oColumn= { field: "PRNo", title: "Code", width: 100, align: "left" }; tblColums.push(oColumn);
                    oColumn = { field: "PrepareByName", title: "Item Name", width: 250, align: "left" }; tblColums.push(oColumn);

                    var oPickerParam = {
                        winid: 'winPurchaseRequisitionPicker',
                        winclass: 'clsPurchaseRequisitionPicker',
                        winwidth: 600,
                        winheight: 460,
                        tableid: 'tblPurchaseRequisitionPicker',
                        tablecolumns: tblColums,
                        datalist: response.objs,
                        multiplereturn: true,
                        searchingbyfieldName: 'PurchaseRequisitionNo',
                        windowTittle: 'Purchase Requisition List'
                    };
                    $.icsPicker(oPickerParam);
                    IntializePickerbutton(oPickerParam);
                }
                else {
                    alert("Data Not Found");
                    return;
                }
            }
            else
            {
                alert("Data Not Found");
                return;

            }
        });
    }
    $("#btnAddNOARequisition").click(function(){
        debugger;
        var oNOA= $('#tblNOAs').datagrid('getSelected');
        if(_oPRs==null || _oPRs.length<=0)
        {
            alert("Please Select PR.");
            return;
        }
        var oPriviousNOARs = $('#tblNOARequisition').datagrid('getRows');
        var oNOARequisitions = [];
        for(var i = 0;i<_oPRs.length;i++)
        {
            if(!ICS_IsExist(oPriviousNOARs,'PRID', _oPRs[i].PRID))
            {
                var oNOARequisition= {
                    NOARequisitionID:0,
                    NOAID:oNOA.NOAID,
                    PRID : _oPRs[i].PRID
                };
                oNOARequisitions.push(oNOARequisition);
            }
        }
        var oNOARequisition = {NOARequisitions:oNOARequisitions};

        $.ajax({
            type: "POST",
            dataType: "json",
            url : _sBaseAddress+  "/NOA/SaveNOARequisition",
            traditional: true,
            data:  JSON.stringify(oNOARequisition),
            contentType: "application/json; charset=utf-8",
            success: function (data) {
                var _oNOARequisitions = jQuery.parseJSON(data);
                if (_oNOARequisitions.length>0 && (_oNOARequisitions[0].ErrorMessage=="" || _oNOARequisitions[0].ErrorMessage==null))
                {
                    alert("Data Saved Succefully.");
                    DynamicRefreshList(_oNOARequisitions, 'tblNOARequisition');
                    $('#txtPRNo').removeClass("fontColorOfPickItem");
                    $('#txtPRNo').val('');
                    _oPRs = [];
                }
                else {
                    alert(_oNOARequisitions[0].ErrorMessage);
                }
            },
            error: function (xhr, status, error) {
                alert(error);
            }
        });


    });
    $("#btnRemoveNOARequisition").click(function()
    {
        var oNOARequisition= $('#tblNOARequisition').datagrid('getSelected');
        if(oNOARequisition==null || oNOARequisition.NOARequisitionID<=0)
        {
            alert("Invalid Field!!! please select a valid Field!");
            return false;
        }
        if (!confirm("Confirm to Delete?")) return ;
        var SelectedRowIndex=$('#tblNOARequisition').datagrid('getRowIndex',oNOARequisition);
        if (oNOARequisition.NOARequisitionID > 0)
        {
            debugger
            $.ajax
            ({
                type: "GET",
                dataType: "json",
                url : _sBaseAddress+  "/NOA/RemoveNOARequisition",
                data: { id: oNOARequisition.NOARequisitionID},
                contentType: "application/json; charset=utf-8",
                success: function (data) {
                    var feedbackmessage = jQuery.parseJSON(data);
                    if (feedbackmessage == "Succefully Deleted")
                    {
                        alert("Delete sucessfully");
                        $('#tblNOARequisition').datagrid('deleteRow',SelectedRowIndex);
                        $('#txtPRNo').focus();
                    }
                    else
                    {
                        alert(feedbackmessage);
                    }
                },
                error: function (xhr, status, error)
                {
                    alert(error);
                }
            });
        }
    });
    //end attach PR

    //Refresh
    $('#btnRefresh').click(function () {
        debugger;
        /* NOA Receive Date*/
        var cboNOADate = document.getElementById("cboNOADate");
        var nNOADate = cboNOADate.options[cboNOADate.selectedIndex].index;
        var dNOARcvStartDate = $('#txtNOAStartDate').datebox('getValue');
        var dNOARcvEndDate = $('#txtNOAEndDate').datebox('getValue');

        var cboApproveDate = document.getElementById("cboApproveDate");
        var nApproveDate = cboApproveDate.options[cboApproveDate.selectedIndex].index;
        var dApproveStartDate = $('#txtApproveStartDate').datebox('getValue');
        var dApproveEndDate = $('#txtApproveEndDate').datebox('getValue');

        var sNOANo = $("#txtSearchNOANo").val();
        var sMPRNo = $("#txtMPRNo").val();
        var sQuotationNo = $("#txtQuotationNo").val();
        var chkResult = CheckEmpty();
        if (chkResult!= true) {
            alert("Please Select at lease one Criteria !!");
            return;
        }
        var tsv=((new Date()).getTime())/1000;
        var oNOA = {
            Note:nNOADate + '~' + dNOARcvStartDate + '~' + dNOARcvEndDate +'~'+nApproveDate+'~'+dApproveStartDate+'~'+dApproveEndDate+'~' + sNOANo+'~'+sessionStorage.getItem("BUID") + '~' + _nDepartmentIDs+"~"+_sProductIDs+"~"+sMPRNo+"~"+sQuotationNo+"~"+_sSupplierIDs
        };

        $.ajax
              ({
                  type: "POST",
                  dataType: "json",
                  url : _sBaseAddress+"/NOA/NOASearch",
                  traditional: true,
                  data: JSON.stringify(oNOA),
                  contentType: "application/json; charset=utf-8",
                  success: function (data) {
                      debugger;
                      _oNOAs  = jQuery.parseJSON(data);
                      if (_oNOAs.length >0)
                      {
                          DynamicRefreshList(_oNOAs,'tblNOAList');
                      }
                      else {
                          alert("Data not found!!");
                          DynamicRefreshList([],'tblNOAList');
                      }
                  },
                  error: function (xhr, status, error)
                  {
                      alert(error);
                  }

              });

    });
    $('#btnReset').click(function () {
        debugger;
        Reset();
    });
    $('#btnPrintExcel').click(function () {
        debugger;
        var cboNOADate = document.getElementById("cboNOADate");
        var nNOADate = cboNOADate.options[cboNOADate.selectedIndex].index;
        var dNOARcvStartDate = $('#txtNOAStartDate').datebox('getValue');
        var dNOARcvEndDate = $('#txtNOAEndDate').datebox('getValue');

        var cboApproveDate = document.getElementById("cboApproveDate");
        var nApproveDate = cboApproveDate.options[cboApproveDate.selectedIndex].index;
        var dApproveStartDate = $('#txtApproveStartDate').datebox('getValue');
        var dApproveEndDate = $('#txtApproveEndDate').datebox('getValue');

        var sNOANo = $("#txtSearchNOANo").val();
        var chkResult = CheckEmpty();
        if (chkResult!= true) {
            alert("Please Select at lease one Criteria !!");
            return;
        }
        var tsv=((new Date()).getTime())/1000;
       
        var searchStr =nNOADate + '~' + dNOARcvStartDate + '~' + dNOARcvEndDate +'~'+nApproveDate+'~'+dApproveStartDate+'~'+dApproveEndDate+'~' + sNOANo+'~'+sessionStorage.getItem("BUID") + '~' + _nDepartmentIDs+"~"+_sProductIDs;

        window.open(_sBaseAddress + '/NOA/PrintListInExcel?searchStr='+searchStr, "_blank");

    });
    function Reset()
    {
        DynamicRefreshList([],'tblNOAList');
        document.getElementById("txtSearchNOANo").value = '';
        document.getElementById("enddate").style.display = '';
        document.getElementById("enddateT").style.display = '';
        document.getElementById("enddateA").style.display = '';
        document.getElementById("enddateTA").style.display = '';
        $('#cboNOADate,#cboApproveDate').val('None');
        SetTodayDate();
        _nPRIDs = "";
        _nDepartmentIDs="";
        _sProductIDs="";
    }
    $('#btnOkButtonClick').click(function () {
        var oNOAs = [];
        var oNOAs = $('#tblNOAList').datagrid('getChecked');
        if (oNOAs.length <= 0) {
            alert("please select at least one item");
            return;
        }
        DynamicRefreshList(oNOAs,'tblNOAs');
        $("#winNOAAdvanceSearch").icsWindow('close');
    });

    //Close Picker
    $('#btnSearchClose').click(function () {
        $("#winNOAAdvanceSearch").icsWindow('close');
    });

    $('._select_changeA').change(function () {
        //  debugger;
        var x = $("#cboNOADate").val();
        if (x == "EqualTo" || x == "NotEqualTo" || x == "GreaterThen" || x == "SmallerThen") {
            document.getElementById("enddate").style.display = 'none';
            document.getElementById("enddateT").style.display = 'none';
        }
        else {
            document.getElementById("enddate").style.display = '';
            document.getElementById("enddateT").style.display = '';
        }
    });
    $('._select_changeB').change(function () {
        //  debugger;
        var x = $("#cboApproveDate").val();
        if (x == "EqualTo" || x == "NotEqualTo" || x == "GreaterThen" || x == "SmallerThen") {
            document.getElementById("enddateA").style.display = 'none';
            document.getElementById("enddateTA").style.display = 'none';
        }
        else {
            document.getElementById("enddateA").style.display = '';
            document.getElementById("enddateTA").style.display = '';
        }
    });

    function SetTodayDate() 
    {
        $('#txtNOAStartDate,#txtNOAEndDate,#txtApproveStartDate,#txtApproveEndDate').datebox('setValue', icsdateformat(new Date()));
    }
    function CheckEmpty() {

        var cboNOADate = document.getElementById("cboNOADate");
        var nNOADate = cboNOADate.options[cboNOADate.selectedIndex].index;
        var dept = document.getElementById("cboApproveDate");
        var cboApproveDate = document.getElementById("cboApproveDate");
        var nApproveDate = cboApproveDate.options[cboApproveDate.selectedIndex].index;
        var sNOANo = $("#txtSearchNOANo").val();

        var sMPRNo = $("#txtMPRNo").val();
        var sQuotationNo = $("#txtQuotationNo").val();
        if (nNOADate == 0 && nApproveDate==0 && sNOANo=="" && _nPRIDs == "" && _nDepartmentIDs == "" && _sProductIDs=="" && sMPRNo=="" && sQuotationNo=="" && _sSupplierIDs=="" )
        {
            return false;
        }
        return true;
    }

    function IntializePickerbutton(oPickerobj) {
        debugger;
        $("#" + oPickerobj.winid).find("#btnOk").click(function () {
            debugger;
            //for Single Select
            PickerEvents(oPickerobj);
        });
        $(document).find('.' + oPickerobj.winclass).keydown(function (e) {
            if (e.which == 13)//enter=13
            {
                PickerEvents(oPickerobj);
            }
        });
    }
    function PickerEvents(oPickerobj) {
        var oreturnobj = null, oreturnobjs = [];
        if (oPickerobj.multiplereturn)
        {
            oreturnobjs = $('#' + oPickerobj.tableid).datagrid('getChecked');
        } else
        {
            oreturnobj = $('#' + oPickerobj.tableid).datagrid('getSelected');
        }

        $("#" + oPickerobj.winid).icsWindow("close");
        $("#" + oPickerobj.winid).remove();
        if(oPickerobj.winclass =="clsPurchaseQuotationPicker")
        {
            if(oreturnobjs.length>0)
            {
                debugger;
                _oPQs = oreturnobjs;
                if(_oPQs.length>1)
                {
                    $('#txtPQNo').val(_oPQs.length+" Item's Selected");
                }else{
                    $('#txtPQNo').val(_oPQs[0].PurchaseQuotationNo);
                }
                $('#txtPQNo').addClass("fontColorOfPickItem");
            }
        }else if(oPickerobj.winclass =="clsPurchaseRequisitionPicker")//
        {
            if(oreturnobjs.length>0)
            {
                debugger;
                _oPRs = oreturnobjs;
                if(_oPRs.length>1)
                {
                    $('#txtPRNo').val(_oPRs.length+" Item's Selected");
                }else{
                    $('#txtPRNo').val(_oPRs[0].PRNo);
                }
                $('#txtPRNo').addClass("fontColorOfPickItem");
            }
        }
        else if (oPickerobj.winid == 'winDept')
        {
            debugger;
            if(oreturnobjs!=null)
            {
                _nDepartmentIDs="";
                var ncount = 0;
                for (var i = 0; i <oreturnobjs.length; i++) {
                    var nDepartmentID = oreturnobjs[i].DepartmentID;
                    _nDepartmentIDs = _nDepartmentIDs + nDepartmentID  + ',';
                    ncount++;
                }
                if (ncount > 1)
                {
                    $('#txtDepartmentName').val("Select " + ncount + " Department's");
                } else
                {
                    $('#txtDepartmentName').val(oreturnobjs[0].Name);
                }
                _nDepartmentIDs = _nDepartmentIDs.substring(0, _nDepartmentIDs.length - 1);
                var txtProductReq = document.getElementById("txtDepartmentName");
                txtProductReq.style.color = "blue";
                txtProductReq.style.fontWeight = "bold";
            }
        }
        else if (oPickerobj.winid == 'winProductPicker')
        {
            debugger;
            if(oreturnobjs!=null)
            {
                _sProductIDs="";
                var ncount = 0;
                for (var i = 0; i <oreturnobjs.length; i++) {
                    _sProductIDs = _sProductIDs + oreturnobjs[i].ProductID  + ',';
                    ncount++;
                }
                if (ncount > 1)
                {
                    $('#txtProductName').val("Select " + ncount + " Department's");
                } else
                {
                    $('#txtProductName').val(oreturnobjs[0].Name);
                }
                _sProductIDs = _sProductIDs.substring(0, _sProductIDs.length - 1);
                var txtProductReq = document.getElementById("txtProductName");
                txtProductReq.style.color = "blue";
                txtProductReq.style.fontWeight = "bold";
            }
        }
        else if (oPickerobj.winid == 'winSuppliers')
        {
            debugger;
            if(oreturnobjs!=null)
            {
                _sSupplierIDs="";
                var ncount = 0;
                for (var i = 0; i <oreturnobjs.length; i++) {
                    _sSupplierIDs = _sSupplierIDs + oreturnobjs[i].ContractorID  + ',';
                    ncount++;
                }
                if (ncount > 1)
                {
                    $('#txtSupplierName').val("Select " + ncount + " Supplier's");
                } else
                {
                    $('#txtSupplierName').val(oreturnobjs[0].Name);
                }
                _sSupplierIDs = _sSupplierIDs.substring(0, _sSupplierIDs.length - 1);
                var txtSupplierReq = document.getElementById("txtSupplierName");
                txtSupplierReq.style.color = "blue";
                txtSupplierReq.style.fontWeight = "bold";
            }
        }
    }

    $(document).keydown(function (e) {
        //debugger;
        if (e.which == 27)//escape=27
        {
            //debugger;
            $("#winNOAAdvanceSearch").icsWindow('close');
        }
    });

    //NOA wise Start
    $('#txtNOANo').keydown(function (e)
    {
        var code = (e.keyCode ? e.keyCode : e.which);
        if (code== 13)
        {
            var txtNOANo = $('#txtNOANo').val();
            if(txtNOANo!="")
            {
                //debugger;
                var tsv=((new Date()).getTime())/1000;
                $.ajax
             ({
                 type: "GET",
                 dataType: "json",
                 url : _sBaseAddress+"/NOA/SearchByNOANo",
                 data: {sTempData:txtNOANo, ts:tsv},
                 contentType: "application/json; charset=utf-8",
                 success: function (data) {
                     //debugger;
                     var _oNOAs = jQuery.parseJSON(data);
                     if (_oNOAs.length>0)
                     {
                         RefreshList(_oNOAs);
                     }
                     else
                     {
                         alert("Data Not found");
                         RefreshList([]);
                     }
                 },
                 error: function (xhr, status, error)
                 {
                     alert(error);
                 }
             });   

          }
        }else  if (code == 8) //backspace=8
        {
            var txtNOANo=document.getElementById("txtNOANo");
            //txtNOANo.value='';
            txtNOANo.style.color="Normal";
            txtNOANo.style.fontWeight="Black";
        }

    }); 
    //style Wise End


    function Add()
    {
        debugger;
        var tsv=((new Date()).getTime())/1000;
        var oNOAs= $('#tblNOAs').datagrid('getRows');
        sessionStorage.setItem("NOAs", JSON.stringify(oNOAs));
        sessionStorage.setItem("SelectedRowIndex", -1);
        sessionStorage.setItem("NOAHeader", "Add @ViewBag.NOAOperationType.Value");
        sessionStorage.setItem("BackLink", window.location.href);
        window.location.href = _sBaseAddress+ "/NOA/ViewNOAEntry?id=0&ts="+tsv;
     
    }

    function Edit()
    {
        // debugger;
        var oNOA= $('#tblNOAs').datagrid('getSelected');
        if(oNOA==null || oNOA.NOAID<=0)
        {
            alert("Please select a item from list!");
            return;
        }
        if(parseInt(oNOA.ApproveBy)!=0)
        {
            alert("Please select Only Initialize Item form List!");
            return false;
        }
        var SelectedRowIndex=$('#tblNOAs').datagrid('getRowIndex',oNOA);
        var tsv=((new Date()).getTime())/1000;
        var oNOAs= $('#tblNOAs').datagrid('getRows');
        sessionStorage.setItem("NOAs", JSON.stringify(oNOAs));
        sessionStorage.setItem("SelectedRowIndex", SelectedRowIndex);
        sessionStorage.setItem("NOAHeader", "Edit NOA");
        sessionStorage.setItem("BackLink", window.location.href);
        window.location.href = _sBaseAddress+  "/NOA/ViewNOAEntry?id="+oNOA.NOAID+"&ts="+tsv;

    }

    function Details()
    {
        //debugger;
        var oNOA= $('#tblNOAs').datagrid('getSelected');
        if(oNOA==null || oNOA.NOAID<=0)
        {
            alert("Please select a item from list!");
            return;
        }
        var SelectedRowIndex=$('#tblNOAs').datagrid('getRowIndex',oNOA);
        var tsv=((new Date()).getTime())/1000;
        var oNOAs= $('#tblNOAs').datagrid('getRows');
        sessionStorage.setItem("NOAs", JSON.stringify(oNOAs));
        sessionStorage.setItem("SelectedRowIndex", SelectedRowIndex);
        sessionStorage.setItem("NOAHeader", "View NOA");
        sessionStorage.setItem("BackLink", window.location.href);
        window.location.href = _sBaseAddress+  "/NOA/ViewNOAEntry?id="+oNOA.NOAID+"&ts="+tsv;
    }

    function Delete()
    {
        //debugger;
        var oNOA= $('#tblNOAs').datagrid('getSelected');
        if(oNOA==null || oNOA.NOAID<=0)
        {
            alert("Invalid Field!!! please select a valid Field!");
            return false;
        }
        if(parseInt(oNOA.ApproveBy)!=0)
        {
            alert("Please select Only Initialize Item form List!");
            return false;
        }
        var SelectedRowIndex=$('#tblNOAs').datagrid('getRowIndex',oNOA);
        if (!confirm("Confirm to Delete?")) return ;
        if (parseInt(oNOA.NOAID)> 0)
        {
            $.ajax
            ({
                type: "GET",
                dataType: "json",
                url : _sBaseAddress+ "/NOA/Delete",
                data: { id:oNOA.NOAID},
                contentType: "application/json; charset=utf-8",
                success: function (data) {
                    //debugger;
                    feedbackmessage = jQuery.parseJSON(data);
                    if (feedbackmessage=="Data Delete Successfully")
                    {
                        alert("Delete sucessfully");
                        $('#tblNOAs').datagrid('deleteRow',SelectedRowIndex);
                    }
                    else
                    {
                        alert(feedbackmessage);
                    }
                },
                error: function (xhr, status, error)
                {
                    alert(error);
                }

            });
        }
    }

    function Approve()
    {
        //debugger;
        var oNOA= $('#tblNOAs').datagrid('getSelected');
        if(oNOA==null || oNOA.NOAID<=0)
        {
            alert("Please select a item from list!");
            return;
        }
        var SelectedRowIndex=$('#tblNOAs').datagrid('getRowIndex',oNOA);
        var tsv=((new Date()).getTime())/1000;
        var oNOAs= $('#tblNOAs').datagrid('getRows');
        sessionStorage.setItem("NOAs", JSON.stringify(oNOAs));
        sessionStorage.setItem("SelectedRowIndex", SelectedRowIndex);
        sessionStorage.setItem("NOAHeader", "Approve NOA");
        sessionStorage.setItem("BackLink", window.location.href);
        window.location.href = _sBaseAddress+  "/NOA/ViewNOA_Approve?id="+oNOA.NOAID+"&ts="+tsv;
    }
    $("#btnRequestFor").click(function(){
        var oNOA= $('#tblNOAs').datagrid('getSelected');
        if(oNOA==null || oNOA.NOAID<=0)
        {
            alert("Please select a item from list!");
            return;
        }
        var SelectedRowIndex=$('#tblNOAs').datagrid('getRowIndex',oNOA);
        var tsv=((new Date()).getTime())/1000;
        var oNOAs= $('#tblNOAs').datagrid('getRows');
        sessionStorage.setItem("NOAs", JSON.stringify(oNOAs));
        sessionStorage.setItem("SelectedRowIndex", SelectedRowIndex);
        sessionStorage.setItem("NOAHeader", "Approve NOA");
        sessionStorage.setItem("BackLink", window.location.href);
        window.location.href = _sBaseAddress+  "/NOASignatory/ViewNOASignatorys?id="+oNOA.NOAID+"&ts="+tsv;
    });

    function UndoApprove()
    {
        var oNOA= $('#tblNOAs').datagrid('getSelected');
        if(oNOA==null || oNOA.NOAID<=0)
        {
            alert("Please select a item from list!");
            return;
        }
        if(parseInt(oNOA.ApproveBy)==0)
        {
            alert("Not Approved item Can't Undo");
            return;
        }
        var SelectedRowIndex=$('#tblNOAs').datagrid('getRowIndex',oNOA);
        if (!confirm("Confirm to Undo?")) return ;
        $.ajax({
            type: "POST",
            dataType: "json",
            url : _sBaseAddress+"/NOA/UndoApprove",
            traditional: true,
            data:  JSON.stringify(oNOA),
            contentType: "application/json; charset=utf-8",
            success: function (data) {
                //debugger;
                oNOA = jQuery.parseJSON(data);
                if (oNOA.ApproveBy==0 ||(oNOA.ErrorMessage==null || oNOA.ErrorMessage==""))
                {
                    alert("Successfully Undo.");
                    $('#tblNOAs').datagrid('updateRow',{index:SelectedRowIndex,row:oNOA});
                }
                else {
                    alert(oNOA.ErrorMessage);
                }
            },
            error: function (xhr, status, error) {
                alert(error);
            }

        });

    }

    function RefreshList(oNOAs)
    {
        data=oNOAs;
        data={"total":""+data.length+"","rows":data};
        $('#tblNOAs').datagrid('loadData',data);
        var nIndex= parseInt(sessionStorage.getItem("SelectedRowIndex"));
        if(nIndex!=null)
        {
            $('#tblNOAs').datagrid('selectRow',nIndex);
        }

    }
    
    function PrintPreview()
    {
        var oNOA= $('#tblNOAs').datagrid('getSelected');
        if(oNOA==null || oNOA.NOAID<=0)
        {
            alert("Please select a item from list!");
            return;
        }
        //window.open(_sBaseAddress + '/NOA/PrintNOA?id='+oNOA.NOAID);
        window.open(_sBaseAddress + '/NOA/PrintNOAWithFormat?id='+oNOA.NOAID+"&bWithTechHead="+true+"&bIsNormalFormat="+false);
    }
    function PrintPreviewNormal()
    {
        var oNOA= $('#tblNOAs').datagrid('getSelected');
        if(oNOA==null || oNOA.NOAID<=0)
        {
            alert("Please select a item from list!");
            return;
        }
        window.open(_sBaseAddress + '/NOA/PrintNOAWithFormat?id='+oNOA.NOAID+"&bWithTechHead="+true+"&bIsNormalFormat="+true);
    }
    function PrintPreviewWithoutTechHead()
    {
        var oNOA= $('#tblNOAs').datagrid('getSelected');
        if(oNOA==null || oNOA.NOAID<=0)
        {
            alert("Please select a item from list!");
            return;
        }
        //window.open(_sBaseAddress + '/NOA/PrintNOA?id='+oNOA.NOAID);
        window.open(_sBaseAddress + '/NOA/PrintNOAWithFormat?id='+oNOA.NOAID+"&bWithTechHead="+false+"&bIsNormalFormat="+false);
    }


    function PrintList()
    {
        var oNOAs= $('#tblNOAs').datagrid('getRows');
        var ids ="";
        if(oNOAs.length >0)
        {
            for(var i =0;i<oNOAs.length;i++)
            {
                ids =ids+oNOAs[i].NOAID+",";
            }
            ids= ids.substring(0, ids.length - 1);
        }
        else
        {
            alert("Data not found ");
            return;
        }
        window.open(_sBaseAddress + '/NOA/PrintNOAs?sParam='+ids);

    }

    function RefreshControlLayout()
    {
        debugger;
        $('#btnAdd,#btnEdit,#btnDelete,#btnView,#btnPrintPreview,#btnPrintList,#btnRequestFor').hide();
      
        if(HavePermission('AdvSearch','NOA')){document.getElementById('btnSearch').style.display = '';}
        if(HavePermission('Add','NOA')){document.getElementById('btnAdd').style.display = '';}
        if(HavePermission('Edit','NOA')){document.getElementById('btnEdit').style.display = '';} 
        if(HavePermission('Delete','NOA')){document.getElementById('btnDelete').style.display = '';}
        if(HavePermission('View','NOA')){document.getElementById('btnView').style.display = '';}
        //if(HavePermission('Approved','NOA')){document.getElementById('btnApproved').style.display = '';}
        if(HavePermission('Preview','NOA')){document.getElementById('btnPrintPreview').style.display = '';}
        if(HavePermission('PrintList','NOA')){document.getElementById('btnPrintList').style.display = '';}
        if(HavePermission('RequestFor_Approve','NOA')){document.getElementById('btnRequestFor').style.display = '';}
    }

    function HavePermission(sOperationType, sDbObject)
    {
        var nSessionID =@Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(HttpContext.Current.Session[SessionInfo.currentUserID]));
        if(nSessionID == -9)
        {
            return true;
        }
        else
        {
            for(var i =0;i<_oAuthorizationRolesMapping.length;i++)
            {
                if(_oAuthorizationRolesMapping[i].OperationTypeST == sOperationType && _oAuthorizationRolesMapping[i].ModuleNameST == sDbObject)
                    return  true;
            }
            return false;
        }
    }

  

</script>
