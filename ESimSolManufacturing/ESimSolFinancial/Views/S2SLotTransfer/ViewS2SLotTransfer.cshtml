<html>
@{
    ViewBag.title = "Style to Style Lot Transfer";
}
<body>
    @model ESimSol.BusinessObjects.S2SLotTransfer
    <div class="menuMainCollectionTable panel-group" ng-app="CS2SLotTransferapp" ng-controller="S2SLotTransferController" id="divCC" style="height:530px">
        <div class=" panel-primary" >
        <div style="height:490px;" class="panel-body regionS2SLotTransfer">
            <fieldset style=" height:100%; text-align:center;">
                <legend style="font-weight:bold;">Transfer Info : </legend>
                <div style="padding:15% 0 0 10%">
                    <div class="row col-md-12">
                        <div class="col-md-2 text-right"><label class="control-label">Store:</label></div>
                        <div class="col-md-4 text-left">
                            <div class="input-group">
                                <input ng-model="S2SLotTransfer.StoreName" id="txtStoreName" class="form-control" ng-keydown="SearchKeyDownStore($event)" placeholder="Type Store & Press Enter" required />
                                <span class="input-group-btn">
                                    <button type="button" class="btn btn-sm" aria-label="Left Align" ng-click="PickStore()"> <span class="glyphicon glyphicon-search" aria-hidden="true"></span></button>
                                </span>
                            </div>
                        </div>
                        <div class="col-md-2 text-right"><label class="control-label">Style:</label></div>
                        <div class="col-md-4 text-left">
                            <div class="input-group">
                                <input ng-model="S2SLotTransfer.IssueStyleNo" id="txtIssueStyleNo" class=" form-control" ng-keydown="SearchKeyIssueStyle($event)" placeholder="Type Style & Press Enter" required />
                                <span class="input-group-btn">
                                    <button type="button" class="btn btn-sm" aria-label="Left Align" ng-click="PickIssueStyle()"> <span class="glyphicon glyphicon-search" aria-hidden="true"></span></button>
                                </span>
                            </div>
                        </div>
                    </div>
                    <div class="row col-md-12">
                        <div class="col-md-2 text-right"><label class="control-label">Product:</label></div>
                        <div class="col-md-10 text-left">
                            <div class="input-group">
                                <input ng-model="S2SLotTransfer.ProductName" id="txtProductName" class="form-control" ng-keydown="SearchKeyProduct($event)" placeholder="Type Product & Press Enter" required />
                                <span class="input-group-btn">
                                    <button type="button" class="btn btn-sm" aria-label="Left Align" ng-click="PickProduct()"> <span class="glyphicon glyphicon-search" aria-hidden="true"></span></button>
                                </span>
                            </div>
                        </div>
                    </div>
                    <div class="row col-md-12">
                        <div class="col-md-2 text-right"><label class="control-label">Lot No:</label></div>
                        <div class="col-md-4 text-left">
                            <div class="input-group">
                                <input ng-model="S2SLotTransfer.IssueLotNo" id="txtIssueLotNo" class="form-control" ng-keydown="SearchKeyLot($event)" placeholder="Type Lot No & Press Enter" required />
                                <span class="input-group-btn">
                                    <button type="button" class="btn btn-sm" aria-label="Left Align" ng-click="PickLot()"> <span class="glyphicon glyphicon-search" aria-hidden="true"></span></button>
                                </span>
                            </div>
                        </div>
                        <div class="col-md-2 text-right"><label class="control-label">Balance :</label></div>
                        <div class="col-md-4 text-left">
                            <input ng-model="S2SLotTransfer.IssueLotBalanceSt" ng-disabled="true" class="form-control" />
                        </div>
                    </div>
                    <div class="row col-md-12">
                        <div class="col-md-2 text-right"><label class="control-label">New Style:</label></div>
                        <div class="col-md-4 text-left">
                            <div class="input-group">
                                <input ng-model="S2SLotTransfer.ReceiveStyleNo" id="txtReceiveStyleNo" class="form-control" ng-keydown="SearchKeyDownReceiveStyle($event)" placeholder="Type New Style & Press Enter" required />
                                <span class="input-group-btn">
                                    <button type="button" class="btn btn-sm" aria-label="Left Align" ng-click="PickReceiveStyle()"> <span class="glyphicon glyphicon-search" aria-hidden="true"></span></button>
                                </span>
                            </div>
                        </div>
                        <div class="col-md-2 text-right"><label class="control-label">Lot No:</label></div>
                        <div class="col-md-4 text-left">
                            <input ng-model="S2SLotTransfer.ReceiveLotNo" id="txtReceiveLotNo" class="form-control" />
                        </div>
                    </div>
                    <div class="row col-md-12">
                        <div class="col-md-2 text-right"><label class="control-label">Transfer Qty:</label></div>
                        <div class="col-md-4 text-left">
                            <input ng-model="S2SLotTransfer.TransferQty" id="txtTransferQty" class="form-control" />
                        </div>
                        <div class="col-md-2 text-right"><label class="control-label">Remarks:</label></div>
                        <div class="col-md-4 text-left">
                            <input ng-model="S2SLotTransfer.Remarks" class="form-control" />
                        </div>
                    </div>
                </div>
            </fieldset>
        </div>
        <fieldset>
            <legend style="font-weight:bold"> Action : </legend>
            <table border="0" cellspacing="2" cellpadding="2" style="font-size:11px; font-weight:bold; width:100%;">
                <tr>
                    <td style="width:100%;text-align:right">
                        <button type="button" id="btnCommit" class="btn btn-default btn-md btn-success" aria-label="right Align" ng-click="Commit()"><span class="glyphicon glyphicon-ok-circle" aria-hidden="true"> Commit</span></button>
                        <button type="button" id="btnSave" class="btn btn-default btn-md btn-success" aria-label="right Align" ng-click="Save()"><span class="glyphicon glyphicon-floppy-disk" aria-hidden="true"> Save</span></button>
                        <button type="button" id="btnClose" class="btn btn-default btn-md btn-danger" aria-label="right Align" ng-click="Close()"><span class="glyphicon glyphicon-remove" aria-hidden="true"> Close</span></button>
                    </td>
                </tr>
            </table>
        </fieldset>
    </div>         
   </div>
</body>
</html>
<style type="text/css">
    .regionS2SLotTransfer .form-horizontal .control-label {
        padding-top: 1px;
    }

    .regionS2SLotTransfer .form-control {
        height: 26px;
        padding: 2px 6px;
        font-size: 12px;
        width:100%;
    }
      .regionS2SLotTransfer .btn-sm {
        padding: 2px 10px;
    }
     
</style>

<script type="text/javascript">
    //debugger;
    var oS2SLotTransfer =@Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(Model));
    var _sBaseAddress =@Html.Raw( new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(HttpContext.Current.Session[SessionInfo.BaseAddress]));
    var CS2SLotTransferApp = angular.module('CS2SLotTransferapp', ['ngAnimate', 'ui.bootstrap','ui.grid','ui.grid.selection','ui.grid.edit', 'ui.grid.rowEdit','ui.grid.cellNav','ui.grid.resizeColumns','ms.service','uiKeyUpDown']);
    CS2SLotTransferApp.controller('S2SLotTransferController', function ($scope, $http, $uibModal,$interval,$timeout,  $log, uiGridConstants, msModal, userSession) {
        $scope.S2SLotTransfer = oS2SLotTransfer;  
        $scope.S2SLotTransfer.BUID = sessionStorage.getItem('BUID');
            $scope.Save=function()
            {
                debugger;
                if(!$scope.ValidateInput()) return;
                var oS2SLotTransfer=$scope.S2SLotTransfer;

                $http.post(_sBaseAddress+'/S2SLotTransfer/Save',oS2SLotTransfer).then(
                      function (response)
                      {
                          var oS2SLotTransfer= jQuery.parseJSON(response.data);
                          if (oS2SLotTransfer.ErrorMessage=="" || oS2SLotTransfer.ErrorMessage==null)
                          {
                                alert("Data Save Successfully!!");
                                var oS2SLotTransfers = sessionStorage.getItem("S2SLotTransfers");
                                var nIndex = parseInt(sessionStorage.getItem("SelectedRowIndex"));
                                if (oS2SLotTransfers != null)
                                {
                                    oS2SLotTransfers = jQuery.parseJSON(oS2SLotTransfers);
                                }
                                else {
                                    oS2SLotTransfers = [];
                                }
                                if (nIndex != -1) {
                                    oS2SLotTransfers[nIndex] = oS2SLotTransfer;
                                }
                                else 
                                {
                                    sessionStorage.setItem("SelectedRowIndex", oS2SLotTransfers.length);
                                    oS2SLotTransfers.push(oS2SLotTransfer);
                                }
                                sessionStorage.setItem("S2SLotTransfers", JSON.stringify(oS2SLotTransfers));
                                window.location.href = sessionStorage.getItem("BackLink");
                          }
                          else
                          {
                              alert(oS2SLotTransfer.ErrorMessage);
                          }

                      },
                          function (response) { alert(jQuery.parseJSON(response.data).Message);}
                  );
            }
            $scope.Commit=function()
            {
                debugger;
                if(!$scope.ValidateInput()) return;
                var oS2SLotTransfer=$scope.S2SLotTransfer;
                $http.post(_sBaseAddress+'/S2SLotTransfer/Commit',oS2SLotTransfer).then(
                      function (response)
                      {
                          var oS2SLotTransfer= jQuery.parseJSON(response.data);
                          if (oS2SLotTransfer.ErrorMessage=="" || oS2SLotTransfer.ErrorMessage==null)
                          {
                              alert("Data Save Successfully!!");
                              var oS2SLotTransfers = sessionStorage.getItem("S2SLotTransfers");
                              var nIndex = parseInt(sessionStorage.getItem("SelectedRowIndex"));
                              if (oS2SLotTransfers != null)
                              {
                                  oS2SLotTransfers = jQuery.parseJSON(oS2SLotTransfers);
                              }
                              else {
                                  oS2SLotTransfers = [];
                              }
                              if (nIndex != -1) {
                                  oS2SLotTransfers[nIndex] = oS2SLotTransfer;
                              }
                              else 
                              {
                                  sessionStorage.setItem("SelectedRowIndex", oS2SLotTransfers.length);
                                  oS2SLotTransfers.push(oS2SLotTransfer);
                              }
                              sessionStorage.setItem("S2SLotTransfers", JSON.stringify(oS2SLotTransfers));
                              window.location.href = sessionStorage.getItem("BackLink");
                          }
                          else
                          {
                              alert(oS2SLotTransfer.ErrorMessage);
                          }

                      },
                          function (response) { alert(jQuery.parseJSON(response.data).Message);}
                  );
            }
            
            $scope.ValidateInput = function()
            {
                debugger;
                if($scope.S2SLotTransfer.StoreID<=0)
                {
                    alert("Please Pick Store Name!");
                    $('#txtStoreName').focus();
                    return false;
                }
                if($scope.S2SLotTransfer.IssueStyleID<=0)
                {
                    alert("Please Select Style.");
                    $('#txtIssueStyleNo').focus();
                    return false;
                }
                if($scope.S2SLotTransfer.ProductID<=0)
                {
                    alert("Please Select Product.");
                    $('#txtProductName').focus();
                    return false;
                }
                if($scope.S2SLotTransfer.IssueLotID<=0)
                {
                    alert("Please Pick Lot.");
                    $('#txtIssueLotNo').focus();
                    return false;
                }
                if($scope.S2SLotTransfer.ReceiveStyleID<=0)
                {
                    alert("Please Pick Receive Style.");
                    $('#txtReceiveStyleNo').focus();
                    return false;
                }
                if($scope.S2SLotTransfer.ReceiveLotNo=="")
                {
                    alert("Please Type Receive Lot No.");
                    $('#txtReceiveLotNo').focus();
                    return false;
                }
                if($scope.S2SLotTransfer.TransferQty<=0)
                {
                    alert("Transfer Qty Should be Greater than 0.");
                    $('#txtTransferQty').focus();
                    return false;
                }
                if(parseFloat($scope.S2SLotTransfer.TransferQty)> parseFloat($scope.S2SLotTransfer.IssueLotBalance))
                {
                    alert("Transfer Qty Should be Les than Or Equal Issue Lot Qty.");
                    $('#txtTransferQty').focus();
                    return false;
                }
                return true;
            }
            if(_sBaseAddress==null)
            {
                _sBaseAddress = "";
            }
            // Search Store
            $scope.SearchKeyDownStore=function (e)
            {
                debugger;
                var code = (e.keyCode ? e.keyCode : e.which);
                if (code == 13)
                {
                    var StoreName = $.trim($scope.S2SLotTransfer.StoreName);
                    if(StoreName==""||StoreName==null)
                    {
                        alert("Type Store Name and Press Enter");
                        return;
                    }
                    $scope.PickStore();
                }else if (code == 8) //backspace=8
                {
                    //debugger;
                    $scope.S2SLotTransfer.StoreName='';
                    $scope.S2SLotTransfer.StoreID = 0;
                    $scope.S2SLotTransfer.ProductName='';
                    $scope.S2SLotTransfer.ProductID = 0;
                    $scope.S2SLotTransfer.IssueLotNo='';
                    $scope.S2SLotTransfer.IssueLotID = 0;
                    $scope.S2SLotTransfer.IssueLotBalance = 0;
                }
            };
            $scope.PickStore= function () {
                 debugger;
                var oWorkingUnit = {
                    BUID:sessionStorage.getItem('BUID'),
                    LocationName:$.trim($scope.S2SLotTransfer.StoreName),
                    //StoreName:
                };
                $.icsProgressBar(true);
                var config = { headers: { 'Content-Type': 'application/x-www-form-urlencoded;charset=utf-8;' } };
                $http.post(_sBaseAddress+'/WorkingUnit/GetsBUWiseWorkingUnit',$.param(oWorkingUnit), config).then(
                                    function (response)
                                    {
                                        $.icsProgressBar(false);
                                        debugger;
                                        var oColumns = [];
                                        var oColumn = { field: 'WorkingUnitCode', name: 'Code',width: '30%' };oColumns.push(oColumn);
                                        oColumn = { field: 'WorkingUnitName', name: 'Store Name',width: '65%', enableSorting: false  };oColumns.push(oColumn);
                                        var results=jQuery.parseJSON(response.data);
                                        var modalObj={
                                            size:'md',
                                            modalcontroller:'ModalCommonListCtrl',
                                            appcontroller:'S2SLotTransferController',
                                            objs:results,
                                            multiSelect:false,
                                            pickertitle:'Store List',
                                            searchingbyfieldName:'StoreName',
                                            columns:oColumns
                                        }
                                        var modalInstance=msModal.Instance(modalObj);
                                        modalInstance.result.then(function (result)
                                        {
                                            debugger;
                                            $scope.S2SLotTransfer.StoreName=result.WorkingUnitName;
                                            $scope.S2SLotTransfer.StoreID=result.WorkingUnitID;
                                        }, function () {
                                            $log.info('Modal dismissed at: ' + new Date());
                                        });
                                    },
                                      function (response) { alert(jQuery.parseJSON(response.data).Message);}
                                );
            };

           // Search issue Style
            $scope.SearchKeyIssueStyle=function (e)
            {
                debugger;
                var code = (e.keyCode ? e.keyCode : e.which);
                if (code == 13)
                {
                    var IssueStyleNo = $.trim($scope.S2SLotTransfer.IssueStyleNo);
                    if(IssueStyleNo==""||IssueStyleNo==null)
                    {
                        alert("Type Store Name and Press Enter");
                        return;
                    }
                    $scope.PickIssueStyle();
                }else if (code == 8) //backspace=8
                {
                    //debugger;
                    $scope.S2SLotTransfer.IssueStyleNo='';
                    $scope.S2SLotTransfer.IssueStyleID = 0;
                    $scope.S2SLotTransfer.ProductName='';
                    $scope.S2SLotTransfer.ProductID = 0;
                    $scope.S2SLotTransfer.IssueLotNo='';
                    $scope.S2SLotTransfer.IssueLotID = 0;
                    $scope.S2SLotTransfer.IssueLotBalance = 0;
                }
            };
            $scope.PickIssueStyle= function () {
                // debugger;
                if($scope.S2SLotTransfer.StoreID<=0)
                {
                    alert("Please Pick Store.");
                    return;
                }
                var oTechnicalSheet = {
                    BUID:sessionStorage.getItem('BUID'),
                    WorkingUnitID:$scope.S2SLotTransfer.StoreID,
                    StyleNo:$.trim($scope.S2SLotTransfer.IssueStyleNo)
                };
                $.icsProgressBar(true);
                var config = { headers: { 'Content-Type': 'application/x-www-form-urlencoded;charset=utf-8;' } };
                $http.post(_sBaseAddress+'/S2SLotTransfer/StyleSearch',$.param(oTechnicalSheet), config).then(
                                    function (response)
                                    {
                                        $.icsProgressBar(false);
                                        debugger;
                                        var oColumns = [];
                                        var oColumn = { field: 'StyleNo', name: 'Style No',width:'40%' };oColumns.push(oColumn);
                                        oColumn = { field: "BuyerName", name: "Buyer Name", width:'30%', align: "left" }; oColumns.push(oColumn);
                                        oColumn = { field: "SessionName", name: "Business Session",width:'20%', align: "left" }; oColumns.push(oColumn);
                                        var results=jQuery.parseJSON(response.data);
                                        var modalObj={
                                            size:'md',
                                            modalcontroller:'ModalCommonListCtrl',
                                            appcontroller:'S2SLotTransferController',
                                            objs:results,
                                            multiSelect:false,
                                            pickertitle:'Style List',
                                            searchingbyfieldName:'StyleNo',
                                            columns:oColumns
                                        }
                                        var modalInstance=msModal.Instance(modalObj);
                                        modalInstance.result.then(function (result)
                                        {
                                            debugger;
                                            $scope.S2SLotTransfer.IssueStyleNo=result.StyleNo;
                                            $scope.S2SLotTransfer.IssueStyleID=result.TechnicalSheetID;
                                        }, function () {
                                            $log.info('Modal dismissed at: ' + new Date());
                                        });
                                    },
                                      function (response) { alert(jQuery.parseJSON(response.data).Message);}
                                );
            };

            $scope.SearchKeyProduct=function (e)
            {
                debugger;
                var code = (e.keyCode ? e.keyCode : e.which);
                if (code == 13)
                {
                    var ProductName = $.trim($scope.S2SLotTransfer.ProductName);
                    if(ProductName==""||ProductName==null)
                    {
                        alert("Type Store Name and Press Enter");
                        return;
                    }
                    $scope.PickProduct();
                }else if (code == 8) //backspace=8
                {
                    //debugger;
                    $scope.S2SLotTransfer.ProductName='';
                    $scope.S2SLotTransfer.ProductID = 0;
                    $scope.S2SLotTransfer.IssueLotNo='';
                    $scope.S2SLotTransfer.IssueLotID = 0;
                    $scope.S2SLotTransfer.IssueLotBalance = 0;
                }
            };
            $scope.PickProduct= function () {
                // debugger;
                var oLot = {BUID:sessionStorage.getItem("BUID"), 
                    ProductName:$.trim($scope.S2SLotTransfer.ProductName),
                    WorkingUnitID:parseInt($.trim($scope.S2SLotTransfer.StoreID)),
                    ProductID:$scope.S2SLotTransfer.IssueStyleID //here temporary use  ProductId property for TechnicalSheetID or StyleID
                };
                $.icsProgressBar(true);
                var config = { headers: { 'Content-Type': 'application/x-www-form-urlencoded;charset=utf-8;' } };
                $http.post(_sBaseAddress+'/TransferRequisitionSlip/SearchProducts',$.param(oLot), config).then(
                                    function (response)
                                    {
                                        $.icsProgressBar(false);
                                        debugger;
                                        var oColumns = [];
                                        var oColumn = { field: "ProductCode", name: "Code", width: 80, align: "left" };oColumns.push(oColumn);
                                        oColumn = { field: "ProductName", name: "Name", width: 300, align: "left" };oColumns.push(oColumn);
                                        oColumn = { field: "MUnit", name: "Unit", width: 70, align: "left" };oColumns.push(oColumn);
                                        var results=response.data;
                                        var modalObj={
                                            size:'md',
                                            modalcontroller:'ModalCommonListCtrl',
                                            appcontroller:'S2SLotTransferController',
                                            objs:results,
                                            multiSelect:false,
                                            pickertitle:'Product List',
                                            searchingbyfieldName:'ProductName',
                                            columns:oColumns
                                        }
                                        var modalInstance=msModal.Instance(modalObj);
                                        modalInstance.result.then(function (result)
                                        {
                                            debugger;
                                            $scope.S2SLotTransfer.ProductCode=result.ProductCode;
                                            $scope.S2SLotTransfer.ProductName=result.ProductName;
                                            $scope.S2SLotTransfer.ProductID=result.ProductID;
                                        }, function () {
                                            $log.info('Modal dismissed at: ' + new Date());
                                        });
                                    },
                                      function (response) { alert(jQuery.parseJSON(response.data).Message);}
                                );
            };

            $scope.SearchKeyLot=function (e)
            {
                debugger;
                var code = (e.keyCode ? e.keyCode : e.which);
                if (code == 13)
                {
                    var IssueLotNo = $.trim($scope.S2SLotTransfer.IssueLotNo);
                    if(IssueLotNo==""||IssueLotNo==null)
                    {
                        alert("Type Lot No and Press Enter");
                        return;
                    }
                    $scope.PickLot();
                }else if (code == 8) //backspace=8
                {
                    //debugger;
                    $scope.S2SLotTransfer.IssueLotNo='';
                    $scope.S2SLotTransfer.IssueLotID = 0;
                    $scope.S2SLotTransfer.IssueLotBalance = 0;
                }
            };
            $scope.PickLot= function () {
                // debugger;
                var oLot = {
                    ProductID: parseInt($scope.S2SLotTransfer.ProductID),
                    LotNo : $scope.S2SLotTransfer.IssueLotNo,
                    WorkingUnitID: $scope.S2SLotTransfer.StoreID,
                    StyleID:parseInt($scope.S2SLotTransfer.IssueStyleID)
                };
                $.icsProgressBar(true);
                var config = { headers: { 'Content-Type': 'application/x-www-form-urlencoded;charset=utf-8;' } };
                $http.post(_sBaseAddress+'/Lot/GetsLot',$.param(oLot), config).then(
                                    function (response)
                                    {
                                        $.icsProgressBar(false);
                                        debugger;
                                        var oColumns = [];
                                        var  oColumn = { field: "LotNo", name: "Lot No", width:150, align:"left" };oColumns.push(oColumn);
                                        oColumn = { field: "ProductNameCode", name: "Product Name", width: 180, align:"left" };oColumns.push(oColumn);
                                        oColumn = { field: "ColorName", name: "Color", width: 70, align:"left"};oColumns.push(oColumn);
                                        oColumn = { field: "Balance", name: "Qty", width: 80, cellClass: 'text-right', formatter:formatPrice };oColumns.push(oColumn);
                                        oColumn = { field: "MUName", name: "Unit", width: 70, align:"left"};oColumns.push(oColumn);

                                        var results=jQuery.parseJSON(response.data);
                                        var modalObj={
                                            size:'md',
                                            modalcontroller:'ModalCommonListCtrl',
                                            appcontroller:'S2SLotTransferController',
                                            objs:results,
                                            multiSelect:false,
                                            pickertitle:'Lot List',
                                            searchingbyfieldName:'LotNo',
                                            columns:oColumns
                                        }
                                        var modalInstance=msModal.Instance(modalObj);
                                        modalInstance.result.then(function (result)
                                        {
                                            debugger;
                                            $scope.S2SLotTransfer.IssueLotNo=result.LotNo;
                                            $scope.S2SLotTransfer.IssueLotID=result.LotID;
                                            $scope.S2SLotTransfer.IssueLotBalance = result.Balance;
                                            $scope.S2SLotTransfer.IssueLotBalanceSt = result.BalanceQtySt;

                                        }, function () {
                                            $log.info('Modal dismissed at: ' + new Date());
                                        });
                                    },
                                      function (response) { alert(jQuery.parseJSON(response.data).Message);}
                                );
            };

            // Search Receive Style
            $scope.SearchKeyDownReceiveStyle=function (e)
            {
                debugger;
                var code = (e.keyCode ? e.keyCode : e.which);
                if (code == 13)
                {
                    var ReceiveStyleNo = $.trim($scope.S2SLotTransfer.ReceiveStyleNo);
                    if(ReceiveStyleNo==""||ReceiveStyleNo==null)
                    {
                        alert("Type Store Name and Press Enter");
                        return;
                    }
                    $scope.PickReceiveStyle();
                }else if (code == 8) //backspace=8
                {
                    //debugger;
                    $scope.S2SLotTransfer.ReceiveStyleNo='';
                    $scope.S2SLotTransfer.ReceiveStyleID = 0;
                }
            };
            $scope.PickReceiveStyle= function () 
            {
                // debugger;
                if($scope.S2SLotTransfer.StoreID<=0)
                {
                    alert("Please Pick Store.");
                    return;
                }
              
                if($scope.S2SLotTransfer.IssueStyleID<=0)
                {
                    alert("Please Pick Issue Style.");
                    return;
                }
               
                if($scope.S2SLotTransfer.ProductID<=0)
                {
                    alert("Please Pick Product.");
                    return;
                }
                
                var oTechnicalSheet = {
                    BUID:sessionStorage.getItem('BUID'),
                    StyleNo:$.trim($scope.S2SLotTransfer.ReceiveStyleNo),
                    ProductID:$scope.S2SLotTransfer.ProductID,
                    TechnicalSheetID:$scope.S2SLotTransfer.IssueStyleID
                };
                $.icsProgressBar(true);
                var config = { headers: { 'Content-Type': 'application/x-www-form-urlencoded;charset=utf-8;' } };
                $http.post(_sBaseAddress+'/S2SLotTransfer/StyleSearchProductWise',$.param(oTechnicalSheet), config).then(
                                    function (response)
                                    {
                                        debugger;
                                        $.icsProgressBar(false);
                                        var oColumns = [];
                                        var oColumn = { field: 'StyleNo', name: 'Style No',width: '30%' };oColumns.push(oColumn);
                                        oColumn = { field: "BuyerName", name: "Buyer Name", width: 200, align: "left" }; oColumns.push(oColumn);
                                        oColumn = { field: "SessionName", name: "Business Session", width: 100, align: "left" }; oColumns.push(oColumn);
                                        var results=jQuery.parseJSON(response.data);
                                        var modalObj={
                                            size:'md',
                                            modalcontroller:'ModalCommonListCtrl',
                                            appcontroller:'S2SLotTransferController',
                                            objs:results,
                                            multiSelect:false,
                                            pickertitle:'Receive Style List',
                                            searchingbyfieldName:'StyleNo',
                                            columns:oColumns
                                        }
                                        var modalInstance=msModal.Instance(modalObj);
                                        modalInstance.result.then(function (result)
                                        {
                                            debugger;
                                            $scope.S2SLotTransfer.ReceiveStyleNo=result.StyleNo;
                                            $scope.S2SLotTransfer.ReceiveStyleID=result.TechnicalSheetID;
                                        }, function () {
                                            $log.info('Modal dismissed at: ' + new Date());
                                        });
                                    },
                                      function (response) { alert(jQuery.parseJSON(response.data).Message);}
                                );
            };

            $('#btnCommit').hide();
            if(sessionStorage.getItem("S2SLotTransferHeader")=="View S2SLotTransfer" )
            {
                $("#divCC :input").prop('disabled', true);
                $('#btnClose').prop('disabled', false);
            }

            if(sessionStorage.getItem("S2SLotTransferHeader")=="Commit S2SLotTransfer" )
            {
                $("#divCC :input").prop('disabled', true);

                $('#btnClose').prop('disabled', false);
                $('#btnCommit').prop('disabled', false);
                $('#btnSave').hide();
                $('#btnCommit').show();
            }
            $scope.Close = function()
            {
                window.location.href = sessionStorage.getItem("BackLink");
            }
            $scope.keydown = function(e)
            {
                if(e.which == 27)//escape=27
                {
                    //debugger;
                    window.location.href = sessionStorage.getItem("BackLink");
                }
            }
        });

</script>