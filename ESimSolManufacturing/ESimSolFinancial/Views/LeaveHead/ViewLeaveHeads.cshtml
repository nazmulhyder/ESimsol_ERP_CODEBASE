@model IEnumerable<ESimSol.BusinessObjects.LeaveHead>
@{
    ViewBag.Title = "Leave Head";
}
<head>
    <title></title>
    <script src="@Url.Content("~/Views/LeaveHead/LeaveHead.js")" type="text/javascript"></script>
</head>
<body>
    <div id="progbarParent" style="width:100%;height:100%;margin:0 auto;text-align:center; margin-left: auto;margin-right: auto;left: 0;right: 0;z-index: 1;">
        <div style="margin: 0px auto;margin-top: 251px;text-align:center;width:390px;">
            <label style="font-size:18px;">Please wait</label>
            <div id="progbar" style="width:100%;height:37px;"></div>
        </div>
    </div>

    <div style="margin-left:0px; width:100%; height:100%">
        <table id="tblLeaveHeads" title="Leave Head List" class="easyui-datagrid" style="width:100%; height:100%" fitcolumns="false" rownumbers="true" pagination="false" singleselect="true" autorowheight="false" toolbar="#toolbar">
            <thead>
                <tr>
                    <th field="Code" width="75" align="left">Code</th>
                    <th field="Name" width="150" align="left">Name</th>
                    <th field="NameInBangla" width="150" align="left">Name In Bangla</th>
                    <th field="Description" width="150" align="left">Description</th>
                    <th field="TotalDay" width="80" align="left">TotalDay</th>
                    <th field="Activity" width="150" align="left">Activity</th>
                </tr>
            </thead>
        </table>
        <div id="toolbar">
            <a id="btnNewLeaveHead" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-add" plain="true" >New</a>
            <a id="btnEdit" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-edit" plain="true">Edit</a>
            <a id="btnView" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-details" plain="true">View</a>
            <a id="btnDelete" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-remove" plain="true">Delete</a>
            <a id="btnActivity" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-ok" plain="true">Activity</a>
            <a id="btnELProcess" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-ok" plain="true">EL Process</a>
        </div>
    </div>

    <div id="winLeaveHead" class="easyui-window" title="Leave Head" data-options="modal:true,closed:true,collapsible:false,minimizable:false,maximizable:false,closable:false" style="width:800px;height:auto;padding:1px">
        <table border="0" cellspacing="2" cellpadding="2">
            <tr>
                <td style="background-color:#cfb53b; text-align:center; width:800px; color:White">
                    <label id="lblHeaderName" style="font-size:15px; font-weight:bold; text-decoration:Underline"> Add Leave Head</label>
                </td>
            </tr>
        </table>
        <fieldset>
            <legend style="font-weight:bold"> Leave Head Informations : </legend>
            <table border="0" cellspacing="2" cellpadding="2" style="font-size:11px; font-weight: bold; width:750px">
                <tr>
                    <td style="text-align:right; width:13%">
                        Code :
                    </td>
                    <td style="width:20%">
                        <input id="txtCode" type="text" style="width: 100%;" disabled="disabled" />
                    </td>
                    <td style=" text-align:right; width:13%">
                        Name :
                    </td>
                    <td style="width:20%">
                        <input id="txtName" style="width: 100%;" type="text" />
                    </td>
                    <td style=" text-align:right; width:13%">
                        Name In Bangla :
                    </td>
                    <td style="width:20%">
                        <input id="txtNameInBangla" style="width: 100%;" type="text" />
                    </td>
                </tr>
                <tr>
                    <td style="text-align:right; width:13%">
                        Short Name :
                    </td>
                    <td style="width:20%">
                        <input style="width: 100%;" id="txtShortName" type="text" />
                    </td>
                    <td style="text-align:right; width:13%">
                        Total Day :
                    </td>
                    <td style="width:20%">
                        <input type="text" style="width: 100%;" id="txtTotalDay" />
                    </td>
                    <td style="text-align:right; width:13%">
                        Required For :
                    </td>
                    <td style="width:20%">
                        @Html.DropDownList("cboRequiredFor", new SelectList(Enum.GetValues(typeof(ESimSol.BusinessObjects.EnumLeaveRequiredFor))), new { id = "cboRequiredFor", style = "width: 50%;" })
                        <input id="chkLWP" type="checkbox" /> LWP
                    </td>
                </tr>

                <tr>
                    <td style=" text-align:right; width:13%">
                        Description :
                    </td>
                    <td style="width:86%" colspan="5">
                        <input style="width: 100%;" id="txtDescription" type="text" />
                    </td>
                </tr>
            </table>
        </fieldset>
        <div style="margin-left:0px; width:100%; height:300px">
            <table id="tblLHRules" title="Leave Head Rule List" class="easyui-datagrid" style="width:100%; height:100%" fitcolumns="false" rownumbers="true" pagination="false" singleselect="true" autorowheight="false" toolbar="#toolbarLHRule">
                <thead>
                    <tr>
                        <th field="LHRuleTypeSt" width="130" align="left">Rule Type</th>
                        <th field="LHRuleTypeDescription" width="400" align="left">Condition</th>
                        <th field="Remarks" width="200" align="left">Remarks</th>
                    </tr>
                </thead>
            </table>
            <div id="toolbarLHRule">
                <a id="btnAddLHRule" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-add" plain="true">Add</a>
                <a id="btnEditLHRule" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-edit" plain="true">Edit</a>
                <a id="btnDeleteLHRule" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-remove" plain="true">Delete</a>
            </div>
        </div>
        <fieldset>
            <legend style="font-weight:bold"> Action : </legend>
            <table border="0" cellspacing="2" cellpadding="2" style="font-size:11px; font-weight:bold">
                <tr>
                    <td style="width:600px; text-align:right"></td>

                    <td style="width:50px">
                        <a id="btnSave" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-save" plain="true">Save</a>
                    </td>
                    <td style="width:50px">
                        <a id="btnClose" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-cancel" plain="true">Close</a>
                    </td>
                </tr>
            </table>
        </fieldset>
    </div>


    <div id="winLeaveHeadRule" class="easyui-window" title="Leave Head Rule" data-options="modal:true,closed:true,collapsible:false,minimizable:false,maximizable:false,closable:false" style="width:500px;height:auto;padding:1px">
        <table border="0" cellspacing="2" cellpadding="2">
            <tr>
                <td style="background-color:#cfb53b; text-align:center; width:500px; color:White">
                    <label id="lblHeaderName" style="font-size:15px; font-weight:bold; text-decoration:Underline"> Leave Head Rule Information</label>
                </td>
            </tr>
        </table>
        <fieldset>
            <legend style="font-weight:bold"> Leave Head Rule Informations : </legend>
            <table border="0" cellspacing="2" cellpadding="2" style="font-size:11px; font-weight: bold; width:450px">
                <tr>
                    <td style="text-align:right; width:20%">
                        Rule Type :
                    </td>
                    <td style="width:20%">
                        <select id="cboLHRuleType" style="width: 100%;"></select>
                    </td>
                    <td style="text-align:right; width:15%">
                        Remarks :
                    </td>
                    <td style="width:45%">
                        <input style="width: 100%;" id="txtRuleTypeRemarks" type="text" />
                    </td>
                </tr>
                @*<tr>
                    
                    <td style="width:20%">
                        @Html.DropDownList("cboRequiredFor", new SelectList(Enum.GetValues(typeof(ESimSol.BusinessObjects.EnumLeaveRequiredFor))), new { id = "cboRequiredFor", style = "width: 50%;" })
                        <input id="chkLWP" type="checkbox" /> LWP
                    </td>
                </tr>*@

                <tr>
                    <td style=" text-align:right; width:20%">
                        Rule :
                    </td>
                    <td style="width:80%" colspan="3">
                        <input type="text" style="width: 100%;" id="txtLHRuleTypeDescription" readonly="readonly" disabled="disabled">
                    </td>
                </tr>
            </table>
        </fieldset>
        <div style="margin-left:0px; width:100%; height:260px">
            <table id="tblLeaveHeadRuleDetails" title="Rule Detail List" class="easyui-datagrid" style="width:100%; height:260px" fitcolumns="false" rownumbers="true" pagination="false" singleselect="true" autorowheight="false" toolbar="#toolbarLHRuleDetail">
                <thead>
                    <tr>
                        <th field="LHRuleValueTypeSt" width="100" align="left">Value Type</th>
                        <th field="LHRuleValue" width="230" align="left">Value</th>
                        <th field="Sequence" width="100" align="left">Sequence</th>
                    </tr>
                </thead>
            </table>
            <div id="toolbarLHRuleDetail">
                Value Type : 
                <select id="cboLHRuleDetailValueType" style="width:150px"></select>
                Value :
                <input type="text" id="txtLHRuleDetailValue" style="width:200px" />
                <a id="btnAddLHRuleDetail" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-add" plain="true">Add</a>
                <a id="btnDeleteLHRuleDetail" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-remove" plain="true">Remove</a>

                <a id="btnUPLHRuleDetail" href="javascript:void(0)" class="easyui-linkbutton initial-state" iconcls="icon-up" plain="true" onclick="SetSequence(1)"> Up</a>
                <a id="btnDownLHRuleDetail" href="javascript:void(0)" class="easyui-linkbutton initial-state" iconcls="icon-down" plain="true" onclick="SetSequence(2)"> Down</a>
            </div>
        </div>
        <fieldset>
            <legend style="font-weight:bold"> Action : </legend>
            <table border="0" cellspacing="2" cellpadding="2" style="font-size:11px; font-weight:bold">
                <tr>
                    <td style="width:300px; text-align:right"></td>

                    <td style="width:50px">
                        <a id="btnSaveLHRuleDetail" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-save" plain="true">Save</a>
                    </td>
                    <td style="width:50px">
                        <a id="btnCloseLHRuleDetail" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-cancel" plain="true">Close</a>
                    </td>
                </tr>
            </table>
        </fieldset>
    </div>
</body>
<script type="text/javascript">
    var _oLeaveHeads=[];
    var _sBaseAddress="";
    var _oLHRuleValueTypes = [];
    var _oLHRuleTypes = [];
    var _oLHRule = [];
    $(document).ready(function () {
        _oLeaveHeads =@Html.Raw( new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(Model));
        _sBaseAddress =@Html.Raw( new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(HttpContext.Current.Session[SessionInfo.BaseAddress]));
        _oLHRuleValueTypes =@Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(ViewBag.LHRuleValueType));
        _oLHRuleTypes =@Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(ViewBag.LHRuleType));
        _oLHRule =@Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(ViewBag.LHRule));
        debugger;
        InitializeLeaveHeadsEvents();
        ProgressBar(true);
    });

    $(document).keydown(function (e)
    {
        var keyCode = e.keyCode || e.which;
        if (keyCode == 27)
        {
            $("#winLeaveHead").icsWindow("close");
        }
    });

    $('#btnELProcess').click(function(e){
        var nEmpLeaveLedgerID=0;
        var LastProcessDate= '01 JAN 1900';
        ProgressBar(false);
        $.ajax
        ({
            type: "POST",
            dataType: "json",
            url: _sBaseAddress + "/EarnLeave/ELProcess",
            traditional: true,
            data: JSON.stringify({nEmpLeaveLedgerID:nEmpLeaveLedgerID,LastProcessDate:LastProcessDate}),
            contentType: "application/json; charset=utf-8",
            success: function (data) {
                var oOBJ = jQuery.parseJSON(data);
                if (oOBJ != null &&  oOBJ.ErrorMessage == "")
                {
                    alert("Process successfully");
                }
                else
                {
                    alert(oOBJ.ErrorMessage);
                }
                ProgressBar(true);
            },
            error: function (xhr, status, error) {
                alert(error);
                ProgressBar(true);
            }
        });
    });

    function ProgressBar(bHide)
    {
        if(bHide)
        {
            $("#progbarParent").hide();
        }
        else{
            $("#progbarParent").show();
        }
    }
</script>
