@{
    ViewBag.Title = "Cheque Register";
}
@model IEnumerable<ESimSol.BusinessObjects.Cheque>
<div id="winCheckRegisterAdvanceSearch" class="easyui-window winClass" title="Advance Search" data-options="modal:true,closed:true,collapsible:false,minimizable:false,maximizable:false,closable:false">
    <div style="width:760px; float: left;">
        <table border="0" cellpadding="0" cellspacing="0">
            <tr style="height:330px">
                <td style="width:850px">
                    <table border="0" cellpadding="0" cellspacing="0">
                        <tr style="height:340px">
                            <td style="width:300px; vertical-align:top;height:330px">
                                <fieldset style="height:98%;">
                                    <legend style="font-weight:bold; font-size:12px"> Searching Criteria : </legend>
                                    <table border="0" cellpadding="0" cellspacing="2">
                                        <tr>
                                            <td style="width:350px;font-size:12px;">
                                                <table border="0" cellpadding="0" cellspacing="0">
                                                    <tr>
                                                        <td style="width:175px;font-size:12px;">
                                                            Book Code:
                                                        </td>
                                                        <td style="width:175px;font-size:12px;">
                                                            Cheque No:
                                                        </td>
                                                    </tr>
                                                </table>
                                            </td>
                                        </tr>
                                        <tr>
                                            <td style="width:350px">
                                                <table border="0" cellpadding="0" cellspacing="0">
                                                    <tr>
                                                        <td style="width:175px;font-size:12px;">
                                                            @Html.TextBox("txtBookCodeForSearch", "", new { style = "width: 160px", id = "txtBookCodeForSearch" })
                                                        </td>
                                                        <td style="width:175px;font-size:12px;">
                                                            @Html.TextBox("txtSearchByChequeNoForSearch", "", new { style = "width: 160px", id = "txtSearchByChequeNoForSearch" })
                                                        </td>
                                                    </tr>
                                                </table>
                                                
                                            </td>
                                        </tr>               
                                        <tr>
                                            <td style="width:350px;font-size:12px;">
                                                A/C No:
                                            </td>
                                        </tr>
                                        <tr>
                                            <td style="width:350px">
                                                @Html.TextBox("txtSearchByAccountNoForSearch", "", new { style = "width: 325px", id = "txtSearchByAccountNoForSearch" })
                                            </td>
                                        </tr>

                                        <tr>
                                            <td style="width:350px;font-size:12px;">
                                                Party Name:
                                            </td>
                                        </tr>
                                        <tr>
                                            <td style="width:350px">
                                                @Html.TextBox("txtSearchByPartyNameForSearch", "", new { style = "width: 325px", id = "txtSearchByPartyNameForSearch" })
                                            </td>
                                        </tr>
                                                              
                                        <tr>
                                            <td style="width:350px;font-size:12px;">
                                                Entry Date:
                                            </td>
                                        </tr>
                                        <tr>
                                            <td style="width:350px">
                                                <table border="0" cellpadding="0" cellspacing="0">
                                                    <tr>
                                                        <td style="width:97px;font-size:12px;"><select id="cboIssueDate" onchange="DateActions_Issue()"></select></td>
                                                        <td style="width:97px;font-size:12px;"><input type="text" id="dtIssueDateFrom" value="" style="width: 108px;font-size:12px;" class="easyui-datebox" data-options="formatter:icsdateformat,parser:icsdateparser" /></td>
                                                        <td style="width:9px;font-size:12px;" id="enddateT">To</td>
                                                        <td style="width:97px;font-size:12px;" id="enddate"><input type="text" id="dtIssueDateTo" value="" style="width: 108px;font-size:12px;" class="easyui-datebox" data-options="formatter:icsdateformat,parser:icsdateparser" /></td>
                                                    </tr>
                                                </table>
                                            </td>
                                        </tr>
                                                           
                                        <tr>
                                            <td style="width:350px;font-size:12px;">
                                                Check Date:
                                            </td>
                                        </tr>
                                        <tr>
                                            <td style="width:350px">
                                                <table border="0" cellpadding="0" cellspacing="0">
                                                    <tr>
                                                        <td style="width:97px;font-size:12px;"><select id="cboChkDate" onchange="DateActions_Cheque()"></select></td>
                                                        <td style="width:97px;font-size:12px;"><input type="text" id="dtChkDateFrom" value="" style="width: 108px;font-size:12px;" class="easyui-datebox" data-options="formatter:icsdateformat,parser:icsdateparser" /></td>
                                                        <td style="width:9px;font-size:12px;" id="enddateT">To</td>
                                                        <td style="width:97px;font-size:12px;" id="enddate"><input type="text" id="dtChkDateTo" value="" style="width: 108px;font-size:12px;" class="easyui-datebox" data-options="formatter:icsdateformat,parser:icsdateparser" /></td>
                                                    </tr>
                                                </table>
                                            </td>
                                        </tr>
                                        <tr>
                                            <td style="width:350px;font-size:12px;">
                                                Check Amount:
                                            </td>
                                        </tr>
                                        <tr>
                                            <td style="width:350px">
                                                <table border="0" cellpadding="0" cellspacing="0">
                                                    <tr>
                                                        <td style="width:97px;font-size:12px;"><select id="cboChkAmount"></select></td>
                                                        <td style="width:97px;font-size:12px;"><input type="text" id="txtChkAmountFrom" value="" style="width: 108px;font-size:12px;" /></td>
                                                        <td style="width:9px;font-size:12px;" id="enddateT">To</td>
                                                        <td style="width:97px;font-size:12px;" id="enddate"><input type="text" id="txtChkAmountTo" value="" style="width: 108px;font-size:12px;" /></td>
                                                    </tr>
                                                </table>
                                            </td>
                                        </tr>
                                        <tr style="height:40px; vertical-align:bottom">
                                            <td style=" text-align:left; width:330px;">
                                                <table border="0" cellpadding="0" cellspacing="0">
                                                    <tr>
                                                        <td style=" text-align:left;"><input type="button" value="Reset" id="btnReset" onclick="Reset()" style="width:70px; text-align:left;" /></td>
                                                        <td style=" text-align:right; width:260px;"><input type="button" value="Search" id="btnRefresh" style="width:70px; text-align:right;" /></td>
                                                    </tr>
                                                </table>
                                            </td>
                                        </tr>
                                    </table>
                                </fieldset>
                            </td>
                            <td style="width:390px; vertical-align:top">
                                <div style="margin-left:0px; margin-top:6px; height:330px">
                                    <table id="tblChequeList" title="Delivery Order List" class="easyui-datagrid" style="width:390px;height:320px" fitcolumns="false" rownumbers="true" pagination="false" singleselect="false" autorowheight="false">
                                        <thead>
                                            <tr>
                                                <th data-options="field:'Selected',checkbox:true"></th>
                                                <th field="BookCode" width="70">Book Code</th>
                                                <th field="AccountNo" width="180">Account No</th>
                                                <th field="ChequeDateInString" width="100">Cheque Date</th>
                                                <th field="AmountInString" width="100" align="right">Cheque Amount</th>  
                                            </tr>
                                        </thead>
                                    </table>
                                </div>
                        </tr>
                    </table>
                </td>
            </tr>
            <tr style="height:50px">
                <td style="width:850px; text-align:right">
                    <a href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-ok" plain="true" onclick="OkButtonClick()">Ok</a>
                    <a href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-cancel" plain="true" onclick="Close()">Close</a>
                </td>
            </tr>
        </table>
    </div>
</div>

  <div id="divCheques" style="margin-left: 0px; height: 100%; width:100%">      
      <table id="tblCheques" title="Cheque List" class="easyui-datagrid" fitcolumns="false" fit="true" rownumbers="true" pagination="true" singleselect="true" autorowheight="false" toolbar="#toolbar">
          <thead data-options="frozen:true">
              <tr>
                  <th data-options="field:'Selected',checkbox:true"></th>
                  <th field="ChequeNo" width="80">Cheque No</th>
              </tr>
          </thead>
          <thead>
              <tr>
                  <th field="BookCode" width="70">Book Code</th>
                  <th field="AccountNo" width="180">Account No</th>                  
                  <th field="ChequeDateInString" width="100">Cheque Date</th>
                  <th field="AmountInString" width="100" align="right">Cheque Amount</th>                  
                  <th field="ChequeStatusInString" width="120">Cheque Status</th>
                  <th field="PaymentTypeInString" width="120">Payment Type</th>
                  <th field="ContractorName" width="200">Party Name</th>
                  <th field="BankShortName" width="100">Bank</th>
                  <th field="Note" width="250">Remarks</th>
                  <th field="RegisterPrintSt" width="60" align="center">Reg Print</th>
                  
              </tr>
          </thead>
      </table>
    <div id="toolbar">
        <input type="text" placeholder="Search By Book No" id="txtBookCode" style="width:120px" />
        <input type="text" placeholder="Search by Cheque No" id="txtSearchByChequeNo" style="width:140px" />
        <input type="text" placeholder="Search By A/C No" id="txtSearchByAccountNo" style="width:130px" />
        <input type="text" placeholder="Search By Party" id="txtSearchByPartyName" style="width:100px" />
        <a id="btnWaightForPrint" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-reload" plain="true">Wait For Reg(Print)</a>
        <a id="btnSearch" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-search" plain="true">Search</a>
        <a id="btnView" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-details" plain="true">View Cheque</a>
        <a id="btnPrint" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-print" plain="true">Print</a>
        <a id="btnCommit" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-save" plain="true" onclick="return Commit()">Commit</a>

    </div>
</div>                                          

<script type="text/javascript">
    $(document).ready(function () {
        var oCheques =@Html.Raw( new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(Model));
        var oCompareOperators = @Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(ViewBag.CompareOperators));
        var oTempCheques =sessionStorage.getItem("Cheques");
        if(oTempCheques!=null)
        {
            oCheques = jQuery.parseJSON(oTempCheques);
        }
        $('#divCheques').data('Cheques', oCheques);
        RefreshList(oCheques);
        $('#txtChequeDate').datebox('setValue', icsdateformat(new Date()));
        $('#tblCheques').datagrid({ selectOnCheck: false, checkOnSelect: false });
        $("#cboIssueDate, #cboChkDate, #cboChkAmount").icsLoadCombo({ List:oCompareOperators,OptionValue: "id", DisplayText: "Value" });

        $('#txtChkAmountFrom,#txtChkAmountTo').icsCurrencyBox();
        $('#txtChkAmountFrom').prop("disabled", true);
        $('#txtChkAmountTo').prop("disabled", true);
        $('#txtChkAmountFrom').val('0.00');
        $('#txtChkAmountTo').val('0.00');
    });

    function Commit()
    {

        if(_cboChequeStatuses==null||_cboChequeStatuses<=0)
        {
            alert("Ivalid Cheque Status! \nPlease select Cheque Status.");
            return false;
        }

    }

    $('#txtSearchByChequeNo').keyup(function (e) {
        var txtName = $('#txtSearchByChequeNo').val();
        var oSearchedCheques = [];  var sTempName="";
        var oCurrentList = $('#tblCheques').datagrid('getRows');
        if (e.which == 8)
        {
            oCurrentList =  $('#divCheques').data('Cheques');
        }
        for(i=0;i<oCurrentList.length;++i){
            sTempName=oCurrentList[i].ChequeNo;
            n=sTempName.toUpperCase().indexOf(txtName.toUpperCase())
            if(n!=-1)
            {
                oSearchedCheques.push(oCurrentList[i]);
            }
        }
        RefreshList(oSearchedCheques);
    });

    $('#txtSearchByPartyName').keyup(function (e) {
        var c = String.fromCharCode(e.which);
        var txtName = $('#txtSearchByPartyName').val();
        var oSearchedCheques = [];  var sTempName="";
        var oCurrentList = $('#tblCheques').datagrid('getRows');
        if (e.which == 8)
        {
            oCurrentList = $('#divCheques').data('Cheques');;
        }
        for(i=0;i<oCurrentList.length;++i){
            sTempName=oCurrentList[i].ContractorName;
            n=sTempName.toUpperCase().indexOf(txtName.toUpperCase())
            if(n!=-1)
            {
                oSearchedCheques.push(oCurrentList[i]);
            }
        }
        RefreshList(oSearchedCheques);
    });

    $('#txtSearchByAccountNo').keyup(function (e) {
        var c = String.fromCharCode(e.which);
        var txtName = $('#txtSearchByAccountNo').val();
        var oSearchedCheques = [];  var sTempName="";
        var oCurrentList = $('#tblCheques').datagrid('getRows');
        if (e.which == 8)
        {
            oCurrentList = $('#divCheques').data('Cheques');
        }
        for(i=0;i<oCurrentList.length;++i){
            sTempName=oCurrentList[i].AccountNo;
            n=sTempName.toUpperCase().indexOf(txtName.toUpperCase())
            if(n!=-1)
            {
                oSearchedCheques.push(oCurrentList[i]);
            }
        }
        RefreshList(oSearchedCheques);
    });

    $('#txtBookCode').keyup(function (e) {
        var c = String.fromCharCode(e.which);
        var txtName = $('#txtBookCode').val();

        var oSearchedCheques = [];  var sTempName="";
        var oCurrentList = $('#tblCheques').datagrid('getRows');
        if (e.which == 8)
        {
            oCurrentList = $('#divCheques').data('Cheques');
        }
        for(i=0;i<oCurrentList.length;++i){
            sTempName=oCurrentList[i].BookCode;
            n=sTempName.toUpperCase().indexOf(txtName.toUpperCase())
            if(n!=-1)
            {
                oSearchedCheques.push(oCurrentList[i]);
            }
        }
        RefreshList(oSearchedCheques);
    });

    $('#btnWaightForPrint').click(function(){
        var oCheque = { ChequeID :0 };
        $.ajax({
            type: "POST",
            dataType: "json",
            url : sessionStorage.getItem('BaseAddress')+  "/Cheque/WaitForRegPrint",
            traditional: true,
            data:  JSON.stringify(oCheque),
            contentType: "application/json; charset=utf-8",
            success: function (data) {
                var oCheques = jQuery.parseJSON(data);
                $('#divCheques').data('Cheques', oCheques);
                RefreshList(oCheques);
            },
            error: function (xhr, status, error) {
                alert(error);
            }
        });
    });

    $('#btnSearch').click(function(){
        $("#winCheckRegisterAdvanceSearch").icsWindow('open', "Advance Search");
        $("#winCheckRegisterAdvanceSearch input").not("input[type='button']").val("");
        $("#winCheckRegisterAdvanceSearch select").val(0);
        Reset();
        var sChequeDate = $('#txtChequeDate').datebox('getValue');
        if(sChequeDate===null || sChequeDate==="")
        {
            alert('Please select Cheque Date!');
            return false;
        }
      
    });
    function Close()
    {
        $("#winCheckRegisterAdvanceSearch").icsWindow('close');
    }

    function OkButtonClick() {
        debugger;
        var oCheques=[];
        var oCheques = $('#tblChequeList').datagrid('getChecked');
        if(oCheques.length<=0)
        {
            alert("please select at least one item");
            return;
        }
        RefreshList(oCheques);
        $("#winCheckRegisterAdvanceSearch").icsWindow('close');
    }
    function DateActions_Issue() {
        DynamicDateActions("cboIssueDate", "dtIssueDateFrom", "dtIssueDateTo");
    }
    function DateActions_Cheque() {
        DynamicDateActions("cboChkDate", "dtChkDateFrom", "dtChkDateTo");
    }
    
    function Reset() {
        debugger;
        $("#txtBookCodeForSearch,#txtSearchByChequeNoForSearch,#txtSearchByAccountNoForSearch,#txtSearchByPartyNameForSearch").val('');
        $("#txtChkAmountFrom,#txtChkAmountTo").val('0.00');
        $('#cboIssueDate,#cboChkDate,#cboChkAmount').val(0);
        $('#dtIssueDateFrom,#dtIssueDateTo,#dtChkDateFrom,#dtChkDateTo').datebox('setValue', icsdateformat(new Date()));
        RefreshListForSearch([]);
    }
    $('#cboChkAmount').change(function(e){
        //EqualTo = 1, NotEqualTo = 2, GreaterThen = 3, SmallerThen = 4, Between = 5, NotBetween = 6
        var nCompareOperator =   parseInt($('#cboChkAmount').val());
        if(nCompareOperator===0)
        {
            $('#txtChkAmountFrom').prop("disabled", true);
            $('#txtChkAmountTo').prop("disabled", true);
        }
        else if (nCompareOperator===1 || nCompareOperator===2 || nCompareOperator===3 || nCompareOperator===4)
        {
            $('#txtChkAmountFrom').prop("disabled", false);
            $('#txtChkAmountTo').prop("disabled", true);
        }
        else
        {
            $('#txtChkAmountFrom').prop("disabled", false);
            $('#txtChkAmountTo').prop("disabled", false);
        }
        $('#txtChkAmountFrom').val('0.00');
        $('#txtChkAmountTo').val('0.00');
    });

    $('#btnRefresh').click(function () {
        debugger;
        var sBookCode= $("#txtBookCodeForSearch").val();
        var sChequeNo= $("#txtSearchByChequeNoForSearch").val();
        var sAccountNo= $("#txtSearchByAccountNoForSearch").val();
        var sPartyName= $("#txtSearchByPartyNameForSearch").val();     
        
        var nIssueDate=$('#cboIssueDate').val();
        var dIssueDate=$('#dtIssueDateFrom').datebox('getValue');
        var dEndIssueDate=$('#dtIssueDateTo').datebox('getValue');

        var nChequeDate=$('#cboChkDate').val();
        var dStartCheckDate=$('#dtChkDateFrom').datebox('getValue');
        var dEndCheckDate=$('#dtChkDateTo').datebox('getValue');

        var nChkAmount = parseInt($('#cboChkAmount').val());
        var sChkAmountFrom   = $.trim($('#txtChkAmountFrom').val());
        var sChkAmountTo = $.trim($('#txtChkAmountTo').val());
        if(nChkAmount===1 || nChkAmount===2 || nChkAmount===3 || nChkAmount===4)
        {            
            if(sChkAmountFrom===null || sChkAmountFrom==="")
            {
                alert("Please enter Cheque start Amount!");
                $('#txtChkAmountFrom').focus();
                return false;
            }
            if(icsRemoveComma(sChkAmountFrom)<=0)
            {
                alert("Please enter Cheque start Amount!");
                $('#txtChkAmountFrom').focus();
                return false;
            }
        }        
        if(nChkAmount===5 || nChkAmount===6)
        {            
            if(sChkAmountFrom===null || sChkAmountFrom==="")
            {
                alert("Please enter Cheque start Amount!");
                $('#txtChkAmountFrom').focus();
                return false;
            }
            if(icsRemoveComma(sChkAmountFrom)<=0)
            {
                alert("Please enter Cheque start Amount!");
                $('#txtChkAmountFrom').focus();
                return false;
            }
                        
            if(sChkAmountTo===null || sChkAmountTo==="")
            {
                alert("Please enter Cheque end Amount!");
                $('#txtChkAmountTo').focus();
                return false;
            }
            if(icsRemoveComma(sChkAmountTo)<=0)
            {
                alert("Please enter Cheque end Amount!");
                $('#txtChkAmountTo').focus();
                return false;
            }
            if(icsRemoveComma(sChkAmountFrom) >= icsRemoveComma(sChkAmountTo))
            {
                alert("Start amount must be smallar than end amount!");
                $('#txtChkAmountFrom').focus();
                return false;
            }
        }

        if(nIssueDate==0 && nChequeDate==0 && nChkAmount==0 && sBookCode=="" && sChequeNo=="" && sAccountNo=="" && sPartyName=="" )
        {
            alert('Please Select a Search Criteria');
            return false;
        }
        var sTempString = nIssueDate+'~'+dIssueDate+'~'+dEndIssueDate+'~'+nChequeDate+'~'+dStartCheckDate+'~'+dEndCheckDate+'~'+sBookCode+'~'+sChequeNo+'~'+sAccountNo+'~'+sPartyName+'~'+nChkAmount+'~'+sChkAmountFrom+'~'+sChkAmountTo;
        $.ajax({
            type: "GET",
            dataType: "json",
            url: '@Url.Action("Gets", "Cheque")',
            data: { Temp: sTempString },
            contentType: "application/json; charset=utf-8",
            success: function (data) {
                ////debugger;
                oCheques = jQuery.parseJSON(data);
                if (oCheques != null) {
                    if(oCheques.length>0)
                    {
                        RefreshListForSearch(oCheques);
                    }
                    else
                    {
                        alert("Data not found!!");
                        RefreshListForSearch([]);
                    }
                }
            },
            error: function (xhr, status, error) {
                alert(error);
            }
        });

    });

    function RefreshListForSearch(oLists)
    {
        data =oLists;
        data={"total":""+data.length+"","rows":data};
        $('#tblChequeList').datagrid('loadData',data);

    }

    $('#btnView').click(function(){
        var oCheque= $('#tblCheques').datagrid('getSelected');
        if(oCheque==null || oCheque.ChequeID<=0)
        {
            alert("Please select a item from list!");
            return false;
        }
        var SelectedRowIndex=$('#tblCheques').datagrid('getRowIndex',oCheque);
        var tsv=((new Date()).getTime())/1000;
        var SelectedRowIndex=$('#tblCheques').datagrid('getRowIndex',oCheque);
        var oCheques= $('#tblCheques').datagrid('getRows');
        sessionStorage.setItem("Cheques", JSON.stringify(oCheques));
        sessionStorage.setItem("SelectedRowIndex", SelectedRowIndex);
        sessionStorage.setItem("ChequeHeader", "View Cheque");
        sessionStorage.setItem("ChequeBackTo", window.location.href);
        window.location.href = _sBaseAddress+  "/Cheque/ViewChequeIssue?id="+oCheque.ChequeID+"&nid="+oCheque.ChequeBookID;
    });

    $('#btnPrint').click(function(){
        var oCheques = $('#tblCheques').datagrid('getChecked');
        if(oCheques === null || oCheques.length <=0)
        {
            alert("Please select at least one cheque!");
            return false;
        }

        //for(var i=0; i<oCheques.length; i++)
        //{
        //    if(oCheques[i].RegisterPrintSt==="Yes")
        //    {
        //        alert("Your selected cheque No : "+ oCheques[i].ChequeNo + " already print!");
        //        return;
        //    }
        //}
        var ids = ICS_PropertyConcatation(oCheques, 'ChequeID');
        var tsv=((new Date()).getTime())/1000;
        window.open(sessionStorage.getItem('BaseAddress')+ "/Cheque/PrintRegister?ids="+ids+"&ts="+tsv);
    });

    $('#btnCommit').click(function(){
        var oCheques = $('#tblCheques').datagrid('getChecked');
        if(oCheques === null || oCheques.length <=0)
        {
            alert("Please select at least one cheque!");
            return false;
        }

        for(var i=0; i<oCheques.length; i++)
        {
            if(oCheques[i].RegisterPrintSt==="Yes")
            {
                alert("Your selected cheque No : "+ oCheques[i].ChequeNo + " already print!");
                return;
            }
        }
        $('#tblCheques').data('Cheques', oCheques);
        if (!confirm("Confirm to Register Print?")) return ;

        var oCheque = { Cheques : oCheques };
        $.ajax({
            type: "POST",
            dataType: "json",
            url : sessionStorage.getItem('BaseAddress')+  "/Cheque/CommitRegisterPrint",
            traditional: true,
            data:  JSON.stringify(oCheque),
            contentType: "application/json; charset=utf-8",
            success: function (data) {
                var sFeedBack = jQuery.parseJSON(data);
                if (sFeedBack === "Successful")
                {
                    var oCheques = [];
                    oCheques = $('#tblCheques').data('Cheques');
                    alert("Data Update sucessfully");
                    RefreshGrid(oCheques);
                }
                else
                {
                    alert("Commit Unsuccessful");
                }
            },
            error: function (xhr, status, error) {
                alert(error);
            }

        });
    });

    function RefreshGrid(oCheques)
    {
        var oCurrentList = $('#tblCheques').datagrid('getRows');
        var SelectedRowIndex;
        for(var i=0; i<oCurrentList.length;i++)
        {
            for(var j=0; j<oCheques.length;j++)
            {
                if(parseInt(oCurrentList[i].ChequeID) === parseInt(oCheques[j].ChequeID))
                {
                    SelectedRowIndex= $('#tblCheques').datagrid('getRowIndex',oCurrentList[i]);
                    $('#tblCheques').datagrid('deleteRow',SelectedRowIndex);
                }
            }
        }
        oCheques =[];
        oCheques = $('#tblCheques').datagrid('getRows');
        $('#divCheques').data('Cheques', oCheques);
        RefreshList(oCheques);
    }

    function RefreshList(oCheques)
    {
        data = oCheques;
        data={"total":""+data.length+"","rows":data};
        $('#tblCheques').datagrid('loadData',data);
        var nIndex =  parseInt(sessionStorage.getItem("SelectedRowIndex"));
        if(nIndex>0)
        {
            $('#tblCheques').datagrid('selectRow',nIndex);
        }
    }
</script>
