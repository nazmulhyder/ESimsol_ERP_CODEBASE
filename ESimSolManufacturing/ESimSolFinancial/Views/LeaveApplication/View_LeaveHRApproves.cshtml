@model IEnumerable<ESimSol.BusinessObjects.LeaveApplication>
    @{
        ViewBag.Title = "HR Approve";
    }
    <div class="menuMainCollectionTable">
        <table id="tblLeaveApplication" title="HR Approve" class="easyui-datagrid" style="width:100%; height:100%" fitcolumns="false" rownumbers="true" pagination="false" singleselect="true" autorowheight="false" toolbar="#toolbar">
            <thead>
                <tr>
                    <th field="EmployeeNameCode" width="110" align="left">Employee</th>
                    <th field="LeaveHeadName" width="75" align="left">Leave</th>                    
                    <th field="LeaveTypeInString" width="67" align="left">Leave Type</th>                    
                    <th field="StartDateTimeInString" width="100" align="left">Start</th>
                    <th field="EndDateTimeInString" width="100" align="left">End</th>
                    @*<th field="LeaveStatusInString" width="100" align="left">Status</th>*@    
                    <th field="StatusOfLeave" width="100" align="left">Status</th>              
                    <th field="DBUserName" width="120" align="center">AppliedBy</th>
                    <th field="Recommend" width="120" align="center">Recommend</th>
                    <th field="ApproveByName" width="120" align="center">Approved By</th>
                    <th field="HRApproveBYName" width="120" align="center">HR Approved By</th>
                </tr>
            </thead>
        </table>

        <div id="toolbar" style="height:auto;">
            <input id="chkIsDate" type="checkbox" />
            <input id="dtStartDate_Search" type="text" style="width: 100px;" class="easyui-datebox" data-options="formatter:icsdateformat,parser:icsdateparser" />
            <input id="dtEndDate_Search" type="text" style="width: 100px;" class="easyui-datebox" data-options="formatter:icsdateformat,parser:icsdateparser" />
            <input id="txtEmployee_Search" type="text" style="width: 150px;" placeholder="Type code or name then enter" />
            <input id="txtCEmployee" type="button" value="C" />
            <input id="chkReportingPerson" type="checkbox" /> Reporting Person
            <a id="btnEmployeeOrDate_Search" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-search" plain="true" onclick="Search_By_Code_Or_Date()"></a>
            <a id="btnAdvSearch" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-search" plain="true">Adv. Search</a>
            <a id="btnClear" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-remove" plain="true">Remove all from the list</a>
            <br />
            
            <a id="btnView" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-details" plain="true">View</a>
            <a id="btnApprove" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-ok" plain="true">Approve</a>
            <a id="btnCancel" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-ok" plain="true">Cancel</a>
            <a id="btnLeaveApplicationForm_MAMIYA" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-print" plain="true">Leave Application </a>
            <a id="btnLeaveAdjustment" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-ok" plain="true">Adjustment</a>
            <a id="btnLeaveLedger" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-ok" plain="true" onclick="LeaveLedger('')">Ledger</a>

        </div>

        <div id="winLeaveApplication" class="easyui-window" title="Leave Application" data-options="modal:true,closed:true,collapsible:false,minimizable:false,maximizable:false,closable:false">
            <table class="tbl">
                <tr>
                    <td class="tdApp">
                        <div class="divLabel">
                            <label>Employee Name:</label>
                        </div>
                        <div class="divInput">
                            <input id="txtEmployee" class="txtfield-picker resetfield" placeholder="Type and press enter or pick employee" type="text" />
                            <input id="btnEmployeePicker" class="pick-btn-LeaveApp" type="button" value="P" />
                            <input id="btnResetEmployeePicker" class="pick-btn-LeaveApp" type="button" value="R" />
                        </div>
                    </td>
                </tr>
                <tr>
                    <td class="tdApp">
                        <div class="divLabel">
                            <label>Start From:</label>
                        </div>
                        <div class="divInput">
                            <div style="float:left; width:49%; text-align:left;">
                                <input id="dtStartDate" type="text" class="easyui-datebox" required="required" data-options="formatter:icsdateformat,parser:icsdateparser" />
                                @*<input id="dtStartDate" class="easyui-datebox" data-options="required:true,showSeconds:false" value="datetime()" />*@
                                <span id="spEndDate">
                                    to
                                    <input id="dtEndDate" type="text" class="easyui-datebox" required="required" data-options="formatter:icsdateformat,parser:icsdateparser" />
                                    @*<input id="dtEndDate" class="easyui-datebox" data-options="required:true,showSeconds:false" value="datetime()" />*@
                                </span>
                            </div>
                            <div style="float:left; width:18.8%; padding-left:1%; text-align:right;">
                                <input id="btnGetAttendance" style="width:110px;float: none;" type="button" value="Show Attendance" onclick="GetAttendance()" />
                            </div>
                        </div>
                    </td>
                </tr>
                @*<tr>
                        <td class="tdApp">
                            <div class="divLabel">
                                <label>Application Type:</label>
                            </div>
                            <div class="divInput-rd">
                                <span><input type="radio" id="rdbtnLeaveOfApplication" class="rd-styler" name="ApplicationType" /> <label>Leave of Application</label> </span>
                                <span><input type="radio" id="rdbtnLeaveOfAbsence" class="rd-styler" name="ApplicationType" /> <label>Leave of Absence</label></span>
                            </div>
                        </td>
                    </tr>*@
                <tr>
                    <td class="tdApp">
                        <div class="divLabel">
                            <label>Leave:</label>
                        </div>
                        <div class="divInput">
                            @*<div style="float:left; width:69%;">
                                    <div style="float:left; width:73%; text-align:left;" >
                                        <select id="cboLeaveLedger" style="width:100%" ></select>
                                    </div>
                                    <div style="float:left; width:25%; padding-left:2%; text-align:right;">
                                        <input type="text" style="width:95%;" class="number" />
                                    </div>
                                </div>*@
                            <div style="float:left; width:49%; text-align:left;">
                                <select id="cboLeaveLedger" style="width:100%"></select>
                            </div>
                            <div style="float:left; width:18.8%; padding-left:1.2%; text-align:right;">
                                @*<input id="btnELProcess" type="button" value="EL Process" style="width:100%;" />*@
                            </div>
                        </div>
                    </td>
                </tr>
                <tr>
                    <td class="tdApp">
                        <div class="divLabel">
                            <label>Leave Type:</label>
                        </div>
                        <div class="divInput">
                            @*<select id="cboLeaveType"></select>*@
                            <div style="float:left; width:69%;">
                                <div style="float:left; width:71%; text-align:left;">
                                    <select id="cboLeaveType" style="width:100%"></select>
                                </div>
                                <div style="float:left; width:27%; padding-left:2%; text-align:right;">
                                    <input id="txtDurationInHour" type="text" style="width:75%;" class="number" disabled placeholder="Duration In Hour" />
                                    (hr)
                                </div>
                            </div>
                        </div>
                    </td>
                </tr>
                <tr>
                    <td class="tdApp">
                        <div class="divLabel">
                            <label>Expense Location:</label>
                        </div>
                        <div class="divInput">
                            <input id="txtExpenseLocation" class="resetfield" type="text" value="N/A" placeholder="Leave expense location." />
                        </div>
                    </td>
                </tr>
                <tr>
                    <td class="tdApp">
                        <div class="divLabel">
                            <label>Reason:</label>
                        </div>
                        <div class="divInput">
                            <input id="txtReason" class="resetfield" type="text" placeholder="Reason for leave." value="N/A" />
                        </div>
                    </td>
                </tr>
                <tr>
                    <td class="tdApp">
                        <div class="divLabel">
                            <label>Responsible Person:</label>
                        </div>
                        <div class="divInput">
                            <input id="txtResponsiblePerson" class="resetfield" placeholder="Type and press enter or pick employee" type="text" />
                        </div>
                    </td>
                </tr>
                <tr>
                    <td class="tdApp">
                        <div class="divLabel">
                            <label>Type:</label>
                        </div>
                        <div class="divInput-rd">
                            <span><input type="radio" id="rdbtnPaid" class="rd-styler" name="paid-unpaid" disabled="disabled" /> <label>Paid</label> </span>
                            <span><input type="radio" id="rdbtnUnPaid" class="rd-styler" name="paid-unpaid" disabled="disabled" /> <label>Un-Paid</label></span>
                        </div>
                    </td>
                </tr>
                <tr>
                    <td class="tdApp tdRecommendationNote">
                        <div class="divLabel">
                            <label>Recommendation Note:</label>
                        </div>
                        <div class="divInput">
                            <input id="txtRecommendationNote" class="resetfield" type="text" placeholder="Recommendation Note." />
                        </div>
                    </td>
                </tr>
                <tr>
                    <td class="tdApp tdRecommendation">
                        <div class="divLabel clsReportingPerson">
                            <label>Request To Approval:</label>
                        </div>
                        <div class="divInput clsReportingPerson">
                            <select id="cboRequestToApproval"></select>
                            <span style="float:left; margin-left:5px;margin-right:5px; "></span>
                            <input id="txtRequestToApproval" class="resetfield" type="text" placeholder="Request To Approval Person." />
                        </div>
                    </td>
                </tr>
                <tr>
                    <td class="tdApp tdApproval">
                        <div class="divLabel">
                            <label>Approval Note:</label>
                        </div>
                        <div class="divInput">
                            <input id="txtApprovalNote" class="resetfield" type="text" placeholder="Approval Note." />
                        </div>
                    </td>
                </tr>
                <tr>
                    <td class="tdApp tdCancel">
                        <div class="divLabel">
                            <label>Cancel Note:</label>
                        </div>
                        <div class="divInput">
                            <input id="txtCancelNote" class="resetfield" type="text" placeholder="Cancel Note." />
                        </div>
                    </td>
                </tr>
            </table>

            <fieldset class="actionfieldsetstyle">
                <legend>Actions : </legend>
                <table class="tbl">
                    <tr>
                        <td class="tdApp lblAlign">
                            <label id="lblApplicationStatus" class="resetlbl"></label>
                            <a id="btnLeaveLedger_Single" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-ok" plain="true" onclick="LeaveLedger('Single')">Ledger</a>
                        </td>
                        <td class="tdApp">
                            <a id="btnCancelLeaveApplication" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-ok" plain="true">Cancel</a>
                            <a id="btnApproveLeaveApplication" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-ok" plain="true">Approve</a>
                            <a id="btnRecommendLeaveApplication" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-ok" plain="true">Recommend</a>
                            <a id="btnLeaveAdjustmentSave" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-ok" plain="true">Adjustment</a>

                            <a id="btnSaveLeaveApplication" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-save" plain="true">Save</a>
                            <a id="btnCloseLeaveApplication" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-cancel" plain="true">Close</a>
                        </td>
                    </tr>
                </table>
            </fieldset>
        </div>

        <div id="winLeaveApplicationAdvSearch" class="easyui-window winstyle" title="Search" style="width:960px;" data-options="modal:true,closed:true,collapsible:false,minimizable:false,maximizable:false,closable:false">
            <div style="width: 100%; font-family: Tahoma;">
                <div style="width: 47%; float: left;">
                    <table class="tbl-AdvSearch">
                        <tr>
                            <td class="td-AdvSearch-Level">
                                Employee Name :
                            </td>
                            <td class="td-AdvSearch-Input">
                                <input id="txtEmployeeNameLAPicker" class="txtfield-picker txtResetLAPicker" type="text" />
                                <input id="btnEmployeeLAPicker" class="pick-btn" type="button" value="P" />
                                <input id="btnResetEmployeeLAPicker" class="pick-btn" type="button" value="R" />
                            </td>
                        </tr>
                        <tr>
                            <td class="td-AdvSearch-Level">
                                Dept./Section :
                            </td>
                            <td class="td-AdvSearch-Input">
                                <input id="txtDepartmentLAPicker" class="txtfield-picker txtResetLAPicker" type="text" disabled />
                                <input id="btnDepartmentPickerLAPicker" class="pick-btn" type="button" value="P" />
                                <input id="btnResetDepartmentPickerLAPicker" class="pick-btn" type="button" value="R" />
                            </td>
                        </tr>
                        <tr>
                            <td class="td-AdvSearch-Level">
                                Application Type :
                            </td>
                            <td class="td-AdvSearch-Input">
                                <select id="cboApplicationTypeLAPicker" class="selection-search cboResetLAPicker"></select>
                            </td>
                        </tr>
                        <tr>
                            <td class="td-AdvSearch-Level">
                                Leave :
                            </td>
                            <td class="td-AdvSearch-Input">
                                <select id="cboLeaveLAPicker" class="selection-search cboResetLAPicker"></select>
                            </td>
                        </tr>
                        <tr>
                            <td class="td-AdvSearch-Level">
                                Leave Type :
                            </td>
                            <td class="td-AdvSearch-Input">
                                <select id="cboLeaveTypeLAPicker" class="selection-search cboResetLAPicker"></select>
                            </td>
                        </tr>
                        <tr>
                            <td class="td-AdvSearch-Level">
                                Status :
                            </td>
                            <td class="td-AdvSearch-Input">
                                <select id="cboLeaveStatusLAPicker" class="selection-search cboResetLAPicker"></select>
                            </td>
                        </tr>
                        <tr>
                            <td class="td-AdvSearch-Level">
                                Date Range :
                            </td>
                            <td class="td-AdvSearch-Input">
                                <input type="checkbox" id="chkIsDateSearch" class="chkResetLAPicker" />
                                <span>
                                    <input id="dtStartDateLAPicker" type="text" class="easyui-datebox" required="required" data-options="formatter:icsdateformat,parser:icsdateparser" />
                                </span>
                                <span>To</span>
                                <input id="dtEndDateLAPicker" type="text" class="easyui-datebox" required="required" data-options="formatter:icsdateformat,parser:icsdateparser" />
                            </td>
                        </tr>
                        <tr>
                            <td class="td-AdvSearch-Level"></td>
                            <td class="td-AdvSearch-Input">
                                <input type="checkbox" id="chkIsPaidLAPicker" class="chkResetLAPicker" /> Paid
                                <input type="checkbox" id="chkIsUnPaidLAPicker" class="chkResetLAPicker" />UnPaid
                            </td>
                        </tr>
                        <tr>
                            <td class="td-AdvSearch-Level"></td>
                            <td class="td-AdvSearch-Input">
                                <input type="button" value="Reset" id="btnResertLAPicker" style="width: 70px" />
                                <input type="button" value="Search" id="btnSearchLAPicker" style="width: 70px" onclick="SearchLAPicker()" />
                            </td>
                        </tr>
                    </table>
                </div>
                <div style="width: 52%; float: right;">
                    <table id="tblLeaveApplicationForPicker" title="Employee List" class="easyui-datagrid" style="width: 480px; height: 425px;" fitcolumns="true" rownumbers="true" pagination="false" singleselect="false" autorowheight="false">
                        <thead>
                            <tr>
                                <th data-options="field:'Selected',checkbox:true"></th>
                                <th field="EmployeeName" width="150">Employee Name</th>
                                <th field="LeaveHeadName" width="80">Leave</th>
                                <th field="StartDateTimeInString" width="105px;" align="center">Start </th>
                                <th field="EndDateTimeInString" width="105px;" align="center"> End </th>
                                <th field="LeaveStatusInString" width="70px;"> Status </th>
                            </tr>
                        </thead>
                    </table>
                    <table style="width: 485px; font-size: 12px; font-weight: bold;">
                        <tr>
                            <td style="text-align: left">
                                <input id="chkRange_Search" type="checkbox" />Range
                                <label id="lblRange1_Search">
                                    <input id="txtFrom_Search" type="text" style="width:40px" />&nbsp; To &nbsp;
                                </label>
                                <label id="lblRange2_Search">
                                    <input id="txtTo_Search" type="text" style="width:40px" />
                                </label>
                                <label id="lblcount_Search"></label>
                            </td>
                            <td style="text-align: right">
                                <a href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-ok" plain="true" onclick="Next_LeaveSearch()">Next</a>
                                <a id="btnLeaveAppPickerOk" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-ok" plain="true">Ok</a>
                                <a id="btnLeavePickerClose" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-cancel" plain="true">Close</a>
                            </td>
                        </tr>
                        <tr>
                            <td style="text-align: left"></td>
                            <td style="text-align: right"></td>
                        </tr>
                    </table>
                </div>
            </div>
        </div>

        <div id="winEmployeePicker" class="easyui-window winstyle" title="Employee Picker" style="width:960px;" data-options="modal:true,closed:true,collapsible:false,minimizable:false,maximizable:false,closable:false">
            <div style="width: 100%; font-family: Tahoma;">
                <div style="width: 47%; float: left;">
                    <table class="tbl-AdvSearch">
                        <tr>
                            <td class="td-AdvSearch-Level">
                                Employee Name :
                            </td>
                            <td class="td-AdvSearch-Input">
                                <input id="txtEmployeeName" class="txtfield-search txtReset" type="text" />
                            </td>
                        </tr>
                        <tr>
                            <td class="td-AdvSearch-Level">
                                Code :
                            </td>
                            <td class="td-AdvSearch-Input">
                                <input id="txtEmpCodeForSearch" class="txtfield-search txtReset" type="text" />
                            </td>
                        </tr>
                        <tr>
                            <td class="td-AdvSearch-Level">
                                Enroll No :
                            </td>
                            <td class="td-AdvSearch-Input">
                                <input id="txtEnrollNo" class="txtfield-search txtReset" type="text" />
                            </td>
                        </tr>
                        <tr>
                            <td class="td-AdvSearch-Level">
                                Attendance Scheme :
                            </td>
                            <td class="td-AdvSearch-Input">
                                <input id="txtAttendanceScheme" class="txtfield-picker txtReset" type="text" disabled />
                                <input id="btnAttScheme" class="pick-btn" type="button" value="P" />
                                <input id="btnResetAttScheme" class="pick-btn" type="button" value="R" />
                            </td>
                        </tr>
                        <tr>
                            <td class="td-AdvSearch-Level">
                                Location :
                            </td>
                            <td class="td-AdvSearch-Input">
                                <input id="txtLocation" class="txtfield-picker txtReset" type="text" disabled />
                                <input id="btnLocationPicker" class="pick-btn" type="button" value="P" />
                                <input id="btnResetLocationPicker" class="pick-btn" type="button" value="R" />
                            </td>
                        </tr>
                        <tr>
                            <td class="td-AdvSearch-Level">
                                Dept./Section :
                            </td>
                            <td class="td-AdvSearch-Input">
                                <input id="txtDepartment" class="txtfield-picker txtReset" type="text" disabled />
                                <input id="btnDepartmentPicker" class="pick-btn" type="button" value="P" />
                                <input id="btnResetDepartmentPicker" class="pick-btn" type="button" value="R" />
                            </td>
                        </tr>
                        <tr>
                            <td class="td-AdvSearch-Level">
                                Designation :
                            </td>
                            <td class="td-AdvSearch-Input">
                                <input id="txtDesignation" class="txtfield-picker txtReset" type="text" disabled />
                                <input id="btnDesignationPicker" class="pick-btn" type="button" value="P" />
                                <input id="btnResetDesignationPicker" class="pick-btn" type="button" value="R" />
                            </td>
                        </tr>
                        <tr>
                            <td class="td-AdvSearch-Level">
                                Employee Type :
                            </td>
                            <td class="td-AdvSearch-Input">
                                <select id="cboEmployeeType" class="selection-search cboReset"></select>
                            </td>
                        </tr>
                        <tr>
                            <td class="td-AdvSearch-Level">
                                Gender :
                            </td>
                            <td class="td-AdvSearch-Input">
                                <select id="cboGender" class="selection-search cboReset">
                                    <option value="0">None</option>
                                    <option value="1">Male</option>
                                    <option value="2">Female</option>
                                </select>
                            </td>
                        </tr>
                        <tr>
                            <td class="td-AdvSearch-Level">
                                Current Shift :
                            </td>
                            <td class="td-AdvSearch-Input">
                                <select id="cboShift" class="selection-search cboReset"></select>
                            </td>
                        </tr>
                        <tr>
                            <td class="td-AdvSearch-Level">
                                Card Status :
                            </td>
                            <td class="td-AdvSearch-Input">
                                <select id="cboEmployeeCardStatus" class="selection-search cboReset"></select>
                            </td>
                        </tr>
                        <tr>
                            <td class="td-AdvSearch-Level">
                                Working Status :
                            </td>
                            <td class="td-AdvSearch-Input">
                                <select id="cboEmployeeWorkigStatus" class="selection-search cboReset"></select>
                            </td>
                        </tr>
                        <tr>
                            <td class="td-AdvSearch-Level">
                                Date Of Birth :
                            </td>
                            <td class="td-AdvSearch-Input">
                                <select id="cboDateType" style="width: 65px" class="cboReset">
                                    <option value='0'>None</option>
                                    <option value='1'>Equal</option>
                                    <option value='2'>Between</option>
                                </select>
                                <span></span>
                                <select id="cboDayFrom" style="width: 45px" class="cboReset"></select>
                                <select id="cboMonthFrom" style="width: 50px" class="cboReset"></select>
                                <span id="regionDateTo">
                                    <span>To</span>
                                    <select id="cboDayTo" style="width: 45px" class="cboReset"> </select>
                                    <select id="cboMonthTo" style="width: 50px" class="cboReset"> </select>
                                </span>

                            </td>
                        </tr>
                        <tr>
                            <td class="td-AdvSearch-Level"></td>
                            <td class="td-AdvSearch-Input">
                                <input type="checkbox" id="chkActive" class="chkReset" /> Active
                                <input type="checkbox" id="chkInActive" class="chkReset" />InActive
                                <input type="checkbox" id="chkUser" class="chkReset" /> User
                            </td>
                        </tr>
                        <tr>
                            <td class="td-AdvSearch-Level"></td>
                            <td class="td-AdvSearch-Input">
                                <input type="checkbox" id="chkOfficialNotAssign" class="chkReset" /> official Information is not assigned yet
                            </td>
                        </tr>
                        <tr>
                            <td class="td-AdvSearch-Level"></td>
                            <td class="td-AdvSearch-Input">
                                <input type="checkbox" id="chkOfficialAssign" class="chkReset" /> official Information assigned employee
                            </td>
                        </tr>
                        <tr>
                            <td class="td-AdvSearch-Level"></td>
                            <td class="td-AdvSearch-Input">
                                <input type="checkbox" id="chkCardNotAssigned" class="chkReset" /> Card is not assigned yet
                            </td>
                        </tr>
                        <tr>
                            <td class="td-AdvSearch-Level"></td>
                            <td class="td-AdvSearch-Input">
                                <input type="checkbox" id="chkSalarystructureNotAssigned" class="chkReset" /> Salary structure is not assigned yet
                            </td>
                        </tr>
                        <tr>
                            <td class="td-AdvSearch-Level"></td>
                            <td class="td-AdvSearch-Input">
                                <input type="button" value="Reset" id="btnEmployeePickerReset" style="width: 70px" onclick="EmployeePickerReset()" />
                                <input type="button" value="Search" id="btnEmpPickerSearch" style="width: 70px" />
                            </td>
                        </tr>
                    </table>
                </div>
                <div style="width: 52%; float: right;">
                    <table id="tblEmployeesForPicker" title="Employee List" class="easyui-datagrid" style="width: 480px; height: 425px;" fitcolumns="true" rownumbers="true" pagination="false" singleselect="true" autorowheight="false">
                        <thead>
                            <tr>
                                @*<th data-options="field:'Selected',checkbox:true"></th>*@
                                <th field="Code" width="200"> Code</th>
                                <th field="Name" width="150">Employee Name</th>
                                <th field="DepartmentName" width="100">Department</th>
                                <th field="DesignationName" width="100">Designation</th>
                            </tr>
                        </thead>
                    </table>
                    <table style="width: 485px; font-size: 12px; font-weight: bold;">
                        <tr>
                            <td style="text-align: left">
                                <input id="chkRange" type="checkbox" />Range
                                <label id="lblRange1">
                                    <input id="txtFrom" type="text" style="width:40px" />&nbsp; To &nbsp;
                                </label>
                                <label id="lblRange2">
                                    <input id="txtTo" type="text" style="width:40px" />
                                </label>
                                <label id="lblcount"></label>
                            </td>
                            <td style="text-align: right">
                                <a href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-ok" plain="true" onclick="Next()">Next</a>
                                <a id="btnEmployeePickerOk" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-ok" plain="true">Ok</a>
                                <a id="btnEmployeePickerClose" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-cancel" plain="true">Close</a>
                            </td>
                        </tr>
                        <tr>
                            <td style="text-align: left"></td>
                            <td style="text-align: right"></td>
                        </tr>
                    </table>
                </div>
            </div>
        </div>

        <div id="winLocationPicker" class="easyui-window winstyle" title="Location Picker" style="width:350px; height:400px" data-options="modal:true,closed:true,collapsible:false,minimizable:false,maximizable:false,closable:false">
            <div style="font-family:Tahoma">
                <div class="easyui-panel" style="width:335px;height:300px;overflow:auto">
                    <ul id="locationtree" data-options="checkbox:false" singleselect="true"></ul>
                </div>

                <fieldset>
                    <legend style="font-weight:bold"> Action : </legend>
                    <table border="0" cellspacing="2" cellpadding="2" style="font-size:11px; font-weight:bold">
                        <tr>
                            <td style="width:400px; text-align:right"></td>

                            <td style="width:50px">
                                <a id="btnLocationPickerOk" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-ok" plain="true" onclick="OkButtonClick()">Ok</a>
                            </td>
                            <td style="width:50px">
                                <a id="btnLocationPickerClose" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-cancel" plain="true">Close</a>
                            </td>
                        </tr>
                    </table>
                </fieldset>
            </div>
        </div>

        <div id="winDepartmentPicker" class="easyui-window winstyle" title="Location Picker" style="width:350px; height:400px" data-options="modal:true,closed:true,collapsible:false,minimizable:false,maximizable:false,closable:false">
            <div style="font-family:Tahoma">
                <div class="easyui-panel" style="width:335px;height:300px;overflow:auto">
                    <ul id="departmenttree" data-options="checkbox:false" singleselect="true"></ul>
                </div>

                <fieldset>
                    <legend style="font-weight:bold"> Action : </legend>
                    <table border="0" cellspacing="2" cellpadding="2" style="font-size:11px; font-weight:bold">
                        <tr>
                            <td style="width:400px; text-align:right"></td>

                            <td style="width:50px">
                                <a id="btnDepartmentPickerOk" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-ok" plain="true" onclick="OkButtonClick()">Ok</a>
                            </td>
                            <td style="width:50px">
                                <a id="btnDepartmentPickerClose" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-cancel" plain="true">Close</a>
                            </td>
                        </tr>
                    </table>
                </fieldset>
            </div>
        </div>

        <div id="winShowAttendance" class="easyui-window winstyle" title="Attendance" style="width:25%;" data-options="modal:true,closed:true,collapsible:false,minimizable:false,maximizable:false,closable:false">
            <table id="tblShowAttendance" title="Attendance List" class="easyui-datagrid" style="width:100%;" fitcolumns="false" rownumbers="true" pagination="false" singleselect="true" autorowheight="false">
                <thead>
                    <tr>
                        <th field="AttendanceDateInString" width="120px;" align="left">Date</th>
                        <th field="AttStatusInST" width="160px;;" align="left">Description</th>
                    </tr>
                </thead>
            </table>
            <fieldset>
                <legend style="font-weight:bold"> Action : </legend>
                <table border="0" cellspacing="2" cellpadding="2" style="font-size:11px; font-weight:bold;width:100%;">
                    <tr>
                        <td style="width:60%; text-align:right"></td>
                        <td style="width:40%;text-align:right;">
                            <a id="btnShowAttendanceClose" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-cancel" plain="true">Close</a>
                        </td>
                    </tr>
                </table>
            </fieldset>
        </div>

        <div id="winLeaveLedger" class="easyui-window winstyle" title="Leave Ledger" style="width:28%;" data-options="modal:true,closed:true,collapsible:false,minimizable:false,maximizable:false,closable:false">
            <table id="tblLeaveLedger" title="Leave Ledger" class="easyui-datagrid" style="width:100%; height:250px;" fitcolumns="false" rownumbers="true" pagination="false" singleselect="true" autorowheight="false">
                <thead>
                    <tr>
                        <th field="LeaveShortName" width="115px;" align="left">Leave Head</th>
                        <th field="TotalLeave" width="65px;" align="right">Total</th>
                        <th field="Enjoyed" width="70px;" align="right">Enjoyed</th>
                        <th field="Balance" width="70px;" align="right">Balance</th>
                    </tr>
                </thead>
            </table>
            <fieldset>
                <legend style="font-weight:bold"> Action : </legend>
                <table border="0" cellspacing="2" cellpadding="2" style="font-size:11px; font-weight:bold;width:100%;">
                    <tr>
                        <td style="width:60%; text-align:right"></td>
                        <td style="width:40%;text-align:right;">
                            <a id="btnLeaveLedgerClose" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-cancel" plain="true">Close</a>
                        </td>
                    </tr>
                </table>
            </fieldset>
        </div>

        <div id="winELProcess" class="easyui-window winstyle" title="EL Process" style="width:300px;" data-options="modal:true,closed:true,collapsible:false,minimizable:false,maximizable:false,closable:false">
            <fieldset>
                Date :
                <input id="dtLastProcessDate" type="text" style="width: 220px" class="easyui-datebox" data-options="formatter:icsdateformat,parser:icsdateparser" />
            </fieldset>
            <fieldset>
                <div style="width:100%; padding-top:5px; text-align: right">
                    <a id="btnCloseELeaveProcess" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-cancel" plain="true">Close</a>
                    <a id="btnELeaveProcess" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-ok" plain="true">Process</a>
                </div>
            </fieldset>
        </div>

    </div>
    <style type="text/css">
        /* leave Application */
        #winLeaveApplication {
            width: 600px;
            font-size: 11px;
        }

        .tdApp {
            padding-bottom: 5px;
        }

            .tdApp .divLabel {
                float: left;
                width: 25%;
                text-align: right;
                margin-right: 1%;
                font-size: 11px;
            }

        .divInput input {
            float: left;
            width: 68%;
            font-size: 11px;
        }

        .divInput select {
            float: left;
            width: 69%;
            font-size: 11px;
        }

        .divInput .txtfield-picker {
            margin-top: 1px;
            width: 61%;
            text-align: left;
            font-size: 11px;
        }

        .divInput .pick-btn-LeaveApp {
            width: 20px;
            text-align: center;
            font-size: 11px;
        }

        .divInput-rd input {
            float: left;
            width: 5%;
            font-size: 11px;
        }

        .divInput-rd label {
            float: left;
            padding-right: 5%;
            font-size: 11px;
            margin-top: 0px;
        }

        .lblAlign {
            padding-left: 5px;
            text-align: left;
        }

        #dtStartDate, #dtEndDate {
            width: 129px;
        }

        .clsReportingPerson select, .clsReportingPerson input {
            float: left;
            width: 32%;
            font-size: 11px;
        }
        /*Leave Application Adv Search*/
        #dtStartDateLAPicker, #dtEndDateLAPicker {
            width: 125px;
        }
        /* Employee Search */
        .tbl-AdvSearch {
            width: 100%;
            font-size: 11px;
            font-weight: bold;
            text-align: left;
            margin-left: 3px;
        }

        .td-AdvSearch-Level {
            text-align: right;
        }

        .td-AdvSearch-Input {
            text-align: left;
        }

        .txtfield-search {
            width: 305px;
            text-align: left;
            font-size: 11px;
        }

        .txtfield-picker {
            width: 259px;
            text-align: left;
            font-size: 11px;
        }

        .selection-search {
            width: 310px;
            text-align: left;
            font-size: 11px;
        }

        .pick-btn {
            width: 20px;
            text-align: center;
            font-size: 11px;
        }
    </style>
    <script type="text/javascript">
    var _sBaseAddress="";
    var _oLeaveApplications=[];
    var _oLeaveApplication=null;
    var _oLeaveHeads=[];
    var _oApplicationTypes=[];
    var _oLeaveStatuss=[];
    var _oLeaveTypes=[];
    var _oEmployeeLeaveLedgers=[];

    var _IsLeaveAppEmp=false;
    var _IsLeavAppDept=false;
    var _nDeptID=0;

    var _oEmployee={EmployeeID:0};
    var _nLastEmployeeID = 0;
    var _sEmployeeIDs = "";
    var _bNext = false;
    var _nLoadRecords = 0;
    var _nRowLength = 0;

    var _oEmployeeTypes=[];
    var _oShifts=[];
    var _oEmployeeCSs=[];
    var _oEmployeeWSs=[];

    var _sAttendanceSchemeID="";
    var _sLocationID = "";
    var _sDepartmentID = "";
    var _sDesignationID = "";
    var _oERPs=[];
    var _nApprovalEmpID=0;
    var _nResponsiblePersonID=0;

    var _nEmployee_Search_EmpID=0;

    var _bNext_LeaveSearch = false;
    var _nLoadRecords_LeaveSearch = 0;
    var _nRowLength_LeaveSearch = 0;
    var _nLastLeaveID=0
    var _nEmpID=0;

    $(document).ready(function ()
    {
        _sBaseAddress =@Html.Raw( new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(HttpContext.Current.Session[SessionInfo.BaseAddress]));
        _oLeaveApplications =@Html.Raw( new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(Model));

        _oERPs = @Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(@ViewBag.ERPs));
        _oLeaveHeads = @Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(@ViewBag.LeaveHeads));
        _oApplicationTypes = @Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(@ViewBag.ApplicationTypes));
        _oLeaveStatuss = @Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(@ViewBag.LeaveStatuss));
        _oLeaveTypes= @Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(@ViewBag.LeaveTypes));

        _oEmployeeTypes= @Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(@ViewBag.EmployeeTypes));
        _oShifts= @Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(@ViewBag.Shifts));
        _oEmployeeCSs= @Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(@ViewBag.EmployeeCSs));
        _oEmployeeWSs= @Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(@ViewBag.EmployeeWSs));

        
        
        
        _nEmpID=@Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(TempData["Emp"]));

        
        $("#btnLeaveAdjustment").hide();
        DynamicRefreshList(_oLeaveApplications,'tblLeaveApplication');
        $("#cboLeaveTypeLAPicker").icsLoadCombo({
            List: _oLeaveTypes,
            OptionValue: "Value",
            DisplayText: "Text",
            //InitialValue: ""
        });

        var  oLeaveTypeList=[];
        for(var i=0; i<_oLeaveTypes.length;i++)
        {
            if(_oLeaveTypes[i].Value!=0)
            {
                oLeaveTypeList.push(_oLeaveTypes[i]);
            }
        }

        $("#cboLeaveType").icsLoadCombo({
            List: oLeaveTypeList,
            OptionValue: "Value",
            DisplayText: "Text",
            InitialValue: ""
        });

        $("#cboRequestToApproval").icsLoadCombo({
            List: _oERPs,
            OptionValue: "RPID",
            DisplayText: "ReportingPersonName",
            InitialValue: "----Select Approval Person----"
        });

        InitializeLeaveAppAdvSearch();
        InitializeEmployeeAdvSearch();

        $('#dtStartDate_Search').datebox({disabled:true});
        $('#dtEndDate_Search').datebox({disabled:true});
        $('#dtStartDate_Search').datebox('setValue',icsdateformat(new Date()));
        $('#dtEndDate_Search').datebox('setValue',icsdateformat(new Date()));

        //$("#btnELProcess").hide();
    });

    $("#chkIsDate").click(function () {
        if($("#chkIsDate").is(':checked'))
        {
            $('#dtStartDate_Search').datebox({disabled:false});
            $('#dtEndDate_Search').datebox({disabled:false});
            $('#dtStartDate_Search').datebox('setValue',icsdateformat(new Date()));
            $('#dtEndDate_Search').datebox('setValue',icsdateformat(new Date()));
        }
        else
        {
            $('#dtStartDate_Search').datebox({disabled:true});
            $('#dtEndDate_Search').datebox({disabled:true});
            $('#dtStartDate_Search').datebox('setValue',icsdateformat(new Date()));
            $('#dtEndDate_Search').datebox('setValue',icsdateformat(new Date()));
        }
    });

    $(document).keydown(function (e) { if (e.keyCode == 27) { $('div').icsWindow('close'); } });

    $('#tblLeaveApplication').datagrid({ onSelect: function (rowIndex, rowData) { OperationPerformsLeaveApplication(rowIndex, rowData); } });

    //function OperationPerformsLeaveApplication(rowIndex, rowData) {
    //    if (rowData != null && rowData.LeaveApplicationID > 0) {
    //        if (rowData.RecommendedBy>0 && rowData.ApproveBy<=0) {
    //            $('#btnCancel,#btnSaveLeaveApplication,#btnLeaveAdjustment').hide();
    //            $('#btnApprove').show();
    //            //if (_sBaseAddress='digicon')
    //            //{
    //            $('#btnApprove').hide();
    //                if (_nEmpID==rowData.RequestForAproval)
    //                {
    //                    $('#btnApprove').show();
    //                }
    //            //}else {
    //            //    $('#btnApprove').show();
    //            //}


    //        }
    //        else if (rowData.ApproveBy>0 && rowData.CancelledBy<=0) {
    //            $('#btnApprove,#btnSaveLeaveApplication').hide();
    //            $('#btnCancel').show();
    //            $("#btnLeaveAdjustment").show();
    //        }
    //        else if (rowData.CancelledBy>0) {
    //            $('#btnApprove,#btnCancel,#btnSaveLeaveApplication,#btnLeaveAdjustment').hide();
    //        }
    //        else {
    //            $('#btnCancel').hide();
    //            $('#btnApprove,#btnSaveLeaveApplication,#btnLeaveAdjustment').show();
    //        }
    //    }
    //}

    $('#btnView').click(function (e) {
        var oLeaveApplication = $("#tblLeaveApplication").datagrid("getSelected");
        if (oLeaveApplication == null || oLeaveApplication.LeaveApplicationID <= 0) { alert("Please select an item from list!"); return; }
        ResetControllLeaveApp();
        LayoutControllLeaveApp("btnView");
        GetLeaveAppInfo(oLeaveApplication,'Leave Info');
        $(".tdRecommendation").show();
        $(".tdRecommendationNote").hide();
        _oEmployee.EmployeeID=oLeaveApplication.EmployeeID;
    });

    $('#btnApprove').click(function (e) {

        var oLeaveApplication = $("#tblLeaveApplication").datagrid("getSelected");
        if (oLeaveApplication == null || oLeaveApplication.LeaveApplicationID <= 0) { alert("Please select an item from list!"); return; }
        if(oLeaveApplication.RequestForRecommendation>0 && oLeaveApplication.RecommendedBy<=0){ alert('Firstly you have to recommend.'); return; }
        else if(oLeaveApplication.CancelledBy>0) { alert('Already Canceled.'); return; }
        //else if (oLeaveApplication.ApproveBy>0) { alert('Already approved.'); return; }

        ResetControllLeaveApp();
        LayoutControllLeaveApp("btnApprove");
        GetLeaveAppInfo(oLeaveApplication,'Appro');
    });

    $('#btnCancel').click(function (e) {

        var oLeaveApplication = $("#tblLeaveApplication").datagrid("getSelected");
        if (oLeaveApplication == null || oLeaveApplication.LeaveApplicationID <= 0) { alert("Please select an item from list!"); return; }

        if (oLeaveApplication.ApproveBy<=0) { alert('You need to approve first for cancel.'); return; }
        else if(oLeaveApplication.CancelledBy>0) { alert('Already Canceled.'); return; }
        ResetControllLeaveApp();
        LayoutControllLeaveApp("btnCancel");
        GetLeaveAppInfo(oLeaveApplication,'Cancel');
    });


    function EmployeeLeaveLedger(oEmployeeLeaveLedgers){

        if(!_IsLeaveAppEmp){
            _oEmployeeLeaveLedgers=oEmployeeLeaveLedgers;
            $("#cboLeaveLedger").icsLoadCombo({
                List: _oEmployeeLeaveLedgers,
                OptionValue: "EmpLeaveLedgerID",
                DisplayText: "LeaveNameWithBalance"
            });
        }
        else{
            $("#cboLeaveLAPicker").icsLoadCombo({
                List: oEmployeeLeaveLedgers,
                OptionValue: "EmpLeaveLedgerID",
                DisplayText: "LeaveName"
            });
        }

    }

    function LayoutControllLeaveApp(buttonId) {
        $('#txtRequestToApproval').css({"width":"68%"});
        $("#cboRequestToApproval").hide();
        if (buttonId === "btnView" || buttonId === "btnApprove" || buttonId === "btnCancel" || buttonId === "btnLeaveAdjustment") {
            $("#winLeaveApplication input").prop("disabled", true);
            $("#winLeaveApplication select").prop("disabled", true);
            $("#btnSaveLeaveApplication, #btnRecommendLeaveApplication, #btnApproveLeaveApplication, #btnCancelLeaveApplication,#btnLeaveAdjustmentSave").hide();
            $(".tdRecommendation,.tdApproval,.tdCancel").hide();
            $('.clsReportingPerson select,.clsReportingPerson span').hide();

            if(buttonId === "btnView"){
                var oLeaveApplication = $("#tblLeaveApplication").datagrid("getSelected");
                if(oLeaveApplication.RecommendedBy>0){ $(".tdRecommendation").show(); }
                if (oLeaveApplication.ApproveBy>0) { $(".tdApproval").show(); }
                if(oLeaveApplication.CancelledBy>0) { $(".tdCancel").show(); }
            }

            else if(buttonId === "btnApprove"){
                $(".tdRecommendation,.tdApproval").show();
                $("#txtApprovalNote").prop("disabled",false);
                $("#btnApproveLeaveApplication").show();
            }
            else if(buttonId === "btnCancel"){
                $(".tdRecommendation,.tdApproval,.tdCancel").show();
                $("#txtCancelNote").prop("disabled",false);
                $("#btnCancelLeaveApplication").show();
            }
            else if(buttonId === "btnLeaveAdjustment"){
                $("#dtEndDate").datebox({disabled: false});
                $("#btnGetAttendance").prop("disabled",false);
                $("#btnLeaveAdjustmentSave").show();
            }
        }
        else {
            $("#winLeaveApplication input").prop("disabled", false);
            $("#txtEmployee,#btnEmployeePicker,#btnResetEmployeePicker").prop("disabled",(buttonId === "btnNew")?false:true);
            $("#winLeaveApplication select").prop("disabled", false);
            $("#btnSaveLeaveApplication").show();
            $(".tdRecommendation,.tdApproval,.tdCancel").hide();
            $("#btnRecommendLeaveApplication, #btnApproveLeaveApplication, #btnCancelLeaveApplication,#btnLeaveAdjustmentSave").hide();
            $("#rdbtnPaid").prop("disabled", true);
            $("#rdbtnUnPaid").prop("disabled", true);
            $("#txtDurationInHour").prop("disabled", true);

        }
        $(".disabled input").prop("disabled", true);
    }

    function GetLeaveAppInfo(oLeaveApplication,sTitle){
        var obj =
        {
            BaseAddress: _sBaseAddress,
            Object: oLeaveApplication,
            ControllerName: "LeaveApplication",
            ActionName: "GetLeaveApp",
            IsWinClose: false
        };

        $.icsDataGet(obj, function (response) {

            if (response.status && response.obj != null) {
                if (response.obj.LeaveApplicationID > 0) {
                    EmployeeLeaveLedger(response.obj.EmployeeLeaveLedgers);
                    RefreshControlLeaveApp(response.obj);
                    $("#winLeaveApplication").icsWindow('open', sTitle);
                }
                else { response.obj.ErrorMessage; }
            }
        });
    }

    function ResetControllLeaveApp() {

        var oDate=new Date();
        var sDate=(oDate.getMonth()+1)+'/'+oDate.getDate()+'/'+oDate.getFullYear()+' '+oDate.getHours()+':'+oDate.getMinutes();
        _oLeaveApplication = null;
        _oEmployee={EmployeeID:0};
        $(".resetfield").val("");
        $(".resetlbl").html("");
        $("#txtDurationInHour").val("");
        $("#txtExpenseLocation").val('N/A');
        $("#txtReason").val('N/A');

        //$("#rdbtnLeaveOfApplication,#rdbtnLeaveOfAbsence").prop("checked", false);
        //$("#rdbtnLeaveOfApplication").prop("checked", true);
        $("#cboLeaveLedger").empty();
        $("#cboLeaveType").val(0);
        $('#dtStartDate, #dtEndDate').datebox("setValue", sDate);
        $("#rdbtnPaid,#rdbtnUnPaid").prop("checked", false);
        $("#rdbtnPaid").prop("checked", true);
    }

    function RefreshControlLeaveApp(oLeaveApplication) {
        _oLeaveApplication = oLeaveApplication;

        $("#txtEmployee").val(_oLeaveApplication.EmployeeName);
        //if(_oLeaveApplication.ApplicationNatureInt == 1){ $("#rdbtnLeaveOfApplication").prop("checked", true); }
        //else if(_oLeaveApplication.ApplicationNatureInt == 2){ $("#rdbtnLeaveOfAbsence").prop("checked", true);  }
        $('#dtStartDate').datebox("setValue", _oLeaveApplication.StartDateTimeInString);
        $('#dtEndDate').datebox("setValue", _oLeaveApplication.EndDateTimeInString);
        $('#cboLeaveLedger').val(_oLeaveApplication.EmpLeaveLedgerID);
        $('#cboLeaveType').val(_oLeaveApplication.LeaveTypeInt);
        $("#txtExpenseLocation").val(_oLeaveApplication.Location);
        $("#txtReason").val(_oLeaveApplication.Reason);
        $("#txtResponsiblePerson").val(_oLeaveApplication.ResponsiblePersonName);
        _nResponsiblePersonID=_oLeaveApplication.ResponsiblePersonID;

        if(_oLeaveApplication.IsUnPaid){ $("#rdbtnUnPaid").prop("checked", true);}
        else{ $("#rdbtnPaid").prop("checked", true);}

        if(_oLeaveApplication.RecommendedBy)
        {
            $(".tdRecommendation").show(); $("#txtRecommendationNote").val(_oLeaveApplication.RecommendationNote);
            //$('#txtRequestToApproval').val(_oLeaveApplication.RequestForAprovalName);
            //_nApprovalEmpID=_oLeaveApplication.RequestForAproval;
        }
        if(_oLeaveApplication.ApproveBy){ $(".tdApproval").show(); $("#txtApprovalNote").val(_oLeaveApplication.ApprovalNote);}
        if(_oLeaveApplication.CancelledBy){ $(".tdCancel").show(); $("#txtCancelNote").val(_oLeaveApplication.CancelledNote);}

        //$("#lblApplicationStatus").html("<b></b>");
        if(_oLeaveApplication.LeaveType==2 || _oLeaveApplication.LeaveType==3)
        {
            $("#txtDurationInHour").prop("disabled", false);
            $("#spEndDate").hide();
        }
        $('#txtDurationInHour').val(_oLeaveApplication.LeaveDurationInHour);
        if(_oLeaveApplication.RequestForAproval>0){$("#txtRequestToApproval").val(_oLeaveApplication.RequestForAprovalName);_nApprovalEmpID=_oLeaveApplication.RequestForAproval;}
    }

    function RefreshObjectLeaveApp() {
        var nRequestForAproval=0;
        if((_oLeaveApplication != null && _oLeaveApplication.LeaveApplicationID>0 ) || _nApprovalEmpID>0){
            nRequestForAproval=_nApprovalEmpID;
        }
        else{
            nRequestForAproval=$('#cboRequestToApproval').val();
        }
        var nLeaveType=$('#cboLeaveType').val();
        var nDurationInHour=0;
        var sStartDateTime= $('#dtStartDate').datebox('getValue');
        var sEndDateTime= $('#dtEndDate').datebox('getValue');

        if(nLeaveType==2 || nLeaveType==3)
        {
            nDurationInHour=$("#txtDurationInHour").val();
            nDurationInHour=nDurationInHour*60;
            sEndDateTime=sStartDateTime;
        }

        var oLeaveApplication = {
            LeaveApplicationID: (_oLeaveApplication != null) ? _oLeaveApplication.LeaveApplicationID : 0,
            EmployeeID: (_oLeaveApplication != null) ? _oLeaveApplication.EmployeeID : _oEmployee.EmployeeID,
            EmpLeaveLedgerID: $('#cboLeaveLedger').val(),
            ApplicationNatureInt: 1 /*(($("#rdbtnLeaveOfApplication").is(":checked"))? 1 : 2)*/,
            LeaveTypeInt: nLeaveType,
            StartDateTime: sStartDateTime,
            EndDateTime: sEndDateTime,
            Location: $("#txtExpenseLocation").val(),
            Reason: $("#txtReason").val(),
            RequestForRecommendation: (_oLeaveApplication != null && _oLeaveApplication.LeaveApplicationID>0) ? _oLeaveApplication.RequestForRecommendation : ((_oERPs.length>0)?_oERPs[0].RPID:0),
            RecommendedBy: (_oLeaveApplication != null) ? _oLeaveApplication.RecommendedBy : 0,
            RecommendedByDate: (_oLeaveApplication != null) ? _oLeaveApplication.RecommendedByDate : icsdateformat(new Date()),
            ApproveBy: (_oLeaveApplication != null) ? _oLeaveApplication.ApproveBy : 0,
            ApproveByDate: (_oLeaveApplication != null) ? _oLeaveApplication.ApproveByDate : icsdateformat(new Date()),
            IsUnPaid: (($("#rdbtnUnPaid").is(":checked"))? true : false),
            RecommendationNote: (_oLeaveApplication != null && _oLeaveApplication.RecommendedBy>0) ? _oLeaveApplication.RecommendationNote : $.trim($("#txtRecommendationNote").val()),
            ApprovalNote: (_oLeaveApplication != null && _oLeaveApplication.ApproveBy>0) ? _oLeaveApplication.ApprovalNote :  $.trim($("#txtApprovalNote").val()),
            LeaveStatusInt: (_oLeaveApplication != null) ? _oLeaveApplication.LeaveStatusInt : 1,
            CancelledBy : (_oLeaveApplication != null && _oLeaveApplication.CancelledBy>0) ? _oLeaveApplication.CancelledBy : 0,
            CancelledNote : (_oLeaveApplication != null && _oLeaveApplication.CancelledBy>0) ? _oLeaveApplication.CancelledNote :  $.trim($("#txtCancelNote").val()),
            RequestForAproval: nRequestForAproval,
            ResponsiblePersonID:_nResponsiblePersonID,
            LeaveDuration:nDurationInHour

        };
        return oLeaveApplication;
    }

    function ValidationLeaveApp(){

        var sCurrentDate=icsdateformat(new Date());
        var sStartDate=icsdateformat(new Date($('#dtStartDate').datebox('getValue')));
        var sEndDate= icsdateformat(new Date($('#dtEndDate').datebox('getValue')));
        debugger;

        if(_oLeaveApplication == null && ( _oEmployee==null || _oEmployee.EmployeeID<=0)){
            alert("Please enter employee.");
            $("#txtEmployee").addClass("errorFieldBorder");
            $("#txtEmployee").focus();
            return false;
        }
        else {
            $("#txtEmployee").removeClass("errorFieldBorder");
        }

        //if (!$("#rdbtnLeaveOfApplication").is(":checked") && !$("#rdbtnLeaveOfAbsence").is(":checked")) {
        //    alert("Please select application type.");
        //    return false;
        //}

        //if($("#rdbtnLeaveOfApplication").is(":checked")){
        //    if(new Date($('#dtEndDate').datebox('getValue')) < new Date($('#dtStartDate').datebox('getValue'))) { alert("End Date must be later than Start Date in case of Leave Application."); return false; }
        //}

        //if($("#rdbtnLeaveOfAbsence").is(":checked")){
        //    if(new Date(sStartDate) == new Date(sCurrentDate))  { alert("Current Date Not Allowed For Start Date!"); return false; }
        //    else if(new Date(sEndDate) == new Date(sCurrentDate)) { alert("Current Date Not Allowed for End Date in past in case of Leave of Absence.!"); return false; }
        //    //else if(new Date(sStartDate) > new Date(sCurrentDate)) { alert("Start Date have to be in past in case of Leave of Absence."); return false; }
        //    //else if(new Date(sEndDate) > new Date(sCurrentDate)) { alert("End Date have to be in past in case of Leave of Absence."); return false; }
        //    else if(new Date($('#dtEndDate').datebox('getValue')) < new Date($('#dtStartDate').datebox('getValue'))) { alert("End Date must be later than Start Date in case of Leave of Absence."); return false; }
        //}

        if ($("#cboLeaveLedger").val() == 0) {
            alert("Please select a leave.");
            $("#cboLeaveLedger").addClass("errorFieldBorder");
            $("#cboLeaveLedger").focus();
            return false;
        } else {
            $("#cboLeaveLedger").removeClass("errorFieldBorder");
        }

        if ($("#cboLeaveType").val() == 0) {
            alert("Please select a leave type.");
            $("#cboLeaveType").addClass("errorFieldBorder");
            $("#cboLeaveType").focus();
            return false;
        } else {
            if ($("#cboLeaveType").val() == 2 || $("#cboLeaveType").val() == 3)
            {
                var nDurationInHour=$("#txtDurationInHour").val();
                if(nDurationInHour<=0)
                {
                    alert("Please enter leave duration in hour.");
                    $("#txtDurationInHour").addClass("errorFieldBorder");
                    $("#txtDurationInHour").focus();
                    return false;
                }
            }
            $("#cboLeaveType").removeClass("errorFieldBorder");
        }


        //if(_oEmployeeLeaveLedgers.length>0){

        //    var nDays=((new Date(sEndDate)).getTime() - (new Date(sStartDate)).getTime())/(1000*3600*24);

        //    var nHour= ((new Date($('#dtEndDate').datebox('getValue'))).getTime() - (new Date($('#dtStartDate').datebox('getValue'))).getTime())/(1000*3600);

        //    for(var i=0; i<_oEmployeeLeaveLedgers.length;i++){
        //        if(_oEmployeeLeaveLedgers[i].EmpLeaveLedgerID==$("#cboLeaveLedger").val()){
        //            var nFullLeave= parseInt(_oEmployeeLeaveLedgers[i].LeaveBalance);
        //            var nHalfLeave= (_oEmployeeLeaveLedgers[i].HalfLeaveInStr!="")? parseInt(_oEmployeeLeaveLedgers[i].HalfLeaveInStr.substring(2,3)):0;
        //            var nShortLeave= (_oEmployeeLeaveLedgers[i].ShortLeaveInStr!="")? parseInt(_oEmployeeLeaveLedgers[i].ShortLeaveInStr.substring(2,3)):0;

        //            if($("#cboLeaveType").val()==1){

        //                if(nFullLeave<=0){
        //                    if(nHalfLeave>0){
        //                        alert("No full leave remaining. You can take a half leave.");
        //                    }
        //                    else if(nHalfLeave<=0 && nShortLeave>0){
        //                        alert("No full & half leave remaining. You can take a short leave.");
        //                    }
        //                    else{
        //                        alert("No leave remaining.");
        //                    }
        //                    return false;
        //                }
        //                else if(nDays>nFullLeave){
        //                    var sText= (nFullLeave>1) ? "leaves" : "leave";
        //                    alert("You can enjoy max "+ nFullLeave +" "+sText);
        //                    return false;
        //                }
        //                //else if(nHour<8){
        //                //    alert("For a full leave min 8 hours required."); return false;
        //                //}
        //            }
        //            else if($("#cboLeaveType").val()==2){
        //                if(nFullLeave<=0 && nHalfLeave<=0){
        //                    if(nShortLeave>0){
        //                        alert("No full & half leave remaining. You can take a half leave.");
        //                    }
        //                    else{
        //                        alert("No leave remaining");
        //                    }
        //                    return false;
        //                }
        //                else if(nHour<=3){
        //                    alert("For a half leave min 3 hours plus required."); return false;
        //                }
        //                else if(nHour>=8){
        //                    alert("Leave duration does'not exceed 8 hours for a half leave."); return false;
        //                }
        //            }
        //            else if($("#cboLeaveType").val()==3){
        //                if(nFullLeave<=0 && nHalfLeave<=0 && nShortLeave<=0){
        //                    alert("No leave remaining");
        //                    return false;
        //                }
        //                else if(nHour>3){
        //                    alert("Leave duration does'not exceed 3 hours for a short leave."); return false;
        //                }
        //                else if(nHour<=0){
        //                    alert("No time duration found for a short leave."); return false;
        //                }
        //            }

        //        }
        //    }

        //}


        //if ($("#cboLeaveType").val() == 2 || $("#cboLeaveType").val() == 3) {
        //    if((sStartDate != sEndDate) || (new Date($('#dtEndDate').datebox('getValue')) < new Date($('#dtStartDate').datebox('getValue')))) { alert("Start Date and End Date have to be same for Half or Short Leave."); return false; }
        //}

        if ($.trim($("#txtExpenseLocation").val()).length == 0) {
            alert("Please enter leave expense location.");
            $("#txtExpenseLocation").addClass("errorFieldBorder");
            $("#txtExpenseLocation").focus();
            return false;
        } else {
            $("#txtExpenseLocation").removeClass("errorFieldBorder");
        }

        if ($.trim($("#txtReason").val()).length == 0) {
            alert("Please enter leave reason.");
            $("#txtReason").addClass("errorFieldBorder");
            $("#txtReason").focus();
            return false;
        } else {
            $("#txtReason").removeClass("errorFieldBorder");
        }

        return true;
    }

    function LeaveApplicationOperation(oLeaveApplication,sActionName,sMessage){

        var obj = {
            BaseAddress: _sBaseAddress,
            Object: oLeaveApplication,
            ObjectId: oLeaveApplication.LeaveApplicationID,
            ControllerName: "LeaveApplication",
            ActionName: sActionName,
            TableId: "tblLeaveApplication",
            IsWinClose: false,
            Message: sMessage
        };
        $.icsSave(obj, function (response) {
            if (response.status && response.obj != null) {
                if (response.obj.LeaveApplicationID > 0) {
                    //if(response.obj.ApproveBy>0 && response.obj.CancelledBy<=0){
                    //    $('#btnApprove').hide();
                    //}
                //else 
                    if(response.obj.CancelledBy>0){
                        $('#btnApprove,#btnCancel').hide();
                    }
                    _oLeaveApplication=null;
                    _oEmployee={EmployeeID:0};
                    if(sActionName!="LeaveApplication_Insert")
                    {$('#winLeaveApplication').icsWindow('close');}
                    if(sActionName=="LeaveApplication_Insert")
                    {ResetControllLeaveApp();}
                }
            }
        });
    }

    $("#btnSaveLeaveApplication").click(function () {
        if (!ValidationLeaveApp()) return;
        var oLeaveApplication = RefreshObjectLeaveApp();
        var sActionName=(oLeaveApplication.LeaveApplicationID>0) ? "LeaveApplication_Update": "LeaveApplication_Insert";
        var sMessage=(oLeaveApplication.LeaveApplicationID>0)?"Update Successfully." : "Save Successfully.";
        LeaveApplicationOperation(oLeaveApplication,sActionName,sMessage);

        $("#txtEmployee").focus();
    });

    $("#btnRecommendLeaveApplication").click(function () {
        if (!ValidationLeaveApp()) return;
        var oLeaveApplication = RefreshObjectLeaveApp();
        var sActionName="LeaveApplication_Recommend";
        var sMessage= "Recommend Successfully.";
        LeaveApplicationOperation(oLeaveApplication,sActionName,sMessage);
    });

    $("#btnApproveLeaveApplication").click(function () {
        if (!ValidationLeaveApp()) return;
        var oLeaveApplication = RefreshObjectLeaveApp();
        oLeaveApplication.IsHRApproval= true;
        var sActionName="LeaveApplication_Approved";
        var sMessage= "Leave Approved Successfully.";
        LeaveApplicationOperation(oLeaveApplication,sActionName,sMessage);
    });

    $("#btnCancelLeaveApplication").click(function () {
        if (!ValidationLeaveApp()) return;
        var oLeaveApplication = RefreshObjectLeaveApp();
        var sActionName="LeaveApplication_Cancel";
        var sMessage= "Leave Cancel Successfully.";
        LeaveApplicationOperation(oLeaveApplication,sActionName,sMessage);
    });

    $("#btnCloseLeaveApplication").click(function () {
        ResetControllLeaveApp();
        $("#winLeaveApplication").icsWindow('close');
    });

    var bSaveShow = true;
    var nLeaveID_ADj=0;
    var SelectedRowIndex_ADj=0;

    $("#btnLeaveAdjustment").click(function () {
        var oLeaveApplication = $("#tblLeaveApplication").datagrid("getSelected");
        if (oLeaveApplication == null || oLeaveApplication.LeaveApplicationID <= 0) { alert("Please select an item from list!"); return; }
        if (oLeaveApplication.ApproveBy<=0) { alert('This Item is not approved, you can edit or delete it.'); return; }
        ResetControllLeaveApp();
        LayoutControllLeaveApp("btnLeaveAdjustment");
        $(".tdRecommendation,.tdApproval").hide();
        GetLeaveAppInfo(oLeaveApplication,'Leave Adjustment');
        _oEmployee.EmployeeID=oLeaveApplication.EmployeeID;
        nLeaveID_ADj=oLeaveApplication.LeaveApplicationID;
        SelectedRowIndex_ADj = $('#tblLeaveApplication').datagrid('getRowIndex', oLeaveApplication);
        bSaveShow= false;
    });

    /*--------------------Employee Search By Name-----------*/


    $("#btnResetEmployeeLAPicker").click(function () {
        _IsLeaveAppEmp=false;
        $("#txtEmployeeNameLAPicker").val("");
        _oEmployee={EmployeeID:0};
    });


    $('#txtEmployee').keypress(function (e)
    {
        var code = (e.keyCode ? e.keyCode : e.which);
        if (code == 13)//Enter key-13
        {
            var sCodeName = $.trim($("#txtEmployee").val());
            if(sCodeName==''){alert("Please enter name or code to search."); return;}
            _IsLeaveAppEmp=false;
            SearchEmployeeByText(sCodeName,false,false, false);
        }
        else if(code == 8){
            _IsLeaveAppEmp=false;
            $("#txtEmployee").val("");
            _oEmployee={EmployeeID:0};
            ResetControllLeaveApp();
        }

    });

    $('#txtEmployeeNameLAPicker').keypress(function (e)
    {
        var code = (e.keyCode ? e.keyCode : e.which);
        if (code == 13)//Enter key-13
        {
            var sCodeName = $.trim($("#txtEmployeeNameLAPicker").val());
            if(sCodeName==''){alert("Please enter name or code to search."); return;}
            _IsLeaveAppEmp=true;
            SearchEmployeeByText(sCodeName,false,false, false);

        }
        else if(code == 8){
            _IsLeaveAppEmp=false;
            if(_oEmployee!=null && _oEmployee.EmployeeID>0){
                $("#txtDepartmentLAPicker").val("");
                _nDeptID=0;
            }
            $("#txtEmployeeNameLAPicker").val("");
            _oEmployee={EmployeeID:0};
            LoadLeave();
            $("#btnDepartmentPickerLAPicker,#btnResetDepartmentPickerLAPicker").prop("disabled", false);
        }
    });


    $('#txtResponsiblePerson').keypress(function (e)
    {
        var code = (e.keyCode ? e.keyCode : e.which);
        if (code == 13)//Enter key-13
        {
            var sCodeName = $.trim($("#txtResponsiblePerson").val());
            if(sCodeName==''){alert("Please enter name or code to search."); return;}
            SearchEmployeeByText(sCodeName,false,true, false);
        }
        else if(code == 8){
            $("#txtResponsiblePerson").val("");
            _nResponsiblePersonID=0;
        }
    });


    $('#cboRequestToApproval').change(function(e){
        $("#txtRequestToApproval").val("");
        _nApprovalEmpID=0;
    });
    $('#txtRequestToApproval').keypress(function (e)
    {
        var code = (e.keyCode ? e.keyCode : e.which);
        if (code == 13)//Enter key-13
        {
            _oEmployee={EmployeeID:0};
            var sCodeName = $.trim($("#txtRequestToApproval").val());
            if(sCodeName==''){alert("Please enter name or code to search."); return;}
            SearchEmployeeByText(sCodeName,true,false,false);

        }
        else if(code == 8){
            $("#txtRequestToApproval").val("");
            _nApprovalEmpID=0;
            $('#cboRequestToApproval').prop('disabled',false);
        }
    });


    function SearchEmployeeByText(sEmpNameCode,bIsApprovalEmployee,bIsEmployeeSearch,bIsEmployeeSearch_FromCollection){
        var oEmployee = { Params: sEmpNameCode +'~'+ 0};
        var obj = {
            BaseAddress: _sBaseAddress,
            Object: oEmployee,
            ControllerName: "Employee",
            ActionName: "GetsByEmpCode",
            IsWinClose: false
        };
        $.icsDataGets(obj, function (response) {

            if (response.status && response.objs.length > 0) {
                if (response.objs[0].EmployeeID > 0) {

                    var tblColums = [];var oColumn = { field: "Code", title: "Code", width: 70, align: "left" };tblColums.push(oColumn);
                    oColumn = { field: "Name", title: "Name", width: 120, align: "left" };tblColums.push(oColumn);
                    oColumn = { field: "DepartmentName", title: "Department", width: 100, align: "left" };tblColums.push(oColumn);
                    oColumn = { field: "DesignationName", title: "Designation", width: 100, align: "left" };tblColums.push(oColumn);
                    var oPickerParam = {
                        winid: 'winEmployeePickerTextSearch',
                        winclass:'clsEmployeePickerTextSearch',
                        winwidth: 455,
                        winheight: 460,
                        tableid: 'tblEmployeePickerTextSearch',
                        tablecolumns: tblColums,
                        datalist: response.objs,
                        multiplereturn: false,
                        searchingbyfieldName:'Name',
                        windowTittle: 'Employee list'
                    };

                    $.icsPicker(oPickerParam);
                    IntializeEmployeePickerTextSearch(oPickerParam, bIsApprovalEmployee,bIsEmployeeSearch,bIsEmployeeSearch_FromCollection);//multiplereturn, winclassName
                    $('#tblEmployeePickerTextSearch').datagrid('selectRow', 0);
                }
                else { alert(response.objs[0].ErrorMessage); }
            }
        });
    }

    function IntializeEmployeePickerTextSearch(oPickerobj, bIsApprovalEmployee,bIsEmployeeSearch,bIsEmployeeSearch_FromCollection)
    {

        $("#" + oPickerobj.winid).find("#btnOk").click(function () {

            var oreturnObj = $('#'+oPickerobj.tableid).datagrid('getSelected');
            if(oreturnObj == null || oreturnObj.EmployeeID<=0){  alert("please select an employee."); return false;}

            $("#"+oPickerobj.winid).icsWindow("close");
            $("#" + oPickerobj.winid).remove();
            if (oPickerobj.winid == 'winEmployeePickerTextSearch')
            {
                if(bIsEmployeeSearch){
                    _nResponsiblePersonID=oreturnObj.EmployeeID;
                    $('#txtResponsiblePerson').val(oreturnObj.NameCode);
                }
                else{
                    if(bIsApprovalEmployee)
                    {
                        if (oreturnObj != null && oreturnObj.EmployeeID > 0)
                        {
                            _nApprovalEmpID=oreturnObj.EmployeeID;
                            $('#txtRequestToApproval').val(oreturnObj.NameCode);
                            $('#cboRequestToApproval').val(0);
                            $('#cboRequestToApproval').prop('disabled',true);
                        }
                    }
                    else
                    {
                        if (oreturnObj != null && oreturnObj.EmployeeID > 0)
                        {
                            PickEmployee(oreturnObj);
                        }
                    }

                    if(bIsEmployeeSearch_FromCollection)
                    {
                        if (oreturnObj != null && oreturnObj.EmployeeID > 0)
                        {
                            _nEmployee_Search_EmpID=oreturnObj.EmployeeID;
                            $('#txtEmployee_Search').val(oreturnObj.NameCode);
                        }
                    }
                }

            }
        });

        $(document).find('.' +oPickerobj.winclass).keydown(function (e) {
            if (e.which == 13)//enter=13
            {
                var oreturnObj = $('#'+oPickerobj.tableid).datagrid('getSelected');
                if(oreturnObj == null || oreturnObj.EmployeeID<=0){  alert("please select an employee."); return false;}

                $("#"+oPickerobj.winid).icsWindow("close");
                $("#" + oPickerobj.winid).remove();

                if (oPickerobj.winclass == 'clsEmployeePickerTextSearch')
                {
                    if(bIsEmployeeSearch){
                        _nResponsiblePersonID=oreturnObj.EmployeeID;
                        $('#txtResponsiblePerson').val(oreturnObj.NameCode);
                        $("#txtResponsiblePerson").select.focus();
                    }
                    else
                    {
                        if(bIsApprovalEmployee)
                        {
                            if (oreturnObj != null && oreturnObj.EmployeeID > 0)
                            {
                                _nApprovalEmpID=oreturnObj.EmployeeID;
                                $('#txtRequestToApproval').val(oreturnObj.NameCode);
                                $('#cboRequestToApproval').val(0);
                                $('#cboRequestToApproval').prop('disabled',true);
                            }
                        }
                        else
                        {
                            if (oreturnObj != null && oreturnObj.EmployeeID > 0)
                            {
                                PickEmployee(oreturnObj);
                            }
                        }
                        if(bIsEmployeeSearch_FromCollection)
                        {
                            if (oreturnObj != null && oreturnObj.EmployeeID > 0)
                            {
                                _nEmployee_Search_EmpID=oreturnObj.EmployeeID;
                                $('#txtEmployee_Search').val(oreturnObj.NameCode);
                            }
                        }
                    }
                }
            }
        });
    }


    /*---------------- Employee Adv Search----------------*/

    function InitializeEmployeeAdvSearch(){
        $("#cboEmployeeType").icsLoadCombo({
            List: _oEmployeeTypes,
            OptionValue: "EmployeeTypeID",
            DisplayText: "Name"
        });
        $("#cboShift").icsLoadCombo({
            List: _oShifts,
            OptionValue: "ShiftID",
            DisplayText: "ShiftWithDuration"
        });
        $("#cboEmployeeCardStatus").icsLoadCombo({
            List: _oEmployeeCSs,
            OptionValue: "Value",
            DisplayText: "Text"
        });
        $("#cboEmployeeWorkigStatus").icsLoadCombo({
            List: _oEmployeeWSs,
            OptionValue: "Value",
            DisplayText: "Text"
        });

        $('#txtFrom,#txtTo').numberbox({min:0, precision:0 });
        $('#txtFrom').numberbox('setValue',1);
        $('#txtTo').numberbox('setValue',50);
        $("#lblRange1").hide();

        var oMonths=[{MonthID:0,Name:'Jan'},{MonthID:1,Name:'Feb'},{MonthID:2,Name:'Mar'},{MonthID:3,Name:'Apr'},
                     {MonthID:4,Name:'May'},{MonthID:5,Name:'Jun'},{MonthID:6,Name:'Jul'},{MonthID:7,Name:'Aug'},
                     {MonthID:8,Name:'Sep'},{MonthID:9,Name:'Oct'},{MonthID:10,Name:'Nov'},{MonthID:11,Name:'Dec'},];

        $("#cboMonthFrom,#cboMonthTo").icsLoadCombo({
            List: oMonths,
            OptionValue: "MonthID",
            DisplayText: "Name",
            InitialValue:''
        });

        LoadDaysInMonth();
    }

    function LoadDaysInMonth(){
        $("#cboMonthFrom,#cboMonthTo").val((new Date()).getMonth());
        var nDaysInMonth=(new Date((new Date()).getFullYear(), parseInt((new Date()).getMonth())+1,0)).getDate();

        var oDays=[];
        for(var i=1;i<=nDaysInMonth;i++){
            oDays.push({DayID:i,Day:i});
        }
        $("#cboDayFrom,#cboDayTo").icsLoadCombo({
            List: oDays,
            OptionValue: "DayID",
            DisplayText: "Day",
            InitialValue:''
        });
    }


    $("#cboDateType").change(function(e){
        if($("#cboDateType").val()==1){
            $("#regionDateTo").hide();
        }
        else{
            $("#regionDateTo").show();
        }
    });

    $("#cboMonthFrom").change(function(e){
        var nDaysInMonth=(new Date((new Date()).getFullYear(), parseInt($("#cboMonthFrom").val())+1,0)).getDate();
        var oDays=[];
        for(var i=1;i<=nDaysInMonth;i++){
            oDays.push({DayID:i,Day:i});
        }
        $("#cboDayFrom").icsLoadCombo({
            List: oDays,
            OptionValue: "DayID",
            DisplayText: "Day",
            InitialValue:''
        });
    });

    $("#cboMonthTo").change(function(e){
        var nDaysInMonth=(new Date((new Date()).getFullYear(), parseInt($("#cboMonthTo").val())+1,0)).getDate();
        var oDays=[];
        for(var i=1;i<=nDaysInMonth;i++){
            oDays.push({DayID:i,Day:i});
        }
        $("#cboDayTo").icsLoadCombo({
            List: oDays,
            OptionValue: "DayID",
            DisplayText: "Day",
            InitialValue:''
        });
    });

    function EmployeePickerReset(){
        _nLastEmployeeID = 0;
        _sEmployeeIDs = "";
        _bNext = false;
        _nLoadRecords = 0;
        _nRowLength = 0;
        _sAttendanceSchemeID="";
        _sLocationID = "";
        _sDepartmentID = "";
        _sDesignationID = "";
        $(".txtReset").val("");
        $(".cboReset").val(0);
        $(".chkReset").prop("checked",false);

        $("#cboMonthFrom,#cboMonthTo").val((new Date()).getMonth());
        LoadDaysInMonth();

        DynamicRefreshList([], "tblEmployeesForPicker");
        $("#lblcount").html("");
        $('#txtFrom,#txtTo').numberbox({min:0, precision:0 });
        $('#txtFrom').numberbox('setValue',1);
        $('#txtTo').numberbox('setValue',50);
        $("#lblRange1").hide();
    }

    $("#btnEmployeePicker").click(function () {
        _IsLeaveAppEmp=false;
        EmployeePickerReset();
        $("#winEmployeePicker").icsWindow("open", " Employee Picker");
    });

    $('#chkRange,#chkRange_Search').click(function()
    {
        if($("#chkRange").is(':checked'))
        {
            $("#lblRange1").show();
        }
        else
        {
            $("#lblRange1").hide();
        }
        if($("#chkRange_Search").is(':checked'))
        {
            $("#lblRange1_Search").show();
        }
        else
        {
            $("#lblRange1_Search").hide();
        }
    });

    $('#btnEmpPickerSearch').click(function () {
        _bNext = false;
        EmployeeAdvSearch();
    });

    function Next() {
        var oEmployees = [];
        oEmployees = $('#tblEmployeesForPicker').datagrid('getRows');
        if (oEmployees.length <= 0) { alert('Please Select Criteria and click on "Search" to find information.!!'); return; }
        _nRowLength = oEmployees.length;
        _bNext = true;
        EmployeeAdvSearch();
    }

    function EmployeeAdvSearch(){
        if (!_bNext) {
            _nRowLength = 0;
            _nLastEmployeeID = 0;
        }
        _nLoadRecords = document.getElementById("txtTo").value;

        if ($("#chkRange").is(':checked')) {
            if($('#txtFrom').numberbox('getValue').length=='' || $('#txtTo').numberbox('getValue').length==''){alert("Please enter valid range.")}
            var nRangeFrom = parseInt($('#txtFrom').numberbox('getValue'));
            var nRangeTo = parseInt( $('#txtTo').numberbox('getValue'));
            if (nRangeFrom > nRangeTo) { alert("Invalid Range !");return; }
            _nRowLength = nRangeFrom - 1;
            _nLoadRecords = nRangeTo - nRangeFrom + 1;
        }

        var sName = $.trim($("#txtEmployeeName").val());
        var sCode = $.trim($("#txtEmpCodeForSearch").val());
        var sEnrollNo = $.trim($("#txtEnrollNo").val());
        var nEmployeeTypeID=$("#cboEmployeeType").val();
        var nShiftID=$("#cboShift").val();
        var nCardStatus=$("#cboEmployeeCardStatus").val();
        var nWorkingStatus=$("#cboEmployeeWorkigStatus").val();
        var nDateType=$("#cboDateType").val();
        var sDOBFrom= parseInt($("#cboMonthFrom").val())+1+'-'+$("#cboDayFrom").val();
        var sDOBTo= parseInt($("#cboMonthTo").val())+1+'-'+$("#cboDayTo").val();
        var sGender= $("#cboGender option:selected").text();

        var bIsActive = ($("#chkActive").is(':checked'))? 1 : 0;
        var bIsInactive = ($("#chkInActive").is(':checked'))? 1 : 0;
        var bIsUser = ($("#chkUser").is(':checked'))? 1 : 0;

        var bIsUnOfficial = ($("#chkOfficialNotAssign").is(':checked'))?1:0;
        var bIsOfficial = ($("#chkOfficialAssign").is(':checked'))? 1 : 0;

        var bIsCardNotAsigned = ($("#chkCardNotAssigned").is(':checked'))? 1 : 0;
        var bIsSalarystructureNotAsigned = ($("#chkSalarystructureNotAssigned").is(':checked'))? 1 : 0;

        debugger;
        if(sName=='' && sCode=="" && sEnrollNo=="" && _sAttendanceSchemeID=="" && _sLocationID=="" && _sDepartmentID=="" && _sDesignationID=="" &&
           nEmployeeTypeID==0 && sGender=="" && nShiftID==0 && bIsActive==0 && bIsUnOfficial==0 && bIsInactive==0 && _sEmployeeIDs=="" && bIsUser==0 &&
           bIsOfficial==0 && nCardStatus==0 && bIsCardNotAsigned==0 && nWorkingStatus==0 && bIsSalarystructureNotAsigned==0 && nDateType==0 )
        {
            alert("Please enter you selection criteria."); return false;
        }

        var sParam = sName + '~' + sCode + '~' + _sAttendanceSchemeID + '~' + _sLocationID + '~' + _sDepartmentID + '~' +_sDesignationID + '~' +
                     sGender + '~' + nEmployeeTypeID + '~' + nShiftID + '~' + bIsActive + '~' + bIsUnOfficial + '~' + bIsInactive + '~' + _sEmployeeIDs + '~' +
                     bIsUser + '~' + bIsOfficial + '~' + nCardStatus + '~' + bIsCardNotAsigned + "~" + nWorkingStatus + "~" + bIsSalarystructureNotAsigned + "~" +
                     sDOBFrom + "~" + sDOBTo + "~" + nDateType + "~" + _nRowLength + "~" + _nLoadRecords+'~'+ false+ '~' + icsdateformat(new Date()) +'~'+ icsdateformat(new Date())+"~"+sEnrollNo;

        $.ajax({
            type: "POST",
            dataType: "json",
            url: _sBaseAddress + "/Employee/EmployeeSearch",
            traditional: true,
            data: JSON.stringify({ sParam: sParam }),
            contentType: "application/json; charset=utf-8",
            success: function (data) {
                var oEmps = jQuery.parseJSON(data);
                if (oEmps != null) {
                    if (oEmps.length > 0) {
                        if(!_bNext){
                            DynamicRefreshList(oEmps,'tblEmployeesForPicker');
                        }
                        else{
                            var bAppend=false;
                            var oTEmps=$('#tblEmployeesForPicker').datagrid('getRows');
                            if(oTEmps.length>0){
                                for (var i = 0; i < oEmps.length; i++) {
                                    var IsAppend=true;
                                    for (var j = 0; j < oTEmps.length; j++) {

                                        if(oEmps[i].EmployeeID==oTEmps[j].EmployeeID){
                                            IsAppend=false;
                                            break;
                                        }
                                    }
                                    if(IsAppend){
                                        bAppend=true;
                                        $('#tblEmployeesForPicker').datagrid('appendRow', oEmps[i]);
                                    }
                                }
                            }
                            else{
                                for (var j = 0; j < oEmps.length; j++) {
                                    bAppend=true;
                                    $('#tblEmployeesForPicker').datagrid('appendRow', oEmps[j]);
                                }
                            }
                            if(!bAppend){
                                alert("No more data found!");
                            }
                        }

                    }
                    else {
                        alert("No more data found!");
                    }
                    var oEmployees = $('#tblEmployeesForPicker').datagrid('getRows');
                    document.getElementById("lblcount").innerHTML = " | Count =" + oEmployees.length;
                    _bNext = false;
                }
            },
            error: function (xhr, status, error) {
                alert(error);
            }
        });
    }

    function PickEmployee(oEmployee){
        _oEmployee=oEmployee;
        if(_IsLeaveAppEmp){
            $('#txtEmployeeNameLAPicker').val(_oEmployee.Name);
            $("#btnDepartmentPickerLAPicker,#btnResetDepartmentPickerLAPicker").prop("disabled", true);
            $('#txtDepartmentLAPicker').val(_oEmployee.DepartmentName);
            _nDeptID= _oEmployee.DepartmentID;
        }
        _oEmployeeLeaveLedgers=[];

        if(_oEmployee.EmployeeID>0){
            var oEmployeeLeaveLedger={
                EmployeeID:_oEmployee.EmployeeID
            }
            var obj =
            {
                BaseAddress: _sBaseAddress,
                Object: oEmployeeLeaveLedger,
                ControllerName: "EmployeeLeaveLedger",
                ActionName: "Gets",
                IsWinClose: false
            };

            $.icsDataGets(obj, function (response) {
                $('#txtEmployee').val(oEmployee.Name);
                $("#txtEmployee").focus();
                if (response.status && response.objs != null)
                {
                    if (response.objs.length>0 && response.objs[0].EmpLeaveLedgerID > 0) {
                        EmployeeLeaveLedger(response.objs);
                    }
                    else{
                        $("#cboLeaveLedger").empty();
                    }
                }
            });
        }
    }

    $("#btnEmployeePickerOk").click(function () {
        var oEmployee = null;
        oEmployee = $('#tblEmployeesForPicker').datagrid('getSelected');
        if (oEmployee.EmployeeID <= 0) { alert("please select an employee.");return; }
        PickEmployee(oEmployee);
        $("#winEmployeePicker").icsWindow('close');
        $("#txtEmployee").select().focus();
    });

    $("#btnEmployeePickerClose").click(function () {
        $("#winEmployeePicker").icsWindow('close');
    });


    /*-------------Attendance Schema Picker----------------*/
    $("#btnAttScheme").click(function(e){
        var oAttendanceScheme={AttendanceSchemeID:0};
        var obj = {
            BaseAddress: _sBaseAddress,
            Object: oAttendanceScheme,
            ControllerName: "AttendanceScheme",
            ActionName: "GetsAttendanceSchemeCurrentSession",
            IsWinClose: false
        };
        $.icsDataGets(obj, function (response) {

            if (response.status && response.objs.length > 0) {
                if (response.objs[0].AttendanceSchemeID > 0) {
                    debugger;
                    var tblColums = [];
                    var oColumn = { field: "Name", title: "Name", width: 150, align: "left" };tblColums.push(oColumn);
                    oColumn = { field: "EmployeeType", title: "EmployeeType", width: 100, align: "left" };tblColums.push(oColumn);
                    oColumn = { field: "DayOff", title: "DayOff", width: 115, align: "left" };tblColums.push(oColumn);

                    var oPickerParam = {
                        winid: 'winAttendanceScheme',
                        winclass:'clsAttendanceScheme',
                        winwidth: 420,
                        winheight: 460,
                        tableid: 'tblAttendanceSchemePicker',
                        tablecolumns: tblColums,
                        datalist: response.objs,
                        multiplereturn: false,
                        searchingbyfieldName:'Name',
                        windowTittle: 'Attendance Scheme List'
                    };
                    $.icsPicker(oPickerParam);
                    IntializeAttendancePickerbutton(oPickerParam);//multiplereturn, winclassName

                }
                else { alert(response.objs[0].ErrorMessage); }
            }
        });
    });

    function IntializeAttendancePickerbutton(oPickerobj)
    {
        $("#" + oPickerobj.winid).find("#btnOk").click(function () {

            var oAttendanceScheme = $('#'+oPickerobj.tableid).datagrid('getSelected');
            if (oPickerobj.winid == 'winAttendanceScheme')
            {
                if(oAttendanceScheme!=null && oAttendanceScheme.AttendanceSchemeID>0){
                    $("#"+oPickerobj.winid).icsWindow("close");
                    $("#" + oPickerobj.winid).remove();
                    $('#txtAttendanceScheme').val(oAttendanceScheme.Name);
                    _sAttendanceSchemeID=oAttendanceScheme.AttendanceSchemeID;
                }
                else{
                    alert("Please select a schema.");
                }
            }
        });
    }

    $("#btnResetAttScheme").click(function(e){
        $('#txtAttendanceScheme').val("");
        _sAttendanceSchemeID="";
    });

    /*-------------Location Picker----------------*/

    $("#btnLocationPicker").click(function(e){

        $("#winLocationPicker").icsWindow('open');
        var oLocation={LocationID:0};
        var obj = {
            BaseAddress: _sBaseAddress,
            Object: oLocation,
            ControllerName: "Location",
            ActionName: "GetsLocationMenuTree",
            IsWinClose: false
        };

        $.icsDataGet(obj, function (response) {

            if (response.status && response.obj!=null) {
                if (response.obj.TLocation.id > 0) {
                    $('#locationtree').tree({ data: [response.obj.TLocation] });
                }
            }
        });
    });

    $("#btnLocationPickerOk").click(function(e){
        var oLocation = $('#locationtree').tree('getSelected');
        if(oLocation!=null && oLocation.id>0){
            $("#winLocationPicker").icsWindow('close');
            $('#txtLocation').val(oLocation.text);
            _sLocationID= oLocation.id;
        }
        else{
            alert("Please select a location.");
        }
    });

    $("#btnLocationPickerClose").click(function(e){
        $("#winLocationPicker").icsWindow('close');
    });

    $("#btnResetLocationPicker").click(function(e){
        $('#txtLocation').val("");
        _sLocationID="";
    });
    /*-------------Department Picker----------------*/

    function DepartmentPicker(nDeptID){
        $("#winDepartmentPicker").icsWindow('open');
        var oDepartment={DepartmentID:nDeptID};
        var obj = {
            BaseAddress: _sBaseAddress,
            Object: oDepartment,
            ControllerName: "Department",
            ActionName: "GetsDepartments",
            IsWinClose: false
        };

        $.icsDataGet(obj, function (response) {

            if (response.status && response.obj!=null) {
                if (response.obj.id > 0) {
                    $('#departmenttree').tree({ data: [response.obj] });
                }
            }
        });
    }

    $("#btnDepartmentPicker").click(function(e){
        _IsLeavAppDept=false;
        DepartmentPicker(0);
    });

    $("#btnDepartmentPickerOk").click(function(e){

        var oDepartment = $('#departmenttree').tree('getSelected');
        if(oDepartment!=null && oDepartment.id>0){
            $("#winDepartmentPicker").icsWindow('close');
            if(!_IsLeavAppDept){
                $('#txtDepartment').val(oDepartment.text);
                _sDepartmentID= oDepartment.id;
            }
            else{

                $('#txtDepartmentLAPicker').val(oDepartment.text);
                _nDeptID= oDepartment.id;
            }

        }
        else{
            alert("Please select a department.");
        }
    });

    $("#btnDepartmentPickerClose").click(function(e){
        $("#winDepartmentPicker").icsWindow('close');
    });

    $("#btnResetDepartmentPicker").click(function(e){
        $('#txtDepartment').val("");
        _sDepartmentID="";
    });


    /*-------------Designation Picker----------------*/


    $("#btnDesignationPicker").click(function(e){
        var oDesignation={
            DesignationID:0,
            Params: (($.trim(_sLocationID)=="")? 0:_sLocationID)+'~'+ (($.trim(_sDepartmentID)=="")? 0:_sDepartmentID)
        };
        var obj = {
            BaseAddress: _sBaseAddress,
            Object: oDesignation,
            ControllerName: "Designation",
            ActionName: "Gets",
            IsWinClose: false
        };
        $.icsDataGets(obj, function (response) {

            if (response.status && response.objs.length > 0) {
                if (response.objs[0].DesignationID > 0) {
                    debugger;
                    var tblColums = [];
                    var oColumn = { field: "Code", title: "Code", width: 50, align: "left" };tblColums.push(oColumn);
                    oColumn = { field: "Name", title: "Name", width: 170, align: "left" };tblColums.push(oColumn);

                    var oPickerParam = {
                        winid: 'winDesignation',
                        winclass:'clsDesignation',
                        winwidth: 320,
                        winheight: 460,
                        tableid: 'tblDesignation',
                        tablecolumns: tblColums,
                        datalist: response.objs,
                        multiplereturn: false,
                        searchingbyfieldName:'Name',
                        windowTittle: 'Designation List'
                    };
                    $.icsPicker(oPickerParam);
                    IntializeDesignationPickerbutton(oPickerParam);//multiplereturn, winclassName

                }
                else { alert(response.objs[0].ErrorMessage); }
            }
        });
    });

    function IntializeDesignationPickerbutton(oPickerobj)
    {
        $("#" + oPickerobj.winid).find("#btnOk").click(function () {

            var oDesignation = $('#'+oPickerobj.tableid).datagrid('getSelected');
            if (oPickerobj.winid == 'winDesignation')
            {
                if(oDesignation!=null && oDesignation.DesignationID>0){
                    $("#"+oPickerobj.winid).icsWindow("close");
                    $("#" + oPickerobj.winid).remove();
                    $('#txtDesignation').val(oDesignation.Name);
                    _sDesignationID=oDesignation.DesignationID;
                }
                else{
                    alert("Please select a designation.");
                }
            }
        });
    }

    $("#btnResetDesignationPicker").click(function(e){
        $('#txtDesignation').val("");
        _sDesignationID="";
    });


    /*---------------- Adv Search leave Application ----------------*/

    function InitializeLeaveAppAdvSearch(){
        LoadLeave();

        $("#cboApplicationTypeLAPicker").icsLoadCombo({
            List: _oApplicationTypes,
            OptionValue: "Value",
            DisplayText: "Text",
            //InitialValue: ""
        });

        $("#cboLeaveStatusLAPicker").icsLoadCombo({
            List: _oLeaveStatuss,
            OptionValue: "Value",
            DisplayText: "Text",
            //InitialValue: ""
        });
    }

    function LoadLeave(){
        $("#cboLeaveLAPicker").icsLoadCombo({
            List: _oLeaveHeads,
            OptionValue: "LeaveHeadID",
            DisplayText: "Name",
            //InitialValue: ""
        });
    }

    function  LeaveAppPickerReset(){
        debugger
        _oEmployee=null;
        LoadLeave();
        $(".txtResetLAPicker").val("");
        $(".cboResetLAPicker").val(0);
        $(".chkResetLAPicker").prop("checked",false);
        $("#dtStartDateLAPicker,#dtEndDateLAPicker").datebox('setValue',icsdateformat(new Date()));
        DynamicRefreshList([],'tblLeaveApplicationForPicker');

        $('#txtFrom_Search').numberbox({min:0, precision:0 });
        $('#txtTo_Search').numberbox({min:0, precision:0 });
        $('#txtFrom_Search').numberbox('setValue',1);
        $('#txtTo_Search').numberbox('setValue',50);
        $("#lblRange1_Search").hide();
        $("#chkRange_Search").prop('checked', false);
        $("#lblcount_Search").html("");

    }

    $("#btnDepartmentPickerLAPicker").click(function(e){
        _IsLeavAppDept=true;
        DepartmentPicker((_oEmployee!=null && _oEmployee.EmployeeID>0)?_oEmployee.DepartmentID:0);
    });

    $("#btnResetDepartmentPickerLAPicker").click(function(e){
        _IsLeavAppDept=false;
        _nDeptID=0;
        $('#txtDepartmentLAPicker').val("");
        $("#btnDepartmentPickerLAPicker,#btnResetDepartmentPickerLAPicker").prop("disabled", false);
        LoadLeave();
    });


    $("#btnEmployeeLAPicker").click(function () {
        _IsLeaveAppEmp=true;
        EmployeePickerReset();
        $("#winEmployeePicker").icsWindow("open", " Employee Picker");
    });

    $("#btnResetEmployeeLAPicker").click(function () {
        _IsLeaveAppEmp=false;
        if(_oEmployee!=null && _oEmployee.EmployeeID>0){
            $("#txtDepartmentLAPicker").val("");
            _nDeptID=0;
        }
        $("#txtEmployeeNameLAPicker").val("");
        _oEmployee=null;
        LoadLeave();
        $("#btnDepartmentPickerLAPicker,#btnResetDepartmentPickerLAPicker").prop("disabled", false);
    });


    $('#btnAdvSearch').click(function(e){
        LeaveAppPickerReset();
        $("#winLeaveApplicationAdvSearch").icsWindow("open", "Search Leave Application");

    });

    $('#btnResertLAPicker').click(function(e){
        LeaveAppPickerReset();
    });

    //$('#btnSearchLAPicker').click(function(e){
    var nTotalSearh=0;
    function SearchLAPicker()
    {
        if(!_bNext_LeaveSearch)
        {
            _nRowLength_LeaveSearch  = 0;
            _nLastLeaveID = 0;
            nTotalSearh=0;
        }

        var nEmpID= (_oEmployee!=null && _oEmployee.EmployeeID>0)?_oEmployee.EmployeeID:0;
        var nApplicationNature=$("#cboApplicationTypeLAPicker").val();
        var nLeaveHeadLedger=$("#cboLeaveLAPicker").val();
        var nLeaveType=$("#cboLeaveTypeLAPicker").val();
        var nLeaveStatus=$("#cboLeaveStatusLAPicker").val();
        var bIsPaid= ($("#chkIsPaidLAPicker").is(':checked'))? 1 : 0;
        var bIsUnPaid = ($("#chkIsUnPaidLAPicker").is(':checked'))? 1 : 0;

        _nLoadRecords_LeaveSearch  = $("#txtTo_Search").val();
        if($("#chkRange_Search").is(":checked") == true)
        {
            var RangeFrom = 0;
            var RangeTo = 0;
            RangeFrom = parseFloat($("#txtFrom_Search").val());
            RangeTo = parseFloat($("#txtTo_Search").val());

            if(RangeFrom > RangeTo)
            {
                alert("Invalid Range !");
                return;
            }
            _nRowLength_LeaveSearch  = 0;
            _nLoadRecords_LeaveSearch  = 0;

            _nRowLength_LeaveSearch  = RangeFrom-1;
            _nLoadRecords_LeaveSearch  = RangeTo - RangeFrom +1;
        }

        var sTempString = nEmpID +"~"+ _nDeptID +"~"+$('#dtStartDateLAPicker').datebox('getValue')+"~"+$('#dtEndDateLAPicker').datebox('getValue')+"~"+nApplicationNature+"~"+nLeaveHeadLedger+"~"+nLeaveType+"~"+nLeaveStatus+"~"+bIsPaid+'~'+bIsUnPaid +'~'+ $("#chkIsDateSearch").is(':checked')+"~"+_nRowLength_LeaveSearch +"~"+_nLoadRecords_LeaveSearch;

        var oLeaveApplication={Params:sTempString};
        var obj = {
            BaseAddress: _sBaseAddress,
            Object: oLeaveApplication,
            ControllerName: "LeaveApplication",
            ActionName: "SearchLeaveApplication",
            IsWinClose: false
        };

        $.icsDataGets(obj, function (response) {
            if (response.status && response.objs!=null) {
                if (response.objs.length>0 && response.objs[0].LeaveApplicationID>0 ) {
                    for (var j = 0; j < response.objs.length; j++)
                    {
                        $('#tblLeaveApplicationForPicker').datagrid('appendRow',response.objs[j]);
                    }
                }
                else
                {
                    alert("No more data found!");
                }

                nTotalSearh+=response.objs.length;
                document.getElementById("lblcount_Search").innerHTML = " | Count ="+ nTotalSearh;
                _bNext_LeaveSearch = false;
            }
        });
    }

    function Next_LeaveSearch()
    {
        var oLeaves =[];
        oLeaves=$('#tblLeaveApplicationForPicker').datagrid('getRows');
        _nRowLength_LeaveSearch  = oLeaves.length;
        _bNext_LeaveSearch = true;

        if (oLeaves.length<=0)
        {
            alert('Please Select Criteria and click on "Search" to find information.!!');
            return;
        }
        var oLeave=oLeaves[oLeaves.length-1];

        if (_nLastLeaveID==oLeave.LeaveApplicationID)
        {
            alert('No more data found');
            return;
        }
        _nLastLeaveID=oLeave.LeaveApplicationID;
        SearchLAPicker();
    }

    $("#btnLeaveAppPickerOk").click(function () {
        var oLeaveApplications = [];
        oLeaveApplications = $('#tblLeaveApplicationForPicker').datagrid('getChecked');
        if (oLeaveApplications.length <= 0) { alert("please select at least one item.");return; }
        $("#winLeaveApplicationAdvSearch").icsWindow("close");
        //DynamicRefreshList(oLeaveApplications,'tblLeaveApplication');
        //for (var j = 0; j < oLeaveApplications.length; j++)
        //{
        //    $('#tblLeaveApplication').datagrid('appendRow',oLeaveApplications[j]);
        //}
        Append(oLeaveApplications);

    });

    $('#btnLeavePickerClose').click(function(e){
        $("#winLeaveApplicationAdvSearch").icsWindow("close");
    });

    $('#btnLeaveApplicationForm_MAMIYA').click(function (e)
    {
        var oLeaveApplication = $('#tblLeaveApplication').datagrid('getSelected');
        if(oLeaveApplication==null || oLeaveApplication.LeaveApplicationID<=0)
        {
            alert("please select an item !");
            return false;
        }
        var tsv=((new Date()).getTime())/1000;
        window.open(_sBaseAddress+ "/LeaveApplication/PrintLeaveApplicationForm_MAMIYA?nEmpID="+oLeaveApplication.EmployeeID+"&nLeaveApplicationID="+oLeaveApplication.LeaveApplicationID+"&ts="+tsv, "_blank");
    });

    function GetAttendance()
    {
        DynamicRefreshList([],'tblShowAttendance');

        if(_oEmployee.EmployeeID<=0)
        {
            alert('Please enter an employee!');
            return;
        }
        var dtStartDate = $('#dtStartDate').datebox("getValue");
        var dtEndDate = $('#dtEndDate').datebox("getValue");
        var diff= (new Date(dtEndDate)-new Date(dtStartDate))/1000/60/60/24+1;
        if(diff<=0)
        {
            alert("Invalid Date!");
            return;
        }

        if(diff>10)
        {
            dtStartDate=dtEndDate;
        }
        var nEmployeeID=_oEmployee.EmployeeID;
        sParams=nEmployeeID+"~"+dtStartDate+"~"+dtEndDate;

        $.ajax({
            type: "POST",
            dataType: "json",
            url: _sBaseAddress + "/AttendanceDaily/EmployeeWiseAttendanceSearch",
            traditional: true,
            data: JSON.stringify({ sTemp : sParams}),
            contentType: "application/json; charset=utf-8",
            success: function (data) {
                var oAttendanceDailys = jQuery.parseJSON(data);
                var oNewList=[];
                if(oAttendanceDailys.length>0 && oAttendanceDailys[0].ErrorMessage=="")
                {
                    $("#winShowAttendance").icsWindow("open");
                    var oNewList=[];
                    if(diff>10)
                    {
                        diff=1;
                    }
                    var oDate= new Date(dtStartDate);
                    for(var i=0; i<diff; i++)
                    {
                        oDate.getDay();
                        var sDate= icsdateformat(oDate);
                        var bExist=false;
                        for(var j=0; j<oAttendanceDailys.length; j++)
                        {
                            if(sDate==oAttendanceDailys[j].AttendanceDateInString)
                            {
                                oNewList.push(oAttendanceDailys[j]);
                                bExist=true;
                                break;
                            }
                        }
                        if(!bExist)
                        {
                            var oObj= new Object();
                            oObj= new Object();
                            oObj.AttendanceDateInString=sDate;
                            oObj.AttStatusInST="--";
                            oNewList.push(oObj);
                        }
                        oDate.setDate(oDate.getDate()+1)
                    }
                    DynamicRefreshList(oNewList,'tblShowAttendance');
                }
                else if(oAttendanceDailys[0].ErrorMessage=="Data Not Found !")
                {
                    $("#winShowAttendance").icsWindow("open");
                    var oObj= new Object();
                    var oItems=[];
                    oObj= new Object();
                    oObj.AttendanceDateInString=dtEndDate;
                    oObj.AttStatusInST="--";
                    oNewList.push(oObj);
                    DynamicRefreshList(oNewList,'tblShowAttendance');
                }
                else
                {
                    alert(oAttendanceDailys[0].ErrorMessage);
                }
                if(bSaveShow){ $("#btnSaveLeaveApplication").show();}

            },
            error: function (xhr, status, error) {
                alert(error);
            }
        });
    }

    $("#btnShowAttendanceClose").click(function(){
        $("#winShowAttendance").icsWindow("close");
    });

    $("#cboLeaveLedger").click(function () {
        var nEmpLeaveLedgerID= $("#cboLeaveLedger").val();
        for(var i=0;i<_oEmployeeLeaveLedgers.length;i++)
        {
            if(_oEmployeeLeaveLedgers[i].EmpLeaveLedgerID==nEmpLeaveLedgerID)
            {
                if(_oEmployeeLeaveLedgers[i].IsLWP)
                {
                    $("#rdbtnPaid").prop('checked', false);
                    $("#rdbtnUnPaid").prop('checked', true);
                }
                else
                {
                    $("#rdbtnPaid").prop('checked', true);
                    $("#rdbtnUnPaid").prop('checked', false);
                }
                break;
            }
            else
            {
                $("#rdbtnPaid").prop('checked', false);
                $("#rdbtnUnPaid").prop('checked', false);
            }
        }
    });

    $("#cboLeaveType").click(function () {
        var nLeaveType= $("#cboLeaveType").val();

        if(nLeaveType==1 || nLeaveType==0)
        {
            $("#txtDurationInHour").prop("disabled", true);
            //$("#spEndDate").show();
        }
        else
        {
            $("#txtDurationInHour").prop("disabled", false);
            //$("#spEndDate").hide();
        }
    });

    $("#btnResetEmployeePicker").click(function () {
        $("#txtEmployee").val("");
        _oEmployee.EmployeeID=0;
    });

    function Search_By_Code_Or_Date()
    {
        var bDate=$("#chkIsDate").is(':checked');
        if(!bDate && _nEmployee_Search_EmpID<=0)
        {
            alert("Please enter employee name or code or check date!");
            return;
        }
        var sStartDate="";
        var sEndDate="";
        if($("#chkIsDate").is(':checked'))
        {
            sStartDate=$('#dtStartDate_Search').datebox('getValue');
            sEndDate=$('#dtEndDate_Search').datebox('getValue');
        }

        var bReportingPerson=$("#chkReportingPerson").is(':checked');
        var sTempString = _nEmployee_Search_EmpID +"~"+ sStartDate +"~"+sEndDate+"~"+bReportingPerson;

        var oLeaveApplication={Params:sTempString};
        var obj = {
            BaseAddress: _sBaseAddress,
            Object: oLeaveApplication,
            ControllerName: "LeaveApplication",
            ActionName: "SearchLeaveApplicationByEmpAndDate",
            IsWinClose: false
        };

        $.icsDataGets(obj, function (response) {
            if (response.status && response.objs!=null) {
                if (response.objs.length>0 && response.objs[0].LeaveApplicationID>0 ) {
                    Append(response.objs);
                }
                else{
                    alert("No data found.");
                    DynamicRefreshList([],'tblLeaveApplication');
                }
            }
        });
    }

    $('#txtCEmployee').click(function (e)
    {
        _nEmployee_Search_EmpID=0;
        $('#txtEmployee_Search').val("");
    });

    $('#txtEmployee_Search').keypress(function (e)
    {
        var code = (e.keyCode ? e.keyCode : e.which);
        if (code == 13)//Enter key-13
        {
            var sCodeName = $.trim($("#txtEmployee_Search").val());
            if(sCodeName==''){alert("Please enter name or code to search.");$("#txtEmployee_Search").focus(); return;}
            SearchEmployeeByText(sCodeName, false, false, true);
        }
    });

    $("#btnClear").click(function () {
        var oLeaves= $('#tblLeaveApplication').datagrid('getRows');
        var n=oLeaves.length-1;
        var SelectedRowIndex=0;
        for(var i=n; i>=0; i=i-1)
        {
            SelectedRowIndex = $('#tblLeaveApplication').datagrid('getRowIndex', oLeaves[i]);
            $('#tblLeaveApplication').datagrid('deleteRow',SelectedRowIndex);
        }
    });

    function Append(oEmps)
    {
        var bFound=false;
        var oTEmps=$('#tblLeaveApplication').datagrid('getRows');
        if(oTEmps.length>0){
            for (var i = 0; i < oEmps.length; i++) {
                var IsAppend=true;
                for (var j = 0; j < oTEmps.length; j++) {
                    if(oEmps[i].LeaveApplicationID==oTEmps[j].LeaveApplicationID){
                        IsAppend=false;
                        break;
                    }
                }
                if(IsAppend){
                    bFound=true;
                    $('#tblLeaveApplication').datagrid('appendRow', oEmps[i]);
                }
            }
        }
        else{
            for (var j = 0; j < oEmps.length; j++) {
                bFound=true;
                $('#tblLeaveApplication').datagrid('appendRow', oEmps[j]);
            }
        }
        if(!bFound){
            alert("data all ready exist!");
        }
    }

    //var nLeaveID_ADj=0;
    //var SelectedRowIndex_ADj=0;
    //$("#btnLeaveAdjustment").click(function () {
    //    var oLeave= $('#tblLeaveApplication').datagrid('getSelected');
    //    if(oLeave== null || oLeave.LeaveApplicationID<=0)
    //    {
    //        alert("Please select an item from the list!");
    //        return;
    //    }
    //    nLeaveID_ADj=oLeave.LeaveApplicationID;
    //    SelectedRowIndex_ADj = $('#tblLeaveApplication').datagrid('getRowIndex', oLeave);
    //    $('#dtStartDate_LeaveAdjustment').datebox('setValue',oLeave.StartDateTimeInString);
    //    $('#dtEndDate_LeaveAdjustment').datebox('setValue',oLeave.EndDateTimeInString);
    //    $("#winLeaveAdjustment").icsWindow("open");
    //});

    //$("#btnwinLeaveAdjustmentClose").click(function () {
    //    $("#winLeaveAdjustment").icsWindow("close");
    //});

    $("#btnLeaveAdjustmentSave").click(function () {
        var sEndDate=$('#dtEndDate').datebox('getValue');
        var sTempString = nLeaveID_ADj +"~"+sEndDate;
        var oLeaveApplication={Params:sTempString};
        var obj = {
            BaseAddress: _sBaseAddress,
            Object: oLeaveApplication,
            ControllerName: "LeaveApplication",
            ActionName: "LeaveAdjustment",
            IsWinClose: false
        };

        $.icsDataGet(obj, function (response) {
            if (response.status && response.obj!=null) {
                if (response.obj.LeaveApplicationID>0 ) {
                    $('#tblLeaveApplication').datagrid('updateRow', { index: SelectedRowIndex_ADj, row: response.obj});
                    alert("Adjustment successfully !");
                    $("#winLeaveAdjustment").icsWindow("close");
                }
                else{
                    alert(response.obj.ErrorMessage);
                }
            }
        });
    });

    $("#cboLeaveLedger").change(function () {
        var nEmpLeaveLedgerID=0;
        for(var i=0;i< _oEmployeeLeaveLedgers.length;i++)
        {
            if(_oEmployeeLeaveLedgers[i].IsLeaveOnPresence==1)
            {
                nEmpLeaveLedgerID=_oEmployeeLeaveLedgers[i].EmpLeaveLedgerID;
                break;
            }
        }
        //if(nEmpLeaveLedgerID==$("#cboLeaveLedger").val())
        //{$("#btnELProcess").show();} else{$("#btnELProcess").hide();}
    });

    //$('#btnELProcess').click(function(e){
    //    $('#dtLastProcessDate').datebox('setValue',icsdateformat(new Date()));
    //    $("#winELProcess").icsWindow('open');
    //});

    $('#btnELeaveProcess').click(function(e){
        var nEmpLeaveLedgerID =$("#cboLeaveLedger").val();
        if(nEmpLeaveLedgerID>0)
        {
            var LastProcessDate=$('#dtLastProcessDate').datebox('getValue');
            if (!confirm("Confirm to process up to " + LastProcessDate)) return;

            $.ajax
            ({
                type: "POST",
                dataType: "json",
                url: _sBaseAddress + "/EarnLeave/ELProcess",
                traditional: true,
                data: JSON.stringify({nEmpLeaveLedgerID:nEmpLeaveLedgerID,LastProcessDate:LastProcessDate}),
                contentType: "application/json; charset=utf-8",
                success: function (data) {
                    var oOBJ = jQuery.parseJSON(data);
                    if (oOBJ != null &&  oOBJ.ErrorMessage == "")
                    {
                        alert("Process successfully");
                        $("#winELProcess").icsWindow('close');
                    }
                    else
                    {
                        alert(oOBJ.ErrorMessage);
                    }
                },
                error: function (xhr, status, error) {
                    alert(error);
                }
            });
        }
    });

    $('#btnCloseELeaveProcess').click(function(e){
        $("#winELProcess").icsWindow('close');
    });

    function LeaveLedger(sFrom)
    {
    var oLeaveLedgers =[];
    var nEmployeeID=0;
    if(sFrom=="Single")
    {
        if (_oLeaveApplication!=null){nEmployeeID=_oLeaveApplication.EmployeeID;}            
        if (nEmployeeID==0 && _oEmployee!=null){nEmployeeID=_oEmployee.EmployeeID;}
               
        if(nEmployeeID<=0)
        {
            alert("Please enter employee!");
            return;
        }
    }
    else
    {
        var oLeaveApplication = $("#tblLeaveApplication").datagrid("getSelected");
        if (oLeaveApplication == null || oLeaveApplication.EmployeeID <= 0) { alert("Please select an item from list!"); return; }
        nEmployeeID=oLeaveApplication.EmployeeID
    }
    if(nEmployeeID>0)
    {
        $.ajax
        ({
            type: "POST",
            dataType: "json",
            url: _sBaseAddress + "/LeaveApplication/GetsLeaveLedger",
            traditional: true,
            data: JSON.stringify({ nEmployeeID: nEmployeeID,nACSID:0}),
            contentType: "application/json; charset=utf-8",
            success: function (data) {
                oLeaveLedgers = jQuery.parseJSON(data);
                if (oLeaveLedgers.length>0 &&  oLeaveLedgers[0].ErrorMessage == "")
                {
                    DynamicRefreshList(oLeaveLedgers,'tblLeaveLedger');
                    $("#winLeaveLedger").icsWindow("open",oLeaveLedgers[0].EmployeeName +"["+ oLeaveLedgers[0].EmployeeCode + "]"+ " | Session-"+oLeaveLedgers[0].AttendanceCalendarSession.Session);
                }
                else
                {
                    alert(oLeaveLedgers[0].ErrorMessage);
                }
            },
            error: function (xhr, status, error)
            {
                alert(error);
            }
        });
    }
}

$('#btnLeaveLedgerClose').click(function(e){
    $("#winLeaveLedger").icsWindow("close");
});

</script>
