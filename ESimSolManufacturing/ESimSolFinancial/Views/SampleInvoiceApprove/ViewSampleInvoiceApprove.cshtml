@{
    ViewBag.Title = "Sample Invoice Approve";
}
@model IEnumerable<ESimSol.BusinessObjects.SampleInvoiceApprove>
                      <body><div id="progressbarParent" style="width:100%;height:100%;margin:0 auto;text-align:center; margin-left: auto;margin-right: auto;left: 0;right: 0;z-index: 1;">
    <div style="margin: 0px auto;margin-top: 251px;text-align:center;width:390px;">
        <label style="font-size:18px;">Please wait</label>
        <div id="progressbar" style="width:100%;height:37px;"></div>
    </div>
</div>
                          <div class="menuMainCollectionTable" style="width:100%;height:100%">

                              <div id="tabReconTabs" class="easyui-tabs" style="width: 100%; height: 100%">
                                  <div title="Invoice Issue" style="width:100%;height:100%">
                                      <table id="tblSampleInvoiceApproves" style="width:100%;height:100%" class="easyui-datagrid" fit="true" fitcolumns="true" rownumbers="true" pagination="true" singleselect="true" autorowheight="false" toolbar="#toolbarOne" data-options="rowStyler: function(index,row){
                                    if (row.SampleInvoiceNo=='Total'){
                                        return 'font-weight:bold;';
                                    }
                                }
                ">
                                          <thead>
                                              <tr>
                                                  <th field="CurrentStatusSt" width="10%" align="left">Status</th>
                                                  <th field="SampleInvoiceDateSt" width="10%" align="left">Invoice Date</th>
                                                  <th field="ContractorName" width="18%" align="left">Contractor Name</th>
                                                  <th field="SampleInvoiceNo" width="12%" align="left">Invoice No</th>
                                                  <th field="AmountSt" width="8%" align="right">Amount</th>
                                                  <th field="MKTPName" width="8%" align="left">MKTPerson Name</th>
                                                  <th field="PINo" width="12%" align="left">PI No</th>
                                                  <th field="LCNo" width="12%" align="left">L/C No</th>
                                                  <th field="OutstandingInSt" width="10%" align="right" formatter="FormatStyle">Outstanding</th>
                                                  <th field="ApproveByName" width="15%" align="left">Approve By </th>
                                                  <th field="PaymentTypeSt" width="10%" align="left">Payment Type</th>
                                                  
                                                  <th field="PartyConcernPerson" width="10%" align="left">PartyConcernPerson</th>


                                              </tr>
                                          </thead>
                                      </table>
                                      <div id="toolbarOne">

                                          <table style="width:100%;">

                                              <tr>
                                                  <td style="width:60%">
                                                      <a id="btnAdvSearch" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-search" plain="true">Adv.</a>
                                                      <label id="lblStartDate"><input id="txtStartDate" type="text" class="easyui-datebox" data-options="formatter:icsdateformat,parser:icsdateparser" style="width: 100px;" /></label>&nbsp;
                                                      <a id="btnSearchByDate" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-search" plain="true"></a>
                                                  </td>

                                                  <td style="width:15%">
                                                      <a href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-approved" plain="true" id="btnApprove">Approve</a>
                                                      <a href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-cancel" plain="true" id="btnCancel">Cancel</a>
                                                  </td>
                                                  <td style="width:15%">
                                                      @*<a href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-details" plain="true" id="btnShowDetail">View Detail</a>*@
                                                  </td>
                                                  <td style="width:10%">
                                                      <a id="btnPrintSampleInvoiceApproveExcel" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-print" plain="true">Export XL</a>
                                                  </td>
                                              </tr>



                                          </table>

                                      </div>
                                  </div>
                                  <div title="Invoice Issue(Product Wise)" id="divProductReconciliation" style="width:100%;height:540px">
                                      <table id="tblSampleInvoiceApprove_ProductWise" style="width:100%;height:100%" class="easyui-datagrid" fit="true" fitcolumns="true" rownumbers="true" pagination="false" singleselect="true" autorowheight="false" toolbar="#toolbar" data-options="rowStyler: function(index,row){
                                    if (row.SampleInvoiceNo=='Total'){
                                        return 'font-weight:bold;';
                                    }
                                }
                ">
                                          <thead>
                                              <tr>
                                                  <th field="CurrentStatusSt" width="10%" align="left">Status</th>
                                                  <th field="SampleInvoiceDateSt" width="10%" align="left">Invoice Date</th>
                                                  <th field="ContractorName" width="18%" align="left">Contractor Name</th>
                                                  <th field="SampleInvoiceNo" width="12%" align="left">Invoice No</th>
                                                  <th field="ProductName" width="12%" align="left">Product Name</th>
                                                  <th field="Color" width="12%" align="left">Color</th>
                                                  <th field="QtySt" width="8%" align="right">Qty</th>
                                                  <th field="UnitPriceSt" width="8%" align="right">Unit Price</th>
                                                  <th field="AmountSt" width="8%" align="right">Amount</th>
                                                  <th field="MKTPName" width="8%" align="left">MKTPerson Name</th>
                                                  <th field="PINo" width="12%" align="left">PI No</th>
                                                  <th field="LCNo" width="12%" align="left">L/C No</th>
                                                  <th field="Outstanding" width="10%" align="right">Outstanding</th>
                                                  <th field="ApproveByName" width="15%" align="left">Approve By </th>
                                                  <th field="PaymentTypeSt" width="10%" align="left">Payment Type</th>


                                              </tr>
                                          </thead>
                                      </table>
                                      <div id="toolbar">

                                          <table style="width:100%;">

                                              <tr>
                                                  <td style="width:60%">
                                                      <a id="btnAdvSearchTwo" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-search" plain="true">Adv.</a>
                                                      <label id="lblStartDate"><input id="txtStartDateTwo" type="text" class="easyui-datebox" data-options="formatter:icsdateformat,parser:icsdateparser" style="width: 100px;" /></label>&nbsp;
                                                      <a id="btnSearchByDateTwo" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-search" plain="true"></a>
                                                  </td>

                                                  <td style="width:15%">
                                                      
                                                  </td>
                                                  <td style="width:15%">
                                                     
                                                  </td>
                                                  <td style="width:10%">
                                                      <a id="btnPrintSampleInvoiceApproveExcel" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-print" plain="true">Export XL</a>
                                                  </td>
                                              </tr>



                                          </table>

                                      </div>
                                  </div>
                              </div>
                          </div>
                          <div id="winAdvSearch" class="easyui-window winClass" title="Adv. Search" data-options="modal:true,closed:true,collapsible:false,minimizable:false,maximizable:false,closable:false">
                              <table style="width:100%;">
                                  <tr>
                                      <td>
                                          <fieldset style="margin-bottom: 0px;">
                                              <legend>Searching Criteria</legend>
                                              <table>
                                                  <tr>
                                                      <td style=" width:20%;text-align:right;">
                                                          <label>Issue To </label>
                                                      </td>
                                                      <td colspan="3" style=" width:80%;text-align:left;">
                                                          <input id="txtContractorAdvS" style="width:75%;" type="text" placeholder="Type & Press Enter" />
                                                          <a id="btnPickContractorAdvS" href="javascript:void(0)" class="easyui-linkbutton ics-pick" iconcls="icon-pick" plain="true"></a>
                                                          <a id="btnClrContractorAdvS" href="javascript:void(0)" class="easyui-linkbutton ics-pick" iconcls="icon-clear" plain="true"></a>

                                                      </td>
                                                  </tr>
                                                  <tr>
                                                      <td style=" width:20%;text-align:right;">
                                                          <label>Deliver To </label>
                                                      </td>
                                                      <td colspan="3" style=" width:80%;text-align:left;">
                                                          <input id="txtDeliverToAdvS" style="width:75%;" type="text" placeholder="Type & Press Enter" />
                                                          <a id="btnPickDeliverToAdvS" href="javascript:void(0)" class="easyui-linkbutton ics-pick" iconcls="icon-pick" plain="true"></a>
                                                          <a id="btnClrDeliverToAdvS" href="javascript:void(0)" class="easyui-linkbutton ics-pick" iconcls="icon-clear" plain="true"></a>
                                                      </td>
                                                  </tr>
                                                  @*<tr>
                                                      <td style=" width:20%;text-align:right;">
                                                          <label>Yarn </label>
                                                      </td>
                                                      <td colspan="3" style=" width:80%;text-align:left;">
                                                          <input id="txtProductName" style="width:75%;" type="text" placeholder="Type & Press Enter" />
                                                          <a id="btnProductPiker" href="javascript:void(0)" class="easyui-linkbutton ics-pick" iconcls="icon-pick" plain="true"></a>
                                                          <a id="btnClrProductPiker" href="javascript:void(0)" class="easyui-linkbutton ics-pick" iconcls="icon-clear" plain="true"></a>
                                                      </td>
                                                  </tr>*@

                                                  <tr>
                                                      <td style=" width:20%;text-align:right;">
                                                          <label>Invoice Date </label>
                                                      </td>
                                                      <td colspan="3">
                                                          <select id="cboInvoiceDateAdvSearch" style="width:30%;" onchange=" DateActionsInvoiceDateAdvSearch(); "></select>
                                                          <input id="txtFromInvoiceDateAdvSearch" type="text" style="width: 100px;" class="easyui-datebox" required="required" data-options="formatter:icsdateformat,parser:icsdateparser" />To
                                                          <input id="txtToInvoiceDateAdvSearch" type="text" style="width: 100px;" class="easyui-datebox" required="required" data-options="formatter:icsdateformat,parser:icsdateparser" />
                                                      </td>
                                                  </tr>
                                                  <tr>
                                                      <td style=" width:20%;text-align:right;">
                                                          <label>Order Date </label>
                                                      </td>
                                                      <td colspan="3">
                                                          <select id="cboOrderDateAdvS" style="width:30%;" onchange="DateActionsOrderDateAdvSearch();"></select>
                                                          <input id="txtFromOrderDateAdvSearch" type="text" style="width: 100px;" class="easyui-datebox" required="required" data-options="formatter:icsdateformat,parser:icsdateparser" />To
                                                          <input id="txtToOrderDateAdvSearch" type="text" style="width: 100px;" class="easyui-datebox" required="required" data-options="formatter:icsdateformat,parser:icsdateparser" />
                                                      </td>
                                                  </tr>
                                                  <tr>
                                                      <td style=" width:20%;text-align:right;">
                                                          <label>Delivery Date </label>
                                                      </td>
                                                      <td colspan="3">
                                                          <select id="cboDeliveryDateAdvS" style="width:30%;" onchange=" DateActionsDeliveryDateAdvSearch(); "></select>
                                                          <input id="txtFromDeliveryDateAdvSearch" type="text" style="width: 100px;" class="easyui-datebox" required="required" data-options="formatter:icsdateformat,parser:icsdateparser" />To
                                                          <input id="txtToDeliveryDateAdvSearch" type="text" style="width: 100px;" class="easyui-datebox" required="required" data-options="formatter:icsdateformat,parser:icsdateparser" />
                                                      </td>
                                                  </tr>

                                                  <tr>
                                                      <td style=" width:20%;text-align:right;">
                                                          <label>Payment Type </label>
                                                      </td>
                                                      <td style=" width:30%;text-align:left;">
                                                          <select id="cboPaymentType" style="width: 100%;"></select>
                                                      </td>
                                                      <td style=" width:20%;text-align:right;">
                                                          <label>Order Type </label>
                                                      </td>
                                                      <td style=" width:30%;text-align:left;">
                                                          <select id="cboOrderType" style="width: 100%;"></select>
                                                      </td>
                                                  </tr>
                                                  @*<tr>
                                    <td style=" width:20%;text-align:right;">
                                        <label>Bank :</label>
                                    </td>
                                    <td colspan="3">
                                        <select id="cboPIBankAdvSearch" style="width:100%;"></select>
                                    </td>
                                </tr>*@
                                                  <tr>
                                                      <td style=" width:20%;text-align:right;">
                                                          <label>Concern Person </label>
                                                      </td>
                                                      <td colspan="3" style=" width:80%;text-align:left;">
                                                          <select id="cboMkPersonAdvSearch" style="width:100%;"></select>
                                                      </td>
                                                  </tr>



                                                  <tr>
                                                      <td style=" width:20%;text-align:right;">
                                                          <label>Invoice No </label>
                                                      </td>
                                                      <td style=" width:30%;text-align:left;">
                                                          <input id="txtInvoiceNo" type="text" style="width:100%" />
                                                      </td>
                                                      <td style=" width:20%;text-align:right;">
                                                          <label>P/I No </label>
                                                      </td>
                                                      <td style=" width:30%;text-align:left;">
                                                          <input id="txtPINo" type="text" style="width:95%" />
                                                      </td>
                                                  </tr>
                                                  <tr>
                                                      <td style=" width:20%;text-align:right;">
                                                          <label>Order No </label>
                                                      </td>
                                                      <td style=" width:30%;text-align:left;">
                                                          <input id="txtOrderNo" type="text" style="width:100%" />
                                                      </td>
                                                      <td style=" width:20%;text-align:right;">
                                                          <label>Ref No </label>
                                                      </td>
                                                      <td style=" width:30%;text-align:left;">
                                                          <input id="txtRefNoAdvS" type="text" style="width:95%" />
                                                      </td>
                                                  </tr>

                                                  <tr>
                                                      <td style="text-align:right;">
                                                          <label>Status :</label>
                                                      </td>
                                                      <td colspan="3">
                                                          <table id="tblCurrentStatus" class="easyui-datagrid" title="" style="width:100%; height: 130px;" data-options="singleSelect: false,fitColumns:false, rownumbers:true, pagination:false, autoRowHeight:false">
                                                              <thead>
                                                                  <tr>
                                                                      <th data-options="field:'Selected',checkbox:true"></th>
                                                                      <th field="Text" width="80%">Status Name</th>
                                                                  </tr>
                                                              </thead>
                                                          </table>
                                                      </td>
                                                  </tr>
                                                  <tr>
                                                      <td style="text-align:right;"></td>
                                                      <td>
                                                          <input id="chkYetNotAttachWithSalesContract" type="checkbox" style="width:5%;" />
                                                          <label>Yet not Adjust </label>
                                                      </td>
                                                      <td colspan="2" style="text-align:right;">
                                                          <input id="chkYetNotReceiveLC" type="checkbox" style="width:5%;" />
                                                          <label>Yet not Receive L/C</label>
                                                      </td>
                                                  </tr>
                                                  <tr>
                                                      <td height="5px" colspan="4"></td>
                                                  </tr>
                                                  @*<tr>
                                    <td class="btnResetSearch" colspan="4">
                                        <a id="btnSearchAdvSearch" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-search" plain="true">Search</a>
                                        <a id="btnResetAdvSearch" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-reload" plain="true">Reset</a>
                                    </td>
                                </tr>*@
                                              </table>
                                          </fieldset>
                                      </td>
                                  </tr>
                              </table>
                              <fieldset class="actionfieldsetstyle">
                                  <legend> </legend>
                                  <a id="btnResetAdvSearch" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-reload" plain="true">Reset</a>
                                  <a id="btnSearchAdvSearch" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-search" plain="true">Search</a>
                              </fieldset>
                              <fieldset class="actionfieldsetstyle">
                                  <legend>Actions : </legend>
                                  <label class="lblLoadingMessage" style="float: left;">Loading Please Wait...</label>
                                  <a id="btnCloseAdvSearch" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-cancel" plain="true">Close</a>
                              </fieldset>
                          </div>
                      </body>
    <script type="text/javascript">
    var _oSampleInvoiceApproves=[];
    var _sBaseAddress="";
    var _oAuthorizationRolesMapping=[];
    var _oPaymentTypes=[];
    var _oCurrentStatus=[];
    var _sQuery="";
    var _nID=-1;
    var _nReportType=1;
    var _sDateRange="";
    $(document).ready(function () {
        _sBaseAddress =@Html.Raw( new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(HttpContext.Current.Session[SessionInfo.BaseAddress]));
        _oSampleInvoiceApproves =@Html.Raw( new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(Model));
        _oPaymentTypes=@Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(@ViewBag.PaymentTypes));
        _oCurrentStatus=@Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(@ViewBag.CurrentStatus));
        _sMenuID =@Html.Raw( new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(HttpContext.Current.Session[SessionInfo.MenuID]));
        _oCompareOperators = @Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(ViewBag.CompareOperators));
        _sMenuID =@Html.Raw( new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(HttpContext.Current.Session[SessionInfo.MenuID]));
        _nBUID = @Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(ViewBag.BUID));
        _oMktPersons = @Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(ViewBag.MktPersons));
        _oOrderTypes = @Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(ViewBag.OrderTypes));

        RefreshDate()

        _nID =parseInt(sessionStorage.getItem("SelectedRowIndex"));
        var oSampleInvoiceApproves =sessionStorage.getItem("Invoices");
        if(oSampleInvoiceApproves!=null)
        {
            oSampleInvoiceApproves = jQuery.parseJSON(oSampleInvoiceApproves);
            _oSampleInvoiceApproves=oSampleInvoiceApproves;
          
        }
        else
        {
            oSampleInvoiceApproves=_oSampleInvoiceApproves;
        }

        RefreshList(oSampleInvoiceApproves);

        if(_nID!=-1)
        {
            $('#tblSampleInvoiceApproves').datagrid('selectRow', _nID);
        }

        DynamicRefreshList(_oCurrentStatus, 'tblCurrentStatus');
        $("#progressbar").progressbar({ value: 0 });
        $("#progressbarParent").hide();
        $(".lblLoadingMessage").hide();
        LoadComboAdv();
    });

    function RefreshDate()
    {
        $('#txtStartDate').datebox('setValue', icsdateformat(new Date()));
        $('#txtStartDateTwo').datebox('setValue', icsdateformat(new Date()));

    }

    $("#btnShowDetail").click(function(){

        _sDateRange=sessionStorage.getItem("DateRange")
        _sQuery=sessionStorage.getItem("sQuery");
        sessionStorage.clear();
        var oInvoices= $('#tblSampleInvoiceApproves').datagrid('getRows');
        sessionStorage.setItem("Invoices", JSON.stringify(oInvoices));
        sessionStorage.setItem("DateRange", _sDateRange);
        sessionStorage.setItem("BackLink", window.location.href);
        sessionStorage.setItem("sQuery", _sQuery);
        window.location.href = _sBaseAddress+  "/SampleInvoiceApprove/ViewSampleInvoiceApproves?sTemp="+_sQuery;
    });



    $("#btnPrintSampleInvoiceApproveExcel").click(function () {
       
        _sQuery=sessionStorage.getItem("sQuery");
        window.open(_sBaseAddress+'/SampleInvoiceApprove/PrintSampleInvoiceApproveExcel?Params='+_sQuery, "_blank");  // Params name must be same in the controller
    });

    $("#btnSearchByDate").click(function () {
        _nReportType=1;
        var oSampleInvoiceApprove= {
            SampleInvoiceDate:$('#txtStartDate').datebox('getValue'),
            EndDate:$('#txtStartDate').datebox('getValue'),
            DateType:1,
            ReportType:_nReportType
        };
        Search(oSampleInvoiceApprove);
    });

    $("#btnSearchByDateTwo").click(function () {

        _nReportType=2;

        var oSampleInvoiceApprove= {
            SampleInvoiceDate:$('#txtStartDateTwo').datebox('getValue'),
            EndDate:$('#txtStartDateTwo').datebox('getValue'),
            DateType:1,
            ReportType:_nReportType
        };
        Search(oSampleInvoiceApprove);
    });

    function Search(oSampleInvoiceApprove)
    {

        $.ajax
          ({
              type: "POST",
              dataType: "json",
              url : _sBaseAddress+  "/SampleInvoiceApprove/GetsByDate",
              data:  JSON.stringify(oSampleInvoiceApprove),
              contentType: "application/json; charset=utf-8",
              success: function (data) {
                  var oSampleInvoiceApproves = jQuery.parseJSON(data);
                  debugger;
                  if(oSampleInvoiceApproves.length<=0 || oSampleInvoiceApproves == null)
                  {
                      if(_nReportType==1)
                      {
                          DynamicRefreshList([],"tblSampleInvoiceApproves");
                      }
                      else{
                          DynamicRefreshList([],"tblSampleInvoiceApprove_ProductWise");
                      }
                      alert("Data not found");
                      return;
                  }
                  else
                  {
                      _oSampleInvoiceApproves = oSampleInvoiceApproves;
                      RefreshList(oSampleInvoiceApproves);
                      if(_nReportType==1)
                      {
                          RefreshSummary();
                      }
                      else{
                          RefreshSummaryTwo();
                      }

                  }
                  $(".lblLoadingMessage").hide();
              },
              error: function (xhr, status, error)
              {
                  alert(error);
              }
          });
    }
    //pppp
    function RefreshSummary()
    {
        //debugger;
        var oSampleInvoiceApproves = $('#tblSampleInvoiceApproves').datagrid('getRows');

        if (oSampleInvoiceApproves.length>0)
        {

            var TotalQty=0.0;
            var TotalAmount=0.0;
            var TotalOutstanding=0.0;
            var FloatTotalOutstanding=0.0;

            for (var i = 0; i < oSampleInvoiceApproves.length; i++) {
                TotalQty  = TotalQty + oSampleInvoiceApproves[i].Qty;
                TotalAmount =TotalAmount + oSampleInvoiceApproves[i].Amount ;
                TotalOutstanding =0;

            }

            TotalQty = parseFloat(TotalQty).toFixed(2);
            TotalAmount =parseFloat(TotalAmount).toFixed(2);
            FloatTotalOutstanding =parseFloat(TotalOutstanding).toFixed(2);

            var oGrandTotalSampleInvoiceApprove= {
                SampleInvoiceNo:"Total",
                QtySt : formatPrice(TotalQty),
                UnitPriceSt :formatPrice(TotalAmount/TotalQty),
                AmountSt :formatPrice(TotalAmount),
                SampleInvoiceID:0,
                OutstandingInSt :"0~0"
            };
            $('#tblSampleInvoiceApproves').datagrid('appendRow',oGrandTotalSampleInvoiceApprove);
        }

    }
    function RefreshSummaryTwo()
    {
        //debugger;
        var oSampleInvoiceApproves = $('#tblSampleInvoiceApprove_ProductWise').datagrid('getRows');

        if (oSampleInvoiceApproves.length>0)
        {

            var TotalQty=0.0;
            var TotalAmount=0.0;
            var TotalOutstanding=0.0;
            var FloatTotalOutstanding=0.0;

            for (var i = 0; i < oSampleInvoiceApproves.length; i++) {
                TotalQty  = TotalQty + oSampleInvoiceApproves[i].Qty;
                TotalAmount =TotalAmount + oSampleInvoiceApproves[i].Amount ;
                TotalOutstanding =0;

            }

            TotalQty = parseFloat(TotalQty).toFixed(2);
            TotalAmount =parseFloat(TotalAmount).toFixed(2);
            FloatTotalOutstanding =parseFloat(TotalOutstanding).toFixed(2);

            var oGrandTotalSampleInvoiceApprove= {
                SampleInvoiceNo:"Total",
                QtySt : formatPrice(TotalQty),
                UnitPriceSt :formatPrice(TotalAmount/TotalQty),
                AmountSt :formatPrice(TotalAmount),
                SampleInvoiceID:0,
                OutstandingInSt :"0~0"
            };
            $('#tblSampleInvoiceApprove_ProductWise').datagrid('appendRow',oGrandTotalSampleInvoiceApprove);
        }

    }

    function RefreshList(oSampleInvoiceApproves)
    {
        if(_nReportType==1)
        {
            var data=oSampleInvoiceApproves;
            data={"total":""+data.length+"","rows":data};
            $('#tblSampleInvoiceApproves').datagrid('loadData',data);
           
        }
        else{
            var data=oSampleInvoiceApproves;
            data={"total":""+data.length+"","rows":data};
            $('#tblSampleInvoiceApprove_ProductWise').datagrid('loadData',data);
           
        }

    }

    function FormatStyle(value){
        var values=value.split("~");
        var nInvID = values[0];
        var sOustValue = values[1];
        var s = '<label id="lblOpening~'+nInvID+'" style="color:Blue;cursor:pointer" class="lblOpening'+nInvID+'" onclick="ShowDetail('+nInvID+')">'+sOustValue+'</label>';
        return s;
    }
    function ShowDetail(nInvID)
    {
        var oPC= $('#tblSampleInvoiceApproves').datagrid('getSelected');
        if(nInvID==null || nInvID<=0)
        {
            alert("Please select a item from list!");
            return;
        }

        var oPCs= $('#tblSampleInvoiceApproves').datagrid('getRows');

        for (i = 0; i < oPCs.length; ++i)
        {
            if(oPCs[i].SampleInvoiceID==nInvID)
            {
                oPC=oPCs[i];
                break;
            }
        }

        var SelectedRowIndex=$('#tblSampleInvoiceApproves').datagrid('getRowIndex',oPC);
        var oPCs= $('#tblSampleInvoiceApproves').datagrid('getRows');
        sessionStorage.setItem("Invoices", JSON.stringify(oPCs));
        sessionStorage.setItem("SelectedRowIndex", SelectedRowIndex);
        sessionStorage.setItem("PCHeader", "Show Outstanding For Party: "+oPC.ContractorName);
        sessionStorage.setItem("BackLink", window.location.href);
        sessionStorage.setItem("sQuery", _sQuery);
        window.location.href = _sBaseAddress+  "/SampleInvoiceApprove/ViewRPT_PartyOutStanding?nConID="+oPC.ContractorID;
    }
    $("#btnApprove").click(function(){

      
       
        var oSampleInvoice= $('#tblSampleInvoiceApproves').datagrid('getSelected');
        if(oSampleInvoice==null || oSampleInvoice.SampleInvoiceID<=0)
        {
            alert("Please select a item from list!");
            return;
        }
        var SelectedRowIndex=$('#tblSampleInvoiceApproves').datagrid('getRowIndex',oSampleInvoice);
        var oInvoices= $('#tblSampleInvoiceApproves').datagrid('getRows');
        sessionStorage.setItem("Invoices", JSON.stringify(oInvoices));
        sessionStorage.setItem("SelectedRowIndex", SelectedRowIndex);
        sessionStorage.setItem("Header", "Approved");
        sessionStorage.setItem("BackLink", window.location.href);
        window.location.href = _sBaseAddress+  "/SampleInvoice/ViewSampleInvoiceApproved?id="+oSampleInvoice.SampleInvoiceID;

    });

    $("#btnCancel").click(function(){

       

        var oSampleInvoice= $('#tblSampleInvoiceApproves').datagrid('getSelected');
        if(oSampleInvoice==null || oSampleInvoice.SampleInvoiceID<=0)
        {
            alert("Please select a item from list!");
            return;
        }
        var SelectedRowIndex=$('#tblSampleInvoiceApproves').datagrid('getRowIndex',oSampleInvoice);
        var oInvoices= $('#tblSampleInvoiceApproves').datagrid('getRows');
        sessionStorage.setItem("Invoices", JSON.stringify(oInvoices));
        sessionStorage.setItem("SelectedRowIndex", SelectedRowIndex);
        sessionStorage.setItem("Header", "Cancel");
        sessionStorage.setItem("BackLink", window.location.href);
        window.location.href = _sBaseAddress+  "/SampleInvoice/ViewSampleInvoiceApproved?id="+oSampleInvoice.SampleInvoiceID;
    });

    /*.......... Searching ............. */


        /*------------------------------------*/
         
    ////Start adv Searching

    function updateProgress() {
        var value =$('#progressbar').progressbar('getValue');
        if (value < 96){
            value += Math.floor(Math.random() * 10);
            $('#progressbar').progressbar('setValue', value);
        }
    }
    function hideShow(miliseconds) {
        $("#progressbarParent").hide();
    }
    //Account Of Picker

    $("#txtContractorAdvS").keydown(function (e) {
        if (e.keyCode === 13) // Enter Press
        {
            PickContractors_AdvS();
        }
        else if (e.keyCode === 08) {
            $("#txtContractorAdvS").removeClass("fontColorOfPickItem");
            _sContractorIds = '';
        }
    });

    $("#btnClrContractorAdvS").click(function () {
        $("#txtContractorAdvS").removeClass("fontColorOfPickItem");
        $("#txtContractorAdvS").val("");
        _sContractorIds = '';
    });

    $("#btnPickContractorAdvS").click(function () {
        PickContractors_AdvS();
    });
    $("#txtSearchByAccountNamePickerAdvSearch").keydown(function (e) {
        var obj = {
            Event: e,
            SearchProperty: "Name",
            GlobalObjectList: _oAccountsOf,
            TableId: "tblAccountsPickerAdvSearch"
        };
        $('#txtSearchByAccountNamePickerAdvSearch').icsSearchByText(obj);
    });
    //End Account Of Picker
    $("#txtDeliverToAdvS").keydown(function (e) {
        if (e.keyCode === 13) // Enter Press
        {
            PickDeliverTo_AdvS();
        }
        else if (e.keyCode === 08) {
            $("#txtDeliverToAdvS").removeClass("fontColorOfPickItem");
            _sDeliverToIDs ="";
        }
    });

    $("#btnClrDeliverToAdvS").click(function () {
        $("#txtDeliverToAdvS").removeClass("fontColorOfPickItem");
        $("#txtDeliverToAdvS").val("");
        _sDeliverToIDs ="";
    });

    $("#btnPickDeliverToAdvS").click(function () {
        PickDeliverTo_AdvS();
    });

    //Product Pick
    $("#txtProductName").keydown(function (e) {
        debugger;
        var code = (e.keyCode ? e.keyCode : e.which);
        if (code == 13) // Enter Press
        {
            if($('#txtProductName').val()==null || $('#txtProductName').val()=="")
            {
                alert("Please Type Product and Press Enter.");
                $('#txtProductName').focus();
                return;
            }
            PickProduct($('#txtProductName').val());
        }
        if (code == 8) //backspace=8
        {
            //debugger;
            $("#txtProductName").removeClass("fontColorOfPickItem");
            _sProductIds= [];
        }
    });
    $("#btnProductPiker").click(function () {
        PickProduct("");
    });
    $("#btnClrProductPiker").click(function () {
        $("#txtProductName").val('');
        $("#txtProductName").removeClass("fontColorOfPickItem");
        _sProductIds= [];
    });
    function PickProduct(sProductName)
    {
        var oProduct = { BUID:sessionStorage.getItem("BUID"),ProductName:sProductName};
        var obj = {
            BaseAddress: _sBaseAddress,
            Object: oProduct,
            ControllerName: "Product",
            ActionName: "SearchByProductBUWise",
            IsWinClose: false
        };
        $.icsDataGets(obj, function (response) {
            debugger;
            if (response.status && response.objs.length > 0) {
                if (response.objs[0].ProductID > 0) {
                    var tblColums = [];
                    var oColumn = { field: "ProductCode", title: "Code", width: 100, align: "left" }; tblColums.push(oColumn);
                    oColumn = { field: "ProductName", title: "Name", width: 300, align: "left" }; tblColums.push(oColumn);
                    oColumn = { field: "MUnit", title: "Unit", width: 70, align: "left" }; tblColums.push(oColumn);
                    var oPickerParam = {
                        winid: 'winProductPicker',
                        winclass: 'clsProductPicker',
                        winwidth: 600,
                        winheight: 460,
                        tableid: 'tblProductPicker',
                        tablecolumns: tblColums,
                        datalist: response.objs,
                        multiplereturn: true,
                        searchingbyfieldName: 'NameCode',
                        windowTittle: 'Product List'
                    };
                    $.icsPicker(oPickerParam);
                    IntializePickerbutton(oPickerParam);
                }
                else {
                    alert(response.objs[0].ErrorMessage);
                }

            }else{
                alert("Data Not Found.");
            }
        });
    }


    //End Buyer Search
    $("#btnResetAdvSearch").click(function () {
        ResetAdvSearchWindow();
        DateActionsOrderDateAdvSearch();
        DateActionsInvoiceDateAdvSearch();
        DateActionsDeliveryDateAdvSearch();
        DateActionsStatusDateAdvSearch();
    });

    $("#btnSearchAdvSearch").click(function () {
        debugger;

        $(".lblLoadingMessage").show();

        var checkDate = CheckFromAndToDateValidation("cboOrderDateAdvS", "txtFromOrderDateAdvSearch", "txtToOrderDateAdvSearch");
        if (!checkDate) {
            alert("Start date must be greater than end date.");
            return false;
        }
        checkDate = CheckFromAndToDateValidation("cboInvoiceDateAdvSearch", "txtFromOrderDateAdvSearch", "txtToInvoiceDateAdvSearch");
        if (!checkDate) {
            alert("Start date must be greater than end date.");
            return false;
        }
        checkDate = CheckFromAndToDateValidation("cboDeliveryDateAdvS", "txtFromDeliveryDateAdvSearch", "txtToDeliveryDateAdvSearch");
        if (!checkDate) {
            alert("Start date must be greater than end date.");
            return false;
        }


        //var nContractorID = parseInt(_sContractorIds);
        //var nBuyerID = parseInt(_sDeliverToIDs);
        var nCboOrderDate = parseInt($("#cboOrderDateAdvS").val());
        var dFromOrderDate = $('#txtFromOrderDateAdvSearch').datebox('getValue');
        var dToOrderDate = $('#txtToOrderDateAdvSearch').datebox('getValue');

        var ncboInvoiceDate = parseInt($("#cboInvoiceDateAdvSearch").val());
        var dFromInvoiceDate = $('#txtFromInvoiceDateAdvSearch').datebox('getValue');
        var dToInvoiceDate = $('#txtToInvoiceDateAdvSearch').datebox('getValue');

        var ncboDeliveryDate = parseInt($("#cboDeliveryDateAdvS").val());
        var dFromDeliveryDate = $('#txtFromDeliveryDateAdvSearch').datebox('getValue');
        var dToDeliveryDate = $('#txtToDeliveryDateAdvSearch').datebox('getValue');

        var ncboPaymentType = parseInt($("#cboPaymentType").val());
        var nCboMkPerson = parseInt($("#cboMkPersonAdvSearch").val());
        var nOrderType = parseInt($("#cboOrderType").val());

        var sPINo = $.trim($("#txtPINo").val());
        var sInvoiceNo = $.trim($("#txtInvoiceNo").val());
        var sOrderNo = $.trim($("#txtOrderNo").val());
        var sRefNo = $.trim($("#txtRefNoAdvS").val());

        var bYetNotAttachWithSalesContract = $("#chkYetNotAttachWithSalesContract").is(':checked');
        var bYetNotReceiveLC = $("#chkYetNotReceiveLC").is(':checked');

        var nOrderTypeFixec =2;

        var sParams = _sContractorIds + "~" +
                      _sDeliverToIDs + "~" +
                      nCboOrderDate + "~" +
                      dFromOrderDate + "~" +
                      dToOrderDate + "~" +
                      ncboInvoiceDate + "~" +
                      dFromInvoiceDate + "~" +
                      dToInvoiceDate + "~" +
                      ncboDeliveryDate + "~" +
                      dFromDeliveryDate + "~" +
                      dToDeliveryDate + "~" +
                      nCboMkPerson + "~" +
                      ncboPaymentType + "~" +
                      nOrderType + "~" +
                      sPINo+"~"+
                      //sInvoiceNo+"~"+
                      //sOrderNo+"~"+
                      //sRefNo+"~"+
                      // _sProductIds+"~"+
                      //bYetNotAttachWithSalesContract + "~" +
                      //bYetNotReceiveLC + "~" +
                      //nOrderTypeFixec + "~" +
                      _nBUID;
        var sCboMkPerson="";
        if(nCboMkPerson>0)
        {
            sCboMkPerson=nCboMkPerson;
        }

        var oSampleInvoiceApprove= {
            SampleInvoiceDate:$('#txtFromInvoiceDateAdvSearch').datebox('getValue'),
            EndDate:$('#txtToInvoiceDateAdvSearch').datebox('getValue'),
            DateType:ncboInvoiceDate,
            ContractorName:_sContractorIds,
            MKTPName:sCboMkPerson,
            SampleInvoiceNo:sInvoiceNo,
            ReportType:_nReportType,
            ErrorMessage : sParams
        };
        Search(oSampleInvoiceApprove);
        $("#winAdvSearch").icsWindow("close");
    });

    function LoadComboAdv()
    {
        $("#cboOrderType").icsLoadCombo({
            List: _oOrderTypes,
            OptionValue: "id",
            DisplayText: "Value"
        });
        $("#cboPaymentType").icsLoadCombo({
            List: _oPaymentTypes,
            OptionValue: "Value",
            DisplayText: "Text"
        });
        $("#cboOrderDateAdvS, #cboInvoiceDateAdvSearch, #cboDeliveryDateAdvS").icsLoadCombo({
            List: _oCompareOperators,
            OptionValue: "id",
            DisplayText: "Value"
        });
        $("#cboMkPersonAdvSearch").icsLoadCombo({
            List: _oMktPersons,
            OptionValue: "EmployeeID",
            DisplayText: "Name"
        });
    }
    function CheckFromAndToDateValidation(OperationComboId, FromDateId, ToDateId) {
        $("#" + OperationComboId).parent().parent().parent().find("select").removeClass("errorFieldBorder");
        var nCboVal = $("#" + OperationComboId).val();
        if (parseInt(nCboVal) == 5 || parseInt(nCboVal) == 6) {
            var fromDate = $("#" + FromDateId).datebox("getValue");
            var toDate = $("#" + ToDateId).datebox("getValue");
            if (new Date(fromDate) > new Date(toDate)) {
                $("#" + ToDateId).focus();
                $("#" + OperationComboId).addClass("errorFieldBorder");
                $(".lblLoadingMessage").hide();
                return false;
            } else {
                $("#" + OperationComboId).removeClass("errorFieldBorder");
                return true;
            }
        } else {
            return true;
        }
    }

    function ResetAdvSearchWindow() {
        _sContractorIds = '';
        _sDeliverToIDs = "";
        $("#winAdvSearch input").not("input[type='button']").val("");
        $("#winAdvSearch input").removeClass("fontColorOfPickItem");
        $("#winAdvSearch select").val(0);
        DateActionsOrderDateAdvSearch();
        DateActionsInvoiceDateAdvSearch();
        DateActionsDeliveryDateAdvSearch();
        $("#txtFromOrderDateAdvSearch,#txtToOrderDateAdvSearch,#txtFromInvoiceDateAdvSearch,#txtToInvoiceDateAdvSearch,#txtFromDeliveryDateAdvSearch,#txtToDeliveryDateAdvSearch").datebox({ disabled: true });
        $("#txtFromOrderDateAdvSearch,#txtToOrderDateAdvSearch,#txtFromInvoiceDateAdvSearch,#txtToInvoiceDateAdvSearch,#txtFromDeliveryDateAdvSearch,#txtToDeliveryDateAdvSearch").datebox("setValue", icsdateformat(new Date()));
    }

    function PickContractors_AdvS() {
        debugger;
        var oContractor = {
            Params: '2,3' + '~' + $.trim($("#txtContractorAdvS").val()+"~"+_nBUID)
        };
        var obj = {
            BaseAddress: _sBaseAddress,
            Object: oContractor,
            ControllerName: "Contractor",
            ActionName: "ContractorSearchByNameType",
            IsWinClose: false
        };

        $("#progressbar").progressbar({ value: 0 });
        $("#progressbarParent").show();
        var intervalID = setInterval(updateProgress, 250);

      
        $.icsDataGets(obj, function (response) {
            clearInterval(intervalID);
            $("#progressbarParent").hide();
            if (response.status && response.objs.length > 0) {
                if (response.objs[0].ContractorID > 0) {
                    var tblColums = []; var oColumn = { field: "ContractorID", title: "Code", width: 50, align: "left" }; tblColums.push(oColumn);
                    oColumn = { field: "Name", title: "Name", width: 280, align: "left" }; tblColums.push(oColumn);

                    var oPickerParam = {
                        winid: 'winContractorPicker',
                        winclass: 'clsAccountOf',
                        winwidth: 400,
                        winheight: 460,
                        tableid: 'tblAccountOfs',
                        tablecolumns: tblColums,
                        datalist: response.objs,
                        multiplereturn: true,
                        searchingbyfieldName: 'Name',
                        windowTittle: 'Contactor List'
                    };
                    $.icsPicker(oPickerParam);
                    IntializePickerbutton(oPickerParam);
                }
                else {
                    alert(response.objs[0].ErrorMessage);
                }
            }
            else {
                alert("Sorry, No Contactor Found.");
            }
        });
    }

    function PickDeliverTo_AdvS() {
        var oContractor = {
            Params: '2' + '~' + $.trim($("#txtDeliverToAdvS").val()+"~"+_nBUID)
        };
        var obj = {
            BaseAddress: _sBaseAddress,
            Object: oContractor,
            ControllerName: "Contractor",
            ActionName: "ContractorSearchByNameType",
            IsWinClose: false
        };
        $("#progressbar").progressbar({ value: 0 });
        $("#progressbarParent").show();
        var intervalID = setInterval(updateProgress, 250);
        DynamicRefreshList([], "tblContractorsPickerAdvSearch");
        $.icsDataGets(obj, function (response) {
            clearInterval(intervalID);
            $("#progressbarParent").hide();
            if (response.status && response.objs.length > 0) {
                if (response.objs[0].ContractorID > 0) {
                    var tblColums = []; var oColumn = { field: "ContractorID", title: "Code", width: 50, align: "left" }; tblColums.push(oColumn);
                    oColumn = { field: "Name", title: "Name", width: 280, align: "left" }; tblColums.push(oColumn);
                    var oPickerParam = {
                        winid: 'winBuyers',
                        winclass: 'clsBuyer',
                        winwidth: 400,
                        winheight: 460,
                        tableid: 'tblBuyers',
                        tablecolumns: tblColums,
                        datalist: response.objs,
                        multiplereturn: true,
                        searchingbyfieldName: 'Name',
                        windowTittle: 'Buyer List'
                    };
                    $.icsPicker(oPickerParam);
                    IntializePickerbutton(oPickerParam);
                }
                else {
                    alert(response.objs[0].ErrorMessage);
                }
            }
            else {
                alert("Sorry, No Contactor Found.");
            }
        });
    }

    function DateActionsOrderDateAdvSearch() {
        DynamicDateActions("cboOrderDateAdvS", "txtFromOrderDateAdvSearch", "txtToOrderDateAdvSearch");
    }
    function DateActionsInvoiceDateAdvSearch() {
        DynamicDateActions("cboInvoiceDateAdvSearch", "txtFromInvoiceDateAdvSearch", "txtToInvoiceDateAdvSearch");
    }
    function DateActionsDeliveryDateAdvSearch() {
        DynamicDateActions("cboDeliveryDateAdvS", "txtFromDeliveryDateAdvSearch", "txtToDeliveryDateAdvSearch");
    }

    $("#btnCloseAdvSearch").click(function () {
        $("#winAdvSearch").icsWindow("close");
    });
    $("#btnAdvSearch").click(function () {
        debugger;
        _nReportType=1;
        $("#winAdvSearch").icsWindow("open", "Sample Invoice Advance Search");
        //DynamicRefreshList([], "tblExportPIAdvSearch");
        DynamicResetAdvSearchWindow("winAdvSearch");
        DynamicDateActions("cboDateOptionAdvSearch", "txtFromDateAdvSearch", "txtToDateAdvSearch");
        DynamicDateActions("cboInvoiceDateAdvSearch", "txtFromInvoiceDateAdvSearch", "txtToInvoiceDateAdvSearch");
        DynamicDateActions("cboDeliveryDateAdvS", "txtFromDeliveryDateAdvSearch", "txtToDeliveryDateAdvSearch");
        ResetAdvSearchWindow();
    });

    $("#btnAdvSearchTwo").click(function () {
        debugger;
        _nReportType=2;
        $("#winAdvSearch").icsWindow("open", "Sample Invoice Advance Search");
        //DynamicRefreshList([], "tblExportPIAdvSearch");
        DynamicResetAdvSearchWindow("winAdvSearch");
        DynamicDateActions("cboDateOptionAdvSearch", "txtFromDateAdvSearch", "txtToDateAdvSearch");
        DynamicDateActions("cboInvoiceDateAdvSearch", "txtFromInvoiceDateAdvSearch", "txtToInvoiceDateAdvSearch");
        DynamicDateActions("cboDeliveryDateAdvS", "txtFromDeliveryDateAdvSearch", "txtToDeliveryDateAdvSearch");
        ResetAdvSearchWindow();
    });

    function IntializePickerbutton(oPickerobj) {
        $("#" + oPickerobj.winid).find("#btnOk").click(function () {
            SetPickerValueAssign(oPickerobj);
        });
        $(document).find('.' + oPickerobj.winclass).keydown(function (e) {
            if (e.which === 13) {
                SetPickerValueAssign(oPickerobj);
            }
        });
    }

    function SetPickerValueAssign(oPickerobj) {
        var oreturnObj = null, oreturnObjs = [];
        if (oPickerobj.multiplereturn) {
            oreturnObjs = $('#' + oPickerobj.tableid).datagrid('getChecked');
        } else {
            oreturnObj = $('#' + oPickerobj.tableid).datagrid('getSelected');
        }

        if (oPickerobj.winid == 'winContractorPicker')
        {
            if (oreturnObjs != null && oreturnObjs.length> 0)
            {

                _sContractorIds=''; var sMessage='';
                sMessage=(oreturnObjs.length>1)? oreturnObjs.length +" Contractors Selected" : oreturnObjs[0].Name;
                $('#txtContractorAdvS').val(sMessage);
                $("#txtContractorAdvS").addClass("fontColorOfPickItem");

                for(var i=0;i<oreturnObjs.length;i++){
                    _sContractorIds=_sContractorIds+oreturnObjs[i].ContractorID+',';
                }
                _sContractorIds=_sContractorIds.substring(0,_sContractorIds.length-1);

            }
            else
            {
                alert("Please select a contractor.");
                return false;
            }
        }

        else if (oPickerobj.winid == 'winBuyers') {
            if (oreturnObjs != null && oreturnObjs.length> 0)
            {
                _sDeliverToIDs='';
                var sMessage='';
                sMessage=(oreturnObjs.length>1)? oreturnObjs.length +" Contractors Selected" : oreturnObjs[0].Name;
                $('#txtDeliverToAdvS').val(sMessage);
                $("#txtDeliverToAdvS").addClass("fontColorOfPickItem");

                for(var i=0;i<oreturnObjs.length;i++){
                    _sDeliverToIDs=_sDeliverToIDs+oreturnObjs[i].ContractorID+',';
                }
                _sDeliverToIDs=_sDeliverToIDs.substring(0,_sDeliverToIDs.length-1);



            }
            else
            {
                alert("Please select a buyer.");
                return false;
            }
        }
        else if (oPickerobj.winid == 'winProductPicker')
        {
            if (oreturnObjs!= null && oreturnObjs.length> 0)
            {
                _sProductIds=''; var sMessage='';
                sMessage=(oreturnObjs.length>1)? oreturnObjs.length +" ProductName Selected" : oreturnObjs[0].ProductName;
                $('#txtProductName').val(sMessage);
                $("#txtProductName").addClass("fontColorOfPickItem");

                for(var i=0;i<oreturnObjs.length;i++){
                    _sProductIds=_sProductIds+oreturnObjs[i].ProductID+',';
                }
                _sProductIds=_sProductIds.substring(0,_sProductIds.length-1);

            }
            else
            {
                alert("Please select a Product.");
                return false;
            }

        }
        $("#" + oPickerobj.winid).icsWindow("close");
        $("#" + oPickerobj.winid).remove();
    }
    /// end Adv Searching


    </script>
