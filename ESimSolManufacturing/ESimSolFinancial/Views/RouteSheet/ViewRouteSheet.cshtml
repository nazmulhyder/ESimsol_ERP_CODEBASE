@{
    ViewBag.Title = "Dyeing Card";
}
<body>

    @model ESimSol.BusinessObjects.RouteSheet
    <div id="progressbarParent" style="width:100%;height:100%;margin:0 auto;text-align:center; margin-left: auto;margin-right: auto;left: 0;right: 0;z-index: 1;">
        <div style="margin: 0px auto;margin-top: 251px;text-align:center;width:390px;">
            <label style="font-size:18px;">Please wait</label>
            <div id="progressbar" style="width:100%;height:37px;"></div>
        </div>
    </div>

    <div class="menuMainCollectionTable">
        <div id="tabRS" class="easyui-tabs" style="width:100%; height:100%">
            <div title="Dyeing Card Entry" id="divOne" style="width:100%;height:100%">
                <div style="width:100%;height:88%">
                    <fieldset>
                        <legend style="font-weight:bold"> Order info </legend>
                        <table border="1" style="width:100% ;height:210px">
                            <tr>
                                <td style="width:60% ;height:200px">
                                    <table style="width:100% ;height:200px;">
                                        <tr>
                                            <td style="width: 15%; text-align: right">
                                                Lab dip No:
                                            </td>
                                            <td style="width:30%">
                                                <input id="txtLabdipNo" type="text" class="reset-text" placeholder="Search by Lab dip No" style="width: 60%" />
                                                <a id="btnPickLabdipNo" href="javascript:void(0)" class="easyui-linkbutton ics-pick" iconcls="icon-pick" plain="true"></a>
                                                <a id="btnResetLabdipNo" href="javascript:void(0)" class="easyui-linkbutton ics-pick" iconcls="icon-clear" plain="true"></a>
                                            </td>
                                            <td style="width: 15%; text-align: right">
                                                Color No:
                                            </td>
                                            <td style="width:40%">
                                                <input id="txtColorNo" type="text" class="reset-text" placeholder="Search by Color No" style="width: 65%" />
                                                <a id="btnPickColorNo" href="javascript:void(0)" class="easyui-linkbutton ics-pick" iconcls="icon-pick" plain="true"></a>
                                                <a id="btnResetColorNo" href="javascript:void(0)" class="easyui-linkbutton ics-pick" iconcls="icon-clear" plain="true"></a>
                                            </td>
                                        </tr>
                                        <tr>
                                            <td style="width: 15%; text-align: right">
                                                <label>Order Type</label>
                                            </td>
                                            <td style="width:30%">
                                                <select id="cboOrderType" onchange="ChangeOrderType()" style="width:80%"></select>
                                            </td>
                                            <td style="width: 15%; text-align: right">
                                                <span class="lblOrderNo"></span>
                                            </td>
                                            <td style="width:40%">
                                                <input id="txtOrderNo" type="text" class="reset-text" placeholder="Search by Order No" style="width: 65%" />
                                                <a id="btnPickOrderNo" href="javascript:void(0)" class="easyui-linkbutton ics-pick" iconcls="icon-pick" plain="true"></a>
                                                <a id="btnResetOrderNo" href="javascript:void(0)" class="easyui-linkbutton ics-pick" iconcls="icon-clear" plain="true"></a>
                                            </td>
                                        </tr>
                                        <tr>
                                            <td colspan="4" style="width: 100%; text-align: right">

                                                <table id="tblRouteSheetDO" class="easyui-datagrid" style="width:99%;height:150px;"
                                                       data-options="singleSelect: true,fitColumns:false, rownumbers:false, pagination:false, autoRowHeight:false, toolbar: '#toolbarRSDO',onClickRow:onClickRow ">
                                                    <thead>
                                                        <tr>
                                                            <th field="OrderNoFull" width="20%" align="left">Order No</th>
                                                            <th data-options="field:'Qty_RS',align:'right',editor:{type:'numberbox',options:{precision:2}}" width="15%"> <label>Qty</label><span class="lblMUnit"></span></th>
                                                            <th data-options="field:'Qty_RSKG',align:'right',editor:{type:'numberbox',options:{precision:8}}" width="15%"><label>Qty</label><span class="lblMUnitTwo"></span></th>
                                                            <th field="OrderQty" width="15%" align="right" formatter="formatPrice">Order Qty<span class="lblMUnit"></span></th>
                                                            <th field="OrderQtyKG" width="15%" align="right" formatter="formatPrice">Order Qty(<span class="lblMUnitTwo"></span></th>
                                                            <th field="Qty_Pro" width="15%" align="right" formatter="formatPrice">Alredy Qty Pro<span class="lblMUnit"></span></th>
                                                            <th field="ClaimOrderNo" width="15%" align="left"> Order No</th>
                                                        </tr>
                                                    </thead>
                                                </table>
                                                <div id="toolbarRSDO">
                                                    <a id="btnDeleteRSDO" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-remove" plain="true"></a>
                                                    <a id="btnRefreshRSDO" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-reload" plain="true">Refresh</a>
                                                </div>
                                                <div style="float:left; width:100%;">
                                                    <div style="float:left; width:10%;" class="align-right">
                                                        <b>Total</b>
                                                    </div>
                                                    <div style="float:left; width:20%;" class="align-right">
                                                        <label id="lblQty_RS">0</label>
                                                    </div>
                                                    <div style="float:left; width:16%;" class="align-right">
                                                        <label id="lblQty_RSKG">0</label>
                                                    </div>
                                                    @*<div style="float:left; width:20%;" class="align-right">
                                                            <span class="lblCurrencyTwo"></span>  <label id="lbl-td-TotalAmount">0</label>
                                                        </div>*@
                                                    <div style="float:left; width:20%;" class="align-right">
                                                        <label id="lblOrderQty">0</label>
                                                    </div>
                                                    <div style="float:left; width:16%;" class="align-right">
                                                        <label id="lblOrderQtyKG">0</label>
                                                    </div>
                                                </div>
                                            </td>
                                        </tr>

                                    </table>

                                </td>
                                <td style="width:40% ;height:200px">

                                    <table border="0" style="width:100% ;height:200px">

                                        <tr>
                                            <td style="width: 20%; text-align: right">
                                                <label id="lblRSNo">Dye Line No:</label>
                                            </td>
                                            <td style="width: 80%; text-align: left">
                                                <input type="text" id="txtRouteSheetNo" placeholder="16-0000" disabled="disabled" class="reset-text txt-styler" />
                                            </td>
                                        </tr>
                                        <tr>
                                            <td style="width: 20%; text-align: right">
                                                <label>Date:</label>
                                            </td>
                                            <td style="width: 80%; text-align: left">
                                                <input id="dtOrderDate" type="text" class="easyui-datebox" style="width:80%;" data-options="formatter:icsdateformat,parser:icsdateparser" />
                                            </td>
                                        </tr>
                                        <tr>
                                            <td style="width: 20%; text-align: right">
                                                <label>Buyer:</label>
                                            </td>
                                            <td style="width: 80%; text-align: left">
                                                <input type="text" id="txtBuyerName" class="reset-text txt-styler type-diabaled" disabled />
                                            </td>

                                        </tr>
                                        <tr>
                                            <td style="width: 20%; text-align: right">
                                                <label>Yarn:</label>
                                            </td>
                                            <td style="width: 80%; text-align: left">
                                                <input id="txtProductPTU" class="reset-text txt-styler type-diabaled" disabled />
                                            </td>
                                        </tr>
                                        <tr>
                                            <td style="width: 20%; text-align: right">
                                                <label>Shade:</label>
                                            </td>
                                            <td style="width: 30%; text-align: left">
                                                <input type="text" id="txtColorShade" class="reset-text txt-styler type-diabaled" disabled />
                                            </td>

                                        </tr>
                                        <tr>
                                            <td style="width: 20%; text-align: right">
                                                <label>Pro Qty:</label>
                                            </td>
                                            <td style="width: 30%; text-align: left">
                                                <input type="text" id="txtYetToProduction" class="reset-text txt-styler number type-diabaled" disabled />
                                            </td>
                                        </tr>
                                    </table>

                                </td>

                            </tr>
                        </table>
                    </fieldset>

                    <table border="1" style="width:100% ;height:60px">
                        <tr>
                            <td style="width:70% ;height:60px">
                                <table border="0" style="width:100% ;height:60px;">
                                    <tr>
                                        <td style="width: 22%; text-align: right">
                                            Qty<span class="lblMUnit"></span>:
                                            <input type="text" id="txtQty" style="width:55%;" class="number" />

                                        </td>
                                        <td style="width:20%">
                                            Qty<span class="lblMUnitTwo"></span>:
                                            <input type="text" id="txtQtyKg" style="width:55%; text-align: left" class="number" />
                                        </td>
                                        <td style="width: 12%; text-align: right">
                                            Total Liquire:
                                        </td>
                                        <td style="width: 23%; text-align: left">
                                            <input type="text" id="txtMultipleBy" style="width:22%;" class="number" />
                                            <span>*</span>
                                            <input id="txtTtlLiquire" style="width:50%;" class="number" />
                                            <input type="button" id="btnLabel" style="width:10%;" />
                                        </td>
                                        <td style="width: 13%; text-align: right">
                                            <span>Cotton(Liq're):</span>
                                        </td>
                                        <td style="width: 10%; text-align: right">
                                            <input type="text" id="txtTtlLiquireCottton" style="width:90%;" class="number" />
                                        </td>

                                    </tr>

                                    <tr>
                                        <td colspan="2" style="width: 42%; text-align: center">
                                            <div>
                                                Dyeing Type:
                                                <select id="cboDyeingTypes" onchange="ChangeDyeingType()" style="width:30%"></select>
                                            </div>
                                        </td>

                                        <td style="width:12%; text-align: right">
                                            <label id="lblHanksCone">No. of Cone:</label>
                                        </td>
                                        <td style="width:23%; text-align: left">
                                            <input type="text" id="txtHanksCone" style="width:90%;" class="number" />
                                        </td>
                                        <td style="width:13%; text-align: right">
                                            <label id="lblWeight">Weight/Cone:</label>
                                        </td>
                                        <td style="width:10%; text-align: left">
                                            <input type="text" id="txtWeightHanksCone" style="width:90%;" class="number" />
                                        </td>




                                    </tr>

                                </table>

                            </td>
                            <td style="width:30% ;height:60px">
                                <table border="0" style="width:100% ;height:60px;">
                                    <tr>
                                        <td style="width:15%; text-align: right">
                                            Shift:
                                        </td>
                                        <td colspan="3" style="width:45%; text-align:right">
                                            <select id="cboRSShift" style="width:100%;"></select>
                                        </td>

                                    </tr>
                                    <tr>
                                        <td style="width:15%; text-align: right">
                                            Qty(Dummy):
                                        </td>
                                        <td style="width:40%; text-align:left">
                                            <input type="text" id="txtQtyDye" style="width:98%; text-align: left" class="number" />
                                        </td>
                                        <td style="width:15%; text-align: right">
                                            Qty(Omit):
                                        </td>
                                        <td style="width:40%; text-align: right">
                                            <input type="text" id="txtQtyOmit" style="width:98%; text-align: left" class="number" />
                                        </td>
                                    </tr>


                                </table>

                            </td>


                        </tr>
                    </table>
                    <fieldset>
                        <legend style="font-weight:bold"> Lot info: </legend>
                        <table style="width:100%;width:100%" id="tblParent">

                            <tr>

                                <td style="width: 10%; text-align: right">
                                    <label>Machine</label>
                                </td>
                                <td style="width: 25%; text-align: left">
                                    <input type="text" id="txtMachine" class="reset-text txt-styler-picker" placeholder="Search Machine" />
                                    <a id="btnPickMachine" href="javascript:void(0)" class="easyui-linkbutton ics-pick" iconcls="icon-pick" plain="true"></a>
                                    <a id="btnResetMachine" href="javascript:void(0)" class="easyui-linkbutton ics-pick" iconcls="icon-clear" plain="true"></a>
                                </td>
                                <td style="width: 10%; text-align: right">
                                    <label>Location</label>
                                </td>
                                <td style="width: 20%; text-align: left">
                                    <select id="cboLocation" class="cbo-styler"></select>
                                </td>
                                <td style="width: 10%; text-align: right">
                                    <label>Store</label>
                                </td>
                                <td style="width: 25%; text-align: left">
                                    <select id="cboStore" class="cbo-styler"></select>
                                </td>

                            </tr>
                            <tr>

                                <td style="width: 10%; text-align: right">
                                    <label>Yarn</label>
                                </td>
                                <td colspan="3" style="width: 55%; text-align: left">
                                    <input type="text" id="txtProduct" class="reset-text txt-styler-picker" placeholder="Search Product" />
                                    <a id="btnPickProduct" href="javascript:void(0)" class="easyui-linkbutton ics-pick" iconcls="icon-pick" plain="true"></a>
                                    <a id="btnResetProduct" href="javascript:void(0)" class="easyui-linkbutton ics-pick" iconcls="icon-clear" plain="true"></a>
                                </td>
                                <td style="width: 10%; text-align: right">
                                    <label>Lot</label>
                                </td>
                                <td style="width: 25%; text-align: left">
                                    <input type="text" id="txtLot" class="reset-text" style="width:40%;" />
                                    <a id="btnPickLot" href="javascript:void(0)" class="easyui-linkbutton ics-pick" iconcls="icon-pick" plain="true"></a>
                                    <a id="btnResetLot" href="javascript:void(0)" class="easyui-linkbutton ics-pick" iconcls="icon-clear" plain="true"></a>
                                    <a id="btnAddLot" href="javascript:void(0)" class="easyui-linkbutton ics-pick" iconcls="icon-add" plain="true">Multiple Lot</a>
                                </td>

                            </tr>
                            <tr>
                                <td style="width: 10%; text-align: right">
                                    <label>Note</label>
                                </td>
                                <td colspan="5" style="width: 90%; text-align: left">
                                    <input type="text" id="txtNote" class="reset-text txt-styler-Note" placeholder="Note" />
                                </td>
                            </tr>
                        </table>
                    </fieldset>
                </div>
                <fieldset>
                    <legend>Action</legend>
                    <div class="align-right">
                        <table border="0" cellpadding="0" cellspacing="0" style="float:right; width:100%;">
                            <tr>
                                <td style="width:30%;float:left; text-align:left">
                                    <a id="btnNew" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-add" plain="true">New</a>
                                    <input id="chkIsCommon" type="checkbox" />
                                    <a id="btnPrint" href="javascript:void(0)" class="easyui-linkbutton initial-state" iconcls="icon-print" plain="true">Print</a>
                                </td>
                                <td style="width:70%;float:right; text-align:right">
                                    <label id="lblIsReDyeing">Is Redyeing: </label>
                                    @*<input id="chkIsReDyeing" type="checkbox" />*@
                                    <select style="width: 18%;" id="cboIsReDyeing">
                                        <option value="0">Select</option>
                                        <option value="1">ReDyeing</option>
                                        <option value="2">Re-Process</option>
                                    </select>
                                    <a id="btnSave" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-save" plain="true">Save</a>
                                    <a id="btnCopy" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-paste" plain="true">Copy</a>
                                    <a id="btnReDyeing" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-paste" plain="true">Redyeing</a>
                                    <a id="btnClose" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-cancel" plain="true">Close</a>
                                </td>
                            </tr>
                        </table>
                    </div>
                </fieldset>
            </div>
            <div title="Solution Templete" id="divTwo" style="width:100%;height:100%">

                <fieldset>
                    <legend>Solution Templete</legend>
                    <div style="width:96%">
                        <table id="tblTreeGridProcess" class="easyui-treegrid" style="width:100%; height:430px;"
                               data-options="idField:'RouteSheetDetailID',treeField:'ProcessName', rownumbers:'true', toolbar:'#toolbarTemplet'">
                            <thead>
                                <tr>
                                    <th data-options="field:'ProcessName'" width="30%">Name</th>
                                    <th data-options="field:'GL', align:'center'" width="5%">GL</th>
                                    <th data-options="field:'Percentage', align:'center'" width="5%">(%)</th>
                                    <th data-options="field:'TempTime',align:'center'" width="8%">Temp & Time</th>
                                    <th data-options="field:'TotalQtyStr',align:'center'" width="10%">Total Qty (Kg)</th>
                                    <th data-options="field:'AddOneQtyStr',align:'center'" width="7%">Qty(One) (Kg)</th>
                                    <th data-options="field:'AddTwoQtyStr',align:'center'" width="7%">Qty(Two) (Kg)</th>
                                    <th data-options="field:'AddThreeQtyStr',align:'center'" width="7%">Qty(Three) (Kg)</th>
                                    <th data-options="field:'ReturnQtyStr',align:'center'" width="7%">Return Qty (Kg)</th>
                                    <th data-options="field:'SuggestLotNo', align:'center'" width="8%">Lot No</th>
                                    <th data-options="field:'Note', align:'center'" width="8%">Note</th>
                                </tr>
                            </thead>
                        </table>
                        <div id="toolbarTemplet">
                            <input type="text" id="txtDyeingSolution" placeholder="Search dyeing solution" style="width:15%" />
                            <a id="btnPickDyeingSolution" href="javascript:void(0)" class="easyui-linkbutton ics-pick" iconcls="icon-pick" plain="true"></a>
                            <a id="btnResetDyeingSolution" href="javascript:void(0)" class="easyui-linkbutton ics-pick" iconcls="icon-clear" plain="true"></a>
                            <input type="checkbox" id="chkDyeChemical" /> <label id="lblDyesChemical">Dye Chemical</label>
                            <a id="btnAddTemplet" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-add" plain="true">Add</a>
                            <a id="btnEditTemplet" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-edit" plain="true">Edit</a>
                            <a id="btnEditTempletAddition" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-edit" plain="true">Additional</a>
                            <a id="btnDeleteTemplet" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-remove" plain="true">Delete</a>
                            @*<a id="btnAdditional" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-ok" plain="true"><label id="lblAdditional">Add. One</label></a>
                                <a id="btnReturn" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-ok" plain="true">Return</a>*@
                            <a id="btnSequenceConfigure" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-reload" plain="true">Sequence</a>
                            <a id="btnLabdipRecipe" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-add" plain="true">Show LD Recipe</a>
                            <input type="text" id="txtRSNoFrom" placeholder="Copy From Batch" style="width:10%" />
                        </div>
                    </div>
                </fieldset>

                <fieldset>
                    <legend>Action</legend>
                    <div class="align-right">
                        <table border="0" cellpadding="0" cellspacing="0" style="float:right; width:100%;">
                            <tr>
                                <td style="width:70%;float:left; text-align:left">
                                    <label id="lblDUPSNote"></label>
                                </td>
                                <td style="width:10%;float:left; text-align:right">
                                    <a id="btnPrintTwo" href="javascript:void(0)" class="easyui-linkbutton initial-state" iconcls="icon-print" plain="true">Print</a>
                                </td>
                                <td style="width:20%;float:right; text-align:right">
                                    <a id="btnSaveDetail" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-save" plain="true">Save</a>
                                    <a id="btnCloseTwo" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-cancel" plain="true">Close</a>
                                </td>
                            </tr>
                        </table>
                    </div>
                </fieldset>
            </div>
        </div>

    </div>

    <div id="winTemplet" class="easyui-window winstyle" title="Dyeing Solution" style="width:620px; height:auto" data-options="modal:true,closed:true,collapsible:false,minimizable:false,maximizable:false,closable:false">
        <div style="width: 98%; font-family: Tahoma;">
            <fieldset>
                <table class="tbl-Win">
                    <tr class="templet">
                        <td class="td-col-5 align-right">
                            <label>Process :</label>
                        </td>
                        <td class="td-styler td-col-25" colspan="3">
                            <select id="cboProcess" class="cbo-styler"></select>
                        </td>
                        <td class="td-styler td-col-1"></td>
                    </tr>
                    <tr class="templet">
                        <td class="td-col-5 align-right">
                            <label>Temp & Time :</label>
                        </td>
                        <td class="td-styler td-col-25" colspan="3">
                            <input id="txtTempTime" type="text" class="reset-text txt-styler" placeholder="Temp & Time" />
                        </td>
                        <td class="td-styler td-col-1"></td>
                    </tr>
                    <tr class="templet-dc">
                        <td class="td-col-5 align-right">
                            <label>Recipe Type :</label>
                        </td>
                        <td class="td-styler td-col-25" colspan="4">
                            <select style="width:80%;" id="cboDyeingRecipeType" onchange="changeDyeingRecipeType()"></select>
                        </td>
                    </tr>
                    <tr class="templet-dc">
                        <td class="td-col-5 align-right">
                            <label>Product :</label>
                        </td>
                        <td class="td-styler td-col-25" colspan="4">
                            <select style="width:20%;" id="cboProductType"></select>
                            @*<select style="width:10%;" id="cboProductCategory">
                                    <option value="25">Dyes</option>
                                    <option value="26">Chemicals</option>
                                </select>*@
                            <input id="txtProduct-DS" style="width:60%" type="text" placeholder="Search Product" />
                            <a id="btnPickProduct-DS" href="javascript:void(0)" class="easyui-linkbutton ics-pick" iconcls="icon-pick" plain="true"></a>
                            <a id="btnResetProduct-DS" href="javascript:void(0)" class="easyui-linkbutton ics-pick" iconcls="icon-clear" plain="true"></a>
                        </td>
                        @*<td class="td-styler td-col-1"></td>*@
                    </tr>
                    <tr id="trGL_Par" class="templet-dc">
                        <td class="td-col-5 align-right">
                            <label>GL :</label>
                        </td>
                        <td class="td-styler td-col-4">
                            <input id="txtGL" min="0" max="100" type="text" class="number reset-text txt-styler" placeholder="GL" />
                        </td>
                        <td class="td-styler td-col-6 align-right">
                            <label>Percentage (%) :</label>
                        </td>
                        <td class="td-styler td-col-15">
                            <input id="txtPercentage" min="0" max="100" type="text" class="number reset-text txt-styler-Percentage" placeholder="%" />
                        </td>
                        <td class="td-styler td-col-1"></td>
                    </tr>

                    <tr id="trGL_Adj" class="templet-dc">
                        <td class="td-col-5 align-right">
                            <label>Adjustment :</label>
                        </td>
                        <td class="td-styler td-col-4">
                            <input id="txtAdjustment" min="0" max="100" type="text" class="number reset-text txt-styler" placeholder="Adjustment" />
                        </td>
                        <td class="td-styler td-col-6 align-right">
                            <label>For Cotton :</label>
                        </td>
                        <td class="td-styler td-col-15">
                            <input type="checkbox" id="chkForCotton" />
                        </td>
                        <td class="td-styler td-col-1"></td>
                    </tr>
                    <tr id="trQty" class="templet-dc">
                        <td class="td-col-5 align-right">
                            <label>Qty :</label>
                        </td>
                        <td class="td-styler td-col-4">
                            <input type="text" id="txtTotalQty_KG" style="width:60%" class="text-right number" placeholder="Type Qty (kg)" />kg

                        </td>
                        <td class="td-styler td-col-6 align-right">
                            <input type="text" id="txtTotalQty_Gm" style="width:60%" class="text-right number" placeholder="Type Qty (gm)" />gm
                        </td>
                        <td class="td-styler td-col-15"></td>
                        <td class="td-styler td-col-1"></td>
                    </tr>
                    <tr>
                        <td class="td-col-5 align-right">
                            <label>Note :</label>
                        </td>
                        <td class="td-styler td-col-25" colspan="3">
                            <input id="txtNoteTemplet" type="text" class="reset-text txt-styler" placeholder="Note" />
                        </td>
                        <td class="td-styler td-col-1"></td>
                    </tr>

                    <tr class="templet-dc">
                        <td class="td-col-5 align-right">
                            <label>Store :</label>
                        </td>
                        <td class="td-styler td-col-25" colspan="4">
                            <select id="cboStoreDC" style="width:80%" class="cbo-styler"></select>
                        </td>
                        @*<td class="td-styler td-col-1"></td>*@
                    </tr>
                    <tr class="templet-dc">
                        <td class="td-col-5 align-right">
                            <label>Lot :</label>
                        </td>
                        <td class="td-styler td-col-25" colspan="4">

                            <input id="txtLot_DC" type="text" style="width:60%" placeholder="Search Lot" />
                            <a id="btnPickLot_DC" href="javascript:void(0)" class="easyui-linkbutton ics-pick" iconcls="icon-pick" plain="true"></a>
                            <a id="btnResetLot_DC" href="javascript:void(0)" class="easyui-linkbutton ics-pick" iconcls="icon-clear" plain="true"></a>
                        </td>
                        @*<td class="td-styler td-col-1"></td>*@
                    </tr>

                </table>
            </fieldset>
            <div style="width:100%">
                <fieldset>
                    <div class="form-inline text-right">
                        <a id="btnSaveTemplet" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-save" plain="true">Save</a>
                        <a id="btnCloseTemplet" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-cancel" plain="true">Close</a>
                    </div>
                </fieldset>
            </div>
        </div>
    </div>

    <div id="winTempletAddition" class="easyui-window winstyle" title="Dyeing Solution" style="width:940px; height:auto" data-options="modal:true,closed:true,collapsible:false,minimizable:false,maximizable:false,closable:false">
        <div style="width: 100%; font-family: Tahoma;">
            <fieldset>
                <table class="tbl-Win">
                    <tr class="templet">
                        <td class="td-col-5 align-right">
                            <label>Process :</label>
                        </td>
                        <td class="td-styler td-col-25" colspan="3">
                            <select id="cboProcessAddition" class="cbo-styler type-addition" disabled></select>
                        </td>
                        <td class="td-styler td-col-1"></td>
                    </tr>
                    <tr class="templet">
                        <td class="td-col-5 align-right">
                            <label>Temp & Time :</label>
                        </td>
                        <td class="td-styler td-col-25" colspan="3">
                            <input type="text" id="txtTempTimeAddition" class="reset-text txt-styler type-addition" placeholder="Temp & Time" disabled />
                        </td>
                        <td class="td-styler td-col-1"></td>
                    </tr>

                    <tr class="templet-dc">
                        <td class="td-col-5 align-right">
                            <label>Product :</label>
                        </td>
                        <td class="td-styler td-col-25" colspan="4">
                            <select style="width:20%;" id="cboProductTypeAdd"></select>
                            @*<select style="width:20%;" id="cboProductCategoryAddition" class=" type-addition" disabled>
                                    <option value="25">Dyes</option>
                                    <option value="26">Chemicals</option>
                                </select>*@
                            <input type="text" id="txtProduct-DSAddition" style="width:60%" placeholder="Search Product" class=" type-addition" disabled />
                            <a id="btnPickProduct-DSAddition" href="javascript:void(0)" class="easyui-linkbutton ics-pick" iconcls="icon-pick" plain="true" disabled></a>
                            <a id="btnResetProduct-DSAddition" href="javascript:void(0)" class="easyui-linkbutton ics-pick" iconcls="icon-clear" plain="true" disabled></a>
                        </td>
                        @*<td class="td-styler td-col-1"></td>*@
                    </tr>
                    <tr class="templet-dc">
                        <td class="td-col-5 align-right">
                            <label>GL :</label>
                        </td>
                        <td class="td-styler td-col-4">
                            <input type="text" id="txtGLAddition" min="0" max="100" class="number reset-text txt-styler type-addition" placeholder="GL" disabled />
                        </td>
                        <td class="td-styler td-col-6 align-right">
                            <label>Percentage (%) :</label>
                        </td>
                        <td class="td-styler td-col-15">
                            <input type="text" id="txtPercentageAddition" min="0" max="100" class="number reset-text txt-styler-Percentage  type-addition" placeholder="%" disabled />
                        </td>
                        <td class="td-styler td-col-1"></td>
                    </tr>

                    <tr class="templet-dc">
                        <td class="td-col-5 align-right">
                            <label>Adjustment :</label>
                        </td>
                        <td class="td-styler td-col-4">
                            <input type="text" id="txtAdjustmentAddition" min="0" max="100" class="number reset-text txt-styler type-addition" placeholder="Adjustment" disabled />
                        </td>
                        <td class="td-styler td-col-6 align-right">
                            <label>For Cotton :</label>
                        </td>
                        <td class="td-styler td-col-15">
                            <input type="checkbox" id="chkForCottonAddition type-addition" disabled />
                        </td>
                        <td class="td-styler td-col-1"></td>
                    </tr>
                    <tr>
                        <td class="td-col-5 align-right">
                            <label>Note :</label>
                        </td>
                        <td class="td-styler td-col-25" colspan="3">
                            <input type="text" id="txtNoteTempletAddition" class="reset-text txt-styler type-addition" placeholder="Note" disabled />
                        </td>
                        <td class="td-styler td-col-1"></td>
                    </tr>
                    @*<tr class="templet-dc">
                            <td class="td-col-5 align-right">
                                <label>Lot :</label>
                            </td>
                            <td class="td-styler td-col-25" colspan="4">
                                <input id="txtLot_DCAddition" style="width:100%" placeholder="Search Lot" class="type-addition" disabled />
                            </td>
                        </tr>*@
                </table>
            </fieldset>


            @*<div class="col-md-12">
                    <input id="txtLot_Addition" style="width:60%" placeholder="Search Lot" class="type-addition" disabled />
                    <a id="btnPickLot_Addition" href="javascript:void(0)" class="easyui-linkbutton ics-pick" iconcls="icon-pick" plain="true"></a>
                    <a id="btnResetLot_Addition" href="javascript:void(0)" class="easyui-linkbutton ics-pick" iconcls="icon-clear" plain="true"></a>
                </div>*@
            <div>
                <table id="tblRSAdditional" class="easyui-datagrid" style="width:100%;height:220px" data-options="singleSelect: true,fitColumns:false, rownumbers:true, pagination:false, autoRowHeight:false, toolbar: '#toolbarAdditional' ">
                    <thead>
                        <tr>
                            <th field="InOutTypeSt" width="10%" align="left">Type</th>
                            <th field="SequenceNo" width="7%" align="left">No</th>
                            <th field="LotNo" width="20%" align="left">Lot No</th>
                            <th field="QtySt" width="10%" align="left">Qty</th>

                            <th field="IssuedByName" width="14%" align="left">Request By</th>
                            <th field="ApprovedByName" width="14%" align="left">Issue By</th>
                            <th field="Note" width="14%" align="left">Note</th>
                            <th field="WUName" width="10%" align="left">Store</th>
                            <th field="ProductTypeSt" width="10%" align="left">Product Type</th>
                        </tr>
                    </thead>
                </table>
                <div id="toolbarAdditional">
                    <select id="cboStoreDCAdon" style="width:15%" class="cbo-styler"></select>
                    <label>Lot</label>
                    <input type="text" id="txtLot_Addition" style="width:16%" placeholder="Search Lot" />
                    <a id="btnPickLot_Addition" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-pick" plain="true"></a>
                    <a id="btnResetLot_Addition" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-clear" plain="true"></a>
                    <select id="cboAdditionType"></select>
                    <label>Qty</label>
                    <input type="text" id="txtLot_Addition_Qty_KG" style="width:8%" class="text-right number" placeholder="Type Qty (kg)" />kg
                    <input type="text" id="txtLot_Addition_Qty_GM" style="width:8%" class="text-right number" placeholder="Type Qty (gm)" />gm
                    <input type="text" id="txtLot_Addition_Remarks" style="width:15%" class="text-left" placeholder="Type Note/Remarks" />
                    <a id="btnAddDetailAddition" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-add" plain="true">Add</a>
                    <a id="btnDeleteDetailAddition" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-remove" plain="true">Delete</a>
                </div>
            </div>

        </div>
        <div style="width:100%">
            <fieldset>
                <div class="form-inline text-right">
                    @*<a id="btnSaveTempletAddition" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-save" plain="true">Save</a>*@
                    <a id="btnCloseTempletAddition" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-cancel" plain="true">Close</a>
                </div>
            </fieldset>
        </div>
    </div>

    <div id="winAdditionalReturn" class="easyui-window winstyle" title="Additional Return" style="width:450px; height:auto" data-options="modal:true,closed:true,collapsible:false,minimizable:false,maximizable:false,closable:false">
        <table class="tbl-Win">
            <tr>
                <td class="td-col-5 align-right">
                    <label>Product Name :</label>
                </td>
                <td class="td-styler td-col-14">
                    <input type="text" id="txtAdditionalReturnProduct" class="reset-text txt-styler" placeholder="Product Name" disabled />
                </td>
                <td class="td-styler td-col-1"></td>
            </tr>
            <tr>
                <td class="td-col-5 align-right">
                    <label>Quantity :</label>
                </td>
                <td class="td-styler td-col-14">
                    <div class="region-parent">
                        <div class="region-child">
                            <input type="text" id="txtAdditionalReturnQtyKg" class="reset-text only-number txt-styler-custom align-right" />
                            <span>kg</span>
                        </div>
                        <div class="region-child align-right">
                            <input type="text" id="txtAdditionalReturnQtyGm" class="reset-text only-number txt-styler-custom align-right" />
                            <span>gm</span>
                        </div>
                    </div>
                </td>
                <td class="td-styler td-col-1"></td>
            </tr>
            <tr>
                <td colspan="3" style="text-align:right; padding-top:10px; padding-bottom:10px;">
                    <select style="width:100px;" id="cboOutState">
                        <option value="0">-Select-</option>
                        <option value="1">First</option>
                        <option value="2">Second</option>
                        <option value="3">Third</option>
                        <option value="4">Return</option>
                    </select>
                    <a id="btnSaveAdditionalReturn" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-save" plain="true">Save</a>
                    <a id="btnCloseAdditionalReturn" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-cancel" plain="true">Close</a>
                </td>
            </tr>
        </table>
    </div>

    <div id="winRSDequence" class="easyui-window" title="View  Sequence Configure" data-options="modal:true,closed:true,collapsible:false,minimizable:false,maximizable:false,closable:false">
        <table id="tblDSTSequence" class="easyui-datagrid" style="width:100%;height:400px" data-options="singleSelect: true,fitColumns:false, rownumbers:true, pagination:false, autoRowHeight:false, toolbar: '#toolbarSequence' ">
            <thead>
                <tr>
                    <th field="ProcessName" width="30%" align="left">ProcessName</th>
                    <th field="TempTime" width="15%" align="left">TempTime</th>
                    <th field="Note" width="20%" align="left">Note</th>
                    <th field="Sequence" width="10%" align="left">Sequence</th>
                </tr>
            </thead>
        </table>
        <div id="toolbarSequence">
            <a href="javascript:void(0)" id="btnUp" class="easyui-linkbutton" iconcls="icon-up" plain="true" onclick="UP()">Up</a>
            <a href="javascript:void(0)" id="btnDown" class="easyui-linkbutton" iconcls="icon-down" plain="true" onclick="Down()">Down</a>
            <a href="javascript:void(0)" id="btnRefresh" class="easyui-linkbutton" iconcls="icon-reload" plain="true" onclick="RefreshMenuSequence()">Refresh</a>
        </div>
        <fieldset class="actionfieldsetstyle">
            <legend>Actions : </legend>
            <a id="btnSaveSequence" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-save" plain="true" onclick="SaveSequence()">Save</a>
            <a id="btnCloseDSTSequence" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-cancel" plain="true">Close</a>
        </fieldset>
    </div>

    <div id="winLabdipRecipe" class="easyui-window" title="View  Sequence Configure" data-options="modal:true,closed:true,collapsible:false,minimizable:false,maximizable:false,closable:false">
        <table id="tblLabdipRecipe" class="easyui-datagrid" style="width:100%;height:400px" data-options="singleSelect: false,fitColumns:false, rownumbers:true, pagination:false, autoRowHeight:false">
            <thead>
                <tr>
                    <th data-options="field:'Selected',checkbox:true"></th>
                    <th field="ProductCode" width="10%" align="left">Code</th>
                    <th field="ProductName" width="40%" align="left">ProductName</th>
                    <th field="Qty" width="10%" align="left">Qty</th>
                    <th field="Note" width="20%" align="left">Note</th>
                </tr>
            </thead>
        </table>
        <fieldset class="actionfieldsetstyle">
            <legend>Actions : </legend>
            <a id="btnSaveLabdipRecipe" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-save" plain="true">OK</a>
            <a id="btnCloseLabdipRecipe" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-cancel" plain="true">Close</a>
        </fieldset>
    </div>

    <div id="winAddLot" class="easyui-window" title="Add Lot" data-options="modal:true,closed:true,collapsible:false,minimizable:false,maximizable:false,closable:false">
        <div style="width:915px; margin-left:2px;">
            <table id="tblLots" class="easyui-datagrid" style="height:260px;" fitcolumns="true" rownumbers="true" pagination="false" singleselect="true" autorowheight="false" toolbar="#toolbarLot" data-options="onClickRow:onClickRowLot">
                <thead>
                    <tr>
                        <th field="ProductName" width="120">Product</th>
                        <th field="OperationUnitName" width="120">Store </th>
                        <th field="LotNo" width="80">LotNo </th>
                        <th data-options="field:'Qty',align:'right',editor:{type:'numberbox',options:{precision:0}}" formatter="formatPrice" width="60">Qty</th>
                        <th field="Balance" width="70">Balance </th>
                        <th data-options="field:'NumOfCone',align:'right',editor:{type:'numberbox',options:{precision:0}}" formatter="formatPrice" width="60">Cone/Hank</th>
                    </tr>
                </thead>
            </table>
            <div id="toolbarLot">
                Order :<select id="cboOrder" style="width:120px;" onchange="GetRSRawLot()"></select>&nbsp;
                Lot : <input type="text" id="txtLotForRS" class="reset-text" style="width:200px;" />
                <a id="btnPickLotForRS" href="javascript:void(0)" class="easyui-linkbutton ics-pick" iconcls="icon-pick" plain="true"></a>
                <a id="btnDeleteRSRawLot" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-remove" plain="true">Remove</a>
            </div>
            <fieldset>
                <legend>Actions : </legend>
                <div style="float:right;">
                    <a id="btnSaveRSRawLot" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-ok" plain="true">Save</a>
                    <a id="btnCloseRSRawLot" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-cancel" plain="true">Close</a>
                </div>
            </fieldset>
        </div>
    </div>

</body>


<style type="text/css">
    .td-styler input, select {
        padding-left: 5px;
    }

    .txt-styler {
        width: 95%;
    }

    .txt-styler-picker {
        width: 50%;
    }

    .cbo-styler {
        width: 98%;
    }

    .txt-styler-Note {
        width: 98.5%;
    }

    .txt-styler-Mul {
        width: 70%;
    }

    .region-parent {
        float: left;
        width: 100%;
    }

    .region-child {
        float: left;
        width: 50%;
    }

    .region-hanks-cone {
        float: left;
        width: 95%;
    }

    .region-hanks-cone-input {
        float: left;
        width: 30%;
    }

    .region-hanks-cone-label {
        float: left;
        width: 40%;
    }

    .tbl-Win {
        width: 100%;
    }

    .txt-styler-Percentage {
        width: 82%;
    }

    .txt-styler-custom {
        width: 75%;
    }

    #winRSDequence {
        width: 600px;
    }

    #winLabdipRecipe {
        width: 600px;
    }
</style>

<script type="text/javascript">

    var _sBaseAddress = "";
    var _oRouteSheet=null;
    var _nPTUID=0;
    var _nProductID = 0;
    var _nLotID = 0;
    var _nSuggestLotID = 0;
    var _nSuggestLotID_Addition = 0;
    var _nMachineID = 0;
    var _nLocationID = 0;
    var _nDyeingSolutionID=0;
    var _oRSD = null;
    var _oRSDRoot =null;
    var _nProcessID = 0;
    var _bIsReturn=false;
    var _nQty_RS = 0;
    var _nQty_RSKG = 0;
    var _nLabDipDetailID=0;
    var _nBUID=0;
    var _oOrderTypes=[];
    $(document).ready(function () {

        _sBaseAddress =@Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(HttpContext.Current.Session[SessionInfo.BaseAddress]));
        debugger;
        _oRouteSheet =@Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(Model));
        var oWorkingUnits=@Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(@ViewBag.WorkingUnits));
        var oWorkingUnitsDC=@Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(@ViewBag.WorkingUnitsDC));
        _oOrderTypes=@Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(@ViewBag.OrderTypes));
        var oDyeingTypes= @Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(@ViewBag.DyeingTypes));
        var IsOut=@Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(@ViewBag.IsOut));
        var oLocations=@Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(@ViewBag.Locations));
        var oRouteSheetSetup=@Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(@ViewBag.RouteSheetSetup));
        _nBUID = @Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(ViewBag.BUID));
        var oRSShifts =@Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(ViewBag.RSShifts));
        var oDUPSchedule =@Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(ViewBag.DUPSchedule));
        var oProductTypes = @Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(ViewBag.ProductTypes));
        var oDyeingRecipeTypes = @Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(ViewBag.DyeingRecipeType));
        RSSetup(oRouteSheetSetup);
        $('#tabRS').data('RouteSheetSetup',oRouteSheetSetup);
        $('.number').val("0.00");
        $("#cboOrderType").icsLoadCombo({
            List: _oOrderTypes,
            OptionValue: "OrderType",
            DisplayText: "ShortName",
        });

        $("#cboDyeingTypes").icsLoadCombo({
            List: oDyeingTypes,
            OptionValue: "DyeingTypeInt",
            DisplayText: "Name",
        });


        $("#cboStoreDC,#cboStoreDCAdon").icsLoadCombo({
            List: oWorkingUnitsDC,
            OptionValue: "WorkingUnitID",
            DisplayText: "WorkingUnitName",
        });
        $("#cboStore").icsLoadCombo({
            List: oWorkingUnits,
            OptionValue: "WorkingUnitID",
            DisplayText: "WorkingUnitName",
        });
        $("#cboLocation").icsLoadCombo({
            List: oLocations,
            OptionValue: "LocationID",
            DisplayText: "Name",
        });
        $("#cboRSShift").icsLoadCombo({
            List: oRSShifts,
            OptionValue: "RSShiftID",
            DisplayText: "Name",

        });
        $("#cboAdditionType").icsLoadCombo({ List: [{id:102,Value:'Addition'},{id:101,Value:'Return'}],   OptionValue: "id",  DisplayText: "Value" });
        $("#cboProductType").icsLoadCombo({  List: oProductTypes, OptionValue: "id",  DisplayText: "Value"});
        $("#cboDyeingRecipeType").icsLoadCombo({ List: oDyeingRecipeTypes, OptionValue: "id",  DisplayText: "Value",  InitialValue:"General" });
        if(oDUPSchedule.Note!="")
        {
            $('#lblDUPSNote').text("Instructions: "+oDUPSchedule.Note);
        }
        Initialization(_oRouteSheet,((sessionStorage.length>0)?sessionStorage.getItem('Operation'):'New'),IsOut);
        document.getElementById("txtQty").disabled = true;
        document.getElementById("txtQtyKg").disabled = true;
        $("#progressbar").progressbar({ value: 0 });
        $("#progressbarParent").hide();

    });

    $(document).keydown(function (e) { if (e.keyCode == 27) { $('#winRouteSheetOrder').icsWindow('close'); } });
    function RSSetup(oRouteSheetSetup)
    {
        $('#lblRSNo').html(oRouteSheetSetup.RSShortName);
        $(".lblMUnit").html("("+oRouteSheetSetup.MUnit+")");
        $(".lblMUnitTwo").html("("+oRouteSheetSetup.MUnitTwo+")");
        //$('#lblMunit').html(oRouteSheetSetup.MUnit);
        //$("#txtLabdipNo").attr("placeholder", "Type "+oLabDipSetup.OrderName);
    }

    function updateProgress() {
        var value =$('#progressbar').progressbar('getValue');
        if (value < 96){
            value += Math.floor(Math.random() * 10);
            $('#progressbar').progressbar('setValue', value);
        }
    }
    function hideShow(miliseconds) {
        $("#progressbarParent").hide();
    }


    $('#tblTreeGridProcess').treegrid({ onSelect: function (rowData) { OperationPerformTreeGrid(rowData); } });

    function OperationPerformTreeGrid(rowData) {
        debugger;
        if (rowData != null && rowData.RouteSheetDetailID > 0) {
            if(rowData.TotalQtyLotID<=0)
            {
                $('#lblDyesChemical').show();
                $("#chkDyeChemical, #btnAddTemplet, #btnEditTemplet, #btnDeleteTemplet").show();
                $("#btnAdditional,#btnReturn").hide();
            }
            else
            {
                $('#lblDyesChemical').hide();
                $("#chkDyeChemical, #btnAddTemplet, #btnEditTemplet, #btnDeleteTemplet").show();
                $("#btnAdditional,#btnReturn").show();
                if(rowData.AddOneLotID<=0)
                    $('#lblAdditional').text("Add. One");
                else if(rowData.AddTwoLotID<=0)
                    $('#lblAdditional').text("Add. Two");
                else if(rowData.AddThreeLotID<=0)
                    $('#lblAdditional').text("Add. Three");
                else
                    $("#btnAdditional").show();

                if(rowData.ReturnLotID<=0)
                    $("#btnReturn").hide();
                else
                    $("#btnAdditional,#btnReturn").show();
            }
        }
    }

    function Initialization(oRouteSheet, sOperation,IsOut){
        debugger;
        ResetControll();
        if(oRouteSheet.RouteSheetID>0){
            RefreshControl(oRouteSheet);
        }
        else{
            $("#cboDyeingTypes").val(oRouteSheet.HanksCone);
        }
        if(sOperation=="View")
        {
            $('#btnSave,#btnSaveDetail,#btnCopy,#btnReDyeing,#cboIsReDyeing,#lblIsReDyeing,#txtRSNoFrom, .ics-pick').hide();
            //$('input,select').not('#txtRouteSheetNo').prop('disabled',true);
            // $('.txt-styler-picker').css('width','95%');
        }
        else if(sOperation=="Copy")
        {
            $('#dtOrderDate').datebox('setValue', icsdateformat(new Date()));
            $('#toolbarTemplet,#btnSave,.ics-pick').hide();
            //$('input,select').not('#txtRouteSheetNo').prop('disabled',true);
            //$('.txt-styler-picker').css('width','95%');
            $('#btnCopy').show();
            $('#cboIsReDyeing,#lblIsReDyeing,#btnReDyeing').hide();
        }
        else if(sOperation=="ReDyeing")
        {
            $('#dtOrderDate').datebox('setValue', icsdateformat(new Date()));
            $('#toolbarTemplet,#btnSave,#btnCopy,.ics-pick').hide();
            //$('input,select').not('#txtRouteSheetNo').prop('disabled',true);
            //$('.txt-styler-picker').css('width','95%');
            $('#cboIsReDyeing').prop('checked',true);
            $('#btnReDyeing,#cboIsReDyeing,#lblIsReDyeing').show();
        }
        else
        {
            $('#btnCopy,#btnReDyeing,#cboIsReDyeing,#lblIsReDyeing').hide();
            $('#toolbarTemplet,#btnSave,.ics-pick').show();
            $('input,select').not('.type-diabaled').prop('disabled',false);
            $('.txt-styler-picker').css('width','70%');
        }
    }

    function ResetControll(){
        _oRouteSheet=null;
        _nPTUID=0;
        _nProductID = 0;
        _nLotID = 0;
        _nMachineID = 0;
        _nLocationID = 0;
        _nDyeingSolutionID = 0;
        $('.reset-text').val("");
        $('.number').val("0.00");
        $('#dtOrderDate').datebox('setValue', icsdateformat(new Date()));

        $('#txtMultipleBy').val(formatPrice(6));
        LoadTreeGrid([]);
    }

    function RefreshControl(oRouteSheet){
        _oRouteSheet = oRouteSheet;
        _nMachineID = oRouteSheet.MachineID;
        if( oRouteSheet.ProductID_Raw<=0)
        {
            oRouteSheet.ProductID_Raw=oRouteSheet.PTU.ProductID;
        }
        _nProductID = oRouteSheet.ProductID_Raw;
        _nLotID = oRouteSheet.LotID;
        _nLocationID = oRouteSheet.LocationID;
        _nPTUID = oRouteSheet.PTUID;
        $('#txtQtyDye').val(oRouteSheet.QtyDye),
        $('#txtQtyOmit').val(oRouteSheet.QtyOmit),
        $('#btnLabel').val(oRouteSheet.Label);
        $('#txtOrderNo').val(oRouteSheet.OrderNo);
        $('#txtRouteSheetNo').val(oRouteSheet.RouteSheetNo);
        $('#dtOrderDate').datebox('setValue',oRouteSheet.RouteSheetDateStr);
        $('#cboOrderType').val(oRouteSheet.OrderType);

        $('#txtPTU').val(oRouteSheet.PTU.OrderNo);
        $('#txtBuyerName').val(oRouteSheet.PTU.ContractorName);
        $('#txtProductPTU').val(oRouteSheet.PTU.ProductNameCode);

        $('#txtColorNo').val(oRouteSheet.PTU.ColorNo);
        $('#txtLabdipNo').val(oRouteSheet.PTU.LabdipNo);
        $('#txtColorShade').val(oRouteSheet.PTU.ColorNameShade);
        $('#txtYetToProduction').val(formatPrice(oRouteSheet.PTU.YetToProduction));
        if(oRouteSheet.ProductName_Raw=="" || oRouteSheet.ProductName_Raw==null)
        {
            $('#txtProduct').val(oRouteSheet.PTU.ProductNameCode);
        }
        else
        {
            $('#txtProduct').val(oRouteSheet.ProductName_Raw);
        }
        $('#txtLot').val(oRouteSheet.LotNo);

        $('#txtQty').val(formatPrice(oRouteSheet.Qty));
        $('#txtQtyKg').val(formatPrice(oRouteSheet.QtyKg));
        $('#txtMultipleBy').val(((oRouteSheet.TtlLiquire>0)? formatPrice(oRouteSheet.TtlLiquire/oRouteSheet.Qty):6));
        $('#txtTtlLiquire').val(formatPrice(oRouteSheet.TtlLiquire));
        $('#txtTtlLiquireCottton').val(formatPrice(oRouteSheet.TtlCotton));
        $('#txtHanksCone').val(formatPrice(oRouteSheet.NoOfHanksCone));
        $('#txtWeightHanksCone').val((oRouteSheet.NoOfHanksCone>0)?(formatPrice(parseFloat(oRouteSheet.Qty)/parseFloat(oRouteSheet.NoOfHanksCone))): formatPrice(0));

        $('#cboStore').val(oRouteSheet.WorkingUnitID);
        $('#cboLocation').val(oRouteSheet.LocationID);
        $('#txtNote').val(oRouteSheet.Note);
        $('#txtMachine').val(oRouteSheet.MachineName);
        ChangeOrderType();

        $("#cboDyeingTypes").val(oRouteSheet.HanksCone);
        $("#cboRSShift").val(oRouteSheet.RSShiftID);
        ChangeDyeingType();

        if(oRouteSheet.RouteSheetDOs.length>0)
        {
            DynamicRefreshList(oRouteSheet.RouteSheetDOs, "tblRouteSheetDO");
            RefreshRSDO();
        }

        var oTree=[];
        if(oRouteSheet.RouteSheetDetail.RouteSheetDetailID>0){
            oTree=[oRouteSheet.RouteSheetDetail];
        }
        LoadTreeGrid(oTree);
    }

    function LoadTreeGrid(oTree){
        var data= oTree;
        data={"total":""+data.length+"","rows":data};
        $('#tblTreeGridProcess').treegrid('loadData',data);
    }

    /*---------------- Route Sheet Save  --------------*/

    function Validation(){

        if(_nPTUID<=0){
            $('#txtPTU').focus();
            $('#txtPTU').addClass("errorFieldBorder");
            alert('No dyeing order found.');
            return false;
        }
        else{
            $('#txtPTU').removeClass("errorFieldBorder");
        }

        if(parseInt($("#cboDyeingTypes").val())<=0){
            $('#cboDyeingTypes').focus();
            $('#cboDyeingTypes').addClass("errorFieldBorder");
            alert('Select Dyeing type.');
            return false;
        }
        else{
            $('#cboDyeingTypes').removeClass("errorFieldBorder");
        }
        if($('#cboStore').val()<=0 && $('#tabRS').data('RouteSheetSetup').IsLotMandatory==true){
            $('#cboStore').focus();
            $('#cboStore').addClass("errorFieldBorder");
            alert('Select store.');
            return false;
        }
        else{
            $('#cboStore').removeClass("errorFieldBorder");
        }

        if(_nProductID<=0){
            $('#txtProduct').focus();
            $('#txtProduct').addClass("errorFieldBorder");
            alert('No raw product found.');
            return false;
        }
        else{
            $('#txtProduct').removeClass("errorFieldBorder");
        }


        if(_nLotID<=0 && $('#tabRS').data('RouteSheetSetup').IsLotMandatory==true)
        {
            $('#txtLot').focus();
            $('#txtLot').addClass("errorFieldBorder");
            alert('No lot found.');
            return false;
        }
        else{
            $('#txtLot').removeClass("errorFieldBorder");
        }

        if($.trim($('#txtQty').val())==""){
            $('#txtQty').focus();
            $('#txtQty').addClass("errorFieldBorder");
            alert('Quantity required.');
            return false;
        }
        else{
            $('#txtQty').removeClass("errorFieldBorder");
        }

        if( parseFloat(icsRemoveComma($('#txtTtlLiquire').val()))<=0){
            $('#txtTtlLiquire').focus();
            $('#txtTtlLiquire').addClass("errorFieldBorder");
            alert('TtlLiquire required.');
            return false;
        }
        else{
            $('#txtTtlLiquire').removeClass("errorFieldBorder");
        }

        var oRouteSheetDOs=$("#tblRouteSheetDO").datagrid('getRows');
        if(oRouteSheetDOs==null || oRouteSheetDOs.length<=0)
        {
            $('#txtOrderNo').focus();
            $('#txtOrderNo').addClass("errorFieldBorder");
            alert('Order No required.');
            return false;
        }
        else{
            $('#txtOrderNo').removeClass("errorFieldBorder");
        }

        if(oRouteSheetDOs.length>0)
        {
            if(parseInt($("#cboOrderType").val())!=oRouteSheetDOs[0].OrderTypeInt)
            {
                $('#cboOrderType').focus();
                $('#cboOrderType').addClass("errorFieldBorder");
                alert('Order Type and Order Not same.');
                return false;
            }
            else{
                $('#cboOrderType').removeClass("errorFieldBorder");
            }
        }


        //if(_nMachineID<=0){
        //    $('#txtMachine').focus();
        //    $('#txtMachine').addClass("errorFieldBorder");
        //    alert('No machine found.');
        //    return false;
        //}
        //else{
        //    $('#txtMachine').removeClass("errorFieldBorder");
        //}
        return true;
    }

    function RefreshObject()
    {
        var oRouteSheet={
            RouteSheetID: (_oRouteSheet!=null && _oRouteSheet.RouteSheetID>0)? _oRouteSheet.RouteSheetID:0,
            RouteSheetDate: $('#dtOrderDate').datebox('getValue'),
            MachineID: _nMachineID,
            ProductID_Raw: _nProductID,
            OrderType:parseInt($("#cboOrderType").val()),
            LotID: _nLotID,
            Qty: parseFloat(icsRemoveComma($('#txtQty').val())),
            QtyDye: parseFloat($('#txtQtyDye').val()),
            QtyOmit:parseFloat($('#txtQtyOmit').val()),
            Label:  parseInt( $('#btnLabel').val()),
            LocationID : $('#cboLocation').val(),
            PTUID : _nPTUID,
            ProductionScheduleDetailID : 0,
            RouteSheetNo : $.trim($('#txtRouteSheetNo').val()),
            Note : $.trim($('#txtNote').val()),
            TtlLiquire : parseFloat(icsRemoveComma($('#txtTtlLiquire').val())),
            TtlCotton : parseFloat(icsRemoveComma($('#txtTtlLiquireCottton').val())),
            HanksCone : parseInt($("#cboDyeingTypes").val()),
            RSShiftID : parseInt($("#cboRSShift").val()),
            NoOfHanksCone : parseFloat(icsRemoveComma($('#txtHanksCone').val())),
            RouteSheetDOs:$("#tblRouteSheetDO").datagrid('getRows'),
            IsReDyeing:false
        };
        return oRouteSheet;
    }

    $("#btnSave").click(function (){
        debugger;
        endEditing();
        if(!Validation()) return false;

        var oRouteSheet=RefreshObject();
        $("#btnSave").hide();

        $.ajax({
            type: "POST",
            dataType: "json",
            url: _sBaseAddress+ '/RouteSheet/Save',
            traditional: true,
            data:  JSON.stringify(oRouteSheet),
            contentType: "application/json; charset=utf-8",
            success: function (data) {
                //debugger;
                var oRS = jQuery.parseJSON(data);
                $("#btnSave").show();
                if (oRS.ErrorMessage==""|| oRS.ErrorMessage==null)
                {
                    if(_oRouteSheet!=null && _oRouteSheet.RouteSheetID>0)
                    {
                        oRS.RouteSheetDetail= _oRouteSheet.RouteSheetDetail;
                    }
                    RefreshControl(oRS);
                    SetIntoSessionStorage();
                    alert("Save Successfully")
                    $('#tabRS').tabs('select',1);
                }
                else
                {
                    alert(oRS.ErrorMessage);
                    return;
                }

            },
            error: function (xhr, status, error) {
                alert(error);
            }
        });
        ///
        //var obj = {
        //    BaseAddress: _sBaseAddress,
        //    Object: oRouteSheet,
        //    ObjectId: oRouteSheet.RouteSheetID,
        //    ControllerName: "RouteSheet",
        //    ActionName: "Save",
        //    TableId: "",
        //    IsWinClose: false,
        //    Message: (oRouteSheet.RouteSheetID>0)?"Update Successfully." : "Save Successfully."
        //};
        //$.icsSave(obj, function (response) {
        //    if (response.status && response.obj != null) {
        //        if (response.obj.RouteSheetID > 0) {
        //            response.obj.RouteSheetDetail = ((_oRouteSheet!=null && _oRouteSheet.RouteSheetID>0)? _oRouteSheet.RouteSheetDetail: response.obj.RouteSheetDetail);
        //            RefreshControl(response.obj);
        //            SetIntoSessionStorage();
        //            $('#tabRS').tabs('select',1);

        //        }
        //    }
        //});
    });
    $("#btnSaveDetail").click(function (){
        debugger;
        endEditing();
        if(!Validation()) return false;


        var oRouteSheet={
            RouteSheetID: (_oRouteSheet!=null && _oRouteSheet.RouteSheetID>0)? _oRouteSheet.RouteSheetID:0,
            RouteSheetDate: $('#dtOrderDate').datebox('getValue')
        }

        $.ajax({
            type: "POST",
            dataType: "json",
            url: _sBaseAddress+ '/RouteSheet/UpdateDetail',
            traditional: true,
            data:  JSON.stringify(oRouteSheet),
            contentType: "application/json; charset=utf-8",
            success: function (data) {
                debugger;
                var oRSD = jQuery.parseJSON(data);
                if (oRSD.ErrorMessage==""|| oRSD.ErrorMessage==null)
                {
                    var oTree=[];
                    if(oRSD.RouteSheetDetailID>0)
                    {
                        alert("Save Successfully")
                        _oRouteSheet.RouteSheetDetail=oRSD;
                        oTree=[oRSD];
                        LoadTreeGrid(oTree);

                    }
                    else{
                        alert("Unable to Save"+oRSD.ErrorMessage)
                    }


                }
                else
                {
                    alert(oRSD.ErrorMessage);
                    return;
                }
            },
            error: function (xhr, status, error) {
                alert(error);
            }
        });

    });
    $("#btnCopy").click(function (){
        debugger;
        endEditing();
        if(!Validation()) return false;

        var oRouteSheet=RefreshObject();
        //if ($("#chkIsReDyeing").is(':checked'))
        //{
        //    oRouteSheet.IsReDyeing=true;

        //    if (!confirm("Confirm to Re-Dyeing With No->[A,B,--]?")) return false;
        //}else{
        //    oRouteSheet.IsReDyeing=false;
        //    if (!confirm("Confirm to Copy this Dyeing Card with New No ?")) return false;
        //}
        if (!confirm("Confirm to Copy this Dyeing Card with New No ?")) return false;
        oRouteSheet.IsReDyeing=false;
        oRouteSheet.RouteSheetNo="";

        $.ajax({
            type: "POST",
            dataType: "json",
            url: _sBaseAddress+ '/RouteSheet/CopyRouteSheet',
            traditional: true,
            data:  JSON.stringify(oRouteSheet),
            contentType: "application/json; charset=utf-8",
            success: function (data) {
                //debugger;
                var oRS = jQuery.parseJSON(data);
                if (oRS.ErrorMessage==""|| oRS.ErrorMessage==null)
                {
                    _oRouteSheet=oRS;
                    var sBackLink=sessionStorage.getItem('BackLink');

                    var oRouteSheets =sessionStorage.getItem("RouteSheets");
                    debugger;
                    if(oRouteSheets!=null)
                    {
                        oRouteSheets = jQuery.parseJSON(oRouteSheets);
                    }
                    else
                    {
                        oRouteSheets=[];
                    }

                    sessionStorage.setItem("SelectedRowIndex", oRouteSheets.length);
                    oRouteSheets.push(_oRouteSheet);
                    sessionStorage.setItem("RouteSheets", JSON.stringify(oRouteSheets));
                    window.location.href = sBackLink;
                }
                else
                {
                    alert(oRS.ErrorMessage);
                    return;
                }
            },
            error: function (xhr, status, error) {
                alert(error);
            }
        });
        ///
        //var obj = {
        //    BaseAddress: _sBaseAddress,
        //    Object: oRouteSheet,
        //    ObjectId: oRouteSheet.RouteSheetID,
        //    ControllerName: "RouteSheet",
        //    ActionName: "Save",
        //    TableId: "",
        //    IsWinClose: false,
        //    Message: (oRouteSheet.RouteSheetID>0)?"Update Successfully." : "Save Successfully."
        //};
        //$.icsSave(obj, function (response) {
        //    if (response.status && response.obj != null) {
        //        if (response.obj.RouteSheetID > 0) {
        //            response.obj.RouteSheetDetail = ((_oRouteSheet!=null && _oRouteSheet.RouteSheetID>0)? _oRouteSheet.RouteSheetDetail: response.obj.RouteSheetDetail);
        //            RefreshControl(response.obj);
        //            SetIntoSessionStorage();
        //            $('#tabRS').tabs('select',1);

        //        }
        //    }
        //});
    });
    $("#btnReDyeing").click(function (){
        debugger;
        endEditing();
        if(!Validation()) return false;

        var oRouteSheet=RefreshObject();
        //if ($("#chkIsReDyeing").is(':checked'))
        //{
        //    oRouteSheet.IsReDyeing=true;

        //    if (!confirm("Confirm to Re-Dyeing With No->[A,B,--]?")) return false;
        //}else{
        //    oRouteSheet.IsReDyeing=false;
        //    if (!confirm("Confirm to Copy this Dyeing Card with New No ?")) return false;
        //}
        if (!confirm("Confirm to Re-Dyeing With No->[A,B,--]?")) return false;

        if(parseInt($("#cboIsReDyeing").val())<=0){
            $('#cboIsReDyeing').focus();
            $('#cboIsReDyeing').addClass("errorFieldBorder");
            alert('Select Dyeing type.');
            return false;
        }
        else{
            $('#cboIsReDyeing').removeClass("errorFieldBorder");
        }
        oRouteSheet.IsReDyeing=parseInt($('#cboIsReDyeing').val());

        if (!confirm("Confirm to Re-Dyeing With No->[A,B,--]?")) return false;

        $.ajax({
            type: "POST",
            dataType: "json",
            url: _sBaseAddress+ '/RouteSheet/CopyRouteSheet',
            traditional: true,
            data:  JSON.stringify(oRouteSheet),
            contentType: "application/json; charset=utf-8",
            success: function (data) {
                //debugger;
                var oRS = jQuery.parseJSON(data);
                if (oRS.ErrorMessage==""|| oRS.ErrorMessage==null)
                {
                    _oRouteSheet=oRS;
                    var sBackLink=sessionStorage.getItem('BackLink');

                    var oRouteSheets =sessionStorage.getItem("RouteSheets");
                    debugger;
                    if(oRouteSheets!=null)
                    {
                        oRouteSheets = jQuery.parseJSON(oRouteSheets);
                    }
                    else
                    {
                        oRouteSheets=[];
                    }

                    sessionStorage.setItem("SelectedRowIndex", oRouteSheets.length);
                    oRouteSheets.push(_oRouteSheet);
                    sessionStorage.setItem("RouteSheets", JSON.stringify(oRouteSheets));
                    window.location.href = sBackLink;
                }
                else
                {
                    alert(oRS.ErrorMessage);
                    return;
                }
            },
            error: function (xhr, status, error) {
                alert(error);
            }
        });

    });


    /*---------------- Route Sheet Detail Save  --------------*/

    function ResetDetail(bIsProductReset){

        if(bIsProductReset){
            _nProductID=0;
            $('#txtProduct').val("");
        }

        $('#cboKnitPly').val(0);
        $('#txtColorSet,#txtShadeCount').val(3);
        $('#txtCombo').val(1);
        $('#txtColorName,#txtRGB,#txtPantonNo,#txtReftNo').val("");
    }

    function ValidationDetail(){

        if(_nProductID<=0){
            $('#txtProduct').focus();
            $('#txtProduct').addClass("errorFieldBorder");
            alert('No product found.');
            return false;
        }
        else{
            $('#txtProduct').removeClass("errorFieldBorder");
        }
        if($.trim($('#txtColorName').val())==""){
            $('#txtColorName').focus();
            $('#txtColorName').addClass("errorFieldBorder");
            alert('Color name required.');
            return false;
        }
        else{
            $('#txtColorName').removeClass("errorFieldBorder");
        }
        //if($.trim($('#txtRGB').val())==""){
        //    $('#txtRGB').focus();
        //    $('#txtRGB').addClass("errorFieldBorder");
        //    alert('RGB required.');
        //    return false;
        //}
        //else{
        //    $('#txtRGB').removeClass("errorFieldBorder");
        //}

        if($.trim($('#txtPantonNo').val())==""){
            $('#txtPantonNo').focus();
            $('#txtPantonNo').addClass("errorFieldBorder");
            alert('Panton no required.');
            return false;
        }
        else{
            $('#txtPantonNo').removeClass("errorFieldBorder");
        }

        return true;
    }

    function RefreshObjectDetail(){


        var oRouteSheetDetail={
            RouteSheetDetailID:0,
            RouteSheetID: (_oRouteSheet!=null && _oRouteSheet.RouteSheetID>0)? _oRouteSheet.RouteSheetID:0,
            ProductID:_nProductID,
            ColorSet:$('#txtColorSet').val(),
            ShadeCount:$('#txtShadeCount').val(),
            KnitPlyYarn:$('#cboKnitPly').val(),
            ColorName:$.trim($('#txtColorName').val()),
            RefNo:$.trim($('#txtReftNo').val()),
            PantonNo:$.trim($('#txtPantonNo').val()),
            RGB:$.trim($('#txtRGB').val()),
            Combo:$('#txtCombo').val(),
            RouteSheet:(_oRouteSheet==null || _oRouteSheet.RouteSheetID<=0)? RefreshObject() : null
        }
        return oRouteSheetDetail;
    }


    $("#btnAddDetail").click(function () {
        if(!Validation()) return false;
        if (!ValidationDetail()) return false;
        var oRouteSheetDetail = RefreshObjectDetail();
        var obj = {
            BaseAddress: _sBaseAddress,
            Object: oRouteSheetDetail,
            ObjectId: oRouteSheetDetail.RouteSheetDetailID,
            ControllerName: "RouteSheet",
            ActionName: "SaveDetail",
            TableId: "",
            IsWinClose: false,
            Message: ""// (oRouteSheetDetail.RouteSheetDetailID>0)?"Update Successfully." : "Save Successfully."
        };
        $.icsSave(obj, function (response) {
            if (response.status && response.obj != null) {
                debugger
                if (response.obj.RouteSheetDetailID > 0) {
                    if(response.obj.RouteSheet.RouteSheetID>0)
                    {
                        var oRouteSheet=response.obj.RouteSheet;
                        oRouteSheet.RouteSheetDetails=$('#tblRouteSheetDetail').datagrid('getRows');
                        RefreshControl(oRouteSheet);
                        //  SetIntoSessionStorage();
                        response.obj.RouteSheet=null;
                    }
                    $('#tblRouteSheetDetail').datagrid('appendRow',response.obj);
                    ResetDetail(false);
                }
            }
        });
    });

    $("#btnRemoveDetail").click(function () {

        var oRouteSheetDetail = $("#tblRouteSheetDetail").datagrid("getSelected");
        if (oRouteSheetDetail == null || oRouteSheetDetail.RouteSheetDetailID <= 0) { alert("Please select an item from list!"); return false; }

        if (!confirm("Confirm to Delete?")) return false;

        var obj =
        {
            BaseAddress: _sBaseAddress,
            Object: oRouteSheetDetail,
            ControllerName: "RouteSheet",
            ActionName: "DeleteDetail",
            TableId: "tblRouteSheetDetail",
            IsWinClose: false,
            Message:''
        };
        $.icsDelete(obj);

    });

    /*---------------- Changing Event  --------------*/




    $('#cboStore').change(function(e){

        _nLotID=0;
        $("#txtLot").val("");
    });

    //$('#chkOrder').click(function(e){
    //    if($('#chkOrder').is(':checked')){
    //        $('#chkPI').prop('checked',false);
    //    }
    //    else{
    //        $('#chkPI').prop('checked',true);
    //    }

    //});

    //$('#chkPI').click(function(e){
    //    if($('#chkPI').is(':checked')){
    //        $('#chkOrder').prop('checked',false);
    //    }
    //    else{
    //        $('#chkOrder').prop('checked',true);
    //    }
    //});



    $("#txtQty").keyup(function (e) {
        CalculateTTLLiquore();
    });

    $("#txtMultipleBy").keyup(function (e) {
        CalculateTTLLiquore();
    });
    function CalculateTTLLiquore(){

        var nQty= icsRemoveComma($("#txtQty").val());
        var nMultiple= icsRemoveComma($("#txtMultipleBy").val());

        if(!isNaN(nQty) && !isNaN(nMultiple)){
            $("#txtTtlLiquire").val(formatPrice(parseFloat(nQty) * parseFloat(nMultiple)));
        }
        else{
            $("#txtTtlLiquire").val("0.00");
        }

        var nDividend= icsRemoveComma($("#txtHanksCone").val());
        if(!isNaN(nQty) && !isNaN(nDividend) && nQty>0 && nDividend>0){
            $("#txtWeightHanksCone").val(formatPrice(parseFloat(nQty) / parseFloat(nDividend)));
        }
        else{
            $("#txtWeightHanksCone").val("0.00");
        }


    }
    $("#txtTtlLiquire").keyup(function (e) {
        CalculateTMultipleBy();
    });

    function CalculateTMultipleBy(){

        var nQty= icsRemoveComma($("#txtQty").val());
        var nTtlLiquire= icsRemoveComma($("#txtTtlLiquire").val());

        if(!isNaN(nQty) && !isNaN(nTtlLiquire)){
            $("#txtMultipleBy").val(formatPrice(parseFloat(nTtlLiquire) / parseFloat(nQty)));
        }
        else{
            $("#txtMultipleBy").val("0.00");
        }

        var nDividend= icsRemoveComma($("#txtHanksCone").val());
        if(!isNaN(nQty) && !isNaN(nDividend) && nQty>0 && nDividend>0){
            $("#txtWeightHanksCone").val(formatPrice(parseFloat(nQty) / parseFloat(nDividend)));
        }
        else{
            $("#txtWeightHanksCone").val("0.00");
        }


    }

    $("#txtHanksCone").keyup(function (e) {
        debugger;
        var nQty= icsRemoveComma($("#txtQty").val());
        var nMultiple= icsRemoveComma($("#txtHanksCone").val());

        if(!isNaN(nQty) && !isNaN(nMultiple) && nMultiple>0 && nQty>0){
            $("#txtWeightHanksCone").val(formatPrice(parseFloat(nQty) / parseFloat(nMultiple)));
        }
        else{
            $("#txtWeightHanksCone").val("0.00");
        }
    });

    $("#txtWeightHanksCone").keyup(function (e) {
        var nQty= icsRemoveComma($("#txtQty").val());
        var nDividend= icsRemoveComma($("#txtWeightHanksCone").val());

        if(!isNaN(nQty) && !isNaN(nDividend) && nQty>0 && nDividend>0){
            $("#txtHanksCone").val(formatPrice(parseFloat(nQty) / parseFloat(nDividend)));
        }
        else{
            $("#txtHanksCone").val("0.00");
        }
    });
    /*---------------- LadDip Gets By Labdip No and color No  --------------*/

    $("#btnPickLabdipNo").click(function () {

        var sLabdipNo=$.trim($("#txtLabdipNo").val());
        if(sLabdipNo==""){ alert("Type Labdip No for search."); return false; }

        if ($.trim($("#txtLabdipNo").val()).length<4 ) {

            alert("Please enter at least 4 character to search.");
            $('#txtLabdipNo').focus();
            return;
        }
        else { $('#txtLabdipNo').removeClass("errorFieldBorder"); }

        var oLabDipDetails = {
            ColorNo:"",
            LabdipNo:sLabdipNo
        };

        GetLabDipDetails(oLabDipDetails);
    });

    $("#txtLabdipNo").keydown(function (e) {
        var nkeyCode = e.keyCode || e.which;
        if(nkeyCode==13){
            var sLabdipNo=$.trim($("#txtLabdipNo").val());
            if(sLabdipNo==""){ alert("Type Labdip No for search."); return false; }
            if ($.trim($("#txtLabdipNo").val()).length<4 ) {

                alert("Please enter at least 4 character to search.");
                $('#txtLabdipNo').focus();
                return;
            }
            else { $('#txtLabdipNo').removeClass("errorFieldBorder"); }
            var oLabDipDetails = {
                ColorNo:"",
                LabdipNo:sLabdipNo
            };
            GetLabDipDetails(oLabDipDetails);
        }
        else if(nkeyCode==8){
            $("#sLabdipNo").val("");
            _nLabDipDetailID=0;
        }
    });
    $("#btnColorNo").click(function () {

        var sColorNo=$.trim($("#txtColorNo").val());
        if(sColorNo=="")
        {
            alert("Type Color No for search."); return ;
        }
        if ($.trim($("#txtColorNo").val()).length<6 ) {

            alert("Please enter at least 6 character to search.");
            $('#txtColorNo').focus();
            return;
        }
        else { $('#txtColorNo').removeClass("errorFieldBorder"); }

        var oLabDipDetails = {
            ColorNo:sColorNo,
            LabdipNo:""
        };

        GetLabDipDetails(oLabDipDetails);
    });

    $("#txtColorNo").keydown(function (e) {
        var nkeyCode = e.keyCode || e.which;
        if(nkeyCode==13){
            var sColorNo=$.trim($("#txtColorNo").val());
            if(sColorNo==""){ alert("Type Color No for search."); return false; }

            if ($.trim($("#txtColorNo").val()).length<6 ) {

                alert("Please enter at least 6 character to search.");
                $('#txtColorNo').focus();
                return;
            }
            else { $('#txtColorNo').removeClass("errorFieldBorder"); }

            var oLabDipDetails = {
                ColorNo:sColorNo,
                LabdipNo:""
            };
            GetLabDipDetails(oLabDipDetails);
        }
        else if(nkeyCode==8){
            $("#txtColorNo").val("");
            _nLabDipDetailID=0;
        }
    });
    function GetLabDipDetails(oLabDipDetails){

        var obj = {
            BaseAddress: _sBaseAddress,
            Object: oLabDipDetails,
            ControllerName: "LabDip",
            ActionName: "GetsLabDipDetail",
            IsWinClose: false
        };
        $("#progressbar").progressbar({ value: 0 });
        $("#progressbarParent").show();
        var intervalID = setInterval(updateProgress, 250);
        $.icsDataGets(obj, function (response) {
            clearInterval(intervalID);
            $("#progressbarParent").hide();
            if (response.status && response.objs.length > 0) {
                if (response.objs[0].LabDipDetailID > 0) {
                    debugger;
                    var tblColums = [];
                    var oColumn = { field: "LabdipNo", title: "LabdipNo", width: 110, align: "left" };tblColums.push(oColumn);
                    oColumn = { field: "ColorNo", title: "ColorNo", width: 110, align: "left" };tblColums.push(oColumn);
                    oColumn = { field: "ColorName", title: "ColorName", width: 160, align: "left" };tblColums.push(oColumn);
                    oColumn = { field: "ProductName", title: "Yarn", width: 150, align: "left" };tblColums.push(oColumn);

                    var oPickerParam = {
                        winid: 'winLabDipPicker',
                        winclass:'clsLabDipPicker',
                        winwidth: 550,
                        winheight: 460,
                        tableid: 'tblLabDipPicker',
                        tablecolumns: tblColums,
                        datalist: response.objs,
                        multiplereturn: false,
                        searchingbyfieldName:'ColorNo',
                        windowTittle: 'LabDip List'
                    };
                    $.icsPicker(oPickerParam);
                    IntializePickerbutton(oPickerParam);//multiplereturn, winclassName
                }
                else { alert(response.objs[0].ErrorMessage); }
            }
            else{
                alert("No Order found.");
            }
        });


    }
    function ChangeOrderType()
    {
        var ocboOrderType = document.getElementById("cboOrderType");
        var sText = ocboOrderType.options[ocboOrderType.selectedIndex].text;
        var ncboOrderType=parseInt($("#cboOrderType").val());
        $('#tblRouteSheetDO').datagrid('hideColumn', 'ClaimOrderNo');

        if(ncboOrderType<=0 || ncboOrderType==null)
        {
            sText="Order No";
            $(".lblOrderNo").html(sText);
        }
        else if(ncboOrderType===5)
        {
            $(".lblOrderNo").html(sText);
            $('#tblRouteSheetDO').datagrid('showColumn', 'ClaimOrderNo');
        }
        else
        {
            $(".lblOrderNo").html(sText);
        }
    }
    function ChangeDyeingType()
    {
        var cboDyeingTypes=parseInt($("#cboDyeingTypes").val());

        if(cboDyeingTypes==2){

            $('#lblHanksCone').text("No. of Cone:");
            $('#lblWeight').text("Weight/ Cone:");
        }
        else{
            $('#lblHanksCone').text("No. of Bells:");
            $('#lblWeight').text("Weight/ Bells:");
        }


    }
    //Order No
    $("#btnPickOrderNo").click(function () {

        if (parseInt($("#cboOrderType").val())<=0 ) {

            alert("Please Select Order Type.");
            $('#cboOrderType').focus();
            $('#cboOrderType').removeClass("errorFieldBorder");
            return;
        }
        //var sorderNo=$.trim($("#txtOrderNo").val());
        //if(sorderNo=="")
        //{
        //    alert("Type order No for search."); return ;
        //}
        //if ($.trim($("#txtOrderNo").val()).length<6 ) {

        //    alert("Please enter at least 6 character to search.");
        //    $('#txtColorNo').focus();
        //    return;
        //}
        //else { $('#txtOrderNo').removeClass("errorFieldBorder"); }

        var oRouteSheetDO = {
            OrderTypeInt:$('#cboOrderType').val(),
            OrderNo:$('#txtOrderNo').val(),
            LabDipDetailID:_nLabDipDetailID
        };

        GetOrders(oRouteSheetDO);
    });

    $("#txtOrderNo").keydown(function (e) {
        var nkeyCode = e.keyCode || e.which;
        if(nkeyCode==13){
            var sorderNo=$.trim($("#txtOrderNo").val());
            if (parseInt($("#cboOrderType").val())<=0 ) {

                alert("Please Select Order Type.");
                $('#cboOrderType').focus();
                $('#cboOrderType').removeClass("errorFieldBorder");
                return;
            }

            var oRouteSheetDO = {
                OrderTypeInt:$('#cboOrderType').val(),
                OrderNo:sorderNo,
                LabDipDetailID:_nLabDipDetailID
            };
            GetOrders(oRouteSheetDO);
        }
        else if(nkeyCode==8){
            $("#txtOrderNo").val("");

        }
    });
    function GetOrders(oRouteSheetDO){

        var obj = {
            BaseAddress: _sBaseAddress,
            Object: oRouteSheetDO,
            ControllerName: "RouteSheet",
            ActionName: "GetsRouteSheetDO",
            IsWinClose: false
        };
        //$("#progressbar").progressbar({ value: 0 });
        //$("#progressbarParent").show();
        $.icsDataGets(obj, function (response) {
            //clearInterval(intervalID);
            //$("#progressbarParent").hide();
            if (response.status && response.objs.length > 0) {
                if (response.objs[0].DyeingOrderDetailID > 0) {
                    debugger;
                    var tblColums = [];
                    var ncboOrderType=parseInt($("#cboOrderType").val());
                    var oColumn = { field: "OrderNoFull", title: "OrderNo", width: 100, align: "left" };tblColums.push(oColumn);
                    if( ncboOrderType===5)
                    {
                        oColumn = { field: "ClaimOrderNo", title: "OrginOrderNo", width: 75, align: "left" };tblColums.push(oColumn);
                    }
                    oColumn = { field: "OrderQty", title: "OrderQty", width: 75, align: "right",formatter:formatPrice };tblColums.push(oColumn);
                    oColumn = { field: "Qty_Pro", title: "Prod Qty", width: 75, align: "right",formatter:formatPrice };tblColums.push(oColumn);
                    oColumn = { field: "Qty_RS", title: "Yet To Pro", width: 75, align: "right" };tblColums.push(oColumn);
                    oColumn = { field: "ProductName", title: "Yarn", width: 225, align: "left" };tblColums.push(oColumn);
                    oColumn = { field: "ColorName", title: "ColorName", width: 100, align: "left" };tblColums.push(oColumn);
                    oColumn = { field: "ShadeSt", title: "Shade", width: 40, align: "left" };tblColums.push(oColumn);
                    oColumn = { field: "ColorNo", title: "ColorNo", width: 80, align: "left" };tblColums.push(oColumn);
                    oColumn = { field: "LabdipNo", title: "LabdipNo", width: 100, align: "left" };tblColums.push(oColumn);
                    oColumn = { field: "OrderTypeSt", title: "OrderType", width: 100, align: "left" };tblColums.push(oColumn);
                    var oPickerParam = {
                        winid: 'winOrderPicker',
                        winclass:'clsOrderPicker',
                        winwidth: 1000,
                        winheight: 660,
                        tableid: 'tblOrderPicker',
                        tablecolumns: tblColums,
                        datalist: response.objs,
                        multiplereturn: true,
                        searchingbyfieldName:'OrderNo',
                        windowTittle: 'Order List'
                    };
                    $.icsPicker(oPickerParam);
                    IntializePickerbutton(oPickerParam);//multiplereturn, winclassName
                }
                else { alert(response.objs[0].ErrorMessage); }
            }
            else{
                alert("No order found.");
            }
        });


    }
    function IntializePickerbutton(oPickerobj) {
        $("#" + oPickerobj.winid).find("#btnOk").click(function () {
            //for Single Select
            SetPickerValueAssign(oPickerobj);
        });
        $(document).find('.' + oPickerobj.winclass).keydown(function (e) {
            if (e.which == 13)//enter=13
            {
                SetPickerValueAssign(oPickerobj);

            }
        });
    }
    function SetPickerValueAssign(oPickerobj) {
        debugger;
        var oreturnObj = null, oreturnobjs = [];
        if (oPickerobj.multiplereturn) {
            oreturnobjs = $('#' + oPickerobj.tableid).datagrid('getChecked');
        } else {
            oreturnObj = $('#' + oPickerobj.tableid).datagrid('getSelected');
        }
        $("#" + oPickerobj.winid).icsWindow("close");
        $("#" + oPickerobj.winid).remove();

        //if (oPickerobj.winid == 'winProductPicker') {
        //    if (oreturnObj != null && oreturnObj.ProductID > 0)
        //    {
        //        $('#txtProduct').val(oreturnObj.ProductNameCode);
        //        _nProductID= oreturnObj.ProductID;
        //        _nExportSCDetailID=oreturnObj.ExportSCDetailID;
        //        $('#txtQtyInlbs').val(parseFloat(oreturnObj.YetToPO).toFixed(2));
        //        $('#txtUnitPriceInlbs').val(parseFloat(oreturnObj.UnitPrice).toFixed(2));
        //        ConvertIntoKg_Qty();
        //        ConvertIntoKgs_UnitPrice();
        //    }
        //    else{
        //        alert("Data Not Found.");
        //        return;
        //    }
        //}
        if (oPickerobj.winid == 'winLabDipPicker')
        {
            if (oreturnObj != null && oreturnObj.LabDipDetailID > 0)
            {
                $('#txtColorNo').val(oreturnObj.ColorNo);
                //$('#txtColorName').val(oreturnObj.ColorName);
                $('#txtLabdipNo').val(oreturnObj.LabdipNo);
                _nLabDipDetailID= oreturnObj.LabDipDetailID;
            }
            else{
                alert("Data Not Found.");
                return;
            }
        }
        else if (oPickerobj.winid == 'winOrderPicker')
        {
            if (oreturnobjs != null && oreturnobjs.length > 0)
            {
                debugger;
                for (i=0; i<oreturnobjs.length;i++)
                {
                    var bExists= IsExist(oreturnobjs[i].LabDipDetailID)
                    if(bExists)
                    {
                        alert("Color must be same")
                        return;
                    }
                    bExists= IsExist_DOD(oreturnobjs[i].LabDipDetailID)
                    if(bExists)
                    {
                        alert("This Order already exists.")
                        return;
                    }

                    $('#tblRouteSheetDO').datagrid('appendRow',oreturnobjs[i]);


                    $('#txtColorNo').val(oreturnobjs[0].ColorNo);
                    $('#txtLabdipNo').val(oreturnobjs[0].LabdipNo);
                    //_oRouteSheet.LabDipDetailID= oreturnobjs[0].LabDipDetailID;
                    $('#txtBuyerName').val(oreturnobjs[0].ContractorName);
                    $('#txtProductPTU').val(oreturnobjs[0].ProductName);
                    //$('#txtColorNo').val(oPTU.ColorNo);
                    $('#txtColorShade').val(oreturnobjs[0].ColorName);
                    _nLabDipDetailID= oreturnobjs[0].LabDipDetailID;
                    _nPTUID= oreturnobjs[0].PTUID;
                    _nProductID= oreturnobjs[0].ProductID;
                    $('#txtColorNo').val(oreturnobjs[0].ColorNo);
                    $('#txtOrderNo').val(oreturnobjs[0].OrderNo);
                    $('#txtProduct').val(oreturnobjs[0].ProductName);
                    RefreshRSDO();
                }


            }
            else{
                alert("Data Not Found.");
                return;
            }
        }


    }
    $("#btnRefreshRSDO").click(function () {

        endEditing();
    });
    function IsExist(nLabDipDetailID)
    {
        var oRSDOs = $('#tblRouteSheetDO').datagrid('getRows');
        for (var i = 0; i < oRSDOs.length; i++)
        {
            if (parseInt(oRSDOs[i].LabDipDetailID) != parseInt(nLabDipDetailID))
            {
                return true;
            }
        }

        return false;
    }
    function IsExist_DOD(nDyeingOrderDetailID)
    {
        var oRSDOs = $('#tblRouteSheetDO').datagrid('getRows');
        for (var i = 0; i < oRSDOs.length; i++) {
            if (parseInt(oRSDOs[i].DyeingOrderDetailID) == parseInt(nDyeingOrderDetailID))
            {
                return true;
            }
        }

        return false;
    }
    $("#btnDeleteRSDO").click(function () {

        var oRSDO = $('#tblRouteSheetDO').datagrid('getSelected');

        if (!confirm("Confirm to Remove?")) return false;
        var sOperation=sessionStorage.getItem('Operation');

        if(sOperation=="Copy" || sOperation=="ReDyeing")
        {
            oRSDO.RouteSheetDOID=0;
        }
        if (oRSDO == null || oRSDO.RouteSheetDOID<=0)
        {
            var SelectedRowIndex = $('#tblRouteSheetDO').datagrid('getRowIndex', oRSDO);
            $('#tblRouteSheetDO').datagrid('deleteRow',SelectedRowIndex);
        }
        else{
            var obj =
            {
                BaseAddress: _sBaseAddress,
                Object: oRSDO,
                ControllerName: "RouteSheet",
                ActionName: "DeleteRSDO",
                TableId: "tblRouteSheetDO",
                IsWinClose: false,
                Message:''
            };
            $.icsDelete(obj);
        }

    });
    function RefreshRSDO()
    {
        var oRouteSheetDOs = $('#tblRouteSheetDO').datagrid('getRows');
        var nQty_RS = 0;
        var Qty_RSKG = 0;
        var nOrderQty = 0;
        var nOrderQtyKG=0;
        for(var i = 0; i<oRouteSheetDOs.length;i++)
        {
            nQty_RS+=parseFloat(oRouteSheetDOs[i].Qty_RS);
            Qty_RSKG+=parseFloat(oRouteSheetDOs[i].Qty_RSKG);
            nOrderQty+=parseFloat(oRouteSheetDOs[i].OrderQty);
            nOrderQtyKG+=parseFloat(oRouteSheetDOs[i].OrderQtyKG);
        }
        $('#txtQty').val(formatPrice(nQty_RS));
        $('#txtQtyKg').val(formatPrice(Qty_RSKG));
        document.getElementById('lblQty_RS').innerHTML = formatPrice(nQty_RS,0);
        document.getElementById('lblQty_RSKG').innerHTML =formatPrice(Qty_RSKG,0);
        document.getElementById('lblOrderQty').innerHTML =formatPrice(nOrderQty,0);
        document.getElementById('lblOrderQtyKG').innerHTML =formatPrice(nOrderQtyKG,0);


    }
    var editIndex = undefined;
    function endEditing() {

        if (editIndex == undefined) {
            return true;
        }

        if ($('#tblRouteSheetDO').datagrid('validateRow', editIndex)) {
            $('#tblRouteSheetDO').datagrid('endEdit', editIndex);
            $('#tblRouteSheetDO').datagrid('selectRow', editIndex);

            var oRSDO = $('#tblRouteSheetDO').datagrid('getSelected');

            if (oRSDO == null) {
                return;
            }
            debugger;
            if (parseFloat(oRSDO.Qty_RSKG) != _nQty_RSKG )
            {
                oRSDO.Qty_RS = (oRSDO.Qty_RSKG / oRSDO.SMUnitValue).toFixed(8); //0.45359237001003542909395360718511
                //oRSDO.AdjValue = parseFloat(oRSDO.AdjQty) * parseFloat((parseFloat(oRSDO.UnitPrice)- parseFloat(oRSDO.AdjRate)))+ parseFloat((parseFloat(oRSDO.Qty)*parseFloat(oRSDO.AdjRate)));
                //oRSDO.MUNameTwo = 'KG'
            }
            else
            {

                oRSDO.Qty_RSKG = (oRSDO.Qty_RS * oRSDO.SMUnitValue).toFixed(8); //0.45359237001003542909395360718511
            }

            $('#tblRouteSheetDO').datagrid('updateRow', { index: editIndex, row: oRSDO });
            RefreshRSDO();
            _nQty_RS = 0;
            _nQty_RSKG = 0;
            editIndex = undefined;
            return true;
        }
        else {
            return false;
        }
    }

    _nQty_RS = 0;
    _nQty_RSKG = 0;

    function onClickRow(index) {
        if (editIndex != index) {
            if (sessionStorage.getItem("ExportPIHeader") != "View Export PI") {
                if (endEditing()) {
                    $('#tblRouteSheetDO').datagrid('selectRow', index).datagrid('beginEdit', index);
                    var oRSDO = $('#tblRouteSheetDO').datagrid('getSelected');
                    _nQty_RS = parseFloat(oRSDO.Qty_RS).toFixed(10);
                    _nQty_RSKG = parseFloat(oRSDO.Qty_RSKG).toFixed(8);
                    editIndex = index;
                }
                else {
                    $('#tblRouteSheetDO').datagrid('selectRow', editIndex);
                }
            }
            else {
                editIndex = index;
            }
        }
    }


    /*---------------- Product Pick --------------*/


    $("#btnResetProduct").click(function () {
        _nProductID=0;
        _nLotID=0;
        $("#txtProduct,#txtLot").val("");
    });

    $("#btnPickProduct").click(function () {

        var sProductName=$.trim($("#txtProduct").val());
        if(sProductName==""){ alert("Type product name to search."); return false; }
        GetProducts(sProductName);
    });

    $("#txtProduct").keydown(function (e) {
        var nkeyCode = e.keyCode || e.which;
        if(nkeyCode==13){
            var sProductName=$.trim($("#txtProduct").val());
            if(sProductName==""){ alert("Type product name to search."); return false; }
            GetProducts(sProductName);
        }
        else if(nkeyCode==8){
            _nProductID=0;
            _nLotID=0;
            $("#txtProduct,#txtLot").val("");
        }
    });

    function GetProducts(sProductName){

        var oProduct = {
            BUID:_nBUID,
            ProductName:sProductName,
        };
        var obj = {
            BaseAddress: _sBaseAddress,
            Object: oProduct,
            ControllerName: "Product",
            ActionName: "SearchByProductBUWise",
            IsWinClose: false
        };
        //$("#progressbar").progressbar({ value: 0 });
        //$("#progressbarParent").show();
        $.icsDataGets(obj, function (response) {
            //clearInterval(intervalID);
            //$("#progressbarParent").hide();
            if (response.status && response.objs.length > 0) {
                if (response.objs[0].ProductID > 0) {
                    debugger;
                    var tblColums = [];
                    var oColumn = { field: "ProductCode", title: "Code", width: 80, align: "left" };tblColums.push(oColumn);
                    oColumn = { field: "ProductName", title: "Name", width: 270, align: "left" };tblColums.push(oColumn);
                    oColumn = { field: "MUnit", title: "Unit", width: 70, align: "left" };tblColums.push(oColumn);

                    var oPickerParam = {
                        winid: 'winProductPicker',
                        winclass:'clsProductPicker',
                        winwidth: 520,
                        winheight: 460,
                        tableid: 'tblProductPicker',
                        tablecolumns: tblColums,
                        datalist: response.objs,
                        multiplereturn: false,
                        searchingbyfieldName:'ProductName',
                        windowTittle: 'Product List'
                    };
                    $.icsPicker(oPickerParam);
                    IntializeProductPickerbutton(oPickerParam);//multiplereturn, winclassName
                }
                else { alert(response.objs[0].ErrorMessage); }
            }
            else{
                alert("No product found.");
            }
        });


    }

    function IntializeProductPickerbutton(oPickerobj)
    {
        $("#" + oPickerobj.winid).find("#btnOk").click(function () {
            ProductSelect(oPickerobj);
        });
        $(document).find('.' +oPickerobj.winclass).keydown(function (e) {
            if (e.which == 13)//enter=13
            {
                ProductSelect(oPickerobj);
            }
        });
    }

    function ProductSelect(oPickerobj){
        var oProduct = $('#'+oPickerobj.tableid).datagrid('getSelected');
        if (oPickerobj.winid == 'winProductPicker')
        {
            if(oProduct !=null  && oProduct.ProductID>0){
                $("#"+oPickerobj.winid).icsWindow("close");
                $("#" + oPickerobj.winid).remove();
                $('#txtProduct').val(oProduct.ProductNameCode);
                _nProductID= oProduct.ProductID;
                _nLotID=0;
                $("#txtLot").val("");

            }
            else{
                alert("Please select product.");
            }
        }
    }


    /*---------------- Product Pick --------------*/

    function ValidationLot(){

        if($('#cboStore').val()<=0){
            $('#cboStore').focus();
            $('#cboStore').addClass("errorFieldBorder");
            alert('Select store.');
            return false;
        }
        else{
            $('#cboStore').removeClass("errorFieldBorder");
        }

        if($('#cboLocation').val()<=0){
            $('#cboLocation').focus();
            $('#cboLocation').addClass("errorFieldBorder");
            alert('Select store.');
            return false;
        }
        else{
            $('#cboLocation').removeClass("errorFieldBorder");
        }

        if($('#cboRSShift').val()<=0){
            $('#cboRSShift').focus();
            $('#cboRSShift').addClass("errorFieldBorder");
            alert('Select Shift.');
            return false;
        }
        else{
            $('#cboRSShift').removeClass("errorFieldBorder");
        }

        if(_nProductID<=0){
            $('#txtProduct').focus();
            $('#txtProduct').addClass("errorFieldBorder");
            alert('No raw product found.');
            return false;
        }
        else{
            $('#txtProduct').removeClass("errorFieldBorder");
        }
        return true;
    }

    $("#btnResetLot").click(function () {
        _nLotID=0;
        $("#txtLot").val("");
    });

    $("#btnPickLot").click(function () {
        if(!ValidationLot()) return false;
        var sLotNo=$.trim($("#txtLot").val());
        //  if(sLotNo==""){ alert("Type lot no to search."); return false; }
        GetLots(sLotNo);
    });

    $("#txtLot").keydown(function (e) {
        var nkeyCode = e.keyCode || e.which;
        if(nkeyCode==13){
            if(!ValidationLot()) return false;
            var sLotNo=$.trim($("#txtLot").val());
            //if(sLotNo==""){ alert("Type lot no to search."); return false; }
            GetLots(sLotNo);
        }
        else if(nkeyCode==8){
            _nLotID=0;
            $("#txtLot").val("");
        }
    });

    function GetLots(sLotNo){

        var oRSDOs = $('#tblRouteSheetDO').datagrid('getRows');
        var sParam="";
        if(oRSDOs.length>0)
        {
            sParam=oRSDOs[0].ContractorID+"~"+ oRSDOs[0].DyeingOrderDetailID+'~'+3;
        }

        var oRouteSheet = {
            RouteSheetID: (_oRouteSheet!=null && _oRouteSheet.RouteSheetID>0)? _oRouteSheet.RouteSheetID:0,
            ProductID_Raw:_nProductID,
            LotNo:sLotNo,
            Params:sParam,
            WorkingUnitID: $('#cboStore').val()
        };

        var obj = {
            BaseAddress: _sBaseAddress,
            Object: oRouteSheet,
            ControllerName: "RouteSheet",
            ActionName: "GetsLotForRS",
            IsWinClose: false
        };

        //var oLot = {
        //    ProductID:_nProductID,
        //    LotNo:sLotNo,
        //    WorkingUnitID: $('#cboStore').val()
        //};

        //var obj = {
        //    BaseAddress: _sBaseAddress,
        //    Object: oLot,
        //    ControllerName: "Lot",
        //    ActionName: "GetsLot",
        //    IsWinClose: false
        //};

        $.icsDataGets(obj, function (response) {

            if (response.status && response.objs.length > 0) {
                if (response.objs[0].ProductID > 0) {
                    debugger;
                    var tblColums = [];
                    var oColumn = { field: "LotNo", title: "Lot No", width: 80, align: "left" };tblColums.push(oColumn);
                    oColumn = { field: "Balance", title: "Qty", width: 80, align: "right", formatter:formatPrice };tblColums.push(oColumn);
                    oColumn = { field: "LotStatusSt", title: "Running", width:30, align: "left" };tblColums.push(oColumn);
                    oColumn = { field: "MUName", title: "Unit", width: 70, align: "left"};tblColums.push(oColumn);
                    oColumn = { field: "ProductNameCode", title: "Name", width: 180, align: "left" };tblColums.push(oColumn);
                    oColumn = { field: "WorkingUnitName", title: "Store", width: 180, align: "left" };tblColums.push(oColumn);


                    var oPickerParam = {
                        winid: 'winLotPicker',
                        winclass:'clsLotPicker',
                        winwidth: 680,
                        winheight: 460,
                        tableid: 'tblLotPicker',
                        tablecolumns: tblColums,
                        datalist: response.objs,
                        multiplereturn: false,
                        searchingbyfieldName:'LotNo',
                        windowTittle: 'Lot List'
                    };
                    $.icsPicker(oPickerParam);
                    IntializeLotPickerbutton(oPickerParam);//multiplereturn, winclassName
                }
                else { alert(response.objs[0].ErrorMessage); }
            }
            else{
                alert("No lot found.");
            }
        });


    }

    $("#btnResetLot_DC").click(function () {
        _nSuggestLotID=0;
        $("#txtLot_DC").val("");
    });

    $("#btnPickLot_DC").click(function () {
        //if(!ValidationLot()) return false;
        var sLotNo=$.trim($("#txtLot_DC").val());
        var nWUID=0;
        var nPCatID=$("#cboProductType").val();
        //if(nPCatID==25)
        //{
        //    nWUID=11;
        //}
        //if(nPCatID==26)
        //{
        //    nWUID=12;
        //}

        nWUID=parseInt($('#cboStoreDC').val());

        if(_nProcessID<=0){
            $('#txtProduct-DS').focus();
            $('#txtProduct-DS').addClass("errorFieldBorder");
            alert('Product required.');
            return false;
        }
        else{
            $('#txtProduct-DS').removeClass("errorFieldBorder");
        }
        if(nWUID<=0){
            $('#cboStoreDC').focus();
            $('#cboStoreDC').addClass("errorFieldBorder");
            alert('Product Type required.');
            return false;
        }
        else{
            $('#cboStoreDC').removeClass("errorFieldBorder");
        }

        //var oLot = {
        //    ProductID:_nProcessID,
        //    LotNo:sLotNo,
        //    WorkingUnitID:nWUID
        //};
        //GetLotsDyesChemical(oLot);

        var oRSDOs = $('#tblRouteSheetDO').datagrid('getRows');
        var sParam="";
        if(oRSDOs.length>0)
        {
            if(oRSDOs[0].OrderTypeInt==4)
            {
                sParam=oRSDOs[0].ContractorID+"~"+ oRSDOs[0].DyeingOrderDetailID+'~'+4;
            }
        }

        var oRouteSheet = {
            RouteSheetID: (_oRouteSheet!=null && _oRouteSheet.RouteSheetID>0)? _oRouteSheet.RouteSheetID:0,
            ProductID_Raw:_nProcessID,
            LotNo:sLotNo,
            Params:sParam,
            WorkingUnitID: nWUID
        };
        GetLotsDyesChemical(oRouteSheet);


    });

    $("#txtLot_DC").keydown(function (e) {
        var nkeyCode = e.keyCode || e.which;
        if(nkeyCode==13){
            //if(!ValidationLot()) return false;
            var sLotNo=$.trim($("#txtLot_DC").val());
            if(sLotNo==""){ alert("Type lot no to search."); return false; }
            var nWUID=0;
            var nPCatID=$("#cboProductType").val();

            nWUID=parseInt($('#cboStoreDC').val());
            if(_nProcessID<=0){
                $('#txtProduct-DS').focus();
                $('#txtProduct-DS').addClass("errorFieldBorder");
                alert('Product required.');
                return false;
            }
            else{
                $('#txtProduct-DS').removeClass("errorFieldBorder");
            }
            if(nWUID<=0){
                $('#cboStoreDC').focus();
                $('#cboStoreDC').addClass("errorFieldBorder");
                alert('Product Type required.');
                return false;
            }
            else{
                $('#cboStoreDC').removeClass("errorFieldBorder");
            }
            var oRSDOs = $('#tblRouteSheetDO').datagrid('getRows');
            var sParam="";
            if(oRSDOs.length>0)
            {
                if(oRSDOs[0].OrderTypeInt==4)
                {
                    sParam=oRSDOs[0].ContractorID+"~"+ oRSDOs[0].DyeingOrderDetailID+'~'+4;
                }
            }

            var oRouteSheet = {
                RouteSheetID: (_oRouteSheet!=null && _oRouteSheet.RouteSheetID>0)? _oRouteSheet.RouteSheetID:0,
                ProductID_Raw:_nProcessID,
                LotNo:sLotNo,
                Params:sParam,
                WorkingUnitID: nWUID
            };
            GetLotsDyesChemical(oRouteSheet);



            //var oLot = {
            //    ProductID:_nProcessID,
            //    LotNo:sLotNo,
            //    WorkingUnitID:nWUID
            //};
            //GetLotsDyesChemical(oLot);
        }
        else if(nkeyCode==8){
            _nSuggestLotID=0;
            //$("#txtLot_DC").val("");
        }
    });

    function GetLotsDyesChemical(oRouteSheet){

        var obj = {
            BaseAddress: _sBaseAddress,
            Object: oRouteSheet,
            ControllerName: "RouteSheet",
            ActionName: "GetsLotForRSDC",
            IsWinClose: false
        };
        //var obj = {
        //    BaseAddress: _sBaseAddress,
        //    Object: oLot,
        //    ControllerName: "Lot",
        //    ActionName: "GetsLot",
        //    IsWinClose: false
        //};

        $.icsDataGets(obj, function (response) {

            if (response.status && response.objs.length > 0) {
                if (response.objs[0].ProductID > 0) {
                    debugger;
                    var tblColums = [];
                    var oColumn = { field: "LotNo", title: "Lot No", width: 90, align: "left" };tblColums.push(oColumn);
                    oColumn = { field: "Balance", title: "Qty", width: 70, align: "right", formatter:formatPrice };tblColums.push(oColumn);
                    oColumn = { field: "LotStatusSt", title: "Running", width:100, align: "left" };tblColums.push(oColumn);
                    oColumn = { field: "Origin", title: "Origin", width:100, align: "left" };tblColums.push(oColumn);
                    oColumn = { field: "MUName", title: "Unit", width: 70, align: "left"};tblColums.push(oColumn);
                    oColumn = { field: "WorkingUnitName", title: "Store", width: 180, align: "left" };tblColums.push(oColumn);
                    oColumn = { field: "ProductNameCode", title: "Name", width: 180, align: "left" };tblColums.push(oColumn);


                    var oPickerParam = {
                        winid: 'winLotDyesChemicalPicker',
                        winclass:'clsLotDyesChemicalPicker',
                        winwidth: 560,
                        winheight: 460,
                        tableid: 'tblLotDyesChemicalPicker',
                        tablecolumns: tblColums,
                        datalist: response.objs,
                        multiplereturn: false,
                        searchingbyfieldName:'LotNo',
                        windowTittle: 'Lot List'
                    };
                    $.icsPicker(oPickerParam);
                    IntializeLotPickerbutton(oPickerParam);//multiplereturn, winclassName
                }
                else { alert(response.objs[0].ErrorMessage); }
            }
            else{
                alert("No lot found.");
            }
        });
    }

    function IntializeLotPickerbutton(oPickerobj)
    {
        $("#" + oPickerobj.winid).find("#btnOk").click(function () {
            LotSelect(oPickerobj);
        });
        $(document).find('.' +oPickerobj.winclass).keydown(function (e) {
            if (e.which == 13)//enter=13
            {
                LotSelect(oPickerobj);
            }
        });
    }

    function LotSelect(oPickerobj){
        if (oPickerobj.multiplereturn)
            oLot = $('#'+oPickerobj.tableid).datagrid('getChecked');
        else
            oLot = $('#'+oPickerobj.tableid).datagrid('getSelected');

        if (oPickerobj.winid == 'winLotPicker')
        {
            if(oLot !=null  && oLot.LotID>0){
                $("#"+oPickerobj.winid).icsWindow("close");
                $("#" + oPickerobj.winid).remove();
                $('#txtLot').val(oLot.LotNo);
                _nLotID= oLot.LotID;
            }
            else{
                alert("Please select lot.");
            }
        }
        if(oPickerobj.winid == 'winLotPickerForRS'){
            if(oLot.length > 0  && oLot[0].LotID>0){
                $("#"+oPickerobj.winid).icsWindow("close");
                $("#" + oPickerobj.winid).remove();
                var oList = [];
                for(var i=0; i<oLot.length;i++){
                    debugger;
                    var oObjLot=oLot[i];
                    var nRSQty = chkRSQty();
                    var nQty=( (_oRouteSheet.Qty-nRSQty) <= oObjLot.Balance?(_oRouteSheet.Qty-nRSQty):oObjLot.StockValue);

                    var oobj = {
                        RSRawLotID:0,
                        RouteSheetID : _oRouteSheet.RouteSheetID,
                        Qty:(nQty <= 0 ? 0 : nQty),
                        RSShiftID : $("#cboRSShift").val(),
                        DyeingOrderDetailID:$("#cboOrder").val(),
                        ProductID: oObjLot.ProductID,
                        ProductName: oObjLot.ProductName,
                        WorkingUnitID : oObjLot.WorkingUnitID,
                        OperationUnitName: oObjLot.OperationUnitName,
                        LotID:oObjLot.LotID,
                        LotNo:oObjLot.LotNo,
                        Balance: oObjLot.Balance,
                        NumOfCone: 0
                    }
                    if(NotExist(oobj))
                        oList.push(oobj);
                }
                for(var i=0; i<oList.length;i++)
                    $('#tblLots').treegrid('appendRow', oList[i]);

            }
            else{
                alert("Please select lot.");
            }
        }
        if (oPickerobj.winid == 'winLotDyesChemicalPicker')
        {
            if(oLot !=null  && oLot.LotID>0){
                $("#"+oPickerobj.winid).icsWindow("close");
                $("#" + oPickerobj.winid).remove();
                $('#txtLot_DC').val(oLot.LotNo);
                _nSuggestLotID= oLot.LotID;
            }
            else{
                alert("Please select lot.");
            }
        }
        if (oPickerobj.winid == 'winLotDyesChemicalPickerAddition')
        {
            if(oLot !=null  && oLot.LotID>0){
                $("#"+oPickerobj.winid).icsWindow("close");
                $("#" + oPickerobj.winid).remove();
                $('#txtLot_Addition').val(oLot.LotNo);
                _nSuggestLotID_Addition= oLot.LotID;
            }
            else{
                alert("Please select lot.");
            }
        }
    }


    /*---------------- Machine Pick --------------*/

    $("#btnResetMachine").click(function () {

        $("#txtMachine").val("");
        _nMachineID=0;
    });

    $("#btnPickMachine").click(function () {

        var sMachineName=$.trim($("#txtMachine").val());
        //if(sMachineName==""){ alert("Type machine name to search."); return false; }
        GetMachines(sMachineName);
    });

    $("#txtMachine").keydown(function (e) {
        var nkeyCode = e.keyCode || e.which;
        if(nkeyCode==13){
            var sMachineName=$.trim($("#txtMachine").val());
            //if(sMachineName==""){ alert("Type machine name to search."); return false; }
            GetMachines(sMachineName);
        }
        else if(nkeyCode==8){
            $("#txtMachine").val("");
            _nMachineID=0;
        }
    });

    function GetMachines(sMachineName){

        var oMachine = {
            BUID:_nBUID,
            //ResourcesTypeInInt:2,
            Name:sMachineName
        };
        var obj = {
            BaseAddress: _sBaseAddress,
            Object: oMachine,
            ControllerName: "DUPSchedule",
            ActionName: "GetsMachine",
            IsWinClose: false
        };

        $.icsDataGets(obj, function (response) {

            if (response.status && response.objs.length > 0) {
                if (response.objs[0].MachineID > 0) {
                    debugger;
                    var tblColums = [];
                    var oColumn = { field: "Code", title: "Code", width: 70, align: "left" };tblColums.push(oColumn);
                    oColumn = { field: "Name", title: "Machine Name", width: 150, align: "left" };tblColums.push(oColumn);
                    oColumn = { field: "MachineTypeName", title: "Type", width: 70, align: "left" };tblColums.push(oColumn);
                    oColumn = { field: "Capacity", title: "Capacity", width: 60, align: "left" };tblColums.push(oColumn);

                    var oPickerParam = {
                        winid: 'winMachinePicker',
                        winclass:'clsMachinePicker',
                        winwidth: 480,
                        winheight: 460,
                        tableid: 'tblMachinePicker',
                        tablecolumns: tblColums,
                        datalist: response.objs,
                        multiplereturn: false,
                        searchingbyfieldName:'Name',
                        windowTittle: 'Machine List'
                    };
                    $.icsPicker(oPickerParam);
                    IntializeMachinePickerbutton(oPickerParam);//multiplereturn, winclassName
                }
                else { alert(response.objs[0].ErrorMessage); }
            }
            else{
                alert("No machine found.");
            }
        });


    }
    $("#btnLabel").click(function () {

        if(parseInt(_nMachineID)<=0){ alert("Type machine name to search."); return false; }
        var oMachineLiquor = {
            MachineID : parseInt(_nMachineID)
        };
        GetMachineLabel(oMachineLiquor);
    });
    function GetMachineLabel(oMachineLiquor)
    {
        var obj = {
            BaseAddress: _sBaseAddress,
            Object: oMachineLiquor,
            ControllerName: "RouteSheet",
            ActionName: "GetMachineLabelByMachineID",
            IsWinClose: false
        };

        $.icsDataGets(obj, function (response) {

            if (response.status && response.objs.length > 0) {
                if (response.objs[0].MachineID > 0) {
                    debugger;
                    var tblColums = [];
                    var oColumn = { field: "Label", title: "Label", width: 70, align: "left" };tblColums.push(oColumn);
                    oColumn = { field: "Liquor", title: "Liquor", width: 150, align: "left" };tblColums.push(oColumn);

                    var oPickerParam = {
                        winid: 'winMachineLabelPicker',
                        winclass:'clsMachineLabelPicker',
                        winwidth: 480,
                        winheight: 460,
                        tableid: 'tblMachinePicker',
                        tablecolumns: tblColums,
                        datalist: response.objs,
                        multiplereturn: false,
                        searchingbyfieldName:'Label',
                        windowTittle: 'Liquor List'
                    };
                    $.icsPicker(oPickerParam);
                    IntializeMachinePickerbutton(oPickerParam);//multiplereturn, winclassName
                }
                else { alert(response.objs[0].ErrorMessage); }
            }
            else{
                alert("No machine Liquor found.");
            }
        });


    }
    function IntializeMachinePickerbutton(oPickerobj)
    {
        $("#" + oPickerobj.winid).find("#btnOk").click(function () {
            MachineSelect(oPickerobj);
        });
        $(document).find('.' +oPickerobj.winclass).keydown(function (e) {
            if (e.which == 13)//enter=13
            {
                MachineSelect(oPickerobj);
            }
        });
    }

    function MachineSelect(oPickerobj){
        var oMachine = $('#'+oPickerobj.tableid).datagrid('getSelected');
        if (oPickerobj.winid == 'winMachinePicker')
        {
            if(oMachine !=null  && oMachine.MachineID>0){
                $("#"+oPickerobj.winid).icsWindow("close");
                $("#" + oPickerobj.winid).remove();
                $('#txtMachine').val(oMachine.Name);
                _nMachineID= oMachine.MachineID;
                _nLocationID=oMachine.LocationID;
            }
            else{
                alert("Please select machine.");
            }
        }
        else if (oPickerobj.winid == 'winMachineLabelPicker')
        {
            if(oMachine !=null  && oMachine.MachineID>0){
                $("#"+oPickerobj.winid).icsWindow("close");
                $("#" + oPickerobj.winid).remove();
                $('#txtTtlLiquire').val(oMachine.Liquor);
                $('#btnLabel').val(oMachine.Label);

            }
            else{
                alert("Please select machine.");
            }

        }
    }

    /*---------------- Dyeing Soution --------------*/

    $("#btnResetDyeingSolution").click(function () {

        if(_oRouteSheet==null || _oRouteSheet.RouteSheetID<=0){
            alert("Save route sheet first."); return false;
        }
        $("#txtDyeingSolution").val("");
    });

    $("#btnPickDyeingSolution").click(function () {

        if(_oRouteSheet==null || _oRouteSheet.RouteSheetID<=0){
            alert("Save route sheet first."); return false;
        }
        var sName=$.trim($("#txtDyeingSolution").val());
        GetDyeingSolutions(sName);
    });

    $("#txtDyeingSolution").keydown(function (e) {
        var nkeyCode = e.keyCode || e.which;
        if(nkeyCode==13){
            if(_oRouteSheet==null || _oRouteSheet.RouteSheetID<=0){
                alert("Save route sheet first."); return false;
            }
            var sName=$.trim($("#txtDyeingSolution").val());
            if(sName==""){ alert("Type solution name to search."); return false; }
            GetDyeingSolutions(sName);
        }
        else if(nkeyCode==8){
            $("#txtDyeingSolution").val("");
        }
    });

    function GetDyeingSolutions(sName){

        var oDyeingSolution = {
            Name:sName
        };
        var obj = {
            BaseAddress: _sBaseAddress,
            Object: oDyeingSolution,
            ControllerName: "DyeingSolutiontemplate",
            ActionName: "GetsDyeingSolution",
            IsWinClose: false
        };

        $.icsDataGets(obj, function (response) {

            if (response.status && response.objs.length > 0) {
                if (response.objs[0].DyeingSolutionID > 0) {
                    debugger;
                    var tblColums = [];
                    var oColumn = { field: "Name", title: "Solution Name", width: 330, align: "left" };tblColums.push(oColumn);
                    var oPickerParam = {
                        winid: 'winDyeingSolutionPicker',
                        winclass:'clsDyeingSolutionPicker',
                        winwidth: 400,
                        winheight: 460,
                        tableid: 'tblDyeingSolutionPicker',
                        tablecolumns: tblColums,
                        datalist: response.objs,
                        multiplereturn: false,
                        searchingbyfieldName:'Name',
                        windowTittle: 'Solution List'
                    };
                    $.icsPicker(oPickerParam);
                    IntializeDyeingSolutionPickerbutton(oPickerParam);//multiplereturn, winclassName
                }
                else { alert(response.objs[0].ErrorMessage); }
            }
            else{
                alert("No solution found.");
            }
        });


    }
    ///
    $("#txtRSNoFrom").keydown(function (e) {
        var nkeyCode = e.keyCode || e.which;
        if(nkeyCode==13){
            if(_oRouteSheet==null || _oRouteSheet.RouteSheetID<=0){
                alert("Save route sheet first."); return false;
            }
            var sName=$.trim($("#txtRSNoFrom").val());
            if(sName==""){ alert("Type Batch No."); return false; }
            GetsRSNoFromCopy(sName);
        }
        else if(nkeyCode==8){
            $("#txtRSNoFrom").val("");
        }
    });

    function GetsRSNoFromCopy(sRSNo){
        var oRouteSheet={
            Params:  sRSNo+'~'+ 0+ '~'+  icsdateformat(new Date())+'~'+ icsdateformat(new Date())+'~'+ "" +'~'+ "" + '~'+"" +'~'+ ""+'~'+''+'~'+""+'~'+0+'~'+ 0+ '~'+ ""+'~'+ ""+''
        };

        var obj = {
            BaseAddress: _sBaseAddress,
            Object: oRouteSheet,
            ControllerName: "RouteSheet",
            ActionName: "Gets",
            IsWinClose: false
        };

        $.icsDataGets(obj, function (response) {

            if (response.status && response.objs.length > 0) {
                if (response.objs[0].RouteSheetID > 0) {
                    debugger;
                    var tblColums = [];
                    var oColumn = { field: "RouteSheetNo", title: "Batch No", width: 120, align: "left" };tblColums.push(oColumn);
                    oColumn = { field: "OrderNo", title: "Order No", width: 130, align: "left" };tblColums.push(oColumn);
                    oColumn = { field: "ColorName", title: "Color Name", width: 200, align: "left" };tblColums.push(oColumn);

                    var oPickerParam = {
                        winid: 'winRouteSheetFromPicker',
                        winclass:'clsRouteSheetFromPicker',
                        winwidth: 400,
                        winheight: 460,
                        tableid: 'tblRouteSheetFromPicker',
                        tablecolumns: tblColums,
                        datalist: response.objs,
                        multiplereturn: false,
                        searchingbyfieldName:'RouteSheetNo',
                        windowTittle: 'Batch List'
                    };
                    $.icsPicker(oPickerParam);
                    IntializeDyeingSolutionPickerbutton(oPickerParam);//multiplereturn, winclassName
                }
                else { alert(response.objs[0].ErrorMessage); }
            }
            else{
                alert("No solution found.");
            }
        });


    }

    function IntializeDyeingSolutionPickerbutton(oPickerobj)
    {
        $("#" + oPickerobj.winid).find("#btnOk").click(function () {
            DyeingSolutionSelect(oPickerobj);
        });
        $(document).find('.' +oPickerobj.winclass).keydown(function (e) {
            if (e.which == 13)//enter=13
            {
                DyeingSolutionSelect(oPickerobj);
            }
        });
    }

    function DyeingSolutionSelect(oPickerobj){
        if(!confirm('Are you sure to add this soution.'));

        var oDyeingSolution = $('#'+oPickerobj.tableid).datagrid('getSelected');
        if (oPickerobj.winid == 'winDyeingSolutionPicker')
        {
            if(oDyeingSolution !=null  && oDyeingSolution.DyeingSolutionID>0){
                $("#"+oPickerobj.winid).icsWindow("close");
                $("#" + oPickerobj.winid).remove();

                var oRouteSheet={
                    RouteSheetID:_oRouteSheet.RouteSheetID,
                    Params:oDyeingSolution.DyeingSolutionID
                };

                var obj = {
                    BaseAddress: _sBaseAddress,
                    Object: oRouteSheet,
                    ObjectId: 0,
                    ControllerName: "RouteSheet",
                    ActionName: "IUDTemplate",
                    TableId: "",
                    IsWinClose: false,
                    Message: "Save Successfully."// (oRouteSheetDetail.RouteSheetDetailID>0)?"Update Successfully." : "Save Successfully."
                };
                $.icsSave(obj, function (response) {
                    if (response.status && response.obj != null) {
                        debugger
                        if (response.obj.RouteSheetDetailID > 0) {
                            _oRouteSheet.RouteSheetDetail=response.obj;
                            LoadTreeGrid([response.obj])
                        }
                    }
                });
            }
            else{
                alert("Please select solution.");
            }
        }
        else if (oPickerobj.winid == 'winRouteSheetFromPicker')
        {
            if(oDyeingSolution !=null  && oDyeingSolution.RouteSheetID>0){
                $("#"+oPickerobj.winid).icsWindow("close");
                $("#" + oPickerobj.winid).remove();

                var oRouteSheet={
                    RouteSheetID:_oRouteSheet.RouteSheetID,
                    CopiedFrom:oDyeingSolution.RouteSheetID
                };

                var obj = {
                    BaseAddress: _sBaseAddress,
                    Object: oRouteSheet,
                    ObjectId: 0,
                    ControllerName: "RouteSheet",
                    ActionName: "CopyTemplateFromRS",
                    TableId: "",
                    IsWinClose: false,
                    Message: "Save Successfully."// (oRouteSheetDetail.RouteSheetDetailID>0)?"Update Successfully." : "Save Successfully."
                };
                $.icsSave(obj, function (response) {
                    if (response.status && response.obj != null) {
                        debugger
                        if (response.obj.RouteSheetDetailID > 0) {
                            _oRouteSheet.RouteSheetDetail=response.obj;
                            LoadTreeGrid([response.obj])
                        }
                    }
                });
            }
            else{
                alert("Please select solution.");
            }
        }
    }


    /*---------------- Templete  As Route Sheet Detail--------------*/

    function GetDyeingProcess(nIndex){
        var oDyeingSolution = {
            Name:""
        };
        var obj = {
            BaseAddress: _sBaseAddress,
            Object: oDyeingSolution,
            ControllerName: "DyeingSolutiontemplate",
            ActionName: "GetsDyeingProcess",
            IsWinClose: false
        };

        $.icsDataGets(obj, function (response) {

            if (response.status && response.objs.length > 0) {
                debugger;
                if (response.objs[0].DyeingSolutionID > 0) {
                    $("#cboProcess").icsLoadCombo({
                        List: response.objs,
                        OptionValue: "DyeingSolutionID",
                        DisplayText: "Name",
                        InitialValue:""
                    });
                    if(nIndex>0)
                        $("#cboProcess").val(nIndex);
                }
                else { alert(response.objs[0].ErrorMessage); }
            }
            else{
                alert("No solution found.");
            }
        });
    }

    function ResetTemplet(bIsSearch){

        _oRSDRoot=null;
        _oRSD=null;
        _nProcessID = 0;
        if($('#chkDyeChemical').is(':checked')){
            $('.templet-dc').show();
            $('.templet').hide();
        }
        else{

            $('.templet').show();
            $('.templet-dc').hide();
            if(bIsSearch)
                GetDyeingProcess(0);
        }
        $('#txtTotalQty_KG').val(0);
        $('#txtTotalQty_Gm').val(0);
        $("#cboProcess").val(0);
        $('#chkForCotton').prop('checked',false);
        $('winTemplet .reset-text').val("");
    }

    function ValidationRouteSheetDetail()
    {

        if($('#chkDyeChemical').is(':checked')){

            if(_nProcessID<=0){
                $('#txtProduct-DS').focus();
                $('#txtProduct-DS').addClass("errorFieldBorder");
                alert('Product required.');
                return false;
            }
            else{
                $('#txtProduct-DS').removeClass("errorFieldBorder");
            }

            if(parseFloat($('#cboDyeingRecipeType').val())<=0 && parseFloat($('#txtGL').val())<=0 && parseFloat($('#txtPercentage').val())<=0){
                $('#txtGL').focus();
                $('#txtGL').addClass("errorFieldBorder");
                alert('GL/ Percentage required.');
                return false;
            }
            else{
                $('#txtGL').removeClass("errorFieldBorder");
            }

            if(parseFloat($('#cboProductType').val())<=0 ){
                $('#cboProductType').focus();
                $('#cboProductType').addClass("errorFieldBorder");
                alert('Product Type required.');
                return false;
            }
            else{
                $('#cboProductType').removeClass("errorFieldBorder");
            }

            //if(parseFloat(icsRemoveComma($('#txtPercentage').val()))<=0){
            //    $('#txtPercentage').focus();
            //    $('#txtPercentage').addClass("errorFieldBorder");
            //    alert('Percentage required.');
            //    return false;
            //}
            //else{
            //    $('#txtPercentage').removeClass("errorFieldBorder");
            //}
        }
        else{
            if($('#cboProcess').val()<=0){
                $('#cboProcess').focus();
                $('#cboProcess').addClass("errorFieldBorder");
                alert('Please select process.');
                return false;
            }
            else{
                $('#cboProcess').removeClass("errorFieldBorder");
            }
            if($.trim($('#txtTempTime').val())==""){
                $('#txtTempTime').focus();
                $('#txtTempTime').addClass("errorFieldBorder");
                alert('Temp & time required.');
                return false;
            }
            else{
                $('#txtTempTime').removeClass("errorFieldBorder");
            }
        }


        return true;
    }

    function RefreshObjectRouteSheetDetail(){

        var nQty= parseFloat(($('#txtTotalQty_KG').val()=='') ? 0 : $('#txtTotalQty_KG').val()) + parseFloat(parseFloat(($('#txtTotalQty_Gm').val()=='')? 0 : $('#txtTotalQty_Gm').val())/1000);



        var ncboDyeingRecipeType= parseInt($('#cboDyeingRecipeType').val());
        if(ncboDyeingRecipeType>0)
        {
            if(nQty<=0 || isNaN(nQty))
            {
                alert("Invalid Quantity."); return;
            }
            $('#txtGL').val(0);
            $('#txtPercentage').val(0);
        }
        debugger;
        var bIsDC=$('#chkDyeChemical').is(':checked');

        var oRSD={
            RouteSheetDetailID : (_oRSD==null || _oRSD.RouteSheetDetailID<=0)? 0 : _oRSD.RouteSheetDetailID,
            RouteSheetID : _oRouteSheet.RouteSheetID,
            ProcessID : (bIsDC)? _nProcessID : $('#cboProcess').val(),
            ParentID : (_oRSD==null || _oRSD.RouteSheetDetailID<=0)? _oRSDRoot.RouteSheetDetailID : _oRSD.ParentID,
            IsDyesChemical : (_oRSD==null || _oRSD.RouteSheetDetailID<=0)?  bIsDC  : _oRSD.IsDyesChemical,
            TempTime : $.trim($('#txtTempTime').val()),
            GL : (bIsDC)?parseFloat($('#txtGL').val()):0,
            Percentage : (bIsDC)?parseFloat($('#txtPercentage').val()):0,
            DAdjustment : (bIsDC)?parseFloat($('#txtAdjustment').val()):0,
            TotalQty : (bIsDC)?parseFloat(nQty):0,
            Note : $.trim($('#txtNoteTemplet').val()),
            ForCotton : $('#chkForCotton').is(':checked'),
            SuggestLotID:_nSuggestLotID,
            SuggestLotNo: $.trim($('#txtLot_DC').val()),
            RecipeCalType: parseInt($('#cboDyeingRecipeType').val()),
            ProductType:parseInt($('#cboProductType').val())
        };
        return oRSD;

    }

    function SaveRouteSheetDetail(oRSD){
        var obj = {
            BaseAddress: _sBaseAddress,
            Object: oRSD,
            ObjectId: oRSD.RouteSheetDetailID,
            ControllerName: "RouteSheet",
            ActionName: "SaveDetail",
            TableId: "",
            IsWinClose: true,
            Message: "Save sucessfully."
        };
        $.icsSave(obj, function (response) {
            if (response.status && response.obj != null) {
                if (response.obj.RouteSheetDetailID > 0) {
                    if(oRSD.RouteSheetDetailID>0){
                        response.obj.children=oRSD.children;
                        $('#tblTreeGridProcess').treegrid('update',{ id: oRSD.RouteSheetDetailID, row: response.obj });
                    }
                    else{
                        $('#tblTreeGridProcess').treegrid('append',{ parent: response.obj.ParentID, data: [response.obj] });
                    }
                }
            }
        });
    }

    $("#btnAddTemplet").click(function (e) {
        if(_oRouteSheet==null || _oRouteSheet.RouteSheetID<=0){
            alert("Save route sheet first."); return false;
        }
        var oRouteSheetDetail= $('#tblTreeGridProcess').datagrid('getSelected');
        if (oRouteSheetDetail == null || oRouteSheetDetail.RouteSheetDetailID <= 0) { alert("Please select an item from list."); return; }
        if (oRouteSheetDetail.IsDyesChemical) { alert("Your Selected item is Dyes or chemical. Please select process to add."); return; }
        ResetTemplet(($('#chkDyeChemical').is(':checked'))?false:true);
        _oRSDRoot= $('#tblTreeGridProcess').datagrid('getSelected');
        if(_oRSDRoot==null || _oRSDRoot.RouteSheetDetailID<=0){ alert("Please select an item from list."); return false; }
        $("#winTemplet").icsWindow("open", (($('#chkDyeChemical').is(':checked'))? "Add Dyes/ Chemical" : "Add Process"));
    });

    $('#btnEditTemplet').click(function (e)
    {
        debugger;
        var oRSD= $('#tblTreeGridProcess').datagrid('getSelected');
        if(oRSD==null || oRSD.RouteSheetDetailID<=0){ alert("Please select an item from list."); return false; }
        $('#chkDyeChemical').prop('checked',oRSD.IsDyesChemical);
        ResetTemplet(false);

        var obj =
        {
            BaseAddress: _sBaseAddress,
            Object: oRSD,
            ControllerName: "RouteSheet",
            ActionName: "GetRouteSheetDetail",
            IsWinClose: false
        };

        $.icsDataGet(obj, function (response) {

            if (response.status && response.obj != null) {
                if (response.obj.RouteSheetDetailID > 0) {
                    _oRSD=response.obj;
                    debugger;
                    if(response.obj.IsDyesChemical){
                        $('#chkDyeChemical').prop('checked',true);
                        _nProcessID=response.obj.ProcessID;
                        _nSuggestLotID=response.obj.SuggestLotID;
                        $("#txtProduct-DS").val(response.obj.ProcessName);
                        $("#txtGL").val(response.obj.GL);
                        $("#txtPercentage").val(response.obj.Percentage);
                        $("#txtAdjustment").val(response.obj.DAdjustment);
                        $('#chkForCotton').prop('checked',response.obj.ForCotton);
                        $("#txtLot_DC").val(response.obj.SuggestLotNo);
                        //$("#cboProductCategory").val(response.obj.PCategoryID);
                        $("#cboProductType").val(response.obj.ProductType);
                        $('#cboStoreDC').val(response.obj.WUID);
                        SetAdditionalQty(response.obj.TotalQty);
                    }
                    else{
                        debugger;
                        $('#chkDyeChemical').prop('checked',false);
                        GetDyeingProcess(response.obj.ProcessID)
                        $("#txtTempTime").val(response.obj.TempTime);
                    }

                    $("#cboDyeingRecipeType").val(response.obj.RecipeCalType);
                    changeDyeingRecipeType();
                    $('#txtNoteTemplet').val(response.obj.Note)
                    $("#winTemplet").icsWindow("open", "Edit Dyeing Solution Detail");
                }
                else { alert(response.obj.ErrorMessage); }
            }
        });


    });
    function SetAdditionalQty(nQty)
    {
        var nKg= 0, mGm =0;
        var nTotalQty = parseFloat(nQty)*1000;
        if(nTotalQty>0)
            nKg= parseInt(nQty);

        mGm = parseFloat(nTotalQty)-parseInt(nKg*1000);

        $('#txtTotalQty_KG').val(nKg);
        $('#txtTotalQty_Gm').val(mGm.toFixed(4));
    }
    $('#btnDeleteTemplet').click(function (e)
    {
        var oRSD=$('#tblTreeGridProcess').datagrid('getSelected');
        if (oRSD==null || oRSD.RouteSheetDetailID<=0) { alert('Please select an item from list.'); return false;}
        if(oRSD.children!=null && oRSD.children.length>0){
            alert("Please delete child element first."); return false;
        }
        if (!confirm("Confirm to Delete?")) return ;
        var obj =
        {
            BaseAddress: _sBaseAddress,
            Object: oRSD,
            ControllerName: "RouteSheet",
            ActionName: "DeleteDetail",
            TableId: "",
            IsWinClose: false
        };
        $.icsDelete(obj, function (response) {
            if (response.status && response.Message =='deleted') {
                $('#tblTreeGridProcess').treegrid('remove',oRSD.RouteSheetDetailID);

                $('#tblTreeGridProcess').treegrid('select',oRSD.ParentID);
                var oParent=  $('#tblTreeGridProcess').datagrid('getSelected');
                if(oParent!=null){
                    var oChildrens=[];
                    for(var i=0;i<oParent.children.length;i++){

                        if(oParent.children[i].RouteSheetDetailID!=oRSD.RouteSheetDetailID){
                            oChildrens.push(oParent.children[i]);
                        }
                    }
                    oParent.children=oChildrens;
                    $('#tblTreeGridProcess').treegrid('update',{	id: oParent.RouteSheetDetailID, row: oParent });
                }
            }
        });
    });

    $("#btnSaveTemplet").click(function (e) {

        if (!ValidationRouteSheetDetail()) return false;
        var oRSD=RefreshObjectRouteSheetDetail();
        SaveRouteSheetDetail(oRSD);
    });

    $("#btnCloseTemplet").click(function (e) {
        $("#winTemplet").icsWindow("close");
    });


    $("#btnResetProduct-DS").click(function () {

        $("#txtProduct-DS").val("");
        _nProcessID=0;
    });

    $("#btnPickProduct-DS").click(function () {

        var sProductName=$.trim($("#txtProduct-DS").val());
        if(sProductName==""){ alert("Type product name to search."); return false; }
        var oProduct = {
            BUID:_nBUID,
            ProductName:sProductName,
            ProductCategoryID:$("#cboProductType").val()
        };
        GetDyesChemical(oProduct);
    });

    $("#txtProduct-DS").keydown(function (e) {
        var nkeyCode = e.keyCode || e.which;
        if(nkeyCode==13){
            var sProductName=$.trim($("#txtProduct-DS").val());
            if(sProductName==""){ alert("Type product name to search."); return false; }

            var oProduct = {
                BUID:_nBUID,
                ProductName:sProductName,
                ProductCategoryID:$("#cboProductType").val()
            };
            GetDyesChemical(oProduct);
        }
        else if(nkeyCode==8){
            _nProcessID=0;
        }
    });

    function GetDyesChemical(oProduct){


        var obj = {
            BaseAddress: _sBaseAddress,
            Object: oProduct,
            ControllerName: "RouteSheet",
            ActionName: "GetProducts",
            IsWinClose: false
        };

        $.icsDataGets(obj, function (response) {

            if (response.status && response.objs.length > 0) {
                if (response.objs[0].ProductID > 0) {
                    debugger;
                    var tblColums = [];
                    var oColumn = { field: "ProductCode", title: "Code", width: 80, align: "left" };tblColums.push(oColumn);
                    oColumn = { field: "ProductName", title: "Name", width: 270, align: "left" };tblColums.push(oColumn);
                    oColumn = { field: "ProductCategoryName", title: "Category Name", width: 270, align: "left" };tblColums.push(oColumn);
                    oColumn = { field: "MUnit", title: "Unit", width: 70, align: "left" };tblColums.push(oColumn);

                    var oPickerParam = {
                        winid: 'winDyesChemicalPicker',
                        winclass:'clsDyesChemicalPicker',
                        winwidth: 520,
                        winheight: 460,
                        tableid: 'tblDyesChemicalPicker',
                        tablecolumns: tblColums,
                        datalist: response.objs,
                        multiplereturn: false,
                        searchingbyfieldName:'ProductName',
                        windowTittle: 'DyesChemical List'
                    };
                    $.icsPicker(oPickerParam);
                    IntializeDyesChemicalPickerbutton(oPickerParam);//multiplereturn, winclassName
                }
                else { alert(response.objs[0].ErrorMessage); }
            }
            else{
                alert("No dyes chemical found.");
            }
        });


    }

    function IntializeDyesChemicalPickerbutton(oPickerobj)
    {
        $("#" + oPickerobj.winid).find("#btnOk").click(function () {
            DyesChemicalSelect(oPickerobj);
        });
        $(document).find('.' +oPickerobj.winclass).keydown(function (e) {
            if (e.which == 13)//enter=13
            {
                DyesChemicalSelect(oPickerobj);
            }
        });
    }

    function DyesChemicalSelect(oPickerobj){
        var oProduct = $('#'+oPickerobj.tableid).datagrid('getSelected');
        if (oPickerobj.winid == 'winDyesChemicalPicker')
        {
            if(oProduct !=null  && oProduct.ProductID>0){
                $("#"+oPickerobj.winid).icsWindow("close");
                $("#" + oPickerobj.winid).remove();
                $('#txtProduct-DS').val(oProduct.ProductNameCode);
                _nProcessID= oProduct.ProductID;
                $('#txtLot_Addition').val("");
                _nSuggestLotID=0;
                $("#txtLot_DC").val("");
            }
            else{
                alert("Please select dyes chemical.");
            }
        }
    }


    $("#txtGL").keyup(function(e){

        if(icsRemoveComma($('#txtGL').val())>0){
            $("#txtPercentage").val(formatPrice(0));
        }
    });

    $("#txtPercentage").keyup(function(e){

        if(icsRemoveComma($('#txtPercentage').val())>0){
            $("#txtGL").val(formatPrice(0));
        }
    });

    // ==================== RS DETAIL ADDITION ==================
    $("#txtLot_Addition_Qty_KG,txtLot_Addition_Qty_GM").keyup(function(e)
    {
        var nkeyCode = e.keyCode || e.which;
        if(nkeyCode==13)
        {
            $("#txtLot_Addition_Remarks").focus();
        }
    });
    $("#txtLot_Addition_Remarks").keyup(function(e)
    {
        var nkeyCode = e.keyCode || e.which;
        if(nkeyCode==13)
        {
            if (!ValidationRouteSheetDetailAddition()) return false;
            var oRSD=RefreshObjectRouteSheetDetailAddition();
            SaveRouteSheetDetailAddition(oRSD);
        }
    });

    $('#btnEditTempletAddition').click(function (e)
    {
        var oRSD= $('#tblTreeGridProcess').datagrid('getSelected');
        if(oRSD==null || oRSD.RouteSheetDetailID<=0){ alert("Please select an item from list."); return false; }
        $('#chkDyeChemical').prop('checked',oRSD.IsDyesChemical);
        $("#cboProductTypeAdd").val(oRSD.ProductType);
        ResetTemplet(false);

        $("#cboAdditionType").icsLoadCombo({
            List: [{id:102,Value:'Addition'},{id:101,Value:'Return'}],
            OptionValue: "id",
            DisplayText: "Value"
        });
        $("#cboAdditionType").val(0);

        $("#txtLot_Addition_Qty_KG").val("");
        $("#txtLot_Addition_Qty_GM").val("");
        $("#txtLot_Addition_Remarks").val("");

        var obj =
        {
            BaseAddress: _sBaseAddress,
            Object: oRSD,
            ControllerName: "RouteSheet",
            ActionName: "GetRSDetailWithAddition",
            IsWinClose: false
        };

        $.icsDataGet(obj, function (response) {

            if (response.status && response.obj != null) {
                if (response.obj.RouteSheetDetailID > 0) {
                    _oRSD=response.obj;
                    if(response.obj.IsDyesChemical){
                        $('#chkDyeChemical').prop('checked',true);
                        _nProcessID=response.obj.ProcessID;
                        _nSuggestLotID_Addition=response.obj.SuggestLotID;
                        $("#txtProduct-DSAddition").val(response.obj.ProcessName);
                        $("#txtGLAddition").val(response.obj.GL);
                        $("#txtPercentageAddition").val(response.obj.Percentage);
                        $("#txtAdjustmentAddition").val(response.obj.DAdjustment);
                        $('#chkForCottonAddition').prop('checked',response.obj.ForCotton);
                        $("#txtLot_DCAddition").val(response.obj.SuggestLotNo);
                        $("#txtLot_Addition").val(response.obj.SuggestLotNo);
                        //$("#cboProductCategoryAddition").val(response.obj.PCategoryID);
                        $("#cboProductType").val(response.obj.ProductType);
                        $("#cboProductTypeAdd").val(response.obj.ProductType);
                        $("#cboDyeingRecipeType").val(response.obj.RecipeCalType);
                        $('#cboStoreDCAdon').val(response.obj.WUID);
                        DynamicRefreshList(response.obj.RSDetailAdditonals, 'tblRSAdditional');
                        //$('#tblRSAdditional').treegrid('appendRow', response.obj);
                    }
                    else{
                        debugger;
                        $('#chkDyeChemical').prop('checked',false);
                        GetDyeingProcess(response.obj.ProcessID)
                        $("#txtTempTimeAddition").val(response.obj.TempTime);
                    }

                    $('#txtNoteTempletAddition').val(response.obj.Note)
                    $('.type-addition').prop('disabled',true);

                    $("#winTempletAddition").icsWindow("open", "Edit Dyeing Solution Detail");
                }
                else { alert(response.obj.ErrorMessage); }
            }
        });
    });

    $("#btnCloseTempletAddition").click(function (e) {
        $("#winTempletAddition").icsWindow("close");
    });

    $("#btnPickLot_Addition").click(function () {
        //if(!ValidationLot()) return false;
        debugger;

        var sLotNo=$.trim($("#txtLot_Addition").val());
        var nWUID=0;

        nWUID=parseInt($('#cboStoreDCAdon').val());
        if(_nProcessID<=0){
            $('#txtProduct-DSAddition').focus();
            $('#txtProduct-DSAddition').addClass("errorFieldBorder");
            alert('Product required.');
            return false;
        }
        else{
            $('#txtProduct-DSAddition').removeClass("errorFieldBorder");
        }
        if(nWUID<=0){
            $('#cboStoreDCAdon').focus();
            $('#cboStoreDCAdon').addClass("errorFieldBorder");
            alert('Store Type required.');
            return false;
        }
        else{
            $('#cboStoreDCAdon').removeClass("errorFieldBorder");
        }

        //var oLot = {
        //    ProductID:_nProcessID,
        //    LotNo:sLotNo,
        //    WorkingUnitID:nWUID
        //};
        //GetLotsDyesChemical(oLot);

        var oRSDOs = $('#tblRouteSheetDO').datagrid('getRows');
        var sParam="";
        if(oRSDOs.length>0)
        {
            if(oRSDOs[0].OrderTypeInt==4)
            {
                sParam=oRSDOs[0].ContractorID+"~"+ oRSDOs[0].DyeingOrderDetailID+'~'+4;
            }
        }

        var oRouteSheet = {
            RouteSheetID: (_oRouteSheet!=null && _oRouteSheet.RouteSheetID>0)? _oRouteSheet.RouteSheetID:0,
            ProductID_Raw:_nProcessID,
            LotNo:sLotNo,
            Params:sParam,
            WorkingUnitID: nWUID
        };
        GetLotsDyesChemicalAddition(oRouteSheet);
    });

    $("#txtLot_Addition").keydown(function (e) {
        var nkeyCode = e.keyCode || e.which;
        if(nkeyCode==13){
            //if(!ValidationLot()) return false;
            debugger;
            var sLotNo=$.trim($("#txtLot_Addition").val());
            if(sLotNo==""){ alert("Type lot no to search."); return false; }
            var nWUID=0;


            nWUID=parseInt($('#cboStoreDCAdon').val());

            if(_nProcessID<=0){
                $('#txtProduct-DSAddition').focus();
                $('#txtProduct-DSAddition').addClass("errorFieldBorder");
                alert('Product required.');
                return false;
            }
            else{
                $('#txtProduct-DSAddition').removeClass("errorFieldBorder");
            }
            if(nWUID<=0){
                $('#cboStoreDCAdon').focus();
                $('#cboStoreDCAdon').addClass("errorFieldBorder");
                alert('Store Type required.');
                return false;
            }
            else{
                $('#cboStoreDCAdon').removeClass("errorFieldBorder");
            }
            var oRSDOs = $('#tblRouteSheetDO').datagrid('getRows');
            var sParam="";
            if(oRSDOs.length>0)
            {
                if(oRSDOs[0].OrderTypeInt==4)
                {
                    sParam=oRSDOs[0].ContractorID+"~"+ oRSDOs[0].DyeingOrderDetailID+'~'+4;
                }
            }

            var oRouteSheet = {
                RouteSheetID: (_oRouteSheet!=null && _oRouteSheet.RouteSheetID>0)? _oRouteSheet.RouteSheetID:0,
                ProductID_Raw:_nProcessID,
                LotNo:sLotNo,
                Params:sParam,
                WorkingUnitID: nWUID
            };
            GetLotsDyesChemicalAddition(oRouteSheet);

            //var oLot = {
            //    ProductID:_nProcessID,
            //    LotNo:sLotNo,
            //    WorkingUnitID:nWUID
            //};
            //GetLotsDyesChemical(oLot);
        }
        else if(nkeyCode==8){
            _nSuggestLotID_Addition=0;
            //$("#txtLot_DC").val("");
        }
    });

    $("#btnResetLot_Addition").click(function () {
        _nSuggestLotID_Addition=0;
        $("#txtLot_Addition").val("");
    });

    function GetLotsDyesChemicalAddition(oRouteSheet){

        var obj = {
            BaseAddress: _sBaseAddress,
            Object: oRouteSheet,
            ControllerName: "RouteSheet",
            ActionName: "GetsLotForRSDC_Addition",
            IsWinClose: false
        };
        //var obj = {
        //    BaseAddress: _sBaseAddress,
        //    Object: oLot,
        //    ControllerName: "Lot",
        //    ActionName: "GetsLot",
        //    IsWinClose: false
        //};

        $.icsDataGets(obj, function (response) {

            if (response.status && response.objs.length > 0) {
                if (response.objs[0].ProductID > 0) {
                    debugger;
                    var tblColums = [];
                    var oColumn = { field: "LotNo", title: "Lot No", width: 90, align: "left" };tblColums.push(oColumn);
                    oColumn = { field: "Balance", title: "Qty", width: 70, align: "right", formatter:formatPrice };tblColums.push(oColumn);
                    oColumn = { field: "LotStatusSt", title: "Running", width:100, align: "left" };tblColums.push(oColumn);
                    oColumn = { field: "Origin", title: "Origin", width:100, align: "left" };tblColums.push(oColumn);
                    oColumn = { field: "MUName", title: "Unit", width: 70, align: "left"};tblColums.push(oColumn);
                    oColumn = { field: "WorkingUnitName", title: "Store", width: 180, align: "left" };tblColums.push(oColumn);
                    oColumn = { field: "ProductNameCode", title: "Name", width: 180, align: "left" };tblColums.push(oColumn);

                    var oPickerParam = {
                        winid: 'winLotDyesChemicalPickerAddition',
                        winclass:'clsLotDyesChemicalPicker',
                        winwidth: 480,
                        winheight: 460,
                        tableid: 'tblLotDyesChemicalPicker',
                        tablecolumns: tblColums,
                        datalist: response.objs,
                        multiplereturn: false,
                        searchingbyfieldName:'LotNo',
                        windowTittle: 'Lot List'
                    };
                    $.icsPicker(oPickerParam);
                    IntializeLotPickerbutton(oPickerParam);//multiplereturn, winclassName
                }
                else { alert(response.objs[0].ErrorMessage); }
            }
            else{
                alert("No lot found.");
            }
        });
    }

    $("#btnAddDetailAddition").click(function (e)
    {
        debugger;

        if (!ValidationRouteSheetDetailAddition()) return false;
        var oRSD=RefreshObjectRouteSheetDetailAddition();
        SaveRouteSheetDetailAddition(oRSD);
    });

    $("#btnDeleteDetailAddition").click(function () {

        var oRSAdditionalDetail = $("#tblRSAdditional").datagrid("getSelected");
        if (oRSAdditionalDetail == null || oRSAdditionalDetail.RSAdditionalDetailID <= 0) { alert("Please select an item from list!"); return false; }

        if (!confirm("Confirm to Delete?")) return false;

        var obj =
        {
            BaseAddress: _sBaseAddress,
            Object: oRSAdditionalDetail,
            ControllerName: "RouteSheet",
            ActionName: "DeleteRSDA",
            TableId: "tblRSAdditional",
            IsWinClose: false,
            Message:''
        };
        $.icsDelete(obj);

    });

    function ValidationRouteSheetDetailAddition()
    {
        if (_oRSD==null || _oRSD.RouteSheetDetailID<=0)
        {
            alert("Invalid Batch !"); return false;
        }
        if ($('#cboAdditionType').val()==undefined || $('#cboAdditionType').val()<=0)
        {
            alert("Please select a type and try again!");
            $('#cboAdditionType').focus();
            return false;
        }

        return true;
    }

    function RefreshObjectRouteSheetDetailAddition()
    {
        debugger;
        if(!ValidationAdditionalQty())return;

        var nQty= parseFloat(($('#txtLot_Addition_Qty_KG').val()=='') ? 0 : $('#txtLot_Addition_Qty_KG').val()) + parseFloat(parseFloat(($('#txtLot_Addition_Qty_GM').val()=='')? 0 : $('#txtLot_Addition_Qty_GM').val())/1000);

        if(nQty<=0 || isNaN(nQty))
        {
            alert("Invalid Quantity."); return;
        }
        if(_nSuggestLotID_Addition<=0 || isNaN(_nSuggestLotID_Addition))
        {
            alert("Invalid Lot."); return;
        }
        var oRSDA={
            RouteSheetDetailID : (_oRSD==null || _oRSD.RouteSheetDetailID<=0)? 0 : _oRSD.RouteSheetDetailID,
            RouteSheetID : _oRouteSheet.RouteSheetID,
            Note : $.trim($('#txtNoteAddition').val()),
            Qty : nQty, //parseFloat($('#txtLot_Addition_Qty').val()),
            LotID : _nSuggestLotID_Addition,
            Note : $.trim($('#txtLot_Addition_Remarks').val()),
            InOutType : $('#cboAdditionType').val(),
            LotNo: $.trim($('#txtLot_Addition').val())
        };
        return oRSDA;
    }

    function SaveRouteSheetDetailAddition(oRSDA){
        var obj = {
            BaseAddress: _sBaseAddress,
            Object: oRSDA,
            ObjectId: oRSDA.RouteSheetDetailID,
            ControllerName: "RouteSheet",
            ActionName: "SaveRSDA",
            TableId: "",
            IsWinClose: false,
            Message: "Save sucessfully."
        };
        $.icsSave(obj, function (response) {
            if (response.status && response.obj != null)
            {
                if (response.obj.RouteSheetDetailID > 0)
                {
                    $('#tblRSAdditional').treegrid('appendRow', response.obj);

                    $("#cboAdditionType").val(0);
                    $("#txtLot_Addition_Qty_KG").val("");
                    $("#txtLot_Addition_Qty_GM").val("");
                    $("#txtLot_Addition_Remarks").val("");

                    //var oRSD= $('#tblTreeGridProcess').datagrid('getSelected');
                    //if(oRSD==null || oRSD.RouteSheetDetailID<=0){ alert("Please select an item from list."); return false; }
                    //oRSDA

                    //$('#tblTreeGridProcess').treegrid('update',{ id: oRSD.RouteSheetDetailID, row: oRSD});
                }
            }
        });
    }



    function ValidationAdditionalQty(){
        if($('#txtLot_Addition_Qty_KG').val()=='' && $('#txtLot_Addition_Qty_GM').val()==''){
            $('#txtLot_Addition_Qty_KG,#txtLot_Addition_Qty_GM').focus();
            $('#txtLot_Addition_Qty_KG').addClass("errorFieldBorder");
            alert('Please enter quantity.');
            return false;
        }
        else{
            $('#txtLot_Addition_Qty_KG,#txtLot_Addition_Qty_GM').removeClass("errorFieldBorder");
        }

        return true;
    }

    /*----------------------- Additional Qty Add----------------*/

    function ResetAdditionalReturn(){
        _oRSD=null;
        _bIsReturn=false;
        $('#txtAdditionalReturnProduct, #txtAdditionalReturnQtyKg, #txtAdditionalReturnQtyGm').val("");
        $('#txtAdditionalReturnQtyKg,#txtAdditionalReturnQtyGm').removeClass("errorFieldBorder");
    }

    function SetAdditionalReturnQty(nQty)
    {
        var nKg= 0, mGm =0;
        var nTotalQty = parseFloat(nQty)*1000;
        if(nTotalQty>0)
            nKg= parseInt(nQty);

        mGm = parseFloat(nTotalQty)-parseInt(nKg*1000);

        $('#txtAdditionalReturnQtyKg').val(nKg);
        $('#txtAdditionalReturnQtyGm').val(mGm.toFixed(4));
    }

    function GetRouteSheetDetail(oRSD,stitle){
        var obj =
         {
             BaseAddress: _sBaseAddress,
             Object: oRSD,
             ControllerName: "RouteSheet",
             ActionName: "GetRouteSheetDetail",
             IsWinClose: false
         };

        $.icsDataGet(obj, function (response) {

            if (response.status && response.obj != null) {
                if (response.obj.RouteSheetDetailID > 0) {

                    if(_bIsReturn){
                        SetAdditionalReturnQty(response.obj.ReturnQty);
                    }
                    else{
                        if(response.obj.AddOneLotID<=0)
                        {
                            SetAdditionalReturnQty(response.obj.AddOneQty);
                        }
                        else if(response.obj.AddTwoLotID<=0)
                        {
                            SetAdditionalReturnQty(response.obj.AddTwoQty);
                        }
                        else if(response.obj.AddThreeLotID<=0)
                        {
                            SetAdditionalReturnQty(response.obj.AddThreeQty);
                        }
                    }

                    _oRSD=response.obj;

                    $('#txtAdditionalReturnProduct').val(response.obj.ProcessName);
                    $("#winAdditionalReturn").icsWindow("open", stitle);

                }
                else { alert(response.obj.ErrorMessage); }
            }
        });
    }

    function ValidationAdditionalReturn(){
        if($('#txtAdditionalReturnQtyKg').val()=='' && $('#txtAdditionalReturnQtyGm').val()==''){
            $('#txtAdditionalReturnQtyKg,#txtAdditionalReturnQtyGm').focus();
            $('#txtAdditionalReturnQtyKg').addClass("errorFieldBorder");
            alert('Please enter quantity.');
            return false;
        }
        else{
            $('#txtAdditionalReturnQtyKg,#txtAdditionalReturnQtyGm').removeClass("errorFieldBorder");
        }
        return true;
    }

    $("#btnAdditional").click(function (e) {
        ResetAdditionalReturn();
        var oRSD= $('#tblTreeGridProcess').datagrid('getSelected');
        if(oRSD==null || oRSD.RouteSheetDetailID<=0){ alert("Please select an item from list."); return false; }
        _bIsReturn=false;
        if(oRSD.TotalQtyLotID<=0){
            alert("Initial dye chemical yet not out."); return false;
        }

        $('#cboOutState').val(oRSD.OutState);

        if(oRSD.AddOneLotID<=0){ $('#cboOutState').val(1); GetRouteSheetDetail(oRSD,"First Additional Qty");}
        else if(oRSD.AddTwoLotID<=0){ $('#cboOutState').val(2);GetRouteSheetDetail(oRSD,"Second Additional Qty");}
        else if(oRSD.AddThreeLotID<=0){ $('#cboOutState').val(3); GetRouteSheetDetail(oRSD,"Third Additional Qty");}
        else
            alert("Additional qty fullfiled.");

    });

    $("#btnReturn").click(function (e) {
        ResetAdditionalReturn();
        var oRSD= $('#tblTreeGridProcess').datagrid('getSelected');
        if(oRSD==null || oRSD.RouteSheetDetailID<=0){ alert("Please select an item from list."); return false; }
        _bIsReturn=true;
        $('#cboOutState').val(4);
        $('#cboOutState').prop('disabled',true);

        if(oRSD.ReturnLotID<=0)
            GetRouteSheetDetail(oRSD,"Return Qty");
        else
            alert("Already disbursed.");

    });


    $("#btnSaveAdditionalReturn").click(function (e) {

        if(!ValidationAdditionalReturn()) return false;

        var nQty= parseFloat(($('#txtAdditionalReturnQtyKg').val()=='')? 0 : $('#txtAdditionalReturnQtyKg').val()) + parseFloat(parseFloat(($('#txtAdditionalReturnQtyGm').val()=='')? 0 : $('#txtAdditionalReturnQtyGm').val())/1000);


        if(_bIsReturn){
            _oRSD.ReturnQty=nQty;
            $("#cboOutState").val(4);
        }
        else{
            //if(_oRSD.AddOneLotID<=0)
            //    _oRSD.AddOneQty=nQty;
            //else if(_oRSD.AddTwoLotID<=0)
            //    _oRSD.AddTwoQty=nQty;
            //else if(_oRSD.AddThreeLotID<=0)
            //    _oRSD.AddTwoQty=nQty;
            if( parseInt($("#cboOutState").val())==1)
                _oRSD.AddOneQty=nQty;
            else if( parseInt($("#cboOutState").val())==2)
                _oRSD.AddTwoQty=nQty;
            else if( parseInt($("#cboOutState").val())==3)
                _oRSD.AddThreeQty=nQty;
        }
        _oRSD.OutState=parseInt($("#cboOutState").val());
        SaveRouteSheetDetail(_oRSD);

    });

    $("#btnCloseAdditionalReturn").click(function (e) {
        $("#winAdditionalReturn").icsWindow("close");
    });

    /*------------------------------------------------------*/

    $('#btnClose').click(function(e){
        window.location.href = sessionStorage.getItem("BackLink");
    });
    $('#btnCloseTwo').click(function(e){
        window.location.href = sessionStorage.getItem("BackLink");
    });
    function SetIntoSessionStorage(){

        debugger;
        var sBackLink=sessionStorage.getItem('BackLink');
        var nIndex=sessionStorage.getItem('SelectedRowIndex');
        var oRouteSheets= (sessionStorage.getItem('RouteSheets').length>0)? jQuery.parseJSON(sessionStorage.getItem('RouteSheets')):[] ;
        if(_oRouteSheet!=null && _oRouteSheet.RouteSheetID>0)
        {
            if(nIndex>=0){
                oRouteSheets[nIndex]=_oRouteSheet;
            }
            else{
                oRouteSheets.push(_oRouteSheet);
                nIndex=oRouteSheets.length-1;
            }
        }
        sessionStorage.clear();
        sessionStorage.setItem("BackLink", sBackLink);
        sessionStorage.setItem("SelectedRowIndex", nIndex);
        sessionStorage.setItem("RouteSheets", JSON.stringify(oRouteSheets));
    }

    $('#btnNew').click(function(e){

        var sBackLink=sessionStorage.getItem('BackLink');
        var nIndex=sessionStorage.getItem('SelectedRowIndex');
        var oRouteSheets= (sessionStorage.getItem('RouteSheets').length>0)? jQuery.parseJSON(sessionStorage.getItem('RouteSheets')):[] ;
        sessionStorage.clear();
        sessionStorage.setItem("BackLink", sBackLink);
        sessionStorage.setItem("SelectedRowIndex", -1);
        sessionStorage.setItem("RouteSheets", JSON.stringify(oRouteSheets));
        ResetControll();
    });

    $('.only-number').keydown(function (e) {


        if ((e.which >= 48 && e.which <= 57) || (e.which >= 96 && e.which <= 105)|| e.which==9 || e.which==119 || e.which==110 || e.which==38 || e.which==40 || e.which==8 || e.which==37 || e.which==39 || e.which==46) {
            return true;
        }
        else {
            return false
        }
    });

    $('#btnPrint').click(function (e)
    {
        if (_oRouteSheet ==null || _oRouteSheet.RouteSheetID <=0 ) { alert("Please select an item from list."); return ; }
        var tsv=((new Date()).getTime())/1000;
        window.open(_sBaseAddress+ "/RouteSheet/PrintRouteSheet?nId="+_oRouteSheet.RouteSheetID+"&bIsCommon="+$("#chkIsCommon").is(":checked")+"&nts="+tsv, "_blank");
    });
    $('#btnPrintTwo').click(function (e)
    {
        if (_oRouteSheet ==null || _oRouteSheet.RouteSheetID <=0 ) { alert("Please select an item from list."); return ; }
        var tsv=((new Date()).getTime())/1000;
        window.open(_sBaseAddress+ "/RouteSheet/PrintRouteSheet?nId="+_oRouteSheet.RouteSheetID+"&bIsCommon="+false+"&nts="+tsv, "_blank");
    });


    //Sequence
    $("#btnSequenceConfigure").click(function () {
        var oRSD = $('#tblTreeGridProcess').datagrid('getSelected');
        if (oRSD == null || parseInt(oRSD.RouteSheetDetailID) <= 0) {
            alert("Please select a item from list!");
            return;
        }
        var SelectedRowIndex = $('#tblTreeGridProcess').datagrid('getRowIndex', oRSD);
        $("#winRSDequence").icsWindow('open', "Selected parent DST : " + oRSD.text);
        $("#winRSDequence input").val("");
        $("#winRSDequence select").val(0);
        GetChildRSDs(oRSD,'tblDSTSequence');
    });
    function GetChildRSDs(oRSD,tblid) {
        var oTempDST = { ParentID: oRSD.RouteSheetDetailID };
        var obj =
        {
            BaseAddress: _sBaseAddress,
            Object: oTempDST,
            ControllerName: "RouteSheet",
            ActionName: "GetRSDChilds",
            IsWinClose: false
        };

        $.icsDataGet(obj, function (response) {
            debugger;
            if (response.status && response.obj != null) {
                if (response.obj.ErrorMessage != "" || response.obj.ErrorMessage != null)
                {
                    _oRSD = response.obj;
                    DynamicRefreshList(response.obj.children, tblid);
                    _oRSDs = response.obj.children;
                }
                else { alert(response.obj.ErrorMessage); }
            }
            else { alert("No information found."); }
        });
    }
    function SaveSequence()
    {
        //debugger;
        var oRSD= {
            children :$('#tblDSTSequence').datagrid('getRows')
        };
        $.ajax({
            type: "POST",
            dataType: "json",
            url : _sBaseAddress+"/RouteSheet/RefreshMenuSequence",
            traditional: true,
            data:  JSON.stringify(oRSD),
            contentType: "application/json; charset=utf-8",
            success: function (data) {
                //debugger;
                var  oRSD = jQuery.parseJSON(data);
                if (oRSD.DisplayMessage=="" || oRSD.DisplayMessage==null)
                {
                    alert("Data Saved sucessfully");
                    $("#winRSDequence").icsWindow("close");
                    $("#winRSDequence input").val("");
                    $("#winRSDequence select").val(0);
                }
                else {
                    alert(oRSD.DisplayMessage);
                }
            },
            error: function (xhr, status, error) {
                alert(error);
            }

        });
    }
    $("#btnCloseDSTSequence").click(function () {
        $("#winRSDequence").icsWindow("close");
        $("#winRSDequence input").val("");
        $("#winRSDequence select").val(0);
    });
    function UP()
    {
        debugger;
        var oRSD = $('#tblDSTSequence').datagrid('getSelected');
        if(oRSD==null)
        {
            alert("Please select Item");
            return;
        }
        var SelectedRowIndex=$('#tblDSTSequence').datagrid('getRowIndex',oRSD);
        if(SelectedRowIndex==0)return;
        var oRSDs=$('#tblDSTSequence').datagrid('getRows');
        _oRSDs = [];
        for(var i=0; i<oRSDs.length; i++)
        {
            if(i==(SelectedRowIndex-1))
            {
                _oRSDs[i]=oRSDs[i+1];
            }
            else if(i==SelectedRowIndex)
            {
                _oRSDs[i]=oRSDs[i-1];
            }
            else
            {
                _oRSDs[i]=oRSDs[i];
            }
            _oRSDs[i].Sequence=i+1;
        }
        data = _oRSDs;
        data={"total":""+data.length+"","rows":data};
        $('#tblDSTSequence').datagrid('loadData',data);
        //    MakeMenu();
        var newSelectedRowIndex=SelectedRowIndex-1;
        $('#tblDSTSequence').datagrid('selectRow',newSelectedRowIndex);

    }
    function Down()
    {
        debugger;
        var oRSD = $('#tblDSTSequence').datagrid('getSelected');
        if(oRSD==null)
        {
            alert("Please select a item from list!");
            return;
        }
        var SelectedRowIndex=$('#tblDSTSequence').datagrid('getRowIndex',oRSD);
        if(SelectedRowIndex==(_oRSDs.length-1))return;
        var oRSDs=$('#tblDSTSequence').datagrid('getRows');
        _oRSDs=[];
        for(var i=0; i<oRSDs.length; i++)
        {
            if(i==(SelectedRowIndex+1))
            {
                _oRSDs[i]=oRSDs[i-1];
            }
            else if(i==SelectedRowIndex)
            {
                _oRSDs[i]=oRSDs[i+1];
            }
            else
            {
                _oRSDs[i]=oRSDs[i];
            }
            _oRSDs[i].Sequence=i+1;
        }
        data = _oRSDs;
        data={"total":""+data.length+"","rows":data};
        $('#tblDSTSequence').datagrid('loadData',data);

        var newSelectedRowIndex=SelectedRowIndex+1;
        $('#tblDSTSequence').datagrid('selectRow',newSelectedRowIndex);
    }
    function RefreshSequence()
    {
        var oRSDs = $('#tblDSTSequence').datagrid('getRows');
        if(oRSDs.length>0)
        {
            for(var i = 0;i<oRSDs.length;i++)
            {
                oRSDs[i].Sequence = i+1;
            }
            RefreshListSequence(oRSDs);
        }
    }
    function RefreshListSequence(oRSDs)
    {
        data=oRSDs;
        data={"total":""+data.length+"","rows":data};
        $('#tblDSTSequence').datagrid('loadData',data);
    }
    //end Sequence

    //Gets Labdip Recepi
    $("#btnLabdipRecipe").click(function () {

        var oPTU={LabDipDetailID: _oRouteSheet.PTU.LabDipDetailID,Shade: _oRouteSheet.PTU.Shade}

        $("#winLabdipRecipe").icsWindow('open',"Labdip No:"+_oRouteSheet.PTU.LabdipNo+ " Color No : " +_oRouteSheet.PTU.ColorNo+" Color"+_oRouteSheet.PTU.ColorNameShade);
        $("#winLabdipRecipe input").val("");
        $("#winLabdipRecipe select").val(0);
        GetLabdipRecipe(oPTU,'tblLabdipRecipe');
    });
    function GetLabdipRecipe(oPTU,tblid) {

        var obj =
        {
            BaseAddress: _sBaseAddress,
            Object: oPTU,
            ControllerName: "RouteSheet",
            ActionName: "GetLabdipRecipe",
            IsWinClose: false
        };

        $.icsDataGets(obj, function (response) {
            debugger;
            if (response.status && response.objs != null) {
                if (response.objs.length>0 )
                {

                    DynamicRefreshList(response.objs, tblid);
                }
                else { alert(response.obj.ErrorMessage); }
            }
            else { alert("No information found."); }
        });
    }
    $("#btnCloseLabdipRecipe").click(function () {
        $("#winLabdipRecipe").icsWindow("close");
        $("#winLabdipRecipe input").val("");
        $("#winLabdipRecipe select").val(0);
    });

    function RefreshObjectRSDetail_LR(oLabdipRecipe){

        var oRSD= $('#tblTreeGridProcess').datagrid('getSelected');
        if(oRSD==null || oRSD.RouteSheetDetailID<=0){ alert("Please select an item from list."); return false; }

        debugger;
        var bIsDC=true;

        var oRSD={
            RouteSheetDetailID : (_oRSD==null || _oRSD.RouteSheetDetailID<=0)? 0 : _oRSD.RouteSheetDetailID,
            RouteSheetID : _oRouteSheet.RouteSheetID,
            ProcessID : oLabdipRecipe.ProductID,
            ParentID : oRSD.RouteSheetDetailID,
            IsDyesChemical : (_oRSD==null || _oRSD.RouteSheetDetailID<=0)?  bIsDC  : _oRSD.IsDyesChemical,
            TempTime : "",
            GL : (oLabdipRecipe.IsGL)? oLabdipRecipe.Qty: 0,
            Percentage :(oLabdipRecipe.IsGL)? 0: oLabdipRecipe.Qty,
            DAdjustment : 0,
            Note : '',
            ForCotton : false,
        };
        return oRSD;

    }
    $("#btnSaveLabdipRecipe").click(function (e) {

        //if (!ValidationRouteSheetDetail()) return false;
        debugger
        var oLabdipRecipes = $("#tblLabdipRecipe").datagrid('getChecked');
        for(var i=0; i<oLabdipRecipes.length; i++)
        {
            var oRSD=RefreshObjectRSDetail_LR(oLabdipRecipes[i]);
            SaveRouteSheetDetail(oRSD);
        }

    });
    //end Labdip Recepi

    function changeDyeingRecipeType()
    {
        var ncboDyeingRecipeType= parseInt($('#cboDyeingRecipeType').val());
        if(ncboDyeingRecipeType==0)
        {
            $("#trGL_Par").show();
            $("#trGL_Adj").show();
            $("#trQty").hide();
        }
        else{
            $("#trGL_Par").hide();
            $("#trGL_Adj").hide();
            $("#trQty").show();
        }

    }


    ////----------------Start Add multiple lot--------------------------------
    $("#btnAddLot").click(function () {
        debugger;
        if(!ValidationLot()) return false;
        $("#cboOrder").icsLoadCombo({List: _oRouteSheet.RouteSheetDOs, OptionValue: "DyeingOrderDetailID", DisplayText: "OrderNo"});
        if(_oRouteSheet.RouteSheetDOs.length == 1){
            $("#cboOrder").val(_oRouteSheet.RouteSheetDOs[0].DyeingOrderDetailID);
            GetRSRawLot();
        }
        $("#txtLotForRS").val("");
        DynamicRefreshList([], "tblLots");
        $("#winAddLot").icsWindow("open", "Add Multiple Lot");
    });

    $("#btnCloseRSRawLot").click(function () {
        $("#winAddLot").icsWindow("close");
    });

    $("#btnPickLotForRS").click(function () {
        if(!ValidationLot()) return false;
        if(parseInt($("#cboOrder").val()) <= 0){
            alert("Please Select order!!");
            $("#cboOrder").focus();
            return;
        }
        var sLotNo=$.trim($("#txtLotForRS").val());
        GetLotsForRS(sLotNo);
    });

    $("#txtLotForRS").keydown(function (e) {
        var nkeyCode = e.keyCode || e.which;
        if(nkeyCode==13){
            if(!ValidationLot()) return false;
            if(parseInt($("#cboOrder").val()) <= 0){
                alert("Please Select order!!");
                $("#cboOrder").focus();
                return;
            }
            var sLotNo=$.trim($("#txtLotForRS").val());
            //if(sLotNo==""){ alert("Type lot no to search."); return false; }
            GetLotsForRS(sLotNo);
        }
    });

    function GetLotsForRS(sLotNo){

        var oRSDOs = $('#tblRouteSheetDO').datagrid('getRows');
        var sParam="";
        if(oRSDOs.length>0)
        {
            sParam=oRSDOs[0].ContractorID+"~"+ oRSDOs[0].DyeingOrderDetailID+'~'+3;
        }

        var oRouteSheet = {
            RouteSheetID: (_oRouteSheet!=null && _oRouteSheet.RouteSheetID>0)? _oRouteSheet.RouteSheetID:0,
            ProductID_Raw:_nProductID,
            LotNo:sLotNo,
            Params:sParam,
            WorkingUnitID: $('#cboStore').val()
        };

        var obj = {
            BaseAddress: _sBaseAddress,
            Object: oRouteSheet,
            ControllerName: "RouteSheet",
            ActionName: "GetsLotForRS",
            IsWinClose: false
        };

        $.icsDataGets(obj, function (response) {

            if (response.status && response.objs.length > 0) {
                if (response.objs[0].ProductID > 0) {
                    debugger;
                    var tblColums = [];
                    var oColumn = { field: "LotNo", title: "Lot No", width: 80, align: "left" };tblColums.push(oColumn);
                    oColumn = { field: "Balance", title: "Qty", width: 80, align: "right", formatter:formatPrice };tblColums.push(oColumn);
                    oColumn = { field: "LotStatusSt", title: "Running", width:30, align: "left" };tblColums.push(oColumn);
                    oColumn = { field: "MUName", title: "Unit", width: 70, align: "left"};tblColums.push(oColumn);
                    oColumn = { field: "ProductNameCode", title: "Name", width: 180, align: "left" };tblColums.push(oColumn);
                    oColumn = { field: "WorkingUnitName", title: "Store", width: 180, align: "left" };tblColums.push(oColumn);


                    var oPickerParam = {
                        winid: 'winLotPickerForRS',
                        winclass:'clsLotPickerForRS',
                        winwidth: 680,
                        winheight: 460,
                        tableid: 'tblLotPickerForRS',
                        tablecolumns: tblColums,
                        datalist: response.objs,
                        multiplereturn: true,
                        searchingbyfieldName:'LotNo',
                        windowTittle: 'Lot List'
                    };
                    $.icsPicker(oPickerParam);
                    IntializeLotPickerbutton(oPickerParam);//multiplereturn, winclassName
                }
                else { alert(response.objs[0].ErrorMessage); }
            }
            else{
                alert("No lot found.");
            }
        });


    }

    function chkRSQty()
    {
        var nDyeingOrderDetailID = 0;
        if(_oRouteSheet.RouteSheetDOs.length>1)
            nDyeingOrderDetailID = 0;
        else  if(_oRouteSheet.RouteSheetDOs.length==1) 
            nDyeingOrderDetailID = _oRouteSheet.RouteSheetDOs[0].DyeingOrderDetailID;   
        var oRows = $("#tblLots").datagrid("getRows");
        var nTotal=0;
        for(var i=0; i<oRows.length;i++)
        {
            if(oRows[i].DyeingOrderDetailID == nDyeingOrderDetailID)
                nTotal= parseFloat(oRows[i].Qty) +parseFloat(nTotal);
        }
        return nTotal;
    }

    function NotExist(oRSRawLot)
    {
        var oRows = $("#tblLots").datagrid("getRows");
        for(var i=0; i<oRows.length;i++)
        {
            if(oRows[i].LotID==oRSRawLot.LotID && oRows[i].DyeingOrderDetailID==oRSRawLot.DyeingOrderDetailID)
                return false
        }
        return true;
    }

    var editIndexLot = undefined;
    function endEditingLot() {
        if (editIndexLot == undefined) { return true }
        if ($('#tblLots').datagrid('validateRow', editIndexLot)) {
            $('#tblLots').datagrid('endEdit', editIndexLot);
            $('#tblLots').datagrid('selectRow', editIndexLot);
            var oESCDetail = $('#tblLots').datagrid('getSelected');

            $('#tblLots').datagrid('updateRow', { index: editIndexLot, row: oESCDetail });
            editIndexLot = undefined;
            return true;
        }
        else {
            return false;
        }
    }
    function onClickRowLot(index) {
        if (editIndexLot != index) {
            if (endEditingLot()) {
                $('#tblLots').datagrid('selectRow', index).datagrid('beginEdit', index);
                var oPRDetail= $('#tblLots').datagrid('getSelected');

                editIndexLot = index;
            }
            else {
                $('#tblLots').datagrid('selectRow', editIndexLot);
            }
        }
    }

    $("#btnDeleteRSRawLot").click(function ()
    {
        endEditingLot();
        var oItem=$('#tblLots').datagrid('getSelected');
        if(oItem==null)
        {
            alert("Please select a valid item from list.");
            return;
        }
        var nIndex= $('#tblLots').datagrid('getRowIndex',oItem);
        if(oItem.RSRawLotID <= 0){
            $('#tblLots').datagrid('deleteRow',nIndex);
        }else{
            $.ajax({
                type: "POST",
                dataType: "json",
                url : _sBaseAddress+"/RouteSheet/DeleteRSRawLot",
                traditional: true,
                data:  JSON.stringify(oItem),
                contentType: "application/json; charset=utf-8",
                success: function (data) {
                    debugger;
                    var sMsg = jQuery.parseJSON(data);
                    if (sMsg=="Deleted") {
                        alert("Delete successfully");
                        $('#tblLots').datagrid('deleteRow',nIndex);
                    }
                    else {
                        alert(sMsg);
                    }
                },
                error: function (xhr, status, error) {
                    alert(error);
                }
            });
        }
        
        
    });

    $("#btnSaveRSRawLot").click(function ()
    {
        endEditingLot();
        var oLots = $("#tblLots").datagrid("getRows");
        if(oLots.length <= 0)
        {
            alert("No Details Found.");
            return;
        }
        var oRSLot= _oRouteSheet;
        oRSLot.RSRawLots=oLots;
        $.ajax({
            type: "POST",
            dataType: "json",
            url : _sBaseAddress+"/RouteSheet/SaveRSRawLot",
            traditional: true,
            data:  JSON.stringify(oRSLot),
            contentType: "application/json; charset=utf-8",
            success: function (data) {
                //debugger;
                oRSLot = jQuery.parseJSON(data);
                if (oRSLot.ErrorMessage==null || oRSLot.ErrorMessage=="") {                    
                    DynamicRefreshList(oRSLot.RSRawLots,"tblLots");
                    alert("Data Saved successfully");
                }
                else {
                    alert(oRSLot.ErrorMessage);
                }
            },
            error: function (xhr, status, error) {
                alert(error);
            }
        });

    });

    function GetRSRawLot(){
        if(parseInt($("#cboOrder").val()) > 0){
            $.ajax({
                type: "GET",
                dataType: "json",
                url : _sBaseAddress+"/RouteSheet/GetRSRawLotByOrder",
                traditional: true,
                data:  {nRSID : _oRouteSheet.RouteSheetID, nDODID: parseInt($("#cboOrder").val())},
                contentType: "application/json; charset=utf-8",
                success: function (data) {
                    //debugger;
                    var oRSRawLots = jQuery.parseJSON(data);
                    if (oRSRawLots.length > 0) {                    
                        DynamicRefreshList(oRSRawLots,"tblLots");
                    }
                },
                error: function (xhr, status, error) {
                    alert(error);
                }
            });
        }
        
    }

    ////----------------End Add multiple lot--------------------------------

</script>