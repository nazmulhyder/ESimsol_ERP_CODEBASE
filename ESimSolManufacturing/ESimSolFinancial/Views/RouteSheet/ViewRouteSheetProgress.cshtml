@{
    ViewBag.Title = "Dye Line Progress";
}

<body>

    @model ESimSol.BusinessObjects.RouteSheet
    <div class="menuMainCollectionTable">
        <fieldset>
            <legend>Batch Card Sheet Info</legend>
            <table id="tblRouteSheet">
                <tr>
                    <td class="td-col-3 align-right">
                        <label>Dye line No </label>
                    </td>
                    <td class="td-col-7 align-left">
                        <input id="txtRouteSheetNo" type="text" placeholder="Search Batch No" />
                    </td>
                    <td class="td-col-3 align-right">
                        <label>Order No </label>
                    </td>
                    <td colspan="3" class="td-col-7 align-left">
                        <input id="txtOrderNo" type="text" placeholder="Search Order No" />
                    </td>
                   
                </tr>
                <tr>
                    <td class="td-col-3 align-right">
                        <label>Machine </label>
                    </td>
                    <td class="td-col-7 align-left">
                        <input id="txtMachine" type="text" disabled />
                    </td>
                    <td class="td-col-3 align-right">
                        <label> Batch No </label>
                    </td>
                    <td class="td-col-2 align-left">
                        <input id="txtBatchNo" type="text" disabled />
                    </td>
                    <td class="td-col-2 align-right">
                        <label> Status </label>
                    </td>
                    <td class="td-col-3 align-left">
                        <input style="width:78%" id="txtRSState" type="text" disabled />
                    </td>
         
                </tr>
                <tr>
                    <td class="td-col-3 align-right">
                        <label>Buyer </label>
                    </td>
                    <td  class="td-col-7 align-left">
                        <input id="txtBuyer" type="text" disabled />
                    </td>
                    <td class="td-col-3 align-right">
                        <label>Product  </label>
                    </td>
                    <td colspan="3" class="td-col-7 align-left">
                        <input id="txtProduct" type="text" disabled />
                    </td>

                </tr>
                <tr>
                    <td class="td-col-3 align-right">
                        <label>Color & Shade  </label>
                    </td>
                    <td class="td-col-7 align-left">
                        <input id="txtColorShade" type="text" disabled />
                    </td>

                    <td class="td-col-3 align-right">
                        <label> Quantity </label>
                    </td>
                    <td class="td-col-2 align-left">
                        <input id="txtQuantity" type="text" disabled />
                    </td>
                    <td class="td-col-2 align-right">
                        <label id="lblDyeingType">Cone</label>
                    </td>
                    <td class="td-col-3 align-left">
                        <input style="width:78%" id="txtDyeingType" type="text" disabled />
                    </td>
                  
                </tr>
                <tr>
                    <td class="td-col-3 align-right">
                        <label>Yarn Out By: </label>
                    </td>
                    <td class="td-col-7 align-left">
                        <input id="txtColorShade" type="text" disabled />
                    </td>

                    <td class="td-col-3 align-right">
                        <label> Yarn Out Time: </label>
                    </td>
                    <td class="td-col-2 align-left">
                        <input id="txtQuantity" type="text" disabled />
                    </td>
                    <td class="td-col-2 align-right">
                        <label id="lblDyeingType">Cone</label>
                    </td>
                    <td class="td-col-3 align-left">
                        <input style="width:78%" id="txtDyeingType" type="text" disabled />
                    </td>

                </tr>
            </table>
        </fieldset>

        <div>
            <div class="region-Styler">
                <fieldset class="process-flied">
                    <legend>Dye Machine Load</legend>
                    <table id="tbl-batch">
                        <tr>
                            <td class="td-col-6 batch-padding align-right">
                                <label>Batch Man </label>
                            </td>
                            <td class="td-col-14 batch-padding align-left">
                                <select id="cboDyeLoadBatchman" class="process-batchman"></select>
                            </td>
                        </tr>
                        <tr>
                            <td class="td-col-6 align-right">
                                <label>Load Time </label>
                            </td>
                            <td class="td-col-14 align-left">
                                <input id="dtDyeLoadTime" style="width:40%;" type="text" class="easyui-datebox" required="required" data-options="formatter:icsdateformat,parser:icsdateparser" />
                                <input id="tpDyeLoadTime" class="easyui-timespinner" style="width:25%;" required="required" />
                            </td>
                        </tr>
                        <tr>
                            <td class="td-col-6 align-right">
                                <label>Remarks </label>
                            </td>
                            <td class="td-col-14 align-left">
                                <input id="txtDyeLoadNote" class="process-note" type="text" placeholder="Remarks"/>
                            </td>
                        </tr>
                        <tr>
                            <td class="td-col-6 align-right"></td>
                            <td class="td-col-14 align-right">
                                <a id="btnDyeLoad" href="javascript:void(0)" class="easyui-linkbutton process-btn" iconcls="icon-ok" plain="true">Process</a>
                            </td>
                        </tr>
                    </table>
                </fieldset>
            </div>
            <div class="region-Styler">
                <fieldset class="process-flied">
                    <legend>Dye Machine Unload</legend>
                    <table id="tbl-batch"> 
                        <tr>
                            <td class="td-col-6 batch-padding align-right">
                                <label>Batch Man </label>
                            </td>
                            <td class="td-col-14 batch-padding align-left">
                                <select id="cboDyeUnloadBatchman" class="process-batchman"></select>
                            </td>
                        </tr>
                        <tr>
                            <td class="td-col-6 align-right">
                                <label>Unload Time </label>
                            </td>
                            <td class="td-col-14 align-left">
                                @*<input id="dtDyeUnloadTime" type="text" class="easyui-datetimebox" style="width:70%" data-options="  showSeconds:false" />*@
                                <input id="dtDyeUnloadTime" style="width:40%;" type="text" class="easyui-datebox" required="required" data-options="formatter:icsdateformat,parser:icsdateparser" />
                                <input id="tpDyeUnloadTime" class="easyui-timespinner" style="width:25%;" required="required" />
                            </td>
                        </tr>
                        <tr>
                            <td class="td-col-6 align-right">
                                <label>Remarks </label>
                            </td>
                            <td class="td-col-14 align-left">
                                <input id="txtDyeUnloadNote" class="process-note" type="text" placeholder="Remarks" />
                            </td>
                        </tr>
                        <tr>
                            <td class="td-col-6 align-right"></td>
                            <td class="td-col-14 align-right">
                                <a id="btnDyeUnload" href="javascript:void(0)" class="easyui-linkbutton process-btn" iconcls="icon-ok" plain="true">Process</a>
                            </td>
                        </tr>
                    </table>
                </fieldset>
            </div>
        </div>
        <div>
            <div class="region-Styler">
                <fieldset class="process-flied">
                    <legend>Hydro Machine Load</legend>
                    <table id="tbl-batch">
                        <tr>
                            <td class="td-col-6 batch-padding align-right">
                                <label>Batch Man </label>
                            </td>
                            <td class="td-col-14 batch-padding align-left">
                                <select id="cboHydroLoadBatchman" class="process-batchman"></select>
                            </td>
                        </tr>
                        <tr>
                            <td class="td-col-6 align-right">
                                <label>Load Time </label>
                            </td>
                            <td class="td-col-14 align-left">
                                @*<input id="dtHydroLoadTime" type="text" class="easyui-datetimebox" style="width:70%" data-options="  showSeconds:false" />*@
                                <input id="dtHydroLoadTime" style="width:40%;" type="text" class="easyui-datebox" required="required" data-options="formatter:icsdateformat,parser:icsdateparser" />
                                <input id="tpHydroLoadTime" class="easyui-timespinner" style="width:25%;" required="required" />
                            </td>
                        </tr>
                        <tr>
                            <td class="td-col-6 align-right">
                                <label>Remarks </label>
                            </td>
                            <td class="td-col-14 align-left">
                                <input id="txtHydroLoadNote" class="process-note" type="text" placeholder="Remarks" />
                            </td>
                        </tr>
                        <tr>
                            <td class="td-col-6 align-right">
                                <label>Hydro Machine</label>
                            </td>
                            <td class="td-col-14 align-left">
                                <div class="input-group" style="width:90%">
                                    <input id="txtHydroMachineName" onkeydown="SearchKeyFNMachine(event,1)" placeholder="Type Name & Press Enter.." />
                                    <button type="button" aria-label="Left Align" onclick="GetFNMachine(1)"> P </button>
                                </div>
                            </td>
                        </tr>
                        <tr>
                            <td class="td-col-6 align-right"></td>
                            <td class="td-col-14 align-right">
                                <a id="btnHydroLoad" href="javascript:void(0)" class="easyui-linkbutton process-btn" iconcls="icon-ok" plain="true">Process</a>
                            </td>
                        </tr>

                        
                    </table>
                </fieldset>
            </div>
            <div class="region-Styler">
                <fieldset class="process-flied">
                    <legend>Hydro Machine Unload</legend>
                    <table id="tbl-batch">
                        <tr>
                            <td class="td-col-6  batch-padding align-right">
                                <label>Batch Man </label>
                            </td>
                            <td class="td-col-14 batch-padding align-left">
                                <select id="cboHydroUnloadBatchman" class="process-batchman"></select>
                            </td>
                        </tr>
                        <tr>
                            <td class="td-col-6 align-right">
                                <label>Unload Time </label>
                            </td>
                            <td class="td-col-14 align-left">
                                @*<input id="dtHydroUnloadTime" type="text" class="easyui-datetimebox" style="width:70%" data-options="  showSeconds:false" />*@
                                <input id="dtHydroUnloadTime" style="width:40%;" type="text" class="easyui-datebox" required="required" data-options="formatter:icsdateformat,parser:icsdateparser" />
                                <input id="tpHydroUnloadTime" class="easyui-timespinner" style="width:25%;" required="required" />
                            </td>
                        </tr>
                        <tr>
                            <td class="td-col-6 align-right">
                                <label>Remarks </label>
                            </td>
                            <td class="td-col-14 align-left">
                                <input id="txtHydroUnloadNote" class="process-note" type="text" placeholder="Remarks" />
                            </td>
                        </tr>
                        <tr>
                            <td class="td-col-6 align-right"></td>
                            <td class="td-col-14 align-right">
                                <a id="btnHydroUnload" href="javascript:void(0)" class="easyui-linkbutton process-btn" iconcls="icon-ok" plain="true">Process</a>
                            </td>
                        </tr>
                    </table>
                </fieldset>
            </div>
        </div>
        <div>
            <div class="region-Styler">
                <fieldset class="process-flied">
                    <legend>Dryer Machine Load</legend>
                    <table id="tbl-batch">
                        <tr>
                            <td class="td-col-6 batch-padding align-right">
                                <label>Batch Man </label>
                            </td>
                            <td class="td-col-14 batch-padding align-left">
                                <select id="cboDryerLoadBatchman" class="process-batchman"></select>
                            </td>
                        </tr>
                        <tr>
                            <td class="td-col-6 align-right">
                                <label>Load Time </label>
                            </td>
                            <td class="td-col-14 align-left">
                                @*<input id="dtDryerLoadTime" type="text" class="easyui-datetimebox" style="width:70%" data-options="  showSeconds:false" />*@
                                <input id="dtDryerLoadTime" style="width:40%;" type="text" class="easyui-datebox" required="required" data-options="formatter:icsdateformat,parser:icsdateparser" />
                                <input id="tpDryerLoadTime" class="easyui-timespinner" style="width:25%;" required="required" />
                            </td>
                        </tr>
                        <tr>
                            <td class="td-col-6 align-right">
                                <label>Remarks </label>
                            </td>
                            <td class="td-col-14 align-left">
                                <input id="txtDryerLoadNote" class="process-note" type="text" placeholder="Remarks" />
                            </td>
                        </tr>
                        <tr>
                            <td class="td-col-6 align-right">
                                <label>Dryer Machine</label>
                            </td>
                            <td class="td-col-14 align-left">
                                <div class="input-group" style="width:90%">
                                    <input id="txtDryerMachineName" onkeydown="SearchKeyFNMachine(event,2)" placeholder="Type Name & Press Enter.." />
                                    <button type="button" aria-label="Left Align" onclick="GetFNMachine(2)"> P </button>
                                </div>
                            </td>
                        </tr>
                        <tr>
                            <td class="td-col-6 align-right"></td>
                            <td class="td-col-14 align-right">
                                <a id="btnDryerLoad" href="javascript:void(0)" class="easyui-linkbutton process-btn" iconcls="icon-ok" plain="true">Process</a>
                            </td>
                        </tr>
                    </table>
                </fieldset>
            </div>
            <div class="region-Styler">
                <fieldset class="process-flied">
                    <legend>Dryer Machine Unload</legend>
                    <table id="tbl-batch">
                        <tr>
                            <td class="td-col-6 batch-padding align-right">
                                <label>Batch Man </label>
                            </td>
                            <td class="td-col-14 batch-padding align-left">
                                <select id="cboDryerUnloadBatchman" class="process-batchman"></select>
                            </td>
                        </tr>
                        <tr>
                            <td class="td-col-6 align-right">
                                <label>Unload Time </label>
                            </td>
                            <td class="td-col-14 align-left">
                                @*<input id="dtDryerUnloadTime" type="text" class="easyui-datetimebox" style="width:70%" data-options="  showSeconds:false" />*@
                                <input id="dtDryerUnloadTime" style="width:40%;" type="text" class="easyui-datebox" required="required" data-options="formatter:icsdateformat,parser:icsdateparser" />
                                <input id="tpDryerUnloadTime" class="easyui-timespinner" style="width:25%;" required="required" />
                            </td>
                        </tr>
                        <tr>
                            <td class="td-col-6 align-right">
                                <label>Remarks </label>
                            </td>
                            <td class="td-col-14 align-left">
                                <input id="txtDryerUnloadNote" class="process-note" type="text" placeholder="Remarks" />
                            </td>
                        </tr>
                        <tr>
                            <td class="td-col-6 align-right"></td>
                            <td class="td-col-14 align-right">
                                <a id="btnDryerUnload" href="javascript:void(0)" class="easyui-linkbutton process-btn" iconcls="icon-ok" plain="true">Process</a>
                            </td>
                        </tr>
                    </table>
                </fieldset>
            </div>
        </div>
        @*<fieldset>
            <legend>Action</legend>
            <div class="align-right">
                <table border="0" cellpadding="0" cellspacing="0" style="float:right; width:100%;">
                    <tr>
                        <td style="width:30%;float:left; text-align:left">
                        </td>
                        <td style="width:70%;float:right; text-align:right">
                            <a id="btnClose" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-cancel" plain="true">Close</a>
                        </td>
                    </tr>
                </table>

            </div>
        </fieldset>*@
    </div>
</body>

<style type="text/css">

     #tblRouteSheet{
         width:100%;
     }

     #tbl-batch{
         width:100%;
     }

     .td-col-7 input{
         width:90%;
     }

     .region-Styler{
         float:left;
         width:50%;
     }
 
     .td-col-14 select{
         width:70%;
     }
     .td-col-14 input{
         width:68%;
     }
     .process-flied{
         min-height:135px;
     }

     .batch-padding{
         padding-top:0px;
     }

</style>

<script type="text/javascript">

    var _sBaseAddress = "";
    var _oRouteSheet=null;
    var _dtEventTime = new Date();
    var _nEventEmpID = 0;
    var _sNote = "";
    var _oRouteSheetSetup=null;
    var _oAuthorizationRolesMapping=null;
    $(document).ready(function () {

        _sBaseAddress =@Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(HttpContext.Current.Session[SessionInfo.BaseAddress]));
        var oRouteSheet =@Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(Model));
        var oEmployees =@Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(@ViewBag.Employees));
        _oRouteSheetSetup=@Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(@ViewBag.RouteSheetSetup));
        _oAuthorizationRolesMapping = @Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(HttpContext.Current.Session[SessionInfo.AuthorizationRolesMapping]));
        $("#cboDyeLoadBatchman,#cboDyeUnloadBatchman,#cboHydroLoadBatchman,#cboHydroUnloadBatchman,#cboDryerLoadBatchman,#cboDryerUnloadBatchman").icsLoadCombo({
            List: oEmployees,
            OptionValue: "EmployeeID",
            DisplayText: "Name",
            InitialValue:"Default"
        });
        debugger;
        ResetRouteSheetProcess();


    });

  
    function ResetRouteSheetProcess(){
        $(".process-batchman").prop('disabled',true);
        $("#dtDyeLoadTime, #dtDyeUnloadTime, #dtHydroLoadTime, #dtHydroUnloadTime, #dtDryerLoadTime, #dtDryerUnloadTime").datebox('setValue', "");
        $('.process-note').prop('disabled',true);
        $('#tblRouteSheet input').val('');
        $('#tbl-batch select').val(0);
        $('.process-btn').hide();
        _dtEventTime = new Date();
        _nEventEmpID = 0;
        _sNote = "";
        _oRouteSheet=null;

        var nHour=_dtEventTime.getHours();
        var nMin=_dtEventTime.getMinutes();
        if(isNaN(nHour))
        {
            nHour=0;
        }
        if(isNaN(nMin))
        {
            nMin=0;
        }
        $('#tpDyeLoadTime,#tpDyeUnloadTime,#tpHydroLoadTime,#tpHydroUnloadTime,#tpDryerLoadTime,#tpDryerUnloadTime').timespinner('setValue', nHour+":"+nMin);
    }

    function RefreshControlHistory(nRSState, oRSHs){

        debugger;
        var dtEventTime=new Date(GetDateTime(new Date()));
        var dtCurrentTime=new Date(GetDateTime(new Date()));

        if(oRSHs.length>0){
            for(var i=0; i<oRSHs.length; i++){

                dtEventTime=new Date(oRSHs[i].EventTimeStr);

                if(oRSHs[i].CurrentStatus==6){
                    $('#cboDyeLoadBatchman').val(oRSHs[i].EventEmpID);
                   // $('#dtDyeLoadTime').datetimebox('setValue',GetDateTime(dtEventTime));
                    $('#dtDyeLoadTime').datebox('setValue', oRSHs[i].EventDT);
                    $('#tpDyeLoadTime').timespinner('setValue', oRSHs[i].TimeSt);
                    $('#txtDyeLoadNote').val(oRSHs[i].Note);
                }
                else if(oRSHs[i].CurrentStatus==7){
                    $('#cboDyeUnloadBatchman').val(oRSHs[i].EventEmpID);
                    //$('#dtDyeUnloadTime').datetimebox('setValue',GetDateTime(dtEventTime));
                    $('#dtDyeUnloadTime').datebox('setValue', oRSHs[i].EventDT);
                    $('#tpDyeUnloadTime').timespinner('setValue', oRSHs[i].TimeSt);
                    $('#txtDyeUnloadNote').val(oRSHs[i].Note);
                }
                else if(oRSHs[i].CurrentStatus==8){
                    $('#cboHydroLoadBatchman').val(oRSHs[i].EventEmpID);
                    //$('#dtHydroLoadTime').datetimebox('setValue',GetDateTime(dtEventTime));
                    $('#dtHydroLoadTime').datebox('setValue', oRSHs[i].EventDT);
                    $('#tpHydroLoadTime').timespinner('setValue', oRSHs[i].TimeSt);
                    $('#txtHydroLoadNote').val(oRSHs[i].Note);
                }
                else if(oRSHs[i].CurrentStatus==9){
                    $('#cboHydroUnloadBatchman').val(oRSHs[i].EventEmpID);
                    //$('#dtHydroUnloadTime').datetimebox('setValue',GetDateTime(dtEventTime));
                    $('#dtHydroUnloadTime').datebox('setValue', oRSHs[i].EventDT);
                    $('#tpHydroUnloadTime').timespinner('setValue', oRSHs[i].TimeSt);
                    $('#txtHydroUnloadNote').val(oRSHs[i].Note);
                }
                else if(oRSHs[i].CurrentStatus==10){
                    $('#cboDryerLoadBatchman').val(oRSHs[i].EventEmpID);
                    //$('#dtDryerLoadTime').datetimebox('setValue',GetDateTime(dtEventTime));
                    $('#dtDryerLoadTime').datebox('setValue', oRSHs[i].EventDT);
                    $('#tpDryerLoadTime').timespinner('setValue', oRSHs[i].TimeSt);
                    $('#txtDryerLoadNote').val(oRSHs[i].Note);
                }
                else if(oRSHs[i].CurrentStatus==11){
                    $('#cboDryerUnloadBatchman').val(oRSHs[i].EventEmpID);
                    $('#dtDryerUnloadTime').datebox('setValue', oRSHs[i].EventDT);
                    $('#tpDryerUnloadTime').timespinner('setValue', oRSHs[i].TimeSt);
                    $('#txtDryerUnloadNote').val(oRSHs[i].Note);
                }
            }
        }

        if(dtEventTime>=dtCurrentTime){
            dtCurrentTime=dtEventTime;
            dtCurrentTime.setMinutes(dtCurrentTime.getMinutes()+1);
        }

        if(nRSState==4){
            $('#cboDyeLoadBatchman').prop('disabled',false);
            $("#dtDyeLoadTime").datebox({'disabled':false});
            //$('#dtDyeLoadTime').datetimebox('setValue',GetDateTime(dtCurrentTime));
            $('#txtDyeLoadNote').prop('disabled',false);
            // $('#btnDyeLoad').show();
          debugger

            if (PermissionChecker('Add', 'DyeingLoadUnLoad',_oAuthorizationRolesMapping)) {  $("#btnDyeLoad").show();}
        }
        else if(nRSState==6){
            $('#cboDyeUnloadBatchman').prop('disabled',false);
            $("#dtDyeUnloadTime").datebox({'disabled':false});
            //$('#dtDyeUnloadTime').datetimebox('setValue',GetDateTime(dtCurrentTime));
            $('#txtDyeUnloadNote').prop('disabled',false);
           // $('#btnDyeUnload').show();
            if (PermissionChecker('Add', 'DyeingLoadUnLoad',_oAuthorizationRolesMapping)) {$("#btnDyeUnload").show();}
        }
        else if(nRSState==7){
            $('#cboHydroLoadBatchman').prop('disabled',false);
            $("#dtHydroLoadTime").datebox({'disabled':false});
            //$('#dtHydroLoadTime').datetimebox('setValue',GetDateTime(dtCurrentTime));
            $('#txtHydroLoadNote').prop('disabled',false);
            //$('#btnHydroLoad').show();
            //$('#btnDryerLoad').show();
            if (PermissionChecker('Add', 'Hydro',_oAuthorizationRolesMapping)) {$("#btnHydroLoad").show();}
        }
        else if(nRSState==8){
            $('#cboHydroUnloadBatchman').prop('disabled',false);
            $("#dtHydroUnloadTime").datebox({'disabled':false});
            //$('#dtHydroUnloadTime').datetimebox('setValue',GetDateTime(dtCurrentTime));
            $('#txtHydroUnloadNote').prop('disabled',false);
            //$('#btnHydroUnload').show();
            if (PermissionChecker('Add', 'Hydro',_oAuthorizationRolesMapping)) {$("#btnHydroUnload").show();}
        }
        else if(nRSState==9){
            $('#cboDryerLoadBatchman').prop('disabled',false);
            $("#dtDryerLoadTime").datebox({'disabled':false});
            //$('#dtDryerLoadTime').datetimebox('setValue',GetDateTime(dtCurrentTime));
            $('#txtDryerLoadNote').prop('disabled',false);
            //$('#btnDryerLoad').show();
            if (PermissionChecker('Add', 'Dryer',_oAuthorizationRolesMapping)) {$("#btnDryerLoad").show();}
        }
        else if(nRSState==10){
            $('#cboDryerUnloadBatchman').prop('disabled',false);
            $("#dtDryerUnloadTime").datebox({'disabled':false});
            //$('#dtDryerUnloadTime').datetimebox('setValue',GetDateTime(dtCurrentTime));
            $('#txtDryerUnloadNote').prop('disabled',false);
            //$('#btnDryerUnload').show();
            if (PermissionChecker('Add', 'Dryer',_oAuthorizationRolesMapping)) {$("#btnDryerUnload").show();}
        }

    }

    function GetDateTime(dt)
    {

        var date=new Date(dt);
        var nMonth=date.getMonth()+1;
        var nDate=date.getDate();
        var nYear=date.getFullYear();
        var nHour=date.getHours();
        var nMin=date.getMinutes();

        if(nMonth<10)
        {
            nMonth='0'+nMonth;
        }
        if(nDate<10)
        {
            nDate='0'+nDate;
        }
        if(nHour<10)
        {
            nHour='0'+nHour;
        }
        if(nMin<10)
        {
            nMin='0'+nMin;
        }
        date= nMonth+'/'+nDate+'/'+nYear+' '+nHour+':'+nMin;

        return date;

    }

    /*----------Routesheet Pick----------------*/

    $("#txtRouteSheetNo").keydown(function (e) {

        var nkeyCode = e.keyCode || e.which;
        debugger;
        if(nkeyCode==13){
            var sRouteSheetNo=$.trim($("#txtRouteSheetNo").val());
            if(sRouteSheetNo==""){ alert("Type Batch no/Dyeing Card no to search."); return false; }
            GetRouteSheetForProcess(sRouteSheetNo);
        }
        else if(nkeyCode==8){
            if($.trim($("#txtRouteSheetNo").val())==''){
                ResetRouteSheetProcess();
            }

        }
    });

    //$("#txtBatchNo").keydown(function (e) {
    //    var nkeyCode = e.keyCode || e.which;
    //    if(nkeyCode==13){
    //        var sRouteSheetNo=$.trim($("#txtBatchNo").val());
    //        if(sRouteSheetNo==""){ alert("Type Batch no/Dyeing Card no to search."); return false; }
    //        GetRouteSheetForProcess(sRouteSheetNo);
    //    }
    //    else if(nkeyCode==8){
    //        if($.trim($("#txtRouteSheetNo").val())==''){
    //            ResetRouteSheetProcess();
    //        }
    //    }
    //});

    function GetRouteSheetForProcess(sRouteSheetNo){

        ResetRouteSheetProcess();

        var oRouteSheet = {
            RouteSheetNo:sRouteSheetNo
        };

        var obj = {
            BaseAddress: _sBaseAddress,
            Object: oRouteSheet,
            ControllerName: "RouteSheet",
            ActionName: "GetRouteSheetForProcess",
            IsWinClose: false
        };

        $.icsDataGet(obj, function (response) {

            if (response.status && response.obj != null) {
                if (response.obj.RouteSheetID > 0) {
                    _oRouteSheet=response.obj;

                    $('#txtRouteSheetNo').val(response.obj.RouteSheetNo);
                    $('#txtBatchNo').val(response.obj.RouteSheetNo);

                    $('#txtMachine').val(response.obj.MachineName);
                    $('#txtRSState').val(response.obj.RSStateStr);
                    $('#txtOrderNo').val(response.obj.OrderNoFull);

                    $('#txtBuyer').val(response.obj.PTU.BuyerName);
                    $('#txtProduct').val(response.obj.ProductName);

                    $('#txtColorShade').val(response.obj.PTU.ColorNameShade);
                    $('#txtQuantity').val(formatPrice(response.obj.Qty+" "+_oRouteSheetSetup.MUnit));
                    $('#lblDyeingType').html("No Of "+response.obj.DyeingType);
                    $('#txtDyeingType').val(response.obj.NoOfHanksCone);
                    RefreshControlHistory(response.obj.RSState,response.obj.RSHistorys);
                }
                else { alert(response.obj.ErrorMessage); }
            }
            else{
                alert("No routesheet found.");
            }
        });


    }

    /*----------Routesheet Pick----------------*/

    /*=============== MACHINE PICK ============*/

    function SetHydroMachien(oResult)
    {
        console.log(oResult);
        $("#txtHydroMachineName").val(oResult.Name);
    }

    function SetDryerMachien(oResult)
    {
        console.log(oResult);
        $("#txtDryerMachineName").val(oResult.Name);
    }

    function SearchKeyFNMachine(e, nType)
    {
        var code = (e.keyCode ? e.keyCode : e.which);
        if (code == 13)
        {
            var sMachineName ="";
            if(nType==1) sMachineName = $.trim($("#txtHydroMachineName").val());
            if(nType==2) sMachineName = $.trim($("#txtDryerMachineName").val());

            if (sMachineName.length == 0)
            {
                alert("Please Type Machine Name To Search !");
                if(nType==1) $("#txtHydroMachineName").focus();
                if(nType==2) $("#txtDryerMachineName").focus();

                return false;
            }
            GetFNMachine(nType);
        }
        else if(code==27 || code==08)
        {
            if(nType==1) ResetHydroMachine();
            if(nType==2) ResetDryerMachine();
        }
    };

    function GetFNMachine(nType,sMachineName)
    {
        var oFNMachine = {
            Name: $.trim(sMachineName),
            Params:"2,3"//Batcher = 2,Trolly=3
        };

        var obj = {
            BaseAddress:_sBaseAddress,
            Object: oFNMachine,
            ControllerName: "FNMachine", //TechnicalSheet
            ActionName: "GetFNMachines",//ViewStyleSearch
            IsWinClose: false
        };

        var tblColums = [];
        var oColumn = { field: "Code", title: "Code", width: 80, align: "left" }; tblColums.push(oColumn);
        oColumn = { field: "Name", title: "Name", width: 80, align: "left" }; tblColums.push(oColumn);
        oColumn = { field: "Qty", title: "Qty", width: 90, align: "right" }; tblColums.push(oColumn);
        oColumn = { field: "FNMachineTypeSt", title: "Type", width: 90, align: "left" }; tblColums.push(oColumn);
        oColumn = { field: "FreeTime", title: "Free Time", width: 90, align: "left" }; tblColums.push(oColumn);

        var oPickerParam = {
            winid: 'winFNBatchers',
            winclass: 'clsFNBatcher',
            winwidth: 600,
            winheight: 460,
            tableid: 'tblFNBatchers',
            tablecolumns: tblColums,
            multiplereturn: false,
            searchingbyfieldName: 'Name',
            windowTittle: 'Bathcer List',
            paramObj: obj,
            pkID: 'FNMachineID',
            callBack: SetHydroMachien
        };

        if(nType==2) oPickerParam.callBack = SetDryerMachien;

        $.icsDynamicPicker(oPickerParam);
    }
    /*================= MACHINE END ============*/

    function Validation(){

        if(_oRouteSheet==null || _oRouteSheet.RouteSheetID<=0){
            $('#txtRouteSheetNo').focus();
            $('#txtRouteSheetNo').addClass("errorFieldBorder");
            alert('No Routesheet Found.');
            return false;
        }
        else{
            $('#txtRouteSheetNo').removeClass("errorFieldBorder");
        }

        if(_oRouteSheet.RSState==4){

            if($('#cboDyeLoadBatchman').val()<=0){
                $('#cboDyeLoadBatchman').focus();
                $('#cboDyeLoadBatchman').addClass("errorFieldBorder");
                alert('Select Batchman.');
                return false;
            }
            else{
                $('#cboDyeLoadBatchman').removeClass("errorFieldBorder");
            }

            //if(new Date($('#dtDyeLoadTime').datetimebox('getValue'))< new Date(GetDateTime(new Date()))){
            //    alert("Dye load time must be later or equal current time.");
            //    return false;
            //}
            _nEventEmpID=$('#cboDyeLoadBatchman').val();
           // _dtEventTime=$('#dtDyeLoadTime').datetimebox('getValue');
            _sNote= $.trim($('#txtDyeLoadNote').val());

            _dtEventTime =$('#dtDyeLoadTime').datebox('getValue');
            var startTime= $('#tpDyeLoadTime').timespinner('getValue');
            var sTime=startTime.split(':');
            var hStartTime= parseFloat(sTime[0]);
            var mStartTime= parseFloat(sTime[1]);
            _dtEventTime = new Date(_dtEventTime);
            _dtEventTime.setHours(hStartTime);
            _dtEventTime.setMinutes(mStartTime);
        }
        else if(_oRouteSheet.RSState==6){

            if($('#cboDyeUnloadBatchman').val()<=0){
                $('#cboDyeUnloadBatchman').focus();
                $('#cboDyeUnloadBatchman').addClass("errorFieldBorder");
                alert('Select Batchman.');
                return false;
            }
            else{
                $('#cboDyeUnloadBatchman').removeClass("errorFieldBorder");
            }

            if(new Date($('#dtDyeUnloadTime').datebox('getValue'))< new Date($('#dtDyeLoadTime').datebox('getValue'))){
                alert("Dye unload time must be later than dye load time.");
                return false;
            }
            _nEventEmpID=$('#cboDyeUnloadBatchman').val();
            //_dtEventTime=$('#dtDyeUnloadTime').datetimebox('getValue');
            _sNote= $.trim($('#txtDyeUnloadNote').val());
            _dtEventTime =$('#dtDyeUnloadTime').datebox('getValue');
            var startTime= $('#tpDyeUnloadTime').timespinner('getValue');
            var sTime=startTime.split(':');
            var hStartTime= parseFloat(sTime[0]);
            var mStartTime= parseFloat(sTime[1]);
            _dtEventTime = new Date(_dtEventTime);
            _dtEventTime.setHours(hStartTime);
            _dtEventTime.setMinutes(mStartTime);

        }

        else if(_oRouteSheet.RSState==7){


            if($('#cboHydroLoadBatchman').val()<=0){
                $('#cboHydroLoadBatchman').focus();
                $('#cboHydroLoadBatchman').addClass("errorFieldBorder");
                alert('Select Batchman.');
                return false;
            }
            else{
                $('#cboHydroLoadBatchman').removeClass("errorFieldBorder");
            }

            if(new Date($('#dtHydroLoadTime').datebox('getValue'))< new Date($('#dtDyeUnloadTime').datebox('getValue'))){
                alert("Hydro load time must be later than dye unload time.");
                return false;
            }
            _nEventEmpID=$('#cboHydroLoadBatchman').val();
            //_dtEventTime=$('#dtHydroLoadTime').datetimebox('getValue');
            _sNote= $.trim($('#txtHydroLoadNote').val());
            _dtEventTime =$('#dtHydroLoadTime').datebox('getValue');
            var startTime= $('#tpHydroLoadTime').timespinner('getValue');
            var sTime=startTime.split(':');
            var hStartTime= parseFloat(sTime[0]);
            var mStartTime= parseFloat(sTime[1]);
            _dtEventTime = new Date(_dtEventTime);
            _dtEventTime.setHours(hStartTime);
            _dtEventTime.setMinutes(mStartTime);

        }

        else if(_oRouteSheet.RSState==8){

            if($('#cboHydroUnloadBatchman').val()<=0){
                $('#cboHydroUnloadBatchman').focus();
                $('#cboHydroUnloadBatchman').addClass("errorFieldBorder");
                alert('Select Batchman.');
                return false;
            }
            else{
                $('#cboHydroUnloadBatchman').removeClass("errorFieldBorder");
            }

            if(new Date($('#dtHydroUnloadTime').datebox('getValue'))< new Date($('#dtHydroLoadTime').datebox('getValue'))){
                alert("Hydro unload time must be later than hydro load time.");
                return false;
            }
            _nEventEmpID=$('#cboHydroUnloadBatchman').val();
            //_dtEventTime=$('#dtHydroUnloadTime').datetimebox('getValue');
            _sNote= $.trim($('#txtHydroUnloadNote').val());
            _dtEventTime =$('#dtHydroUnloadTime').datebox('getValue');
            var startTime= $('#tpHydroUnloadTime').timespinner('getValue');
            var sTime=startTime.split(':');
            var hStartTime= parseFloat(sTime[0]);
            var mStartTime= parseFloat(sTime[1]);
            _dtEventTime = new Date(_dtEventTime);
            _dtEventTime.setHours(hStartTime);
            _dtEventTime.setMinutes(mStartTime);

        }

        else if(_oRouteSheet.RSState==9){

            if($('#cboDryerLoadBatchman').val()<=0){
                $('#cboDryerLoadBatchman').focus();
                $('#cboDryerLoadBatchman').addClass("errorFieldBorder");
                alert('Select Batchman.');
                return false;
            }
            else{
                $('#cboDryerLoadBatchman').removeClass("errorFieldBorder");
            }

            if(new Date($('#dtDryerLoadTime').datebox('getValue'))< new Date($('#dtHydroUnloadTime').datebox('getValue'))){
                alert("Dryer load time must be later than hydro unload time.");
                return false;
            }
            _nEventEmpID=$('#cboDryerLoadBatchman').val();
            //_dtEventTime=$('#dtDryerLoadTime').datetimebox('getValue');
            _sNote= $.trim($('#txtDryerLoadNote').val());

            _dtEventTime =$('#dtDryerLoadTime').datebox('getValue');
            var startTime= $('#tpDryerLoadTime').timespinner('getValue');
            var sTime=startTime.split(':');
            var hStartTime= parseFloat(sTime[0]);
            var mStartTime= parseFloat(sTime[1]);
            _dtEventTime = new Date(_dtEventTime);
            _dtEventTime.setHours(hStartTime);
            _dtEventTime.setMinutes(mStartTime);

        }
        else if(_oRouteSheet.RSState==10){

            if($('#cboDryerUnloadBatchman').val()<=0){
                $('#cboDryerUnloadBatchman').focus();
                $('#cboDryerUnloadBatchman').addClass("errorFieldBorder");
                alert('Select Batchman.');
                return false;
            }
            else{
                $('#cboDryerUnloadBatchman').removeClass("errorFieldBorder");
            }

            if(new Date($('#dtDryerUnloadTime').datebox('getValue'))< new Date($('#dtDryerLoadTime').datebox('getValue'))){
                alert("Dryer unload time must be later than dryer load time.");
                return false;
            }
            _nEventEmpID=$('#cboDryerUnloadBatchman').val();
            //_dtEventTime=$('#dtDryerUnloadTime').datetimebox('getValue');
            _sNote= $.trim($('#txtDryerUnloadNote').val());

            _dtEventTime =$('#dtDryerUnloadTime').datebox('getValue');
            var startTime= $('#tpDryerUnloadTime').timespinner('getValue');
            var sTime=startTime.split(':');
            var hStartTime= parseFloat(sTime[0]);
            var mStartTime= parseFloat(sTime[1]);
            _dtEventTime = new Date(_dtEventTime);
            _dtEventTime.setHours(hStartTime);
            _dtEventTime.setMinutes(mStartTime);

        }
        else if(_oRouteSheet.RSState==11){
            alert("Dyeing process completed. Please try with another routesheet.");
            return false;
        }
        return true;
    }

    function RefreshObject(){
        var oRSH={
            RouteSheetHistoryID: 0,
            RouteSheetID : _oRouteSheet.RouteSheetID,
            EventTime : _dtEventTime,
            EventEmpID : _nEventEmpID,
            CurrentStatus : (_oRouteSheet.RSState==4)?6:(_oRouteSheet.RSState+1),
            PreviousState : _oRouteSheet.RSState,
            Note : _sNote,
        };
        return oRSH;
    }

    function SaveRouteSheetProgress(datetimeboxId){
        debugger;
        if(!Validation()) return false;

        var oRSH=RefreshObject();
        var obj = {
            BaseAddress: _sBaseAddress,
            Object: oRSH,
            ObjectId: 0,
            ControllerName: "RouteSheet",
            ActionName: "RouteSheetProgress",
            TableId: "",
            IsWinClose: false,
            Message: "Process execute Successfully."
        };
        $.icsSave(obj, function (response) {
            if (response.status && response.obj != null) {
                if (response.obj.RouteSheetHistoryID > 0) {
                    _oRouteSheet.RSState=response.obj.CurrentStatus;
                    _oRouteSheet.RSStateStr=response.obj.CurrentStatusStr;
                    $('#txtRSState').val(response.obj.CurrentStatusStr);
                    $(".process-batchman").prop('disabled',true);
                    $('.process-btn').hide();
                    $('.process-note').prop('disabled',true);
                    $('#'+datetimeboxId).datebox({'disabled':true});
                    $('#'+datetimeboxId).datebox('setValue', icsdateformat(new Date()));
                    RefreshControlHistory(response.obj.CurrentStatus, [response.obj]);
                }
            }
        });
    }


    $("#btnDyeLoad").click(function (){ SaveRouteSheetProgress('dtDyeLoadTime'); });

    $("#btnDyeUnload").click(function (){ SaveRouteSheetProgress('dtDyeUnloadTime'); });

    $("#btnHydroLoad").click(function (){ SaveRouteSheetProgress('dtHydroLoadTime'); });

    $("#btnHydroUnload").click(function (){ SaveRouteSheetProgress('dtHydroUnloadTime'); });

    $("#btnDryerLoad").click(function (){ SaveRouteSheetProgress('dtDryerLoadTime'); });

    $("#btnDryerUnload").click(function (){ SaveRouteSheetProgress('dtDryerUnloadTime'); });




</script>