@{
    ViewBag.Title = "Production Order(s)";
}

@model IEnumerable<ESimSol.BusinessObjects.DyeingOrder>
    
    <head>
        <title>Lab Dip Orders</title>      
    </head>

    <body>
        <div id="progressbarParent" style="width:100%;height:100%;margin:0 auto;text-align:center; margin-left: auto;margin-right: auto;left: 0;right: 0;z-index: 1;">
            <div style="margin: 0px auto;margin-top: 251px;text-align:center;width:390px;">
                <label style="font-size:18px;">Please wait</label>
                <div id="progressbar" style="width:100%;height:37px;"></div>
            </div>
        </div>
        <div class="menuMainCollectionTable" >
            <table id="tblDyeingOrder" title="DyeingOrder List" class="easyui-datagrid" fit="true" fitcolumn="true" rownumbers="true" pagination="true" singleselect="true" autorowheight="false" toolbar="#toolbarDyeingOrder" >
                <thead>
                    <tr>
                        <th field="OrderNoFull" width="12%">Dyeing Order No</th>
                        <th field="OrderDateSt" width="10%">Issue Date</th>
                        <th field="ContractorName" width="20%">Contractor</th>
                        <th field="DeliveryToName" width="15%">Delivered To</th>
                        <th field="SampleInvocieNo" width="10%">Invoice No</th>
                        <th field="ExportPINo" width="10%">P/I No</th>
                        <th field="DyeingOrderTypeSt" width="10%">OrderType</th>
                        <th field="MKTPName" width="10%">Concern Person</th>
                        <th field="StateSt" width="12%">Status</th>
                        
                    </tr>
                </thead>
            </table>

            <div id="toolbarDyeingOrder">
                <a href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-reload" plain="true" id="btnReload"></a>
                <input type="text" id="txtSearchByOrderNo" placeholder="Search DyeingOrder" style="width:15%;" />
                <a id="btnSearchLabDipReq" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-search" plain="true">Waiting For Lab Req</a>
                <a id="btnSearchWatingLabDip" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-search" plain="true">Waiting Lab Dip</a>
                <a id="btnAdvSearch" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-search" plain="true">Adv. Search</a>
                <a id="btnCreateLabdip" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-ok" plain="true">Request For LabDip</a>
                <a id="btnView" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-details" plain="true">View</a>
             </div>
        </div>
        <div id="winAdvSearch" class="easyui-window winClass" style="width:600px" title="Adv. Search" data-options="modal:true,closed:true,collapsible:false,minimizable:false,maximizable:false,closable:false">
            <table style="width:100%;">
                <tr>
                    <td>
                        <fieldset style="margin-bottom: 0px;">
                            <legend>Searching Criteria</legend>
                            <table>
                                <tr>
                                    <td style=" width:20%;text-align:right;">
                                        <label>Issue To </label>
                                    </td>
                                    <td colspan="3" style=" width:80%;text-align:left;">
                                        <input id="txtContractorAdvS" style="width:75%;" type="text" placeholder="Type & Press Enter" />
                                        <a id="btnPickContractorAdvS" href="javascript:void(0)" class="easyui-linkbutton ics-pick" iconcls="icon-pick" plain="true"></a>
                                        <a id="btnClrContractorAdvS" href="javascript:void(0)" class="easyui-linkbutton ics-pick" iconcls="icon-clear" plain="true"></a>

                                    </td>
                                </tr>
                                <tr>
                                    <td style=" width:20%;text-align:right;">
                                        <label>Deliver To </label>
                                    </td>
                                    <td colspan="3" style=" width:80%;text-align:left;">
                                        <input id="txtDeliverToAdvS" style="width:75%;" type="text" placeholder="Type & Press Enter" />
                                        <a id="btnPickDeliverToAdvS" href="javascript:void(0)" class="easyui-linkbutton ics-pick" iconcls="icon-pick" plain="true"></a>
                                        <a id="btnClrDeliverToAdvS" href="javascript:void(0)" class="easyui-linkbutton ics-pick" iconcls="icon-clear" plain="true"></a>
                                    </td>
                                </tr>
                                <tr>
                                    <td style=" width:20%;text-align:right;">
                                        <label>Yarn </label>
                                    </td>
                                    <td colspan="3" style=" width:80%;text-align:left;">
                                        <input id="txtProductName" style="width:75%;" type="text" placeholder="Type & Press Enter" />
                                        <a id="btnProductPiker" href="javascript:void(0)" class="easyui-linkbutton ics-pick" iconcls="icon-pick" plain="true"></a>
                                        <a id="btnClrProductPiker" href="javascript:void(0)" class="easyui-linkbutton ics-pick" iconcls="icon-clear" plain="true"></a>
                                    </td>
                                </tr>
                                <tr>
                                    <td style=" width:20%;text-align:right;">
                                        <label>Order Date </label>
                                    </td>
                                    <td colspan="3">
                                        <select id="cboOrderDateAdvS" style="width:30%;" onchange="DateActionsOrderDateAdvSearch();"></select>
                                        <input id="txtFromOrderDateAdvSearch" type="text" style="width: 100px;" class="easyui-datebox" required="required" data-options="formatter:icsdateformat,parser:icsdateparser" />To
                                        <input id="txtToOrderDateAdvSearch" type="text" style="width: 100px;" class="easyui-datebox" required="required" data-options="formatter:icsdateformat,parser:icsdateparser" />
                                    </td>
                                </tr>
                                <tr>
                                    <td style=" width:20%;text-align:right;">
                                        <label>Invoice Date </label>
                                    </td>
                                    <td colspan="3">
                                        <select id="cboInvoiceDateAdvSearch" style="width:30%;" onchange=" DateActionsInvoiceDateAdvSearch(); "></select>
                                        <input id="txtFromInvoiceDateAdvSearch" type="text" style="width: 100px;" class="easyui-datebox" required="required" data-options="formatter:icsdateformat,parser:icsdateparser" />To
                                        <input id="txtToInvoiceDateAdvSearch" type="text" style="width: 100px;" class="easyui-datebox" required="required" data-options="formatter:icsdateformat,parser:icsdateparser" />
                                    </td>
                                </tr>
                                <tr>
                                    <td style=" width:20%;text-align:right;">
                                        <label>Delivery Date </label>
                                    </td>
                                    <td colspan="3">
                                        <select id="cboDeliveryDateAdvS" style="width:30%;" onchange=" DateActionsDeliveryDateAdvSearch(); "></select>
                                        <input id="txtFromDeliveryDateAdvSearch" type="text" style="width: 100px;" class="easyui-datebox" required="required" data-options="formatter:icsdateformat,parser:icsdateparser" />To
                                        <input id="txtToDeliveryDateAdvSearch" type="text" style="width: 100px;" class="easyui-datebox" required="required" data-options="formatter:icsdateformat,parser:icsdateparser" />
                                    </td>
                                </tr>

                                <tr>
                                    <td style=" width:20%;text-align:right;">
                                        <label>Payment Type </label>
                                    </td>
                                    <td style=" width:30%;text-align:left;">
                                        <select id="cboPaymentType" style="width: 100%;"></select>
                                    </td>
                                    <td style=" width:20%;text-align:right;">
                                        <label>Order Type </label>
                                    </td>
                                    <td style=" width:30%;text-align:left;">
                                        <select id="cboOrderType" style="width: 100%;"></select>
                                    </td>
                                </tr>
                                @*<tr>
                                    <td style=" width:20%;text-align:right;">
                                        <label>Bank :</label>
                                    </td>
                                    <td colspan="3">
                                        <select id="cboPIBankAdvSearch" style="width:100%;"></select>
                                    </td>
                                </tr>*@
                                <tr>
                                    <td style=" width:20%;text-align:right;">
                                        <label>Concern Person </label>
                                    </td>
                                    <td colspan="3" style=" width:80%;text-align:left;">
                                        <select id="cboMkPersonAdvSearch" style="width:100%;"></select>
                                    </td>
                                </tr>



                                <tr>
                                    <td style=" width:20%;text-align:right;">
                                        <label>Invoice No </label>
                                    </td>
                                    <td style=" width:30%;text-align:left;">
                                        <input id="txtInvoiceNo" type="text" style="width:100%" />
                                    </td>
                                    <td style=" width:20%;text-align:right;">
                                        <label>P/I No </label>
                                    </td>
                                    <td style=" width:30%;text-align:left;">
                                        <input id="txtPINo" type="text" style="width:95%" />
                                    </td>
                                </tr>
                                <tr>
                                    <td style=" width:20%;text-align:right;">
                                        <label>Style No </label>
                                    </td>
                                    <td style=" width:30%;text-align:left;">
                                        <input id="txtStyleNoAdvS" type="text" style="width:100%" />
                                    </td>
                                    <td style=" width:20%;text-align:right;">
                                        <label>Ref No </label>
                                    </td>
                                    <td style=" width:30%;text-align:left;">
                                        <input id="txtRefNoAdvS" type="text" style="width:95%" />
                                    </td>
                                </tr>


                                <tr>
                                    <td style="text-align:right;"></td>
                                    <td>
                                        <input id="chkYetNotSendLabReq" type="checkbox" style="width:5%;" />
                                        <label>Pending LabDip </label>
                                    </td>
                                    <td colspan="2" style="text-align:right;">
                                        <input id="chkYetNotSendPro" type="checkbox" style="width:5%;" />
                                        <label>Yet not Send Production</label>
                                    </td>
                                </tr>
                                <tr>
                                    <td height="5px" colspan="4"></td>
                                </tr>
                                @*<tr>
                                    <td class="btnResetSearch" colspan="4">
                                        <a id="btnSearchAdvSearch" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-search" plain="true">Search</a>
                                        <a id="btnResetAdvSearch" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-reload" plain="true">Reset</a>
                                    </td>
                                </tr>*@
                            </table>
                        </fieldset>
                    </td>
                </tr>
            </table>

            <fieldset class="actionfieldsetstyle">
                <legend>Actions : </legend>
                <label class="lblLoadingMessage" style="float: left;">Loading Please Wait...</label>
                <a id="btnResetAdvSearch" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-reload" plain="true">Reset</a>
                <a id="btnSearchAdvSearch" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-search" plain="true">Search</a>
                <a id="btnCloseAdvSearch" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-cancel" plain="true">Close</a>
            </fieldset>
        </div>
    </body>

    <style>
        #progressbarParent {
            opacity: 0.8;
            background-color: #DCD9D4;
            position: fixed;
            width: 100%;
            height: 100%;
            top: 0px;
            left: 0px;
            z-index: 1000;
        }
    </style>
    <script type="text/javascript">
        var _sBaseAddress="";
        var _oDyeingOrders=[];
        var _sMessage='';
        var _nNextStatus=-1;
        var _sMenuID=0;
        var _nBUID = 0;
        var _sContractorIds = '';
        var _sProductIds = '';
        var _sDeliverToIDs = '';
        var _oPaymentTypes=[];
        var _oOrderTypes=[];

        $(document).ready(function () {
            _sBaseAddress = @Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(HttpContext.Current.Session[SessionInfo.BaseAddress]));
            _oDyeingOrders =@Html.Raw( new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(Model));
            _sMenuID =@Html.Raw( new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(HttpContext.Current.Session[SessionInfo.MenuID]));
            _nBUID = @Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(ViewBag.BUID));
            _oCompareOperators = @Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(ViewBag.CompareOperators));
            _oMktPersons = @Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(ViewBag.MktPersons));
            _oPaymentTypes = @Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(ViewBag.PaymentTypes));
            _oOrderTypes = @Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(ViewBag.OrderTypes));

            if(sessionStorage.getItem("DyeingOrders")!=null && sessionStorage.getItem("DyeingOrders").length>0){
                _oDyeingOrders= jQuery.parseJSON(sessionStorage.getItem('DyeingOrders'));
                var nIndex= sessionStorage.getItem('SelectedRowIndex');
                DynamicRefreshList(_oDyeingOrders, 'tblDyeingOrder');
                if(nIndex>-1){
                    $('#tblDyeingOrder').datagrid('selectRow',nIndex);
                }
            }
            else{
                DynamicRefreshList(_oDyeingOrders, 'tblDyeingOrder');
            }
          
            $("#progressbar").progressbar({ value: 0 });
            $("#progressbarParent").hide();
            $(".lblLoadingMessage").hide();
            LoadComboAdv();
        });
        
        $(document).keydown(function (e) { if (e.keyCode == 27) { $('#winDyeingOrderOrder').icsWindow('close'); } });
       
        function updateProgress() {   
            var value =$('#progressbar').progressbar('getValue');
            if (value < 90){
                value += Math.floor(Math.random() * 15);
                $('#progressbar').progressbar('setValue', value);
            }
        }

        function hideShow(miliseconds) {
            $("#progressbarParent").hide();
        }

        $("#btnSearchLabDipReq").click(function () {

            var oDyeingOrder={
                DyeingOrderID:0
            }

            var obj =
            {
                BaseAddress: _sBaseAddress,
                Object: oDyeingOrder,
                ControllerName: "DyeingOrder",
                ActionName: "DOPendingLabDipReq",
                IsWinClose: false
            };

            $.icsDataGets(obj, function (response) {

                if (response.status && response.objs != null) {
                    if (response.objs.length > 0) {
                        if(response.objs[0].DyeingOrderID>0){
                            DynamicRefreshList(response.objs, "tblDyeingOrder");
                        }
                        else
                        {
                            DynamicRefreshList([], "tblDyeingOrder");
                            alert(response.objs[0].ErrorMessage);
                        }
                    }
                    else {  DynamicRefreshList([], "tblDyeingOrder");  alert("No dyeing order found to create labdip."); }
                }
            });
         

        });
      
        $("#btnSearchWatingLabDip").click(function () {

            var oDyeingOrder={
                DyeingOrderID:0
            }

            var obj =
            {
                BaseAddress: _sBaseAddress,
                Object: oDyeingOrder,
                ControllerName: "DyeingOrder",
                ActionName: "DOPendingLabDipDone",
                IsWinClose: false
            };

            $.icsDataGets(obj, function (response) {

                if (response.status && response.objs != null) {
                    if (response.objs.length > 0) {
                        if(response.objs[0].DyeingOrderID>0){
                            DynamicRefreshList(response.objs, "tblDyeingOrder");
                        }
                        else
                        {
                            DynamicRefreshList([], "tblDyeingOrder");
                            alert(response.objs[0].ErrorMessage);
                        }
                    }
                    else { DynamicRefreshList([], "tblDyeingOrder");  alert("No dyeing order found for waiting labdip."); }
                }
            });        

        });
     

        $('#btnView').click(function (e)
        {
            var oDyeingOrder = $('#tblDyeingOrder').datagrid('getSelected');
            if (oDyeingOrder ==null || oDyeingOrder.DyeingOrderID <=0 ) { alert("Please select an item from list."); return ; }

            var nIndex=$('#tblDyeingOrder').datagrid('getRowIndex',oDyeingOrder);

            sessionStorage.clear();
            sessionStorage.setItem("Operation", "View");
            sessionStorage.setItem("SelectedRowIndex", nIndex);
            sessionStorage.setItem("LapdipHeader", "View Production");
            sessionStorage.setItem("DyeingOrders", JSON.stringify($('#tblDyeingOrder').datagrid('getRows')));
            sessionStorage.setItem("BackLink", window.location.href);
            var tsv=((new Date()).getTime())/1000;
            window.location.href = _sBaseAddress+ "/DyeingOrder/ViewDyeingOrder?nId="+oDyeingOrder.DyeingOrderID+"&ts="+tsv;;
        });
    
        $('#btnCreateLabdip').click(function (e)
        {
            var oDyeingOrder = $('#tblDyeingOrder').datagrid('getSelected');
            if (oDyeingOrder ==null || oDyeingOrder.DyeingOrderID <=0 ) { alert("Please select an item from list."); return ; }

            var obj = {
                BaseAddress: _sBaseAddress,
                Object: oDyeingOrder,
                ObjectId: oDyeingOrder.DyeingOrderID,
                ControllerName: "DyeingOrder",
                ActionName: "SaveLabdipByDO",
                TableId: "",
                IsWinClose: false,
                Message: ""
            };
            $.icsSave(obj, function (response) {
                if (response.status && response.obj != null) {
                    debugger
                    if (response.obj.LabDipID > 0) {
                        alert("Request Send Successfully.");
                    }
                    else{
                        alert(response.obj.ErrorMessage);
                    }
                }
            });

        });

        $("#btnReload").click(function() {
            window.location.href = _sBaseAddress+ '/DyeingOrder/ViewDyeingOrdersLadDipPending?'+"buid="+_nBUID+"&menuid="+_sMenuID; ;
        });
        ////Start adv Searching

        function updateProgress() {
            var value =$('#progressbar').progressbar('getValue');
            if (value < 96){
                value += Math.floor(Math.random() * 10);
                $('#progressbar').progressbar('setValue', value);
            }
        }
        function hideShow(miliseconds) {
            $("#progressbarParent").hide();
        }
        //Account Of Picker

        $("#txtContractorAdvS").keydown(function (e) {
            if (e.keyCode === 13) // Enter Press
            {
                PickContractors_AdvS();
            }
            else if (e.keyCode === 08) {
                $("#txtContractorAdvS").removeClass("fontColorOfPickItem");
                _sContractorIds = '';
            }
        });

        $("#btnClrContractorAdvS").click(function () {
            $("#txtContractorAdvS").removeClass("fontColorOfPickItem");
            $("#txtContractorAdvS").val("");
            _sContractorIds = '';
        });

        $("#btnPickContractorAdvS").click(function () {
            PickContractors_AdvS();
        });
        $("#txtSearchByAccountNamePickerAdvSearch").keydown(function (e) {
            var obj = {
                Event: e,
                SearchProperty: "Name",
                GlobalObjectList: _oAccountsOf,
                TableId: "tblAccountsPickerAdvSearch"
            };
            $('#txtSearchByAccountNamePickerAdvSearch').icsSearchByText(obj);
        });
        //End Account Of Picker
        $("#txtDeliverToAdvS").keydown(function (e) {
            if (e.keyCode === 13) // Enter Press
            {
                PickDeliverTo_AdvS();
            }
            else if (e.keyCode === 08) {
                $("#txtDeliverToAdvS").removeClass("fontColorOfPickItem");
                _sDeliverToIDs ="";
            }
        });

        $("#btnClrDeliverToAdvS").click(function () {
            $("#txtDeliverToAdvS").removeClass("fontColorOfPickItem");
            $("#txtDeliverToAdvS").val("");
            _sDeliverToIDs ="";
        });

        $("#btnPickDeliverToAdvS").click(function () {
            PickDeliverTo_AdvS();
        });

        //Product Pick
        $("#txtProductName").keydown(function (e) {
            debugger;
            var code = (e.keyCode ? e.keyCode : e.which);
            if (code == 13) // Enter Press
            {
                if($('#txtProductName').val()==null || $('#txtProductName').val()=="")
                {
                    alert("Please Type Product and Press Enter.");
                    $('#txtProductName').focus();
                    return;
                }
                PickProduct($('#txtProductName').val());
            }
            if (code == 8) //backspace=8
            {
                //debugger;
                $("#txtProductName").removeClass("fontColorOfPickItem");
                _sProductIds= [];
            }
        });
        $("#btnProductPiker").click(function () {
            PickProduct("");
        });
        $("#btnClrProductPiker").click(function () {
            $("#txtProductName").val('');
            $("#txtProductName").removeClass("fontColorOfPickItem");
            _sProductIds= [];
        });
        function PickProduct(sProductName)
        {
            var oProduct = { BUID:sessionStorage.getItem("BUID"),ProductName:sProductName};
            var obj = {
                BaseAddress: _sBaseAddress,
                Object: oProduct,
                ControllerName: "Product",
                ActionName: "SearchByProductBUWise",
                IsWinClose: false
            };
            $.icsDataGets(obj, function (response) {
                debugger;
                if (response.status && response.objs.length > 0) {
                    if (response.objs[0].ProductID > 0) {
                        var tblColums = [];
                        var oColumn = { field: "ProductCode", title: "Code", width: 100, align: "left" }; tblColums.push(oColumn);
                        oColumn = { field: "ProductName", title: "Name", width: 300, align: "left" }; tblColums.push(oColumn);
                        oColumn = { field: "MUnit", title: "Unit", width: 70, align: "left" }; tblColums.push(oColumn);
                        var oPickerParam = {
                            winid: 'winProductPicker',
                            winclass: 'clsProductPicker',
                            winwidth: 600,
                            winheight: 460,
                            tableid: 'tblProductPicker',
                            tablecolumns: tblColums,
                            datalist: response.objs,
                            multiplereturn: true,
                            searchingbyfieldName: 'NameCode',
                            windowTittle: 'Product List'
                        };
                        $.icsPicker(oPickerParam);
                        IntializePickerbutton(oPickerParam);
                    }
                    else {
                        alert(response.objs[0].ErrorMessage);
                    }

                }else{
                    alert("Data Not Found.");
                }
            });
        }


        //End Buyer Search
        $("#btnResetAdvSearch").click(function () {
            ResetAdvSearchWindow();
            DateActionsOrderDateAdvSearch();
            DateActionsInvoiceDateAdvSearch();
            DateActionsDeliveryDateAdvSearch();
            DateActionsStatusDateAdvSearch();
        });

        $("#btnSearchAdvSearch").click(function () {
            debugger;

            $(".lblLoadingMessage").show();

            var checkDate = CheckFromAndToDateValidation("cboOrderDateAdvS", "txtFromOrderDateAdvSearch", "txtToOrderDateAdvSearch");
            if (!checkDate) {
                alert("Start date must be greater than end date.");
                return false;
            }
            checkDate = CheckFromAndToDateValidation("cboInvoiceDateAdvSearch", "txtFromOrderDateAdvSearch", "txtToInvoiceDateAdvSearch");
            if (!checkDate) {
                alert("Start date must be greater than end date.");
                return false;
            }
            checkDate = CheckFromAndToDateValidation("cboDeliveryDateAdvS", "txtFromDeliveryDateAdvSearch", "txtToDeliveryDateAdvSearch");
            if (!checkDate) {
                alert("Start date must be greater than end date.");
                return false;
            }


            //var nContractorID = parseInt(_sContractorIds);
            //var nBuyerID = parseInt(_sDeliverToIDs);
            var nCboOrderDate = parseInt($("#cboOrderDateAdvS").val());
            var dFromOrderDate = $('#txtFromOrderDateAdvSearch').datebox('getValue');
            var dToOrderDate = $('#txtToOrderDateAdvSearch').datebox('getValue');

            var ncboInvoiceDate = parseInt($("#cboInvoiceDateAdvSearch").val());
            var dFromInvoiceDate = $('#txtFromInvoiceDateAdvSearch').datebox('getValue');
            var dToInvoiceDate = $('#txtToInvoiceDateAdvSearch').datebox('getValue');

            var ncboDeliveryDate = parseInt($("#cboDeliveryDateAdvS").val());
            var dFromDeliveryDate = $('#txtFromDeliveryDateAdvSearch').datebox('getValue');
            var dToDeliveryDate = $('#txtToDeliveryDateAdvSearch').datebox('getValue');

            var ncboPaymentType = parseInt($("#cboPaymentType").val());
            var nCboMkPerson = parseInt($("#cboMkPersonAdvSearch").val());
            var nOrderType = parseInt($("#cboOrderType").val());

            var sPINo = $.trim($("#txtPINo").val());
            var sInvoiceNo = $.trim($("#txtInvoiceNo").val());
            var sStyleNo = $.trim($("#txtStyleNoAdvS").val());
            var sRefNo = $.trim($("#txtRefNoAdvS").val());

            var bYetNotSendLabReq = $("#chkYetNotSendLabReq").is(':checked');
            var bYetNotSendPro = $("#chkYetNotSendPro").is(':checked');

            var nOrderTypeFixec =0;

            var sParams = _sContractorIds + "~" +
                          _sDeliverToIDs + "~" +
                          nCboOrderDate + "~" +
                          dFromOrderDate + "~" +
                          dToOrderDate + "~" +
                          ncboInvoiceDate + "~" +
                          dFromInvoiceDate + "~" +
                          dToInvoiceDate + "~" +
                          ncboDeliveryDate + "~" +
                          dFromDeliveryDate + "~" +
                          dToDeliveryDate + "~" +
                          nCboMkPerson + "~" +
                          ncboPaymentType + "~" +
                          nOrderType + "~" +
                          sPINo+"~"+
                          sInvoiceNo+"~"+
                          sStyleNo+"~"+
                          sRefNo+"~"+
                           _sProductIds+"~"+
                          bYetNotSendLabReq + "~" +
                          bYetNotSendPro + "~" +
                          nOrderTypeFixec + "~" +
                          _nBUID;
            var oDyeingOrder = {
                Note : sParams
            };

            $.ajax({
                type: "POST",
                dataType: "json",
                url: _sBaseAddress + "/DyeingOrder/AdvSearch",
                traditional: true,
                data: JSON.stringify(oDyeingOrder),
                contentType: "application/json; charset=utf-8",
                success: function (data) {
                    var oDyeingOrders = jQuery.parseJSON(data);
                    debugger;
                    if (oDyeingOrders != null) {
                        if (oDyeingOrders.length > 0)
                        {

                            DynamicRefreshList(oDyeingOrders, "tblDyeingOrder");
                            $("#winAdvSearch").icsWindow("close");

                        }
                        else
                        {
                            alert("Sorry, No data found.");
                            DynamicRefreshList([], "tblDyeingOrder");
                        }

                    } else {
                        alert("Sorry, No data found.");
                        DynamicRefreshList([], "tblDyeingOrder");
                    }
                    $(".lblLoadingMessage").hide();
                }
            });
        });

        function LoadComboAdv()
        {
            $("#cboOrderType").icsLoadCombo({
                List: _oOrderTypes,
                OptionValue: "id",
                DisplayText: "Value"
            });
            $("#cboPaymentType").icsLoadCombo({
                List: _oPaymentTypes,
                OptionValue: "Value",
                DisplayText: "Text"
            });
            $("#cboOrderDateAdvS, #cboInvoiceDateAdvSearch, #cboDeliveryDateAdvS").icsLoadCombo({
                List: _oCompareOperators,
                OptionValue: "id",
                DisplayText: "Value"
            });
            $("#cboMkPersonAdvSearch").icsLoadCombo({
                List: _oMktPersons,
                OptionValue: "MarketingAccountID",
                DisplayText: "Name"
            });
        }
        function CheckFromAndToDateValidation(OperationComboId, FromDateId, ToDateId) {
            $("#" + OperationComboId).parent().parent().parent().find("select").removeClass("errorFieldBorder");
            var nCboVal = $("#" + OperationComboId).val();
            if (parseInt(nCboVal) == 5 || parseInt(nCboVal) == 6) {
                var fromDate = $("#" + FromDateId).datebox("getValue");
                var toDate = $("#" + ToDateId).datebox("getValue");
                if (new Date(fromDate) > new Date(toDate)) {
                    $("#" + ToDateId).focus();
                    $("#" + OperationComboId).addClass("errorFieldBorder");
                    $(".lblLoadingMessage").hide();
                    return false;
                } else {
                    $("#" + OperationComboId).removeClass("errorFieldBorder");
                    return true;
                }
            } else {
                return true;
            }
        }

        function ResetAdvSearchWindow() {
            _sContractorIds = '';
            _sDeliverToIDs = "";
            $("#winAdvSearch input").not("input[type='button']").val("");
            $("#winAdvSearch input").removeClass("fontColorOfPickItem");
            $("#winAdvSearch select").val(0);
            DateActionsOrderDateAdvSearch();
            DateActionsInvoiceDateAdvSearch();
            DateActionsDeliveryDateAdvSearch();
            $("#txtFromOrderDateAdvSearch,#txtToOrderDateAdvSearch,#txtFromInvoiceDateAdvSearch,#txtToInvoiceDateAdvSearch,#txtFromDeliveryDateAdvSearch,#txtToDeliveryDateAdvSearch").datebox({ disabled: true });
            $("#txtFromOrderDateAdvSearch,#txtToOrderDateAdvSearch,#txtFromInvoiceDateAdvSearch,#txtToInvoiceDateAdvSearch,#txtFromDeliveryDateAdvSearch,#txtToDeliveryDateAdvSearch").datebox("setValue", icsdateformat(new Date()));
        }

        function PickContractors_AdvS() {
            var oContractor = {
                Params: '2,3' + '~' + $.trim($("#txtContractorAdvS").val()+"~"+_nBUID)
            };
            var obj = {
                BaseAddress: _sBaseAddress,
                Object: oContractor,
                ControllerName: "Contractor",
                ActionName: "ContractorSearchByNameType",
                IsWinClose: false
            };

            $("#progressbar").progressbar({ value: 0 });
            $("#progressbarParent").show();
            var intervalID = setInterval(updateProgress, 250);

            DynamicRefreshList([], "tblAccountsPickerAdvSearch");
            $.icsDataGets(obj, function (response) {
                clearInterval(intervalID);
                $("#progressbarParent").hide();
                if (response.status && response.objs.length > 0) {
                    if (response.objs[0].ContractorID > 0) {
                        var tblColums = []; var oColumn = { field: "ContractorID", title: "Code", width: 50, align: "left" }; tblColums.push(oColumn);
                        oColumn = { field: "Name", title: "Name", width: 280, align: "left" }; tblColums.push(oColumn);

                        var oPickerParam = {
                            winid: 'winContractorPicker',
                            winclass: 'clsAccountOf',
                            winwidth: 400,
                            winheight: 460,
                            tableid: 'tblAccountOfs',
                            tablecolumns: tblColums,
                            datalist: response.objs,
                            multiplereturn: true,
                            searchingbyfieldName: 'Name',
                            windowTittle: 'Contactor List'
                        };
                        $.icsPicker(oPickerParam);
                        IntializePickerbutton(oPickerParam);
                    }
                    else {
                        alert(response.objs[0].ErrorMessage);
                    }
                }
                else {
                    alert("Sorry, No Contactor Found.");
                }
            });
        }

        function PickDeliverTo_AdvS() {
            var oContractor = {
                Params: '2' + '~' + $.trim($("#txtDeliverToAdvS").val()+"~"+_nBUID)
            };
            var obj = {
                BaseAddress: _sBaseAddress,
                Object: oContractor,
                ControllerName: "Contractor",
                ActionName: "ContractorSearchByNameType",
                IsWinClose: false
            };
            $("#progressbar").progressbar({ value: 0 });
            $("#progressbarParent").show();
            var intervalID = setInterval(updateProgress, 250);
            DynamicRefreshList([], "tblContractorsPickerAdvSearch");
            $.icsDataGets(obj, function (response) {
                clearInterval(intervalID);
                $("#progressbarParent").hide();
                if (response.status && response.objs.length > 0) {
                    if (response.objs[0].ContractorID > 0) {
                        var tblColums = []; var oColumn = { field: "ContractorID", title: "Code", width: 50, align: "left" }; tblColums.push(oColumn);
                        oColumn = { field: "Name", title: "Name", width: 280, align: "left" }; tblColums.push(oColumn);
                        var oPickerParam = {
                            winid: 'winBuyers',
                            winclass: 'clsBuyer',
                            winwidth: 400,
                            winheight: 460,
                            tableid: 'tblBuyers',
                            tablecolumns: tblColums,
                            datalist: response.objs,
                            multiplereturn: true,
                            searchingbyfieldName: 'Name',
                            windowTittle: 'Buyer List'
                        };
                        $.icsPicker(oPickerParam);
                        IntializePickerbutton(oPickerParam);
                    }
                    else {
                        alert(response.objs[0].ErrorMessage);
                    }
                }
                else {
                    alert("Sorry, No Contactor Found.");
                }
            });
        }

        function DateActionsOrderDateAdvSearch() {
            DynamicDateActions("cboOrderDateAdvS", "txtFromOrderDateAdvSearch", "txtToOrderDateAdvSearch");
        }
        function DateActionsInvoiceDateAdvSearch() {
            DynamicDateActions("cboInvoiceDateAdvSearch", "txtFromInvoiceDateAdvSearch", "txtToInvoiceDateAdvSearch");
        }
        function DateActionsDeliveryDateAdvSearch() {
            DynamicDateActions("cboDeliveryDateAdvS", "txtFromDeliveryDateAdvSearch", "txtToDeliveryDateAdvSearch");
        }

        $("#btnCloseAdvSearch").click(function () {
            $("#winAdvSearch").icsWindow("close");
        });
        $("#btnAdvSearch").click(function () {
            debugger;
            $("#winAdvSearch").icsWindow("open", "Sample Order Advance Search");
            //DynamicRefreshList([], "tblExportPIAdvSearch");
            DynamicResetAdvSearchWindow("winAdvSearch");
            DynamicDateActions("cboDateOptionAdvSearch", "txtFromDateAdvSearch", "txtToDateAdvSearch");
            DynamicDateActions("cboInvoiceDateAdvSearch", "txtFromInvoiceDateAdvSearch", "txtToInvoiceDateAdvSearch");
            DynamicDateActions("cboDeliveryDateAdvS", "txtFromDeliveryDateAdvSearch", "txtToDeliveryDateAdvSearch");
            ResetAdvSearchWindow();
        });

        function IntializePickerbutton(oPickerobj) {
            $("#" + oPickerobj.winid).find("#btnOk").click(function () {
                SetPickerValueAssign(oPickerobj);
            });
            $(document).find('.' + oPickerobj.winclass).keydown(function (e) {
                if (e.which === 13) {
                    SetPickerValueAssign(oPickerobj);
                }
            });
        }

        function SetPickerValueAssign(oPickerobj) {
            var oreturnObj = null, oreturnObjs = [];
            if (oPickerobj.multiplereturn) {
                oreturnObjs = $('#' + oPickerobj.tableid).datagrid('getChecked');
            } else {
                oreturnObj = $('#' + oPickerobj.tableid).datagrid('getSelected');
            }

            if (oPickerobj.winid == 'winContractorPicker')
            {
                if (oreturnObjs != null && oreturnObjs.length> 0)
                {

                    _sContractorIds=''; var sMessage='';
                    sMessage=(oreturnObjs.length>1)? oreturnObjs.length +" Contractors Selected" : oreturnObjs[0].Name;
                    $('#txtContractorAdvS').val(sMessage);
                    $("#txtContractorAdvS").addClass("fontColorOfPickItem");

                    for(var i=0;i<oreturnObjs.length;i++){
                        _sContractorIds=_sContractorIds+oreturnObjs[i].ContractorID+',';
                    }
                    _sContractorIds=_sContractorIds.substring(0,_sContractorIds.length-1);

                }
                else
                {
                    alert("Please select a contractor.");
                    return false;
                }
            }

            else if (oPickerobj.winid == 'winBuyers') {
                if (oreturnObjs != null && oreturnObjs.length> 0)
                {
                    _sDeliverToIDs='';
                    var sMessage='';
                    sMessage=(oreturnObjs.length>1)? oreturnObjs.length +" Contractors Selected" : oreturnObjs[0].Name;
                    $('#txtDeliverToAdvS').val(sMessage);
                    $("#txtDeliverToAdvS").addClass("fontColorOfPickItem");

                    for(var i=0;i<oreturnObjs.length;i++){
                        _sDeliverToIDs=_sDeliverToIDs+oreturnObjs[i].ContractorID+',';
                    }
                    _sDeliverToIDs=_sDeliverToIDs.substring(0,_sDeliverToIDs.length-1);



                }
                else
                {
                    alert("Please select a buyer.");
                    return false;
                }
            }
            else if (oPickerobj.winid == 'winProductPicker')
            {
                if (oreturnObjs!= null && oreturnObjs.length> 0)
                {
                    _sProductIds=''; var sMessage='';
                    sMessage=(oreturnObjs.length>1)? oreturnObjs.length +" ProductName Selected" : oreturnObjs[0].ProductName;
                    $('#txtProductName').val(sMessage);
                    $("#txtProductName").addClass("fontColorOfPickItem");

                    for(var i=0;i<oreturnObjs.length;i++){
                        _sProductIds=_sProductIds+oreturnObjs[i].ProductID+',';
                    }
                    _sProductIds=_sProductIds.substring(0,_sProductIds.length-1);

                }
                else
                {
                    alert("Please select a Product.");
                    return false;
                }

            }
            $("#" + oPickerobj.winid).icsWindow("close");
            $("#" + oPickerobj.winid).remove();
        }
        /// end Adv Searching
        $("#txtSearchByOrderNo").keydown(function (e) {
            var nkeyCode = e.keyCode || e.which;
            if(nkeyCode==13){

                var oDyeingOrder= {

                    OrderNo: $.trim($("#txtSearchByOrderNo").val()),
                    SampleInvocieNo: ""
                };
                GetsOrders(oDyeingOrder);
            }
            else if(nkeyCode==8){
                $("#txtSearchByOrderNo").val("");

            }
        });
        function GetsOrders(oDyeingOrder)
        {
            $.ajax
              ({
                  type: "POST",
                  dataType: "json",
                  url : _sBaseAddress+"/DyeingOrder/GetsbyNo",
                  data:  JSON.stringify(oDyeingOrder),
                  contentType: "application/json; charset=utf-8",
                  success: function (data) {
                      //debugger;
                      var oDyeingOrders = jQuery.parseJSON(data);
                      if (oDyeingOrders.length>0)
                      {
                          DynamicRefreshList(oDyeingOrders, "tblDyeingOrder");
                      }
                      else
                      {
                          alert("Data Not found");
                          DynamicRefreshList([], "tblDyeingOrder");
                      }
                  },
                  error: function (xhr, status, error)
                  {
                      alert(error);
                  }
              });
        }
</script>
