<html>
<head>
    <title>Dyeing Order </title>
</head>
<body>

    @model ESimSol.BusinessObjects.DyeingOrder
    <div id="progressbarParent" style="width:100%;height:100%;margin:0 auto;text-align:center; margin-left: auto;margin-right: auto;left: 0;right: 0;z-index: 1;">
        <div style="margin: 0px auto;margin-top: 251px;text-align:center;width:390px;">
            <label style="font-size:18px;">Please wait</label>
            <div id="progressbar" style="width:100%;height:37px;"></div>
        </div>
    </div>
    <div class="menuMainCollectionTable">
        <div id="tabOrder" class="easyui-tabs" style="width:100%;">
            <div title="Order Info" style="width:100%;">

                <fieldset>
                    <legend> <label style="color:green" id="lblHeaderPIInfo">PI Info.:</label> </legend>
                    <table style="width:100%" cellpadding="2" cellspacing="2">

                        <tr>
                            <td style="width: 8%; text-align: right">
                                <label>P/I No</label>
                            </td>
                            <td colspan="3" style="width: 28%; text-align: left">
                                <input id="txtExportPINo" style="width: 70%" class="reset-text" placeholder="Search PI No" />
                                <a id="btnPickExportPI" href="javascript:void(0)" class="easyui-linkbutton ics-pick" iconcls="icon-pick" plain="true"></a>
                                <a id="btnResetExportPI" href="javascript:void(0)" class="easyui-linkbutton ics-pick" iconcls="icon-clear" plain="true"></a>
                            </td>
                            @*<td style="width: 8%; text-align: right">
                                <label>L/C No</label>
                            </td>
                            <td colspan="2" style="width: 20%; text-align: left">
                                <input id="txtExportLCNo" style="width: 99%" class="reset-text" placeholder="Search L/C No" />
                                <a id="btnPickExportLCNo" href="javascript:void(0)" class="easyui-linkbutton ics-pick" iconcls="icon-pick" plain="true"></a>
                                <a id="btnResetExportLCNo" href="javascript:void(0)" class="easyui-linkbutton ics-pick" iconcls="icon-clear" plain="true"></a>
                            </td>*@
                            <td style="width: 10%; text-align: right">
                                <label>Order No</label>
                            </td>
                            <td style="width: 8%; text-align: left">
                                <input id="txtOrderNo" class="reset-text" placeholder="19-0000" style="width: 60%" />
                                <select style="width: 18%;" id="cboReviseNo">
                                    <option value="0">0</option>
                                    <option value="1">1</option>
                                    <option value="2">2</option>
                                    <option value="3">3</option>
                                    
                                </select>
                                @*<input id="txtOrderNo" class="reset-text" placeholder="Auto Generate" style="width: 100%" readonly="readonly" />*@
                            </td>
                           
                            <td colspan="4" style="width: 42%; text-align: left">
                                <table style="width: 100%;">
                                    <tr>
                                        <td style="width: 5%; text-align: right">
                                            <label>Date</label>
                                        </td>
                                        <td style="width:10%;">
                                            <input id="dtOrderDate" type="text" class="easyui-datebox" style="width: 105px;" data-options="formatter:icsdateformat,parser:icsdateparser" />
                                        </td>
                                        <td id="trReviseDate" style="width:55%;">
                                            <label id="lblReviseDate">Rev.Date</label>
                                            <input id="dtReviseDate" type="text" class="easyui-datebox" style="width: 100px;" data-options="formatter:icsdateformat,parser:icsdateparser" />
                                        </td>
                                    </tr>
                                </table>
                                @*<input id="dtOrderDate" type="text" class="easyui-datebox" style="width: 105px;" data-options="formatter:icsdateformat,parser:icsdateparser" />*@
                            </td>
                           
                        </tr>
                        <tr>

                            <td style="width: 8%; text-align: right">
                                <label>PI Value($)</label>
                            </td>
                            <td style="width: 10%; text-align: right">
                                <input id="txtOrderValue" class="reset-text" style="width: 100%" disabled="disabled" />
                            </td>
                            <td style="width:10%; text-align: right">
                                <label>PI Qty(</label><span class="lblMUnitOne"></span>):
                            </td>
                            <td style="width: 8%; text-align: right">
                                <input id="txtOrderQty" class="reset-text" style="width: 100%" disabled="disabled" />
                            </td>

                            <td style="width: 10%; text-align: right">
                                <label>PO Qty(</label><span class="lblMUnitOne"></span>):
                            </td>
                            <td style="width: 8%; text-align: right">
                                <input id="txtTotalDOQty" class="reset-text" style="width: 100%" disabled="disabled" />
                            </td>
                            <td style="width: 12%; text-align: right">
                                <label>Yet To PO(</label><span class="lblMUnitOne"></span>):
                            </td>
                            <td style="width: 8%; text-align: right">
                                <input id="txtDOYetTo" class="reset-text" style="width: 100%" disabled="disabled" />
                            </td>

                            <td style="width: 10%; text-align: right">
                                <label>Con. Person</label>
                            </td>
                            <td  style="width: 12%; text-align: left">
                                <input id="txtMktAccount" class="reset-text" style="width: 100%" disabled="disabled" />
                            </td>
                        </tr>



                    </table>

                </fieldset>
                <fieldset>
                    <legend id="leOrderTwo" style="font-weight:bold">  Order entry: </legend>
                    <table cellpadding="2" cellspacing="2" style="width:100%">


                        <tr>
                            <td class="td-col-2 align-right">
                                <label>Account Of</label>
                            </td>
                            <td colspan="5" style="width: 45%; text-align: left">
                                <input id="txtIssueTo" class="reset-text" style="width: 90%;" placeholder=" search issue to" />
                                <a id="btnPickIssueTo" href="javascript:void(0)" class="easyui-linkbutton ics-pick" iconcls="icon-pick" plain="true"></a>
                                <a id="btnResetIssueTo" href="javascript:void(0)" class="easyui-linkbutton ics-pick" iconcls="icon-clear" plain="true"></a>
                            </td>
                            <td style="width: 15%; text-align: right">
                                <label>Buyer Concern Person</label>
                            </td>
                            <td style="width: 25%; text-align: left">
                                <select id="cboCPIssueTo" style="width:80%"></select>
                                <a href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-reload" plain="true" id="btnReLoad_CPIssueTo"></a>
                            </td>
                        </tr>

                        <tr>
                            <td class="td-col-2 align-right">
                                <label>Deliver To</label>
                            </td>
                            <td colspan="5" style="width: 45%; text-align: left">
                                <input id="txtDeliverTo" style="width: 90%;" class="reset-text" placeholder="Search Delivery To" />
                                <a id="btnPickDeliverTo" href="javascript:void(0)" class="easyui-linkbutton ics-pick" iconcls="icon-pick" plain="true"></a>
                                <a id="btnResetDeliverTo" href="javascript:void(0)" class="easyui-linkbutton ics-pick" iconcls="icon-clear" plain="true"></a>
                            </td>
                            <td style="width: 15%; text-align: right">
                                <label>Factory Concern Person</label>
                            </td>
                            <td style="width: 25%; text-align: left">

                                <select id="cboCPDeliverTo" style="width:80%"></select>
                                <a href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-reload" plain="true" id="btnReLoad_CPDeliverTo"></a>
                            </td>
                        </tr>
                    </table>
                    <table>
                        <tr>
                            <td class="td-col-2 align-right">

                                <label>Style No</label>
                            </td>
                            <td style="width: 10%; text-align: left">
                                <input id="txtStyleNo" class="reset-text" placeholder="Style No" />
                            </td>
                            <td style="width: 10%; text-align: right">
                                <label>Ref No</label>
                            </td>
                            <td style="width: 10%; text-align: left">
                                <input id="txtBuyerRef" class="reset-text" placeholder="Type Buyer Reference" />
                            </td>

                            <td style="width: 10%; text-align: right">
                                <label>Priority Level</label>
                            </td>
                            <td style="width: 10%; text-align: left">
                                <select id="cboPriorityLevel" style="width:100%"></select>
                            </td>

                            <td style="width: 10%; text-align: right">
                                <label>Light Source</label>
                            </td>
                            <td style="width: 10%; text-align: left">
                                <select id="cboLightSource" style="width:90%"></select>
                            </td>


                        </tr>
                        <tr>
                            <td class="td-col-2 align-right">

                                <label>Stripe Order</label>
                            </td>
                            <td style="width: 10%; text-align: left">
                                <input id="txtStripeOrder" class="reset-text" placeholder="" />
                            </td>


                            <td style="width: 10%; text-align: right">
                                <label>Gauge</label>
                            </td>
                            <td style="width: 10%; text-align: left">
                                <input id="txtGauge" class="reset-text" placeholder="" />
                            </td>

                            <td style="width: 10%; text-align: right">
                                <label>Knitting Style</label>
                            </td>
                            <td colspan="3" style="width:30%; text-align: left">
                                <input id="txtKnittingStyle" style="width:94%; text-align: left" class="reset-text" placeholder="" />
                            </td>
                        </tr>

                        <tr>
                            <td class="td-col-2 align-right">
                                <label>Note</label>
                            </td>
                            <td colspan="7" class="td-styler td-col-18 td-Note">
                                <input id="txtNote" class="reset-text" placeholder="Type Note" />
                            </td>
                        </tr>

                    </table>

                </fieldset>

                <fieldset>
                    <legend id="leOrderThree">Order Detail</legend>

                    <table id="tblDyeingOrderDetail" class="easyui-datagrid" style="height: 190px; width:100%;" fitcolumns="false" rownumbers="true" pagination="false" singleselect="true" autorowheight="false" toolbar="#toolbar">
                        <thead>
                            <tr>
                                <th field="ProductNameCode" width="18%" align="left">Yarn </th>
                                <th field="ColorNo" width="10%" align="left">Color No</th>
                                <th field="ColorName" width="10%" align="left">ColorName</th>
                                <th field="ShadeSt" width="10%" align="left">Shade</th>
                                <th field="LabDipTypeSt" width="10%" align="left">LabDip Type</th>
                                <th field="PantonNo" width="8%" align="left">Panton No</th>
                                <th field="Qty" width="10%" align="right" formatter="formatPrice">Qty(<label id="lblMUName"></label>)</th>
                                <th field="UnitPrice" width="10%" align="right" formatter="formatPrice">Unit Price($/<label id="lblMUName2"></label>)</th>
                                <th field="Amount" width="10%" align="right" formatter="formatPrice">Amount($)</th>
                                <th field="StatusSt" width="10%" align="left">Status</th>
                                <th field="Qty_Pro" width="6%" align="right" formatter="formatPrice">Qty(Pro)</th>
                                <th field="DOQty" width="6%" align="right" formatter="formatPrice">DO Qty</th>
                            </tr>
                        </thead>
                    </table>
                    <div id="toolbar">
                        <a id="btnAddDetail" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-add" plain="true">Add</a>
                        <a id="btnEditDetail" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-edit" plain="true">Edit</a>
                        <a id="btnRemoveDetail" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-remove" plain="true">Remove</a>
                    </div>
                    <table border="0" cellpadding="0" cellspacing="0" style="width:100%;">
                        <tr>
                            <td style="width:65%;  text-align:right;font-weight:bold;">Total:</td>
                            <td style="width:10%;  text-align:right;font-weight:bold;"><label id="lblTotalQty">0</label> </td>
                            <td style="width:5%;  text-align:right;font-weight:bold;"> </td>
                            <td style="width:10%; text-align:right; font-weight:bold;"><label id="lblTotalAmount"> </label> </td>
                            <td style="width:5%;  text-align:right;font-weight:bold;"> </td>
                        </tr>
                    </table>
                </fieldset>

                <fieldset>
                    <legend>Action</legend>
                    <div class="align-right">
                        <table border="0" cellpadding="0" cellspacing="0" style="width:100%;">

                            <tr>
                                <td style=" float:left;  width:5%; ">
                                    <a id="btnNew" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-add" plain="true">Save&New</a>

                                </td>
                                <td style=" float:left;  width:15%; ">
                                    <input id="chkIsPrintHistory" type="checkbox" checked="checked" />
                                    <a id="btnPrint" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-print" plain="true">Print</a>
                                </td>
                                <td style="width:80%;float:right; text-align:right">
                                    <label id="lblReviseNote">Remarks(Revise)</label> <input id="txtReviseNote" type="text" style="width:40%;" />
                                    <label id="lblCreateReviseNo">Create Revise No?</label> <input id="chkIsCreateReviseNo" type="checkbox" checked="checked" />
                                    <a id="btnSave" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-save" plain="true">Save</a>
                                    <a id="btnSave_Revise" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-save" plain="true">Save(Revise)</a>
                                    <a id="btnApprove" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-save" plain="true">Approve</a>
                                    <a id="btnCancel" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-cancel" plain="true">Cancel</a>
                                    <a id="btnClose" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-cancel" plain="true">Close</a>
                                </td>
                            </tr>

                        </table>

                    </div>

                </fieldset>
            </div>
            <div title="Specification">
                <div>
                    <fieldset>
                        <legend>Delivery Specification </legend>
                        <table style="width: 100%;height:25px; text-align: left">
                            <tr>
                                <td style="width:25%; text-align: left">
                                    Delivery Note(Place, Contract No etc):
                                </td>
                                <td style="width:70%; text-align: left">
                                    <input id="txtDeliveryZone" class="reset-text" placeholder="Place, Contract No etc." style="width:60%" />
                                    <a id="btnPickDeliveryZone" href="javascript:void(0)" class="easyui-linkbutton ics-pick" iconcls="icon-pick" plain="true"></a>
                                    <a id="btnReseDeliveryZone" href="javascript:void(0)" class="easyui-linkbutton ics-pick" iconcls="icon-clear" plain="true"></a>
 
                                </td>

                            </tr>
                            <tr>
                                <td style="width:25%; text-align: left">
                                   Master Buyer:
                                </td>
                                <td style="width:75%; text-align: left">
                                    <input id="txtBuyerMaster" class="reset-text" placeholder="Master Buyer Name." style="width:60%" />
                                    <a id="btnPickBuyerMaster" href="javascript:void(0)" class="easyui-linkbutton ics-pick" iconcls="icon-pick" plain="true"></a>
                                    <a id="btnReseBuyerMaster" href="javascript:void(0)" class="easyui-linkbutton ics-pick" iconcls="icon-clear" plain="true"></a>
                                </td>

                            </tr>
                        </table>
                    </fieldset>
                </div>
                <fieldset>
                    <legend>Color Combo </legend>
                    <table id="tblDUColorCombo" class="easyui-datagrid" style="height: 150px; width:100%;" fitcolumns="true" rownumbers="true" pagination="false" singleselect="true" autorowheight="false" toolbar="#Toolbar_BCombo">

                        <thead>
                            <tr>
                                <th field="ComboIDSt" width="25%" align="center">Combo</th>
                                <th field="ColorName" width="70%" align="center">ColorName</th>

                            </tr>
                        </thead>
                    </table>
                    <div id="Toolbar_BCombo" style=" height:25px;">
                        <a href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-reload" plain="true" id="btnReloadDUCCombo"></a>
                        <select style="width: 120px;" id="cboDUColorCombo">
                            <option value="0">-Select-</option>
                            <option value="1">First</option>
                            <option value="2">Second</option>
                            <option value="3">Third</option>
                            <option value="4">Fourth</option>
                            <option value="5">Fifth</option>
                            <option value="6">Sixth</option>
                            <option value="7">Seventh</option>
                            <option value="8">Eighth</option>
                            <option value="9">Ninth</option>
                            <option value="10">Tenth</option>

                        </select>
                        @*<a id="btnUpdatePType" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-edit" plain="true"></a>*@
                        <a id="btnAddDUColorCombo" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-pick" plain="true">Pick</a>
                        <a id="btnRemoveDUColorCombo" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-remove" plain="true">Remove</a>
                        @*<a id="btnRefreshDUColorCombo" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-reload" plain="true">Refresh</a>*@
                    </div>
                </fieldset>
                <fieldset>
                    <legend>Specification </legend>
                    <div title="Note(s)">
                        <table id="tblDONote_DO" class="easyui-datagrid" style="width:100%; height:190px" fitcolumns="true" rownumbers="true" pagination="false" singleselect="true" autorowheight="false" toolbar="#TCtoolbar" data-options="singleSelect: true, fitColumns:false,  rownumbers:true,pagination:false,autoRowHeight:false, onClickRow: onClickRowTC">
                            <thead>
                                <tr>
                                    <th field="OrderNote" width="80%" align="left" data-options="field:'OrderNote',editor:{type:'text',options:{precision:0}}"> Terms & Condition </th>
                                </tr>
                            </thead>
                        </table>
                        <div id="TCtoolbar" style=" height:25px;">
                            <a id="btnAddDONote" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-pick" onclick="PickDONote()" plain="true">Pick</a>
                            <a id="btnRemoveDONote" href="javascript:void(0)" class="easyui-linkbutton" onclick="RemoveDONote()" iconcls="icon-remove" plain="true">Remove</a>
                            <a id="btnRefreshDONote" href="javascript:void(0)" class="easyui-linkbutton" onclick="RefreshDONote()" iconcls="icon-reload" plain="true">Refresh</a>
                        </div>
                    </div>
                </fieldset>
                <fieldset class="actionfieldsetstyle">
                    <legend style="font-weight:bold;font-size:11px"> Action : </legend>
                    <table style="width:100%" border="0" cellspacing="2" cellpadding="2">
                        <tr>
                            <td style=" float:left;  width:40%;text-align:left"></td>
                            <td style="width:30%"></td>
                            <td style="width:30%;text-align:right">
                                <a id="btnSaveDONote" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-save" plain="true">Save</a>
                                <a id="btnCloseTwo" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-closed" plain="true">Close</a>
                            </td>
                        </tr>
                    </table>
                </fieldset>
            </div>
        </div>
    </div>
    <div id="winDyeingOrderDetail" class=" easyui-window winclass" title="Edit Payment info" data-options="modal:true,closed:true,collapsible:false,minimizable:false,maximizable:false,closable:false">
        <div>

            <fieldset>
                <table border="0" cellspacing="2" cellpadding="2" style="width:100%; font-size: 11px; font-weight: bold">

                    <tr>
                        <td style="width: 20%; text-align: right">
                            Yarn  :
                        </td>
                        <td colspan="3" style="width:80%">
                            <input id="txtProduct" class="reset-text" placeholder="Type & Press entry For Yarn" style="width: 85%" />
                            <a id="btnPickProduct" href="javascript:void(0)" class="easyui-linkbutton ics-pick" iconcls="icon-pick" plain="true"></a>
                            <a id="btnResetProduct" href="javascript:void(0)" class="easyui-linkbutton ics-pick" iconcls="icon-clear" plain="true"></a>
                        </td>

                    </tr>
                    <tr>
                        <td style="width: 20%; text-align: right">
                            <label>
                                Qty(
                            </label><span class="lblMUnitOne"></span>):
                        </td>

                        <td style="width: 30%; text-align: left">
                            <input type="text" style="width: 60%; text-align:right" id="txtQtyInOne" />
                        </td>
                        <td style="width: 20%; text-align: right">
                            <label>
                                Qty(
                            </label><span class="lblMUnitTwo"></span>):

                        </td>

                        <td style="width: 30%; text-align: left">

                            <input type="text" style="width: 60%; text-align:right" id="txtQtyInTwo" />

                        </td>

                    </tr>
                    <tr>
                        <td style="width: 20%; text-align: right">
                            <label>
                                Unit Price ($/
                            </label><span class="lblMUnitOne"></span>):

                        </td>

                        <td style="width:30%; text-align: left">

                            <input type="text" style="width: 60%; text-align:right" id="txtUnitPriceInOne" />

                        </td>
                        <td style="width: 20%; text-align: right">
                            <label>
                                Unit Price ($/
                            </label><span class="lblMUnitTwo"></span>):
                        </td>

                        <td style="width: 30%; text-align: left">

                            <input type="text" style="width: 60%; text-align:right" id="txtUnitPriceInTwo" />

                        </td>

                    </tr>

                </table>
            </fieldset>
            <fieldset>
                <table border="0" cellspacing="2" cellpadding="2" style="width:100%; font-size: 11px; font-weight: bold">
                    <tr>
                        <td style="width: 20%; text-align: right">Type</td>
                        <td style="width: 30%;">
                            @*<input type="checkbox" style="width: 40px; margin-left: -15px" id="checkTBA" /><span>TBA</span>
                                <input type="checkbox" style="width: 40px; margin-left: -10px" id="checkDTMABL" /><span>DTM/ABL</span>*@
                            <select id="cboLabDipType" style="width:50%" onchange="ChangeLabDipType()"></select>

                        </td>
                        <td style="width: 20%; text-align: right">
                            Shade
                        </td>
                        <td style="width: 30%;">
                            <select style="width: 63px;" id="cboShade">
                                <option value="0">NA</option>
                                <option value="1">A</option>
                                <option value="2">B</option>
                                <option value="3">C</option>
                                <option value="4">D</option>
                                <option value="5">E</option>
                                <option value="6">F</option>
                                <option value="7">G</option>
                                <option value="8">H</option>
                                <option value="9">I</option>
                                <option value="10">J</option>
                                <option value="11">K</option>
                                <option value="12">L</option>
                                <option value="13">M</option>
                                <option value="14">N</option>
                                <option value="15">O</option>

                            </select>
                            <input id="txtShade" type="text" style="width: 63px" disabled="disabled" />
                        </td>

                    </tr>
                    <tr>
                        <td style="width: 20%; text-align: right">
                            Color No
                        </td>
                        <td style="width: 30%;">
                            <input type="text" style="width: 80%;" id="txtColorNo" /><input type="button" style="width: 16%;"
                                                                                            value="Pic" id="btnColorNo" />
                        </td>
                        <td style="width: 20%; text-align: right">
                            Labdip No
                        </td>
                        <td style="width: 30%">
                            <input type="text" style="width: 80%;" id="txtLabdipNo" /><input type="button" style="width: 16%;"
                                                                                             value="Pic" id="btnLabdipNo" />


                        </td>
                    </tr>
                    <tr>
                        <td style="width: 20%; text-align: right">
                            Lot No
                        </td>
                        <td style="width: 30%">
                            <input type="text" style="width: 100%" id="txtApproveLotNo" />
                        </td>
                        <td style="width: 20%; text-align: right">
                            Color Name :
                        </td>
                        <td style="width: 30%">
                            <input type="text" disabled="disabled" style="width: 100%" id="txtColorName" />
                        </td>
                    </tr>
                    <tr>
                        <td style="width: 20%; text-align: right">
                            Dev. Product:
                        </td>
                        <td colspan="3" style="width: 80%">
                            <input type="text" style="width: 100%" id="txtColorDevProduct" disabled="disabled" />
                        </td>

                    </tr>
                    <tr>
                        <td style="width: 20%; text-align: right">
                            Hank/Cone:
                        </td>
                        <td style="width: 30%">
                            <select style="width: 100%;" id="cboHankorCone">
                            </select>
                        </td>
                        <td style="width: 20%; text-align: right">
                            Panton No :
                        </td>
                        <td style="width: 30%">
                            <input type="text" disabled="disabled" style="width: 100%" id="txtPantonNo" />
                        </td>
                    </tr>
                    <tr>
                        <td style="width: 20%; text-align: right">
                            NoOfCone(Warp) :
                        </td>
                        <td style="width: 30%">
                            <input type="text" style="width: 100%" id="txtNoOfCone" />
                        </td>
                        <td style="width: 20%; text-align: right">
                            LengthOfCone(Warp) :
                        </td>
                        <td style="width: 30%">
                            <input type="text" style="width: 100%" id="txtLengthOfCone" />
                        </td>
                    </tr>
                    <tr>
                        <td style="width: 20%; text-align: right">
                            NoOfCone(Weft) :
                        </td>
                        <td style="width: 30%">
                            <input type="text" style="width: 100%" id="txtNoOfCone_Weft" />
                        </td>
                        <td style="width: 20%; text-align: right">
                            Buyer Combo :
                        </td>
                        <td style="width: 30%">
                            @*<input type="text" style="width: 100%" id="txtBuyerCombo" />*@
                            <input id="txtBuyerCombo" type="number" min="0" pattern="^[0-9]" step="1" class="only-number" style="width: 70%" />
                        </td>
                    </tr>
                    <tr>
                        <td style="width: 20%; text-align: right">
                            Note :
                        </td>
                        <td style="width: 30%">
                            <input type="text" id="txtNoteDetail" style="width: 100%;" />
                        </td>
                        <td style="width: 20%; text-align: right">
                            Delivery Date :
                        </td>
                        <td style="width: 30%">
                            <input type="text" class="easyui-datebox" style="width: 100%;" data-options="formatter:icsdateformat,parser:icsdateparser"
                                   id="txtDeliveryDate" />
                        </td>
                    </tr>
                </table>


            </fieldset>
            <div style="width:100%;">
                <fieldset>
                    <legend style="font-weight: bold">Action : </legend>
                    <table border="0" cellspacing="2" cellpadding="2" style="font-size: 11px; font-weight: bold; width:100%">
                        <tr>
                            <td style="width:80%; text-align:right"></td>
                            <td style="width: 10%">
                                <a id="btnSave_DODetail" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-save" plain="true">Ok</a>
                            </td>
                            <td style="width: 10%">
                                <a id="btnClose_DODetail" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-cancel" plain="true">Close</a>
                            </td>
                        </tr>
                    </table>
                </fieldset>
            </div>
        </div>
    </div>
    <div id="winDONote" style="width:70%; text-align:center;" class="easyui-window winstyle" title="Specification orTerms And Condition Picker" data-options="modal:true,closed:true,collapsible:false,minimizable:false,maximizable:false,closable:false">
        <div style="width:100%; text-align:left;">
            <input type="text" id="txtDONote" placeholder="Search By Name" style="width:350px; text-align:left;" />&nbsp;&nbsp;&nbsp;
            <table id="tblDONote" title="" class="easyui-datagrid" style="height:300px; " fitcolumns="true" rownumbers="true" pagination="false" singleselect="false" autorowheight="false">
                <thead>
                    <tr>
                        <th data-options="field:'Selected',checkbox:true"></th>
                        <th field="OrderNote" width="80%">Clause</th>
                    </tr>
                </thead>
            </table>
        </div>

        <fieldset class="actionfieldsetstyle">
            <legend>Actions : </legend>
            <a id="btnOkDyeingOrderNote" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-ok" plain="true">Ok</a>
            <a id="btnCloseDONote" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-cancel" plain="true">Close</a>
        </fieldset>
    </div>
    <div id="winDeliveryZone" style="width:500px;" class="easyui-window" title="Order" data-options="modal:true,closed:true,collapsible:false,minimizable:false,maximizable:false,closable:false">
        <div>
            <fieldset>
                <legend style="font-weight:bold"> Delivery Place/Zone/Contrct No: </legend>
                <table border="0" cellspacing="2" cellpadding="2" style="width:100%; font-size:11px; font-weight:bold">

                    <tr>
                        <td style="width:30%;text-align:right">
                            Delivery info:
                        </td>

                        <td style="width:70%">
                            <input id="txtDeliveryZoneNew" type="text" style="width:100%" />
                        </td>

                    </tr>


                </table>
            </fieldset>
        </div>
        <fieldset>
            <legend style="font-weight:bold"> Action : </legend>
            <table border="0" cellspacing="2" cellpadding="2" style="width:100%; font-size:11px; font-weight:bold;">
                <tr>
                    <td style="width:100%;text-align:right;">
                        <a id="btnSaveDeliveryZone" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-save" plain="true">Save</a>
                        <a id="btnCloseDeliveryZone" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-cancel" plain="true">Close</a>
                    </td>

                </tr>
            </table>
        </fieldset>
    </div>
</body>
</html>

<style type="text/css">
    .td-styler input {
        padding-left: 5px;
    }

    .td-styler select {
        padding-left: 5px;
    }

    .td-col-3 select {
        width: 95%;
    }

    .td-col-3 input {
        width: 92%;
    }

    .td-col-6 input {
        width: 70%;
    }

    .td-col-14 input {
        width: 86%;
    }

    .send-to .td-col-14 input {
        width: 85.7%;
    }


    .hp-ph .td-col-8 input {
        width: 66%;
    }

    .hp-ph .td-col-8 select {
        width: 96%;
    }

    .td-Note input {
        width: 97.5%;
    }

    .td-col-14 select {
        width: 15%;
    }

    .td-product input {
        width: 60%;
    }

    .number-combo input {
        width: 10%;
    }

    .td-KnitPly select {
        width: 95%;
    }

    .td-ColorName input, .td-RGB input {
        width: 90%;
    }

    .td-PantonNo-Ref input {
        width: 40%;
    }
</style>

<script type="text/javascript">

    var _sBaseAddress = "";
    var _oDyeingOrder=null;
    var _nMktAccountID=0;
    var _nContractorID=0;
    var _nDeliveryToID=0;
    var _nProductID=0;
    var _nExportSCDetailID=0;
    var _bIsIssueTo=true;
    var _oCPIssueTos=[];
    var _oCPDeliveryTos=[];
    var _oPaymentTypes=[];
    var _oLightSources=[];
    var _oPriorityLevels=[];
    var _oIsAdd=false;
    var _nLabDipDetailID=0;
    var _nDyeingOrderDetailID=0;
    var _nExportLCID=0;
    var _nSelectedRowIndex=0;
    var _sBackLink="";
    var _oMUnitCon=null;
    var _nBUID=0;

    $(document).ready(function () {

        _sBaseAddress =@Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(HttpContext.Current.Session[SessionInfo.BaseAddress]));
        var oDyeingOrder =@Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(Model));
        _oCPIssueTos =@Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(@ViewBag.CPIssueTos));
        _oCPDeliveryTos =@Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(@ViewBag.CPDeliveryTos));
        var oLightSources=@Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(@ViewBag.LightSources));
        var oPriorityLevels =@Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(@ViewBag.EnumPriorityLevels));
        var oDUOrderSetup =@Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(@ViewBag.DUOrderSetup));
        var oPaymentTypes =@Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(@ViewBag.PaymentTypes));
        var oLabDipTypeObj =@Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(@ViewBag.LabDipTypeObj));
        var oDyeingTypes =@Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(@ViewBag.DyeingTypes));
        var oDyeingTypes =@Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(@ViewBag.DyeingTypes));
        _oMUnitCon =@Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(@ViewBag.MeasurementUnitCon));
        var oBU =@Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(@ViewBag.BU));
        var oDyeingOrderNotes =@Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(@ViewBag.DyeingOrderNotes));
      
        debugger;

        $("#cboHankorCone").icsLoadCombo({
            List: oDyeingTypes,
            OptionValue: "DyeingType",
            DisplayText: "Name",
        });

        $("#cboLightSource").icsLoadCombo({
            List: oLightSources,
            OptionValue: "LightSourceID",
            DisplayText: "Descriptions",
            InitialValue:""
        });
        $("#cboPriorityLevel").icsLoadCombo({
            List: oPriorityLevels,
            OptionValue: "Value",
            DisplayText: "Text",
            InitialValue:""
        });
        $("#cboLabDipType").icsLoadCombo({
            List: oLabDipTypeObj,
            OptionValue: "id",
            DisplayText: "Value",
            InitialValue:"Select"
        });

        Initialization(oDyeingOrder,((sessionStorage.length>0)?sessionStorage.getItem('Operation'):'New'));
        if(oDyeingOrderNotes!=null)
        {
            DynamicRefreshList(oDyeingOrderNotes, 'tblDONote_DO');
        }
        _sBackLink=sessionStorage.getItem("BackLink");
        $('#txtUnitPriceInOne').val(0);
        $("#progressbar").progressbar({ value: 0 });
        $("#progressbarParent").hide();
        document.getElementById('leOrderTwo').innerHTML = oDUOrderSetup.OrderName;
        document.getElementById('leOrderThree').innerHTML = oDUOrderSetup.OrderName+" Detail";
        $(".lblMUnitOne").html(_oMUnitCon.FromMUnit);
        $(".lblMUnitTwo").html(_oMUnitCon.ToMUnit);
        $(".lblBUName").html(" "+oBU.ShortName);
        $('#lblMUName,#lblMUName2').html(oDUOrderSetup.MUName);
        _nBUID=oBU.BusinessUnitID;
        Control_disabled();
        if(_oDyeingOrder.DyeingOrderID>0)
        {
            GetsDUCCombo(_oDyeingOrder);
        }
    });
    function updateProgress() {
        var value =$('#progressbar').progressbar('getValue');
        if (value < 96){
            value += Math.floor(Math.random() * 10);
            $('#progressbar').progressbar('setValue', value);
        }
    }
    function hideShow(miliseconds) {
        $("#progressbarParent").hide();
    }
    $("#txtQtyInOne,#txtQtyInTwo,#txtUnitPriceInOne,#txtUnitPriceInTwo").keypress(function (e) {
        if (e.which != 8 && e.which != 0  && e.which != 46  && (e.which < 48 || e.which > 57)) {
            return false;
        }

    });
    function Initialization(oDyeingOrder, sOperation){
        ResetControll();
            RefreshControl(oDyeingOrder);
            if(oDyeingOrder.ReviseNo<=0)
            {
                $("#trReviseDate,#lblReviseNote,#txtReviseNote").hide();
            }
            else
            {
                $("#trReviseDate,#lblReviseNote,#txtReviseNote").show();
            }
       
            $("#chkIsCreateReviseNo").hide();
            $("#lblCreateReviseNo").hide();

        if(sOperation=="View")
        {
            $('#toolbar,#btnApprove,#btnSave,#btnCancel,.ics-pick').hide();
            $('input,select').not('#txtDyeingOrderNo').prop('disabled',true);
            $('.td-col-6 input').css('width','92%');
        }
        else  if(sOperation=="Revise")
        {
            $('#btnSave,#btnCancel,#btnApprove').hide();
            $('#btnSave_Revise').show();
            $("#chkIsCreateReviseNo").show();
            $("#lblCreateReviseNo,#lblReviseNote,#txtReviseNote,#trReviseDate").show();
            $('input,select').not('#txtDyeingOrderNo').prop('disabled',false);
            //$('#dtOrderDate').datebox('setValue', icsdateformat(new Date()));
            $('#dtOrderDate').prop('disabled',true);
            $('#dtReviseDate').datebox('setValue', icsdateformat(new Date()));

        }
        else  if(sOperation=="Cancel")
        {
            $('#btnSave,#btnApprove,#btnSave_Revise').hide();
            $('#btnCancel').show();
            $('input,select').not('#txtDyeingOrderNo').prop('disabled',false);
        }
       else if(sOperation=="Approve")
        {
           $('#toolbar,#btnSave,#btnSave_Revise,#btnCancel,.ics-pick').hide();
            $('#btnApprove').show();
            $('input,select').not('#txtDyeingOrderNo').prop('disabled',true);
            $('.td-col-6 input').css('width','92%');
        }
        else{
           $('#toolbar,#btnSave,.ics-pick').show();
           $('#btnApprove,#btnSave_Revise,#btnCancel').hide();
            $('input,select').not('#txtDyeingOrderNo').prop('disabled',false);
            $('.td-col-6 input').css('width','70%');
        }
    }


    function LoadIssueContactPersonnel(oCPs){
        $("#cboCPIssueTo").icsLoadCombo({
            List: oCPs,
            OptionValue: "ContactPersonnelID",
            DisplayText: "Name",
            InitialValue:""
        });
    }

    function LoadDeliveredContactPersonnel(oCPs){
        $("#cboCPDeliverTo").icsLoadCombo({
            List: oCPs,
            OptionValue: "ContactPersonnelID",
            DisplayText: "Name",
            InitialValue:""
        });
    }


    function ResetControll(){
        _oDyeingOrder=null;

        _nMktAccountID=0;
        _nContractorID=0;
        _nDeliveryToID=0;
        _nProductID=0;
        _nExportSCDetailID=0;

        $('.reset-text').val("");
        $('#dtOrderDate,#dtSeekingDate').datebox('setValue', icsdateformat(new Date()));
        LoadIssueContactPersonnel(_oCPIssueTos);
        LoadDeliveredContactPersonnel(_oCPDeliveryTos);
        //$('.number').val("0.00");
        ResetDetail();
        DynamicRefreshList([], 'tblDyeingOrderDetail');
        RefreshSummary();
    }

    function Control_disabled()
    {
        document.getElementById("txtMktAccount").disabled = true;
        document.getElementById("txtIssueTo").disabled = true;
        document.getElementById("txtDeliverTo").disabled = true;
        //document.getElementById("txtOrderNo").disabled = true;
        document.getElementById("txtOrderValue").disabled = true;
        document.getElementById("txtOrderQty").disabled = true;
        document.getElementById("txtTotalDOQty").disabled = true;
        document.getElementById("txtDOYetTo").disabled = true;

        document.getElementById("txtUnitPriceInOne").disabled = true;
        document.getElementById("txtUnitPriceInTwo").disabled = true;

        $('#btnPickIssueTo').hide();
        $('#btnResetIssueTo').hide();
        $('#btnPickDeliverTo').hide();
        $('#btnResetDeliverTo').hide();
    }

    function RefreshControl(oDyeingOrder){
        debugger;
        _oDyeingOrder=oDyeingOrder;
        if(_oDyeingOrder.DyeingOrderID>0)
        {
            $('#lblHeaderPIInfo').text('[P/I No.: '+_oDyeingOrder.ExportPINo+"] [L/C No: "+_oDyeingOrder.ExportLCNo+"] [P/I Value: "+parseFloat(_oDyeingOrder.OrderValue).toFixed(2)+"]");
        }
        $('#txtOrderValue').val(parseFloat(_oDyeingOrder.OrderValue).toFixed(2));
        $('#txtOrderQty').val(parseFloat(_oDyeingOrder.OrderQty).toFixed(2));
        $('#txtTotalDOQty').val(parseFloat(_oDyeingOrder.TotalDOQty).toFixed(2));
        $('#txtDOYetTo').val(parseFloat(_oDyeingOrder.OrderQty-_oDyeingOrder.TotalDOQty).toFixed(2));
        //$('#txtExportLCNo').val(_oDyeingOrder.ExportLCNo);
        $('#txtExportPINo').val(_oDyeingOrder.ExportPINo);

        _nMktAccountID=oDyeingOrder.MKTEmpID;
        _nContractorID=oDyeingOrder.ContractorID;
        _nDeliveryToID=oDyeingOrder.DeliveryToID;


        $('#txtMktAccount').val(oDyeingOrder.MKTPName);
        $('#txtIssueTo').val(oDyeingOrder.ContractorName);
        $('#txtDeliverTo').val(oDyeingOrder.DeliveryToName);
        $('#txtBuyerMaster').val(oDyeingOrder.MBuyer);
        $('#txtOrderNo').val(oDyeingOrder.PONo);
        $('#cboReviseNo').val(oDyeingOrder.ReviseNo);

        $('#dtOrderDate').datebox('setValue',oDyeingOrder.OrderDateSt);
        $('#dtReviseDate').datebox('setValue',oDyeingOrder.ReviseDateSt);
        $('#txtReviseNote').val(oDyeingOrder.ReviseNote);
        $('#cboCPIssueTo').val(oDyeingOrder.ContactPersonnelID);
        $('#cboCPDeliverTo').val(oDyeingOrder.ContactPersonnelID_DelTo);

        //$('#dtSeekingDate').datebox('setValue',oDyeingOrder.SeekingDateStr);
        $('#cboPriorityLevel').val(oDyeingOrder.PriorityInt);

        $('#txtStyleNo').val(oDyeingOrder.StyleNo);
        $('#cboLightSource').val(oDyeingOrder.LightSourchID);
        $('#txtBuyerRef').val(oDyeingOrder.RefNo);
        $('#txtStripeOrder').val(oDyeingOrder.StripeOrder);
        $('#txtKnittingStyle').val(oDyeingOrder.KnittingStyle);
        $('#txtGauge').val(oDyeingOrder.Gauge);

        $('#txtNote').val(oDyeingOrder.Note);
        $('#txtDeliveryZone').val(oDyeingOrder.DeliveryNote);
        if(oDyeingOrder.DyeingOrderDetails!==null && oDyeingOrder.DyeingOrderDetails.length>0)
        {
            DynamicRefreshList(oDyeingOrder.DyeingOrderDetails, 'tblDyeingOrderDetail');
        }
        else{
            DynamicRefreshList([], 'tblDyeingOrderDetail');
        }
        //$('#txtQtyInOne').icsCurrencyBox();
        //$('#txtQtyInTwo').icsCurrencyBox();
        //$('#txtUnitPriceInOne').icsCurrencyBox();
        //$('#txtUnitPriceInTwo').icsCurrencyBox();
        RefreshSummary();

    }

    function ChangeLabDipType()
    {

        var nLabDipType=parseInt($("#cboLabDipType").val());
        if( nLabDipType===1)
        {
            $("#cboShade" ).show();
            $("#txtShade" ).hide();
            $("#txtColorNo" ).prop({disabled:false});
            $("#txtLabdipNo" ).prop({disabled:false});
        }
        else{
            $("#cboShade" ).hide();
            $("#txtShade" ).show();
            $("#txtColorNo" ).prop({disabled:true});
            $("#txtLabdipNo" ).prop({disabled:true});
            $("#txtColorNo" ).val("");

            _nLabDipDetailID=0;
            //DTM = 2,
            if( nLabDipType===2)
            {
                $("#txtShade" ).val('DTM');
                $("#txtLabdipNo" ).val("DTM");
            }
            if( nLabDipType===3)
            {
                $("#txtShade" ).val('ANY');
                $("#txtLabdipNo" ).val("AVL");
            }
            if( nLabDipType===4)//TBA
            {
                $("#txtShade" ).hide();
                $("#cboShade" ).show();
            }
        }
    }

    function Validation(){



        if(_oDyeingOrder.ExportPIID<=0){
            $('#txtExportPINo').focus();
            $('#txtExportPINo').addClass("errorFieldBorder");
            alert('Pick P/I .');
            return false;
        }

        if(_nMktAccountID<=0){
            $('#txtMktAccount').focus();
            $('#txtMktAccount').addClass("errorFieldBorder");
            alert('Mkt person required.');
            return false;
        }
        else{
            $('#txtMktAccount').removeClass("errorFieldBorder");
        }

        if(_nContractorID<=0){
            $('#txtIssueTo').focus();
            $('#txtIssueTo').addClass("errorFieldBorder");
            alert('DyeingOrder issue to required.');
            return false;
        }
        else{
            $('#txtIssueTo').removeClass("errorFieldBorder");
        }



        if($('#cboPriorityLevel').val()<=0){
            $('#cboPriorityLevel').focus();
            $('#cboPriorityLevel').addClass("errorFieldBorder");
            alert('Select priority level.');
            return false;
        }
        else{
            $('#cboPriorityLevel').removeClass("errorFieldBorder");
        }
        return true;
    }

    function RefreshObject()
    {

        var oDyeingOrder={
            DyeingOrderID: (_oDyeingOrder!=null && _oDyeingOrder.DyeingOrderID>0)? _oDyeingOrder.DyeingOrderID:0,
            MKTEmpID:_nMktAccountID,
            ContractorID: _nContractorID,
            ContactPersonnelID: $('#cboCPIssueTo').val(),
            DeliveryToID:_nDeliveryToID,
            ContactPersonnelID_DelTo:$('#cboCPDeliverTo').val(),
            PriorityInt:$('#cboPriorityLevel').val(),
            //PaymentType:$('#cboPaymentType').val(),
            ExportPIID:_oDyeingOrder.ExportPIID,
            DyeingOrderType:_oDyeingOrder.DyeingOrderType,
            LightSourchID:$('#cboLightSource').val(),
            StyleNo: $.trim($('#txtStyleNo').val()),
            KnittingStyle: $.trim($('#txtKnittingStyle').val()),
            StripeOrder: $.trim($('#txtStripeOrder').val()),
            Gauge: $.trim($('#txtGauge').val()),
            RefNo:$.trim($('#txtBuyerRef').val()),
            Note:$.trim($('#txtNote').val()),
            //SeekingDate:$('#dtSeekingDate').datebox('getValue'),
            OrderNo:$.trim($('#txtOrderNo').val()),
            ReviseNo:$('#cboReviseNo').val(),
            OrderDate:$('#dtOrderDate').datebox('getValue'),
            IsCreateReviseNo:false,
            ReviseNote:$.trim($('#txtReviseNote').val()),
            ReviseDate:$('#dtReviseDate').datebox('getValue'),
            DyeingOrderDetails:$('#tblDyeingOrderDetail').datagrid('getRows')

        };
        return oDyeingOrder;
    }



    function ResetDetail(){
        _nProductID=0;
        _nExportSCDetailID=0;

        $('#cboKnitPly').val(0);
        $('#txtColorSet,#txtShadeCount').val(3);
        $('#txtCombo').val(1);
        $('#txtProduct,#txtColorName,#txtRGB,#txtPantonNo,#txtReftNo,#txtApproveLotNo').val("");
    }



    /////
    $("#btnReseDeliveryZone").click(function () {

        $("#txtDeliveryZone").val("");
       
    });
    $("#btnPickDeliveryZone").click(function () {
        debugger;
        var sName=$.trim($("#txtDeliveryZone").val());
        var sConIDs="";
        if(_oDyeingOrder.ContractorID>0)
        {
            sConIDs=_oDyeingOrder.ContractorID;
        }
        if(_oDyeingOrder.DeliveryToID>0)
        {
            sConIDs=sConIDs+","+_oDyeingOrder.DeliveryToID;
        }

        var oDyeingOrder = {
            DeliveryNote:sName,
            ErrorMessage:''
        };
        GetDeliveryZone(oDeliveryZone);
    });
    $("#txtDeliveryZone").keydown(function (e) {
        var nkeyCode = e.keyCode || e.which;
        if(nkeyCode==13){
            var sName=$.trim($("#txtDeliveryZone").val());
            if(sName=="" || sName==null)
            {
                alert("Type Name or Part of Name!");
                return;
            }

            var oDyeingOrder = {
                DeliveryNote:sName,
                ErrorMessage:''
            };
            GetDeliveryZone(oDyeingOrder);
        }
        else if(nkeyCode==8){
            $("#txtDeliveryZone").val("");
            _oDyeingOrder.DeliveryNote="";
        }
    });
    function GetDeliveryZone(oDyeingOrder){


        var obj = {
            BaseAddress: _sBaseAddress,
            Object: oDyeingOrder,
            ControllerName: "DyeingOrder",
            ActionName: "GetsDistingDeliveryNote",
            IsWinClose: false
        };
        $("#progressbar").progressbar({ value: 0 });
        $("#progressbarParent").show();
        var intervalID = setInterval(updateProgress, 250);
        $.icsDataGets(obj, function (response) {
            clearInterval(intervalID);
            $("#progressbarParent").hide();
            if (response.status && response.objs.length > 0) {
                if (response.objs[0].DeliveryNote!=null) {
                    debugger;
                    var tblColums = [];
                    var oColumn = { field: "DeliveryNote", title: "Delivery Note(s)", width: 250, align: "left" };tblColums.push(oColumn);

                    var oPickerParam = {
                        winid: 'winDeliveryZonePicker',
                        winclass:'clsDeliveryZonePicker',
                        winwidth: 460,
                        winheight: 460,
                        tableid: 'tblDeliveryZonePicker',
                        tablecolumns: tblColums,
                        datalist: response.objs,
                        multiplereturn: false,
                        searchingbyfieldName:'Name',
                        windowTittle: 'DeliveryZoneName'
                    };
                    $.icsPicker(oPickerParam);
                    IntializePickerbutton(oPickerParam);//multiplereturn, winclassName
                }
                else { alert(response.objs[0].ErrorMessage); }
            }
            else{
                alert("No Delivery Zone found.");
            }
        });


    }

    $("#btnResetMktPerson").click(function () {

        $("#txtMktAccount").val("");
        _nMktAccountID=0;
    });

    $("#btnPickMktAccount").click(function () {

        var sName=$.trim($("#txtMktAccount").val());
        GetMktPersons(sName);
    });

    $("#txtMktAccount").keydown(function (e) {
        var nkeyCode = e.keyCode || e.which;
        if(nkeyCode==13){
            var sName=$.trim($("#txtMktAccount").val());
            GetMktPersons(sName);
        }
        else if(nkeyCode==8){
            $("#txtMktAccount").val("");
            _nMktAccountID=0;
        }
    });

    function GetMktPersons(sName){

        var oMarketingAccount_BU = {
            Name:sName,
            BUID:sessionStorage.getItem("BUID")
        };
        var obj = {
            BaseAddress: _sBaseAddress,
            Object: oMarketingAccount_BU,
            ControllerName: "MarketingAccount",
            ActionName: "MarketingAccountSearchByName",
            IsWinClose: false
        };

        $.icsDataGets(obj, function (response) {

            if (response.status && response.objs.length > 0) {
                if (response.objs[0].MarketingAccountID > 0) {
                    debugger;
                    var tblColums = [];
                    var oColumn = { field: "MarketingAccountID", title: "Code", width: 50, align: "left" };tblColums.push(oColumn);
                    oColumn = { field: "Name", title: "Name", width: 250, align: "left" };tblColums.push(oColumn);
                    oColumn = { field: "Phone", title: "Phone", width: 100, align: "left" };tblColums.push(oColumn);

                    var oPickerParam = {
                        winid: 'winMktAccount',
                        winclass:'clsMktPersonPicker',
                        winwidth: 460,
                        winheight: 460,
                        tableid: 'tblMktPersonPicker',
                        tablecolumns: tblColums,
                        datalist: response.objs,
                        multiplereturn: false,
                        searchingbyfieldName:'Name',
                        windowTittle: 'MKT Person List'
                    };
                    $.icsPicker(oPickerParam);
                    IntializePickerbutton(oPickerParam);//multiplereturn, winclassName
                }
                else { alert(response.objs[0].ErrorMessage); }
            }
            else{
                alert("No marketing person found.");
            }
        });


    }




    $("#btnPickIssueTo").click(function () {

        var sContractorName=$.trim($("#txtIssueTo").val());
        _bIsIssueTo=true;
        GetContractors(sContractorName, _bIsIssueTo);
    });
    $("#txtIssueTo").keydown(function (e) {
        var nkeyCode = e.keyCode || e.which;
        if(nkeyCode==13){
            var sContractorName=$.trim($("#txtIssueTo").val());
            _bIsIssueTo=true;
            GetContractors(sContractorName,_bIsIssueTo);
        }
        else if(nkeyCode==8){
            $("#txtIssueTo").val("");
            _nContractorID=0;
            $("#cboCPIssueTo").empty();
        }
    });
    $("#btnResetIssueTo").click(function () {
        $("#txtIssueTo").val("");
        _nContractorID=0;
    });



    $("#btnResetDeliverTo").click(function () {
        $("#txtDeliverTo").val("");
        _nDeliveryToID=0;
        $("#cboCPDeliverTo").empty();
    });

    $("#btnPickDeliverTo").click(function () {
        var sContractorName=$.trim($("#txtDeliverTo").val());
        _bIsIssueTo=false;
        GetContractors(sContractorName, _bIsIssueTo);
    });

    $("#txtDeliverTo").keydown(function (e) {
        var nkeyCode = e.keyCode || e.which;
        if(nkeyCode==13){
            var sContractorName=$.trim($("#txtDeliverTo").val());
            _bIsIssueTo=false;
            GetContractors(sContractorName,_bIsIssueTo);
        }
        else if(nkeyCode==8){
            $("#txtDeliverTo").val("");
            _nDeliveryToID=0;
            $("#txtDeliverTo").empty();

        }
    });


    function GetContractors(sContractorName, bIsIssueTo){

        var oContractor = {
            Params: '2,3' +'~'+sContractorName,
        };
        var obj = {
            BaseAddress: _sBaseAddress,
            Object: oContractor,
            ControllerName: "Contractor",
            ActionName: "ContractorSearchByNameType",
            IsWinClose: false
        };

        $.icsDataGets(obj, function (response) {

            if (response.status && response.objs.length > 0) {
                if (response.objs[0].ContractorID > 0) {
                    debugger;
                    var tblColums = [];
                    var oColumn = { field: "ContractorID", title: "Code", width: 50, align: "center" };tblColums.push(oColumn);
                    oColumn = { field: "Name", title: "Name", width: 190, align: "left" };tblColums.push(oColumn);
                    oColumn = { field: "Phone", title: "Phone", width: 140, align: "left" };tblColums.push(oColumn);

                    var oPickerParam = {
                        winid: 'winContractorPicker',
                        winclass:'clsContractorPicker',
                        winwidth: 460,
                        winheight: 460,
                        tableid: 'tblContractorPicker',
                        tablecolumns: tblColums,
                        datalist: response.objs,
                        multiplereturn: false,
                        searchingbyfieldName:'Name',
                        windowTittle: 'Contractor List'
                    };
                    $.icsPicker(oPickerParam);
                    IntializePickerbutton(oPickerParam);//multiplereturn, winclassName
                }
                else { alert(response.objs[0].ErrorMessage); }
            }
            else{
                alert("No contractor found.");
            }
        });


    }

    function GetContactPersonel(nContractorID,bIsIssueTo){

        var oContractor = {
            ContractorID: nContractorID
        };
        var obj = {
            BaseAddress: _sBaseAddress,
            Object: oContractor,
            ControllerName: "Contractor",
            ActionName: "GetContactPersonnels",
            IsWinClose: false
        };

        $.icsDataGets(obj, function (response) {

            if (response.status && response.objs.length > 0) {
                if (response.objs[0].ContactPersonnelID > 0) {

                    if(bIsIssueTo){
                        LoadIssueContactPersonnel(response.objs);
                    }
                    else{
                        LoadDeliveredContactPersonnel(response.objs);
                    }

                }
                else{
                    if(bIsIssueTo){
                        LoadIssueContactPersonnel([]);
                    }
                    else{
                        LoadDeliveredContactPersonnel([]);
                    }
                }
            }
        });
    }


    $("#btnResetProduct").click(function () {

        $("#txtProduct").val("");
        _nProductID=0;
        _nExportSCDetailID=0;
    });

    $("#btnPickProduct").click(function () {

        var sProductName=$.trim($("#txtProduct").val());

        GetProducts(sProductName);
    });

    $("#txtProduct").keydown(function (e) {
        var nkeyCode = e.keyCode || e.which;
        if(nkeyCode==13){
            var sProductName=$.trim($("#txtProduct").val());

            GetProducts(sProductName);
        }
        else if(nkeyCode==8){
            $("#txtProduct").val("");
            _nProductID=0;
            _nExportSCDetailID=0;
        }
    });

    function GetProducts(sProductName){

        var oExportSCDO = {
            ExportPIID:_oDyeingOrder.ExportPIID,
            ProductionType:1,
            ProductCode:sProductName
        };
        var obj = {
            BaseAddress: _sBaseAddress,
            Object: oExportSCDO,
            ControllerName: "ExportSCDO",
            ActionName: "GetsExportSCDetailDO",
            IsWinClose: false
        };

        $.icsDataGets(obj, function (response) {

            if (response.status && response.objs.length > 0) {
                if (response.objs[0].ProductID > 0) {
                    debugger;
                    var tblColums = [];
                    var oColumn = { field: "ProductCode", title: "Code", width: 80, align: "left" };tblColums.push(oColumn);
                    oColumn = { field: "ProductName", title: "Name", width: 220, align: "left" };tblColums.push(oColumn);
                    oColumn = { field: "MUName", title: "Unit", width: 70, align: "left" };tblColums.push(oColumn);
                    oColumn = { field: "Qty", title: "Order Qty", width: 100, align: "right",formatter:formatPrice };tblColums.push(oColumn);
                    oColumn = { field: "POQty", title: "PO Qty", width: 100, align: "right",formatter:formatPrice };tblColums.push(oColumn);
                    oColumn = { field: "YetToPO", title: "Yet To PO", width: 100, align: "right",formatter:formatPrice };tblColums.push(oColumn);

                    var oPickerParam = {
                        winid: 'winProductPicker',
                        winclass:'clsProductPicker',
                        winwidth: 750,
                        winheight: 460,
                        tableid: 'tblProductPicker',
                        tablecolumns: tblColums,
                        datalist: response.objs,
                        multiplereturn: false,
                        searchingbyfieldName:'ProductName',
                        windowTittle: 'Product List'
                    };
                    $.icsPicker(oPickerParam);
                    IntializePickerbutton(oPickerParam);//multiplereturn, winclassName
                }
                else { alert(response.objs[0].ErrorMessage); }
            }
            else{
                alert("No product found.");
            }
        });


    }

    //LadDip Gets By Color No
    $("#btnColorNo").click(function () {

        var sColorNo=$.trim($("#txtColorNo").val());
        if(sColorNo=="")
        {
            alert("Type Color No for search."); return ;
        }
        if ($.trim($("#txtColorNo").val()).length<6 ) {

            alert("Please enter at least 6 character to search.");
            $('#txtColorNo').focus();
            return;
        }
        else { $('#txtColorNo').removeClass("errorFieldBorder"); }

        var oLabDipDetails = {
            ColorNo:sColorNo,
            LabdipNo:""
        };

        GetLabDipDetails(oLabDipDetails);
    });

    $("#txtColorNo").keydown(function (e) {
        var nkeyCode = e.keyCode || e.which;
        if(nkeyCode==13){
            var sColorNo=$.trim($("#txtColorNo").val());
            if(sColorNo==""){ alert("Type Color No for search."); return false; }

            if ($.trim($("#txtColorNo").val()).length<6 ) {

                alert("Please enter at least 6 character to search.");
                $('#txtColorNo').focus();
                return;
            }
            else { $('#txtColorNo').removeClass("errorFieldBorder"); }

            var oLabDipDetails = {
                ColorNo:sColorNo,
                LabdipNo:""
            };
            GetLabDipDetails(oLabDipDetails);
        }
        else if(nkeyCode==8){
            $("#txtColorNo").val("");
            _nLabDipDetailID=0;
        }
    });
    //LadDip Gets By Labdip No
    $("#btnLabdipNo").click(function () {

        var sLabdipNo=$.trim($("#txtLabdipNo").val());
        if(sLabdipNo==""){ alert("Type Labdip No for search."); return false; }

        if ($.trim($("#txtLabdipNo").val()).length<4 ) {

            alert("Please enter at least 4 character to search.");
            $('#txtLabdipNo').focus();
            return;
        }
        else { $('#txtLabdipNo').removeClass("errorFieldBorder"); }

        var oLabDipDetails = {
            ColorNo:"",
            LabdipNo:sLabdipNo
        };

        GetLabDipDetails(oLabDipDetails);
    });

    $("#txtLabdipNo").keydown(function (e) {
        var nkeyCode = e.keyCode || e.which;
        if(nkeyCode==13){
            var sLabdipNo=$.trim($("#txtLabdipNo").val());
            if(sLabdipNo==""){ alert("Type Labdip No for search."); return false; }
            if ($.trim($("#txtLabdipNo").val()).length<4 ) {

                alert("Please enter at least 4 character to search.");
                $('#txtLabdipNo').focus();
                return;
            }
            else { $('#txtLabdipNo').removeClass("errorFieldBorder"); }
            var oLabDipDetails = {
                ColorNo:"",
                LabdipNo:sLabdipNo
            };
            GetLabDipDetails(oLabDipDetails);
        }
        else if(nkeyCode==8){
            $("#sLabdipNo").val("");
            _nLabDipDetailID=0;
        }
    });
    function GetLabDipDetails(oLabDipDetails){

        var obj = {
            BaseAddress: _sBaseAddress,
            Object: oLabDipDetails,
            ControllerName: "LabDip",
            ActionName: "GetsLabDipDetail",
            IsWinClose: false
        };

        $.icsDataGets(obj, function (response) {

            if (response.status && response.objs.length > 0) {
                if (response.objs[0].LabDipDetailID > 0) {
                    debugger;
                    var tblColums = [];
                    var oColumn = { field: "LabdipNo", title: "LabdipNo", width: 110, align: "left" };tblColums.push(oColumn);
                    oColumn = { field: "ColorNo", title: "ColorNo", width: 110, align: "left" };tblColums.push(oColumn);
                    oColumn = { field: "ColorName", title: "ColorName", width: 160, align: "left" };tblColums.push(oColumn);
                    oColumn = { field: "ProductName", title: "Yarn", width: 150, align: "left" };tblColums.push(oColumn);

                    var oPickerParam = {
                        winid: 'winLabDipPicker',
                        winclass:'clsLabDipPicker',
                        winwidth: 550,
                        winheight: 460,
                        tableid: 'tblLabDipPicker',
                        tablecolumns: tblColums,
                        datalist: response.objs,
                        multiplereturn: false,
                        searchingbyfieldName:'ColorNo',
                        windowTittle: 'LabDip List'
                    };
                    $.icsPicker(oPickerParam);
                    IntializePickerbutton(oPickerParam);//multiplereturn, winclassName
                }
                else { alert(response.objs[0].ErrorMessage); }
            }
            else{
                alert("No product found.");
            }
        });


    }
    //Pick PI /LC

    //$("#btnPickExportLCNo").click(function () {

    //    var sContractorName=$.trim($("#txtExportLCNo").val());
    //    var sNo=$.trim($("#txtExportLCNo").val());
    //    var oExportSCDO = {
    //        PINo:"",
    //        ExportLCNo:sNo,
    //        LCID:0
    //    };
    //    GetsExportPIs(oExportSCDO);
    //});

    //$("#txtExportLCNo").keydown(function (e) {
    //    var nkeyCode = e.keyCode || e.which;
    //    if(nkeyCode==13){
    //        var sNo=$.trim($("#txtExportLCNo").val());
    //        var oExportSCDO = {
    //            PINo:"",
    //            ExportLCNo:sNo,
    //            LCID:0
    //        };
    //        GetsExportPIs(oExportSCDO);
    //    }
    //    else if(nkeyCode==8){
    //        $("#txtExportLCNo").val("");
    //        _nExportLCID=0;

    //    }
    //});
    //$("#btnResetExportLCNo").click(function () {
    //    $("#txtExportLCNo").val("");
    //    _nExportLCID=0;
    //});

    $("#btnPickExportPI").click(function () {

        var sNo=$.trim($("#txtExportPINo").val());
        var oExportSCDO = {
            PINo:sNo,
            LCNo:'',
            LCID:_nExportLCID,
            BUID:_nBUID
        };
        GetsExportPIs(oExportSCDO);
    });

    $("#txtExportPINo").keydown(function (e) {
        var nkeyCode = e.keyCode || e.which;
        if(nkeyCode==13){
            var sNo=$.trim($("#txtExportPINo").val());
            var oExportSCDO = {
                PINo:sNo,
                LCNo:'',
                LCID:_nExportLCID,
                BUID:_nBUID
            };
            GetsExportPIs(oExportSCDO);
        }
        else if(nkeyCode==8){
            $("#txtExportPINo").val("");
            _oDyeingOrder.ExportPIID=0;

        }
    });
    $("#btnResetExportPI").click(function () {
        $("#txtExportPINo").val("");
        _oDyeingOrder.ExportPIID=0;
    });


    function GetsExportPIs(oExportSCDO){


        var obj = {
            BaseAddress: _sBaseAddress,
            Object: oExportSCDO,
            ControllerName: "ExportSCDO",
            ActionName: "GetExportPIs",
            IsWinClose: false
        };

        $.icsDataGets(obj, function (response) {

            if (response.status && response.objs.length > 0)
            {
                if (response.objs[0].ExportPIID > 0) {
                    debugger;
                    var tblColums = [];
                    var oColumn = { field: "ExportPINo", title: "P/I No", width: 160, align: "left" };tblColums.push(oColumn);
                    oColumn = { field: "ExportLCNo", title: "L/C No", width: 200, align: "left" };tblColums.push(oColumn);
                    oColumn = { field: "OrderQty", title: "P/I. Qty", width: 100, align: "right" };tblColums.push(oColumn);
                    oColumn = { field: "TotalDOQty", title: "P.O. Qty", width: 100, align: "right" };tblColums.push(oColumn);
                    var oPickerParam = {
                        winid: 'winExportPIPicker',
                        winclass:'clsExportPIPicker',
                        winwidth: 660,
                        winheight: 460,
                        tableid: 'tblExportPIPicker',
                        tablecolumns: tblColums,
                        datalist: response.objs,
                        multiplereturn: false,
                        searchingbyfieldName:'PINo',
                        windowTittle: 'P/I List'
                    };
                    $.icsPicker(oPickerParam);
                    IntializePickerbutton(oPickerParam);//multiplereturn, winclassName
                }
                else { alert(response.objs[0].ErrorMessage); }
            }
            else{
                alert("Data not found.");
            }
        });


    }
    //End PI LC Pick

    $("#btnPickBuyerMaster").click(function () {
        var sContractorName=$.trim($("#txtBuyerMaster").val());
        GetsMasterBuyer(sContractorName);
    });
    $("#txtBuyerMaster").keydown(function (e) {
        var nkeyCode = e.keyCode || e.which;
        if(nkeyCode==13){
            var sContractorName=$.trim($("#txtBuyerMaster").val());
            GetsMasterBuyer(sContractorName);
        }
        else if(nkeyCode==8){
            $("#txtBuyerMaster").val("");
           
        }
    });
    $("#btnReseBuyerMaster").click(function () {
        $("#txtBuyerMaster").val("");
        
    });

    
    function GetsMasterBuyer(sContractorName){

        var oContractor = {
            Params: '6' +'~'+sContractorName,
            BUID:sessionStorage.getItem("BUID")
        };
        var obj = {
            BaseAddress: _sBaseAddress,
            Object: oContractor,
            ControllerName: "Contractor",
            ActionName: "ContractorSearchByNameType",
            IsWinClose: false
        };

        $.icsDataGets(obj, function (response) {

            if (response.status && response.objs.length > 0) {
                if (response.objs[0].ContractorID > 0) {
                    debugger;
                    var tblColums = [];
                    var oColumn = { field: "ContractorID", title: "Code", width: 50, align: "center" };tblColums.push(oColumn);
                    oColumn = { field: "Name", title: "Name", width: 190, align: "left" };tblColums.push(oColumn);
                    oColumn = { field: "Phone", title: "Phone", width: 140, align: "left" };tblColums.push(oColumn);

                    var oPickerParam = {
                        winid: 'winMasterBuyerPicker',
                        winclass:'clsMasterBuyerPicker',
                        winwidth: 460,
                        winheight: 460,
                        tableid: 'tblContractorPicker',
                        tablecolumns: tblColums,
                        datalist: response.objs,
                        multiplereturn: false,
                        searchingbyfieldName:'Name',
                        windowTittle: 'Buyer List'
                    };
                    $.icsPicker(oPickerParam);
                    IntializePickerbutton(oPickerParam);//multiplereturn, winclassName
                }
                else { alert(response.objs[0].ErrorMessage); }
            }
            else{
                alert("No contractor found.");
            }
        });


    }
    function IntializePickerbutton(oPickerobj) {
        $("#" + oPickerobj.winid).find("#btnOk").click(function () {
            //for Single Select
            SetPickerValueAssign(oPickerobj);
        });
        $(document).find('.' + oPickerobj.winclass).keydown(function (e) {
            if (e.which == 13)//enter=13
            {
                SetPickerValueAssign(oPickerobj);

            }
        });
    }

    function SetPickerValueAssign(oPickerobj) {
        debugger;
        var oreturnObj = null, oreturnobjs = [];
        if (oPickerobj.multiplereturn) {
            oreturnobjs = $('#' + oPickerobj.tableid).datagrid('getChecked');
        } else {
            oreturnObj = $('#' + oPickerobj.tableid).datagrid('getSelected');
        }
        $("#" + oPickerobj.winid).icsWindow("close");
        $("#" + oPickerobj.winid).remove();
        if (oPickerobj.winid == 'winContractorPicker')
        {
            if (oreturnObj != null && oreturnObj.ContractorID > 0)
            {
                debugger;


                if(_bIsIssueTo){
                    $('#txtIssueTo').val(oreturnObj.Name);
                    _nContractorID= oreturnObj.ContractorID;
                    if(_nDeliveryToID<=0){
                        $('#txtDeliverTo').val(oreturnObj.Name);
                        _nDeliveryToID= oreturnObj.ContractorID;
                    }
                }
                else{
                    $('#txtDeliverTo').val(oreturnObj.Name);
                    _nDeliveryToID= oreturnObj.ContractorID;
                }

                GetContactPersonel(oreturnObj.ContractorID, _bIsIssueTo);

            }
            else{
                alert("Data not found");
            }
        }
        else  if (oPickerobj.winid == 'winMasterBuyerPicker')
        {
            if (oreturnObj != null && oreturnObj.ContractorID > 0)
            {
                debugger;
                $('#txtBuyerMaster').val(oreturnObj.Name);
                UpdateMasterBuyers(oreturnObj.ContractorID);
                
            }
            else{
                alert("Data not found");
            }
        }
        else if (oPickerobj.winid == 'winProductPicker') {
            if (oreturnObj != null && oreturnObj.ProductID > 0)
            {
                $('#txtProduct').val(oreturnObj.ProductNameCode);
                _nProductID= oreturnObj.ProductID;
                _nExportSCDetailID=oreturnObj.ExportSCDetailID;
                $('#txtQtyInOne').val(parseFloat(oreturnObj.YetToPO).toFixed(2));
                $('#txtUnitPriceInOne').val(parseFloat(oreturnObj.UnitPrice).toFixed(2));
                if(oreturnObj.StyleNo.length>0) { $('#txtStyleNo').val(oreturnObj.StyleNo);}
                if(oreturnObj.BuyerRef.length>0) { $('#txtBuyerRef').val(oreturnObj.BuyerRef);}
                ConvertIntoKg_Qty();
                ConvertIntoKgs_UnitPrice();
            }
            else{
                alert("Data Not Found.");
                return;
            }
        }
        else if (oPickerobj.winid == 'winDeliveryZonePicker') {
            if (oreturnObj != null && oreturnObj.DeliveryNote!=null)
            {
                $('#txtDeliveryZone').val(oreturnObj.DeliveryNote);
               
            }
            else{
                alert("Data Not Found.");
                return;
            }
        }
        else if (oPickerobj.winid=='winDoDColorCombo')
        {
           
            if(oreturnobjs.length>0)
            {
                Save_DUColorCombo(oreturnobjs);
            }
            else{
                alert("Data Not Found.");
            }
        }
        else if (oPickerobj.winid == 'winLabDipPicker')
        {
            if (oreturnObj != null && oreturnObj.LabDipDetailID > 0)
            {
                $('#txtColorNo').val(oreturnObj.ColorNo);
                $('#txtColorName').val(oreturnObj.ColorName);
                $('#txtLabdipNo').val(oreturnObj.LabdipNo);
                $('#txtPantonNo').val(oreturnObj.PantonNo);
                $('#txtColorDevProduct').val(oreturnObj.ProductName);
                _nLabDipDetailID= oreturnObj.LabDipDetailID;
            }
            else{
                alert("Data Not Found.");
                return;
            }
        }
        else if (oPickerobj.winid=='winMktAccount')
        {
            if(oreturnObj!=null && parseInt(oreturnObj.MarketingAccountID)>0)
            {
                var txtMktAccount = document.getElementById("txtMktAccount");
                txtMktAccount.style.color = "blue";
                txtMktAccount.style.fontWeight = "bold";
                $('#txtMktAccount').val(oreturnObj.Name);
                _nMktAccountID= oreturnObj.MarketingAccountID;
            }
            else
            {
                alert("Data Not Found.");
            }
        }
        else if (oPickerobj.winid=='winExportPIPicker')
        {
            if(oreturnObj!=null && parseInt(oreturnObj.ExportPIID)>0)
            {
                debugger;
                var txtExportPINo = document.getElementById("txtExportPINo");
                txtExportPINo.style.color = "blue";
                txtExportPINo.style.fontWeight = "bold";
                $('#txtExportPINo').val(oreturnObj.ExportPINo);
                RefreshControl(oreturnObj);
            }
            else
            {
                alert("Data Not Found.");
            }
        }
    }

    $("#btnAddDetail").click(function () {
        debugger;
        _oIsAdd=true;
        _nDyeingOrderDetailID=0;
        var nPQTY=0;
     
        var   oDyeingOrderDetail= {
            DyeingOrderDetailID : 0,
            DyeingOrderID : 0,
            LabDipDetailID:0 ,
            ProductID : _nProductID,
            ExportSCDetailID : _nExportSCDetailID,
            ProductName: $('#txtProduct').val(),
            Shade:0,
            LabDipType:1,
            LabdipNo:"",
            ColorName:"",
            ColorNo:"",
            PantonNo:"",
            Qty: 0,
            Qty_Pro:0,
            UnitPrice: parseFloat($('#txtUnitPriceInOne').val()).toFixed(4),
            HankorCone:0,
            BuyerCombo:'',
            ApproveLotNo:"",
            NoOfCone:"",
            LengthOfCone:"",
            NoOfCone_Weft:"",
            NoOfCone_Weft:"",
            LengthOfCone_Weft:"",
            Note:"",
            DeliveryDate: new Date(),
            DeliveryDateSt: icsdateformat(new Date())

        };
        RefreshControlDetail(oDyeingOrderDetail);
        $("#winDyeingOrderDetail").icsWindow('open', "Color Information");

    });
    $("#btnEditDetail").click(function () {
        debugger;

        _oIsAdd=false;
        var oDyeingOrderDetail = $("#tblDyeingOrderDetail").datagrid("getSelected");
        //if (oDyeingOrderDetail == null || oDyeingOrderDetail.DyeingOrderDetailID <= 0) { alert("Please select an item from list!"); return false; }
        _nDyeingOrderDetailID=oDyeingOrderDetail.DyeingOrderDetailID;
        _nLabDipDetailID=oDyeingOrderDetail.LabDipDetailID;
        _nProductID=oDyeingOrderDetail.ProductID;
        _nExportSCDetailID=oDyeingOrderDetail.ExportSCDetailID;
        _nSelectedRowIndex=$('#tblDyeingOrderDetail').datagrid('getRowIndex',oDyeingOrderDetail);
        RefreshControlDetail(oDyeingOrderDetail);
        $("#winDyeingOrderDetail").icsWindow('open', "Color Information");

    });


    $('#btnClose').click(function(e){
        window.location.href = sessionStorage.getItem("BackLink");
    });
    $('#btnClose,#btnCloseTwo').click(function(e){
        window.location.href = sessionStorage.getItem("BackLink");
    });
    function RefreshControlDetail(oDyeingOrderDetail)
    {

        debugger;
        document.getElementById("txtColorDevProduct").disabled = true;
        document.getElementById("txtShade").disabled = true;

        $('#txtQtyInOne').val(parseFloat(oDyeingOrderDetail.Qty).toFixed(2));
        //$('#txtQtyInTwo').val(parseFloat(oDyeingOrderDetail.Qty).toFixed(2));
        $('#txtUnitPriceInOne').val(parseFloat(oDyeingOrderDetail.UnitPrice).toFixed(4));
        //$('#txtUnitPriceInTwo').val(parseFloat(oDyeingOrderDetail.UnitPrice).toFixed(2));
        $('#txtProduct').val(oDyeingOrderDetail.ProductName);
        $('#txtApproveLotNo').val(oDyeingOrderDetail.ApproveLotNo);
        $('#txtColorDevProduct').val(oDyeingOrderDetail.ColorDevelopProduct);
        $('#txtNoteDetail').val(oDyeingOrderDetail.Note);
        $('#txtBuyerCombo').val(oDyeingOrderDetail.BuyerCombo);
        $('#txtLabdipNo').val(oDyeingOrderDetail.LabdipNo);
        $('#cboLabDipType').val(oDyeingOrderDetail.LabDipType);
        $('#cboShade').val(oDyeingOrderDetail.Shade);
        $('#txtColorName').val(oDyeingOrderDetail.ColorName);
        $('#txtColorNo').val(oDyeingOrderDetail.ColorNo);
        $('#txtPantonNo').val(oDyeingOrderDetail.PantonNo);
        $('#cboHankorCone').val(oDyeingOrderDetail.HankorCone);
        $('#txtNoOfCone_Weft').val(oDyeingOrderDetail.NoOfCone_Weft);
        $('#txtNoOfCone').val(oDyeingOrderDetail.NoOfCone);
        $('#txtLengthOfCone').val(oDyeingOrderDetail.LengthOfCone);
        if (oDyeingOrderDetail.DeliveryDateSt != "") {
            $('#txtDeliveryDate').datebox('setValue', oDyeingOrderDetail.DeliveryDateSt);
        }

        ConvertIntoKgs_UnitPrice();
        ConvertIntoKg_Qty();
        ChangeLabDipType();
    }


    $("#btnRemoveDetail").click(function () {
        var oDyeingOrderDetail = $("#tblDyeingOrderDetail").datagrid("getSelected");
        if (oDyeingOrderDetail == null) { alert("Please select an item from list!"); return false; }
        if (oDyeingOrderDetail.Qty_Pro>0) { alert("Already Dyeing Card Issue, You can't remove it.(But Revise it)!"); return false;}
        var nIndex=$('#tblDyeingOrderDetail').datagrid('getRowIndex',oDyeingOrderDetail);
        if (!confirm("Confirm to Delete?")) return false;
        $("#tblDyeingOrderDetail").datagrid("deleteRow", nIndex);
        RefreshSummary();

    });

    function RefreshObjectDetail(){

        var ocboLabDipType = document.getElementById("cboLabDipType");
        var sLabDipType = ocboLabDipType.options[ocboLabDipType.selectedIndex].text;
        var cboShade = document.getElementById("cboShade");
        var sShade="";
        if($('#cboShade').val()==null || $('#cboShade').val()<=0)
        {
            sShade = "DTM";
        }
        else{
            sShade = cboShade.options[cboShade.selectedIndex].text;
        }

        var   oDyeingOrderDetail= {
            DyeingOrderDetailID :_nDyeingOrderDetailID,
            DyeingOrderID : (_oDyeingOrder!=null && _oDyeingOrder.DyeingOrderID>0)? _oDyeingOrder.DyeingOrderID:0,
            LabDipDetailID:_nLabDipDetailID,
            ProductID : _nProductID,
            ExportSCDetailID : _nExportSCDetailID,
            ProductName: $('#txtProduct').val(),
            ProductNameCode: $('#txtProduct').val(),
            Shade: $('#cboShade').val(),
            ShadeSt:sShade,
            LabDipType: $('#cboLabDipType').val(),
            LabDipTypeSt: sLabDipType,
            LabdipNo:"",
            ColorName: $('#txtColorName').val(),
            ColorNo:$('#txtColorNo').val(),
            PantonNo:$('#txtPantonNo').val(),
            Qty: $('#txtQtyInOne').val(),
            UnitPrice: $('#txtUnitPriceInOne').val(),
            Amount:0,
            HankorCone:parseInt($('#cboHankorCone').val()),
            BuyerCombo:$('#txtBuyerCombo').val(),
            ApproveLotNo: $('#txtApproveLotNo').val(),
            NoOfCone: $('#txtNoOfCone').val(),
            LengthOfCone:  $('#txtLengthOfCone').val(),
            NoOfCone_Weft: $('#txtNoOfCone_Weft').val(),
            LengthOfCone_Weft: $('#txtLengthOfCone').val(),
            Note:$('#txtNoteDetail').val(),
            DeliveryDate:$('#txtDeliveryDate').datebox('getValue'),
            DeliveryDateSt: icsdateformat(new Date())
        };

        return oDyeingOrderDetail;
    }

    $('#btnSave_DODetail').click(function(e){
        debugger;
        if(!ValidationDetail()) return false;
        var oDyeingOrderDetail = RefreshObjectDetail();
        oDyeingOrderDetail.Amount=(oDyeingOrderDetail.Qty*oDyeingOrderDetail.UnitPrice)
        alert("Date Save Successfully");
        if(_oIsAdd==true)
        {
            var oDyeingOrderDetails= $('#tblDyeingOrderDetail').datagrid('getRows');
            var nIndex=oDyeingOrderDetails.length;
            $('#tblDyeingOrderDetail').datagrid('appendRow', oDyeingOrderDetail);
            $('#tblDyeingOrderDetail').datagrid('selectRow', nIndex);
        }
        else
        {

            $('#tblDyeingOrderDetail').datagrid('updateRow', { index: _nSelectedRowIndex, row: oDyeingOrderDetail });
            $('#tblDyeingOrderDetail').datagrid('selectRow', _nSelectedRowIndex);
        }
        _nLabDipDetailID=0;
        $("#winDyeingOrderDetail").icsWindow('close');
        RefreshSummary();

    });
    $("#btnClose_DODetail").click(function () {
        debugger;

        $("#winDyeingOrderDetail").icsWindow('close');
    });
    function ValidationDetail(){
        debugger;

        if(_nProductID<=0 || _nExportSCDetailID<=0)
        {
            $('#txtProduct').focus();
            $('#txtProduct').addClass("errorFieldBorder");
            alert('No product found.');
            return false;
        }
        else
        {
            $('#txtProduct').removeClass("errorFieldBorder");
        }


        var nQty =$('#txtQtyInOne').val();// icsRemoveComma($('#txtQtyInOne').val());
        if(parseFloat(nQty).toFixed(2)<=0 )
        {
            $('#txtQtyInOne').focus();
            $('#txtQtyInOne').addClass("errorFieldBorder");
            alert('Quantity require.');
            return false;
        }
        var nUnitPrice = $('#txtUnitPriceInOne').val();// icsRemoveComma($('#txtUnitPriceInOne').val());
        if(parseFloat(nUnitPrice).toFixed(2)<=0 )
        {
            $('#txtUnitPriceInOne').focus();
            $('#txtUnitPriceInOne').addClass("errorFieldBorder");
            alert('Unit Price require.');
            return false;
        }

        var nLabDipType=  $('#cboLabDipType').val();

        if(nLabDipType==1)
        {

            if(_nLabDipDetailID<=0){
                $('#txtColorNo').focus();
                $('#txtColorNo').addClass("errorFieldBorder");
                alert('Must Pick Color No.');
                return false;
            }
            else{
                $('#txtColorNo').removeClass("errorFieldBorder");
            }

            if($('#cboShade').val()<=0){
                $('#cboShade').focus();
                $('#cboShade').addClass("errorFieldBorder");
                alert('Select Shade.');
                return false;
            }
            else{
                $('#cboShade').removeClass("errorFieldBorder");
            }


        }

        if($('#cboLabDipType').val()<=0){
            $('#cboLabDipType').focus();
            $('#cboLabDipType').addClass("errorFieldBorder");
            alert('Select LabDip Type.');
            return false;
        }
        else{
            $('#cboLabDipType').removeClass("errorFieldBorder");
        }



        if($.trim($('#txtColorName').val())==""){
            $('#txtColorName').focus();
            $('#txtColorName').addClass("errorFieldBorder");
            alert('Color name required.');
            return false;
        }
        else{
            $('#txtColorName').removeClass("errorFieldBorder");
        }


        return true;
    }

    $("#txtQtyInOne").keyup(function (e){
        debugger;
        ConvertIntoKg_Qty();
    });
    $("#txtQtyInTwo").keyup(function (e){
        debugger;
        ConvertIntoLbs_Qty();
    });



    function ConvertIntoLbs_Qty()
    {
        var nQtyInTwo =$('#txtQtyInTwo').val();//icsRemoveComma($('#txtQtyInTwo').val());
        //var nQtyInOne= parseFloat(nQtyInTwo/0.45359237001003542909395360718511).toFixed(4);
        var nQtyInOne= parseFloat(nQtyInTwo/_oMUnitCon.Value).toFixed(4);
        $('#txtQtyInOne').val(nQtyInOne);
    }
    function ConvertIntoKg_Qty()
    {
        var nQtyInOne =$('#txtQtyInOne').val();  //icsRemoveComma($('#txtQtyInOne').val());
        var nQtyInTwo= parseFloat(nQtyInOne*_oMUnitCon.Value).toFixed(10);
        $('#txtQtyInTwo').val(nQtyInTwo);
    }

    $("#txtUnitPriceInOne").keyup(function (e){
        debugger;
        ConvertIntoKgs_UnitPrice();
    });
    $("#txtUnitPriceInTwo").keyup(function (e){
        debugger;
        ConvertIntoLbs_UnitPrice();
    });

    function ConvertIntoLbs_UnitPrice()
    {
        var nQtyInTwo =$('#txtUnitPriceInTwo').val();// icsRemoveComma($('#txtUnitPriceInTwo').val());
        var nQtyInOne= parseFloat(nQtyInTwo*_oMUnitCon.Value).toFixed(4);
        $('#txtUnitPriceInOne').val(nQtyInOne);
    }
    function ConvertIntoKgs_UnitPrice()
    {
        var nQtyInOne =$('#txtUnitPriceInOne').val();//icsRemoveComma($('#txtUnitPriceInOne').val());
        var nQtyInTwo= parseFloat(nQtyInOne/_oMUnitCon.Value).toFixed(10);
        $('#txtUnitPriceInTwo').val(nQtyInTwo);
    }
    function GetsProductQty(nProductID) {
        var oDODetails = $('#tblDyeingOrderDetail').datagrid('getRows');
        var nTotalQty = 0;
        for (var i = 0; i < oDODetails.length; i++) {
            if (parseInt(oDODetails[i].ProductID) == parseInt(nProductID)) {
                nTotalQty=nTotalQty+oDODetails[i].Qty;
            }
        }
        return nTotalQty;
    }

    function RefreshSummary()
    {
        var oDODetails = $('#tblDyeingOrderDetail').datagrid('getRows');
        var nTotalQty = 0, nTotalAmount= 0;
        var sMUnit="";
        for(var i = 0; i<oDODetails.length;i++)
        {
            nTotalQty+=parseFloat(oDODetails[i].Qty);
            nTotalAmount+=parseFloat(oDODetails[i].Qty*oDODetails[i].UnitPrice);
            sMUnit=oDODetails[i].MUnit;
        }
        document.getElementById('lblTotalQty').innerHTML = formatPrice(nTotalQty,0)+" "+sMUnit;
        document.getElementById('lblTotalAmount').innerHTML = "$"+formatPrice(nTotalAmount,0);
    }


    $('#btnApprove').click(function () {

        debugger;
        var conf = confirm("Are you sure you want to Approve ?");
        if(conf==false)return;

        if (_oDyeingOrder ==null || _oDyeingOrder.DyeingOrderID <=0 ) { alert("Please select an item from list."); return ; }

        if( _oDyeingOrder.ApproveBy!=0)
        {
            alert("Already Approve.");
            return;
        }
            $.ajax({
                type: "POST",
                dataType: "json",

                url : _sBaseAddress+  "/DyeingOrder/Approve",
                traditional: true,
                data:  JSON.stringify(_oDyeingOrder),

                contentType: "application/json; charset=utf-8",
                success: function (data) {
                    debugger;
                    var oDyeingOrder = jQuery.parseJSON(data);
                    if ( oDyeingOrder.ErrorMessage=="" || oDyeingOrder.ErrorMessage==null )
                    {
                        _oDyeingOrder=oDyeingOrder;
                        alert("Approved sucessfully");
                        var oDyeingOrders =sessionStorage.getItem("DyeingOrders");
                        var nIndex= parseInt(sessionStorage.getItem("SelectedRowIndex"));

                        if(oDyeingOrders!=null)
                        {
                            oDyeingOrders = jQuery.parseJSON(oDyeingOrders);
                        }
                        else
                        {
                            oDyeingOrders=[];
                        }
                        if(nIndex!=-1)
                        {
                            oDyeingOrders[nIndex]=_oDyeingOrder;
                        }
                        else
                        {
                            sessionStorage.setItem("SelectedRowIndex", oDyeingOrders.length);
                            oDyeingOrders.push(oDyeingOrders);
                        }
                        sessionStorage.setItem("DyeingOrders", JSON.stringify(oDyeingOrders));
                        window.location.href = _sBackLink;
                    }
                    else
                    {
                        alert(oDyeingOrder.ErrorMessage);
                    }
                },
                error: function (xhr, status, error) {
                    alert(error);
                }
            });

    });

    $("#btnSave").click(function (){
        if(!Validation()) return false;

        var oDyeingOrder=RefreshObject();
        $('#btnSave').hide();
        var obj = {
            BaseAddress: _sBaseAddress,
            Object: oDyeingOrder,
            ObjectId: oDyeingOrder.DyeingOrderID,
            ControllerName: "DyeingOrder",
            ActionName: "Save",
            TableId: "",
            IsWinClose: false,
            Message: (oDyeingOrder.DyeingOrderID>0)?"Update Successfully." : "Save Successfully."
        };
        $('#btnSave').show();
        $.icsSave(obj, function (response) {
            if (response.status && response.obj != null) {
                if (response.obj.DyeingOrderID > 0)
                {
                   //    response.obj.DyeingOrderDetails=$('#tblDyeingOrderDetail').datagrid('getRows');
                    $('#tblDyeingOrderDetail').empty();
                    RefreshControl(response.obj);
                    var oDyeingOrders =sessionStorage.getItem("DyeingOrders");
                    var nIndex= parseInt(sessionStorage.getItem("SelectedRowIndex"));
                    debugger;
                    if(oDyeingOrders!=null)
                    {
                        oDyeingOrders = jQuery.parseJSON(oDyeingOrders);
                    }
                    else
                    {
                        oDyeingOrders=[];
                    }
                    if(nIndex!=-1)
                    {
                        oDyeingOrders[nIndex]=_oDyeingOrder;
                    }
                    else
                    {
                        sessionStorage.setItem("SelectedRowIndex", oDyeingOrders.length);
                        oDyeingOrders.push(_oDyeingOrder);
                    }
                    sessionStorage.setItem("DyeingOrders", JSON.stringify(oDyeingOrders));

                }
            }
        });
    });


    $("#btnSave_Revise").click(function (){
        debugger;
        if(!Validation()) return false;

        var oDyeingOrder=RefreshObject();
        oDyeingOrder.ReviseDate=$('#dtReviseDate').datebox('getValue');
        oDyeingOrder.ReviseNote=$.trim($('#txtReviseNote').val());
        if ($("#chkIsCreateReviseNo").is(':checked'))
        {
            oDyeingOrder.IsCreateReviseNo=true;
            //if( $('#txtReviseNote').val()==null ||$('#txtReviseNote').val()=="")
            //{
            //    $('#txtReviseNote').focus();
            //    $('#txtReviseNote').addClass("errorFieldBorder");
            //    alert('Please entry Revise Note.');
            //    return false;
            //}
            //else{
            //    $('#txtReviseNote').removeClass("errorFieldBorder");
            //}
            if (!confirm("Confirm to Change this Order with Revise No ?")) return false;
        }else{
            oDyeingOrder.IsCreateReviseNo=false;
            if (!confirm("Confirm to Change this Order without Revise No ?")) return false;
        }
        $.ajax({
            type: "POST",
            dataType: "json",
            url : _sBaseAddress+"/DyeingOrder/Save_Log",
            traditional: true,
            data:  JSON.stringify(oDyeingOrder),
            contentType: "application/json; charset=utf-8",
            success: function (data) {
               
                var oDO= jQuery.parseJSON(data);
                           
                if (oDO.ErrorMessage=="" || oDO.ErrorMessage==null)
                {
                    alert("Data Save Succesfully!!");
                    debugger;
                    var oDyeingOrders =sessionStorage.getItem("DyeingOrders");
                    var nIndex= parseInt(sessionStorage.getItem("SelectedRowIndex"));
                  
                    if(oDyeingOrders!=null)
                    {
                        oDyeingOrders = jQuery.parseJSON(oDyeingOrders);
                    }
                    else
                    {
                        oDyeingOrders=[];
                    }
                    if(nIndex>-1)
                    {
                        oDyeingOrders[nIndex]=oDO;
                    }
                    else
                    {
                        sessionStorage.setItem("SelectedRowIndex", oDyeingOrders.length);
                        oDyeingOrders.push(oDO);
                    }
                    sessionStorage.setItem("DyeingOrders", JSON.stringify(oDyeingOrders));
                    window.location.href = _sBackLink;
                }
                else
                {
                    alert(oDO.ErrorMessage);
                }
            },
            error: function (xhr, status, error)
            {
                alert(error);
            }
        });
    });
    $("#btnCancel").click(function (){
        debugger;
        if(!Validation()) return false;


        var oDyeingOrder=RefreshObject();
        if( oDyeingOrder==null)
        {
            alert(" Something Wrong. Please Check!!");
        }

        if(oDyeingOrder.DyeingOrderID>0)
        {
            $.ajax({
                type: "POST",
                dataType: "json",
                url : _sBaseAddress+  "/DyeingOrder/DOCancel",
                traditional: true,
                data:  JSON.stringify(oDyeingOrder),
                contentType: "application/json; charset=utf-8",
                success: function (data) {

                    var  oDyeingOrder = jQuery.parseJSON(data);
                    if (oDyeingOrder.ErrorMessage=="" || oDyeingOrder.ErrorMessage==null) {
                        alert("Cancel successfully");
                        _oDyeingOrder=oDyeingOrder;

                        var oDyeingOrders =sessionStorage.getItem("DyeingOrders");
                        var nIndex= parseInt(sessionStorage.getItem("SelectedRowIndex"));

                        if(oDyeingOrders!=null)
                        {
                            oDyeingOrders = jQuery.parseJSON(oDyeingOrders);
                        }
                        else
                        {
                            oDyeingOrders=[];
                        }
                        if(nIndex!=-1)
                        {
                            oDyeingOrders[nIndex]=_oDyeingOrder;
                        }
                        else
                        {
                            sessionStorage.setItem("SelectedRowIndex", oDyeingOrders.length);
                            oDyeingOrders.push(oDyeingOrders);
                        }
                        sessionStorage.setItem("DyeingOrders", JSON.stringify(oDyeingOrders));
                        window.location.href = _sBackLink;
                    }
                    else
                    {
                        alert(oDyeingOrder.ErrorMessage);
                    }
                },
                error: function (xhr, status, error) {
                    alert(error);
                }


            });
        }

        else
        {
            alert("Please Select valid Order.");
        }


    });


    $('#btnNew').click(function(e){

        if(!Validation()) return false;

        var oDyeingOrder=RefreshObject();
        var obj = {
            BaseAddress: _sBaseAddress,
            Object: oDyeingOrder,
            ObjectId: oDyeingOrder.DyeingOrderID,
            ControllerName: "DyeingOrder",
            ActionName: "Save",
            TableId: "",
            IsWinClose: false,
            Message: (oDyeingOrder.DyeingOrderID>0)?"Update Successfully." : "Save Successfully."
        };
        $.icsSave(obj, function (response) {
            if (response.status && response.obj != null) {
                if (response.obj.DyeingOrderID > 0)
                {
                    //    response.obj.DyeingOrderDetails=$('#tblDyeingOrderDetail').datagrid('getRows');
                    $('#tblDyeingOrderDetail').empty();
                    RefreshControl(response.obj);

                }
            }
        });

        sessionStorage.setItem("Operation", "New");
        sessionStorage.setItem("SelectedRowIndex", -1);
        sessionStorage.setItem("DOHeader", "Add Order");
        sessionStorage.setItem("DyeingOrders", JSON.stringify($('#tblDyeingOrder').datagrid('getRows')));
        sessionStorage.setItem("BackLink", window.location.href);
        sessionStorage.setItem("BUID", sessionStorage.getItem("BUID"));
        var tsv=((new Date()).getTime())/1000;
        window.location.href = _sBaseAddress+ "/DyeingOrder/ViewDyeingOrder?nId=0&ts="+tsv;

    });
    $('#btnPrint').click(function (e)
    {

        if (_oDyeingOrder ==null || _oDyeingOrder.DyeingOrderID <=0 ) { alert("Please select an item from list."); return ; }
        var tsv=((new Date()).getTime())/1000;
        var bIsPrintHistory= $("#chkIsPrintHistory").is(":checked");
        window.open(_sBaseAddress+ "/DyeingOrder/PrintDyeingOrder?nId="+_oDyeingOrder.DyeingOrderID+"&bIsPrintHistory="+bIsPrintHistory+"&nts="+tsv, "_blank");

    });

    $("#btnReLoad_CPIssueTo").click(function ()
    {
        if(_oDyeingOrder==null)
        {
            alert("Please, Pick valid Issue To ");
            return;
        }
        if(_oDyeingOrder.ContractorID<=0)
        {
            alert("Please, Pick valid Issue To ");
            return;
        }
         GetContactPersonel(_oDyeingOrder.ContractorID, true);
    });
    $("#btnReLoad_CPDeliverTo").click(function ()
    {
        if(_oDyeingOrder==null)
        {
            alert("Please, Pick valid Deliver To ");
            return;
        }
        if(_oDyeingOrder.DeliveryToID<=0)
        {
            alert("Please, Pick valid Deliver To ");
            return;
        }
         GetContactPersonel(_oDyeingOrder.DeliveryToID, false);

    });

    /////Instraction///--
    function PickDONote() {

        var oDyeingOrderNote = {
            Note:"",
            DyeingOrderID:0,
            DyeingOrderNoteID:0,
            ContractorID:_oDyeingOrder.ContractorID
        };
        var obj = {
            BaseAddress: _sBaseAddress,
            Object: oDyeingOrderNote,
            ControllerName: "DyeingOrderNote",
            ActionName: "GetsByCon",
            IsWinClose: false
        };
        $("#progressbar").progressbar({ value: 0 });
        $("#progressbarParent").show();
        var intervalID = setInterval(updateProgress, 250);
        $.icsDataGets(obj, function (response) {
            clearInterval(intervalID);
            $("#progressbarParent").hide();
            if (response.status && response.objs.length > 0) {
                if (response.objs[0].DyeingOrderNoteID > 0)
                {
                    debugger;
                    $("#winDONote input").val("");
                    sessionStorage.setItem('DyeingOrderNote',JSON.stringify(response.objs));
                    DynamicRefreshList(response.objs, "tblDONote");
                    $("#winDONote").icsWindow('open', "Special instruction Picker");
                }
                else {
                    sessionStorage.setItem('DyeingOrderNote',JSON.stringify([]));
                    alert(response.objs[0].ErrorMessage);
                }
            }
            else {
                alert("Sorry, There is No Terms and Condition Found.");
            }
        });
    }

    $("#btnOkDyeingOrderNote").click(function () {
        debugger;
        var oSelectedObjs = $('#tblDONote').datagrid('getChecked');
        if(oSelectedObjs.length>0)
        {
            //var oExistingItems = [];
            //oExistingItems = $('#tblDONote_DO').datagrid('getRows');
            if(_oDyeingOrder.DyeingOrderID<=0)
            {
                alert("Invaild Order");
                return;
            }
            for(var i = 0;i<oSelectedObjs.length;i++)
            {
                var oDONote = {
                    DyeingOrderNoteID: 0,
                    DyeingOrderID: _oDyeingOrder.DyeingOrderID,
                    Sequence:0,
                    OrderNote: oSelectedObjs[i].OrderNote
                };
                var bExists= IsExist(oSelectedObjs[i].OrderNote)
                if(!bExists)
                {
                    $('#tblDONote_DO').datagrid('appendRow', oDONote);
                }

            }
        }
        $("#winDONote").icsWindow('close');
    });
    function Save_DUColorCombo(oDODetails)
    {
      
        if(_oDyeingOrder.DyeingOrderID<=0)
        {
            alert("Invaild Order");
            return;
        }
        
        if(parseInt($("#cboDUColorCombo").val())<=0)
        {
            alert("Invalid Selection!!! please select a valid Type!");
            $('#cboDUColorCombo').focus();
            return ;
        }
        var oDUColorCombos=[];
        for(var i = 0;i<oDODetails.length;i++)
        {
            var oDUColorCombo = {
                DUColorComboID: 0,
                ComboID:parseInt($("#cboDUColorCombo").val()),
                DyeingOrderID: _oDyeingOrder.DyeingOrderID,
                ColorName:oDODetails[i].ColorName,
                Sequence:0,
                DyeingOrderDetailID: oDODetails[i].DyeingOrderDetailID
            };
            oDUColorCombos.push(oDUColorCombo);
            // $('#tblDUColorCombo').datagrid('appendRow', oDONote);
        }
       
        $.ajax({
            type: "POST",
            dataType: "json",
            url : _sBaseAddress+"/DyeingOrder/Save_DUColorCombo",
            traditional: true,
            data:  JSON.stringify(oDUColorCombos),
            contentType: "application/json; charset=utf-8",
            success: function (data) {
                debugger;
                var oDUColorCombos= jQuery.parseJSON(data);
                if (oDUColorCombos.length>0)
                {
                    DynamicRefreshList(oDUColorCombos, 'tblDUColorCombo');
                    alert("Data Save Succesfully!!");
                }
                else
                {
                    alert(oDUColorCombos[0].ErrorMessage);
                }
            },
            error: function (xhr, status, error)
            {
                alert(error);
            }
        });
    }
    $("#btnRemoveDUColorCombo").click(function () {
        debugger;
        var oDUColorCombo = $("#tblDUColorCombo").datagrid("getSelected");
        if (oDUColorCombo == null) { alert("Please select an item from list!"); return false; }
        var nIndex=$('#tblDUColorCombo').datagrid('getRowIndex',oDUColorCombo);
        if (!confirm("Confirm to Delete?")) return false;

        if(oDUColorCombo.DyeingOrderID<=0)
        {
            $("#tblDUColorCombo").datagrid("deleteRow", nIndex);
        }
        else
        {
            var obj =
                     {
                         BaseAddress: _sBaseAddress,
                         Object: oDUColorCombo,
                         ControllerName: "DyeingOrder",
                         ActionName: "DeleteDUColorCombo",
                         TableId: "tblDUColorCombo",
                         IsWinClose: false
                     };
            $.icsDelete(obj);
        }

    });
   
    function IsExist(nNote)
    {
        var oDONotes = $('#tblDONote_DO').datagrid('getRows');
        for (var i = 0; i < oDONotes.length; i++) {
            if (oDONotes[i].OrderNote === nNote)
            {
                return true;
            }
        }
        return false;
    }

    $("#btnCloseDONote").click(function () {
        $("#winDONote").icsWindow('close');
    });
    $('#txtDONote').keyup(function (e) {
        var c = String.fromCharCode(e.which);
        var txtDONote = $('#txtDONote').val();
        var oSearchedPITAndCs = [];  var sTempName="";
        var oDyeingOrderNotes = $('#tblDONote').datagrid('getRows');
        if (e.which == 8)
        {
            oDyeingOrderNotes = jQuery.parseJSON(sessionStorage.getItem('DyeingOrderNote'));
        }
        for(var i=0;i<oDyeingOrderNotes.length;++i){
            sTempName=oDyeingOrderNotes[i].OrderNote;
            n=sTempName.toUpperCase().indexOf(txtDONote.toUpperCase())
            if(n!=-1)
            {
                oSearchedPITAndCs.push(oDyeingOrderNotes[i]);
            }
        }
        DynamicRefreshList(oSearchedPITAndCs, "tblDONote");
    });


    function RefreshDONote()
    {
        endEditingTC();
        sTableId='tblDONote_DO';
        var oTermsConditions = $('#'+sTableId).datagrid('getRows');
        DynamicRefreshList(oTermsConditions, sTableId);
    }

    function RemoveDONote()
    {
        var oDyeingOrderNote = $("#tblDONote_DO").datagrid("getSelected");
        if (oDyeingOrderNote == null) { alert("Please select an item from list!"); return false; }
        var nIndex=$('#tblDONote_DO').datagrid('getRowIndex',oDyeingOrderNote);
        if (!confirm("Confirm to Delete?")) return false;

        if(oDyeingOrderNote.DyeingOrderNoteID<=0)
        {
            $("#tblDONote_DO").datagrid("deleteRow", nIndex);
        }
        else
        {
            var obj =
                     {
                         BaseAddress: _sBaseAddress,
                         Object: oDyeingOrderNote,
                         ControllerName: "DyeingOrderNote",
                         ActionName: "DeleteDyeingOrderNote",
                         TableId: "tblDONote_DO",
                         IsWinClose: false
                     };
            $.icsDelete(obj);
        }

    }
    var editTCIndex = undefined;
    function endEditingTC() {
        if (editTCIndex == undefined) { return true }
        if ($('#tblDONote_DO').datagrid('validateRow', editTCIndex)) {

            $('#tblDONote_DO').datagrid('endEdit', editTCIndex);
            editTCIndex = undefined;
            return true;
        }
        else {
            return false;
        }
    }

    function onClickRowTC(index) {

        if (editTCIndex != index) {
            if (endEditingTC()) {
                $('#tblDONote_DO').datagrid('selectRow', index)
                        .datagrid('beginEdit', index);
                editTCIndex = index;
            }
            else {
                $('#tblDONote_DO').datagrid('selectRow', editTCIndex);
            }
        }
    }

    $("#btnSaveDONote").click(function (){
        debugger;
        endEditingTC();
        // if (!ValidateInputFabricSalesContract()) return;

        if (_oDyeingOrder.DyeingOrderID <= 0 || _oDyeingOrder == null)
        {
            alert("Please, First save Order from  previous tab!");
            return ;
        }
        if (_oDyeingOrder.DeliveryZoneID <= 0 )
        {
            alert("Please, First save Delivery info !");
            return ;
        }
        //if (_oFabricSalesContract.CurrentStatusInt>=3)
        //{
        //    alert("Already approve");

        //    return false;
        //}
        var oDyeingOrderNotes = $("#tblDONote_DO").datagrid("getRows");
        //if(oDyeingOrderNotes.length>0)
        //{
        var oDyeingOrder={DyeingOrderID:_oDyeingOrder.DyeingOrderID,DeliveryNote:$.trim($("#txtDeliveryZone").val())};

        var oDyeingOrderNote = {
            DyeingOrderNoteID: 0,
            DyeingOrderID: _oDyeingOrder.DyeingOrderID,
            DyeingOrder: oDyeingOrder,
            DyeingOrderNotes: oDyeingOrderNotes,
           

        };

        $.ajax({
            type: "POST",
            dataType: "json",
            url : _sBaseAddress+"/DyeingOrderNote/Save_DONote",
            traditional: true,
            data:  JSON.stringify(oDyeingOrderNote),
            contentType: "application/json; charset=utf-8",
            success: function (data) {
                debugger;
                var oDyeingOrderNote= jQuery.parseJSON(data);
                if (oDyeingOrderNote.ErrorMessage=="" || oDyeingOrderNote.ErrorMessage==null)
                {
                    //_oDyeingOrderNotes=oFabricSalesContract.DyeingOrderNotes;
                    //DynamicRefreshList(_oDyeingOrderNotes, "tblDONote_DO");
                    alert("Data Save Succesfully!!");

                    window.location.href = _sBackLink;
                }
                else
                {
                    alert(oDyeingOrderNote.ErrorMessage);
                }
            },
            error: function (xhr, status, error)
            {
                alert(error);
            }
        });
        //}
        //else{
        //    window.location.href = _sBackLink;
        //}
    });
    
    $('#btnEditDeliveryZone').click(function(e){
        debugger;
        if(_oDyeingOrder.DeliveryZoneID<=0)
        {
            alert("First, Select a Delivery Place");
            $("#txtDeliveryZoneNew").focus();
            return;
        }
        var oDeliveryZone = {
            DeliveryZoneID  : _oDyeingOrder.DeliveryZoneID,
            DeliveryZoneName :""
        };
        AddDeliveryZone(oDeliveryZone);

    });
    $('#btnNewDeliveryZone').click(function(e){
        debugger;
        if(_oDyeingOrder.DyeingOrderID<=0)
        {
            alert("First, Save Order");
            $("#txtDeliveryZoneNew").focus();
            return;
        }
       
        $("#winDeliveryZone input").val("");
        var oDeliveryZone = {
            DeliveryZoneID  : 0,
            DeliveryZoneName :""
        };
        AddDeliveryZone(oDeliveryZone);
    });
    function AddDeliveryZone(oDeliveryZone)
    {
        $("#winDeliveryZone input").val("");
        var obj =
           {
               BaseAddress: _sBaseAddress,
               Object: oDeliveryZone,
               ControllerName: "DeliveryZone",
               ActionName: "Get",
               IsWinClose: false
           };
        $.icsDataGet(obj, function (response) {
        
            if (response.status && response.obj != null) 
            {
                $("#txtDeliveryZoneNew").val(response.obj.DeliveryZoneName);
                _oDyeingOrder.DeliveryZoneID=response.obj.DeliveryZoneID;
                $("#winDeliveryZone").icsWindow("open","Delivery Zone");
                //else { alert(response.obj.ErrorMessage); }
            }
           
        });
        
    }


    $('#btnSaveDeliveryZone').click(function(e){
      
        if(_oDyeingOrder.DyeingOrderID<=0)
        {
            alert("First, Save Order");
            $("#txtDeliveryZoneNew").focus();
            return;
        }

        var oDeliveryZone = {
            DeliveryZoneID  : _oDyeingOrder.DeliveryZoneID,
            DeliveryZoneName : $.trim($("#txtDeliveryZoneNew").val())
        };
        if (!confirm("Confirm to Save new Delivery Zone?")) return;
        var obj = {
            BaseAddress: _sBaseAddress,
            Object: oDeliveryZone,
            ObjectId: oDeliveryZone.DeliveryZoneID,
            ControllerName: "DeliveryZone",
            ActionName: "SaveDeliveryZone",
            TableId: "",
            IsWinClose: true,
            Message:""
        };
        $.icsSave(obj, function (response) {
            if (response.status && response.obj != null) {
                if (response.obj.DeliveryZoneID > 0) {
                    _oDyeingOrder.DeliveryZoneID=response.obj.DeliveryZoneID;
                    $("#txtDeliveryZone").val(response.obj.DeliveryZoneName);
                    $("#winDeliveryZone").icsWindow("close");
                }
            }
        });
    });
    $("#btnCloseDeliveryZone").click(function () {
        debugger;
        $("#winDeliveryZone").icsWindow("close");

    });

    //// Color Com bo
    $('#tabOrder').tabs({
        onSelect:function(title){
        
            if(title=="Specification")
            { 
                if(_oDyeingOrder.DyeingOrderID>0)
                {
                    GetsDUCCombo(_oDyeingOrder);
                }
            }
          
        }
    });
    $("#btnReloadLot").click(function() {
        if(_oDyeingOrder==null || _oDyeingOrder.DyeingOrderID<=0)
        {
            alert("Please, Pick a Valid DL No."); return false; 
        }
        if(_oDyeingOrder.DyeingOrderID>0)
        {
            GetsDUCCombo(_oDyeingOrder);
        }
    });

    function GetsDUCCombo(oDyeingOrder)
    {
    
     
        var obj = {
            BaseAddress: _sBaseAddress,
            Object: oDyeingOrder,
            ControllerName: "DyeingOrder",
            ActionName: "Gets_DUColorCombo",
            IsWinClose: false
        };
        $.icsDataGets(obj, function (response) {
            debugger;
            if (response.status && response.objs.length > 0)
            {
                var oDUCCombos= response.objs;
                
                DynamicRefreshList(oDUCCombos, 'tblDUColorCombo');
                
            }
        });
    }

    ////Sequence
    function UP()
    {
        debugger;
        var oRSD = $('#tblDyeingOrderDetail').datagrid('getSelected');
        if(oRSD==null)
        {
            alert("Please select Item");
            return;
        }
        var SelectedRowIndex=$('#tblDyeingOrderDetail').datagrid('getRowIndex',oRSD);
        if(SelectedRowIndex==0)return;
        var oRSDs=$('#tblDyeingOrderDetail').datagrid('getRows');
        _oDODetailDs = [];
        for(var i=0; i<oRSDs.length; i++)
        {
            if(i==(SelectedRowIndex-1))
            {
                _oDODetailDs[i]=oRSDs[i+1];
            }
            else if(i==SelectedRowIndex)
            {
                _oDODetailDs[i]=oRSDs[i-1];
            }
            else
            {
                _oDODetailDs[i]=oRSDs[i];
            }
            _oDODetailDs[i].SL=i+1;
        }
        DynamicRefreshList(_oDODetailDs, 'tblDyeingOrderDetail');
        var newSelectedRowIndex=SelectedRowIndex-1;
        $('#tblDyeingOrderDetail').datagrid('selectRow',newSelectedRowIndex);

    }
    function Down()
    {
        debugger;
        var oRSD = $('#tblDyeingOrderDetail').datagrid('getSelected');
        if(oRSD==null)
        {
            alert("Please select a item from list!");
            return;
        }
        var SelectedRowIndex=$('#tblDyeingOrderDetail').datagrid('getRowIndex',oRSD);
        if(SelectedRowIndex==(_oDODetailDs.length-1))return;
        var oRSDs=$('#tblDyeingOrderDetail').datagrid('getRows');
        _oDODetailDs = [];
        for(var i=0; i<oRSDs.length; i++)
        {
            if(i==(SelectedRowIndex+1))
            {
                _oDODetailDs[i]=oRSDs[i-1];
            }
            else if(i==SelectedRowIndex)
            {
                _oDODetailDs[i]=oRSDs[i+1];
            }
            else
            {
                _oDODetailDs[i]=oRSDs[i];
            }
            _oDODetailDs[i].SL=i+1;
        }
        DynamicRefreshList(_oDODetailDs, 'tblDyeingOrderDetail');
        var newSelectedRowIndex=SelectedRowIndex+1;
        $('#tblDyeingOrderDetail').datagrid('selectRow',newSelectedRowIndex);
    }
    function RefreshSequence()
    {
        var oRSDs = $('#tblDyeingOrderDetail').datagrid('getRows');
        if(oRSDs.length>0)
        {
            for(var i = 0;i<oRSDs.length;i++)
            {
                oRSDs[i].SL = i+1;
            }
          
            DynamicRefreshList(oRSDs, 'tblDyeingOrderDetail');
        }
    }

    $("#btnAddDUColorCombo").click(function () {
        GetsDODetails();
    });
    function GetsDODetails(sName){

        var oDyeingOrderDetail = {
            DyeingOrderID:_oDyeingOrder.DyeingOrderID,
            ColorName:''
        };
        var obj = {
            BaseAddress: _sBaseAddress,
            Object: oDyeingOrderDetail,
            ControllerName: "DyeingOrder",
            ActionName: "GetsDOD",
            IsWinClose: false
        };
        $("#progressbar").progressbar({ value: 0 });
        $("#progressbarParent").show();
        var intervalID = setInterval(updateProgress, 250);
        $.icsDataGets(obj, function (response) {
            clearInterval(intervalID);
            $("#progressbarParent").hide();
            if (response.status && response.objs.length > 0) {
                if (response.objs[0].DyeingOrderDetailID > 0) {
                    debugger;
                    var tblColums = [];
                    var oColumn = { field: "ColorName", title: "Code", width: 50, align: "left" };tblColums.push(oColumn);
                    oColumn = { field: "ColorNo", title: "Name", width: 250, align: "left" };tblColums.push(oColumn);

                    var oPickerParam = {
                        winid: 'winDoDColorCombo',
                        winclass:'clsDoDColorComboPicker',
                        winwidth: 460,
                        winheight: 460,
                        tableid: 'tblDoDColorComboPicker',
                        tablecolumns: tblColums,
                        datalist: response.objs,
                        multiplereturn: true,
                        searchingbyfieldName:'ColorName',
                        windowTittle: 'Color List'
                    };
                    $.icsPicker(oPickerParam);
                    IntializePickerbutton(oPickerParam);//multiplereturn, winclassName
                }
                else { alert(response.objs[0].ErrorMessage); }
            }
            else{
                alert("Color Not Found.");
            }
        });


    }
    function UpdateMasterBuyers(nMBuyerID)
    {
        if(_oDyeingOrder==null || _oDyeingOrder.DyeingOrderID<=0)
        {
            alert("Invalid Name!");
            return false;
        }
        if(_oDyeingOrder.DyeingOrderID<=0)
        {
            alert("Order not found!");
            return false;
        }
           
        // if(!ValidateInput()) return;
        var oDyeingOrder={DyeingOrderID:_oDyeingOrder.DyeingOrderID,MBuyerID:nMBuyerID}

        if (!confirm("Confirm to Update End Buyer Name?")) return false;
     
        var obj = {
            BaseAddress: _sBaseAddress,
            Object: oDyeingOrder,
            ObjectId: oDyeingOrder.DyeingOrderID,
            ControllerName: "DyeingOrder",
            ActionName: "UpdateMasterBuyer",
            TableId: "",
            IsWinClose: false
        };
        $.icsSave(obj, function (response)
        {
            if (response.status && response.obj != null) {
                if (response.obj.DyeingOrderID > 0)
                {
                 
                  
                }
            }
        });
    }
</script>