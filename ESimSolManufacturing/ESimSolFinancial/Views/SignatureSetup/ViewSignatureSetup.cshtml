<html>
<body>
    @{
        ViewBag.Title = "Signature Setup";
    }
    @model IEnumerable<ESimSol.BusinessObjects.SignatureSetup>
    <div id="winSignatureSetup" class="easyui-window" title="Edit Signature Setup" style="width:400px;height:240px" data-options="modal:true,closed:true,collapsible:false,minimizable:false,maximizable:false,closable:false">
        <div>
            <fieldset style="margin-top:3px">
                <legend style="font-weight:bold">Update Info : </legend>
                <table border="0" cellspacing="2" cellpadding="2" style="font-size:11px; font-weight:bold">
                    <tr>
                        <td style="width:125px; text-align:right">
                            Report Module :
                        </td>
                        <td style="width:250px">
                            <input type="text" id="txtReportModuleEdit" style="width:100%" disabled="disabled" />
                        </td>
                    </tr>
                    <tr>
                        <td style="width:125px; text-align:right">
                            Signature Caption :
                        </td>
                        <td style="width:250px">
                            <input type="text" id="txtSignatureCaptionEdit" style="width:100%" />
                        </td>
                    </tr>
                    <tr>
                        <td style="width:125px; text-align:right">
                            Display Data Column :
                        </td>
                        <td style="width:250px">
                            <input type="text" id="txtDisplayDataColumnEdit" style="width:100%" />
                        </td>
                    </tr>
                    <tr>
                        <td style="width:125px; text-align:right">
                            Display Fixed Name :
                        </td>
                        <td style="width:250px">
                            <input type="text" id="txtDisplayFixedNameEdit" style="width:100%" />
                        </td>
                    </tr>
                </table>
            </fieldset>
        </div>
        <fieldset style="width:99%;height:60px; vertical-align:top;">
            <legend style="font-weight:bold"> Action : </legend>
            <table border="0" cellspacing="2" cellpadding="2" style="font-size:11px; font-weight:bold;">
                <tr>
                    <td style="width:7%;text-align:right;">
                        <a id="btnSaveEdit" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-save" plain="true">Update</a>
                        <a id="btnCloseEdit" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-cancel" plain="true">Close</a>
                    </td>
                </tr>
            </table>
        </fieldset>
    </div>

    <div id="divSignatureSetup" class="easyui-panel" title="" style="font-family:Tahoma; height:100%; width:100%">
        <table id="tblSignatureSetup" title="Signature Setup" class="easyui-datagrid" style="width:100%;height:100%" data-options="singleSelect: true,fitColumns:true,rownumbers:true,pagination:true,autoRowHeight:false,toolbar: '#toolbar'">
            <thead>
                <tr>
                    <th field="ReportModuleSt" width="200" align="left">Report Module</th>
                    <th field="SignatureCaption" width="200" align="left">Signature Caption</th>
                    <th field="DisplayDataColumn" width="200" align="left">Display Data Column</th>
                    <th field="DisplayFixedName" width="200" align="left">Display Fixed Name</th>
                    <th field="SignatureSequence" width="100" align="center">Sequence</th>
                </tr>
            </thead>
        </table>
        <div style="text-align:left" id="toolbar">
            Report Module : <select id="cboReportModule" style="width:200px"> </select>            
            <input type="text" id="txtSignatureCaption" style="width:160px" placeholder="Signature Caption" />
            <input type="text" id="txtDisplayDataColumn" style="width:160px" placeholder="Display Data Column" />
            <input type="text" id="txtDisplayFixedName" style="width:160px" placeholder="Display Fixed Name" />
            <a id="btnAdd" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-add" plain="true">Add</a>
            <a id="btnEdit" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-edit" plain="true">Edit</a>
            <a id="btnDelete" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-remove" plain="true">Remove</a>
            <a id="btnRefresh" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-reload" plain="true"></a>
        </div>     
    </div>
</body>
</html>


<script type="text/javascript">
    $(document).ready(function () {
        var oSignatureSetups =@Html.Raw( new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(Model));
        var oReportModules =@Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(ViewBag.ReportModules));     
        RefreshList(oSignatureSetups);
        $("#cboReportModule").icsLoadCombo({List: oReportModules, OptionValue: "id",DisplayText: "Value"});
    });

    function ValidateInput()
    {
        if($('#cboReportModule').val()===null || $('#cboReportModule').val()===undefined || parseInt($('#cboReportModule').val())<=0)
        {
            alert("Please select Report Module!");
            $('#cboReportModule').focus();
            return false;
        }
        if($('#txtSignatureCaption').val()===null || $('#txtSignatureCaption').val()===undefined || $.trim($('#txtSignatureCaption').val())==="")
        {
            alert("Please enter SignatureCaption!");
            $('#txtSignatureCaption').focus();
            return false;
        }
        return true;
    }


    function RefreshObject()
    {
        var oSignatureSetup=   {
            SignatureSetupID : 0,
            ReportModule : parseInt($('#cboReportModule').val()),
            ReportModuleInt : parseInt($('#cboReportModule').val()),
            SignatureCaption : $.trim($('#txtSignatureCaption').val()),
            SignatureSequence : 0,
            DisplayDataColumn : $.trim($('#txtDisplayDataColumn').val()),
            DisplayFixedName : $.trim($('#txtDisplayFixedName').val())
        };
        return oSignatureSetup;
    }

    $("#btnAdd").click(function(){
        if(!ValidateInput()) return;
        var oSignatureSetup=RefreshObject();
        $.ajax({
            type: "POST",
            dataType: "json",
            url : sessionStorage.getItem("BaseAddress")+  "/SignatureSetup/SaveSignatureSetup",
            traditional: true,
            data:  JSON.stringify(oSignatureSetup),
            contentType: "application/json; charset=utf-8",
            success: function (data) {
                var oSignatureSetup = jQuery.parseJSON(data);
                if(parseInt(oSignatureSetup.SignatureSetupID)>0)
                {
                    alert("Data Saved sucessfully");
                    var nIndex=$('#tblSignatureSetup').datagrid('getRows').length;
                    $('#tblSignatureSetup').datagrid('appendRow',oSignatureSetup);
                    $('#tblSignatureSetup').datagrid('selectRow', nIndex);
                    $("#cboReportModule").val(0);                
                    $("#txtSignatureCaption,#txtDisplayDataColumn,#txtDisplayFixedName").val('');                    
                }
                else {
                    alert(oSignatureSetup.ErrorMessage);
                }
            },
            error: function (xhr, status, error) {
                alert(error);
            }
        });
    });

    $('#btnDelete').click(function(e){
        var oSignatureSetup = $('#tblSignatureSetup').datagrid('getSelected');
        if(oSignatureSetup===null || parseInt(oSignatureSetup.SignatureSetupID)<=0)
        {
            alert("Please select a item from list!");
            return;
        }
        var conf = confirm("Confirm to delete?");
        if(conf==false)return;
        var SelectedRowIndex=$('#tblSignatureSetup').datagrid('getRowIndex',oSignatureSetup);
        if (parseInt(oSignatureSetup.SignatureSetupID)> 0)
        {
            $.ajax({
                type: "POST",
                dataType: "json",
                url : sessionStorage.getItem("BaseAddress")+  "/SignatureSetup/DeleteSignatureSetup",
                traditional: true,
                data:  JSON.stringify(oSignatureSetup),
                contentType: "application/json; charset=utf-8",            
                success: function (data) {
                    feedbackmessage = jQuery.parseJSON(data);
                    if (feedbackmessage == "Deleted")
                    {
                        alert("Delete sucessfully");
                        $('#tblSignatureSetup').datagrid('deleteRow',SelectedRowIndex);
                        window.location.href = window.location.href;
                    }
                    else
                    {
                        alert(feedbackmessage);
                    }
                },
                error: function (xhr, status, error)
                {
                    alert(error);
                }
            });
        }
    });

    function RefreshList(oSignatureSetups)
    {
        var data=oSignatureSetups;
        data={"total":""+data.length+"","rows":data};
        $('#tblSignatureSetup').datagrid('loadData',data);
    }

    $("#btnRefresh").click(function(){
        var data=$('#tblSignatureSetup').datagrid('getRows');
        data={"total":""+data.length+"","rows":data};
        $('#tblSignatureSetup').datagrid('loadData',data);
    });

    $('#btnEdit').click(function(e){
        var oSignatureSetup = $('#tblSignatureSetup').datagrid('getSelected');
        if(oSignatureSetup===null || parseInt(oSignatureSetup.SignatureSetupID)<=0)
        {
            alert("Please select a item from list!");
            return;
        }
        $("#winSignatureSetup input").not("input[type='button']").val("");
        
        $('#winSignatureSetup').data('SignatureSetup', oSignatureSetup);
        $('#txtReportModuleEdit').val(oSignatureSetup.ReportModuleSt);
        $('#txtSignatureCaptionEdit').val(oSignatureSetup.SignatureCaption);
        $('#txtDisplayDataColumnEdit').val(oSignatureSetup.DisplayDataColumn);
        $('#txtDisplayFixedNameEdit').val(oSignatureSetup.DisplayFixedName);
        $("#winSignatureSetup").icsWindow('open', "Edit Signature Setup");
    });

    $('#btnSaveEdit').click(function(){        
        var oSignatureSetup = $('#winSignatureSetup').data('SignatureSetup');
        if(oSignatureSetup===null || parseInt(oSignatureSetup.SignatureSetupID)<=0)
        {
            alert("Invalid Signature Setup!");            
            return false;
        }
        if(oSignatureSetup===null || parseInt(oSignatureSetup.SignatureSetupID)<=0)
        {
            alert("Invalid Signature Setup!");            
            return false;
        }
        if($('#txtSignatureCaptionEdit').val()===null || $('#txtSignatureCaptionEdit').val()===undefined || $.trim($('#txtSignatureCaptionEdit').val())==="")
        {
            alert("Please enter SignatureCaption!");
            $('#txtSignatureCaptionEdit').focus();
            return false;
        }
        var SelectedRowIndex=$('#tblSignatureSetup').datagrid('getRowIndex',oSignatureSetup);
        var oSignatureSetupObj =   {
            SignatureSetupID : parseInt(oSignatureSetup.SignatureSetupID),
            ReportModule : parseInt(oSignatureSetup.ReportModuleInt),
            ReportModuleInt : parseInt(oSignatureSetup.ReportModuleInt),
            SignatureCaption : $.trim($('#txtSignatureCaptionEdit').val()),            
            DisplayDataColumn : $.trim($('#txtDisplayDataColumnEdit').val()),
            DisplayFixedName : $.trim($('#txtDisplayFixedNameEdit').val())
        };
       
        $.ajax({
            type: "POST",
            dataType: "json",
            url : sessionStorage.getItem("BaseAddress")+  "/SignatureSetup/SaveSignatureSetup",
            traditional: true,
            data:  JSON.stringify(oSignatureSetupObj),
            contentType: "application/json; charset=utf-8",
            success: function (data) {
                var oSignatureSetup = jQuery.parseJSON(data);
                if(parseInt(oSignatureSetup.SignatureSetupID)>0)
                {
                    alert("Data Saved sucessfully");
                    $('#tblSignatureSetup').datagrid('updateRow',{index: SelectedRowIndex,	row: oSignatureSetup});
                    $("#winSignatureSetup").icsWindow('close');
                }
                else {
                    alert(oSignatureSetup.ErrorMessage);
                }
            },
            error: function (xhr, status, error) {
                alert(error);
            }
        });
    });

    $('#btnCloseEdit').click(function(){
        $("#winSignatureSetup").icsWindow('close');
    });
</script>