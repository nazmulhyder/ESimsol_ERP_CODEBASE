<html>
<head>
    @{
        ViewBag.Title = "QC Test Group";
    }
</head>
<body>
    @model ESimSol.BusinessObjects.FnQCTestGroup
    <div id="progressbarParent" style="width:100%;height:100%;margin:0 auto;text-align:center; margin-left: auto;margin-right: auto;left: 0;right: 0;z-index: 1;">
        <div style="margin: 0px auto;margin-top: 251px;text-align:center;width:390px;">
            <label style="font-size:18px;">Please wait</label>
            <div id="progressbar" style="width:100%;height:37px;"></div>
        </div>
    </div>
    <div class="menuMainCollectionTable">
        <div class="easyui-panel" title="Department" style="font-family:Tahoma; text-align:center; height:89%;">
            <fieldset style="height:100%; text-align:center;">
                <legend style="font-weight:bold"> Department Informations : </legend>
                <table border="0" cellspacing="2" cellpadding="2" style="font-size:11px; font-weight:bold; text-align:center; width:80%">
                    <tr>
                        <td style="height:150px;">&nbsp;</td>
                        <td style="height:150px;">&nbsp;</td>
                    </tr>
                    <tr>
                        <td style="width:30%; text-align:right">
                            Name :
                        </td>
                        <td style="width:70%">
                            @Html.TextBoxFor(model => model.Name, new { style = "width: 100%;", id = "txtName" })

                        </td>
                    </tr>
                    <tr>
                        <td style="width:30%; text-align:right">
                            Note :
                        </td>
                        <td style="width:70%">
                            @Html.TextBoxFor(model => model.Note, new { style = "width: 100%;", id = "txtNote" })
                        </td>
                    </tr>

                </table>
            </fieldset>
        </div>
        <fieldset style="height:10%">
            <legend style="font-weight: bold">Action : </legend>
            <table border="0" cellspacing="2" cellpadding="2" style="font-size: 11px; font-weight: bold; width:100%">
                <tr>
                    <td style="width:60%; text-align:right"></td>
                    <td style="width:40%;text-align:right;">
                        <a id="btnSave" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-save" plain="true">Save</a>
                        <a id="btnClose" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-cancel" plain="true">Close</a>
                    </td>
                </tr>
            </table>
        </fieldset>
    </div>
</body>
</html>
<style type="text/css">
    td, th {
        padding: 2px;
    }
</style>
<script type="text/javascript">
    var _sBaseAddress = "";
    var _oFnQCTestGroup = [];
    var TypeList = [];
    var Units = [];
    var _oFnQCTestGroupDetails = [];
    $(document).ready(function () {
        debugger;
        _sBaseAddress =@Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(HttpContext.Current.Session[SessionInfo.BaseAddress]));
        _oFnQCTestGroup =@Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(Model));
        if(sessionStorage.getItem('Action')=='View')
        {
            $('#tblFnQCTestGroupDetail').data("GridEditable",false);
            $('#btnSave, #toolbar').hide();
        }
        debugger;
        if(parseInt(_oFnQCTestGroup.FnQCTestGroupID)>0)
        {
            $('#txtName, #txtNote').addClass('fontColorOfPickItem');
        }
        $("#progressbar").progressbar({ value: 0 });
        $("#progressbarParent").hide();
    });

    function updateProgress() {
        var value =$('#progressbar').progressbar('getValue');
        if (value < 90){
            value += Math.floor(Math.random() * 10);
            $('#progressbar').progressbar('setValue', value);
        }
    }

    function Validation(){
        if($("#txtName").val() == "" || $("#txtName").val() == undefined){
            alert("Please enter Name!!");
            $("#txtName").focus();
            return false;
        }
        return true;
    }

    function RefreshObject()
    {
        var oFnQCTestGroup={
            FnQCTestGroupID : _oFnQCTestGroup.FnQCTestGroupID,
            Name : $("#txtName").val(),
            Note : $('#txtNote').val(),
            SLNo: _oFnQCTestGroup.SLNo
        };

        return oFnQCTestGroup;
    }

    $("#btnSave").click(function (){
        debugger;
        if(!Validation()) return false;
        var oFnQCTestGroup=RefreshObject();
        //return;
        $("#progressbar").progressbar({ value: 0 });
        $("#progressbarParent").show();
        var intervalID = setInterval(updateProgress, 250);
        $.ajax({
            type: "POST",
            dataType: "json",
            url : _sBaseAddress+"/FnQCTestGroup/Save",
            traditional: true,
            data:  JSON.stringify(oFnQCTestGroup),
            contentType: "application/json; charset=utf-8",
            success: function (data) {
                //debugger;
                oFnQCTestGroup = jQuery.parseJSON(data);
                clearInterval(intervalID);
                $("#progressbarParent").hide();
                if (oFnQCTestGroup.ErrorMessage==null || oFnQCTestGroup.ErrorMessage=="") {
                    alert("Data Saved successfully");
                    var oFnQCTestGroups = sessionStorage.getItem("FnQCTestGroups");
                    var nIndex = parseInt(sessionStorage.getItem("SelectedRowIndex"));
                    if (oFnQCTestGroups != null) {
                        oFnQCTestGroups = jQuery.parseJSON(oFnQCTestGroups);
                    }
                    else
                    {
                        oFnQCTestGroups = [];
                    }
                    if (nIndex != -1)
                    {
                        oFnQCTestGroups[nIndex] = oFnQCTestGroup;
                    }
                    else
                    {
                        sessionStorage.setItem("SelectedRowIndex", oFnQCTestGroups.length);
                        oFnQCTestGroups.push(oFnQCTestGroup);
                    }
                    sessionStorage.setItem("FnQCTestGroups", JSON.stringify(oFnQCTestGroups));
                    window.location.href = sessionStorage.getItem("BackLink");
                }
                else {
                    alert(oFnQCTestGroup.ErrorMessage);
                }
            },
            error: function (xhr, status, error) {
                alert(error);
            }

        });
    });

    $('#btnClose').click(function(e){
        window.location.href = sessionStorage.getItem("BackLink");
    })

</script>