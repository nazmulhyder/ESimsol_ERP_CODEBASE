@{
    ViewBag.Title = "Create Challan";
}

@model IEnumerable<ESimSol.BusinessObjects.SUDeliveryOrder>
<html>
    <head>
        <title></title>
        <script src="@Url.Content("~/Views/SUDeliveryProgram/SUDPChallanPrepare.js")" type="text/javascript"></script>
        <script src="@Url.Content("~/Views/SUDeliveryOrder/SUDeliveryOrder.js")" type="text/javascript"></script>
        <script src="@Url.Content("~/Views/SUDeliveryOrder/AdvSearch.js")" type="text/javascript"></script>
        <script src="@Url.Content("~/Views/SUDeliveryChallan/SUDeliveryChallan.js")" type="text/javascript"></script>
    </head>
    <body>

        <div id="winProgramChallanHistory" class="easyui-window" title="Program And Challan History" data-options="modal:true,closed:true,collapsible:false,minimizable:false,maximizable:false,closable:false">
            <div id="tabProgramChallanHistory" class="easyui-tabs" style="width: 900px;height:360px;">
                <div title="Program History">
                    <table id="tblProgramHistory" class="easyui-datagrid" style="width: 890px; height: 320px" fitcolumns="false" rownumbers="true" pagination="false" singleselect="true" multiselect="false" autorowheight="false">
                        <thead>
                            <tr>
                                <th field="ProgramDateInString" width="15%" align="center">Program Date</th>
                                <th field="ProductName" width="42%">Product Name</th>
                                <th field="LotNo" width="20%">Lot No</th>
                                <th field="ProgramQtyInString" width="20%" align="right">Program Qty</th>
                            </tr>
                        </thead>
                    </table>
                </div>
                <div title="Challan History">
                    <table id="tblChallanHistory" class="easyui-datagrid" style="width: 890px; height: 320px" fitcolumns="false" rownumbers="true" pagination="false" singleselect="true" multiselect="false" autorowheight="false">
                        <thead>
                            <tr>
                                <th field="ProgramDateSt" width="15%" align="center">Program Date</th>
                                <th field="ChallanNo" width="15%">Challan No</th>
                                <th field="ChallanDateSt" width="15%" align="center">Challan Date</th>
                                <th field="ProductName" width="35%">Product Name</th>
                                <th field="QtySt" width="18%" align="right">Challan Qty</th>
                            </tr>
                        </thead>
                    </table>
                </div>
            </div>
            <fieldset class="actionfieldsetstyle">
                <legend>Actions : </legend>
                <table style="width:100%;">
                    <tr>
                        <td style="width:500px;float:right;">
                            <a id="btnClosePCH" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-cancel" plain="true">Close</a>
                        </td>
                    </tr>
                </table>
            </fieldset>
        </div>
        <div id="winSUDChallan" class="easyui-window" data-options="modal:true,closed:true,collapsible:false,minimizable:false,maximizable:false,closable:false">
            <div id="divSUDChallan" tabindex="-1">
                <table id="tblSUDChallan" class="easyui-datagrid" style="width: 900px; height: 350px; margin: 0;"
                       data-options="singleSelect: true,fitColumns:false, rownumbers:true, pagination:false, autoRowHeight:false,toolbar: '#toolbarSUDChallan'">
                    <thead>
                        <tr>
                            <th field="ChallanNo" width="15%">Challan No</th>
                            <th field="DONo" width="15%">DO No</th>
                            <th field="ChallanDateSt" width="10%" align="center">Challan Date</th>
                            <th field="ChallanStatusSt" width="10%">Status</th>
                            <th field="BuyerName" width="20%">Buyer</th>
                            <th field="DeliveryToName" width="20%">Delivered To</th>
                            <th field="ApprovedByName" width="20%">Approved By</th>
                            <th field="DeliveredByName" width="20%">Delivered By</th>
                            <th field="QtySt" width="10%" align="right">Qty</th>
                        </tr>
                    </thead>
                </table>
            </div>
            <div id="toolbarSUDChallan">
                <a id="btnViewSUDChallan" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-details" plain="true">View</a>
            </div>
            <fieldset class="actionfieldsetstyle">
                <legend>Actions : </legend>
                <a id="btnCloseSUDChallan" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-cancel" plain="true">Close</a>
            </fieldset>
        </div>
        <div id="winLotAssignSUDeliveryChallan" class="easyui-window" title="Lot List" data-options="modal:true,closed:true,collapsible:false,minimizable:false,maximizable:false,closable:false">
            <div id="divLotAssign" tabindex="-1">
                <table id="tblLotAssign" class="easyui-datagrid" title="Lot List" style="width: 500px; height: 350px; margin: 0;"
                       data-options="singleSelect: true,fitColumns:false, rownumbers:true, pagination:false, autoRowHeight:false">
                    <thead>
                        <tr>
                            <th field="LotNo" width="20%" align="left">Lot No</th>
                            <th field="Balance" width="20%" align="right">Balance Qty</th>
                            <th field="UnitPrice" width="25%" align="right">Unit Price</th>
                            <th field="Amount" width="25%" align="right">Amount</th>
                        </tr>
                    </thead>
                </table>
            </div>
           
            <fieldset class="actionfieldsetstyle">
                <legend>Actions : </legend>
                <a id="btnOkLotAssign" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-ok" plain="true">Ok</a>
                <a id="btnCloseLotAssign" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-cancel" plain="true">Close</a>
            </fieldset>
        </div>
        <div id="winSUDeliveryChallan" class="easyui-window" title="Delivery Challan" data-options="modal:true,closed:true,collapsible:false,minimizable:false,maximizable:false,closable:false">
            <fieldset>
                <legend>Delivery Challan :</legend>
                <table border="0" cellspacing="2" cellpadding="2" class="CaptionStyle">
                    <tr>
                        <td style="width:100px; text-align:right">
                            Challan No :
                        </td>
                        <td style="">
                            <input type="text" style="width:130px;margin-right:3px;float:left;" id="txtChallanNoSUDeliveryChallan" disabled />
                            <div style="float:right;">
                                DO No :
                                <input type="text" style="width:130px;margin-right:3px;" id="txtDONoSUDeliveryChallan" disabled />
                            </div>
                        </td>
                        <td style="width:200px; text-align:right">
                            Challan Date :
                        </td>
                        <td>
                            <input id="txtChallanDateSUDeliveryChallan" type="text" style="width:210px;" class="easyui-datebox enableDisable" required="required" data-options="formatter:icsdateformat,parser:icsdateparser" />
                        </td>
                    </tr>
                    <tr>
                        <td style="width:100px; text-align:right">
                            Buyer :
                        </td>
                        <td style="text-align:left">
                            <select id="cboBuyerSUDeliveryChallan" class="enableDisable" style="width:120px;"></select>
                            <input id="txtSearchByBuyerSUDeliveryChallan" class="enableDisable" type="text" style="width: 59%;" placeholder="Type & Press Enter" />
                        </td>
                        <td style="width:200px; text-align:right">
                            <label style="width:150px;">Goods Checked By :</label>
                        </td>
                        <td>
                            <select id="cboGoodsCheckedBySUDeliveryChallan" style="width:100%;"></select>
                        </td>
                    </tr>
                    <tr>
                        <td style="width:100px; text-align:right">
                            Deliver To :
                        </td>
                        <td style="text-align:left">
                            <select id="cboDeliveryToSUDeliveryChallan" class="enableDisable" style="width:120px;"></select>
                            <input id="txtSearchByDeliveryToSUDeliveryChallan" class="enableDisable" type="text" style="width: 59%;" placeholder="Type & Press Enter" />
                        </td>
                        <td style="text-align:right">
                            <label style="width:150px;">Finish Goods Store : </label>
                        </td>
                        <td>
                            <select id="cboFinishGoodsStoreSUDeliveryChallan" style="width:100%;"></select>
                        </td>
                    </tr>
                    <tr>
                        <td style="width:100px; text-align:right">
                            Driver Name :
                        </td>
                        <td>
                            <input id="txtDriverNameSUDeliveryChallan" type="text" style="width:37%;" />
                            <div style="float:right;">
                                <label>Mobile No :</label>
                                <input id="txtDriverContactNoSUDeliveryChallan" type="text" style="width:63%;" />
                            </div>
                        </td>
                        <td style="width:200px; text-align:right">
                            Vehicle No :
                        </td>
                        <td>
                            <input id="txtVehicleNoSUDeliveryChallan" type="text" style="width:98%;" />
                        </td>
                    </tr>
                    <tr>
                        <td style="width:100px; text-align:right">
                            Remarks :
                        </td>
                        <td>
                            <input id="txtRemarksSUDeliveryChallan" type="text" style="width:37%;margin-right:5px;" />
                            S. Phone No :
                            <input id="txtStorePhoneNoSUDeliveryChallan" type="text" style="width:37%;" />
                        </td>
                        <td style="width:200px; text-align:right">
                            <label style="display:none;">Gate Pass No :</label>
                        </td>
                        <td>
                            <input id="txtGatePassNoSUDeliveryChallan" type="text" style="width:98%; display:none;" />
                        </td>
                    </tr>
                </table>
            </fieldset>
            <div style="margin-left:2px; margin-top:2px">
                <table id="tblSUDeliveryChallanDetails" title="Item Description" class="easyui-datagrid" style="width:922px;height:300px;" fitcolumns="false" rownumbers="true" pagination="false" singleselect="true" autorowheight="false" toolbar="#toolbarSUDeliveryChallanDetail" data-options="onClickRow: onClickRowSUDC">
                    <thead>
                        <tr>
                            <th field="ProductCode" width="8%" align="left">Code</th>
                            <th field="ProductName" width="20%" align="left">Item Description</th>
                            <th field="LotNoWithStore" width="18%" align="left">Lot No</th>
                            <th data-options="field:'Qty',align:'right',editor:{type:'numberbox',options:{precision:2}}" width="8%" align="right">Qty(kG)</th>
                            <th field="QtyLbsSt" width="12%" align="right">Qty(LBS)</th>
                            <th field="ProgramQty" width="12%" align="right">Program Qty(KG)</th>
                            <th field="YetToChallanCountWiseSt" width="10%" align="right">Yet To Challan</th>
                            <th data-options="field:'Bags',align:'right',editor:{type:'numberbox',options:{precision:0}}" width="10%" align="right">Bags</th>
                        </tr>
                    </thead>
                </table>
                <div id="toolbarSUDeliveryChallanDetail">
                    <a id="btnLotAssignSUDeliveryChallanDetail" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-redo" plain="true">Lot Assign</a>
                    <a id="btnRefreshSUDeliveryChallanDetail" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-reload" plain="true">Refresh</a>
                    <a id="btnProductRemoveSUDeliveryChallanDetail" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-remove" plain="true">Remove</a>
                    <a id="btnCopyItemSUDeliveryChallanDetail" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-copy" plain="true">Copy Item</a>
                </div>
            </div>
            <table border="0">
                <tr>
                    <td style="width:363px;"></td>
                    <td id="tdTotalCaption" style="text-align: right; font-size: 12px; font-weight:bold"> Total : </td>
                    <td style="width: 100px; text-align: right; font-size: 12px">
                        <label id="lblTotalQty" class="lblTotalQty" style="text-align: right; font-size:12px; font-weight:bold;">0.00</label>
                        <label style="font-weight:bold;"></label>
                    </td>
                    <td style="width: 100px; text-align: right; font-size: 12px">
                        <label id="lblTotalQtyLbs" class="lblTotalQtyLbs" style="text-align: right; font-size:12px; font-weight:bold;">0.00</label>
                        <label style="font-weight:bold;"></label>
                    </td>
                    <td style="width: 87px; text-align: right; font-size: 12px">
                        <label id="lblTotalProgramQty" style="text-align: right; font-size:12px; float: right; font-weight:bold">0.00</label>
                    </td>
                    <td style="width: 181px; text-align: right; font-size: 12px">
                        <label id="lblTotalBags" style="text-align: right; font-size:12px; float: right; font-weight:bold">0.00</label>
                    </td>
                </tr>
            </table>
            <fieldset class="actionfieldsetstyle">
                <legend style="font-weight:bold"> Action : </legend>
                <a id="btnSaveSUDeliveryChallan" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-save" plain="true">Save</a>
                <a id="btnDisburseSUDeliveryChallan" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-save" plain="true">Disburse</a>
                <a id="btnCloseSUDeliveryChallan" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-cancel" plain="true">Close</a>
            </fieldset>
        </div>
        <div id="winBuyerPickerAdvSearch" class="easyui-window" title="Contractor" data-options="modal:true,closed:true,collapsible:false,minimizable:false,maximizable:false,closable:false">
            <div id="divBuyerPickerAdvSearch" tabindex="-1">
                <table id="tblBuyersPickerAdvSearch" class="easyui-datagrid" style="width: 400px; height: 350px; margin: 0;"
                       data-options="singleSelect: true,fitColumns:false, rownumbers:true, pagination:false, autoRowHeight:false, toolbar: '#toolbarBuyerPickerAdvSearch' ">
                    <thead>
                        <tr>
                            <th field="Name" width="240" align="left">Name</th>
                            <th field="ContractorTypeInString" width="150" align="left">Type</th>
                        </tr>
                    </thead>
                </table>
                <div id="toolbarBuyerPickerAdvSearch">
                    <input id="txtSearchByBuyerNamePickerAdvSearch" class="txtPickerSearchInputField" type="text" placeholder="Search by name" />
                </div>
            </div>
            <fieldset class="actionfieldsetstyle">
                <legend>Actions : </legend>
                <a id="btnOkBuyerPickerAdvSearch" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-ok" plain="true">Ok</a>
                <a id="btnCloseBuyerPickerAdvSearch" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-cancel" plain="true">Close</a>
            </fieldset>
        </div>
        <div id="winAdvSearchSUDeliveryOrder" class="easyui-window winstyle" title="Adv. Search" data-options="modal:true,closed:true,collapsible:false,minimizable:false,maximizable:false,closable:false">
            <table class="tblAdvSearch">
                <tr>
                    <td>
                        <fieldset style="margin-bottom: 0px;" class="abc">
                            <legend>Searching Criteria</legend>
                            <table class="tblASWrapper">
                                <tr>
                                    <td>
                                        <label>Search By DO No :</label>
                                    </td>
                                </tr>
                                <tr>
                                    <td>
                                        <input id="txtDONoAdvSearch" type="text" />
                                    </td>
                                </tr>
                                <tr>
                                    <td>
                                        <label>Search By Buyer(s) :</label>
                                    </td>
                                </tr>
                                <tr>
                                    <td class="oneTextTwoButton">
                                        <input id="txtSearchByBuyersAdvSearch" type="text" placeholder="Type & Press Enter" />
                                        <input id="btnClrSearchByBuyersAdvSearch" type="button" value="C" />
                                        <input id="btnPickSearchByBuyersAdvSearch" type="button" value="P" />
                                    </td>
                                </tr>
                                <tr>
                                    <td>
                                        <label>Search By PI No :</label>
                                    </td>
                                </tr>
                                <tr>
                                    <td>
                                        <input id="txtPINoAdvSearch" type="text" />
                                    </td>
                                </tr>
                                <tr>
                                    <td>
                                        <label>Search By MKT Person :</label>
                                    </td>
                                </tr>
                                <tr>
                                    <td>
                                        <select id="cboMKTPersonAdvSearch"></select>
                                    </td>
                                </tr>
                                <tr>
                                    <td>
                                        <label>Search By DO Type :</label>
                                    </td>
                                </tr>
                                <tr>
                                    <td>
                                        <select id="cboDOTypeAdvSearch"></select>
                                    </td>
                                </tr>
                                <tr>
                                    <td height="10"></td>
                                </tr>
                                <tr>
                                    <td>
                                        <input id="chkDODate" type="checkbox" style="margin: 0;" onchange="ChangeDODates();" />
                                        <label style="margin-right: 19px;">DO Date :</label>
                                        <input id="txtFromDODateAdvSearch" type="text" style="width: 100px;" class="easyui-datebox" required="required" data-options="formatter:icsdateformat,parser:icsdateparser" />
                                        <label style="margin: 0 16px 0 16px;">To</label>
                                        <input id="txtToDODateAdvSearch" type="text" style="width: 100px;" class="easyui-datebox" required="required" data-options="formatter:icsdateformat,parser:icsdateparser" />
                                    </td>
                                </tr>
                                <tr>
                                    <td height="10"></td>
                                </tr>
                                <tr>
                                    <td>
                                        <input id="chkDeliveryDate" type="checkbox" style="margin: 0;" onchange="ChangeDeliveryDates();" />
                                        <label style="margin-right: 15px;">Del. Date :</label>
                                        <input id="txtFromDeliveryDateAdvSearch" type="text" style="width: 100px;" class="easyui-datebox" required="required" data-options="formatter:icsdateformat,parser:icsdateparser" />
                                        <label style="margin: 0 16px 0 16px;">To</label>
                                        <input id="txtToDeliveryDateAdvSearch" type="text" style="width: 100px;" class="easyui-datebox" required="required" data-options="formatter:icsdateformat,parser:icsdateparser" />
                                    </td>
                                </tr>
                                <tr>
                                    <td height="20"></td>
                                </tr>
                                <tr>
                                    <td class="btnResetSearch">
                                        <input id="btnResetAdvSearch" type="button" value="Reset" />
                                        <input id="btnSearchAdvSearch" type="button" value="Search" />
                                    </td>
                                </tr>
                            </table>
                        </fieldset>
                    </td>
                    <td>
                        <div style="margin-top: 6px;">
                            <table id="tblSUDeliveryOrderAdvSearch" class="easyui-datagrid" title="Delivery Order(s)" style="width: 450px; height: 364px;" data-options="singleSelect: false,fitColumns:false, rownumbers:true, pagination:false, autoRowHeight:false, ">
                                <thead>
                                    <tr>
                                        <th data-options="field:'Selected',checkbox:true"></th>
                                        <th field="DONo" width="15%">DONo</th>
                                        <th field="DODateSt" width="20%" align="center">DO Date</th>
                                        <th field="DOStatusSt" width="15%">Status</th>
                                        <th field="BuyerName" width="20%">Buyer Name</th>
                                        <th field="DOTypeSt" width="15%">DO Type</th>
                                        <th field="DeliveredToName" width="20%">Delivered To</th>
                                        <th field="DeliveryDateSt" width="20%" align="center">Delivery Date</th>
                                        <th field="MKTPName" width="20%">MKT Person</th>
                                    </tr>
                                </thead>
                            </table>
                        </div>
                    </td>
                </tr>
            </table>
            <fieldset class="actionfieldsetstyle">
                <legend>Actions : </legend>
                <a id="btnOkAdvSearchSUDO" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-ok" plain="true">Ok</a>
                <a id="btnCloseAdvSearch" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-cancel" plain="true">Close</a>
            </fieldset>
        </div>
        <div id="winReviseHistory" class="easyui-window" title="Revise History" data-options="modal:true,closed:true,collapsible:false,minimizable:false,maximizable:false,closable:false">
            <table id="tblReviseHistory" class="easyui-datagrid" style="width: 900px; height: 350px; margin: 0;" data-options="singleSelect: true,fitColumns:false, rownumbers:true, pagination:false, autoRowHeight:false, toolbar: '#toolbarReviseHistory' ">
                <thead>
                    <tr>
                        <th field="DONo" width="15%">DONo</th>
                        <th field="DODateSt" width="15%" align="center">DO Date</th>
                        <th field="DOStatusSt" width="15%">Status</th>
                        <th field="BuyerName" width="20%">Buyer Name</th>
                        <th field="DOTypeSt" width="15%">DO Type</th>
                        <th field="DeliveredToName" width="20%">Delivered To</th>
                        <th field="DeliveryDateSt" width="20%" align="center">Delivery Date</th>
                        <th field="MKTPName" width="20%">MKT Person</th>
                        <th field="QtySt" width="15%" align="right">Qty</th>
                        <th field="AmountSt" width="15%" align="right">Amount</th>
                    </tr>
                </thead>
            </table>
            <div id="toolbarReviseHistory">
                <a id="btnViewReviseHistory" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-details" plain="true">Details</a>
            </div>
            <fieldset class="actionfieldsetstyle">
                <legend>Actions : </legend>
                <a id="btnCloseReviseHistory" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-cancel" plain="true">Close</a>
            </fieldset>
        </div>
        <div id="winSUDO" class="easyui-window" title="SUDeliveryOrder" data-options="modal:true,closed:true,collapsible:false,minimizable:false,maximizable:false,closable:false">
            <table border="0" cellspacing="2" cellpadding="2" class="CaptionStyle">
                <tr>
                    <td style="width:100px; text-align:right">
                        DO No :
                    </td>
                    <td style="">
                        <input type="text" style="width:110px;margin-right:3px;" id="txtDONoSUDO" disabled="disabled" />
                        DO Type :
                        <select id="cboDOTypeSUDO" class="buyer"></select>
                    </td>
                    <td style="width:200px; text-align:right">
                        DO Date :
                    </td>
                    <td style="">
                        <input id="txtDODateSUDO" type="text" style="width:210px;" class="easyui-datebox" required="required" data-options="formatter:icsdateformat,parser:icsdateparser" />
                    </td>
                </tr>
                <tr>
                    <td style="width:100px; text-align:right">
                        Buyer :
                    </td>
                    <td style="text-align:left">
                        <select id="cboBuyerSUDO" style="width:120px;"></select>
                        <input id="txtSearchByBuyerSUDO" class="buyer" type="text" style="" placeholder="Type & Press Enter" />
                        <input id="btnClrBuyerSUDO" class="buyer" type="button" value="C" />
                        <input id="btnPickBuyerSUDO" class="buyer" type="button" value="P" />
                    </td>
                    <td style="width:200px; text-align:right">
                        <label style="width:150px;">Delivery Date </label>
                    </td>
                    <td style="">
                        <input id="txtDeliveryDateSUDO" type="text" style="width:210px;" class="easyui-datebox" required="required" data-options="formatter:icsdateformat,parser:icsdateparser" />
                    </td>
                </tr>
                <tr>
                    <td style="width:100px; text-align:right">
                        Deliver To :
                    </td>
                    <td style="text-align:left">
                        <select id="cboDeliveryToSUDO" style="width:120px;"></select>
                        <input id="txtSearchByDeliveryToSUDO" type="text" style="" placeholder="Type & Press Enter" />
                        <input id="btnClrDeliveryToSUDO" type="button" value="C" />
                        <input id="btnPickDeliveryToSUDO" type="button" value="P" />
                    </td>
                    <td style="text-align:right">
                        <label style="width:150px;">MKT Person : </label>
                    </td>
                    <td style="">
                        <select id="cboMKTPersonSUDO" style="width:100%;"></select>
                    </td>
                </tr>
                <tr>
                    <td style="width:100px; text-align:right">
                        Deliver Point :
                    </td>
                    <td style="">
                        <input id="txtDeliverPointSUDO" type="text" style="width:98%;" />
                    </td>
                    <td style="width:200px; text-align:right">
                        PI No :
                    </td>
                    <td style="">
                        <input id="txtPINoSUDO" type="text" style="width:63%;" disabled />
                        <input id="btnClearPINoSUDO" type="button" value="C" />
                        <input id="btnPINoSUDO" type="button" value="P" />
                    </td>
                </tr>
                <tr>
                    <td style="width:100px; text-align:right">
                        Remarks :
                    </td>
                    <td style="">
                        <input id="txtRemarksSUDO" type="text" style="width:98%;" />
                    </td>
                    <td style="width:200px; text-align:right">
                        Currency :
                    </td>
                    <td style="">
                        <select id="cboCurrencySUDO" style="width:100%;"></select>
                    </td>
                </tr>
            </table>
            <div style="margin-left:2px; margin-top:2px">
                <table id="tblSUDPs" title="Delivery Programs" class="easyui-datagrid" style="width:917px;height:300px;" fitcolumns="false" rownumbers="true" pagination="false" singleselect="true" autorowheight="false" toolbar="#toolbarSUDPs" data-options="onClickRow: onClickRowSUDO">
                    <thead>
                        <tr>
                            <th field="DONo" width="15%" align="left">DO No</th>
                            <th field="ProductName" width="15%" align="left">Item Description</th>
                            <th field="PIQtyInString" width="11%" align="right">PI Qty</th>
                            <th field="DOQtyInString" width="11%" align="right">DO Qty</th>
                            <th field="YetToDOProgramInString" width="11%" align="right">Yet To Program/LBS</th>
                            <th field="YetToDeliveryInString" width="12%" align="right">Yet To Delivery</th>
                            <th field="ReadyStockInHandInString" width="12%" align="right">Stock In Hand</th>
                            <th field="ProgramQtyInString" width="12%" align="right">Program Qty</th>
                        </tr>
                    </thead>
                </table>

            </div>
            <table border="0" style="width: 917px;">
                <tr>
                    <td style="width:73%;text-align: right; font-size: 12px; font-weight:bold">
                        Total :
                    </td>
                    <td style="width: 10%; text-align: right; font-size: 12px; font-weight:bold">
                        <label id="lblTotalQtySUDP" style="text-align: right; font-size:12px; font-weight:bold">0.00</label>
                    </td>

                </tr>
            </table>

            <fieldset class="actionfieldsetstyle">
                <legend style="font-weight:bold"> Action : </legend>
                <a id="btnSaveSUDO" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-save" plain="true">Save</a>
                <a id="btnCloseSUDO" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-closed" plain="true">Close</a>
            </fieldset>
        </div>
        <div id="winSUDeliveryOrder" class="easyui-window" title="SUDeliveryOrder" data-options="modal:true,closed:true,collapsible:false,minimizable:false,maximizable:false,closable:false">
            <table border="0" cellspacing="2" cellpadding="2" class="CaptionStyle">
                <tr>
                    <td style="width:100px; text-align:right">
                        DO No :
                    </td>
                    <td style="">
                        <input type="text" style="width:110px;margin-right:3px;" id="txtDONoSUDeliveryOrder" disabled="disabled" />
                        DO Type :
                        <select id="cboDOTypeSUDeliveryOrder" class="buyer"></select>
                    </td>
                    <td style="width:200px; text-align:right">
                        DO Date :
                    </td>
                    <td style="">
                        <input id="txtDODateSUDeliveryOrder" type="text" style="width:210px;" class="easyui-datebox" required="required" data-options="formatter:icsdateformat,parser:icsdateparser" />
                    </td>
                </tr>
                <tr>
                    <td style="width:100px; text-align:right">
                        Buyer :
                    </td>
                    <td style="text-align:left">
                        <select id="cboBuyerSUDeliveryOrder" style="width:120px;"></select>
                        <input id="txtSearchByBuyerSUDeliveryOrder" class="buyer" type="text" style="" placeholder="Type & Press Enter" />
                        <input id="btnClrBuyerSUDeliveryOrder" class="buyer" type="button" value="C" />
                        <input id="btnPickBuyerSUDeliveryOrder" class="buyer" type="button" value="P" />
                    </td>
                    <td style="width:200px; text-align:right">
                        <label style="width:150px;">Delivery Date </label>
                    </td>
                    <td style="">
                        <input id="txtDeliveryDateSUDeliveryOrder" type="text" style="width:210px;" class="easyui-datebox" required="required" data-options="formatter:icsdateformat,parser:icsdateparser" />
                    </td>
                </tr>
                <tr>
                    <td style="width:100px; text-align:right">
                        Deliver To :
                    </td>
                    <td style="text-align:left">
                        <select id="cboDeliveryToSUDeliveryOrder" style="width:120px;"></select>
                        <input id="txtSearchByDeliveryToSUDeliveryOrder" type="text" style="" placeholder="Type & Press Enter" />
                        <input id="btnClrDeliveryToSUDeliveryOrder" type="button" value="C" />
                        <input id="btnPickDeliveryToSUDeliveryOrder" type="button" value="P" />
                    </td>
                    <td style="text-align:right">
                        <label style="width:150px;">MKT Person : </label>
                    </td>
                    <td style="">
                        <select id="cboMKTPersonSUDeliveryOrder" style="width:100%;"></select>
                    </td>
                </tr>
                <tr>
                    <td style="width:100px; text-align:right">
                        Deliver Point :
                    </td>
                    <td style="">
                        <input id="txtDeliverPointSUDeliveryOrder" type="text" style="width:98%;" />
                    </td>
                    <td style="width:200px; text-align:right">
                        PI No :
                    </td>
                    <td style="">
                        <input id="txtPINoSUDeliveryOrder" type="text" style="width:63%;" disabled />
                        <input id="btnClearPINoSUDeliveryOrder" type="button" value="C" />
                        <input id="btnPINoSUDeliveryOrder" type="button" value="P" />
                    </td>
                </tr>
                <tr>
                    <td style="width:100px; text-align:right">
                        Remarks :
                    </td>
                    <td style="">
                        <input id="txtRemarksSUDeliveryOrder" type="text" style="width:98%;" />
                    </td>
                    <td style="width:200px; text-align:right">
                        Currency :
                    </td>
                    <td style="">
                        <select id="cboCurrencySUDeliveryOrder" style="width:100%;"></select>
                    </td>
                </tr>
            </table>
            <div style="margin-left:2px; margin-top:2px">
                <table id="tblSUDeliveryOrderDetails" title="Products/Item Description" class="easyui-datagrid" style="width:917px;height:300px;" fitcolumns="false" rownumbers="true" pagination="false" singleselect="true" autorowheight="false" toolbar="#toolbarSUDeliveryOrderDetail" data-options="onClickRow: onClickRowSUDO">
                    <thead>
                        <tr>
                            <th field="ProductName" width="20%" align="left">Item Description</th>
                            <th data-options="field:'Qty',align:'right',editor:{type:'numberbox',options:{precision:2}}" width="15%" align="right">Qty(kG)</th>
                            <th field="QtyInLbs" width="15%" align="right">Qty(LBS)</th>
                            <th data-options="field:'UnitPrice',align:'right',editor:{type:'numberbox',options:{precision:2}}" width="15%" align="right">Unit Price/KG</th>
                            <th field="UnitPriceInLbs" width="15%" align="right">Unit Price/LBS</th>
                            <th field="AmountSt" width="15%" align="right">Amount</th>
                        </tr>
                    </thead>
                </table>
                <div id="toolbarSUDeliveryOrderDetail">
                    <label id="lblSUDeliveryOrderDetailLabel">Product :</label>
                    <input id="txtProductNameSUDeliveryOrderDetail" type="text" class="productItemsSUDeliveryOrder" placeholder="Type Product & Press Enter" style="width:210px;" />
                    <input id="btnClrProductSUDeliveryOrderDetail" class="productItemsSUDeliveryOrder" type="button" value="C" />
                    <input id="btnPickProductSUDeliveryOrderDetail" class="productItemsSUDeliveryOrder" type="button" value="P" />
                    <a id="btnProductAddSUDeliveryOrderDetail" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-add" plain="true">Add</a>
                    <a id="btnProductRemoveSUDeliveryOrderDetail" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-remove" plain="true">Remove</a>
                    <a id="btnRefreshSUDeliveryOrderDetail" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-reload" plain="true">Refresh</a>
                    <a id="btnPIProductsSUDeliveryOrderDetail" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-add" plain="true">PI Products</a>
                </div>
            </div>
            <table border="0">
                <tr>
                    <td style="width:80px;"></td>
                    <td id="tdTotalCaption" style="width: 100px; text-align: right; font-size: 12px; font-weight:bold"> Total : </td>
                    <td style="width: 150px; text-align: right; font-size: 12px">
                        <label id="lblTotalQty" style="text-align: right; font-size:12px; float: right; font-weight:bold">0.00</label>
                    </td>
                    <td style="width:100px;"></td>
                    <td style="width: 150px; text-align: right; font-size: 12px">
                        <label id="lblTotalUnitPrice" style="text-align: right; font-size:12px; float: right; font-weight:bold">0.00</label>
                    </td>
                    <td style="width:100px;"></td>
                    <td style="width: 150px; text-align: right; font-size: 12px">
                        <label id="lblTotalValue" style="text-align: right; font-size:12px; float: right; font-weight:bold">0.00</label>
                    </td>
                    <td style="width: 50px; text-align: right; font-size: 12px; font-weight:bold"></td>
                </tr>
            </table>
            <fieldset class="actionfieldsetstyle">
                <legend style="font-weight:bold"> Action : </legend>
                <a id="btnSaveSUDeliveryOrder" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-save" plain="true">Save</a>
                <a id="btnCloseSUDeliveryOrder" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-closed" plain="true">Close</a>
            </fieldset>
        </div>
        <div class="menuMainCollectionTable">
            <table id="tblSUDOs" title="Delivery Program" class="easyui-datagrid" style="width:100%;" fit="true" fitcolumns="false" rownumbers="true" pagination="false" singleselect="true" autorowheight="false" toolbar="#toolbarSUDO">
              
            </table>
            <div id="toolbarSUDO">
                <table>
                    <tr>
                        <td>
                            <input id="txtDONoSUDOrder" type="text" style="width:110px" placeholder="Search by DO No" />
                            <input id="txtBuyerNameSUDO" type="text" style="width:110px" placeholder="Search by Buyer" />
                            <input id="txtDeliveredToNameSUDO" type="text" style="width:110px" placeholder="Search by Delivered to" />
                            <input id="chkProgramDateSUDO" type="checkbox" checked="checked" />
                            <input id="txtProgramDateSUDO" type="text" class="easyui-datebox" data-options="formatter:icsdateformat,parser:icsdateparser" style="width:100px;float:left" />
                            <a id="btnSearchSUDO" href="javascript:void(0)" class="easyui-linkbutton easyui-tooltip" title="Refresh" iconcls="icon-search" plain="true">Search</a>
                            <a id="btnViewSUDO" href="javascript:void(0)" class="easyui-linkbutton easyui-tooltip" title="View DO" iconcls="icon-details" plain="true">View DO</a>
                            @*<a id="btnViewProgramSUDO" href="javascript:void(0)" class="easyui-linkbutton easyui-tooltip" title="View Delivery Program" iconcls="icon-details" plain="true">View Delivery Program</a>*@
                            <a id="btnNewChallanSUDO" href="javascript:void(0)" class="easyui-linkbutton easyui-tooltip" title="Create Challan" iconcls="icon-add" plain="true">Create Challan</a>
                            <a id="btnChallanListSUDO" href="javascript:void(0)" class="easyui-linkbutton easyui-tooltip" title="Challan List" iconcls="icon-details" plain="true">Challan List</a>
                            <a id="btnProgramHistorySUDO" style="float:right;" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-details" plain="true">Program History</a>
                            @using (Html.BeginForm("PrintSUDPsFromSUDO", "SUDeliveryProgram", FormMethod.Post, new { enctype = "multipart/form-data", target = "_blank"}))
                            {
                                <input type="text" name="txtCollectionPrintText" id="txtCollectionPrintText" hidden="hidden" />
                                <input type="submit" id="btnPrintList" value="    Print List" class="icon-print PrintList" />
                            }
                        </td>
                    </tr>
                </table>
            </div>
        </div>
    </body>
</html>
    <script type="text/javascript">
    var _oSUDeliveryProgram = {ErrorMessage:"",MKTPersonID:0,SUDeliveryProgramDateTime:''};
    var _oBaseSUDeliveryProgram = {ErrorMessage:"",MKTPersonID:0,SUDeliveryProgramDateTime:''};
    var _oSUDeliveryPrograms = [];
    var _oDBSUDeliveryPrograms = [];
    var _sBaseAddress = "";
    var _oCurrentUser={};
    var _oProduct={};
    var _otblColumns=[];
    var _nbtnIDNo =0;
    var _nAvailableMachines=0;
    var _oDeliveryOrders=[];
    var _oReceivedStores=[];
    var _oContractorTypes=[];
    var _oCheckedByUsers=[];
    var _oDOStatus=[];
    var _oSUDeliveryChallan=null;
    $(document).ready(function() {
        _sBaseAddress = @Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(HttpContext.Current.Session[SessionInfo.BaseAddress]));
        _oCurrentUser=@Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(HttpContext.Current.Session[SessionInfo.CurrentUser]));
        _oDeliveryOrders=@Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(Model));
        _oDOTypes = @Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(ViewBag.DOTypes));
        _oMktPersons = @Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(ViewBag.MktPersons));
        _oCurrencys = @Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(ViewBag.Currencys));
        _oContractorTypes = @Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(ViewBag.ContractorTypes));
        _oReceivedStores = @Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(ViewBag.ReceivedStores));
        _oCheckedByUsers = @Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(ViewBag.CheckedByUsers));
        _oDOStatus = @Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(ViewBag.DOStatus));
        InitializeSUDPChallanPrepareEvents();
        InitializeSUDeliveryOrderEvents();
        InitializeAdvSearchSUDeliveryOrderEvents();
        InitializeSUDeliveryChallanEvents();
        $("#txtDONoSUDOrder").focus();
    });
        $(document).keydown(function (e) { if (e.keyCode === 27) { $('div').icsWindow("close")}});

        function formatTotalChallan(value)
        {
            var nSUDOID = value.split("~")[0];
            var sTotalChallan = value.split("~")[1];
            var s = "";
            if(sTotalChallan != "-")
            {
                s = '<a  href="javascript:void(0)" onclick = "ViewChallanDetails('+nSUDOID+')"">'+sTotalChallan+'</a>';
            }
            return s;       
        }

        function ViewChallanDetails(nSUDOID)
        {
            if(nSUDOID>0)
            {
                var oSUDODs = $("#tblSUDOs").datagrid("getRows");
                var nIndex=0;
                for(var i=0;i<oSUDODs.length;i++)
                {
                    if(oSUDODs[i].SUDeliveryOrderID == parseInt(nSUDOID))
                    {
                        nIndex = i;
                        break;
                    }
                }
                $('#tblSUDOs').datagrid('selectRow', nIndex);
                var oSUDP = $('#tblSUDOs').datagrid('getSelected');
                if (oSUDP.SUDeliveryOrderID > 0) {
                    GetsBySUDeliveryOrder(oSUDP);
                }
            }
        }

 

        function GetsBySUDeliveryOrder(oDeliveryChallan)
        {
            $.ajax({
                type: "POST",
                dataType: "json",
                url: _sBaseAddress + "/SUDeliveryChallan/GetsBySUDeliveryOrder",
                traditional: true,
                data: JSON.stringify(oDeliveryChallan),
                contentType: "application/json; charset=utf-8",
                success: function (data) {
                    var oSUDeliveryOrders = jQuery.parseJSON(data);
                    if (oSUDeliveryOrders != null) {
                        if (oSUDeliveryOrders.length > 0) {
                            DynamicRefreshList(oSUDeliveryOrders, "tblSUDChallan");
                            $("#winSUDChallan").icsWindow("open", "Delivery Challans");
                            $("#btnViewSUDChallan").focus();
                        }
                        else {
                            alert("Sorry, No List Found.");
                            DynamicRefreshList([], "tblSUDChallan");
                        }
                    }
                    else {
                        alert("Invalid Object List.");
                    }
                },
                error: function (xhr, status, error) {
                    alert(error);
                }
            });
        }

    </script>
