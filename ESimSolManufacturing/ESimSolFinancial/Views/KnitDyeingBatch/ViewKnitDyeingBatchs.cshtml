@{
    ViewBag.Title = "Dyeing Batch List";
}
@model IEnumerable<ESimSol.BusinessObjects.KnitDyeingBatch>
    <div id="progbarParent" style="width:100%;height:100%;margin:0 auto;text-align:center; margin-left: auto;margin-right: auto;left: 0;right: 0;z-index: 1;">
        <div style="margin: 0px auto;margin-top: 251px;text-align:center;width:390px;">
            <label style="font-size:18px;">Please wait</label>
            <div id="progbar" style="width:100%;height:37px;"></div>
        </div>
    </div>
    <div class="menuMainCollectionTable">
        <div style="margin-left:0px; height:100%; width:100%; font-family:Tahoma">
            <table id="tblKnitDyeingBatchs" title="Dyeing Batch List" class="easyui-datagrid" fit="true" fitcolumns="true" rownumbers="true" pagination="true" singleselect="true" autorowheight="false" toolbar="#toolbar">
                <thead>
                    <tr>
                        <th field="StyleNo" width="100" align="left">Style No </th>
                        <th field="RefObjectNo" width="100">Recap/PAM No </th>
                        <th field="ColorName" width="120">Color Name </th>
                        <th field="BatchNo" width="100">Batch No </th>
                        <th field="BatchIssueDateSt" width="65">Issue Date</th>
                        <th field="FinishedGSMName" width="70">Finish GSM </th>
                        <th field="ApprovedByName" width="100">Approve By</th>
                        <th field="Remarks" width="120">Remarks</th>
                    </tr>
                </thead>
            </table>
            <div id="toolbar">
                <a id="btnAdvSearchPick" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-search" plain="true">Adv. Search</a>
                <a id="btnAdd" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-add" plain="true">Add</a>
                <a id="btnEdit" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-edit" plain="true">Edit</a>
                <a id="btnView" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-details" plain="true">View</a>
                <a id="btnDelete" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-remove" plain="true">Delete</a>
                <a id="btnApprove" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-ok" plain="true">Approve</a>
                <a id="btnPrintBatchCard" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-print" plain="true">Batch Card</a>
                @*<a id="btnGrayFabricOut" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-add" plain="true">Gray Fabric Out</a>*@
                <a id="btnGrayChallan" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-add" plain="true">Gray Challan</a>
                <a id="btnDisburse" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-ok" plain="true">Disburse</a>
                <a id="btnPrintChallan" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-print" plain="true">Challan Preview</a>
                <a id="btnPrintList" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-print" plain="true">Print List</a>
            </div>
        </div>

        <div id="winKnitDyeingBatchGrayChallan" class="easyui-window" title="DynamicTitle" style="width:1100px;height:440px;padding:2px;" data-options="modal:true,closed:true,collapsible:false,minimizable:false,maximizable:false,closable:false">
            <div>
                <table id="tblKnitDyeingBatchGrayChallan" title="Dynamic" class="easyui-datagrid" style="height:335px; width:100%;" fitcolumns="false" rownumbers="true" pagination="false" singleselect="true" autorowheight="false" showfooter="true" toolbar="#toolbarFabricOut">
                    <thead>
                        <tr>
                            <th field="FabricName" width="20%" align="left">Composition name</th>
                            <th field="StoreName" width="12%" align="left">Store</th>
                            <th field="LotNo" width="10%" align="left">Lot</th>
                            <th field="UnitName" width="10%" align="left">Unit</th>
                            <th field="Qty" width="8%" align="right" formatter="formatPrice">Qty</th>
                            <th field="Remarks" width="35%" align="left">Remarks</th>
                            <th field="DisburseByName" width="35%" align="left">Disburse By</th>
                        </tr>
                    </thead>
                </table>
                <div id="toolbarFabricOut">
                    <select id="cboKnitDyeingBatchDetail" style="width:350px;height:20px"></select>
                    <select id="cboStore" style="width:150px;height:20px"></select>
                    <input type="text" id="txtLot" style="width:150px" placeholder="Search By Lot No" />
                    <input id="btnClearLot" type="button" value="C" />
                    <input id="btnPickLot" type="button" value="P" />
                    <input type="text" class="number" id="txtFabricQty" style="width:70px" placeholder="Enter Qty" />
                    <input type="text" id="txtRemarks" placeholder="Remarks" style="width:150px" />
                    <a id="btnAddKnitDyeingBatchGrayChallan" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-add" plain="true"></a>
                    <a id="btnRemoveKnitDyeingBatchGrayChallan" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-remove" plain="true"></a>
                </div>
            </div>
            <fieldset style="width:100%; vertical-align:top;">
                <legend style="font-weight:bold"> Action : </legend>
                <a id="btnCloseKnitDyeingYarn" href="javascript:void(0)" style="float:right" class="easyui-linkbutton" iconcls="icon-cancel" plain="true">Close</a>
                <a id="btnDivDisburse" href="javascript:void(0)" style="float:right" class="easyui-linkbutton" iconcls="icon-ok" plain="true">Disburse</a>
                <a id="btnSaveKnitDyeingYarn" href="javascript:void(0)" style="float:right" class="easyui-linkbutton" iconcls="icon-save" plain="true">Save</a>
            </fieldset>
        </div>
    </div>
                      <div id="winAdvSearchBatch" class="easyui-window winClass" title="Advance Search" data-options="modal:true,closed:true,collapsible:false,minimizable:false,maximizable:false,closable:false">
                          <div style="width:560px; float: left;">
                              <fieldset>
                                  <legend>Searching Citeria</legend>
                                  <table border="0" cellpadding="2" cellspacing="2" style="font-size: 12px;width:100%">
                                      <tr>
                                          <td style="width:30%; text-align:right"><label>Style :</label></td>
                                          <td style="width:70%">
                                              <input type="text" id="txtAdvStyle" style="width:75%" placeholder="Enter Style No" />
                                              <input type="button" id="btnAdvStylePick" style="width:11%" value="P" />
                                              <input type="button" id="btnAdvStyleCancel" style="width:11%" value="C" />
                                          </td>
                                      </tr>
                                      <tr>
                                          <td style="width:30%; text-align:right"><label>Order Recap :</label></td>
                                          <td style="width:70%">
                                              <input type="text" id="txtAdvPO" style="width:75%" placeholder="Enter Po/ Order Recap/ Ps Qty" />
                                              <input type="button" id="btnAdvPOPick" style="width:11%" value="P" />
                                              <input type="button" id="btnAdvPOCancel" style="width:11%" value="C" />
                                          </td>
                                      </tr>
                                      <tr>
                                          <td style="width:30%; text-align:right"><label>Color :</label></td>
                                          <td style="width:70%">
                                              <input type="text" id="txtAdvColor" style="width:100%" placeholder="Enter Color Name" />
                                          </td>
                                      </tr>
                                      <tr>
                                          <td style="width:30%; text-align:right"><label>Batch No :</label></td>
                                          <td style="width:70%">
                                              <input type="text" id="txtAdvBatchNo" style="width:100%" placeholder="Enter Batch No" />
                                          </td>
                                      </tr>
                                      <tr>
                                          <td style="width:30%; text-align:right"><label>Dia :</label></td>
                                          <td style="width:70%">
                                              <select id="cboAdvDiaType" style="width:120px"></select>
                                              <input type="text" id="txtAdvDia" style="width:242px" placeholder="Enter Name"/>
                                          </td>
                                      </tr>
                                      <tr>
                                          <td style="width:30%; text-align:right"><label>Issue Date :</label></td>
                                          <td style="width:70%">
                                              <select id="cboAdvIssueDate" style="width:120px"></select>
                                              <input type="text" style="width:110px;" id="txtAdvIssueDateStart" class="easyui-datebox" data-options="formatter:icsdateformat,parser:icsdateparser" />
                                              to
                                              <input type="text" style="width:110px;" id="txtAdvIssueDateEnd" class="easyui-datebox" data-options="formatter:icsdateformat,parser:icsdateparser" />
                                          </td>
                                      </tr>
                                  </table>
                              </fieldset>
                              <fieldset class="actionfieldsetstyle">
                                  <legend>Actions : </legend>
                                  <a id="btnAdvReset" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-reload" plain="true">Reset</a>
                                  <a id="btnAdvSearch" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-search" plain="true">Search</a>
                                  <a id="btnAdvClose" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-cancel" plain="true">Close</a>
                              </fieldset>
                          </div>
                      </div>
    <style>
        .blueText {
            color: blue;
            font-style: italic;
        }

        .blackText {
            color: black;
        }
    </style>

    <script type="text/javascript">
        var nBUID = 0;
        $(document).ready(function () {
            debugger;
            nBUID = @Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(ViewBag.BUID));
            var oKnitDyeingBatchs =@Html.Raw( new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(Model));
            var oCompareOperators = @Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(ViewBag.CompareOperators));
            var oDyedTypes = @Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(ViewBag.DyedTypes));
            var oTempKnitDyeingBatchs = sessionStorage.getItem("KnitDyeingBatchs");

            var oCompareOperators = @Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(ViewBag.CompareOperators));
            var oSourcingConfigHeadTypes = @Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(ViewBag.SourcingConfigHeadType));
            var oKnitDyeingProgramStatus = @Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(ViewBag.KnitDyeingProgramStatus));

            $('#winAdvSearchBatch').data('CompareOperators', oCompareOperators);
            $('#winAdvSearchBatch').data('DyedTypes', oSourcingConfigHeadTypes);

            if(oTempKnitDyeingBatchs!=null)
            {
                oKnitDyeingBatchs = jQuery.parseJSON(oTempKnitDyeingBatchs);
            }
            RefreshList(oKnitDyeingBatchs);
            //RefreshControlLayout(oAURolesMapping);
            sessionStorage.setItem("BUID", nBUID);
            $("#progbar").progressbar({ value: 0 });
            $("#progbarParent").hide();
            $('#txtBuyerName').data('Buyers', []);
            $('#txtProductName').data('Products', []);
        });

        $('#btnApprove').click(function (e) {
            var oKnitDyeingBatch= $('#tblKnitDyeingBatchs').datagrid('getSelected');
            if(oKnitDyeingBatch==null || parseInt(oKnitDyeingBatch.KnitDyeingBatchID)<=0)
            {
                alert("Please select a item from list!");
                return;
            }
            if (!confirm("Confirm to Approved?")) return ;
            var SelectedRowIndex=$('#tblKnitDyeingBatchs').datagrid('getRowIndex',oKnitDyeingBatch);
            $.ajax({
                type: "POST",
                dataType: "JSON",
                url: sessionStorage.getItem("BaseAddress")+  "/KnitDyeingBatch/Approved",
                data:  JSON.stringify(oKnitDyeingBatch),
                contentType: "application/json; charset=utf-8",
                success: function (data) {
                    var  oKnitDyeingBatch = jQuery.parseJSON(data);
                    if (oKnitDyeingBatch != null &&  oKnitDyeingBatch.ErrorMessage == "" && parseInt(oKnitDyeingBatch.KnitDyeingBatchID)>0) {
                        alert("Approved Successfully");
                        $('#tblKnitDyeingBatchs').datagrid('updateRow',{ index: SelectedRowIndex, row: oKnitDyeingBatch });
                    }
                    else
                    {
                        alert(oKnitDyeingBatch.ErrorMessage);
                    }
                },
                error: function (xhr, status, error) {
                    alert(error);
                }
            });
        });

        $('#btnAdd').click(function (e) {
            debugger;
            var tsv=((new Date()).getTime())/1000;
            sessionStorage.setItem('BUID', nBUID);
            var oKnitDyeingBatchs= $('#tblKnitDyeingBatchs').datagrid('getRows');
            sessionStorage.setItem("KnitDyeingBatchs", JSON.stringify(oKnitDyeingBatchs));
            sessionStorage.setItem("KnitDyeingBatchHeader", "Add Dyeing Batch");
            sessionStorage.setItem("SelectedRowIndex", -1);
            sessionStorage.setItem("BackLink", window.location.href);
            window.location.href = sessionStorage.getItem("BaseAddress")+  "/KnitDyeingBatch/ViewKnitDyeingBatch?id=0&ts="+tsv;
        });

        $('#btnEdit').click(function (e) {
            var oKnitDyeingBatch= $('#tblKnitDyeingBatchs').datagrid('getSelected');
            if(oKnitDyeingBatch==null || parseInt(oKnitDyeingBatch.KnitDyeingBatchID)<=0)
            {
                alert("Please select a item from list!");
                return;
            }
            if(oKnitDyeingBatch==null || parseInt(oKnitDyeingBatch.ApprovedBy)>0)
            {
                alert("Already Approved !!");
                return;
            }
            var tsv=((new Date()).getTime())/1000;
            var SelectedRowIndex=$('#tblKnitDyeingBatchs').datagrid('getRowIndex',oKnitDyeingBatch);
            var oKnitDyeingBatchs= $('#tblKnitDyeingBatchs').datagrid('getRows');
            sessionStorage.setItem("KnitDyeingBatchs", JSON.stringify(oKnitDyeingBatchs));
            sessionStorage.setItem("SelectedRowIndex", SelectedRowIndex);
            sessionStorage.setItem("KnitDyeingBatchHeader", "Edit Dyeing Batch");
            sessionStorage.setItem("BackLink", window.location.href);
            window.location.href = sessionStorage.getItem("BaseAddress")+  "/KnitDyeingBatch/ViewKnitDyeingBatch?id="+oKnitDyeingBatch.KnitDyeingBatchID+"&ts="+tsv;
        });

        $('#btnGrayChallan').click(function (e) {
            var oKnitDyeingBatch= $('#tblKnitDyeingBatchs').datagrid('getSelected');
            if(oKnitDyeingBatch==null || parseInt(oKnitDyeingBatch.KnitDyeingBatchID)<=0)
            {
                alert("Please select a item from list!");
                return;
            }
            var tsv=((new Date()).getTime())/1000;
            var SelectedRowIndex=$('#tblKnitDyeingBatchs').datagrid('getRowIndex',oKnitDyeingBatch);
            var oKnitDyeingBatchs= $('#tblKnitDyeingBatchs').datagrid('getRows');
            sessionStorage.setItem("KnitDyeingBatchs", JSON.stringify(oKnitDyeingBatchs));
            sessionStorage.setItem("SelectedRowIndex", SelectedRowIndex);
            sessionStorage.setItem("Operation", "GrayChallan");
            sessionStorage.setItem("BackLink", window.location.href);
            window.location.href = sessionStorage.getItem("BaseAddress")+  "/KnitDyeingGrayChallan/ViewKnitDyeingGrayChallan?nId="+oKnitDyeingBatch.KnitDyeingBatchID+"&nBUID="+nBUID+"&ts="+tsv;
        });

        $("#btnView").click(function(){
            var oKnitDyeingBatch= $('#tblKnitDyeingBatchs').datagrid('getSelected');
            if(oKnitDyeingBatch==null || oKnitDyeingBatch.KnitDyeingBatchID<=0)
            {
                alert("Please select a item from list!");
                return;
            }
            var tsv=((new Date()).getTime())/1000;
            var SelectedRowIndex=$('#tblKnitDyeingBatchs').datagrid('getRowIndex',oKnitDyeingBatch);
            var oKnitDyeingBatchs= $('#tblKnitDyeingBatchs').datagrid('getRows');
            sessionStorage.setItem("KnitDyeingBatchs", JSON.stringify(oKnitDyeingBatchs));
            sessionStorage.setItem("SelectedRowIndex", SelectedRowIndex);
            sessionStorage.setItem("KnitDyeingBatchHeader", "View Dyeing Batch");
            sessionStorage.setItem("BackLink", window.location.href);
            window.location.href = sessionStorage.getItem("BaseAddress")+  "/KnitDyeingBatch/ViewKnitDyeingBatch?id="+oKnitDyeingBatch.KnitDyeingBatchID+"&ts="+tsv;
        });

        $('#btnDelete').click(function (e) {
            var oKnitDyeingBatch = $('#tblKnitDyeingBatchs').datagrid('getSelected');
            if(oKnitDyeingBatch==null || oKnitDyeingBatch.KnitDyeingBatchID<=0)
            {
                alert("Please select a item from list!");
                return;
            }
            if(parseInt(oKnitDyeingBatch.ApprovedBy)!=0)
            {
                alert("Selected Knit Dyeing Batch already Approved!");
                return;
            }
            if (!confirm("Confirm to Delete?")) return ;
            var SelectedRowIndex=$('#tblKnitDyeingBatchs').datagrid('getRowIndex',oKnitDyeingBatch);
            $.ajax({
                type: "GEt",
                dataType: "json",
                url: sessionStorage.getItem("BaseAddress")+ "/KnitDyeingBatch/Delete",
                traditional: true,
                data:  {id: oKnitDyeingBatch.KnitDyeingBatchID},
                contentType: "application/json; charset=utf-8",
                success: function (data) {
                    debugger;
                    feedbackmessage = jQuery.parseJSON(data);
                    if (feedbackmessage == "Data delete successfully")
                    {
                        alert("Delete sucessfully");
                        $('#tblKnitDyeingBatchs').datagrid('deleteRow',SelectedRowIndex);
                    }
                    else
                    {
                        alert(feedbackmessage);
                    }
                },
                error: function (xhr, status, error) {
                    alert(error);
                }
            });
        });

        //$('#btnGrayFabricOut').click(function(e){
        //    $('#tblKnitDyeingBatchGrayChallan').datagrid('loadData', []);
        //    var KnitDyeingBatch =$('#tblKnitDyeingBatchs').datagrid('getSelected');
        //    if(KnitDyeingBatch == null || parseInt(KnitDyeingBatch.KnitDyeingBatchID) <=0)
        //    {
        //        alert("Please Select an Item !!");
        //        return;
        //    }
        //    $("#winKnitDyeingBatchGrayChallan").icsWindow('open', "Batch Gray Challan");
        //    var dgPanel = $('#tblKnitDyeingBatchGrayChallan').datagrid('getPanel');
        //    dgPanel.panel('setTitle', KnitDyeingBatch.PanelHeader);
        //    GetKnitDyeingBatchDetails(KnitDyeingBatch.KnitDyeingBatchID);
        //    GetKnitDyeingBatchGrayChallans(KnitDyeingBatch.KnitDyeingBatchID);
        //    $('#winKnitDyeingBatchGrayChallan').data('KnitDyeingBatch',KnitDyeingBatch);
        //    $('#winKnitDyeingBatchGrayChallan').data('Lot',[]);
        //    $('#toolbarFabricOut').show();
        //    $('#btnDivDisburse').hide();
        //    $('#btnSaveKnitDyeingYarn').show();
        //});
        $('#btnDisburse').click(function(e){
            debugger;
            var oKnitDyeingBatch= $('#tblKnitDyeingBatchs').datagrid('getSelected');
            if(oKnitDyeingBatch==null || parseInt(oKnitDyeingBatch.KnitDyeingBatchID)<=0)
            {
                alert("Please select a item from list!");
                return;
            }
            if(oKnitDyeingBatch.ApprovedBy <= 0)
            {
                alert("Not Approved Yet !!");
                return;
            }
            var tsv=((new Date()).getTime())/1000;
            var SelectedRowIndex=$('#tblKnitDyeingBatchs').datagrid('getRowIndex',oKnitDyeingBatch);
            var oKnitDyeingBatchs= $('#tblKnitDyeingBatchs').datagrid('getRows');
            sessionStorage.setItem("KnitDyeingBatchs", JSON.stringify(oKnitDyeingBatchs));
            sessionStorage.setItem("SelectedRowIndex", SelectedRowIndex);
            sessionStorage.setItem("Operation", "Disburse");
            sessionStorage.setItem("BackLink", window.location.href);
            window.location.href = sessionStorage.getItem("BaseAddress")+  "/KnitDyeingGrayChallan/ViewKnitDyeingGrayChallan?nId="+oKnitDyeingBatch.KnitDyeingBatchID+"&nBUID="+nBUID+"&ts="+tsv;
        });
        function RefreshList(oKnitDyeingBatchs)
        {
            data = oKnitDyeingBatchs;
            data={"total":""+data.length+"","rows":data};
            $('#tblKnitDyeingBatchs').datagrid('loadData',data);
            var nIndex= parseInt(sessionStorage.getItem("SelectedRowIndex"));
            $('#tblKnitDyeingBatchs').datagrid('selectRow',nIndex);
        }

        $('#btnPrintBatchCard').click(function (e) {
            debugger;
            var oKnitDyeingBatch = $('#tblKnitDyeingBatchs').datagrid('getSelected');
            if(oKnitDyeingBatch==null || oKnitDyeingBatch.KnitDyeingBatchID<=0)
            {
                alert("Please select a item from list!");
                return;
            }
            var tsv = ((new Date()).getTime())/1000;
            window.open(sessionStorage.getItem("BaseAddress")+'/KnitDyeingBatch/PrintKnitDyeingBatch?id='+oKnitDyeingBatch.KnitDyeingBatchID+"&ts="+tsv, "_blank")
        });

        $('#btnPrintChallan').click(function (e) {
            debugger;
            var oKnitDyeingBatch = $('#tblKnitDyeingBatchs').datagrid('getSelected');
            if(oKnitDyeingBatch==null || oKnitDyeingBatch.KnitDyeingBatchID<=0)
            {
                alert("Please select a item from list!");
                return;
            }
            var tsv = ((new Date()).getTime())/1000;
            window.open(sessionStorage.getItem("BaseAddress")+'/KnitDyeingGrayChallan/PrintKnitDyeingChallan?id='+oKnitDyeingBatch.KnitDyeingBatchID+"&ts="+tsv, "_blank")
        });

        //Start Search
        function RefreshComboBoxControls()
        {
            var oDeliveryUsers = $('#cboDeliveryBy').data('DeliveryUsers');
            var oDateCompareOperatorObjs = $('#cboChallanDate').data('DateCompareOperatorObjs');
            var oAmountCompareOperatorObjs = $('#cboKnitDyeingBatchAmount').data('AmountCompareOperatorObj');
            $("#cboDeliveryBy").icsLoadCombo({ List: oDeliveryUsers, OptionValue: "UserID", DisplayText: "UserName" });
            $("#cboChallanDate").icsLoadCombo({ List: oDateCompareOperatorObjs, OptionValue: "id", DisplayText: "Value" });
            $("#cboKnitDyeingBatchAmount").icsLoadCombo({ List: oAmountCompareOperatorObjs, OptionValue: "id", DisplayText: "Value" });
        }

        function ValidateSearch()
        {
            var sChallanNo =$.trim($('#txtChallanNo').val());
            var sInvocieNo =$.trim($('#txtInvocieNo').val());
            var nChallanDate = parseInt($('#cboChallanDate').val());
            if(nChallanDate===1 || nChallanDate===2 || nChallanDate===3 || nChallanDate===4)
            {
                var sKnitDyeingBatchStartDate   = $('#txtKnitDyeingBatchStartDate').datebox('getValue');
                if(sKnitDyeingBatchStartDate===null || sKnitDyeingBatchStartDate==="")
                {
                    alert("Please select KnitDyeingBatch start date!");
                    $('#txtKnitDyeingBatchStartDate').focus();
                    return false;
                }
            }
            if(nChallanDate===5 || nChallanDate===6)
            {
                var sKnitDyeingBatchStartDate   = $('#txtKnitDyeingBatchStartDate').datebox('getValue');
                var sKnitDyeingBatchEndDate   = $('#txtKnitDyeingBatchEndDate').datebox('getValue');
                if(sKnitDyeingBatchStartDate===null || sKnitDyeingBatchStartDate==="")
                {
                    alert("Please select KnitDyeingBatch start date!");
                    $('#txtKnitDyeingBatchStartDate').focus();
                    return false;
                }
                if(sKnitDyeingBatchEndDate===null || sKnitDyeingBatchEndDate==="")
                {
                    alert("Please select KnitDyeingBatch end date!");
                    $('#txtKnitDyeingBatchEndDate').focus();
                    return false;
                }
                if(new Date(sKnitDyeingBatchStartDate) > new Date(sKnitDyeingBatchEndDate))
                {
                    alert("Start date must be smallar than or equal end date!");
                    $('#txtKnitDyeingBatchStartDate').focus();
                    return false;
                }
            }

            var nKnitDyeingBatchAmount = parseInt($('#cboKnitDyeingBatchAmount').val());
            if(nKnitDyeingBatchAmount===1 || nKnitDyeingBatchAmount===2 || nKnitDyeingBatchAmount===3 || nKnitDyeingBatchAmount===4)
            {
                var sKnitDyeingBatchAmountStart   = $.trim($('#txtKnitDyeingBatchAmountStart').val());
                if(sKnitDyeingBatchAmountStart===null || sKnitDyeingBatchAmountStart==="")
                {
                    alert("Please enter KnitDyeingBatch start Amount!");
                    $('#txtKnitDyeingBatchAmountStart').focus();
                    return false;
                }
                if(icsRemoveComma(sKnitDyeingBatchAmountStart)<=0)
                {
                    alert("Please enter KnitDyeingBatch start Amount!");
                    $('#txtKnitDyeingBatchAmountStart').focus();
                    return false;
                }
            }
            if(nKnitDyeingBatchAmount===5 || nKnitDyeingBatchAmount===6)
            {
                var sKnitDyeingBatchAmountStart = $.trim($('#txtKnitDyeingBatchAmountStart').val());
                if(sKnitDyeingBatchAmountStart===null || sKnitDyeingBatchAmountStart==="")
                {
                    alert("Please enter KnitDyeingBatch start Amount!");
                    $('#txtKnitDyeingBatchAmountStart').focus();
                    return false;
                }
                if(icsRemoveComma(sKnitDyeingBatchAmountStart)<=0)
                {
                    alert("Please enter KnitDyeingBatch start Amount!");
                    $('#txtKnitDyeingBatchAmountStart').focus();
                    return false;
                }

                var sKnitDyeingBatchAmountEnd = $.trim($('#txtKnitDyeingBatchAmountEnd').val());
                if(sKnitDyeingBatchAmountEnd===null || sKnitDyeingBatchAmountEnd==="")
                {
                    alert("Please enter KnitDyeingBatch end Amount!");
                    $('#txtKnitDyeingBatchAmountEnd').focus();
                    return false;
                }
                if(icsRemoveComma(sKnitDyeingBatchAmountEnd)<=0)
                {
                    alert("Please enter KnitDyeingBatch end Amount!");
                    $('#txtKnitDyeingBatchAmountEnd').focus();
                    return false;
                }
                if(icsRemoveComma(sKnitDyeingBatchAmountStart) >= icsRemoveComma(sKnitDyeingBatchAmountEnd))
                {
                    alert("Start amount must be smallar than end amount!");
                    $('#txtKnitDyeingBatchAmountStart').focus();
                    return false;
                }
            }

            var nDeliveryBy = parseInt($('#cboDeliveryBy').val());
            var oBuyers = $('#txtBuyerName').data('Buyers');
            var oProducts = $('#txtProductName').data('Products');

            if(sChallanNo==="" && sInvocieNo==="" && nChallanDate===0 && nKnitDyeingBatchAmount===0 && nDeliveryBy===0 && oBuyers.length<=0 && oProducts.length<=0)
            {
                alert("Please select atleast one searching criteriea!");
                return false;
            }
            return true;
        }

        $('#btnAdvSearch').click(function(e){
            $("#winAdvanceSearch").icsWindow('open', "Advance Search");
            $("#winAdvanceSearch input").not("input[type='button']").val("");
            $('#txtKnitDyeingBatchStartDate').datebox('setValue', icsdateformat(new Date()));
            $('#txtKnitDyeingBatchEndDate').datebox('setValue', icsdateformat(new Date()));
            $('#txtKnitDyeingBatchAmountStart').val('0.00');
            $('#txtKnitDyeingBatchAmountEnd').val('0.00');
            $('#txtKnitDyeingBatchAmountStart').prop("disabled", true);
            $('#txtKnitDyeingBatchAmountEnd').prop("disabled", true);
            $('#txtBuyerName').data('Buyers', []);
            $('#txtProductName').data('Products', []);
            RefreshComboBoxControls();
        });

        $('#btnAdvSearchClose').click(function(e){
            $("#winAdvanceSearch").icsWindow('close');
        });

        $('#cboChallanDate').change(function(e){
            //EqualTo = 1, NotEqualTo = 2, GreaterThen = 3, SmallerThen = 4, Between = 5, NotBetween = 6
            var nCompareOperator =   parseInt($('#cboChallanDate').val());
            if(nCompareOperator===0)
            {
                $('#txtKnitDyeingBatchStartDate').datebox({ disabled : true });
                $('#txtKnitDyeingBatchEndDate').datebox({ disabled : true });
            }
            else if (nCompareOperator===1 || nCompareOperator===2 || nCompareOperator===3 || nCompareOperator===4)
            {
                $('#txtKnitDyeingBatchStartDate').datebox({ disabled : false });
                $('#txtKnitDyeingBatchEndDate').datebox({ disabled : true });
            }
            else
            {
                $('#txtKnitDyeingBatchStartDate').datebox({ disabled : false });
                $('#txtKnitDyeingBatchEndDate').datebox({ disabled : false });
            }
            $('#txtKnitDyeingBatchStartDate').datebox('setValue', icsdateformat(new Date()));
            $('#txtKnitDyeingBatchEndDate').datebox('setValue', icsdateformat(new Date()));
        });

        $('#cboKnitDyeingBatchAmount').change(function(e){
            //EqualTo = 1, NotEqualTo = 2, GreaterThen = 3, SmallerThen = 4, Between = 5, NotBetween = 6
            var nCompareOperator =   parseInt($('#cboKnitDyeingBatchAmount').val());
            if(nCompareOperator===0)
            {
                $('#txtKnitDyeingBatchAmountStart').prop("disabled", true);
                $('#txtKnitDyeingBatchAmountEnd').prop("disabled", true);
            }
            else if (nCompareOperator===1 || nCompareOperator===2 || nCompareOperator===3 || nCompareOperator===4)
            {
                $('#txtKnitDyeingBatchAmountStart').prop("disabled", false);
                $('#txtKnitDyeingBatchAmountEnd').prop("disabled", true);
            }
            else
            {
                $('#txtKnitDyeingBatchAmountStart').prop("disabled", false);
                $('#txtKnitDyeingBatchAmountEnd').prop("disabled", false);
            }
            $('#txtKnitDyeingBatchAmountStart').val('0.00');
            $('#txtKnitDyeingBatchAmountEnd').val('0.00');
        });

        $('#btnAdvSearchReset').click(function(e){
            $("#winAdvanceSearch input").not("input[type='button']").val("");
            $('#cboChallanDate').val(0);
            $('#txtKnitDyeingBatchStartDate').datebox({ disabled : true });
            $('#txtKnitDyeingBatchEndDate').datebox({ disabled : true });
            $('#txtKnitDyeingBatchStartDate').datebox('setValue', icsdateformat(new Date()));
            $('#txtKnitDyeingBatchEndDate').datebox('setValue', icsdateformat(new Date()));

            $('#cboKnitDyeingBatchAmount').val(0);
            $('#txtKnitDyeingBatchAmountStart').prop("disabled", true);
            $('#txtKnitDyeingBatchAmountEnd').prop("disabled", true);
            $('#txtKnitDyeingBatchAmountStart').val('0.00');
            $('#txtKnitDyeingBatchAmountEnd').val('0.00');

            $('#cboDeliveryBy').val(0);
            $('#txtBuyerName').data('Buyers', []);
            $("#txtBuyerName").removeClass("fontColorOfPickItem");
            $('#txtProductName').data('Products', []);
            $("#txtProductName").removeClass("fontColorOfPickItem");
        });

        $('#btnSearch').click(function(e){
            if(!ValidateSearch()) return;

            var sChallanNo =$.trim($('#txtChallanNo').val());
            var sInvocieNo =$.trim($('#txtInvocieNo').val());

            var nChallanDate = parseInt($('#cboChallanDate').val());
            var sKnitDyeingBatchStartDate   = $('#txtKnitDyeingBatchStartDate').datebox('getValue');
            var sKnitDyeingBatchEndDate   = $('#txtKnitDyeingBatchEndDate').datebox('getValue');

            var nKnitDyeingBatchAmount = parseInt($('#cboKnitDyeingBatchAmount').val());
            var sKnitDyeingBatchAmountStart = icsRemoveComma($.trim($('#txtKnitDyeingBatchAmountStart').val()));
            var sKnitDyeingBatchAmountEnd = icsRemoveComma($.trim($('#txtKnitDyeingBatchAmountEnd').val()));

            var nDeliveryBy = parseInt($('#cboDeliveryBy').val());
            var oBuyers = $('#txtBuyerName').data('Buyers');
            var oProducts = $('#txtProductName').data('Products');

            if(oBuyers===null) {oBuyers = []; }
            if(oProducts===null) {oProducts = []; }
            var sBuyerIDs =""; var sProductIDs ="";

            for(var i=0; i<oBuyers.length; i++)
            {
                sBuyerIDs  = sBuyerIDs + oBuyers[i].ContractorID+ ",";
            }
            if(sBuyerIDs.length>0)
            {
                sBuyerIDs=sBuyerIDs.substring(0, sBuyerIDs.length-1);
            }
            for(var i=0; i<oProducts.length; i++)
            {
                sProductIDs  = sProductIDs + oProducts[i].ProductID+ ",";
            }
            if(sProductIDs.length>0)
            {
                sProductIDs=sProductIDs.substring(0, sProductIDs.length-1);
            }

            var sSearchingData  =  sChallanNo+'~';
            sSearchingData = sSearchingData + sInvocieNo+'~';
            sSearchingData = sSearchingData + nChallanDate+'~';
            sSearchingData = sSearchingData + sKnitDyeingBatchStartDate+'~';
            sSearchingData = sSearchingData + sKnitDyeingBatchEndDate+'~';
            sSearchingData = sSearchingData + nKnitDyeingBatchAmount+'~';
            sSearchingData = sSearchingData + sKnitDyeingBatchAmountStart+'~';
            sSearchingData = sSearchingData + sKnitDyeingBatchAmountEnd+'~';
            sSearchingData = sSearchingData + nDeliveryBy+'~';
            sSearchingData = sSearchingData + sBuyerIDs +'~';
            sSearchingData = sSearchingData + sProductIDs;

            var oKnitDyeingBatch = {
                Note : sSearchingData,
                BUID : parseInt(sessionStorage.getItem("BUID"))
            };

            $.ajax({
                type: "POST",
                dataType: "JSON",
                url: sessionStorage.getItem("BaseAddress")+  "/KnitDyeingBatch/AdvanceSearch",
                data:  JSON.stringify(oKnitDyeingBatch),
                contentType: "application/json; charset=utf-8",
                success: function (data) {
                    var  oKnitDyeingBatchs = jQuery.parseJSON(data);
                    if (oKnitDyeingBatchs != null) {
                        if(oKnitDyeingBatchs.length>0)
                        {
                            if(oKnitDyeingBatchs[0].ErrorMessage=="")
                            {
                                RefreshList(oKnitDyeingBatchs);
                                $('#tblKnitDyeingBatchs').data('KnitDyeingBatchs', oKnitDyeingBatchs);
                                $("#winAdvanceSearch").icsWindow('close');
                            }
                            else
                            {
                                alert(oKnitDyeingBatchs[0].ErrorMessage);
                            }
                        }
                        else
                        {
                            alert("Data not found!!");
                        }
                    }
                },
                error: function (xhr, status, error) {
                    alert(error);
                }
            });
        });

        $('#txtSearchByBatchNo').keyup(function (e) {
            var c = String.fromCharCode(e.which);
            var txtSearchByName = document.getElementById('txtSearchByBatchNo').value;

            var oSearchedKnitDyeingBatchs = [];  var sTempName="";
            var oKnitDyeingBatchList = $('#tblKnitDyeingBatchs').datagrid('getRows');
            if (e.which == 8)
            {
                oKnitDyeingBatchList = $('#tblKnitDyeingBatchs').data('KnitDyeingBatchs');
            }
            for(i=0;i<oKnitDyeingBatchList.length;++i){
                sTempName=oKnitDyeingBatchList[i].ChallanNo;
                n=sTempName.toUpperCase().indexOf(txtSearchByName.toUpperCase())
                if(n!=-1)
                {
                    oSearchedKnitDyeingBatchs.push(oKnitDyeingBatchList[i]);
                }
            }
            RefreshList(oSearchedKnitDyeingBatchs);
        });

        ///Buyer Pick
        $("#txtBuyerName").keydown(function (e) {
            var code = (e.keyCode ? e.keyCode : e.which);
            if (code == 13) // Enter Press
            {
                var nBUID = parseInt(sessionStorage.getItem("BUID"));
                var oContractor = { Params: 2 + '~' + $.trim($('#txtBuyerName').val())+'~'+ nBUID };//here 2 is Buyer
                var obj = {
                    BaseAddress: sessionStorage.getItem("BaseAddress"),
                    Object: oContractor,
                    ControllerName: "Contractor",
                    ActionName: "ContractorSearchByNameType",
                    IsWinClose: false
                };
                $("#progbar").progressbar({ value: 0 });
                $("#progbarParent").show();
                var intervalID = setInterval(updateProgress, 250);
                $.icsDataGets(obj, function (response) {
                    clearInterval(intervalID);
                    $("#progbarParent").hide();
                    if (response.status && response.objs.length > 0) {
                        if (response.objs[0].ContractorID > 0) {
                            var tblColums = []; var oColumn = { field: "Name", title: "Name", width: 200, align: "left" }; tblColums.push(oColumn);
                            oColumn = { field: "Address", title: "Address", width: 120, align: "left" }; tblColums.push(oColumn);
                            oColumn = { field: "Email", title: "Email", width: 90, align: "left" }; tblColums.push(oColumn);
                            oColumn = { field: "ShortName", title: "Short Name", width: 90, align: "left" }; tblColums.push(oColumn);
                            var oPickerParam = {
                                winid: 'winBuyers',
                                winclass: 'clsBuyer',
                                winwidth: 600,
                                winheight: 460,
                                tableid: 'tblBuyers',
                                tablecolumns: tblColums,
                                datalist: response.objs,
                                multiplereturn: true,
                                searchingbyfieldName: 'Name',
                                windowTittle: 'Buyer List'
                            };
                            $.icsPicker(oPickerParam);
                            IntializePickerbutton(oPickerParam);
                        }
                        else { alert(response.objs[0].ErrorMessage); }
                    }else{
                        alert("Data Not Found.");
                        return;
                    }
                });
            }
        });
        $("#btnBuyerPicker").click(function () {
            var nBUID = parseInt(sessionStorage.getItem("BUID"));
            var oContractor = { Params: "2~~"+nBUID };//here 2 Is Buyer
            var obj = {
                BaseAddress: sessionStorage.getItem("BaseAddress"),
                Object: oContractor,
                ControllerName: "Contractor",
                ActionName: "ContractorSearchByNameType",
                IsWinClose: false
            };
            $("#progbar").progressbar({ value: 0 });
            $("#progbarParent").show();
            var intervalID = setInterval(updateProgress, 250);
            $.icsDataGets(obj, function (response) {
                clearInterval(intervalID);
                $("#progbarParent").hide();
                if (response.status && response.objs.length > 0) {
                    if (response.objs[0].ContractorID > 0) {
                        var tblColums = []; var oColumn = { field: "Name", title: "Name", width: 200, align: "left" }; tblColums.push(oColumn);
                        oColumn = { field: "Address", title: "Address", width: 120, align: "left" }; tblColums.push(oColumn);
                        oColumn = { field: "Email", title: "Email", width: 90, align: "left" }; tblColums.push(oColumn);
                        oColumn = { field: "ShortName", title: "Short Name", width: 90, align: "left" }; tblColums.push(oColumn);
                        var oPickerParam = {
                            winid: 'winBuyers',
                            winclass: 'clsBuyer',
                            winwidth: 600,
                            winheight: 460,
                            tableid: 'tblBuyers',
                            tablecolumns: tblColums,
                            datalist: response.objs,
                            multiplereturn: true,
                            searchingbyfieldName: 'Name',
                            windowTittle: 'Buyer List'
                        };
                        $.icsPicker(oPickerParam);
                        IntializePickerbutton(oPickerParam);
                    }
                    else { alert(response.objs[0].ErrorMessage); }
                }else{
                    alert("Data Not Found.");
                }
            });

        });
        $('#txtBuyerName').keydown(function (e) {
            var code = (e.keyCode ? e.keyCode : e.which);
            if (code == 8) //backspace=8
            {
                $("#txtBuyerName").removeClass("fontColorOfPickItem");
                $('#txtBuyerName').data('BuyerID', 0);
            }
        });
        $('#btnBuyerClear').click(function(e){
            $("#txtBuyerName").val("");
            $('#txtBuyerName').data('Buyers', []);
            $("#txtBuyerName").removeClass("fontColorOfPickItem");
        });
        //End Buyer Picker

        //Product Pick
        $("#txtProductName").keydown(function (e) {
            var code = (e.keyCode ? e.keyCode : e.which);
            if (code == 13) // Enter Press
            {
                if($('#txtProductName').val()==null || $('#txtProductName').val()=="")
                {
                    alert("Please Type Product and Press Enter.");
                    $('#txtProductName').focus();
                    return;
                }
                var nBUID = parseInt(sessionStorage.getItem("BUID"));
                var oProduct = { BUID: nBUID, ProductName: $.trim($('#txtProductName').val())};
                var obj = {
                    BaseAddress: sessionStorage.getItem("BaseAddress"),
                    Object: oProduct,
                    ControllerName: "Product",
                    ActionName: "SearchByProductBUWise",
                    IsWinClose: false
                };
                $.icsProgressBar(true);
                $.icsDataGets(obj, function (response) {
                    $.icsProgressBar(false);
                    if (response.status && response.objs.length > 0) {
                        if (response.objs[0].ProductID > 0) {
                            var tblColums = [];
                            var oColumn = { field: "ProductCode", title: "Product Code", width: 80, align: "left" }; tblColums.push(oColumn);
                            oColumn = { field: "ProductName", title: "Product Name", width: 300, align: "left" }; tblColums.push(oColumn);
                            oColumn = { field: "ShortName", title: "Short Name", width: 100, align: "left" }; tblColums.push(oColumn);
                            oColumn = { field: "ProductCategoryName", title: "Category", width: 100, align: "left" }; tblColums.push(oColumn);
                            var oPickerParam = {
                                winid: 'winProductPicker',
                                winclass: 'clsProductPicker',
                                winwidth: 600,
                                winheight: 460,
                                tableid: 'tblProductPicker',
                                tablecolumns: tblColums,
                                datalist: response.objs,
                                multiplereturn: true,
                                searchingbyfieldName: 'NameCode',
                                windowTittle: 'Product List'
                            };
                            $.icsPicker(oPickerParam);
                            IntializePickerbutton(oPickerParam);
                        }
                        else {
                            alert(response.objs[0].ErrorMessage);
                        }

                    }else{
                        alert("Data Not Found.");
                    }
                });
            }
        });
        $("#btnProductPicker").click(function () {
            var nBUID = parseInt(sessionStorage.getItem("BUID"));
            var oProduct = { BUID: nBUID};
            var obj = {
                BaseAddress: sessionStorage.getItem("BaseAddress"),
                Object: oProduct,
                ControllerName: "Product",
                ActionName: "SearchByProductBUWise",
                IsWinClose: false
            };
            $.icsProgressBar(true);
            $.icsDataGets(obj, function (response) {
                $.icsProgressBar(false);
                if (response.status && response.objs.length > 0) {
                    if (response.objs[0].ProductID > 0) {
                        var tblColums = [];
                        var oColumn = { field: "ProductCode", title: "Product Code", width: 80, align: "left" }; tblColums.push(oColumn);
                        oColumn = { field: "ProductName", title: "Product Name", width: 300, align: "left" }; tblColums.push(oColumn);
                        oColumn = { field: "ShortName", title: "Short Name", width: 100, align: "left" }; tblColums.push(oColumn);
                        oColumn = { field: "ProductCategoryName", title: "Category", width: 100, align: "left" }; tblColums.push(oColumn);
                        var oPickerParam = {
                            winid: 'winProductPicker',
                            winclass: 'clsProductPicker',
                            winwidth: 600,
                            winheight: 460,
                            tableid: 'tblProductPicker',
                            tablecolumns: tblColums,
                            datalist: response.objs,
                            multiplereturn: true,
                            searchingbyfieldName: 'NameCode',
                            windowTittle: 'Product List'
                        };
                        $.icsPicker(oPickerParam);
                        IntializePickerbutton(oPickerParam);
                    }
                    else {
                        alert(response.objs[0].ErrorMessage);
                    }

                }else{
                    alert("Data Not Found.");
                }
            });
        });
        $('#txtProductName').keydown(function (e) {
            var code = (e.keyCode ? e.keyCode : e.which);
            if (code == 8) //backspace=8
            {
                $("#txtProductName").removeClass("fontColorOfPickItem");
                $('#txtProductName').data('Product', null);
            }
        });
        $('#btnProductClear').click(function(e){
            $("#txtProductName").val("");
            $('#txtProductName').data('Products', []);
            $("#txtProductName").removeClass("fontColorOfPickItem");
        });
        //End Product

        function IntializePickerbutton(oPickerobj) {
            $("#" + oPickerobj.winid).find("#btnOk").click(function () {
                //for Single Select
                SetPickerValueAssign(oPickerobj);
            });
            $(document).find('.' + oPickerobj.winclass).keydown(function (e) {
                if (e.which == 13)//enter=13
                {
                    SetPickerValueAssign(oPickerobj);
                }
            });
        }

        function SetPickerValueAssign(oPickerobj) {
            var oreturnObj = null, oreturnobjs = [];
            if (oPickerobj.multiplereturn) {
                oreturnobjs = $('#' + oPickerobj.tableid).datagrid('getChecked');
            } else {
                oreturnObj = $('#' + oPickerobj.tableid).datagrid('getSelected');
            }
            $("#" + oPickerobj.winid).icsWindow("close");
            $("#" + oPickerobj.winid).remove();

            if (oPickerobj.winid === 'winBuyers')
            {
                if (oreturnobjs != null && oreturnobjs.length > 0) {
                    $('#txtBuyerName').val(oreturnobjs.length+"'s Buyers seleted");
                    $('#txtBuyerName').addClass('fontColorOfPickItem');
                    $('#txtBuyerName').data('Buyers', oreturnobjs);
                    $('#txtBuyerName').focus();
                }
            }
            else if (oPickerobj.winid == 'winProductPicker')
            {
                if (oreturnobjs != null && oreturnobjs.length > 0)
                {
                    $('#txtProductName').val(oreturnobjs.length+"'s products seleted");
                    $('#txtProductName').addClass('fontColorOfPickItem');
                    $('#txtProductName').data('Products', oreturnobjs);
                }
            }
        }

        function updateProgress() {
            var value =$('#progbar').progressbar('getValue');
            if (value < 96){
                value += Math.floor(Math.random() * 10);
                $('#progbar').progressbar('setValue', value);
            }
        }

        function hideShow(miliseconds) {
            $("#progbarParent").hide();
        }
        //**********************************************************************************************//
        //************************************************ADV SEARCH (START)*********************************************//
        $('#btnAdvSearchPick').click(function(e){
            $("#winAdvSearchBatch").icsWindow('open', "Advance Search");
            $('#btnAdvReset').click();
        });
        $('#btnAdvClose').click(function(e){
            debugger;
            $('#btnAdvReset').click();
            $("#winAdvSearchBatch").icsWindow('close');
        });
        $('#btnAdvReset').click(function(e){
            $('#txtAdvIssueDateStart,#txtAdvIssueDateEnd').datebox('setValue', icsdateformat(new Date()));
            $("#cboAdvIssueDate").icsLoadCombo({List: $('#winAdvSearchBatch').data('CompareOperators'), OptionValue: "id",DisplayText: "Value"});
            $("#cboAdvDiaType").icsLoadCombo({List: $('#winAdvSearchBatch').data('DyedTypes'), OptionValue: "id",DisplayText: "Value"});
            $('#txtAdvBatchNo').val('');
            $('#txtAdvColor').val('');
            $('#txtAdvDia').val('');
            $('#btnAdvStyleCancel').click();
            $('#btnAdvPOCancel').click();
            $('#winAdvSearchBatch').data('OrderRecapIDs','');
        });
        $('#btnAdvSearch').click(function(e){
            var oKnitDyeingBatch =   { 
                StyleNo:$('#winAdvSearchBatch').data('StyleIDs'),
                OrderRecapNo: $('#winAdvSearchBatch').data('OrderRecapIDs'),
                ColorName:$('#txtAdvColor').val(),
                BatchNo:$('#txtAdvBatchNo').val(),
                ErrorMessage: $('#cboAdvDiaType').val() + '~' + $('#txtAdvDia').val() + '~' + $('#cboAdvIssueDate').val() + '~' + $('#txtAdvIssueDateStart').datebox('getValue') + '~' + $('#txtAdvIssueDateEnd').datebox('getValue')
            };
            var obj = {
                BaseAddress: sessionStorage.getItem('BaseAddress'),
                Object: oKnitDyeingBatch,
                ControllerName: "KnitDyeingBatch",
                ActionName: "AdvanceSearch",
                IsWinClose: false
            };
            $.icsProgressBar(true);
            $.icsDataGets(obj, function (response) {
                $.icsProgressBar(false);
                if (response.status && response.objs.length > 0) {
                    if (response.objs[0].KnitDyeingBatchID > 0) {
                        $('#tblKnitDyeingBatchs').datagrid('loadData',response.objs);
                        $("#winAdvSearchBatch").icsWindow('close');
                        $('#btnAdvClose').click();
                    }
                } else{
                    alert("Data Not Found.");
                    return;
                }
            });
        });
        //************************************************ADV SEARCH (END)*********************************************//
        function IntializePickerbutton(oPickerobj) {
            $("#" + oPickerobj.winid).find("#btnOk").click(function () {
            
                //for Single Select
                SetPickerValueAssign(oPickerobj);
            });
            $(document).find('.' + oPickerobj.winclass).keydown(function (e) {
                if (e.which == 13)//enter=13
                {
                    SetPickerValueAssign(oPickerobj);
                }
            });
        }
        function SetPickerValueAssign(oPickerobj)
        {
            var oreturnObj = null, oreturnobjs = [];
            if (oPickerobj.multiplereturn)
            {
                oreturnobjs = $('#'+oPickerobj.tableid).datagrid('getChecked');
            } else {
                oreturnObj = $('#'+oPickerobj.tableid).datagrid('getSelected');
            }
            $("#" + oPickerobj.winid).icsWindow("close");
            $("#" + oPickerobj.winid).remove();
            debugger;
            if(oPickerobj.winid == 'winStyle'){
                if (oreturnobjs != null && oreturnobjs.length>0)
                {
                    var ncount = 0;
                    var nStyleIDs = "";
                    for (var i = 0; i <oreturnobjs.length; i++) {
                        var nStyleID = oreturnobjs[i].TechnicalSheetID;
                        nStyleIDs = nStyleIDs + nStyleID + ',';
                        ncount++;
                    }
                    if (ncount > 1)
                    {
                        $('#txtAdvStyle').val("Select " + ncount + " Style's");
                    } else
                    {
                        $('#txtAdvStyle').val(oreturnobjs[0].StyleNo);
                    }
                    nStyleIDs = nStyleIDs.substring(0, nStyleIDs.length - 1);
                    $('#winAdvSearchBatch').data('StyleIDs', nStyleIDs);
                    $("txtAdvStyle").addClass("blueText");
                }
            }
            else if(oPickerobj.winid == 'winOrderRecap'){
                if (oreturnobjs != null && oreturnobjs.length>0)
                {
                    var ncount = 0;
                    var nOrderRecapIDs = "";
                    for (var i = 0; i <oreturnobjs.length; i++) {
                        var nOrderRecapID = oreturnobjs[i].OrderRecapID;
                        nOrderRecapIDs = nOrderRecapIDs + nOrderRecapID + ',';
                        ncount++;
                    }
                    if (ncount > 1)
                    {
                        $('#txtAdvPO').val("Select " + ncount + " OrderRecap's");
                    } else
                    {
                        $('#txtAdvPO').val(oreturnobjs[0].OrderRecapNo);
                    }
                    nOrderRecapIDs = nOrderRecapIDs.substring(0, nOrderRecapIDs.length - 1);
                    $('#winAdvSearchBatch').data('OrderRecapIDs', nOrderRecapIDs);
                    $("txtAdvPO").addClass("blueText");
                }
            }
        }
        //************************************************STYLE PICKER (START)*********************************************//
        $('#btnAdvStyleCancel').click(function(e){
            $("#txtAdvStyle").val('');
            $('#winAdvSearchBatch').data('StyleIDs','');
            $("txtAdvStyle").addClass("blackText");
        })
        $('#txtAdvStyle').keyup(function(e){
            var code = (e.keyCode ? e.keyCode : e.which);
            if(code==13)//enter
            {
                if($.trim($('#txtAdvStyle').val())==null || $.trim($('#txtAdvStyle').val())=="")
                {
                    alert("Type Style No.");
                    return;
                }
                $('#btnAdvStylePick').click();
            }
            else if(code==8)
            {
                $('#btnAdvStyleCancel').click();
            }
        });
        $('#btnAdvStylePick').click(function(e){
            var oTechnicalSheet =   { 
                BUID : 0,
                StyleNo : $.trim($('#txtAdvStyle').val())
            };
            var obj = {
                BaseAddress: sessionStorage.getItem('BaseAddress'),
                Object: oTechnicalSheet,
                ControllerName: "OrderRecap",
                ActionName: "StyleSearch",
                IsWinClose: false
            };
            $.icsProgressBar(true);
            $.icsDataGets(obj, function (response) {
                $.icsProgressBar(false);
                if (response.status && response.objs.length > 0) {
                    if (response.objs[0].TechnicalSheetID > 0) {
                        var tblColums = [];
                        var oColumn = { field: "StyleNo", title: "Style No", width:200, align: "left" }; tblColums.push(oColumn);
                        oColumn = { field: "BuyerName", title: "Buyer", width:150, align: "left" }; tblColums.push(oColumn);
                        oColumn = { field: "ApproxQty", title: "Approx Qty", width:150, align: "right" }; tblColums.push(oColumn);
                    
                        var oPickerParam = {
                            winid: 'winStyle',
                            winclass: 'clsStyle',
                            winwidth: 620,
                            winheight: 460,
                            tableid: 'tblStyle',
                            tablecolumns: tblColums,
                            datalist: response.objs,
                            multiplereturn: true,
                            searchingbyfieldName: 'StyleNo',
                            windowTittle: 'Style List'
                        };
                        $.icsPicker(oPickerParam);
                        IntializePickerbutton(oPickerParam);
                    }
                    else {
                        alert(response.objs[0].ErrorMessage);
                    }

                } else{
                    alert("Data Not Found.");
                    return;
                }
            });
        })
        //************************************************STYLE PICKER (END)*****************************************//
        //************************************************FABRIC PICKER (START)*********************************************//
        $('#btnAdvPOCancel').click(function(e){
            $("#txtAdvPO").val('');
            $('#winAdvSearchBatch').data('StyleIDs','');
            $("txtAdvPO").addClass("blackText");
        })
        $('#txtAdvPO').keyup(function(e){
            var code = (e.keyCode ? e.keyCode : e.which);
            if(code==13)//enter
            {
                if($.trim($('#txtAdvPO').val())==null || $.trim($('#txtAdvPO').val())=="")
                {
                    alert("Type No.");
                    return;
                }
                $('#btnAdvPOPick').click();
            }
            else if(code==8)
            {
                $('#btnAdvStyleCancel').click();
            }
        });
        $('#btnAdvPOPick').click(function(e){
            var oOrderRecap =   { 
                OrderRecapNo : $.trim($('#txtAdvPO').val())
            };
            var obj = {
                BaseAddress: sessionStorage.getItem('BaseAddress'),
                Object: oOrderRecap,
                ControllerName: "OrderRecap",
                ActionName: "OrderRecapSearchByNo",
                IsWinClose: false
            };
            $.icsProgressBar(true);
            $.icsDataGets(obj, function (response) {
                $.icsProgressBar(false);
                if (response.status && response.objs.length > 0) {
                    if (response.objs[0].TechnicalSheetID > 0) {
                        var tblColums = [];
                        var oColumn = { field: "BuyerName", title: "Buyer Name", width:150, align: "left" }; tblColums.push(oColumn);
                        oColumn = { field: "StyleNo", title: "Style", width:150, align: "left" }; tblColums.push(oColumn);
                        oColumn = { field: "OrderRecapNo", title: "Order Recap No", width:150, align: "left" }; tblColums.push(oColumn);
                        oColumn = { field: "TotalQuantity", title: "Total Quantity", width:100, align: "right" }; tblColums.push(oColumn);
                    
                        var oPickerParam = {
                            winid: 'winOrderRecap',
                            winclass: 'clsOrderRecap',
                            winwidth: 650,
                            winheight: 460,
                            tableid: 'tblOrderRecap',
                            tablecolumns: tblColums,
                            datalist: response.objs,
                            multiplereturn: true,
                            searchingbyfieldName: 'OrderRecapNo',
                            windowTittle: 'Order Recap List'
                        };
                        $.icsPicker(oPickerParam);
                        IntializePickerbutton(oPickerParam);
                    }
                    else {
                        alert(response.objs[0].ErrorMessage);
                    }

                } else{
                    alert("Data Not Found.");
                    return;
                }
            });
        })
        //************************************************FABRIC PICKER (END)*********************************************//
        $('#btnPrintList').click(function(){
            var oList = $('#tblKnitDyeingBatchs').datagrid('getRows');
            if(oList.length==0)
            {
                alert("Nothing To Print");
                return
            }
            window.open(sessionStorage.getItem('BaseAddress')+ "/KnitDyeingBatch/PrintList?tvs=" + Date.now() + "&buid="+parseInt(sessionStorage.getItem('BUID')));
        });
    </script>
