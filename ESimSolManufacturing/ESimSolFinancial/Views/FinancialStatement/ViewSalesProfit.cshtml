@model ESimSol.BusinessObjects.SalesProfit
@{
    ViewBag.Title = "Sales Profit";
}

<div id="winVoucher" class="easyui-window" title="View Voucher" style="height: 515px; width: 1020px;" data-options="modal:true,closed:true,collapsible:false,minimizable:false,maximizable:false,closable:false">
    <div id="p" style="width:99%; padding:1px">
        <div style="width:100%">
            <table border="0" cellpadding="2" cellspacing="2" style="width:100%;">
                <tr>
                    <td style="width:25%; font-size:12px">
                        Business Unit:<input type="text" id="txtBusinessUnit" style="width: 120px;margin-left:5px; font-weight:bolder" disabled />
                    </td>
                    <td style="width:25%; font-size:12px">
                        Voucher No:<input type="text" id="txtVoucherNo" style="width: 120px;margin-left:5px; font-weight:bolder" disabled />
                    </td>
                    <td style="width:25%; text-align:center">
                        Voucher Type:<input type="text" id="txtVoucherType" style="width: 150px;margin-left:5px; font-weight:bolder" disabled />
                    </td>
                    <td style="width:22%; font-size:12px;text-align:right;">
                        Voucher Date :<input type="text" id="txtVoucherDate" style="width: 120px;margin-left:5px; font-weight:bolder" disabled />
                    </td>
                </tr>
            </table>
        </div>
        <div style="width:100%">
            <table id="tblVoucherDetailHeader" class="tablebordaer" border="0" cellpadding="0" cellspacing="0" width="100%" style="font-size:12px; font-weight:bold">
                <tr>
                    <td style="width:5%; text-align:center">BU</td>
                    <td style="width:45%; text-align:center">Particulars</td>
                    <td style="width:30%; text-align:center">Narration</td>
                    <td style="width:10%; text-align:center">Debit<label class="lblBaseCurrencySymbol"></label></td>
                    <td style="width:10%; text-align:center">Credit<label class="lblBaseCurrencySymbol"></label></td>
                </tr>
            </table>
        </div>
        <div class="tablebordaer" id="divVoucherDetails" style="height:280px; width:100%; font-size:12px; overflow:auto">
            <table id="tblVoucherDetail" border="0" cellpadding="0" cellspacing="0" style="font-size:13px; width:100%"></table>
        </div>
        <table border="0" cellpadding="0" cellspacing="0" style="width:100%">
            <tr>
                <td style="width:80%; text-align:right; font-size:12px; font-weight:bold"></td>
                <td colspan="2" style="width:20%; text-align:right; font-size:12px; font-weight:bold"><hr /></td>
            </tr>
            <tr>
                <td style="width:70%; text-align:right; font-size:12px; font-weight:bold"></td>
                <td style="width:20%; text-align:right; font-size:10px; font-weight:bold;padding-right: 34px;"><label class="lblBaseCurrencySymbol"></label><label id="lblTotalDebitAmount">0.00</label> </td>
                <td style="width:10%; text-align:right; font-size:10px; font-weight:bold"><label class="lblBaseCurrencySymbol"></label><label id="lblTotalCreditAmount"> 0.00</label>&nbsp;&nbsp;</td>
            </tr>
            <tr>
                <td style="width:80%; text-align:right; font-size:12px; font-weight:bold"></td>
                <td colspan="2" style="width:20%; text-align:right; font-size:12px; font-weight:bold"><hr /><hr /></td>
            </tr>
            <tr>
                <td style="width:80%; text-align:left; font-size:12px; font-weight:bold">Narration :</td>
                <td colspan="2" style="width:20%; text-align:right; font-size:12px; font-weight:bold"></td>
            </tr>
            <tr>
                <td colspan="3" style="width:100%; text-align:left; font-size:12px; font-weight:bold">
                    <textarea rows="1" id="txtNarration" style="text-align:left; width:100%" disabled></textarea>
                </td>
            </tr>
            <tr style="height:33px">
                <td style="width:60%; text-align:left; font-size:12px; font-weight:bold"></td>
                <td style="width:20%; text-align:right; font-size:12px; font-weight:bold; vertical-align:bottom">
                    <a id="btnPrintVoucher" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-print" plain="true">Print</a>
                </td>
                <td colspan="2" style="width:20%; text-align:right; font-size:12px; font-weight:bold; vertical-align:bottom">
                    <a id="btnCloseVoucher" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-cancel" plain="true">Close</a>
                </td>
            </tr>
        </table>
    </div>
</div>
<div class="easyui-panel" title="" style="margin-left: 0px; height:100%; width:100%" fit="true">
    <div class="easyui-layout" data-options="fit:true">
        <div data-options="region:'north',split:true" style="width:100%;padding:5px; overflow:hidden">
            <div style="margin-bottom:5px">
                @*<select id="cboBUs" style="width:210px;"></select>*@
                <input type="text" id="txtOrderNo" style="width:350px;" placeholder="Type Ref No/Order No/DO No/Client Name" />
                Date :
                <input id="txtStartDate" type="text" class="easyui-datebox" style="width:100px;" required="required" data-options="formatter:icsdateformat,parser:icsdateparser" />
                To
                <input id="txtEndDate" type="text" class="easyui-datebox" style="width:100px;" required="required" data-options="formatter:icsdateformat,parser:icsdateparser" />
                @*<select id="cboAccountType" style="width:86px;"></select>*@
                <a id="btnRefresh" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-reload" plain="false">Refresh</a>
                <a id="btnPrint" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-print" plain="false">Sales Profit</a>
                <a id="btnPrintXL" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-print" plain="false">Export To XL</a>
            </div>
        </div>
        <div data-options="region:'center'" style="width:100%;padding:20px;">
            <div style="width:100%; border:1px solid black; margin-bottom:20px">
                <table  id="tblSalesProfit" border="0" cellpadding="1" cellspacing="0" style="width:100%">
                    <tr>
                        <td colspan="4" style="width:100%; text-align:left">
                            <label id="lblCompanyName" style="font-size:16px; font-weight:bold">Cross Wold Power Ltd</label>
                        </td>                        
                    </tr>
                    <tr>                        
                        <td colspan="4" style="width:100%; text-align:left">
                            <label id="lblStatementName" style="font-size:15px; font-weight:bold; color:gray">Sales Profit</label>
                        </td>                        
                    </tr>
                    <tr>
                        <td colspan="4" style="width:100%; text-align:left">
                            <label id="lblStatementDate" style="font-size:13px;">As at 31 December 2015</label>
                        </td>                        
                    </tr>                   
                    <tr>
                        <td style="width:50%; text-align:right">
                            <label id="lblNetProfitOrLoss" style="font-size:13px; font-weight:bold;">Net Profit : 0.00 </label>
                        </td>
                        <td style="width:28%; text-align:center; font-weight:bold"></td>
                        <td style="width:20%; text-align:right;">
                            <label id="lblStatementDateWithCurrency" style="font-size:13px; font-weight:bold;">31 Dec 2015-BDT</label>
                        </td>
                        <td style="width:2%"></td>
                    </tr>    
                    @*<tr>
                        <td style="width:50%"></td>
                        <td style="width:28%; text-align:center; font-weight:bold">Notes</td>
                        <td style="width:20%; text-align:right;">
                        </td>
                        <td style="width:2%"></td>
                    </tr>*@                
                    @*<tr>
                        <td style="width:50%"></td>
                        <td style="width:28%"></td>
                        <td style="width:22%"></td>
                        <td style="width:2%"></td>
                    </tr>*@
                </table>
                <div style="width:100%; border-top:1px solid black; margin-top:20px;">
                    <table id="tblSalesIncome" border="0" cellpadding="1" cellspacing="0" style="width:100%">
                        <tr>
                            <td style="width:2%"></td>
                            <td style="width:15%; font-size:13px; font-weight:bold;">Sales No</td>
                            <td style="width:15%; font-size:13px; font-weight:bold;">Sales Date</td>
                            <td style="width:18%; font-size:13px; font-weight:bold;">Account</td>
                            <td style="width:15%; font-size:13px; font-weight:bold;">Voucher No</td>
                            <td style="width:15%; font-size:13px; font-weight:bold;">Voucher Date</td>
                            <td style="width:18%; font-size:13px; font-weight:bold; text-align:right;">Amount</td>
                            <td style="width:2%"></td>
                        </tr>
                    </table>
                </div>
                <div style="width:100%; border-top:1px solid black; margin-top:20px;">
                    <table id="tblSalesExpense" border="0" cellpadding="1" cellspacing="0" style="width:100%">
                        <tr >
                            <td style="width:2%"></td>
                            <td style="width:15%; font-size:13px; font-weight:bold;">Sale No</td>
                            <td style="width:15%; font-size:13px; font-weight:bold;">Sale Date</td>
                            <td style="width:18%; font-size:13px; font-weight:bold;">Account</td>
                            <td style="width:15%; font-size:13px; font-weight:bold;">Voucher No</td>
                            <td style="width:15%; font-size:13px; font-weight:bold;">Voucher Date</td>
                            <td style="width:18%; font-size:13px; font-weight:bold; text-align:right;">Amount</td>
                            <td style="width:2%"></td>
                        </tr>
                    </table>
                </div>
                </div>
        </div>        
    </div>
</div>
<style>
    .tablebordaer {
        border: 1px solid black;
    }
        
    #tblVoucherDetail td{
        border-left: 1px solid #D8D8D8;
        border-bottom: 1px solid #D8D8D8;
    }

    #tblVoucherDetailHeader  td{
        border-left: 1px solid black;
    }

    .highlight {
        background-color: #CFB53B;
        color: #fff;
    }

    .highlighthover {
        background-color: #FAE794;
        color: #000;
    }
    
    .header {
        color: black;
        font-size: 13px;
        font-family: Tahoma;
        font-weight: bold;
        text-align:left;
    }

    
    .highlight {
        background: #DAFFD6;
    }

    #tblSalesProfit tr:hover td,
    #tblSalesProfit tr:hover td.highlight {
        background: #D6DAD5;
    }
    #tblSalesIncome tr:hover td,
    #tblSalesIncome tr:hover td.highlight {
        background: #D6DAD5;
    }
    #tblSalesExpense tr:hover td,
    #tblSalesExpense tr:hover td.highlight {
        background: #D6DAD5;
    }
</style>



<script type="text/javascript">    
    var _oSalesProfit=null;    
    var _nTotalIncomeAmount =0 ;
    $(document).ready(function () {
        debugger;
        _oSalesProfit =@Html.Raw( new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(Model));

        var oSO =@Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(ViewBag.SO));
        $('#txtOrderNo').data('obj',oSO);

        var oCompany= @Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(ViewBag.Company));
        sessionStorage.setItem("Company", JSON.stringify(oCompany));

        var oBU= @Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(ViewBag.BU));
        $('#lblCompanyName').data('obj',oBU);

        debugger;


        $('#txtStartDate').datebox('setValue', icsdateformat(new Date()));
        $('#txtEndDate').datebox('setValue', icsdateformat(new Date()));

        ////refresh control
        $('#txtOrderNo').val(oSO.SalesNo);
        $('#txtStartDate').datebox('setValue', _oSalesProfit.StartDateSt);
        $('#txtEndDate').datebox('setValue', _oSalesProfit.EndDateSt);
        /////end refresh control

        RefreshTable(_oSalesProfit);

        $('#txtOrderNo').icsAutoComplete({
            BaseAddress : sessionStorage.getItem('BaseAddress'),
            ControllerName: "SaleOrder",
            ActionName: "GetsSaleOrders",
            Object: {SalesNo:''},
            PropertyName: "SalesNo",
            ParamName: "SalesNo",
            Columns:[{field:'RefNo',width:'15%'},{field:'DONo',width:'15%'},{field:'SalesNo',width:'20%'},{field:'ClientName',width:'50%'}]});


        $('#Mainlayout').layout('collapse', 'west');
    });

    function ValidateInput()
    {
        if ( $('#txtStartDate').datebox('getValue')=="") {
            alert("please select Start date!");
            $('#txtStartDate').focus();
            return false;
        }

        if ( $('#txtEndDate').datebox('getValue')=="") {
            alert("Please select end date!!");
            $('#txtEndDate').focus();
            return false;
        }

        var sStartDate=$('#txtStartDate').datebox('getValue');
        var sEndDate = $('#txtEndDate').datebox('getValue');
        var dStartDate = new Date(sStartDate);
        var dEndDate = new Date(sEndDate);

        if(dEndDate < dStartDate) {
            alert("End date must be grater then start date!!");
            $('#txtEndDate').focus();
            return false;
        }

        if ((!$('#txtOrderNo').data('obj') || $('#txtOrderNo').data('obj') == null) ) {
            alert("Please select Order!");
            $('#txtOrderNo').focus();
            return false;
        }

        if ((!parseInt($('#txtOrderNo').data('obj').SaleOrderID) || parseInt($('#txtOrderNo').data('obj').SaleOrderID)<=0) ) {
            alert("Please select Order!");
            $('#txtOrderNo').focus();
            return false;
        }
        return true;
    }
    $("#btnRefresh").click(function(){
        if(!ValidateInput()){return false;}

        var obj={
            OrderID:parseInt($('#txtOrderNo').data('obj').SaleOrderID)?parseInt($('#txtOrderNo').data('obj').SaleOrderID):0,
            StartDate:$('#txtStartDate').datebox('getValue'),
            EndDate:$('#txtEndDate').datebox('getValue')
        };
        $.ajax({
            type: "POST",
            dataType: "json",
            url : sessionStorage.getItem('BaseAddress')+  "/FinancialStatement/SetSPSessionData",
            traditional: true,
            data:  JSON.stringify(obj),
            contentType: "application/json; charset=utf-8",
            success: function (data) {
                var sFeedBackMessage = jQuery.parseJSON(data);
                if (sFeedBackMessage==="Successful") {
                    window.location.href = sessionStorage.getItem('BaseAddress')+ "/FinancialStatement/ViewSalesProfit?menuid="+parseInt(sessionStorage.getItem('MenuID'));
                }
            },
            error: function (xhr, status, error) {
                alert(error);
            }
        });
    });



    function RefreshTable(oSalesProfit)
    {
        //Segment = 2, SubGroup = 4,
        var oIncomes=oSalesProfit.Incomes;
        var oExpenses=oSalesProfit.Expenses;

        if($('#lblCompanyName').data('obj') && parseInt($('#lblCompanyName').data('obj').BusinessUnitID)>0){
            $('#lblCompanyName').text($('#lblCompanyName').data('obj').Name);
        }
        else{
            $('#lblCompanyName').text(jQuery.parseJSON(sessionStorage.getItem("Company")).Name);
        }
        
        if(oSalesProfit.OrderID>0){
            $('#lblStatementDate').text('Profit form Sale No: '+ $('#txtOrderNo').data('obj').SalesNo+ ', Date '+ oSalesProfit.StartDateSt+' To '+oSalesProfit.EndDateSt);
        }
        else{
            $('#lblStatementDate').text('Profit form Date '+ oSalesProfit.StartDateSt+' To '+oSalesProfit.EndDateSt);
        }
        $('#lblStatementDateWithCurrency').text('[All Amounts Shown in '+jQuery.parseJSON(sessionStorage.getItem("Company")).CurrencyName+']');
        var nMaxRowIndex = document.getElementById('tblSalesProfit').rows.length-1;
        for(var i=nMaxRowIndex; i>3; i--)
        {
            document.getElementById("tblSalesProfit").deleteRow(i);
        }

        RefreshIncome(oIncomes);
        RefreshExpense(oExpenses);
    }

    function RefreshIncome(oIncomes)
    {
        _nTotalIncomeAmount =0;
        for(var i=0;  i<oIncomes.length; i++ )
        {
            var table = document.getElementById('tblSalesIncome');
            var nRowIndex = table.rows.length;
            var row = table.insertRow(nRowIndex);

            var cellBlankHeader = row.insertCell(0);
            cellBlankHeader.width= "2%";
            cellBlankHeader.innerHTML = '';

            var cellBillNo = row.insertCell(1);
            cellBillNo.width= "15%";
            cellBillNo.innerHTML = '<label id="BillNo'+nRowIndex+'" rowIndex="'+nRowIndex+'" style="font-size:13px;color:Blue;cursor:pointer;text-decoration:underline;">'+oIncomes[i].OrderNo+'</label>';
            cellBillNo.style.textAlign = 'left';

            var cellBillDateSt = row.insertCell(2);
            cellBillDateSt.width= "15%";
            cellBillDateSt.innerHTML = '<label id="BillDateSt'+nRowIndex+'" rowIndex="'+nRowIndex+'" style="font-size:13px;">'+oIncomes[i].OrderDateSt+'</label>';
            cellBillDateSt.style.textAlign = 'left';

            var cellCCName = row.insertCell(3);
            cellCCName.width= "18%";
            cellCCName.innerHTML = '<label id="CCName'+nRowIndex+'" rowIndex="'+nRowIndex+'" style="font-size:13px;color:Blue;cursor:pointer;text-decoration:underline;" onclick="GLMonthly('+oIncomes[i].AccountHeadID+')">'+oIncomes[i].AccountHeadName+'</label>';
            cellCCName.style.textAlign = 'left';

            var cellVoucherNo = row.insertCell(4);
            cellVoucherNo.width= "15%";
            cellVoucherNo.innerHTML = '<label id="VoucherNo'+nRowIndex+'" rowIndex="'+nRowIndex+'" style="font-size:13px;color:Blue;cursor:pointer;text-decoration:underline;"  onclick="RefreshVoucherData('+oIncomes[i].VoucherID+')">'+oIncomes[i].VoucherNo+'</label>';
            cellVoucherNo.style.textAlign = 'left';

            var cellVoucherDateSt = row.insertCell(5);
            cellVoucherDateSt.width= "15%";
            cellVoucherDateSt.innerHTML = '<label id="VoucherDateSt'+nRowIndex+'" rowIndex="'+nRowIndex+'" style="font-size:13px;">'+oIncomes[i].VoucherDateSt+'</label>';
            cellVoucherDateSt.style.textAlign = 'left';

            var cellCurrentBalanceSt = row.insertCell(6);
            cellCurrentBalanceSt.width= "18%";
            cellCurrentBalanceSt.innerHTML = '<label id="CurrentBalanceSt'+nRowIndex+'" rowIndex="'+nRowIndex+'" style="font-size:13px;">'+oIncomes[i].AmountSt+'</label>';
            cellCurrentBalanceSt.style.textAlign = 'right';

            var cellBlankTrailer = row.insertCell(7);
            cellBlankTrailer.width= "2%";
            cellBlankTrailer.innerHTML = '';
            _nTotalIncomeAmount = _nTotalIncomeAmount +parseFloat(oIncomes[i].Amount);
        }

        var table = document.getElementById('tblSalesIncome');
        var nRowIndex = table.rows.length;
        var row = table.insertRow(nRowIndex);


        var cellTotal = row.insertCell(0);
        cellTotal.colSpan= 6;
        cellTotal.width= "80%";
        cellTotal.innerHTML = '<label id="VoucherDateSt'+nRowIndex+'" rowIndex="'+nRowIndex+'" style="font-size:13px; font-weight:bold;">Total Income :</label>';
        cellTotal.style.textAlign = 'right';

        var cellCurrentBalanceSt = row.insertCell(1);
        cellCurrentBalanceSt.width= "18%";
        cellCurrentBalanceSt.innerHTML = '<label id="CurrentBalanceSt'+nRowIndex+'" rowIndex="'+nRowIndex+'" style="font-size:13px; font-weight:bold;">'+ formatPrice(_nTotalIncomeAmount)+'</label>';
        cellCurrentBalanceSt.style.textAlign = 'right';
        cellCurrentBalanceSt.style.borderTop='1px solid black';
        cellCurrentBalanceSt.style.borderBottom='1px solid black';

        var cellBlank = row.insertCell(2);
        cellBlank.width= "2%";
        cellBlank.innerHTML = '';

        var table = document.getElementById('tblSalesIncome');
        var nRowIndex = table.rows.length;
        var row = table.insertRow(nRowIndex);


        var cellTotal = row.insertCell(0);
        cellTotal.colSpan= 8;
        cellTotal.width= "100%";
        cellTotal.innerHTML = '<label id="VoucherDateSt'+nRowIndex+'" rowIndex="'+nRowIndex+'" style="font-size:13px; font-weight:bold;"></label>';
        cellTotal.style.textAlign = 'center';
        cellBlank.height = '7';


        var table = document.getElementById('tblSalesIncome');
        var nRowIndex = table.rows.length;
        var row = table.insertRow(nRowIndex);


        var cellTotal = row.insertCell(0);
        cellTotal.colSpan= 6;
        cellTotal.width= "80%";
        cellTotal.style.textAlign = 'right';

        var cellCurrentBalanceSt = row.insertCell(1);
        cellCurrentBalanceSt.width= "18%";
        cellCurrentBalanceSt.style.borderTop='1px solid black';

        var cellBlank = row.insertCell(2);
        cellBlank.width= "2%";
        cellBlank.innerHTML = '';

        var table = document.getElementById('tblSalesIncome');
        var nRowIndex = table.rows.length;
        var row = table.insertRow(nRowIndex);

        var cellBlank = row.insertCell(0);
        cellBlank.colSpan= 8;
        cellBlank.width= "100%";
        cellBlank.innerHTML = '';
        cellBlank.height = '25';


    }

    function RefreshExpense(oExpenses)
    {
        var nTotalExpensesAmount=0;
        for(var i=0;  i<oExpenses.length; i++ )
        {
            var table = document.getElementById('tblSalesExpense');
            var nRowIndex = table.rows.length;
            var row = table.insertRow(nRowIndex);

            var cellBlankHeader = row.insertCell(0);
            cellBlankHeader.width= "2%";
            cellBlankHeader.innerHTML = '';

            var cellBillNo = row.insertCell(1);
            cellBillNo.width= "15%";
            cellBillNo.innerHTML = '<label id="BillNo'+nRowIndex+'" rowIndex="'+nRowIndex+'" style="font-size:13px;">'+oExpenses[i].OrderNo+'</label>';
            cellBillNo.style.textAlign = 'left';

            var cellBillDateSt = row.insertCell(2);
            cellBillDateSt.width= "15%";
            cellBillDateSt.innerHTML = '<label id="BillDateSt'+nRowIndex+'" rowIndex="'+nRowIndex+'" style="font-size:13px;">'+oExpenses[i].OrderDateSt+'</label>';
            cellBillDateSt.style.textAlign = 'left';

            var cellCCName = row.insertCell(3);
            cellCCName.width= "18%";
            cellCCName.innerHTML = '<label id="CCName'+nRowIndex+'" rowIndex="'+nRowIndex+'" style="font-size:13px;color:Blue;cursor:pointer;text-decoration:underline;"  onclick="GLMonthly('+oExpenses[i].AccountHeadID+')">'+oExpenses[i].AccountHeadName+'</label>';
            cellCCName.style.textAlign = 'left';

            var cellVoucherNo = row.insertCell(4);
            cellVoucherNo.width= "15%";
            cellVoucherNo.innerHTML = '<label id="VoucherNo'+nRowIndex+'" rowIndex="'+nRowIndex+'" style="font-size:13px;color:Blue;cursor:pointer;text-decoration:underline;"  onclick="RefreshVoucherData('+oExpenses[i].VoucherID+')">'+oExpenses[i].VoucherNo+'</label>';
            cellVoucherNo.style.textAlign = 'left';

            var cellVoucherDateSt = row.insertCell(5);
            cellVoucherDateSt.width= "15%";
            cellVoucherDateSt.innerHTML = '<label id="VoucherDateSt'+nRowIndex+'" rowIndex="'+nRowIndex+'" style="font-size:13px;">'+oExpenses[i].VoucherDateSt+'</label>';
            cellVoucherDateSt.style.textAlign = 'left';

            var cellCurrentBalanceSt = row.insertCell(6);
            cellCurrentBalanceSt.width= "18%";
            cellCurrentBalanceSt.innerHTML = '<label id="CurrentBalanceSt'+nRowIndex+'" rowIndex="'+nRowIndex+'" style="font-size:13px;">'+oExpenses[i].AmountSt+'</label>';
            cellCurrentBalanceSt.style.textAlign = 'right';

            var cellBlankTrailer = row.insertCell(7);
            cellBlankTrailer.width= "2%";
            cellBlankTrailer.innerHTML = '';

            nTotalExpensesAmount=nTotalExpensesAmount+parseFloat(oExpenses[i].Amount);
        }
        var table = document.getElementById('tblSalesExpense');
        var nRowIndex = table.rows.length;
        var row = table.insertRow(nRowIndex);


        var cellTotal = row.insertCell(0);
        cellTotal.colSpan= 6;
        cellTotal.width= "80%";
        cellTotal.innerHTML = '<label id="VoucherDateSt'+nRowIndex+'" rowIndex="'+nRowIndex+'" style="font-size:13px; font-weight:bold;">Total Expenses :</label>';
        cellTotal.style.textAlign = 'right';

        var cellCurrentBalanceSt = row.insertCell(1);
        cellCurrentBalanceSt.width= "18%";
        cellCurrentBalanceSt.innerHTML = '<label id="CurrentBalanceSt'+nRowIndex+'" rowIndex="'+nRowIndex+'" style="font-size:13px; font-weight:bold;">'+formatPrice(nTotalExpensesAmount)+'</label>';
        cellCurrentBalanceSt.style.textAlign = 'right';
        cellCurrentBalanceSt.style.borderTop='1px solid black';
        cellCurrentBalanceSt.style.borderBottom='1px solid black';

        var cellBlank = row.insertCell(2);
        cellBlank.width= "2%";
        cellBlank.innerHTML = '';

        var nNetProfit = (_nTotalIncomeAmount - nTotalExpensesAmount);
        if(nNetProfit<0)
        {
            $('#lblNetProfitOrLoss').text('Net Loss : '+formatPrice(nNetProfit*(-1)));
        }
        else
        {
            $('#lblNetProfitOrLoss').text('Net Profit : '+formatPrice(nNetProfit));
        }

        var table = document.getElementById('tblSalesExpense');
        var nRowIndex = table.rows.length;
        var row = table.insertRow(nRowIndex);


        var cellTotal = row.insertCell(0);
        cellTotal.colSpan= 8;
        cellTotal.width= "100%";
        cellTotal.innerHTML = '<label id="VoucherDateSt'+nRowIndex+'" rowIndex="'+nRowIndex+'" style="font-size:13px; font-weight:bold;"></label>';
        cellTotal.style.textAlign = 'center';
        cellBlank.height = '7';


        var table = document.getElementById('tblSalesExpense');
        var nRowIndex = table.rows.length;
        var row = table.insertRow(nRowIndex);


        var cellTotal = row.insertCell(0);
        cellTotal.colSpan= 6;
        cellTotal.width= "80%";
        cellTotal.style.textAlign = 'right';

        var cellCurrentBalanceSt = row.insertCell(1);
        cellCurrentBalanceSt.width= "18%";
        cellCurrentBalanceSt.style.borderTop='1px solid black';

        var cellBlank = row.insertCell(2);
        cellBlank.width= "2%";
        cellBlank.innerHTML = '';


        var table = document.getElementById('tblSalesExpense');
        var nRowIndex = table.rows.length;
        var row = table.insertRow(nRowIndex);

        var cellBlank = row.insertCell(0);
        cellBlank.colSpan= 8;
        cellBlank.width= "100%";
        cellBlank.innerHTML = '';
        cellBlank.height = '25';


    }

    function SLLedger(nParentHeadID, nCCID)
    {
        debugger;
        var oVoucherRefReport = {
            AccountHeadID : nParentHeadID,
            CCID:nCCID,
            StartDate : $('#txtStartDate').datebox('getValue'),
            EndDate : $('#txtEndDate').datebox('getValue'),
            IsApproved:true
        };
        $.ajax({
            type: "POST",
            dataType: "json",
            url : _sBaseAddress+  "/FinancialStatement/SetCCBSessionData",
            traditional: true,
            data:  JSON.stringify(oVoucherRefReport),
            contentType: "application/json; charset=utf-8",
            success: function (data) {
                var sFeedBackMessage = jQuery.parseJSON(data);
                if (sFeedBackMessage==="Successful") {
                    window.location.href = _sBaseAddress+ "/FinancialStatement/ViewSubLedgerLedger?menuid="+parseInt(sessionStorage.getItem('MenuID'));
                }
            },
            error: function (xhr, status, error) {
                alert(error);
            }
        });


    }

    function GLMonthly(nAccountHeadID)
    {
        var oGeneralLedger = {
            AccountHeadID : parseInt(nAccountHeadID),
            StartDate : $('#txtStartDate').datebox('getValue'),
            EndDate : $('#txtEndDate').datebox('getValue'),
            IsApproved:true
        };
        $.ajax({
            type: "POST",
            dataType: "json",
            url : sessionStorage.getItem("BaseAddress")+  "/GeneralLedger/SetMonthlyGLSessionData",
            traditional: true,
            data:  JSON.stringify(oGeneralLedger),
            contentType: "application/json; charset=utf-8",
            success: function (data) {
                var sFeedBackMessage = jQuery.parseJSON(data);
                if (sFeedBackMessage==="Successful") {
                    window.location.href = sessionStorage.getItem("BaseAddress")+ "/GeneralLedger/ViewGLMonthlySummary?menuid="+parseInt(sessionStorage.getItem('MenuID'));
                }
            },
            error: function (xhr, status, error) {
                alert(error);
            }
        });


    }

    function BillLedger(nParentHeadID, nCCID, nVoucherBillID)
    {
        debugger;
        var oVoucherRefReport = {
            AccountHeadID : nParentHeadID,
            CCID:nCCID,
            VoucherBillID:nVoucherBillID,
            StartDate : $('#txtStartDate').datebox('getValue'),
            EndDate : $('#txtEndDate').datebox('getValue'),
            IsApproved:true
        };
        $.ajax({
            type: "POST",
            dataType: "json",
            url : sessionStorage.getItem("BaseAddress")+  "/FinancialStatement/SetVRRSessionData",
            traditional: true,
            data:  JSON.stringify(oVoucherRefReport),
            contentType: "application/json; charset=utf-8",
            success: function (data) {
                var sFeedBackMessage = jQuery.parseJSON(data);
                if (sFeedBackMessage==="Successful") {
                    window.location.href = sessionStorage.getItem("BaseAddress")+ "/FinancialStatement/ViewBillLedger?menuid="+parseInt(sessionStorage.getItem('MenuID'));
                }
            },
            error: function (xhr, status, error) {
                alert(error);
            }
        });


    }

    $("#btnPrint").click(function(){
        if(!ValidateInput()){return;}
        var nOrderID=parseInt($('#txtOrderNo').data('obj').SaleOrderID)?parseInt($('#txtOrderNo').data('obj').SaleOrderID):0;
        var dStartDate=$('#txtStartDate').datebox('getValue');
        var dEndDate=$('#txtEndDate').datebox('getValue');
        var sParam= nOrderID+"~"+dStartDate+"~"+dEndDate;
        window.open(sessionStorage.getItem("BaseAddress")+'/FinancialStatement/PrintSalesProfit?Params=' + sParam, "_blank");
    });


    $("#btnPrintXL").click(function(){
        if(!ValidateInput()){return;}
        var nOrderID=parseInt($('#txtOrderNo').data('obj').SaleOrderID)?parseInt($('#txtOrderNo').data('obj').SaleOrderID):0;
        var dStartDate=$('#txtStartDate').datebox('getValue');
        var dEndDate=$('#txtEndDate').datebox('getValue');
        var sParam= nOrderID+"~"+dStartDate+"~"+dEndDate;
        window.open(sessionStorage.getItem("BaseAddress")+'/FinancialStatement/ExportSalesProfitToExcel?Params=' + sParam, "_blank");
    });

    //////////voucher
    function RefreshVoucherData(nVoucherID){
        debugger;

        $.icsDataGet({
            BaseAddress: sessionStorage.getItem("BaseAddress"),
            Object: {VoucherID:nVoucherID},
            ControllerName: 'Voucher',
            ActionName: 'GetSingleVoucherDetails',
            IsWinClose: false
        },function (response){
            if(response.status && response.obj!=null){
                if(response.obj.VoucherID>0){
                    debugger;
                    sessionStorage.setItem("Voucher",JSON.stringify(response.obj));
                    var oVoucher =response.obj;
                    var oCurrencyes =oVoucher.LstCurrency;
                    var oCompany =oVoucher.Company;
                    var oVDObjs = oVoucher.VDObjs;
                    $(".lblBaseCurrencySymbol").text("("+oVoucher.BaseCUSymbol+")");
                    RefreshList(oVDObjs);
                    RefreshSummery(oVDObjs);
                    InitializeEventClick();
                    InitializeEventHover();
                    RefreshControl();
                    $("#winVoucher").icsWindow('open');
                    sessionStorage.setItem("VoucherWindow", 'Open');
                }
            }
        });

    }
    
    function RefreshList(oVDObjs)
    {
        //VoucherDetail = 0
        //CostCenter = 1
        //BillReference = 2
        //VoucherReference = 3
        //InventoryReference = 4
        var table = document.getElementById('tblVoucherDetail');
        $('#tblVoucherDetail').empty();
        for(var i=0; i<oVDObjs.length; i++)
        {
            var row = table.insertRow(i);
            if(oVDObjs[i].ObjTypeInt==0)
            {
                var cellAccountHead = row.insertCell(0);
                cellAccountHead.width= "50%";
                cellAccountHead.innerHTML =oVDObjs[i].AHName + " ["+oVDObjs[i].AHCode+"]";

                var cellNarration = row.insertCell(1);
                cellNarration.colSpan= 2;
                cellNarration.width= "30%";
                cellNarration.innerHTML = oVDObjs[i].Detail;


                var cellDebitAmount = row.insertCell(2);
                cellDebitAmount.width= "10%";
                cellDebitAmount.style.textAlign = "right";
                cellDebitAmount.innerHTML =  formatPrice(oVDObjs[i].DrAmount,null);

                var cellCreditAmount = row.insertCell(3);
                cellCreditAmount.width= "10%";
                cellCreditAmount.style.textAlign = "right";
                cellCreditAmount.innerHTML = formatPrice(oVDObjs[i].CrAmount,null);
            }
            if(oVDObjs[i].ObjTypeInt==1)
            {                    
                var cellSubLedgerName = row.insertCell(0);
                cellSubLedgerName.width= "50%";
                cellSubLedgerName.innerHTML = oVDObjs[i].CFormat;

                var cellSubLedgerNarration = row.insertCell(1);
                cellSubLedgerNarration.width= "20%";
                cellSubLedgerNarration.innerHTML = oVDObjs[i].Detail;

                var cellSubLedgerAmount = row.insertCell(2);
                cellSubLedgerAmount.width= "10%";
                cellSubLedgerAmount.style.textAlign = "right";
                cellSubLedgerAmount.innerHTML = formatPrice(oVDObjs[i].CAmount);

                var cellDebitAmount = row.insertCell(3);
                cellDebitAmount.width= "10%";
                cellDebitAmount.innerHTML = "";

                var cellCreditAmount = row.insertCell(4);
                cellCreditAmount.width= "10%";
                cellCreditAmount.innerHTML =  "";
            }
            if(oVDObjs[i].ObjTypeInt==2 || oVDObjs[i].ObjTypeInt==5)
            {
                var cellBillNumber = row.insertCell(0);
                cellBillNumber.width= "50%";
                cellBillNumber.innerHTML = oVDObjs[i].CFormat;

                var cellBillNarration = row.insertCell(1);
                cellBillNarration.width= "20%";
                cellBillNarration.innerHTML = oVDObjs[i].Detail;

                var cellBillAmount = row.insertCell(2);
                cellBillAmount.width= "10%";
                cellBillAmount.style.textAlign = "right";
                cellBillAmount.innerHTML = formatPrice(oVDObjs[i].CAmount);

                var cellDebitAmount = row.insertCell(3);
                cellDebitAmount.width= "10%";
                cellDebitAmount.innerHTML = "";

                var cellCreditAmount = row.insertCell(4);
                cellCreditAmount.width= "10%";
                cellCreditAmount.innerHTML =  "";
            }
            if(oVDObjs[i].ObjTypeInt==3 || oVDObjs[i].ObjTypeInt==6)
            {
                var cellChequeNumber = row.insertCell(0);
                cellChequeNumber.width= "50%";
                cellChequeNumber.innerHTML = oVDObjs[i].CFormat;

                var cellChequeNarration = row.insertCell(1);
                cellChequeNarration.width= "20%";
                cellChequeNarration.innerHTML = oVDObjs[i].Detail;

                var cellChequeAmount = row.insertCell(2);
                cellChequeAmount.width= "10%";
                cellChequeAmount.style.textAlign = "right";
                cellChequeAmount.innerHTML = formatPrice(oVDObjs[i].CAmount);

                var cellDebitAmount = row.insertCell(3);
                cellDebitAmount.width= "10%";
                cellDebitAmount.innerHTML = "";

                var cellCreditAmount = row.insertCell(4);
                cellCreditAmount.width= "10%";
                cellCreditAmount.innerHTML =  "";
            }
            if(oVDObjs[i].ObjTypeInt==4)
            {
                var cellInventoryItem = row.insertCell(0);
                cellInventoryItem.colSpan=2;
                cellInventoryItem.width= "70%";
                cellInventoryItem.innerHTML = oVDObjs[i].CFormat;

                var cellChequeAmount = row.insertCell(1);
                cellChequeAmount.width= "10%";
                cellChequeAmount.style.textAlign = "right";
                cellChequeAmount.innerHTML = formatPrice(oVDObjs[i].CAmount);

                var cellDebitAmount = row.insertCell(2);
                cellDebitAmount.width= "10%";
                cellDebitAmount.innerHTML = "";

                var cellCreditAmount = row.insertCell(3);
                cellCreditAmount.width= "10%";
                cellCreditAmount.innerHTML =  "";
            }
            if(oVDObjs[i].ObjTypeInt === 7 || oVDObjs[i].ObjTypeInt === 8)//Order Reference= 7 //SLOrder Reference= 8
            {                                        
                var cellInventoryItem = row.insertCell(0);
                cellInventoryItem.colSpan=2;
                cellInventoryItem.width= "70%";
                cellInventoryItem.innerHTML = oVDObjs[i].CFormat;

                var cellChequeAmount = row.insertCell(1);
                cellChequeAmount.width= "10%";
                cellChequeAmount.style.textAlign = "right";
                cellChequeAmount.innerHTML = formatPrice(oVDObjs[i].Amount);

                var cellDebitAmount = row.insertCell(2);
                cellDebitAmount.width= "10%";
                cellDebitAmount.innerHTML = "";

                var cellCreditAmount = row.insertCell(3);
                cellCreditAmount.width= "10%";
                cellCreditAmount.innerHTML =  "";
            }
        }
    }
    function RefreshSummery(oVDObjs)
    {
        var nTotalDebitAmount=0; var nTotalCreditAmount=0;
        if(oVDObjs==null)oVDObjs=[];
        for(var i=0; i<oVDObjs.length; i++)
        {
            nTotalDebitAmount=nTotalDebitAmount+ parseFloat(oVDObjs[i].DrAmount)
            nTotalCreditAmount=nTotalCreditAmount+parseFloat(oVDObjs[i].CrAmount);
        }
        document.getElementById('lblTotalDebitAmount').innerHTML =formatPrice(nTotalDebitAmount, null) ;
        document.getElementById('lblTotalCreditAmount').innerHTML =formatPrice(nTotalCreditAmount, null);
    }
    function InitializeEventClick()
    {
        $("#tblVoucherDetail tr").click(function() {
            ResetAllRowsClick();
            $(this).addClass("highlight");
            $(this).css("cursor","pointer");
        });
    }
    function ResetAllRowsClick()
    {
        var tblVoucherDetail=document.getElementById("tblVoucherDetail");
        if(tblVoucherDetail.rows!=null)
        {
            for(var i=0; i<tblVoucherDetail.rows.length; i++)
            {
                $('#tblVoucherDetail tr').eq(i).removeClass("highlight");
                $('#tblVoucherDetail tr').eq(i).removeClass("highlighthover");
            }
        }
    }
    function InitializeEventHover()
    {
        $("#tblVoucherDetail tr").hover(function() {
            ResetAllRowsHover();
            $(this).addClass("highlighthover");
            $(this).css("cursor","pointer");
        });
    }
    function ResetAllRowsHover()
    {
        var tblVoucherDetail=document.getElementById("tblVoucherDetail");
        if(tblVoucherDetail.rows!=null)
        {
            for(var i=0; i<tblVoucherDetail.rows.length; i++)
            {
                $('#tblVoucherDetail tr').eq(i).removeClass("highlighthover");
            }
        }
    }
    function RefreshControl()
    {
        var oVoucher=jQuery.parseJSON(sessionStorage.getItem("Voucher"));
        $("#lblHeaderName").text('View Voucher');
        $("#btnApprove").hide();

        $('#txtVoucherType').val(oVoucher.VoucherName)
        $('#txtVoucherDate').val(oVoucher.VoucherDateAsString)
        $("#txtBusinessUnit").val(oVoucher.BUShortNameCode);
        $("#txtVoucherNo").val(oVoucher.VoucherNo);
        $('#txtCurrency').val(oVoucher.CurrencyNameSymbol);
        $('#txtConversionRate').val(oVoucher.CurrencyConversionRate);
        $("#txtNarration").val(oVoucher.Narration);
        CalculateTotalSummary();
    }
    function CalculateTotalSummary()
    {
        debugger;
        var oVoucher=jQuery.parseJSON(sessionStorage.getItem("Voucher"));
        var nTotalDebitAmount=0;
        var nTotalCreditAmount=0;
        var oVDObjs = oVoucher.VDObjs;
        if(oVDObjs!=null)
        {
            for(var i=0; i<oVDObjs.length;i++)
            {

                nTotalDebitAmount=nTotalDebitAmount+ parseFloat(oVDObjs[i].DrAmount)
                nTotalCreditAmount=nTotalCreditAmount+parseFloat(oVDObjs[i].CrAmount);

            }
        }
        document.getElementById('lblTotalDebitAmount').innerHTML =formatPrice(nTotalDebitAmount, null) ;
        document.getElementById('lblTotalCreditAmount').innerHTML =formatPrice(nTotalCreditAmount, null);
    }
    $('#btnPrintVoucher').click(function(){
        var oVoucher=jQuery.parseJSON(sessionStorage.getItem("Voucher"));
        window.open(_sBaseAddress+'/Voucher/PrintVoucher?id=' + oVoucher.VoucherID+'&buid=0', "_blank");
    });
    $("#btnCloseVoucher").click(function (){
        $("#winVoucher").icsWindow('close');
        sessionStorage.setItem("VoucherWindow", 'Close');
    });
    ////////////voucher
</script>
