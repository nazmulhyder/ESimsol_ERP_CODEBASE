<html>
<head>
        <link href="@Url.Content("~/Content/CSS/icon.css")" rel="stylesheet" type="text/css" />
        <link href="@Url.Content("~/Content/CSS/easyui.css")" rel="stylesheet" type="text/css" />
        <link href="@Url.Content("~/Content/CSS/Pikerstyle.css")" rel="stylesheet" type="text/css" />
        <script src="@Url.Content("~/Scripts/jquery-1.7.1.min.js")" type="text/javascript"></script>
        <script src="@Url.Content("~/Scripts/jquery.ics.customize.js")" type="text/javascript"></script>
        <script src="@Url.Content("~/Scripts/jquery.easyui.min.js")" type="text/javascript"></script>
        <script src="@Url.Content("~/Scripts/jquery-ui.min.js")" type="text/javascript"></script>
        <script src="@Url.Content("~/Scripts/json2.js")" type="text/javascript"></script>
</head>
@model ESimSol.BusinessObjects.ProductionSchedule
<body>
    <div style="font-family: Tahoma">
        <table border="0" cellspacing="2" cellpadding="2">
            <tr>
                <td style="background-color: #CFB53B; text-align: center; width: 935px; color: White">
                    <label id="lblHeaderName" style="font-size: 15px; font-weight: bold; text-decoration: Underline">
                        @ViewBag.Title</label>
                </td>
            </tr>
        </table>
        <fieldset>
            <table style="font-size: 12px; width: 915px">
                <tr>
                    <td style="padding-left: 70px;">
                        <span style="font-weight: bold;">Color: </span><span>
                            <select id="cboColor" style=" width:185px;"></select>
                        </span>
                    </td>
                    <td>
                        <span style="font-weight: bold; padding-left: 60px;">Yarn: </span><span>
                            <label id="lblYarn">
                            </label>
                        </span>
                    </td>
                    <td>
                        <span style="font-weight: bold; padding-left: 48px;">Exe No:</span><span>
                            <label id="lblExeNo">
                            </label>
                        </span>
                    </td>
                </tr>
                <tr>
                    <td style="padding-left: 30px;">
                        <span style="font-weight: bold;">Buyer Name: </span><span>
                             <label id="lblBuyerName">
                            </label>
                        </span>
                    </td>
                    <td>
                        <span style="font-weight: bold; padding-left: 27px;">Mkt Name:  </span><span>
                           <label id="lblMktName">
                            </label>
                           
                        </span>
                    </td>
                    <td>
                     <span style="font-weight: bold; padding-left: 57px;">Color: </span><span>
                            <label id="lblColor">
                            </label>
                        </span>
                    </td>
                </tr>
                <tr>
                    <td style="padding-left: 55px;">
                        <span style="font-weight: bold;">Order Qty: </span><span>
                            <label id="lblOrderQty">
                            </label>
                        </span>
                    </td>
                    <td>
                        <span style="font-weight: bold; ">Scheduled Qty: </span><span>
                            <label id="lblScheduledQty">
                            </label>
                        </span>
                    </td>
                    <td>
                        <span style="font-weight: bold;">Remaining Qty: </span><span>
                            <label id="lblRemainingQty">
                            </label>
                        </span>
                    </td>
                </tr>
                <tr>
                    <td style="padding-left: 20px;">
                        <span>Select Machine:</span> <span>
                            <input type="text" id="txtMachineName" style="width: 120px;" />
                            <input type="text" id="txtAssignedSchedule" style="width: 30px;" align="middle" disabled /></span> <span>
                                <input type="button" id="btnPickMachine" value="P" /></span>
                    </td>
                    <td style="padding-left: 10px;">
                        <span>Qty</span> <span>
                            <input type="text" style="width: 65px;" id="txtQty" /></span> <span style="padding-left: 10px;">
                                Continue</span> <span>
                                    <input type="text" style="width: 60px;" id="txtContinue" /></span>
                    </td>
                    <td style="padding-left: 10px;">
                        <span style="padding-left: 10px;">
                            <input type="checkbox" id="ckboxRegular" onclick="checkRegular()" /></span><span>Regular</span><span
                                style="padding-left: 10px;"><input type="checkbox" id="ckboxBooking" onclick="checkBooking()" /></span><span>Booking</span>
                               @*  <span style=" padding-left:15px; font-size:14px; color:Red">  <input type="checkbox" id="chkCombine" />Combine </span>*@
                    </td>
                </tr>
                <tr>
                    <td colspan="3" style="padding-left: 57px;">
                        <span>Remarks:</span> <span>
                            <input type="text" id="txtRemarks" style="width: 750px;" /></span>
                    </td>
                </tr>
                @*<tr>
                    <td colspan="3" style="padding-left: 44px; padding-top: 20px;">
                        <span>Start Time:</span> <span>
                            <input id="txtStartDate" type="text" class="easyui-datetimebox" data-options=" required:true, showSeconds:false"
                                style="width: 184px;" /></span> <span style="padding-left: 10px;">
                                    <input id="timeSpinner" class="easyui-timespinner" style="width: 100px;" required="required"
                                        data-options="showSeconds:false" /></span> <span>
                                            <button onclick="AddTime()" style="width: 45px;">
                                                Add</button></span> <span style="padding-left: 10px;">End Time</span>
                        <span>
                            <input id="txtEndDate" type="text" class="easyui-datetimebox" data-options=" required:true, showSeconds:false"
                                style="width: 180px;" /></span> 
                    </td>
                </tr>*@
            </table>
            <div style="padding-left: 20px; padding-right: 10px; padding-top: 10px;">
                <table style="width: 100%; font-size: 12px;">
                    <tr>
                        <td>
                            <div>
                                <div style="float: left; width: 20%;">
                                    <div style="float: right; padding-top: 2px; padding-right: 10px;">
                                        Start Time
                                    </div>
                                </div>
                                <div id="startDateTime" style="float: left; width: 75%;">
                                    <span>
                                        <select id="cboYear">
                                        </select>
                                    </span><span>
                                        <select id="cboMonth">
                                        </select>
                                    </span><span>
                                        <select id="cboDay">
                                        </select>
                                    </span><span>
                                        <select id="cboHour">
                                        </select>
                                    </span><span>
                                        <select id="cboMinute">
                                        </select>
                                    </span>
                                </div>
                            </div>
                        </td>
                        <td>
                            <div>
                                <div style="float: left; width: 21%;">
                                    <div style="float: right; padding-top: 2px; padding-right: 10px;">
                                        End Time
                                    </div>
                                </div>
                                <div style="float: left; width: 75%;">
                                    @*<input id="txtEndDate" type="text" class="easyui-datetimebox" data-options="required:true, showSeconds:false"
                                            style="width: 180px;" />*@ <span>
                                                <select id="cboEndYear">
                                                </select>
                                            </span><span>
                                                <select id="cboEndMonth">
                                                </select>
                                            </span><span>
                                                <select id="cboEndDay">
                                                </select>
                                            </span><span>
                                                <select id="cboEndHour">
                                                </select>
                                            </span><span>
                                                <select id="cboEndMinute">
                                                </select>
                                            </span>
                                </div>
                            </div>
                        </td>
                    </tr>
                    <tr style="padding-top: 20px;">
                        <td>
                            <div>
                                <div style="float: left; width: 20%;">
                                    <div style="float: right; padding-top: 2px; padding-right: 10px;">
                                    </div>
                                </div>
                                <div style="float: left; width: 75%;">
                                    <span>
                                        <input type="button" id="btnScheduleLastTime" value="Default Time" style="font-size: 11px;
                                            height: 23px; width: 80px;" />
                                    </span><span>
                                        <input type="button" id="btnCurrenttime" value="Current Time" style="font-size: 11px;
                                            height: 23px; width: 80px;" />
                                    </span><span>
                                        <input id="timeSpinner" class="easyui-timespinner" style="width: 75px; height:20px; font-size: 11px;" required="required"
                                            data-options="showSeconds:false" />
                                    </span>
                                    <span>
                                        <input type="button" id="btnAddSpinnerTime" value="Add" style="font-size: 11px;
                                            height: 23px; width: 30px;" />
                                    </span>
                                </div>
                            </div>
                        </td>
                        <td>
                            <span style="padding-left: 30px;">
                                <input type="button" id="btnAddSchedule" value="Add Schedule" />
                            </span>
                        </td>
                    </tr>
                </table>
            </div>
        </fieldset>
        <fieldset>
            <div style="width: 915px; height: 185px; padding-top: 10px;">
                <table id="tblProductionScheduleDetail" class="easyui-datagrid" style="width: 920px;
                    height: 185px" pagination="false" rownumbers="true" fitcolumns="false" singleselect="true"
                    toolbar="#toolbar">
                    <thead>
                        <tr>
                            <th field="ProductionScheduleNo" width="110">
                                PS No
                            </th>
                            <th field="RouteSheetNo" width="75" align="left">
                                DL No
                            </th>
                            <th field="BatchCardNo" width="85" align="left">
                                Bach No
                            </th>
                            
                            <th field="MachineName" width="105">
                                Machine
                            </th>
                            @* <th field="ProductionQty" width="110" align="right" formatter="formatPrice">
                                Capacity
                            </th>*@
                            
                            <th field="DEOScheduleQty" width="80" align="right" formatter="formatPrice">
                                Quantity
                            </th>
                            <th field="StartTimeInString" width="125" align="left">
                                Start Date
                            </th>
                            <th field="EndTimeInString" width="125" align="left">
                                End Date
                            </th>
                            <th field="DyeLoadTimeInString" width="125" align="left">
                                DyeLoad Time
                            </th>
                            <th field="DyeUnLoadTimeInString" width="125" align="left">
                                DyeUnLoad Time
                            </th>
                            <th field="RSStateInString" width="110" align="left">
                                Status
                            </th>
                        </tr>
                    </thead>
                </table>
            </div>
            <div id="toolbar">
                <a id="btnEdit" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-edit"
                    plain="true">Edit</a> <a id="btnDelete" href="javascript:void(0)" class="easyui-linkbutton"
                        iconcls="icon-remove" plain="true">Delete</a> <a id="btnAddDyelineSheet" href="javascript:void(0)"
                            class="easyui-linkbutton" iconcls="icon-add" plain="true">Add DL</a>
                <a id="btnViewDL" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-details"
                    plain="true">View DL</a> 
                   @* <a id="btnAddCombineDyelineSheet" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-add" plain="true">CDL</a>*@
                    <a id="btnPrintBatchCard" href="javascript:void(0)" class="easyui-linkbutton"
                        iconcls="icon-print" plain="true">Batch Card</a>
            </div>
        </fieldset>
        <table border="0" cellspacing="2" cellpadding="2" style="font-size: 11px;">
            <tr>
                <td style="width: 920px; text-align: right">
                    <a href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-cancel" plain="true"
                        onclick="Close()">Close</a>
                </td>
            </tr>
        </table>
    </div>
</body>
</html>
<script type="text/javascript">
    var _sBaseAddress='';
    var _oPTUs=[];
    var _oPTU=null;
    var _oProductionSchedule=null;
    var _oPSDs=[];
    var nflag=0;
    var _nPSSID=0;
    var _nLocationID=0;
    var _nUsedQty=0;
    var _StratTime="";
    var _nPTUID=0;
    var _bChanges=false;
$(document).ready(function () {
    //debugger;  
    var obj = window.dialogArguments;         
    _sBaseAddress =@Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(HttpContext.Current.Session[SessionInfo.BaseAddress]));
    _oProductionSchedule=@Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(Model));
    _oPTUs=@Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(ViewBag.oPTUs));
    var bAddSchedule=@Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(TempData["AddSchedule"]));
    var bEditSchedule=@Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(TempData["EditSchedule"]));
    var bDeleteSchedule=@Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(TempData["DeleteSchedule"]));
    var bAddDyelineSheet=@Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(TempData["AddDyelineSheet"]));
    
    _nPTUID=obj.PTUID;
    
    document.getElementById('ckboxRegular').checked=true;
    if(bAddSchedule==false)
    {
       document.getElementById('btnAddSchedule').style.display='none'; 
    }
    if(bEditSchedule==false)
    {
       document.getElementById('btnEdit').style.display='none';  
    }
    if(bDeleteSchedule==false)
    {
       document.getElementById('btnDelete').style.display='none'; 
    }
    if(bAddDyelineSheet==false) 
    {
       document.getElementById('btnAddDyelineSheet').style.display='none';
//       document.getElementById('btnAddCombineDyelineSheet').style.display='none';  
    }


    LoadColor();

     $('#txtQty').numberbox({ min:0,precision:2});
     $('#txtContinue').numberbox({ min:0,precision:0});
     //$('#txtContinue').numberbox('setValue',1);
    
//     var currentDateTime=new Date();
//     var nyear=currentDateTime.getFullYear();
//     var nmonth=currentDateTime.getMonth()+1;
//     var nday=currentDateTime.getDate();
//     var nhour=currentDateTime.getHours();
//     var nminutes=currentDateTime.getMinutes();

//      nminutes=Number(nminutes)+5;
//      var newStartDate=nmonth +'/'+ nday +'/'+ nyear +' '+ nhour +':'+nminutes;
//      $("#txtStartDate").datetimebox('setValue',newStartDate);
//      $("#txtEndDate").datetimebox('setValue',newStartDate);

       debugger; 
       Controll();
       SetDateTime();
       var sYear=(new Date()).getFullYear().toString();
       sYear=sYear.substring(2,sYear.length);
       $('#timeSpinner').timespinner('setValue', '12:00'); 
   
       var oDate=new Date();
       oDate.setMinutes(oDate.getMinutes()+5);
       SetStartTime(oDate);
       AddTime(GenerateStartTimeInString());


     // LoadIntoGrid(_oProductionSchedule.ProductionScheduleDetailList);

}); 

function LoadColor()
{
   //ProductionTracingUnitID
    $('#cboColor').empty();
//    var oPTUs = "<option value='0'>--Select Color --</option>";
    var oPTUs=null;
    if(_oPTUs.length>0)
    {
        for (var i = 0; i < _oPTUs.length; i++)
        {
            oPTUs += "<option value=" + _oPTUs[i].ProductionTracingUnitID + ">" + _oPTUs[i].Color + "</option>";
        }
    }
    $('#cboColor').html(oPTUs);  
    if(_nPTUID>0){$('#cboColor').val(_nPTUID);}  
    if(_oPTUs.length>0){SetColorWiseInformation();}

}


 function Controll()
 {
      document.getElementById('cboEndYear').disabled=true;
      document.getElementById('cboEndMonth').disabled=true;
      document.getElementById('cboEndDay').disabled=true;
      document.getElementById('cboEndHour').disabled=true;
      document.getElementById('cboEndMinute').disabled=true;
 }


 function SetDateTime()
 {
    var oDate=new Date();

    /*---------------------------------------- Start Set Year-------------------------------------------*/
    var sYear="";
    sYear +="<option value='0'>"+'Year'+"</option>";
    for(var i=0; i<=10; i++)
    {
        sYear += "<option value='" + (parseInt(oDate.getFullYear()) + parseInt(i)) +"'>" + (parseInt(oDate.getFullYear()) + parseInt(i)) +"</option>";
    }
    $('#cboYear').html(sYear);
    $('#cboEndYear').html(sYear);
    /*---------------------------------------- End Set Year-------------------------------------------*/


    /*---------------------------------------- Start Set Month-------------------------------------------*/
    var sMonth="";
    var oMonths=['Jan','Feb','Mar','Apr','May','Jun','Jul','Aug','Sep','Oct','Nov','Dec'];
    sMonth +="<option value='0'>"+'Month'+"</option>";
    for(var i=0; i<oMonths.length; i++)
    {
        sMonth += "<option value='" +(parseInt(i)+1)+"'>" + oMonths[i] +"</option>";
    }
    $('#cboMonth').html(sMonth);
    $('#cboEndMonth').html(sMonth);
    /*---------------------------------------- End Set Month-------------------------------------------*/


    /*---------------------------------------- Start Set Date-------------------------------------------*/
    var sDay ="<option value='0'>"+'Day'+"</option>";
    $('#cboDay').html(sDay);
    $('#cboEndDay').html(sDay);
    /*---------------------------------------- End Set Date-------------------------------------------*/


    /*---------------------------------------- Start Set Hour-------------------------------------------*/
    var sHour="";
    sHour +="<option value='-1'>"+'hh'+"</option>";
    for(var i=0; i<24; i++)
    {
        if(i<10)
        {
          sHour += "<option value='" +i+"'>" + '0'+i+"</option>";
        }
        else
        {
          sHour += "<option value='" +i+"'>" + i+"</option>";
        }
    }
    $('#cboHour').html(sHour);
    $('#cboEndHour').html(sHour);
    /*---------------------------------------- End Set hour-------------------------------------------*/


    /*---------------------------------------- Start Set Minute-------------------------------------------*/
    var sMinute="<option value='-1'>"+'mm'+"</option>";
    $('#cboMinute').html(sMinute);
    $('#cboEndMinute').html(sMinute);
    /*---------------------------------------- End Set Minute-------------------------------------------*/

 }


 $('#cboYear').change(function(e)
 {
   var nYear=$('#cboYear').val();
   var nMonth=$('#cboMonth').val();
   if(nYear>0 && nMonth>0)
   {
     $('#cboDay').html(SetDateEvent(nYear, nMonth));
   }

 });

 $('#cboEndYear').change(function(e)
 {
   var nYear=$('#cboEndYear').val();
   var nMonth=$('#cboEndMonth').val();
   if(nYear>0 && nMonth>0)
   {
     $('#cboEndDay').html(SetDateEvent(nYear, nMonth));
   }

 });

  $('#cboMonth').change(function(e)
 {
   var nYear=$('#cboYear').val();
   var nMonth=$('#cboMonth').val();
   if(nYear>0 && nMonth>0)
   {
     $('#cboDay').html(SetDateEvent(nYear, nMonth));
   }

 });

 $('#cboEndMonth').change(function(e)
 {

   var nYear=$('#cboEndYear').val();
   var nMonth=$('#cboEndMonth').val();
   if(nYear>0 && nMonth>0)
   {
     $('#cboEndDay').html(SetDateEvent(nYear, nMonth));
   }

 });

 function SetDateEvent(nYear, nMonth)
 {

   var oDate=new Date();
   var sDay="";
   if( parseInt(nMonth)>0)
   {
        var nDay= new Date(parseInt(nYear), parseInt(nMonth), 0).getDate();
        sDay +="<option value='0'>"+'Day'+"</option>";
        for(var i=1; i<=parseInt(nDay); i++)
        {
            if(i<10)
            {
              sDay += "<option value='" +i+"'>" + '0'+i +"</option>";
            }
            else
            {
              sDay += "<option value='" +i+"'>" + i +"</option>";
            }
            
        }
    }
    return sDay;
 }





 $('#cboHour').change(function(e) 
 {
   if($('#cboHour').val()>=0)
   {
        $('#cboMinute').html(SetMinuteEvent());
   }

 });

 $('#cboEndHour').change(function(e) 
 {
   if($('#cboEndHour').val()>=0)
   {
        $('#cboEndMinute').html(SetMinuteEvent());
   }

 });

 function SetMinuteEvent()
 { 
    var sMinute="";
    sMinute +="<option value='-1'>"+'mm'+"</option>";
    for(var i=0; i<=60; i++)
    {
        if(i<10)
        {
            sMinute += "<option value='" +i+"'>" +'0'+ i+"</option>";
        }
        else
        {
            sMinute += "<option value='" +i+"'>" + i+"</option>";
        }
        
    }
    return sMinute;
 }

 $('#cboMinute').change(function(e) 
 {
   if($('#cboMinute').val()==60)
   {
      var nHour=$('#cboHour').val();
      nHour=parseInt(nHour)+1;
      $('#cboHour').val(nHour);
      $('#cboMinute').val(0);
   }

 });

 $('#cboEndMinute').change(function(e) 
 {
   if($('#cboEndMinute').val()==60)
   {
      var nHour=$('#cboEndHour').val();
      nHour=parseInt(nHour)+1;
      $('#cboEndHour').val(nHour);
      $('#cboEndMinute').val(0);
   }

 });

 function SetStartTime(oDate)
 {
      debugger;
      var nyear=oDate.getFullYear();
      var nmonth=oDate.getMonth()+1;
      var nday=oDate.getDate();
      var nhour=oDate.getHours();
      var nminutes=oDate.getMinutes();
      $('#cboYear').val(nyear);
      $('#cboMonth').val(nmonth); 
      $('#cboDay').html(SetDateEvent(nyear,nmonth)); 
      $('#cboDay').val(nday); 
      $('#cboHour').val(nhour); 
      $('#cboMinute').html(SetMinuteEvent()); 
      $('#cboMinute').val(nminutes); 
 }

 
$('#btnCurrenttime').click(function(e)
{
    var oDate=new Date();
    oDate.setMinutes(oDate.getMinutes()+5);
    SetStartTime(oDate);
    AddTime(GenerateStartTimeInString());
});

$('#btnScheduleLastTime').click(function(e)
{
   if($.trim(_StratTime)!=""){ SetStartTime(new Date(_StratTime));}
   else
   {
    var oDate=new Date();
    oDate.setMinutes(oDate.getMinutes()+5);
    SetStartTime(oDate);
    }
   AddTime(GenerateStartTimeInString());
});

function GenerateStartTimeInString()
{
   var sDate="";
   sDate= $('#cboMonth').val()+'/'+ $('#cboDay').val()+'/'+ $('#cboYear').val()+ ' '+ $('#cboHour').val()+':'+$('#cboMinute').val();
   return sDate;
}

function GenerateEndTimeInString()
{
   var sDate="";
   sDate= $('#cboEndMonth').val()+'/'+ $('#cboEndDay').val()+'/'+ $('#cboEndYear').val()+ ' '+ $('#cboEndHour').val()+':'+$('#cboEndMinute').val();
   return sDate;
}


 function AddTime(sDate)
 {
      var nhr=$('#timeSpinner').timespinner('getHours');
      var nmin=$('#timeSpinner').timespinner('getMinutes');
      if(isNaN(nhr))
      {
        nhr=0;
      }
      if(isNaN(nmin))
      {
        nmin=0;
      }

      var oDate=new Date(sDate);
      oDate.setHours(oDate.getHours()+nhr);
      oDate.setMinutes(oDate.getMinutes()+nmin);

      var nyear=oDate.getFullYear();
      var nmonth=oDate.getMonth()+1;
      var nday=oDate.getDate();
      var nhour=oDate.getHours();
      var nminutes=oDate.getMinutes();

      $('#cboEndYear').val(nyear);
      $('#cboEndMonth').val(nmonth); 
      $('#cboEndDay').html(SetDateEvent(nyear,nmonth)); 
      $('#cboEndDay').val(nday); 
      $('#cboEndHour').val(nhour); 
      $('#cboEndMinute').html(SetMinuteEvent()); 
      $('#cboEndMinute').val(nminutes); 
      
 }

//$('#timeSpinner').keydown(function (e) 
//{
//    var code = (e.keyCode ? e.keyCode : e.which);
//    if (code == 13)//Enter key-13
//    {
//        if(ValidationOfStartTime())
//        {

//          AddTime(GenerateStartTimeInString());
//        }
//     }
//});

$('#btnAddSpinnerTime').click(function(e)
{
    if(ValidationOfStartTime())
    {

        AddTime(GenerateStartTimeInString());
    }
});

function ValidationOfStartTime()
{
   if($('#cboYear').val()==0)
   {
     alert("Please select a year of start time.");
     return false;
   }
   if($('#cboMonth').val()==0)
   {
     alert("Please select a month of start time.");
     return false;
   }
   if($('#cboDay').val()==0)
   {
     alert("Please select a day of start time.");
     return false;
   }
   if($('#cboHour').val()==-1)
   {
     alert("Please select hour of start time.");
     return false;
   }
   if($('#cboMinute').val()==-1)
   {
     alert("Please select minute of start time.");
     return false;
   }
   return true;
}  

// function AddTime()
// {
//    //debugger;

//      document.getElementById("txtEndDate").disabled= true;
//     // var ntemp= $('#timeSpinner').timespinner('getValue');


//      var nhr=$('#timeSpinner').timespinner('getHours');
//      var nmin=$('#timeSpinner').timespinner('getMinutes');
//      if(isNaN(nhr))
//      {
//        nhr=0;
//      }
//      if(isNaN(nmin))
//      {
//        nmin=0;
//      }

//      var sStartDate=$("#txtStartDate").datetimebox('getValue');
//      var snewDateTime=new Date(sStartDate);
//      var nyear=snewDateTime.getFullYear();
//      var nmonth=snewDateTime.getMonth()+1;
//      var nday=snewDateTime.getDate();
//      var nhour=snewDateTime.getHours();
//      var nminutes=snewDateTime.getMinutes();

//      nhour=Number(nhour)+Number(nhr);
//      nminutes=Number(nminutes)+Number(nmin);
//      var newStartDate=nmonth +'/'+ nday +'/'+ nyear +' '+ nhour +':'+nminutes;
//      $("#txtEndDate").datetimebox('setValue',newStartDate);
//      document.getElementById("txtEndDate").disabled= true;
//      
// }

  function checkRegular()
 {
    
     if(document.getElementById("ckboxRegular").checked==true)
     {
        
         document.getElementById("ckboxBooking").checked=false;
        _oProductionSchedule.ScheduleType=true;
     }

    
 }
  function checkBooking()
 {
    
      if(document.getElementById("ckboxBooking").checked==true)
     {  
        document.getElementById("ckboxRegular").checked=false;
        _oProductionSchedule.ScheduleType=false;
     }
    
 }


 $('#cboColor').change(function(e)
 {
    SetColorWiseInformation();
 });


 function SetColorWiseInformation()
 {
  debugger;
      var nYTPQty=0;
      var nPTUID=$('#cboColor').val();
      if(parseInt(nPTUID)>0)
      {
         for(var i=0; i<_oPTUs.length;i++)
         {
            if(nPTUID == _oPTUs[i].ProductionTracingUnitID)
            {
                 _oPTU=_oPTUs[i];
                 GetProductionScheduleDetail();
                 document.getElementById('lblExeNo').innerHTML=_oPTU.JobNo;
                 document.getElementById('lblBuyerName').innerHTML=_oPTU.BuyerName;
                 document.getElementById('lblMktName').innerHTML=_oPTU.MKT; 
                 document.getElementById('lblYarn').innerHTML=_oPTU.ProductName; 
                 document.getElementById('lblColor').innerHTML=_oPTU.Color; 
                 document.getElementById('lblOrderQty').innerHTML=_oPTU.DyeingOrderQty.toFixed(2) + " KG"; 
                 document.getElementById('txtContinue').value=1;
                 //$('#txtContinue').numberbox('setValue',1);
            }
         }
      }
      else
      {
                 document.getElementById('lblExeNo').innerHTML='';
                 document.getElementById('lblBuyerName').innerHTML='';
                 document.getElementById('lblMktName').innerHTML=''; 
                 document.getElementById('lblYarn').innerHTML=''; 
                 document.getElementById('lblColor').innerHTML=''; 
                 document.getElementById('lblOrderQty').innerHTML=''; 
                 document.getElementById('lblScheduledQty').innerHTML=''; 
                 document.getElementById('lblRemainingQty').innerHTML='' ; 
                 $('#txtQty').numberbox('setValue','');
                 document.getElementById('txtContinue').value="";
                 LoadIntoGrid([]);
      }
 }


function LoadIntoGrid(oPSDs)
{
    data = oPSDs;  
    data={"total":""+data.length+"","rows":data};
    $('#tblProductionScheduleDetail').datagrid('loadData',data); 
    $('#tblProductionScheduleDetail').datagrid({selectOnCheck:true, checkOnSelect:true}) ;
    debugger;
    if(oPSDs.length>0)
    {
        document.getElementById('lblScheduledQty').innerHTML = oPSDs[parseInt(oPSDs.length)-1].TotalScheduledQuantity.toFixed(2) + " KG"; 
        //document.getElementById('lblRemainingQty').innerHTML = (oPSDs[parseInt(oPSDs.length)-1].RemainingScheduleQuantity).toFixed(2) + " KG"; 
        var nRemainingQty=(parseFloat(_oPTU.DyeingOrderQty)-parseFloat( (document.getElementById('lblScheduledQty').innerHTML).split(' ')[0])).toFixed(2);
        document.getElementById('lblRemainingQty').innerHTML = (nRemainingQty>0)?nRemainingQty:'0.00' + " KG"; ; 
        $('#txtQty').numberbox('setValue', (parseFloat(_oPTU.DyeingOrderQty)-parseFloat( (document.getElementById('lblScheduledQty').innerHTML).split(' ')[0])).toFixed(2));
        
        
        //if(parseFloat((document.getElementById('lblScheduledQty').innerHTML).split(' ')[0])>parseFloat(_oPTU.DyeingOrderQty))
        //{
           
        //}
        //else
        //{
        //    document.getElementById('lblRemainingQty').innerHTML = (parseFloat(_oPTU.YetToProduction)-parseFloat( (document.getElementById('lblScheduledQty').innerHTML).split(' ')[0])).toFixed(2) + " KG"; 
        //    $('#txtQty').numberbox('setValue', (parseFloat(_oPTU.YetToProduction)-parseFloat( (document.getElementById('lblScheduledQty').innerHTML).split(' ')[0])).toFixed(2));
        //}
        
        
        //$('#txtQty').numberbox('setValue', (parseFloat(_oPTU.RemainingJobOrderQty)).toFixed(2));
        
    } 
    else
    {   
         if($('#cboColor').val()<=0)
         {
             document.getElementById('lblScheduledQty').innerHTML=""; 
             document.getElementById('lblRemainingQty').innerHTML="";
         }
         else
         {
             document.getElementById('lblScheduledQty').innerHTML="0.00 KG"; 
             document.getElementById('lblRemainingQty').innerHTML=_oPTU.YetToProduction.toFixed(2) + " KG";
             $('#txtQty').numberbox('setValue',(parseFloat(_oPTU.YetToProduction)-parseFloat( (document.getElementById('lblScheduledQty').innerHTML).split(' ')[0])).toFixed(2));
         }
    }

}

$('#txtMachineName').keypress(function (e) 
{
        debugger;
        var code = (e.keyCode ? e.keyCode : e.which);
        var sName=document.getElementById("txtMachineName").value;
        
        if (code == 13)//Enter key-13
        {
            if($.trim(sName)!="")
            {
                var nts=(new Date()).getTime()/1000;
                var oParameter = new Object();
                oParameter.MultipleItemReturn = false;
                oParameter.Name=sName;
                var url = _sBaseAddress + "/ProductionSchedule/ViewMachineByName?sStr="+$.trim(sName)+"&nts="+nts;
                var oReturnObject = window.showModalDialog(url, oParameter, 'dialogHeight:400px;dialogWidth:400px;dialogLeft:400;dialogTop:100;center:yes;resizable:no;status:no;scroll:no');
                if (oReturnObject!=null)
                {
                    document.getElementById('txtAssignedSchedule').value="";
                    $("#txtMachineName")[0].value=oReturnObject.MachineName;
                    _nPSSID=oReturnObject.PSSID;
                    _nLocationID = oReturnObject.LocationID;
                    IndividualMachineSchedule();
                    SetLastScheduleTime();
                }
            }
            else
            {
                alert("Please enter somethig to seach machine.");
            }
        }
});

$('#btnPickMachine').click(function(e)
{
        var oParameter = new Object();
       
        oParameter.Name = "Add New Machine";
        var url =_sBaseAddress+ "/ProductionSchedule/ViewMachine";
        var oMachineLocation=window.showModalDialog(url, oParameter,'dialogHeight:400px;dialogWidth:600px;dialogLeft:450;dialogTop:150;center:yes;resizable:no;status:no;scroll:yes');
        if(oMachineLocation!=null)
        {
            _nPSSID = oMachineLocation.DyeMachines.PSSID;
            _nLocationID = oMachineLocation.LocationID;
            document.getElementById("txtMachineName").value=oMachineLocation.DyeMachines.MachineName;
            document.getElementById('txtAssignedSchedule').value="";
            IndividualMachineSchedule();
            // Get last schedule time for this machine
            SetLastScheduleTime();

       }
});

function SetLastScheduleTime()
{

   if(parseInt(_nPSSID)>0 && parseInt(_nLocationID)>0)
   {
        var nts=(new Date()).getTime()/1000;
        $.ajax({
                type: "GET",
                dataType: "json",
                url: _sBaseAddress + "/ProductionSchedule/GetPSByMachine",
                data: { nMachineID: _nPSSID ,  nLocationID: _nLocationID , nts:nts },
                contentType: "application/json; charset=utf-8",
                success: function(data) 
                {
                    //debugger;
                    _StratTime = jQuery.parseJSON(data);
                    if ($.trim(_StratTime)!='') 
                    {
                        SetStartTime(new Date(_StratTime));
                        AddTime(GenerateStartTimeInString());
                    }
                    else
                    {
                        
                        var oDate=new Date();
                        oDate.setMinutes(oDate.getMinutes()+5);
                        SetStartTime(oDate);
                    }
                    },
                    error: function(xhr, status, error)
                    {
                    alert(error);
                    }
                });
     }

}

function dateTimeValidation()
{

   if(ValidationOfStartTime())
   {
        var sStartTime= new Date(GenerateStartTimeInString());
        var sEndTime= new Date(GenerateEndTimeInString());

        if(new Date()>new Date(GenerateStartTimeInString()))
        {
           alert("Date time must be greater than current date time.");
           return false;
        }

        if(new Date(GenerateStartTimeInString())>=new Date(GenerateEndTimeInString()))
        {
           alert("End date time must be greater than start date time.");
           return false;
        }
        return true;
    }
    else
    {
       return false;
    }

}

function RefreshObject()
 {    
    //debugger;  
      
      // var sStability=document.getElementById("cboStability");
//       var sDate=$("#txtStartDate").datetimebox('getValue');
//       var eDate= $("#txtEndDate").datetimebox('getValue');

//       var sDateTime=new Date(sDate);
//       var eDateTime=new Date(eDate);
       var sDateTime=new Date(GenerateStartTimeInString());
       var eDateTime=new Date(GenerateEndTimeInString());
       var nProductionScheduleID=0;
       var oProductions=[];
       var oScheduleDetail=ProductionScheduleDetail();
       oProductions.push(oScheduleDetail);
       var oProductionSchedule = {   

                                        ProductionScheduleID          : nProductionScheduleID,
                                       // ScheduleStability           : sStability.options[sStability.selectedIndex].text, 
                                        PSSID                         : _nPSSID,  
                                        BatchNo                       :  $('#txtContinue').numberbox('getValue'),
                                        LocationID                    : _nLocationID,
                                        ProductionQty                 :  $('#txtQty').numberbox('getValue'),  
                                        ScheduleType                  : _oProductionSchedule.ScheduleType,
                                        StartTime	                  : sDateTime,
                                        EndTime                       : eDateTime,
                                        ProductionScheduleDetailList  : oProductions
                                  };


      return oProductionSchedule;
 } 

 function ProductionScheduleDetail()
 {
     var oPSD=
     {
            ProductionTracingUnitID : _oPTU.ProductionTracingUnitID,
            ProductionQty : $('#txtQty').numberbox('getValue'),
            Remarks :document.getElementById('txtRemarks').value,
            WaitingForProductionQty: _nUsedQty,
            YetToProductionQty:_oPTU.YetToProduction
     }
     return oPSD;

 }

 function validation()
 {
    var nQty=0;

    var oRows=$('#tblProductionScheduleDetail').datagrid('getRows');
    var nBatch= $('#txtContinue').numberbox('getValue');
    if($('#cboColor').val()<=0)
    {
       alert("Please select a color.");
       return fasle;
    }

    else if(_nLocationID==0 || _nPSSID==0)
    {
       alert("Please pick a machine.");
       return fasle;
    }
    else if(  $('#txtQty').numberbox('getValue')<1)
    {
      alert("Please enter quantity.");
      document.getElementById('txtQty').focus();
      return false;
    }

    else if(nBatch<1)
    {
       alert("Please enter Continue for schedule.");
       document.getElementById('txtContinue').focus();
       return false;
    }

//    else if(document.getElementById('txtQty').value>0)
//    {
//      _nUsedQty=0;
//      for(var i=0;i<oRows.length;i++)
//      {
//         _nUsedQty=_nUsedQty+oRows[i].ProductionQty;
//      }
//      nQty=_oPTU.YetToProduction -_nUsedQty;
//      if(nQty>0 && (document.getElementById('txtQty').value)*nBatch>nQty)
//      {
//        alert("You can assign at most "+(nQty/nBatch).toFixed(2)+" per batch");
//        return false;
//      }
//      else if(nQty==0)
//      {
//         alert("Please try with another. Because all of it's quantity is used before.");
//         return false;
//      }
//      
//    }

    else if(document.getElementById('ckboxRegular').checked==false && document.getElementById('ckboxBooking').checked==false)
    {
       alert("Please select regular or booking.");
       return false;
    }

    return true;
 }

 $('#btnAddSchedule').click(function(e)
 {
       debugger;

       if(!validation())
       return;
       if(! dateTimeValidation())
       return;
       var oProductionSchedule=RefreshObject();
        $.ajax({
            type: "POST",
            dataType: "json",            
            url : _sBaseAddress+  "/ProductionSchedule/Save_Batch",
            traditional: true,
            data:  JSON.stringify(oProductionSchedule),
            contentType: "application/json; charset=utf-8",
            success: function (data) {
                //debugger;
                oProductionSchedule = jQuery.parseJSON(data);
                if (oProductionSchedule.ErrorMessage=="") {
                    _bChanges=true;
                    alert("Data Saved successfully");

                    //debugger; 
                    var oPSDS=$('#tblProductionScheduleDetail').datagrid('getRows');
                    for(var i=0;i<oProductionSchedule.ProductionScheduleDetailList.length;i++)
                    {
                       oPSDS.push(oProductionSchedule.ProductionScheduleDetailList[i]);
                       LoadIntoGrid(oPSDS);
                       SetScheduleRemaining();
                       SetLastScheduleTime();
                    }
                    
                                    
                }
                else 
                {
                    alert(oProductionSchedule.ErrorMessage);
                }
            },
            error: function (xhr, status, error) {
                alert(error);
            }
                 

        });
 });

 
 $('#btnDelete').click(function(e)
 {
     var oPSD= $('#tblProductionScheduleDetail').datagrid('getSelected'); 
     var oPSDS= $('#tblProductionScheduleDetail').datagrid('getRows'); 
     if(oPSD==null)
     {
        alert("Please select a item from list!");
        return;
     }

     var nCount=0;
     for(var i=0;i<oPSDS.length;i++)
     {
        if(oPSDS[i].ProductionScheduleID==oPSD.ProductionScheduleID)
        {
          nCount++;
        }
     }

     if(nCount==1)
     {
        var x=confirm("Are you sure to delete it. Because It will be deleted the schedule with details.");
        if(x==false)
        {
          return;
        }
     }

     var nts=(new Date()).getTime()/1000;

     var SelectedRowIndex=$('#tblProductionScheduleDetail').datagrid('getRowIndex',oPSD);
     $.ajax({
                type: "GET",
                dataType: "json",
                url: _sBaseAddress + "/ProductionSchedule/DeleteByDEO",
                data: { nPSID:oPSD.ProductionScheduleID , nPSDID: oPSD.ProductionScheduleDetailID ,nts:nts },
                contentType: "application/json; charset=utf-8",
                success: function(data) 
                {
                    //debugger;
                    var feedbackmessage = jQuery.parseJSON(data);
                    //debugger;
                    if (feedbackmessage != "")
                    {
                        _bChanges=true;
                        alert(feedbackmessage);
                        $('#tblProductionScheduleDetail').datagrid('deleteRow', SelectedRowIndex);
                        SetScheduleRemaining();
                    } 
                  },
                  error: function(xhr, status, error)
                  {
                    alert(error);
                  }
              });
 });

  $('#btnEdit').click(function(e)
 {
         var oPSD= $('#tblProductionScheduleDetail').datagrid('getSelected'); 
        //  ProductionScheduleID<=0
         if(oPSD==null)
        {
            alert("Please select a item from list!");
            return;
         }
         if(oPSD.RouteSheetNo!='')
         {
             alert("Unable To Edit. Already a dyeline sheet is created.");
             return;
         }

        var SelectedRowIndex=$('#tblProductionScheduleDetail').datagrid('getRowIndex',oPSD);

        var oParameter = new Object();        
        oParameter.Name = "Schedule By DEO";
        
        var url =_sBaseAddress+ "/ProductionSchedule/ViewEditProductionScheduleByDEO?id="+oPSD.ProductionScheduleID+"&nPSDID="+oPSD.ProductionScheduleDetailID;
        var result= window.showModalDialog(url, oParameter,'dialogHeight:450px;dialogWidth:800px;dialogLeft:385;dialogTop:150;center:yes;resizable:no;status:no;scroll:yes');
       // oParameter.ProductionSchedule=oProductionSchedule;
        var oPSDs=result[1];
        debugger;
        if(oPSDs.length>0)
        {
            if(oPSDs[0].ProductionScheduleID>0)
            {
                _bChanges=true;
                $('#tblProductionScheduleDetail').datagrid('updateRow',{index: SelectedRowIndex,	row: oPSDs[0]});
                SetScheduleRemaining(); 
            }
        }
 });

 function SetScheduleRemaining()
 {
     var oPSDS=$('#tblProductionScheduleDetail').datagrid('getRows');
     var nTotal=0;
     if(oPSDS.length>0)
     {
        
         for(var i=0;i<oPSDS.length;i++)
         {
            nTotal=nTotal+oPSDS[i].ProductionQty;
         }
     } 
     document.getElementById('lblScheduledQty').innerHTML=nTotal +" KG"; 
     document.getElementById('lblRemainingQty').innerHTML=(_oPTU.JobOrderQty-nTotal).toFixed(2) +" KG"; 
     $('#txtQty').numberbox('setValue',(_oPTU.YetToProduction-nTotal).toFixed(2)); 


 }


$('#btnAddDyelineSheet').click(function(e)
{
    var oPSD = $('#tblProductionScheduleDetail').datagrid('getSelected');
    if (oPSD == null) 
    {
        alert("Please select an item from list!");
        return;
    }
    if(oPSD.RouteSheetNo>0)
    {
       alert("Dyeline sheet is already created. Please select another.");
       return;
    }
    var oParameter = new Object();
    oParameter.Name = "New Dye Line";
    var tsv = ((new Date()).getTime()) / 1000;
    var url = _sBaseAddress + "/DyeLine/View_DyeLineSheetByDEO?nId="+oPSD.ProductionScheduleDetailID+"&ts=" + tsv;
    var oDyeLine = window.showModalDialog(url, oParameter, 'dialogHeight:650px;dialogWidth:870px;dialogLeft:100;dialogRight:100;dialogTop:50;center:yes;resizable:no;status:no;scroll:no');
    GetProductionScheduleDetail();
 
});


function  GetProductionScheduleDetail()
{
  $.ajax({
           type: "GET",
           dataType: "json",
           url: _sBaseAddress + "/ProductionSchedule/GetsByPTUForDEO",
           data: { nPTUID:_oPTU.ProductionTracingUnitID },
           contentType: "application/json; charset=utf-8",
           success: function(data) 
           {
                var oPSDS = jQuery.parseJSON(data);
                if (oPSDS.length>0 && oPSDS[0].ErrorMessage==""  )
                {
                    LoadIntoGrid(oPSDS); 
                } 
                else
                {
                 LoadIntoGrid([]);
                }
            },
            error: function(xhr, status, error)
            {
               alert(error);
              
            }
         });
}
$('#btnPrintBatchCard').click(function(e)
{
    var oPSD = $('#tblProductionScheduleDetail').datagrid('getSelected');
    if (oPSD == null) 
    {
        alert("Please select an item from list!");
        return;
    }
    
    if(oPSD.ProductionScheduleDetailID>0)
    {
        window.open(_sBaseAddress+'/ProductionSchedule/PrintBatchCard?sRSNo='+oPSD.RouteSheetNo,"_blank");  
    }
    window.returnValue="Print";
    window.close();
    
 
});


function formatPrice(val,row)
{  
    if(val==null)
    {
        val="0.00";
    }
    val=parseFloat(val);
    var test = val.toFixed(2);
    var tests = addComma(test);
    return tests;       
} 
function addComma(nStr)
{
	nStr += '';
	x = nStr.split('.');
	x1 = x[0];
	x2 = x.length > 1 ? '.' + x[1] : '';
	var rgx = /(\d+)(\d{3})/;
	while (rgx.test(x1)) {
		x1 = x1.replace(rgx, '$1' + ',' + '$2');
	}
	return x1 + x2;
}


$('#btnViewDL').click(function(e)
{
    
    var oPSD = $('#tblProductionScheduleDetail').datagrid('getSelected');
    if (oPSD == null) 
    {
        alert("Please select an item from list!");
        return;
    }
    if(oPSD.RouteSheetNo==""){ alert("No dyeline sheet is created. Please add dyeline sheet first."); return;}

    var oParameter = new Object();
    oParameter.Name = "New Dye Line";
    var tsv = ((new Date()).getTime()) / 1000;
    var url = _sBaseAddress + "/DyeLine/View_DyeLineSheetByDEO?nId="+oPSD.ProductionScheduleDetailID+"&ts=" + tsv;
    var sReturnValue= window.showModalDialog(url, oParameter, 'dialogHeight:650px;dialogWidth:870px;dialogLeft:100;dialogRight:100;dialogTop:50;center:yes;resizable:no;status:no;scroll:no');

    if(sReturnValue!=null || $.trim(sReturnValue)!="")
    {
      window.returnValue=sReturnValue;
      window.close();
    }

});


function Close()
{
    if(_bChanges)
    {
        window.returnValue="Changes";
    }
    else
    {
            window.returnValue="";
    }
    
    window.close();
}



function IndividualMachineSchedule()
{
       debugger;
       if(_nPSSID>0 && _nLocationID>0)
       {
           var nts=(new Date()).getTime()/1000;
           $.ajax({
                   type: "GET",
                   dataType: "json",               
                   url: _sBaseAddress+ "/ProductionSchedule/GetIndividualMachineSchedule",
                   data: { nPSSID:_nPSSID, nLocationID: _nLocationID, nts:nts },
                   contentType: "application/json; charset=utf-8",
                   success: function (data) 
                   {
                       debugger;
                       var oPSs=[];
                       oPSs = jQuery.parseJSON(data);                  
                 
                        if(oPSs.length>0 && oPSs[0].ErrorMessage=="")
                        {
                            document.getElementById('txtAssignedSchedule').value=oPSs.length;
                        }    
                        else
                        {
                            document.getElementById('txtAssignedSchedule').value="";
                        }              
                     
                     },
                     error: function (xhr, status, error) 
                     {
                        alert(error);
                     }
                });
            }
}


//$('#btnAddCombineDyelineSheet').click(function(e)
//{
//    var oPSD = $('#tblProductionScheduleDetail').datagrid('getSelected');
//    if (oPSD == null ) 
//    {
//        alert("There is no item in the list.");
//        return;
//    }

//    if(oPSD.ProductionScheduleID>0)
//    {
//       var nSelectedIndex=$('#tblProductionScheduleDetail').datagrid('getRowIndex',oPSD);
//       var sProductionScheduleNo=oPSD.ProductionScheduleNo;
//       var oParameter = new Object();
//       oParameter.Name = "New Combine Dyline";
//       oParameter.ProductionScheduleNo=sProductionScheduleNo;
//       var nts = ((new Date()).getTime()) / 1000;
//       var url = _sBaseAddress + "/CombineRouteSheet/ViewCombineRouteSheet?nId="+oPSD.CRSID+"&nts=" + nts;
//       var oCRS = window.showModalDialog(url, oParameter, 'dialogHeight:610px;dialogWidth:870px;dialogLeft:270;dialogRight:120;dialogTop:50;center:yes;resizable:no;status:no;scroll:no'); 

//       if(oCRS!=null)
//       {
//         if(oCRS=='print')
//         {
//             window.close(); 
//         }

//         else if(oCRS.CRSID>0)
//         {
//               var nts=(new Date()).getTime()/1000;
//               $.ajax({
//               type: "GET",
//               dataType: "json",               
//               url: _sBaseAddress+ "/ProductionSchedule/GetsProductionScheduleDetail",
//               data: { nPSID: oPSD.ProductionScheduleID,nts:nts },
//               contentType: "application/json; charset=utf-8",
//               success: function (data) 
//               {
//                   debugger;
//                   var oPSDs=[];
//                   oPSDs = jQuery.parseJSON(data);                  
//                 
//                    if(oPSDs.length>0 && oPSDs[0].ErrorMessage=="")
//                    {
//                       $('#tblProductionScheduleDetail').datagrid('updateRow', { index: nSelectedIndex, row: oPSDs[0] }); 
//                    }    
//                    else
//                    {
//                        alert(oPSDs[0].ErrorMessage);
//                    }              
//                     
//                 },
//                 error: function (xhr, status, error) 
//                 {
//                    alert(error);
//                 }
//            });
//         }
//       }
//    }

//});

</script>
