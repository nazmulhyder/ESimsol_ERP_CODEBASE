<html>
<body>
    <head>
        @{
            ViewBag.Title = "Production Schedule";
        }
    </head>
    @model ESimSol.BusinessObjects.ProductionSchedule
    <div id="progressbarParent" style="width:100%;height:100%;margin:0 auto;text-align:center; margin-left: auto;margin-right: auto;left: 0;right: 0;z-index: 1;">
        <div style="margin: 0px auto;margin-top: 251px;text-align:center;width:390px;">
            <label style="font-size:18px;">Please wait</label>
            <div id="progressbar" style="width:100%;height:37px;"></div>
        </div>
    </div>
    <div id="winDyeingOrderDetailAdvanceSearch" class="easyui-window winClass" title="Advance Search" data-options="modal:true,closed:true,collapsible:false,minimizable:false,maximizable:false,closable:false">
        <div style="width:760px; float: left;">
            <table border="0" cellpadding="0" cellspacing="0">
                <tr style="height:300px">
                    <td style="width:850px">
                        <table border="0" cellpadding="0" cellspacing="0">
                            <tr style="height:300px">
                                <td style="width:300px; vertical-align:top;height:300px">
                                    <fieldset>
                                        <legend style="font-weight:bold; font-size:12px"> Searching Criteria : </legend>
                                        <table border="0" cellpadding="0" cellspacing="2">
                                            <tr>
                                                <td style="width:300px;font-size:12px;">
                                                    Order No:
                                                </td>
                                            </tr>
                                            <tr>
                                                <td style="width:350px">
                                                    @Html.TextBox("txtDyeingOrderNo", "", new { style = "width: 325px", id = "txtDyeingOrderNo" })
                                                </td>
                                            </tr>

                                            <tr>
                                                <td style="width:300px;font-size:12px;">
                                                    Buyer Name:
                                                </td>
                                            </tr>
                                            <tr>
                                                <td style="width:300px;font-size:12px;">
                                                    @Html.TextBox("txtBuyerName", "", new { style = "width: 260px;font-size:12px;", id = "txtBuyerName", placeholder = " Type Buyer & Press Enter" }) <input type="button" id="btnBuyerPicker" style="width:60px;" value="Pick" />

                                                </td>
                                            </tr>

                                            <tr>
                                                <td style="width:300px;font-size:12px;">
                                                    Order Date:
                                                </td>
                                            </tr>
                                            <tr>
                                                <td style="width:300px">
                                                    <table border="0" cellpadding="0" cellspacing="0">
                                                        <tr>
                                                            <td style="width:97px;font-size:12px;">@Html.DropDownList("cboOrderCreateDate", new SelectList(Enum.GetValues(typeof(ESimSol.BusinessObjects.EnumCompareOperator))), new { id = "cboOrderCreateDate", style = "width: 97px;font-size:12px;", @class = "_select_changeA" })</td>
                                                            <td style="width:97px;font-size:12px;"><input type="text" id="txtStartOrderDate" value="" style="width: 108px;font-size:12px;" class="easyui-datebox" data-options="formatter:icsdateformat,parser:icsdateparser" /></td>
                                                            <td style="width:9px;font-size:12px;" id="enddateT">To</td>
                                                            <td style="width:97px;font-size:12px;" id="enddate"><input type="text" id="txtEndOrderDate" value="" style="width: 108px;font-size:12px;" class="easyui-datebox" data-options="formatter:icsdateformat,parser:icsdateparser" /></td>
                                                        </tr>
                                                    </table>
                                                </td>
                                            </tr>

                                            <tr style="height:137px; vertical-align:bottom">
                                                <td style=" text-align:left; width:330px;">
                                                    <table border="0" cellpadding="0" cellspacing="0">
                                                        <tr>
                                                            <td style=" text-align:left;"><input type="button" value="Reset" id="btnReset" onclick="Reset()" style="width:70px; text-align:left;" /></td>
                                                            <td style=" text-align:right; width:260px;"><input type="button" value="Search" id="btnRefresh" style="width:70px; text-align:right;" /></td>
                                                        </tr>
                                                    </table>
                                                </td>
                                            </tr>
                                        </table>
                                    </fieldset>
                                </td>
                                <td style="width:400px; vertical-align:top">
                                    <div style="margin-left:0px; margin-top:6px; height:265px">
                                        <table id="tblDyeingOrderDetailsList" title="Dyeing Order Detail List" class="easyui-datagrid" style="width:400px;height:295px" fitcolumns="false" rownumbers="true" pagination="false" singleselect="true" autorowheight="false">
                                            <thead>
                                                <tr>
                                                    <th field="JobNo" width="80">Order No</th>
                                                    <th field="BuyerName" width="100">Buyer Name</th>
                                                    <th field="ProductName" width="80">Product</th>
                                                    <th field="ColorName" width="70">Color</th>
                                                    <th field="YetToScheduleQty" align="right" width="60">Yet To Schedule</th>
                                                </tr>
                                            </thead>
                                        </table>
                                    </div>
                                </td>

                            </tr>
                        </table>
                    </td>
                </tr>
                <tr style="height:50px">
                    <td style="width:850px; text-align:right">
                        <a href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-ok" plain="true" onclick="OkButtonClick()">Ok</a>
                        <a href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-cancel" plain="true" onclick="SearchClose()">Close</a>
                    </td>
                </tr>
            </table>
        </div>
    </div>

    <div class="menuMainCollectionTable" id="divPS">
        <div class="easyui-panel" title="Production Schedule" style="font-family:Tahoma; width:100%; height:89%;">
            <fieldset style="width:98%;">
                <legend>Production Schedule </legend>
                <table style="width: 100%; font-size: 12px;" border="0">
                    <tr>
                        <td style="text-align:right; width:10%">Start Time:</td>
                        <td style="width:35%; text-align:left;">
                            <table border="0" cellpadding="0" cellspacing="0" width="100%">
                                <tr>
                                    <td style="width:100%">
                                    <div id="startDateTime" style="float:left; width:100%;">
                                        <span>
                                            <select id="cboYear"></select>
                                        </span>
                                        <span>
                                            <select id="cboMonth"></select>
                                        </span>
                                        <span>
                                            <select id="cboDay"></select>
                                        </span>
                                        <span>
                                            <select id="cboHour"></select>
                                        </span>
                                        <span>
                                            <select id="cboMinute"></select>
                                        </span>
                                    </div></td>
                                </tr>
                            </table>
                        </td>
                        <td style="width:10%">
                            <div>
                                <div style="float: left; width: 100%;">
                                </div>
                            </div>
                        </td>
                        <td style="text-align:right; width:10%">End Time:</td>
                        <td style="width:35%; text-align:left;">
                            <table border="0" cellpadding="0" cellspacing="0" width="100%">
                                <tr>
                                    <td style="width:100%">
                                        <div style="float: left; width:100%;">
                                            <span>
                                                <select id="cboEndYear"></select>
                                            </span>
                                            <span>
                                                <select id="cboEndMonth"></select>
                                            </span>
                                            <span>
                                                <select id="cboEndDay"></select>
                                            </span>
                                            <span>
                                                <select id="cboEndHour"></select>
                                            </span>
                                            <span>
                                                <select id="cboEndMinute"></select>
                                            </span>
                                        </div>
                                    </td>
                                </tr>
                            </table>
                        </td>
                    </tr>
                    <tr >
                        <td style="text-align:right; width:10%"></td>
                        <td style="width:35%;text-align:left;">
                            <div>
                                <div style="float: left; width:100%;">
                                    <span>
                                        <input type="button" id="btnScheduleLastTime" value="Default Time" style="font-size: 11px;width:80px;" />
                                    </span>
                                    <span>
                                        <input type="button" id="btnCurrenttime" value="Current Time" style="font-size: 11px;width:77px;" />
                                    </span>
                                    <span>
                                        <input id="timeSpinner" class="easyui-timespinner" style="width: 75px;font-size: 11px;" required="required"data-options="showSeconds:false" />
                                    </span>
                                    <span>
                                        <input type="button" id="btnAddSpinnerTime" value="Add" style="font-size: 11px; width:30px;" />
                                    </span>

                                </div>
                            </div>
                        </td>
                        <td style="width:10%">
                            <div>
                                <div style="float: left; width: 42%">
                                    <div style="float: right; padding-top: 2px; padding-right: 10px;">
                                    </div>
                                </div>
                                <div style="float: left; width: 58%">
                                    <select id="cboMachineType" onchange="ChangeOnlaocation('MachineType')" style="width: 115px">
                                        <option value='0'>All</option>
                                        <option value='1'>Cone</option>
                                        <option value='2'>Hank</option>
                                    </select>
                                </div>
                            </div>
                        </td>
                        <td style="text-align:right; width:10%">Order No</td>
                        <td style="width:35%;text-align:left;">
                            <div style="width:100%">
                                <div style="float: left; width:100%;">
                                    <select id="cboOrderType" style="width:100px;"></select>
                                    <input type="text" id="txtOrderNo" value="Order No" style="width:130px; font-size: 11px;"onclick="ClearJobNofield()" />
                                    <input id="btnOrder" type="button" value="S" style="font-size: 11px; height: 22px; width:28px;" />
                                </div>
                            </div>
                            <div id="regionCheckBox" style="padding-left: 5%;">
                                <div style="float: left; width: 30%">
                                    <input type="checkbox" id="ckboxRegular" onclick="checkRegular()" checked="true"
                                           style="width: 25px" />Regular
                                </div>
                                <div style="float: left; width: 50%">
                                    <input type="checkbox" id="ckboxBooking" onclick="checkBooking()" style="width: 25px" />Booking
                                </div>
                            </div>
                        </td>
                    </tr>

                    <tr>
                        <td style="text-align:right; width:10%">Location:</td>
                        <td style="width:35%; text-align:left;">
                            <table border="0" cellpadding="0" cellspacing="0" width="100%">
                                <tr>
                                    <td style="width:70%;">
                                        <select id="cboLocation" onchange="ChangeOnlaocation('Location')" style="width:79%;"></select>
                                    </td>
                                </tr>
                            </table>
                            
                        </td>
                        <td style="width:10%"></td>
                        <td style="text-align:right; width:10%">Color</td>
                        <td style="width:35%;text-align:left;">
                            <div>
                                <div style="float: left;width:100%">
                                    <select id="cboColor" style="width:67%;"></select>
                                    <span style=""><input id="btnAddJob" type="button" value="Add" style="width:10%; height:22px;" /></span>
                                </div>
                            </div>
                        </td>
                    </tr>
                </table>
            </fieldset>

            <table id="tblMachineSelection" class="easyui-datagrid" style="width:100%; height:358px;"
                   fitcolumns="false" rownumbers="true" pagination="false" singleselect="true" autorowheight="false"
                   toolbar="#toolbar" data-options="singleSelect: true, fitColumns:false, rownumbers:true,pagination:false, autoRowHeight:false,toolbar: '#toolbar',onClickRow: onClickRow ">
                <thead>
                    <tr>
                        <th data-options="field:'Selected',checkbox:true">
                        </th>
                        <th field="MachineName" width="145" height="25" align="left">
                            Machine Name
                        </th>
                        <th field="UsesWeight" width="60" align="right">
                            Weight
                        </th>
                      
                        <th data-options="field:'BatchNo',width:64,align:'right',editor:{type:'numberbox',options:{precision:0}}"align="right">
                            Continue
                        </th>
                        <th field="OrderNo" width="130" align="left">
                            Order No
                        </th>
                        <th data-options="field:'ProductionQty',width:90,align:'right',editor:{type:'numberbox',options:{precision:2}},formatter:formatPrice"
                            align="right">
                            YTS Qty
                        </th>
                        <th data-options="field:'Remarks',width:160,align:'right',editor:{type:'text'}" align="left">
                            Remarks
                        </th>
                        <th width="100" align="right" data-options="field:'YetToProductionQty',formatter:formatPrice">
                            YTP Qty
                        </th>
                        <th width="110" align="right" data-options="field:'WaitingForProductionQty',formatter:formatPrice">
                            Al. Scheduled Qty
                        </th>
                        <th field="BuyerName" min-width="180" align="left">
                            Buyer Name
                        </th>
                        <th field="ProductName" min-width="150" align="left">
                            Product Name
                        </th>
                        <th field="ColorName" min-width="130" align="left">
                            Color Name
                        </th>
                        <th field="Job" min-width="70" align="center" formatter="JobSelection">
                            Job
                        </th>
                    </tr>
                </thead>
            </table>
        </div>
        <fieldset style="height:8%">
            <legend style="font-weight: bold">Action : </legend>
            <table border="0" cellspacing="2" cellpadding="2" style="font-size: 11px; font-weight: bold; width:100%">
                <tr>
                    <td style="width:60%; text-align:right"></td>
                    <td style="width:40%;text-align:right;">
                        <a href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-save" plain="true" style=" height:22px;"onclick="Save()">Save</a>
                        <a id="btnClose" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-cancel" onclick="Close()" plain="true">Close</a>
                    </td>
                </tr>
            </table>
        </fieldset>
</div>
</body>
</html>
<script type="text/javascript">
    var _value ="";
    var _sBaseAddress="";
    var nProductionScheduleID=0;
    $(document).ready(function () {
        debugger;
        _sBaseAddress =@Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(HttpContext.Current.Session[SessionInfo.BaseAddress]));
        var oProductionSchedule =@Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(Model));
        var oLocations=  @Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(Model.LocationList));
        var oCapitalResources=  @Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(Model.CapitalResources));
        var eOrderTypes = @Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(ViewBag.OrderTypes));
        var dStratTime=@Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(TempData["StartTimeInString"]));
        $('#divPS').data("ProductionSchedule",oProductionSchedule);
        $('#divPS').data("CapitalResources",oCapitalResources);
        $('#divPS').data("LocationList",oLocations);
        $('#divPS').data("StartTime",dStratTime);
        $('#divPS').data('BuyerIDs',"");

        $("#progressbar").progressbar({ value: 0 });
        $("#progressbarParent").hide();
        document.getElementById('cboMachineType').style.display='none';
        document.getElementById('regionCheckBox').style.display='none';
        _sPSHeader = sessionStorage.getItem("ProductionScheduleHeader");
        Controll();
        SetDateTime();
        debugger;
        
        $('#timeSpinner').timespinner('setValue', '12:00');

        if(dStratTime!=null)
        {
            SetStartTime(new Date(dStratTime));
            AddTime(GenerateStartTimeInString());
        }
        else
        {
            var oDate=new Date();
            oDate.setMinutes(oDate.getMinutes()+5);
            SetStartTime(oDate);
            AddTime(GenerateStartTimeInString());
        }
        $("#cboLocation").icsLoadCombo({List: oLocations,OptionValue: "LocationID",DisplayText: "Name"});
        $("#cboOrderType").icsLoadCombo({List: eOrderTypes,OptionValue: "Value",DisplayText: "Text"});
        if(_sPSHeader=="Add New Schedule")
        {
            debugger;
            $('#tblMachineSelection').empty;
            var x= document.getElementById('cboLocation');
            x.disabled=true;
            var y= document.getElementById('cboMachineType');
            y.disabled=true;
            if(sessionStorage.getItem("DyeMachine")!=null)
            {
                var oDyeMachines=[];
                oDyeMachines.push(JSON.parse(sessionStorage.getItem("DyeMachine")));
                $("#cboLocation").val(oDyeMachines[0].LocationID);

                data=loadIntoGrid(oDyeMachines);
                data={"total":""+data.length+"","rows":data};
                $('#tblMachineSelection').datagrid('loadData',data);
            }
        }
        if(_sPSHeader=="View Schedule")
        {
            var x= document.getElementById('cboLocation');
            x.disabled=true;

            data=loadIntoGrid(oCapitalResources);
            data={"total":""+data.length+"","rows":data};
            $('#tblMachineSelection').datagrid('loadData',data);
        }
    });

    function Controll()
    {
        document.getElementById('cboEndYear').disabled=true;
        document.getElementById('cboEndMonth').disabled=true;
        document.getElementById('cboEndDay').disabled=true;
        document.getElementById('cboEndHour').disabled=true;
        document.getElementById('cboEndMinute').disabled=true;
    }

    function SetDateTime()
    {
        var oDate=new Date();

        /*---------------------------------------- Start Set Year-------------------------------------------*/
        var sYear="";
        sYear +="<option value='0'>"+'Year'+"</option>";
        for(var i=0; i<=10; i++)
        {
            sYear += "<option value='" + (parseInt(oDate.getFullYear()) + parseInt(i)) +"'>" + (parseInt(oDate.getFullYear()) + parseInt(i)) +"</option>";
        }
        $('#cboYear').html(sYear);
        $('#cboEndYear').html(sYear);
        /*---------------------------------------- End Set Year-------------------------------------------*/


        /*---------------------------------------- Start Set Month-------------------------------------------*/
        var sMonth="";
        var oMonths=['Jan','Feb','Mar','Apr','May','Jun','Jul','Aug','Sep','Oct','Nov','Dec'];
        sMonth +="<option value='0'>"+'Month'+"</option>";
        for(var i=0; i<oMonths.length; i++)
        {
            sMonth += "<option value='" +(parseInt(i)+1)+"'>" + oMonths[i] +"</option>";
        }
        $('#cboMonth').html(sMonth);
        $('#cboEndMonth').html(sMonth);
        /*---------------------------------------- End Set Month-------------------------------------------*/


        /*---------------------------------------- Start Set Date-------------------------------------------*/
        var sDay ="<option value='0'>"+'Day'+"</option>";
        $('#cboDay').html(sDay);
        $('#cboEndDay').html(sDay);
        /*---------------------------------------- End Set Date-------------------------------------------*/


        /*---------------------------------------- Start Set Hour-------------------------------------------*/
        var sHour="";
        sHour +="<option value='-1'>"+'hh'+"</option>";
        for(var i=0; i<24; i++)
        {
            if(i<10)
            {
                sHour += "<option value='" +i+"'>" + '0'+i+"</option>";
            }
            else
            {
                sHour += "<option value='" +i+"'>" + i+"</option>";
            }
        }
        $('#cboHour').html(sHour);
        $('#cboEndHour').html(sHour);
        /*---------------------------------------- End Set hour-------------------------------------------*/


        /*---------------------------------------- Start Set Minute-------------------------------------------*/
        var sMinute="<option value='-1'>"+'mm'+"</option>";
        $('#cboMinute').html(sMinute);
        $('#cboEndMinute').html(sMinute);
        /*---------------------------------------- End Set Minute-------------------------------------------*/

    }

    $('#cboYear').change(function(e)
    {
        var nYear=$('#cboYear').val();
        var nMonth=$('#cboMonth').val();
        if(nYear>0 && nMonth>0)
        {
            $('#cboDay').html(SetDateEvent(nYear, nMonth));
        }

    });

    $('#cboEndYear').change(function(e)
    {
        var nYear=$('#cboEndYear').val();
        var nMonth=$('#cboEndMonth').val();
        if(nYear>0 && nMonth>0)
        {
            $('#cboEndDay').html(SetDateEvent(nYear, nMonth));
        }

    });

    $('#cboMonth').change(function(e)
    {
        var nYear=$('#cboYear').val();
        var nMonth=$('#cboMonth').val();
        if(nYear>0 && nMonth>0)
        {
            $('#cboDay').html(SetDateEvent(nYear, nMonth));
        }

    });

    $('#cboEndMonth').change(function(e)
    {

        var nYear=$('#cboEndYear').val();
        var nMonth=$('#cboEndMonth').val();
        if(nYear>0 && nMonth>0)
        {
            $('#cboEndDay').html(SetDateEvent(nYear, nMonth));
        }

    });

    function SetDateEvent(nYear, nMonth)
    {

        var oDate=new Date();
        var sDay="";
        if( parseInt(nMonth)>0)
        {
            var nDay= new Date(parseInt(nYear), parseInt(nMonth), 0).getDate();
            sDay +="<option value='0'>"+'Day'+"</option>";
            for(var i=1; i<=parseInt(nDay); i++)
            {
                if(i<10)
                {
                    sDay += "<option value='" +i+"'>" + '0'+i +"</option>";
                }
                else
                {
                    sDay += "<option value='" +i+"'>" + i +"</option>";
                }

            }
        }
        return sDay;
    }

    $('#cboHour').change(function(e)
    {
        if($('#cboHour').val()>=0)
        {
            $('#cboMinute').html(SetMinuteEvent());
        }

    });

    $('#cboEndHour').change(function(e)
    {
        if($('#cboEndHour').val()>=0)
        {
            $('#cboEndMinute').html(SetMinuteEvent());
        }

    });

    function SetMinuteEvent()
    {
        var sMinute="";
        sMinute +="<option value='-1'>"+'mm'+"</option>";
        for(var i=0; i<=60; i++)
        {
            if(i<10)
            {
                sMinute += "<option value='" +i+"'>" +'0'+ i+"</option>";
            }
            else
            {
                sMinute += "<option value='" +i+"'>" + i+"</option>";
            }

        }
        return sMinute;
    }

    $('#cboMinute').change(function(e)
    {
        if($('#cboMinute').val()==60)
        {
            var nHour=$('#cboHour').val();
            nHour=parseInt(nHour)+1;
            $('#cboHour').val(nHour);
            $('#cboMinute').val(0);
        }

    });

    $('#cboEndMinute').change(function(e)
    {
        if($('#cboEndMinute').val()==60)
        {
            var nHour=$('#cboEndHour').val();
            nHour=parseInt(nHour)+1;
            $('#cboEndHour').val(nHour);
            $('#cboEndMinute').val(0);
        }

    });

    function SetStartTime(oDate)
    {
        debugger;
        var nyear=oDate.getFullYear();
        var nmonth=oDate.getMonth()+1;
        var nday=oDate.getDate();
        var nhour=oDate.getHours();
        var nminutes=oDate.getMinutes();
        $('#cboYear').val(nyear);
        $('#cboMonth').val(nmonth);
        $('#cboDay').html(SetDateEvent(nyear,nmonth));
        $('#cboDay').val(nday);
        $('#cboHour').val(nhour);
        $('#cboMinute').html(SetMinuteEvent());
        $('#cboMinute').val(nminutes);
    }

    function JobSelection()
    {
        var sButton= '<button style="Width:70px; height:18px" onclick="AddJobOrder()"><span style="font-size:10px;">Add Order</span></button>';
        return sButton;
    }

    function ValidationOfStartTime()
    {
        if($('#cboYear').val()==0)
        {
            alert("Please select a year of start time.");
            return false;
        }
        if($('#cboMonth').val()==0)
        {
            alert("Please select a month of start time.");
            return false;
        }
        if($('#cboDay').val()==0)
        {
            alert("Please select a day of start time.");
            return false;
        }
        if($('#cboHour').val()==-1)
        {
            alert("Please select hour of start time.");
            return false;
        }
        if($('#cboMinute').val()==-1)
        {
            alert("Please select minute of start time.");
            return false;
        }
        return true;
    }

    function AddTime(sDate)
    {
        var nhr=$('#timeSpinner').timespinner('getHours');
        var nmin=$('#timeSpinner').timespinner('getMinutes');
        if(isNaN(nhr))
        {
            nhr=0;
        }
        if(isNaN(nmin))
        {
            nmin=0;
        }

        var oDate=new Date(sDate);
        oDate.setHours(oDate.getHours()+nhr);
        oDate.setMinutes(oDate.getMinutes()+nmin);

        var nyear=oDate.getFullYear();
        var nmonth=oDate.getMonth()+1;
        var nday=oDate.getDate();
        var nhour=oDate.getHours();
        var nminutes=oDate.getMinutes();

        $('#cboEndYear').val(nyear);
        $('#cboEndMonth').val(nmonth);
        $('#cboEndDay').html(SetDateEvent(nyear,nmonth));
        $('#cboEndDay').val(nday);
        $('#cboEndHour').val(nhour);
        $('#cboEndMinute').html(SetMinuteEvent());
        $('#cboEndMinute').val(nminutes);

    }

    function dateTimeValidation()
    {

        if(ValidationOfStartTime())
        {
            var sStartTime= new Date(GenerateStartTimeInString());
            var sEndTime= new Date(GenerateEndTimeInString());

            if(new Date()>new Date(GenerateStartTimeInString()))
            {
                alert("Date time must be greater than current date time.");
                return false;
            }

            if(new Date(GenerateStartTimeInString())>=new Date(GenerateEndTimeInString()))
            {
                alert("End date time must be greater than start date time.");
                return false;
            }
            return true;
        }
        else
        {
            return false;
        }

    }

    function ChangeOnlaocation(sSearchBy)
    {
        debugger;
        var CapitalResources=[];
        var locationId= document.getElementById("cboLocation").value;
        var machineType= document.getElementById("cboMachineType").value;
        var oCapitalResources = $('#divPS').data("CapitalResources");
        if(oCapitalResources.length>0)
        {

            for (var i = 0; i < oCapitalResources.length; i++)
            {
                if (sSearchBy=='Location')
                {
                    document.getElementById("cboMachineType").value=0;
                    if(oCapitalResources[i].LocationID==locationId && oCapitalResources[i].IsActive==true)
                    {
                        CapitalResources.push(oCapitalResources[i]);
                    }
                }
                else if(sSearchBy=='MachineType')
                {
                    if(machineType==0)
                    {
                        if(oCapitalResources[i].LocationID==locationId && oCapitalResources[i].Status=='Active')
                        {
                            CapitalResources.push(oCapitalResources[i]);
                        }
                    }
                    else
                    {
                        if(oCapitalResources[i].LocationID==locationId && oCapitalResources[i].MachineType==machineType && oCapitalResources[i].Status=='Active')
                        {

                            CapitalResources.push(oCapitalResources[i]);

                        }
                    }
                }
            }
        }

        $('#tblMachineSelection').empty;
        data=loadIntoGrid(CapitalResources);
        data={"total":""+data.length+"","rows":data};
        $('#tblMachineSelection').datagrid('loadData',data);
    }

    function loadIntoGrid(CapitalResources)
    {
        var GridDataItems=[];

        for( var i=0;i<CapitalResources.length;i++)
        {

            GridDataItems[i] = {
                CRID                 :   CapitalResources[i].CRID,
                MachineName         :   CapitalResources[i].Name,
                LocationID          :   CapitalResources[i].LocationID,
                UsesWeight          :   CapitalResources[i].MachineCapacity,
                //                                UsesSpindleCount    :   CapitalResources[i].UsesSpindleCount,
                //                                UsesLiquorCapacity  :   CapitalResources[i].UsesLiquorCapacity,
                BatchNo             :   $('#divPS').data("ProductionSchedule").BatchNo
            };
        }
        return GridDataItems;
    }


    function checkRegular()
    {
        var oProductionSchedule = $('#divPS').data("ProductionSchedule")
        if(document.getElementById("ckboxRegular").checked==true)
        {
            document.getElementById("ckboxBooking").checked=false;
            oProductionSchedule.ScheduleType=true;
        }
        $('#divPS').data("ProductionSchedule",oProductionSchedule);
    }
    function checkBooking()
    {
        var oProductionSchedule = $('#divPS').data("ProductionSchedule")
        if(document.getElementById("ckboxBooking").checked==true)
        {
            document.getElementById("ckboxRegular").checked=false;
            oProductionSchedule.ScheduleType=false;
        }
        $('#divPS').data("ProductionSchedule",oProductionSchedule);
    }


    var editIndex = undefined;
    function endEditing()
    {
        if (editIndex == undefined)
        {
            return true;
        }
        if ($('#tblMachineSelection').datagrid('validateRow', editIndex))
        {

            $('#tblMachineSelection').datagrid('endEdit', editIndex);
            editIndex = undefined;
            return true;
        }
        else
        {
            return false;
        }

    }
    //debugger;
    function onClickRow(index)
    {

        if (editIndex != index){
            if (endEditing()){
                $('#tblMachineSelection').datagrid('selectRow', index)
                        .datagrid('beginEdit', index);
                editIndex = index;
            } else {
                $('#tblMachineSelection').datagrid('selectRow', editIndex);
            }
        }

    }
    function RefreshObject()
    {
        //debugger;
        var sDateTime=new Date(GenerateStartTimeInString());
        var eDateTime=new Date(GenerateEndTimeInString());
        var oProductions=[];
        var oScheduleDetail=$('#tblMachineSelection').datagrid('getSelected');
        oProductions.push(oScheduleDetail);
        var oProductionSchedule = {
            ProductionScheduleID          : nProductionScheduleID,
            MachineID                     : oScheduleDetail.CRID,
            BatchNo                       : oScheduleDetail.BatchNo,
            LocationID                    : $("#cboLocation").val(),
            BUID                          :sessionStorage.getItem('BUID'),
            ProductionQty                 : oScheduleDetail.ProductionQty,
            ScheduleType                  : oScheduleDetail.ScheduleType,
            StartTime	                  : sDateTime,
            EndTime                       : eDateTime,
            ProductionScheduleDetails     : oProductions
        };
        return oProductionSchedule;
    }
    //debugger;
    function Save()
    {
        //debugger;
     debugger;
        var nflag=1;
        if(!dateTimeValidation())return;
        endEditing();
        var oScheduleDetail=$('#tblMachineSelection').datagrid('getSelected');
        if(oScheduleDetail==null )
        {
            alert("Please select a machine from table to make a schedule.");
            return;
        }
        if(oScheduleDetail.OrderNo==null)
        {
            alert("Please, first select an order.");
            return;
        }
        var ntotalQuantity = (oScheduleDetail.BatchNo * oScheduleDetail.ProductionQty);
        if( ntotalQuantity<1)
        {
            alert("Number of yet to schedule must greater than zero.");
            return;
        }
        var oProductionSchedule=RefreshObject();
        var nts=(new Date()).getTime()/1000;
        $.ajax({
            type: "POST",
            dataType: "json",
            url: _sBaseAddress + "/ProductionSchedule/ScheduleInTimePeriod",
            data: JSON.stringify({oProductionSchedule:oProductionSchedule, nts: nts}),
            contentType: "application/json; charset=utf-8",
            success: function(data)
            {
                //debugger;
                nCount = jQuery.parseJSON(data);
                if (nCount>0)
                {
                    if(confirm("Are you sure to increase time from next all schedules."))
                    {
                        oProductionSchedule.bIncreaseTime=true;
                        SaveProductionSchedule(oProductionSchedule);
                    }
                }
                else if(nCount==0)
                {
                    oProductionSchedule.bIncreaseTime=false;
                    SaveProductionSchedule(oProductionSchedule);
                }

            },
            error: function(xhr, status, error)
            {
                alert(error);
            }
        });
    }


    function SaveProductionSchedule(oProductionSchedule)
    {
        $.ajax({
            type: "POST",
            dataType: "json",
            url : _sBaseAddress+  "/ProductionSchedule/Save_Batch",
            traditional: true,
            data:  JSON.stringify(oProductionSchedule),
            contentType: "application/json; charset=utf-8",
            success: function (data) {
             //debugger;
                oProductionSchedule = jQuery.parseJSON(data);
                if (oProductionSchedule.ErrorMessage=="")
                {
                    alert("Data Saved successfully");
                    var oProductionSchedules = sessionStorage.getItem("ProductionSchedules");
                    var nIndex = parseInt(sessionStorage.getItem("SelectedRowIndex"));
                    if (oProductionSchedules != null)
                    {
                        oProductionSchedules = jQuery.parseJSON(oProductionSchedules);
                    }
                    else
                    {
                        oProductionSchedules = [];
                    }
                    if (nIndex != -1)
                    {
                        oProductionSchedules[nIndex] = oProductionSchedule;
                    }
                    else
                    {
                        sessionStorage.setItem("SelectedRowIndex", oProductionSchedules.length);
                        oProductionSchedules.push(oProductionSchedule);
                    }
                    sessionStorage.setItem("ProductionSchedules", JSON.stringify(oProductionSchedules));
                    window.location.href = sessionStorage.getItem("BackLink");
                }
                else {
                    alert(oProductionSchedule.ErrorMessage);
                }
            },
            error: function (xhr, status, error) {
                alert(error);
            }


        });
    }

    function objectMaping(getobj)
    {
        debugger;
        var oProductionScheduleDetail;
        endEditing();
        // var nProductionQuantity= Number(getobj.YetToProductionQty)- Number(getobj.WaitingForProductionQty);
        var oCapitalResourceSelection= $('#tblMachineSelection').datagrid('getSelected');
        oProductionScheduleDetail=
                 {
                     MachineName              :  oCapitalResourceSelection.MachineName,
                     CRID                     :  oCapitalResourceSelection.CRID,
                     UsesWeight               :  oCapitalResourceSelection.UsesWeight,
                     //UsesSpindleCount         :  oCapitalResourceSelection.UsesSpindleCount,
                     //UsesLiquorCapacity       :  oCapitalResourceSelection.UsesLiquorCapacity,
                     ScheduleType             :  oCapitalResourceSelection.ScheduleType,
                     BatchNo                  :  oCapitalResourceSelection.BatchNo,
                     ProductionTracingUnitID  :  getobj.PTUID,
                     DODID                    :  getobj.DyeingOrderDetailID,
                     OrderNo                  :  getobj.JobNo,
                     ProductName              :  getobj.ProductName,
                     BuyerName                :  getobj.BuyerName,
                     ColorName                :  getobj.ColorName,
                     WaitingForProductionQty  :  getobj.WaitingForProductionQty,
                     YetToProductionQty       :  getobj.YetToProductionQty,
                     ProductionQty            :  getobj.YetToScheduleQty //nProductionQuantity
                 };
        return oProductionScheduleDetail;
    }

    function Close()
    {
        window.location.href = sessionStorage.getItem("BackLink");
    }

    function ClearJobNofield()
    {
        $("#txtOrderNo")[0].value='';
    }

    $('#txtOrderNo').keypress(function(e)
    {
        var code = (e.keyCode ? e.keyCode : e.which);
        if (code==13 )//Entrer =13
        {
            GetDyeingOrders();
        }
    });
    $('#btnOrder').click(function (e)
    {
        GetDyeingOrders();
    });

    function GetDyeingOrders()
    {
        debugger;
        var nOrderType=$("#cboOrderType").val();
        var sOrderNo=$("#txtOrderNo").val();
        if (nOrderType<=0)
        {
            alert('Please select Order Type.');
            $('#cboOrderType').focus();
            return;
        }
        var oDyeingOrder = {OrderNo:$.trim(sOrderNo),DyeingOrderType:nOrderType };
        var obj = {
            BaseAddress: _sBaseAddress,
            Object: oDyeingOrder,
            ControllerName: "DyeingOrder",
            ActionName: "GetsDyeingOrder",
            IsWinClose: false
        };
        $.icsDataGets(obj, function (response) {
            debugger;
            if (response.status && response.objs.length > 0) {
                if (response.objs[0].DyeingOrderID > 0) {
                    var tblColums = [];
                    var oColumn = { field: "OrderNo", title: "Order No", width: 80, align: "left" }; tblColums.push(oColumn);
                    oColumn = { field: "OrderDateSt", title: "Order Date", width: 150, align: "left" }; tblColums.push(oColumn);
                    oColumn = { field: "ContractorName", title: "Buyer", width: 100, align: "left" }; tblColums.push(oColumn);
                    oColumn = { field: "ExportPINo", title: "PI No", width: 40, align: "left" }; tblColums.push(oColumn);
                    var oPickerParam = {
                        winid: 'winDyeingOrderPicker',
                        winclass: 'clsDyeingOrderPicker',
                        winwidth: 450,
                        winheight: 460,
                        tableid: 'tblDyeingOrderPicker',
                        tablecolumns: tblColums,
                        datalist: response.objs,
                        multiplereturn: false,
                        searchingbyfieldName: 'OrderNo',
                        windowTittle: 'Dyeing Order List'
                    };
                    $.icsPicker(oPickerParam);
                    IntializePickerbutton(oPickerParam);
                }
                else {
                    alert(response.objs[0].ErrorMessage);
                }

            }else{
                alert("Data Not Found.");
            }
        });
    }
   
    function SetColor(nDyeingOrderID)
    {
        var oDyeingOrderDetail={
            DyeingOrderID: nDyeingOrderID
        }
        $.ajax({
            type: "POST",
            dataType: "json",
            url: _sBaseAddress + "/DyeingOrder/GetsDOD",
            traditional: true,
            data:  JSON.stringify(oDyeingOrderDetail),
            contentType: "application/json; charset=utf-8",
            success: function (data) {
                var oDyeingOrderDetails = jQuery.parseJSON(data);
                if(oDyeingOrderDetails.length>0 && (oDyeingOrderDetails[0].ErrorMessage==null || oDyeingOrderDetails[0].ErrorMessage==""))
                {
                    $("#cboColor").icsLoadCombo({List:oDyeingOrderDetails,OptionValue:"DyeingOrderDetailID",DisplayText:"ColorName"});
                }
                else
                {
                    alert(oDyeingOrderDetails[0].ErrorMessage);
                    $("#cboColor").icsLoadCombo({List: [],OptionValue: "DyeingOrderDetailID",DisplayText: "ColorName"});
                }
            },
            error: function (xhr, status, error) {
                alert(error);
            }
        });

    }


    $('#btnAddJob').click(function(e)
    {
        var oScheduleDetail=$('#tblMachineSelection').datagrid('getSelected');
        if(parseInt($('#cboColor').val())<=0)
        {
            alert("Please select from color.");
            return;
        }
        if(oScheduleDetail==null )
        {
            alert("Please select a machine from table to make a schedule.");
            return;
        }
        var nSelectedRowIndex=$('#tblMachineSelection').datagrid('getRowIndex',oScheduleDetail);
        var nts=(new Date()).getTime()/1000;
        $.ajax({
            type: "Get",
            dataType: "json",
            url: _sBaseAddress+ "/DyeingOrder/GetDOD",
            traditional: true,
            data:  {nID :parseInt($('#cboColor').val()), nts:nts},
            contentType: "application/json; charset=utf-8",
            success: function (data) 
            {
                var oDyeingOrderDetail= jQuery.parseJSON(data);
                if(oDyeingOrderDetail.DyeingOrderDetailID>0 && (oDyeingOrderDetail.ErrorMessage==null || oDyeingOrderDetail.ErrorMessage==""))
                {
                    oProductionScheduleDetail = jQuery.parseJSON(data);
                    var oScheduleDetail= objectMaping(oDyeingOrderDetail);
                    if(oScheduleDetail!=null)
                    {
                        $('#tblMachineSelection').datagrid('updateRow',{index: nSelectedRowIndex,	row: oScheduleDetail});
                        var rows = $('#tblMachineSelection').datagrid('getRows');
                        for(i=0;i<rows.length;++i)
                        {
                            if(rows[i]['IsActive']==true)
                            {
                                $('#tblMachineSelection').datagrid('checkRow',i);
                            }
                        }

                    }
                }
                else
                {
                    alert(oDyeingOrderDetail.ErrorMessage);
                }

            },
            error: function (xhr, status, error) {
                alert(error);
            }
        });
    });


    $('#btnCurrenttime').click(function(e)
    {
        var oDate=new Date();
        oDate.setMinutes(oDate.getMinutes()+5);
        SetStartTime(oDate);
        AddTime(GenerateStartTimeInString());
    });

    $('#btnScheduleLastTime').click(function(e)
    {
        SetStartTime(new Date($('#divPS').data("StartTime")));
        AddTime(GenerateStartTimeInString());
    });

    function GenerateStartTimeInString()
    {
        var sDate="";
        sDate= $('#cboMonth').val()+'/'+ $('#cboDay').val()+'/'+ $('#cboYear').val()+ ' '+ $('#cboHour').val()+':'+$('#cboMinute').val();
        return sDate;
    }

    function GenerateEndTimeInString()
    {
        var sDate="";
        sDate= $('#cboEndMonth').val()+'/'+ $('#cboEndDay').val()+'/'+ $('#cboEndYear').val()+ ' '+ $('#cboEndHour').val()+':'+$('#cboEndMinute').val();
        return sDate;
    }

    $('#btnAddSpinnerTime').click(function(e)
    {
        if(ValidationOfStartTime())
        {

            AddTime(GenerateStartTimeInString());
        }
    });

    function formatPrice(val,row)
    {

        if(parseFloat(val))
        {
            val=parseFloat(val);
            var test = val.toFixed(2);
            if (val < 0)
            {
                test=(-1*test);
            }
            var tests = addComma(test);
            if (val < 0)
            {
                return '<span style="color:red;">('+tests+')</span>';
            }
            else
            {
                return tests;
            }
        }

    }

    function addComma(nStr)
    {

        nStr += '';
        x = nStr.split('.');
        x1 = x[0];
        x2 = x.length > 1 ? '.' + x[1] : '';
        var rgx = /(\d+)(\d{3})/;
        while (rgx.test(x1)) {
            x1 = x1.replace(rgx, '$1' + ',' + '$2');
        }
        return x1 + x2;
    }

    //Add Order start
    function AddJobOrder()
    {
        $("#winDyeingOrderDetailAdvanceSearch").icsWindow('open', "Advance Search");
        $("#winDyeingOrderDetailAdvanceSearch input").not("input[type='button']").val("");
        $("#winDyeingOrderDetailAdvanceSearch select").val(0);
        SetTodayDate();
        Reset();
     }

    function SetTodayDate()
    {
        $('#txtStartOrderDate').datebox('setValue', icsdateformat(new Date()));
        $('#txtEndOrderDate').datebox('setValue', icsdateformat(new Date()));
    }

    $('._select_changeA').change(function () {
        //debugger;
        var x = $("#cboOrderCreateDate").val();
        if (x == "EqualTo" || x == "NotEqualTo" || x == "GreaterThen" || x == "SmallerThen") {
            document.getElementById("enddate").style.display = 'none';
            document.getElementById("enddateT").style.display = 'none';
        }
        else {
            document.getElementById("enddate").style.display = '';
            document.getElementById("enddateT").style.display = '';
        }
        if (x == "None")
        {

            $('#txtStartOrderDate').datebox('setValue', icsdateformat(new Date()));
            $('#txtEndOrderDate').datebox('setValue', icsdateformat(new Date()));
        }
    });

    ///Contractor Pick
    $("#txtBuyerName").keydown(function (e) {
        debugger;
        var code = (e.keyCode ? e.keyCode : e.which);
        if (code == 13) // Enter Press
        {
            GetBuyers();
        }if (code == 8) //backspace=8
        {
            //debugger;
            $("#txtBuyerName").removeClass("fontColorOfPickItem");
            $('#divPS').data('BuyerIDs',"");
        }
    });
    $("#btnBuyerPicker").click(function () {
        
        GetBuyers();
    });
    
    function GetBuyers()
    {
        debugger;
        var oContractor = { Params: "2~"+$('#txtBuyerName').val()+'~'+sessionStorage.getItem('BUID') };
        var obj = {
            BaseAddress: _sBaseAddress,
            Object: oContractor,
            ControllerName: "Contractor",
            ActionName: "ContractorSearchByNameType",
            IsWinClose: false
        };
        $("#progressbar").progressbar({ value: 0 });
        $("#progressbarParent").show();
        var intervalID = setInterval(updateProgress, 250);
        $.icsDataGets(obj, function (response) {
            debugger;
            clearInterval(intervalID);
            $("#progressbarParent").hide();
            if (response.status && response.objs.length > 0) {
                if (response.objs[0].ContractorID > 0) {
                    var tblColums = []; var oColumn = { field: "Name", title: "Name", width: 200, align: "left" }; tblColums.push(oColumn);
                    oColumn = { field: "Address", title: "Address", width: 120, align: "left" }; tblColums.push(oColumn);
                    oColumn = { field: "Email", title: "Email", width: 90, align: "left" }; tblColums.push(oColumn);
                    oColumn = { field: "ShortName", title: "Short Name", width: 90, align: "left" }; tblColums.push(oColumn);
                    var oPickerParam = {
                        winid: 'winContractors',
                        winclass: 'clsContractor',
                        winwidth: 600,
                        winheight: 460,
                        tableid: 'tblContractors',
                        tablecolumns: tblColums,
                        datalist: response.objs,
                        multiplereturn: true,
                        searchingbyfieldName: 'Name',
                        windowTittle: 'Buyer List'
                    };
                    $.icsPicker(oPickerParam);
                    IntializePickerbutton(oPickerParam);
                }
                else { alert(response.objs[0].ErrorMessage); }
            }else{
                alert("Data Not Found.");
            }
        });
    }

    $('#btnRefresh').click(function (){
        debugger;
        var sOrderNo= $("#txtDyeingOrderNo").val();
        var cboOrderCreateDate = document.getElementById("cboOrderCreateDate");
        var nOrderCreateDate=cboOrderCreateDate.options[cboOrderCreateDate.selectedIndex].index;
        var dOrderDateStart=$('#txtStartOrderDate').datebox('getValue');
        var dOrderDateEnd=$('#txtEndOrderDate').datebox('getValue');
        if(nOrderCreateDate==0 && sOrderNo=="" &&  $('#divPS').data('BuyerIDs') =="")
        {
            alert('Please Select a Search Criteria');
            return false;
        }
        var sTempString = nOrderCreateDate+'~'+dOrderDateStart+'~'+dOrderDateEnd+'~'+sOrderNo+'~'+ $('#divPS').data('BuyerIDs')+'~'+ sessionStorage.getItem('BUID');
        $.ajax({
            type: "GET",
            dataType: "json",
            url: '@Url.Action("DODetailsSearch", "DyeingOrder")',
            data: { Temp: sTempString },
            contentType: "application/json; charset=utf-8",
            success: function (data) {
                ////debugger;
                oDyeingOrderDetails = jQuery.parseJSON(data);
                if (oDyeingOrderDetails != null) {
                    if(oDyeingOrderDetails.length>0)
                    {
                        RefreshListForSearch(oDyeingOrderDetails);
                    }
                    else
                    {
                        alert("Data not found!!");
                        RefreshListForSearch([]);
                    }
                }
            },
            error: function (xhr, status, error) {
                alert(error);
            }
        });

    });

    function Reset() {
        debugger;
        $("#txtDyeingOrderNo,#txtBuyerName").val('');
        document.getElementById("enddate").style.display = '';
        document.getElementById("enddateT").style.display = '';
        $('#cboOrderCreateDate').val('None');
        SetTodayDate();
        data ="";
        data={"total":""+data.length+"","rows":data};
        $('#tblDyeingOrderDetailsList').datagrid('loadData',data);
        $("#txtBuyerName").removeClass("fontColorOfPickItem");
        $('#divPS').data('BuyerIDs',"");
      
    }

    function IntializePickerbutton(oPickerobj) {
        debugger;
        $("#" + oPickerobj.winid).find("#btnOk").click(function () {
            debugger;
            //for Single Select
            PickerEvents(oPickerobj);
        });
        $(document).find('.' + oPickerobj.winclass).keydown(function (e) {
            if (e.which == 13)//enter=13
            {
                PickerEvents(oPickerobj);
            }
        });
    }
    function PickerEvents(oPickerobj) {
        var oreturnobj = null, oreturnobjs = [];
        if (oPickerobj.multiplereturn)
        {
            oreturnobjs = $('#' + oPickerobj.tableid).datagrid('getChecked');
        } else
        {
            oreturnobj = $('#' + oPickerobj.tableid).datagrid('getSelected');
        }

        $("#" + oPickerobj.winid).icsWindow("close");
        $("#" + oPickerobj.winid).remove();
        if (oPickerobj.winclass == 'clsContractor')
        {
            $('#divPS').data('BuyerIDs',"");
            var sBuyerIDs = "";
            if (oPickerobj.multiplereturn)
            {
                var ncount = 0;
                for (var i = 0; i <oreturnobjs.length; i++) {
                    var nSupplierID = oreturnobjs[i].ContractorID;
                    sBuyerIDs = sBuyerIDs + nSupplierID + ',';
                    ncount++;
                }
                if (ncount > 1)
                {
                    $('#txtBuyerName').val("Select " + ncount + " Buyer's");
                } else
                {
                    $('#txtBuyerName').val(oreturnobjs[0].Name);
                }
                sBuyerIDs = sBuyerIDs.substring(0, sBuyerIDs.length - 1);

            } else
            {
                $('#txtBuyerName').val(oreturnobj.Name);
                sBuyerIDs = "" + oreturnobj.ContractorID + "";
                $('#txtBuyerName').focus();
            }
            $("#txtBuyerName").addClass("fontColorOfPickItem");
            $('#divPS').data('BuyerIDs',sBuyerIDs);
        }else   if (oPickerobj.winid == 'winDyeingOrderPicker')
        {
            if (oreturnobj != null && parseInt(oreturnobj.DyeingOrderID) > 0)
            {
                debugger;
                $('#txtOrderNo').addClass('fontColorOfPickItem');
                $('#txtOrderNo').val(oreturnobj.OrderNo);
                $('#cboColor').focus();
                SetColor(oreturnobj.DyeingOrderID);
            }
        }
    }
    function RefreshListForSearch(oSameOrders)
    {
        data =oSameOrders;
        data={"total":""+data.length+"","rows":data};
        $('#tblDyeingOrderDetailsList').datagrid('loadData',data);

    }

    function SearchClose()
    {
        $("#winDyeingOrderDetailAdvanceSearch").icsWindow('close');
    }

    function OkButtonClick() {
        debugger;
        var oDyeingOrderDetail = $('#tblDyeingOrderDetailsList').datagrid('getSelected');
        if(oDyeingOrderDetail.DyeingOrderDetailID<=0)
        {
            alert("please select at least one item");
            return;
        }
        var oScheduleDetail= objectMaping(oDyeingOrderDetail);
        var oProductionSchedule= $('#tblMachineSelection').datagrid('getSelected');
        var SelectedRowIndex=$('#tblMachineSelection').datagrid('getRowIndex',oProductionSchedule);
        if(oScheduleDetail!=null)
        {
            $('#tblMachineSelection').datagrid('updateRow',{index: SelectedRowIndex,	row: oScheduleDetail});
            var rows = $('#tblMachineSelection').datagrid('getRows');
            for(i=0;i<rows.length;++i)
            {
                if(rows[i]['IsActive']==true)
                {
                    $('#tblMachineSelection').datagrid('checkRow',i);
                }
            }
        }
        $("#winDyeingOrderDetailAdvanceSearch").icsWindow('close');
    }

    //Add Order End
    function updateProgress() 
    {
        var value =$('#progressbar').progressbar('getValue');
        if (value < 96){
            value += Math.floor(Math.random() * 10);
            $('#progressbar').progressbar('setValue', value);
        }
    }
    function hideShow(miliseconds) {
        $("#progressbarParent").hide();
    }
</script>
