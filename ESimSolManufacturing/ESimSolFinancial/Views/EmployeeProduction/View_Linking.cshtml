<!DOCTYPE HTML>
<html>
<head>
    <title>Linking Issue & Receive</title>
    <link href="@Url.Content("~/Content/CSS/icon.css")" rel="stylesheet" type="text/css" />
    <link href="@Url.Content("~/Content/CSS/easyui.css")" rel="stylesheet" type="text/css" />
    <link href="@Url.Content("~/Content/CSS/Pikerstyle.css")" rel="stylesheet" type="text/css" />
    <script src="@Url.Content("~/Scripts/jquery-1.7.1.min.js")" type="text/javascript"></script>
    <script src="@Url.Content("~/Scripts/jquery.ics.customize.js")" type="text/javascript"></script>
    <script src="@Url.Content("~/Scripts/jquery.easyui.min.js")" type="text/javascript"></script>
    <script src="@Url.Content("~/Scripts/jquery-ui.min.js")" type="text/javascript"></script>
    <script src="@Url.Content("~/Scripts/json2.js")" type="text/javascript"></script>
</head>
<body>

    @model IEnumerable<ESimSol.BusinessObjects.EmployeeProduction>
        <table border="0" cellspacing="0" cellpadding="0">
            <tr>
                <td style="background-color: #cfb53b; text-align: center; width: 1200px; color: White">
                    <label id="lblHeader" style="font-size:20px; font-weight: bold; text-decoration: Underline; font-family:Tahoma">
                        Linking Issue & Receive
                    </label>
                </td>
            </tr>

        </table>
        <div style="margin-left:0px; height:452px; font-family:Tahoma">
            <table id="tblLinkingList" class="easyui-datagrid" style="width:1200px;height:452px;" fitcolumns="false" rownumbers="true" pagination="false" singleselect="true" autorowheight="false" toolbar="#toolbar">

                @*<table id="tblLinkingList" class="easyui-datagrid" style="width: 1200px; height: 452px;"
                    fitcolumns="false" pagination="false" singleselect="true" autorowheight="false"
                    toolbar="#toolbar" data-options="singleSelect: false, fitColumns:false,  rownumbers:true,pagination:false,autoRowHeight:false, toolbar: '#toolbar1', onClickRow: onClickRow">*@
                <thead>
                    <tr>
                        <th field="IssueDateInString" width="80" align="center">Issue Date</th>
                        <th field="MachineNo" width="50" align="center">M. No</th>
                        <th field="EmployeeNameCode" width="200" align="left">Employee</th>
                        <th field="ReferenceEPSNo" width="105" align="left">KT TC No</th>
                        <th field="EPSNO" width="105" align="left">LN TC No</th>
                        <th field="IssueQty" width="60" align="center">Issue(Pcs)</th>
                        <th field="RcvQty" width="55" align="center">Rcv(Pcs)</th>
                        @*<th id="rcvqty" data-options="field:'RcvQty',width:55,align:'right',editor:{type:'numberbox',options:{precision:0}}" align="center">Rcv(Pcs)</th>*@
                        <th field="EmpWiseBalanceQty" width="75" align="center">Balance(Pcs)</th>
                        <th field="RcvByDateInString" width="80" align="center">Receive Date</th>
                        <th field="StyleNo" width="110" align="center">Style</th>
                        <th field="ColorName" width="100" align="center">Color</th>
                        <th field="SizeCategoryName" width="50" align="center">Size</th>
                        <th field="GPName" width="60" align="center">B. Part</th>
                        <th field="ActivityStatus" width="50" align="center">Activity</th>
                    </tr>
                </thead>
            </table>
            ​<table style="font-size : 12px; font-family:Tahoma;">
                <tr>
                    <td>
                        Load <input id="txtLoadRecords" type="text" style="width:70px" />  &nbsp; Records &nbsp; &nbsp;
                        <label id="lblcount"></label>
                        <a href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-ok" plain="true" onclick="Next()">Next</a>
                        &nbsp;&nbsp;&nbsp;<label id="lblTotal"></label>
                    </td>

                </tr>
            </table>
            <div id="toolbar" style="height : 75px;">

                <!--Knit. TC No : <input id="txtKnittingTC" type="text" style="width:130px; " placeholder="Type TC No & Enter"  />&nbsp;-->
                @*Style : <input id="txtStyle" type="text" style="width:115px; " placeholder="Type style & enter" />&nbsp;*@
                <input id="txtOrderRecapPickerByStyle" type="text" style="width:140px;" placeholder="Type StyleNo & Enter" />
                <input id="btnOrderRecapPickerByStyle" type="button" value="P" />&nbsp;
                <!--Knit. Serial No :  <input id="txtKnitSerialNo" type="text" style="width:130px; " placeholder="Type serial & enter" />&nbsp;-->
                <input id="txtMNo" type="text" style="width:40px; " placeholder="M. No" />&nbsp;
                Color With Size : <select id="cboColorWithSize" style="width:120px;"></select>  &nbsp;
                <!--Color : <input id="txtColor" type="text" style="width:120px; "   disabled="disabled"/>&nbsp;
                Size : <input id="txtSize" type="text" style="width:61px; " disabled="disabled" />&nbsp;-->
                Body Part :  <select id="cboStyleWiseBodyPart" style="width:90px;"></select>
                @*@Html.DropDownList("cboGarmentPart", new SelectList(Enum.GetValues(typeof(ICS.Base.Client.Utility.EnumGarmentPart))), new { id = "cboGarmentPart", style = "width: 133px;" })&nbsp;*@
                <!--Lin. Emp. : --> <input id="txtLinEmpCode" type="text" style="width:150px;" placeholder="Type Emp. Code & Enter" onclick="LinEmpClear()" />
                <input id="btnLinEmployeePicker" type="button" value="P" />&nbsp;
                @*Block : <input id="txtBlock" type="text" style="width:70px; "  />&nbsp;*@
                <input id="txtIssueReceiveQty" type="text" style="width:40px; " placeholder="Qty." />&nbsp;
                <input id="dtDate" type="text" style="width: 100px" class="easyui-datebox" required="required" data-options="formatter:icsdateformat" />&nbsp;

                <a id="btnIssueReceive" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-save" plain="true">Issue & Rcv.</a>
                <a id="btnPrint" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-print" plain="true">Print</a>

                <br />
                <hr />
                <input id="chkIssueDateWise" type="checkbox" />Issue Date Wise
                <input id="chkReceiveDateWise" type="checkbox" />Rcv. Date Wise
                @*<input id="txtSearchByReferenceEPSNo" type="text" style="width:130px; " placeholder="Type Ref. PSNo & Enter"  />&nbsp;&nbsp;
                    <input id="txtSearchByPSNo" type="text" style="width:130px; " placeholder="Type TCNo & Enter"  />&nbsp;*@
                <input id="dtDateFrom" type="text" style="width: 95px;" class="easyui-datebox" required="required" data-options="formatter:icsdateformat" />&nbsp; To &nbsp;
                <input id="dtDateTo" type="text" style="width: 95px" class="easyui-datebox" required="required" data-options="formatter:icsdateformat" />&nbsp;&nbsp;
                <input id="txtCode" type="text" style="width:140px;" placeholder="Type Code & Enter" onclick="EmpClear()" />
                <input id="btnEmployeePicker" type="button" value="P" />
                @*@Html.DropDownList("cboGarmentPartForsearch", new SelectList(Enum.GetValues(typeof(ICS.Base.Client.Utility.EnumGarmentPart))), new { id = "cboGarmentPartForsearch", style = "width: 100px;" })*@
                <select id="cboGarmentPartForsearch" style="width:100px;"></select>
                <select id="cboSize" style="width:50px;"></select>
                <input id="txtOrderRecapPickerByStyleForSearch" type="text" style="width:130px;" placeholder="Type styleNo & enter" />
                <input id="btnOrderRecapPickerByStyleForSearch" type="button" value="P" />
                <input id="chkLoginUser" type="checkbox" checked="checked" />Login User
                <a id="btnSearchByCodeNo" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-search" plain="true" onclick="SearchWithPasignation()"></a>

                @*<a id="btnEdit" href="javascript:void(0)" class="easyui-linkbutton" iconCls="icon-edit" plain="true" >Edit</a>*@
                @*<a id="btnApprove" href="javascript:void(0)" class="easyui-linkbutton" iconCls="icon-ok" plain="true" >Approve</a>*@
                @*<a id="btnRePrint" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-print" plain="true">RePrint</a>*@
                @*<a id="btnDelete" href="javascript:void(0)" class="easyui-linkbutton" iconCls="icon-remove" plain="true" >Delete</a>*@
                @*<a id="btnTransfer" href="javascript:void(0)" class="easyui-linkbutton" iconCls="icon-ok" plain="true" >Transfer</a>*@
                @*<a id="btnActivity" href="javascript:void(0)" class="easyui-linkbutton" iconCls="icon-ok" plain="true" >Inactive</a>*@
                @*<a id="btnSave" href="javascript:void(0)" class="easyui-linkbutton" iconCls="icon-save" plain="true" >R. Save</a>*@
                <a id="btnAdvanceEdit" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-edit" plain="true">Adv. Edit</a>

            </div>
        </div>
</body>
</html>
<script type="text/javascript">
    var _oLinkingLists=[];
    var _sBaseAddress="";
    var _obj=null;
    var _sPSNo="";
    var _oEmployee = null;
    var _oLinking = null;
    var _nRQty = 0;
    var _bFlag = 0;
    //var _nReferenceEPSID = 0;
    var _nOrderRecapDetailID = 0;
    var _bFlag1 = true;
    var _nEmployeeID = 0;
    var _nEPSID = 0;
    var _nLoadRecords = 0;
    var _nRowLength = 0;
    var _bNext = false;
    var _nLastEPSID = 0;
    var _oEmployeeProductions = [];
    var _nTechnicalSheetID =0;
    var _sStyleNoForSearch ="";
    var _sStyleNo = 0;
    var _nOrderRecapID = 0;

    $(document).ready(function ()
    {
        _oLinkingLists =@Html.Raw( new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(Model));
        _sBaseAddress =@Html.Raw( new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(HttpContext.Current.Session[SessionInfo.BaseAddress]));
        var bAdvanceEdit =@Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(TempData["AdvanceEdit"]));

        _obj = window.dialogArguments;
        $('#txtLoadRecords').numberbox({min:0, precision:0 });
        $('#txtLoadRecords').numberbox('setValue',100);
        $('#dtDate').datebox('setValue', icsdateformat(new Date()));
        $('#dtDateFrom').datebox('setValue', icsdateformat(new Date()));
        $('#dtDateTo').datebox('setValue', icsdateformat(new Date()));
        //SetEPSNO();
        LoadGarmentPart();
        LoadSize();
        if(bAdvanceEdit==false)
        {
            document.getElementById("btnAdvanceEdit").style.display='none';
        }
        //$("#txtKnittingTC").focus();
        $("#txtOrderRecapPickerByStyle").focus();
    });

    function LoadGarmentPart()
    {
        debugger

        var listItems="";
        listItems += "<option value=0>" +"None" +"</option>";
        for (i = 0; i < _oLinkingLists[0].GarmentParts.length; i++)
        {
            listItems += "<option value='" + _oLinkingLists[0].GarmentParts[i].GPID+"'>" + _oLinkingLists[0].GarmentParts[i].Name+"</option>";
        }
        $("#cboGarmentPartForsearch").html(listItems);
    }

    $('#txtOrderRecapPickerByStyle').keypress(function (e)
    {

        var code = (e.keyCode ? e.keyCode : e.which);
        var sStyleNo = document.getElementById("txtOrderRecapPickerByStyle").value;

        if (code == 13)//Enter key-13
        {
            if(sStyleNo=="")
            {
                alert("Please Enter Style No !");
                return;
            }

            var oParameter = new Object();
            oParameter.Name = "Style Picker";
            oParameter.MultipleItemReturn=false;
            var tsv=((new Date()).getTime())/1000;
            var url =_sBaseAddress+ "/OrderRecap/OrderRecapPickerByStyleNo?sStyleNo="+sStyleNo+"&ts="+tsv;
            var oSelectedOrder = window.showModalDialog(url, oParameter, 'dialogHeight:385px;dialogWidth:453px;dialogLeft:350;dialogTop:100;center:yes;resizable:no;status:no;scroll:no');

            if(oSelectedOrder != null)
            {

                $("#txtOrderRecapPickerByStyle").val(oSelectedOrder.StyleNo);
                _sStyleNo = oSelectedOrder.StyleNo;
                _nOrderRecapID = oSelectedOrder.OrderRecapID;
                GetOrderRecapDetail();
                GetStyleWiseBodyPart();
            }
        }
    });

    $('#btnOrderRecapPickerByStyle').click(function (e)
    {

        var sStyleNo = "";
        var oParameter = new Object();
        oParameter.Name = "OrderRecap Picker";
        oParameter.MultipleItemReturn=false;
        var tsv=((new Date()).getTime())/1000;
        var url =_sBaseAddress+ "/OrderRecap/OrderRecapPickerByStyleNo?sStyleNo="+sStyleNo+"&ts="+tsv;
        var oSelectedOrder = window.showModalDialog(url, oParameter, 'dialogHeight:385px;dialogWidth:453px;dialogLeft:350;dialogTop:100;center:yes;resizable:no;status:no;scroll:no');

        if(oSelectedOrder != null)
        {
            $("#txtOrderRecapPickerByStyle").val(oSelectedOrder.StyleNo);
            _sStyleNo = oSelectedOrder.StyleNo;
            _nOrderRecapID = oSelectedOrder.OrderRecapID;
            GetOrderRecapDetail();
            GetStyleWiseBodyPart();
        }

    });

    function GetOrderRecapDetail()
    {
        var tsv=((new Date()).getTime())/1000;
        $.ajax({
            type: "POST",
            dataType: "json",
            url: _sBaseAddress + "/OrderRecap/GetOrderRecapDetailByOrderID",
            traditional: true,
            data: JSON.stringify({nOrderRecapID : _nOrderRecapID, ts : tsv}),
            contentType: "application/json; charset=utf-8",

            success: function(data)
            {
                var oSelectedOrderDetails=[];
                oSelectedOrderDetails = jQuery.parseJSON(data);

                if (oSelectedOrderDetails.length>0 && oSelectedOrderDetails[0].ErrorMessage=="")
                {

                    LoadColorAndSize(oSelectedOrderDetails);
                }
                else
                {

                    alert(oSelectedOrderDetails[0].ErrorMessage);
                    $("#cboColorWithSize").empty();
                }
            },
            error: function(xhr, status, error)
            {
                alert(error);
            }
        });

    }

    function GetStyleWiseBodyPart()
    {
        var tsv=((new Date()).getTime())/1000;
        $.ajax({
            type: "POST",
            dataType: "json",
            url: _sBaseAddress + "/TechnicalSheet/GetStyleWiseBodyPart",
            traditional: true,
            data: JSON.stringify({sStyleNo : _sStyleNo, ts : tsv}),
            contentType: "application/json; charset=utf-8",

            success: function(data)
            {
                var oTechnicalSheetBodyParts=[];
                oTechnicalSheetBodyParts = jQuery.parseJSON(data);
                if (oTechnicalSheetBodyParts.length>0 && oTechnicalSheetBodyParts[0].ErrorMessage=="")
                {

                    LoadStyleWiseBodyPart(oTechnicalSheetBodyParts)
                }
                else
                {
                    alert(oTechnicalSheetBodyParts[0].ErrorMessage);
                    $("#cboStyleWiseBodyPart").empty();
                }
            },
            error: function(xhr, status, error)
            {
                alert(error);
            }
        });
    }

    function LoadColorAndSize(oSelectedOrderDetails)
    {
        $("#cboColorWithSize").empty();

        var listItems="";
        listItems += "<option value=0>" +"--None--" +"</option>";
        for (i = 0; i < oSelectedOrderDetails.length; i++)
        {
            listItems += "<option value='" + oSelectedOrderDetails[i].OrderRecapDetailID+"'>" + oSelectedOrderDetails[i].ColorAndSizeInString+"</option>";
        }
        $("#cboColorWithSize").html(listItems);
    }

    function LoadStyleWiseBodyPart(oTechnicalSheetBodyParts)
    {
        $("#cboStyleWiseBodyPart").empty();
        var listItems="";
        listItems += "<option value=0>" +"--None--" +"</option>";
        for (i = 0; i < oTechnicalSheetBodyParts.length; i++)
        {
            listItems += "<option value='" + oTechnicalSheetBodyParts[i].GPID+"'>" + oTechnicalSheetBodyParts[i].GPName+"</option>";
        }
        $("#cboStyleWiseBodyPart").html(listItems);
    }

    //$('#txtStyle').keypress(function (e)
    //{
    //    var code = (e.keyCode ? e.keyCode : e.which);
    //    var sStyleNo = document.getElementById("txtStyle").value;
    //    if (code == 13)//Enter key-13
    //    {
    //        if(sStyleNo=="")
    //        {
    //            alert("Please Enter Style No !");
    //            return;
    //        }

    //        var oParameter = new Object();
    //        oParameter.Name = "Style Picker";
    //        oParameter.MultipleItemReturn=false;
    //        var tsv=((new Date()).getTime())/1000;
    //        var url =_sBaseAddress+ "/TechnicalSheet/StylePickerByName?sStyleNo="+sStyleNo+"&ts="+tsv;
    //        var oSelectedStyle = window.showModalDialog(url, oParameter, 'dialogHeight:385px;dialogWidth:453px;dialogLeft:350;dialogTop:100;center:yes;resizable:no;status:no;scroll:no');

    //        if(oSelectedStyle != null)
    //        {
    //            _nTechnicalSheetID = oSelectedStyle.TechnicalSheetID;
    //            $("#txtStyle").val(oSelectedStyle.StyleNo);
    //        }
    //    }
    //});

    $('#txtOrderRecapPickerByStyleForSearch').keypress(function (e)
    {

        var code = (e.keyCode ? e.keyCode : e.which);
        var sStyleNo = document.getElementById("txtOrderRecapPickerByStyleForSearch").value;

        if (code == 13)//Enter key-13
        {
            if(sStyleNo=="")
            {
                alert("Please Enter Style No !");
                return;
            }

            var oParameter = new Object();
            oParameter.Name = "Style Picker";
            oParameter.MultipleItemReturn=false;
            var tsv=((new Date()).getTime())/1000;
            var url =_sBaseAddress+ "/OrderRecap/OrderRecapPickerByStyleNo?sStyleNo="+sStyleNo+"&ts="+tsv;
            var oSelectedOrder = window.showModalDialog(url, oParameter, 'dialogHeight:385px;dialogWidth:453px;dialogLeft:350;dialogTop:100;center:yes;resizable:no;status:no;scroll:no');

            if(oSelectedOrder != null)
            {

                $("#txtOrderRecapPickerByStyleForSearch").val(oSelectedOrder.StyleNo);
                _sStyleNoForSearch ="'"+ oSelectedOrder.StyleNo+"'";

            }
        }
    });

    $('#btnOrderRecapPickerByStyleForSearch').click(function (e)
    {

        var sStyleNo = "";
        var oParameter = new Object();
        oParameter.Name = "OrderRecap Picker";
        oParameter.MultipleItemReturn=false;
        var tsv=((new Date()).getTime())/1000;
        var url =_sBaseAddress+ "/OrderRecap/OrderRecapPickerByStyleNo?sStyleNo="+sStyleNo+"&ts="+tsv;
        var oSelectedOrder = window.showModalDialog(url, oParameter, 'dialogHeight:385px;dialogWidth:453px;dialogLeft:350;dialogTop:100;center:yes;resizable:no;status:no;scroll:no');

        if(oSelectedOrder != null)
        {
            $("#txtOrderRecapPickerByStyleForSearch").val(oSelectedOrder.StyleNo);
            _sStyleNoForSearch ="'"+ oSelectedOrder.StyleNo+"'";
        }

    });

    //function SetEPSNO()
    //{
    //    var date = new Date();
    //    var y = date.getFullYear();
    //    var m = date.getMonth()+1;
    //    var d = date.getDate();

    //    if(m<10)
    //    {
    //        m = "0"+m;
    //    }
    //    if(d<10)
    //    {
    //        d = "0" + d;
    //    }
    //    var Year = y.toString();
    //    Year=Year.substring(Year.length-2,Year.length);

    //    document.getElementById("txtSearchByPSNo").value = "LN"+Year+m+d;
    //    document.getElementById("txtKnittingTC").value = "KT"+Year+m+d;
    //    document.getElementById("txtSearchByReferenceEPSNo").value = "KT"+Year+m+d;

    //}

    function LoadSize()
    {

        var listItems="";
        listItems += "<option value=0>" +"Size" +"</option>";
        for (i = 0; i < _oLinkingLists[0].SizeCategorys.length; i++)
        {
            listItems += "<option value='" + _oLinkingLists[0].SizeCategorys[i].SizeCategoryID+"'>" + _oLinkingLists[0].SizeCategorys[i].SizeCategoryName+"</option>";
        }
        $("#cboSize").html(listItems);
    }

    function RefreshList(oLinkingLists )
    {
        data = oLinkingLists ;
        data = { "total": "" + data.length + "", "rows": data };
        $('#tblLinkingList').datagrid('loadData', data);
    }

    function  icsdateformat(date)
    {
        var mthNames = ["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];
        var y = date.getFullYear();
        var m = date.getMonth();
        var d = date.getDate();
        var result= d +' '+ mthNames[m]+' '+ y;
        return result;
    }

    $('#txtSearchByPSNo').keypress(function (e)
    {

        var keyCode = e.keyCode || e.which;
        if (keyCode == 13)
        {
            _sPSNo = document.getElementById('txtSearchByPSNo').value;
            Search();
        }

    });


    $('#txtSearchByReferenceEPSNo').keypress(function (e)
    {

        var keyCode = e.keyCode || e.which;
        if (keyCode == 13)
        {
            var sRefEPSNo = document.getElementById('txtSearchByReferenceEPSNo').value;
            oEmployeeProduction={ReferenceEPSNo:sRefEPSNo};
            $.ajax({
                type: "POST",
                dataType: "json",
                url: _sBaseAddress + "/EmployeeProduction/EmployeeProduction_SearchByRefEPSNO",
                traditional: true,
                data: JSON.stringify(oEmployeeProduction),
                contentType: "application/json; charset=utf-8",

                success: function(data)
                {
                    var oEmployeeProductions=[];
                    debugger;
                    oEmployeeProductions = jQuery.parseJSON(data);
                    if (oEmployeeProductions.length>0 && oEmployeeProductions[0].ErrorMessage=="")
                    {
                        RefreshList(oEmployeeProductions);
                    }
                    else
                    {
                        alert(oEmployeeProductions[0].ErrorMessage);
                        oEmployeeProductions=[];
                        RefreshList(oEmployeeProductions);
                    }
                },
                error: function(xhr, status, error)
                {
                    alert(error);
                }
            });
        }

    });

    $('#btnRefreshAll').click(function (e)// this event is not used currently
    {

        _sPSNo = "All";
        Search();

    });

    function Search()
    {

        oEmployeeProduction={EPSNO:_sPSNo, OrderRecapDetailID :0};
        $.ajax({
            type: "POST",
            dataType: "json",
            url: _sBaseAddress + "/EmployeeProduction/EmployeeProduction_LinkingSearch",
            traditional: true,
            data: JSON.stringify(oEmployeeProduction),
            contentType: "application/json; charset=utf-8",

            success: function(data)
            {
                var oEmployeeProductions=[];
                //debugger;
                oEmployeeProductions = jQuery.parseJSON(data);
                if (oEmployeeProductions.length>0 && oEmployeeProductions[0].ErrorMessage=="")
                {
                    RefreshList(oEmployeeProductions);
                }
                else
                {
                    alert(oEmployeeProductions[0].ErrorMessage);
                    oEmployeeProductions=[];
                    RefreshList(oEmployeeProductions);
                }
            },
            error: function(xhr, status, error)
            {
                alert(error);
            }
        });

    }

    //$('#btnReceive').click(function (e)
    //{

    //    var oLinking = $('#tblLinkingList').datagrid('getSelected');
    //    if (oLinking == null || oLinking.EPSID <= 0)
    //    {
    //        alert("Please select an item from the list!");
    //        return ;
    //    }
    //
    //    if(oLinking.ApproveBy<=0)
    //    {
    //        alert("This Item Is Not Approved!");
    //        return false;
    //    }

    //    if(oLinking.EmpWiseBalanceQty==0)
    //    {
    //        alert("Balance Qty Is Zero. You Have Nothing To Receive !");
    //        return false;
    //    }

    //    var oParameter = new Object();
    //    oParameter.oOrderRecape = _obj.oOrderRecape;
    //    oParameter.oLinking = oLinking;
    //    var SelectedRowIndex = $('#tblLinkingList').datagrid('getRowIndex', oLinking);
    //    var tsv = ((new Date()).getTime()) / 1000;
    //    var url = _sBaseAddress + "/EmployeeProduction/View_LinkingReceive?nId=0&ts=" + tsv;
    //    var oLinkingList = window.showModalDialog(url, oParameter, 'dialogHeight:252px;dialogWidth:670px;dialogLeft:400;dialogRight:100;dialogTop:250;center:yes;resizable:no;status:no;scroll:no');
    //
    //    if (oLinkingList != null)
    //    {
    //        if (oLinkingList.EPSID > 0)
    //        {
    //            $('#tblLinkingList').datagrid('updateRow', { index: SelectedRowIndex, row: oLinkingList });
    //        }
    //    }

    //});

    $('#btnRePrint').click(function (e)
    {
        var oLinking = $('#tblLinkingList').datagrid('getSelected');
        if (oLinking == null || oLinking.EPSID <= 0)
        {
            alert("Please select an item from the list!");
            return ;
        }
        window.open(_sBaseAddress + '/EmployeeProduction/RePrintTransportationCard?nId='+oLinking.EPSID, "_blank");
        window.close();
    });

    //$('#btnApprove').click(function (e)
    //{
    function Approve()
    {
        debugger
        //var oLinking = $('#tblLinkingList').datagrid('getSelected');
        //var SelectedRowIndex=$('#tblLinkingList').datagrid('getRowIndex',oLinking);
        //if (oLinking == null || oLinking.EPSID <= 0)
        //{
        //    alert("Please select an item from the list!");
        //    return ;
        //}
        //if (oLinking.ApproveBy > 0)
        //{
        //    alert("Already Approve!");
        //    return ;
        //}

        $.ajax({
            type: "POST",
            dataType: "json",
            url: _sBaseAddress + "/EmployeeProduction/EmployeeProduction_Approve",
            traditional: true,
            data: JSON.stringify({nId:_opEmployeeProduction.EPSID}),
            contentType: "application/json; charset=utf-8",
            success: function(data)
            {
                var oEmployeeProduction=[];
                debugger
                oEmployeeProduction = jQuery.parseJSON(data);
                if (oEmployeeProduction.ErrorMessage=="")
                {
                    //alert('Approved successfully.!!');
                    //$('#tblLinkingList').datagrid('updateRow',{index: SelectedRowIndex,row: oEmployeeProduction});
                    Receive();
                }
                else
                {
                    alert(oEmployeeProduction.ErrorMessage);
                }
            },
            error: function(xhr, status, error)
            {
                alert(error);
            }
        });
    }

    //$('#btnDelete').click(function (e)
    //{


    //    var oLinking = $('#tblLinkingList').datagrid('getSelected');
    //    var SelectedRowIndex=$('#tblLinkingList').datagrid('getRowIndex',oLinking);
    //    if (oLinking == null || oLinking.EPSID <= 0)
    //    {
    //        alert("Please select an item from the list!");
    //        return ;
    //    }

    //    //if (oLinking.ApproveBy > 0)
    //    //{
    //    //alert("Already Approve.You cant delete this item.!");
    //    //return ;
    //    //}

    //    if(oLinking.RcvQty >0)
    //    {
    //        alert("Already Received by this Transportation Card. Deletion is not Possible!");
    //        return;
    //    }

    //    if (!confirm("Confirm to Delete?")) return ;
    //    $.ajax({
    //            type: "POST",
    //            dataType: "json",
    //            url: _sBaseAddress + "/EmployeeProduction/EmployeeProduction_Delete",
    //            traditional: true,
    //            data: JSON.stringify({nEPSID:oLinking.EPSID}),
    //            contentType: "application/json; charset=utf-8",
    //            success: function(data)
    //            {

    //                var oEmployeeProduction = jQuery.parseJSON(data);
    //                if (oEmployeeProduction.ErrorMessage=="")
    //                {
    //                    alert('Delete successfully.!!');
    //                    $('#tblLinkingList').datagrid('deleteRow',SelectedRowIndex);
    //                }
    //                else
    //                {
    //                    alert(oEmployeeProduction.ErrorMessage);
    //                }
    //            },
    //            error: function(xhr, status, error)
    //            {
    //                alert(error);
    //            }
    //         });
    //});

    $('#txtCode').keypress(function (e)
    {

        var code = (e.keyCode ? e.keyCode : e.which);
        var sEmpCode=document.getElementById("txtCode").value;

        if (code == 13)//Enter key-13
        {
            if(sEmpCode=="")
            {
                alert("Please Enter Code !");
                return;
            }
            var nts=(new Date()).getTime()/1000;
            var oParameter = new Object();
            oParameter.MultipleItemReturn = false;
            var url = _sBaseAddress + "/Employee/EmployeePikerByCode?sCode="+sEmpCode+"&nDepartmentID="+_oLinkingLists[0].EmployeeOfficial.DepartmentID+"&nts="+nts;

            _oEmployee = window.showModalDialog(url, oParameter, 'dialogHeight:415px;dialogWidth:515px;dialogLeft:400;dialogTop:100;center:yes;resizable:no;status:no;scroll:no');

            if(_oEmployee!=null)
            {
                if(_oEmployee.DesignationName=="" || _oEmployee.DepartmentName=="" || _oEmployee.LocationName=="")
                {
                    alert("This Employee Has No Official Information !");
                    return;
                }
                _nEmployeeID = _oEmployee.EmployeeID;
                $("#txtCode")[0].value=_oEmployee.Name+"["+_oEmployee.Code+"]";

            }
        }
    });


    $('#txtLinEmpCode').keypress(function (e)
    {

        var code = (e.keyCode ? e.keyCode : e.which);
        var sEmpCode=document.getElementById("txtLinEmpCode").value;

        if (code == 13)//Enter key-13
        {
            if(sEmpCode=="")
            {
                alert("Please Enter Code !");
                return;
            }
            var nts=(new Date()).getTime()/1000;
            var oParameter = new Object();
            oParameter.MultipleItemReturn = false;
            var url = _sBaseAddress + "/Employee/EmployeePikerByCode?sCode="+sEmpCode+"&nDepartmentID="+_oLinkingLists[0].EmployeeOfficial.DepartmentID+"&nts="+nts;

            _oEmployee = window.showModalDialog(url, oParameter, 'dialogHeight:415px;dialogWidth:515px;dialogLeft:400;dialogTop:100;center:yes;resizable:no;status:no;scroll:no');

            if(_oEmployee!=null)
            {
                if(_oEmployee.DesignationName=="" || _oEmployee.DepartmentName=="" || _oEmployee.LocationName=="")
                {
                    alert("This Employee Has No Official Information !");
                    return;
                }
                _nEmployeeID = _oEmployee.EmployeeID;
                $("#txtLinEmpCode")[0].value=_oEmployee.Name+"["+_oEmployee.Code+"]";

            }
        }
    });

    function SearchWithPasignation()
    {
        debugger
        if(!_bNext)
        {
            _nRowLength = 0;
            _nLastEPSID = 0;
        }
        var sDepartmentIDs = "";
        var bIssueDateWise= true;
        var bReceiveDateWise= true;
        var dtDateFrom = $('#dtDateFrom').datebox('getValue');
        var dtDateTo = $('#dtDateTo').datebox('getValue');
        var nLoginID = 0;
        var sUserIds="";
        var  sCode = "";
        var nGarmentPart = 0;
        var nSizeCategoryID = 0;

        bIssueDateWise = document.getElementById("chkIssueDateWise").checked;
        bReceiveDateWise = document.getElementById("chkReceiveDateWise").checked;
        nGarmentPart = document.getElementById('cboGarmentPartForsearch').value;
        nSizeCategoryID = document.getElementById('cboSize').value;

        if(_oEmployee != null)
        {
            sCode = _oEmployee.Code;
        }

        var nOrderRecapIds = "" ;

        var nPP = 2;//Production Process= Linking (2)

        var sStyleNos="";

        if(document.getElementById("chkLoginUser").checked == true)
        {

            nLoginID = 1;

        }
        sStyleNos = _sStyleNoForSearch;
        //var sParam = dtDateFrom + "~"+ dtDateTo + "~" + sCode + "~" + nOrderRecapId+ "~" + sStyleNos + "~" + nPP ;
        _nLoadRecords = document.getElementById("txtLoadRecords").value;
        var sParam = dtDateFrom + "~"+ dtDateTo + "~" + sCode + "~" + nOrderRecapIds+ "~" + sStyleNos + "~" + nPP+ "~" + bIssueDateWise+ "~" + bReceiveDateWise+"~"+sDepartmentIDs+"~"+nLoginID+"~"+sUserIds+"~"+nGarmentPart+"~"+nSizeCategoryID+"~"+_nLoadRecords+"~"+_nRowLength;

        $.ajax({
            type: "POST",
            dataType: "json",
            url: _sBaseAddress + "/EmployeeProduction/SearchByCodeAndDate",
            traditional: true,
            data: JSON.stringify({sParam : sParam}),
            contentType: "application/json; charset=utf-8",

            success: function(data)
            {
                var oEmployeeProductions=[];
                oEmployeeProductions = jQuery.parseJSON(data);

                if (oEmployeeProductions.length>0 && oEmployeeProductions[0].ErrorMessage=="")
                {
                    if(!_bNext)
                    {
                        _oEmployeeProductions=[];
                        RefreshList(_oEmployeeProductions);
                    }

                    for (var j = 0; j < oEmployeeProductions.length; j++)
                    {
                        $('#tblLinkingList').datagrid('appendRow',oEmployeeProductions[j]);
                    }
                }
                else
                {
                    if(_bNext == false)
                    {
                        alert("Data not found !!");
                        _oEmployeeProductions=[];
                        RefreshList(_oEmployeeProductions);
                        return;
                    }
                    else
                    {
                        alert("No more data found !");
                        return;
                    }
                }
                var oEmployeeProductions=$('#tblLinkingList').datagrid('getRows');
                document.getElementById("lblcount").innerHTML = " | Count ="+ oEmployeeProductions.length;
                Total();
                _bNext = false;
            },
            error: function(xhr, status, error)
            {
                alert(error);
            }
        });
    }

    function Next()
    {
        var oEmployeeProductions =[];
        oEmployeeProductions=$('#tblLinkingList').datagrid('getRows');
        _nRowLength = oEmployeeProductions.length;
        _bNext = true;

        if (oEmployeeProductions.length<=0)
        {
            alert('Please Select Criteria and click on "Search" to find information.!!');
            return;
        }
        var oEmployeeProduction = oEmployeeProductions[oEmployeeProductions.length-1];

        if (_nLastEPSID==oEmployeeProduction.EPSID)
        {
            alert('No more data found by this date range');
            return;
        }
        _nLastEPSID=oEmployeeProduction.EPSID;
        SearchWithPasignation()
    }

    function Total()
    {
        var oLists = $('#tblLinkingList').datagrid('getRows');
        if(oLists.length>0)
        {
            var nTotalIssue = 0;
            var nTotalReceive = 0;
            var nTotalBalance = 0;

            for(var i=0;i<oLists.length;i++)
            {
                nTotalIssue = parseFloat(nTotalIssue)+parseFloat(oLists[i].IssueQty);
                nTotalReceive = parseFloat(nTotalReceive)+parseFloat(oLists[i].RcvQty);
                nTotalBalance = parseFloat(nTotalBalance)+parseFloat(oLists[i].EmpWiseBalanceQty);
            }
            document.getElementById("lblTotal").innerHTML = " Total Issue = "+ nTotalIssue + ", Total Rcv. = "+ nTotalReceive + ", Balance = " + nTotalBalance;
        }
    }

    $('#btnLinEmployeePicker').click(function (e)
    {
        var oParameter = new Object();
        oParameter.Name = "Employee Advance Search";
        oParameter.MultipleItemReturn=false;
        var url = _sBaseAddress + "/Employee/EmployeeHRMPiker";
        _oEmployee = window.showModalDialog(url, oParameter, 'dialogHeight:510px;dialogWidth:1000px;dialogLeft:50;dialogRight:50;dialogTop:50;center:yes;resizable:yes;status:no;scroll:no');
        if(_oEmployee!=null)
        {
            if(_oEmployee.DesignationName=="" || _oEmployee.DepartmentName=="" || _oEmployee.LocationName=="")
            {
                alert("This Employee Has No Official Information !");
                return;
            }
            _nEmployeeID = _oEmployee.EmployeeID;
            $("#txtLinEmpCode")[0].value=_oEmployee.Name+"["+_oEmployee.Code+"]";

        }
    });

    $('#btnEmployeePicker').click(function (e)
    {
        var oParameter = new Object();
        oParameter.Name = "Employee Advance Search";
        oParameter.MultipleItemReturn=false;
        var url = _sBaseAddress + "/Employee/EmployeeHRMPiker";
        _oEmployee = window.showModalDialog(url, oParameter, 'dialogHeight:515px;dialogWidth:1000px;dialogLeft:50;dialogRight:50;dialogTop:50;center:yes;resizable:yes;status:no;scroll:no');
        if(_oEmployee!=null)
        {
            if(_oEmployee.DesignationName=="" || _oEmployee.DepartmentName=="" || _oEmployee.LocationName=="")
            {
                alert("This Employee Has No Official Information !");
                return;
            }
            _nEmployeeID = _oEmployee.EmployeeID;
            $("#txtCode")[0].value=_oEmployee.Name+"["+_oEmployee.Code+"]";

        }
    });


    function ValidateInputForIssue()
    {

        //if(_nReferenceEPSID == 0)
        //{
        //    alert("Please enter knitting TC !");
        //    $("#txtKnittingTC").focus();
        //    return false;
        //}

        if(_sStyleNo == "")
        {
            alert("Please Enter Style No!");
            $("#txtOrderRecapPickerByStyle").focus();
            return false;
        }
        if(document.getElementById("txtMNo").value == "" || document.getElementById("txtMNo").value == null || isNaN(document.getElementById("txtMNo").value))
        {
            alert("Please Enter Macine No!");
            $("#txtMNo").focus();
            return false;
        }

        if(document.getElementById("cboStyleWiseBodyPart").value == 0)
        {
            alert("Please select a body part!");
            $("#cboStyleWiseBodyPart").focus();
            return false;
        }

        if(_oEmployee==null && _nEmployeeID == 0)
        {
            alert("Please Enter Employee!");
            $("#txtLinEmpCode").focus();
            return false;
        }

        var nIssueQty=parseFloat(document.getElementById("txtIssueReceiveQty").value);
        if(nIssueQty==0 || isNaN(nIssueQty)|| nIssueQty == null)
        {
            alert("Please Enter Issue Qty!");
            $("#txtIssueReceiveQty").focus();
            return false;
        }

        return true;
    }

    function RefreshObjectForIssue()
    {

        var oEmployeeProduction=
        {
            EPSID : _nEPSID,
            EmployeeID : _nEmployeeID,
            OrderRecapDetailID : document.getElementById("cboColorWithSize").value,
            ProductionProcessInt : 2,
            GPID : document.getElementById("cboStyleWiseBodyPart").value,
            MachineNo : document.getElementById("txtMNo").value,
            IssueQty : document.getElementById("txtIssueReceiveQty").value,
            IssueDate : $('#dtDate').datebox('getValue'),
            //ReferenceEPSID : _nReferenceEPSID

        }
        return oEmployeeProduction;
    }

    $('#btnIssueReceive').click(function (e)
    {
        debugger
        if (!ValidateInputForIssue()) return;
        var oEmployeeProduction = RefreshObjectForIssue();
        $.ajax({
            type: "POST",
            dataType: "json",
            url: _sBaseAddress + "/EmployeeProduction/EmployeeProduction_IU",
            traditional: true,
            data: JSON.stringify(oEmployeeProduction),
            contentType: "application/json; charset=utf-8",

            success: function(data)
            {
                debugger
                _opEmployeeProduction = jQuery.parseJSON(data);
                if (_opEmployeeProduction.ErrorMessage == "")
                {
                    //alert("Data Saved sucessfully");
                    //if(_bFlag1)
                    //{
                    //    var oEPSs = $('#tblLinkingList').datagrid('getRows');
                    //    var nIndex = oEPSs.length;
                    //    $('#tblLinkingList').datagrid('appendRow', _opEmployeeProduction);
                    //    $('#tblLinkingList').datagrid('selectRow', nIndex);
                    //}
                    //else
                    //{
                    //    var SelectedRowIndex=$('#tblLinkingList').datagrid('getRowIndex',$('#tblLinkingList').datagrid('getSelected'));
                    //    $('#tblLinkingList').datagrid('updateRow',{index: SelectedRowIndex,	row: _opEmployeeProduction});
                    //    _bFlag1 = true;
                    //    _nEPSID = 0;

                    //}
                    //BlankAndFocus();
                    Approve();
                }
                else
                {
                    alert(_opEmployeeProduction.ErrorMessage);
                }

            },
            error: function(xhr, status, error)
            {
                alert(error);
            }
        });
    });

    function BlankAndFocus()
    {
        $("#txtOrderRecapPickerByStyle").focus();
        document.getElementById("txtLinEmpCode").value = "";
        _nEmployeeID = 0;
        document.getElementById("txtIssueReceiveQty").value = "";
    }

    $('#btnEdit').click(function (e)
    {

        var oEPS = $('#tblLinkingList').datagrid('getSelected');
        if(oEPS == null)
        {
            alert("Please select an item from the list !");
            return;
        }

        //if(oEPS.ApproveBy>0)
        //{
        //alert("Approved item can not edited!");
        //return;
        //}

        if(oEPS.RcvQty >0)
        {
            alert("Already Received by this Transportation Card. Edit is not Possible!");
            return;
        }

        $.ajax({
            type: "POST",
            dataType: "json",
            url: _sBaseAddress + "/EmployeeProduction/EmployeeProduction_Edit",
            traditional: true,
            data: JSON.stringify({nEPSID : oEPS.EPSID}),
            contentType: "application/json; charset=utf-8",

            success: function(data) {

                oEPS = jQuery.parseJSON(data);
                if (oEPS.EPSID > 0)
                {
                    RefreshControl(oEPS);
                    _bFlag1 =false;

                }
                else
                {
                    alert(oEPS.ErrorMessage);
                }
            }

        });


    });

    function RefreshControl(oEPS)
    {

        document.getElementById("cboGarmentPart").selectedIndex = oEPS.GPID;
        document.getElementById("txtLinEmpCode").value = oEPS.EmployeeName;
        document.getElementById("txtIssueReceiveQty").value = oEPS.IssueQty;
        $('#dtDate').datebox('setValue',oEPS.IssueDateInString);
        document.getElementById("txtMNo").value = oEPS.ReferenceMachineNo;
        document.getElementById("txtColor").value = oEPS.ColorName;
        document.getElementById("txtStyle").value = oEPS.StyleNo;
        document.getElementById("txtSize").value = oEPS.SizeCategoryName;
        //document.getElementById("txtKnittingTC").value = oEPS.ReferenceEPSNo;
        //_nReferenceEPSID = oEPS.ReferenceEPSID;
        _nEmployeeID = oEPS.EmployeeID;
        _nEPSID = oEPS.EPSID;
        _nOrderRecapDetailID = oEPS.OrderRecapDetailID;

    }

    $('#btnTransfer').click(function (e)
    {

        var oEPS = $('#tblLinkingList').datagrid('getSelected');
        if(oEPS == null)
        {
            alert("Please select an item from the list !");
            return;
        }

        if(oEPS.RcvQty >0)
        {
            alert("Already Received by this Transportation Card. Transfer is not Possible!");
            return;
        }

        var SelectedRowIndex = $('#tblLinkingList').datagrid('getRowIndex',oEPS);
        var oParameter = new Object();
        oParameter.oEPS = oEPS;
        var tsv = ((new Date()).getTime()) / 1000;
        var url = _sBaseAddress + "/EmployeeProduction/View_TransferEmployeeProduction?ts=" + tsv;
        var oEPS = window.showModalDialog(url, oParameter, 'dialogHeight:150px;dialogWidth:400px;dialogLeft:400;dialogRight:100;dialogTop:250;center:yes;resizable:no;status:no;scroll:no');

        if(oEPS !=null)
        {

            $('#tblLinkingList').datagrid('updateRow',{index: SelectedRowIndex,	row: oEPS});
        }

    });

    //$('#btnActivity').click(function (e)
    //{

    //    var Act="";

    //    var oEPS = $('#tblLinkingList').datagrid('getSelected');
    //    if (oEPS == null || oEPS.EPSID <= 0)
    //    {
    //        alert("Please select an item from list!");
    //        return;
    //    }

    //    //    if(oEPS.IsActive==false)
    //    //    {
    //    //         Act=true;
    //    //
    //    //    }

    //    if(oEPS.IsActive==false)
    //    {
    //        alert("Inactive item can not be Activeted!");
    //        return;

    //    }
    //    if (!confirm("Confirm to Inactive?")) return;
    //    if(oEPS.IsActive==true)
    //    {
    //         Act=false;

    //    }
    //    oEPS.IsActive=Act;

    //    var SelectedRowIndex = $('#tblLinkingList').datagrid('getRowIndex', oEPS);
    //    $.ajax({
    //    type: "POST",
    //    dataType: "json",
    //    url: _sBaseAddress + "/EmployeeProduction/EmployeeProduction_Activity",
    //    traditional: true,
    //    data: JSON.stringify(oEPS),
    //    contentType: "application/json; charset=utf-8",

    //    success: function(data) {

    //             oEPS = jQuery.parseJSON(data);
    //             if (oEPS.EPSID > 0)
    //             {

    //                // if(oEPS.IsActive==true)
    //                // {
    //                //      msg="Activated";
    //                // }

    //                 if(oEPS.IsActive==false)
    //                 {
    //                    msg="InActivated";
    //                 }
    //                 alert(msg+" Successfully!");
    //                 $('#tblLinkingList').datagrid('updateRow', { index: SelectedRowIndex, row: oEPS });

    //             }
    //             else
    //             {
    //                 alert(oEPS.ErrorMessage);
    //             }
    //         }

    //     });

    //});


    //function onClickRow(index)
    //{

    //    if (editIndex != index)
    //    {
    //        if (endEditing())
    //        {
    //            _oLinking = $('#tblLinkingList').datagrid('getSelected');
    //            _nRQty = _oLinking.RcvQty;
    //            $('#tblLinkingList').datagrid('selectRow', index).datagrid('beginEdit', index);
    //            editIndex = index;

    //        }
    //        else
    //        {
    //            $('#tblLinkingList').datagrid('selectRow', editIndex);
    //        }
    //    }
    //}

    //var editIndex = undefined;

    //function endEditing()
    //{
    //    if (editIndex == undefined){return true}
    //    if ($('#tblLinkingList').datagrid('validateRow', editIndex))
    //    {
    //        $('#tblLinkingList').datagrid('endEdit', editIndex);
    //        if(_bFlag == 0)
    //        {
    //            _oLinking.RcvQty = _nRQty;
    //            $('#tblLinkingList').datagrid('updateRow', { index: editIndex, row: _oLinking });
    //        }
    //        editIndex = undefined;
    //        return true;
    //    }
    //    else
    //    {
    //        return false;
    //    }


    //}

    //function ValidateInput()
    //{
    //    var oLinking = $('#tblLinkingList').datagrid('getSelected');
    //    var SelectedRowIndex = $('#tblLinkingList').datagrid('getRowIndex', oLinking);

    //    if (oLinking == null || oLinking.EPSID <= 0)
    //    {
    //        alert("Please select an item from the list!");
    //        _bFlag = 0;
    //        return false;
    //    }

    //    if(oLinking.ApproveBy<=0)
    //    {
    //        alert("This Item Is Not Approved!");
    //        _oLinking.RcvQty = _nRQty;
    //        $('#tblLinkingList').datagrid('updateRow', { index: SelectedRowIndex, row: _oLinking });
    //        _bFlag = 0;
    //        return false;
    //    }

    //    if(oLinking.EmpWiseBalanceQty==0)
    //    {
    //       alert("Balance Qty Is Zero. You Have Nothing To Receive !");
    //       _oLinking.RcvQty = _nRQty;
    //       $('#tblLinkingList').datagrid('updateRow', { index: SelectedRowIndex, row: _oLinking });
    //       _bFlag = 0;
    //       return false;
    //    }

    //    if(oLinking.RcvQty>oLinking.EmpWiseBalanceQty)
    //    {
    //        alert("ReceiveQty Must Not be Greater Than Balance Qty !");
    //        $('#tblLinkingList').datagrid('selectRow', SelectedRowIndex).datagrid('beginEdit', SelectedRowIndex);
    //        editIndex = SelectedRowIndex;
    //        _bFlag = 0;
    //        return false;
    //    }

    //    return true;
    //}

    function RefreshObject()
    {
        //var oLinking = $('#tblLinkingList').datagrid('getSelected');

        //var nNewRcvQty= 0;
        //if(oLinking.RcvQty == 0)
        //{

        //    nNewRcvQty = oLinking.IssueQty;

        //}
        //else
        //{
        //    nNewRcvQty=oLinking.RcvQty;
        //}

        var oEmployeeProductionReceiveDetail=
        {
            EPSRDID : 0,
            EPSID : _opEmployeeProduction.EPSID,
            RcvQty : document.getElementById("txtIssueReceiveQty").value,
            RcvByDate : $('#dtDate').datebox('getValue')
        }
        return oEmployeeProductionReceiveDetail;
    }

    //$('#btnSave').click(function (e)
    //{
    //    _bFlag = 1;
    //    endEditing();
    //    var oLinking = $('#tblLinkingList').datagrid('getSelected');
    //    var SelectedRowIndex = $('#tblLinkingList').datagrid('getRowIndex', oLinking);
    //    if(!ValidateInput()) return;
    function Receive()
    {
        var oEmployeeProductionReceiveDetail = RefreshObject();
        debugger
        $.ajax({
            type: "POST",
            dataType: "json",
            url: _sBaseAddress + "/EmployeeProduction/EmployeeProductionReceiveDetail_IU",
            traditional: true,
            data: JSON.stringify({oEmployeeProductionReceiveDetail:oEmployeeProductionReceiveDetail}),
            contentType: "application/json; charset=utf-8",

            success: function(data)
            {
                debugger
                var oEmployeeProduction = jQuery.parseJSON(data);
                if (oEmployeeProduction.ErrorMessage == "")
                {
                    //alert("Receieved sucessfully.");
                    //$('#tblLinkingList').datagrid('updateRow', { index: SelectedRowIndex, row: oEmployeeProduction });
                    //_bFlag = 0;
                    alert("Received sucessfully");
                    var oEPSs = $('#tblLinkingList').datagrid('getRows');
                    var nIndex = oEPSs.length;
                    $('#tblLinkingList').datagrid('appendRow', oEmployeeProduction);
                    $('#tblLinkingList').datagrid('selectRow', nIndex);
                    BlankAndFocus();
                }
                else
                {
                    alert(oEmployeeProduction.ErrorMessage);
                }
            },
            error: function(xhr, status, error)
            {
                alert(error);
            }
        });
    }


    //$('#txtKnittingTC').keypress(function (e)
    //{
    //    var code = (e.keyCode ? e.keyCode : e.which);
    //    var sEmpTC = document.getElementById("txtKnittingTC").value;

    //    if (code == 13)//Enter key-13
    //    {

    //        if(sEmpTC=="")
    //        {
    //            alert("Please Enter TC No.!");
    //            return;
    //        }

    //        $.ajax({

    //                type: "POST",
    //                dataType: "json",
    //                url: _sBaseAddress + "/EmployeeProduction/GetEmployeeProductionByTC",
    //                traditional: true,
    //                data: JSON.stringify({sEmpTC : sEmpTC}),
    //                contentType: "application/json; charset=utf-8",
    //                success: function(data)
    //                {
    //                    var oEmployeeProduction = null ;
    //                    oEmployeeProduction = jQuery.parseJSON(data);

    //                    if (oEmployeeProduction.ErrorMessage=="")
    //                    {
    //                        document.getElementById("txtMNo").value = oEmployeeProduction.MachineNo;
    //                        document.getElementById("cboGarmentPart").selectedIndex = oEmployeeProduction.GarmentPart;
    //                        document.getElementById("txtColor").value = oEmployeeProduction.ColorName;
    //                        document.getElementById("txtSize").value = oEmployeeProduction.SizeCategoryName;
    //                        document.getElementById("txtIssueReceiveQty").value = oEmployeeProduction.IssueQty;
    //                        document.getElementById("txtStyle").value = oEmployeeProduction.StyleNo;
    //                        _nReferenceEPSID = oEmployeeProduction.EPSID;
    //                        _nOrderRecapDetailID = oEmployeeProduction.OrderRecapDetailID;
    //                    }
    //                    else
    //                    {
    //                        document.getElementById("txtMNo").value = "";
    //                        document.getElementById("cboGarmentPart").selectedIndex = 0;
    //                        document.getElementById("txtColor").value = "";
    //                        document.getElementById("txtSize").value = "";
    //                        document.getElementById("txtIssueReceiveQty").value = "";
    //                        document.getElementById("txtStyle").value = "";
    //                        _nReferenceEPSID = 0;
    //                        _nOrderRecapDetailID = 0;
    //                        alert(oEmployeeProduction.ErrorMessage);
    //                    }
    //                 },

    //                error: function(xhr, status, error)
    //                {
    //                alert(error);
    //                }


    //           });
    //    }
    //});

    //$('#txtKnitSerialNo').keypress(function (e)
    //{
    //    var code = (e.keyCode ? e.keyCode : e.which);
    //    var sKnitSerial = document.getElementById("txtKnitSerialNo").value;
    //    if (code == 13)//Enter key-13
    //    {
    //        if(sKnitSerial=="")
    //        {
    //            alert("Please Enter Serial No.!");
    //            return;
    //        }
    //        if(_nTechnicalSheetID == 0)
    //        {
    //            alert("Please Enter Style No.!");
    //            return;
    //        }
    //        $.ajax({

    //            type: "POST",
    //            dataType: "json",
    //            url: _sBaseAddress + "/EmployeeProduction/GetKnittingBySerial",
    //            traditional: true,
    //            data: JSON.stringify({sKnitSerial : sKnitSerial,nTechnicalSheetID : _nTechnicalSheetID}),
    //            contentType: "application/json; charset=utf-8",
    //            success: function(data)
    //            {
    //                var oEmployeeProduction = null ;
    //                oEmployeeProduction = jQuery.parseJSON(data);

    //                if (oEmployeeProduction.ErrorMessage=="")
    //                {
    //                    document.getElementById("txtMNo").value = oEmployeeProduction.MachineNo;
    //                    document.getElementById("cboGarmentPart").selectedIndex = oEmployeeProduction.GarmentPart;
    //                    document.getElementById("txtColor").value = oEmployeeProduction.ColorName;
    //                    document.getElementById("txtSize").value = oEmployeeProduction.SizeCategoryName;
    //                    document.getElementById("txtIssueReceiveQty").value = oEmployeeProduction.IssueQty;
    //                    document.getElementById("txtStyle").value = oEmployeeProduction.StyleNo;
    //                    _nReferenceEPSID = oEmployeeProduction.EPSID;
    //                    _nOrderRecapDetailID = oEmployeeProduction.OrderRecapDetailID;
    //                }
    //                else
    //                {
    //                    document.getElementById("txtMNo").value = "";
    //                    document.getElementById("cboGarmentPart").selectedIndex = 0;
    //                    document.getElementById("txtColor").value = "";
    //                    document.getElementById("txtSize").value = "";
    //                    document.getElementById("txtIssueReceiveQty").value = "";
    //                    //document.getElementById("txtStyle").value = "";
    //                    _nReferenceEPSID = 0;
    //                    _nOrderRecapDetailID = 0;
    //                    alert(oEmployeeProduction.ErrorMessage);
    //                }
    //            },

    //            error: function(xhr, status, error)
    //            {
    //                alert(error);
    //            }


    //        });
    //    }
    //});

    $('#btnPrint').click(function (e)
    {
        window.open(_sBaseAddress + '/EmployeeProduction/PrintTransportationCard?nId='+_opEmployeeProduction.EPSID, "_blank");
        window.close();
    });

    $('#btnAdvanceEdit').click(function (e)
    {

        var oEPS = $('#tblLinkingList').datagrid('getSelected');
        if(oEPS == null)
        {
            alert("Please select an item from the list !");
            return;
        }

        var SelectedRowIndex=$('#tblLinkingList').datagrid('getRowIndex',oEPS);
        var oParameter = new Object();
        oParameter.oOrderRecape=_obj.oOrderRecape;
        oParameter.Name = "EPS Advance Edit";
        var tsv = ((new Date()).getTime()) / 1000;
        var url = _sBaseAddress + "/EmployeeProduction/View_AdvanceEdit?EmployeeProductionID="+ oEPS.EPSID+"&ts=" + tsv;
        var oEPS = window.showModalDialog(url, oParameter, 'dialogHeight:330px;dialogWidth:380px;dialogLeft:400;dialogRight:100;dialogTop:250;center:yes;resizable:no;status:no;scroll:no');

        if(oEPS !=null)
        {

            $('#tblLinkingList').datagrid('updateRow',{index: SelectedRowIndex,	row: oEPS});

        }

    });

    function LinEmpClear()
    {
        document.getElementById("txtLinEmpCode").value="";

    }
    function EmpClear()
    {
        document.getElementById("txtCode").value="";

    }

    $('#txtStyle').keypress(function (e)
    {
        var code = (e.keyCode ? e.keyCode : e.which);
        if (code==8)
        {
            document.getElementById("txtStyle").value = "";
            _nTechnicalSheetID = 0;

        }
    });

    //$('#txtKnitSerialNo').keypress(function (e)
    //{
    //    var code = (e.keyCode ? e.keyCode : e.which);
    //    if (code==8)
    //    {
    //        document.getElementById("txtKnitSerialNo").value = "";
    //    }
    //});

    $('#txtOrderRecapPickerByStyleForSearch').click(function (e)
    {
        document.getElementById("txtOrderRecapPickerByStyleForSearch").value="";
        _sStyleNoForSearch = "";
    });
</script>