<!DOCTYPE html />
<html>
<head>
    <title>Production Sheet(Linking)</title>
    <link href="@Url.Content("~/Content/CSS/icon.css")" rel="stylesheet" type="text/css" />
    <link href="@Url.Content("~/Content/CSS/easyui.css")" rel="stylesheet" type="text/css" />
    <link href="@Url.Content("~/Content/CSS/Pikerstyle.css")" rel="stylesheet" type="text/css" />
    <script src="@Url.Content("~/Scripts/jquery-1.7.1.min.js")" type="text/javascript"></script>
    <script src="@Url.Content("~/Scripts/jquery.ics.customize.js")" type="text/javascript"></script>
    <script src="@Url.Content("~/Scripts/jquery.easyui.min.js")" type="text/javascript"></script>
    <script src="@Url.Content("~/Scripts/jquery-ui.min.js")" type="text/javascript"></script>
    <script src="@Url.Content("~/Scripts/json2.js")" type="text/javascript"></script>
</head>
<body>
    @model ESimSol.BusinessObjects.EmployeeProduction
    <div style="font-family: Tahoma">
        <table border="0" cellspacing="0" cellpadding="0">
            <tr>
                <td style="background-color: #cfb53b; text-align: center; width: 700px; color: White">
                    <label id="lblHeaderName" style="font-size: 17px; font-weight: bold; text-decoration: Underline">
                       Issue Production Sheet(Linking)</label>
                </td>
            </tr>
            <tr>
                <td style="background-color: #cfb53b; text-align: center; width: 700px; color: White">
                    <label id="lblHeader" style="font-size: 14px; font-weight: bold; text-decoration: Underline">
                        Production Sheet</label>
                </td>
            </tr>
        </table>
        <fieldset>
            <legend style="font-weight: bold">Production Sheet(Linking)</legend>@* table1 start*@
            <table border="0" cellspacing="2" cellpadding="2" style="font-size: 11px; font-weight: bold;">
                <tr>
                    <td style="width: 120px; text-align: right;">
                        Knitting TC :
                    </td>
                    <td>
                    <input placeholder="Type TC & Enter" id="txtTC" type="text" style="width:200px;" />
                    
                    </td>
                    <td style="width: 100px; text-align: right;">
                        Lot :
                        <label id="lblLot"></label>,
                    </td>
                    <td>
                       Machine No :
                       <label id ="lblMachineNo"></label>
                    </td>
                </tr>
                <tr>
                    <td style="width: 120px; text-align: right;">
                        Employee :
                    </td>
                    <td>
                    <input placeholder="Type Code & Enter" id="txtEmployee" type="text" style="width:165px;" />
                    <input id="btnEmployee" type="button" value="P"/>
                    </td>
                    <td style="width: 100px; text-align: right;">
                        Date :
                    </td>
                    <td>
                       <input id="dtDate" type="text" style="width: 200px" class="easyui-datebox" required="required" data-options="formatter:icsdateformat" />
                    </td>
                </tr>
                <tr>
                    <td style="width: 120px; text-align: right;">
                        Official Info :
                    </td>
                    <td>
                        <input id="txtOfficialInfo" type="text" style="width: 200px;" disabled="disabled" />
                    </td>
                    <td style="width: 100px; text-align: right;">
                        PSNo :
                    </td>
                    <td >
                       <input id="txtPSNo" type="text" disabled="disabled" style="width: 200px;" />
                    </td>
                </tr>
                <tr>
                    <td style="width: 120px; text-align: right;">
                        Machine Number :
                    </td>
                    <td>
                        <input id="txtMachineNumber" type="text" style="width:200px;" />
                    </td>
                    <td style="width: 120px; text-align: right;">
                        Color With Size :
                    </td>
                    <td>
                        <select id="cboColorWithSize" style="width:200px;"></select>
                    </td>
                </tr>
                <tr>
                    
                    <td style="width: 100px; text-align: right;">
                        Issue Qty :
                    </td>
                    <td>
                        <input id="txtIssueQty" type="text" style="width:50px;" />(Pcs) &nbsp;
                        @*EPSLotNo :*@ <input id="txtEPSLotNo" type="text" style="width:50px;" />
                    </td>

                    <td style="width: 120px; text-align: right;">
                      Body Part :
                    </td>
                    <td style="width: 200px; text-align: left;">
                        <select id="cboGarmentPart" style="width:200px;"></select>
                        @*@Html.DropDownListFor(model => model.GarmentPart, new SelectList(Enum.GetValues(typeof(ESimSol.BusinessObjects.EnumGarmentPart))), new { id = "cboGarmentPart", style = "width: 200px;" })*@
@*                        Total Qty :  
                       <label id="lblTotalQty"></label>&nbsp;
                        Balance Qty :
                       <label id="lblBalanceQty"></label>*@
                    </td>

                </tr>
              
            </table>
            <table border="0" cellspacing="2" cellpadding="2" style="font-size: 11px; font-weight: bold;">
                <tr>
                    <td style="width: 120px;">
                    
                    </td>
                    <td style="width: 180px;">
                    
                    </td>
                    <td style="width: 330px; text-align: right;">
                        <a id="btnSave_Linking" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-save" plain="true">Save</a>
                        <a id="btnPrint" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-print" plain="true">Print</a>
                        <a id="btnCancel" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-cancel" plain="true">Cancel</a>
                    </td>
                </tr>
            </table>
            @* table1 end*@
            
        </fieldset>
    </div>
</body>
</html>

<script type="text/javascript">
var _oEmployeeProduction=null;
var _opEmployeeProduction=null;
var _sBaseAddress="";
var _obj=null;
var _oEmployee=null;
var _nEmployeeID = 0;
var _nReferenceEPSID = 0;

$(document).ready(function ()
{
    _sBaseAddress =@Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(HttpContext.Current.Session[SessionInfo.BaseAddress]));  
    _oEmployeeProduction =@Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(Model)); 
    _obj = window.dialogArguments;
    

    document.getElementById("lblHeader").innerHTML= "Order No : "+_obj.oOrderRecape.OrderRecapNo+", Style : "+_obj.oOrderRecape.StyleNo+", Buyer : "+_obj.oOrderRecape.BuyerName;
    $("#txtIssueQty").numberbox();
    $('#dtDate').datebox('setValue', _oEmployeeProduction.IssueDateInString);
    LoadBodyPart(_oEmployeeProduction);
    LoadColorAndSize(_oEmployeeProduction);
    document.getElementById('txtEPSLotNo').style.display='none';

    if(_obj.Name == "Edit EPS")
    {
        document.getElementById("lblHeaderName").innerHTML = "Edit Production Sheet(Linking)"; 
        RefreshControl();
        
    }
    SetEPSNO();
    
});


function SetEPSNO()
{
    
    var date = new Date(); 
    var y = date.getFullYear();
    var m = date.getMonth()+1;
    var d = date.getDate();

    if(m<10)
    {

        m = "0"+m;
    
    }
    if(d<10)
    {
    
        d = "0" + d;

    }

    var Year = y.toString();
    Year=Year.substring(Year.length-2,Year.length);
    
    document.getElementById("txtTC").value = "KT-"+Year+m+d+"-";

}

function RefreshControl()
{
 
    debugger
    document.getElementById("txtEmployee").value = _oEmployeeProduction.EmployeeName;
    document.getElementById("txtOfficialInfo").value = _oEmployeeProduction.EmpOfficial;
    document.getElementById("txtPSNo").value = _oEmployeeProduction.EPSNO;
    document.getElementById("txtMachineNumber").value = _oEmployeeProduction.MachineNo;
    
    document.getElementById("cboColorWithSize").value = _oEmployeeProduction.OrderRecapDetailID;
    //document.getElementById("cboLot").value = _oEmployeeProduction.TSPID;
    document.getElementById("txtIssueQty").value = _oEmployeeProduction.IssueQty;
    document.getElementById("txtEPSLotNo").value = _oEmployeeProduction.EPSLotNo;
    document.getElementById("cboGarmentPart").value = _oEmployeeProduction.GPID; 

    document.getElementById("lblLot").innerHTML = _oEmployeeProduction.ReferenceLotNo;
    document.getElementById("lblMachineNo").innerHTML = _oEmployeeProduction.ReferenceMachineNo;
    document.getElementById("txtTC").value = _oEmployeeProduction.ReferenceEPSNo;
   _nReferenceEPSID = _oEmployeeProduction.ReferenceEPSID;
   
    
    _nEmployeeID = _oEmployeeProduction.EmployeeID;

}

function  icsdateformat(date)
{
    var mthNames = ["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];
    var y = date.getFullYear();
    var m = date.getMonth();
    var d = date.getDate();
    var result= d +' '+ mthNames[m]+' '+ y;
    return result;
}

$('#btnEmployee').click(function (e)
{
    var oParameter = new Object();
    oParameter.Name = "Employee Advance Search";
    oParameter.MultipleItemReturn=false;
    var url = _sBaseAddress + "/Employee/EmployeeHRMPiker";
    _oEmployee = window.showModalDialog(url, oParameter, 'dialogHeight:510px;dialogWidth:950px;dialogLeft:200;dialogRight:50;dialogTop:50;center:yes;resizable:yes;status:no;scroll:no');
    if(_oEmployee!=null)
    {
        if(_oEmployee.DesignationName=="" || _oEmployee.DepartmentName=="" || _oEmployee.LocationName=="")
        {
            alert("This Employee Has No Official Information !");
            return;
        }

        if(_oEmployee.IsActive == false)
        {
            alert("InActive Employee. Work can not be assigned for this employee!");
            return;
        }

        $("#txtEmployee")[0].value=_oEmployee.Name;
        $("#txtOfficialInfo")[0].value=_oEmployee.DepartmentName+", "+_oEmployee.DesignationName;
        _nEmployeeID = _oEmployee.EmployeeID ;
    }
});

$('#txtEmployee').keypress(function (e) 
{
        var code = (e.keyCode ? e.keyCode : e.which);
        var sEmpCode=document.getElementById("txtEmployee").value;
        
        if (code == 13)//Enter key-13
        {

            if(sEmpCode=="")
            {
                alert("Please Enter Code !");
                return;
            }

            var nts=(new Date()).getTime()/1000;
            var oParameter = new Object();
            oParameter.MultipleItemReturn = false;
            var url = _sBaseAddress + "/Employee/EmployeePikerByCode?sCode="+sEmpCode+"&nDepartmentID="+_oEmployeeProduction.EmployeeOfficial.DepartmentID+"&nts="+nts;
            _oEmployee = window.showModalDialog(url, oParameter, 'dialogHeight:405px;dialogWidth:515px;dialogLeft:400;dialogTop:100;center:yes;resizable:no;status:no;scroll:no');
            
            if(_oEmployee!=null)
            {

                if(_oEmployee.DesignationName=="" || _oEmployee.DepartmentName=="" || _oEmployee.LocationName=="")
                {
                    alert("This Employee Has No Official Information !");
                    return;
                }

                if(_oEmployee.IsActive == false)
                {
                    alert("InActive Employee. Work can not be assigned for this employee!");
                    return;
                }

                $("#txtEmployee")[0].value=_oEmployee.Name;
                $("#txtOfficialInfo")[0].value=_oEmployee.DepartmentName+", "+_oEmployee.DesignationName;
                _nEmployeeID = _oEmployee.EmployeeID ;

            }
        }
 });

function LoadColorAndSize(_oEmployeeProduction)
{

    var listItems="";
    listItems += "<option value=0>" +"--Select Color With Size--" +"</option>";
    for (i = 0; i < _oEmployeeProduction.OrderRecapDetails.length; i++)
    {
        listItems += "<option value='" + _oEmployeeProduction.OrderRecapDetails[i].OrderRecapDetailID+"'>" + _oEmployeeProduction.OrderRecapDetails[i].ColorAndSizeInString+"</option>";
    
    }
    $("#cboColorWithSize").html(listItems);

}

//$('#cboColorWithSize').change(function (e) 
//{
//   var SelectedID=document.getElementById("cboColorWithSize").value;
//   for (i = 0; i < _oEmployeeProduction.OrderRecapDetails.length; i++)
//    {
//        if(SelectedID==_oEmployeeProduction.OrderRecapDetails[i].OrderRecapDetailID)
//        {
//            document.getElementById("lblTotalQty").innerHTML=_oEmployeeProduction.OrderRecapDetails[i].Quantity;
//            document.getElementById("lblBalanceQty").innerHTML=_oEmployeeProduction.OrderRecapDetails[i].Quantity-_oEmployeeProduction.OrderRecapDetails[i].IssueQty;
//        }
//    } 
//});

function ValidateInput() 
{
debugger
    
    if(_nReferenceEPSID == 0)
    {
        alert("Please enter knitting TC !");
        $("#txtTC").focus();
        return false;
    }

    if(_oEmployee==null && _nEmployeeID <= 0)
    {
        alert("Please Enter Employee!");
        $("#txtEmployee").focus();
        return false;
    }

    var IssueDate=$('#dtDate').datebox('getValue');
    var IssueDateTime=new Date(IssueDate);
    var ND= new Date();
    ND.setHours(0,0,0,0);
//    if(IssueDateTime<ND)
//    {
//        alert("IssueDate Must Not be Less Than Current Date !");
//        $("#dtDate").focus();
//        return false;
//    }
    
    if(document.getElementById("cboColorWithSize").value==0)
    {
        alert("Please Select A Color With Size!");
        $("#cboColorWithSize").focus();
        return false;
    }
   
    var nIssueQty=parseFloat(document.getElementById("txtIssueQty").value);
    if(nIssueQty==0)
    {
    
        alert("Please Enter Issue Qty!");
        $("#txtIssueQty").focus();
        return false;
    }
    
//    var nBalanceQty= parseFloat( document.getElementById("lblBalanceQty").innerHTML);
//    
//    if(nIssueQty>nBalanceQty)
//    {
//    
//        alert("Issue Qty Must Not Be Greater Than Balance Qty!");
//        $("#txtIssueQty").focus();
//        return false;
//    }
//    
    
    return true;
}

function RefreshObject() 
{

    var oEmployeeProduction=
    {
        EPSID : _oEmployeeProduction.EPSID,
        EmployeeID : _nEmployeeID,
        OrderRecapDetailID : document.getElementById("cboColorWithSize").value,
        ProductionProcessInt : 2,
        GPID : document.getElementById("cboGarmentPart").value,
        MachineNo : document.getElementById("txtMachineNumber").value,
        IssueQty : document.getElementById("txtIssueQty").value,
        IssueDate : $('#dtDate').datebox('getValue'),
        EPSLotNo : document.getElementById("txtEPSLotNo").value,
        ReferenceEPSID : _nReferenceEPSID
       
    }
    return oEmployeeProduction;
}

$('#btnSave_Linking').click(function (e) 
{
    debugger
    if (!ValidateInput()) return;
    var oEmployeeProduction = RefreshObject();
    $.ajax({
            type: "POST",
            dataType: "json",
            url: _sBaseAddress + "/EmployeeProduction/EmployeeProduction_IU",
            traditional: true,
            data: JSON.stringify(oEmployeeProduction),
            contentType: "application/json; charset=utf-8",

            success: function(data)
            {
                _opEmployeeProduction = jQuery.parseJSON(data);
                if (_opEmployeeProduction.ErrorMessage == "") 
                {
                    alert("Data Saved sucessfully");
                    window.returnValue = _opEmployeeProduction;
                    //window.close();
                } 
                else 
                {
                    alert(_opEmployeeProduction.ErrorMessage);
                }
             },
             error: function(xhr, status, error)
             {
                alert(error);
             }
          });
});

$('#btnPrint').click(function (e) 
{
    window.open(_sBaseAddress + '/EmployeeProduction/PrintTransportationCard?nId='+_opEmployeeProduction.EPSID, "_blank");
    window.close(); 
});


$('#txtTC').keypress(function (e) 
{

        var code = (e.keyCode ? e.keyCode : e.which);
        var sEmpTC = document.getElementById("txtTC").value;
        
        if (code == 13)//Enter key-13
        {

            if(sEmpTC=="")
            {
                alert("Please Enter TC No.!");
                return;
            }
         
         
            $.ajax({

                    type: "POST",
                    dataType: "json",
                    url: _sBaseAddress + "/EmployeeProduction/GetEmployeeProductionByTC",
                    traditional: true,
                    data: JSON.stringify({sEmpTC : sEmpTC}),
                    contentType: "application/json; charset=utf-8",

                    success: function(data)
                    {

                        var oEmployeeProduction = null ;
                        oEmployeeProduction = jQuery.parseJSON(data);

                        if (oEmployeeProduction.OrderRecapID>0) 
                        {
                            
                            if(oEmployeeProduction.OrderRecapID != _obj.oOrderRecape.OrderRecapID)
                            {
                                alert("Please enter TC No for the same order !!");
                                return;
                          
                            }
                            
                            document.getElementById("lblLot").innerHTML = oEmployeeProduction.NewLotNo;
                            document.getElementById("lblMachineNo").innerHTML = oEmployeeProduction.MachineNo;
                            document.getElementById("cboGarmentPart").value = oEmployeeProduction.GPID; 
                            document.getElementById("cboColorWithSize").value = oEmployeeProduction.OrderRecapDetailID; 
                            document.getElementById("txtIssueQty").value = oEmployeeProduction.IssueQty;
                            _nReferenceEPSID = oEmployeeProduction.EPSID;
                            
                        } 
                        else 
                        {

                            alert("There is no data by this TC");
                            document.getElementById("lblLot").innerHTML = "";
                            document.getElementById("lblMachineNo").innerHTML = "";
                            document.getElementById("cboGarmentPart").value = 0; 
                            document.getElementById("cboColorWithSize").value = 0; 
                            document.getElementById("txtIssueQty").value = 0;
                            _nReferenceEPSID = 0;

                        }

                     },

                     error: function(xhr, status, error)
                     {
                        alert(error);
                     }


                  });
        }
 });

function LoadBodyPart(_oEmployeeProduction)
{
    var listItems="";
    listItems += "<option value=0>" +"--Select Body Part--" +"</option>";
    for (i = 0; i < _oEmployeeProduction.TechnicalSheetBodyParts.length; i++)
    {
        listItems += "<option value='" + _oEmployeeProduction.TechnicalSheetBodyParts[i].GPID+"'>" + _oEmployeeProduction.TechnicalSheetBodyParts[i].GPName+"</option>";
    }
    $("#cboGarmentPart").html(listItems);
}


$('#btnCancel').click(function (e) 
{
    window.close();
});

</script>