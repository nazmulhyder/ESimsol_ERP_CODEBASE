
@{
    ViewBag.Title = "Dyeing Card";
}

@model ESimSol.BusinessObjects.RouteSheetSetup
<div class="menuMainCollectionTable" style="margin-left: 0px; height:99%; width:99.5%">
    <div style="height:90%; width:100%">
        <fieldset style="margin-top: 2px; height:100%;">
            <legend style="font-weight: bold">RouteSheetSetup </legend>
            <table border="0" style="margin-left: 0px; height:10%; width:100%;font-size:12px">
                <tr>
                    <td style="width:30%; text-align:right;font-weight:bold">
                        Production Sheet Name:
                    </td>
                    <td style="width:30%;text-align:left">
                        <input id="txtRSName" class="reset-text" style="width:90%" />
                    </td>
                    <td style="width:15%; text-align:right;font-weight:bold"></td>
                    <td style="width:25%; text-align:right;font-weight:bold"></td>
                </tr>
                <tr>
                    <td style="width:30%; text-align:right;font-weight:bold">
                        Print Name:
                    </td>
                    <td style="width:30%;text-align:left">
                        <input id="txtRSName_Print" class="reset-text" style="width:90%" />

                    </td>
                    <td style="width:15%; text-align:right;font-weight:bold"></td>
                    <td style="width:25%; text-align:right;font-weight:bold"></td>

                </tr>
                <tr>
                    <td style="width:30%; text-align:right;font-weight:bold">
                        Short Name:
                    </td>
                    <td style="width:30%;text-align:left">
                        <input id="txtRSShortName" class="reset-text" style="width:90%" />
                    </td>
                    <td style="width:15%; text-align:right;font-weight:bold"></td>
                    <td style="width:25%; text-align:right;font-weight:bold"></td>

                </tr>
                <tr>
                    <td style="width:30%; text-align:right;font-weight:bold">
                        Calculate Measurement Unit:
                    </td>
                    <td style="width:30%">
                        <select id="cboMUnit" style=" width:90%;"></select>
                    </td>
                    <td style="width:15%; text-align:right;font-weight:bold"></td>
                    <td style="width:25%; text-align:right;font-weight:bold"></td>

                </tr>
                <tr>
                    <td style="width:30%; text-align:right;font-weight:bold">
                        Alternate Measurement Unit:
                    </td>
                    <td style="width:30%">
                        <select id="cboMUnitID_Two" style=" width:90%;"></select>
                    </td>
                    <td style="width:15%; text-align:right;font-weight:bold"></td>
                    <td style="width:25%; text-align:right;font-weight:bold"></td>
                </tr>
                <tr>
                    <td style="width:30%; text-align:right;font-weight:bold">
                        Receipe Calculation By(Small Unit) :
                    </td>
                    <td style="width:30%;text-align:left">
                        <input id="txtSmallUnit_Cal" class="reset-text" style="width:40%" />
                        <input id="txtSMUnitValue" class="reset-text" style="width:49%"  />
                    </td>
                    <td style="width:15%; text-align:right;font-weight:bold"></td>
                    <td style="width:25%; text-align:right;font-weight:bold"></td>
                </tr>
                <tr>
                    <td style="width:30%; text-align:right;font-weight:bold">
                        GracePercentage:
                    </td>
                    <td style="width:30%">
                        <input id="txtGracePercentage" class="reset-text" style="width:90%" />
                    </td>
                    <td style="width:15%; text-align:right;font-weight:bold"></td>
                    <td style="width:25%; text-align:right;font-weight:bold"></td>
                </tr>
                <tr>
                    <td style="width:30%; text-align:right;font-weight:bold">
                        Loss Percentage:
                    </td>
                    <td style="width:30%">
                        <input id="txtLossPercentage" class="reset-text" style="width:90%" />
                    </td>
                    <td style="width:15%; text-align:right;font-weight:bold"></td>
                    <td style="width:25%; text-align:right;font-weight:bold"></td>
                </tr>
                <tr>
                    <td style="width:30%; text-align:right;font-weight:bold">
                        Gain Percentage:
                    </td>
                    <td style="width:30%">
                        <input id="txtGainPercentage" class="reset-text" style="width:90%" />
                    </td>
                    <td style="width:15%; text-align:right;font-weight:bold"></td>
                    <td style="width:25%; text-align:right;font-weight:bold"></td>
                </tr>
                <tr>
                    <td style="width:30%; text-align:right;font-weight:bold">
                        Print No:
                    </td>
                    <td style="width:30%">
                        <select id="cboPrintNo" style=" width:90%;"></select>
                    </td>
                    <td style="width:15%; text-align:right;font-weight:bold"></td>
                    <td style="width:25%; text-align:right;font-weight:bold"></td>
                </tr>
                <tr>
                    <td style="width:30%; text-align:right;font-weight:bold">
                        RestartBy:
                    </td>
                    <td style="width:30%">
                        <select id="cboRestartBy" style=" width:90%;"></select>
                    </td>
                    <td style="width:15%; text-align:right;font-weight:bold"></td>
                    <td style="width:25%; text-align:right;font-weight:bold"></td>
                </tr>
                <tr>
                    <td style="width:30%; text-align:right;font-weight:bold">
                        View Type:
                    </td>
                    <td style="width:30%">
                        <select id="cboDyesChemicalViewType" style=" width:90%;"></select>
                    </td>
                    <td style="width:15%; text-align:right;font-weight:bold">WIP Store</td>
                    <td style="width:25%; text-align:right;font-weight:bold"><select id="cboWorkingUnitWIO" style=" width:90%;"></select></td>
                </tr>

                
                <tr>
                    <td style="width:30%; text-align:right;font-weight:bold">
                        Batch Time:
                    </td>
                    <td style="width:30%">
                        <input id="timeSpinner" class="easyui-timespinner" style="width: 75px; height:20px; font-size: 11px;" required="required" data-options="showSeconds:false" />
                    </td>
                    <td style="width:15%; text-align:right;font-weight:bold">DC Entry Validation</td>
                    <td style="width:25%; text-align:right;font-weight:bold"><select id="cboDCEntryValidation" style=" width:90%;"></select></td>
                </tr>
                    
                <tr>
                    <td style="width:30%; text-align:right;font-weight:bold">
                        Batch Code:
                    </td>
                    <td style="width:30%;text-align:left">
                        <input id="txtBatchCode" class="reset-text" style="width:90%" />
                    </td>
                    <td style="width:15%; text-align:right;font-weight:bold">DC Out Validation</td>
                    <td style="width:25%; text-align:right;font-weight:bold"><select id="cboDCOutValidation" style=" width:90%;"></select></td>
                </tr>
                <tr>
                    <td style="width:30%; text-align:right;font-weight:bold">
                        Machine Per Page:
                    </td>
                    <td style="width:30%;text-align:left">
                        <input id="txtMachinePerDoc" class="reset-text number" style="width:90%" />
                    </td>
                    <td style="width:15%; text-align:right;font-weight:bold">Batch Cost Report Default View</td>
                    <td style="width:25%; text-align:right;font-weight:bold"><select id="cboBatchCostReport" style=" width:90%;"></select></td>

                </tr>
                <tr>
                    <td style="width:30%; text-align:right;font-weight:bold">
                        Font Size:
                    </td>
                    <td style="width:30%;text-align:left">
                        <input id="txtFontSize" class="reset-text number" style="width:90%" />
                    </td>
                    <td style="width:15%; text-align:right;font-weight:bold"></td>
                    <td style="width:25%; text-align:right;font-weight:bold"></td>
                </tr>
                <tr>
                    <td style="width:30%; text-align:right;font-weight:bold">
                        Number of Addition (for qty):
                    </td>
                    <td style="width:30%;text-align:left">
                        <input id="txtNumberOfAddition" class="reset-text number" style="width:90%" />
                    </td>
                    <td style="width:15%; text-align:right;font-weight:bold"></td>
                    <td style="width:25%; text-align:right;font-weight:bold"></td>
                </tr>
                <tr>
                    <td style="width:30%; text-align:right;font-weight:bold">
                        Is Lot Mandatory?
                    </td>
                    <td style="width:30%">
                        <input id="chkIsLotMandatory" type="checkbox" />
                    </td>
                    <td style="width:15%; text-align:right;font-weight:bold">Is Rate Show on USD?</td>
                    <td style="width:25%; text-align:left;font-weight:bold"><input id="chkIsRateOnUSD" type="checkbox" /></td>
                </tr>
                <tr>
                    <td style="width:30%; text-align:right;font-weight:bold">
                        Is Show Buyer?
                    </td>
                    <td style="width:30%">
                        <input id="chkIsShowBuyer" type="checkbox" />
                    </td>
                  
                    <td style="width:15%; text-align:right;font-weight:bold"></td>
                    <td style="width:25%; text-align:right;font-weight:bold"></td>
                </tr>
                <tr>
                    <td style="width:30%; text-align:right;font-weight:bold">
                        Is Apply HW?
                    </td>
                    <td style="width:30%">
                        <input id="chkIsApplyHW" type="checkbox" />
                    </td>
                    <td style="width:15%; text-align:right;font-weight:bold"></td>
                    <td style="width:25%; text-align:right;font-weight:bold"></td>
                </tr>
                <tr>
                    <td style="width:30%; text-align:right;font-weight:bold">
                        Is Grace Applicable?
                    </td>
                    <td style="width:30%">
                        <input id="chkIsGraceApplicable" type="checkbox" />
                    </td>
                    <td style="width:15%; text-align:right;font-weight:bold"></td>
                    <td style="width:25%; text-align:right;font-weight:bold"></td>
                </tr>
                    
            </table>
        </fieldset>
    </div>
    <div style="margin-left: 2px; height:6%; width:100%">
        <fieldset >
            <legend style="font-weight: bold">Action </legend>
            <table border="0" cellspacing="2" cellpadding="2" style="font-size: 11px; width: 100%;font-weight: bold; font-size: 12px;">
                <tr>
                    <td style="width: 80%; text-align: right"></td>
                    <td style="width: 10%; font-size: 13px">
                        <a id="btnSave" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-save" plain="true" onclick="Save()">Save</a>
                    </td>
                    <td style="width: 10%; font-size: 13px">
                        <a id="btnClose" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-cancel"
                            plain="true" onclick="Close()">Close</a>
                    </td>
                </tr>
            </table>
        </fieldset>
    </div>
</div>
    
<script type="text/javascript">
    var _oRouteSheetSetup=null;
    var _sBaseAddress="";
    var _oMeasurementUnits=[];
    var _oPrintNos=[];
    var _oRestartBys=[];
    $(document).ready(function () {
        debugger;
        _sBaseAddress =@Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(HttpContext.Current.Session[SessionInfo.BaseAddress]));
        _oRouteSheetSetup =@Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(Model));
        _oMeasurementUnits = @Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(ViewBag.MeasurementUnits));
        _oPrintNos = @Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(ViewBag.PrintNoList));
        _oRestartBys = @Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(ViewBag.RestartByList));
        _oDyesChemicalViewTypes = @Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(ViewBag.DyesChemicalViewTypes));
        var oWorkingUnits=@Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(@ViewBag.WorkingUnits));
        var  oDCEntryValType =@Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(ViewBag.DCEntryValType));
        var  oRSStateForCost =@Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(ViewBag.RSStateForCost));

        $("#cboDCEntryValidation").icsLoadCombo({List: oDCEntryValType, OptionValue: "id", DisplayText: "Value", InitialValue:"-Select One-" });
        $("#cboDCOutValidation").icsLoadCombo({List: oDCEntryValType, OptionValue: "id", DisplayText: "Value", InitialValue:"-Select One-" });
        $("#cboBatchCostReport").icsLoadCombo({List: oRSStateForCost, OptionValue: "id", DisplayText: "Value", InitialValue:"-Select One-" });
        $("#cboWorkingUnitWIO").icsLoadCombo({
            List: oWorkingUnits,
            OptionValue: "WorkingUnitID",
            DisplayText: "WorkingUnitName",
        });
        LoadCombo();
        RefreshControl();

    });
    function LoadCombo() {
        $("#cboMUnit, #cboMUnitID_Two").icsLoadCombo({
            List: _oMeasurementUnits,
            OptionValue: "MeasurementUnitID",
            DisplayText: "UnitName"
        });
        $("#cboPrintNo").icsLoadCombo({
            List: _oPrintNos,
            OptionValue: "id",
            DisplayText: "Value"
        });
        $("#cboRestartBy").icsLoadCombo({
            List: _oRestartBys,
            OptionValue: "id",
            DisplayText: "Value"
        });
        $("#cboDyesChemicalViewType").icsLoadCombo({
            List: _oDyesChemicalViewTypes,
            OptionValue: "id",
            DisplayText: "Value"
        });

    }
    function RefreshControl()
    {
        $("#txtRSName").val(_oRouteSheetSetup.RSName);
        $("#txtRSShortName").val(_oRouteSheetSetup.RSShortName);
        $("#txtRSName_Print").val(_oRouteSheetSetup.RSName_Print);
        $("#cboMUnit").val(_oRouteSheetSetup.MUnitID);
        $("#cboMUnitID_Two").val(_oRouteSheetSetup.MUnitID_Two);
        $("#txtSmallUnit_Cal").val(_oRouteSheetSetup.SmallUnit_Cal);
        $('#txtSMUnitValue').prop("disabled", true);
        $("#txtSMUnitValue").val(_oRouteSheetSetup.SMUnitValue);
        $("#txtGracePercentage").val(_oRouteSheetSetup.GracePercentage);
        $("#txtLossPercentage").val(_oRouteSheetSetup.LossPercentage);
        $("#txtGainPercentage").val(_oRouteSheetSetup.GainPercentage);
        $("#cboPrintNo").val(_oRouteSheetSetup.PrintNo);
        $("#cboRestartBy").val(_oRouteSheetSetup.RestartBy);
        $("#cboDyesChemicalViewType").val(_oRouteSheetSetup.DyesChemicalViewType);
        $("#cboWorkingUnitWIO").val(_oRouteSheetSetup.WorkingUnitIDWIP);

        $("#cboDCEntryValidation").val(_oRouteSheetSetup.DCEntryValType);
        $("#cboDCOutValidation").val(_oRouteSheetSetup.DCOutValType);
        $("#cboBatchCostReport").val(_oRouteSheetSetup.RSStateForCost);

        $("#txtBatchCode").val(_oRouteSheetSetup.BatchCode);
        $("#txtMachinePerDoc").val(_oRouteSheetSetup.MachinePerDoc);
        $("#txtFontSize").val(_oRouteSheetSetup.FontSize);
        $("#txtNumberOfAddition").val(_oRouteSheetSetup.NumberOfAddition);

        $("#chkIsLotMandatory").prop('checked',_oRouteSheetSetup.IsLotMandatory);
        $("#chkIsRateOnUSD").prop('checked',_oRouteSheetSetup.IsRateOnUSD);
        $("#chkIsShowBuyer").prop('checked',_oRouteSheetSetup.IsShowBuyer);
        $("#chkIsApplyHW").prop('checked',_oRouteSheetSetup.IsApplyHW);
        $("#chkIsGraceApplicable").prop('checked',_oRouteSheetSetup.IsGraceApplicable);
        $('#timeSpinner').timespinner('setValue', _oRouteSheetSetup.BatchTimeSt);  // set timespinner value
    }
    function ValidateInputExportLC() {
        if (!$.trim($('#txtRSName').val()).length) {
            alert("Please enter Name.");
            $('#txtRSName').focus();
            $("#txtRSName").addClass("errorFieldBorder");
            return false;
        } else { $('#txtRSName').removeClass("errorFieldBorder"); }

        if (!$.trim($('#txtRSShortName').val()).length) {
            alert("Please enter short Name.");
            $('#txtRSShortName').focus();
            $("#txtRSShortName").addClass("errorFieldBorder");
            return false;
        } else { $('#txtRSShortName').removeClass("errorFieldBorder"); }



        if (parseInt($("#cboMUnit").val()) <= 0) {
            alert("Please select Unit Name!"); $('#cboMUnit').focus();
            $("#cboMUnit").addClass("errorFieldBorder");
            return false;
        } else {
            $("#cboMUnit").removeClass("errorFieldBorder");
        }
        if (parseInt($("#cboMUnitID_Two").val()) <= 0)
        {
            alert("Please select alternate Unit Name!"); $('#cboMUnit').focus();
            $("#cboMUnitID_Two").addClass("errorFieldBorder");
            return false;
        }
        else
        {
            $("#cboMUnitID_Two").removeClass("errorFieldBorder");
        }
        return true;
    }
    function Save()
    {
        debugger;//$("#chkIsLotMandatory").val()
        if (!ValidateInputExportLC()) return;
        var oRouteSheetSetup=RefreshObject();
        $.ajax({
            type: "POST",
            dataType: "json",
            url : _sBaseAddress+"/RouteSheetSetup/Save",
            traditional: true,
            data:  JSON.stringify(oRouteSheetSetup),
            contentType: "application/json; charset=utf-8",
            success: function (data) {
                debugger;
                var oRouteSheetSetup= jQuery.parseJSON(data);
                if (oRouteSheetSetup.ErrorMessage=="" || oRouteSheetSetup.ErrorMessage==null)
                {
                    _oRouteSheetSetup=oRouteSheetSetup;
                    RefreshControl();
                    alert("Data Save Succesfully!!");

                }
                else
                {
                    alert(oRouteSheetSetup.ErrorMessage);
                }
            },
            error: function (xhr, status, error)
            {
                alert(error);
            }
        });

    }

    function RefreshObject()
    {
        var timeSpinner = $('#timeSpinner').timespinner('getValue');  // get timespinner value
        var BatchTime=new Date();
        BatchTime.setHours(timeSpinner.split(':')[0])
        BatchTime.setMinutes(timeSpinner.split(':')[1])
        //alert(BatchTime);

        var oRouteSheetSetup= {
            RouteSheetSetupID:_oRouteSheetSetup.RouteSheetSetupID,
            RSName:$("#txtRSName").val(),
            RSShortName:$("#txtRSShortName").val(),
            RSName_Print:$("#txtRSName_Print").val(),
            MUnitID:$("#cboMUnit").val(),
            MUnitID_Two: $("#cboMUnitID_Two").val(),
            SmallUnit_Cal:$("#txtSmallUnit_Cal").val(),
            GracePercentage:$("#txtGracePercentage").val(),
            LossPercentage: $("#txtLossPercentage").val(),
            GainPercentage: $("#txtGainPercentage").val(),
            PrintNo: $("#cboPrintNo").val(),
            RestartBy:$("#cboRestartBy").val(),
            DyesChemicalViewType:$("#cboDyesChemicalViewType").val(),
            MachinePerDoc:$("#txtMachinePerDoc").val(),
            BatchCode:$("#txtBatchCode").val(),
            FontSize:$("#txtFontSize").val(),
            NumberOfAddition:$("#txtNumberOfAddition").val(),
            IsLotMandatory:($("#chkIsLotMandatory").attr('checked')=='checked'? true: false),
            IsRateOnUSD:($("#chkIsRateOnUSD").attr('checked')=='checked'? true: false),
            IsShowBuyer:($("#chkIsShowBuyer").attr('checked')=='checked'? true: false),
            IsApplyHW:($("#chkIsApplyHW").attr('checked')=='checked'? true: false),
            IsGraceApplicable:($("#chkIsGraceApplicable").attr('checked')=='checked'? true: false),
            WorkingUnitIDWIP:$("#cboWorkingUnitWIO").val(),
            DCEntryValType:parseInt($("#cboDCEntryValidation").val()),
            DCOutValType:parseInt($("#cboDCOutValidation").val()),
            RSStateForCost:parseInt($("#cboBatchCostReport").val()),
            BatchTime:new Date(BatchTime)
        };

        //console.log(oRouteSheetSetup);
        return oRouteSheetSetup;
    }

    $("#txtSmallUnit_Cal").keypress(function (e) {
        if (e.which != 8 && e.which != 0  && e.which != 46  && (e.which < 48 || e.which > 57)) {

            return false;
        }
    });
</script>
