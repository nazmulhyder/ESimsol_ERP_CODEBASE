<html>
<head>
    @{
        ViewBag.Title = "Export L/C";
    } 
</head>
<body>
    @model ESimSol.BusinessObjects.ExportLC

  
    <div class="menuMainCollectionTable">
        <div class="easyui-panel" title="" style="font-family:Tahoma; text-align:center; width:100%; height:100%;">
            <div id="divExportLCAmendmentRequests" style="font-family:Tahoma; text-align:center; width:100%; height:88%;">
                <fieldset>
                 <legend style="font-weight:bold">L/C  info </legend>
                <table border="0" cellspacing="2" cellpadding="2" style=" width:100%;font-size:12px; font-weight:bold">
                    
                    <tr>
                        <td style="width:20%; text-align:right">
                            L/C No :
                        </td>
                        <td style="width:25%">
                            <input id="txtLCNo" style="width: 100%;font-size:12px; font-weight:bold" class="type-diabaled" disabled />
                        </td>
                        <td style="width:15%; text-align:right">
                            <label id="lblAmendmentNo">Amendment No :</label>
                        </td>
                        <td style="width:25%">
                            <input id="txtAmendmentNoAndDate" style="width: 100%;font-size:12px; font-weight:bold" class="type-diabaled" disabled />
                        </td>
                        <td style="width:10%; text-align:right"></td>
                    </tr>
                    <tr>
                        <td style="width:20%; text-align:right">
                            File No :
                        </td>
                        <td style="width:25%">
                            <input id="txtFileNo" style="width: 100%;font-size:12px; font-weight:bold" class="type-diabaled" disabled />
                        </td>
                        <td style="width:15%; text-align:right"></td>
                        <td style="width:25%"></td>
                        <td style="width:10%; text-align:right"></td>
                    </tr>
                    <tr>
                        <td style="width:20%; text-align:right">
                            Party Name :
                        </td>
                        <td colspan="3" style="width:70%">
                            <input id="txtApplicantName" style="width: 100%;font-size:12px; font-weight:bold" class="type-diabaled" disabled />
                        </td>
                        <td style="width:10%; text-align:right"></td>
                    </tr>
                    <tr>
                        <td style="width:20%; text-align:right">
                            Advice Bank :
                        </td>
                        <td colspan="3" style="width:70%">
                            <input id="txtBankNameAdvice" style="width: 100%;font-size:12px; font-weight:bold" class="type-diabaled" disabled />
                        </td>
                        <td style="width:10%; text-align:right"></td>
                    </tr>
                    <tr>
                        <td style="width:20%; text-align:right">
                            Issue Bank :
                        </td>
                        <td colspan="3" style="width:70%">
                            <input id="txtBankNameIssue" style="width: 100%;font-size:12px; font-weight:bold" class="type-diabaled" disabled />
                        </td>
                        <td style="width:10%; text-align:right"></td>
                    </tr>
                    <tr>
                        <td style="width:20%; text-align:right">
                            Negotiation Bank :
                        </td>
                        <td colspan="3" style="width:70%">
                            <input id="txtBankNameNego" style="width: 100%;font-size:12px; font-weight:bold" class="type-diabaled" disabled />
                        </td>
                        <td style="width:12%; text-align:right"></td>
                    </tr>
                    <tr>
                        <td style="width:20%; text-align:right">
                            L/C Date :
                        </td>
                        <td style="width:30%">
                            <input id="txtLCDate" style="width: 100%;font-size:12px; font-weight:bold" class="type-diabaled" disabled />
                        </td>
                        <td style="width:15%; text-align:right">
                            L/C Value :
                        </td>
                        <td style="width:25%">
                            <input id="txtIAmountLC" style="width: 100%;font-size:12px; font-weight:bold" class="type-diabaled" disabled />
                        </td>
                        <td style="width:10%; text-align:right"></td>
                    </tr>
                    <tr>
                        <td style="width:20%; text-align:right">
                            Current Status :
                        </td>
                        <td colspan="3" style="width:70%">
                            <input id="txtState" style="width: 100%;font-size:12px; font-weight:bold" class="type-diabaled" disabled />
                        </td>
                        <td style="width:10%; text-align:right"></td>
                    </tr>
                </table>
                </fieldset>
                <table id="tblExportLCAmendmentRequests" class="easyui-datagrid" style="width:100%; height: 200px; margin: 0;"
                       data-options="singleSelect: true,fitColumns:false, rownumbers:true, pagination:false, autoRowHeight:false, toolbar: '#toolbarExportLCAmendmentRequests' ">
                    <thead>
                        <tr>
                            <th field="Sequencest" width="100" align="left">Sequencest</th>
                            <th field="DateOfRequestSt" width="110" align="left">Request Send Date</th>
                            <th field="DateOfReceiveSt" width="220" align="left">Received Date</th>
                        </tr>
                    </thead>
                </table>
                <div id="toolbarExportLCAmendmentRequests">
                    <input type="button" id="btnAddExportLCAmendmentRequest" value="Add" style="width:100px; font-size:12px" />
                    <input type="button" id="btnEditExportLCAmendmentRequest" value="Edit" style="width:100px; font-size:12px" />
                    <input type="button" id="btnDeleteExportLCAmendmentRequest" value="Delete" style="width: 100px; font-size: 12px" />
                    <a id="btnPrintExportLCAmendmentRequest" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-print" plain="true">Preview(Request Letter)</a>
                    @*<input type="button" id="btnPrintExportLCAmendmentRequest" value="Preview(Request Letter)" style="width: 100px; font-size: 12px" />*@
                </div>
            </div>
            <fieldset>
                <legend style="font-weight:bold"> Action : </legend>
                <table border="0" cellspacing="2" cellpadding="2" style="width:100%;font-size:11px; font-weight:bold">
                    <tr>
                        <td style="width:70%"></td>
                        <td style="width:10%">
                        </td>
                        <td style="width:15%;text-align:right">
                            <a id="btnClose" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-closed" plain="true">Close</a>
                        </td>
                    </tr>
                </table>
            </fieldset>
        </div>  
    </div>
    <div id="winExportLCAmendmentRequest" class="easyui-window" title="ExportLC Amendment Request(s)" data-options="modal:true,closed:true,collapsible:false,minimizable:false,maximizable:false,closable:false">
        <div id="divExportLCAmendmentRequest" tabindex="-1">
            <table id="tblExportLCAmendmentRequest" class="easyui-datagrid" style="width: 400px; height: 350px; margin: 0;"
                   data-options="singleSelect: true,fitColumns:false, rownumbers:true, pagination:false, autoRowHeight:false, toolbar: '#toolbartoolbarExportLCAmendmentRequest' ">
                <thead>
                    <tr>
                        <th data-options="field:'Selected',checkbox:true"></th>
                        <th field="Clause" width="450" align="left" data-options="field:'Clause',editor:{type:'text',options:{precision:0}}"> Clause </th>
                    </tr>
                </thead>
            </table>
            <div id="toolbartoolbarExportLCAmendmentRequest">
                <a href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-reload" plain="true"></a>
                <input type="text" id="txtNewAmendmentCaluse" value="" style="width:230px" />
                <a href="javascript:void(0)" id="btnAddAmendmentCaluse" class="easyui-linkbutton" iconcls="icon-add" plain="true">Add new Clause</a>
            </div>
        </div>
        <fieldset class="actionfieldsetstyle">
            <legend>Actions : </legend>
            <a id="btnOkExportLCAmendmentClauses" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-save" plain="true">Save</a>
            <a id="btnCloseExportLCAmendmentClauses" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-cancel" plain="true">Close</a>
        </fieldset>
    </div>
</body>
</html>
<script type="text/javascript">
    var _sBaseAddress = "";
    var _oExportLC=null;
    var _oExportLCAmendmentRequests = [];
  
   
    $(document).ready(function () {
        _sBaseAddress =@Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(HttpContext.Current.Session[SessionInfo.BaseAddress]));
        _oExportLC =@Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(Model));
        _oExportLCAmendmentRequests = @Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(ViewBag.ExportLCAmendmentRequests));
      
        debugger;
     
        RefreshControl();
        _sBackLink=sessionStorage.getItem("BackLink");
      
    });
  
 
   
    function RefreshControl() {

        $("#txtAmendmentNoAndDate").val( _oExportLC.AmendmentFullNo);
        if(_oExportLC.VersionNo<=0 || _oExportLC.AmendmentNo == null)
        {
            $("#txtAmendmentNoAndDate").hide();
            $("#lblAmendmentNo").hide();
        }
        $("#txtLCNo").val(_oExportLC.ExportLCNo);
        $("#txtFileNo").val( _oExportLC.FileNo);
        $("#txtApplicantName").val(_oExportLC.ApplicantName);
        $("#txtLCDate").val(_oExportLC.OpeningDateST);
        $("#txtBankNameAdvice").val(_oExportLC.BankName_Advice + '[' + _oExportLC.BBranchName_Advice + ']');
        $("#txtBankNameNego").val( _oExportLC.BankName_Nego + '[' + _oExportLC.BBranchName_Nego + ']');
        $("#txtBankNameIssue").val(_oExportLC.BankName_Issue + '[' + _oExportLC.BBranchName_Issue + ']');
        $("#txtIAmountLC").val(_oExportLC.AmountSt);
        $("#txtState").val(_oExportLC.CurrentStatusInST);

        if(_oExportLCAmendmentRequests!=null )
        {
            DynamicRefreshList(_oExportLCAmendmentRequests, "tblExportLCAmendmentRequests");
        }
        else{
            DynamicRefreshList([], "tblExportLCAmendmentRequests");
        }
    }
    function NewExportLCAmendmentRequest() {

        var oExportLCAmendmentRequest = {
            ExportLCAmendmentRequestID: 0,
            ExportLCID: _oExportLC.ExportLCID
        };
        return oExportLCAmendmentRequest;
    }
    $("#btnAddExportLCAmendmentRequest").click(function () {
      
        var oExportLCAmendmentRequest = NewExportLCAmendmentRequest();
        $("#winExportLCAmendmentRequest").icsWindow('open', "ExportLCAmendmentClause");
        Gets_ExportLCAmendmentClauses(oExportLCAmendmentRequest);
        $("#txtNewAmendmentCaluse").focus();
        $('#tblExportLCAmendmentRequest').datagrid('selectRow', -1);
    });

    $("#btnEditExportLCAmendmentRequest").click(function () {
        var oExportLCAmendmentRequest = $("#tblExportLCAmendmentRequests").datagrid("getSelected");
        
        $("#winExportLCAmendmentRequest").icsWindow('open', "ExportLCAmendmentClause");
        Gets_ExportLCAmendmentClauses(oExportLCAmendmentRequest);
        $("#txtNewAmendmentCaluse").focus();
        $('#tblExportLCAmendmentRequest').datagrid('selectRow', -1);
    });
    function Gets_ExportLCAmendmentClauses(oExportLCAmendmentRequest) {
    
        var obj =
        {
            BaseAddress: _sBaseAddress,
            Object: oExportLCAmendmentRequest,
            ControllerName: "ExportLC",
            ActionName: "GetsExportLCAmendmentClauses",
            IsWinClose: false
        };

        $.icsDataGets(obj, function (response) {
        
            if (response.status && response.objs.length > 0) {
                if (response.objs.length > 0) {
                    DynamicRefreshListForMultipleSelection(response.objs, "tblExportLCAmendmentRequest");
                    $('#tblExportLCAmendmentRequest').datagrid({ selectOnCheck: false, checkOnSelect: true });
                    debugger;
                    var oExportLCAmendmentClauses = $('#tblExportLCAmendmentRequest').datagrid('getRows');
                    for(var i =0;i<oExportLCAmendmentClauses.length;i++)
                    {
                        if(parseInt(oExportLCAmendmentClauses[i].ExportLCAmendmentClauseID)>0)
                        {
                            $('#tblExportLCAmendmentRequest').datagrid('checkRow',i);
                        }
                    }
                    
                }
                else { DynamicRefreshListForMultipleSelection([], "tblExportLCAmendmentRequest"); }

            }
        });
    }
    $("#btnDeleteExportLCAmendmentRequest").click(function () {
        var oExportLCAmendmentRequest = $("#tblExportLCAmendmentRequests").datagrid("getSelected");
        if (oExportLCAmendmentRequest == null || oExportLCAmendmentRequest.ExportLCAmendmentRequestID <= 0) {
            alert("Please select an item from list!");
            return;
        }
        if (!confirm("Confirm to Delete?")) return false;
       
        var obj =
        {
            BaseAddress: _sBaseAddress,
            Object: oExportLCAmendmentRequest,
            ObjectId: oExportLCAmendmentRequest.ExportLCAmendmentRequestID,
            ControllerName: "ExportLC",
            ActionName: "Delete_AmendmentRequest",
            TableId: "tblExportLCAmendmentRequests",
            IsWinClose: false
        };
        $.icsDelete(obj);
    });

    ////

    $("#btnOkExportLCAmendmentClauses").click(function () {
        var obj = $("#tblExportLCAmendmentRequest").datagrid("getChecked");
    
        if (obj == null || obj.length<=0)
        {
            alert("Please select an item from list.");
            return false;
        }
       

        var oExportLCAmendmentClauses = [];
        //oExportLCAmendmentClauses.push(obj);
        for (var i = 0; i < obj.length; i++) {
            oExportLCAmendmentClauses.push(obj[i]);
        }
        var oExportLCAmendmentRequest = NewExportLCAmendmentRequest();
        oExportLCAmendmentRequest.ExportLCAmendmentClauses = oExportLCAmendmentClauses;
        if (oExportLCAmendmentClauses[0].ExportLCAmendRequestID > 0) {
            oExportLCAmendmentRequest.ExportLCAmendmentRequestID = oExportLCAmendmentClauses[0].ExportLCAmendRequestID;
        }
        var obj =
        {
            BaseAddress: _sBaseAddress,
            Object: oExportLCAmendmentRequest,
            ObjectId: oExportLCAmendmentRequest.ExportLCAmendmentRequestID,
            ControllerName: "ExportLC",
            ActionName: "Save_AmendmentRequest",
            TableId: "tblExportLCAmendmentRequests",
            IsWinClose: true
        };
        $.icsSave(obj, function (response) {
            if (response.status && response.obj != null) {
                if (response.obj != null && response.obj.ExportLCAmendmentRequestID > 0) {
                    alert("Data Save successfully");
                }
            }
        });
    });
    ////


    $("#btnPrintExportLCAmendmentRequest").click(function () {
        var oExportLCAmendmentRequest = $("#tblExportLCAmendmentRequests").datagrid("getSelected");
        if (oExportLCAmendmentRequest == null || oExportLCAmendmentRequest.ExportLCAmendmentRequestID <= 0) {
            alert("Please select an item from list!");
            return;
        }
        $("#winExportLCAmendmentRequest").icsWindow('close');
        window.open(_sBaseAddress + '/ExportLC/PrintAmendmentRequest?id=' + oExportLCAmendmentRequest.ExportLCAmendmentRequestID, "_blank");
    });
  
    $("#btnCloseExportLCAmendmentClauses").click(function () {
        $("#winExportLCAmendmentRequest").icsWindow("close");
    });

    $("#btnAddAmendmentCaluse").click(function () {
        AddAmendmentCaluse();
    });

    $("#txtNewAmendmentCaluse").keydown(function (e) {
        if (e.keyCode === 13)
        {
            AddAmendmentCaluse();
        }
    });
    function AddAmendmentCaluse() {
        if ($.trim($("#txtNewAmendmentCaluse").val()) == "") {
            alert("Please write some Clause");
            $("#txtNewAmendmentCaluse").addClass("errorFieldBorder");
            $("#txtNewAmendmentCaluse").focus();
            return false;
        } else {
            $("#txtNewAmendmentCaluse").removeClass("errorFieldBorder");
        }
        var oExportLCAmendmentClause = {
            ExportLCAmendmentClauseID: 0,
            Clause: $("#txtNewAmendmentCaluse").val(),
            ExportLCAmendRequestID: 0
        };
        $('#tblExportLCAmendmentRequest').datagrid('appendRow', oExportLCAmendmentClause);
        $("#txtNewAmendmentCaluse").val("");
    }
    $('#btnClose').click(function(e){
        window.location.href = sessionStorage.getItem("BackLink");
    });

</script>