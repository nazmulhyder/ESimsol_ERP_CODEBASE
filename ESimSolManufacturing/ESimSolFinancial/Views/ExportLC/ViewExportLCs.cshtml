
@model IEnumerable<ESimSol.BusinessObjects.ExportLC>
@{
    ViewBag.Title = "Export Letter of Credit";
}

<head>
<title>L/C Terms</title>
   
</head>

<body>
    <div id="progressbarParent" style="width:100%;height:100%;margin:0 auto;text-align:center; margin-left: auto;margin-right: auto;left: 0;right: 0;z-index: 1;">
        <div style="margin: 0px auto;margin-top: 251px;text-align:center;width:390px;">
            <label style="font-size:18px;">Please wait</label>
            <div id="progressbar" style="width:100%;height:37px;"></div>
        </div>
    </div>

<div id="winExportLCStatusUpdate" class="easyui-window" title="ExportLC Status Change" data-options="modal:true,closed:true,collapsible:false,minimizable:false,maximizable:false,closable:true">
    <div id="divExportLCStatusUpdate">
        <table>
            <tr>
                <td style="width:120px; text-align:right">
                    L/C Current Status
                </td>
                <td style="width:150px">
                    <select id="cboLCStatus" style="width: 150px;" disabled="disabled"></select>
                </td>
            </tr>
            <tr>

                <td style="width:120px; text-align:right">
                    New Status
                </td>
                <td style="width:150px;text-align:left">
                    <select id="cboLCStatus_Update" style="width: 150px;"></select>
                </td>

            </tr>
            <tr>
                <td style="width:120px; text-align:right">
                    Remark
                </td>
                <td style="width:150px">
                    <input type="text" style="width:150px;" id="txtNoteUpdateStatus" />
                </td>
            </tr>
        </table>

    </div>
    <fieldset class="actionfieldsetstyle">
        <legend>Actions : </legend>
        <a id="btnSaveExportLCStatusUpdate" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-save" plain="true">Save</a>
        <a id="btnCloseExportLCStatusUpdate" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-cancel" plain="true">Close</a>
    </fieldset>
</div>

 <div id="winExportTR" class="easyui-window" title="Contractor" data-options="modal:true,closed:true,collapsible:false,minimizable:false,maximizable:false,closable:false">
        <div id="divExportTR" tabindex=" -1">
            <table id="tblExportTRs" class=" easyui-datagrid" style="width: 400px; height: 350px; margin: 0;"
                   data-options="singleSelect: true,fitColumns:false, rownumbers:true, pagination:false, autoRowHeight:false ">
                <thead>
                    <tr>
                        <th field="TruckReceiptNo" width="60">Receipt No</th>
                        <th field="Carrier" width="100">Carrier</th>
                        <th field="TruckNo" width="100">Truck No</th>
                        <th field="DriverName" width="120">Driver Name</th>
                    </tr>
                </thead>
            </table>

        </div>
        <fieldset class="actionfieldsetstyle">
            <legend>Actions : </legend>
            <a id="btnOkExportTR" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-ok" plain="true">Ok</a>
            <a id="btnCloseExportTR" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-cancel" plain="true">Close</a>
        </fieldset>
    </div>

<div id="winExportDocTnC" style="width:700px" class="easyui-window winstyle" title="Bill Informations" data-options="modal:true,closed:true,collapsible:false,minimizable:false,maximizable:false,closable:false">

    <table>
        <tr>
            <td>
                <fieldset>
                    <legend style="font-weight: bold">Truck Info : </legend>
                    <table border="0" cellspacing="2" cellpadding="2" style="font-size: 11px; font-weight: bold">
                        <tr>
                            <td style="width: 100px; text-align: right">
                                Receipt No :
                            </td>
                            <td style="width: 200px">
                                <input id="txtTruckReceiptNo" type="text" style="width:142px;" disabled="disabled" /><a id="btnPickExportTruckReceipt" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-ok" plain="true">Pick</a>
                            </td>
                            <td style="width: 100px; text-align: right">
                                Receipt Date:
                            </td>
                            <td style="width: 200px">
                                <input id="txtTruckReceiptDate" type="text" style="width:200px;" disabled="disabled" />
                            </td>
                        </tr>
                        <tr>
                            <td style="width: 100px; text-align: right">
                                Carrier :
                            </td>
                            <td style="width: 200px">
                                <input id="txtCarrier" type="text" style="width:200px;" disabled="disabled" />
                            </td>
                            <td style="width: 100px; text-align: right">
                                Truck No :
                            </td>
                            <td style="width: 200px">
                                <input id="txtTruckNo" type="text" style="width:200px;" disabled="disabled" />
                            </td>
                        </tr>
                        <tr>
                            <td style="width: 100px; text-align: right">
                                Driver Name :
                            </td>
                            <td style="width: 200px">
                                <input id="txtDriverName" type="text" style="width:200px;" disabled="disabled" />
                            </td>
                            <td style="width: 100px; text-align: right"></td>
                            <td style="width: 100px"></td>
                        </tr>
                    </table>
                </fieldset>
                <table border="0" cellpadding="0" cellspacing="0" style="width:100%">
                    <tr>
                        <td style="width:70%">
                            <table id="tblExportDocForwarding" title="Required Documents" class="easyui-datagrid" style="width:100%;height:200px;" fitcolumns="false" rownumbers="true" pagination="false" singleselect="false" autorowheight="false" toolbar="#toolbarExportDocForwarding" data-options="onClickRow: onClickRowDocForwarding">
                                <thead>
                                <th data-options="field:'selected',checkbox:true"></th>
                                <th data-options="field:'Name_Print', width:230,align:'Left',editor:{type:'text'}" height="100px" align="Left">Doc Name</th>
                                <th data-options="field:'Copies', width:100,align:'Left',editor:{type:'text'}" style="width:70px; height:100px" align="Left">Copies</th>
                                <th field="Name_Doc" width="110" align="left">Doc Name</th>
                                </thead>
                            </table>

                        </td>
                        <td style="width:30%">
                            <table id="tblPartyInfo" title="" class="easyui-datagrid" style="width:100%; height:200px;  font-size: 12px" fitcolumns="false" rownumbers="true" pagination="false" singleselect="false" autorowheight="false">
                                <thead>
                                    <tr>
                                        <th data-options="field:'Selected',checkbox:true">
                                        </th>
                                        <th field="PartyInfo" width="40%">PartyInfo</th>
                                        <th field="RefNo" width="30%">RefNo</th>
                                        <th field="RefDate" width="30%">RefDate</th>
                                    </tr>
                                </thead>
                            </table>
                        </td>
                    </tr>
                </table>

                <fieldset>
                    <legend style="font-weight: bold">Other Info : </legend>
                    <table border="0" cellspacing="2" cellpadding="2" style="font-size: 11px;">
                        <tr>
                            <td style="width: 100px; text-align: right">
                                NOTIFY PARTY
                            </td>
                            <td style="width: 100px">
                                <select id="cboNotifyBy" style=" width:100%;"></select>
                            </td>
                            <td style="width: 100px; text-align: right"></td>
                            <td style="width: 100px"></td>
                        </tr>
                        <tr>
                            <td style="width: 100px; text-align: right">
                                <input id="chkIsPrintGrossNetWeight" type="checkbox" />
                            </td>
                            <td style="width: 100px">
                                Print Gross / Net Weight
                            </td>
                            <td style="width: 100px; text-align: right">
                                <input id="chkIsPrintOriginal" type="checkbox" />
                            </td>
                            <td style="width: 100px">
                                Print Original
                            </td>
                        </tr>
                        <tr>
                            <td style="width: 100px; text-align: right">
                                <input id="chkIsDeliveryBy" type="checkbox" />
                            </td>
                            <td style="width: 200px">
                                <input id="txtDeliveryBy" type="text" style="width:200px;" placeholder="Delivery By" />
                            </td>
                            <td style="width: 100px; text-align: right">
                                <input id="chkIsTerm" type="checkbox" />
                            </td>
                            <td style="width: 200px">
                                <input id="txtTerm" type="text" style="width:200px;" placeholder="Trade Term" />
                            </td>
                        </tr>
                        @*<tr>
                            <td  style="width: 100px; text-align: right">
                                CTP APPLICANT
                            </td>
                            <td  style="width: 200px; text-align: right">
                                <input id="txtCTPApplicant" type="text" style="width:99%;" placeholder="CTP Applicant" />
                            </td>
                             
                            <td style="width: 100px; text-align: right">
                                GRP Form No
                            </td>
                            <td  style="width: 200px;">
                                <input id="txtGRPNonDate" type="text" style="width:99%;" placeholder="GRP/Export Form No" />
                            </td>
                        </tr>
                        <tr>
                            <td style="width: 100px; text-align: right">
                                Certification
                            </td>
                            <td colspan="3" style="width: 500px; text-align: right">
                                <input id="txtCertificationt" type="text" style="width:99%;" value="TO BE OF BANGLADESH ORGIN" />
                            </td>

                        </tr>*@
                    </table>
                    <table border="0">
                    <tr>
                        <td style="width: 250px; text-align: right"> <label id="lblBagWeight" style="font-size: 10px ;"></label></td>
                        <td style="width: 50px">
                            <input id="txtMeasurementCarton" type="text" style="width:99%;" placeholder="Measurement Carton" />
                        </td>
                        <td style="width: 250px; text-align: right"><label id="lblWeightPerBag" style="font-size: 10px;"></label></td>
                        <td style="width: 50px">
                            <input id="txtPerCartonWeight" type="text" style="width:99%;" placeholder="Per Carton Weight" />
                        </td>
                    </tr>
                    </table>
    </fieldset>

    <fieldset id="Action">
        <legend style="font-weight: bold">Action : </legend>
        <table border="0" cellspacing="2" cellpadding="2" style=" width: 100%;font-weight: bold; font-size: 12px">
            <tr>
                <td style="width: 320px; text-align: right"></td>

                <td style="width: 50px; font-size:13px">
                    <a id="btnSaveExportDocTnC" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-save" plain="true">Save</a>
                </td>
                <td style="width: 50px; font-size:13px">
                    <a id="btnCloseExportDocTnC" href=" javascript:void(0)" class="easyui-linkbutton" iconcls="icon-closed" plain="true">Close</a>
                </td>
            </tr>
        </table>
    </fieldset>
    </td>
    </tr>
    </table>
</div>

 <div class="menuMainCollectionTable">
     <table id="tblExportLCs" title="Export L/C(s)" class="easyui-datagrid" style="height:100%;" data-options="singleSelect: true,fitColumns:false, rownumbers:true, pagination:false, autoRowHeight:false, fit:false, onClickRow: onClickRowLCCollectionPage" toolbar="#toolbarExportLC">
         <thead>
             <tr>
                 <th field="FileNo" width="10%" align="left">File No</th>
                 <th field="ApplicantName" width="20%" align="left">Applicant Name</th>
                 <th field="ExportLCNo" width="15%" align="left">L/C No</th>
                 <th field="AmountSt" width="15%" align="right">Amount</th>
                 <th field="ShipmentDateST" width="10%" align="center">Shipment Date</th>
                 <th field="ExpiryDateST" width="10%" align="center">Expiry Date</th>
                 <th field="OpeningDateST" width="10%" align="center">Opening Date</th>
                 <th field="LCRecivedDateST" width="10%" align="center">LC Recived Date</th>
                 <th field="BankName_Issue" width="20%" align="left">Issue Bank Name</th>
                 <th field="BBranchName_Issue" width="20%" align="left">Branch Name</th>
                 <th field="NoteQuery" width="20%" align="left">Note Query</th>
                 <th field="GetOrginalCopySt" width="10%" align="left">Get Orginal Copy</th>
                 <th data-options="field:'AmountBill',align:'right',formatter:formatPrice" style="width:10%" align="right">Invoice Aount</th>
                 <th field="BalanceSt" width="10%" align="right">Yet To Invoice</th>
                 <th field="VersionNo" width="4%" align="right">A.No</th>
                 <th field="AmendmentDateSt" width="10%" align="center">A.Date</th>
               
                 <th field="CurrentStatusInST" width="20%" align="left">Status</th>
                 
             </tr>
         </thead>
     </table>
        <div id="toolbarExportLC">
            <input type="text" id="txtSearchbyLCNo" placeholder="Type L/C No and Press Enter" style="width:169px" />
            <label style="margin-left:10px;">Recived Date :</label> <input id="txtLCRecDate" type="text" style="width: 100px;" class="easyui-datebox" required="required" data-options="formatter:icsdateformat,parser:icsdateparser" />
            <a id="btnSearchLC" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-search" plain="true"></a>
            <a id="btnAdvSearch" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-search" plain="true">Adv. Search</a>
            <a id="btnAddExportLC" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-add" plain="true">New</a>
            <a id="btnEditExportLC" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-edit" plain="true">Edit</a>
            <a id="btnViewExportLC" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-details" plain="true">View</a>
            <a id="btnDeleteExportLC" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-remove" plain="true">Delete</a>
            <a id="btnApproveLC" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-approved" plain="true">Approve</a>
            <a id="btnAddAmendmentRequest" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-approved" plain="true">Amendment Request</a>
            <a id="btnAddAmendmentRecd" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-approved" plain="true">Amendment Received</a>
            @*<a id="btnGetOrginalCopy" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-approved" plain="true">GetOrginalCopy</a>*@
            <a id="btnAddBills" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-add" plain="true">Add Bill</a>
            <a id="btnExportLCStatusUpdate" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-add" plain="true">L/C Status Change</a>
            @*<a id="btnAddDOFromLC" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-ok" plain="true">Create DO</a>*@
            <a id="btnAttachment" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-attachment" plain="true">Attachment</a>
            <a id="btnUpdatePartyInfo" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-edit" plain="true">Update Party Info</a>
            <a id="btnExportDocTnC" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-ok" plain="true">Document Setup</a>
            <a id="btnViewExportLCLog" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-details" plain="true">View Amemend L/C</a>
            <a id="btnPrintPreview" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-print" plain="true">Preview</a>
            <a id="btnPrintLCStatement" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-print" plain="true">Preview(Statement)</a>
            <a id="btnExportLCUD" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-details" plain="true">Add Info</a>
            <a id="btnFundAllocation" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-ok" plain="true">Fund Allocation</a>
            <a id="btnPrintListInXL" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-excel" plain="true">Excel</a>
        </div>
    </div>
    
 <div id="winAdvSearch" class="easyui-window winClass" style="width:800px" title="Adv. Search" data-options="modal:true,closed:true,collapsible:false,minimizable:false,maximizable:false,closable:false">
        <div>
            <fieldset style="margin-bottom: 0px;">
                <legend>Searching Criteria</legend>
                <table style="width:100%;text-align:right;">
                    <tr>
                        <td style="width:20%;text-align:right;">
                            <label>P/I No :</label>
                        </td>
                        <td style=" width:20%;text-align:left;">
                            <input id="txtExportPINoAS" style="width:100%;" type="text" />
                        </td>
                        <td style=" width:15%;text-align:right;">
                            <label>File No :</label>
                        </td>
                        <td style=" width:15%;text-align:left;">
                            <input id="txtFileNoAS" style="width:100%;" type="text" />
                        </td>
                        <td style="width:30%; text-align: left; font-size: 12px; vertical-align:top" rowspan="11" >
                            <div style="margin-top: 2px;">
                                <table id="tblExportLCStatusAdv" class="easyui-datagrid" title="Status" style="width:100%; height: 250px;" data-options="singleSelect: false,fitColumns:false, rownumbers:true, pagination:false, autoRowHeight:false, ">
                                    <thead>
                                        <tr>
                                            <th data-options="field:'Selected',checkbox:true"></th>
                                            <th field="Value" width="98%"></th>
                                        </tr>
                                    </thead>
                                </table>
                            </div>
                        </td>
                    </tr>
                    <tr>
                        <td style=" width:20%;text-align:right;">
                            <label>Applicant :</label>
                        </td>
                        <td colspan="3" style=" width:50%;text-align:left;">
                            <input id="txtContractorAdvS" style="width:75%;" type="text" placeholder="Type & Press Enter" />
                            <a id="btnPickContractorAdvS" href="javascript:void(0)" class="easyui-linkbutton ics-pick" iconcls="icon-pick" plain="true"></a>
                            <a id="btnClrContractorAdvS" href="javascript:void(0)" class="easyui-linkbutton ics-pick" iconcls="icon-clear" plain="true"></a>
                        </td>
                    </tr>
                    <tr>
                        <td style=" width:20%;text-align:right;">
                            <label>Nego Bank:</label>
                        </td>
                        <td colspan="3" style=" width:50%;text-align:left;">
                            <select id="cboBankBranch_Nego" style="width:90%;"></select>
                        </td>
                    </tr>
                    <tr>
                        <td style=" width:20%;text-align:right;">
                            <label>Advise Bank:</label>
                        </td>
                        <td colspan="3" style=" width:50%;text-align:left;">
                            <select id="cboBankBranch_Advise" style="width:90%;"></select>
                        </td>
                    </tr>
                    <tr>
                        <td style=" width:20%;text-align:right;">
                            <label>Issue Bank :</label>
                        </td>
                        <td colspan="3" style=" width:50%;text-align:left;">
                            <input id="txtBankBranch_Issue" style="width:75%;" type="text" placeholder="Type & Press Enter" />
                            <a id="btnPickBankBranch_Issue" href="javascript:void(0)" class="easyui-linkbutton ics-pick" iconcls="icon-pick" plain="true"></a>
                            <a id="btnClrBankBranch_Issue" href="javascript:void(0)" class="easyui-linkbutton ics-pick" iconcls="icon-clear" plain="true"></a>
                        </td>
                    </tr>
                    <tr>
                        <td style=" width:20%;text-align:right;">
                            <label>L/C Open Date:</label>
                        </td>
                        <td colspan="3" style=" width:50%;text-align:left;">
                            <table>
                                <tr>
                                    <td>
                                        <select id="cboDateOpening" onchange="DateActions_LCOpen(); "></select>
                                        <input id="txtFromOpeningDate" type="text" style="width: 110px;" class="easyui-datebox" required="required" data-options="formatter:icsdateformat,parser:icsdateparser" />To
                                        <input id="txtToOpeningDate" type="text" style="width: 110px;" class="easyui-datebox" required="required" data-options="formatter:icsdateformat,parser:icsdateparser" />
                                    </td>
                                </tr>
                            </table>
                        </td>
                    </tr>
                    <tr>
                        <td style="width:20%;text-align:right;">
                            <label>L/C Open & Amt Date:</label>
                        </td>
                        <td colspan="3" style=" width:50%;text-align:left;">
                            <table>
                                <tr>
                                    <td>
                                        <select id="cboAmendmentDate" onchange="DateActions_AmendmentDate(); "></select>
                                        <input id="txtFromAmendmentDate" type="text" style="width: 110px;" class="easyui-datebox" required="required" data-options="formatter:icsdateformat,parser:icsdateparser" />To
                                        <input id="txtToAmendmentDate" type="text" style="width: 110px;" class="easyui-datebox" required="required" data-options="formatter:icsdateformat,parser:icsdateparser" />
                                    </td>
                                </tr>
                            </table>
                        </td>
                    </tr>

                    <tr>
                        <td style="width:20%;text-align:right;">
                            <label>Receive Date:</label>
                        </td>
                        <td colspan="3" style=" width:50%;text-align:left;">
                            <table>
                                <tr>
                                    <td>
                                        <select id="cboLCRecivedDate" onchange="DateActions_LCRecivedDate(); "></select>
                                        <input id="txtFromLCRecivedDate" type="text" style="width: 110px;" class="easyui-datebox" required="required" data-options="formatter:icsdateformat,parser:icsdateparser" />To
                                        <input id="txtToLCRecivedDate" type="text" style="width: 110px;" class="easyui-datebox" required="required" data-options="formatter:icsdateformat,parser:icsdateparser" />
                                    </td>
                                </tr>
                            </table>
                        </td>
                    </tr>
                    <tr>
                        <td style="width:20%;text-align:right;">
                            <label>Shipment Date:</label>
                        </td>
                        <td colspan="3" style=" width:50%;text-align:left;">
                            <table>
                                <tr>
                                    <td>
                                        <select id="cboShipmentDate" onchange="DateActions_ShipmentDate(); "></select>
                                        <input id="txtfromShipmentDate" type="text" style="width: 100px;" class="easyui-datebox" required="required" data-options="formatter:icsdateformat,parser:icsdateparser" />To
                                        <input id="txtTofromShipmentDate" type="text" style="width: 100px;" class="easyui-datebox" required="required" data-options="formatter:icsdateformat,parser:icsdateparser" />
                                    </td>
                                </tr>
                            </table>
                        </td>
                    </tr>
                    <tr>
                        <td style="width:20%;text-align:right;">
                            <label>Expire Date:</label>
                        </td>
                        <td colspan="3" style="width:50%;text-align:left;">
                            <table>
                                <tr>

                                    <td>
                                        <select id="cboExpireDate" onchange="DateActions_ExpireDate(); "></select>
                                        <input id="txtFromExpireDate" type="text" style="width: 100px;" class="easyui-datebox" required="required" data-options="formatter:icsdateformat,parser:icsdateparser" />To
                                        <input id="txtToExpireDate" type="text" style="width: 100px;" class="easyui-datebox" required="required" data-options="formatter:icsdateformat,parser:icsdateparser" />

                                    </td>
                                </tr>
                            </table>
                        </td>
                    </tr>
                    <tr>
                        <td colspan="5" style="width:70%;text-align:left;">
                            <table style="width:100%;text-align:left;">
                                <tr>
                                    <td style=" width:15%;text-align:right;">
                                        <label>UD Receive:</label>
                                    </td>
                                    <td style=" width:15%;text-align:left;">
                                        <select style="width: 100%;" id="cboUDRecd">
                                            <option value="0">Default</option>
                                            <option value="1">Yet No Recv</option>
                                            <option value="2">Receive</option>

                                        </select>
                                    </td>
                                    <td style=" width:20%;text-align:right;">
                                        <label>Have Any Query :</label>
                                    </td>
                                    <td style=" width:15%;text-align:left;">
                                        <select style="width: 100%;" id="cboHaveQuery">
                                            <option value="0">Default</option>
                                            <option value="1">Yes</option>
                                            <option value="2">No</option>

                                        </select>
                                    </td>
                                    <td style=" width:20%;text-align:right;">
                                        <label>Original Copy :</label>
                                    </td>
                                    <td style=" width:15%;text-align:left;">
                                        <select style="width: 100%;" id="cboGetOriginalCopy">
                                            <option value="0">Default</option>
                                            <option value="1">Yet No Recv</option>
                                            <option value="2">Receive</option>

                                        </select>
                                    </td>
                                </tr>
                            </table>
                        </td>
                    </tr>
                
                    <tr>
                        <td colspan="2" style=" width:40%;text-align:right;">
                            <label>DO  yet not Create:</label>
                        </td>
                        <td style="width:10%;text-align:left;">
                            <input id="chkExportDoIsntCreateYet" type="checkbox" style="margin-left: 7px;" />
                        </td>
                        <td  style=" width:25%;text-align:right;margin-left: 10px;">
                            <label>L/C In Hand:</label>
                            @*<input id="chkLCInHand" type="checkbox" style="" />*@
                        </td>
                        <td style=" width:25%;text-align:right;">
                            <input id="chkLCInHand" type="checkbox" style="margin-right: 140px;" />
                        </td>

                    </tr>
                    <tr>
                        <td colspan="2" style=" width:20%;text-align:right;">
                            <label>Delivery Challan Issue but Bill Not created:</label>
                        </td>
                        <td style="width:10%;text-align:left;">
                            <input id="chkDeliveryChallanIssueButBillNotCreated" type="checkbox" style="margin-left: 7px;" />
                        </td>
                        <td style=" width:25%;text-align:right;">
                            <label>L/C Type:</label>
                        </td>
                        <td style=" width:25%;text-align:right;">
                            <select style="width:100%;" id="cboLCType">
                            </select>
                        </td>
                    </tr>
                    @*<tr>
                        <td style=" width:40%;text-align:right;">
                            <label>Status : </label>
                        </td>
                        <td colspan="3" style="width:60%;text-align:left;">
                            <div style="margin-top: 2px;">
                                <table id="tblExportLCStatusAdv" class="easyui-datagrid" title="" style="width:100%; height: 80px;" data-options="singleSelect: false,fitColumns:false, rownumbers:true, pagination:false, autoRowHeight:false, ">
                                    <thead>
                                        <tr>
                                            <th data-options="field:'Selected',checkbox:true"></th>
                                            <th field="Value" width="98%"></th>
                                        </tr>
                                    </thead>
                                </table>
                            </div>
                        </td>
                    </tr>*@

                </table>
            </fieldset>

            <fieldset >
                <legend>Actions : </legend>
                <table style="width:100%;text-align:right;">
                    <tr>
                        <td style="width:20%;text-align:right;">

                            <a id="btnResetAdvSearch" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-reload" plain="true">Reset</a>

                        </td>
                        <td style="width:80%;text-align:right;">
                            <label class="lblLoadingMessage" style="float: left;">Loading Please Wait...</label>
                            <a id="btnSearchAdvSearch" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-search" plain="true">Search</a>
                            <a id="btnCloseAdvSearch" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-cancel" plain="true">Close</a>
                        </td>
                    </tr>
                </table>
              
            </fieldset>
        </div>
    </div>
 <div id="winExportLCAttachment" class="easyui-window" title="Export LC Attachments" data-options="modal:true,closed:true,collapsible:false,minimizable:false,maximizable:false,closable:false">
    @using (Html.BeginForm("UploadAttchment", "ExportLC", FormMethod.Post, new { enctype = "multipart/form-data", target = "_blank" }))
    {
        <table id="tblExportLCAttachment" class="easyui-datagrid" style="width:798px;height:350px;margin:0;" data-options="singleSelect: true,fitColumns:false, rownumbers:true, pagination:false, autoRowHeight:false, toolbar: '#toolbarExportLCAttachment' ">
            <thead>
                <tr>
                    <th field="AttatchmentName" width="60%">AttatchmentName</th>
                    <th field="Remarks" width="30%">Remarks</th>
                </tr>
            </thead>
        </table>
        <div id="toolbarExportLCAttachment">
            <input type="text" name="ExportLCID" id="txtExportLCIdSubmit" hidden="hidden" />
            <input type="file" id="fileControl" name="file" style="width: 200px;" />
            Remark :
            <input id="txtRemarks" name="Remarks" type="text" />
            <input id="btnSubmitExportLCAttachment" type="submit" value="Upload" style="font-weight: bold;" />
            <input id="btnDeleteExportLCAttachment" type="button" value="Delete" style="font-weight: bold" />
        </div>
    }
    <fieldset class="actionfieldsetstyle">
        <legend>Actions : </legend>
        <table border="0" cellpadding="2" cellspacing="2">
            <tr>
                <td style="width:395px; text-align:left">
                    @using (Html.BeginForm("DownloadAttachment", "ExportLC", FormMethod.Post, new { enctype = "multipart/form-data", target = "_blank" }))
                    {
                        <input type="text" name="ExportLCAttchmentID" id="txtExportLCAttchmentID" hidden="hidden" />
                        <input type="submit" value="Download" id="btnDownload" />
                    }
                </td>
                <td style="width:395px"><a id="btnCloseExportLCAttachment" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-cancel" plain="true">Close</a></td>
            </tr>
        </table>
    </fieldset>
</div>
 </body>

<style type="text/css">
.lines-no .datagrid-body td {
    border-right: 1px dotted transparent;
    border-bottom: 1px dotted transparent;
}
</style>

<script type="text/javascript">
    var _sBaseAddress="";
    var _oExportLC=null;
    var _oExportLCs=[];
    var _oBankBranchs=[];
    var _oCurrencys=[];
    var _oLCTerms=[];
    var _oBusinessUnits=[];
    var _oExportBill=null;
    var _oCompareOperators=[];
    var _oLCStatus=[];
    var _nBUID = 0;
    var _oNotifyBy=[];
    var _nExportTRID = 0;
    var _oExportTR = [];
    var _oLCTypes = [];
    var _nMenuID=0;
    $(document).ready(function () {
        debugger;
        _sBaseAddress =@Html.Raw( new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(HttpContext.Current.Session[SessionInfo.BaseAddress]));
        _oExportLCs =@Html.Raw( new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(Model));
        _oBankBranchs = @Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(ViewBag.BankBranchs));
        _oCurrencys = @Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(ViewBag.Currencys));
        _oLCTerms = @Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(ViewBag.LCTerms));
        _oBusinessUnits= @Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(ViewBag.BusinessUnits));
        _oCompareOperators = @Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(ViewBag.CompareOperators));
        _oLCStatus = @Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(ViewBag.LCStatus));
        _nBUID = @Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(ViewBag.BUID));
        _oNotifyBy = @Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(ViewBag.NotifyBy));
        _oLCTypes = @Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(ViewBag.LCTypes));
        _nMenuID= @Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(@ViewBag.MenuID));

        if(sessionStorage.getItem("ExportLCs")!=null && sessionStorage.getItem("ExportLCs").length>0)
        {
            _oExportLCs= jQuery.parseJSON(sessionStorage.getItem('ExportLCs'));
            var nIndex= sessionStorage.getItem('SelectedRowIndex');
            DynamicRefreshList(_oExportLCs, 'tblExportLCs');

            if(nIndex>-1){
                $('#tblExportLCs').datagrid('selectRow',nIndex);
               RowSelect(nIndex, _oExportLCs[nIndex]);
            }
        }
        else{
            DynamicRefreshList(_oExportLCs, 'tblExportLCs');
        }
        $("#progressbar").progressbar({ value: 0 });
        $("#progressbarParent").hide();
        $("#winAdvSearch").data("oAdvSrc", null);
    });

    $(document).keydown(function (e) { if (e.keyCode == 27) { $('div').icsWindow('close'); } });
    $('#tblExportLCs').datagrid({ onSelect: function (rowIndex, rowData) { RowSelect(rowIndex, rowData); } });

    function RowSelect(rowIndex, rowData) {

        if (rowData.Stability==false) {
            document.getElementById("btnAddBills").style.display = 'none';
        }
        else {
            document.getElementById("btnAddBills").style.display = '';
        }

    }

    $("#btnAddExportLC").click(function () {
        var oExportLCs= $('#tblExportLCs').datagrid('getRows');
        sessionStorage.setItem("ExportLCs", JSON.stringify(oExportLCs));
        sessionStorage.setItem("Operation", "New");
        sessionStorage.setItem("SelectedRowIndex", -1);
        sessionStorage.setItem("ExportLCHeader", "Add Export L/C");
        sessionStorage.setItem("BUID", _nBUID);
        sessionStorage.setItem("BackLink", window.location.href);
        window.location.href = _sBaseAddress+ "/ExportLC/ViewExportLC?id=0&buid="+_nBUID;
    });

    $("#btnEditExportLC").click(function () {
        var oExportLC = $("#tblExportLCs").datagrid("getSelected");
        if (oExportLC == null || parseInt(oExportLC.ExportLCID) <= 0) { alert("Please select an item from list!"); return; }
        var oExportLCs= $('#tblExportLCs').datagrid('getRows');
        sessionStorage.setItem("Operation", "Edit");
        sessionStorage.setItem("ExportLCs", JSON.stringify(oExportLCs));
        var SelectedRowIndex=$('#tblExportLCs').datagrid('getRowIndex',oExportLC);
        sessionStorage.setItem("SelectedRowIndex", SelectedRowIndex);
        sessionStorage.setItem("ExportLCHeader", "Edit Export L/C");
        sessionStorage.setItem("BUID", _nBUID);
        sessionStorage.setItem("BackLink", window.location.href);
        window.location.href = _sBaseAddress+ "/ExportLC/ViewExportLC?id="+parseInt(oExportLC.ExportLCID)+"&buid="+_nBUID;


    });

    $("#btnViewExportLC").click(function () {
        var oExportLC = $("#tblExportLCs").datagrid("getSelected");
        if (oExportLC == null || oExportLC.ExportLCID <= 0) { alert("Please select an item from list!"); return; }
        var oExportLCs= $('#tblExportLCs').datagrid('getRows');
        sessionStorage.setItem("ExportLCs", JSON.stringify(oExportLCs));
        var SelectedRowIndex=$('#tblExportLCs').datagrid('getRowIndex',oExportLC);
        sessionStorage.setItem("Operation", "View");
        sessionStorage.setItem("SelectedRowIndex", SelectedRowIndex);
        sessionStorage.setItem("ExportLCHeader", "View Export L/C");
        sessionStorage.setItem("BUID", _nBUID);
        sessionStorage.setItem("BackLink", window.location.href);
        window.location.href = _sBaseAddress+ "/ExportLC/ViewExportLC?id="+parseInt(oExportLC.ExportLCID)+"&buid="+_nBUID;
    });

    $("#btnApproveLC").click(function () {
        var oExportLC = $("#tblExportLCs").datagrid("getSelected");
        if (oExportLC == null || oExportLC.ExportLCID <= 0) { alert("Please select an item from list!"); return; }
        var oExportLCs= $('#tblExportLCs').datagrid('getRows');
        sessionStorage.setItem("Operation", "Approve");
        sessionStorage.setItem("ExportLCs", JSON.stringify(oExportLCs));
        var SelectedRowIndex=$('#tblExportLCs').datagrid('getRowIndex',oExportLC);
        sessionStorage.setItem("SelectedRowIndex", SelectedRowIndex);
        sessionStorage.setItem("ExportLCHeader", "Approve Export L/C");
        sessionStorage.setItem("BUID", _nBUID);
        sessionStorage.setItem("BackLink", window.location.href);
        window.location.href = _sBaseAddress+ "/ExportLC/ViewExportLC?id="+parseInt(oExportLC.ExportLCID)+"&buid="+_nBUID;
    });

    $("#btnAddAmendmentRecd").click(function () {
        var oExportLC = $("#tblExportLCs").datagrid("getSelected");
        if (oExportLC == null || oExportLC.ExportLCID <= 0) { alert("Please select an item from list!"); return; }
        var oExportLCs= $('#tblExportLCs').datagrid('getRows');
        sessionStorage.setItem("ExportLCs", JSON.stringify(oExportLCs));
        sessionStorage.setItem("Operation", "Amendment");
        var SelectedRowIndex=$('#tblExportLCs').datagrid('getRowIndex',oExportLC);
        sessionStorage.setItem("SelectedRowIndex", SelectedRowIndex);
        sessionStorage.setItem("ExportLCHeader", "Approve Export L/C");
        sessionStorage.setItem("BUID", _nBUID);
        sessionStorage.setItem("BackLink", window.location.href);
        window.location.href = _sBaseAddress+ "/ExportLC/ViewExportLC_Amendment?id="+parseInt(oExportLC.ExportLCID)+"&buid="+_nBUID;
    });

    $("#btnDeleteExportLC").click(function () {

        var oExportLC = $("#tblExportLCs").datagrid("getSelected");
        if (oExportLC == null || oExportLC.ExportLCID <= 0) {
            alert("Invalid Field!!! please select a valid Field!");
            return false;
        }
        if (oExportLC.CurrentStatus >= 2) {
            alert("Sorry, Already Approved.");
            return false;
        }
        if (!confirm("Confirm to Delete?")) return false;
        var obj =
        {
            BaseAddress: _sBaseAddress,
            Object: oExportLC,
            ObjectId: oExportLC.ExportLCID,
            ControllerName: "ExportLC",
            ActionName: "DeleteExportLC",
            TableId: "tblExportLCs",
            IsWinClose: true
        };
        $.icsDelete(obj);
    });

    $("#btnAddAmendmentRequest").click(function () {
        var oExportLC = $("#tblExportLCs").datagrid("getSelected");
        if (oExportLC == null || oExportLC.ExportLCID <= 0) { alert("Please select an item from list!"); return; }
        var oExportLCs= $('#tblExportLCs').datagrid('getRows');
        sessionStorage.setItem("ExportLCs", JSON.stringify(oExportLCs));
        var SelectedRowIndex=$('#tblExportLCs').datagrid('getRowIndex',oExportLC);
        sessionStorage.setItem("SelectedRowIndex", SelectedRowIndex);
        sessionStorage.setItem("ExportLCHeader", "Request for Amendment Export L/C");
        sessionStorage.setItem("BUID", _nBUID);
        sessionStorage.setItem("BackLink", window.location.href);
        window.location.href = _sBaseAddress+ "/ExportLC/ViewExportLC_ARequest?id="+parseInt(oExportLC.ExportLCID)+"&buid="+_nBUID;
    });
    $("#btnAddBills").click(function () {
        var oExportLC = $("#tblExportLCs").datagrid("getSelected");
        if (oExportLC == null || oExportLC.ExportLCID <= 0) { alert("Please select an item from list!"); return; }
        var oExportLCs= $('#tblExportLCs').datagrid('getRows');
        sessionStorage.setItem("ExportLCs", JSON.stringify(oExportLCs));
        var SelectedRowIndex=$('#tblExportLCs').datagrid('getRowIndex',oExportLC);
        sessionStorage.setItem("SelectedRowIndex", SelectedRowIndex);
        sessionStorage.setItem("ExportLCHeader", "Request for Amendment Export L/C");
        sessionStorage.setItem("BUID", _nBUID);
        sessionStorage.setItem("BackLink", window.location.href);
        window.location.href = _sBaseAddress+ "/ExportLC/ViewExportLC_Bills?id="+parseInt(oExportLC.ExportLCID)+"&buid="+_nBUID;
    });
    $("#btnViewExportLCLog").click(function () {
        var oExportLC = $("#tblExportLCs").datagrid("getSelected");
        if (oExportLC == null || oExportLC.ExportLCID <= 0) { alert("Please select an item from list!"); return; }
        var oExportLCs= $('#tblExportLCs').datagrid('getRows');
        sessionStorage.setItem("ExportLCs", JSON.stringify(oExportLCs));
        var SelectedRowIndex=$('#tblExportLCs').datagrid('getRowIndex',oExportLC);
        sessionStorage.setItem("SelectedRowIndex", SelectedRowIndex);
        sessionStorage.setItem("ExportLCHeader", "View All Amendment L/C");
        sessionStorage.setItem("BUID", _nBUID);
        sessionStorage.setItem("BackLink", window.location.href);
        window.location.href = _sBaseAddress+ "/ExportLC/ViewExportLCLogs?id="+parseInt(oExportLC.ExportLCID)+"&buid="+_nBUID;
    });

    $("#btnExportLCUD").click(function () {
        var oExportLC = $("#tblExportLCs").datagrid("getSelected");
        if (oExportLC == null || oExportLC.ExportLCID <= 0) { alert("Please select an item from list!"); return; }
        var oExportLCs= $('#tblExportLCs').datagrid('getRows');
        sessionStorage.setItem("ExportLCs", JSON.stringify(oExportLCs));
        var SelectedRowIndex=$('#tblExportLCs').datagrid('getRowIndex',oExportLC);
        sessionStorage.setItem("SelectedRowIndex", SelectedRowIndex);
        sessionStorage.setItem("ExportLCHeader", "View All Amendment L/C");
        sessionStorage.setItem("BUID", _nBUID);
        sessionStorage.setItem("BackLink", window.location.href);
        window.location.href = _sBaseAddress+ "/ExportLC/ViewExportLCUD?id="+parseInt(oExportLC.ExportLCID)+"&buid="+_nBUID;
    });

    function onClickRowLCCollectionPage(index) {
        var oExportLC = $("#tblExportLCs").datagrid("getSelected");
        if(oExportLC.ExportLCID > 0)
        {
            if(oExportLC.BUID == 1 || oExportLC.BUID == 2) //Spinning || Weaving
            {
                $("#btnAddDOFromLC").show();
            }else{
                $("#btnAddDOFromLC").hide();
            }
        }
    }

    $("#btnAddDOFromLC").click(function(){
        var oExportLC = $("#tblExportLCs").datagrid("getSelected");
        if(oExportLC == null || oExportLC.ExportLCID <= 0)
        {
            alert("Please select an item from list.");
            return false;
        }

        var obj = {};
        if(oExportLC.BUID == 1) //Spinning
        {
            var oSUDeliveryOrder = {
                LCID: oExportLC.ExportLCID
            };

            obj = {
                BaseAddress: _sBaseAddress,
                TableId: "",
                OpenedPageTitle: "Add Delivery Order",
                Object: oSUDeliveryOrder,
                ObjectId: 0 + "~" + oSUDeliveryOrder.LCID,
                PrimaryKeyName: "SUDeliveryOrderID",
                ControllerName: "SUDeliveryOrder",
                ActionName: "View_SUDeliveryOrder",
                BtnID: $(this).attr("id")
            };
        }
        else if(oExportLC.BUID == 2) //Weaving
        {
            var oFabricDeliveryOrder = {
                LCID: oExportLC.ExportLCID
            };

            obj = {
                BaseAddress: _sBaseAddress,
                TableId: "",
                OpenedPageTitle: "Add Fabric Delivery Order",
                Object: oFabricDeliveryOrder,
                ObjectId: 0 + "~" + oFabricDeliveryOrder.LCID, // ObjectID Formate FDOID + "~" + LCID
                PrimaryKeyName: "FDOID",
                ControllerName: "FabricDeliveryOrder",
                ActionName: "ViewFabricDeliveryOrder",
                BtnID: $(this).attr("id")
            };
        }
        $.icsOpenPickerInNewPage(obj);
    });

    //File Attachment
    $("#btnCloseExportLCAttachment").click(function() {
        $("#winExportLCAttachment").icsWindow("close");
    });

    $("#btnDownload").click(function() {
        var oExportLCAttachment = $("#tblExportLCAttachment").datagrid("getSelected");
        if (oExportLCAttachment == null || parseInt(oExportLCAttachment.ExportLCAttachmentID) <= 0) {
            alert("Please select an item from list!");
            return false;
        }
        $('#txtExportLCAttchmentID').val(oExportLCAttachment.ExportLCAttachmentID);
    });

    $("#btnDeleteExportLCAttachment").click(function() {
        var oExportLCAttachment = $("#tblExportLCAttachment").datagrid("getSelected");
        if (oExportLCAttachment == null || parseInt(oExportLCAttachment.ExportLCAttachmentID) <= 0) {
            alert("Please select an item from list!");
            return false;
        }
        if (!confirm("Confirm to Delete?")) return false;
        oExportLCAttachment.AttatchFile = null;
        var obj = {
            BaseAddress: _sBaseAddress,
            Object: oExportLCAttachment,
            ControllerName: "ExportLC",
            ActionName: "DeleteExportLCAttachment",
            TableId: "tblExportLCAttachment",
            IsWinClose: false
        };
        $.icsDelete(obj);
    });

    $("#btnSubmitExportLCAttachment").click(function(e) {
        var oExportLC = $("#tblExportLCs").datagrid("getSelected");
        $("#txtExportLCIdSubmit").val(oExportLC.ExportLCID);
        $("#winExportLCAttachment").icsWindow("close");
    });

    $("#btnAttachment").click(function() {
        var oExportLC = $("#tblExportLCs").datagrid('getSelected');
        if(oExportLC==null || parseInt(oExportLC.ExportLCID)<=0)
        {
            alert("Please select an item from list!");
            return;
        }
        var oExportLCAttachment = {
            ExportLCID : oExportLC.ExportLCID
        };
        $.ajax({
            type: "POST",
            url: _sBaseAddress + "/ExportLC/GetsAttachmentById",
            traditional: true,
            data: JSON.stringify(oExportLCAttachment),
            contentType: "application/json; charset=utf-8",
            success: function (data) {
                var oExportLCAttachments = data;
                if (oExportLCAttachments != null) {
                    if (oExportLCAttachments.length > 0) {
                        DynamicRefreshList(oExportLCAttachments, "tblExportLCAttachment");
                    }
                    else {
                        DynamicRefreshList([], "tblExportLCAttachment");
                    }
                }
            }
        });
        $("#txtExportLCIdSubmit").val('0');
        $("#txtRemarks").val('');
        $("#fileControl").val('');
        $("#winExportLCAttachment").icsWindow("Open","Export LC Attachments");
    });
    $("#btnPrintPreview").click(function() {
        var oExportLC = $("#tblExportLCs").datagrid('getSelected');
        if(oExportLC==null || parseInt(oExportLC.ExportLCID)<=0)
        {
            alert("Please select an item from list!");
            return;
        }
        var nts = ((new Date()).getTime()) / 1000;
        window.open(_sBaseAddress + '/ExportLC/PrintLCStatement?nExportLCID=' + parseInt(oExportLC.ExportLCID)  + "&nts=" + nts, "_blank");
    });
    $("#btnFundAllocation").click(function(e){
        var oExportLC = $("#tblExportLCs").datagrid('getSelected');
        if(oExportLC==null || parseInt(oExportLC.ExportLCID)<=0)
        {
            alert("Please select an item from list!");
            return;
        }
        var sURL = sessionStorage.getItem("BaseAddress")+ "/ExportFundAllocation/ViewExportFundAllocation?menuid="+_nMenuID+"&nid="+parseInt(oExportLC.ExportLCID);
        window.open(sURL,'_blank');
    });
    $("#btnPrintLCStatement").click(function() {
        var oExportLC = $("#tblExportLCs").datagrid('getSelected');
        if(oExportLC==null || parseInt(oExportLC.ExportLCID)<=0)
        {
            alert("Please select an item from list!");
            return;
        }
        var nts = ((new Date()).getTime()) / 1000;
        window.open(_sBaseAddress + '/ExportLC/PrintLCReceiving?nExportLCID=' + parseInt(oExportLC.ExportLCID)  + "&nts=" + nts, "_blank");
    });

    var editIndexDocForwarding = undefined;
    function endEditingDocForwarding() {
        if (editIndexDocForwarding == undefined) {
            return true;
        }
        if ($('#tblExportDocForwarding').datagrid('validateRow', editIndexDocForwarding)) {
            $('#tblExportDocForwarding').datagrid('endEdit', editIndexDocForwarding);
            $('#tblExportDocForwarding').datagrid('selectRow', editIndexDocForwarding);

            editIndexDocForwarding = undefined;
            return true;
        }
        else {
            return false;
        }
    }

    function onClickRowDocForwarding(index) {
        if (editIndexDocForwarding != index) {
            if (endEditingDocForwarding()) {
                $('#tblExportDocForwarding').datagrid('selectRow', index)
                        .datagrid('beginEdit', index);
                editIndexDocForwarding = index;
            }
            else {
                $('#tblExportDocForwarding').datagrid('selectRow', editIndexDocForwarding);
            }
        }
    }


    ////Start adv Searching

    function updateProgress() {
        var value =$('#progressbar').progressbar('getValue');
        if (value < 96){
            value += Math.floor(Math.random() * 10);
            $('#progressbar').progressbar('setValue', value);
        }
    }
    function hideShow(miliseconds) {
        $("#progressbarParent").hide();
    }
    //Account Of Picker

    $("#txtContractorAdvS").keydown(function (e) {
        if (e.keyCode === 13) // Enter Press
        {
            PickContractors_AdvS();
        }
        else if (e.keyCode === 08) {
            $("#txtContractorAdvS").removeClass("fontColorOfPickItem");
            _sContractorIds = '';
        }
    });

    $("#btnClrContractorAdvS").click(function () {
        $("#txtContractorAdvS").removeClass("fontColorOfPickItem");
        $("#txtContractorAdvS").val("");
        _sContractorIds = '';
    });

    $("#btnPickContractorAdvS").click(function () {
        PickContractors_AdvS();
    });
    function PickContractors_AdvS() {
        var oContractor = {
            Params: '2,3' + '~' + $.trim($("#txtContractorAdvS").val()+"~"+_nBUID)
        };
        var obj = {
            BaseAddress: _sBaseAddress,
            Object: oContractor,
            ControllerName: "Contractor",
            ActionName: "ContractorSearchByNameType",
            IsWinClose: false
        };

        $("#progressbar").progressbar({ value: 0 });
        $("#progressbarParent").show();
        var intervalID = setInterval(updateProgress, 250);

        DynamicRefreshList([], "tblAccountsPickerAdvSearch");
        $.icsDataGets(obj, function (response) {
            clearInterval(intervalID);
            $("#progressbarParent").hide();
            if (response.status && response.objs.length > 0) {
                if (response.objs[0].ContractorID > 0) {
                    var tblColums = []; var oColumn = { field: "ContractorID", title: "Code", width: 50, align: "left" }; tblColums.push(oColumn);
                    oColumn = { field: "Name", title: "Name", width: 280, align: "left" }; tblColums.push(oColumn);

                    var oPickerParam = {
                        winid: 'winContractorPicker',
                        winclass: 'clsAccountOf',
                        winwidth: 400,
                        winheight: 460,
                        tableid: 'tblAccountOfs',
                        tablecolumns: tblColums,
                        datalist: response.objs,
                        multiplereturn: true,
                        searchingbyfieldName: 'Name',
                        windowTittle: 'Contactor List'
                    };
                    $.icsPicker(oPickerParam);
                    IntializePickerbutton(oPickerParam);
                }
                else {
                    alert(response.objs[0].ErrorMessage);
                }
            }
            else {
                alert("Sorry, No Contactor Found.");
            }
        });
    }
    //End Account Of Picker
    $("#txtBankBranch_Issue").keydown(function (e) {
        if (e.keyCode === 13) // Enter Press
        {
            if($("#txtBankBranch_Issue").val()=="" || $("#txtBankBranch_Issue").val()==null)
            {
                $("#txtBankBranch_Issue").removeClass("fontColorOfPickItem");
                _sBankBranch_IssueIds = '';
                alert("Please, Type name")
                return;
            }

            var oBankBranch = {
                BUID: _nBUID,
                DeptIDs: '5',//EnumOperationalDept : Export_Party=5
                BankName: $.trim($("#txtBankBranch_Issue").val())
            };
            PickBanks_AdvS(oBankBranch);
        }
        else if (e.keyCode === 08) {
            $("#txtBankBranch_Issue").removeClass("fontColorOfPickItem");
            _sBankBranch_IssueIds = '';
        }
    });

    $("#btnClrBankBranch_Issue").click(function () {
        $("#txtBankBranch_Issue").removeClass("fontColorOfPickItem");
        $("#txtBankBranch_Issue").val("");
        _sBankBranch_IssueIds = '';
    });

    $("#btnPickBankBranch_Issue").click(function () {
        var oBankBranch = {
            BUID: _nBUID,
            DeptIDs: '5',//EnumOperationalDept : Export_Party=5
            BankName: $.trim($("#txtBankBranch_Issue").val())
        };
        PickBanks_AdvS(oBankBranch);
    });
    function PickBanks_AdvS(oBankBranch) {

        var obj = {
            BaseAddress: _sBaseAddress,
            Object: oBankBranch,
            ControllerName: "BankBranch",
            ActionName: "GetsBankBranchSearchByBankName",
            IsWinClose: false
        };

        $("#progressbar").progressbar({ value: 0 });
        $("#progressbarParent").show();
        var intervalID = setInterval(updateProgress, 250);

        $.icsDataGets(obj, function (response) {
            clearInterval(intervalID);
            $("#progressbarParent").hide();
            if (response.status && response.objs.length > 0) {
                if (response.objs[0].BankBranchID > 0) {
                    var tblColums = []; var oColumn = { field: "BankName", title: "Bank Name", width: 200, align: "left" }; tblColums.push(oColumn);
                    oColumn = { field: "BranchName", title: "Branch Name", width: 280, align: "left" }; tblColums.push(oColumn);
                    oColumn = { field: "Address", title: "Address", width: 280, align: "left" }; tblColums.push(oColumn);

                    var oPickerParam = {
                        winid: 'winBankBranch_IssuePicker',
                        winclass: 'clsBankBranch_Issue',
                        winwidth: 500,
                        winheight: 460,
                        tableid: 'tblBankBranch_Issues',
                        tablecolumns: tblColums,
                        datalist: response.objs,
                        multiplereturn: true,
                        searchingbyfieldName: 'BranchName',
                        windowTittle: 'Bank List'
                    };
                    $.icsPicker(oPickerParam);
                    IntializePickerbutton(oPickerParam);
                }
                else {
                    alert(response.objs[0].ErrorMessage);
                }
            }
            else {
                alert("Sorry, No Contactor Found.");
            }
        });
    }

    //EndIssue Bank

    function IntializePickerbutton(oPickerobj) {
        $("#" + oPickerobj.winid).find("#btnOk").click(function () {
            SetPickerValueAssign(oPickerobj);
        });
        $(document).find('.' + oPickerobj.winclass).keydown(function (e) {
            if (e.which === 13) {
                SetPickerValueAssign(oPickerobj);
            }
        });
    }

    function SetPickerValueAssign(oPickerobj) {
        var oreturnObj = null, oreturnObjs = [];
        if (oPickerobj.multiplereturn) {
            oreturnObjs = $('#' + oPickerobj.tableid).datagrid('getChecked');
        } else {
            oreturnObj = $('#' + oPickerobj.tableid).datagrid('getSelected');
        }

        if (oPickerobj.winid == 'winContractorPicker')
        {
            if (oreturnObjs != null && oreturnObjs.length> 0)
            {

                _sContractorIds=''; var sMessage='';
                sMessage=(oreturnObjs.length>1)? oreturnObjs.length +" Contractors Selected" : oreturnObjs[0].Name;
                $('#txtContractorAdvS').val(sMessage);
                $("#txtContractorAdvS").addClass("fontColorOfPickItem");

                for(var i=0;i<oreturnObjs.length;i++){
                    _sContractorIds=_sContractorIds+oreturnObjs[i].ContractorID+',';
                }
                _sContractorIds=_sContractorIds.substring(0,_sContractorIds.length-1);

            }
            else
            {
                alert("Please select a contractor.");
                return false;
            }
        }

        else if (oPickerobj.winid == 'winBankBranch_IssuePicker') {
            if (oreturnObjs != null && oreturnObjs.length> 0)
            {
                var sMessage='';
                sMessage=(oreturnObjs.length>1)? oreturnObjs.length +" Bank(s) Selected" : oreturnObjs[0].BankName;
                $('#txtBankBranch_Issue').val(sMessage);
                $("#txtBankBranch_Issue").addClass("fontColorOfPickItem");

                for(var i=0;i<oreturnObjs.length;i++){
                    _sBankBranch_IssueIds=_sBankBranch_IssueIds+oreturnObjs[i].BankBranchID+',';
                }
                _sBankBranch_IssueIds=_sBankBranch_IssueIds.substring(0,_sBankBranch_IssueIds.length-1);
            }
            else
            {
                alert("Please select a Bank Branch.");
                return false;
            }
        }

        $("#" + oPickerobj.winid).icsWindow("close");
        $("#" + oPickerobj.winid).remove();
    }

    //End Buyer Search
    $("#btnResetAdvSearch").click(function () {
        ResetAdvSearchWindow();
        LoadComboAdv();
    });

    $("#btnSearchAdvSearch").click(function () {
        $(".lblLoadingMessage").show();
        var sStatusIds = "";
        var sLCNo = "";
        var oLCStatus = $("#tblExportLCStatusAdv").datagrid("getChecked");
        if (oLCStatus.length > 0)
        {
            for (var i = 0;i<oLCStatus.length; i++){
                sStatusIds = oLCStatus[i].id + "," + sStatusIds;
            }
            sStatusIds = sStatusIds.substring(0, sStatusIds.length - 1);
        }


        var sTempString = $.trim($("#txtExportPINoAS").val()) + '~'
                        + $.trim($("#txtFileNoAS").val()) + '~'
                        + _sContractorIds + '~'
                        + $("#cboBankBranch_Nego").val() + '~'
                        + $("#cboBankBranch_Advise").val() + '~'
                        + _sBankBranch_IssueIds + '~'
                        + $("#cboDateOpening").val() + '~'
                        + $("#txtFromOpeningDate").datebox("getValue") + '~'
                        + $("#txtToOpeningDate").datebox("getValue") + '~'
                         + $("#cboLCRecivedDate").val() + '~'
                        + $("#txtFromLCRecivedDate").datebox("getValue") + '~'
                        + $("#txtToLCRecivedDate").datebox("getValue") + '~'
                         + $("#cboShipmentDate").val() + '~'
                        + $("#txtfromShipmentDate").datebox("getValue") + '~'
                        + $("#txtTofromShipmentDate").datebox("getValue") + '~'
                         + $("#cboExpireDate").val() + '~'
                        + $("#txtFromExpireDate").datebox("getValue") + '~'
                        + $("#txtToExpireDate").datebox("getValue") + "~"
                        + $("#cboAmendmentDate").val() + '~'
                        + $("#txtFromAmendmentDate").datebox("getValue") + '~'
                        + $("#txtToAmendmentDate").datebox("getValue") + "~"  //20
                         + sStatusIds + "~"
                         + _nBUID + "~"
                        + parseInt($("#cboUDRecd").val()) + "~"
                        + parseInt($("#cboHaveQuery").val()) + "~"
                        + parseInt($("#cboGetOriginalCopy").val()) + "~"
                        + $("#chkExportDoIsntCreateYet").is(':checked') + "~"
                        + $("#chkDeliveryChallanIssueButBillNotCreated").is(':checked') + "~"
                        + sLCNo + "~"
                        + $("#chkLCInHand").is(':checked') + "~"

        var oExportLC = {
            ErrorMessage: sTempString,
            ExportLCType: parseInt($("#cboLCType").val())
        }
        $("#winAdvSearch").data("oAdvSrc", oExportLC);
        $.ajax({
            type: "POST",
            dataType: "json",
            url: _sBaseAddress + "/ExportLC/AdvanchSearch",
            traditional: true,
            data: JSON.stringify(oExportLC),
            contentType: "application/json; charset=utf-8",
            success: function (data) {
                debugger;
                var oExportLCs = data;
                if (oExportLCs.length > 0) {
                    DynamicRefreshList(oExportLCs, "tblExportLCs");
                    $("#winAdvSearch").icsWindow("close");
                } else {
                    alert("Sorry, No data found.");
                    DynamicRefreshList([], "tblExportLCs");
                }

                $(".lblLoadingMessage").hide();

            }
        });
    });
    function LoadComboAdv()
    {
        $("#cboBankBranch_Nego,#cboBankBranch_Advise").icsLoadCombo({List: _oBankBranchs, OptionValue: "BankBranchID", DisplayText: "BankBranchName"});
        DynamicRefreshList(_oLCStatus, "tblExportLCStatusAdv");
        $("#cboDateOpening, #cboAmendmentDate, #cboLCRecivedDate,#cboShipmentDate,#cboExpireDate").icsLoadCombo({List: _oCompareOperators, OptionValue: "id",DisplayText: "Value" });
        $("#cboLCType").icsLoadCombo({List: _oLCTypes, OptionValue: "id", DisplayText: "Value"});
    }
    function ResetAdvSearchWindow() {
        _sContractorIds = '';
        _sBankBranch_IssueIds = "";
        $(".lblLoadingMessage").hide();
        $("#winAdvSearch input").not("input[type='button']").val("");
        $("#winAdvSearch input").removeClass("fontColorOfPickItem");
        $("#winAdvSearch select").val(0);
        DateActions_LCOpen();
        DateActions_AmendmentDate();
        DateActions_LCRecivedDate();
        DateActions_ShipmentDate();
        DateActions_ExpireDate();
        $("#txtFromOpeningDate,#txtToOpeningDate,#txtFromAmendmentDate,#txtToAmendmentDate,#txtFromLCRecivedDate,#txtToLCRecivedDate,#txtfromShipmentDate,#txtTofromShipmentDate,#txtFromExpireDate,#txtToExpireDate").datebox({ disabled: true });
        $("#txtFromOpeningDate,#txtToOpeningDate,#txtFromAmendmentDate,#txtToAmendmentDate,#txtFromLCRecivedDate,#txtToLCRecivedDate,#txtfromShipmentDate,#txtTofromShipmentDate,#txtFromExpireDate,#txtToExpireDate").datebox("setValue", icsdateformat(new Date()));
    }

    function MakeStringIDs(StringIDs) {

        var IDs = "";
        for (var i = 0; i < StringIDs.length; i++) {
            IDs = StringIDs[i].id + "," + IDs;
        }
        var length = 0;
        length = parseInt(IDs.length) - 1;
        IDs = IDs.substring(0, parseInt(length));
        return IDs;
    }

    function CheckFromAndToDateValidation(OperationComboId, FromDateId, ToDateId) {
        $("#" + OperationComboId).parent().parent().parent().find("select").removeClass("errorFieldBorder");
        var nCboVal = $("#" + OperationComboId).val();
        if (parseInt(nCboVal) == 5 || parseInt(nCboVal) == 6) {
            var fromDate = $("#" + FromDateId).datebox("getValue");
            var toDate = $("#" + ToDateId).datebox("getValue");
            if (new Date(fromDate) > new Date(toDate)) {
                $("#" + ToDateId).focus();
                $("#" + OperationComboId).addClass("errorFieldBorder");
                $(".lblLoadingMessage").hide();
                return false;
            } else {
                $("#" + OperationComboId).removeClass("errorFieldBorder");
                return true;
            }
        } else {
            return true;
        }
    }

    function DateActions_LCOpen() {
        DynamicDateActions("cboDateOpening", "txtFromOpeningDate", "txtToOpeningDate");
    }
    function DateActions_AmendmentDate() {
        DynamicDateActions("cboAmendmentDate", "txtFromAmendmentDate", "txtToAmendmentDate");
    }
    function DateActions_LCRecivedDate() {
        DynamicDateActions("cboLCRecivedDate", "txtFromLCRecivedDate", "txtToLCRecivedDate");
    }
    function DateActions_ShipmentDate() {
        DynamicDateActions("cboShipmentDate", "txtfromShipmentDate", "txtTofromShipmentDate");
    }
    function DateActions_ExpireDate() {
        DynamicDateActions("cboExpireDate", "txtFromExpireDate", "txtToExpireDate");
    }

    $("#btnCloseAdvSearch").click(function () {
        $("#winAdvSearch").icsWindow("close");
    });
    $("#btnAdvSearch").click(function () {
        debugger;
        $("#winAdvSearch").icsWindow("open", "Export L/C Advance Search");
        //DynamicRefreshList([], "tblExportPIAdvSearch");
        DynamicResetAdvSearchWindow("winAdvSearch");
        ResetAdvSearchWindow();
        LoadComboAdv();
    });
    /// end Adv Searching

    //// Party info
    $("#btnUpdatePartyInfo").click(function () {
        var oExportLC = $("#tblExportLCs").datagrid("getSelected");
        if (oExportLC == null || parseInt(oExportLC.ExportLCID) <= 0) { alert("Please select an item from list!"); return; }

        var oExportLCs= $('#tblExportLCs').datagrid('getRows');
        sessionStorage.setItem("ExportLCs", JSON.stringify(oExportLCs));
        var SelectedRowIndex=$('#tblExportLCs').datagrid('getRowIndex',oExportLC);
        sessionStorage.setItem("SelectedRowIndex", SelectedRowIndex);
        sessionStorage.setItem("ExportLCHeader", "Party Info");
        sessionStorage.setItem("BUID", _nBUID);
        sessionStorage.setItem("BackLink", window.location.href);
        window.open(sessionStorage.getItem("BaseAddress") + '/ExportPartyInfo/ViewPartyWiseExportInfoLC?pid=' + parseInt(oExportLC.ExportLCID), '_blank');

    });
    $("#btnExportDocTnC").click(function () {
        var oExportLC = $("#tblExportLCs").datagrid("getSelected");
        if (oExportLC == null || oExportLC.ExportLCID <= 0) { alert("Please select an item from list!"); return; }
        oExportLC.RefTypeInInt = 2;//EnumMasterLCType:1:MasterLC;2:ExportLC  don't remove this code without ask developer;
        $("#cboNotifyBy").icsLoadCombo({
            List: _oNotifyBy,
            OptionValue: "id",
            DisplayText: "Value"
        });
        _oExportLC = oExportLC;
        $("#winExportDocTnC").icsWindow('open', "Export LC format Setup");
        GetFormatInformation(oExportLC);
    });
    $("#btnCloseExportTR").click(function () {
        $("#winExportTR").icsWindow("close");
    });
    $("#btnCloseExportDocTnC").click(function () {
        $("#winExportDocTnC").icsWindow("close");
        $("#winExportDocTnC input").val("");
        $("#winExportDocTnC select").val(0);
    });
    $("#btnPickExportTruckReceipt").click(function () {
        PickExportTR();
    });

    $("#btnSaveExportDocTnC").click(function (e) {
        // if (!ValidateInputExportBill()) return;
        //ratin
        endEditingDocForwarding();
        var oExportDocTnC = {
            ReferenceID: (_oExportLC != null) ? _oExportLC.ExportLCID : 0,
            RefTypeInInt:2,//ExportLC:2
            ExportDocTnCID: (_oExportDocTnC!= null) ? _oExportDocTnC.ExportDocTnCID:0,
            ExportTRID: _nExportTRID,
            IsPrintGrossNetWeight: $("#chkIsPrintGrossNetWeight").is(':checked'),
            IsPrintOriginal: $("#chkIsPrintOriginal").is(':checked'),
            DeliveryBy: $("#txtDeliveryBy").val(),
            IsDeliveryBy: $("#chkIsDeliveryBy").is(':checked'),
            Term: $("#txtTerm").val(),
            //CTPApplicant: $("#txtCTPApplicant").val(),
            //GRPNonDate: $("#txtGRPNonDate").val(),
            //Certification: $("#txtCertificationt").val(),
            IsTerm: $("#chkIsTerm").is(':checked'),
            MeasurementCarton: $("#txtMeasurementCarton").val(),
            PerCartonWeight: $("#txtPerCartonWeight").val(),
            NotifyByInt: parseInt($("#cboNotifyBy").val()),
            ExportPartyInfoBills: $('#tblPartyInfo').datagrid('getChecked'),
            ExportDocForwardings: $('#tblExportDocForwarding').datagrid('getChecked')
        };

        var obj =
            {
                BaseAddress: _sBaseAddress,
                Object: oExportDocTnC,
                ObjectId: oExportDocTnC.ReferenceID,
                RefTypeInInt:2,//exportLC
                ControllerName: "ExportDocTnC",
                ActionName: "Save",
                TableId: "tblExportLCs",
                IsWinClose: true
            };
        $.icsSave(obj);
    });
    function GetFormatInformation(oExportLC) {

        for (var i = 0;i<_oBusinessUnits.length; i++){
            if(oExportLC.BUID== _oBusinessUnits[i].BusinessUnitID)
            {
                if( _oBusinessUnits[i].BusinessUnitTypeInInt==5||  _oBusinessUnits[i].BusinessUnitTypeInInt==6)
                {
                    document.getElementById("lblBagWeight").innerHTML = "Per yds Weight in GM";
                    document.getElementById("lblWeightPerBag").innerHTML = "Per Roll Length(Y)";
                }
                else{
                    document.getElementById("lblBagWeight").innerHTML = "Bag/Packet Weight";
                    document.getElementById("lblWeightPerBag").innerHTML = "Weight per Bag/Packet";
                }
            }
        }


        var obj =
        {
            BaseAddress: _sBaseAddress,
            Object: oExportLC,
            ControllerName: "ExportDocTnC",
            ActionName: "Get_ExportDocTnCSetupExportLC",
            IsWinClose: false
        };

        $.icsDataGet(obj, function (response) {

            if (response.status && response.obj != null) {
                if (response.obj.ReferenceID> 0) { RefreshControl_ExportLCFormatInfo(response.obj); }
                else { alert(response.obj.ErrorMessage); }
            }
            else {

                alert("No information found.");
            }
        });
    }

    function RefreshControl_ExportLCFormatInfo(oExportDocTnC) {
        _oExportLC = oExportDocTnC.ExportLC;
        _oExportDocTnC = oExportDocTnC;
        _nExportTRID = oExportDocTnC.ExportTRID;
        $("#txtTruckReceiptNo").val(oExportDocTnC.TruckReceiptNo);
        $("#txtTruckReceiptDate").val(oExportDocTnC.TruckReceiptDateInString);
        $("#txtCarrier").val(oExportDocTnC.Carrier);
        $("#txtTruckNo").val(oExportDocTnC.TruckNo);
        $("#txtDriverName").val(oExportDocTnC.DriverName);
        $("#txtDeliveryBy").val(oExportDocTnC.DeliveryBy);
        $("#txtTerm").val(oExportDocTnC.Term);
        //$("#txtCTPApplicant").val(oExportDocTnC.CTPApplicant),
        //$("#txtGRPNonDate").val(oExportDocTnC.GRPNonDate),
        //$("#txtCertificationt").val(oExportDocTnC.Certification),
        $("#chkIsPrintGrossNetWeight").prop("checked", oExportDocTnC.IsPrintGrossNetWeight);
        $("#chkIsPrintOriginal").prop("checked", oExportDocTnC.IsPrintOriginal);
        $("#chkIsDeliveryBy").prop("checked", oExportDocTnC.IsDeliveryBy);
        $("#chkIsTerm").prop("checked", oExportDocTnC.IsTerm);
        $("#txtMeasurementCarton").val(oExportDocTnC.MeasurementCarton);
        $("#txtPerCartonWeight").val(oExportDocTnC.PerCartonWeight);
        $("#cboNotifyBy").val(oExportDocTnC.NotifyByInt);
        //forwarding
        data = oExportDocTnC.ExportDocForwardings;
        data = { "total": "" + data.length + "", "rows": data };
        $('#tblExportDocForwarding').datagrid('loadData', data);
        CheckExistingForwardingInfo();
        //party info set
        data = oExportDocTnC.ExportPartyInfoBills;
        data = { "total": "" + data.length + "", "rows": data };
        $('#tblPartyInfo').datagrid('loadData', data);
        CheckExistingPartyInfo();

        //  $('#txtPerCartonWeight').numberbox('setValue', oExportDocTnC.PerCartonWeight);
    }
    function CheckExistingPartyInfo() {
        var oExportPartyInfoBills = $('#tblPartyInfo').datagrid('getRows');
        if (oExportPartyInfoBills.length > 0) {
            for (var i = 0; i < oExportPartyInfoBills.length; i++) {
                if (Boolean(oExportPartyInfoBills[i].Selected)) {
                    $('#tblPartyInfo').datagrid('checkRow', i);
                }
            }
        }
    }


    function CheckExistingForwardingInfo() {
        var oExportDocForwardings = $('#tblExportDocForwarding').datagrid('getRows');
        if (oExportDocForwardings.length > 0) {
            for (var i = 0; i < oExportDocForwardings.length; i++) {
                if (Boolean(oExportDocForwardings[i].Selected)) {
                    $('#tblExportDocForwarding').datagrid('checkRow', i);
                }
            }
        }
    }
    function PickExportTR() {
        var oExportTR = {
            ExportTRID: 0,
            BUID: _nBUID
        };
        var obj = {
            BaseAddress: _sBaseAddress,
            Object: oExportTR,
            ControllerName: "ExportTR",
            ActionName: "PickExportTRs",
            IsWinClose: false
        };
        DynamicRefreshList([], "tblExportTRs");
        $.icsDataGets(obj, function (response) {
            if (response.status && response.objs.length > 0) {
                if (response.objs[0].ExportTRID > 0) {
                    _oExportTR = []; _oExportTR = response.objs;
                    DynamicRefreshList(response.objs, "tblExportTRs");
                    $("#winExportTR").icsWindow('open', "Export TR Search");
                    $("#divExportTR").focus();
                    $("#winExportTR input").val("");
                }
                else {
                    _oExportTR = [];
                    DynamicRefreshList([], "tblExportTRs");
                    alert(response.objs[0].ErrorMessage);
                    // $("#txtSearchByAccountOfAdvSearch").removeClass("fontColorOfPickItem");
                    _nExportTRID = 0;
                }
            }
            else {
                alert("Sorry, No data found, Try again.");
                // $("#txtSearchByAccountOfAdvSearch").removeClass("fontColorOfPickItem");
                _nExportTRID = 0;
            }
        });
    }
    $("#btnOkExportTR").click(function () {
        var oExportTR = $("#tblExportTRs").icsGetSelectedItem();
        if (oExportTR != null && oExportTR.ExportTRID > 0) {
            _nExportTRID = oExportTR.ExportTRID;
            RefreshControl_ExportTR(oExportTR);
        }
    });
    function RefreshControl_ExportTR(oExportTR) {

        $("#txtTruckReceiptNo").val(oExportTR.TruckReceiptNo);
        $("#txtTruckReceiptDate").val(oExportTR.TruckReceiptDateInString);
        $("#txtCarrier").val(oExportTR.Carrier);
        $("#txtTruckNo").val(oExportTR.TruckNo);
        $("#txtDriverName").val(oExportTR.DriverName);

    }
    ///


    /////
    $("#btnGetOrginalCopy").click(function () {
        var oExportLC = $("#tblExportLCs").datagrid("getSelected");
        if (oExportLC == null || parseInt(oExportLC.ExportLCID) <= 0) { alert("Please select an item from list!"); return; }

        if (!confirm("Confirm to Get orginal Copy?")) return false;
        var nRowIndex = $('#tblExportLCs').datagrid('getRowIndex', oExportLC);

        $.ajax({
            type: "POST",
            dataType: "json",
            url: _sBaseAddress + "/ExportLC/UpdateForGetOrginalCopy",
            traditional: true,
            data: JSON.stringify(oExportLC),
            contentType: "application/json; charset=utf-8",
            success: function (data) {
                //
                var oExportLC = jQuery.parseJSON(data);
                if (oExportLC.ErrorMessage == "" || oExportLC.ErrorMessage == null) {
                    alert("Successfully Change Get Orginal copy");
                    $('#tblExportLCs').datagrid('updateRow', { index: nRowIndex, row: oExportLC });
                } else {
                    alert(oExportLC.ErrorMessage);
                }
            },
            error: function (xhr, status, error) {
                alert(error);
            }
        });
    });
    $("#btnExportLCStatusUpdate").click(function () {
        $("#cboLCStatus, #cboLCStatus_Update").icsLoadCombo({List: _oLCStatus, OptionValue: "id",DisplayText: "Value" });
        var oExportLC = $("#tblExportLCs").datagrid("getSelected");
        if (oExportLC == null || parseInt(oExportLC.ExportLCID) <= 0) { alert("Please select an item from list!"); return; }
        $("#winExportLCStatusUpdate").icsWindow('open', "Export L/C Status Change");

        GetExportLCInformation(oExportLC);
    });

    function GetExportLCInformation(oExportLC) {
        var obj =
        {
            BaseAddress: _sBaseAddress,
            Object: oExportLC,
            ControllerName: "ExportLC",
            ActionName: "GetExportLC",
            IsWinClose: false
        };
        $.icsDataGet(obj, function (response) {
            if (response.status && response.obj != null) {
                if (response.obj.ExportLCID > 0)
                {$("#cboLCStatus,#cboLCStatus_Update").val(response.obj.CurrentStatusInInt); }
                else { alert(response.obj.ErrorMessage); }
            }
            else { alert("No information found."); }
        });
    }
    $("#btnSaveExportLCStatusUpdate").click(function (e) {
        var oExportLC = $("#tblExportLCs").datagrid("getSelected");
        if (oExportLC == null || parseInt(oExportLC.ExportLCID) <= 0) { alert("Please select an item from list!"); return; }
        var nRowIndex = $("#tblExportLCs").datagrid("getRowIndex", oExportLC);
        if(parseInt($("#cboLCStatus_Update").val())==7)
        {
            if (!confirm("Confirm to Cancel This L/C?. (Please Checked its PI status after Cancel. and All of Commerciel invoice must be cancel)")) return false;
        }
        else
        {
            if (!confirm("Confirm to Change Status?")) return false;
        }

        var oExportLC = {
            ExportLCID:oExportLC.ExportLCID,
            SLNo: parseInt($("#cboLCStatus_Update").val()),
            Remark: $("#txtNoteUpdateStatus").val()
        };
        var obj =
            {
                BaseAddress: _sBaseAddress,
                Object: oExportLC,
                ObjectId: oExportLC.ExportLCID,
                ControllerName: "ExportLC",
                ActionName: "Save_ExportLCStatusUpdate",
                TableId: "tblExportLCs",
                IsWinClose: true
            };
        $.icsSave(obj, function (response) {
            if (response.status) {
            }
        });
    });
    $("#btnCloseExportLCStatusUpdate").click(function () {
        $("#winExportLCStatusUpdate").icsWindow("close");
    });


    /// Search By No and Date
    $('#txtSearchbyLCNo').keypress(function (e) {

        var code = (e.keyCode ? e.keyCode : e.which);
        if (code == 13)//Enter key-13
        {
            if ($.trim($("#txtSearchbyLCNo").val()) == "")
            {
                alert("Please give LC No.");
                return false;
            }

            var oExportLC =
            {
                ExportLCID: 0,
                BUID:_nBUID,
                ExportLCNo: $.trim($("#txtSearchbyLCNo").val())
            };
            Gets_byLCNo(oExportLC);
        }

    });
    function Gets_byLCNo(oExportLC) {
        var obj =
        {
            BaseAddress: _sBaseAddress,
            Object: oExportLC,
            ControllerName: "ExportLC",
            ActionName: "GetbyLCNo",
            IsWinClose: false
        };
        $.icsDataGets(obj, function (response) {
            if (response.status && response.objs.length > 0) {
                if (response.objs.length > 0) {
                    DynamicRefreshList(response.objs, "tblExportLCs");
                }
                else {
                    DynamicRefreshList([], "tblExportLCs");
                }
            } else {
                DynamicRefreshList([], "tblExportLCs");
            }
        });
    }
    $("#btnSearchLC").click(function () {
        var oExportLC = {
            IsRecDateSearch: true,
            LCRecivedDate: $('#txtLCRecDate').datebox('getValue'),
            BUID: _nBUID,
            ExportLCNo: ""
        }
        Gets_byLCNo(oExportLC);
    });
    /// End Search

    $("#btnPrintListInXL").click(function () {
        debugger;
        var oObj = $("#winAdvSearch").data("oAdvSrc");
        if(oObj == null)
        {
            alert("Please Search Data First!");
            return;
        }

        $.ajax({
            type: "POST",
            dataType: "json",
            url : _sBaseAddress+  "/ExportLC/SetDataInSession",
            traditional: true,
            data:  JSON.stringify(oObj),
            contentType: "application/json; charset=utf-8",
            success: function (data) {
                var sFeedBackMessage = jQuery.parseJSON(data);
                if (sFeedBackMessage==="Successful")
                {
                    window.open(_sBaseAddress+ "/ExportLC/PrintListInXL?nBUID="+_nBUID, "_blank");
                }
            },
            error: function (xhr, status, error) {
                alert(error);
            }
        });
    });

</script>





