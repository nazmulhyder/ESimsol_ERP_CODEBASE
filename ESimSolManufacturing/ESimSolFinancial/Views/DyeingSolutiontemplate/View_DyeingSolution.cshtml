@model IEnumerable<ESimSol.BusinessObjects.DyeingSolution>
@{
    ViewBag.Title = "View_DyeingProcess";
}
<div class="menuMainCollectionTable">
    <table id="tblDyeingSolution" title="Dyeing Solution" class="easyui-datagrid" style="width: 100%; height: 100%" fitcolumns="false" rownumbers="true" pagination="false" singleselect="true" autorowheight="false" toolbar="#toolbar">
        <thead>
            <tr>
                <th field="Name" width="25%" align="left">Name</th>
                <th field="Description" width="35%" align="left">Note</th>
                <th field="AdviseBy" width="20%" align="left">Advised By</th>
            </tr>
        </thead>
    </table>

    <div id="toolbar">
        <input id="txtName" type="text" style="width:180px" placeholder="Search Dyeing Solution" />
        <a id="btnAdd" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-add" plain="true">New</a>
        <a id="btnEdit" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-edit" plain="true">Edit</a>
        <a id="btnDelete" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-remove" plain="true">Delete</a>
        <a id="btnTemplate" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-add" plain="true">Add Template</a>
        <a id="btnCopy" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-copy" plain="true">Copy</a>
    </div>

    <div id="winDyeingSolution" class="easyui-window winstyle" title="Dyeing Solution" style="width:450px; height:auto" data-options="modal:true,closed:true,collapsible:false,minimizable:false,maximizable:false,closable:false">
        <div style="width: 98%; font-family: Tahoma;">
            <table class="tbl-Win">
                <tr>
                    <td class="td-Win-Level">
                        Name :
                    </td>
                    <td class="td-Win-Input">
                        <input id="txtSolutionName" class="reset-text" placeholder="Solution Name" />
                    </td>
                </tr>
                <tr>
                    <td class="td-Win-Level">
                        Note :
                    </td>
                    <td class="td-Win-Input">
                        <input id="txtNote" class="reset-text" placeholder="Note" />
                    </td>
                </tr>
                <tr>
                    <td class="td-Win-Level">
                        Advise By :
                    </td>
                    <td class="td-Win-Input">
                        <input id="txtAdviseBy" class="reset-text" placeholder="Advise By" />
                    </td>
                </tr>
                <tr>
                    <td colspan="2" style="text-align:right; padding-top:10px; padding-bottom:10px;">
                        <a id="btnSaveDyeingSolution" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-save" plain="true">Save</a>
                        <a id="btnCloseDyeingSolution" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-cancel" plain="true">Close</a>
                    </td>
                </tr>
            </table>
        </div>
    </div>

    <div id="winDyeingSolutionTemplet" class="easyui-window winstyle" title="Dyeing Solution" style="width:800px; height:auto" data-options="modal:true,closed:true,collapsible:false,minimizable:false,maximizable:false,closable:false">
        <div style="width: 98%; font-family: Tahoma;">

            <table class="tbl-Win">
                <tr>
                    <td>
                        <table id="tblTreeGridProcess" class="easyui-treegrid" style="width:775px; height:400px;"
                               data-options="idField:'DSTID',treeField:'ProcessName', rownumbers:'true', toolbar:'#toolbarTemplet'">
                            <thead>
                                <tr>
                                    <th data-options="field:'ProcessName',width:320">Name</th>
                                    @*<th data-options="field:'GL',width:100,align:'right',editor:{type:'numberbox',options:{precision:4}}" align="right">GL</th>*@
                                    <th data-options="field:'GLst',width:100, align:'center'">GL</th>
                                    <th data-options="field:'Percentage',width:80, align:'center'">(%)</th>
                                    <th data-options="field:'TempTime',width:100, align:'center'">Temp & Time</th>
                                    <th data-options="field:'Note',width:130, align:'center'">Note</th>
                                </tr>
                            </thead>
                        </table>
                        <div id="toolbarTemplet">
                            <a id="btnAddTemplet" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-add" plain="true">New</a>
                            <a id="btnEditTemplet" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-edit" plain="true">Edit</a>
                            <a id="btnDeleteTemplet" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-remove" plain="true">Delete</a>
                            <input type="checkbox" id="chkDyeChemical" />Dye Chemical
                            <a id="btnSequenceConfigure" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-reload" plain="true">Sequence Configure</a>
                        </div>
                    </td>
                </tr>
                <tr>
                    <td style="text-align:right; padding-top:10px; padding-bottom:10px;">
                        <a id="btnCloseDyeingSolutionTemplet" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-cancel" plain="true">Close</a>
                    </td>
                </tr>
            </table>
            

        </div>
    </div>

    <div id="winTemplet" class="easyui-window winstyle" title="Dyeing Solution" style="width:550px; height:auto" data-options="modal:true,closed:true,collapsible:false,minimizable:false,maximizable:false,closable:false">
        <div style="width: 98%; font-family: Tahoma;">
            <table class="tbl-Win">
                <tr class="templet">
                    <td class="td-Win-Level">
                        Process :
                    </td>
                    <td class="td-Win-Input">
                        <select id="cboProcess"></select>
                    </td>
                </tr>
                <tr class="templet">
                    <td class="td-Win-Level">
                        Temp & Time :
                    </td>
                    <td class="td-Win-Input">
                        <input id="txtTempTime" class="reset-text" placeholder="Temp & Time" />
                    </td>
                </tr>
                <tr class="templet-dc">
                    <td class="td-Win-Level">
                        Product :
                    </td>
                    <td >
                        @*<select style="width:20%;" id="cboProductCategory">
                            <option value="25">Dyes</option>
                            <option value="26">Chemicals</option>
                        </select>*@
                        <select style="width:20%;" id="cboProductType">
                        </select>
                        <input id="txtProduct" class="reset-text txt-picker" placeholder="Search Product" />
                        <a id="btnPickProduct" href="javascript:void(0)" class="easyui-linkbutton ics-pick" iconcls="icon-pick" plain="true"></a>
                        <a id="btnResetProduct" href="javascript:void(0)" class="easyui-linkbutton ics-pick" iconcls="icon-clear" plain="true"></a>
                    </td>
                </tr>
                <tr class="templet-dc">
                    <td class="td-Win-Level">
                        GL :
                    </td>
                    <td class="td-Win-Input">
                        <input id="txtGL" min="0" max="100" class="number" placeholder="GL" />
                    </td>
                </tr>
                <tr class="templet-dc">
                    <td class="td-Win-Level">
                        Percentage (%) :
                    </td>
                    <td class="td-Win-Input">
                        <input id="txtPercentage" min="0" max="100" class="number" placeholder="%" />
                    </td>
                </tr>
                <tr>
                    <td class="td-Win-Level">
                        Note :
                    </td>
                    <td class="td-Win-Input">
                        <input id="txtNoteTemplet" class="reset-text" placeholder="Note" />
                    </td>
                </tr>
                <tr>
                    <td class="td-Win-Level">
                        Recipe Type :
                    </td>
                    <td>
                        <select style="width:20%;" id="cboDyeingRecipeType"></select>
                    </td>
                </tr>
                <tr>
                    <td colspan="2" style="text-align:right; padding-top:10px; padding-bottom:10px;">
                        <a id="btnSaveTemplet" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-save" plain="true">Save</a>
                        <a id="btnCloseTemplet" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-cancel" plain="true">Close</a>
                    </td>
                </tr>
            </table>
        </div>
    </div>
    <div id="winDSTSequence"  class="easyui-window" title="View  Sequence Configure" data-options="modal:true,closed:true,collapsible:false,minimizable:false,maximizable:false,closable:false">
        <table id="tblDSTSequence" class="easyui-datagrid" style="width:100%;height:400px" data-options="singleSelect: true,fitColumns:false, rownumbers:true, pagination:false, autoRowHeight:false, toolbar: '#toolbarSequence' ">
            <thead>
                <tr>
                    <th field="ProcessName" width="50%" align="left">ProcessName</th>
                    <th field="TempTime" width="15%" align="left">TempTime</th>
                    <th field="Note" width="20%" align="left">Note</th>
                    <th field="Sequence" width="10%" align="left">Sequence</th>
                </tr>
            </thead>
        </table>
        <div id="toolbarSequence">
            <a href="javascript:void(0)" id="btnUp" class="easyui-linkbutton" iconcls="icon-up" plain="true" onclick="UP()">Up</a>
            <a href="javascript:void(0)" id="btnDown" class="easyui-linkbutton" iconcls="icon-down" plain="true" onclick="Down()">Down</a>
            <a href="javascript:void(0)" id="btnRefresh" class="easyui-linkbutton" iconcls="icon-reload" plain="true" onclick="RefreshMenuSequence()">Refresh</a>
        </div>

        <fieldset class="actionfieldsetstyle">
            <legend>Actions : </legend>
            <a id="btnSaveSequence" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-save" plain="true" onclick="SaveSequence()">Save</a>
            <a id="btnCloseDSTSequence" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-cancel" plain="true">Close</a>
        </fieldset>

    </div>
</div>
<style type="text/css">
    .tbl-Win{
        width:100%;
    }
    .td-Win-Level {
        width: 30%;
        text-align: right;
        font-weight: bold;
    }

    .td-Win-Input {
        width: 64%;
    }
    .td-Win-Input input{
        width: 90%;
    }
     .td-Win-Input .txt-picker{
        width: 70%;
    }
    
    .td-Win-Input select{
        width: 92%;
    }
      #winDSTSequence {
      width: 600px;
      }
</style>
                     

<script type="text/javascript">

    var _sBaseAddress="";
    var _oDyeSolutions=[];
    var _oDyeingSolution=null;
    var _oDSTRoot=null;
    var _oDST=null;
    var _nProductID=0;
    var _nBUID=0;
    var _oProductTypes=[];
    var _oDyeingRecipeTypes=[];
    $(document).ready(function ()
    {
        _sBaseAddress =@Html.Raw( new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(HttpContext.Current.Session[SessionInfo.BaseAddress]));
        _oDyeSolutions =@Html.Raw( new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(Model));
        var oDPs =@Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(@ViewBag.DPs));
        _nBUID = @Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(ViewBag.BUID));
        _oProductTypes = @Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(ViewBag.ProductTypes));
        _oDyeingRecipeTypes = @Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(ViewBag.DyeingRecipeType));
        //$('.number').icsCurrencyBox();
        $('.number').val("0.00");
        $("#cboProcess").icsLoadCombo({
            List: oDPs,
            OptionValue: "DyeingSolutionID",
            DisplayText: "Name",
            InitialValue:"Default"
        });
        $("#cboProductType").icsLoadCombo({
            List: _oProductTypes,
            OptionValue: "id",
            DisplayText: "Value",
        });
        $("#cboDyeingRecipeType").icsLoadCombo({
            List: _oDyeingRecipeTypes,
            OptionValue: "id",
            DisplayText: "Value",
            InitialValue:"General"
        });
        
        DynamicRefreshList(_oDyeSolutions, 'tblDyeingSolution');
    });

    $(document).keydown(function (e) { if (e.keyCode == 27) { $('div').icsWindow('close'); } });

    /*.......... Searching ............. */


    $("#txtName").keyup(function (e) {
        var oDyeSolutions =[];
        var keyCode = e.keyCode || e.which;
        $('#txtName').removeClass("errorFieldBorder");
        if (keyCode == 8) { oDyeSolutions = _oDyeSolutions; }
        else{ oDyeSolutions = $('#tblDyeingSolution').datagrid('getRows'); }
        var sTempName="";
        var oSearchedData = [];
        for(i=0;i<oDyeSolutions.length;++i)
        {
            sTempName=oDyeSolutions[i]['Name'];
            if(sTempName.toUpperCase().indexOf($('#txtName').val().toUpperCase())>-1)
            {
                oSearchedData.push(oDyeSolutions[i]);
            }
        }
        $('#tblDyeingSolution').empty();
        if (oSearchedData.length == 0) { DynamicRefreshList(_oDyeSolutions, "tblDyeingSolution");}
        else { DynamicRefreshList(oSearchedData, "tblDyeingSolution"); }
    });


    /*............... Dyeing Solution ................. */

    function Validate()
    {
        if($.trim($('#txtSolutionName').val())==""){
            $('#txtSolutionName').focus();
            $('#txtSolutionName').addClass("errorFieldBorder");
            alert('Solution name required.');
            return false;
        }
        else{
            $('#txtSolutionName').removeClass("errorFieldBorder");
        }
        if($.trim($('#txtAdviseBy').val())==""){
            $('#txtAdviseBy').focus();
            $('#txtAdviseBy').addClass("errorFieldBorder");
            alert('Advise by required.');
            return false;
        }
        else{
            $('#txtAdviseBy').removeClass("errorFieldBorder");
        }
        return true;
    }

    function ResetDyeingSolution(){
        $('.reset-text').val("");
        _oDyeingSolution=null;
    }

    function RefreshObject(){
        var oDyeingSolution={
            DyeingSolutionID: (_oDyeingSolution==null)? 0: _oDyeingSolution.DyeingSolutionID,
            Code:(_oDyeingSolution==null)? "": _oDyeingSolution.DyeingSolutionID,
            Name: $.trim($("#txtSolutionName").val()),
            Description: $.trim($("#txtNote").val()),
            AdviseBy: $.trim($('#txtAdviseBy').val())
        };
        return oDyeingSolution;
    }

    $("#btnAdd").click(function (e) {
        ResetDyeingSolution();
        $("#winDyeingSolution").icsWindow("open", "Add Dyeing Solution");
    });

    $('#btnEdit').click(function (e)
    {
        var oDyeingSolution=$('#tblDyeingSolution').datagrid('getSelected');
        if (oDyeingSolution==null || oDyeingSolution.DyeingSolutionID<=0) { alert('Please select an item from list.'); return false;}
        ResetDyeingSolution();

        var obj =
       {
           BaseAddress: _sBaseAddress,
           Object: oDyeingSolution,
           ControllerName: "DyeingSolutiontemplate",
           ActionName: "GetDyeingSolution",
           IsWinClose: false
       };

        $.icsDataGet(obj, function (response) {

            if (response.status && response.obj != null) {
                if (response.obj.DyeingSolutionID > 0) {
                    _oDyeingSolution=response.obj;
                    $("#txtSolutionName").val(_oDyeingSolution.Name);
                    $("#txtNote").val(_oDyeingSolution.Description);
                    $('#txtAdviseBy').val(_oDyeingSolution.AdviseBy);
                    $("#winDyeingSolution").icsWindow("open", "Edit Dyeing Solution");
                }
                else { alert(response.obj.ErrorMessage); }
            }
        });


    });

    $('#btnDelete').click(function (e)
    {
        var oDyeingSolution=$('#tblDyeingSolution').datagrid('getSelected');
        if (oDyeingSolution==null || oDyeingSolution.DyeingSolutionID<=0) { alert('Please select an item from list.'); return false;}

        if (!confirm("Confirm to Delete?")) return ;
        var obj =
        {
            BaseAddress: _sBaseAddress,
            Object: oDyeingSolution,
            ControllerName: "DyeingSolutiontemplate",
            ActionName: "DyeProcess_Delete",
            TableId: "tblDyeingSolution",
            IsWinClose: false
        };
        $.icsDelete(obj);
    });

    $("#btnSaveDyeingSolution").click(function (e) {

        if (!Validate()) return false;
        var oDyeingSolution=RefreshObject();
        var obj = {
            BaseAddress: _sBaseAddress,
            Object: oDyeingSolution,
            ObjectId: oDyeingSolution.DyeingSolutionID,
            ControllerName: "DyeingSolutiontemplate",
            ActionName: "DyeSolution_IU",
            TableId: "tblDyeingSolution",
            IsWinClose: true,
            Message: "Save sucessfully."
        };
        $.icsSave(obj, function (response) {
            if (response.status && response.obj != null) {
                if (response.obj.DyeingSolutionID > 0) {
                    ResetDyeingSolution();
                    $("#txtSolutionName").focus();
                }
            }
        });
    });

    $("#btnCloseDyeingSolution").click(function (e) {
        $("#winDyeingSolution").icsWindow("close");
    });

    $('#btnCopy').click(function (e)
    {
        var oDyeingSolution=$('#tblDyeingSolution').datagrid('getSelected');
        if (oDyeingSolution==null || oDyeingSolution.DyeingSolutionID<=0) { alert('Please select an item from list.'); return false;}

        var obj = {
            BaseAddress: _sBaseAddress,
            Object: oDyeingSolution,
            ObjectId: 0,
            ControllerName: "DyeingSolutiontemplate",
            ActionName: "DyeSolution_Copy",
            TableId: "tblDyeingSolution",
            IsWinClose: true,
            Message: "Copy sucessfully."
        };
        $.icsSave(obj);
    });


    /*............... Dyeing Solution Templet................. */

    $('#btnTemplate').click(function (e)
    {
        var oDyeingSolution=$('#tblDyeingSolution').datagrid('getSelected');
        if (oDyeingSolution==null || oDyeingSolution.DyeingSolutionID<=0) { alert('Please select an item from list.'); return false;}

        var oDST={
            DyeingSolutionID:oDyeingSolution.DyeingSolutionID
        };

        var obj =
        {
            BaseAddress: _sBaseAddress,
            Object: oDST,
            ControllerName: "DyeingSolutiontemplate",
            ActionName: "GetsDyeingSolutionTemplet",
            IsWinClose: false
        };

        $.icsDataGet(obj, function (response) {

            if (response.status && response.obj != null) {
                if (response.obj.DSTID > 0) {

                    $("#winDyeingSolutionTemplet").icsWindow("open", "Dyeing Templet");
                    var data= [response.obj];
                    data={"total":""+data.length+"","rows":data};
                    $('#tblTreeGridProcess').treegrid('loadData',data);

                }
                else { alert(response.obj.ErrorMessage); }
            }
        });

    });

    $("#btnCloseDyeingSolutionTemplet").click(function (e) {
        $("#winDyeingSolutionTemplet").icsWindow("close");
    });



    function ResetTemplet(){
        _oDSTRoot=null;
        _oDST=null;

        if($('#chkDyeChemical').is(':checked')){
            $('.templet-dc').show();
            $('.templet').hide();
        }
        else{
            $('.templet').show();
            $('.templet-dc').hide();
        }

        $("#cboProcess").val(0);
        $('.reset-text').val("");
        $('.number').val("0.00");
        //$("#chkIsFixed" ).prop("checked", false);
    }

    function ValidationTemplet()
    {

        if($('#chkDyeChemical').is(':checked')){

            if(_nProductID<=0){
                $('#txtProduct').focus();
                $('#txtProduct').addClass("errorFieldBorder");
                alert('Product required.');
                return false;
            }
            else{
                $('#txtProduct').removeClass("errorFieldBorder");
            }
            if(parseInt($('#cboDyeingRecipeType').val())==0)
            {
                if((parseFloat($('#txtGL').val())<=0)&&(parseFloat($('#txtPercentage').val())<=0)){
                    $('#txtGL').focus();
                    $('#txtGL').addClass("errorFieldBorder");
                    alert('GL required.');
                    return false;
                }
                else{
                    $('#txtGL').removeClass("errorFieldBorder");
                }

                if((parseFloat($('#txtGL').val())>0)&&(parseFloat($('#txtPercentage').val())>0)){
                    $('#txtGL').focus();
                    $('#txtGL').addClass("errorFieldBorder");
                    alert('GL or Percentage required.(Both not Possible)');
                    return false;
                }
                else{
                    $('#txtGL').removeClass("errorFieldBorder");
                }
            }
            //if(parseFloat(icsRemoveComma($('#txtPercentage').val()))<=0){
            //    $('#txtPercentage').focus();
            //    $('#txtPercentage').addClass("errorFieldBorder");
            //    alert('Percentage required.');
            //    return false;
            //}
            //else{
            //    $('#txtPercentage').removeClass("errorFieldBorder");
            //}
        }
        else{
            if($('#cboProcess').val()<=0){
                $('#cboProcess').focus();
                $('#cboProcess').addClass("errorFieldBorder");
                alert('Please select process.');
                return false;
            }
            else{
                $('#cboProcess').removeClass("errorFieldBorder");
            }
            if($.trim($('#txtTempTime').val())==""){
                $('#txtTempTime').focus();
                $('#txtTempTime').addClass("errorFieldBorder");
                alert('Temp & time required.');
                return false;
            }
            else{
                $('#txtTempTime').removeClass("errorFieldBorder");
            }
        }


        return true;
    }

    function RefreshObjectTemplet(){

        var bIsDC=$('#chkDyeChemical').is(':checked');
        //var bIsFixed = false;
        //if($('#chkIsFixed').attr("checked"))
        //    bIsFixed=true;
        var oDSTemplet={
            DSTID: (_oDST==null || _oDST.DSTID<=0)? 0 : _oDST.DSTID,
            DyeingSolutionID: (_oDST==null || _oDST.DSTID<=0)? _oDSTRoot.DyeingSolutionID : _oDST.DyeingSolutionID,
            ProcessID: (bIsDC)? _nProductID : $('#cboProcess').val(),
            ParentID:(_oDST==null || _oDST.DSTID<=0)? _oDSTRoot.DSTID : _oDST.ParentID,
            IsDyesChemical: (_oDST==null || _oDST.DSTID<=0)?  bIsDC  : _oDST.IsDyesChemical,
            TempTime:  $.trim($('#txtTempTime').val()),
            GL:(bIsDC)?parseFloat($('#txtGL').val()):0,
            Percentage:(bIsDC)?parseFloat($('#txtPercentage').val()):0,
            Note: $.trim($('#txtNoteTemplet').val()),
            ProductType: parseInt($('#cboProductType').val()),
            RecipeCalType: parseInt($('#cboDyeingRecipeType').val())
        };
        return oDSTemplet;

    }

    $("#btnAddTemplet").click(function (e) {
        debugger;
        ResetTemplet();
        _oDSTRoot= $('#tblTreeGridProcess').datagrid('getSelected');
        if(_oDSTRoot==null || _oDSTRoot.DSTID<=0){ alert("Please select an item from list."); return false; }
        $("#winTemplet").icsWindow("open", "Add Dyeing Solution Detail");
    });

    $('#btnEditTemplet').click(function (e)
    {
        var oDST= $('#tblTreeGridProcess').datagrid('getSelected');
        if(oDST==null || oDST.DSTID<=0){ alert("Please select an item from list."); return false; }
        $('#chkDyeChemical').prop('checked',oDST.IsDyesChemical);
        ResetTemplet();

        var obj =
       {
           BaseAddress: _sBaseAddress,
           Object: oDST,
           ControllerName: "DyeingSolutiontemplate",
           ActionName: "GetDyeingSolutionTemplet",
           IsWinClose: false
       };

        $.icsDataGet(obj, function (response) {

            if (response.status && response.obj != null) {
                if (response.obj.DSTID > 0) {
                    _oDST=response.obj;
                    if(response.obj.IsDyesChemical){
                        $('#chkDyeChemical').prop('checked',true);
                        _nProductID=response.obj.ProcessID;
                        $("#txtProduct").val(response.obj.ProcessName);
                        $("#txtGL").val(response.obj.GL);
                       
                        $("#txtPercentage").val(response.obj.Percentage);
                    }
                    else{
                        $('#chkDyeChemical').prop('checked',false);
                        $("#cboProcess").val(response.obj.ProcessID);
                        $("#txtTempTime").val(response.obj.TempTime);
                    }
                    $("#cboDyeingRecipeType").val(response.obj.RecipeCalType);
                    $("#cboProductType").val(response.obj.ProductType);
                    $('#txtNoteTemplet').val(response.obj.Note)
                    //if(response.obj.IsFixed)
                    //    $( "#chkIsFixed" ).prop("checked", true);
                    //else $( "#chkIsFixed" ).prop("checked", false);
                    $("#winTemplet").icsWindow("open", "Edit Dyeing Solution Detail");
                }
                else { alert(response.obj.ErrorMessage); }
            }
        });


    });

    $('#btnDeleteTemplet').click(function (e)
    {
        var oDST=$('#tblTreeGridProcess').datagrid('getSelected');
        if (oDST==null || oDST.DSTID<=0) { alert('Please select an item from list.'); return false;}

        if (!confirm("Confirm to Delete?")) return ;
        var obj =
        {
            BaseAddress: _sBaseAddress,
            Object: oDST,
            ControllerName: "DyeingSolutiontemplate",
            ActionName: "DyeSolutionTemplate_Delete",
            TableId: "",
            IsWinClose: false
        };
        $.icsDelete(obj, function (response) {
            if (response.status && response.Message =='deleted') {
                $('#tblTreeGridProcess').treegrid('remove',oDST.DSTID);

                $('#tblTreeGridProcess').treegrid('select',oDST.ParentID);;
                var oParent=  $('#tblTreeGridProcess').datagrid('getSelected');
                if(oParent!=null){
                    var oChildrens=[];
                    for(var i=0;i<oParent.children.length;i++){

                        if(oParent.children[i].DSTID!=oDST.DSTID){
                            oChildrens.push(oParent.children[i]);
                        }
                    }
                    oParent.children=oChildrens;
                    $('#tblTreeGridProcess').treegrid('update',{	id: oParent.DSTID, row: oParent });
                }
            }
        });
    });

    $("#btnSaveTemplet").click(function (e) {

        if (!ValidationTemplet()) return false;
        var oDST=RefreshObjectTemplet();
        var obj = {
            BaseAddress: _sBaseAddress,
            Object: oDST,
            ObjectId: oDST.DSTID,
            ControllerName: "DyeingSolutiontemplate",
            ActionName: "DyeSolutionTemplate_IU",
            TableId: "",
            IsWinClose: true,
            Message: "Save sucessfully."
        };
        $.icsSave(obj, function (response) {
            if (response.status && response.obj != null) {
                if (response.obj.DSTID > 0) {
                    if(oDST.DSTID>0){
                        response.obj.children=oDST.children;
                        $('#tblTreeGridProcess').treegrid('update',{ id: oDST.DSTID, row: response.obj });
                    }
                    else{
                        $('#tblTreeGridProcess').treegrid('append',{ parent: response.obj.ParentID, data: [response.obj] });
                    }
                }
            }
        });
    });

    $("#btnCloseTemplet").click(function (e) {
        $("#winTemplet").icsWindow("close");
    });


    /*............... Pick Product ................. */

    $("#btnResetProduct").click(function () {

        $("#txtProduct").val("");
        _nProductID=0;
    });

    $("#btnPickProduct").click(function () {

        var sProductName=$.trim($("#txtProduct").val());
        if(sProductName==""){ alert("Type product name to search."); return false; }
        if(parseInt($("#cboProductType").val())<=0){ alert("Please Select Category name.");    $('#cboProductType').focus(); return false; }
        GetProducts(sProductName);
    });

    $("#txtProduct").keydown(function (e) {
        var nkeyCode = e.keyCode || e.which;
        if(nkeyCode==13){
            var sProductName=$.trim($("#txtProduct").val());
            if(sProductName==""){ alert("Type product name to search."); return false; }
            if(parseInt($("#cboProductType").val())<=0){ alert("Please Select Product type.");    $('#cboProductType').focus(); return false; }
            GetProducts(sProductName);
        }
        else if(nkeyCode==8){
            //$("#txtProduct").val("");
            _nProductID=0;
        }
    });

    function GetProducts(sProductName){

        var oProduct = {
            BUID:_nBUID,
            ProductName:sProductName,
            ProductCategoryID:parseInt($("#cboProductType").val())
        };
        var obj = {
            BaseAddress: _sBaseAddress,
            Object: oProduct,
            ControllerName: "DyeingSolutiontemplate",
            ActionName: "GetProducts",
            IsWinClose: false
        };

        $.icsDataGets(obj, function (response) {

            if (response.status && response.objs.length > 0) {
                if (response.objs[0].ProductID > 0) {
                    debugger;
                    var tblColums = [];
                    var oColumn = { field: "ProductCode", title: "Code", width: 80, align: "left" };tblColums.push(oColumn);
                    oColumn = { field: "ProductName", title: "Name", width: 270, align: "left" };tblColums.push(oColumn);
                    oColumn = { field: "ProductCategoryName", title: "Category Name", width: 270, align: "left" };tblColums.push(oColumn);
                    oColumn = { field: "MUnit", title: "Unit", width: 70, align: "left" };tblColums.push(oColumn);

                    var oPickerParam = {
                        winid: 'winProductPicker',
                        winclass:'clsProductPicker',
                        winwidth: 520,
                        winheight: 460,
                        tableid: 'tblProductPicker',
                        tablecolumns: tblColums,
                        datalist: response.objs,
                        multiplereturn: false,
                        searchingbyfieldName:'ProductName',
                        windowTittle: 'Product List'
                    };
                    $.icsPicker(oPickerParam);
                    IntializeProductPickerbutton(oPickerParam);//multiplereturn, winclassName
                }
                else { alert(response.objs[0].ErrorMessage); }
            }
            else{
                alert("No product found.");
            }
        });


    }

    function IntializeProductPickerbutton(oPickerobj)
    {
        $("#" + oPickerobj.winid).find("#btnOk").click(function () {
            ProductSelect(oPickerobj);
        });
        $(document).find('.' +oPickerobj.winclass).keydown(function (e) {
            if (e.which == 13)//enter=13
            {
                ProductSelect(oPickerobj);
            }
        });
    }

    function ProductSelect(oPickerobj){
        var oProduct = $('#'+oPickerobj.tableid).datagrid('getSelected');
        if (oPickerobj.winid == 'winProductPicker')
        {
            if(oProduct !=null  && oProduct.ProductID>0){
                $("#"+oPickerobj.winid).icsWindow("close");
                $("#" + oPickerobj.winid).remove();
                $('#txtProduct').val(oProduct.ProductNameCode);
                _nProductID= oProduct.ProductID;
            }
            else{
                alert("Please select product.");
            }
        }
    }
    //Sequence
    $("#btnSequenceConfigure").click(function () {
        var oDST = $('#tblTreeGridProcess').datagrid('getSelected');
        if (oDST == null || parseInt(oDST.DSTID) <= 0) {
            alert("Please select a item from list!");
            return;
        }
        var SelectedRowIndex = $('#tblTreeGridProcess').datagrid('getRowIndex', oDST);
        $("#winDSTSequence").icsWindow('open', "Selected parent DST : " + oDST.text);
        $("#winDSTSequence input").val("");
        $("#winDSTSequence select").val(0);
        GetChildDSTs(oDST,'tblDSTSequence');
    });
    function GetChildDSTs(oDST,tblid) {
        var oTempDST = { ParentID: oDST.DSTID };
        var obj =
        {
            BaseAddress: _sBaseAddress,
            Object: oTempDST,
            ControllerName: "DyeingSolutiontemplate",
            ActionName: "GetDSTChilds",
            IsWinClose: false
        };

        $.icsDataGet(obj, function (response) {
            debugger;
            if (response.status && response.obj != null) {
                if (response.obj.ErrorMessage != "" || response.obj.ErrorMessage != null)
                {
                    _oDST = response.obj;
                    DynamicRefreshList(response.obj.children, tblid);
                    _oDSTs = response.obj.children;
                }
                else { alert(response.obj.ErrorMessage); }
            }
            else { alert("No information found."); }
        });
    }


    function SaveSequence()
    {
        //debugger;
        var oDST= {
            children :$('#tblDSTSequence').datagrid('getRows')
        };
        $.ajax({
            type: "POST",
            dataType: "json",
            url : _sBaseAddress+"/DyeingSolutiontemplate/RefreshMenuSequence",
            traditional: true,
            data:  JSON.stringify(oDST),
            contentType: "application/json; charset=utf-8",
            success: function (data) {
                //debugger;
                var  oDST = jQuery.parseJSON(data);
                if (oDST.DisplayMessage=="" || oDST.DisplayMessage==null)
                {
                    alert("Data Saved sucessfully");
                    $("#winDSTSequence").icsWindow("close");
                    $("#winDSTSequence input").val("");
                    $("#winDSTSequence select").val(0);
                }
                else {
                    alert(oDST.DisplayMessage);
                }
            },
            error: function (xhr, status, error) {
                alert(error);
            }

        });
    }

    $("#btnCloseDSTSequence").click(function () {
        $("#winDSTSequence").icsWindow("close");
        $("#winDSTSequence input").val("");
        $("#winDSTSequence select").val(0);
    });
    function UP()
    {
        debugger;
        var oDST = $('#tblDSTSequence').datagrid('getSelected');
        if(oDST==null)
        {
            alert("Please select Item");
            return;
        }
        var SelectedRowIndex=$('#tblDSTSequence').datagrid('getRowIndex',oDST);
        if(SelectedRowIndex==0)return;
        var oDSTs=$('#tblDSTSequence').datagrid('getRows');
        _oDSTs = [];
        for(var i=0; i<oDSTs.length; i++)
        {
            if(i==(SelectedRowIndex-1))
            {
                _oDSTs[i]=oDSTs[i+1];
            }
            else if(i==SelectedRowIndex)
            {
                _oDSTs[i]=oDSTs[i-1];
            }
            else
            {
                _oDSTs[i]=oDSTs[i];
            }
            _oDSTs[i].Sequence=i+1;
        }
        data = _oDSTs;
        data={"total":""+data.length+"","rows":data};
        $('#tblDSTSequence').datagrid('loadData',data);
        //    MakeMenu();
        var newSelectedRowIndex=SelectedRowIndex-1;
        $('#tblDSTSequence').datagrid('selectRow',newSelectedRowIndex);

    }

    function Down()
    {
        debugger;
        var oDST = $('#tblDSTSequence').datagrid('getSelected');
        if(oDST==null)
        {
            alert("Please select a item from list!");
            return;
        }
        var SelectedRowIndex=$('#tblDSTSequence').datagrid('getRowIndex',oDST);
        if(SelectedRowIndex==(_oDSTs.length-1))return;
        var oDSTs=$('#tblDSTSequence').datagrid('getRows');
        _oDSTs=[];
        for(var i=0; i<oDSTs.length; i++)
        {
            if(i==(SelectedRowIndex+1))
            {
                _oDSTs[i]=oDSTs[i-1];
            }
            else if(i==SelectedRowIndex)
            {
                _oDSTs[i]=oDSTs[i+1];
            }
            else
            {
                _oDSTs[i]=oDSTs[i];
            }
            _oDSTs[i].Sequence=i+1;
        }
        data = _oDSTs;
        data={"total":""+data.length+"","rows":data};
        $('#tblDSTSequence').datagrid('loadData',data);

        var newSelectedRowIndex=SelectedRowIndex+1;
        $('#tblDSTSequence').datagrid('selectRow',newSelectedRowIndex);
    }

    function RefreshSequence()
    {
        var oDSTs = $('#tblDSTSequence').datagrid('getRows');
        if(oDSTs.length>0)
        {
            for(var i = 0;i<oDSTs.length;i++)
            {
                oDSTs[i].Sequence = i+1;
            }
            RefreshListSequence(oDSTs);
        }
    }

    function RefreshListSequence(oDSTs)
    {
        data=oDSTs;
        data={"total":""+data.length+"","rows":data};
        $('#tblDSTSequence').datagrid('loadData',data);
    }
//end Sequence
</script>