@{
    ViewBag.Title = "Sub-Contract";
}
<html>
<body>
    @model ESimSol.BusinessObjects.WUSubContract

    <div class="menuMainCollectionTable" style="height:100%; width:100%">
        <div id="ViewSubContract" class="easyui-tabs" style="width:100%; height:500px;">
            <div title="Sub-Contract" style="padding:5px; height:100%">
                <fieldset style="height:100%; width:100%">
                    <legend>Sub-Contract Info :</legend>
                    <table border="0" cellspacing="2" cellpadding="2" style="font-size:11px; font-weight: bold; width:100%">
                        <tr>
                            <td style="text-align:right; width:12%">
                                Job No :
                            </td>
                            <td style="width:15%">
                                <input id="txtJobNo" style="width: 100%;" type="text" disabled="disabled" />
                            </td>
                            <td style="text-align:right; width:12%">
                                Contract Date :
                            </td>
                            <td style="width:11%">
                                <input type="text" style="width:100%;" id="dtpContractDate" class="easyui-datebox" data-options="formatter:icsdateformat,parser:icsdateparser" />
                            </td>
                            <td style="text-align:right; width:15%">
                                Payment Mode :
                            </td>
                            <td colspan="2" style="width:35%">
                                <select style="width:100%; height:21px" id="cboPaymentMode"> </select>
                            </td>
                        </tr>
                        <tr>
                            <td style="text-align:right; width:12%">
                                Supplier :
                            </td>
                            <td style="width:15%">
                                <input id="txtSupplier" type="text" style="width:100%" />
                            </td>
                            <td style="width:10%">
                                <table border="0" cellpadding="0" cellspacing="0" style="width:100%">
                                    <tr>
                                        <td style="width:25%">
                                            <input id="btnPickSupplier" type="button" value="P" style="width:100%" />
                                        </td>
                                        <td style="width:25%">
                                            <input id="btnClearSupplier" type="button" value="C" style="width:100%" />
                                        </td>
                                        <td style="width:50%; text-align: right">
                                            CP :
                                        </td>
                                    </tr>
                                </table>
                            </td>
                            <td style="width:13%">
                                <select style="width:100%; height:21px" id="cboContractPerson"> </select>
                            </td>
                            <td style="text-align:right; width:15%">
                                Contract By :
                            </td>
                            <td colspan="2" style="width:35%">
                                <select style="width:100%; height:21px" id="cboContractBy"> </select>
                            </td>
                        </tr>
                        <tr>
                            <td style="text-align:right; width:12%">
                                Buyer :
                            </td>
                            <td colspan="3" style="text-align:right; width:38%">
                                <table border="0" cellpadding="0" cellspacing="0" style="width:100%">
                                    <tr>
                                        <td style="text-align:left; width:80%">
                                            <input id="txtBuyer" type="text" style="width:100%" />
                                        </td>
                                        <td style="text-align:left; width:10%">
                                            <input id="btnPickBuyer" type="button" value="P" style="width:100%" />
                                        </td>
                                        <td style="text-align:left; width:10%">
                                            <input id="btnClearBuyer" type="button" value="C" style="width:100%" />
                                        </td>
                                    </tr>
                                </table>
                            </td>
                            <td style="text-align:right; width:15%">
                                Order Type :
                            </td>
                            <td colspan="2" style="width:35%">
                                <select style="width:100%; height:21px" id="cboOrderType"> </select>
                            </td>
                        </tr>
                        <tr>
                            <td style="text-align:right; width:12%">
                                SO No :
                            </td>
                            <td colspan="3" style="width:38%">
                                <input id="txtSONo" style="width: 100%;" type="text" />
                            </td>
                            <td style="text-align:right; width:15%">
                                Work Type :
                            </td>
                            <td colspan="2" style="width:35%">
                                <select style="width:100%; height:21px" id="cboWorkType"> </select>
                            </td>
                        </tr>
                        <tr>
                            <td style="text-align:right; width:12%">
                                Style No :
                            </td>
                            <td colspan="3" style="width:38%">
                                <input id="txtStyleNo" style="width: 100%;" type="text" />
                            </td>
                            <td style="text-align:right; width:15%">
                                Fabric Type :
                            </td>
                            <td style="width:27%">
                                <input id="txtFabricType" style="width: 100%;" type="text" />
                            </td>
                            <td style="width:8%">
                                <table border="0" cellpadding="0" cellspacing="0" style="width:100%">
                                    <tr>
                                        <td style="text-align:left;">
                                            <input id="btnPickFabric" type="button" value="P" style="width:100%" />
                                        </td>
                                        <td style="text-align:left;">
                                            <input id="btnClearFabric" type="button" value="C" style="width:100%" />
                                        </td>
                                    </tr>
                                </table>
                            </td>
                        </tr>
                        <tr>
                            <td style="text-align:right; width:12%">
                                Composition :
                            </td>
                            <td colspan="3" style="text-align:right; width:38%">
                                <table border="0" cellpadding="0" cellspacing="0" style="width:100%">
                                    <tr>
                                        <td style="text-align:left; width:80%">
                                            <input id="txtComposition" type="text" style="width:100%" />
                                        </td>
                                        <td style="text-align:left; width:10%">
                                            <input id="btnPickComposition" type="button" value="P" style="width:100%" />
                                        </td>
                                        <td style="text-align:left; width:10%">
                                            <input id="btnClearComposition" type="button" value="C" style="width:100%" />
                                        </td>
                                    </tr>
                                </table>
                            </td>
                            <td style="text-align:right; width:15%">
                                Weave Design :
                            </td>
                            <td style="width:27%">
                                <input id="txtWeaveDesign" style="width: 100%;" type="text" />
                            </td>
                            <td style="width:8%">
                                <table border="0" cellpadding="0" cellspacing="0" style="width:100%">
                                    <tr>
                                        <td style="text-align:left;">
                                            <input id="btnPickWeaveDesign" type="button" value="P" style="width:100%" />
                                        </td>
                                        <td style="text-align:left;">
                                            <input id="btnClearWeaveDesign" type="button" value="C" style="width:100%" />
                                        </td>
                                    </tr>
                                </table>
                            </td>
                        </tr>
                        <tr>
                            <td style="text-align:right; width:12%">
                                Construction :
                            </td>
                            <td colspan="3" style="width:38%">
                                <input id="txtConstruction" style="width: 100%;" type="text" />
                            </td>                            
                            <td style="text-align:right; width:15%">
                                Reed Count :
                            </td>
                            <td colspan="2" style="width:35%">
                                <input id="txtReedCount" style="width: 100%;" type="text" />
                            </td>
                        </tr>
                        <tr>
                            <td style="text-align:right; width:12%">
                                Gray Width :
                            </td>
                            <td style="width:15%">
                                <input id="txtGrayWidth" style="width: 100%;" type="text" />
                            </td>
                            <td style="text-align:right; width:12%">
                                Reed Space :
                            </td>
                            <td style="width:11%">
                                <input id="txtReedSpace" style="width: 100%;" type="text" />
                            </td>
                            <td style="text-align:right; width:15%">
                                Order Quantity :
                            </td>
                            <td style="width:27%">
                                <input id="txtOrderQuantity" style="width: 100%;" type="text" />
                            </td>
                            <td style="width:8%">
                                <select style="width:100%; height:21px" id="cboMeasurementUnit"> </select>
                            </td>
                        </tr>
                        <tr>
                            <td style=" text-align:right; width:12%">
                                Total Ends :
                            </td>
                            <td style="width:15%">
                                <input id="txtTotalEnds" style="width: 100%;" type="text" />
                            </td>
                            <td style="text-align:right; width:12%">
                                Gray Pick :
                            </td>
                            <td style="width:11%">
                                <input id="txtGrayPick" style="width: 100%;" type="text" />
                            </td>
                            <td style="text-align:right; width:15%">
                                Rate :
                            </td>
                            <td style="width:27%">
                                <table style="width:100%" cellpadding="0" cellspacing="0" border="0">
                                    <tr>
                                        <td style="width:70%">
                                            <input id="txtRatePerMeasurementUnit" style="width: 100%;" type="text" />
                                        </td>
                                        <td style="width:30%">
                                            <select style="width:100%; height:21px" id="cboCurrency"> </select>
                                        </td>
                                    </tr>
                                </table>
                            </td>
                            <td style="width:8%">
                                <input id="txtMeasurementUnit" style="width: 100%;" type="text" disabled="disabled" />
                            </td>
                        </tr>
                        <tr>
                            <td style="text-align:right; width:12%">
                                Transportation :
                            </td>
                            <td colspan="3" style="width:38%">
                                <select style="width:100%; height:21px" id="cboTransportation"> </select>
                            </td>
                            <td style="text-align:right; width:15%">
                                Rate :
                            </td>
                            <td style="width:27%">
                                <table style="width:100%" cellpadding="0" cellspacing="0" border="0">
                                    <tr>
                                        <td style="width:70%">
                                            <input id="txtRatePerPick" style="width: 100%;" type="text" />
                                        </td>
                                        <td style="width:30%">
                                            <input id="txtCurrencyPerPick" style="width: 100%;" type="text" disabled="disabled" />
                                        </td>
                                    </tr>
                                </table>
                            </td>
                            <td style="width:8%">
                                <input id="txtPick" style="width: 100%;" type="text" value="/Pick" disabled="disabled" />
                            </td>
                        </tr>
                        <tr>
                            <td style="text-align:right; width:12%">
                                Prod Start :
                            </td>
                            <td style="width:15%">
                                <input type="text" id="dtpProdStartDate" class="easyui-datebox" data-options="formatter:icsdateformat,parser:icsdateparser" />
                            </td>
                            <td style="text-align:right; width:12%">
                                Complete Date :
                            </td>
                            <td style="width:11%">
                                <input type="text" style="width:100%;" id="dtpProdCompleteDate" class="easyui-datebox" data-options="formatter:icsdateformat,parser:icsdateparser" />
                            </td>
                            <td style="text-align:right; width:15%">
                                Total Amount :
                            </td>
                            <td style="width: 27%">
                                <table style="width:100%" cellpadding="0" cellspacing="0" border="0">
                                    <tr>
                                        <td style="width:70%">
                                            <input id="txtTotalAmount" style="width: 100%;" type="text" />
                                        </td>
                                        <td style="width:30%">
                                            <input id="txtCRate" style="width: 100%;" type="text" />
                                        </td>
                                    </tr>
                                </table>                                   
                            </td>
                            <td style="width:8%">
                                <input id="txtCurrency" style="width: 100%;" type="text" disabled="disabled" />
                            </td>
                        </tr>
                        <tr>
                            <td style="text-align:right; width:12%">
                                Prod Comment :
                            </td>
                            <td colspan="3" style="width:38%">
                                <input id="txtProdComment" style="width: 100%;" type="text" />
                            </td>
                            <td style="text-align:right; width:15%">
                                Remarks :
                            </td>
                            <td colspan="2" style="width:35%">
                                <input id="txtRemarks" style="width: 100%;" type="text" />
                            </td>
                        </tr>
                    </table>
                </fieldset>
            </div>
            <div title="Yarn Consumption" style="padding:5px; height:100%">
                <table id="tblYarnConsumptions" class="easyui-datagrid" style="width: 100%; height: 455px; font-size: 11px;" fitcolumns="false" rownumbers="true" pagination="false" singleselect="true" autorowheight="true" toolbar="#toolbarConsumption">
                    <thead>
                        <tr>
                            <th field="WarpWeftTypeSt" width="120" align="left"> Warp Weft Type </th>
                            <th field="YarnCode" width="90" align="left"> Yarn Code </th>
                            <th field="YarnName" width="200" align="left"> Yarn Name </th>
                            <th field="MUSymbol" width="120" align="center"> Measurement Unit </th>
                            <th field="ConsumptionPerUnit" width="140" align="right"> Consumption/Unit </th>
                            <th field="ConsumptionQty" width="120" align="right"> Consumption Qty </th>
                            <th field="Remarks" width="180" align="left"> Remarks </th>
                        </tr>
                    </thead>
                </table>
                <div id="toolbarConsumption">
                    <a id="btnAddConsumption" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-add" plain="true">Add</a>
                    <a id="btnEditConsumption" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-add" plain="true">Edit</a>
                    <a id="btnDeleteConsumption" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-remove" plain="true">Delete</a>
                </div>
            </div>
            <div title="Terms & Condition" style="padding:5px">
                <table id="tblTermsConditions" class="easyui-datagrid" style="width: 100%; height: 455px; font-size: 11px;" fitcolumns="false" rownumbers="true" pagination="false" singleselect="true" autorowheight="true" data-options="onClickCell: onClickCell" toolbar="#toolbarCondition">
                    <thead>
                        <tr>
                            <th field="TermsAndCondition" width="99%" align="left" editor="{type:'textbox'}"> Terms & Condition </th>
                        </tr>
                    </thead>
                </table>
                <div id="toolbarCondition">
                    <a id="btnPickCondition" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-pick" plain="true">Pick</a>
                    <a id="btnRemoveCondition" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-remove" plain="true">Remove</a>
                    <a id="btnRefreshCondition" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-reload" plain="true">Refresh</a>
                </div>
            </div>
        </div>
        <div id="winYarnConsumption" class="easyui-window" data-options="modal:true,closed:true,collapsible:false,minimizable:false,maximizable:false,closable:false"
             style="width:32%;height:auto;padding:1px">
            <fieldset>
                <legend style="font-weight: bold">Yarn Consumption Info : </legend>
                <table border="0" cellspacing="2" cellpadding="2" style="font-size: 11px; font-weight: bold; width: 100%">
                    <tr>
                        <td style="text-align: right; width: 40%">
                            Warp Weft Type :
                        </td>
                        <td style="width: 60%">
                            <select style="width:100%; height:21px" id="cboWarpWeftType"> </select>
                        </td>
                    </tr>
                    <tr>
                        <td style="text-align: right; width: 40%">
                            Yarn :
                        </td>
                        <td style="width: 60%">
                            <table border="0" cellpadding="0" cellspacing="0" style="width:100%">
                                <tr>
                                    <td style="width: 70%">
                                        <input id="txtYarn" style="width: 100%;" type="text" />
                                    </td>
                                    <td style="text-align:left; width: 15%">
                                        <input id="btnPickYarn" type="button" value="P" style="width:100%" />
                                    </td>
                                    <td style="text-align:left; width: 15%">
                                        <input id="btnClearYarn" type="button" value="C" style="width:100%" />
                                    </td>
                                </tr>
                            </table>
                        </td>
                    </tr>
                    <tr>
                        <td style="text-align: right; width: 40%">
                            Consumption Qty/Unit :
                        </td>
                        <td style="width: 60%">
                            <table border="0" cellpadding="0" cellspacing="0" style="width:100%">
                                <tr>
                                    <td style="width: 40%">
                                        <input id="txtConsumptionQty" style="width: 100%;" type="text" />
                                    </td>
                                    <td style="text-align:left; width: 30%">
                                        <select style="width:100%; height:21px" id="cboConsumptionUnit"> </select>
                                    </td>
                                    <td style="text-align:left; width: 30%">
                                        <input id="txtMeasurementUnit" style="width: 100%;" type="text" value="/Yds" disabled="disabled" />
                                    </td>
                                </tr>
                            </table>
                        </td>
                    </tr>
                    <tr>
                        <td style="text-align: right; width: 40%">
                            Total Consumption Qty :
                        </td>
                        <td style="width: 60%">
                            <table border="0" cellpadding="0" cellspacing="0" style="width:100%">
                                <tr>
                                    <td style="width: 70%">
                                        <input id="txtTotalConsumptionQty" style="width: 100%;" type="text" />
                                    </td>
                                    <td style="text-align:left; width: 30%">
                                        <input id="txtConsumptionUnit" style="width: 100%;" type="text" disabled="disabled" />
                                    </td>
                                </tr>
                            </table>
                        </td>
                    </tr>
                    <tr>
                        <td style="text-align: right; width: 40%">
                            Remarks :
                        </td>
                        <td style="width: 60%">
                            <input id="txtConsumptionRemarks" style="width: 100%;" type="text" />
                        </td>
                    </tr>               
                </table>
            </fieldset>
            <fieldset>
                <legend style="font-weight: bold">Action : </legend>
                <table border="0" cellspacing="2" cellpadding="2" style="font-size: 11px; font-weight: bold">
                    <tr>
                        <td style="width: 400px; text-align: right"></td>
                        <td style="width: 50px">
                            <a id="btnYarnConsumptionOk" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-ok" plain="true">Ok</a>
                        </td>
                        <td style="width: 50px">
                            <a id="btnYarnConsumptionClose" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-cancel" plain="true">Close</a>
                        </td>
                    </tr>
                </table>
            </fieldset>
        </div>
        <fieldset style="height:10%; width:99%">
            <legend>Action :</legend>
            <table border="0" cellspacing="2" cellpadding="2" style="font-size: 11px; font-weight: bold; width:100%">
                <tr>
                    <td style="width:70%"></td>
                    <td style="width:30%; text-align:right;">
                        <a id="btnSave" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-save" plain="true">Save</a>
                        <a id="btnAcceptRevise" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-save" plain="true">Accept Revise</a>
                        <a id="btnClose" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-cancel" plain="true">Close</a>
                    </td>
                </tr>
            </table>
        </fieldset>
    </div>
</body>
</html>

<script type="text/javascript">
    $(document).ready(function () {
        var oWUSubContract =@Html.Raw( new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(Model));
        var nBUID = @Html.Raw( new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(ViewBag.BUID));
        var oPaymentModes = @Html.Raw( new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(ViewBag.PaymentModes));
        var oContractEmployees = @Html.Raw( new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(ViewBag.ContractEmployees));
        var oOrderTypes = @Html.Raw( new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(ViewBag.OrderTypes));
        var oWorkTypes = @Html.Raw( new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(ViewBag.WorkTypes));
        var oMeasurementUnits = @Html.Raw( new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(ViewBag.MeasurementUnits));
        var oCurrencys = @Html.Raw( new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(ViewBag.Currencys));
        var oTransportations = @Html.Raw( new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(ViewBag.Transportations));
        var oWarpWefts = @Html.Raw( new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(ViewBag.WarpWefts));

        $('#ViewSubContract').data('WUSubContract', oWUSubContract);
        $('#ViewSubContract').data('PaymentModes', oPaymentModes);
        $('#ViewSubContract').data('ContractEmployees', oContractEmployees);
        $('#ViewSubContract').data('OrderTypes', oOrderTypes);
        $('#ViewSubContract').data('WorkTypes', oWorkTypes);
        $('#ViewSubContract').data('MeasurementUnits', oMeasurementUnits);
        $('#ViewSubContract').data('Currencys', oCurrencys);
        $('#ViewSubContract').data('Transportations', oTransportations);
        $('#ViewSubContract').data('WarpWefts', oWarpWefts);

        $("#txtYarn").data('YarnID', null);
        $("#txtSupplier").data('SupplierID', 0);
        $('#txtBuyer').data('BuyerID', 0);
        $("#txtFabricType").data('FabricID', 0);
        $("#txtComposition").data('CompositionID', 0);
        $("#txtWeaveDesign").data('WeaveDesignID', 0);
        $("#cboPaymentMode").data("BUID", nBUID);

        $("#dtpContractDate").datebox('setValue', icsdateformat(new Date()));
        $("#dtpProdStartDate").datebox('setValue', icsdateformat(new Date()));
        $("#dtpProdCompleteDate").datebox('setValue', icsdateformat(new Date()));

        $("#txtOrderQuantity, #txtTotalAmount, #txtConsumptionQty, #txtTotalConsumptionQty, #txtCRate").icsCurrencyBox(null, 0, 2);
        $("#txtTotalEnds, #txtGrayPick").icsCurrencyBox(null, 0, 0);
        $("#txtRatePerMeasurementUnit, #txtRatePerPick").icsCurrencyBox(null, 0.00, 4);

        $("#AppMainLayout").layout('collapse', 'west');
        $("#AppMainLayout").layout('expand', 'west');
        $("#AppMainLayout").layout('expand', 'west');

        RefreshComboBox();
        RefreshControl(oWUSubContract);
    });

    function RefreshComboBox() {

        var oPaymentModes = $('#ViewSubContract').data('PaymentModes');
        var oContractEmployees = $('#ViewSubContract').data('ContractEmployees');
        var oOrderTypes = $('#ViewSubContract').data('OrderTypes');
        var oWorkTypes = $('#ViewSubContract').data('WorkTypes');
        var oMeasurementUnits = $('#ViewSubContract').data('MeasurementUnits');
        var oCurrencys = $('#ViewSubContract').data('Currencys');
        var oTransportations = $('#ViewSubContract').data('Transportations');
        var oWarpWefts = $('#ViewSubContract').data('WarpWefts');

        $("#cboPaymentMode").icsLoadCombo({ List: oPaymentModes, OptionValue: "id", DisplayText: "Value", InitialValue: "--Payment Mode--" });
        $("#cboContractBy").icsLoadCombo({ List: oContractEmployees, OptionValue: "EmployeeID", DisplayText: "Name", InitialValue: "--Contract By--" });
        $("#cboOrderType").icsLoadCombo({ List: oOrderTypes, OptionValue: "id", DisplayText: "Value", InitialValue: "--Order Type--" });
        $("#cboWorkType").icsLoadCombo({ List: oWorkTypes, OptionValue: "id", DisplayText: "Value", InitialValue: "--Work Type--" });
        $("#cboMeasurementUnit").icsLoadCombo({ List: oMeasurementUnits, OptionValue: "MeasurementUnitID", DisplayText: "Symbol", InitialValue: "--MU--" });
        $("#cboCurrency").icsLoadCombo({ List: oCurrencys, OptionValue: "CurrencyID", DisplayText: "Symbol", InitialValue: "Currency" });
        $("#cboTransportation").icsLoadCombo({ List: oTransportations, OptionValue: "id", DisplayText: "Value", InitialValue: "--Transportation--" });
        $("#cboWarpWeftType").icsLoadCombo({ List: oWarpWefts, OptionValue: "id", DisplayText: "Value", InitialValue: "--Warp Weft--" });
    }

    $("#cboMeasurementUnit").change(function () {
        var unitName = $("#cboMeasurementUnit option:selected").text();
        $("#txtMeasurementUnit").val(unitName);
    });

    $("#cboCurrency").change(function () {
        var currencyName = $("#cboCurrency option:selected").text();
        $("#txtCurrencyPerPick").val(currencyName);
        $("#txtCurrency").val(currencyName);
        if (currencyName == "TK") {
            $("#txtCRate").attr("disabled", true);
            $("#txtCRate").val(1.00);
        }
        else if (currencyName != "TK") {
            $("#txtCRate").attr("disabled", false);
            $("#txtCRate").val(0.00);
        }
    });

    $("#cboConsumptionUnit").change(function () {
        var consumptionUnitName = $("#cboConsumptionUnit option:selected").text();
        $("#txtConsumptionUnit").val(consumptionUnitName);       
    });

    $("#btnAddConsumption").click(function () {
        var oYarnConsumptions = $('#tblYarnConsumptions').datagrid('getRows');
        sessionStorage.setItem("YarnConsumptions", JSON.stringify(oYarnConsumptions));
        sessionStorage.setItem("selectedRowIndex", -1);
        $('#tblYarnConsumptions').data("selectedRowIndex", -1);
        $('#tblYarnConsumptions').data('YarnConsumptionID', 0);
        $("#winYarnConsumption").icsWindow("open", "Add Yarn Consumption");
        ClearWinYarnConsumption();
    });
    
    function ClearWinYarnConsumption() {
        var oWarpWefts = $('#ViewSubContract').data('WarpWefts');
        $("#cboWarpWeftType").icsLoadCombo({ List: oWarpWefts, OptionValue: "id", DisplayText: "Value", InitialValue: "--Warp Weft--" });
        $("#cboConsumptionUnit").icsLoadCombo({ List: [], OptionValue: "", DisplayText: "", InitialValue: ""});
        $("#txtYarn").val("");
        $("#txtConsumptionQty").val("");
        $("#txtTotalConsumptionQty").val("");
        $("#txtConsumptionUnit").val("");
        $("#txtConsumptionRemarks").val("");
    }

    function RefreshControl(oWUSubContract) {
        $("#txtJobNo").val(oWUSubContract.JobNo);
        $('#dtpContractDate').datebox('setValue', oWUSubContract.ContractDateSt);
        $("#txtSupplier").val(oWUSubContract.SupplierName);
        $("#cboContractBy").val(oWUSubContract.ContractBy);
        $("#cboPaymentMode").val(oWUSubContract.PaymentModeInt);
        $("#txtSONo").val(oWUSubContract.SONo);
        $("#txtBuyer").val(oWUSubContract.BuyerName);
        $("#txtSupplier").data('SupplierID', oWUSubContract.SupplierID);
        $("#txtBuyer").data('BuyerID', oWUSubContract.BuyerID);
        $("#txtFabricType").data('FabricID', oWUSubContract.FabricTypeID);
        $("#txtWeaveDesign").data('WeaveDesignID', oWUSubContract.WeaveDesignID);
        $("#txtStyleNo").val(oWUSubContract.StyleNo);
        $("#cboOrderType").val(oWUSubContract.OrderTypeInt);
        $("#txtFabricType").val(oWUSubContract.FabricTypeName);
        $("#txtComposition").data('CompositionID', oWUSubContract.CompositionID);
        $("#txtComposition").val(oWUSubContract.CompositionName);
        $("#txtConstruction").val(oWUSubContract.Construction);
        $("#txtGrayWidth").val(oWUSubContract.GrayWidth);
        $("#txtGrayPick").val(oWUSubContract.GrayPick);
        $("#txtReedSpace").val(oWUSubContract.ReedSpace);
        $("#txtTotalEnds").val(oWUSubContract.TotalEnds);
        $("#txtReedCount").val(oWUSubContract.ReedCount);
        $("#txtWeaveDesign").val(oWUSubContract.WeaveDesignName);
        $("#cboWorkType").val(oWUSubContract.WSCWorkTypeInt);
        $("#txtOrderQuantity").val(oWUSubContract.OrderQty);
        $("#cboMeasurementUnit").val(oWUSubContract.MUnitID);
        $("#txtRatePerMeasurementUnit").val(oWUSubContract.Rate);
        $("#txtMeasurementUnit").val(oWUSubContract.MUSymbol);
        $("#txtRatePerPick").val(oWUSubContract.RatePerPick);
        $("#txtTotalAmount").val(oWUSubContract.TotalAmount);
        $("#txtCRate").val(oWUSubContract.CRate);
        $("#txtCurrency").val(oWUSubContract.CUSymbol);
        $("#cboCurrency").val(oWUSubContract.CurrencyID);
        $("#txtCurrencyPerPick").val(oWUSubContract.CUSymbol);
        $("#cboTransportation").val(oWUSubContract.TransportationInt);
        $('#dtpProdStartDate').datebox('setValue', oWUSubContract.ProdStartDateSt);
        $("#txtProdComment").val(oWUSubContract.ProdStartComments);
        $('#dtpProdCompleteDate').datebox('setValue', oWUSubContract.ProdCompleteDateSt);
        $("#txtRemarks").val(oWUSubContract.Remarks);
        GetContractPerson(oWUSubContract.SupplierID, oWUSubContract.ContractPersonID);
        DynamicRefreshList(oWUSubContract.WUSubContractYarnConsumptions, 'tblYarnConsumptions');
        DynamicRefreshList(oWUSubContract.WUSubContractTermsConditions, 'tblTermsConditions');

        $("#btnAcceptRevise").hide();

        if (sessionStorage.getItem("SubContractHeader") == "View Sub-Contract") {
            $("#ViewSubContract :input").attr("disabled", true);
            $('#dtpContractDate, #dtpProdStartDate, #dtpProdCompleteDate').textbox('readonly', true);
            $('#btnAddConsumption, #btnEditConsumption, #btnDeleteConsumption, #btnPickCondition, #btnRemoveCondition, #btnRefreshCondition, #btnSave, #btnAcceptRevise').hide();
        }
        else if (sessionStorage.getItem("SubContractHeader") == "Revise Sub-Contract") {
            $("#btnSave").hide();
            $("#btnAcceptRevise").show();
        }
    }

    function WinRefreshControl(oYarnConsumption) {
        $("#cboWarpWeftType").val(parseInt(oYarnConsumption.WarpWeftTypeInt));        
        $("#txtYarn").val(oYarnConsumption.YarnName);
        var otempYarnConsumption = {
            ProductID: oYarnConsumption.YarnID,
            ProductCode: oYarnConsumption.YarnCode
        }
        $("#txtYarn").data("YarnID", otempYarnConsumption);
        $("#txtConsumptionQty").val(oYarnConsumption.ConsumptionPerUnit);
        $("#txtTotalConsumptionQty").val(oYarnConsumption.ConsumptionQty);
        $("#txtConsumptionUnit").val(oYarnConsumption.MUSymbol);
        $("#txtConsumptionRemarks").val(oYarnConsumption.Remarks);
        GetYarnUnit(oYarnConsumption.UnitType, oYarnConsumption.MUnitID, oYarnConsumption.MUSymbol);
    }
    
    $("#btnEditConsumption").click(function () {
        var oYarnConsumption = $("#tblYarnConsumptions").datagrid("getSelected");
        if (oYarnConsumption == null || oYarnConsumption.length <= 0) {
            alert("Please select a item from list!");
            return;
        }
        var nSelectedRowIndex = $('#tblYarnConsumptions').datagrid('getRowIndex', oYarnConsumption);
        var oYarnConsumptionDetails = $('#tblYarnConsumptions').datagrid('getRows');
        sessionStorage.setItem("YarnConsumptions", JSON.stringify(oYarnConsumptionDetails));
        sessionStorage.setItem("selectedRowIndex", nSelectedRowIndex);
        $('#tblYarnConsumptions').data("selectedRowIndex", nSelectedRowIndex);
        $("#winYarnConsumption").icsWindow("open", "Edit Yarn Consumption");
        WinRefreshControl(oYarnConsumption);
    });

    $("#btnYarnConsumptionOk").click(function () {
        if (!ValidateWinConsumption()) return;
      
        var oWUSubContractYarnConsumption = {
            WUSubContractYarnConsumptionID: 0,
            WUSubContractID: $('#ViewSubContract').data('WUSubContract').WUSubContractID,
            WarpWeftTypeSt: $("#cboWarpWeftType option:selected").text(),
            WarpWeftTypeInt: parseInt($("#cboWarpWeftType").val()),
            YarnID: $("#txtYarn").data('YarnID').ProductID,
            YarnCode: $("#txtYarn").data('YarnID').ProductCode,
            YarnName: $("#txtYarn").val(),
            ConsumptionPerUnit: $("#txtConsumptionQty").val(),
            MUnitID: parseInt($("#cboConsumptionUnit").val()),
            UnitType: parseInt($("#txtYarn").data('UnitTypeID')),
            ConsumptionQty: $("#txtTotalConsumptionQty").val(),
            MUSymbol: $("#txtConsumptionUnit").val(),
            Remarks: $("#txtConsumptionRemarks").val()
        }
        if (parseInt($('#tblYarnConsumptions').data("selectedRowIndex")) != -1) {
            $('#tblYarnConsumptions').datagrid('updateRow', { index: parseInt($('#tblYarnConsumptions').data("selectedRowIndex")), row: oWUSubContractYarnConsumption });
        }
        else {
            $('#tblYarnConsumptions').datagrid('appendRow', oWUSubContractYarnConsumption);
        }
        $("#winYarnConsumption").icsWindow("close");
    });

    $("#btnSave").click(function () {
        endEditingTermsAndCondition();
        if (!ValidateInput()) return;
        var oWUSubContract = RefreshObject();
        $.ajax({
            type: "POST",
            dataType: "json",
            url: sessionStorage.getItem('BaseAddress') + "/WUSubContract/Save",
            traditional: true,
            data: JSON.stringify(oWUSubContract),
            contentType: "application/json; charset=utf-8",
            success: function (data) {
                debugger;
                oWUSubContract = jQuery.parseJSON(data);
                if (oWUSubContract.ErrorMessage == "" || oWUSubContract.ErrorMessage == null) {
                    alert("Data Saved sucessfully");
                    var oWUSubContracts = sessionStorage.getItem("WUSubContracts");
                    var nIndex = parseInt(sessionStorage.getItem("SelectedRowIndex"));
                    if (oWUSubContracts != null) {
                        oWUSubContracts = jQuery.parseJSON(oWUSubContracts);
                    }
                    else {
                        oWUSubContracts = [];
                    }
                    if (nIndex != -1) {
                        oWUSubContracts[nIndex] = oWUSubContract;
                    }
                    else {
                        sessionStorage.setItem("SelectedRowIndex", oWUSubContracts.length);
                        oWUSubContracts.push(oWUSubContract);
                    }
                    sessionStorage.setItem("WUSubContracts", JSON.stringify(oWUSubContracts));
                    window.location.href = sessionStorage.getItem("BackLink");
                }
                else {
                    alert(oWUSubContract.ErrorMessage);
                }
            },
            error: function (xhr, status, error) {
                alert(error);
            }
        });
    });

    $("#btnAcceptRevise").click(function () {
        endEditingTermsAndCondition();
        if (!ValidateInput()) return;
        if (!confirm("Confirm to Revise?")) return;
        var oWUSubContract = RefreshObject();
        $.ajax({
            type: "POST",
            dataType: "json",
            url: sessionStorage.getItem('BaseAddress') + "/WUSubContract/AcceptRevise",
            traditional: true,
            data: JSON.stringify(oWUSubContract),
            contentType: "application/json; charset=utf-8",
            success: function (data) {
                debugger;
                oWUSubContract = jQuery.parseJSON(data);
                if (oWUSubContract.ErrorMessage == "" || oWUSubContract.ErrorMessage == null) {
                    alert("Data Saved sucessfully");
                    var oWUSubContracts = sessionStorage.getItem("WUSubContracts");
                    var nIndex = parseInt(sessionStorage.getItem("SelectedRowIndex"));
                    if (oWUSubContracts != null) {
                        oWUSubContracts = jQuery.parseJSON(oWUSubContracts);
                    }
                    else {
                        oWUSubContracts = [];
                    }
                    if (nIndex != -1) {
                        oWUSubContracts[nIndex] = oWUSubContract;
                    }
                    else {
                        sessionStorage.setItem("SelectedRowIndex", oWUSubContracts.length);
                        oWUSubContracts.push(oWUSubContract);
                    }
                    sessionStorage.setItem("WUSubContracts", JSON.stringify(oWUSubContracts));
                    window.location.href = sessionStorage.getItem("BackLink");
                }
                else {
                    alert(oWUSubContract.ErrorMessage);
                }
            },
            error: function (xhr, status, error) {
                alert(error);
            }
        });
    });

    function RefreshObject() {
        var oTempWUSubContract = $('#ViewSubContract').data('WUSubContract');
        var oWUSubContract = {
            WUSubContractID: parseInt(oTempWUSubContract.WUSubContractID),
            BUID: parseInt(oTempWUSubContract.BUID),
            JobNo: parseInt(oTempWUSubContract.JobNo),
            ContractDate: $('#dtpContractDate').datebox('getValue'),
            SupplierID: $("#txtSupplier").data('SupplierID'),
            ContractPersonID: parseInt($("#cboContractPerson").val()),
            ContractBy: parseInt($("#cboContractBy").val()),
            ContractStatusInt: parseInt(oTempWUSubContract.ContractStatusInt),
            YarnChallanStatusInt: parseInt(oTempWUSubContract.YarnChallanStatusInt),
            FabricRcvStatusInt: parseInt(oTempWUSubContract.FabricRcvStatusInt),
            PaymentModeInt: parseInt($("#cboPaymentMode").val()),
            SONo: $("#txtSONo").val(),
            BuyerID: $("#txtBuyer").data('BuyerID'),
            StyleNo: $("#txtStyleNo").val(),
            OrderTypeInt: parseInt($("#cboOrderType").val()),
            FabricTypeID: $("#txtFabricType").data('FabricID'),
            CompositionID: $("#txtComposition").data('CompositionID'),
            Construction: $("#txtConstruction").val(),
            GrayWidth: $("#txtGrayWidth").val(),
            GrayPick: parseInt(icsRemoveComma($("#txtGrayPick").val())),
            ReedSpace: $("#txtReedSpace").val(),
            TotalEnds: parseInt(icsRemoveComma($("#txtTotalEnds").val())),
            ReedCount: $("#txtReedCount").val(),
            WeaveDesignID: $("#txtWeaveDesign").data('WeaveDesignID'),
            WSCWorkTypeInt: parseInt($("#cboWorkType").val()),
            OrderQty: $("#txtOrderQuantity").val(),
            MUnitID: parseInt($("#cboMeasurementUnit").val()),
            Rate: $("#txtRatePerMeasurementUnit").val(),
            RatePerPick: $("#txtRatePerPick").val(),
            TotalAmount: $("#txtTotalAmount").val(),
            CRate: $("#txtCRate").val(),
            CurrencyID: parseInt($("#cboCurrency").val()),
            TransportationInt: parseInt($("#cboTransportation").val()),
            ProdStartDate: $('#dtpProdStartDate').datebox('getValue'),
            ProdStartComments: $("#txtProdComment").val(),
            ProdCompleteDate: $('#dtpProdCompleteDate').datebox('getValue'),
            ApprovedBy: parseInt(oTempWUSubContract.ApprovedBy),
            Remarks: $("#txtRemarks").val(),
            WUSubContractYarnConsumptions: $('#tblYarnConsumptions').datagrid('getRows'),
            WUSubContractTermsConditions: $('#tblTermsConditions').datagrid('getRows')
        };
        return oWUSubContract;
    }

    function ValidateWinConsumption() {
        var nWarpWeftType = parseInt($("#cboWarpWeftType").val());
        if (nWarpWeftType == null || nWarpWeftType == 0) {
            alert("Please Select Warp Weft First!");
            $('#cboWarpWeftType').focus();
            return false;
        }
        if ($("#txtYarn").val() == null || $("#txtYarn").val() == "") {
            alert("Please Select Yarn First!");
            $("#txtYarn").focus();
            return false;
        }
        var nYarnID = parseInt($('#txtYarn').data('YarnID'));
        if (nYarnID <= 0 || nYarnID == null)
        {
            alert("Please Pick Yarn First!");
            $("#txtYarn").focus();
            return false;
        }
        var nConsumptionUnit = parseInt($("#cboConsumptionUnit").val());
        if (nConsumptionUnit == null || nConsumptionUnit == 0) {
            alert("Please Select Consumption Unit First!");
            $('#cboConsumptionUnit').focus();
            return false;
        }
        if ($("#txtConsumptionQty").val() == null || $("#txtConsumptionQty").val() == "") {
            alert("Please Pick Consumption Qty First!");
            $("#txtConsumptionQty").focus();
            return false;
        }
        if ($("#txtTotalConsumptionQty").val() == null || $("#txtTotalConsumptionQty").val() == "") {
            alert("Please Pick Total Consumption Qty First!");
            $("#txtTotalConsumptionQty").focus();
            return false;
        }
        return true;
    }

    function ValidateInput() {
        var nPaymentMode = parseInt($("#cboPaymentMode").val());
        if (nPaymentMode == null || nPaymentMode == 0) {
            alert("Please Select Payment Mode First!");
            $('#cboPaymentMode').focus();
            return false;
        }
        if ($("#txtSupplier").val() == null || $("#txtSupplier").val() == "") {
            alert("Please Select Supplier First!");
            $("#txtSupplier").focus();
            return false;
        }
        var nSupplierID = parseInt($('#txtSupplier').data('SupplierID'));
        if (nSupplierID <= 0 || nSupplierID == null) {
            alert("Please Pick Supplier First!");
            $("#txtSupplier").focus();
            return false;
        }
        var nContractPerson = parseInt($("#cboContractPerson").val());
        if (nContractPerson == null || nContractPerson == 0) {
            alert("Please Select Contract Person First!");
            $('#cboContractPerson').focus();
            return false;
        }
        if ($("#txtBuyer").val() == null || $("#txtBuyer").val() == "") {
            alert("Please Select Buyer First!");
            $("#txtBuyer").focus();
            return false;
        }
        var nBuyerID = parseInt($('#txtBuyer').data('BuyerID'));
        if (nBuyerID <= 0 || nBuyerID == null) {
            alert("Please Pick Buyer First!");
            $("#txtBuyer").focus();
            return false;
        }
        var nOrderType = parseInt($("#cboOrderType").val());
        if (nOrderType == null || nOrderType == 0) {
            alert("Please Select Order Type First!");
            $('#cboOrderType').focus();
            return false;
        }
        if ($("#txtSONo").val() == null || $("#txtSONo").val() == "") {
            alert("Please Write SONo First!");
            $("#txtSONo").focus();
            return false;
        }
        var nWorkType = parseInt($("#cboWorkType").val());
        if (nWorkType == null || nWorkType == 0) {
            alert("Please Select Work Type First!");
            $('#cboWorkType').focus();
            return false;
        }
        if ($("#txtStyleNo").val() == null || $("#txtStyleNo").val() == "") {
            alert("Please Pick Style No First!");
            $("#txtStyleNo").focus();
            return false;
        }
        if ($("#txtFabricType").val() == null || $("#txtFabricType").val() == "") {
            alert("Please Select Fabric Type First!");
            $("#txtFabricType").focus();
            return false;
        }
        var nFabricID = parseInt($("#txtFabricType").data('FabricID'));
        if (nFabricID <= 0 || nFabricID == null) {
            alert("Please Pick Fabric Type First!");
            $("#txtFabricType").focus();
            return false;
        }
        if ($("#txtComposition").val() == null || $("#txtComposition").val() == "") {
            alert("Please Select Composition First!");
            $("#txtComposition").focus();
            return false;
        }
        var nCompositionID = parseInt($("#txtComposition").data('CompositionID'));
        if (nCompositionID <= 0 || nCompositionID == null) {
            alert("Please Pick Composition First!");
            $("#txtComposition").focus();
            return false;
        }
        if ($("#txtConstruction").val() == null || $("#txtConstruction").val() == "") {
            alert("Please Write Construction First!");
            $("#txtConstruction").focus();
            return false;
        }
        if ($("#txtWeaveDesign").val() == null || $("#txtWeaveDesign").val() == "") {
            alert("Please Select Weave Design First!");
            $("#txtWeaveDesign").focus();
            return false;
        }
        var nWeaveDesignID = parseInt($("#txtWeaveDesign").data('WeaveDesignID'));
        if (nWeaveDesignID <= 0 || nWeaveDesignID == null) {
            alert("Please Pick Weave Design First!");
            $("#txtWeaveDesign").focus();
            return false;
        }
        if ($("#txtGrayWidth").val() == null || $("#txtGrayWidth").val() == "") {
            alert("Please Write Gray Width No First!");
            $("#txtGrayWidth").focus();
            return false;
        }
        if ($("#txtReedSpace").val() == null || $("#txtReedSpace").val() == "") {
            alert("Please Write Reed Space First!");
            $("#txtReedSpace").focus();
            return false;
        }
        if ($("#txtReedCount").val() == null || $("#txtReedCount").val() == "") {
            alert("Please Write Reed Count First!");
            $("#txtReedCount").focus();
            return false;
        }
        if ($("#txtTotalEnds").val() <= 0 || $("#txtTotalEnds").val() == "") {
            alert("Please Write Total Ends First!");
            $("#txtTotalEnds").focus();
            return false;
        }
        if ($("#txtGrayPick").val() <= 0 || $("#txtGrayPick").val() == "") {
            alert("Please Write Gray Pick First!");
            $("#txtGrayPick").focus();
            return false;
        }
        if ($("#txtOrderQuantity").val() <= 0 || $("#txtOrderQuantity").val() == "") {
            alert("Please Write Order Quantity First!");
            $("#txtOrderQuantity").focus();
            return false;
        }
        var nMUnit = parseInt($("#cboMeasurementUnit").val());
        if (nMUnit == null || nMUnit == 0) {
            alert("Please Select MUnit First!");
            $('#cboMeasurementUnit').focus();
            return false;
        }
        var nTransportation = parseInt($("#cboTransportation").val());
        if (nTransportation == null || nTransportation == 0) {
            alert("Please Select Transportation First!");
            $('#cboTransportation').focus();
            return false;
        }
        if ($("#txtRatePerMeasurementUnit").val() <= 0 || $("#txtRatePerMeasurementUnit").val() == "") {
            alert("Please Write Rate First!");
            $("#txtRatePerMeasurementUnit").focus();
            return false;
        }
        var nCurrency = parseInt($("#cboCurrency").val());
        if (nCurrency == null || nCurrency == 0) {
            alert("Please Select Currency First!");
            $('#cboCurrency').focus();
            return false;
        }
        if ($("#txtRatePerPick").val() <= 0 || $("#txtRatePerPick").val() == "") {
            alert("Please Write Rate Per Pick First!");
            $("#txtRatePerPick").focus();
            return false;
        }
        var nProdStartDate = $('#dtpProdStartDate').datebox('getValue');
        var nProdCompleteDate = $('#dtpProdCompleteDate').datebox('getValue');
        if (nProdStartDate >= nProdCompleteDate) {
            alert("Please Insert Correct Prod Date Format !!!");
            return false;
        }
        if ($("#txtTotalAmount").val() <= 0 || $("#txtTotalAmount").val() == "") {
            alert("Please Write Total Amount First!");
            $("#txtTotalAmount").focus();
            return false;
        }
        debugger;
        var oYarnConsumptions = $('#tblYarnConsumptions').datagrid('getRows');
        if (oYarnConsumptions == null || oYarnConsumptions.length <= 0) {
            alert("Please Add Atleast One Yarn Consumption!"); 
            $("#ViewSubContract").tabs('select', "Yarn Consumption");
            return false;
        }
        var existWarp = false, existWeft = false;
        for (var i = 0; i < oYarnConsumptions.length; i++) {
            if (oYarnConsumptions[i].WarpWeftTypeInt == 1) {
                existWarp = true;
            }
            else if (oYarnConsumptions[i].WarpWeftTypeInt == 2) {
                existWeft = true;
            }
            else if (oYarnConsumptions[i].WarpWeftTypeInt == 3) {
                existWarp = true;
                existWeft = true;
            }
        }
        if (existWarp == false || existWeft == false) {
            alert("Please insert at least one Warp and weft !!");
            return false;
        }
        var oTermsConditions = $('#tblTermsConditions').datagrid('getRows');
        if (oTermsConditions == null || oTermsConditions.length <= 0) {
            alert("Please Add Atleast One Term Condition !!");
            $("#ViewSubContract").tabs('select', "Terms & Condition");
            return false;
        }
        return true;
    }

    function SetPickerValueAssign(oPickerobj) {
        var oreturnObj = null, oreturnobjs = [];
        if (oPickerobj.multiplereturn) {
            oreturnobjs = $("#" + oPickerobj.tableid).datagrid('getChecked');
        }
        else {
            oreturnObj = $("#" + oPickerobj.tableid).datagrid('getSelected');
        }
        $("#" + oPickerobj.winid).icsWindow("close");
        $("#" + oPickerobj.winid).remove();

        if (oPickerobj.winid == 'winSuppliers') {
            if (oreturnObj != null && oreturnObj.ContractorID > 0) {
                $("#txtSupplier").val(oreturnObj.Name);
                $("#txtSupplier").addClass('fontColorOfPickItem');
                $("#txtSupplier").data('SupplierID', parseInt(oreturnObj.ContractorID));
                GetContractPerson(parseInt(oreturnObj.ContractorID), 0);
                $("#cboContractPerson").focus();
            }
        }
        else if (oPickerobj.winid == 'winBuyers') {
            if (oreturnObj != null && oreturnObj.ContractorID > 0) {
                $("#txtBuyer").val(oreturnObj.Name);
                $("#txtBuyer").addClass('fontColorOfPickItem');
                $("#txtBuyer").data('BuyerID', parseInt(oreturnObj.ContractorID));
            }
        }
        else if (oPickerobj.winid == 'winFabrics') {
            if (oreturnObj != null && oreturnObj.FabricProcessID > 0) {
                $("#txtFabricType").val(oreturnObj.Name);
                $("#txtFabricType").addClass('fontColorOfPickItem');
                $("#txtFabricType").data('FabricID', parseInt(oreturnObj.FabricProcessID));
            }
        }
        else if (oPickerobj.winid == 'winCompositions') {
            if (oreturnObj != null && oreturnObj.ProductID > 0) {               
                $("#txtComposition").val(oreturnObj.ProductName);
                $("#txtComposition").addClass('fontColorOfPickItem');
                $("#txtComposition").data('CompositionID', parseInt(oreturnObj.ProductID));

                var oMeasurementUnits = $('#ViewSubContract').data('MeasurementUnits');
                var oMUnits = [];
                for (var i = 0; i < oMeasurementUnits.length; i++) {
                    if (oMeasurementUnits[i].UnitType == oreturnObj.UnitType) {
                        oMUnits.push(oMeasurementUnits[i]);
                    }
                }
                $("#cboMeasurementUnit").icsLoadCombo({ List: oMUnits, OptionValue: "MeasurementUnitID", DisplayText: "Symbol", InitialValue: "--MU--" });
                $("#cboMeasurementUnit").val(oreturnObj.MeasurementUnitID);
            }
        }
        else if (oPickerobj.winid == 'winWeaveDesigns') {
            if (oreturnObj != null && oreturnObj.FabricProcessID > 0) {
                $("#txtWeaveDesign").val(oreturnObj.Name);
                $("#txtWeaveDesign").addClass('fontColorOfPickItem');
                $("#txtWeaveDesign").data('WeaveDesignID', parseInt(oreturnObj.FabricProcessID));
            }
        }
        else if (oPickerobj.winid == 'winYarns') {
            if (oreturnObj != null && oreturnObj.ProductID > 0) {
                $("#txtYarn").val(oreturnObj.ProductName);
                $("#txtYarn").addClass('fontColorOfPickItem');
                $("#txtYarn").data('YarnID', oreturnObj);
                $("#txtYarn").data('UnitTypeID', parseInt(oreturnObj.UnitTypeInInt));
                GetYarnUnit(parseInt(oreturnObj.UnitTypeInInt), 0, []);
                $("#cboConsumptionUnit").focus();
            }
        }
        else if (oPickerobj.winid == 'winConditions') {
            if (oreturnobjs != null && oreturnobjs.length > 0) {
                SaveTermsAndCondition(oreturnobjs);
            }
        }
    }

    function GetContractPerson(nContractorID, nContractPersonID) {
        var oContractor = { ContractorID: nContractorID };
        $.ajax
            ({
                type: "POST",
                dataType: "json",
                url: sessionStorage.getItem('BaseAddress') + "/Contractor/GetContactPersonnels",
                traditional: true,
                data: JSON.stringify(oContractor),
                contentType: "application/json; charset=utf-8",
                success: function (data) {
                    var oContractPersonnels = jQuery.parseJSON(data);
                    if (oContractPersonnels != null) {
                        if (nContractPersonID != 0) {
                            $("#cboContractPerson").icsLoadCombo({ List: oContractPersonnels, OptionValue: "ContactPersonnelID", DisplayText: "Name", InitialValue: "--Contract Person--" });
                            $("#cboContractPerson").val(nContractPersonID);
                        }
                        else {
                            $("#cboContractPerson").icsLoadCombo({ List: oContractPersonnels, OptionValue: "ContactPersonnelID", DisplayText: "Name", InitialValue: "--Contract Person--" });
                        }
                    }
                },
                error: function (xhr, status, error) {
                    alert(error);
                }
            });
    }

    function GetYarnUnit(nUnitTypeInInt, nMunitID, sMUnitName) {
        var oMeasurementUnits = [];
        var oTempMeasurementUnits = $('#ViewSubContract').data('MeasurementUnits');
        for (var i = 0; i < oTempMeasurementUnits.length; i++) {
            if (parseInt(oTempMeasurementUnits[i].UnitType) == parseInt(nUnitTypeInInt)) {
                oMeasurementUnits.push(oTempMeasurementUnits[i]);
            }
        }
        $("#cboConsumptionUnit").icsLoadCombo({ List: oMeasurementUnits, OptionValue: "MeasurementUnitID", DisplayText: "Symbol", InitialValue: "--Select--" });
        $("#cboConsumptionUnit").val(nMunitID);
        $("#txtConsumptionUnit").val(sMUnitName);
    }

    function SaveTermsAndCondition(oTermsAndConditionSetups) {
        debugger;
        var oTermsAndConditions = $('#tblTermsConditions').datagrid('getRows');
        for (var i = 0; i < oTermsAndConditionSetups.length; i++) {
            var IsExist = false;
            for (var j = 0; j < oTermsAndConditions.length; j++) {
                if (oTermsAndConditionSetups[i].TermsAndConditionText == oTermsAndConditions[j].TermsAndCondition) {
                    IsExist = true;
                }
            }
            if (!IsExist) {
                var oWUSubContractTermsAndConditions = {
                    WUSubContractTermsConditionID: 0,
                    WUSubContractID: $('#ViewSubContract').data('WUSubContract').WUSubContractID,
                    TermsAndCondition: oTermsAndConditionSetups[i].TermsAndConditionText
                };
                $('#tblTermsConditions').datagrid('appendRow', oWUSubContractTermsAndConditions);
            }

        }
    }

    function onClickCell(index, field) {
        if (editIndexTermsAndCondition != index) {
            if (endEditingTermsAndCondition()) {
                $('#tblTermsConditions').datagrid('selectRow', index).datagrid('beginEdit', index);
                var ed = $('#tblTermsConditions').datagrid('getEditor', { index: index, field: field });
                if (ed) {
                    ($(ed.target).data('textbox') ? $(ed.target).textbox('textbox') : $(ed.target)).focus();
                }
                editIndexTermsAndCondition = index;
            } else {
                setTimeout(function () {
                    $('#tblTermsConditions').datagrid('selectRow', editIndexTermsAndCondition);
                }, 0);
            }
        }
    }

    var editIndexTermsAndCondition = undefined;
    function endEditingTermsAndCondition() {
        if (editIndexTermsAndCondition == undefined) { return true }
        if ($('#tblTermsConditions').datagrid('validateRow', editIndexTermsAndCondition)) {
            $('#tblTermsConditions').datagrid('endEdit', editIndexTermsAndCondition);
            editIndexTermsAndCondition = undefined;
            return true;
        }
        else {
            return false;
        }
    }

    $("#btnClose").click(function () {
        window.location.href = sessionStorage.getItem("BackLink");
    })

    $("#btnDeleteConsumption").click(function (e) {
        var oYarnConsumptions = $('#tblYarnConsumptions').datagrid('getSelected');
        if(oYarnConsumptions == null)
        {
            alert("Please select a item from list!");
            return;
        }
        if (!confirm("Confirm to Delete?")) return ;
        var SelectedRowIndex = $('#tblYarnConsumptions').datagrid('getRowIndex', oYarnConsumptions);
        alert("Delete sucessfully");
        $('#tblYarnConsumptions').datagrid('deleteRow', SelectedRowIndex);
        var oYarnConsumptions = $('#tblYarnConsumptions').datagrid('getRows');
        DynamicRefreshList(oYarnConsumptions, "tblYarnConsumptions");
    });

    $("#btnRemoveCondition").click(function (e) {
        var oTermsAndConditions = $('#tblTermsConditions').datagrid('getSelected');
        if(oTermsAndConditions == null)
        {
            alert("Please select a item from list!");
            return;
        }
        if (!confirm("Confirm to Delete?")) return ;
        var SelectedRowIndex = $('#tblTermsConditions').datagrid('getRowIndex', oTermsAndConditions);
        alert("Delete sucessfully");
        $('#tblTermsConditions').datagrid('deleteRow', SelectedRowIndex);
        var oTermsAndConditions = $('#tblTermsConditions').datagrid('getRows');
        DynamicRefreshList(oTermsAndConditions, "tblTermsConditions");
    });

    $("#btnRefreshCondition").click(function (e) {
        endEditingTermsAndCondition();
        var oTermsAndConditions = $('#tblTermsConditions').datagrid('getRows');
        DynamicRefreshList(oTermsAndConditions, "tblTermsConditions");
    });

    $("#btnClearSupplier").click(function () {
        $("#txtSupplier").val("");
        $("#txtSupplier").removeClass('fontColorOfPickItem');
        $("#txtSupplier").data('SupplierID', 0);        
        $("#txtSupplier").focus();
        $("#cboContractPerson").icsLoadCombo({ List: [], OptionValue: "", DisplayText: "", InitialValue: ""});
    });

    $("#btnClearBuyer").click(function () {
        $("#txtBuyer").val("");
        $("#txtBuyer").removeClass('fontColorOfPickItem');
        $("#txtBuyer").data('BuyerID', 0);
    });

    $("#btnClearFabric").click(function () {
        $("#txtFabricType").val("");
        $("#txtFabricType").removeClass('fontColorOfPickItem');
        $("#txtFabricType").data('FabricID', 0);
    });

    $("#btnClearComposition").click(function () {
        $("#txtComposition").val("");
        $("#txtComposition").removeClass('fontColorOfPickItem');
        $("#txtComposition").data('CompositionID', 0);
    });

    $("#btnClearWeaveDesign").click(function () {
        $("#txtWeaveDesign").val("");
        $("#txtWeaveDesign").removeClass('fontColorOfPickItem');
        $("#txtWeaveDesign").data('WeaveDesignID', 0);
    });

    $("#btnClearYarn").click(function () {
        $("#txtYarn").val("");
        $("#txtYarn").removeClass('fontColorOfPickItem');
        $("#txtYarn").data('YarnID', null);
        $("#txtYarn").focus();
        $("#cboConsumptionUnit").icsLoadCombo({ List: [], OptionValue: "", DisplayText: "", InitialValue: ""});
    });

    $("#btnYarnConsumptionClose").click(function () {
        $("#winYarnConsumption").icsWindow("close");
    });

    $("#txtSupplier").keydown(function (e) {
        var code = (e.keyCode ? e.keyCode : e.which);
        if (code == 13) // Enter Press
        {
            var sSupplierName = $.trim($("#txtSupplier").val());
            PickSupplier(sSupplierName);
        }
    });   

    $("#txtSupplier").keydown(function (e) {
        var code = (e.keyCode ? e.keyCode : e.which);
        if (code == 8) //backspace=8
        {
            $("#txtSupplier").removeClass("fontColorOfPickItem");
            $("#txtSupplier").data('SupplierID', 0);
            $("#cboContractPerson").icsLoadCombo({ List: [], OptionValue: "", DisplayText: "", InitialValue: "" });
        }
    });

    $("#txtBuyer").keydown(function (e) {
        var code = (e.keyCode ? e.keyCode : e.which);
        if (code == 13) // Enter Press
        {
            var sBuyerName = $.trim($("#txtBuyer").val());
            PickBuyer(sBuyerName);
        }
    });

    $("#txtBuyer").keydown(function (e) {
        var code = (e.keyCode ? e.keyCode : e.which);
        if (code == 8) //backspace=8
        {
            $("#txtBuyer").removeClass("fontColorOfPickItem");
            $("#txtBuyer").data('BuyerID', 0);
        }
    });

    $("#txtFabricType").keydown(function (e) {
        var code = (e.keyCode ? e.keyCode : e.which);
        if (code == 13) // Enter Press
        {
            var sFabricName = $.trim($("#txtFabricType").val());
            PickFabric(sFabricName);
        }
    });

    $("#txtFabricType").keydown(function (e) {
        var code = (e.keyCode ? e.keyCode : e.which);
        if (code == 8) //backspace=8
        {
            $("#txtFabricType").removeClass("fontColorOfPickItem");
            $("#txtFabricType").data('FabricID', 0);
        }
    });

    $("#txtComposition").keydown(function (e) {
        var code = (e.keyCode ? e.keyCode : e.which);
        if (code == 13) // Enter Press
        {
            var sCompositionName = $.trim($("#txtComposition").val());
            PickComposition(sCompositionName);
        }
    });

    $("#txtComposition").keydown(function (e) {
        var code = (e.keyCode ? e.keyCode : e.which);
        if (code == 8) //backspace=8
        {
            $("#txtComposition").removeClass("fontColorOfPickItem");
            $("#txtComposition").data('CompositionID', 0);
        }
    });

    $("#txtWeaveDesign").keydown(function (e) {
        var code = (e.keyCode ? e.keyCode : e.which);
        if (code == 13) // Enter Press
        {
            var sWeaveDesignName = $.trim($("#txtWeaveDesign").val());
            PickWeaveDesign(sWeaveDesignName);
        }
    });

    $("#txtWeaveDesign").keydown(function (e) {
        var code = (e.keyCode ? e.keyCode : e.which);
        if (code == 8) //backspace=8
        {
            $("#txtWeaveDesign").removeClass("fontColorOfPickItem");
            $("#txtWeaveDesign").data('WeaveDesignID', 0);
        }
    });

    $("#txtYarn").keydown(function (e) {
        var code = (e.keyCode ? e.keyCode : e.which);
        if (code == 13) // Enter Press
        {
            var sYarnName = $.trim($("#txtYarn").val());
            PickYarn(sYarnName);
        }
    });

    $("#txtYarn").keydown(function (e) {
        var code = (e.keyCode ? e.keyCode : e.which);
        if (code == 8) //backspace=8
        {
            $("#txtYarn").removeClass("fontColorOfPickItem");
            $("#txtYarn").data('YarnID', null);
            $("#cboConsumptionUnit").icsLoadCombo({ List: [], OptionValue: "", DisplayText: "", InitialValue: ""});
        }
    });

    $("#btnPickSupplier").click(function () {
        PickSupplier('');
    });

    $("#btnPickBuyer").click(function () {
        PickBuyer('');
    });

    $("#btnPickFabric").click(function () {
        PickFabric('');
    });

    $("#btnPickComposition").click(function () {
        PickComposition('');
    });

    $("#btnPickWeaveDesign").click(function () {
        PickWeaveDesign('');
    });

    $("#btnPickYarn").click(function () {
        PickYarn('');
    });

    $("#btnPickCondition").click(function () {
        var obj = {
            BaseAddress: sessionStorage.getItem('BaseAddress'),
            ControllerName: "WUSubContract",
            ActionName: "GetConditions",
            IsWinClose: false
        };

        $.icsProgressBar(true);
        $.icsDataGets(obj, function (response) {
            $.icsProgressBar(false);
            if (response.status && response.objs.length > 0) {
                if (response.objs[0].TermsAndConditionID > 0) {
                    var tblColums = [];
                    var oColumn = { field: "TermsAndConditionText", title: "Term and Condition", width: 420, align: "left" }; tblColums.push(oColumn);
                    var oPickerParam = {
                        winid: 'winConditions',
                        winclass: 'clsCondition',
                        winwidth: 500,
                        winheight: 460,
                        tableid: 'tblConditions',
                        tablecolumns: tblColums,
                        datalist: response.objs,
                        multiplereturn: true,
                        searchingbyfieldName: 'NameCode',
                        windowTittle: 'Terms & Condition List'
                    };
                    $.icsPicker(oPickerParam);
                    IntializePickerbutton(oPickerParam);
                }
                else {
                    alert(response.objs[0].ErrorMessage);
                }

            } else {
                alert("Data Not Found.");
                return;
            }
        });

    });

    function PickSupplier(sSupplierName)
    {
        // Supplier = 1
        var oContractor = { Params: "1~"+sSupplierName+"~"+ $("#cboPaymentMode").data("BUID") };//here 1 Is Supplier
        var obj = {
            BaseAddress: sessionStorage.getItem('BaseAddress'),
            Object: oContractor,
            ControllerName: "Contractor",
            ActionName: "ContractorSearchByNameType",
            IsWinClose: false
        };
        $.icsDataGets(obj, function (response) {
            if (response.status && response.objs.length > 0) {
                if (response.objs[0].ContractorID > 0) {
                    var tblColums = []; var oColumn = { field: "Name", title: "Name", width: 200, align: "left" }; tblColums.push(oColumn);
                    oColumn = { field: "Address", title: "Address", width: 120, align: "left" }; tblColums.push(oColumn);
                    oColumn = { field: "Email", title: "Email", width: 90, align: "left" }; tblColums.push(oColumn);
                    oColumn = { field: "ShortName", title: "Short Name", width: 90, align: "left" }; tblColums.push(oColumn);
                    var oPickerParam = {
                        winid: 'winSuppliers',
                        winclass: 'clsSupplier',
                        winwidth: 600,
                        winheight: 460,
                        tableid: 'tblSuppliers',
                        tablecolumns: tblColums,
                        datalist: response.objs,
                        multiplereturn: false,
                        searchingbyfieldName: 'Name',
                        windowTittle: 'Supplier List'
                    };
                    $.icsPicker(oPickerParam);
                    IntializePickerbutton(oPickerParam);
                }
                else { alert(response.objs[0].ErrorMessage); }
            }else{
                alert("Data Not Found.");
            }
        });
    }

    function PickBuyer(sBuyerName)
    {
        // Buyer = 1
        var oContractor = { Params: "2~"+sBuyerName+"~"+ $("#cboPaymentMode").data("BUID") };//here 1 Is Supplier
        var obj = {
            BaseAddress: sessionStorage.getItem('BaseAddress'),
            Object: oContractor,
            ControllerName: "Contractor",
            ActionName: "ContractorSearchByNameType",
            IsWinClose: false
        };
        $.icsDataGets(obj, function (response) {
            if (response.status && response.objs.length > 0) {
                if (response.objs[0].ContractorID > 0) {
                    var tblColums = []; var oColumn = { field: "Name", title: "Name", width: 200, align: "left" }; tblColums.push(oColumn);
                    oColumn = { field: "Address", title: "Address", width: 120, align: "left" }; tblColums.push(oColumn);
                    oColumn = { field: "Email", title: "Email", width: 90, align: "left" }; tblColums.push(oColumn);
                    oColumn = { field: "ShortName", title: "Short Name", width: 90, align: "left" }; tblColums.push(oColumn);
                    var oPickerParam = {
                        winid: 'winBuyers',
                        winclass: 'clsBuyer',
                        winwidth: 600,
                        winheight: 460,
                        tableid: 'tblBuyers',
                        tablecolumns: tblColums,
                        datalist: response.objs,
                        multiplereturn: false,
                        searchingbyfieldName: 'Name',
                        windowTittle: 'Buyer List'
                    };
                    $.icsPicker(oPickerParam);
                    IntializePickerbutton(oPickerParam);
                }
                else { alert(response.objs[0].ErrorMessage); }
            }else{
                alert("Data Not Found.");
            }
        });
    }

    function PickFabric(sFabricName)
    {
        // Process = 1
        var oFabricProcess = { Params: "1~"+sFabricName };//here 1 Is Supplier
        var obj = {
            BaseAddress: sessionStorage.getItem('BaseAddress'),
            Object: oFabricProcess,
            ControllerName: "WUSubContract",
            ActionName: "GetsFabricName",
            IsWinClose: false
        };
        $.icsDataGets(obj, function (response) {
            if (response.status && response.objs.length > 0) {
                if (response.objs[0].FabricProcessID > 0) {
                    var tblColums = []; var oColumn = { field: "Name", title: "Name", width: 250, align: "left" }; tblColums.push(oColumn);
                    var oPickerParam = {
                        winid: 'winFabrics',
                        winclass: 'clsFabric',
                        winwidth: 300,
                        winheight: 460,
                        tableid: 'tblFabrics',
                        tablecolumns: tblColums,
                        datalist: response.objs,
                        multiplereturn: false,
                        searchingbyfieldName: 'Name',
                        windowTittle: 'Fabric List'
                    };
                    $.icsPicker(oPickerParam);
                    IntializePickerbutton(oPickerParam);
                }
                else { alert(response.objs[0].ErrorMessage); }
            }else{
                alert("Data Not Found.");
            }
        });
    }

    function PickWeaveDesign(sWeaveDesignName)
    {
        // Weave = 1
        var oFabricProcess = { Params: "3~"+sWeaveDesignName };//here 1 Is Supplier
        var obj = {
            BaseAddress: sessionStorage.getItem('BaseAddress'),
            Object: oFabricProcess,
            ControllerName: "WUSubContract",
            ActionName: "GetsFabricName",
            IsWinClose: false
        };
        $.icsDataGets(obj, function (response) {
            if (response.status && response.objs.length > 0) {
                if (response.objs[0].FabricProcessID > 0) {
                    var tblColums = []; var oColumn = { field: "Name", title: "Name", width: 250, align: "left" }; tblColums.push(oColumn);
                    var oPickerParam = {
                        winid: 'winWeaveDesigns',
                        winclass: 'clsWeaveDesign',
                        winwidth: 300,
                        winheight: 460,
                        tableid: 'tblWeaveDesigns',
                        tablecolumns: tblColums,
                        datalist: response.objs,
                        multiplereturn: false,
                        searchingbyfieldName: 'Name',
                        windowTittle: 'Weave Design List'
                    };
                    $.icsPicker(oPickerParam);
                    IntializePickerbutton(oPickerParam);
                }
                else { alert(response.objs[0].ErrorMessage); }
            }else{
                alert("Data Not Found.");
            }
        });
    }

    function PickYarn(sYarnName) {
        var oYarnName = $("#txtYarn").val();
        if (oYarnName == null || oYarnName == "") {
            alert("Please write a Yarn name!");
            $("#txtYarn").focus();
            return false;
        }
        var oProductSearch = {
            BUID: $("#cboPaymentMode").data("BUID"),
            ProductName: sYarnName,
        };

        var obj = {
            BaseAddress: sessionStorage.getItem('BaseAddress'),
            Object: (oProductSearch) ,
            ControllerName: "WUSubContract",
            ActionName: "GetProducts",
            IsWinClose: false
        };
        $.icsProgressBar(true);
        $.icsDataGets(obj, function (response) {
            $.icsProgressBar(false);
            if (response.status && response.objs.length > 0) {
                if (response.objs[0].ProductID > 0) {
                    var tblColums = [];
                    var oColumn = { field: "ProductCode", title: "Product Code", width:150, align: "left" }; tblColums.push(oColumn);
                    oColumn = { field: "ProductName", title: "Product Name", width:300, align: "left" }; tblColums.push(oColumn);
                    var oPickerParam = {
                        winid: 'winYarns',
                        winclass: 'clsYarn',
                        winwidth: 600,
                        winheight: 460,
                        tableid: 'tblYarns',
                        tablecolumns: tblColums,
                        datalist: response.objs,
                        multiplereturn: false,
                        searchingbyfieldName: 'ProductName',
                        windowTittle: 'Yarn List'
                    };
                    $.icsPicker(oPickerParam);
                    IntializePickerbutton(oPickerParam);
                }
                else {
                    alert(response.objs[0].ErrorMessage);
                }

            } else{
                alert("Data Not Found.");
                return;
            }
        });
    }

    function PickComposition(sCompositionName) {
        var oProductSearch = {
            BUID: $("#cboPaymentMode").data("BUID"),
            ProductName: sCompositionName,
        };

        var obj = {
            BaseAddress: sessionStorage.getItem('BaseAddress'),
            Object: (oProductSearch) ,
            ControllerName: "WUSubContract",
            ActionName: "GetCompositions",
            IsWinClose: false
        };
        $.icsProgressBar(true);
        $.icsDataGets(obj, function (response) {
            $.icsProgressBar(false);
            if (response.status && response.objs.length > 0) {
                if (response.objs[0].ProductID > 0) {
                    var tblColums = [];
                    var oColumn = { field: "ProductCode", title: "Product Code", width:150, align: "left" }; tblColums.push(oColumn);
                    oColumn = { field: "ProductName", title: "Product Name", width:300, align: "left" }; tblColums.push(oColumn);
                    var oPickerParam = {
                        winid: 'winCompositions',
                        winclass: 'clsComposition',
                        winwidth: 600,
                        winheight: 460,
                        tableid: 'tblCompositions',
                        tablecolumns: tblColums,
                        datalist: response.objs,
                        multiplereturn: false,
                        searchingbyfieldName: 'ProductName',
                        windowTittle: 'Composition List'
                    };
                    $.icsPicker(oPickerParam);
                    IntializePickerbutton(oPickerParam);
                }
                else {
                    alert(response.objs[0].ErrorMessage);
                }
            } else{
                alert("Data Not Found.");
                return;
            }
        });
    }
    
    function IntializePickerbutton(oPickerobj) {
        $("#" + oPickerobj.winid).find("#btnOk").click(function () {
            //for Single Select
            SetPickerValueAssign(oPickerobj);
        });
        $(document).find('.' + oPickerobj.winclass).keydown(function (e) {
            if (e.which == 13)//enter=13
            {
                SetPickerValueAssign(oPickerobj);
            }
        });
    }

</script>