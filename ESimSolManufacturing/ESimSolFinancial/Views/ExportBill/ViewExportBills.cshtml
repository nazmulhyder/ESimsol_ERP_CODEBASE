@{
    ViewBag.Title = "Export Bill  List";
}
@model IEnumerable<ESimSol.BusinessObjects.ExportBill>

<head>
 <title>ExportBill</title>
    
</head>
<body>     
    <div id="progressbarParent" style="width:100%;height:100%;margin:0 auto;text-align:center; margin-left: auto;margin-right: auto;left: 0;right: 0;z-index: 1;">
        <div style="margin: 0px auto;margin-top: 251px;text-align:center;width:390px;">
            <label style="font-size:18px;">Please wait</label>
            <div id="progressbar" style="width:100%;height:37px;"></div>
        </div>
    </div>

 <div id="winPrintFormat" style="width:400px;" class="easyui-window winstyle" title="Print Format" data-options="modal:true,closed:true,collapsible:false,minimizable:false,maximizable:false,closable:false">
        <div>
            <table id="tblExportDocSetup" title="Document Names" class="easyui-datagrid" style="width:100%;height:250px;" fitcolumns="false" rownumbers="true" pagination="false" singleselect="false" autorowheight="false" >
                <thead>
                    <th data-options="field:'selected',checkbox:true"></th>
                    <th field="DocName" width="350px" align="Left">Doc Name</th>
                </thead>
            </table>
        </div>
        <table border="0" cellpadding="0" cellspacing="0" style="width:100%">
            <tr>
                <td style="width:50%">
                    <fieldset>
                        <legend>Paper Format : </legend>
                        <table style="width:100%;">
                            <tr>
                                <td>
                                    <input id="chkPrintNormal" type="checkbox" checked />Normal Format
                                </td>
                            </tr>
                            <tr>
                                <td>
                                    <input id="chkPrintTitleInPAD" type="checkbox" />Pad Format
                                </td>
                            </tr>
                            <tr>
                                <td>
                                    <input id="chkPrintTitleInImg" type="checkbox" />Image Format
                                </td>
                            </tr>
                        </table>
                    </fieldset>
                </td>
                <td style="width:50%; vertical-align:top">
                    <fieldset>
                        <legend>Unit Setup & Page Size: </legend>
                        <table style="width:100%;">
                            <tr>
                                <td>
                                    <input id="rdoInLbs" type="radio" name="Unit" value="2" /> <label id="lblMunitOne">In LBS</label>
                                    <input id="rdoInKg" type="radio" name="Unit" value="1" /> <label id="lblMunitTwo">In KG</label>
                                </td>
                            </tr>
                            <tr>
                                <td>
                                    <input id="rdoInA4" type="radio" name="PageSize" value="1" /> A4
                                    <input id="rdoInLegal" type="radio" name="PageSize" value="2" /> Legal
                                </td>
                            </tr>
                            
                        </table>
                    </fieldset>
                </td>
            </tr>
        </table>
     <fieldset>
         <legend> </legend>
         <table border="0" cellpadding="0" cellspacing="0" style="width:100%">
             <tr>
                 <td style="width:40%;"><input id="chkIsApplicant" type="checkbox" />Is Applicant</td>
                 <td style="width:50%;">Doc Date : <input type="text" style="width:65%;" id="txtDocDate" class="easyui-datebox" required="required" data-options="formatter:icsdateformat,parser:icsdateparser" /></td>
                 <td style="width:10%;"><a id="btnSaveDocDate" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-add" plain="true"></a></td>
            </tr>
           
         </table>
     </fieldset>
         <fieldset class="actionfieldsetstyle">
             <legend>Actions : </legend>
             <a id="btnOkPrintFormat" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-print" plain="true">Preview</a>
             <a id="btnClosePrintFormat" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-cancel" plain="true">Close</a>
         </fieldset>
</div>
      
 <div class="menuMainCollectionTable">
        <table id="tblExportBills" title="ExportBill List" class="easyui-datagrid" fit="true" fitcolumns="true" rownumbers="true" pagination="fasle" singleselect="true" autorowheight="false" toolbar="#toolbar">
            <thead>
                <tr>
                    <th field="ExportLCNo" width="12%" align="left">L/C No</th>
                    <th field="ApplicantName" width="20%" align="left">Party Name</th>
                    <th field="BankName_Issue" width="25%" align="left">Issue Bank</th>
                    <th field="BankName_Advice" width="15%" align="left">Advice Bank</th>                    
                    <th field="ExportBillNoSt" width="12%" align="left">Bill No</th>
                    <th field="AmountSt" width="10%" align="right">Amount</th>
                    <th field="StateSt" width="15%" align="left">Current Status</th>
                    <th field="StartDateSt" width="10%" align="left">Doc Prepare Date</th>
                    <th field="SendToPartySt" width="10%" align="left">Send To Party</th>
                    <th field="RecdFromPartySt" width="10%" align="left">Recd From Party</th>
                    <th field="SendToBankDateSt" width="10%" align="left">Send To Bank</th>
                    <th field="RecedFromBankDateSt" width="10%" align="left">Recd From Bank</th>
                    <th field="LDBCDateSt" width="10%" align="left">LDBC/IBC Date</th>
                    <th field="LDBCNo" width="10%" align="left">LDBC/IBC No.</th>
                    <th field="AcceptanceDateSt" width="10%" align="left">Submit To Party Bank</th>
                    <th field="MaturityReceivedDateSt" width="10%" align="center">Maturity Red Date</th>
                    <th field="MaturityDateSt" width="10%" align="left">Maturity Date</th>
                    <th field="DiscountedDateSt" width="10%" align="left">Discounted Date</th>
                    <th field="BankFDDRecDateSt" width="10%" align="left">BankFDD Recd Date</th>
                    <th field="RelizationDateSt" width="10%" align="left">Relization Date</th>
                    <th field="EncashmentDateSt" width="10%" align="left">Encashment Date</th>
                    @*<th field="UPNo" width="10%" align="left">UP No</th>*@
                </tr>
            </thead>
        </table>
        <div id="toolbar">
            <table>
                <tr>
                    <td>
                        <input type="text" id="txtSearchbyLCNo" placeholder="Type L/C No and Press Enter" style="width:166px" />
                        <input type="text" id="txtSearchbyLDBCNo" placeholder="Type LDBC/IBC No and Press Enter" style="width:175px" />
                        <input type="text" id="txtSearchbyBillNo" placeholder="Type Bill No and Press Enter" style="width:166px" />
                        <a id="btnAdvSearch" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-search" plain="true">Adv. Search</a>
                        <a id="btnViewExportLCInBill" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-details" plain="true">LC View</a>
                        <a href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-ok" plain="true" id="btnAddSendToParty">Send To Party</a>
                        <a href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-ok" plain="true" id="btnAddRecedFromParty">Receive From Party</a>
                        <a href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-ok" plain="true" id="btnAddSendToBank">Send To Bank</a>
                        <a href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-ok" plain="true" id="btnAddLDBP">Discount</a>
                        <a href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-ok" plain="true" id="btnAddRecedfromBank">Receive from Bank</a>
                        <a href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-ok" plain="true" id="btnAddMaturity">Maturity Receive</a>
                        <a href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-ok" plain="true" id="btnAddBillRelization">Bill Relization</a>
                        <a href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-ok" plain="true" id="btnAddBankFDDRecd">Bank FDD Recd </a>
                        <a href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-ok" plain="true" id="btnAddEncashment">Encashment Recd </a>
                    </td>
                </tr>
                <tr>
                    <td>
                        <a id="btnPrintDoc" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-print" plain="true">Print Document</a>
                        <a id="btnExportBillDoc" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-add" plain="true">Document</a>
                        <a id="btnExportBillHistory" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-ok" plain="true">Pick Bill History</a>
                        @*<a id="btnPrintList" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-print" plain="true">Print List</a>*@
                        <a id="btnExportToXL" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-print" plain="true">Export To XL</a>
                        <a id="btnEBillStatusUpdate" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-add" plain="true">Status Change</a>
                        <a id="btnClaimSettle" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-add" plain="true">Claim Settle</a>
                        @*<a href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-ok" plain="true" id="btnAddSAN">Create SAN</a>*@
                    </td>
                </tr>
            </table>
        </div>
    </div>
 <div id="winAdvSearch" class="easyui-window winClass" title="Adv. Search" data-options="modal:true,closed:true,collapsible:false,minimizable:false,maximizable:false,closable:false">
        <table style="width:100%;">
            <tr>
                <td>
                    <fieldset style="margin-bottom: 0px;">
                        <legend>Searching Criteria</legend>
                        <table>
                            <tr >
                                <td>
                                    <label>Party Name :</label>
                                </td>
                                <td >
                                    <input id="txtContractorAdvS" style="width:75%;" type="text" placeholder="Type & Press Enter" />
                                    <a id="btnPickContractorAdvS" href="javascript:void(0)" class="easyui-linkbutton ics-pick" iconcls="icon-pick" plain="true"></a>
                                    <a id="btnClrContractorAdvS" href="javascript:void(0)" class="easyui-linkbutton ics-pick" iconcls="icon-clear" plain="true"></a>
                                </td>
                                <td rowspan="12">
                                    <table id="tblCurrenctState" title="Currenct State" class="easyui-datagrid" style="width:200px;height:100%;" pagination="false" rownumbers="false" fitcolumns="true" singleselect="false">
                                        <thead>
                                            <tr>
                                                <th field="ck" checkbox="true"></th>
                                                <th field="Value" width="100" style="font-size:12px;">Currenct State</th>
                                            </tr>
                                        </thead>
                                    </table>
                                </td>
                            </tr>
                            <tr>
                                <td>
                                    <label>Nego Bank:</label>
                                </td>
                                <td>
                                    <select id="cboBankBranch_Nego" style="width: 390px"></select>
                                </td>
                            </tr>
                            <tr>
                                <td>
                                    <label>Advising Bank:</label>
                                </td>
                                <td>
                                    <select id="cboBankBranch_Advice" style="width: 390px"></select>
                                </td>
                            </tr>
                            <tr>
                                <td>
                                    <label>Issue Bank :</label>
                                </td>
                                <td>
                                    <input id="txtBankBranch_Issue" style="width:75%;" type="text" placeholder="Type & Press Enter" />
                                    <a id="btnPickBankBranch_Issue" href="javascript:void(0)" class="easyui-linkbutton ics-pick" iconcls="icon-pick" plain="true"></a>
                                    <a id="btnClrBankBranch_Issue" href="javascript:void(0)" class="easyui-linkbutton ics-pick" iconcls="icon-clear" plain="true"></a>
                                </td>
                            </tr>


                            <tr>
                                <td>
                                    <label>Bill Amount :</label>
                                </td>
                                <td >
                                    <select id="cobBillAmount" onchange="DateActions_Amount()" style="width:130px;"></select>
                                    <input type="text" id="txtFromBillAmount" style="width:110px;text-align:right" value="0" />
                                    To
                                    <input type="text" id="txtToBillAmount" style="width:110px;text-align:right" disabled value="0" />
                                </td>
                            </tr>

                            <tr>
                                <td colspan="2">
                                    <fieldset style="width:465px;">
                                        <legend style="font-weight: bold">Criteria : </legend>
                                        <table id="tblDateType">
                                            <tr>
                                                <td style="font-size:12px;text-align:right;">
                                                    <label>Date Type :</label>
                                                </td>
                                                <td>
                                                    <select id="cboDateCriteria" style="width: 352px;">
                                                        <option value="None">--Select One--</option>
                                                        <option value="StartDate">Bill Prepare</option>
                                                        <option value="SendToParty">Send To Party</option>
                                                        <option value="RecdFromParty">Received From Party</option>
                                                        <option value="SendToBank">Send To Bank</option>
                                                        <option value="RecdFromBank">Received From Bank</option>
                                                        <option value="LDBCDate">LDBC/IBC Date</option>
                                                        <option value="AcceptanceDate">Acceptance Date</option>
                                                        <option value="MaturityDate">Maturity Date</option>
                                                        <option value="MaturityReceivedDate">Maturity Received Date</option>
                                                        <option value="DiscountedDate">Discounted Date</option>
                                                        <option value="BankFDDReceiveDate">Bank FDD Receive Date</option>
                                                        <option value="RelizationDate">Relization Date</option>
                                                        <option value="EncashmentDate">Encashment Date</option>
                                                    </select>
                                                </td>
                                            </tr>
                                            <tr>
                                                <td style="font-size:12px;text-align:right;width:100px;">
                                                    <label>Date :</label>
                                                </td>
                                                <td>
                                                    <select id="cboBillDate" onchange="DateActions_Bill()" style="width:100px;font-size:12px;"></select>
                                                    <input id="txtBillDateStart" type="text" style="width: 110px;" class="easyui-datebox" required="required" data-options="formatter:icsdateformat,parser:icsdateparser" />
                                                    To
                                                    <input id="txtBillDateEnd" type="text" style="width: 110px;" class="easyui-datebox" required="required" data-options="formatter:icsdateformat,parser:icsdateparser" />
                                                </td>
                                            </tr>
                                        </table>
                                    </fieldset>
                                </td>
                            </tr>
                            <tr>
                                <td colspan="2">
                                    <fieldset style="width:465px;">
                                        <legend style="font-weight: bold">Datewise State : </legend>
                                        <table>
                                            <tr>
                                                <td style="font-size:12px;text-align:right;width:100px;">
                                                    <label>State on Date :</label>
                                                </td>
                                                <td>
                                                    <select id="cboState" style="width: 352px;"></select>
                                                </td>
                                            </tr>
                                            <tr>
                                                <td style="font-size:12px;text-align:right;">
                                                    <label>Date :</label>
                                                </td>
                                                <td>
                                                    <select id="cboDateOptionAdvSearch" onchange="DateActions_DateOption(); "></select>
                                                    <input id="txtFromDateAdvSearch" type="text" style="width: 110px;" class="easyui-datebox" required="required" data-options="formatter:icsdateformat,parser:icsdateparser" />To
                                                    <input id="txtToDateAdvSearch" type="text" style="width: 110px;" class="easyui-datebox" required="required" data-options="formatter:icsdateformat,parser:icsdateparser" />

                                                </td>
                                            </tr>
                                        </table>
                                    </fieldset>
                                </td>
                            </tr>

                            <tr>
                                <td height="5px" colspan="4"></td>
                            </tr>
                            <tr>
                                <td colspan="3">
                                    <div class="col-md-12">
                                        <div class="col-md-3">
                                            <label>Wait for UP Issue: </label>
                                            <span>
                                                <input type="checkbox" id="ckhYetToEUP" />
                                            </span>
                                        </div>
                                        <div class="col-md-3">
                                            <label>Export UP Issued: </label>
                                            <span>
                                                <input type="checkbox" id="ckhEUPDone" />
                                            </span>
                                        </div>
                                        <div class="col-md-2">
                                            @*<label>Export UP Issued: </label>*@                                         
                                            <select style="width:100%;" id="cboLCType">
                                        </div>
                                        <div class="col-md-4">                                          
                                        </div>
                                    </div>
                                </td>
                                </tr>
                        </table>
                    </fieldset>
                </td>
            </tr>
        </table>

        <fieldset class="actionfieldsetstyle">
            <legend>Actions : </legend>
            <label class="lblLoadingMessage" style="float: left;">Loading Please Wait...</label>
            <a id="btnResetAdvSearch" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-reload" plain="true">Reset</a>
            <a id="btnSearchAdvSearch" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-search" plain="true">Search</a>
            <a id="btnCloseAdvSearch" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-cancel" plain="true">Close</a>
        </fieldset>
    </div>
    <div id="winExportBillStatus" class="easyui-window" title="Invoice Status Change" data-options="modal:true,closed:true,collapsible:false,minimizable:false,maximizable:false,closable:true">

        <fieldset class="actionfieldsetstyle">
            <div id="divInvoiceStatusUpdate">
                <table style="width:100%;">
                    <tr>
                        <td style="width:120px; text-align:right">
                            Current Status:
                        </td>
                        <td style="width:150px;text-align:left">
                            <select id="cboCurrentState" style="width: 150px;"></select>
                        </td>
                    </tr>
                    <tr>
                        <td style="width:120px; text-align:right">
                            Note:
                        </td>
                        <td style="width:150px;text-align:left">
                            <input id="txtNoteStatusChange"  placeholder="Note" style="width:100%" />
                        </td>
                    </tr>
                </table>

            </div>
        </fieldset>
            <fieldset class="actionfieldsetstyle">
                <legend>Actions : </legend>
                <a id="btnSaveExportBillStatus" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-save" plain="true">Save</a>
                <a id="btnCloseExportBillStatus" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-cancel" plain="true">Close</a>
            </fieldset>
</div>
</body>
                      
<style type="text/css">
    #winExportBill {
        width: 400px;
    }
</style>

 <script type="text/javascript">
    var _sBaseAddress="";
    var _oExportBill=null;
    var _oExportBills=[];
    var _sBankBranch_IssueIds="";
    var _sContractorIds="";
    var _oBankBranchs_Nego=[];
    var _oLCBillEventObj=[];
    var _oCompareOperators=[];
    var _oBankAccounts=[];
    var _oCurrencys=[];
    var _oCompanys=[];
    var _oCurrencys=[];
    var _oLCTermss=[];
    var _oBusinessUnits=[];
    var _oMeasurementUnitCon=null;
    var _nBUID=0;
    var _oLCTypes = [];
    $(document).ready(function () {
        _sBaseAddress =@Html.Raw( new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(HttpContext.Current.Session[SessionInfo.BaseAddress]));
        _oExportBills =@Html.Raw( new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(Model));
        _oBankBranchs_Nego=@Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(ViewBag.BankBranchs_Nego));
        _oLCBillEventObj=@Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(ViewBag.LCBillEventObj));
        _oCompareOperators = @Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(ViewBag.CompareOperators));
        _oBankAccounts= @Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(ViewBag.BankAccounts));
        _oCurrencys= @Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(ViewBag.Currencys));
        _oCompanys = @Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(ViewBag.Companys));
        _oCurrencys = @Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(ViewBag.Currencys));
        _oLCTermss = @Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(ViewBag.LCTermss));
        _nBUID = @Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(ViewBag.BUID));
        _oBusinessUnits= @Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(ViewBag.BusinessUnits));
        _oMeasurementUnitCon= @Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(ViewBag.MeasurementUnitCon));
        _oLCTypes = @Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(ViewBag.LCTypes));
        LoadCombo();
        $("#cboLCType").icsLoadCombo({List: _oLCTypes, OptionValue: "id", DisplayText: "Value", InitialValue:"--L/C Types--" });

        Hide();
        if(sessionStorage.getItem("ExportBills")!=null && sessionStorage.getItem("ExportBills").length>0)
        {
            _oExportBills= jQuery.parseJSON(sessionStorage.getItem('ExportBills'));
            var nIndex= sessionStorage.getItem('SelectedRowIndex');
            DynamicRefreshList(_oExportBills, 'tblExportBills');

            if(nIndex>-1){
                $('#tblExportBills').datagrid('selectRow',nIndex);
                RowSelect(nIndex, _oExportBills[nIndex]);
            }

        }
        else{
            DynamicRefreshList(_oExportBills, 'tblExportBills');
        }

        $(".lblLoadingMessage").hide();
        $("#progressbarParent").hide();
    });


     $('#tblExportBills').datagrid({ onSelect: function (rowIndex, rowData) { RowSelect(rowIndex, rowData); } });

     $(document).keydown(function (e) { if (e.keyCode == 27) { $('#winExportBill').icsWindow('close'); } });

     $("#txtPerCartonWeight").keypress(function (e) {
         if (e.which != 8 && e.which != 0  && e.which != 46  && (e.which < 48 || e.which > 57)) {
             return false;
         }
     });


     function LoadCombo()
     {
         $("#rdoInLbs").prop("checked", true);

         $("#cboBenificiary, #cboBenificiary01").icsLoadCombo({
             List: _oCompanys,
             OptionValue: "CompanyID",
             DisplayText: "Name"
         });
         $("#cboCurrency").icsLoadCombo({
             List: _oCurrencys,
             OptionValue: "CurrencyID",
             DisplayText: "Symbol"
         });
         $("#cboBankBranch_Advice, #cboBankBranch_Nego").icsLoadCombo({
             List: _oBankBranchs_Nego,
             OptionValue: "BankBranchID",
             DisplayText: "BankBranchName"
         });
         LoadComboAdv();
     }
     function Hide() {

         document.getElementById("btnAddSendToParty").style.display = 'none';
         document.getElementById("btnAddRecedFromParty").style.display = 'none';
         document.getElementById("btnAddSendToBank").style.display = 'none';
         document.getElementById("btnAddRecedfromBank").style.display = 'none';

         document.getElementById("btnAddLDBP").style.display = 'none';
         document.getElementById("btnAddMaturity").style.display = 'none';
         document.getElementById("btnAddBillRelization").style.display = 'none';
         document.getElementById("btnAddBankFDDRecd").style.display = 'none';
         document.getElementById("btnAddEncashment").style.display = 'none';
         //document.getElementById("btnClaimSettle").style.display = 'none';

     }
     function RowSelect(rowIndex, rowData) {

         //  BOEinHand = 0,       //BOEinCustomerHand = 1,       //AcceptedBill = 2,//ReceivedFromBuyer = 2,       //Nego_Transit = 3,       //NegotiatedBill = 4,
         //B_AcceptedBill = 5,       //FDDinHand = 6,       //Discounted = 7,       //Encashment = 8,       //BillClosed = 9,       //BillRealized = 10,       //BillCancel = 11,
         //R_ForDiscounted = 12,

         Hide();

         if (rowData.StateInt <= 0) {
             document.getElementById("btnAddSendToParty").style.display = '';
             //document.getElementById("btnClaimSettle").style.display = '';

         }
         else if (rowData.StateInt == 1) {
             document.getElementById("btnAddSendToParty").style.display = '';
             document.getElementById("btnAddRecedFromParty").style.display = '';
             //document.getElementById("btnClaimSettle").style.display = '';
         }
         else if (rowData.StateInt == 2) {
             document.getElementById("btnAddRecedFromParty").style.display = '';
             document.getElementById("btnAddSendToBank").style.display = '';
             //document.getElementById("btnClaimSettle").style.display = '';
         }
         else if (rowData.StateInt == 3) {
             document.getElementById("btnAddSendToBank").style.display = '';
             document.getElementById("btnAddRecedfromBank").style.display = '';
         }
         else if (rowData.StateInt == 4) {
             document.getElementById("btnAddRecedfromBank").style.display = '';
             document.getElementById("btnAddMaturity").style.display = '';

         }
         else if (rowData.StateInt == 5)
         {
             document.getElementById("btnAddMaturity").style.display = '';
             document.getElementById("btnAddBankFDDRecd").style.display = '';
         }
         else if (rowData.StateInt == 12) {
             document.getElementById("btnAddLDBP").style.display = '';
         }
         else if (rowData.StateInt == 7) {
             document.getElementById("btnAddLDBP").style.display = '';
             document.getElementById("btnAddBankFDDRecd").style.display = '';
             //document.getElementById("btnClaimSettle").style.display = 'none';
         }
         else if (rowData.StateInt == 10) {
             document.getElementById("btnAddBillRelization").style.display = '';
             document.getElementById("btnAddBankFDDRecd").style.display = '';
             document.getElementById("btnAddEncashment").style.display = '';
             //document.getElementById("btnClaimSettle").style.display = 'none';
         }
         else if (rowData.StateInt == 6) {

             document.getElementById("btnAddBillRelization").style.display = '';
             document.getElementById("btnAddEncashment").style.display = '';
             //document.getElementById("btnClaimSettle").style.display = 'none';

         }
         else if (rowData.StateInt == 8) {

             document.getElementById("btnAddEncashment").style.display = '';
             //document.getElementById("btnClaimSettle").style.display = 'none';

         }
         else {
             document.getElementById("btnAddSendToParty").style.display = 'none';
             document.getElementById("btnAddRecedFromParty").style.display = 'none';
             document.getElementById("btnAddSendToBank").style.display = 'none';
             document.getElementById("btnAddRecedfromBank").style.display = 'none';

             document.getElementById("btnAddLDBP").style.display = 'none';
             document.getElementById("btnAddMaturity").style.display = 'none';
             document.getElementById("btnAddBillRelization").style.display = 'none';
             document.getElementById("btnAddBankFDDRecd").style.display = 'none';
             document.getElementById("btnAddEncashment").style.display = 'none';
         }
     }

     //Operstion
     $("#btnAddSendToParty").click(function(){
         debugger;
         var oExportBill = $('#tblExportBills').datagrid('getSelected');
         if (oExportBill ==null || oExportBill.ExportBillID <=0 ) { alert("Please select an item from list."); return ; }
         var nIndex=$('#tblExportBills').datagrid('getRowIndex',oExportBill);
         sessionStorage.setItem("Operation", "New");
         sessionStorage.setItem("SelectedRowIndex", nIndex);
         sessionStorage.setItem("ExportBillHeader", "Send To Party");
         sessionStorage.setItem("ExportBills", JSON.stringify($('#tblExportBills').datagrid('getRows')));
         sessionStorage.setItem("BackLink", window.location.href);
         var tsv=((new Date()).getTime())/1000;
         window.location.href = _sBaseAddress+ "/ExportBill/ViewExportBill_SendToParty?nId="+oExportBill.ExportBillID+"&ts="+tsv;
     });
     $("#btnAddRecedFromParty").click(function(){
         debugger;
         var oExportBill = $('#tblExportBills').datagrid('getSelected');
         if (oExportBill ==null || oExportBill.ExportBillID <=0 ) { alert("Please select an item from list."); return ; }
         var nIndex=$('#tblExportBills').datagrid('getRowIndex',oExportBill);
         sessionStorage.setItem("Operation", "New");
         sessionStorage.setItem("SelectedRowIndex", nIndex);
         sessionStorage.setItem("ExportBillHeader", "Party Acceptance");
         sessionStorage.setItem("ExportBills", JSON.stringify($('#tblExportBills').datagrid('getRows')));
         sessionStorage.setItem("BackLink", window.location.href);
         var tsv=((new Date()).getTime())/1000;
         window.location.href = _sBaseAddress+ "/ExportBill/ViewExportBill_ReceiveFromParty?nId="+oExportBill.ExportBillID+"&ts="+tsv;
     });
     $("#btnAddSendToBank").click(function(){
         debugger;
         var oExportBill = $('#tblExportBills').datagrid('getSelected');
         if (oExportBill ==null || oExportBill.ExportBillID <=0 ) { alert("Please select an item from list."); return ; }
         var nIndex=$('#tblExportBills').datagrid('getRowIndex',oExportBill);
         sessionStorage.setItem("Operation", "New");
         sessionStorage.setItem("SelectedRowIndex", nIndex);
         sessionStorage.setItem("ExportBillHeader", "Bank Submission");
         sessionStorage.setItem("ExportBills", JSON.stringify($('#tblExportBills').datagrid('getRows')));
         sessionStorage.setItem("BackLink", window.location.href);
         var tsv=((new Date()).getTime())/1000;
         window.location.href = _sBaseAddress+ "/ExportBill/ViewExportBill_SendToBank?nId="+oExportBill.ExportBillID+"&ts="+tsv;
     });
     $("#btnAddRecedfromBank").click(function(){
         debugger;
         var oExportBill = $('#tblExportBills').datagrid('getSelected');
         if (oExportBill ==null || oExportBill.ExportBillID <=0 ) { alert("Please select an item from list."); return ; }
         var nIndex=$('#tblExportBills').datagrid('getRowIndex',oExportBill);
         sessionStorage.setItem("Operation", "New");
         sessionStorage.setItem("SelectedRowIndex", nIndex);
         sessionStorage.setItem("ExportBillHeader", "Receive From Bank");
         sessionStorage.setItem("ExportBills", JSON.stringify($('#tblExportBills').datagrid('getRows')));
         sessionStorage.setItem("BackLink", window.location.href);
         var tsv=((new Date()).getTime())/1000;
         window.location.href = _sBaseAddress+ "/ExportBill/ViewExportBill_RecdFromBank?nId="+oExportBill.ExportBillID+"&ts="+tsv;
     });
     $("#btnAddMaturity").click(function(){
         debugger;
         var oExportBill = $('#tblExportBills').datagrid('getSelected');
         if (oExportBill ==null || oExportBill.ExportBillID <=0 ) { alert("Please select an item from list."); return ; }
         var nIndex=$('#tblExportBills').datagrid('getRowIndex',oExportBill);
         sessionStorage.setItem("Operation", "New");
         sessionStorage.setItem("SelectedRowIndex", nIndex);
         sessionStorage.setItem("ExportBillHeader", "Maturity Entry");
         sessionStorage.setItem("ExportBills", JSON.stringify($('#tblExportBills').datagrid('getRows')));
         sessionStorage.setItem("BackLink", window.location.href);
         var tsv=((new Date()).getTime())/1000;
         window.location.href = _sBaseAddress+ "/ExportBill/ViewExportBill_MaturityReceive?nId="+oExportBill.ExportBillID+"&ts="+tsv;
     });
     $("#btnAddBillRelization").click(function(){
         debugger;
         var oExportBill = $('#tblExportBills').datagrid('getSelected');
         if (oExportBill ==null || oExportBill.ExportBillID <=0 ) { alert("Please select an item from list."); return ; }
         var nIndex=$('#tblExportBills').datagrid('getRowIndex',oExportBill);
         sessionStorage.setItem("Operation", "New");
         sessionStorage.setItem("SelectedRowIndex", nIndex);
         sessionStorage.setItem("ExportBillHeader", "Payment Entry");
         sessionStorage.setItem("ExportBills", JSON.stringify($('#tblExportBills').datagrid('getRows')));
         sessionStorage.setItem("BackLink", window.location.href);
         var tsv=((new Date()).getTime())/1000;
         window.location.href = _sBaseAddress+ "/ExportBill/ViewExportBill_BillRelization?nId="+oExportBill.ExportBillID+"&ts="+tsv;
     });
     $("#btnAddBankFDDRecd").click(function(){
         debugger;
         var oExportBill = $('#tblExportBills').datagrid('getSelected');
         if (oExportBill ==null || oExportBill.ExportBillID <=0 ) { alert("Please select an item from list."); return ; }
         var nIndex=$('#tblExportBills').datagrid('getRowIndex',oExportBill);
         sessionStorage.setItem("Operation", "New");
         sessionStorage.setItem("SelectedRowIndex", nIndex);
         sessionStorage.setItem("ExportBillHeader", "Send To Party");
         sessionStorage.setItem("ExportBills", JSON.stringify($('#tblExportBills').datagrid('getRows')));
         sessionStorage.setItem("BackLink", window.location.href);
         var tsv=((new Date()).getTime())/1000;
         window.location.href = _sBaseAddress+ "/ExportBill/ViewExportBill_FDDinHand?nId="+oExportBill.ExportBillID+"&ts="+tsv;
     });
     $("#btnAddEncashment").click(function(){
         debugger;
         var oExportBill = $('#tblExportBills').datagrid('getSelected');
         if (oExportBill ==null || oExportBill.ExportBillID <=0 ) { alert("Please select an item from list."); return ; }
         var nIndex=$('#tblExportBills').datagrid('getRowIndex',oExportBill);
         sessionStorage.setItem("Operation", "New");
         sessionStorage.setItem("SelectedRowIndex", nIndex);
         sessionStorage.setItem("ExportBillHeader", "Encashment entry");
         sessionStorage.setItem("ExportBills", JSON.stringify($('#tblExportBills').datagrid('getRows')));
         sessionStorage.setItem("BackLink", window.location.href);
         var tsv=((new Date()).getTime())/1000;
         window.location.href = _sBaseAddress+ "/ExportBill/ViewExportBill_Encashment?nId="+oExportBill.ExportBillID+"&ts="+tsv;
     });

     $("#btnExportBillHistory").click(function(){
         debugger;
         var oExportBill = $('#tblExportBills').datagrid('getSelected');
         if (oExportBill ==null || oExportBill.ExportBillID <=0 ) { alert("Please select an item from list."); return ; }
         var nIndex=$('#tblExportBills').datagrid('getRowIndex',oExportBill);
         sessionStorage.setItem("Operation", "New");
         sessionStorage.setItem("SelectedRowIndex", nIndex);
         sessionStorage.setItem("ExportBillHeader", "Show Bill History");
         sessionStorage.setItem("ExportBills", JSON.stringify($('#tblExportBills').datagrid('getRows')));
         sessionStorage.setItem("BackLink", window.location.href);
         var tsv=((new Date()).getTime())/1000;
         window.location.href = _sBaseAddress+ "/ExportBill/ViewExportBill_History?nId="+oExportBill.ExportBillID+"&ts="+tsv;
     });
     $("#btnAddSAN").click(function(){
         debugger;
         var oExportBill = $('#tblExportBills').datagrid('getSelected');
         if (oExportBill ==null || oExportBill.ExportBillID <=0 ) { alert("Please select an item from list."); return ; }
         var nIndex=$('#tblExportBills').datagrid('getRowIndex',oExportBill);
         sessionStorage.setItem("Operation", "New");
         sessionStorage.setItem("SelectedRowIndex", nIndex);
         sessionStorage.setItem("ExportBillHeader", "SAN Entry");
         sessionStorage.setItem("ExportBills", JSON.stringify($('#tblExportBills').datagrid('getRows')));
         sessionStorage.setItem("BackLink", window.location.href);
         var tsv=((new Date()).getTime())/1000;
         window.location.href = _sBaseAddress+ "/ExportBill/ViewExportBill_SAN?nId="+oExportBill.ExportBillID+"&ts="+tsv;
     });
     // End Operation
     //search By No
     $('#txtSearchbyLDBCNo').keypress(function (e) {
         var code = (e.keyCode ? e.keyCode : e.which);
         if (code == 13)//Enter key-13
         {
             var oExportBill =
             {
                 ExportBillID: 0,
                 BUID: _nBUID,
                 LDBCNo: document.getElementById('txtSearchbyLDBCNo').value,
                 ExportLCType: 0
             };
             Gets_byNo(oExportBill);
         }
         else if (code === 8) {
             DynamicRefreshList(_oExportBills, "tblExportBills");
         }
     });
     $('#txtSearchbyLCNo').keypress(function (e) {
         var code = (e.keyCode ? e.keyCode : e.which);
         if (code == 13)//Enter key-13
         {
             if ($.trim($("#txtSearchbyLCNo").val()) == "")
             {
                 alert("Please give LC No.");
                 return false;
             }
             var oExportBill =
             {
                 ExportBillID: 0,
                 BUID: _nBUID,
                 ExportLCNo: $.trim($("#txtSearchbyLCNo").val()),
                 ExportLCType: 0
             };
             Gets_byNo(oExportBill);
         }
         else if (code === 8) {
             DynamicRefreshList(_oExportBills, "tblExportBills");
         }
     });

     $('#txtSearchbyBillNo').keypress(function (e) {
         var code = (e.keyCode ? e.keyCode : e.which);
         if (code == 13)//Enter key-13
         {

             if ($.trim($("#txtSearchbyBillNo").val()) == "") {
                 alert("Please give Bill No.");
                 return false;
             }
             var oExportBill =
             {
                 ExportBillID: 0,
                 BUID: _nBUID,
                 ExportBillNo: $.trim($("#txtSearchbyBillNo").val()),
                 ExportLCType: 0
             };
             Gets_byNo(oExportBill);
         }
         else if (code === 8) {
             DynamicRefreshList(_oExportBills, "tblExportBills");
         }
     });

     function Gets_byNo(oExportBill)
     {
         $.ajax
         ({
             type: "POST",
             dataType: "json",
             url : _sBaseAddress+"/ExportBill/AdvanceSearch",
             data:  JSON.stringify(oExportBill),
             contentType: "application/json; charset=utf-8",
             success: function (data) {
                 //debugger;
                 var oExportBills = data;
                 if (oExportBills.length>0)
                 {
                     DynamicRefreshList(oExportBills, "tblExportBills");
                 }
                 else
                 {
                     alert("Data Not found");
                     DynamicRefreshList([], "tblExportBills");
                 }
             },
             error: function (xhr, status, error)
             {
                 alert(error);
             }
         });


     }

     /// Print Export Doc
     $("#btnPrintDoc").click(function () {
         var oExportBill = $("#tblExportBills").datagrid("getSelected");
         if (oExportBill == null || oExportBill.ExportBillID <= 0) { alert("Please Select an item from list!"); return; }

             for (var i = 0;i<_oBusinessUnits.length; i++){
                 if(oExportBill.BUID== _oBusinessUnits[i].BusinessUnitID)
                 {
                     if( _oBusinessUnits[i].BusinessUnitTypeInInt==5||  _oBusinessUnits[i].BusinessUnitTypeInInt==6)
                     {
                         document.getElementById("lblMunitOne").innerHTML = "In Yard";
                         document.getElementById("lblMunitTwo").innerHTML = "In Meter";
                     }
                     else{
                         document.getElementById("lblMunitOne").innerHTML = "In LBS";
                         document.getElementById("lblMunitTwo").innerHTML = "In Kg";
                         if(_oMeasurementUnitCon!=null && _oMeasurementUnitCon.MeasurementUnitConID>0)
                         {
                             document.getElementById("lblMunitOne").innerHTML = "In"+_oMeasurementUnitCon.FromMUnit;
                             document.getElementById("lblMunitTwo").innerHTML ="In"+ _oMeasurementUnitCon.ToMUnit;
                         }
                     }
                 }
             }

         $('#txtDocDate').datebox('setValue',oExportBill.DocDateSt);
         GetExportDocs(oExportBill);
         BtnPrintFormatEB();
         $("#rdoInLbs").prop("checked", true);
         $("#rdoInA4").prop("checked", true);
         $("#winPrintFormat").icsWindow("open", "Print Format");
     });
     function GetExportDocs(oExportBillTemp)
     {
         var oExportBill = { ExportLCID: oExportBillTemp.ExportLCID,ExportBillID:oExportBillTemp.ExportBillID};
         var obj =
         {
             BaseAddress: _sBaseAddress,
             Object: oExportBill,
             ControllerName: "ExportBill",
             ActionName: "GetExportDocs",
             IsWinClose: false
         };

         $.icsDataGets(obj, function (response) {
             if (response.status && response.objs.length > 0) {
                 DynamicRefreshList(response.objs, "tblExportDocSetup");
             }
             else {
                 alert("No List Found");
                 DynamicRefreshList([], "tblExportDocSetup");
             }
         });
     }

     function BtnPrintFormatEB() {
         $('#chkPrintNormal').prop('checked', true);
         $('#chkPrintTitleInPAD').prop('checked', false);
         $('#chkPrintTitleInImg').prop('checked', false);
     }


     $("#btnClosePrintFormat").click(function () {
         $("#winPrintFormat").icsWindow("close");
     });

     $("#btnOkPrintFormat").click(function () {
         debugger;
         if (!($("#chkPrintTitleInImg").is(':checked')) && !($("#chkPrintTitleInPAD").is(':checked')) && !($("#chkPrintNormal").is(':checked')))
         {
             alert("Please select one format.");
             return false;
         }
         var nPrintType = GetSelectedFormat();
         if (nPrintType == 0)
         {
             alert("Please select one format. ");
             return false;
         }
         var nUnitType = parseInt($('input[name=Unit]:checked').val());
         var nPageSize = parseInt($('input[name=PageSize]:checked').val());
         var oExportBill = $("#tblExportBills").datagrid("getSelected");
         var oExportDocs = $('#tblExportDocSetup').datagrid('getChecked');
         if (oExportDocs == null || oExportDocs.length <= 0) { alert("Please select at least one Export Document Setup."); return; }
         $("#winPrintFormat").icsWindow("close");
         for (var i = 0; i<oExportDocs.length; i++)
         {
             window.open(_sBaseAddress + '/ExportBill/PrintExportDoc?id=' + oExportBill.ExportBillID + "&nDocType=" + oExportDocs[i].ExportDocSetupID + "&nPrintType=" + nPrintType + "&nUnitType=" + nUnitType + "&nPageSize=" + nPageSize+"&bIsApplicant="+$("#chkIsApplicant").is(':checked'), "_blank");
         }
     });

     function GetSelectedFormat()
     {
         var nPrintType = 0;
         if ($("#chkPrintNormal").is(':checked')) {
             nPrintType = 1;
         }else if ($("#chkPrintTitleInPAD").is(':checked')) {
             nPrintType = 2;
         }else if ($("#chkPrintTitleInImg").is(':checked')) {
             nPrintType = 3;
         }
         return nPrintType;
     }
     $("#chkPrintTitleInImg").change(function () {
         if (this.checked) {
             $('#chkPrintTitleInImg').prop('checked', true);
             $('#chkPrintTitleInPAD').prop('checked', false);
             $('#chkPrintNormal').prop('checked', false);
         } else {
             $('#chkPrintTitleInPAD').prop('checked', false);
             $('#chkPrintTitleInImg').prop('checked', false);
             $('#chkPrintNormal').prop('checked', false);
         }
     });

     $("#chkPrintTitleInPAD").change(function () {
         if (this.checked) {
             $('#chkPrintTitleInPAD').prop('checked', true);
             $('#chkPrintTitleInImg').prop('checked', false);
             $('#chkPrintNormal').prop('checked', false);
         } else {
             $('#chkPrintTitleInPAD').prop('checked', false);
             $('#chkPrintTitleInImg').prop('checked', false);
             $('#chkPrintNormal').prop('checked', false);
         }
     });

     $("#chkPrintNormal").change(function () {
         if (this.checked) {
             $('#chkPrintNormal').prop('checked', true);
             $('#chkPrintTitleInPAD').prop('checked', false);
             $('#chkPrintTitleInImg').prop('checked', false);
         } else {
             $('#chkPrintTitleInPAD').prop('checked', false);
             $('#chkPrintTitleInImg').prop('checked', false);
             $('#chkPrintNormal').prop('checked', false);
         }
     });
     /// end Print Export Doc


     $("#btnPrintList").click(function () {
         var oExportBills = $('#tblExportBills').datagrid('getRows');
         if (oExportBills.length <= 0) {
             alert("Sorry, there is no data to Print");
         }
         var ids = ICS_PropertyConcatation(oExportBills, 'ExportBillID');
         var tsv = ((new Date()).getTime()) / 1000;
         var buid= parseInt(sessionStorage.getItem('BUID'));
         window.open(_sBaseAddress + "/ExportBill/PrintList?ids=" + ids + "&buid=" + buid + "&ts=" + tsv);
     });

     $("#btnExportToXL").click(function () {
         var oExportBills = $('#tblExportBills').datagrid('getRows');
         if (oExportBills.length <= 0) {
             alert("Sorry, there is no data to Print");
         }
         var ids = ICS_PropertyConcatation(oExportBills, 'ExportBillID');
         var tsv = ((new Date()).getTime()) / 1000;
         var buid = parseInt(sessionStorage.getItem('BUID'));
         window.open(_sBaseAddress + "/ExportBill/ExportToXL?ids=" + ids + "&buid=" + buid + "&ts=" + tsv);
     });


     ////Start adv Searching

     function updateProgress() {
         var value =$('#progressbar').progressbar('getValue');
         if (value < 96){
             value += Math.floor(Math.random() * 10);
             $('#progressbar').progressbar('setValue', value);
         }
     }
     function hideShow(miliseconds) {
         $("#progressbarParent").hide();
     }
     //Account Of Picker

     $("#txtContractorAdvS").keydown(function (e) {
         if (e.keyCode === 13) // Enter Press
         {
             PickContractors_AdvS();
         }
         else if (e.keyCode === 08) {
             $("#txtContractorAdvS").removeClass("fontColorOfPickItem");
             _sContractorIds = '';
         }
     });

     $("#btnClrContractorAdvS").click(function () {
         $("#txtContractorAdvS").removeClass("fontColorOfPickItem");
         $("#txtContractorAdvS").val("");
         _sContractorIds = '';
     });

     $("#btnPickContractorAdvS").click(function () {
         PickContractors_AdvS();
     });
     function PickContractors_AdvS() {
         var oContractor = {
             Params: '2,3' + '~' + $.trim($("#txtContractorAdvS").val()+"~"+_nBUID)
         };
         var obj = {
             BaseAddress: _sBaseAddress,
             Object: oContractor,
             ControllerName: "Contractor",
             ActionName: "ContractorSearchByNameType",
             IsWinClose: false
         };

         $("#progressbar").progressbar({ value: 0 });
         $("#progressbarParent").show();
         var intervalID = setInterval(updateProgress, 250);

         DynamicRefreshList([], "tblAccountsPickerAdvSearch");
         $.icsDataGets(obj, function (response) {
             clearInterval(intervalID);
             $("#progressbarParent").hide();
             if (response.status && response.objs.length > 0) {
                 if (response.objs[0].ContractorID > 0) {
                     var tblColums = []; var oColumn = { field: "ContractorID", title: "Code", width: 50, align: "left" }; tblColums.push(oColumn);
                     oColumn = { field: "Name", title: "Name", width: 280, align: "left" }; tblColums.push(oColumn);

                     var oPickerParam = {
                         winid: 'winContractorPicker',
                         winclass: 'clsAccountOf',
                         winwidth: 400,
                         winheight: 460,
                         tableid: 'tblAccountOfs',
                         tablecolumns: tblColums,
                         datalist: response.objs,
                         multiplereturn: true,
                         searchingbyfieldName: 'Name',
                         windowTittle: 'Contactor List'
                     };
                     $.icsPicker(oPickerParam);
                     IntializePickerbutton(oPickerParam);
                 }
                 else {
                     alert(response.objs[0].ErrorMessage);
                 }
             }
             else {
                 alert("Sorry, No Contactor Found.");
             }
         });
     }
     //End Account Of Picker
     $("#txtBankBranch_Issue").keydown(function (e) {
         if (e.keyCode === 13) // Enter Press
         {
             if($("#txtBankBranch_Issue").val()=="" || $("#txtBankBranch_Issue").val()==null)
             {
                 $("#txtBankBranch_Issue").removeClass("fontColorOfPickItem");
                 _sBankBranch_IssueIds = '';
                 alert("Please, Type name")
                 return;
             }

             var oBankBranch = {
                 BUID: _nBUID,
                 DeptIDs: '5',//EnumOperationalDept : Export_Party=5
                 BankName: $.trim($("#txtBankBranch_Issue").val())
             };
             PickBanks_AdvS(oBankBranch);
         }
         else if (e.keyCode === 08) {
             $("#txtBankBranch_Issue").removeClass("fontColorOfPickItem");
             _sBankBranch_IssueIds = '';
         }
     });

     $("#btnClrBankBranch_Issue").click(function () {
         $("#txtBankBranch_Issue").removeClass("fontColorOfPickItem");
         $("#txtBankBranch_Issue").val("");
         _sBankBranch_IssueIds = '';
     });

     $("#btnPickBankBranch_Issue").click(function () {
         var oBankBranch = {
             BUID: _nBUID,
             DeptIDs: '5',//EnumOperationalDept : Export_Party=5
             BankName: $.trim($("#txtBankBranch_Issue").val())
         };
         PickBanks_AdvS(oBankBranch);
     });
     function PickBanks_AdvS(oBankBranch) {

         var obj = {
             BaseAddress: _sBaseAddress,
             Object: oBankBranch,
             ControllerName: "BankBranch",
             ActionName: "GetsBankBranchSearchByBankName",
             IsWinClose: false
         };

         $("#progressbar").progressbar({ value: 0 });
         $("#progressbarParent").show();
         var intervalID = setInterval(updateProgress, 250);

         $.icsDataGets(obj, function (response) {
             clearInterval(intervalID);
             $("#progressbarParent").hide();
             if (response.status && response.objs.length > 0) {
                 if (response.objs[0].BankBranchID > 0) {
                     var tblColums = []; var oColumn = { field: "BankName", title: "Bank Name", width: 200, align: "left" }; tblColums.push(oColumn);
                     oColumn = { field: "BranchName", title: "Branch Name", width: 280, align: "left" }; tblColums.push(oColumn);
                     oColumn = { field: "Address", title: "Address", width: 280, align: "left" }; tblColums.push(oColumn);

                     var oPickerParam = {
                         winid: 'winBankBranch_IssuePicker',
                         winclass: 'clsBankBranch_Issue',
                         winwidth: 500,
                         winheight: 460,
                         tableid: 'tblBankBranch_Issues',
                         tablecolumns: tblColums,
                         datalist: response.objs,
                         multiplereturn: true,
                         searchingbyfieldName: 'BranchName',
                         windowTittle: 'Bank List'
                     };
                     $.icsPicker(oPickerParam);
                     IntializePickerbutton(oPickerParam);
                 }
                 else {
                     alert(response.objs[0].ErrorMessage);
                 }
             }
             else {
                 alert("Sorry, No Contactor Found.");
             }
         });
     }

     //EndIssue Bank

     function IntializePickerbutton(oPickerobj) {
         $("#" + oPickerobj.winid).find("#btnOk").click(function () {
             SetPickerValueAssign(oPickerobj);
         });
         $(document).find('.' + oPickerobj.winclass).keydown(function (e) {
             if (e.which === 13) {
                 SetPickerValueAssign(oPickerobj);
             }
         });
     }

     function SetPickerValueAssign(oPickerobj) {
         var oreturnObj = null, oreturnObjs = [];
         if (oPickerobj.multiplereturn) {
             oreturnObjs = $('#' + oPickerobj.tableid).datagrid('getChecked');
         } else {
             oreturnObj = $('#' + oPickerobj.tableid).datagrid('getSelected');
         }

         if (oPickerobj.winid == 'winContractorPicker')
         {
             if (oreturnObjs != null && oreturnObjs.length> 0)
             {

                 _sContractorIds=''; var sMessage='';
                 sMessage=(oreturnObjs.length>1)? oreturnObjs.length +" Contractors Selected" : oreturnObjs[0].Name;
                 $('#txtContractorAdvS').val(sMessage);
                 $("#txtContractorAdvS").addClass("fontColorOfPickItem");

                 for(var i=0;i<oreturnObjs.length;i++){
                     _sContractorIds=_sContractorIds+oreturnObjs[i].ContractorID+',';
                 }
                 _sContractorIds=_sContractorIds.substring(0,_sContractorIds.length-1);

             }
             else
             {
                 alert("Please select a contractor.");
                 return false;
             }
         }

         else if (oPickerobj.winid == 'winBankBranch_IssuePicker') {
             if (oreturnObjs != null && oreturnObjs.length> 0)
             {
                 var sMessage='';
                 sMessage=(oreturnObjs.length>1)? oreturnObjs.length +" Bank(s) Selected" : oreturnObjs[0].BankName;
                 $('#txtBankBranch_Issue').val(sMessage);
                 $("#txtBankBranch_Issue").addClass("fontColorOfPickItem");

                 for(var i=0;i<oreturnObjs.length;i++){
                     _sBankBranch_IssueIds=_sBankBranch_IssueIds+oreturnObjs[i].BankBranchID+',';
                 }
                 _sBankBranch_IssueIds=_sBankBranch_IssueIds.substring(0,_sBankBranch_IssueIds.length-1);
             }
             else
             {
                 alert("Please select a Bank Branch.");
                 return false;
             }
         }

         $("#" + oPickerobj.winid).icsWindow("close");
         $("#" + oPickerobj.winid).remove();
     }

     $('#ckhYetToEUP').change(function (e) {
         debugger;
         if ($('#ckhYetToEUP').is(':checked'))
             $('#ckhEUPDone').prop('checked', false);

     });
     $('#ckhEUPDone').change(function (e) {
         if ($('#ckhEUPDone').is(':checked'))
             $('#ckhYetToEUP').prop('checked', false);

     });
     //End Buyer Search
     $("#btnResetAdvSearch").click(function () {
         ResetAdvSearchWindow();
         DateActions_Amount();
         DateActions_Bill();
         DateActions_DateOption();

     });

     function MakeStringIDs(StringIDs) {

         var IDs = "";
         for (var i = 0; i < StringIDs.length; i++) {
             IDs = StringIDs[i].id + "," + IDs;
         }
         var length = 0;
         length = parseInt(IDs.length) - 1;
         IDs = IDs.substring(0, parseInt(length));
         return IDs;
     }
     $("#btnSearchAdvSearch").click(function () {
         debugger;

         $(".lblLoadingMessage").show();

         var checkDate = CheckFromAndToDateValidation("cboBillDate", "txtBillDateStart", "txtBillDateEnd");
         if (!checkDate) {
             alert("Start date must be greater than end date.");
             return false;
         }
         checkDate = CheckFromAndToDateValidation("cboDateOptionAdvSearch", "txtFromDateAdvSearch", "txtToDateAdvSearch");
         if (!checkDate) {
             alert("Start date must be greater than end date.");
             return false;
         }
         var oCurrenctStates = $('#tblCurrenctState').datagrid('getSelections');
         var sCurrenctStates = "";
         if (oCurrenctStates.length > 0) {
             sCurrenctStates = MakeStringIDs(oCurrenctStates);
         }
         var oExportBill = {
             ApplicantName: _sContractorIds,
             CurrentStateIDs: sCurrenctStates,
             BankBranchID_Nego: parseInt($("#cboBankBranch_Nego").val()),
             BBranchName_Issue: _sBankBranch_IssueIds,
             BankBranchID_Advice:$('#cboBankBranch_Advice').val(),
             SearchAmountType: parseInt($("#cobBillAmount").val()),
             FromAmount: parseFloat($("#txtFromBillAmount").val()),
             ToAmount: parseFloat($("#txtToBillAmount").val()),
             DateType: $("#cboDateCriteria").val(),
             DateSearchCriteria: parseInt($("#cboBillDate").val()),
             StartDateCritaria: new Date($('#txtBillDateStart').datebox('getValue')),
             EndDateCritaria: new Date($('#txtBillDateEnd').datebox('getValue')),
             BUID: _nBUID,
             StateDateType: parseInt($("#cboState").val()),
             DateSearchState: parseInt($("#cboDateOptionAdvSearch").val()),
             StartDateState: new Date($('#txtFromDateAdvSearch').datebox('getValue')),
             EndDateState: new Date($('#txtToDateAdvSearch').datebox('getValue')),
             Params: $('#ckhYetToEUP').is(':checked') + '~' + $('#ckhEUPDone').is(':checked'),
             ExportLCType: parseInt($("#cboLCType").val())
         }

         $.ajax({
             type: "POST",
             dataType: "json",
             url: _sBaseAddress + "/ExportBill/AdvanceSearch",
             traditional: true,
             data: JSON.stringify(oExportBill),
             contentType: "application/json; charset=utf-8",
             success: function (data) {
                 var oExportBills = data;
                 debugger;
                 if (oExportBills != null)
                 {
                     if (oExportBills.length > 0)
                     {
                         DynamicRefreshList(oExportBills, "tblExportBills");
                         $("#winAdvSearch").icsWindow("close");

                     }
                     else
                     {
                         alert("Sorry, No data found.");
                         DynamicRefreshList([], "tblExportBills");
                     }

                 } else {
                     alert("Sorry, No data found.");
                     DynamicRefreshList([], "tblExportBills");
                 }
                 $(".lblLoadingMessage").hide();
             }
         });
     });

     function LoadComboAdv()
     {
         $("#cboBankBranch_Nego").icsLoadCombo({
             List: _oBankBranchs_Nego,
             OptionValue: "BankBranchID",
             DisplayText: "BankBranchName"
         });

         DynamicRefreshList(_oLCBillEventObj, "tblCurrenctState");

         $("#cboState,#cboCurrentState").icsLoadCombo({
             List: _oLCBillEventObj,
             OptionValue: "id",
             DisplayText: "Value"
         });
         $("#cboDateOptionAdvSearch, #cboBillDate, #cobBillAmount").icsLoadCombo({
             List: _oCompareOperators,
             OptionValue: "id",
             DisplayText: "Value"
         });


     }
     function CheckFromAndToDateValidation(OperationComboId, FromDateId, ToDateId) {
         $("#" + OperationComboId).parent().parent().parent().find("select").removeClass("errorFieldBorder");
         var nCboVal = $("#" + OperationComboId).val();
         if (parseInt(nCboVal) == 5 || parseInt(nCboVal) == 6) {
             var fromDate = $("#" + FromDateId).datebox("getValue");
             var toDate = $("#" + ToDateId).datebox("getValue");
             if (new Date(fromDate) > new Date(toDate)) {
                 $("#" + ToDateId).focus();
                 $("#" + OperationComboId).addClass("errorFieldBorder");
                 $(".lblLoadingMessage").hide();
                 return false;
             } else {
                 $("#" + OperationComboId).removeClass("errorFieldBorder");
                 return true;
             }
         } else {
             return true;
         }
     }

     function ResetAdvSearchWindow() {
         _sContractorIds = '';
         _sBankBranch_IssueIds = "";
         $("#winAdvSearch input").not("input[type='button']").val("");
         $("#winAdvSearch input").removeClass("fontColorOfPickItem");
         $("#winAdvSearch select").val(0);
         DateActions_Amount();
         DateActions_Bill();
         DateActions_DateOption();
         $("#txtBillDateStart,#txtBillDateEnd,#txtFromDateAdvSearch,#txtToDateAdvSearch").datebox({ disabled: true });
         $("#txtBillDateStart,#txtBillDateEnd,#txtFromDateAdvSearch,#txtToDateAdvSearch").datebox("setValue", icsdateformat(new Date()));
     }

     function DateActions_Amount() {
         var nDateOptionValTwo = $("#cobBillAmount").val();
         if (parseInt(nDateOptionValTwo) == 0) {
             $("#txtFromBillAmount").prop('disabled', true);
             $("#txtToBillAmount").prop('disabled', true);
             $("#txtFromBillAmount").val(0);
             $("#txtToBillAmount").val(0);
         }
         else if (parseInt(nDateOptionValTwo) >= 1 && parseInt(nDateOptionValTwo) <= 4) {
             $("#txtFromBillAmount").prop('disabled', false);
             $("#txtToBillAmount").prop('disabled', true);

         }
         else if (parseInt(nDateOptionValTwo) == 5 || parseInt(nDateOptionValTwo) == 6) {
             $("#txtFromBillAmount").prop('disabled', false);
             $("#txtToBillAmount").prop('disabled', false);
             $("#txtToBillAmount").val(0);

         }
     }
     function DateActions_Bill() {
         DynamicDateActions("cboBillDate", "txtBillDateStart", "txtBillDateEnd");
     }
     function DateActions_DateOption() {
         DynamicDateActions("cboDateOptionAdvSearch", "txtFromDateAdvSearch", "txtToDateAdvSearch");
     }

     $("#btnCloseAdvSearch").click(function () {
         $("#winAdvSearch").icsWindow("close");
     });
     $("#btnAdvSearch").click(function () {
         debugger;
         $("#winAdvSearch").icsWindow("open", "Export Bill Advance Search");
         //DynamicRefreshList([], "tblExportPIAdvSearch");
         DynamicResetAdvSearchWindow("winAdvSearch");
         //DynamicDateActions("cobBillAmount", "txtFromBillAmount", "txtToBillAmount");
         DynamicDateActions("cboBillDate", "txtBillDateStart", "txtBillDateEnd");
         DynamicDateActions("cboDateOptionAdvSearch", "txtFromDateAdvSearch", "txtToDateAdvSearch");
         ResetAdvSearchWindow();
     });
     /// end Adv Searching


     /// Update Status
     $("#btnEBillStatusUpdate").click(function () {
         var oExportBill = $('#tblExportBills').datagrid('getSelected');
         if (oExportBill ==null || oExportBill.ExportBillID <=0 ) { alert("Please select an item from list."); return ; }
         $('#cboCurrentState').val(oExportBill.StateInt);
         $("#winExportBillStatus").icsWindow('open', "Export Bill Status Change");

     });
     $("#btnExportBillDoc").click(function () {

         var oExportBill=$('#tblExportBills').datagrid('getSelected');
         var nSelectedIndex= $('#tblExportBills').datagrid('getRowIndex',oExportBill);
         if(oExportBill==null || oExportBill.ExportBillID<=0)
         {
             alert("Please select a item from list!");
             return;
         }
         var nIndex=$('#tblExportBills').datagrid('getRowIndex',oExportBill);
         sessionStorage.setItem("Operation", "New");
         sessionStorage.setItem("SelectedRowIndex", nIndex);
         sessionStorage.setItem("ExportBillHeader", "Document setup");
         sessionStorage.setItem("ExportBills", JSON.stringify($('#tblExportBills').datagrid('getRows')));
         sessionStorage.setItem("BackLink", window.location.href);
         var buid= parseInt(sessionStorage.getItem('BUID'));
         var tsv = ((new Date()).getTime()) / 1000;
         window.open(_sBaseAddress + "/ExportDocSetup/View_ExportDocSetupsBill?id=" + oExportBill.ExportBillID + "&buid=" + buid);
     });

     $("#btnClaimSettle").click(function ()
     {
         var oExportBill=$('#tblExportBills').datagrid('getSelected');
         var nSelectedIndex= $('#tblExportBills').datagrid('getRowIndex',oExportBill);
         if(oExportBill==null || oExportBill.ExportBillID<=0)
         {
             alert("Please select a item from list!");
             return;
         }
         var nIndex=$('#tblExportBills').datagrid('getRowIndex',oExportBill);
         sessionStorage.setItem("SelectedRowIndex", nIndex);
         sessionStorage.setItem("ExportBill", JSON.stringify(oExportBill));
         sessionStorage.setItem("ExportBills", JSON.stringify($('#tblExportBills').datagrid('getRows')));
         sessionStorage.setItem("BackLink", window.location.href);
         var buid= parseInt(sessionStorage.getItem('BUID'));
         var tsv = ((new Date()).getTime()) / 1000;
         window.open(_sBaseAddress + "/ExportBill/ViewExportClaimSettle?id=" + oExportBill.ExportBillID + "&buid=" + buid);
     });

     $("#btnSaveExportBillStatus").click(function (e) {
         var oExportBill=$('#tblExportBills').datagrid('getSelected');
         var nSelectedIndex= $('#tblExportBills').datagrid('getRowIndex',oExportBill);
         if(oExportBill==null || oExportBill.ExportBillID<=0)
         {
             alert("Please select a item from list!");
             return;
         }


         var oExportBillTemp = {
             ExportBillID:oExportBill.ExportBillID,
             StateInt: parseInt($("#cboCurrentState").val()),
             NoteCarry: $("#txtNoteStatusChange").val()

         };
         var obj =
             {
                 BaseAddress: _sBaseAddress,
                 Object: oExportBillTemp,
                 ObjectId: oExportBillTemp.ExportBillID,
                 ControllerName: "ExportBill",
                 ActionName: "Save_UpdateStatus",
                 TableId: "tblExportBills",
                 IsWinClose: true
             };
         $.icsSave(obj, function (response) {
             if (response.status) {
                 if(nSelectedIndex>-1){
                     $('#tblExportBills').datagrid('selectRow',nSelectedIndex);
                     RowSelect(nSelectedIndex, _oExportBills[nSelectedIndex]);
                 }
             }
         });
     });
     $("#btnCloseExportBillStatus").click(function () {
         $("#winExportBillStatus").icsWindow("close");
     });
     $("#btnSaveDocDate").click(function (e) {
         var oExportBill=$('#tblExportBills').datagrid('getSelected');
         var nSelectedIndex= $('#tblExportBills').datagrid('getRowIndex',oExportBill);
         if(oExportBill==null || oExportBill.ExportBillID<=0)
         {
             alert("Please select a item from list!");
             return;
         }

         var oExportBillTemp = {
             ExportBillID:oExportBill.ExportBillID,
             DocDate: $('#txtDocDate').datebox('getValue')

         };
         var obj =
             {
                 BaseAddress: _sBaseAddress,
                 Object: oExportBillTemp,
                 ObjectId: oExportBillTemp.ExportBillID,
                 ControllerName: "ExportBill",
                 ActionName: "SaveDocDate",
                 TableId: "tblExportBills",
                 IsWinClose: false
             };
         $.icsSave(obj, function (response) {
             if (response.status) {
                 //if(nSelectedIndex>-1){
                 //    $('#tblExportBills').datagrid('selectRow',nSelectedIndex);
                 //    RowSelect(nSelectedIndex, _oExportBills[nSelectedIndex]);
                 //}
             }
         });
     });
     $("#btnExportBillDoc").click(function () {

         var oExportBill=$('#tblExportBills').datagrid('getSelected');
         var nSelectedIndex= $('#tblExportBills').datagrid('getRowIndex',oExportBill);
         if(oExportBill==null || oExportBill.ExportBillID<=0)
         {
             alert("Please select a item from list!");
             return;
         }
         var nIndex=$('#tblExportBills').datagrid('getRowIndex',oExportBill);
         sessionStorage.setItem("Operation", "New");
         sessionStorage.setItem("SelectedRowIndex", nIndex);
         sessionStorage.setItem("ExportBillHeader", "Document setup");
         sessionStorage.setItem("ExportBills", JSON.stringify($('#tblExportBills').datagrid('getRows')));
         sessionStorage.setItem("BackLink", window.location.href);
         var buid= parseInt(sessionStorage.getItem('BUID'));
         var tsv = ((new Date()).getTime()) / 1000;
         window.open(_sBaseAddress + "/ExportDocSetup/View_ExportDocSetupsBill?id=" + oExportBill.ExportBillID + "&buid=" + buid);
     });
     $('#btnAddLDBP').click(function(){
         var oExportBill=$('#tblExportBills').datagrid('getSelected');
         var nSelectedIndex= $('#tblExportBills').datagrid('getRowIndex',oExportBill);
         if(oExportBill==null || oExportBill.ExportBillID<=0)
         {
             alert("Please select a item from list!");
             return;
         }
         var nIndex=$('#tblExportBills').datagrid('getRowIndex',oExportBill);
         sessionStorage.setItem("Operation", "LDBP");
         sessionStorage.setItem("SelectedRowIndex", nIndex);
         sessionStorage.setItem("ExportBillHeader", "LDBP");
         sessionStorage.setItem("ExportBills", JSON.stringify($('#tblExportBills').datagrid('getRows')));
         sessionStorage.setItem("BackLink", window.location.href);
         var buid= parseInt(sessionStorage.getItem('BUID'));
         window.open(_sBaseAddress + "/ExportBill/ViewExportBill_LDBP?nId=" + oExportBill.ExportBillID + "&buid=" + buid);
     });
</script>
    
