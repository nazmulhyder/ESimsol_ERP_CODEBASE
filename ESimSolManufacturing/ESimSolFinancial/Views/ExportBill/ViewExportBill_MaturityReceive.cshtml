<html>
<head>
    @{
        ViewBag.Title = " Maturity Received";
    } 
</head>
<body>
    @model ESimSol.BusinessObjects.ExportBill  
    <div class="menuMainCollectionTable">
        <div style="width:100%;height:88%">
            <fieldset>
             <legend style="font-weight:bold">L/C & Invoice  info </legend>
                <table border="0"  cellspacing="2" cellpadding="2" style=" width:100%;font-size:12px; font-weight:bold">
                    <tr>
                        <td style="width:20%; text-align:right">
                            Invoice No :
                        </td>
                        <td style="width:30%;font-size:12px; font-weight:bold">
                            <input id="txtExportBillNo" style="width: 100%;font-size:12px; font-weight:bold" font-weight:bold" class="type-diabaled" disabled />
                        </td>
                        <td style="width:15%; text-align:right"></td>
                        <td style="width:25%"></td>
                        <td style="width:10%; text-align:right">
                        </td>
                    </tr>
                    <tr>
                        <td style="width:20%; text-align:right">
                            L/C No :
                        </td>
                        <td style="width:25%">
                            <input id="txtLCNo" style="width: 100%;font-size:12px; font-weight:bold" class="type-diabaled" disabled />
                        </td>
                        <td style="width:15%; text-align:right">
                            <label id="lblAmendmentNo">Amendment No :</label>  
                        </td>
                        <td style="width:25%">
                            <input id="txtAmendmentNoAndDate" style="width: 100%;font-size:12px; font-weight:bold" class="type-diabaled" disabled />
                        </td>
                        <td style="width:10%; text-align:right"></td>
                    </tr>
                    <tr>
                        <td style="width:20%; text-align:right">
                            File No :
                        </td>
                        <td style="width:25%">
                            <input id="txtFileNo" style="width: 100%;font-size:12px; font-weight:bold" class="type-diabaled" disabled />
                        </td>
                        <td style="width:15%; text-align:right"></td>
                        <td style="width:25%"></td>
                        <td style="width:10%; text-align:right"></td>
                    </tr>
                    <tr>
                        <td style="width:20%; text-align:right">
                            Party Name :
                        </td>
                        <td colspan="3" style="width:70%">
                            <input id="txtApplicantName" style="width: 100%;font-size:12px; font-weight:bold" class="type-diabaled" disabled />
                        </td>
                        <td style="width:10%; text-align:right"></td>
                    </tr>
                    <tr>
                        <td style="width:20%; text-align:right">
                            Advice Bank :
                        </td>
                        <td colspan="3" style="width:70%">
                            <input id="txtBankNameAdvice" style="width: 100%;font-size:12px; font-weight:bold" class="type-diabaled" disabled />
                        </td>
                        <td style="width:10%; text-align:right"></td>
                    </tr>
                    <tr>
                        <td style="width:20%; text-align:right">
                            Issue Bank :
                        </td>
                        <td colspan="3" style="width:70%">
                            <input id="txtBankNameIssue" style="width: 100%;font-size:12px; font-weight:bold" class="type-diabaled" disabled />
                        </td>
                        <td style="width:10%; text-align:right"></td>
                    </tr>
                    <tr>
                        <td style="width:20%; text-align:right">
                            Negotiation Bank :
                        </td>
                        <td colspan="3" style="width:70%">
                            <input id="txtBankNameNego" style="width: 100%;font-size:12px; font-weight:bold" class="type-diabaled" disabled />
                        </td>
                        <td style="width:12%; text-align:right"></td>
                    </tr>
                    <tr>
                        <td style="width:20%; text-align:right">
                            Bill Date :
                        </td>
                        <td style="width:30%">
                            <input id="txtExportBillDate" style="width: 100%;font-size:12px; font-weight:bold" class="type-diabaled" disabled />
                        </td>
                        <td style="width:15%; text-align:right">
                            L/C Date :
                        </td>
                        <td style="width:25%">
                            <input id="txtLCDate" style="width: 100%;font-size:12px; font-weight:bold" class="type-diabaled" disabled />
                        </td>
                        <td style="width:10%; text-align:right"></td>
                    </tr>
                    <tr>
                        <td style="width:20%; text-align:right">
                            Bill Value :
                        </td>
                        <td style="width:30%">
                            <input id="txtIAmountSt" style="width: 100%;font-size:12px; font-weight:bold" class="type-diabaled" disabled />
                        </td>
                        <td style="width:15%; text-align:right">
                            L/C Value :
                        </td>
                        <td style="width:25%">
                            <input id="txtIAmountLC" style="width: 100%;font-size:12px; font-weight:bold" class="type-diabaled" disabled />
                        </td>
                        <td style="width:10%; text-align:right"></td>
                    </tr>
                  
                    <tr>
                        <td style="width:20%; text-align:right">
                            Send To Bank :
                        </td>
                        <td style="width:30%">
                            <input id="txtSendToBankDateSt" style="width: 100%;font-size:12px; font-weight:bold" class="type-diabaled" disabled />
                        </td>

                        <td style="width:15%; text-align:right">
                            Received From Bank :
                        </td>
                        <td style="width:25%">
                            <input id="txtRecedFromBankDateSt" style="width: 100%;font-size:12px; font-weight:bold" class="type-diabaled" disabled />
                        </td>
                        <td style="width:10%; text-align:right"></td>
                    </tr>
                    <tr>

                        <td style="width:20%; text-align:right">
                            LDBC/IBC No :
                        </td>
                        <td style="width:30%">
                            <input id="txtLDBCNo" style="width: 100%;font-size:12px; font-weight:bold" class="type-diabaled" disabled />
                        </td>
                        <td style="width:15%; text-align:right">
                            LDBC/IBC No Date :
                        </td>
                        <td style="width:25%">
                            <input id="txtLDBCDate" style="width: 100%;font-size:12px; font-weight:bold" class="type-diabaled" disabled />
                        </td>
                        <td style="width:10%; text-align:right"></td>
                    </tr>
                    <tr>
                        <td style="width:20%; text-align:right">
                            Current Status :
                        </td>
                        <td colspan="3" style="width:70%">
                            <input id="txtState" style="width: 100%;font-size:12px; font-weight:bold" class="type-diabaled" disabled />
                        </td>
                        <td style="width:10%; text-align:right"></td>
                    </tr>
                    <tr>
                        <td style="width:20%; text-align:right">
                            Terms :
                        </td>
                        <td colspan="3" style="width:70%">
                            <input id="txtLCTermsName" style="width: 100%;font-size:12px; font-weight:bold" class="type-diabaled" disabled />
                        </td>
                        <td style="width:10%; text-align:right"></td>
                    </tr>
                </table>
            </fieldset>
            <fieldset>
                <legend style="font-weight:bold">Maturity info </legend>
                <table style="width:100%;font-size:12px; font-weight:normal" border="0" cellspacing="2" cellpadding="2" style="font-size:11px; font-weight:bold">
                    <tr>
                        <td style="width:20%; text-align:right">
                            Negotiation Criteria:
                        </td>
                        <td style="width:15%">
                            <select style="width:100%;" id="cboLCTerm" onchange="cboLCTermonchange()" />
                        </td>
                        <td style="width:10%; text-align:right">
                            Accept Rate:
                        </td>
                        <td style="width:10%">
                            <input id="txtAcceptRate" type="text" style="width:100%;" />
                        </td>
                        <td style="width:25%; text-align:right">
                            Submit To Party Bank:
                        </td>
                        <td style="width:15%">
                            <input id="txtAcceptanceDate" type="text" style="width: 100%;" class="easyui-datebox" required="required" data-options="formatter:icsdateformat,parser:icsdateparser" />
                        </td>
                       
                        <td style=" width:5%"></td>
                    </tr>
                    <tr>
                        <td style="width:20%; text-align:right">
                            <span class="lblMaturityRcvDate"></span>:
                        </td>
                        <td style="width:15%">
                            <input id="txtMaturityReceivedDate" type="text" style="width: 100%;" class="easyui-datebox" required="required" data-options="formatter:icsdateformat,parser:icsdateparser" />
                        </td>
                        <td style="width:10%; text-align:right">
                          
                        </td>
                        <td style="width:10%">
                        </td>
                        <td style="width:25%; text-align:right">
                            <span class="lblMaturityDate"></span>:
                        </td>
                        <td style="width:15%">
                            <input id="txtMaturityDate" type="text" style="width: 100%;" class="easyui-datebox" required="required" data-options="formatter:icsdateformat,parser:icsdateparser" />
                        </td>
                       
                        <td style=" width:5%"></td>                     
                    </tr>
                    <tr>
                      
                        <td style="width:20%; text-align:right">
                            Note:
                        </td>
                        <td colspan="5" style="width:75%">
                            <input id="txtNote_MaturityRecd" type="text" style="width:100%;" />
                        </td>
                        <td style=" width:5%"></td>
                    </tr>
                </table>
            </fieldset>
            
        </div>
         


        <fieldset>
            <legend>Action</legend>
            <div style="width:100%;height:10%">
                <table border="0" cellpadding="2" cellspacing="2" style="width:100%;">
                <tr>
                    <td style="width: 20%; text-align: right"></td>

                    <td style="width: 65px; font-size:13px">
                    </td>
                    <td style="width: 15%;text-align: right;  font-size:13px">
                        <a id="btnSave" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-save" plain="true">Save</a>
                        <a id="btnClose" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-cancel" plain="true">Close</a>
                    </td>
                   
                </tr>
                </table>
            </div>

        </fieldset>
    </div>

</body>
</html>

<style type="text/css">
    .td-styler input {
        padding-left: 5px;
    }

    .td-styler select {
        padding-left: 5px;
    }

    .td-col-3 select {
        width: 95%;
    }
</style>

<script type="text/javascript">

    var _sBaseAddress = "";
    var _oExportBill=null;
    var _nSelectedRowIndex=0;
    var _sBackLink="";
    var _oLCTerms=[];
    $(document).ready(function () {
        _sBaseAddress =@Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(HttpContext.Current.Session[SessionInfo.BaseAddress]));
        _oExportBill =@Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(Model));
        var oCompany= @Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(ViewBag.Company));
        _oLCTerms = @Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(ViewBag.LCTerms));
        $("#cboLCTerm").icsLoadCombo({
            List: _oLCTerms,
            OptionValue: "LCTermID",
            DisplayText: "NameDaysInString"
        });

       
        ResetControll();
        RefreshControl(_oExportBill);
       
        _sBackLink=sessionStorage.getItem("BackLink");
        $('#txtAcceptRate').icsCurrencyBox(null, null, 3);

        if(parseFloat(_oExportBill.AcceptanceRate)>0)
        {
            $('#txtAcceptRate').val(icsFormatPrice(parseFloat(_oExportBill.AcceptanceRate), null,3));
        }
        else
        {
            if(parseInt(_oExportBill.CurrencyID)===parseInt(oCompany.BaseCurrencyID))
            {
                $('#txtAcceptRate').val(formatPrice(parseFloat(1.00),2));
                $('#txtAcceptRate').prop('disabled', true);
            }
            else
            {
                $('#txtAcceptRate').val(formatPrice(parseFloat(78.00),2));
                $('#txtAcceptRate').prop('disabled', false);
            }
        }
    });



    function ResetControll()
    {

        $('#txtSendToParty').datebox('setValue', icsdateformat(new Date()));
        $('.reset-text').val("");
    }

    function RefreshControl(oExportBill){        
        _oExportBill=oExportBill;
        $("#txtExportBillNo").val( _oExportBill.ExportBillNo);
        $("#txtAmendmentNoAndDate").val( _oExportBill.AmendmentNo);
        if(_oExportBill.AmendmentNo=="" || _oExportBill.AmendmentNo == null)
        {
            $("#txtAmendmentNoAndDate").hide();
            $("#lblAmendmentNo").hide();
        }
        $("#txtLCNo").val(_oExportBill.ExportLCNo);
        $("#txtFileNo").val( _oExportBill.FileNo);
        $("#txtApplicantName").val(_oExportBill.ApplicantName);
        $("#txtExportBillDate").val(_oExportBill.StartDateSt);
        $("#txtLCDate").val(_oExportBill.LCOpeningDatest);
        $("#txtBankNameAdvice").val(_oExportBill.BankName_Advice + '[' + _oExportBill.BBranchName_Advice + ']');
        $("#txtBankNameNego").val( _oExportBill.BankName_Nego + '[' + _oExportBill.BBranchName_Nego + ']');
        $("#txtBankNameIssue").val(_oExportBill.BankName_Issue + '[' + _oExportBill.BBranchName_Issue + ']');
        $("#txtIAmountSt").val( _oExportBill.AmountSt);
        $("#txtIAmountLC").val(_oExportBill.Amount_LCSt);
        $("#txtState").val(_oExportBill.StateSt);        
        $("#txtSendToBankDateSt").val( _oExportBill.SendToBankDateSt);        
        $("#txtRecedFromBankDateSt").val( _oExportBill.RecedFromBankDateSt);
        $("#txtLDBCNo").val(_oExportBill.LDBCNo);
        $("#txtLDBCDate").val(_oExportBill.LDBCDateSt);
        $('#cboLCTerm').val(_oExportBill.LCTramsID);
        $("#txtNote_MaturityRecd").val(_oExportBill.NoteCarry);
        $("#txtLCTermsName").val(_oExportBill.LCTermsName);
        if (_oExportBill.AcceptanceDateStr == "" || _oExportBill.AcceptanceDateStr == "--") {
            $('#txtAcceptanceDate').datebox('setValue', icsdateformat(new Date()));
        }
        else {
            $('#txtAcceptanceDate').datebox('setValue', _oExportBill.AcceptanceDateStr);
        }
        if (_oExportBill.MaturityReceivedDateSt == "" || _oExportBill.MaturityReceivedDateSt == "--") {
            $('#txtMaturityReceivedDate').datebox('setValue', icsdateformat(new Date()));
        }
        else {
            $('#txtMaturityReceivedDate').datebox('setValue', _oExportBill.MaturityReceivedDateSt);
        }
        if (_oExportBill.MaturityDateSt == "" || _oExportBill.MaturityDateSt == "--") {
            $('#txtMaturityDate').datebox('setValue', icsdateformat(new Date()));
        }
        else {
            $('#txtMaturityDate').datebox('setValue', _oExportBill.MaturityDateSt);
        }
        cboLCTermonchange();
    }

    function Validation()
    {
        //var dSendToParty = new Date($('#txtSendToParty').datebox('getValue'));
        //var dStartDate = new Date(_oExportBill.StartDate);
        //if ((dStartDate) > (dSendToParty))
        //{
        //    alert("Send to party Date cannot be greater than Invoice Date.");
        //    return false;
        //}

        if(parseFloat(icsRemoveComma($('#txtAcceptRate').val())) <=0)
        {
            alert("Please Enter Acceptance Rate!");
            $('#txtAcceptRate').focus()
            return false;
        }
        return true;
    }

    function RefreshObject()
    {
        var oExportBill = {
            ExportBillID: (_oExportBill != null) ? _oExportBill.ExportBillID : 0,
            AcceptanceDate: new Date($('#txtAcceptanceDate').datebox('getValue')),
            MaturityDate: new Date($('#txtMaturityDate').datebox('getValue')),
            MaturityReceivedDate: new Date($('#txtMaturityReceivedDate').datebox('getValue')),
            AcceptanceRate : parseFloat(icsRemoveComma($('#txtAcceptRate').val(), 3)),
            NoteCarry: document.getElementById('txtNote_MaturityRecd').value,
            LCTramsID:parseInt($('#cboLCTerm').val())
        };
        return oExportBill;
    }

    $("#btnSave").click(function (){

        if(!Validation()) return;

        var oExportBill=RefreshObject();
        $.ajax({
            type: "POST",
            dataType: "json",
            url : _sBaseAddress+"/ExportBill/SaveMaturityReceived",
            traditional: true,
            data:  JSON.stringify(oExportBill),
            contentType: "application/json; charset=utf-8",
            success: function (data) {
                debugger;
                var ExportBill= jQuery.parseJSON(data);
                if (ExportBill.ErrorMessage=="" || ExportBill.ErrorMessage==null)
                {
                    _oExportBill=ExportBill;
                    alert("Data Save Succesfully!!");
                    var oExportBills =sessionStorage.getItem("ExportBills");
                    var nIndex= parseInt(sessionStorage.getItem("SelectedRowIndex"));
                    debugger;
                    if(oExportBills!=null)
                    {
                        oExportBills = jQuery.parseJSON(oExportBills);
                    }
                    else
                    {
                        oExportBills=[];
                    }
                    if(nIndex!=-1)
                    {
                        oExportBills[nIndex]=_oExportBill;
                    }
                    else
                    {
                        sessionStorage.setItem("SelectedRowIndex", oExportBills.length);
                        oExportBills.push(_oExportBill);
                    }
                    sessionStorage.setItem("ExportBills", JSON.stringify(oExportBills));
                    window.location.href = _sBackLink;
                }
                else
                {
                    alert(ExportBill.ErrorMessage);
                }
            },
            error: function (xhr, status, error)
            {
                alert(error);
            }
        });
    });




    $('#btnClose').click(function(e){
        window.location.href = sessionStorage.getItem("BackLink");
    });

    function cboLCTermonchange()
    {
        $(".lblMaturityRcvDate").html("Maturity Rcv Date");
        $(".lblMaturityDate").html("Maturity Date");
        var ncboLCTerm= parseInt($('#cboLCTerm').val());
        var nDays=0;
        if(ncboLCTerm>0)
        {
            for(var i = 0;i<_oLCTerms.length;i++)
            {
                if(parseInt(ncboLCTerm)===parseInt(_oLCTerms[i].LCTermID))
                {
                    nDays=parseInt(_oLCTerms[i].Days);
                    break;
                }
            }
        }
        if(nDays<=0)
        {
            $(".lblMaturityRcvDate").html("Negotiation Date");
            $(".lblMaturityDate").html("Payment Rcv Date");
        }
    }

</script>