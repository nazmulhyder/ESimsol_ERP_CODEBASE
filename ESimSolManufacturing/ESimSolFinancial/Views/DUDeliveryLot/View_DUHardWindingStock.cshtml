@model IEnumerable<ESimSol.BusinessObjects.DUDeliveryLot>
    @{
        ViewBag.Title = "DU Hard Winding Stock Report(For Production)";
    }

    <div id="progressbarParent" style="width:100%;height:100%;margin:0 auto;text-align:center; margin-left: auto;margin-right: auto;left: 0;right: 0;z-index: 1;">
        <div style="margin: 0px auto;margin-top: 251px;text-align:center;width:390px;">
            <label style="font-size:18px;">Please wait</label>
            <div id="progressbar" style="width:100%;height:37px;"></div>
        </div>
    </div>

    <div class="menuMainCollectionTable">
        <table border="0" cellpadding="2" cellspacing="2" style="width:100%;">  
        </table>
            <div title="Lot View" id="divLotView" style="width:100%;height:95%">
                <div style="width:100%;height:100%">
                    <table id="tblLotView" style="width:100%; height:100%" class="easyui-datagrid" fit="true" fitcolumns="false" rownumbers="true" pagination="false" singleselect="true" autorowheight="false" toolbar="#toolbarRSWise" showFooter="true" data-options="rowStyler: function(index,row){
                if (row.Product=='Total'){
                return 'color:#016B18; font-weight:bold;';
            }
        }
">
                        <thead>
                            <tr>
                                <th field="LotNo" width="8%">Batch No</th>
                                <th field="OrderNoFull" width="12%">Order No</th>
                                <th field="Contractor" width="20%">Buyer Name</th>
                                <th field="Product" width="15%">Yarn</th>
                                <th field="ColorName" width="10%">Color</th>                               
                                <th field="BagNo" width="5%">Bag No</th>
                                <th field="Qty_Batch" width="10%" formatter="formatPrice">Qty</th>
                                <th field="Qty_Warp" width="10%" formatter="formatPrice">Warp Qty</th>
                                <th field="Qty_Weft" width="10%" formatter="formatPrice">Weft Qty</th>
                                <th field="Qty_DC" width="8%" align="right" formatter="formatPrice">Delivered Qty</th>
                                <th field="Balance" width="8%" align="right" formatter="formatPrice">Stock in Hand</th> 
                                <th field="OrderTypeSt" width="12%">OrderType</th>
                            </tr>
                        </thead>
                    </table>
                    <div id="toolbarRSWise">
                        Order No:<input id="txtOrderNo" type="text" style="width:100px;" placeholder="Type OrderNo & Press Enter"/>
                        Lot No:<input id="txtLotNo" type="text" style="width:100px;" placeholder="Type LotNo & Press Enter" />
                        <a id="btnAdvanceSearch_Lot" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-search" plain="true">Adv. Search</a>
                        @*<a id="btnLotLocation" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-add" plain="true">Lot Location</a>*@
                        @*<a href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-reload" plain="true" id="btnSearch_Lot">Refresh</a>*@
                        <a id="btnDULotDistribution" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-details" plain="true">Lot Distribution</a>
                        <a id="btnPrintList" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-print" plain="true">ExportPDF</a>
                    </div>
                </div>
            </div>                  
        </div>
    <div id="winAdvSearchOrderTracker" style="width:510px" class="easyui-window winClass" title="Adv. Search" data-options="modal:true,closed:true,collapsible:false,minimizable:false,maximizable:false,closable:false">
        <table style="width:100%">
            <tr>
                <td>
                    <fieldset>
                        <legend>Searching Criteria</legend>
                        <table style="width:100%">
                            <tr>
                                <td style="width:20%;text-align:right;">
                                    <label>Packing Date:</label>
                                </td>
                                <td colspan="3" style=" width:75%;text-align:left;">
                                    <select id="cboDODate" style="width:30%;"></select>
                                    <input id="txtFromDODate" type="text" style="width: 100px;" class="easyui-datebox" required="required" data-options="formatter:icsdateformat,parser:icsdateparser" />To
                                    <input id="txtToDODate" type="text" style="width: 100px;" class="easyui-datebox" required="required" data-options="formatter:icsdateformat,parser:icsdateparser" />
                                </td>
                            </tr>

                            <tr>
                                <td style=" width:25%;text-align:right;">
                                    <label>Customer:</label>
                                </td>
                                <td colspan="3" style=" width:75%;text-align:left;">
                                    <input id="txtContractorAdvS" style="width:75%;" type="text" placeholder="Type & Press Enter" />
                                    <a id="btnPickContractorAdvS" href="javascript:void(0)" class="easyui-linkbutton ics-pick" iconcls="icon-pick" plain="true"></a>
                                    <a id="btnClrContractorAdvS" href="javascript:void(0)" class="easyui-linkbutton ics-pick" iconcls="icon-clear" plain="true"></a>
                                </td>
                            </tr>
                            <tr>
                                <td style=" width:25%;text-align:right;">
                                    <label>Product:</label>
                                </td>
                                <td colspan="3" style=" width:75%;text-align:left;">
                                    <input id="txtProductName" style="width:75%;" type="text" placeholder="Type & Press Enter" />
                                    <a id="btnProductPiker" href="javascript:void(0)" class="easyui-linkbutton ics-pick" iconcls="icon-pick" plain="true"></a>
                                    <a id="btnClrProductPiker" href="javascript:void(0)" class="easyui-linkbutton ics-pick" iconcls="icon-clear" plain="true"></a>
                                </td>
                            </tr>
                            <tr>
                                <td style=" width:25%;text-align:right;">
                                    <label>Order Type: </label>
                                </td>
                                <td style=" width:25%;text-align:left;">
                                    <select id="cboOrderTypeSearch" style="width: 100%;"></select>
                                </td>
                                <td style=" width:25%;text-align:right;">
                                    <label>Stock: </label>
                                </td>
                                <td style=" width:25%;text-align:left;">
                                    <select id="cboStockType" style="width:114px; margin-right:50px;">
                                        <option value="1">Current Stock All</option>
                                        <option value="2">Current Stock Warp</option>
                                        <option value="3">Current Stock Weft</option>
                                    </select>   
                                </td>
                            </tr>

                            @*<tr>
                                <td style=" width:25%;text-align:right;">
                                    <label>Order No: </label>
                                </td>
                                <td style=" width:25%;text-align:left;">
                                    <input id="txtOrderNo" type="text" style="width:100%" />
                                </td>
                                <td style=" width:25%;text-align:right;">
                                    <label>Lot No: </label>
                                </td>
                                <td style=" width:25%;text-align:left;">
                                    <input id="txtLotNo" type="text" style="width:100%" />
                                </td>

                            </tr>*@
                        </table>
                    </fieldset>
                </td>
            </tr>
        </table>
        <fieldset>
            <legend>Actions : </legend>
            <table border="0" cellspacing="2" cellpadding="2" style="width:100%;font-size:11px; font-weight:bold;">
                <tr>
                    <td style="width:60%;text-align:left">
                        <a id="btnAdvSearchReset" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-reload" plain="true"> Reset</a>
                        <label class="lblLoadingMessage" style="float: left;">Loading Please Wait...</label>
                    </td>
                    <td style="width:40%; text-align: right">
                        <a id="btnSearch" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-search" plain="true">Search</a>
                        <a id="btnAdvSearchClose" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-cancel" plain="true">Close</a>
                    </td>
                </tr>
            </table>
        </fieldset>
    </div>
                    
                      <div id="winDULotDistribution" class="easyui-window winstyle" style=" height:auto;width:60%" data-options="modal:true,closed:true,collapsible:false,minimizable:false,maximizable:false,closable:false">
                          <div class="menuMainCollectionTable">
                              <div style="overflow:hidden;display:block;">
                                  <fieldset style="height:10%">
                                      <legend style="font-weight: bold">  </legend>
                                      <div style="overflow:hidden;display:block">
                                          <div style="overflow:hidden;float:left; width:30%">
                                              <div style="overflow:hidden;float:left;width:30%;text-align:right">
                                                  Lot No:
                                              </div>
                                              <div style="overflow:hidden;float:left;width:70%">
                                                  <input id="txtDULotNo" type="text" style="float:left;width:100%" disabled/>
                                              </div>
                                          </div>
                                          <div style="overflow:hidden;float:left; width:40%">
                                              <div style="overflow:hidden;float:left;width:30%;text-align:right">
                                                  Order No:
                                              </div>
                                              <div style="overflow:hidden;float:left;width:70%">
                                                  <input id="txtDUOrderNo" type="text" style="float:left;width:100%"  disabled/>
                                              </div>
                                          </div>
                                          <div style="overflow:hidden;float:left; width:30%">
                                              <div style="overflow:hidden;float:left;width:30%;text-align:right">
                                                  Balance:
                                              </div>
                                              <div style="overflow:hidden;float:left;width:70%">
                                                  <input id="txtDUBalance" type="text" style="float:left;width:100%" disabled />
                                              </div>
                                          </div>
                                      </div>
                                      <div style="overflow:hidden;display:block;margin-top:5px;">
                                          <div style="overflow:hidden;float:left; width:30%">
                                              <div style="overflow:hidden;float:left;width:30%;text-align:right">
                                                  Qty:
                                              </div>
                                              <div style="overflow:hidden;float:left;width:70%">
                                                  <input id="txtDUQty" type="text" style="float:left;width:100%" />
                                              </div>
                                          </div>
                                          <div style="overflow:hidden;float:left; width:40%">
                                              <div style="overflow:hidden;float:left;width:30%;text-align:right">
                                                  Order Pick:
                                              </div>
                                              <div style="overflow:hidden;float:left;width:70%">
                                                  <input id="txtOrderPick" type="text" style="float:left;width:100%" placeholder=" Search By OrderNo & click ok .." />
                                                  @*<input id="btnDULotDistributionDelete" type="button"style="width: 20%" value="C" />*@
                                              </div>
                                          </div>                                        
                                          <div style="overflow:hidden;float:right; width:30%;">
                                              <div style="overflow:hidden;float:left;width:100%;text-align:right">
                                                  @*<input id="btnAddDULotDistribution" type="button" value="Add" />*@
                                              </div>
                                          </div>
                                      </div>
                                  </fieldset>
                              </div>
                              <div title="Lot Distribution List" style="display:block;overflow:hidden;height:200px">
                                  <table id="tblDULotDistribution" title="DU Lot Distribution" class="easyui-datagrid" fit="true" fitcolumns="false" rownumbers="true" pagination="false" singleselect="true" autorowheight="false" toolbar="#toolbar" style="height:310px" showfooter="true">
                                      <thead>
                                          <tr>
                                              <th field="OrderNo" width="15%">Order No</th>
                                              <th field="ProductName" width="40%">Product Name</th>
                                              <th field="Qty" width="20%" formatter="formatPrice">Qty</th>
                                              <th field="MUName" width="20%">MUnit</th>
                                          </tr>
                                      </thead>
                                  </table>
                                  <div id="toolbar">
                                      @*<a id="btnDULotDistributionDelete" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-remove" plain="true">Delete</a>*@
                                  </div>
                              </div>
                              <div style="display:block;overflow:hidden;">
                                  <fieldset style="height:10%">
                                      <legend style="font-weight: bold">Action : </legend>
                                      <table border="0" cellspacing="2" cellpadding="2" style="font-size: 11px; font-weight: bold; width:100%">
                                          <tr>
                                              <td style="width:60%; text-align:right"></td>
                                              <td style="width:40%;text-align:right;">
                                                  <a id="btnDULotDistributionClose" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-cancel" plain="true">Close</a>
                                              </td>
                                          </tr>
                                      </table>
                                  </fieldset>
                              </div>
                          </div>
                      </div>

    <style type="text/css">
        .lines-no .datagrid-body td {
            border-right: 1px dotted transparent;
            border-bottom: 1px dotted transparent;
        }

        .form-control {
            height: 22px;
            padding: 2px 4px;
            font-size: 12px;
        }
    </style>

    <script type="text/javascript">
    var _sBaseAddress="";
    var _oDUDeliveryLot=null;
    var _oDUDeliveryLots=[];
    var _oCompanys=[];
    var _oCompareOperators=[];
    var _nBUID = 0;
    var _oBU = null;
    var _sMessage="";
    var _nReportType=0;
    var _oOrderTypes = [];
    var _sProductIDs = "";
    var _sContractorIds = "";
    var _sPID = "";
    var _OrderNo = [];
    var _LotNo = [];
    var _Balance = [];

    $(document).ready(function ()
    {
        _sBaseAddress =@Html.Raw( new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(HttpContext.Current.Session[SessionInfo.BaseAddress]));
        _oDUDeliveryLots =@Html.Raw( new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(Model));
        _oCompareOperators = @Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(ViewBag.CompareOperators));
        var OrderTypes = @Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(ViewBag.OrderTypes));
        _nBUID = @Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(ViewBag.BUID));
        _OrderNo = @Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(ViewBag.OrderNo));
        _LotNo = @Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(ViewBag.LotNo));
        _Balance = @Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(ViewBag.Balance));

        debugger;
        $("#progressbar").progressbar({ value: 0 });
        $("#progressbarParent").hide();
        $(".lblLoadingMessage").hide();
        $('#txtFromDODate').datebox('setValue', icsdateformat(new Date()));
        $('#txtToDODate').datebox('setValue', icsdateformat(new Date()));
        $('#txtDUQty').icsCurrencyBox();

        $("#cboOrderType").icsLoadCombo({
            List: OrderTypes,
            OptionValue: "OrderType",
            DisplayText: "ShortName",
        });
        RefreshWU();
        _oOrderTypes = OrderTypes;
        RefreshSearchComboBoxControls();
    });

     function RefreshWU()
     {
         $('#cboWorkingUnit').empty();
         var listDates = "<option value='"+0+"'>" + "--Select Store--" + "</option>";
         listDates+= "<option value='"+8+"'>" + "Delivery Store" + "</option>";
         $("#cboWorkingUnit").html(listDates);
         $("#cboWorkingUnit").val(8);
     }

     $(document).keydown(function (e) { if (e.keyCode == 27) { $('div').icsWindow('close'); } });

    ////Start adv Searching

    function updateProgress() {
        var value =$('#progressbar').progressbar('getValue');
        if (value < 96){
            value += Math.floor(Math.random() * 10);
            $('#progressbar').progressbar('setValue', value);
        }
    }
    function hideShow(miliseconds) {
        $("#progressbarParent").hide();
    }

    function RefreshSearchComboBoxControls()
    {
        $("#cboDODate").icsLoadCombo({
            List: _oCompareOperators,
            OptionValue: "id",
            DisplayText: "Value"
        });

        $("#cboOrderTypeSearch").icsLoadCombo({
            List: _oOrderTypes,
            OptionValue: "OrderType",
            DisplayText: "ShortName"
        });
        $('#cboWorkingUnit').empty();
        var listDates = "<option value='"+0+"'>" + "--Select Store--" + "</option>";
        listDates+= "<option value='"+8+"'>" + "[Delivery Store]" + "</option>";
        $("#cboWorkingUnit").html(listDates);
        $("#cboWorkingUnit").val(8);

    }
    $('#btnAdvSearchReset').click(function(e){
        $("#winAdvSearchOrderTracker input").not("input[type='button']").val("");
        RefreshSearchComboBoxControls();
        _sContractorIds ="";
        _sProductIDs="";
        _sPID = "";
        $('#txtFromDODate').datebox({ disabled : true });
        $('#txtToDODate').datebox({ disabled : true });
        $('#txtFromDODate').datebox('setValue', icsdateformat(new Date()));
        $('#txtToDODate').datebox('setValue', icsdateformat(new Date()));

        //$('#txtFromPIDate').datebox({ disabled : true });
        //$('#txtToPIDate').datebox({ disabled : true });
        //$('#txtFromPIDate').datebox('setValue', icsdateformat(new Date()));
        //$('#txtToPIDate').datebox('setValue', icsdateformat(new Date()));

        $('#cboDODate').val(0);
        //$('#cboPIDate').val(0);
        $('#cboOrderType').val(0);
        $('#cboStockType').val(1);

    });

    $("#btnSearch_Lot").click(function () {

        var ncboWorkingUnit = parseInt($("#cboWorkingUnit").val());
        var nOrderType = parseInt($("#cboOrderType").val());
        _nReportType =1;
        var sParams =
                     ncboWorkingUnit + "~" +
                     nOrderType + "~" +
                     _nReportType
        sessionStorage.setItem("ParamsInvPro", sParams);
        var oDUDeliveryLot = {
            ErrorMessage : sParams
        };
        Search(oDUDeliveryLot);
    });
    $("#btnSearch_Pro").click(function () {
        var ncboWorkingUnit = parseInt($("#cboWorkingUnit").val());
        var nOrderType = parseInt($("#cboOrderType").val());
        _nReportType =2;
        var sParams =
                     ncboWorkingUnit + "~" +
                     nOrderType + "~" +
                     _nReportType
        sessionStorage.setItem("ParamsInvPro", sParams);
        var oDUDeliveryLot = {
            ErrorMessage : sParams
        };
        Search(oDUDeliveryLot);
    });
    $("#btnAdvanceSearch_Lot").click(function () {
        $(".lblLoadingMessage").hide();
        $("#winAdvSearchOrderTracker").icsWindow("open", "Advance Search");
        _nReportType=1;
    });
    $("#btnAdvanceSearch_Pro").click(function () {
        $(".lblLoadingMessage").hide();
        $("#winAdvSearchOrderTracker").icsWindow("open", "Advance Search");
        _nReportType=2;
    });
    $("#btnAdvanceSearch_Buyer").click(function () {
        $(".lblLoadingMessage").hide();
        $("#winAdvSearchOrderTracker").icsWindow("open", "Advance Search");
        _nReportType=3;
    });
    //$("#btnAdvanceSearch_ProductView").click(function () {
    //    $(".lblLoadingMessage").hide();
    //    $("#winAdvSearchOrderTracker").icsWindow("open", "Advance Search");
    //    _nReportLevel=3;
     //});
    $('#btnAdvSearchClose').click(function(e){
        $("#winAdvSearchOrderTracker").icsWindow('close');
        _sPID = "";
    });

    $("#btnLotLocation").click(function ()
    {
        var oRSA= $('#tblLotView').datagrid('getSelected');
        if(oRSA==null || oRSA.LotID<=0)
        {
            alert("Please select a item from list!");
            return;
        }
        var nIndex = $('#tblLotView').datagrid('getRowIndex',oRSA);
        $('#txtLotNo_LotLocation').data('Lot',oRSA);
        $('#txtLotNo_LotLocation').data('LotIndex',nIndex);

        $('#txtLotNo_LotLocation').val(oRSA.LotNo);
        $('#txtLocationName_LotLocation').val(oRSA.LocationName);
        //$('#txtRemarks_LotLocation').val(oRSA.LotNo);
        $("#winLotLocation").icsWindow("open", "Lot Location Entry");
    });
    $("#btnClose_LotLocation").click(function () {
        debugger;
        $("#winLotLocation").icsWindow('close');
    });


    $("#btnSave_LotLocation").click(function (){

        var txtLotLocationName = $('#txtLocationName_LotLocation').val();
        if(txtLotLocationName==null || txtLotLocationName==undefined)
        {
            alert("Please type a name and try again!!");
            return;
        }

        var oLot = $('#txtLotNo_LotLocation').data('Lot');

        var oLotLocation=
            {
                LotLocationID:oLot.LotLocationID,
                LotID: oLot.LotID,
                LotLocationName: txtLotLocationName
            }

        $.ajax({
            type: "POST",
            dataType: "json",
            url : sessionStorage.getItem('BaseAddress')+"/Lot/SaveLotLocation",
            traditional: true,
            data:  JSON.stringify(oLotLocation),
            contentType: "application/json; charset=utf-8",
            success: function (data) {
                var oLotLocation = jQuery.parseJSON(data);
                if (oLotLocation.ErrorMessage=="" || oLotLocation.ErrorMessage==null)
                {
                    alert("Data Save Succesfully!!");
                    var nIndex=  $('#txtLotNo_LotLocation').data('LotIndex');

                    oLot.LocationName= txtLotLocationName;
                    oLot.LotLocationID = oLotLocation.LotLocationID;
                    $('#tblLotView').datagrid('updateRow',{index: nIndex,   row:oLot});
                    $("#winLotLocation").icsWindow('close');
                }
                else
                {
                    alert(oLotLocation.ErrorMessage);
                }
            },
            error: function (xhr, status, error)
            {
                alert(error);
            }
        });
    });


    //$('#btnAdvSearchReset').click(function(e){
    //    $("#winAdvSearchOrderTracker input").not("input[type='button']").val("");
    //    RefreshSearchComboBoxControls();
    //    _sContractorIds ="";
    //    _sProductIDs="";
    //    $('#txtFromDODate').datebox({ disabled : true });
    //    $('#txtToDODate').datebox({ disabled : true });
    //    $('#txtFromDODate').datebox('setValue', icsdateformat(new Date()));
    //    $('#txtToDODate').datebox('setValue', icsdateformat(new Date()));

    //    //$('#txtFromPIDate').datebox({ disabled : true });
    //    //$('#txtToPIDate').datebox({ disabled : true });
    //    //$('#txtFromPIDate').datebox('setValue', icsdateformat(new Date()));
    //    //$('#txtToPIDate').datebox('setValue', icsdateformat(new Date()));

    //    $('#cboDODate').val(0);
    //    //$('#cboPIDate').val(0);
    //    $('#cboOrderType').val(0);

    //});
    $("#btnSearch_Buyer").click(function () {
        var ncboWorkingUnit = parseInt($("#cboWorkingUnit").val());
        var nOrderType = parseInt($("#cboOrderType").val());
        _nReportType =3;
        var sParams =
                     ncboWorkingUnit + "~" +
                     nOrderType + "~" +
                     _nReportType
        sessionStorage.setItem("ParamsInvPro", sParams);
        var oDUDeliveryLot = {
            ErrorMessage : sParams
        };
        Search(oDUDeliveryLot);
    });
    function Search(oDUDeliveryLot)
    {

        $.ajax({
            type: "POST",
            dataType: "json",
            url: _sBaseAddress + "/DUDeliveryLot/AdvSearch",
            traditional: true,
            data: JSON.stringify(oDUDeliveryLot),
            contentType: "application/json; charset=utf-8",
            success: function (data) {
                var oDUDeliveryLots = data;
                debugger;
                if (oDUDeliveryLots != null)
                {
                    if (oDUDeliveryLots.length > 0)
                    {
                        if(_nReportType==1)
                        {
                            DynamicRefreshList(oDUDeliveryLots, "tblLotView");

                        }
                        else  if(_nReportType==2)
                        {
                            DynamicRefreshList(oDUDeliveryLots, "tblProductView");
                        }
                        else  if(_nReportType==3)
                        {
                            DynamicRefreshList(oDUDeliveryLots, "tblBuyerView");
                        }
                        RefreshSummary(_nReportType);
                    }
                    else
                    {
                        alert("Sorry, No data found.");
                        if(_nReportType==1)
                        {
                            DynamicRefreshList([], "tblLotView");
                        }
                        else  if(_nReportType==2)
                        {
                            DynamicRefreshList([], "tblProductView");
                        }
                        else  if(_nReportType==3)
                        {
                            DynamicRefreshList([], "tblBuyerView");
                        }

                    }
                }
                $(".lblLoadingMessage").hide();
            }
        });
    }



    $("#btnView_Detail").click(function () {
        debugger;
        var oIRP= $('#tblProductView').datagrid('getSelected');
        if(oIRP==null)
        {
            alert("Please select a item from list!");
            return ;
        }
        DynamicRefreshList([], 'tblLots');
        GetsLots(oIRP);
        RefreshControl(oIRP);
        $("#winReportDetail").icsWindow('open', "Color Information");
        $('#tabReportDetail').tabs({ onSelect: function () {TabClick();} });
    });


    function RefreshControl(oIRP)
    {
        $('#txtProductNamePTU').val(oIRP.ProductName);
        $('#txtStockQty').val(formatPrice(oIRP.StockQty,null));
        $('#txtProBookingQty').val(formatPrice(oIRP.RSQty,null));
        $('#txtBalance').val(oIRP.Balance);
    }
    $("#btnClose_Detail").click(function () {
        debugger;

        $("#winReportDetail").icsWindow('close');
    });
     //// Lots Gets
    $("#btnLoad_Lot").click(function () {
        debugger;
        var oIRP= $('#tblProductView').datagrid('getSelected');
        if(oIRP==null)
        {
            alert("Please select a item from list!");
            return ;
        }
        DynamicRefreshList([], 'tblLots');
        GetsLots(oIRP);
        RefreshControl(oIRP)
    });
    function GetsLots(oIRP)
    {
        var obj = {
            BaseAddress: _sBaseAddress,
            Object: oIRP,
            ControllerName: "DUDeliveryLot",
            ActionName: "GetsLots",
            IsWinClose: false
        };
        $.icsDataGets(obj, function (response) {
            debugger;
            if (response.status && response.objs.length > 0)
            {
                var oLotDetails= response.objs;
                DynamicRefreshList(oLotDetails, 'tblLots');
            }
        });
    }
          //RS Gets
    $("#btnLoad_RS").click(function () {
        LoadRS();
    });
    function CheckFromAndToDateValidation(OperationComboId, FromDateId, ToDateId) {
        $("#" + OperationComboId).parent().parent().parent().find("select").removeClass("errorFieldBorder");
        var nCboVal = $("#" + OperationComboId).val();
        if (parseInt(nCboVal) == 5 || parseInt(nCboVal) == 6) {
            var fromDate = $("#" + FromDateId).datebox("getValue");
            var toDate = $("#" + ToDateId).datebox("getValue");
            if (new Date(fromDate) > new Date(toDate)) {
                $("#" + ToDateId).focus();
                $("#" + OperationComboId).addClass("errorFieldBorder");
                $(".lblLoadingMessage").hide();
                return false;
            } else {
                $("#" + OperationComboId).removeClass("errorFieldBorder");
                return true;
            }
        } else {
            return true;
        }
    }
    $('#btnSearch').click(function(e){
        debugger;
        $(".lblLoadingMessage").show();
        var checkDate = CheckFromAndToDateValidation("cboDODate", "txtFromDODate", "txtToDODate");
        if (!checkDate) {
            alert("Start date must be greater than end date.");
            return false;
        }

       //QC Date
        var ncboDODate = parseInt($('#cboDODate').val());
        var dFromDODate   = $('#txtFromDODate').datebox('getValue');
        var dToDODate   = $('#txtToDODate').datebox('getValue');

        var nOrderType = parseInt($("#cboOrderTypeSearch").val());
        var nStockType = parseInt($("#cboStockType").val());

        var sLotNo=$("#txtLotNo").val();
        var sOrderNo=$("#txtOrderNo").val();

        var sParams =    ncboDODate + "~" +
                         dFromDODate + "~" +
                         dToDODate + "~" +
                         _sContractorIds + "~" +
                         _sPID + "~" +
                         nOrderType + "~" +
                         nStockType + "~" +
                         sLotNo+ "~" +
                         sOrderNo+ "~" +
                         _nBUID;

        var oExportLCReport = {
            ErrorMessage : sParams,
            BUID : parseInt(sessionStorage.getItem("BUID")),
            ReportType : _nReportType
        };
        sessionStorage.setItem("Params", sParams);
        $.ajax({
            type: "POST",
            dataType: "JSON",
            url: sessionStorage.getItem("BaseAddress")+  "/DUDeliveryLot/AdvSearchHWStock",
            data:  JSON.stringify(oExportLCReport),
            contentType: "application/json; charset=utf-8",
            success: function (data) {
                debugger;
                var  oDUDeliveryLots = data;
                if (oDUDeliveryLots != null) {
                    if(oDUDeliveryLots.length>0)
                    {
                        if(_nReportType==1)
                        {
                            DynamicRefreshList(oDUDeliveryLots, "tblLotView");
                            $.icsMakeFooterColumn('tblLotView',['LotNo','Qty_Batch','Qty_Warp','Qty_Weft','Qty_DC','Balance']);

                        }       
                        $("#winAdvSearchOrderTracker").icsWindow('close');
                    }
                    else
                    {
                        alert("Data not found!!");
                    }
                }
                $(".lblLoadingMessage").hide();
            },
            error: function (xhr, status, error) {
                alert(error);
            }
        });
    });

     //Search by OrderNo,LotNo
    $('#txtOrderNo').keydown(function (e)
    {
        var code = (e.keyCode ? e.keyCode : e.which);
        if (code== 13) {
            var txtByOrderNo = $.trim($('#txtOrderNo').val());
            if(txtByOrderNo!="")
            {
                //debugger;
                var oOrderNo={OrderNo:txtByOrderNo,LotNo:'',ReportType:1};
                SearchByOrderLotNo(oOrderNo);
            }else{
                alert("Type Order No and Press Enter.");
                return;
            }
        }

    });
    $('#txtLotNo').keydown(function (e)
    {
        var code = (e.keyCode ? e.keyCode : e.which);
        if (code== 13) {
            var txtByLotNo = $.trim($('#txtLotNo').val());
            if(txtByLotNo!="")
            {
                //debugger;
                var oLotNo={LotNo:txtByLotNo,OrderNo:'',ReportType:1};
                SearchByOrderLotNo(oLotNo);
            }else{
                alert("Type Lot No and Press Enter.");
                return;
            }
        }

    });

    function SearchByOrderLotNo(oLotOrder)
    {
        $.ajax({
            type: "POST",
            dataType: "JSON",
            url: sessionStorage.getItem("BaseAddress")+  "/DUDeliveryLot/SearchByOrderLotNo",
            data:  JSON.stringify(oLotOrder),
            contentType: "application/json; charset=utf-8",
            success: function (data) {
                debugger;
                var  oDUDeliveryLots = data;_nReportType=1
                if (oDUDeliveryLots != null) {
                    if(oDUDeliveryLots.length>0)
                    {
                        if(_nReportType==1)
                        {
                            DynamicRefreshList(oDUDeliveryLots, "tblLotView");
                            $.icsMakeFooterColumn('tblLotView',['LotNo','Qty_Batch','Qty_Warp','Qty_Weft','Qty_DC','Balance']);

                        }       
                        $("#winAdvSearchOrderTracker").icsWindow('close');
                    }
                    else
                    {
                        alert("Data not found!!");
                    }
                }
                $(".lblLoadingMessage").hide();
            },
            error: function (xhr, status, error) {
                alert(error);
            }
        });    

    }


    $('#btnPrintList').click(function(e){
        debugger;
        $(".lblLoadingMessage").show();
        var checkDate = CheckFromAndToDateValidation("cboDODate", "txtFromDODate", "txtToDODate");
        if (!checkDate) {
            alert("Start date must be greater than end date.");
            return false;
        }
        //QC Date
        var ncboDODate = parseInt($('#cboDODate').val());
        var dFromDODate   = $('#txtFromDODate').datebox('getValue');
        var dToDODate   = $('#txtToDODate').datebox('getValue');

        var nOrderType = parseInt($("#cboOrderTypeSearch").val());
        var nStockType = parseInt($("#cboStockType").val());

        var sLotNo=$("#txtLotNo").val();
        var sOrderNo=$("#txtOrderNo").val();
        var sParams =    ncboDODate + "~" +
                         dFromDODate + "~" +
                         dToDODate + "~" +
                         _sContractorIds + "~" +
                         _sPID + "~" +
                         nOrderType + "~" +
                         nStockType + "~" +
                         sLotNo+ "~" +
                         sOrderNo+ "~" +
                         _nBUID+'~'+_nReportType;

        //var oExportLCReport = {
        //    ErrorMessage : sParams,
        //    BUID : parseInt(sessionStorage.getItem("BUID")),
        //    ReportType : _nReportType
        //};
        sessionStorage.setItem("Params", sParams);
        var sTempString  = sParams;
        window.open(_sBaseAddress+"/DUDeliveryLot/DUHardWindingStockList?sValue="+sTempString);  
    });
    function LoadRS()
        {
        var oIRP= $('#tblProductView').datagrid('getSelected');
        if(oIRP==null)
        {
            alert("Please select a item from list!");
            return ;
        }
        DynamicRefreshList([], 'tblLots');
        GetsRS(oIRP);
        RefreshControl(oIRP)
    }
    function GetsRS(oIRP)
    {
        var obj = {
            BaseAddress: _sBaseAddress,
            Object: oIRP,
            ControllerName: "DUDeliveryLot",
            ActionName: "GetsRSs",
            IsWinClose: false
        };
        $.icsDataGets(obj, function (response) {
            debugger;
            if (response.status && response.objs.length > 0)
            {
                var oRSs= response.objs;
                DynamicRefreshList(oRSs, 'tblRSs');
            }
        });
    }
    function TabClick()
    {
        debugger;
        var tab = $('#tabReportDetail').tabs('getSelected');
        var index = $('#tabReportDetail').tabs('getTabIndex', tab);
        if (parseInt(index)==1)
        {
            LoadRS();
        }
    }

     /// print
    $('#btnPrintXL1').click(function()
    {
        debugger;
        _nReportType = 1;
        var sParams=sessionStorage.getItem("Params");
        if(sParams=="" || sParams == null)
        {
            alert("Please Enter The Searching Field !!");
            return;
        }
        window.open(_sBaseAddress + '/DUDeliveryLot/PrintRpt_Excel?sTempString=' + sParams + "&nReportType= " + _nReportType);
    });
    $('#btnPrintXL2').click(function()
    {
        debugger;
        _nReportType = 2;
        var sParams=sessionStorage.getItem("Params");
        if(sParams=="" || sParams == null)
        {
            alert("Please Enter The Searching Field !!");
            return;
        }
        window.open(_sBaseAddress + '/DUDeliveryLot/PrintRpt_Excel?sTempString=' + sParams + "&nReportType= " + _nReportType);
    });
    $('#btnPrintXL3').click(function()
    {
        debugger;
        _nReportType = 3;
        var sParams=sessionStorage.getItem("Params");
        if(sParams=="" || sParams == null)
        {
            alert("Please Enter The Searching Field !!");
            return;
        }
        window.open(_sBaseAddress + '/DUDeliveryLot/PrintRpt_Excel?sTempString=' + sParams + "&nReportType= " + _nReportType);
    });

    function FormatStyle(value){
        var values=value.split("~");
        var nRSCount = values[0];
        var nProductID = values[1];

        var s = '<label id="lblOpening~'+nProductID+'" style="color:Blue;cursor:pointer" class="lblOpening'+nProductID+'" onclick="ShowDetail('+nProductID+')">'+nRSCount+'</label>';
        return s;
    }
    function ShowDetail(nProductID)
    {
        var oRSA= $('#tblLotView').datagrid('getSelected');
        if(nProductID==null || nProductID<=0)
        {
            alert("Please select a item from list!");
            return;
        }
        var oRSAs= $('#tblLotView').datagrid('getRows');
        for (i = 0; i < oRSA.length; ++i)
        {
            if(oRSA[i].ProductID==nProductID)
            {
                oRSA=oRSA[i];
                break;
            }
        }
        var nIndex=$('#tblLotView').datagrid('getRowIndex',oRSA);
        sessionStorage.setItem("Operation", "Approve");
        sessionStorage.setItem("SelectedRowIndexLot", nIndex);
        sessionStorage.setItem("RouteSheetHeader", "Approve Production");
        sessionStorage.setItem("RouteSheetsApprove", JSON.stringify($('#tblLotView').datagrid('getRows')));
        sessionStorage.setItem("BackLinkLot", window.location.href);
        var tsv=((new Date()).getTime())/1000;
        window.location.href = _sBaseAddress+ "/DUDeliveryLot/View_DUDeliveryLot_Lot?nID="+oRSA.ProductID+"&ts="+tsv;
    }

     ////First Tab
    $('#btnView').click(function (e)
    {
        var oRouteSheet = $('#tblLotView').datagrid('getSelected');
        if (oRouteSheet ==null || oRouteSheet.RouteSheetID <=0 ) { alert("Please select an item from list."); return ; }
        var nIndex=$('#tblLotView').datagrid('getRowIndex',oRouteSheet);
        //sessionStorage.clear();
        sessionStorage.setItem("Operation", "View");
        sessionStorage.setItem("SelectedRowIndex", nIndex);
        sessionStorage.setItem("RouteSheetHeader", "View Production");
        sessionStorage.setItem("RouteSheets", JSON.stringify($('#tblLotView').datagrid('getRows')));
        sessionStorage.setItem("BackLink", window.location.href);
        var tsv=((new Date()).getTime())/1000;
        window.location.href = _sBaseAddress+ "/RouteSheet/ViewRouteSheet?nId="+oRouteSheet.RouteSheetID+"&ts="+tsv;;
    });

    $('#btnPrint').click(function (e)
    {
        var oRouteSheet = $('#tblLotView').datagrid('getSelected');
        if (oRouteSheet ==null || oRouteSheet.RouteSheetID <=0 ) { alert("Please select an item from list."); return ; }
        var tsv=((new Date()).getTime())/1000;
        window.open(_sBaseAddress+ "/RouteSheet/PrintRouteSheet?nId="+oRouteSheet.RouteSheetID+"&bIsCommon="+$("#chkIsCommon").is(":checked")+"&nts="+tsv, "_blank");

    });

    function RefreshSummary(nPeportType)
    {
        if(nPeportType==1)
        {
            var oRows = $('#tblLotView').datagrid('getRows');

        }
        else if(nPeportType==2)
        {
            var oRows = $('#tblProductView').datagrid('getRows');
        }
        else
        {
            var oRows = $('#tblBuyerView').datagrid('getRows');
        }
        if(oRows.length>0)
        {
            var nQty_DC = 0,nBalance=0;
            for(var i=0;i<oRows.length;i++)
            {
                nQty_DC = parseFloat(nQty_DC)+parseFloat(oRows[i].Qty_DC);
                nBalance = parseFloat(nBalance)+parseFloat(oRows[i].Balance);
            }

            nQty_DC = parseFloat(nQty_DC).toFixed(2);
            nBalance = parseFloat(nBalance).toFixed(2);

            if(nPeportType==1)
            {
                var oRow ={ Product : 'Total', Qty_DC:nQty_DC,  Balance:nBalance}
                $('#tblLotView').datagrid('appendRow',oRow);
            }
            else  if(nPeportType==2)
            {
                var oRow ={Product : 'Total',  Qty_DC:nQty_DC,Balance:nBalance }
                $('#tblProductView').datagrid('appendRow',oRow);
            }
            else
            {
                var oRow = {
                    Contractor : 'Total',  Qty_DC:nQty_DC, Balance:nBalance }
                $('#tblBuyerView').datagrid('appendRow',oRow);
            }
        }

    }
     //-------------Picker Code--------------------//
    $("#txtContractorAdvS").keydown(function (e) {
        if (e.keyCode === 13) // Enter Press
        {
            PickContractors_AdvS();
        }
        else if (e.keyCode === 08) {
            $("#txtContractorAdvS").removeClass("fontColorOfPickItem");
            _sContractorIds = '';
        }
    });

    $("#btnClrContractorAdvS").click(function () {
        $("#txtContractorAdvS").removeClass("fontColorOfPickItem");
        $("#txtContractorAdvS").val("");
        _sContractorIds = '';
    });

    $("#btnPickContractorAdvS").click(function () {
        PickContractors_AdvS();
    });
    function PickContractors_AdvS() {
        var oContractor = {
            Params: '2,3' + '~' + $.trim($("#txtContractorAdvS").val()+"~"+_nBUID)
        };
        var obj = {
            BaseAddress: _sBaseAddress,
            Object: oContractor,
            ControllerName: "Contractor",
            ActionName: "ContractorSearchByNameType",
            IsWinClose: false
        };

        $("#progressbar").progressbar({ value: 0 });
        $("#progressbarParent").show();
        var intervalID = setInterval(updateProgress, 250);

        DynamicRefreshList([], "tblAccountsPickerAdvSearch");
        $.icsDataGets(obj, function (response) {
            clearInterval(intervalID);
            $("#progressbarParent").hide();
            if (response.status && response.objs.length > 0) {
                if (response.objs[0].ContractorID > 0) {
                    var tblColums = []; var oColumn = { field: "ContractorID", title: "Code", width: 50, align: "left" }; tblColums.push(oColumn);
                    oColumn = { field: "Name", title: "Name", width: 280, align: "left" }; tblColums.push(oColumn);

                    var oPickerParam = {
                        winid: 'winContractorPicker',
                        winclass: 'clsAccountOf',
                        winwidth: 400,
                        winheight: 460,
                        tableid: 'tblAccountOfs',
                        tablecolumns: tblColums,
                        datalist: response.objs,
                        multiplereturn: true,
                        searchingbyfieldName: 'Name',
                        windowTittle: 'Contactor List'
                    };
                    $.icsPicker(oPickerParam);
                    IntializePickerbutton(oPickerParam);
                }
                else {
                    alert(response.objs[0].ErrorMessage);
                }
            }
            else {
                alert("Sorry, No Contactor Found.");
            }
        });
    }
    //End Account Of Picker


    //Start Product
    //Product Pick
    $("#txtProductName").keydown(function (e) {
        debugger;
        var code = (e.keyCode ? e.keyCode : e.which);
        if (code == 13) // Enter Press
        {
            if($('#txtProductName').val()==null || $('#txtProductName').val()=="")
            {
                alert("Please Type Product and Press Enter.");
                $('#txtProductName').focus();
                return;
            }
            PickProduct($('#txtProductName').val());
        }
        if (code == 8) //backspace=8
        {
            //debugger;
            $("#txtProductName").removeClass("fontColorOfPickItem");
            _sProductIds = "";
            _sPID = "";
        }
    });
    $("#btnProductPiker").click(function () {
        PickProduct("");
    });
    $("#btnClrProductPiker").click(function () {
        $("#txtProductName").val('');
        $("#txtProductName").removeClass("fontColorOfPickItem");
        _sProductIds= "";
        _sPID = "";
    });
    function PickProduct(sProductName)
    {
        var oProduct = { BUID:sessionStorage.getItem("BUID"),ProductName:sProductName};
        var obj = {
            BaseAddress: _sBaseAddress,
            Object: oProduct,
            ControllerName: "Product",
            ActionName: "SearchByProductBUWise",
            IsWinClose: false
        };
        $.icsDataGets(obj, function (response) {
            debugger;
            if (response.status && response.objs.length > 0) {
                if (response.objs[0].ProductID > 0) {
                    var tblColums = [];
                    var oColumn = { field: "ProductCode", title: "Code", width: 100, align: "left" }; tblColums.push(oColumn);
                    oColumn = { field: "ProductName", title: "Name", width: 300, align: "left" }; tblColums.push(oColumn);
                    oColumn = { field: "MUnit", title: "Unit", width: 70, align: "left" }; tblColums.push(oColumn);
                    var oPickerParam = {
                        winid: 'winProductPicker',
                        winclass: 'clsProductPicker',
                        winwidth: 600,
                        winheight: 460,
                        tableid: 'tblProductPicker',
                        tablecolumns: tblColums,
                        datalist: response.objs,
                        multiplereturn: true,
                        searchingbyfieldName: 'NameCode',
                        windowTittle: 'Product List'
                    };
                    $.icsPicker(oPickerParam);
                    IntializePickerbutton(oPickerParam);
                }
                else {
                    alert(response.objs[0].ErrorMessage);
                }

            }else{
                alert("Data Not Found.");
            }
        });
    }


    function IntializePickerbutton(oPickerobj) {
        $("#" + oPickerobj.winid).find("#btnOk").click(function () {
            SetPickerValueAssign(oPickerobj);
        });
        $(document).find('.' + oPickerobj.winclass).keydown(function (e) {
            if (e.which === 13) {
                SetPickerValueAssign(oPickerobj);
            }
        });
    }

    function SetPickerValueAssign(oPickerobj) {
        var oreturnObj = null, oreturnObjs = [];
        if (oPickerobj.multiplereturn) {
            oreturnObjs = $('#' + oPickerobj.tableid).datagrid('getChecked');
        } else {
            oreturnObj = $('#' + oPickerobj.tableid).datagrid('getSelected');
        }

        if (oPickerobj.winid == 'winContractorPicker')
        {
            if (oreturnObjs != null && oreturnObjs.length> 0)
            {

                _sContractorIds=''; var sMessage='';
                sMessage=(oreturnObjs.length>1)? oreturnObjs.length +" Contractors Selected" : oreturnObjs[0].Name;
                $('#txtContractorAdvS').val(sMessage);
                $("#txtContractorAdvS").addClass("fontColorOfPickItem");

                for(var i=0;i<oreturnObjs.length;i++){
                    _sContractorIds=_sContractorIds+oreturnObjs[i].ContractorID+',';
                }
                _sContractorIds=_sContractorIds.substring(0,_sContractorIds.length-1);

            }
            else
            {
                alert("Please select a contractor.");
                return false;
            }
        }
        else if (oPickerobj.winid == 'winProductPicker')
        {
            debugger;

            if (oreturnObjs!= null && oreturnObjs.length> 0)
            {
                _sProductIds=''; var sMessage='';
                sMessage=(oreturnObjs.length>1)? oreturnObjs.length +" ProductName Selected" : oreturnObjs[0].ProductName;
                $('#txtProductName').val(sMessage);
                $("#txtProductName").addClass("fontColorOfPickItem");

                for(var i=0;i<oreturnObjs.length;i++){
                    _sProductIds=_sProductIds+oreturnObjs[i].ProductID+',';
                }
                _sProductIds=_sProductIds.substring(0,_sProductIds.length-1);
                _sPID = _sProductIds;


            }
            else
            {
                alert("Please select a Product.");
                return false;
            }

        }

        $("#" + oPickerobj.winid).icsWindow("close");
        $("#" + oPickerobj.winid).remove();
    }


        //DU Lot Distribution
    function RefreshDULotDistribution(){
        $("#txtLotNo").val('');
        $("#txtOrderNo").val('');
        $("#txtBalance").val('');
        $("#txtQty").val('');
        $("#txtOrderPick").val('');
    }
    $("#btnDULotDistribution").click(function(){
        debugger;
        RefreshDULotDistribution();
        var oDULotDistribution = $('#tblLotView').datagrid('getSelected');

        if(oDULotDistribution==null || oDULotDistribution.LotID<=0)
        {
            alert("Please select a item from list!");
            return;
        }  
        //$('MktPersonName').data('MktPersonName', oMktSaleTarget.Name+", Group Name"+oMktSaleTarget.GroupName);
        $('#tblLotView').data('LotView', oDULotDistribution);
        var oDULotDistribution={
            LotID : parseInt(oDULotDistribution.LotID),
            DODID : parseInt(oDULotDistribution.DODID),
            LotNo : oDULotDistribution.LotNo,
            OrderNo : oDULotDistribution.OrderNo,
            Balance : oDULotDistribution.Balance

        }
        $.ajax({
            type: "POST",
            dataType: "json",
            url :  _sBaseAddress+ "/DUDeliveryLot/GetAllDULotDistribution",
            traditional: true,
            data:  JSON.stringify(oDULotDistribution),
            contentType: "application/json; charset=utf-8",
            success: function (data)
            {
                debugger;
                var _DULotDistributions = jQuery.parseJSON(data);
                if (_DULotDistributions.length>0)
                {
                    RefreshDULotDistribution();
                    $("#txtDULotNo").val($('#tblLotView').data('LotView').LotNo);
                    $("#txtDUOrderNo").val($('#tblLotView').data('LotView').OrderNo);
                    $("#txtDUBalance").val($('#tblLotView').data('LotView').Balance);
                    DynamicRefreshList(_DULotDistributions,'tblDULotDistribution');   
                   
                }
                else
                {
                    $("#txtDULotNo").val($('#tblLotView').data('LotView').LotNo);
                    $("#txtDUOrderNo").val($('#tblLotView').data('LotView').OrderNo);
                    $("#txtDUBalance").val($('#tblLotView').data('LotView').Balance);
                    DynamicRefreshList([],'tblDULotDistribution');
                    //alert(_oMktSaleTarget.ErrorMessage);
                }
            },
            error: function (xhr, status, error) {
                alert(error);
            }
        });       
        $("#winDULotDistribution").icsWindow('open','Add Lot Distribution');
    });

    $("#btnDULotDistributionClose").click(function(){
        $("#winDULotDistribution").icsWindow('close');
    });

    $("#txtOrderPick").keydown(function (e) {
        debugger;
        var nkeyCode = e.keyCode || e.which;
        if(nkeyCode==13){
            var Qty = parseFloat(TempRemoveComma($('#txtDUQty').val()));
            var Balance = parseFloat($('#tblLotView').data('LotView').Balance);
            if(Qty<=0){
                alert("Qty Required!");return;
            }
            var sOrderNo=$.trim($("#txtOrderPick").val());
         
            if(sOrderNo=="" || sOrderNo==null)
            {
                alert("Please Type No or part of No");
                $('#txtOrderPick').focus();
                $('#txtOrderPick').removeClass("errorFieldBorder");
                return;
            }
            var oDyeingOrder= {
                OrderNo :sOrderNo,
                ExportPINo:'',
                ExportLCNo:'',
                DyeingOrderType: parseInt($('#tblLotView').data('LotView').OrderType)
            };
            GetsOrders(oDyeingOrder);
        }
        else if(nkeyCode==8){
            $("#txtOrderPick").val("");

        }
    });
    function GetsOrders(oDyeingOrder)
    {     
        var obj = {
            BaseAddress: _sBaseAddress,
            Object: oDyeingOrder,
            ControllerName: "DULotDistribution",
            ActionName: "GetbyNo",
            IsWinClose: false
        };
        $("#progressbar").progressbar({ value: 0 });
        $("#progressbarParent").show();
        var intervalID = setInterval(updateProgress, 250);
        $.icsDataGets(obj, function (response) {
            clearInterval(intervalID);
            $("#progressbarParent").hide();
            if (response.status && response.objs.length > 0) {
                if (response.objs[0].DyeingOrderDetailID > 0) {
                    debugger;
                    var tblColums = [];
                    var ncboOrderType=parseInt($("#cboOrderType").val());
                    var oColumn = { field: "OrderNo", title: "OrderNo", width: 100, align: "left" };tblColums.push(oColumn);
                    oColumn = { field: "Qty", title: "OrderQty", width: 75, align: "right",formatter:formatPrice };tblColums.push(oColumn);
                    oColumn = { field: "Qty_Pro", title: "Prod Qty", width: 75, align: "right",formatter:formatPrice };tblColums.push(oColumn);
                    oColumn = { field: "Qty_RS", title: "Yet To Pro", width: 75, align: "right" };tblColums.push(oColumn);
                    oColumn = { field: "ProductName", title: "Yarn", width: 225, align: "left" };tblColums.push(oColumn);
                    oColumn = { field: "ColorName", title: "ColorName", width: 100, align: "left" };tblColums.push(oColumn);
                    oColumn = { field: "ShadeSt", title: "Shade", width: 40, align: "left" };tblColums.push(oColumn);
                    oColumn = { field: "ColorNo", title: "ColorNo", width: 80, align: "left" };tblColums.push(oColumn);
                    oColumn = { field: "LabdipNo", title: "LabdipNo", width: 100, align: "left" };tblColums.push(oColumn);
                   
                    
                    var oPickerParam = {
                        winid: 'winOrderPicker',
                        winclass:'clsOrderPicker',
                        winwidth: 1000,
                        winheight: 660,
                        tableid: 'tblOrderPicker',
                        tablecolumns: tblColums,
                        datalist: response.objs,
                        multiplereturn: false,
                        searchingbyfieldName:'OrderNo',
                        windowTittle: 'Order List'
                    };
                    $.icsPicker(oPickerParam);
                    IntializePickerbutton(oPickerParam);//multiplereturn, winclassName
                }
                else { alert(response.objs[0].ErrorMessage); }
            }
            else{
                alert("No order found.");
            }
        });
    }
    function IntializePickerbutton(oPickerobj) {
        $("#" + oPickerobj.winid).find("#btnOk").click(function () {
            //for Single Select
            SetPickerValueAssign(oPickerobj);
        });
        $(document).find('.' + oPickerobj.winclass).keydown(function (e) {
            if (e.which == 13)//enter=13
            {
                SetPickerValueAssign(oPickerobj);

            }
        });
    }

    function ValidateInput()
    {
        var Qty = parseFloat($('#txtDUQty').val());
        var Balance = parseInt($('#tblLotView').data('LotView').Balance);
        if(Balance<Qty)
        {
            alert("Qty Must Less Then Balance!");
            return false;
        }     
        return true;
    }
    function SetPickerValueAssign(oPickerobj) {
        debugger;
        var oreturnObj = null, oreturnobjs = [];
        if (oPickerobj.multiplereturn) {
            oreturnobjs = $('#' + oPickerobj.tableid).datagrid('getChecked');
        } else {
            oreturnObj = $('#' + oPickerobj.tableid).datagrid('getSelected');
        }
        $("#" + oPickerobj.winid).icsWindow("close");
        $("#" + oPickerobj.winid).remove();


        if (oPickerobj.winid == 'winOrderPicker')
        {
            if (oreturnObj != null && oreturnObj.DyeingOrderDetailID > 0)
            {
                $('#txtOrderNoPick').val(oreturnObj.ProductName+","+oreturnObj.ColorNameShade);
                _nDODID_Source=oreturnObj.DyeingOrderDetailID;
                var oPTUDistribution={DODID:_nDODID_Source ,LotNo:''};
                ///////
                debugger;
                if(!ValidateInput()) {return;}
                var oDULotDistribution =
                    {
                        DULotDistribution :0,
                        DODID :parseInt($('#tblLotView').data('LotView').DODID),  
                        DODID_Dest : parseInt(oreturnObj.DyeingOrderDetailID),                
                        LotID : parseInt($('#tblLotView').data('LotView').LotID),
                        Qty :  parseFloat(TempRemoveComma($('#txtDUQty').val())),
                        IsReceive : 1     
                    }
                debugger;
                $.ajax({
                    type: "POST",
                    dataType: "json",
                    url :  _sBaseAddress+ "/DULotDistribution/Save_Transfer",
                    traditional: true,
                    data:  JSON.stringify(oDULotDistribution),
                    contentType: "application/json; charset=utf-8",
                    success: function (data)
                    {
                        debugger;
                        oDULotDistribution = jQuery.parseJSON(data);
                        if (oDULotDistribution.ErrorMessage=="" || oDULotDistribution.ErrorMessage==null)
                        {
                            alert("Data Saved sucessfully");                            
                            $('#tblDULotDistribution').datagrid('appendRow',oDULotDistribution);
                            var oData = $('#tblDULotDistribution').datagrid('getRows');
                            $('#tblDULotDistribution').datagrid('selectRow',oData.length-1);
                            $('#txtDUQty').val('');
                        }
                        else
                        {
                            alert(oDULotDistribution.ErrorMessage);
                            $('#txtDUQty').val('');
                        }
                    },
                    error: function (xhr, status, error) {
                        alert(error);
                    }

                });
                //////
            }
            else{
                alert("Data Not Found.");
                return;
            }
        }
    }

    //REMOVE COMMA
    function TempRemoveComma(userInput) {
        //debugger;
        var amountInString = "";
        if (userInput === null || userInput === "") {
            amountInString = "0.00";
        }
        else {
            amountInString = "";
            for (var i = 0; i < userInput.length; i++) {
                var char = userInput.charAt(i);
                var charForCheck = char;
                char = char.match(/\d+/g);
                if (char != null) {
                    amountInString = amountInString + userInput.charAt(i);
                    count = 1;
                }
                else if (charForCheck == ",") {
                    continue;
                }
                else if (charForCheck == ".") {
                    amountInString = amountInString + userInput.charAt(i);
                }
            }
        }
        //debugger;
        return (isNaN(parseFloat(amountInString)) ? parseFloat(0.00) : parseFloat(amountInString)).toFixed(3);
    }

    function TempAddComma(nStr) {
        nStr += '';
        x = nStr.split('.');
        x1 = x[0];
        x2 = x.length > 1 ? '.' + x[1] : '';
        var process = /(\d+)(\d{3})/;
        while (process.test(x1)) {
            x1 = x1.replace(process, '$1' + ',' + '$2');
        }
        return x1 + x2;
    }   
    </script>


