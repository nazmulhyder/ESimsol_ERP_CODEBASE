<!DOCTYPE html />
<html>
<head>
    <title>Block Machine Mapping</title>
    <script src="@Url.Content("~/Scripts/jquery-1.7.1.min.js")" type="text/javascript"></script>
    <script src="@Url.Content("~/Scripts/jquery-latest.js")" type="text/javascript"></script>
    <link href="../../Content/CSS/newPikerview.css" rel="stylesheet" type="text/css" />
    <script src="@Url.Content("~/Scripts/jquery-ui-1.8.22.custom.min.js")" type="text/javascript"></script>
    <script src="@Url.Content("~/Scripts/UserControlScript/GlobalScript.js")" type="text/javascript"></script>
    <link href="@Url.Content("~/Content/CSS/jquery-ui-1.8.22.custom.css")" rel="stylesheet" type="text/css" />
    <script src="@Url.Content("~/Scripts/jquery.unobtrusive-ajax.js")" type="text/javascript"></script>
    @* Following Reference For menu *@
    <link href="@Url.Content("~/Content/CSS/easyui.css")" rel="stylesheet" type="text/css" />
    <link href="@Url.Content("~/Content/CSS/icon.css")" rel="stylesheet" type="text/css" />
    <script src="@Url.Content("~/Scripts/jquery.easyui.min.js")" type="text/javascript"></script>
    @*Datetime format piker*@
    <script src="@Url.Content("~/Scripts/Date-Format-1.2.3.js")" type="text/javascript"></script>
    <script src="@Url.Content("~/Scripts/jquery.json.js")" type="text/javascript"></script>
    @*for json stringify *@
    <script src="@Url.Content("~/Scripts/jquery-ui.min.js")" type="text/javascript"></script>
    <script src="@Url.Content("~/Scripts/json2.js")" type="text/javascript"></script>
</head>
<body>
    @model ESimSol.BusinessObjects.BlockMachineMapping
    <div style="font-family: Tahoma">
        <table border="0" cellspacing="0" cellpadding="0">
            <tr>
                <td style="background-color: #cfb53b; text-align: center; width: 700px; color: White">
                    <label id="lblHeaderName" style="font-size: 17px; font-weight: bold; text-decoration: Underline">
                       Block Machine Mapping</label>
                </td>
            </tr>
          
        </table>
        <fieldset>
            <legend style="font-weight: bold">Block Machine Mapping</legend>@* table1 start*@
            <table border="0" cellspacing="2" cellpadding="2" style="font-size: 11px; font-weight: bold;">
                <tr>
                    <td style="width: 130px; text-align: right;">
                        Production Process :
                    </td>
                    <td>
                        @Html.DropDownListFor(model => model.ProductionProcess, new SelectList(Enum.GetValues(typeof(ESimSol.BusinessObjects.EnumProductionProcess))), new { id = "cboProductionProcess", style = "width: 310px;" })

                    </td>
                </tr>
                <tr>
                    <td style="width: 130px; text-align: right;">
                        Department :
                    </td>
                    <td>
                    <input  id="txtDepartment" type="text" style="width:275px;" disabled="disabled" />
                    <input id="btnDepartment" type="button" onclick="DepartmentPicker()" value="P"/>
                    </td>
                 
                </tr>
                <tr>
                    <td style="width: 130px; text-align: right;">
                        Block Name :
                    </td>
                    <td>
                        <input id="txtBlockName" type="text" style="width: 310px;" />
                    </td>
                  
                </tr>
                <tr>
                    <td colspan="2" style="text-align:right;">
                        <a id="btnSave" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-save" plain="true">Save</a>
                    </td>

                </tr>
                </table>
            <table border="0" cellspacing="2" cellpadding="2" style="font-size: 11px; font-weight: bold;">
                <tr>
                    <td style="width: 130px; text-align: right;">
                        Machine Number :
                    </td>
                    <td>
                        <input id="txtMachineNumber" type="text" style="width:100px;" />
                        <a id="btnDetailAdd" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-save" plain="true">Add</a>
                        <a id="btnDetailRemove" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-remove" plain="true">Remove</a>
                        <a id="btnDetailActivity" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-ok" plain="true" onclick="Activity()">Activity</a>
                    </td>

                </tr>
                <tr>
                    <td style="width: 130px; text-align: right;">
                        
                    </td>
                    <td  style="text-align:right;">
                        @*grid start*@
                        <table  id="tblBlockMachineMappingDetail" class="easyui-datagrid" style="width: 320px; height: 150px;
                            font-size: 11px;" fitcolumns="false" rownumbers="false" pagination="false" singleselect="true"
                               autorowheight="true">
                            <thead>
                                <tr>

                                    <th field="MachineNo" width="180" align="left">
                                        Machine No
                                    </th>
                                    <th field="ActivityStatus" width="120" align="left">
                                        Activity
                                    </th>
                                </tr>
                            </thead>
                        </table>
                        @*grid end*@
                    </td>

                </tr>
            </table>

            <table border="0" cellspacing="2" cellpadding="2" style="font-size: 11px; font-weight: bold;">
                <tr>
                   
                    <td style="width: 50px;">
                    
                    </td>
                    <td style="width: 400px; text-align: right;">
                        <a id="btnCancel" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-cancel" plain="true">Close</a>
                    </td>
                </tr>
            </table>
            @* table1 end*@
            
        </fieldset>
    </div>
</body>
</html>

<script type="text/javascript">
var _oBlockMachineMapping=null;
var _sBaseAddress="";
var _obj=null;
var _nDepartmentID = 0;

$(document).ready(function ()
{
    _sBaseAddress =@Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(HttpContext.Current.Session[SessionInfo.BaseAddress]));  
    _oBlockMachineMapping =@Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(Model)); 
    _obj = window.dialogArguments;
    document.getElementById("lblHeaderName").innerHTML = _obj.Name;
    
    if(_obj.Name == "Edit Block Machine Mapping")
    {
        RefreshControl();
        DetailRefresList(_oBlockMachineMapping.BlockMachineMappingDetails);
    }
    
    if(_oBlockMachineMapping.BMMID<=0)
    {
        document.getElementById("btnDetailAdd").style.display='none';
        document.getElementById("btnDetailRemove").style.display='none';
        document.getElementById("btnDetailActivity").style.display='none';
    }
    else
    {
        document.getElementById("btnDetailAdd").style.display='';
        document.getElementById("btnDetailRemove").style.display='';
        document.getElementById("btnDetailActivity").style.display='';
    }
  
});

function DetailRefresList(data)
{
    data={"total":""+data.length+"","rows":data};
    $('#tblBlockMachineMappingDetail').datagrid('loadData',data);
}

function RefreshControl()
{

    document.getElementById("cboProductionProcess").SelectedIndex = _oBlockMachineMapping.ProductionProcess;
    document.getElementById("txtDepartment").value = _oBlockMachineMapping.DepartmentName;
    document.getElementById("txtBlockName").value = _oBlockMachineMapping.BlockName;
    _nDepartmentID = _oBlockMachineMapping.DepartmentID;

}

function DepartmentPicker() 
{
        
    var oParameter = new Object();
    oParameter.MultipleItemReturn = false;
    var url = _sBaseAddress + "/Department/DepartmentPickerWithCheckBox?id=0";
    var oReturnObject = window.showModalDialog(url, oParameter, 'dialogHeight:470px;dialogWidth:550px;dialogLeft:400;dialogTop:100;center:yes;resizable:no;status:no;scroll:no');
    if (oReturnObject != null) 
    {
        $("#txtDepartment")[0].value = oReturnObject.text;
        _nDepartmentID= oReturnObject.id;
    }
}

function ValidateInput() 
{

    if(document.getElementById("cboProductionProcess").selectedIndex == 0)
    {
        alert("Please Select Production Process !");
        $("#cboProductionProcess").focus();
        return false;
    }

    if(_nDepartmentID == 0)
    {
        alert("Please enter Department");
        $("#txtDepartment").focus();
        return false;
    }

    if(document.getElementById("txtBlockName").value== "")
    {
        alert("Please enter block name!");
        $("#txtBlockName").focus();
        return false;
    }
    
    return true;
}

function RefreshObject() 
{

    var oBlockMachineMapping=
    {
        BMMID : _oBlockMachineMapping.BMMID,
        ProductionProcessInt : document.getElementById("cboProductionProcess").selectedIndex,
        DepartmentID : _nDepartmentID,
        BlockName : document.getElementById("txtBlockName").value,
        
    }
    return oBlockMachineMapping;
}

$('#btnSave').click(function (e) 
{
    
    if (!ValidateInput()) return;
    var oBlockMachineMapping = RefreshObject();
    $.ajax({
            type: "POST",
            dataType: "json",
            url: _sBaseAddress + "/BlockMachineMapping/BlockMachineMapping_IU",
            traditional: true,
            data: JSON.stringify(oBlockMachineMapping),
            contentType: "application/json; charset=utf-8",

            success: function(data)
            {
                _oBlockMachineMapping = jQuery.parseJSON(data);
                if (_oBlockMachineMapping.ErrorMessage == "" && _oBlockMachineMapping.BMMID>0) 
                {
                    alert("Data Saved sucessfully");
                    window.returnValue = _oBlockMachineMapping;
                    document.getElementById("btnDetailAdd").style.display='';
                    document.getElementById("btnDetailRemove").style.display='';
                    document.getElementById("btnDetailActivity").style.display='';
                   
                } 
                else 
                {
                    alert(_oBlockMachineMapping.ErrorMessage);
                }
             },
             error: function(xhr, status, error)
             {
                alert(error);
             }
          });
});

function DetailRefreshObject() 
{
   
    var oBlockMachineMappingDetail=
    {
        BMMDID :0,
        BMMID : _oBlockMachineMapping.BMMID,
        MachineNo :document.getElementById("txtMachineNumber").value
        
    }
    return oBlockMachineMappingDetail;
}

$('#btnDetailAdd').click(function (e) 
{
    
    if(document.getElementById("txtMachineNumber").value== "")
    {
        alert("Please enter machine number!");
        $("#txtMachineNumber").focus();
        return false;
    }
   
    var oBlockMachineMappingDetail = DetailRefreshObject();
    $.ajax({
        type: "POST",
        dataType: "json",
        url: _sBaseAddress + "/BlockMachineMapping/BlockMachineMappingDetail_IU",
        traditional: true,
        data: JSON.stringify(oBlockMachineMappingDetail),
        contentType: "application/json; charset=utf-8",
        
        success: function(data)
        {
            var oBlockMachineMappingDetail = jQuery.parseJSON(data);
            if (oBlockMachineMappingDetail.BMMDID >0) 
            {
                alert("Data Saved sucessfully");
                var oBlockMachineMappingDetails = $('#tblBlockMachineMappingDetail').datagrid('getRows');
                var nIndex = oBlockMachineMappingDetails.length;
                $('#tblBlockMachineMappingDetail').datagrid('appendRow', oBlockMachineMappingDetail);
                $('#tblBlockMachineMappingDetail').datagrid('selectRow', nIndex);
            } 
            else 
            {
                alert(oBlockMachineMappingDetail.ErrorMessage);
            }
        },
        error: function(xhr, status, error)
        {
            alert(error);
        }
    });
});

$('#btnDetailRemove').click(function (e)
{
    
    var oBlockMachineMappingDetail = $('#tblBlockMachineMappingDetail').datagrid('getSelected');
    if (oBlockMachineMappingDetail == null || oBlockMachineMappingDetail.BMMDID <= 0)
    {
        alert("Please select an item from the list!");
        return false;
    }
   
    if (!confirm("Confirm to Delete?")) return;
    var SelectedRowIndex = $('#tblBlockMachineMappingDetail').datagrid('getRowIndex', oBlockMachineMappingDetail);
    var tsv = ((new Date()).getTime()) / 1000;
    if (oBlockMachineMappingDetail.BMMDID > 0)
    {
        $.ajax({
            type: "GET",
            dataType: "json",
            url: _sBaseAddress + "/BlockMachineMapping/BlockMachineMappingDetail_Delete",
            data: { nId: oBlockMachineMappingDetail.BMMDID,ts: tsv },
            contentType: "application/json; charset=utf-8",
            success: function(data) 
            {
                var feedbackmessage = jQuery.parseJSON(data);
                if (feedbackmessage == "")
                {
                    $('#tblBlockMachineMappingDetail').datagrid('deleteRow', SelectedRowIndex);
                } 
                else 
                {
                    alert(feedbackmessage);
                }
            },
            error: function(xhr, status, error)
            {
                alert(error);
            }
        });
    }    

});

function Activity()
{
    //debugger;
    var Act="";
    var oBlockMachineMappingDetail = $('#tblBlockMachineMappingDetail').datagrid('getSelected');
    if (oBlockMachineMappingDetail == null || oBlockMachineMappingDetail.BMMDID <= 0)
    {
        alert("Please select an item from list!");
        return;
    }
    if(oBlockMachineMappingDetail.IsActive==false)
    {
        Act=true;
         
    }
    if(oBlockMachineMappingDetail.IsActive==true)
    {
        Act=false;
         
    }
    oBlockMachineMappingDetail.IsActive=Act;

    var SelectedRowIndex = $('#tblBlockMachineMappingDetail').datagrid('getRowIndex', oBlockMachineMappingDetail);
    $.ajax({
        type: "POST",
        dataType: "json",
        url: _sBaseAddress + "/BlockMachineMapping/BlockMachineMappingDetail_Activity",
        traditional: true,
        data: JSON.stringify(oBlockMachineMappingDetail),
        contentType: "application/json; charset=utf-8",

        success: function(data) {
            debugger;
            oBlockMachineMappingDetail = jQuery.parseJSON(data);
            if (oBlockMachineMappingDetail.BMMDID > 0)
            {
                
                if(oBlockMachineMappingDetail.IsActive==true)
                {
                    msg="Activated";
                }
                if(oBlockMachineMappingDetail.IsActive==false)
                {
                    msg="InActivated";
                }
                alert(msg+" Successfully!");
                $('#tblBlockMachineMappingDetail').datagrid('updateRow', { index: SelectedRowIndex, row: oBlockMachineMappingDetail });
            
            } 
            else
            {
                alert(oBlockMachineMappingDetail.ErrorMessage);
            }
        }
         
    });

}

$('#btnCancel').click(function (e) 
{
    window.close();
});
$(document).keydown(function (e)
{
    var keyCode = e.keyCode || e.which;
    if (keyCode == 27)
    {
        window.close();
    }
});
</script>