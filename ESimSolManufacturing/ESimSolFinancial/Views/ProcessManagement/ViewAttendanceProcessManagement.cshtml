<html>
<head>
    <title>Daily Attendance</title>
    <link href="@Url.Content("~/Content/CSS/icon.css")" rel="stylesheet" type="text/css" />
    <link href="@Url.Content("~/Content/CSS/easyui.css")" rel="stylesheet" type="text/css" />
    <link href="@Url.Content("~/Content/CSS/Pikerstyle.css")" rel="stylesheet" type="text/css" />
    <script src="@Url.Content("~/Scripts/jquery-1.7.1.min.js")" type="text/javascript"></script>
    <script src="@Url.Content("~/Scripts/jquery.ics.customize.js")" type="text/javascript"></script>
    <script src="@Url.Content("~/Scripts/jquery.easyui.min.js")" type="text/javascript"></script>
    <script src="@Url.Content("~/Scripts/jquery-ui.min.js")" type="text/javascript"></script>
    <script src="@Url.Content("~/Scripts/json2.js")" type="text/javascript"></script>
</head>
<body>
    @model ESimSol.BusinessObjects.AttendanceProcessManagement
    <div style="font-family: Tahoma">
        <table border="0" cellspacing="2" cellpadding="2">
            <tr>
                <td style="background-color: #cfb53b; text-align: center; width: 300px; color: White">
                    <label id="lblHeaderName" style="font-size: 15px; font-weight: bold; text-decoration: Underline">
                        Daily Attendance
                    </label>
                </td>
            </tr>
        </table>
        <fieldset>
            <legend style="font-weight: bold">Daily Attendance Information : </legend>
            <table border="0" cellspacing="2" cellpadding="2" style="font-size: 11px; font-weight: bold">
                <tr>
                    <td style="width: 100px; text-align: right">
                        Location :
                    </td>
                    <td style="width: 180px">
                        <select id="cboLocation" style="width:180px;"></select>
                        @*<input type="text" style="width: 133px;" id="txtLocation" disabled="disabled" />
                            <input type="hidden" id="txtLocationID"/>
                            <input type="button" value="Pick" style="width: 40px;" onclick="LocationPicker()" />*@
                    </td>
                </tr>
                @*                <tr>
                        <td style="width: 100px; text-align: right">
                            Department :
                        </td>
                        <td style="width: 180px;">
                            <input type="text" style="width: 133px;" id="txtDepartment" disabled="disabled" />
                            <input type="hidden" id="txtDepartmentID"/>
                            <input type="button" value="Pick" style="width: 40px;" onclick="DepartmentPicker()"/>
                        </td>
                    </tr>*@
                <tr>
                    <td style="width: 100px; text-align: right">
                        Shift :
                    </td>
                    <td style="width: 180px">
                        <select id="cboShift" style="width:180px;"></select>

                    </td>
                </tr>
                <tr>
                    <td style="width: 100px; text-align: right">
                        Process Type :
                    </td>
                    <td style="width: 180px">
                        @Html.DropDownListFor(model => model.ProcessType, new SelectList(Enum.GetValues(typeof(ESimSol.BusinessObjects.EnumProcessType))), new { id = "cboProcesType", style = "width: 180px;" })
                    </td>
                </tr>
                <tr>
                    <td style="width: 100px; text-align: right">
                        Date :
                    </td>
                    <td>
                        <input id="txtDate" type="text" style="width: 180px" class="easyui-datebox"
                               required="required" data-options="formatter:icsdateformat,parser:icsdateparser" />
                    </td>
                </tr>
            </table>
        </fieldset>
        <fieldset>
            <legend style="font-weight: bold">Action : </legend>
            <table border="0" cellspacing="2" cellpadding="2" style="font-size: 11px; font-weight: bold">
                <tr>

                    <td style="width: 230px"></td>
                    <td style="width: 50px">
                        <a id="btnProcess" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-save" plain="true"
                           onclick="Process()">Process</a>
                    </td>
                </tr>
            </table>
        </fieldset>
    </div>
</body>
</html>
<script type="text/javascript">
    var _oAttendanceProcessManagement = null;
    var _sBaseAddress = "";
    var _oShifts=[];
    $(document).ready(function() {
        _sBaseAddress = @Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(HttpContext.Current.Session[SessionInfo.BaseAddress]));
        _oAttendanceProcessManagement = @Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(Model));
        _oShifts = @Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(Model.Shifts));
        var obj = window.dialogArguments;
        document.getElementById('lblHeaderName').innerHTML = obj.Name;
        $('#txtDate').datebox('setValue', _oAttendanceProcessManagement.AttendanceDateInString);
        LoadShift(_oShifts) ;
        LoadLocation();
        document.getElementById('cboLocation').value = 2;
        document.getElementById('cboShift').value = 1;
        document.getElementById("cboProcesType").selectedIndex = 1;
    });

    function LoadLocation()
    {
        var listItems="";
        listItems += "<option value=0>" +"None" +"</option>";
        for (i = 0; i < _oAttendanceProcessManagement.Locations.length; i++)
        {
            listItems += "<option value='" + _oAttendanceProcessManagement.Locations[i].LocationID+"'>" + _oAttendanceProcessManagement.Locations[i].Name+"</option>";
        }
        $("#cboLocation").html(listItems);
    }

    function LoadShift(_oShifts)
    {
        debugger;
        $('#cboShift').empty();
        var listItems = "";
        listItems += "<option value='0'> --Select Shift-- </option>";
        for (var i = 0; i < _oShifts.length; i++)
        {

            listItems += "<option value='" + _oShifts[i].ShiftID + "'>" + _oShifts[i].Name + "</option>";

        }
        $("#cboShift").html(listItems);
    }

    function  icsdateformat(date)
    {
        var mthNames = ["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];
        var y = date.getFullYear();
        var m = date.getMonth();
        var d = date.getDate();
        var result= d +' '+ mthNames[m]+' '+ y;
        return result;
    }

    function ValidateInput()
    {
        //
        return true;
    }

    function RefreshObject()
    {
        debugger;

        var sDate=new Date($('#txtDate').datebox('getValue'));
        var oAttendanceProcessManagement =
        {
            APMID :_oAttendanceProcessManagement.APMID,
            LocationID:document.getElementById('cboLocation').value,
            DepartmentID:0,//$("#txtDepartmentID").val(),
            ShiftID:document.getElementById("cboShift").selectedIndex,
            ProcessTypeInt:document.getElementById("cboProcesType").selectedIndex,
            StatusInt:1,//Process
            AttendanceDate:sDate

        };

        return oAttendanceProcessManagement;
    }

    function Process()
    {
        debugger;

        if (!ValidateInput()) return;
        var oAttendanceProcessManagement = RefreshObject();
        document.getElementById('btnProcess').style.display='none';
        $.ajax({
            type: "POST",
            dataType: "json",
            url: _sBaseAddress + "/ProcessManagement/AttendanceProcessManagement_IU",
            traditional: true,
            data: JSON.stringify(oAttendanceProcessManagement),
            contentType: "application/json; charset=utf-8",

            success: function(data)
            {
                //debugger
                oAttendanceProcessManagement = jQuery.parseJSON(data);
                if (oAttendanceProcessManagement.APMID > 0)
                {
                    document.getElementById('btnProcess').style.display='';
                    alert("Data Saved sucessfully");
                    window.returnValue = oAttendanceProcessManagement;
                    window.close();
                }
                else
                {
                    alert(oAttendanceProcessManagement.ErrorMessage);
                    document.getElementById('btnProcess').style.display='';
                }
            },
            error: function(xhr, status, error)
            {
                alert(error);
            }
        });


    }

    function LocationPicker()
    {
        var oParameter = new Object();
        oParameter.MultipleItemReturn = false;
        var url = _sBaseAddress + "/Location/LocationPickerWithCheckBox?id=0";
        var oReturnObject = window.showModalDialog(url, oParameter, 'dialogHeight:470px;dialogWidth:550px;dialogLeft:400;dialogTop:100;center:yes;resizable:no;status:no;scroll:no');

        $("#txtLocation")[0].value=oReturnObject.text;
        $("#txtLocationID")[0].value=oReturnObject.id;

    }
    function DepartmentPicker()
    {
        //debugger;
        var oParameter = new Object();
        oParameter.MultipleItemReturn = false;
        var url = _sBaseAddress + "/Department/DepartmentPickerWithCheckBox?id=0";
        var oReturnObject = window.showModalDialog(url, oParameter, 'dialogHeight:470px;dialogWidth:550px;dialogLeft:400;dialogTop:100;center:yes;resizable:no;status:no;scroll:no');
        $("#txtDepartment")[0].value = oReturnObject.text;
        $("#txtDepartmentID")[0].value = oReturnObject.id;
    }

    function Close()
    {
        window.close();
    }
    function ClearLate()
    {
        document.getElementById("txtLate").value="";
    }
    function ClearEarly()
    {
        document.getElementById("txtEarlyLeaving").value="";
    }
    function ClearOver()
    {
        document.getElementById("txtOverTime").value="";
    }
</script>
