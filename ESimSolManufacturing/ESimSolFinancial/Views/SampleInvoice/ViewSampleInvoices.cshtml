@model IEnumerable<ESimSol.BusinessObjects.SampleInvoice>
@{
    ViewBag.Title = "ViewSampleInvoices";
}
  <head>
    <title>Sample Invoice</title>
   </head>
 <body>
    <div id="progressbarParent" style="width:100%;height:100%;margin:0 auto;text-align:center; margin-left: auto;margin-right: auto;left: 0;right: 0;z-index: 1;">
        <div style="margin: 0px auto;margin-top: 251px;text-align:center;width:390px;">
            <label style="font-size:18px;">Please wait</label>
            <div id="progressbar" style="width:100%;height:37px;"></div>
        </div>
    </div>
    <div id="winSampleInvoiceInfo" class="easyui-window" title="Update Sample Invoice Info" data-options="modal:true,closed:true,collapsible:false,minimizable:false,maximizable:false,closable:false">
          <table border="0" cellpadding="1" cellspacing="1" style="width:99%">
              <tr>
                  <td style="width:50%;text-align:right;">Payment Type:</td>
                  <td style="width:50%">
                      <select id="cboPaymentType" style="width:100%;"></select>
                  </td>
              </tr>
              <tr>
                  <td style="width:50%;text-align:right;">Conversion Rate:</td>
                  <td style="width:50%">
                      <input id="txtConversionRate" class="reset-text number" style="width: 100%; text-align:right" />
                  </td>
              </tr>
              <tr>
                  <td style="width:50%;text-align:right;">Is Advance?</td>
                  <td style="width:50%">
                      <table>
                          <tr>
                              <td>
                                  <input type="checkbox" id="chkIsAdvance_Yes" onchange="IsAdvance_Yes()" />Yes
                                  <input type="checkbox" id="chkIsAdvance_No" onchange="IsAdvance_No()" />No
                              </td>
                          </tr>
                      </table>
                  </td>
              </tr>
                <tr>
                  <td style="width:50%;text-align:right;"> Con. Person:</td>
                  <td style="width:50%">
                      <input id="txtMktAccount" class="reset-text" placeholder="Search Concern Person" style="width:62%" />
                      <a id="btnPickMktAccount" href="javascript:void(0)" class="easyui-linkbutton ics-pick" iconcls="icon-pick" plain="true"></a>
                      <a id="btnResetMktPerson" href="javascript:void(0)" class="easyui-linkbutton ics-pick" iconcls="icon-clear" plain="true"></a>
                  </td>
              </tr>
          </table>
          <fieldset class="actionfieldsetstyle">
              <legend>Actions : </legend>
              <a id="btnUpdateInvoiceInfo" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-save" plain="true">Update</a>
              <a id="btnCloseInvoiceInfo" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-cancel" plain="true">Close</a>
          </fieldset>
      </div>
    <div class="menuMainCollectionTable" style="margin-left: 0px; height: 100%; width:100%">
        <table style="width:100%;height:100%;" id="tblSampleInvoice" title="Invoice List" class="easyui-datagrid" fit="true" fitcolumns="true" rownumbers="true" pagination="true" singleselect="true" autorowheight="false" toolbar="#toolbar">
                <thead>
                    <tr>
                        <th field="InvoiceNo" width="8%"><label id="lblInvoiceNo">Invoice No</label></th>
                        <th field="SampleInvoiceDateST" width="10%" align="center"> Date</th>
                        <th field="ContractorName" width="15%" align="left">Contractor Name</th>
                        <th field="AmountST" width="12%" align="right">Amount</th>
                        <th field="AmountWithCRateST" width="12%" align="right">Amount(Conv)</th>
                        <th field="ContractorPersopnnalName" width="15%" align="left">Contarct Person To</th>
                        <th field="PaymentTypeSt" width="10%" align="left">PaymentType</th>
                        <th field="ApproveByName" width="15%" align="left">Approve By</th>
                        <th field="CurrentStatusSt" width="10%" align="left">Current Status</th>
                        <th field="ExportPINo" width="10%" align="left">P/I No</th>
                        <th field="LCNo" width="10%" align="left">L/C No</th>
                        <th field="IsAdvanceSt" width="10%" align="left">Advance Type</th>
                        <th field="InvoiceTypeSt" width="10%" align="left">Type</th>
                        <th field="MKTPName" width="10%" align="left">Mkt.Concern Person</th>
                        
                        
                    </tr>
                </thead>
            </table>
            <div id="toolbar">
                <a href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-reload" plain="true" onclick="WaitForApproval()"></a>
                <input type="text" id="txtSearchByInvoiceNo" placeholder="Search Invoice No" style="width:100px" />
                <input type="text" id="txtSearchByOrderNo" placeholder="Search by order No" style="width:100px" />
                <input type="text" id="txtSearchByPINo" placeholder="Search by PI No" style="width:100px" />
                <a id="btnAdvSearch" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-search" plain="true">Adv. Search</a>
                <a href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-add" plain="true" id="btnAdd">New</a>
                <a href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-edit" plain="true" id="btnEdit">Edit</a>
                <a href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-remove" plain="true" id="btnDelete" onclick="Delete()">Delete</a>
                <a href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-details" plain="true" id="btnView">View</a>
                <a id="btnRevise" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-add" plain="true">Revise</a>
                <a href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-approved" plain="true" id="btnApprove">Approve</a>
                <a href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-cancel" plain="true" id="btnCancel">Cancel</a>
                <a href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-print" plain="true" id="btnPrint">Preview</a>
                <a href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-print" plain="true" id="btnPrint_F2">Preview(F2)</a>
                <a href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-excel" plain="true" id="btnPrintExcel">Excel</a>
                <a id="btnCreatePI" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-add" plain="true">Create PI</a>
                <a id="btnPickUpdateInfo" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-edit" plain="true">Update Info</a>
                <a id="btnPrintFormat" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-setting" plain="true">Print Format</a>
                <a id="btnUpdateInvNo" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-add" plain="true">Change No</a>
                <a id="btnAddAttachment" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-attachment" plain="true">Attachment</a>
                @*<a href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-print" plain="true" id="btnPrint_DN">Debit Note</a>*@
               
            </div>
</div>
     <div id="winAdvSearch" style="width:600px" class="easyui-window winClass" title="Adv. Search" data-options="modal:true,closed:true,collapsible:false,minimizable:false,maximizable:false,closable:false">
         <table style="width:100%;">
             <tr>
                 <td>
                     <fieldset style="margin-bottom: 0px;">
                         <legend>Searching Criteria</legend>
                         <table>
                             <tr>
                                 <td style=" width:20%;text-align:right;">
                                     <label>Issue To </label>
                                 </td>
                                 <td colspan="3" style=" width:80%;text-align:left;">
                                     <input id="txtContractorAdvS" style="width:75%;" type="text" placeholder="Type & Press Enter" />
                                     <a id="btnPickContractorAdvS" href="javascript:void(0)" class="easyui-linkbutton ics-pick" iconcls="icon-pick" plain="true"></a>
                                     <a id="btnClrContractorAdvS" href="javascript:void(0)" class="easyui-linkbutton ics-pick" iconcls="icon-clear" plain="true"></a>

                                 </td>
                             </tr>
                             <tr>
                                 <td style=" width:20%;text-align:right;">
                                     <label>Deliver To </label>
                                 </td>
                                 <td colspan="3" style=" width:80%;text-align:left;">
                                     <input id="txtDeliverToAdvS" style="width:75%;" type="text" placeholder="Type & Press Enter" />
                                     <a id="btnPickDeliverToAdvS" href="javascript:void(0)" class="easyui-linkbutton ics-pick" iconcls="icon-pick" plain="true"></a>
                                     <a id="btnClrDeliverToAdvS" href="javascript:void(0)" class="easyui-linkbutton ics-pick" iconcls="icon-clear" plain="true"></a>
                                 </td>
                             </tr>
                             <tr>
                                 <td style=" width:20%;text-align:right;">
                                     <label>Yarn </label>
                                 </td>
                                 <td colspan="3" style=" width:80%;text-align:left;">
                                     <input id="txtProductName" style="width:75%;" type="text" placeholder="Type & Press Enter" />
                                     <a id="btnProductPiker" href="javascript:void(0)" class="easyui-linkbutton ics-pick" iconcls="icon-pick" plain="true"></a>
                                     <a id="btnClrProductPiker" href="javascript:void(0)" class="easyui-linkbutton ics-pick" iconcls="icon-clear" plain="true"></a>
                                 </td>
                             </tr>

                             <tr>
                                 <td style=" width:20%;text-align:right;">
                                     <label> Date </label>
                                 </td>
                                 <td colspan="3">
                                     <select id="cboInvoiceDateAdvSearch" style="width:30%;" onchange=" DateActionsInvoiceDateAdvSearch(); "></select>
                                     <input id="txtFromInvoiceDateAdvSearch" type="text" style="width: 100px;" class="easyui-datebox" required="required" data-options="formatter:icsdateformat,parser:icsdateparser" />To
                                     <input id="txtToInvoiceDateAdvSearch" type="text" style="width: 100px;" class="easyui-datebox" required="required" data-options="formatter:icsdateformat,parser:icsdateparser" />
                                 </td>
                             </tr>
                             <tr>
                                 <td style=" width:20%;text-align:right;">
                                     <label>Order Date </label>
                                 </td>
                                 <td colspan="3">
                                     <select id="cboOrderDateAdvS" style="width:30%;" onchange="DateActionsOrderDateAdvSearch();"></select>
                                     <input id="txtFromOrderDateAdvSearch" type="text" style="width: 100px;" class="easyui-datebox" required="required" data-options="formatter:icsdateformat,parser:icsdateparser" />To
                                     <input id="txtToOrderDateAdvSearch" type="text" style="width: 100px;" class="easyui-datebox" required="required" data-options="formatter:icsdateformat,parser:icsdateparser" />
                                 </td>
                             </tr>
                             <tr>
                                 <td style=" width:20%;text-align:right;">
                                     <label>Delivery Date </label>
                                 </td>
                                 <td colspan="3">
                                     <select id="cboDeliveryDateAdvS" style="width:30%;" onchange=" DateActionsDeliveryDateAdvSearch(); "></select>
                                     <input id="txtFromDeliveryDateAdvSearch" type="text" style="width: 100px;" class="easyui-datebox" required="required" data-options="formatter:icsdateformat,parser:icsdateparser" />To
                                     <input id="txtToDeliveryDateAdvSearch" type="text" style="width: 100px;" class="easyui-datebox" required="required" data-options="formatter:icsdateformat,parser:icsdateparser" />
                                 </td>
                             </tr>

                             <tr>
                                 <td style=" width:20%;text-align:right;">
                                     <label>Payment Type </label>
                                 </td>
                                 <td style=" width:30%;text-align:left;">
                                     <select id="cboPaymentTypeAdvs" style="width: 100%;"></select>
                                 </td>
                                 <td style=" width:20%;text-align:right;">
                                     <label>Order Type </label>
                                 </td>
                                 <td style=" width:30%;text-align:left;">
                                     <select id="cboOrderType" style="width: 100%;"></select>
                                 </td>
                             </tr>

                             <tr>
                                 <td style=" width:20%;text-align:right;">
                                     <label>Concern Person </label>
                                 </td>
                                 <td colspan="3" style=" width:80%;text-align:left;">
                                     <select id="cboMkPersonAdvSearch" style="width:100%;"></select>
                                 </td>
                             </tr>



                             <tr>
                                 <td style=" width:20%;text-align:right;">
                                     <label id="lblInvoiceNoAds">Invoice No </label>
                                 </td>
                                 <td style=" width:30%;text-align:left;">
                                     <input id="txtInvoiceNo" type="text" style="width:100%" />
                                 </td>
                                 <td style=" width:20%;text-align:right;">
                                     <label>P/I No </label>
                                 </td>
                                 <td style=" width:30%;text-align:left;">
                                     <input id="txtPINo" type="text" style="width:95%" />
                                 </td>
                             </tr>
                             <tr>
                                 <td style=" width:20%;text-align:right;">
                                     <label>Order No </label>
                                 </td>
                                 <td style=" width:30%;text-align:left;">
                                     <input id="txtOrderNo" type="text" style="width:100%" />
                                 </td>
                                 <td style=" width:20%;text-align:right;">
                                     <label>Ref No </label>
                                 </td>
                                 <td style=" width:30%;text-align:left;">
                                     <input id="txtRefNoAdvS" type="text" style="width:95%" />
                                 </td>
                             </tr>


                             <tr>
                                 <td style="text-align:right;"></td>
                                 <td>
                                     <input id="chkYetNotAttachWithSalesContract" type="checkbox" style="width:5%;" />
                                     <label>Yet not Adjust </label>
                                 </td>
                                 <td colspan="2" style="text-align:right;">
                                     <input id="chkYetNotReceiveLC" type="checkbox" style="width:5%;" />
                                     <label>Yet not Receive L/C</label>
                                 </td>
                             </tr>
                             <tr>
                                 <td style="text-align:right;"></td>
                                 <td>
                                     <input id="chkYetNotAssignOrder" type="checkbox" style="width:5%;" />
                                     <label>Not Assign Order or Mkt Person </label>
                                 </td>
                                 <td colspan="2" style="text-align:right;">
                                    
                                 </td>
                             </tr>
                             <tr>
                                 <td height="2px" colspan="4"></td>
                             </tr>

                         </table>
                     </fieldset>
                 </td>
             </tr>
         </table>
         <fieldset class="actionfieldsetstyle">
             <legend> </legend>
             <a id="btnResetAdvSearch" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-reload" plain="true">Reset</a>
             <a id="btnSearchAdvSearch" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-search" plain="true">Search</a>
         </fieldset>
         <fieldset class="actionfieldsetstyle">
             <legend>Actions : </legend>
             <label class="lblLoadingMessage" style="float: left;">Loading Please Wait...</label>
             <a id="btnCloseAdvSearch" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-cancel" plain="true">Close</a>
         </fieldset>
     </div>
     <div id="winPrintFormat2" style="width:550px;" class="easyui-window winstyle" title="Adv. Search" data-options="modal:true,closed:true,collapsible:false,minimizable:false,maximizable:false,closable:false">
         <fieldset>
             <legend>Print Setup</legend>
             <table style="width:100%;">
                 <tr>
                     <td style="text-align:right;">
                         Qty Fromat :
                     </td>
                     <td>
                         <input id="chkInKg" type="checkbox" onclick="if(this.checked){IsLBSFormat(false)}else{IsLBSFormat(true)}" /> <label id="lblMUnitTwo"> In LBS</label>
                     </td>
                     <td>
                         <input id="chkInLBS" type="checkbox" checked onclick="if(this.checked){IsLBSFormat(true)}else{IsLBSFormat(false)}" /> <label id="lblMUnitOne"> In KG</label>
                     </td>
                     <td style="width:30%;">
                         &nbsp;&nbsp;&nbsp;
                     </td>
                 </tr>
                 <tr>
                     <td style="text-align:right;">
                         Print Title :
                     </td>
                     <td>
                         <input id="chkPrintTitleInNormalFormat" type="checkbox" checked onclick="if(this.checked){PrintTitleFormat(1)}" /> Normal Format
                     </td>
                     <td>
                         <input id="chkPrintTitlePadFormat" type="checkbox" onclick="if(this.checked){PrintTitleFormat(2)}" /> Pad Format
                     </td>
                     <td>
                         <input id="chkPrintTitleImageFormat" type="checkbox" onclick="if(this.checked){PrintTitleFormat(3)}" /> Image Format
                     </td>

                 </tr>
             </table>
         </fieldset>
         <fieldset class="actionfieldsetstyle">
             <legend>Actions : </legend>
             <a id="btnOkPrintFormat2" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-ok" plain="true">Ok</a>
             <a id="btnClosePrintFormat2" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-cancel" plain="true">Close</a>
         </fieldset>
     </div>
     <div id="winSINoChange" style="width:350px;" class="easyui-window" title="PI No Change" data-options="modal:true,closed:true,collapsible:false,minimizable:false,maximizable:false,closable:true">
         <div>
             <table style="width:100%;text-align:left">

                 <tr>
                     <td style="width:30%;text-align:right">
                         <label id="lblInvoiceNoNoChange">  </label> 
                     </td>
                     <td style="width:70%">
                         <input id="txtSInvoiceNo_Cur" class="reset-text" style="width:100%;" placeholder="Code search" />
                     </td>
                 </tr>
                 <tr>
                     <td style="width:30%;text-align:right">
                         New <label id="lblInvoiceNoNoChange2">Invoice No </label> 
                     </td>
                     <td style="width:70%">
                         <input type="text" style="width:100%;" id="txtSInvoiceNo_New" placeholder="0000" />
                     </td>
                 </tr>
                 <tr>
                     <td style="width:30%;text-align:right"></td>
                     <td style="width:70%">
                         (Last Four digit)
                     </td>
                 </tr>
             </table>

         </div>
         <fieldset class="actionfieldsetstyle">
             <legend>Actions : </legend>
             <a id="btnSaveSInvNo" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-save" plain="true">Save</a>
             <a id="btnClosePINo" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-cancel" plain="true">Close</a>
         </fieldset>
     </div>
 </body>

<style type="text/css">         
    #winExportPIInfo {
        width:350px;
    }
</style>
<script type="text/javascript">
    var _oSampleInvoices=[];
    var _sBaseAddress = "";
    var _oPermissions=[];
    var _nMenuID=0;
    var _nID=-1;
    var _nContractorIDs="";
    var _sContractorIds = '';
    var _sProductIds = '';
    var _sDeliverToIDs = '';
    var _oPaymentTypes=[];
    var _oOrderTypes=[];
    var _nBUID=0;
    var _nProductNature = 0;
    var _nMktAccountID=0;
    var _oOrderPaymentTypeObjs = [];
   
    $(document).ready(function () {
        //debugger;
        _sBaseAddress =@Html.Raw( new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(HttpContext.Current.Session[SessionInfo.BaseAddress]));
        @*_oPermissions =@Html.Raw( new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(HttpContext.Current.Session[SessionInfo.AuthorizationUserOEDOs]));*@
        _oSampleInvoices =@Html.Raw( new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(Model));
        _sMenuID =@Html.Raw( new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(HttpContext.Current.Session[SessionInfo.MenuID]));
        _oCompareOperators = @Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(ViewBag.CompareOperators));
        _sMenuID =@Html.Raw( new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(HttpContext.Current.Session[SessionInfo.MenuID]));
        _nBUID = @Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(ViewBag.BUID));
        _nProductNature = @Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(ViewBag.ProductNature));
        _oMktPersons = @Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(ViewBag.MktPersons));
        _oPaymentTypes = @Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(ViewBag.PaymentTypes));
        _oOrderTypes = @Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(ViewBag.OrderTypes));
        _oOrderPaymentTypeObjs = @Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(ViewBag.OrderPaymentTypeObjs));
        var oSampleInvoiceSetup = @Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(ViewBag.SampleInvoiceSetup));
        SampleInvoiceSetup(oSampleInvoiceSetup);
        sessionStorage.setItem('BUID',_nBUID);
        _nID =parseInt(sessionStorage.getItem("SelectedRowIndex"));
        var oSampleInvoices =sessionStorage.getItem("SampleInvoices");
        if(oSampleInvoices!=null)
        {
            oSampleInvoices = jQuery.parseJSON(oSampleInvoices);
        }
        else
        {
            oSampleInvoices=_oSampleInvoices;
        }
        RefreshList(oSampleInvoices);
        if(_nID!=-1)
        {
            $('#tblSampleInvoice').datagrid('selectRow', _nID);
        }

        $("#progressbar").progressbar({ value: 0 });
        $("#progressbarParent").hide();
        $(".lblLoadingMessage").hide();
        LoadComboAdv();
        if(parseInt(_nProductNature)!=0)//not is Yarn
        {
            $('#btnAdd,#btnEdit,#btnApprove,#btnDelete').hide();
        }
        sessionStorage.setItem("QtyFormat",true);//default set
        sessionStorage.setItem("ImageFormat",1);//default set
    });


    $('#tblSampleInvoice').datagrid({ onSelect: function (rowIndex, rowData) { OperationPerforms(rowIndex, rowData); } });

    function OperationPerforms(rowIndex, rowData)
    {
        $('#btnRevise,#btnCancel,#btnCreatePI').show();
        if (rowData != null && rowData.SampleInvoiceID > 0)
        {
            if (rowData.ApproveBy!=0)  
            {
                $('#btnEdit,#btnDelete,#btnApprove').hide();
                $('#btnRevise,#btnCancel').show();
                if (rowData.PaymentType==3)  
                {
                    $('#btnCreatePI').show();
                }
            }
            else
            {
                $('#btnEdit,#btnDelete,#btnApprove').show();
                $('#btnRevise,#btnCancel,#btnCreatePI').hide();
            }
            

            
        }
    }
    
    function SampleInvoiceSetup(oSampleInvoiceSetup)
    {
        $('#lblInvoiceNo,#lblInvoiceNoAds,#lblInvoiceNoNoChange2,#lblInvoiceNoNoChange').html(oSampleInvoiceSetup.ShortName+" No");
        $("#txtSearchByInvoiceNo").attr("placeholder", "Search by "+oSampleInvoiceSetup.ShortName+" No");
        if(oSampleInvoiceSetup.IsRateChange){ $("#btnCreatePI").hide()}
    }


    function RefreshList(oSampleInvoices)
    {
        data=oSampleInvoices;
        data={"total":""+data.length+"","rows":data};
        $('#tblSampleInvoice').datagrid('loadData',data);

    }

    $("#btnPickUpdateInfo").click(function()
    {
        var oSampleInvoice= $('#tblSampleInvoice').datagrid('getSelected');
        if(oSampleInvoice==null || parseInt(oSampleInvoice.SampleInvoiceID)<=0)
        {
            alert("Invalid Field!!! please select a valid Field!");
            return false;
        }
        if(oSampleInvoice.IsPaymentDone)
        {
            alert("Already Payment Done!");
            return false;
        }
        $('#txtConversionRate').val(oSampleInvoice.ConversionRate);
        $("#cboPaymentType").icsLoadCombo({List: _oOrderPaymentTypeObjs,OptionValue: "id",DisplayText: "Value"});
        $("#cboPaymentType").val(oSampleInvoice.PaymentType);
        $("#chkIsAdvance_Yes").prop("checked", oSampleInvoice.IsAdvance);
        $("#chkIsAdvance_No").prop("checked", !oSampleInvoice.IsAdvance);
        _nMktAccountID= oSampleInvoice.MKTEmpID;
        $('#txtMktAccount').val(oSampleInvoice.MKTPName);

        if(parseInt(oSampleInvoice.CurrencyID)==parseInt(oSampleInvoice.ExchangeCurrencyID))
        {
            $('#txtConversionRate').prop('disabled',true);
        }
        $("#winSampleInvoiceInfo").icsWindow("open", "Update Info");
    });

    $("#btnUpdateInvoiceInfo").click(function(){
        var oNewSampleInvoice= $('#tblSampleInvoice').datagrid('getSelected');
        if(oNewSampleInvoice==null || oNewSampleInvoice.SampleInvoiceID<=0)
        {
            alert("Invalid Field!!! please select a valid Field!");
            return ;
        }
        if($('#cboPaymentType').val()==0)
        {
            alert("Please select Payment Type.");
            return;
        }
        if(_nMktAccountID==0)
        {
            alert("Please select Payment Type.");
            return;
        }
        if(parseFloat(icsRemoveComma($('#txtConversionRate').val()))<=0)
        {
            alert("Conversion Rate Should be Greater than  0");
            return;
        }

        var SelectedRowIndex=$('#tblSampleInvoice').datagrid('getRowIndex',oNewSampleInvoice);
        var oSampleInvoice = {
            CurrencyID:oNewSampleInvoice.CurrencyID,
            ExchangeCurrencyID:oNewSampleInvoice.ExchangeCurrencyID,
            SampleInvoiceID:oNewSampleInvoice.SampleInvoiceID,
            ConversionRate:parseFloat(icsRemoveComma($('#txtConversionRate').val())),
            IsAdvance: $("#chkIsAdvance_Yes").is(":checked"),
            PaymentType:parseInt($("#cboPaymentType").val()),
            MKTEmpID :_nMktAccountID
        };
        $.ajax({
            type: "POST",
            dataType: "json",
            url: _sBaseAddress + "/SampleInvoice/UpdateSampleInvoice",
            traditional: true,
            data: JSON.stringify(oSampleInvoice),
            contentType: "application/json; charset=utf-8",
            success: function (data) {
                var oSampleInvoice = jQuery.parseJSON(data);
                if (oSampleInvoice.ErrorMessage==null || oSampleInvoice.ErrorMessage=="") 
                {
                    alert("Successfully Updated.");
                    $('#tblSampleInvoice').datagrid('updateRow',{index: SelectedRowIndex,	row: oSampleInvoice});
                    $("#winSampleInvoiceInfo").icsWindow("close");

                } else {
                    alert(oSampleInvoice.ErrorMessage);
                }
                
            },
            error: function (xhr, status, error) {
                alert(error);
            }
        });

    });
    $("#btnCloseInvoiceInfo").click(function(){
        $("#winSampleInvoiceInfo").icsWindow("close");
    });




    $("#btnAdd").click(function(){
        var oSampleInvoices= $('#tblSampleInvoice').datagrid('getRows');
        sessionStorage.setItem("SampleInvoices", JSON.stringify(oSampleInvoices));
        sessionStorage.setItem("SelectedRowIndex", -1);
        sessionStorage.setItem("SampleInvoiceHeader", "Add ");
        sessionStorage.setItem("Operation", "New");
        sessionStorage.setItem("BackLink", window.location.href);
        window.location.href = _sBaseAddress+ "/SampleInvoice/ViewSampleInvoice?id=0&buid="+sessionStorage.getItem('BUID');
    });

    $("#btnEdit").click(function(){

        var oSampleInvoice= $('#tblSampleInvoice').datagrid('getSelected');
        if(oSampleInvoice==null || oSampleInvoice.SampleInvoiceID<=0)
        {
            alert("Please select a item from list!");
            return;
        }
        var SelectedRowIndex=$('#tblSampleInvoice').datagrid('getRowIndex',oSampleInvoice);

        var oSampleInvoices= $('#tblSampleInvoice').datagrid('getRows');
        sessionStorage.setItem("SampleInvoices", JSON.stringify(oSampleInvoices));
        sessionStorage.setItem("SelectedRowIndex", SelectedRowIndex);
        sessionStorage.setItem("SampleInvoiceHeader", "Edit ");
        sessionStorage.setItem("Operation", "Edit");
        sessionStorage.setItem("BackLink", window.location.href);
        window.location.href = _sBaseAddress+ "/SampleInvoice/ViewSampleInvoice?id="+oSampleInvoice.SampleInvoiceID+"&buid="+sessionStorage.getItem('BUID');
    });
    $("#btnApprove").click(function(){

        var oSampleInvoice= $('#tblSampleInvoice').datagrid('getSelected');
        if(oSampleInvoice==null || oSampleInvoice.SampleInvoiceID<=0)
        {
            alert("Please select a item from list!");
            return;
        }
        var SelectedRowIndex=$('#tblSampleInvoice').datagrid('getRowIndex',oSampleInvoice);
        var oInvoices= $('#tblSampleInvoice').datagrid('getRows');
        sessionStorage.setItem("SampleInvoices", JSON.stringify(oInvoices));
        sessionStorage.setItem("SelectedRowIndex", SelectedRowIndex);
        sessionStorage.setItem("SampleInvoiceHeader", "Approve ");
        sessionStorage.setItem("Operation", "Approve");
        sessionStorage.setItem("BackLink", window.location.href);
        window.location.href = _sBaseAddress+ "/SampleInvoice/ViewSampleInvoice?id="+oSampleInvoice.SampleInvoiceID+"&buid="+sessionStorage.getItem('BUID');
    });
    $("#btnCancel").click(function(){
        var oSampleInvoice= $('#tblSampleInvoice').datagrid('getSelected');
        if(oSampleInvoice==null || oSampleInvoice.SampleInvoiceID<=0)
        {
            alert("Please select a item from list!");
            return;
        }
        var SelectedRowIndex=$('#tblSampleInvoice').datagrid('getRowIndex',oSampleInvoice);
        var oInvoices= $('#tblSampleInvoice').datagrid('getRows');
        sessionStorage.setItem("Invoices", JSON.stringify(oInvoices));
        sessionStorage.setItem("SelectedRowIndex", SelectedRowIndex);
        sessionStorage.setItem("SampleInvoiceHeader", "Cancel ");
        sessionStorage.setItem("Operation", "Cancel");
        sessionStorage.setItem("BackLink", window.location.href);
        window.location.href = _sBaseAddress+  "/SampleInvoice/ViewSampleInvoice?id="+oSampleInvoice.SampleInvoiceID+"&buid="+sessionStorage.getItem('BUID');
    });
    $("#btnRevise").click(function(){
        var oSampleInvoice= $('#tblSampleInvoice').datagrid('getSelected');
        if(oSampleInvoice==null || oSampleInvoice.SampleInvoiceID<=0)
        {
            alert("Please select a item from list!");
            return;
        }
        var SelectedRowIndex=$('#tblSampleInvoice').datagrid('getRowIndex',oSampleInvoice);
        var oInvoices= $('#tblSampleInvoice').datagrid('getRows');
        sessionStorage.setItem("Invoices", JSON.stringify(oInvoices));
        sessionStorage.setItem("SelectedRowIndex", SelectedRowIndex);
        sessionStorage.setItem("SampleInvoiceHeader", "Revise");
        sessionStorage.setItem("Operation", "Revise");
        sessionStorage.setItem("BackLink", window.location.href);
        window.location.href = _sBaseAddress+  "/SampleInvoice/ViewSampleInvoice?id="+oSampleInvoice.SampleInvoiceID+"&buid="+sessionStorage.getItem('BUID');
    });
    $("#btnView").click(function(){

        var oSampleInvoice= $('#tblSampleInvoice').datagrid('getSelected');
        if(oSampleInvoice==null || oSampleInvoice.SampleInvoiceID<=0)
        {
            alert("Please select a item from list!");
            return;
        }
        var SelectedRowIndex=$('#tblSampleInvoice').datagrid('getRowIndex',oSampleInvoice);
        var oInvoices= $('#tblSampleInvoice').datagrid('getRows');
        sessionStorage.setItem("SampleInvoices", JSON.stringify(oInvoices));
        sessionStorage.setItem("SelectedRowIndex", SelectedRowIndex);
        sessionStorage.setItem("SampleInvoiceHeader", "Approve");
        sessionStorage.setItem("Operation", "View");
        sessionStorage.setItem("BackLink", window.location.href);
        window.location.href = _sBaseAddress+ "/SampleInvoice/ViewSampleInvoice?id="+oSampleInvoice.SampleInvoiceID+"&buid="+sessionStorage.getItem('BUID');
    });

 
    function Delete()
    {
        ////debugger;
        var oSampleInvoice= $('#tblSampleInvoice').datagrid('getSelected');
        if (!confirm("Confirm to Delete?")) return ;

        if(oSampleInvoice==null || oSampleInvoice.SampleInvoiceID<=0)
        {
            alert("Invalid Field!!! please select a valid Field!");
            return false;
        }
        var SelectedRowIndex=$('#tblSampleInvoice').datagrid('getRowIndex',oSampleInvoice);

        if (oSampleInvoice.SampleInvoiceID > 0)
        {

            $.ajax
            ({
                type: "GET",
                dataType: "json",
                url: '@Url.Action("Delete", "SampleInvoice")',
                data: { id: oSampleInvoice.SampleInvoiceID},
                contentType: "application/json; charset=utf-8",
                success: function (data) {
                    debugger;
                    feedbackmessage = jQuery.parseJSON(data);
                    if (feedbackmessage == "Deleted")
                    {
                        alert("Delete sucessfully");
                        $('#tblSampleInvoice').datagrid('deleteRow',SelectedRowIndex);

                    }
                    else
                    {
                        alert(feedbackmessage);
                    }
                },
                error: function (xhr, status, error)
                {
                    alert(error);
                }

            });
        }
    }



    function WaitForApproval()
    {
        window.location.href = _sBaseAddress+ '/SampleInvoice/ViewSampleInvoices?'+"buid="+_nBUID+"&menuid="+_sMenuID;
    }

    $('#btnPrint').click(function(e){
        var oSampleInvoice= $('#tblSampleInvoice').datagrid('getSelected');
        if(oSampleInvoice==null || oSampleInvoice.SampleInvoiceID<=0)
        {
            alert("Please select a item from list!");
            return;
        }
       // window.open(_sBaseAddress + '/ExportPI/PrintExportPIPreviewLog?id='+oSampleInvoiceLog.ExportPILogID+ "&bQtyFormat="+sessionStorage.getItem("QtyFormat") + "&nTitleTypeInImg="+sessionStorage.getItem("ImageFormat"), "_blank");
        window.open(_sBaseAddress+ "/SampleInvoice/PrintSampleInvoice?id="+oSampleInvoice.SampleInvoiceID+ "&bQtyFormat="+sessionStorage.getItem("QtyFormat") + "&nTitleTypeInImg="+sessionStorage.getItem("ImageFormat"), "_blank");
    });
    $('#btnPrint_F2').click(function(e){
        var oSampleInvoice= $('#tblSampleInvoice').datagrid('getSelected');
        if(oSampleInvoice==null || oSampleInvoice.SampleInvoiceID<=0)
        {
            alert("Please select a item from list!");
            return;
        }
        // window.open(_sBaseAddress + '/ExportPI/PrintExportPIPreviewLog?id='+oSampleInvoiceLog.ExportPILogID+ "&bQtyFormat="+sessionStorage.getItem("QtyFormat") + "&nTitleTypeInImg="+sessionStorage.getItem("ImageFormat"), "_blank");
        window.open(_sBaseAddress+ "/SampleInvoice/PrintSampleInvoice_F2?id="+oSampleInvoice.SampleInvoiceID+ "&bQtyFormat="+sessionStorage.getItem("QtyFormat") + "&nTitleTypeInImg="+sessionStorage.getItem("ImageFormat")+"&nPageHeight=770", "_blank");
    });
    $('#btnPrintExcel').click(function(e){
        var oSampleInvoice= $('#tblSampleInvoice').datagrid('getSelected');
        if(oSampleInvoice==null || oSampleInvoice.SampleInvoiceID<=0)
        {
            alert("Please select a item from list!");
            return;
        }
        window.open(_sBaseAddress+ "/SampleInvoice/PrintToExcelSampleInvoice?id="+oSampleInvoice.SampleInvoiceID+ "&bQtyFormat="+sessionStorage.getItem("QtyFormat") + "&nTitleTypeInImg="+sessionStorage.getItem("ImageFormat"), "_blank");
    });

    
    $("#txtSearchByInvoiceNo").keydown(function (e) {
        var nkeyCode = e.keyCode || e.which;
        if(nkeyCode==13){

            var oSampleInvoice= {
                ExportPINo :"",
                OrderNo: "",
                SampleInvoiceNo: $("#txtSearchByInvoiceNo").val()
            };
            GetsOrders(oSampleInvoice);
        }
        else if(nkeyCode==8){
            $("#txtSearchByInvoiceNo").val("");

        }
    });
    $("#txtSearchByOrderNo").keydown(function (e) {
        var nkeyCode = e.keyCode || e.which;
        if(nkeyCode==13){

            var oSampleInvoice= {
                ExportPINo :"",
                OrderNo:  $("#txtSearchByOrderNo").val(),
                SampleInvoiceNo: $("#txtSearchByInvoiceNo").val()
            };
            GetsOrders(oSampleInvoice);
        }
        else if(nkeyCode==8){
            $("#txtSearchByOrderNo").val("");

        }
    });
    $("#txtSearchByPINo").keydown(function (e) {
        var nkeyCode = e.keyCode || e.which;
        if(nkeyCode==13){

            var oSampleInvoice= {
                ExportPINo : $("#txtSearchByPINo").val(),
                OrderNo:  "",
                SampleInvoiceNo: ""
            };
            GetsOrders(oSampleInvoice);
        }
        else if(nkeyCode==8){
            $("#txtSearchByPINo").val("");

        }
    });

    function GetsOrders(oSampleInvoice)
    {
        $(".lblLoadingMessage").show();

        var nCboOrderDate = 0;
        var dFromOrderDate = icsdateformat(new Date());
        var dToOrderDate = icsdateformat(new Date());

        var ncboInvoiceDate = 0;
        var dFromInvoiceDate = icsdateformat(new Date());
        var dToInvoiceDate =icsdateformat(new Date());

        var ncboDeliveryDate = 0;
        var dFromDeliveryDate =icsdateformat(new Date());
        var dToDeliveryDate = icsdateformat(new Date());

        var ncboPaymentType =0;
        var nCboMkPerson = 0;
        var nOrderType = 0;
        var nInvoiceType = 0;
        var sPINo = $.trim(oSampleInvoice.ExportPINo);
        var sInvoiceNo = $.trim(oSampleInvoice.SampleInvoiceNo);
        var sOrderNo = $.trim(oSampleInvoice.OrderNo);
        var sRefNo = "";
        var bYetNotAttachWithSalesContract = false;
        var bYetNotReceiveLC = false;
        var nInvoiceTypeFixec =1;
        var bchkYetNotAssignOrder=false;
        if(parseInt(_nProductNature)!=0)//not is Yarn
        {
            nInvoiceTypeFixec = 11;//Sales Contract
        }
        var sParams = _sContractorIds + "~" +
                      _sDeliverToIDs + "~" +
                      nCboOrderDate + "~" +
                      dFromOrderDate + "~" +
                      dToOrderDate + "~" +
                      ncboInvoiceDate + "~" +
                      dFromInvoiceDate + "~" +
                      dToInvoiceDate + "~" +
                      ncboDeliveryDate + "~" +
                      dFromDeliveryDate + "~" +
                      dToDeliveryDate + "~" +
                      nCboMkPerson + "~" +
                      ncboPaymentType + "~" +
                      nOrderType + "~" +
                      sPINo+"~"+
                      sInvoiceNo+"~"+
                      sOrderNo+"~"+
                      sRefNo+"~"+
                       _sProductIds+"~"+
                      bYetNotAttachWithSalesContract + "~" +
                      bYetNotReceiveLC + "~" +
                      nInvoiceTypeFixec + "~" +
                      nInvoiceType + "~" +
                      _nBUID+"~"+
                      bchkYetNotAssignOrder+"~"+
                      _nProductNature ;
        var oSampleInvoice = {
            ErrorMessage : sParams
        };

        $.ajax({
            type: "POST",
            dataType: "json",
            url: _sBaseAddress + "/SampleInvoice/AdvSearch",
            traditional: true,
            data: JSON.stringify(oSampleInvoice),
            contentType: "application/json; charset=utf-8",
            success: function (data) {
                var oSampleInvoices = jQuery.parseJSON(data);
                debugger;
                if (oSampleInvoices != null) {
                    if (oSampleInvoices.length > 0)
                    {

                        DynamicRefreshList(oSampleInvoices, "tblSampleInvoice");
                        $("#winAdvSearch").icsWindow("close");

                    }
                    else
                    {
                        alert("Sorry, No data found.");
                        DynamicRefreshList([], "tblSampleInvoice");
                    }

                } else {
                    alert("Sorry, No data found.");
                    DynamicRefreshList([], "tblSampleInvoice");
                }
                $(".lblLoadingMessage").hide();
            }
        });
    }
    ////Start adv Searching

    function updateProgress() {
        var value =$('#progressbar').progressbar('getValue');
        if (value < 96){
            value += Math.floor(Math.random() * 10);
            $('#progressbar').progressbar('setValue', value);
        }
    }
    function hideShow(miliseconds) {
        $("#progressbarParent").hide();
    }
    //Account Of Picker

    $("#txtContractorAdvS").keydown(function (e) {
        if (e.keyCode === 13) // Enter Press
        {
            PickContractors_AdvS();
        }
        else if (e.keyCode === 08) {
            $("#txtContractorAdvS").removeClass("fontColorOfPickItem");
            _sContractorIds = '';
        }
    });
    $("#btnClrContractorAdvS").click(function () {
        $("#txtContractorAdvS").removeClass("fontColorOfPickItem");
        $("#txtContractorAdvS").val("");
        _sContractorIds = '';
    });

    $("#btnPickContractorAdvS").click(function () {
        PickContractors_AdvS();
    });
    $("#txtSearchByAccountNamePickerAdvSearch").keydown(function (e) {
        var obj = {
            Event: e,
            SearchProperty: "Name",
            GlobalObjectList: _oAccountsOf,
            TableId: "tblAccountsPickerAdvSearch"
        };
        $('#txtSearchByAccountNamePickerAdvSearch').icsSearchByText(obj);
    });
    //End Account Of Picker
    $("#txtDeliverToAdvS").keydown(function (e) {
        if (e.keyCode === 13) // Enter Press
        {
            PickDeliverTo_AdvS();
        }
        else if (e.keyCode === 08) {
            $("#txtDeliverToAdvS").removeClass("fontColorOfPickItem");
            _sDeliverToIDs ="";
        }
    });
    $("#btnClrDeliverToAdvS").click(function () {
        $("#txtDeliverToAdvS").removeClass("fontColorOfPickItem");
        $("#txtDeliverToAdvS").val("");
        _sDeliverToIDs ="";
    });
    $("#btnPickDeliverToAdvS").click(function () {
        PickDeliverTo_AdvS();
    });

    //Product Pick
    $("#txtProductName").keydown(function (e) {
        debugger;
        var code = (e.keyCode ? e.keyCode : e.which);
        if (code == 13) // Enter Press
        {
            if($('#txtProductName').val()==null || $('#txtProductName').val()=="")
            {
                alert("Please Type Product and Press Enter.");
                $('#txtProductName').focus();
                return;
            }
            PickProduct($('#txtProductName').val());
        }
        if (code == 8) //backspace=8
        {
            //debugger;
            $("#txtProductName").removeClass("fontColorOfPickItem");
            _sProductIds= [];
        }
    });
    $("#btnProductPiker").click(function () {
        PickProduct("");
    });
    $("#btnClrProductPiker").click(function () {
        $("#txtProductName").val('');
        $("#txtProductName").removeClass("fontColorOfPickItem");
        _sProductIds= [];
    });
    function PickProduct(sProductName)
    {
        var oProduct = { BUID:sessionStorage.getItem("BUID"),ProductName:sProductName};
        var obj = {
            BaseAddress: _sBaseAddress,
            Object: oProduct,
            ControllerName: "Product",
            ActionName: "SearchByProductBUWise",
            IsWinClose: false
        };
        $.icsDataGets(obj, function (response) {
            debugger;
            if (response.status && response.objs.length > 0) {
                if (response.objs[0].ProductID > 0) {
                    var tblColums = [];
                    var oColumn = { field: "ProductCode", title: "Code", width: 100, align: "left" }; tblColums.push(oColumn);
                    oColumn = { field: "ProductName", title: "Name", width: 300, align: "left" }; tblColums.push(oColumn);
                    oColumn = { field: "MUnit", title: "Unit", width: 70, align: "left" }; tblColums.push(oColumn);
                    var oPickerParam = {
                        winid: 'winProductPicker',
                        winclass: 'clsProductPicker',
                        winwidth: 600,
                        winheight: 460,
                        tableid: 'tblProductPicker',
                        tablecolumns: tblColums,
                        datalist: response.objs,
                        multiplereturn: true,
                        searchingbyfieldName: 'NameCode',
                        windowTittle: 'Product List'
                    };
                    $.icsPicker(oPickerParam);
                    IntializePickerbutton(oPickerParam);
                }
                else {
                    alert(response.objs[0].ErrorMessage);
                }

            }else{
                alert("Data Not Found.");
            }
        });
    }


    //End Buyer Search
    $("#btnResetAdvSearch").click(function () {
        ResetAdvSearchWindow();
        DateActionsOrderDateAdvSearch();
        DateActionsInvoiceDateAdvSearch();
        DateActionsDeliveryDateAdvSearch();
        DateActionsStatusDateAdvSearch();
    });
    $("#btnSearchAdvSearch").click(function () {
        debugger;

        $(".lblLoadingMessage").show();

        var checkDate = CheckFromAndToDateValidation("cboOrderDateAdvS", "txtFromOrderDateAdvSearch", "txtToOrderDateAdvSearch");
        if (!checkDate) {
            alert("Start date must be greater than end date.");
            return false;
        }
        checkDate = CheckFromAndToDateValidation("cboInvoiceDateAdvSearch", "txtFromInvoiceDateAdvSearch", "txtToInvoiceDateAdvSearch");
        if (!checkDate) {
            alert("Start date must be greater than end date.");
            return false;
        }
        checkDate = CheckFromAndToDateValidation("cboDeliveryDateAdvS", "txtFromDeliveryDateAdvSearch", "txtToDeliveryDateAdvSearch");
        if (!checkDate) {
            alert("Start date must be greater than end date.");
            return false;
        }


        var nCboOrderDate = parseInt($("#cboOrderDateAdvS").val());
        var dFromOrderDate = $('#txtFromOrderDateAdvSearch').datebox('getValue');
        var dToOrderDate = $('#txtToOrderDateAdvSearch').datebox('getValue');

        var ncboInvoiceDate = parseInt($("#cboInvoiceDateAdvSearch").val());
        var dFromInvoiceDate = $('#txtFromInvoiceDateAdvSearch').datebox('getValue');
        var dToInvoiceDate = $('#txtToInvoiceDateAdvSearch').datebox('getValue');

        var ncboDeliveryDate = parseInt($("#cboDeliveryDateAdvS").val());
        var dFromDeliveryDate = $('#txtFromDeliveryDateAdvSearch').datebox('getValue');
        var dToDeliveryDate = $('#txtToDeliveryDateAdvSearch').datebox('getValue');

        var ncboPaymentType = parseInt($("#cboPaymentTypeAdvs").val());
        var nCboMkPerson = parseInt($("#cboMkPersonAdvSearch").val());
        var nOrderType = parseInt($("#cboOrderType").val());

        var sPINo = $.trim($("#txtPINo").val());
        var sInvoiceNo = $.trim($("#txtInvoiceNo").val());
        var sOrderNo = $.trim($("#txtOrderNo").val());
        var sRefNo = $.trim($("#txtRefNoAdvS").val());

        var bYetNotAttachWithSalesContract = $("#chkYetNotAttachWithSalesContract").is(':checked');
        var bYetNotReceiveLC = $("#chkYetNotReceiveLC").is(':checked');
        var bchkYetNotAssignOrder = $("#chkYetNotAssignOrder").is(':checked');

        var nInvoiceTypeFixec =1;
        if(_nProductNature!=0)
        {
            nInvoiceTypeFixec =11;//Sales contract
        }
        var nInvoiceType =0;

        var sParams = _sContractorIds + "~" +
                      _sDeliverToIDs + "~" +
                      nCboOrderDate + "~" +
                      dFromOrderDate + "~" +
                      dToOrderDate + "~" +
                      ncboInvoiceDate + "~" +
                      dFromInvoiceDate + "~" +
                      dToInvoiceDate + "~" +
                      ncboDeliveryDate + "~" +
                      dFromDeliveryDate + "~" +
                      dToDeliveryDate + "~" +
                      nCboMkPerson + "~" +
                      ncboPaymentType + "~" +
                      nOrderType + "~" +
                      sPINo+"~"+
                      sInvoiceNo+"~"+
                      sOrderNo+"~"+
                      sRefNo+"~"+
                       _sProductIds+"~"+
                      bYetNotAttachWithSalesContract + "~" +
                      bYetNotReceiveLC + "~" +
                       nInvoiceTypeFixec + "~" +
                      nInvoiceType + "~" +
                      _nBUID+"~"+
                       bchkYetNotAssignOrder+"~"+
                    _nProductNature;
        var oSampleInvoice = {
            ErrorMessage : sParams
        };

        $.ajax({
            type: "POST",
            dataType: "json",
            url: _sBaseAddress + "/SampleInvoice/AdvSearch",
            traditional: true,
            data: JSON.stringify(oSampleInvoice),
            contentType: "application/json; charset=utf-8",
            success: function (data) {
                var oSampleInvoices = jQuery.parseJSON(data);
                debugger;
                if (oSampleInvoices != null) {
                    if (oSampleInvoices.length > 0)
                    {

                        DynamicRefreshList(oSampleInvoices, "tblSampleInvoice");
                        $("#winAdvSearch").icsWindow("close");

                    }
                    else
                    {
                        alert("Sorry, No data found.");
                        DynamicRefreshList([], "tblSampleInvoice");
                    }

                } else {
                    alert("Sorry, No data found.");
                    DynamicRefreshList([], "tblSampleInvoice");
                }
                $(".lblLoadingMessage").hide();
            }
        });
    });

    function LoadComboAdv()
    {
        $("#cboOrderType").icsLoadCombo({
            List: _oOrderTypes,
            OptionValue: "id",
            DisplayText: "Value"
        });
        $("#cboPaymentType,#cboPaymentTypeAdvs").icsLoadCombo({
            List: _oPaymentTypes,
            OptionValue: "Value",
            DisplayText: "Text"
        });
        $("#cboOrderDateAdvS, #cboInvoiceDateAdvSearch, #cboDeliveryDateAdvS").icsLoadCombo({
            List: _oCompareOperators,
            OptionValue: "id",
            DisplayText: "Value"
        });
        $("#cboMkPersonAdvSearch").icsLoadCombo({
            List: _oMktPersons,
            OptionValue: "EmployeeID",
            DisplayText: "Name"
        });
    }
    function CheckFromAndToDateValidation(OperationComboId, FromDateId, ToDateId) {
        $("#" + OperationComboId).parent().parent().parent().find("select").removeClass("errorFieldBorder");
        var nCboVal = $("#" + OperationComboId).val();
        if (parseInt(nCboVal) == 5 || parseInt(nCboVal) == 6) {
            var fromDate = $("#" + FromDateId).datebox("getValue");
            var toDate = $("#" + ToDateId).datebox("getValue");
            if (new Date(fromDate) > new Date(toDate)) {
                $("#" + ToDateId).focus();
                $("#" + OperationComboId).addClass("errorFieldBorder");
                $(".lblLoadingMessage").hide();
                return false;
            } else {
                $("#" + OperationComboId).removeClass("errorFieldBorder");
                return true;
            }
        } else {
            return true;
        }
    }

    function ResetAdvSearchWindow() {
        _sContractorIds = '';
        _sDeliverToIDs = "";
        $("#winAdvSearch input").not("input[type='button']").val("");
        $("#winAdvSearch input").removeClass("fontColorOfPickItem");
        $("#winAdvSearch select").val(0);
        DateActionsOrderDateAdvSearch();
        DateActionsInvoiceDateAdvSearch();
        DateActionsDeliveryDateAdvSearch();
        $("#txtFromOrderDateAdvSearch,#txtToOrderDateAdvSearch,#txtFromInvoiceDateAdvSearch,#txtToInvoiceDateAdvSearch,#txtFromDeliveryDateAdvSearch,#txtToDeliveryDateAdvSearch").datebox({ disabled: true });
        $("#txtFromOrderDateAdvSearch,#txtToOrderDateAdvSearch,#txtFromInvoiceDateAdvSearch,#txtToInvoiceDateAdvSearch,#txtFromDeliveryDateAdvSearch,#txtToDeliveryDateAdvSearch").datebox("setValue", icsdateformat(new Date()));
    }

    function PickContractors_AdvS() {
        debugger;
        var oContractor = {
            Params: '2,3' + '~' + $.trim($("#txtContractorAdvS").val()+"~"+_nBUID)
        };
        var obj = {
            BaseAddress: _sBaseAddress,
            Object: oContractor,
            ControllerName: "Contractor",
            ActionName: "ContractorSearchByNameType",
            IsWinClose: false
        };

        $("#progressbar").progressbar({ value: 0 });
        $("#progressbarParent").show();
        var intervalID = setInterval(updateProgress, 250);


        $.icsDataGets(obj, function (response) {
            clearInterval(intervalID);
            $("#progressbarParent").hide();
            if (response.status && response.objs.length > 0) {
                if (response.objs[0].ContractorID > 0) {
                    var tblColums = []; var oColumn = { field: "ContractorID", title: "Code", width: 50, align: "left" }; tblColums.push(oColumn);
                    oColumn = { field: "Name", title: "Name", width: 280, align: "left" }; tblColums.push(oColumn);

                    var oPickerParam = {
                        winid: 'winContractorPicker',
                        winclass: 'clsAccountOf',
                        winwidth: 400,
                        winheight: 460,
                        tableid: 'tblAccountOfs',
                        tablecolumns: tblColums,
                        datalist: response.objs,
                        multiplereturn: true,
                        searchingbyfieldName: 'Name',
                        windowTittle: 'Contactor List'
                    };
                    $.icsPicker(oPickerParam);
                    IntializePickerbutton(oPickerParam);
                }
                else {
                    alert(response.objs[0].ErrorMessage);
                }
            }
            else {
                alert("Sorry, No Contactor Found.");
            }
        });
    }

    function PickDeliverTo_AdvS() {
        var oContractor = {
            Params: '2' + '~' + $.trim($("#txtDeliverToAdvS").val()+"~"+_nBUID)
        };
        var obj = {
            BaseAddress: _sBaseAddress,
            Object: oContractor,
            ControllerName: "Contractor",
            ActionName: "ContractorSearchByNameType",
            IsWinClose: false
        };
        $("#progressbar").progressbar({ value: 0 });
        $("#progressbarParent").show();
        var intervalID = setInterval(updateProgress, 250);
        DynamicRefreshList([], "tblContractorsPickerAdvSearch");
        $.icsDataGets(obj, function (response) {
            clearInterval(intervalID);
            $("#progressbarParent").hide();
            if (response.status && response.objs.length > 0) {
                if (response.objs[0].ContractorID > 0) {
                    var tblColums = []; var oColumn = { field: "ContractorID", title: "Code", width: 50, align: "left" }; tblColums.push(oColumn);
                    oColumn = { field: "Name", title: "Name", width: 280, align: "left" }; tblColums.push(oColumn);
                    var oPickerParam = {
                        winid: 'winBuyers',
                        winclass: 'clsBuyer',
                        winwidth: 400,
                        winheight: 460,
                        tableid: 'tblBuyers',
                        tablecolumns: tblColums,
                        datalist: response.objs,
                        multiplereturn: true,
                        searchingbyfieldName: 'Name',
                        windowTittle: 'Buyer List'
                    };
                    $.icsPicker(oPickerParam);
                    IntializePickerbutton(oPickerParam);
                }
                else {
                    alert(response.objs[0].ErrorMessage);
                }
            }
            else {
                alert("Sorry, No Contactor Found.");
            }
        });
    }

    function DateActionsOrderDateAdvSearch() {
        DynamicDateActions("cboOrderDateAdvS", "txtFromOrderDateAdvSearch", "txtToOrderDateAdvSearch");
    }
    function DateActionsInvoiceDateAdvSearch() {
        DynamicDateActions("cboInvoiceDateAdvSearch", "txtFromInvoiceDateAdvSearch", "txtToInvoiceDateAdvSearch");
    }
    function DateActionsDeliveryDateAdvSearch() {
        DynamicDateActions("cboDeliveryDateAdvS", "txtFromDeliveryDateAdvSearch", "txtToDeliveryDateAdvSearch");
    }

    $("#btnCloseAdvSearch").click(function () {
        $("#winAdvSearch").icsWindow("close");
    });
    $("#btnAdvSearch").click(function () {
        debugger;
        $("#winAdvSearch").icsWindow("open", "Sample Invoice Advance Search");
        //DynamicRefreshList([], "tblExportPIAdvSearch");
        DynamicResetAdvSearchWindow("winAdvSearch");
        DynamicDateActions("cboDateOptionAdvSearch", "txtFromDateAdvSearch", "txtToDateAdvSearch");
        DynamicDateActions("cboInvoiceDateAdvSearch", "txtFromInvoiceDateAdvSearch", "txtToInvoiceDateAdvSearch");
        DynamicDateActions("cboDeliveryDateAdvS", "txtFromDeliveryDateAdvSearch", "txtToDeliveryDateAdvSearch");
        ResetAdvSearchWindow();
    });

    function IntializePickerbutton(oPickerobj) {
        $("#" + oPickerobj.winid).find("#btnOk").click(function () {
            SetPickerValueAssign(oPickerobj);
        });
        $(document).find('.' + oPickerobj.winclass).keydown(function (e) {
            if (e.which === 13) {
                SetPickerValueAssign(oPickerobj);
            }
        });
    }

    function SetPickerValueAssign(oPickerobj) {
        var oreturnObj = null, oreturnObjs = [];
        if (oPickerobj.multiplereturn) {
            oreturnObjs = $('#' + oPickerobj.tableid).datagrid('getChecked');
        } else {
            oreturnObj = $('#' + oPickerobj.tableid).datagrid('getSelected');
        }

        if (oPickerobj.winid == 'winContractorPicker')
        {
            if (oreturnObjs != null && oreturnObjs.length> 0)
            {

                _sContractorIds=''; var sMessage='';
                sMessage=(oreturnObjs.length>1)? oreturnObjs.length +" Contractors Selected" : oreturnObjs[0].Name;
                $('#txtContractorAdvS').val(sMessage);
                $("#txtContractorAdvS").addClass("fontColorOfPickItem");

                for(var i=0;i<oreturnObjs.length;i++){
                    _sContractorIds=_sContractorIds+oreturnObjs[i].ContractorID+',';
                }
                _sContractorIds=_sContractorIds.substring(0,_sContractorIds.length-1);

            }
            else
            {
                alert("Please select a contractor.");
                return false;
            }
        }

        else if (oPickerobj.winid == 'winBuyers') {
            if (oreturnObjs != null && oreturnObjs.length> 0)
            {
                _sDeliverToIDs='';
                var sMessage='';
                sMessage=(oreturnObjs.length>1)? oreturnObjs.length +" Contractors Selected" : oreturnObjs[0].Name;
                $('#txtDeliverToAdvS').val(sMessage);
                $("#txtDeliverToAdvS").addClass("fontColorOfPickItem");

                for(var i=0;i<oreturnObjs.length;i++){
                    _sDeliverToIDs=_sDeliverToIDs+oreturnObjs[i].ContractorID+',';
                }
                _sDeliverToIDs=_sDeliverToIDs.substring(0,_sDeliverToIDs.length-1);



            }
            else
            {
                alert("Please select a buyer.");
                return false;
            }
        }
        else if (oPickerobj.winid=='winMktAccount')
        {
            if(oreturnObj!=null && parseInt(oreturnObj.MarketingAccountID)>0)
            {
                var txtMktAccount = document.getElementById("txtMktAccount");
                txtMktAccount.style.color = "blue";
                txtMktAccount.style.fontWeight = "bold";
                $('#txtMktAccount').val(oreturnObj.Name);
                _nMktAccountID= oreturnObj.MarketingAccountID;
            }
            else{
                alert("Data Not Found.");
            }
        }
        else if (oPickerobj.winid == 'winProductPicker')
        {
            if (oreturnObjs!= null && oreturnObjs.length> 0)
            {
                _sProductIds=''; var sMessage='';
                sMessage=(oreturnObjs.length>1)? oreturnObjs.length +" ProductName Selected" : oreturnObjs[0].ProductName;
                $('#txtProductName').val(sMessage);
                $("#txtProductName").addClass("fontColorOfPickItem");

                for(var i=0;i<oreturnObjs.length;i++){
                    _sProductIds=_sProductIds+oreturnObjs[i].ProductID+',';
                }
                _sProductIds=_sProductIds.substring(0,_sProductIds.length-1);

            }
            else
            {
                alert("Please select a Product.");
                return false;
            }

        }
        $("#" + oPickerobj.winid).icsWindow("close");
        $("#" + oPickerobj.winid).remove();
    }
    /// end Adv Searching
    function IsAdvance_Yes()
    {
        if($("#chkIsAdvance_Yes").is(":checked")==true)
        {
            $("#chkIsAdvance_Yes").prop("checked", true);
            $("#chkIsAdvance_No").prop("checked", false);
        }
        
    }
    function IsAdvance_No()
    {
        if($("#chkIsAdvance_No").is(":checked")==true)
        {
            $("#chkIsAdvance_Yes").prop("checked", false);
            $("#chkIsAdvance_No").prop("checked", true);
          
        }
    }
  


    $('#btnCreatePI').click(function(e){
        debugger;
        var oSampleInvoice= $('#tblSampleInvoice').datagrid('getSelected');
        if(oSampleInvoice==null || oSampleInvoice.SampleInvoiceID<=0)
        {
            alert("Please select a item from list!");
            return;
        }
        if(oSampleInvoice.ExportPIID>0)
        {
            alert("Please PI already Issue!");
            return;
        }
        var nSelectedIndex=$('#tblSampleInvoice').datagrid('getRowIndex',oSampleInvoice);

        if(!confirm("Confirm To Create PI")) return false;

        $.ajax({
            type: "POST",
            dataType: "json",
            url : _sBaseAddress+"/SampleInvoice/Save_PI",
            traditional: true,
            data:  JSON.stringify(oSampleInvoice),
            contentType: "application/json; charset=utf-8",
            success: function (data) {
                var  oSampleInvoice = jQuery.parseJSON(data);
                debugger;
                if (oSampleInvoice.ErrorMessage == '' || oSampleInvoice.ErrorMessage == null)
                {
                    debugger;
                    $('#tblSampleInvoice').datagrid('updateRow', { index: nSelectedIndex, row: oSampleInvoice });

                }
                else
                {
                    alert(oSampleInvoice.ErrorMessage);
                   
                }
            },
            error: function (xhr, status, error)
            {
                alert(xhr+'~' +status+'~'+error);
            }
        });
    });


    $("#btnPrintFormat").click(function () {
        debugger;
        if(sessionStorage.getItem("QtyFormat")=="true")
        {
            $("#chkInKg").prop( "checked", false );
            $("#chkInLBS").prop( "checked", true );
        }else{
            $("#chkInLBS").prop( "checked", false );
            $("#chkInKg").prop( "checked", true );
        }
        if(parseInt(sessionStorage.getItem("ImageFormat"))==1)
        {
            $("#chkPrintTitleInNormalFormat").prop( "checked",true);
            $("#chkPrintTitlePadFormat").prop( "checked", false );
            $("#chkPrintTitleImageFormat").prop( "checked", false );
        }else if(parseInt(sessionStorage.getItem("ImageFormat"))==2)
        {
            $("#chkPrintTitleInNormalFormat").prop( "checked",false);
            $("#chkPrintTitlePadFormat").prop( "checked", true );
            $("#chkPrintTitleImageFormat").prop( "checked", false );
        }else
        {
            $("#chkPrintTitleInNormalFormat").prop( "checked",false);
            $("#chkPrintTitlePadFormat").prop( "checked", false );
            $("#chkPrintTitleImageFormat").prop( "checked", true );
        }
        $("#winPrintFormat2").icsWindow("open","PI Print Format Setup");
    });

    $("#btnClosePrintFormat2").click(function () {
        $("#winPrintFormat2").icsWindow("close");
    });

    $("#btnOkPrintFormat2").click(function () {
        debugger;
        $("#winPrintFormat2").icsWindow("close");

        if ($("#chkInLBS").is(':checked'))
        {
            sessionStorage.setItem("QtyFormat",true);
        }else{
            sessionStorage.setItem("QtyFormat",false);
        }

        if ($("#chkPrintTitleInNormalFormat").is(':checked'))
        {
            sessionStorage.setItem("ImageFormat",1);//normal
        }else if ($("#chkPrintTitlePadFormat").is(':checked'))
        {
            sessionStorage.setItem("ImageFormat",2);//pad
        }else if ($("#chkPrintTitleImageFormat").is(':checked'))
        {
            sessionStorage.setItem("ImageFormat",3);//with Image
        }
    });

    function IsLBSFormat(bIstrue)
    {
        if(bIstrue)
        {
            $("#chkInKg").prop( "checked", false );
            $("#chkInLBS").prop( "checked", true );
        }else{
            $("#chkInKg").prop( "checked", true );
            $("#chkInLBS").prop( "checked", false );
        }
    }

    function PrintTitleFormat(nPrintTitleFormat)
    {
        if(parseInt(nPrintTitleFormat)==1)//normal
        {
            $("#chkPrintTitleInNormalFormat").prop( "checked", true );
            $("#chkPrintTitlePadFormat").prop( "checked", false );
            $("#chkPrintTitleImageFormat").prop( "checked", false );
        }else  if(parseInt(nPrintTitleFormat)==2)//pad
        {
            $("#chkPrintTitleInNormalFormat").prop( "checked", false );
            $("#chkPrintTitlePadFormat").prop( "checked", true );
            $("#chkPrintTitleImageFormat").prop( "checked", false );
        }else
        {
            $("#chkPrintTitleInNormalFormat").prop( "checked", false );
            $("#chkPrintTitlePadFormat").prop( "checked", false );
            $("#chkPrintTitleImageFormat").prop( "checked", true );
        }
    }



    ///Update PI No
    $("#btnUpdateInvNo ").click(function () {
        debugger;
       
        var oSampleInvoice= $('#tblSampleInvoice').datagrid('getSelected');
        if(oSampleInvoice==null || oSampleInvoice.SampleInvoiceID<=0)
        {
            alert("Please select a item from list!");
            return;
        }
        // var nRowIndex = $('#tblSampleInvoice').datagrid('getRowIndex', oSampleInvoice);
        $('#txtSInvoiceNo_Cur,#txtSInvoiceNo_New').val("");
        $('#txtSInvoiceNo_Cur').val(oSampleInvoice.SampleInvoiceNo);
        $('#txtSInvoiceNo_Cur').prop('disabled',true);
        $("#winSINoChange").icsWindow('open', "Change P/I No");
    });
    $("#btnSaveSInvNo").click(function (e) {
        Save_SINVNo();
    });
    function Save_SINVNo()
    {
        var oSampleInvoice = $("#tblSampleInvoice").datagrid("getSelected");
        var nSelectedIndex= $('#tblSampleInvoice').datagrid('getRowIndex',oSampleInvoice);
        if (oSampleInvoice == null || parseInt(oSampleInvoice.SampleInvoiceID) <= 0) { alert("Please select an item from list!"); return; }
        oSampleInvoice.SampleInvoiceNo=  $.trim($('#txtSInvoiceNo_New').val());
        if(oSampleInvoice.SampleInvoiceNo=="" || oSampleInvoice.SampleInvoiceNo==null)
        {
            alert("Please entry valid No");
            return;
        }

        var obj =
            {
                BaseAddress: _sBaseAddress,
                Object: oSampleInvoice,
                ObjectId: oSampleInvoice.SampleInvoiceID,
                ControllerName: "SampleInvoice",
                ActionName: "UpdateSInvoiceNo",
                TableId: "tblSampleInvoice",
                IsWinClose: false
            };
        $.icsSave(obj, function (response) 
        {
            if (response.status && response.obj != null) 
            {
                if (response.obj.ErrorMessage==""||response.obj.ErrorMessage==null)
                {
                    $("#winSINoChange").icsWindow("close");
                }
                else {
                    alert(response.obj.ErrorMessage);
                }
            }
            else {
                alert("No information found.");
            }
        });
    }
    $("#btnClosePINo").click(function () {
        $("#winSINoChange").icsWindow("close");
    });
    ///New PI No
    $("#txtSInvoiceNo_New").keypress(function (e) {
        if (e.which != 8 && e.which != 0  && e.which != 46  && (e.which < 48 || e.which > 57)) {
            return false;
        }
    });
    // End Update PI No
    $('#btnAddAttachment').click(function (e)
    { 
        var oSampleInvoice= $('#tblSampleInvoice').datagrid('getSelected');
        if(oSampleInvoice==null || oSampleInvoice.SampleInvoiceID<=0)
        {
            alert("Please select a item from list!");
            return;
        }
        //var SelectedRowIndex=$('#tblSampleInvoice').datagrid('getRowIndex',oSampleInvoice);
        //SampleInvoice==25
        window.open(_sBaseAddress + '/AttachDocument/Attachment?id='+parseInt(oSampleInvoice.SampleInvoiceID)+'&RefType=25&OperationInfo= Selected Bill/Invoice No : '+ oSampleInvoice.SampleInvoiceNo, '_blank');
    });

    $("#btnResetMktPerson").click(function () {

        $("#txtMktAccount").val("");
        _nMktAccountID=0;
    });
    $("#btnPickMktAccount").click(function () {
        debugger;
        var sName=$.trim($("#txtMktAccount").val());
        GetMktPersons(sName);
    });
    $("#txtMktAccount").keydown(function (e) {
        var nkeyCode = e.keyCode || e.which;
        if(nkeyCode==13){
            var sName=$.trim($("#txtMktAccount").val());
            GetMktPersons(sName);
        }
        else if(nkeyCode==8){
            $("#txtMktAccount").val("");
            _nMktAccountID=0;
        }
    });
    function GetMktPersons(sName){

        var oMarketingAccount_BU = {
            Name:sName,
            BUID:sessionStorage.getItem("BUID")
        };
        var obj = {
            BaseAddress: _sBaseAddress,
            Object: oMarketingAccount_BU,
            ControllerName: "MarketingAccount",
            ActionName: "MarketingAccountSearchByName",
            IsWinClose: false
        };
        $("#progressbar").progressbar({ value: 0 });
        $("#progressbarParent").show();
        var intervalID = setInterval(updateProgress, 250);

        $.icsDataGets(obj, function (response) {
            clearInterval(intervalID);
            $("#progressbarParent").hide();
            if (response.status && response.objs.length > 0) {
                if (response.objs[0].MarketingAccountID > 0) {
                    debugger;
                    var tblColums = [];
                    var oColumn = { field: "MarketingAccountID", title: "Code", width: 50, align: "left" };tblColums.push(oColumn);
                    oColumn = { field: "Name", title: "Name", width: 250, align: "left" };tblColums.push(oColumn);
                    oColumn = { field: "Phone", title: "Phone", width: 100, align: "left" };tblColums.push(oColumn);

                    var oPickerParam = {
                        winid: 'winMktAccount',
                        winclass:'clsMktPersonPicker',
                        winwidth: 460,
                        winheight: 460,
                        tableid: 'tblMktPersonPicker',
                        tablecolumns: tblColums,
                        datalist: response.objs,
                        multiplereturn: false,
                        searchingbyfieldName:'Name',
                        windowTittle: 'MKT Person List'
                    };
                    $.icsPicker(oPickerParam);
                    IntializePickerbutton(oPickerParam);//multiplereturn, winclassName
                }
                else { alert(response.objs[0].ErrorMessage); }
            }
            else{
                alert("No marketing person found.");
            }
        });


    }

</script>