@{
    ViewBag.Title = "Delivery Challan";
}
@model IEnumerable<ESimSol.BusinessObjects.SUDeliveryChallan>
<head>
    <title>Delivery Challan</title>
    <script src="@Url.Content("~/Views/SUDeliveryChallan/AdvSearch.js")" type="text/javascript"></script>
    <script src="@Url.Content("~/Views/SUDeliveryChallan/SUDeliveryChallan.js")" type="text/javascript"></script>
    <script src="@Url.Content("~/Views/SUDeliveryChallan/SUDeliveryChallans.js")" type="text/javascript"></script>
    <script src="@Url.Content("~/Views/SUReturnChallan/SUReturnChallan.js")" type="text/javascript"></script>
</head>
<body>
    <div id="winPrintFormat1" style="width:300px;" class="easyui-window winstyle" title="Adv. Search" data-options="modal:true,closed:true,collapsible:false,minimizable:false,maximizable:false,closable:false">
        <fieldset>
            <legend>Print Format : </legend>
            <table style="width:100%;">
                <tr>
                    <td>
                        <input id="chkPrintWithUnitPriceAndAmount" type="checkbox" checked /> Print With Unit Price and Amount
                    </td>
                </tr>
            </table>
        </fieldset>
        <fieldset class="actionfieldsetstyle">
            <legend>Actions : </legend>
           @using (Html.BeginForm("PrintDC", "SUDeliveryChallan", FormMethod.Post, new { enctype = "multipart/form-data", target = "_blank", @class = "PrintForm" }))
           {
                <input type="text" name="txtSUDeliveryChallanCollectionList" id="txtSUDeliveryChallanCollectionList" hidden="hidden" />
                <input type="submit" id="btnPrintSUDeliveryChallan" value="  Print List" class="icon-print PrintList" onclick=" return isValidSUDeliveryChallan() " style="margin-top: 4px;" />
           }
            <a id="btnClosePrintFormat1" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-cancel" plain="true">Close</a>
        </fieldset>
    </div>

    <div id="winSUAttachment" class="easyui-window" title="SU Attachments" data-options="modal:true,closed:true,collapsible:false,minimizable:false,maximizable:false,closable:false">
        @using (Html.BeginForm("UploadAttchment", "SUDeliveryChallan", FormMethod.Post, new { enctype = "multipart/form-data", target = "_blank" }))
        {
            <table id="tblSUAttachment" class="easyui-datagrid" style="width:798px;height:350px;margin:0;" data-options="singleSelect: true,fitColumns:false, rownumbers:true, pagination:false, autoRowHeight:false, toolbar: '#toolbarSUAttachment' ">
                <thead>
                    <tr>
                        <th field="AttatchmentName" width="60%">AttatchmentName</th>
                        <th field="Remarks" width="30%">Remarks</th>
                    </tr>
                </thead>
            </table>
            <div id="toolbarSUAttachment">
                <input type="text" name="ObjectID" id="txtSUIdSubmit" hidden="hidden" />
                <input type="file" id="fileControl" name="file" style="width: 200px;" />
                Remark :
                <input id="txtRemarks" name="Remarks" type="text" />
                <input id="btnSubmitSUAttachment" type="submit" value="Upload" style="font-weight: bold;" />
                <input id="btnDeleteSUAttachment" type="button" value="Delete" style="font-weight: bold" />
            </div>
        }
        <fieldset class="actionfieldsetstyle">
            <legend>Actions : </legend>
            <table border="0" cellpadding="2" cellspacing="2">
                <tr>
                    <td style="width:395px; text-align:left">
                        @using (Html.BeginForm("DownloadAttachment", "SUDeliveryChallan", FormMethod.Post, new { enctype = "multipart/form-data", target = "_blank" }))
                        {
                            <input type="text" name="SUAttchmentID" id="txtSUAttchmentID" hidden="hidden" />
                            <input type="submit" value="Download" id="btnDownload" />
                        }
                    </td>
                    <td style="width:395px"><a id="btnCloseSUAttachment" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-cancel" plain="true">Close</a></td>
                </tr>
            </table>
        </fieldset>
    </div>

  

    <div id="winSUReturnChallan" class="easyui-window" title="Return Challan" data-options="modal:true,closed:true,collapsible:false,minimizable:false,maximizable:false,closable:false">
        <fieldset>
            <legend>Return Challan :</legend>
            <table border="0" cellspacing="2" cellpadding="2" class="CaptionStyle">
                <tr>
                    <td style="width:100px; text-align:right">
                        Return No :
                    </td>
                    <td style="">
                        <input type="text" class="enableDisable" style="width:130px;margin-right:3px;float:left;" id="txtReturnNoSUReturnChallan" disabled />

                        <div style="float:right;">
                            DO No :
                            <input type="text" class="enableDisable" style="width:130px;margin-right:3px;" id="txtDONoSUReturnChallan" disabled />
                        </div>
                    </td>
                    <td style="width:100px; text-align:right">
                        Challan No :
                    </td>
                    <td>
                        <input type="text" class="enableDisable" style="width:98%;margin-right:3px;float:left;" id="txtChallanNoSUReturnChallan" disabled />

                    </td>
                </tr>
                <tr>
                    <td style="width:100px; text-align:right">
                        Buyer :
                    </td>
                    <td style="text-align:left">
                        <select id="cboBuyerSUReturnChallan" class="enableDisable" style="width:120px;" disabled></select>
                        <input id="txtSearchByBuyerSUReturnChallan" class="enableDisable" type="text" style="width: 59%;" disabled placeholder="Type & Press Enter" />
                    </td>
                    <td style="width:100px; text-align:right">
                        <label style="width:150px;">Return Date :</label>
                    </td>
                    <td>
                        <input id="txtReturnDateSUReturnChallan" type="text" style="width:210px;" disabled class="easyui-datebox enableDisable" required="required" data-options="formatter:icsdateformat,parser:icsdateparser" />
                    </td>
                </tr>
                <tr>
                    <td style="width:100px; text-align:right">
                        Party Challan No :
                    </td>
                    <td>
                        <input id="txtPartyChallanNoSUReturnChallan" type="text" style="width:98%;" />
                    </td>
                    <td style="width:100px; text-align:right">
                        <label style="width:150px;">Receive Store : </label>
                    </td>
                    <td>
                        <select id="cboFinishGoodsStoreSUReturnChallan" class="enableDisable" style="width:100%;" disabled></select>
                    </td>
                </tr>
                <tr>
                    <td style="width:100px; text-align:right">
                        Remarks :
                    </td>
                    <td colspan="3">
                        <input id="txtRemarksSUReturnChallan" type="text" style="width:98%;" />
                    </td>
                </tr>
            </table>
        </fieldset>
        <div style="margin-left:2px; margin-top:2px">
            <table id="tblSUReturnChallanDetails" title="Item Description" class="easyui-datagrid" style="width:850px;height:300px;" fitcolumns="false" rownumbers="true" pagination="false" singleselect="true" autorowheight="false" toolbar="#toolbarSUReturnChallanDetail" data-options="onClickRow: onClickRowSUDC1">
                <thead>
                    <tr>
                        <th field="ProductCode" width="15%" align="left">Code</th>
                        <th field="ProductName" width="25%" align="left">Item Description</th>
                        <th field="LotNo" width="12%" align="left">Lot No</th>
                        <th data-options="field:'Qty',align:'right',editor:{type:'numberbox',options:{precision:2}}" width="15%" align="right">Qty(kG)</th>
                        <th field="QtyLbsSt" width="15%" align="right">Qty(LBS)</th>
                        <th field="SUDCDQty" width="17%" align="right">Delivery Qty</th>
                    </tr>
                </thead>
            </table>
            <div id="toolbarSUReturnChallanDetail">
                <a id="btnRefreshSUReturnChallanDetail" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-reload" plain="true">Refresh</a>
                <a id="btnProductRemoveSUReturnChallanDetail" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-remove" plain="true">Remove</a>
            </div>
        </div>
        <table border="0">
            <tr>
                <td style="width:400px;"></td>
                <td id="tdTotalCaption" style="text-align: right; font-size: 12px; font-weight:bold"> Total : </td>
                <td style="width: 100px; text-align: right; font-size: 12px">
                    <label id="lblTotalQty" class="lblTotalQty" style="text-align: right; font-size:12px; font-weight:bold;">0.00</label>
                    <label style="font-weight:bold;">(KG)</label>
                </td>
                <td style="width: 124px; text-align: right; font-size: 12px">
                    <label id="lblTotalQtyLbs" class="lblTotalQtyLbs" style="text-align: right; font-size:12px; font-weight:bold;">0.00</label>
                    <label style="font-weight:bold;">(LBS)</label>
                </td>
                <td style="width: 124px; text-align: right; font-size: 12px">
                    <label id="lblTotalSUDCDQty" style="text-align: right; font-size:12px; font-weight:bold;">0.00</label>
                </td>
            </tr>
        </table>
        <fieldset class="actionfieldsetstyle">
            <legend style="font-weight:bold"> Action : </legend>
            <a id="btnSaveSUReturnChallan" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-save" plain="true">Save</a>
            <a id="btnReceiveSUReturnChallan" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-save" plain="true">Disburse</a>
            <a id="btnApproveSUReturnChallan" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-save" plain="true">Approve</a>
            <a id="btnCloseSUReturnChallan" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-cancel" plain="true">Close</a>
        </fieldset>
    </div>
    <div id="winAdvSearchSUDeliveryChallan" class="easyui-window winstyle" title="Adv. Search" data-options="modal:true,closed:true,collapsible:false,minimizable:false,maximizable:false,closable:false">
        <table class="tblAdvSearch">
            <tr>
                <td>
                    <fieldset style="margin-bottom: 0px;" class="abc">
                        <legend>Searching Criteria</legend>
                        <table class="tblASWrapper">
                            <tr>
                                <td style="text-align:right;">
                                    <label>DO No :</label>
                                </td>
                                <td>
                                    <input id="txtDONoAdvSearch" type="text" />
                                </td>
                            </tr>
                            <tr>
                                <td style="text-align:right;">
                                    <label>Buyer :</label>
                                </td>
                                <td class="oneTextTwoButton">
                                    <input id="txtSearchByBuyersAdvSearch" type="text" placeholder="Type & Press Enter" />
                                    <input id="btnClrSearchByBuyersAdvSearch" type="button" value="C" />
                                    <input id="btnPickSearchByBuyersAdvSearch" type="button" value="P" />
                                </td>
                            </tr>
                            <tr>
                                <td style="text-align:right;">
                                    <label>LC No :</label>
                                </td>
                                <td>
                                    <input id="txtLCNoAdvSearch" type="text" />
                                </td>
                            </tr>
                            <tr>
                                <td style="text-align:right;">
                                    <label>PI No :</label>
                                </td>
                                <td>
                                    <input id="txtPINoAdvSearch" type="text" />
                                </td>
                            </tr>
                            <tr>
                                <td style="text-align:right;">
                                    <label>MKT Person :</label>
                                </td>
                                <td>
                                    <select id="cboMKTPersonAdvSearch"></select>
                                </td>
                            </tr>
                            <tr>
                                <td style="text-align:right;">
                                    <label>DO Type :</label>
                                </td>
                                <td>
                                    <select id="cboDOTypeAdvSearch"></select>
                                </td>
                            </tr>
                            <tr>
                                <td height="10" colspan="2"></td>
                            </tr>
                            <tr>
                                <td colspan="2">
                                    <table>
                                        <tr>
                                            <td style="padding-top: 6px;">
                                                <input id="chkDODate" type="checkbox" style="margin: 0;" onchange="ChangeDODates();" />
                                            </td>
                                            <td style="text-align:right;width: 80px;">
                                                DO Date :
                                            </td>
                                            <td style="text-align:right;">
                                                <input id="txtFromDODateAdvSearch" type="text" style="width: 100px;" class="easyui-datebox" required="required" data-options="formatter:icsdateformat,parser:icsdateparser" />
                                                <label style="margin:0 10px 0 10px;">To</label>
                                                <input id="txtToDODateAdvSearch" type="text" style="width: 100px;" class="easyui-datebox" required="required" data-options="formatter:icsdateformat,parser:icsdateparser" />
                                            </td>
                                        </tr>
                                    </table>
                                </td>
                            </tr>
                            <tr>
                                <td height="10" colspan="2"></td>
                            </tr>
                            <tr>
                                <td colspan="2">
                                    <table>
                                        <tr>
                                            <td style="padding-top: 6px;">
                                                <input id="chkDeliveryDate" type="checkbox" style="margin: 0;" onchange="ChangeChallanDates();" />
                                            </td>
                                            <td style="text-align:right;width: 80px;">
                                                Challan Date :
                                            </td>
                                            <td style="text-align:right;">
                                                <input id="txtFromChallanDateAdvSearch" type="text" style="width: 100px;" class="easyui-datebox" required="required" data-options="formatter:icsdateformat,parser:icsdateparser" />
                                                <label style="margin:0 10px 0 10px;">To</label>
                                                <input id="txtToChallanDateAdvSearch" type="text" style="width: 100px;" class="easyui-datebox" required="required" data-options="formatter:icsdateformat,parser:icsdateparser" />
                                            </td>
                                        </tr>
                                    </table>
                                </td>
                            </tr>
                            <tr>
                                <td height="20" colspan="2"></td>
                            </tr>
                            <tr>
                                <td class="btnResetSearch" colspan="2">
                                    <input id="btnResetAdvSearch" type="button" value="Reset" />
                                    <input id="btnSearchAdvSearch" type="button" value="Search" />
                                </td>
                            </tr>
                        </table>
                    </fieldset>
                </td>
                <td>
                    <div style="margin-top: 6px;">
                        <table id="tblSUDeliveryChallanAdvSearch" class="easyui-datagrid" title="Delivery Challan(s)" style="width: 450px; height: 335px;" data-options="singleSelect: false,fitColumns:false, rownumbers:true, pagination:false, autoRowHeight:false, ">
                            <thead>
                                <tr>
                                    <th data-options="field:'Selected',checkbox:true"></th>
                                    <th field="ChallanNo" width="30%">Challan No</th>
                                    <th field="BuyerName" width="20%">Buyer</th>
                                    <th field="ChallanDateSt" width="20%" align="center">Challan Date</th>
                                    <th field="QtySt" width="15%" align="right">Qty</th>
                                </tr>
                            </thead>
                        </table>
                    </div>
                </td>
            </tr>
        </table>
        <fieldset class="actionfieldsetstyle">
            <legend>Actions : </legend>
            <label class="lblLoadingMessage" style="float:left;">Loading Please Wait...</label>
            <a id="btnOkAdvSearch" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-ok" plain="true">Ok</a>
            <a id="btnCloseAdvSearch" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-cancel" plain="true">Close</a>
        </fieldset>
    </div>
    <div id="winBuyerPickerAdvSearch" class="easyui-window" title="Contractor" data-options="modal:true,closed:true,collapsible:false,minimizable:false,maximizable:false,closable:false">
        <div id="divBuyerPickerAdvSearch" tabindex="-1">
            <table id="tblBuyersPickerAdvSearch" class="easyui-datagrid" style="width: 400px; height: 350px; margin: 0;"
                   data-options="singleSelect: true,fitColumns:false, rownumbers:true, pagination:false, autoRowHeight:false, toolbar: '#toolbarBuyerPickerAdvSearch' ">
                <thead>
                    <tr>
                        <th field="Name" width="240" align="left">Name</th>
                        <th field="ContractorTypeInString" width="150" align="left">Type</th>
                    </tr>
                </thead>
            </table>
            <div id="toolbarBuyerPickerAdvSearch">
                <input id="txtSearchByBuyerNamePickerAdvSearch" class="txtPickerSearchInputField" type="text" placeholder="Search by name" />
            </div>
        </div>
        <fieldset class="actionfieldsetstyle">
            <legend>Actions : </legend>
            <a id="btnOkBuyerPickerAdvSearch" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-ok" plain="true">Ok</a>
            <a id="btnCloseBuyerPickerAdvSearch" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-cancel" plain="true">Close</a>
        </fieldset>
    </div>
    <div id="winLotAssignSUDeliveryChallan" class="easyui-window" title="Lot List" data-options="modal:true,closed:true,collapsible:false,minimizable:false,maximizable:false,closable:false">
        <div id="divLotAssign" tabindex="-1">
            <table id="tblLotAssign" class="easyui-datagrid" title="Lot List" style="width: 500px; height: 350px; margin: 0;"
                   data-options="singleSelect: true,fitColumns:false, rownumbers:true, pagination:false, autoRowHeight:false">
                <thead>
                    <tr>
                        <th field="LotNo" width="20%" align="left">Lot No</th>
                        <th field="Balance" width="20%" align="right">Balance Qty</th>
                        <th field="UnitPrice" width="25%" align="right">Unit Price</th>
                        <th field="Amount" width="25%" align="right">Amount</th>
                    </tr>
                </thead>
            </table>
        </div>
        <fieldset class="actionfieldsetstyle">
            <legend>Actions : </legend>
            <a id="btnOkLotAssign" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-ok" plain="true">Ok</a>
            <a id="btnCloseLotAssign" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-cancel" plain="true">Close</a>
        </fieldset>
    </div>
    <div id="winSUDeliveryChallan" class="easyui-window" title="Delivery Challan" data-options="modal:true,closed:true,collapsible:false,minimizable:false,maximizable:false,closable:false">
        <fieldset>
            <legend>Delivery Challan :</legend>
            <table border="0" cellspacing="2" cellpadding="2" class="CaptionStyle">
                <tr>
                    <td style="width:100px; text-align:right">
                        Challan No :
                    </td>
                    <td style="">
                        <input type="text" style="width:130px;margin-right:3px;float:left;" id="txtChallanNoSUDeliveryChallan" disabled />
                        <div style="float:right;">
                            DO No :
                            <input type="text" style="width:130px;margin-right:3px;" id="txtDONoSUDeliveryChallan" disabled />
                        </div>
                    </td>
                    <td style="width:200px; text-align:right">
                        Challan Date :
                    </td>
                    <td>
                        <input id="txtChallanDateSUDeliveryChallan" type="text" style="width:210px;" class="easyui-datebox enableDisable" required="required" data-options="formatter:icsdateformat,parser:icsdateparser" />
                    </td>
                </tr>
                <tr>
                    <td style="width:100px; text-align:right">
                        Buyer :
                    </td>
                    <td style="text-align:left">
                        <select id="cboBuyerSUDeliveryChallan" class="enableDisable" style="width:120px;"></select>
                        <input id="txtSearchByBuyerSUDeliveryChallan" class="enableDisable" type="text" style="width: 59%;" placeholder="Type & Press Enter" />
                    </td>
                    <td style="width:200px; text-align:right">
                        <label style="width:150px;">Goods Checked By :</label>
                    </td>
                    <td>
                        <select id="cboGoodsCheckedBySUDeliveryChallan" style="width:100%;"></select>
                    </td>
                </tr>
                <tr>
                    <td style="width:100px; text-align:right">
                        Deliver To :
                    </td>
                    <td style="text-align:left">
                        <select id="cboDeliveryToSUDeliveryChallan" class="enableDisable" style="width:120px;"></select>
                        <input id="txtSearchByDeliveryToSUDeliveryChallan" class="enableDisable" type="text" style="width: 59%;" placeholder="Type & Press Enter" />
                    </td>
                    <td style="text-align:right">
                        <label style="width:150px;">Finish Goods Store : </label>
                    </td>
                    <td>
                        <select id="cboFinishGoodsStoreSUDeliveryChallan" style="width:100%;"></select>
                    </td>
                </tr>
                <tr>
                    <td style="width:100px; text-align:right">
                        Driver Name :
                    </td>
                    <td>
                        <input id="txtDriverNameSUDeliveryChallan" type="text" style="width:37%;" />
                        <div style="float:right;">
                            <label>Mobile No :</label>
                            <input id="txtDriverContactNoSUDeliveryChallan" type="text" style="width:63%;" />
                        </div>
                    </td>
                    <td style="width:200px; text-align:right">
                        Vehicle No :
                    </td>
                    <td>
                        <input id="txtVehicleNoSUDeliveryChallan" type="text" style="width:98%;" />
                    </td>
                </tr>
                <tr>
                    <td style="width:100px; text-align:right">
                        Remarks :
                    </td>
                    <td>
                        <input id="txtRemarksSUDeliveryChallan" type="text" style="width:37%;margin-right:5px;" />
                        S. Phone No :
                        <input id="txtStorePhoneNoSUDeliveryChallan" type="text" style="width:37%;" />
                    </td>
                    <td style="width:200px; text-align:right">
                        Gate Pass No :
                    </td>
                    <td>
                        <input id="txtGatePassNoSUDeliveryChallan" type="text" style="width:98%;" />
                    </td>
                </tr>
            </table>
        </fieldset>
        <div style="margin-left:2px; margin-top:2px">
            <table id="tblSUDeliveryChallanDetails" title="Item Description" class="easyui-datagrid" style="width:917px;height:300px;" fitcolumns="false" rownumbers="true" pagination="false" singleselect="true" autorowheight="false" toolbar="#toolbarSUDeliveryChallanDetail" data-options="onClickRow: onClickRowSUDC">
                <thead>
                    <tr>
                        <th field="ProductCode" width="10%" align="left">Code</th>
                        <th field="ProductName" width="25%" align="left">Item Description</th>
                        <th field="LotNoWithStore" width="18%" align="left">Lot No</th>
                        <th data-options="field:'Qty',align:'right',editor:{type:'numberbox',options:{precision:2}}" width="12%" align="right">Qty(kG)</th>
                        <th field="QtyLbsSt" width="12%" align="right">Qty(LBS)</th>
                        <th field="ProgramQty" width="12%" align="right">Program Qty(KG)</th>
                        <th data-options="field:'Bags',align:'right',editor:{type:'numberbox',options:{precision:2}}" width="10%" align="right">Bags</th>
                    </tr>
                </thead>
            </table>
            <div id="toolbarSUDeliveryChallanDetail">
                <a id="btnLotAssignSUDeliveryChallanDetail" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-redo" plain="true">Lot Assign</a>
                <a id="btnRefreshSUDeliveryChallanDetail" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-reload" plain="true">Refresh</a>
                <a id="btnProductRemoveSUDeliveryChallanDetail" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-remove" plain="true">Remove</a>
                <a id="btnCopyItemSUDeliveryChallanDetail" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-copy" plain="true">Copy Item</a>
            </div>
        </div>
        <table border="0">
            <tr>
                <td style="width:452px;"></td>
                <td id="tdTotalCaption" style="text-align: right; font-size: 12px; font-weight:bold"> Total : </td>
                <td style="width: 100px; text-align: right; font-size: 12px">
                    <label id="lblTotalQty" class="lblTotalQty" style="text-align: right; font-size:12px; float: right; font-weight:bold">0.00</label>
                </td>
                <td style="width: 108px; text-align: right; font-size: 12px">
                    <label id="lblTotalQtyLbs" class="lblTotalQtyLbs" style="text-align: right; font-size:12px; float: right; font-weight:bold">0.00</label>
                </td>
                <td style="width: 99px; text-align: right; font-size: 12px">
                    <label id="lblTotalProgramQty" style="text-align: right; font-size:12px; float: right; font-weight:bold">0.00</label>
                </td>
                <td style="width: 90px; text-align: right; font-size: 12px">
                    <label id="lblTotalBags" style="text-align: right; font-size:12px; float: right; font-weight:bold">0.00</label>
                </td>
            </tr>
        </table>
        <fieldset class="actionfieldsetstyle">
            <legend style="font-weight:bold"> Action : </legend>
            <a id="btnSaveSUDeliveryChallan" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-save" plain="true">Save</a>
            <a id="btnDisburseSUDeliveryChallan" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-save" plain="true">Disburse</a>
            <a id="btnApproveSUDeliveryChallan" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-save" plain="true">Approve</a>
            <a id="btnCloseSUDeliveryChallan" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-cancel" plain="true">Close</a>
        </fieldset>
    </div>
    <div class="menuMainCollectionTable">
        <table id="tblSUDeliveryChallans" title="Delivery Challan" class="easyui-datagrid" fit="true" fitcolumns="true" rownumbers="true" pagination="false" singleselect="true" autorowheight="false" toolbar="#toolbarSUDeliveryChallan">
            <thead>
                <tr>
                    <th field="ChallanNo" width="15%">Challan No</th>
                    <th field="DONo" width="15%">DO No</th>
                    <th field="ChallanDateSt" width="10%" align="center">Challan Date</th>
                    <th field="ChallanStatusSt" width="10%">Status</th>
                    <th field="BuyerName" width="20%">Buyer</th>
                    <th field="DeliveryToName" width="20%">Delivered To</th>
                    <th field="DBUserName" width="15%">Created By</th>
                    <th field="ApprovedByName" width="20%">Approved By</th>
                    <th field="DeliveredByName" width="20%">Disbursed By</th>
                    <th field="QtySt" width="10%" align="right">Qty</th>
                    <th field="TotalAttachmentWithDcID" width="12%" align="center" formatter="ShowAttachments">Total Attachment</th>
                </tr>
            </thead>
        </table>
        <div id="toolbarSUDeliveryChallan">
            <table>
                <tr>
                    <td>
                        <input id="txtSearchByChallanNoSUDeliveryChallan" type="text" placeholder="Search by Challan No" style="width: 130px;" />
                        <input id="txtSearchByDoNoSUDeliveryChallan" type="text" placeholder="Search by DO No" style="width: 125px;" />
                        <input id="chkDeliveryComplete" type="checkbox"/>Delivery Complete
                        <input id="txtChallanDateSUDeliveryChallansFrom" type="text" class="easyui-datebox" data-options="formatter:icsdateformat,parser:icsdateparser" style="width:100px;float:left" />
                        To
                        <input id="txtChallanDateSUDeliveryChallansTo" type="text" class="easyui-datebox" data-options="formatter:icsdateformat,parser:icsdateparser" style="width:100px;float:left" />
                        <a id="btnSearchByDateSUDeliveryChallans" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-search" plain="true"></a>
                        <a id="btnAdvSearchSUDeliveryChallan" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-search" plain="true">Adv. Search</a>
                        <a id="btnPendingChallanSUDeliveryChallan" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-reload" plain="true">Pending Challan</a>
                        <a id="btnWaitingApprovalSUDeliveryChallan" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-reload" plain="true">Waiting For Approval</a>
                        <a id="btnEditSUDeliveryChallan" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-edit" plain="true">Edit</a>
                        <a id="btnViewSUDeliveryChallan" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-details" plain="true">Details</a>
                        <a id="btnDeleteSUDeliveryChallan" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-remove" plain="true">Delete</a>
                        <a id="btnChallanApproveSUDeliveryChallan" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-approved" plain="true">Approve</a>
                        <a id="btnChallanUndoApproveSUDeliveryChallan" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-undo" plain="true">Undo Approve</a>
                    </td>
                    <td>
                </tr>
                <tr>
                    <td>
                        <a id="btnChallanDisburseSUDeliveryChallan" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-disburse" plain="true">Challan Disburse</a>
                        <a id="btnReturnChallanSUDeliveryChallan" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-add" plain="true">Return Challan</a>
                        <a id="btnAttachment" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-attachment" plain="true">Attachment</a>
                        <a id="btnPreviewSUDeliveryChallan" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-print" plain="true">Preview</a>
                        <a id="btnPrintSUDC" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-print" plain="true">Print List</a>
                        @*<a id="btnDeliveryCompleteSUDeliveryChallan" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-print" plain="true">Delivery Complete</a>*@
                        
                        
                        
                        @using (Html.BeginForm("PrintDeliveryComplete", "SUDeliveryChallan", FormMethod.Post, new { enctype = "multipart/form-data", target = "_blank", @class = "PrintForm" }))
                        {
                            <input type="text" name="txtDeliveryComplete" id="txtDeliveryComplete" hidden="hidden" />
                            <input type="submit" id="btnDeliveryCompleteSUDeliveryChallan" value="  Delivery Complete" class="icon-print PrintList" onclick=" return isValidDeliveryComplete() " style="margin-top: 4px;" />
                        }
                    </td>
                </tr>
            </table>
        </div>
    </div>
</body>

<style type="text/css">
        .tblAdvSearch .tblASWrapper {
            width: 360px;
        }
       
        .tblAdvSearch .tblASWrapper input[type="text"] {
            width: 97%;
        }
        .tblAdvSearch .tblASWrapper select {
            width: 99%;
        }
        .tblAdvSearch .oneTextTwoButton input[type='text']{
            width: 72%;
        }
        .tblAdvSearch .oneTextTwoButton input[type='button']{
            width: 11%;
        }
        .btnResetSearch input[type="button"] {
            width: 20%;
        }
        #btnSearchAdvSearch {
            float: right;
        }
</style>

<script type="text/javascript">
    var _sBaseAddress = null;
    var _oCurrentUser = null;
    var _oSUDeliveryChallan = null;
    var _oSUDeliveryChallans = [];
    var _oContractorTypes=[];
    var _oMktPersons=[];
    var _oCurrencys=[];
    var _oDOTypes=[];
    var _oReceivedStores=[];
    var _oContractorTypes=[];
    var _oCheckedByUsers=[];
    var _oSUReturnChallan = null;
    var _oSUDeliveryChallanRPTSetups=[];
    $(document).ready(function () {
        _sBaseAddress =@Html.Raw( new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(HttpContext.Current.Session[SessionInfo.BaseAddress]));
        _oCurrentUser=@Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(HttpContext.Current.Session[SessionInfo.CurrentUser]));
        _oSUDeliveryChallans =@Html.Raw( new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(Model));
        _oContractorTypes = @Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(ViewBag.ContractorTypes));
        _oMktPersons = @Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(ViewBag.MktPersons));
        _oCurrencys = @Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(ViewBag.Currencys));
        _oDOTypes = @Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(ViewBag.DOTypes));
        _oReceivedStores = @Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(ViewBag.ReceivedStores));
        _oContractorTypes = @Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(ViewBag.ContractorTypes));
        _oCheckedByUsers = @Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(ViewBag.CheckedByUsers));
        _oSUDeliveryChallanRPTSetups = @Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(ViewBag.SUDeliveryChallanRPTSetups));

        $(".easyui-datebox").datebox({ disabled: false });
        $(".easyui-datebox").datebox("setValue", icsdateformat(new Date()));
        InitializeAdvSearchSUDeliveryChallanEvents();
        InitializeSUDeliveryChallanEvents();
        InitializeSUDeliveryChallansEvents();
        InitializeSUReturnChallanEvents();
        $("#txtSearchByChallanNoSUDeliveryChallan").focus();

    });
    $(document).keydown(function (e) { if (e.keyCode == 27) { $('div').icsWindow('close'); } });

    $("#btnPrintSUDC").click(function(){
        $("#winPrintFormat1").icsWindow("open","Print Format");
    });

    $("#btnClosePrintFormat1").click(function(){
        $("#winPrintFormat1").icsWindow("close");
    });

    $("#btnPrintListSUDeliveryChallan").click(function(){
        var tblColums = []; var oColumn = { field: "Value", title: "Fields Name", width: "90%", align: "left" }; tblColums.push(oColumn);
        var oPickerParam = {
            winid: 'winPrintListSetups',
            winclass: 'clsPrintListSetup',
            winwidth: 300,
            winheight: 400,
            tableid: 'tblPrintListSetups',
            tablecolumns: tblColums,
            datalist: _oSUDeliveryChallanRPTSetups,
            multiplereturn: true,
            allChecked : true,
            windowTittle: 'Print List Setup',
            searchOption : false,
            btnOkText : "Print"
        };
        $.icsPicker(oPickerParam);
        IntializePickerbuttonSUDC(oPickerParam);
    });

    function IntializePickerbuttonSUDC(oPickerobj) {
        $("#" + oPickerobj.winid).find("#btnOk").click(function () {
            SetPickerValueAssignSUDC(oPickerobj);
        });
        $(document).find('.' + oPickerobj.winclass).keydown(function (e) {
            if (e.which === 13) {
                SetPickerValueAssignSUDC(oPickerobj);
            }
        });
    }

    function SetPickerValueAssignSUDC(oPickerobj) {
        var oreturnObj = null, oreturnObjs = [];
        if (oPickerobj.multiplereturn) {
            oreturnObjs = $('#' + oPickerobj.tableid).datagrid('getChecked');
        } else {
            oreturnObj = $('#' + oPickerobj.tableid).datagrid('getSelected');
        }

        if (oPickerobj.winid == 'winPrintListSetups') {
            if(oreturnObjs.length > 0)
            {
                var sPrintSetupValues = "";
                for(var i=0;i<oreturnObjs.length;i++)
                {
                    sPrintSetupValues = oreturnObjs[i].id + "," + sPrintSetupValues;
                }
                sPrintSetupValues = sPrintSetupValues.substring(0, sPrintSetupValues.length - 1);

                var sSUDeliveryChallanIDs = "";
                var oSUDeliveryChallans = $("#tblSUDeliveryChallans").datagrid("getRows");
                for(var i=0;i<oSUDeliveryChallans.length;i++)
                {
                    if(typeof oSUDeliveryChallans[i].SUDeliveryChallanID != undefined)
                    {
                        sSUDeliveryChallanIDs = oSUDeliveryChallans[i].SUDeliveryChallanID + "," + sSUDeliveryChallanIDs;
                    }
                }
                sSUDeliveryChallanIDs = sSUDeliveryChallanIDs.substring(0, sSUDeliveryChallanIDs.length - 1);

                var oSUDeliveryChallan={
                    Params : sPrintSetupValues,
                    SUDeliveryChallanIDs : sSUDeliveryChallanIDs
                };

                $.ajax({
                    type: "POST",
                    dataType: "json",
                    url: _sBaseAddress + "/SUDeliveryChallan/PrintDC",
                    traditional: true,
                    data: JSON.stringify(oSUDeliveryChallan),
                    contentType: "application/json; charset=utf-8",
                    success: function (data) {
                    },
                    error: function (xhr, status, error) {
                        alert(error);
                    }
                });
            }
            else
            {
                alert("Select minimum one item.");
                return false;
            }
        }
        $("#" + oPickerobj.winid).icsWindow("close");
        $("#" + oPickerobj.winid).remove();
    }

    $("#btnClosePrintListSetup").click(function(){
        $("#winPrintListSetup").icsWindow("close");
    });

    function ShowAttachments(value)
    {
        if(typeof value != "undefined")
        {
            var nTotalAttachment = value.split("~")[0];
            var nSUDCID = value.split("~")[1];
            var s = "";
            if(parseFloat(nTotalAttachment) > 0)
            {
                s = '<a href="javascript:void(0)" onclick = "OpenAttachmentPicker('+nSUDCID+')"">'+nTotalAttachment+'</a>';
            }else
            {
                s = nTotalAttachment;
            }
            return s;
        }
        return "";
    }

    function OpenAttachmentPicker(nSUDCID)
    {
        if(nSUDCID>0)
        {
            var oSU = {
                SUDeliveryChallanID : nSUDCID
            };
            if(oSU==null || parseInt(oSU.SUDeliveryChallanID)<=0)
            {
                alert("Please select an item from list!");
                return;
            }
            var oSUAttachment = {
                ObjectID : oSU.SUDeliveryChallanID,
                ObjectType : 2 //SUDeliveryChallan
            };
            $.ajax({
                type: "POST",
                url: _sBaseAddress + "/SUDeliveryChallan/GetsAttachmentById",
                traditional: true,
                data: JSON.stringify(oSUAttachment),
                contentType: "application/json; charset=utf-8",
                success: function (data) {
                    var oSUAttachments = jQuery.parseJSON(data);
                    if (oSUAttachments != null) {
                        if (oSUAttachments.length > 0) {
                            DynamicRefreshList(oSUAttachments, "tblSUAttachment");
                        }
                        else {
                            DynamicRefreshList([], "tblSUAttachment");
                        }
                    }
                }
            });
            $("#txtSUIdSubmit").val('0');
            $("#txtRemarks").val('');
            $("#fileControl").val('');
            $("#winSUAttachment").icsWindow("Open","Delivery Order Attachments");
        }
    }








    //File Attachment



    $("#btnCloseSUAttachment").click(function() {
        $("#winSUAttachment").icsWindow("close");
    });

    $("#btnDownload").click(function() {
        var oSUAttachment = $("#tblSUAttachment").datagrid("getSelected");
        if (oSUAttachment == null || parseInt(oSUAttachment.SUAttachmentID) <= 0) {
            alert("Please select an item from list!");
            return false;
        }
        $('#txtSUAttchmentID').val(oSUAttachment.SUAttachmentID);
    });

    $("#btnDeleteSUAttachment").click(function() {
        var oSUAttachment = $("#tblSUAttachment").datagrid("getSelected");
        if (oSUAttachment == null || parseInt(oSUAttachment.SUAttachmentID) <= 0) {
            alert("Please select an item from list!");
            return false;
        }
        if (!confirm("Confirm to Delete?")) return false;

        var obj = {
            BaseAddress: _sBaseAddress,
            Object: oSUAttachment,
            ControllerName: "SUDeliveryOrder",
            ActionName: "DeleteSUAttachment",
            TableId: "tblSUAttachment",
            IsWinClose: false
        };
        $.icsDelete(obj);
    });

    $("#btnSubmitSUAttachment").click(function(e) {
        var oSUDO = $("#tblSUDeliveryChallans").datagrid("getSelected");
        $("#txtSUIdSubmit").val(oSUDO.SUDeliveryChallanID);
        $("#winSUAttachment").icsWindow("close");
    });

    $("#btnAttachment").click(function() {
        var oSU = $("#tblSUDeliveryChallans").datagrid('getSelected');
        if(oSU==null || parseInt(oSU.SUDeliveryChallanID)<=0)
        {
            alert("Please select an item from list!");
            return;
        }
        var oSUAttachment = {
            ObjectID : oSU.SUDeliveryChallanID,
            ObjectType : 2 //SUDeliveryChallan
        };
        $.ajax({
            type: "POST",
            url: _sBaseAddress + "/SUDeliveryChallan/GetsAttachmentById",
            traditional: true,
            data: JSON.stringify(oSUAttachment),
            contentType: "application/json; charset=utf-8",
            success: function (data) {
                var oSUAttachments = jQuery.parseJSON(data);
                if (oSUAttachments != null) {
                    if (oSUAttachments.length > 0) {
                        DynamicRefreshList(oSUAttachments, "tblSUAttachment");
                    }
                    else {
                        DynamicRefreshList([], "tblSUAttachment");
                    }
                }
            }
        });
        $("#txtSUIdSubmit").val('0');
        $("#txtRemarks").val('');
        $("#fileControl").val('');
        $("#winSUAttachment").icsWindow("Open","Delivery Order Attachments");
    });
</script>
