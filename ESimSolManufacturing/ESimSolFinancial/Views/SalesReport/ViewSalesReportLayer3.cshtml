@{
    ViewBag.Title = "Sales Report Layer3";
}
@model IEnumerable<ESimSol.BusinessObjects.SalesReport>
    <div class="menuMainCollectionTable" style="height:450px">
        <table id="tblSalesReportLayer3" title="Sales Report Details Layer 3 | Marketing Person : @ViewBag.MktPersonName" class="easyui-datagrid" fit="true" fitcolumns="true" rownumbers="true" pagination="false" showfooter="true" singleselect="true" autorowheight="false" toolbar="#toolbar">
            <thead>
                <tr>
                    <th field="RefDateInString" width="10%" align="left">Ref. Date</th>
                    <th field="RefNo" width="15%" align="left">Ref. No</th>
                    <th field="RefName" width="18%" align="left">Ref. Name</th>                   
                    <th field="Qty" width="10%" align="right" formatter="formatPrice">Qty</th>
                    <th field="QTYDC" width="10%" align="right" formatter="formatPrice">Delivery Qty</th>
                    <th field="MUnitName" width="8%" align="center">MUnit</th>
                    <th field="ValueST" width="12%" align="right">Value</th>
                </tr>
            </thead>
        </table>
        <div id="toolbar">
            <a id="btnPrintList" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-print" plain="true">Export To Pdf</a>
            @*<a id="btnPrint" href="javascript:void(0)" class="easyui-linkbutton"  iconcls="icon-print" plain="true">Print</a>*@
        </div>
    </div>
    <div style="display:block;overflow:hidden;height:100px">
        <fieldset>
            <legend style="font-weight: bold">Action : </legend>
            <table border="0" cellspacing="2" cellpadding="2" style="font-size: 11px; font-weight: bold; width:100%">
                <tr>
                    <td style="width:60%; text-align:right"></td>
                    <td style="width:40%;text-align:right;">
                        <a id="btnClose" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-cancel" plain="true">Close</a>
                    </td>
                </tr>
            </table>
        </fieldset>
    </div>

<script>
    var MktPersonStatus = [];
    var Params = [];
    $(document).ready(function () {
        debugger;
        var oSalesReportLayer3s =@Html.Raw( new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(Model));
        var sBaseAddress =@Html.Raw( new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(HttpContext.Current.Session[SessionInfo.BaseAddress]));       
        MktPersonStatus = @Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(ViewBag.MktPersonName));
        Params = @Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(ViewBag.Parameters));
        $('#tblSalesReportLayer3').data('SalesReport',oSalesReportLayer3s);
        $('#tblSalesReportLayer3').data('BaseAddress', sBaseAddress);

        //var oTempProductionSteps=sessionStorage.getItem("SUFPProductionStep");
        RefreshList(oSalesReportLayer3s);

    });

    function RefreshList(oSalesReportLayer3s) {
        debugger;
        if(oSalesReportLayer3s[0].ErrorMessage!=""){
            alert("No Data Found");
            DynamicRefreshList([], "tblSalesReportLayer3");
            var win  = window.open("","_self");
            win.close();
        }
        data={"total":""+oSalesReportLayer3s.length+"","rows":oSalesReportLayer3s};
        $('#tblSalesReportLayer3').datagrid('loadData',data);
        var nSelectedRowIndex =parseInt(sessionStorage.getItem("SelectedRowIndex"));
        if(nSelectedRowIndex!=-1)
        {
            $('#tblSalesReportLayer3').datagrid('selectRow', nSelectedRowIndex);
        }
        $.icsMakeFooterColumn('tblSalesReportLayer3',['RefDateInString','Value','Qty','QTYDC']);
    }

    $('#btnClose').click(function(){
            var win  = window.open("","_self");
            //window.location.href = sessionStorage.getItem("BackLink2");
            win.close();
    });

    $('#btnPrintList').click(function(){
        debugger;  
        var sValue = Params+'~'+MktPersonStatus;
        window.open(_sBaseAddress+'/SalesReport/PrintLists?sValue='+sValue);
    });

 </script>
