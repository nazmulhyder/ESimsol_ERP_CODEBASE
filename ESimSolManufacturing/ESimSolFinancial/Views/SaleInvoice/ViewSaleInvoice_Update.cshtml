<html>
@{
    ViewBag.Title = "Sale Invoice Entry";
}
<body>
    @model ESimSol.BusinessObjects.SaleInvoice
    <script src="~/Views/VehicleChassis/VehicleChassiss.js"></script>
    <script src="~/Views/VehicleEngine/VehicleEngine.js"></script>

    <div class="menuMainCollectionTable" ng-app="SaleInvoiceApp" ng-controller="SaleInvoiceController as SODC" style="height:100%; width:100%; overflow:hidden" id="divSaleInvoice">
        <div style="height:4%; overflow:hidden;" class="ui-grid-top-panel">
            <label ng-model="HeaderStatus">Update Invoice Status</label>
        </div>


        <div class="regionVR" style="height:80%;">
            <div style="font-family:Tahoma;text-align:center;height:80%; padding-right:24px" class="regionVR">
                <div class="col-md-12" style="height:42%;">
                    <fieldset style="height:460px;width:100%">
                        <div class="row" style="padding-top:120px;">
                            <div class="col-md-12 ">
                                <div class="col-md-2 text-right"><label class="control-label">Invoice No:</label></div>
                                <div class="col-md-4 text-left">
                                    <input type="text" ng-model="SaleInvoice.InvoiceNo" class="form-control" disabled>
                                </div>
                                <div class="col-md-2 text-right"><label class="control-label">KommNo:</label></div>
                                <div class="col-md-4 text-left">
                                    <input type="text" ng-model="SaleInvoice.KommNo" class="form-control" disabled>
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-12 ">
                                <div class="col-md-2 text-right"><label class="control-label">Invoice Date:</label></div>
                                <div class="col-md-4 text-left">
                                    <input type="text" ng-model="SaleInvoice.InvoiceDateST" class="form-control" disabled>
                                </div>
                                <div class="col-md-2 text-right"><label class="control-label">SQ No:</label></div>
                                <div class="col-md-4 text-left">
                                    <input type="text" ng-model="SaleInvoice.SQNo" class="form-control" disabled>
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-12 ">
                                <div class="col-md-2 text-right"><label class="control-label">VIN No:</label></div>
                                <div class="col-md-4 text-left">
                                    <input type="text" ng-model="SaleInvoice.ChassisNo" class="form-control" disabled>
                                </div>
                                <div class="col-md-2 text-right"><label class="control-label">Model No:</label></div>
                                <div class="col-md-4 text-left">
                                    <input type="text" ng-model="SaleInvoice.ModelNo" class="form-control" disabled>
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-12 ">
                                <div class="col-md-2 text-right"><label class="control-label">Engine No:</label></div>
                                <div class="col-md-4 text-left">
                                    <input type="text" ng-model="SaleInvoice.EngineNo" class="form-control" disabled>
                                </div>
                                <div class="col-md-2 text-right"><label class="control-label">Customer:</label></div>
                                <div class="col-md-4 text-left">
                                    <input type="text" ng-model="SaleInvoice.CustomerName" class="form-control" disabled>
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-12 ">
                                <div class="col-md-2 text-right"><label class="control-label">Rcv BY:</label></div>
                                <div class="col-md-4 text-left">
                                    <input type="text" ng-model="SaleInvoice.ReceivedByName" class="form-control" disabled>
                                </div>
                                <div class="col-md-2 text-right"><label class="control-label"> Customer Phone:</label></div>
                                <div class="col-md-4 text-left">
                                    <input type="text" ng-model="SaleInvoice.CustomerCellPhone" class="form-control" disabled>
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-12 ">
                                <div class="col-md-2 text-right"><label class="control-label"> Rcv On</label></div>
                                <div class="col-md-4 text-left">
                                    <input type="text" ng-model="SaleInvoice.ReceivedOn" class="form-control" disabled>
                                </div>
                                <div class="col-md-2 text-right"><label class="control-label">Invoice Note:</label></div>
                                <div class="col-md-4 text-left">
                                    <input type="text" ng-model="SaleInvoice.Remarks" class="form-control" disabled>
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-12 ">
                                <div class="col-md-2 text-right"><label class="control-label">Comments:</label></div>
                                <div class="col-md-10 text-left">
                                    <input type="text" ng-model="SaleInvoice.Comments" class="form-control" placeholder="Write a comment..">
                                </div>
                            </div>
                        </div>
                    </fieldset>
                </div>
            </div>
        </div>

        <div class="row" style="width:100%; height:10%">
            <fieldset style="margin-left:22px; margin-right:11px">
                <legend>Action</legend>
                <div class="row col-md-12 text-right">
                    <button type="button" class="btn-primary btn-sm" ng-show="btnApprove" aria-label="Left Align" ng-click="Approve()"> <span class="glyphicon glyphicon-ok" aria-hidden="true"></span> Approve</button>
                    <button type="button" class="btn-primary btn-sm" ng-show="btnReceive" aria-label="Left Align" ng-click="Receive()"> <span class="glyphicon glyphicon-ok" aria-hidden="true"></span> Receive</button>
                    <button type="button" class="btn-primary btn-sm" ng-show="btnDelivered" aria-label="Left Align" ng-click="Delivered()"> <span class="glyphicon glyphicon-ok" aria-hidden="true"></span> Delivered</button>
                    <button type="button" class="btn-warning btn-sm" ng-show="btnCancel" aria-label="Left Align" ng-click="Cancel()"> <span class="glyphicon glyphicon-stop" aria-hidden="true"></span> Cancel</button>
                    <button type="button" class="btn-danger btn-sm" aria-label="Right Align" ng-click="Close()"> <span class="glyphicon glyphicon-remove" aria-hidden="true"></span> Close</button>
                </div>
            </fieldset>
        </div>
    </div>
</body>
</html>
<style type="text/css">
    .regionVR .form-horizontal .control-label {
        padding-top: 1px;
    }

    .regionVR .form-control {
        height: 22px;
        padding: 0px 6px;
        font-size: 12px;
    }
    .regionVR regionVROT .form-control {
        height: 20px;
        padding: 0px 6px;
        font-size: 12px;
    }
    .regionVR .col-md-12 {
        width: 100%;
        padding-right: 5px;
        padding-left: 5px;
        margin-bottom: 5px;
    }
  
    .regionVR .col-md-2 {
        width: 16%;
        padding-right: 5px;
        padding-left: 5px;
    }
    .regionVR .col-md-10 {
        width: 82.5%;
        padding-right: 5px;
        padding-left: 5px;
    }
     .regionVR .col-md-4 {
        width: 33.33%;
        padding-right: 5px;
        padding-left: 5px;
    }
    
    .regionVR .col-md-6 {
        width: 50%;
        padding-right: 5px;
        padding-left: 5px;
    }
 
    .regionVR .btn-sm {
        padding: 2px 8px;
    }

    .regionVR .input-group-addon {
        padding: 2px 5px;
    }
    /*.ui-grid-top-panel {
        background: linear-gradient(to bottom,#EFF5FF 0,#E0ECFF 100%);
    } 
    .ui-grid-panel {
        background: linear-gradient(to bottom,#EFF5FF 0,#E0ECFF 100%);
    }*/
</style>
<script type="text/javascript">
    var oSaleInvoice =@Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(Model));
    var SaleInvoiceApp = angular.module('SaleInvoiceApp', ['ngAnimate', 'ui.bootstrap','ui.grid', 'ui.grid.selection', 'ui.grid.edit', 'ms.service','chassis.service','engine.service']);
    SaleInvoiceApp.controller('SaleInvoiceController', function ($scope,$http,$uibModal,$log,uiGridConstants,msModal,userSession,icsMethod,msGridControl, chassisservice, engineservice) {
       
        $scope.SaleInvoice=oSaleInvoice;
        $scope.SaleInvoice.BUID=sessionStorage.getItem('BUID');
      
        $scope.Operation=sessionStorage.getItem("Operation");
        debugger;
        $scope.btnApprove= $scope.btnDelivered = $scope.btnReceive= $scope.btnCancel= false;
        if($scope.Operation=="Approve")
        {
            $scope.btnApprove=true;
            $scope.lblDateTime="Invoice Date: ";
            $scope.Date_disabled= true;
            $('#txtDateTime').datetimebox('setValue', icsdatetimeformat(new Date(oSaleInvoice.SaleInvoiceDateSt)));
        }
        else if($scope.Operation=="Receive")
        {
            $scope.btnReceive=true;
            $scope.lblDateTime="Receive Date: ";
            $('#txtDateTime').datetimebox('setValue', icsdatetimeformat(new Date()));
        }
        else if($scope.Operation=="Deliver")
        {
            $scope.lblDateTime="Delivery Date: ";
            $scope.btnDelivered =true;
            $('#txtDateTime').datetimebox('setValue', icsdatetimeformat(new Date()));
        }
        else if($scope.Operation=="Cancel")
        {
            $scope.lblDateTime="Invoice Date: ";
            $scope.btnCancel= true;
            $scope.Date_disabled= true;
            $('#txtDateTime').datetimebox('setValue', icsdatetimeformat(new Date(oSaleInvoice.SaleInvoiceDateSt)));
            $("#txtDateTime").datebox("disable");
        }
        

        $scope.Approve= function () {
            debugger;
            var oSaleInvoice=$scope.SaleInvoice;
            oSaleInvoice.nRequest=2; //2: Approve
            oSaleInvoice.Remarks=$scope.SaleInvoice.Comments; 

            $http.post(sessionStorage.getItem('BaseAddress')+'/SaleInvoice/UpdateStatus', JSON.stringify(oSaleInvoice)).then(
                            function (response) {
                                debugger;
                                if (jQuery.parseJSON(response.data) == 'Approved') 
                                {
                                    var oSaleInvoice=$scope.SaleInvoice;
                                    alert("Successfully Approved.");
                                    oSaleInvoice.InvoiceStatusInt=2;
                                    oSaleInvoice.InvoiceStatusST="Approved";

                                    userSession.setData('SaleInvoices',oSaleInvoice);
                                    userSession.previousPage();
                                    $scope.Close();
                                }
                                else 
                                {
                                    alert(jQuery.parseJSON(response.data));
                                }
                            },
                            function (response) { alert(jQuery.parseJSON(response.data)); }
                        );
        };
        $scope.Receive= function () {

            var oSaleInvoice=$scope.SaleInvoice;
            oSaleInvoice.nRequest=2; // 2: Receive
            oSaleInvoice.Remarks=$scope.SaleInvoice.Comments; 
            oSaleInvoice.ActualRcvDateTime= $('#txtDateTime').datebox('getValue');

            $http.post(sessionStorage.getItem('BaseAddress')+'/SaleInvoice/UpdateStatus', JSON.stringify(oSaleInvoice)).then(
                            function (response) {
                                if (jQuery.parseJSON(response.data) == 'Received') 
                                {
                                    var oSaleInvoice=$scope.SaleInvoice;
                                    alert("Successfully Received.");
                                    oSaleInvoice.InvoiceStatusInt=3;
                                    oSaleInvoice.InvoiceStatusSt="Receive";

                                    userSession.setData('SaleInvoiceList',oSaleInvoice);
                                    userSession.previousPage();
                                    $scope.Close();
                                }
                                else 
                                {
                                    alert(jQuery.parseJSON(response.data));
                                }
                            },
                            function (response) { alert(jQuery.parseJSON(response.data)); }
                        );
        };
        $scope.Delivered= function () {

            var oSaleInvoice=$scope.SaleInvoice;
            oSaleInvoice.nRequest=3; // 1: Delivered
            oSaleInvoice.Remarks=$scope.SaleInvoice.Comments; 
            oSaleInvoice.ActualRcvDateTime= $('#txtDateTime').datebox('getValue');

            $http.post(sessionStorage.getItem('BaseAddress')+'/SaleInvoice/UpdateStatus', JSON.stringify(oSaleInvoice)).then(
                            function (response) {
                                if (jQuery.parseJSON(response.data) == 'Delivered') 
                                {
                                    alert("Successfully Delivered.");
                                    var oSaleInvoice=$scope.SaleInvoice;
                                    oSaleInvoice.InvoiceStatusInt=3;
                                    oSaleInvoice.InvoiceStatusSt="Delivered";

                                    userSession.setData('SaleInvoiceList',oSaleInvoice);
                                    userSession.previousPage();
                                    $scope.Close();
                                }
                                else 
                                {
                                    alert(jQuery.parseJSON(response.data));
                                }
                            },
                            function (response) { alert(jQuery.parseJSON(response.data)); }
                        );
        };
        $scope.Cancel= function () {

            var oSaleInvoice=$scope.SaleInvoice;
            oSaleInvoice.nRequest=4; // 4: Cancel
            oSaleInvoice.Remarks=$scope.SaleInvoice.Comments; 
            oSaleInvoice.ActualRcvDateTime= $('#txtDateTime').datebox('getValue');

            $http.post(sessionStorage.getItem('BaseAddress')+'/SaleInvoice/UpdateStatus', JSON.stringify(oSaleInvoice)).then(
                            function (response) {
                                if (jQuery.parseJSON(response.data) == 'Cancel') 
                                {
                                    alert("Successfully Canceled.");
                                    $scope.SaleInvoice.InvoiceStatusInt=4;
                                    $scope.SaleInvoice.InvoiceStatusSt="Cancel";

                                    userSession.setData('SaleInvoiceList',oSaleInvoice);
                                    userSession.previousPage();
                                    $scope.Close();
                                }
                                else 
                                {
                                    alert(jQuery.parseJSON(response.data));
                                }
                            },
                            function (response) { alert(jQuery.parseJSON(response.data)); }
                        );
        };
      

        $scope.Close=function ()
        {
            debugger;
            window.location.href = sessionStorage.getItem("BackLink");
        };
    });

</script>