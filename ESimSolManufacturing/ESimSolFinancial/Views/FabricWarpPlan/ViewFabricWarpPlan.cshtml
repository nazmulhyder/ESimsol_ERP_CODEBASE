@{
    ViewBag.Title = "Fabric Warping Plan(s)";
}
@model IEnumerable<ESimSol.BusinessObjects.FabricWarpPlan>

    <head>
        <title>Fabric Sizing Plan</title>
    </head>
    <div id="progressbarParent" style="width:100%;height:100%;margin:0 auto;text-align:center; margin-left: auto;margin-right: auto;left: 0;right: 0;z-index: 1;">
        <div style="margin: 0px auto;margin-top: 251px;text-align:center;width:390px;">
            <label style="font-size:18px;">Please wait</label>
            <div id="progressbar" style="width:100%;height:37px;"></div>
        </div>
    </div>
    <body>
        <div class="menuMainCollectionTable">
            <table id="tblFabricWarpPlan" title="FabricWarpPlan List" class="easyui-datagrid" fit="true" fitcolumn="true" rownumbers="true" pagination="true" singleselect="true" autorowheight="false" showfooter="true" data-options="resizable:true,checkOnSelect:false,selectOnCheck:false" toolbar="#toolbarFabricWarpPlan">
                <thead>
                    <tr>
                        <th data-options="field:'Selected',checkbox:true"></th>
                        <th field="StartTimeSt" width="12%">Start Date</th>
                        <th field="EndTimeSt" width="12%">End Date</th>
                        <th field="MachineName" width="12%"> M/C</th>
                        <th field="ContractorName" width="18%">Customer</th>
                        <th field="Construction" width="10%">Construction</th>
                        <th field="Composition" width="10%">Composition</th>
                        <th field="ExeNo" width="10%">Dispo No</th>
                        <th field="Weave" width="10%">Design</th>
                        <th field="PlanStatusSt" data-options="formatter:cellFormatterColor" width="8%" align="left">Plan Status</th>
                        <th field="StatusSt" width="10%" align="left">Status</th>
                        <th field="WarpColor" width="8%">WarpColor</th>
                        <th field="WeftColor" width="8%">WeftColor</th>
                        <th field="ReedNo" width="8%">ReedNo</th>
                        <th field="REEDWidth" formatter="formatPrice" width="10%" align="right">R.Width</th>
                        <th field="RequiredWarpLength" formatter="formatPrice" width="10%" align="right">Req. Warp Length</th>
                        <th field="Qty" formatter="formatPrice" width="10%" align="right">Warp Length</th>
                        <th field="ExeQtyInM" formatter="formatPrice" width="10%" align="right">Execution Qty(M)</th>
                        <th field="WarpBeam" width="10%" align="right">Warp Beam</th>
                        @*<th field="BeamName" width="10%" align="left">Beam Name</th>*@
                        <th field="BatchNo" width="10%" align="left">Batch No</th>
                        <th field="LowerUpperType" width="10%" align="left">Type</th>
                    </tr>
                </thead>

            </table>>

            <div id="toolbarFabricWarpPlan">
                @*<a href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-reload" plain="true" id="btnReload"></a>*@
                <input type="text" id="txtSearchByDispoNo" placeholder="Search by Dispo No" style="width:150px;text-align:left" />
                <a id="btnAdvSearch" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-search" plain="true">Adv. Search</a>
                <a id="btnAdd" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-add" plain="true">New</a>
                <a id="btnEdit" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-edit" plain="true">Edit</a>
                <a id="btnDelete" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-remove" plain="true">Delete</a>
                @*<a id="btnView" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-details" plain="true">View</a>*@
                @*<a id="btnCancel" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-cancel" plain="true">Cancel</a>*@
                <a id="btnCut" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-cut" plain="true">Cut</a>
                <a id="btnPast" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-paste" plain="true">Paste</a>
                <a id="btnSwap" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-redo" plain="true">Swap</a>
                <a id="btnAddFBatch" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-add" plain="true">Fabric Batch</a>
                &nbsp;Is Pending: <input type="checkbox" id="chkIsPendingFWP" />
                <a id="btnPrint" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-print" plain="true">Print</a>
                <a id="btnExcel" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-excel" plain="true">XL</a>
            </div>
        </div>
        <div id="winDUFabricWarpPlan" style="width:800px;height:480px" class="easyui-window winstyle" title="Schedule Informations" data-options="modal:true,closed:true,collapsible:false,minimizable:false,maximizable:false,closable:false">
            <div style="padding-left:0px; padding-right:0px; padding-top:2px;">
                <fieldset>
                    <legend>Order Info:</legend>
                    <div>
                        <table cellpadding="1" cellspacing="1" style="font-size: 12px;width: 100%">
                            <tr>
                                <td style="width:15%;text-align:right;">
                                    <select id="cboPlanType" style="width:55px;"></select>
                                    Dispo No:
                                </td>
                                <td style="width:35%;text-align:left;">
                                    <input type="text" id="txtOrderNo" class="reset-text" placeholder="Search by Dispo No" style="width:85%" />
                                    <a id="btnPickOrderNo" href="javascript:void(0)" class="easyui-linkbutton ics-pick" iconcls="icon-pick" plain="true"></a>
                                </td>
                                <td style="width:15%;text-align:right;">
                                    Buyer Name:
                                </td>
                                <td style="padding-left: 2px;width:35%;text-align:left">
                                    <input id="txtBuyerName" type="text" style="width:100%"  disabled="disabled" />
                                </td>
                            </tr>
                            <tr>
                                <td style="width:15%;text-align:right;">
                                    Construction:
                                </td>
                                <td style="width:35%;text-align:left;">
                                    <input id="txtConstruction" class="reset-text" placeholder="Construction" style="width:100%" disabled="disabled" />
                                </td>
                                <td style="width:15%;text-align:right;">
                                    Composition:
                                </td>
                                <td style="padding-left: 2px;width:35%;text-align:left">
                                    <input id="txtComposition" type="text" style="width:100%" disabled="disabled" />
                                </td>
                            </tr>
                            <tr>
                                <td style="width:15%;text-align:right;">
                                    Design:
                                </td>
                                <td style="width:35%;text-align:left;">
                                    <input id="txtDesign" class="reset-text" style="width:100%" disabled="disabled" />
                                </td>
                                <td style="width:15%;text-align:right;">
                                    Color :
                                </td>
                                <td style="padding-left: 2px;width:35%;text-align:left">
                                    @*<input id="txtRequiredWarpLength" type="text" style="width:100%" />*@
                                    <table >
                                        <tr>
                                            <td style="text-align:right;width:20%;">
                                                Warp:
                                            </td>
                                            <td style="width:30%;">
                                                <input id="txtWarpColor" type="text" style="width:80%;" disabled="disabled" />
                                            </td>
                                            <td style="text-align:right;width:20%;">
                                                Weft:
                                            </td>
                                            <td style="width:30%;">
                                                <input id="txtWeftColor" type="text" style="width:80%;" disabled="disabled" />
                                            </td>
                                        </tr>
                                        </table> 

                                </td>
                            </tr>
                        </table>
                    </div>
                    <div>
                        <table cellpadding="2"cellspacing="2" style="width:100%;">
                          
                            <tr>
                                <td style="text-align:right;width:20%; border-top:1px solid black">
                                    <label>Order Qty:</label>
                                </td>
                                <td style="width:30%;border-top:1px solid black">
                                    <input id="txtQtyOrderY" type="text" style="width:59%;text-align:right;" value="0.00" disabled="disabled" />(Y)
                                </td>
                                <td style="width:30%;border-top:1px solid black">
                                    <input id="txtQtyOrderM" type="text" style="width:59%;text-align:right;" value="0.00" disabled="disabled" />(M)
                                </td>
                                <td style="text-align:right;width:20%;border-top:1px solid black"></td>
                            </tr>

                            <tr>
                                <td style="text-align:right;width:20%;">
                                    <label>Grey Target Qty :</label>
                                </td>
                                <td style="width:30%;">
                                    <input id="txtGreyTargetQtyUS" type="text" style="width:59%;text-align:right;" value="0.00" disabled="disabled" />(Y)
                                </td>
                                <td style="width:30%;">
                                    <input id="txtGreyTargetQtyUSInMeter" type="text" style="width:59%;text-align:right;" value="0.00" disabled="disabled" />(M)
                                </td>
                                <td style="text-align:right;width:20%;"></td>
                            </tr>

                            <tr>
                                <td style="text-align:right;width:20%;">
                                    <label>Require Warp Length :</label>
                                </td>
                                <td style="width:30%;">
                                    <input id="txtRequireWarpLengthY" type="text" style="width:59%;text-align:right;" value="0.00" disabled="disabled" />(Y)
                                </td>
                                <td style="width:30%;">
                                    <input id="txtRequireWarpLengthUSInMeter" type="text" style="width:59%;text-align:right;" value="0.00" disabled="disabled" />(M)
                                </td>
                                <td style="text-align:right;width:20%;"></td>
                            </tr>
                            <tr>
                                <td style="text-align:right;width:20%;">
                                    <label>Length in Weaving :</label>
                                </td>
                                <td style="width:30%;">
                                    <input id="txtLengthInWeavingY" type="text" style="width:59%;text-align:right;" value="0.00" disabled="disabled" />(Y)
                                </td>
                                <td style="width:30%;">
                                    <input id="txtLengthInWeavingM" type="text" style="width:59%;text-align:right;" value="0.00" disabled="disabled" />(M)
                                </td>
                                <td style="text-align:right;width:20%;"></td>
                            </tr>

                         
                        </table>
                    </div>
                </fieldset>
            </div>
            <div>
                <fieldset>
                    <legend>Schedule Info:</legend>
                    <div>
                        <table cellpadding="1" cellspacing="1" style="font-size: 12px;width: 100%">
                            <tr>
                                <td style="width:5%;text-align:right;"></td>
                                <td style="width:10%;text-align:right;">
                                    Machine:
                                </td>
                                <td style="padding-left: 0px;width:30%;text-align:left">
                                    <input id="txtMachine" style="width: 60% ; font-size: 11px;" placeholder="Search Machine" />
                                    <a id="btnPickMachine" href="javascript:void(0)" class="easyui-linkbutton ics-pick" iconcls="icon-pick" plain="true"></a>
                                    <a id="btnResetMachine" href="javascript:void(0)" class="easyui-linkbutton ics-pick" iconcls="icon-clear" plain="true"></a>
                                </td>
                                <td colspan="2" style="padding-right: 2px;width:50%;text-align:right;">
                                    <div style="float: right; width:100%;">

                                        <span>
                                            <input type="button" id="btnScheduleLastTime" value="Default Time" style="font-size: 11px;
                                            height: 23px; width: 80px;" />
                                        </span><span>
                                            <input type="button" id="btnCurrenttime" value="Current Time" style="font-size: 11px;
                                            height: 23px; width: 80px;" />
                                        </span><span>
                                            <input id="tptimeSpinner" class="easyui-timespinner" style="width: 75px; height:20px; font-size: 11px;" required="required"
                                                   data-options="showSeconds:false" />
                                        </span>
                                        <span>
                                            <input type="button" id="btnAddSpinnerTime" value="Add" style="font-size: 11px;
                                            height: 23px; width: 30px;" />
                                        </span>
                                    </div>
                                </td>
                                <td style="width:5%;text-align:right;"></td>
                            </tr>
                            <tr>
                                <td style="width:5%;text-align:right;"></td>
                                <td style="width:10%;text-align:right;">
                                    Start Time:
                                </td>
                                <td style="width:30%;">
                                    @*<input id="txtStartDate" type="text" class="easyui-datetimebox" style="width:100%" data-options="showSeconds:false" />*@
                                    <input id="txtStartDate" style="width:100px;" type="text" class="easyui-datebox" required="required" data-options="formatter:icsdateformat,parser:icsdateparser" />
                                    <input id="tpStartTime" class="easyui-timespinner" style="width:60px;" required="required" />
                                </td>

                                <td style="width:20%;text-align:right;">
                                    End Time:
                                </td>
                                <td style="padding-left: 2px;width:30%;">
                                    @*<input id="txtEndDate" type="text" class="easyui-datetimebox" style="width:100%" data-options="showSeconds:false" />*@
                                    <input id="txtEndDate" style="width:100px;" type="text" class="easyui-datebox" required="required" data-options="formatter:icsdateformat,parser:icsdateparser" />
                                    <input id="tpEndTime" class="easyui-timespinner" style="width:60px;" required="required" />
                                </td>

                                <td style="width:5%;text-align:right;"></td>
                            </tr>

                        </table>

                    </div>
                </fieldset>
                <fieldset>
                    <legend></legend>
                   
                    <div>
                        <table style="font-size: 12px;width: 100%">
                            <tr>
                                <td style="text-align:right;width:10%;">
                                    <label>Qty :</label>
                                </td>
                                <td style="text-align:left;width:25%;">
                                    <input id="txtQty" type="text" class="form-control number" />(M)
                                </td>
                                <td style="width:10%;">
                                    <label class="control-label">Qty(Y):</label>
                                </td>
                                <td style="text-align:left;width:25%;">
                                    <input id="txtYardQty" type="text" class="form-control number" disabled />(Y)
                                </td>
                                <td style="text-align:right;width:15%;">
                                    <label>Warp Beam :</label>
                                </td>
                                <td style="text-align:left;width:15%;">
                                    <input id="txtWarpBeam" type="text"  />
                                </td>
                            </tr>
                            <tr>
                                @*<td style="text-align:right;width:10%;">
                                    <label>Priority :</label>
                                </td>
                                <td style="text-align:left;width:25%;">
                                    <select id="cboPriority" style="width:83%;height:22px;">
                                        <option value="0">--Select One--</option>
                                        <option value="1">Low</option>
                                        <option value="2">Medium</option>
                                        <option value="3">High</option>
                                        <option value="4">Urgent</option>
                                        <option value="5">Top Urgent</option>
                                    </select>
                                </td>*@
                                <td style="width:10%;text-align:right;">
                                    <label>Remarks :</label>
                                </td>
                                <td colspan="5" style="width:55%;">
                                    <input type="text" id="txtNote" class="reset-text" style="width:100%;" placeholder="Remarks.." />
                                </td>
                            </tr>
                        </table>

                    </div>
                </fieldset>
            </div>
           
            <fieldset class="actionfieldsetstyle">
                <legend>Actions : </legend>
                <table border="0" cellspacing="2" cellpadding="2" style="width:100%; font-size:11px; font-weight:bold;">
                    <tr>
                        <td style="width:60%;text-align:left;">
                            @*<a id="btnDelete" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-remove" plain="true">Delete</a>
                            <a id="btnSaveRS" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-save" plain="true" style=" height:22px;">Dyeing Card</a>
                            <a id="btnCut" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-cut" plain="true" style=" height:22px;">Cut</a>
                            <a id="btnPaste1" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-paste" plain="true" style=" height:22px;">Paste</a>*@
                            <label>Priority :</label>
                            <select id="cboPriority" style="width:25%;">
                                <option value="0">--Select One--</option>
                                <option value="5">Top Urgent</option>
                                <option value="4">Urgent</option>
                                <option value="6">Loom Program</option>
                                @*<option value="3">High</option>
                                <option value="2">Medium</option>
                                <option value="1">Low</option>*@
                            </select>
                            <label id="lblPlanStatus">Plan Status :</label>
                            <select style="width:25%" id="cboPlanStatus"> </select>
                            <a id="btnUpdatePlanStatus" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-ok" plain="true" style=" height:22px;">Update</a>
                        </td>
                        <td style="width:40%;text-align:right;">
                            <a id="btnAddFB" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-add" plain="true">Fabric Batch</a>
                            <a id="btnSave" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-save" plain="true" style=" height:22px;" onclick="Save(false)">Save</a>
                            <a id="btnClosePS" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-cancel" plain="true">Close</a>
                        </td>
                    </tr>
                </table>
            </fieldset>
            <fieldset id="region-fabric-batch">
                <legend>Fabric Batch</legend>
                <div class="row">
                    <div class="col-lg-3 col-md-3 col-sm-3 text-right">
                        <label class="control-label">Fabric Batch(s):</label>
                    </div>
                    <div class="col-lg-8 col-md-8 col-sm-8">
                        <select id="cboFabricBatch" class="form-control"></select>
                        <label id="lblSingleFB" class="control-label"></label>
                        <a id="btnBatchCardPrint" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-print" plain="true"></a>
                    </div>
                </div>
            </fieldset>
        </div>
        <div id="winAdvSearch" class="easyui-window winClass" style=" width:500px;" title=" adv. search" data-options="modal:true,closed:true,collapsible:false,minimizable:false,maximizable:false,closable:false">
            <table style="width:100%;">
                <tr>
                    <td>
                        <fieldset style="margin-bottom: 0px;">
                            <legend>Searching Criteria</legend>
                            <table>

                                <tr>
                                    <td style=" width:20%;text-align:right;">
                                        <label>Plan Date : </label>
                                    </td>
                                    <td colspan="3">
                                        <select id="cboDateAdvS" style="width:30%;height:22px;" onchange="DateActionsDateAdvSearch(); "></select>
                                        <input id="txtFromDateAdvSearch" type="text" style="width: 100px;" class="easyui-datebox" required="required" data-options="formatter:icsdateformat,parser:icsdateparser" />To
                                        <input id="txtToDateAdvSearch" type="text" style="width: 100px;" class="easyui-datebox" required="required" data-options="formatter:icsdateformat,parser:icsdateparser" />
                                    </td>
                                </tr>
                                <tr>
                                    <td style=" width:20%;text-align:right;">
                                        <label>Dispo No : </label>
                                    </td>
                                    <td colspan="3" style="width:80%;text-align:left;">
                                        <input id="txtExeNo" type="text" style="width:93%" />
                                    </td>
                                </tr>
                                <tr>
                                    <td style=" width:20%;text-align:right;">
                                        <label>Batch No : </label>
                                    </td>
                                    <td colspan="3" style="width:80%;text-align:left;">
                                        <input id="txtBatchNo" type="text" style="width:93%" />
                                    </td>
                                </tr>
                                <tr>
                                    <td style="width:20%;text-align:right;">
                                        <label>Construction : </label>
                                    </td>
                                    <td colspan="3" style=" width:80%;text-align:left;">
                                        <input id="txtConstructions" type="text" style="width:93%" />
                                    </td>
                                </tr>

                                <tr>
                                    <td style=" width:20%;text-align:right;">
                                        <label>Machine : </label>
                                    </td>
                                    <td colspan="3" style=" width:80%;text-align:left;">
                                        <input id="txtMachineName" style="width:78%;" type="text" placeholder="Type Machine Name & Press Enter" />
                                        <a id="btnMachinePiker" href="javascript:void(0)" class="easyui-linkbutton ics-pick" iconcls="icon-pick" plain="true"></a>
                                        <a id="btnClrMachinePiker" href="javascript:void(0)" class="easyui-linkbutton ics-pick" iconcls="icon-clear" plain="true"></a>
                                    </td>
                                </tr>

                                <tr>
                                    <td style=" width:20%;text-align:right;">
                                        <label>Customer : </label>
                                    </td>
                                    <td colspan="3" style=" width:80%;text-align:left;">
                                        <input id="txtCustomerName" style="width:78%;" type="text" placeholder="Type Customer Name & Press Enter" />
                                        <a id="btnCustomerPiker" href="javascript:void(0)" class="easyui-linkbutton ics-pick" iconcls="icon-pick" plain="true"></a>
                                        <a id="btnClrCustomerPiker" href="javascript:void(0)" class="easyui-linkbutton ics-pick" iconcls="icon-clear" plain="true"></a>
                                    </td>
                                </tr>
                              
                                <tr>
                                    <td style="width:20%;text-align:right;">
                                        <label>Design : </label>
                                    </td>
                                    <td colspan="3" style=" width:80%;text-align:left;">
                                        <select id="cboDesign" style="width:93%;height:22px;"></select>
                                    </td>
                                </tr>
                                <tr>
                                    <td style="width:20%;text-align:right;">
                                        <label>Plan Status : </label>
                                    </td>
                                    <td colspan="3" style=" width:80%;text-align:left;">
                                        <select id="cboPlanStatusAdv" style="width:93%;height:22px;"></select>
                                    </td>
                                </tr>
                                <tr>
                                    <td style=" width:20%;text-align:right;">
                                        <label>Pending : </label>
                                    </td>
                                    <td colspan="3" style="width:80%;text-align:left;">
                                        <input type="checkbox" id="chkIsPending" />
                                    </td>
                                </tr>
                                <tr>
                                    <td height="5px" colspan="4"></td>
                                </tr>
                                @*<tr>
                                        <td class="btnResetSearch" colspan="4">
                                            <a id="btnSearchAdvSearch" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-search" plain="true">Search</a>
                                            <a id="btnResetAdvSearch" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-reload" plain="true">Reset</a>
                                        </td>
                                    </tr>*@
                            </table>
                        </fieldset>
                    </td>
                </tr>
            </table>

            <fieldset class="actionfieldsetstyle">
                <legend>Actions : </legend>
                <label class="lblLoadingMessage" style="float: left;">Loading Please Wait...</label>
                @*<a id="btnResetAdvSearch" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-reload" plain="true">Reset</a>*@
                <a id="btnSearchAdvSearch" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-search" plain="true">Search</a>
                <a id="btnCloseAdvSearch" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-cancel" plain="true">Close</a>
            </fieldset>
        </div>
        
    </body>


    <script type="text/javascript">
    var _sBaseAddress="";
    var _oFabricWarpPlans=[];
    var _oAuthorizationRolesMapping=[];
    var _sMessage='';
    var _nNextStatus=-1;
    var _sMenuID=0;
    var _nContractorIDs="";
    var _sMenuID=0;
    var _nBUID = 0;
    var _sContractorIds = '';
    var _sProductIds = '';
    var _sDeliverToIDs = '';
    var _oIsAdd=false;
    var _oFabricWarpPlan={};
    var _nSelectedRowIndex=0;
    $(document).ready(function () {
        _oAuthorizationRolesMapping =@Html.Raw( new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(HttpContext.Current.Session[SessionInfo.AuthorizationRolesMapping]));
        _sBaseAddress = @Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(HttpContext.Current.Session[SessionInfo.BaseAddress]));
        _oFabricWarpPlans =@Html.Raw( new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(Model));
        _sMenuID =@Html.Raw( new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(HttpContext.Current.Session[SessionInfo.MenuID]));
        _nBUID = @Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(ViewBag.BUID));
        _oCompareOperators = @Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(ViewBag.CompareOperators));
        var oFabricWeaves = @Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(ViewBag.FabricWeaves));
        var oPlanStatusList = @Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(ViewBag.PlanStatusList));
        var oPlanTypes = @Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(ViewBag.PlanTypes));
        debugger;
        RefreshControlLayout();
        DynamicRefreshList(_oFabricWarpPlans, 'tblFabricWarpPlan');
        $("#cboPlanStatus").icsLoadCombo({ List: oPlanStatusList, OptionValue: "id", DisplayText: "Value" });
        $("#cboPlanType").icsLoadCombo({ List: oPlanTypes, OptionValue: "id", DisplayText: "Value", InitialValue: "Fixed" });
        $("#progressbar").progressbar({ value: 0 });
        $("#progressbarParent").hide();
        $(".lblLoadingMessage").hide();
        sessionStorage.setItem("ParamsSO", "");

        //adv search
        $("#cboDesign").icsLoadCombo({List: oFabricWeaves, OptionValue: "FabricProcessID", DisplayText: "Name"});
        $("#cboPlanStatusAdv").icsLoadCombo({ List: oPlanStatusList, OptionValue: "id", DisplayText: "Value" });
        $("#winAdvSearch").data("MachineIDs","");
        $("#winAdvSearch").data("CustomerIDs","");
        $('#btnPast').hide();
        $('#tblFabricWarpPlan').datagrid({ onSelect: function (rowIndex, rowData) { OpenAttHistory(rowIndex, rowData); } });
        function OpenAttHistory(rowIndex, rowData) {
            debugger;
            if(rowData.BatchNo == "" || rowData.BatchNo == null){
                GetsFabricBatch(rowData.FabricWarpPlanID);
                $("#btnAddFBatch").show();
            }
            else{
                $("#btnAddFBatch").hide();
            }
        }
        document.getElementById("chkIsPendingFWP").checked = true;
    });
    function updateProgress() {
        var value =$('#progressbar').progressbar('getValue');
        if (value < 96){
            value += Math.floor(Math.random() * 10);
            $('#progressbar').progressbar('setValue', value);
        }
    }
    function hideShow(miliseconds) {
        $("#progressbarParent").hide();
    }
    $(document).keydown(function (e) { if (e.keyCode == 27) { $('#winFabricWarpPlanOrder').icsWindow('close'); } });


    $('#tblFabricWarpPlan').datagrid({ onSelect: function (rowIndex, rowData) { OperationPerforms(rowIndex, rowData); } });

    function OperationPerforms(rowIndex, rowData)
    {
        if (rowData != null && rowData.FabricWarpPlanID > 0)
        {
            if (rowData.OrderStatus==1 )  //Initialized = 1,
            {

            }
            //$('#btnCancel,#btnUndo,#btnAdd,#btnEdit,#btnDelete').hide();
            ////if (rowData.OrderStatus==1 )  //Initialized = 1,
            ////{
            //$('#btnAdd,#btnEdit,#btnDelete,#btnOrderStatus').show();
            //_nNextStatus=2;
            //_sMessage="send an approval request.";
            //$('#lblOrderStatus').text(' Approve');
        }
    }

    function cellFormatterColor(value,row,index) {
        //debugger;
        if(row.PlanStatus == 1)
            return "<table style='width:100%;background-color:#0EF622;'><tr><td style='border: 0px'>" + row.PlanStatusSt  + "</td></tr></table>";
        else if(row.PlanStatus == 2)
            return "<table style='width:100%;background-color:#EE7CC8;'><tr><td style='border: 0px'>" + row.PlanStatusSt  + "</td></tr></table>";
        else return row.PlanStatusSt;
    }


    /*------------------------------------*/

    $("#btnAdd").click(function(){

        ////  alert("index="+sPSID);
        //if (nObjectID == null || nObjectID <= 0) {
        //    alert("Please select a item from list!");
        //    return;
        //}
        _oIsAdd=true;
        _oFabricWarpPlan = { ErrorMessage: "", FabricWarpPlanID: 0, FMID: 0 };

        $.ajax({
            type: "POST",
            url: _sBaseAddress + "/FabricWarpPlan/GetPS",
            traditional: true,
            data: JSON.stringify(_oFabricWarpPlan),
            contentType: "application/json; charset=utf-8",
            success: function (data) {
                debugger;
                _oFabricWarpPlan = { ErrorMessage: "", FabricWarpPlanID: 0, FMID: 0 };
                var oFabricWarpPlan = jQuery.parseJSON(data);

                RefreshControl(oFabricWarpPlan);
                $('#cboPlanType').val(oFabricWarpPlan.PlanType);
                $("#winDUFabricWarpPlan").icsWindow("open", "Schedule Entry");
                $("#cboPlanStatus").hide();
                $("#btnUpdatePlanStatus").hide();
                $("#lblPlanStatus").hide();
            }
        });


    });

    $('#btnEdit').click(function (e)
    {
        _oIsAdd=false;
        var oFabricWarpPlan = $('#tblFabricWarpPlan').datagrid('getSelected');
        if (oFabricWarpPlan ==null || oFabricWarpPlan.FabricWarpPlanID <=0 ) { alert("Please select an item from list."); return ; }
        var nIndex=$('#tblFabricWarpPlan').datagrid('getRowIndex',oFabricWarpPlan);
        _nSelectedRowIndex=nIndex;
        $.ajax({
            type: "POST",
            url: _sBaseAddress + "/FabricWarpPlan/GetPS",
            traditional: true,
            data: JSON.stringify(oFabricWarpPlan),
            contentType: "application/json; charset=utf-8",
            success: function (data) {
                debugger;
                var oFabricWarpPlan = jQuery.parseJSON(data);
                RefreshControl(oFabricWarpPlan);
                $('#cboPlanType').val(oFabricWarpPlan.PlanType);

                $("#winDUFabricWarpPlan").icsWindow("open", "Schedule Entry");
                $("#cboPlanStatus").show();
                $("#btnUpdatePlanStatus").show();
                $("#lblPlanStatus").show();
            }
        });

    });
    function RefreshControl(oFabricWarpPlan)
    {
        debugger;
        _oFabricWarpPlan=oFabricWarpPlan;
        if(oFabricWarpPlan.FabricWarpPlanID>0)
        {
            $('#tpStartTime').timespinner('setValue', oFabricWarpPlan.StartTimeTS);
            $('#txtStartDate').datebox('setValue', oFabricWarpPlan.StartDateSt);

            $('#tpEndTime').timespinner('setValue', oFabricWarpPlan.EndTimeTS);
            $('#txtEndDate').datebox('setValue', oFabricWarpPlan.EndDateSt);

            $("#txtScheduleNo").val(oFabricWarpPlan.ScheduleNo);
            $("#txtMachine").val(oFabricWarpPlan.MachineName);
            $("#txtNote").val(oFabricWarpPlan.Note);
            $("#txtWarpBeam").val(oFabricWarpPlan.WarpBeam);
            $("#cboPlanStatus").val(oFabricWarpPlan.PlanStatus);
        }
        else{
            $("#txtMachine").val("");
            //$("#divFabricWarpPlan").data("MachineID",0);
            $("#txtNote").val("");
            $("#txtWarpBeam").val("");
        }
        $("#cboPriority").val(oFabricWarpPlan.Priority);
        $("#txtOrderNo").val(oFabricWarpPlan.ExeNo);
        $("#txtBuyerName").val(oFabricWarpPlan.ContractorName);
        $("#txtConstruction").val(oFabricWarpPlan.Construction);
        $("#txtComposition").val(oFabricWarpPlan.Composition);
        $("#txtDesign").val(oFabricWarpPlan.Weave);

        $("#txtQtyOrderY").val(formatPrice(oFabricWarpPlan.OrderQty));
        $("#txtQtyOrderM").val(formatPrice(GetMeter(oFabricWarpPlan.OrderQty,2)));

        $("#txtGreyTargetQtyUSInMeter").val(formatPrice(parseFloat(oFabricWarpPlan.GreigeDemand).toFixed(1)));
        $("#txtGreyTargetQtyUS").val(formatPrice(parseFloat(oFabricWarpPlan.GreigeDemand*1.09361).toFixed(1)));

        $("#txtRequireWarpLengthUSInMeter").val(oFabricWarpPlan.RequiredWarpLength);
        $("#txtRequireWarpLengthY").val(formatPrice(parseFloat(oFabricWarpPlan.RequiredWarpLength*1.09361).toFixed(1)));

        $("#txtLengthInWeavingM").val(oFabricWarpPlan.TFLength);
        $("#txtLengthInWeavingY").val(formatPrice(parseFloat(oFabricWarpPlan.TFLength*1.09361).toFixed(1)));

        $('#txtWeftColor').val(oFabricWarpPlan.WeftColor);
        $('#txtWarpColor').val(oFabricWarpPlan.WarpColor);

        //var nMeterQty = GetMeter(oFabricWarpPlan.Qty,2);
        //$('#cboPlanType').val(oFabricWarpPlan.PlanType);

        //$('#txtQty').numberbox({min:0, precision:2 });
        $('#txtQty').numberbox({onChange:ConvertIntoYards,min:0, precision:2 });
        $('#txtYardQty').numberbox({min:0, precision:2 });

        $('#txtQty').numberbox('setValue',oFabricWarpPlan.Qty);
        $('#txtYardQty').numberbox('setValue',GetYard(oFabricWarpPlan.Qty,2));

        $('#region-fabric-batch').hide();
        $('#btnBatchCardPrint').hide();
        if(oFabricWarpPlan.FabricWarpPlanID>0){
            GetsFabricBatch(oFabricWarpPlan.FabricWarpPlanID);
            $("#btnAddFB").show();
        }
        else{

            $("#btnAddFB").hide();
        }
    }

    $('#txtStartDate').datebox({
        onSelect: function(date){
            //alert(date.getFullYear()+":"+(date.getMonth()+1)+":"+date.getDate());
            debugger;
            var oDate = new Date(date);
            oDate.setHours(new Date().getHours());
            oDate.setMinutes(new Date().getMinutes());

            var nHour=oDate.getHours();
            var nMin=oDate.getMinutes();
            if(isNaN(nHour))
                nHour=0;
            if(isNaN(nMin))
                nMin=0;
            $('#tpStartTime').timespinner('setValue', nHour+":"+nMin);

            oDate.setMinutes(oDate.getMinutes() + 10);
            $('#txtEndDate').datebox('setValue', icsdateformat(oDate));
            nHour=oDate.getHours();
            nMin=oDate.getMinutes();
            if(isNaN(nHour))
                nHour=0;
            if(isNaN(nMin))
                nMin=0;
            $('#tpEndTime').timespinner('setValue', nHour+":"+nMin);
        }
    });

    function ConvertIntoYards()
    {

        var nQtyInMeter= $('#txtQty').numberbox('getValue');
        var nQtyInYards= nQtyInMeter*1.09361;
        $('#txtYardQty').numberbox('setValue',nQtyInYards.toFixed(2));
    }

    //$("#btnCancel").click(function(){

    //    var oFabricWarpPlan = $('#tblFabricWarpPlan').datagrid('getSelected');
    //    if (oFabricWarpPlan ==null || oFabricWarpPlan.FabricWarpPlanID <=0 ) { alert("Please select an item from list."); return ; }

    //    var nIndex=$('#tblFabricWarpPlan').datagrid('getRowIndex',oFabricWarpPlan);
    //    sessionStorage.setItem("Operation", "Cancel");
    //    sessionStorage.setItem("SelectedRowIndex", nIndex);
    //    sessionStorage.setItem("FabricWarpPlanHeader", "Cancel Production");
    //    sessionStorage.setItem("FabricWarpPlans", JSON.stringify($('#tblFabricWarpPlan').datagrid('getRows')));
    //    sessionStorage.setItem("BackLink", window.location.href);
    //    var tsv=((new Date()).getTime())/1000;
    //    window.location.href = _sBaseAddress+ "/FabricWarpPlan/ViewFabricWarpPlan?nId="+oFabricWarpPlan.FabricWarpPlanID+"&ts="+tsv;

    //});
    $('#btnDelete').click(function(e){
        debugger;
        var oFabricWarpPlan = $('#tblFabricWarpPlan').datagrid('getSelected');
        oFabricWarpPlan.StartTime = new Date(oFabricWarpPlan.StartTimeSt); //icsdateformat(oFabricWarpPlan.StartTimeSt);
        oFabricWarpPlan.EndTime = new Date(oFabricWarpPlan.EndTimeSt); //icsdateformat(oFabricWarpPlan.EndTimeSt);
        if (oFabricWarpPlan ==null || oFabricWarpPlan.FabricWarpPlanID <=0 ) { alert("Please select an item from list."); return ; }
        if (!confirm("Confirm to delete?")) return;
        sessionStorage.clear();
        var obj =
        {
            BaseAddress: _sBaseAddress,
            Object: oFabricWarpPlan,
            ControllerName: "FabricWarpPlan",
            ActionName: "Delete",
            TableId: "tblFabricWarpPlan",
            IsWinClose: false
        };
        $.icsDelete(obj);

    });
    $('#btnCut').click(function(e){
        debugger;

        var oFabricWarpPlan = $('#tblFabricWarpPlan').datagrid('getSelected');
        oFabricWarpPlan.StartTime = new Date(oFabricWarpPlan.StartTimeSt); //icsdateformat(oFabricWarpPlan.StartTimeSt);
        oFabricWarpPlan.EndTime = new Date(oFabricWarpPlan.EndTimeSt); //icsdateformat(oFabricWarpPlan.EndTimeSt);
        if (oFabricWarpPlan ==null || oFabricWarpPlan.FabricWarpPlanID <=0 ) { alert("Please select an item from list."); return ; }

        _oFabricWarpPlan=oFabricWarpPlan;

        var SelectedRowIndex = $('#tblFabricWarpPlan').datagrid('getRowIndex', oFabricWarpPlan);
        $('#tblFabricWarpPlan').datagrid('deleteRow',SelectedRowIndex);
        $('#btnPast').show();
        $('#btnCut').hide();

    });
    $('#btnPast').click(function(e)
    {
        if(_oFabricWarpPlan==null|| _oFabricWarpPlan.FabricWarpPlanID<=0){alert("Nothing found for paste."); return;}
        //if(_oFabricWarpPlan.FMID<=0)
        //{
        //    alert("Select Machine from List.");
        //    return;
        //}
        debugger;

        var oFabricWarpPlan = $('#tblFabricWarpPlan').datagrid('getSelected');
        oFabricWarpPlan.StartTime = new Date(oFabricWarpPlan.StartTimeSt); //icsdateformat(oFabricWarpPlan.StartTimeSt);
        oFabricWarpPlan.EndTime = new Date(oFabricWarpPlan.EndTimeSt); //icsdateformat(oFabricWarpPlan.EndTimeSt);
        if (oFabricWarpPlan ==null || oFabricWarpPlan.FabricWarpPlanID <=0 ) { alert("Please select an item from list."); return ; }

        var nIndex=$('#tblFabricWarpPlan').datagrid('getRowIndex',oFabricWarpPlan);
        var dStartDate =oFabricWarpPlan.EndTimeSt;
        var startTime=oFabricWarpPlan.EndTimeSt;


        //if(_oFabricSizingPlan.FabricSizingPlanID<=0)
        //{
        //    var dStartDate =$('#txtStartDate').datebox('getValue');
        //    var startTime= $('#tpStartTime').timespinner('getValue');
        //}
        //else{
        //    var dStartDate =_oFabricSizingPlan.EndDateSt;
        //    var startTime=_oFabricSizingPlan.EndTimeTS;
        //}

        if(_oFabricWarpPlan.FMID<=0){
            alert("Invalid Machine !"); return;
        }
        if(oFabricWarpPlan.FMID<=0){
            alert("Invalid Machine !"); return;
        }

        var oFabricWP=
            {
                FabricWarpPlanID: (oFabricWarpPlan!=null &&oFabricWarpPlan.FabricWarpPlanID>0)? oFabricWarpPlan.FabricWarpPlanID:0,
                FMID:oFabricWarpPlan.FMID,
                BUID:sessionStorage.getItem('BUID'),
                Params:oFabricWarpPlan.FabricWarpPlanID+'~'+_oFabricWarpPlan.FabricWarpPlanID+'~'+dStartDate+"~"+startTime
            };

        //debugger;

        var nts=(new Date()).getTime()/1000;
        {
            //var sPSIDs=;
            $.ajax({
                type: "Post",
                dataType: "json",
                url: _sBaseAddress + "/FabricWarpPlan/PastSchedule",
                traditional: true,
                data:   JSON.stringify(oFabricWP),///{sPSIDs : sPSIDs, nts:nts}),
                contentType: "application/json; charset=utf-8",
                success: function (data)
                {
                    debugger;
                    var oresults=jQuery.parseJSON(data);
                    if(oresults[0].ErrorMessage=="" || oresults[0].ErrorMessage==null)
                    {
                        debugger;
                        alert("Paste Successfully");
                        var  oFabricWarpPlans=$('#tblFabricWarpPlan').datagrid('getRows');
                        // Replace with `33`
                        nIndex=nIndex+1;
                        if ( nIndex >= 0 ) {
                            oFabricWarpPlans.splice( nIndex, 0, oresults[0] );

                            DynamicRefreshList(oFabricWarpPlans, 'tblFabricWarpPlan');
                            $('#tblFabricWarpPlan').datagrid('selectRow', nIndex);
                        }

                        $('#btnCut').show();
                        $('#btnPast').hide();
                        //function move(array, oldIndex, newIndex) {
                        //    if (newIndex >= array.length) {
                        //        newIndex = array.length - 1;
                        //    }
                        //    array.splice(newIndex, 0, array.splice(oldIndex, 1)[0]);
                        //    return array;
                        //}

                        //var idx = data.indexOf(32);

                        //// Replace with `33`
                        //if ( idx >= 0 ) {
                        //    data.splice( idx, 0, 33 );
                        //}


                    }
                    else {alert(oresults[0].ErrorMessage);}
                    //alert(sMessage);
                    //if(sMessage=="Swap Successfully") { Refresh(); }

                },
                error: function (xhr, status, error) {alert(error);}
            });
        }
    });

    $('#btnSwap').click(function(e)
    {
        var oRows =  $('#tblFabricWarpPlan').datagrid('getChecked');
        if(oRows.length != 2){
            alert("Please select only two items!!");
            return;
        }
        for(var i=0;i<oRows.length;i++){
            if(oRows[i].FMID<=0){
                alert("Invalid Machine For Dispo No: "+oRows[i].ExeNo+" !"); return;
            }
            oRows[i].StartTime = new Date(oRows[i].StartTimeSt); //icsdateformat(oFabricSizingPlan.StartTimeSt);
            oRows[i].EndTime = new Date(oRows[i].EndTimeSt); //icsdateformat(oFabricSizingPlan.EndTimeSt);
        }

        if(!confirm("Are you sure want to swap?"))
            return false;

        var nIndex1=$('#tblFabricWarpPlan').datagrid('getRowIndex',oRows[0]);
        var nIndex2=$('#tblFabricWarpPlan').datagrid('getRowIndex',oRows[1]);

        var oFabricWP=
            {
                Params: oRows[0].FabricWarpPlanID+'~'+oRows[1].FabricWarpPlanID //+'~'+dStartDate+"~"+startTime
            };

        debugger;
        $.ajax({
            type: "Post",
            dataType: "json",
            url: _sBaseAddress + "/FabricWarpPlan/SwapTwoSchedule",
            traditional: true,
            data:   JSON.stringify(oFabricWP),
            contentType: "application/json; charset=utf-8",
            success: function (data)
            {
                debugger;
                var oresults=jQuery.parseJSON(data);
                if(oresults[0].ErrorMessage=="" || oresults[0].ErrorMessage==null)
                {
                    debugger;
                    alert("Swap Successfully");

                    $('#tblFabricWarpPlan').datagrid('updateRow',{index: nIndex1,row: oresults[1]});
                    $('#tblFabricWarpPlan').datagrid('updateRow',{index: nIndex2,row: oresults[0]});

                    $('#tblFabricWarpPlan').datagrid('selectRow', nIndex1);
                }
                else {alert(oresults[0].ErrorMessage);}
            },
            error: function (xhr, status, error) {alert(error);}
        });


    });

    //$('#btnView').click(function (e)
    //{
    //    var oFabricWarpPlan = $('#tblFabricWarpPlan').datagrid('getSelected');
    //    if (oFabricWarpPlan ==null || oFabricWarpPlan.FabricWarpPlanID <=0 ) { alert("Please select an item from list."); return ; }

    //    var nIndex=$('#tblFabricWarpPlan').datagrid('getRowIndex',oFabricWarpPlan);

    //    sessionStorage.clear();
    //    sessionStorage.setItem("Operation", "View");
    //    sessionStorage.setItem("SelectedRowIndex", nIndex);
    //    sessionStorage.setItem("DOHeader", "View Order");
    //    sessionStorage.setItem("FabricWarpPlans", JSON.stringify($('#tblFabricWarpPlan').datagrid('getRows')));
    //    sessionStorage.setItem("BackLink", window.location.href);
    //    var tsv=((new Date()).getTime())/1000;
    //    window.location.href = _sBaseAddress+ "/FabricWarpPlan/ViewFabricWarpPlan?nId="+oFabricWarpPlan.FabricWarpPlanID+"&ts="+tsv;;
    //});



    //////////////
    $("#btnPickOrderNo").click(function ()
    {
        var oPSDetail = {
            ExeNo:$('#txtOrderNo').val(),
            FMID:_oFabricWarpPlan.FMID,
            DODID:0,
            PlanType: $("#cboPlanType").val()
        };

        GetOrders(oPSDetail);
    });

    $("#txtOrderNo").keydown(function (e) {
        var nkeyCode = e.keyCode || e.which;
        if(nkeyCode==13){
            var sorderNo=$.trim($("#txtOrderNo").val());

            var oPSDetail = {
                ExeNo:$('#txtOrderNo').val(),
                FMID:_oFabricWarpPlan.FMID,
                PlanType: $("#cboPlanType").val()
            };
            GetOrders(oPSDetail);
        }
        else if(nkeyCode==8){

        }
    });

    $("#txtOrderNoTwo").keydown(function (e) {
        var nkeyCode = e.keyCode || e.which;
        if(nkeyCode==13){
            var sorderNo=$.trim($("#txtOrderNoTwo").val());

            if (sorderNo=="" ||sorderNo==null)
            {

                alert("Please Type Order no.");
                $('#txtOrderNoTwo').focus();
                $('#txtOrderNoTwo').addClass("errorFieldBorder");
                return;
            }
            else{
                $('#txtOrderNoTwo').removeClass("errorFieldBorder");
            }

            var oPSDetail = {
                OrderType:0,
                OrderNo:$('#txtOrderNoTwo').val(),
                LabDipDetailID:0,
                DODID:0
            };
            GetOrdersTwo(oPSDetail);
        }
        else if(nkeyCode==8){

        }
    });

    $("#txtBatchNoTwo").keydown(function (e) {
        var nkeyCode = e.keyCode || e.which;
        if(nkeyCode==13){
            var sRouteSheetNo=$.trim($("#txtBatchNoTwo").val());

            if (sRouteSheetNo=="" ||sRouteSheetNo==null)
            {

                alert("Please Type Batch no.");
                $('#txtBatchNoTwo').focus();
                $('#txtBatchNoTwo').addClass("errorFieldBorder");
                return;
            }
            else{
                $('#txtBatchNoTwo').removeClass("errorFieldBorder");
            }

            SearchDO("",sRouteSheetNo);
        }
        else if(nkeyCode==8){

        }
    });


    $("#btnResetOrderNo").click(function ()
    {
        $("#txtOrderNo").val("");
    });

    function GetOrders(oPSDetail)
    {

        var obj = {
            BaseAddress: _sBaseAddress,
            Object: oPSDetail,
            ControllerName: "FabricWarpPlan",
            ActionName: "GetsFabricExecutionSpe",
            IsWinClose: false
        };
        $("#progressbar").progressbar({ value: 0 });
        $("#progressbarParent").show();
        var intervalID = setInterval(updateProgress, 250);
        $.icsDataGets(obj, function (response) {
            clearInterval(intervalID);
            $("#progressbarParent").hide();
            if (response.status && response.objs.length > 0) {
                if (response.objs[0].FEOSID > 0) {
                    //debugger;
                    var tblColums = [];

                    var oColumn = { field: "ExeNo", title: "OrderNo", width: 100, align: "left" };tblColums.push(oColumn);
                    oColumn = { field: "ContractorName", title: "Customer", width: 100, align: "left" };tblColums.push(oColumn);
                    oColumn = { field: "Construction", title: "Construction ", width: 100, align: "left" };tblColums.push(oColumn);
                    oColumn = { field: "Composition", title: "Composition ", width: 100, align: "left" };tblColums.push(oColumn);
                    oColumn = { field: "Weave", title: "Design", width: 100, align: "left" };tblColums.push(oColumn);
                    oColumn = { field: "TFLength", title: "T/F Length", width: 75, align: "right",formatter:formatPrice };tblColums.push(oColumn);
                    oColumn = { field: "LengthReaming", title: "Remaing Length", width: 75, align: "right",formatter:formatPrice };tblColums.push(oColumn);
                    oColumn = { field: "RequiredWarpLength", title: "Required Warp Length", width: 75, align: "right",formatter:formatPrice };tblColums.push(oColumn);
                    oColumn = { field: "Qty_FWP", title: "Warping Qty", width: 75, align: "right",formatter:formatPrice };tblColums.push(oColumn);
                    oColumn = { field: "Qty", title: "Pending Qty", width: 75, align: "right",formatter:formatPrice };tblColums.push(oColumn);

                    var oPickerParam = {
                        winid: 'winOrderPicker',
                        winclass:'clsOrderPicker',
                        winwidth: 1000,
                        winheight: 660,
                        tableid: 'tblOrderPicker',
                        tablecolumns: tblColums,
                        datalist: response.objs,
                        multiplereturn: false,
                        searchingbyfieldName:'OrderNo',
                        windowTittle: 'Order List'
                    };
                    $.icsPicker(oPickerParam);
                    IntializePickerbutton(oPickerParam);//multiplereturn, winclassName
                }
                else { alert(response.objs[0].ErrorMessage); }
            }
            else{
                alert("No order found.");
            }
        });


    }
    function GetOrdersTwo(oPSDetail)
    {

        var obj = {
            BaseAddress: _sBaseAddress,
            Object: oPSDetail,
            ControllerName: "FabricWarpPlan",
            ActionName: "GetsFabricExecutionSpe",
            IsWinClose: false
        };
        $("#progressbar").progressbar({ value: 0 });
        $("#progressbarParent").show();
        var intervalID = setInterval(updateProgress, 250);
        $.icsDataGets(obj, function (response) {
            clearInterval(intervalID);
            $("#progressbarParent").hide();
            if (response.status && response.objs.length > 0) {
                if (response.objs[0].FEOSID > 0) {
                    //debugger;
                    var tblColums = [];

                    var oColumn = { field: "ExeNo", title: "OrderNo", width: 100, align: "left" };tblColums.push(oColumn);
                    oColumn = { field: "ContractorName", title: "Customer", width: 100, align: "left" };tblColums.push(oColumn);
                    oColumn = { field: "Construction", title: "Construction ", width: 100, align: "left" };tblColums.push(oColumn);
                    oColumn = { field: "Composition", title: "Composition ", width: 100, align: "left" };tblColums.push(oColumn);
                    oColumn = { field: "Weave", title: "Design", width: 100, align: "left" };tblColums.push(oColumn);
                    oColumn = { field: "RequiredWarpLength", title: "Required Warp Length", width: 75, align: "right",formatter:formatPrice };tblColums.push(oColumn);
                    var oPickerParam = {
                        winid: 'winOrderPickerTwo',
                        winclass:'clsOrderPicker',
                        winwidth: 1000,
                        winheight: 660,
                        tableid: 'tblOrderPicker',
                        tablecolumns: tblColums,
                        datalist: response.objs,
                        multiplereturn: true,
                        searchingbyfieldName:'OrderNo',
                        windowTittle: 'Order List'
                    };
                    $.icsPicker(oPickerParam);
                    IntializePickerbutton(oPickerParam);//multiplereturn, winclassName
                }
                else { alert(response.objs[0].ErrorMessage); }
            }
            else{
                alert("No order found.");
            }
        });


    }
    $("#btnResetMachine").click(function () {

        $("#txtMachine").val("");
        _oFabricWarpPlan.FMID=0;
    });

    $("#btnPickMachine").click(function () {

        var sMachineName=$.trim($("#txtMachine").val());
        //if(sMachineName==""){ alert("Type machine name to search."); return false; }
        GetMachines(sMachineName);
    });

    $("#txtMachine").keydown(function (e) {
        var nkeyCode = e.keyCode || e.which;
        if(nkeyCode==13){
            var sMachineName=$.trim($("#txtMachine").val());
            //if(sMachineName==""){ alert("Type machine name to search."); return false; }
            GetMachines(sMachineName);
        }
        else if(nkeyCode==8){
            $("#txtMachine").val("");
            _oFabricWarpPlan.FMID=0;
        }
    });
    function GetMachines(sMachineName){

        var oMachine = {
            BUID:sessionStorage.getItem('BUID'),
            //ResourcesTypeInInt:2,
            Name:sMachineName
        };
        var obj = {
            BaseAddress: _sBaseAddress,
            Object: oMachine,
            ControllerName: "FabricWarpPlan",
            ActionName: "GetsMachine",
            IsWinClose: false
        };

        $.icsDataGets(obj, function (response) {

            if (response.status && response.objs.length > 0) {
                if (response.objs[0].FMID > 0) {
                    //debugger;
                    var tblColums = [];
                    var oColumn = { field: "Code", title: "Code", width: 100, align: "left" };tblColums.push(oColumn);
                    oColumn = { field: "Name", title: "Machine Name", width: 150, align: "left" };tblColums.push(oColumn);
                    oColumn = { field: "MachineStatusInString", title: "Status", width: 90, align: "left" };tblColums.push(oColumn);
                    //oColumn = { field: "SequenceNo", title: "SL No", width: 150, align: "left" };tblColums.push(oColumn);

                    var oPickerParam = {
                        winid: 'winMachinePicker',
                        winclass:'clsMachinePicker',
                        winwidth: 480,
                        winheight: 460,
                        tableid: 'tblMachinePicker',
                        tablecolumns: tblColums,
                        datalist: response.objs,
                        multiplereturn: false,
                        searchingbyfieldName:'Name',
                        windowTittle: 'Machine List'
                    };
                    $.icsPicker(oPickerParam);
                    IntializePickerbutton(oPickerParam);//multiplereturn, winclassName
                }
                else { alert(response.objs[0].ErrorMessage); }
            }
            else{
                alert("No machine found.");
            }
        });


    }


    function IntializePickerbutton(oPickerobj) {
        $("#" + oPickerobj.winid).find("#btnOk").click(function () {
            //for Single Select
            SetPickerValueAssign(oPickerobj);
        });
        $(document).find('.' + oPickerobj.winclass).keydown(function (e) {
            if (e.which == 13)//enter=13
            {
                SetPickerValueAssign(oPickerobj);

            }
        });
    }
    function SetPickerValueAssign(oPickerobj) {
        //debugger;
        var oreturnObj = null, oreturnobjs = [];
        if (oPickerobj.multiplereturn) {
            oreturnobjs = $('#' + oPickerobj.tableid).datagrid('getChecked');
        } else {
            oreturnObj = $('#' + oPickerobj.tableid).datagrid('getSelected');
        }
        $("#" + oPickerobj.winid).icsWindow("close");
        $("#" + oPickerobj.winid).remove();

        if (oPickerobj.winid == 'winLabDipPicker')
        {
            if (oreturnObj != null && oreturnObj.LabDipDetailID > 0)
            {
                $('#txtColorNo').val(oreturnObj.ColorNo);
                //$('#txtColorName').val(oreturnObj.ColorName);
                $('#txtLabdipNo').val(oreturnObj.LabdipNo);
                _nLabDipDetailID= oreturnObj.LabDipDetailID;
            }
            else{
                alert("Data Not Found.");
                return;
            }
        }
        else if (oPickerobj.winid == 'winMachinePicker')
        {debugger;
            if(oreturnObj !=null  && oreturnObj.FMID>0){

                $('#txtMachine').val(oreturnObj.Name);
                _oFabricWarpPlan.FMID= oreturnObj.FMID;
                SetLastScheduleTime();
            }
            else{
                alert("Please select machine.");
            }
        }
        else if (oPickerobj.winid == 'winMachinesPicker')
        {
            if(oreturnobjs.length > 0){
                if(oreturnobjs.length == 1){
                    $("#txtMachineName").val(oreturnobjs[0].Name);
                    $("#winAdvSearch").data("MachineIDs",oreturnobjs[0].FMID);
                }else{
                    var ids = "";
                    for(var i=0;i<oreturnobjs.length;i++){
                        ids += oreturnobjs[i].FMID + ",";
                    }
                    if(ids.length > 0) ids = ids.substring(0, ids.length-1);
                    $("#txtMachineName").val("You select " + oreturnobjs.length + " Machines");
                    $("#winAdvSearch").data("MachineIDs",ids);
                }
            }else{
                alert("Please select machine.");
            }
        }
        else if (oPickerobj.winid == 'winCustomersPicker')
        {
            if(oreturnobjs.length > 0){
                if(oreturnobjs.length == 1){
                    $("#txtCustomerName").val(oreturnobjs[0].Name);
                    $("#winAdvSearch").data("CustomerIDs",oreturnobjs[0].ContractorID);
                }else{
                    var ids = "";
                    for(var i=0;i<oreturnobjs.length;i++){
                        ids += oreturnobjs[i].ContractorID + ",";
                    }
                    if(ids.length > 0) ids = ids.substring(0, ids.length-1);
                    $("#txtCustomerName").val("You select " + oreturnobjs.length + " Customers");
                    $("#winAdvSearch").data("CustomerIDs",ids);
                }
            }else{
                alert("Please select Customer.");
            }
        }

        else if (oPickerobj.winid == 'winOrderPicker')
        {
            debugger;
            if(oreturnObj !=null  && oreturnObj.FEOSID>0)
            {
                var oFabricWarpPlan=null;
                oFabricWarpPlan=oreturnObj;

                GetsOrderInfo(oreturnObj);
                oFabricWarpPlan.WeftColor=_oFabricWarpPlan.WeftColor;
                oFabricWarpPlan.WarpColor=_oFabricWarpPlan.WarpColor;
                oFabricWarpPlan.TFLength=_oFabricWarpPlan.TFLength;
                oFabricWarpPlan.TFLength=_oFabricWarpPlan.TFLength;
                RefreshControl(oFabricWarpPlan);
            }

            else{
                alert("Data Not Found.");
                return;
            }
        }
        else if (oPickerobj.winid == 'winOrderPickerTwo')
        {
            if (oreturnobjs != null && oreturnobjs.length> 0)
            {

                var sDODIDs=''; var sMessage='';
                sMessage=(oreturnobjs.length>1)? oreturnobjs.length +" Order(s) Selected" : oreturnobjs[0].OrderNo;
                $('#txtOrderNoTwo').val(sMessage);
                $("#txtOrderNoTwo").addClass("fontColorOfPickItem");

                for(var i=0;i<oreturnobjs.length;i++){
                    sDODIDs=sDODIDs+oreturnobjs[i].FEOSID+',';
                }
                sDODIDs=sDODIDs.substring(0,sDODIDs.length-1);
                SearchDO(sDODIDs,"");
            }
            else
            {
                alert("Please select a Order.");
                return false;
            }

        }
    }
    function GetsOrderInfo(oFabricWarpPlan) {
        var obj =
            {
                BaseAddress: _sBaseAddress,
                Object: oFabricWarpPlan,
                ControllerName: "FabricWarpPlan",
                ActionName: "GetsOrderDetails",
                IsWinClose: false
            };
        $.icsDataGet(obj, function (response) {

            if (response.status && response.obj != null) {
                debugger;
                _oFabricWarpPlan=response.obj;
                RefreshControl(_oFabricWarpPlan);

            }
        });

    }
    $("#btnClosePS").click(function () {
        $("#winDUFabricWarpPlan").icsWindow("close");

    });
    $('#btnCurrenttime').click(function(e)
    {
        var oDate=new Date();
        oDate.setMinutes(oDate.getMinutes()+5);
        SetStartTime(oDate);
        AddTime(oDate);
    });

    function SetLastScheduleTime()
    {

        if(parseInt(_oFabricWarpPlan.FMID)>0 )
        {
            var nts=(new Date()).getTime()/1000;
            $.ajax({
                type: "GET",
                dataType: "json",
                url: _sBaseAddress + "/FabricWarpPlan/GetPSByMachine",
                data: { nFMID: _oFabricWarpPlan.FMID ,  nts:nts },
                contentType: "application/json; charset=utf-8",
                success: function(data)
                {
                    ////debugger;
                    var sStratTime = jQuery.parseJSON(data);
                    if ($.trim(sStratTime)!='')
                    {
                        SetStartTime(new Date(sStratTime));
                        AddTime(new Date(sStratTime));
                    }
                    else
                    {
                        var oDate=new Date();
                        oDate.setMinutes(oDate.getMinutes()+5);
                        SetStartTime(oDate);
                        AddTime(oDate);
                    }
                },
                error: function(xhr, status, error)
                {
                    alert(error);
                }
            });
        }

    }

    $('#btnScheduleLastTime').click(function(e)
    {

        SetLastScheduleTime();
    });
    function SetStartTime(oDate)
    {

        //debugger;

        $('#txtStartDate').datebox('setValue', icsdateformat(oDate));
        var nHour=oDate.getHours();
        var nMin=oDate.getMinutes();
        if(isNaN(nHour))
        {
            nHour=0;
        }
        if(isNaN(nMin))
        {
            nMin=0;
        }
        $('#tpStartTime').timespinner('setValue', nHour+":"+nMin);

    }

    function AddTime(sDate)
    {
        //debugger;  //Previous Code
        //var nhr=$('#tpStartTime').timespinner('getHours');
        //var nmin=$('#tpStartTime').timespinner('getMinutes');
        //if(isNaN(nhr))
        //{
        //    nhr=0;
        //}
        //if(isNaN(nmin))
        //{
        //    nmin=0;
        //}
        //var oDate=new Date(sDate);
        //oDate.setHours(oDate.getHours()+nhr);
        //oDate.setMinutes(oDate.getMinutes()+nmin);
        //$('#txtEndDate').datebox('setValue', icsdateformat(oDate));
        //var nHour=oDate.getHours();
        //var nMin=oDate.getMinutes();
        //if(isNaN(nHour))
        //{
        //    nHour=0;
        //}
        //if(isNaN(nMin))
        //{
        //    nMin=0;
        //}
        //$('#tpEndTime').timespinner('setValue', nHour+":"+nMin);

        //Add 10 mins from start date
        var oDate = new Date($('#txtStartDate').datebox('getValue'));
        oDate.setHours(new Date().getHours());
        oDate.setMinutes(new Date().getMinutes());

        var nHour=oDate.getHours();
        var nMin=oDate.getMinutes();
        if(isNaN(nHour))
            nHour=0;
        if(isNaN(nMin))
            nMin=0;
        $('#tpStartTime').timespinner('setValue', nHour+":"+nMin);

        oDate.setMinutes(oDate.getMinutes() + 10);
        $('#txtEndDate').datebox('setValue', icsdateformat(oDate));
        nHour=oDate.getHours();
        nMin=oDate.getMinutes();
        if(isNaN(nHour))
            nHour=0;
        if(isNaN(nMin))
            nMin=0;
        $('#tpEndTime').timespinner('setValue', nHour+":"+nMin);

    }

    function ValidationOfStartTime()
    {
        if(new Date($('#txtStartDate').datebox('getValue'))> new Date($('#txtEndDate').datebox('getValue'))){
            alert("Start time must be later than End time.");
            return false;
        }
        return true;
    }

    $('#btnAddSpinnerTime').click(function(e)
    {
        var dStartDate =$('#txtStartDate').datebox('getValue');

        var hOur=$('#tpStartTime').timespinner('getHours');
        var mIn=$('#tpStartTime').timespinner('getMinutes');
        var oStartDate=new Date(dStartDate);
        oStartDate.setHours(oStartDate.getHours()+hOur);
        oStartDate.setMinutes(oStartDate.getMinutes()+mIn);
        //oStartDate = icsdatetimeformat(oStartDate);

        var nhr=$('#tptimeSpinner').timespinner('getHours');
        var nmin=$('#tptimeSpinner').timespinner('getMinutes');
        if(isNaN(nhr))
        {
            nhr=0;
        }
        if(isNaN(nmin))
        {
            nmin=0;
        }
        var oDate=new Date(oStartDate);
        oDate.setHours(oDate.getHours()+nhr);
        oDate.setMinutes(oDate.getMinutes()+nmin);
        AddTimeToEndDate(oDate);
        if(!ValidationOfStartTime())return;
    });

    function AddTimeToEndDate(sDate)
    {
        debugger;
        var oDate=new Date(sDate);
        var nhr = oDate.getHours();
        var nmin = oDate.getMinutes();
        $('#txtEndDate').datebox('setValue', icsdateformat(oDate));
        $('#tpEndTime').timespinner('setValue', nhr+":"+nmin);

    }

    function RefreshObject()
    {
        debugger;
        var dStartDate =$('#txtStartDate').datebox('getValue');
        var startTime= $('#tpStartTime').timespinner('getValue');
        var sTime=startTime.split(':');
        var hStartTime= parseFloat(sTime[0]);
        var mStartTime= parseFloat(sTime[1]);
        dStartDate = new Date(dStartDate);
        dStartDate.setHours(hStartTime);
        dStartDate.setMinutes(mStartTime);

        var dEndtDate =$('#txtEndDate').datebox('getValue');
        var EndtTime= $('#tpEndTime').timespinner('getValue');
        var sTime=EndtTime.split(':');
        var hEndtTime= parseFloat(sTime[0]);
        var mEndtTime= parseFloat(sTime[1]);
        dEndtDate = new Date(dEndtDate);
        dEndtDate.setHours(hEndtTime);
        dEndtDate.setMinutes(mEndtTime);


        var oFabricWarpPlan = {
            FabricWarpPlanID     : (_oFabricWarpPlan!=null && _oFabricWarpPlan.FabricWarpPlanID>0)? _oFabricWarpPlan.FabricWarpPlanID:0,
            FMID                   : _oFabricWarpPlan.FMID,
            FEOSID                 : _oFabricWarpPlan.FEOSID,
            FSCDID                 : _oFabricWarpPlan.FSCDID,
            BatchNo                : _oFabricWarpPlan.BatchNo,
            BUID                   :sessionStorage.getItem('BUID'),
            Qty : $('#txtQty').val(),
            ScheduleType           : _oFabricWarpPlan.ScheduleType,
            StartTime	           : dStartDate,
            EndTime                : dEndtDate,
            Note                   : $("#txtNote").val(),
            WarpBeam               : $("#txtWarpBeam").val(),
            Priority               : $("#cboPriority").val(),
            PlanType               : $("#cboPlanType").val()
        };
        return oFabricWarpPlan;
    }
    function Save()
    {
        debugger;


        if(!ValidationOfStartTime())return;
        if(_oFabricWarpPlan.FMID==null || _oFabricWarpPlan.FMID<=0)
        {
            alert("Please, first select a FMID.");
            return;
        }

        //var ntotalQuantity = (oScheduleDetail.BatchNo * oScheduleDetail.ProductionQty);
        //if( ntotalQuantity<1)
        //{
        //    alert("Number of yet to schedule must greater than zero.");
        //    return;
        //}
        var oFabricWarpPlan=RefreshObject();
        var nts=(new Date()).getTime()/1000;

        $('#btnSave').hide();

        $.ajax({
            type: "POST",
            dataType: "json",
            url: _sBaseAddress + "/FabricWarpPlan/ScheduleInTimePeriod",
            data: JSON.stringify({oFabricWarpPlan:oFabricWarpPlan, nts: nts}),
            contentType: "application/json; charset=utf-8",
            success: function(data)
            {
                ////debugger;
                var nCount = jQuery.parseJSON(data);
                if (nCount>0)
                {
                    if(confirm("Are you sure to increase time from next all schedules."))
                    {
                        oFabricWarpPlan.IsIncreaseTime=true;
                        SaveProductionSchedule(oFabricWarpPlan);
                        //$("#winDUFabricWarpPlan").icsWindow("close");
                        //$('#btnSave').show();
                    }
                }
                else if(nCount==0)
                {
                    oFabricWarpPlan.IsIncreaseTime=false;
                    SaveProductionSchedule(oFabricWarpPlan);
                    //$("#winDUFabricWarpPlan").icsWindow("close");
                    //$('#btnSave').show();
                }
            },
            error: function(xhr, status, error)
            {
                alert(error);
                $('#btnSave').show();
            }
        });
    }
    function SaveProductionSchedule(oFabricWarpPlan)
    {
        $.ajax({
            type: "POST",
            dataType: "json",
            url : _sBaseAddress+  "/FabricWarpPlan/Save",
            traditional: true,
            data:  JSON.stringify(oFabricWarpPlan),
            contentType: "application/json; charset=utf-8",
            success: function (data) {
                ////debugger;
                var oDUPS = jQuery.parseJSON(data);
                if (oDUPS.ErrorMessage=="")
                {
                    _oFabricWarpPlan=oDUPS;
                    alert("Data Saved successfully");

                    GetsFabricBatch(_oFabricWarpPlan.FabricWarpPlanID);

                    if(_oIsAdd==true)
                    {
                        var oFabricWarpPlans= $('#tblFabricWarpPlan').datagrid('getRows');
                        var nIndex=oFabricWarpPlans.length;

                        $('#tblFabricWarpPlan').datagrid('appendRow', _oFabricWarpPlan);
                        $('#tblFabricWarpPlan').datagrid('selectRow', nIndex);
                        _nSelectedRowIndex=nIndex
                        _oIsAdd=false;
                    }
                    else
                    {
                        $('#tblFabricWarpPlan').datagrid('updateRow', { index: _nSelectedRowIndex, row: _oFabricWarpPlan });
                        $('#tblFabricWarpPlan').datagrid('selectRow', _nSelectedRowIndex);
                    }
                    //$("#winDUFabricWarpPlan").icsWindow("close");

                    $("#btnAddFB").show();
                }
                else {
                    alert(oDUPS.ErrorMessage);
                }
                $('#btnSave').show();
            },
            error: function (xhr, status, error) {
                alert(error);
            }


        });
    }

    $("#btnUpdatePlanStatus").click(function () {
        var oFabricWarpPlan = $('#tblFabricWarpPlan').datagrid('getSelected');
        if (oFabricWarpPlan ==null || oFabricWarpPlan.FabricWarpPlanID <=0 ) { alert("Please select a valid item from list."); return ; }

        //if (oFabricWarpPlan.PlanStatus==3) { alert("Already finish. Unable to Change Status."); return ; }

        var nIndex=$('#tblFabricWarpPlan').datagrid('getRowIndex',oFabricWarpPlan);
        if(parseInt($("#cboPlanStatus").val()) <= 0) {alert("Please select a status!!"); return;}
        //if(oFabricWarpPlan.Status > 1 && parseInt($("#cboPlanStatus").val()) == 2){
        //    alert("Hold is not possible, Because Batch status is "+oFabricWarpPlan.StatusSt);
        //    return;
        //}
        oFabricWarpPlan.PlanStatus = $("#cboPlanStatus").val();
        oFabricWarpPlan.Priority = $("#cboPriority").val();
        $.ajax({
            type: "POST",
            dataType: "json",
            url : _sBaseAddress+  "/FabricWarpPlan/UpdatePlanStatus",
            traditional: true,
            data: JSON.stringify(oFabricWarpPlan),
            contentType: "application/json; charset=utf-8",
            success: function (data) {
                oFabricWarpPlan = jQuery.parseJSON(data);
                if(oFabricWarpPlan!=null)
                {
                    if(oFabricWarpPlan.ErrorMessage=="" || oFabricWarpPlan.ErrorMessage == null)
                    {
                        alert("Updated Successful");
                        $('#tblFabricWarpPlan').datagrid('updateRow',{ index: nIndex, row: oFabricWarpPlan });
                    }
                    else
                    {
                        alert(oFabricWarpPlan.ErrorMessage);
                    }
                }
                else
                {
                    alert("Invalid Operation!");
                }

            },
            error: function (xhr, status, error) {
                alert(error);
            }
        });
    });

    //////advance Search

    $("#btnClrMachinePiker").click(function () {

        $("#txtMachineName").val("");
        $("#winAdvSearch").data("MachineIDs","");
    });

    $("#btnMachinePiker").click(function () {

        var sMachineName=$.trim($("#txtMachineName").val());
        //if(sMachineName==""){ alert("Type machine name to search."); return false; }
        GetMachinespp(sMachineName);
    });

    $("#txtMachineName").keydown(function (e) {
        var nkeyCode = e.keyCode || e.which;
        if(nkeyCode==13){
            var sMachineName=$.trim($("#txtMachineName").val());
            //if(sMachineName==""){ alert("Type machine name to search."); return false; }
            GetMachinespp(sMachineName);
        }
        else if(nkeyCode==8){
            $("#txtMachineName").val("");
            $("#winAdvSearch").data("MachineIDs","");
        }
    });
    function GetMachinespp(sMachineName){

        var oMachine = {
            BUID:sessionStorage.getItem('BUID'),
            //ResourcesTypeInInt:2,
            Name:sMachineName
        };
        var obj = {
            BaseAddress: _sBaseAddress,
            Object: oMachine,
            ControllerName: "FabricWarpPlan",
            ActionName: "GetsMachine",
            IsWinClose: false
        };

        $.icsDataGets(obj, function (response) {

            if (response.status && response.objs.length > 0) {
                if (response.objs[0].FMID > 0) {
                    //debugger;
                    var tblColums = [];
                    var oColumn = { field: "Code", title: "Code", width: 100, align: "left" };tblColums.push(oColumn);
                    oColumn = { field: "Name", title: "Machine Name", width: 150, align: "left" };tblColums.push(oColumn);
                    //oColumn = { field: "Capacity", title: "Capacity", width: 90, align: "left" };tblColums.push(oColumn);
                    //oColumn = { field: "SequenceNo", title: "SL No", width: 150, align: "left" };tblColums.push(oColumn);

                    var oPickerParam = {
                        winid: 'winMachinesPicker',
                        winclass:'clsMachinesPicker',
                        winwidth: 480,
                        winheight: 460,
                        tableid: 'tblMachinesPicker',
                        tablecolumns: tblColums,
                        datalist: response.objs,
                        multiplereturn: true,
                        searchingbyfieldName:'Name',
                        windowTittle: 'Machine List'
                    };
                    $.icsPicker(oPickerParam);
                    IntializePickerbutton(oPickerParam);//multiplereturn, winclassName
                }
                else { alert(response.objs[0].ErrorMessage); }
            }
            else{
                alert("No machine found.");
            }
        });
    }

    $("#btnClrCustomerPiker").click(function () {
        $("#txtCustomerName").val("");
        $("#winAdvSearch").data("CustomerIDs","");
    });

    $("#btnCustomerPiker").click(function () {
        var sCustomerName=$.trim($("#txtCustomerName").val());
        //if(sCustomerName==""){ alert("Type Customer name to search."); return false; }
        GetCustomers(sCustomerName);
    });

    $("#txtCustomerName").keydown(function (e) {
        var nkeyCode = e.keyCode || e.which;
        if(nkeyCode==13){
            var sCustomerName=$.trim($("#txtCustomerName").val());
            //if(sCustomerName==""){ alert("Type Customer name to search."); return false; }
            GetCustomers(sCustomerName);
        }
        else if(nkeyCode==8){
            $("#txtCustomerName").val("");
            $("#winAdvSearch").data("CustomerIDs","");
        }
    });
    function GetCustomers(sCustomerName){

        var oCustomer = {
            Name:sCustomerName
        };
        var obj = {
            BaseAddress: _sBaseAddress,
            Object: oCustomer,
            ControllerName: "FabricWarpPlan",
            ActionName: "GetsCustomer",
            IsWinClose: false
        };

        $.icsDataGets(obj, function (response) {
            debugger;
            if (response.status && response.objs.length > 0) {
                if (response.objs[0].ContractorID > 0) {
                    debugger;
                    var tblColums = [];
                    var oColumn = { field: "Name", title: "Name", width: 200, align: "left" }; tblColums.push(oColumn);
                    oColumn = { field: "Address", title: "Address", width: 120, align: "left" }; tblColums.push(oColumn);
                    oColumn = { field: "Email", title: "Email", width: 90, align: "left" }; tblColums.push(oColumn);
                    oColumn = { field: "ShortName", title: "Short Name", width: 90, align: "left" }; tblColums.push(oColumn);

                    var oPickerParam = {
                        winid: 'winCustomersPicker',
                        winclass:'clsCustomersPicker',
                        winwidth: 480,
                        winheight: 460,
                        tableid: 'tblCustomersPicker',
                        tablecolumns: tblColums,
                        datalist: response.objs,
                        multiplereturn: true,
                        searchingbyfieldName:'Name',
                        windowTittle: 'Customer List'
                    };
                    $.icsPicker(oPickerParam);
                    IntializePickerbutton(oPickerParam);//multiplereturn, winclassName
                }
                else { alert(response.objs[0].ErrorMessage); }
            }
            else{
                alert("No Customer found.");
            }
        });
    }

    function CheckFromAndToDateValidation(OperationComboId, FromDateId, ToDateId) {
        $("#" + OperationComboId).parent().parent().parent().find("select").removeClass("errorFieldBorder");
        var nCboVal = $("#" + OperationComboId).val();
        if (parseInt(nCboVal) == 5 || parseInt(nCboVal) == 6) {
            var fromDate = $("#" + FromDateId).datebox("getValue");
            var toDate = $("#" + ToDateId).datebox("getValue");
            if (new Date(fromDate) > new Date(toDate)) {
                $("#" + ToDateId).focus();
                $("#" + OperationComboId).addClass("errorFieldBorder");
                $(".lblLoadingMessage").hide();
                return false;
            } else {
                $("#" + OperationComboId).removeClass("errorFieldBorder");
                return true;
            }
        } else {
            return true;
        }
    }

    function ResetAdvSearchWindow() {
        _sContractorIds = '';
        _sDeliverToIDs = "";
        _sCPersonnelIds="";
        $("#winAdvSearch input").not("input[type='button']").val("");
        $("#winAdvSearch input").removeClass("fontColorOfPickItem");
        $("#winAdvSearch select").val(0);
        DateActionsDateAdvSearch();
        $("#txtFromDateAdvSearch,#txtToDateAdvSearch").datebox({ disabled: true });
        $("#txtFromDateAdvSearch,#txtToDateAdvSearch").datebox("setValue", icsdateformat(new Date()));
    }

    function PickContractors_AdvS() {
        var oContractor = {
            Params: '2,3' + '~' + $.trim($("#txtContractorAdvS").val())+"~"+_nBUID
        };
        var obj = {
            BaseAddress: _sBaseAddress,
            Object: oContractor,
            ControllerName: "Contractor",
            ActionName: "ContractorSearchByNameType",
            IsWinClose: false
        };

        $("#progressbar").progressbar({ value: 0 });
        $("#progressbarParent").show();
        var intervalID = setInterval(updateProgress, 250);

        DynamicRefreshList([], "tblAccountsPickerAdvSearch");
        $.icsDataGets(obj, function (response) {
            clearInterval(intervalID);
            $("#progressbarParent").hide();
            if (response.status && response.objs.length > 0) {
                if (response.objs[0].ContractorID > 0) {
                    var tblColums = []; var oColumn = { field: "ContractorID", title: "Code", width: 50, align: "left" }; tblColums.push(oColumn);
                    oColumn = { field: "Name", title: "Name", width: 280, align: "left" }; tblColums.push(oColumn);

                    var oPickerParam = {
                        winid: 'winContractorPicker',
                        winclass: 'clsAccountOf',
                        winwidth: 400,
                        winheight: 460,
                        tableid: 'tblAccountOfs',
                        tablecolumns: tblColums,
                        datalist: response.objs,
                        multiplereturn: true,
                        searchingbyfieldName: 'Name',
                        windowTittle: 'Contactor List'
                    };
                    $.icsPicker(oPickerParam);
                    IntializePickerbutton(oPickerParam);
                }
                else {
                    alert(response.objs[0].ErrorMessage);
                }
            }
            else {
                alert("Sorry, No Contactor Found.");
            }
        });
    }

    function PickDeliverTo_AdvS() {
        var oContractor = {
            Params: '2' + '~' + $.trim($("#txtDeliverToAdvS").val()+"~"+_nBUID)
        };
        var obj = {
            BaseAddress: _sBaseAddress,
            Object: oContractor,
            ControllerName: "Contractor",
            ActionName: "ContractorSearchByNameType",
            IsWinClose: false
        };
        $("#progressbar").progressbar({ value: 0 });
        $("#progressbarParent").show();
        var intervalID = setInterval(updateProgress, 250);
        DynamicRefreshList([], "tblContractorsPickerAdvSearch");
        $.icsDataGets(obj, function (response) {
            clearInterval(intervalID);
            $("#progressbarParent").hide();
            if (response.status && response.objs.length > 0) {
                if (response.objs[0].ContractorID > 0) {
                    var tblColums = []; var oColumn = { field: "ContractorID", title: "Code", width: 50, align: "left" }; tblColums.push(oColumn);
                    oColumn = { field: "Name", title: "Name", width: 280, align: "left" }; tblColums.push(oColumn);
                    var oPickerParam = {
                        winid: 'winBuyers',
                        winclass: 'clsBuyer',
                        winwidth: 400,
                        winheight: 460,
                        tableid: 'tblBuyers',
                        tablecolumns: tblColums,
                        datalist: response.objs,
                        multiplereturn: true,
                        searchingbyfieldName: 'Name',
                        windowTittle: 'Buyer List'
                    };
                    $.icsPicker(oPickerParam);
                    IntializePickerbutton(oPickerParam);
                }
                else {
                    alert(response.objs[0].ErrorMessage);
                }
            }
            else {
                alert("Sorry, No Contactor Found.");
            }
        });
    }
    function DateActionsDateAdvSearch() {
        DynamicDateActions("cboDateAdvS", "txtFromDateAdvSearch", "txtToDateAdvSearch");
    }
    $("#btnCloseAdvSearch").click(function () {
        $("#winAdvSearch").icsWindow("close");
    });
    $("#btnAdvSearch").click(function () {
        debugger;
        $("#winAdvSearch").icsWindow("open", " Advance Search");

        DynamicResetAdvSearchWindow("winAdvSearch");
        DynamicDateActions("cboDateAdvS", "txtFromDateAdvSearch", "txtToDateAdvSearch");
        ResetAdvSearchWindow();
        $("#cboDateAdvS").icsLoadCombo({
            List: _oCompareOperators,
            OptionValue: "id",
            DisplayText: "Value"
        });
    });
    $('#txtSearchByDispoNo').keypress(function (e) {
        var code = (e.keyCode ? e.keyCode : e.which);
        if (code == 13)//Enter key-13
        {
            var nCboOrderDate = 0;
            var dFromOrderDate = icsdateformat(new Date());
            var dToOrderDate = icsdateformat(new Date());
            var sExeNo = $.trim($("#txtSearchByDispoNo").val());

            debugger;
            var sParams = nCboOrderDate + "~" +
                          dFromOrderDate + "~" +
                          dToOrderDate + "~" +
                          sExeNo + "~" +
                          "" +"~"+
                          "" +"~"+
                          "" +"~"+
                          0 +"~"+
                        0 +"~"+
                        "" +"~"+
                        false;

            //console.log(sParams);
            sessionStorage.setItem("ParamsSO", sParams);
            var oFabricWarpPlan = {
                ErrorMessage : sParams
            };

            $.ajax({
                type: "POST",
                dataType: "json",
                url: _sBaseAddress + "/FabricWarpPlan/AdvSearch",
                traditional: true,
                data: JSON.stringify(oFabricWarpPlan),
                contentType: "application/json; charset=utf-8",
                success: function (data) {
                    var oFabricWarpPlans = data;
                    if (oFabricWarpPlans != null )
                    {
                        if (oFabricWarpPlans.length > 0 && oFabricWarpPlans[0].ErrorMessage=='')
                        {
                            DynamicRefreshList(oFabricWarpPlans, "tblFabricWarpPlan");
                            $.icsMakeFooterColumn('tblFabricWarpPlan',['ReedNo','Qty']);
                            $("#winAdvSearch").icsWindow("close");
                        }
                        else
                        {
                            alert("Sorry, No data found. "+(oFabricWarpPlans[0]==undefined?'':oFabricWarpPlans[0].ErrorMessage));
                            DynamicRefreshList([], "tblFabricWarpPlan");
                        }

                    } else {
                        alert("Sorry, No data found. ");
                        DynamicRefreshList([], "tblFabricWarpPlan");
                    }
                    $(".lblLoadingMessage").hide();
                }
            });
        }
        else if (code === 8) {
            DynamicRefreshList([], "tblExportBillReports");
        }
    });
    $("#btnSearchAdvSearch").click(function () {
        debugger;
        var checkDate = CheckFromAndToDateValidation("cboOrderDateAdvS", "txtFromOrderDateAdvSearch", "txtToOrderDateAdvSearch");
        if (!checkDate) {
            alert("Start date must be greater than end date.");
            return false;
        }
        var nCboOrderDate = parseInt($("#cboDateAdvS").val());
        var dFromOrderDate = $('#txtFromDateAdvSearch').datebox('getValue');
        var dToOrderDate = $('#txtToDateAdvSearch').datebox('getValue');

        var sExeNo = $.trim($("#txtExeNo").val());
        var sConstruction = $.trim($("#txtConstructions").val());
        var sMachineIDs = $("#winAdvSearch").data("MachineIDs");
        var sCustomerIDs = $("#winAdvSearch").data("CustomerIDs");
        var nDesign = parseInt($("#cboDesign").val());
        var nPlanStatus = parseInt($("#cboPlanStatusAdv").val());
        var sBatchNo = $.trim($("#txtBatchNo").val());
        var bIsPending = false;
        if($('#chkIsPending').attr("checked"))
            bIsPending=true;

        if(nCboOrderDate <= 0 && sExeNo == "" && sConstruction == "" && sMachineIDs == "" && sCustomerIDs == "" && nDesign <= 0 && nPlanStatus <= 0 && sBatchNo == "" && bIsPending == false){
            alert("Please enter atleast one searching criteria!!");
            return;
        }

        debugger;
        var sParams =   nCboOrderDate + "~" +
                        dFromOrderDate + "~" +
                        dToOrderDate + "~" +
                        sExeNo+"~" +
                        sConstruction+"~"+
                        sMachineIDs+"~"+
                        sCustomerIDs+"~"+
                        nDesign+"~"+
                        nPlanStatus+"~"+
                        sBatchNo+"~"+
                        bIsPending;

        //console.log(sParams);
        sessionStorage.setItem("ParamsSO", sParams);
        var oFabricWarpPlan = {
            ErrorMessage : sParams
        };
        $(".lblLoadingMessage").show();
        $.ajax({
            type: "POST",
            dataType: "json",
            url: _sBaseAddress + "/FabricWarpPlan/AdvSearch",
            traditional: true,
            data: JSON.stringify(oFabricWarpPlan),
            contentType: "application/json; charset=utf-8",
            success: function (data) {
                var oFabricWarpPlans = data;
                debugger;
                if (oFabricWarpPlans != null )
                {
                    if (oFabricWarpPlans.length > 0 && oFabricWarpPlans[0].ErrorMessage=='')
                    {
                        DynamicRefreshList(oFabricWarpPlans, "tblFabricWarpPlan");
                        $.icsMakeFooterColumn('tblFabricWarpPlan',['ReedNo','Qty']);
                        $("#winAdvSearch").icsWindow("close");
                    }
                    else
                    {
                        alert("Sorry, No data found. "+(oFabricWarpPlans[0]==undefined?'':oFabricWarpPlans[0].ErrorMessage));
                        DynamicRefreshList([], "tblFabricWarpPlan");
                    }

                } else {
                    alert("Sorry, No data found. ");
                    DynamicRefreshList([], "tblFabricWarpPlan");
                }
                $(".lblLoadingMessage").hide();
            }
        });
    });
    $("#btnPrint").click(function () {
        var sParams="";
        var bIsPending = false;
        if($('#chkIsPendingFWP').attr("checked"))
            bIsPending=true;
        if(bIsPending == true){
            sParams = 0 + "~" +
                          icsdateformat(new Date()) + "~" +
                          icsdateformat(new Date()) + "~" +
                          "" + "~" +
                          "" +"~"+
                          "" +"~"+
                          "" +"~"+
                          0 +"~"+
                        0 +"~"+
                        "" +"~"+
                        true;

        }else{
            sParams=sessionStorage.getItem("ParamsSO");
            if(sParams == ""){
                alert("Please search first!!");
                return;
            }
        }

        window.open(_sBaseAddress + '/FabricWarpPlan/PrintFabricWarpingPlan_Machine?sTemp=' + sParams, "_blank");
    });
    $('#btnAddFB').click(function(e){
        debugger;
        AddFB();
        $("#winDUFabricWarpPlan").icsWindow("close");

    });

    $('#btnAddFBatch').click(function(e){
        AddFB();
    });

    function AddFB(){
        var oFabricWarpPlan = $('#tblFabricWarpPlan').datagrid('getSelected');
        if (oFabricWarpPlan ==null || oFabricWarpPlan.FabricWarpPlanID <=0 ) { alert("Planning yet not created."); return ; }

        if(oFabricWarpPlan == null || parseInt(oFabricWarpPlan.FabricWarpPlanID)<=0){
            alert("Planning yet not created.");
            return false;
        }
        if(!confirm("Are you sure to create fabric batch?"))
            return false;
        var SelectedRowIndex=$('#tblFabricWarpPlan').datagrid('getRowIndex',oFabricWarpPlan);
        var oFabricBatch={
            FWPDID:oFabricWarpPlan.FabricWarpPlanID
        }
        var obj = {
            BaseAddress: _sBaseAddress,
            Object: oFabricBatch,
            ControllerName: "FabricBatch",
            ActionName: "GetLastFabricBatchByWarpPlane",
            IsWinClose: false
        };
        $.icsDataGet(obj, function (response)
        {
            debugger;
            //if (response.obj.FBID>0) {
            //    $("#txtTotalEnds").val(response.obj.TotalEnds);
            //}
            //else {
            //    $("#txtTotalEnds").val(0);
            //}
            var oFabricBatchTemp=response.obj;
            var oFabricBatch={
                FBID:oFabricBatchTemp.FBID,
                FWPDID:oFabricWarpPlan.FabricWarpPlanID,
                FabricSalesContractDetailID:oFabricWarpPlan.FSCDID,
                Qty:oFabricWarpPlan.Qty*1.0936132983,
                FMID:oFabricWarpPlan.FMID,
                FEOSID:oFabricWarpPlan.FEOSID,
                TotalEnds:0,
                Params:$('#tblFabricWarpPlan').data('FWPDID'),
                PlanType:oFabricWarpPlan.PlanType,
            }
            var obj =
            {
                BaseAddress: _sBaseAddress,
                Object: oFabricBatch,
                ObjectId: oFabricBatch.FBID,
                ControllerName: "FabricBatch",
                ActionName: "SaveFabricBatchFromWarpPlan",
                TableId: "",
                IsWinClose: false,
                Message: "Fabric Batch Create Successfully."
            };
            $.icsSave(obj, function (response) {
                if (response.status && response.obj != null) {
                    if (response.obj.FBID>0)
                    {
                        oFabricWarpPlan.BatchNo = response.obj.BatchNo;
                        $('#tblFabricWarpPlan').datagrid('updateRow',{ index: SelectedRowIndex, row: oFabricWarpPlan });
                        $("#winDUFabricWarpPlan").icsWindow("close");
                        $('#btnAddFBatch').hide();
                    }
                }
            });


        });
    }
    function GetsFabricBatch(nFWPDID){
        _nFBID =0;
        $("#cboFabricBatch").empty();
        $("#lblSingleFB").text("");
        $("#btnAddFB,#cboFabricBatch,#lblSingleFB").hide();

        var obj = {
            BaseAddress: _sBaseAddress,
            Object: { FWPDID:nFWPDID },
            ControllerName: "FabricBatch",
            ActionName: "GetsFabricBatchByFWPD",
            IsWinClose: false
        };
        $.icsMaxDataGets(obj, function (response) {
            if (response.status && response.objs.length > 0) {
                $("#region-fabric-batch").show();
                $('#btnBatchCardPrint').show();
                $('#btnAddFB').hide();
                if(response.objs.length > 1)
                {
                    $("#cboFabricBatch").icsLoadCombo({
                        List: response.objs,
                        OptionValue: "FBID",
                        DisplayText: "FabricBatchWithStatus",
                        InitialValue:""
                    });
                    $("#cboFabricBatch").show();

                }else{
                    $("#lblSingleFB").show();
                    $("#lblSingleFB").text(response.objs[0].FabricBatchWithStatus);
                    $('#btnBatchCardPrint').show();
                    _nFBID =response.objs[0].FBID;
                }
            }
        });
    }

    $("#btnBatchCardPrint").click(function () {

        if(_nFBID<=0)
        {
            alert("No Batch Card Found!");
            return;
        }
        window.open(_sBaseAddress+ "/FabricBatch/PrintBatchCard_Dynamic?nFBID="+_nFBID+"&nProcess="+0); ///warping = 0
    });

    $("#btnExcel").click(function () {
        var sParams="";
        var bIsPending = false;
        if($('#chkIsPendingFWP').attr("checked"))
            bIsPending=true;
        if(bIsPending == true){
            sParams = 0 + "~" +
                          icsdateformat(new Date()) + "~" +
                          icsdateformat(new Date()) + "~" +
                          "" + "~" +
                          "" +"~"+
                          "" +"~"+
                          "" +"~"+
                          0 +"~"+
                        0 +"~"+
                        "" +"~"+
                        true;

        }else{
            sParams=sessionStorage.getItem("ParamsSO");
            if(sParams == ""){
                alert("Please search first!!");
                return;
            }
        }

        window.open(_sBaseAddress + '/FabricWarpPlan/ExcelFabricWarpingPlan_Machine?sTemp=' + sParams, "_blank");
    });


    function RefreshControlLayout()
    {
        $('#btnAdd,#btnEdit,#btnDelete,#btnCut,#btnPast,#btnSwap').hide();

        if (PermissionChecker('Add', 'FabricWarpPlan',_oAuthorizationRolesMapping)) {$("#btnAdd").show();}
        if (PermissionChecker('Edit', 'FabricWarpPlan',_oAuthorizationRolesMapping)) {$("#btnEdit").show();}
        if (PermissionChecker('View', 'FabricWarpPlan',_oAuthorizationRolesMapping)) {$("#btnView").show();}
        if (PermissionChecker('Delete', 'FabricWarpPlan',_oAuthorizationRolesMapping)) {$("#btnDelete").show();}
        if (PermissionChecker('Copy', 'FabricWarpPlan',_oAuthorizationRolesMapping)) {$('#btnCut,#btnPast,#btnSwap').show();}

    }




</script>
