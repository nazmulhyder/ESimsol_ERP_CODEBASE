@{
    ViewBag.Title = "Customer Personal Information";
}
@model ESimSol.BusinessObjects.CustomerPersonalInfo


<html>
<body>
    <div id="divCustomer" class="easyui-panel" title="Add Customer Info" style="font-family:Tahoma; height:100%; width:100%">
        <div style="width:100%; height:87%; text-align:center">
            <fieldset style="height:95%">
                <legend style="font-weight:bold;text-align:left;"> Contractor Informations : </legend>
                <table style="width:100%;">
                    <tr>
                        <td colspan="2" style="text-align:right">
                            
                        </td>
                        <td style="width:20%">
                            Contractor Name:
                        </td>
                        <td style="width:30%" >
                            <input type="text" id="txtContructorName" disabled style="width:100%" />
                        </td>
                    </tr>
                    <tr>
                        <td style="width:20%">Customer Name</td>
                        <td style=" width:30%"><input type="text" id="txtCustomerName" style="width:100%"></td>

                        <td style="width:20%">Employeer Name</td>
                        <td style=" width:30%"><input type="text" id="txtEmployeerName" style="width:100%"></td>
                    </tr>
                    <tr>
                        <td style="width:20%">Designation</td>
                        <td style=" width:30%"><input type="text" id="txtDesignation" style="width:100%"></td>

                        <td style="width:20%">Address</td>
                        <td style=" width:30%"><input type="text" id="txtAddress" style="width:100%"></td>
                    </tr>

                    <tr>
                        <td style="width:20%">Contact Number</td>
                        <td style=" width:30%"><input type="text" id="txtContactNumber" style="width:100%"></td>

                        <td style="width:20%">Email Address</td>
                        <td style=" width:30%"><input type="text" id="txtEmailAddress" style="width:100%"></td>
                    </tr>
                    <tr>
                        <td style="width:20%">Date Of Birth</td>
                        <td style=" width:30%"><input type="text" class="easyui-datebox" data-options="formatter:icsdateformat,parser:icsdateparser" id="txtDateOfBirth" style="width:100%"></td>

                        <td style="width:20%">MarriedStatus</td>
                        <td style=" width:30%"><select id="cboMarriedStatus" style="width:100%"></select></td>
                    </tr>
                    <tr>
                        <td style="width:20%">Spouse Namer</td>
                        <td style=" width:30%"><input type="text" id="txtSpouseName" style="width:100%"></td>

                        <td style="width:20%">Spouse Date Of Birth</td>
                        <td style=" width:30%"><input type="text" class="easyui-datebox" data-options="formatter:icsdateformat,parser:icsdateparser" id="txtSpouseDateOfBirth" style="width:100%"></td>
                    </tr>
                    <tr>
                        <td style="width:20%">Anniversary Date</td>
                        <td style=" width:30%"><input type="text" class="easyui-datebox" data-options="formatter:icsdateformat,parser:icsdateparser" id="txtAnniversaryDate" style="width:100%"></td>

                        <td style="width:20%">Remarks</td>
                        <td style=" width:30%"><input type="text" id="txtRemarks" style="width:100%"></td>
                    </tr>
                    
                </table>
            </fieldset>
        </div>
        <div style="width:100%; height:10%">
            <fieldset>
                <legend style="font-weight: bold">Action : </legend>
                <table border="0" cellspacing="2" cellpadding="2" style="font-size: 11px; font-weight: bold; width:100%">
                    <tr>
                        <td style="width:80%; text-align:right"></td>
                        <td style="width: 10%">
                            <a id="btnSave" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-save" plain="true">Save</a>
                        </td>
                        <td style="width: 10%">
                            <a id="btnClose" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-cancel" plain="true">Close</a>
                        </td>
                    </tr>
                </table>
            </fieldset>
        </div>
    </div>
</body>
</html>
<script type="text/javascript">
    var _sBaseAddress="";
    var _oCustomerPersonalInfo=null;
    var _oMarriedStatus=[];
    var nCustomerID=0;
    $(document).ready(function () {
        _sBaseAddress =@Html.Raw( new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(HttpContext.Current.Session[SessionInfo.BaseAddress]));
        _oCustomerPersonalInfo=@Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(Model));
        _oMarriedStatus= @Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(ViewBag.MarriedStatus));
        nCustomerID=@Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(ViewBag.CustomerID));
        $("#cboMarriedStatus").icsLoadCombo({List: _oMarriedStatus, OptionValue: "id", DisplayText: "Value" });
        $('#divCustomer').data('BaseAddress', _sBaseAddress);
        RefreshControll(_oCustomerPersonalInfo);
    });
    function RefreshControll(_oCustomerPersonalInfo)
    {
        
        $("#txtCustomerName").val(_oCustomerPersonalInfo.CustomerName);
        $("#txtEmployeerName").val(_oCustomerPersonalInfo.EmployeerName);
        $("#txtDesignation").val(_oCustomerPersonalInfo.Designation);
        $("#txtAddress").val(_oCustomerPersonalInfo.Address);
        $("#txtContactNumber").val(_oCustomerPersonalInfo.ContactNumber);
        $("#txtEmailAddress").val(_oCustomerPersonalInfo.EmailAddress);
        $("#txtDateOfBirth").datebox("setValue",_oCustomerPersonalInfo.DateOfBirthSt);
        $("#cboMarriedStatus").val(parseInt(_oCustomerPersonalInfo.MarriedStatus));
        $("#txtSpouseName").val(_oCustomerPersonalInfo.SpouseName);
        $("#txtSpouseDateOfBirth").datebox("setValue",_oCustomerPersonalInfo.SpouseDateOfBirthSt);
        $("#txtAnniversaryDate").datebox("setValue",_oCustomerPersonalInfo.AnniversaryDateSt);
        $("#txtRemarks").val(_oCustomerPersonalInfo.Remarks);
        $("#txtContructorName").val(_oCustomerPersonalInfo.ContractorName)

    }
    function ValidateInput()
    {
        if($("#txtCustomerName").val()==null || $("#txtCustomerName").val()=="")
        {
            alert("Please enter Customer Name!");
            $('#txtCustomerName').focus();
            return false;
        }
        if($("#txtEmployeerName").val()==null || $("#txtEmployeerName").val()=="")
        {
            alert("Please enter Employeer Name!");
            $('#txtEmployeerName').focus();
            return false;
        }
        if($("#txtDesignation").val()==null || $("#txtDesignation").val()=="")
        {
            alert("Please enter Designation!");
            $('#txtDesignation').focus();
            return false;
        }
        if($("#txtAddress").val()==null || $("#txtAddress").val()=="")
        {
            alert("Please enter Address!");
            $('#txtAddress').focus();
            return false;
        }
        if($("#txtContactNumber").val()==null || $("#txtContactNumber").val()=="")
        {
            alert("Please enter Contact Number!");
            $('#txtContactNumber').focus();
            return false;
        }
        if($("#txtEmailAddress").val()==null || $("#txtEmailAddress").val()=="")
        {
            alert("Please enter Email Address!");
            $('#txtEmailAddress').focus();
            return false;
        }
        var MarriedStatus=parseInt($("#cboMarriedStatus").val());
        if(MarriedStatus==null || MarriedStatus==0)
        {
            alert("Please Select Married Status!");
            $('#cboMarriedStatus').focus();
            return false;
        }
        if($("#txtSpouseName").val()==null || $("#txtSpouseName").val()=="")
        {
            alert("Please enter Spouse Name!");
            $('#txtSpouseName').focus();
            return false;
        }
        if($("#txtRemarks").val()==null || $("#txtRemarks").val()=="")
        {
            alert("Please enter Remarks!");
            $('#txtRemarks').focus();
            return false;
        }
        return true;
    }
    function RefreshObject()
    {
        
       
        var oCustomerPersonalInfo= {
            CustomerPersonalInfoID:_oCustomerPersonalInfo.CustomerPersonalInfoID,
            CustomerName: $("#txtCustomerName").val(),
            CustomerID:nCustomerID,
            EmployeerName: $("#txtEmployeerName").val(),
            Designation:$("#txtDesignation").val(),
            Address:$("#txtAddress").val(),
            ContactNumber:$("#txtContactNumber").val(),
            EmailAddress:$("#txtEmailAddress").val(),
            DateOfBirth:$("#txtDateOfBirth").datebox('getValue'),
            MarriedStatus:parseInt($("#cboMarriedStatus").val()),
            SpouseName:$("#txtSpouseName").val(),
            SpouseDateOfBirth:$("#txtSpouseDateOfBirth").datebox('getValue'),
        AnniversaryDate:$("#txtAnniversaryDate").datebox('getValue'),
            Remarks:$("#txtRemarks").val(),
        };
        return oCustomerPersonalInfo;
    }
    $('#btnSave').click(function(){
        if(!ValidateInput()) return;
        var oCustomerPersonalInfo=RefreshObject();

        $.ajax({
            type: "POST",
            dataType: "json",            
            url :  $('#divCustomer').data('BaseAddress')+ "/Contractor/SaveCustomerPersonalInfo",
            traditional: true,
            data:  JSON.stringify(oCustomerPersonalInfo),
            contentType: "application/json; charset=utf-8",
            success: function (data)
            {            
                oDyeingType = jQuery.parseJSON(data);
                if (oCustomerPersonalInfo.ErrorMessage=="" || oCustomerPersonalInfo.ErrorMessage==null)
                {
                    alert("Data Saved sucessfully");
                   
                    window.location.href = sessionStorage.getItem("BackLink");
                }
                else 
                {
                    alert(oCustomerPersonalInfo.ErrorMessage);
                }
            },
            error: function (xhr, status, error) {
                alert(error);
            }

        });
    });
    $('#btnClose').click(function(){
        window.location.href = sessionStorage.getItem("BackLink");
    });
</script>