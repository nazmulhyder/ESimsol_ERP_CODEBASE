@{
    ViewBag.Title = "Technical Sheet";
}
<html>

<body>
    @{var MenuID = HttpContext.Current.Session[SessionInfo.MenuID];}
    @model ESimSol.BusinessObjects.TechnicalSheet
    <div id="winColorSequence" class="easyui-window" title="Pick Color" data-options="modal:true,closed:true,collapsible:false,minimizable:false,maximizable:false,closable:false">
        <div style="font-family:Tahoma">
            <fieldset style="margin-top:3px">
                <table border="0" style="font-size:12px">
                    <tr>
                        <td style="width:310px; text-align:right">
                            <table id="tblColorBank" title="Color Bank" class="easyui-datagrid" style="width: 310px; height: 300px" fit="true" fitcolumns="false" rownumbers="true" singleselect="true" autorowheight="false" toolbar="#ColorBankToolbar">
                                <thead>
                                    <tr>
                                        <th field="ColorName" width="320" align="left">Color Name</th>
                                    </tr>
                                </thead>
                            </table>
                            <div id="ColorBankToolbar">
                                <input type="text" id="txtSearchColorSequence" style="width:310px" placeholder="search By color name" />
                            </div>
                        </td>
                        <td style="width:50px; text-align:center; vertical-align:middle">
                            <input type="button" value="Add" id="btnAddTSColor" style="width:40px" />
                        </td>
                        <td style="width:310px; text-align:right">
                            <table id="tblTechnicalSheetColor" title="Color Sequence" class="easyui-datagrid" style="width: 310px; height: 300px" fit="true" fitcolumns="false" rownumbers="true" singleselect="true" autorowheight="false" toolbar="#ColorSequenceToolbar">
                                <thead>
                                    <tr>
                                        <th field="ColorName" width="230" align="left">Color Name</th>
                                        <th field="PantonNo" width="70" align="left">Panton No</th>
                                    </tr>
                                </thead>
                            </table>
                            <div id="ColorSequenceToolbar">
                                <a id="btnColorSequenceUp" style=" width:50px; text-align:left;" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-up" plain="true">Up</a>
                                <a id="btnColorSequenceDown" style=" width:60px; text-align:left;" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-down" plain="true">Down</a>
                                <a id="btnColorSequenceRemove" style=" width:80px; text-align:left;" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-remove" plain="true">Remove</a>
                            </div>
                        </td>
                    </tr>
                </table>
            </fieldset>

            <fieldset style="margin-bottom:3px">
                <legend style="font-weight:bold"> Action : </legend>
                <table border="0" cellspacing="2" cellpadding="2" style="font-size:11px; width:650px">
                    <tr>
                        <td style="width:550px; text-align:left">
                            <a id="btnNewColorCategory" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-add" plain="true">Add New Color</a>
                        </td>
                        <td style="width:50px">
                            <a id="btnColorSequenceSave" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-save" plain="true">Save</a>
                        </td>
                        <td style="width:50px">
                            <a id="btnColorSequenceClose" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-cancel" plain="true">Close</a>
                        </td>
                    </tr>
                </table>
            </fieldset>
        </div>
    </div>

    <div id="winNewColor" class="easyui-window" title="Add Color" data-options="modal:true,closed:true,collapsible:false,minimizable:false,maximizable:false,closable:false">
        <div style="font-family:Tahoma">
            <fieldset style="margin-top:3px">
                <table border="0" style="font-size:12px">
                    <tr>
                        <td style="width:150px; text-align:right">Color Name:</td>
                        <td style="width:250px; text-align:left">
                            <input type="text" id="txtNewColorName" style="width:220px" />
                        </td>
                    </tr>
                    <tr>
                        <td style="width:150px; text-align:right">Note :</td>
                        <td style="width:250px; text-align:left">
                            <input type="text" id="txtNewColorNote" style="width:220px" />
                        </td>
                    </tr>
                </table>
            </fieldset>

            <fieldset style="margin-bottom:3px">
                <legend style="font-weight:bold"> Action : </legend>
                <table border="0" cellspacing="2" cellpadding="2" style="font-size:11px; width:400px">
                    <tr>
                        <td style="width:300px; text-align:right"></td>
                        <td style="width:50px">
                            <a id="btnNewColorSave" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-save" plain="true">Save</a>
                        </td>
                        <td style="width:50px">
                            <a id="btnNewColorClose" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-cancel" plain="true">Close</a>
                        </td>
                    </tr>
                </table>
            </fieldset>
        </div>
    </div>

    <div id="winSizeSequence" class="easyui-window" title="Pick Color" data-options="modal:true,closed:true,collapsible:false,minimizable:false,maximizable:false,closable:false">
        <div style="font-family:Tahoma">
            <fieldset style="margin-top:3px">
                <table border="0" style="font-size:12px">
                    <tr>
                        <td style="width:310px; text-align:right">
                            <table id="tblSizeBank" title="Color Bank" class="easyui-datagrid" style="width: 310px; height: 300px" fit="true" fitcolumns="false" rownumbers="true" singleselect="true" autorowheight="false" toolbar="#SizeBankToolbar">
                                <thead>
                                    <tr>
                                        <th field="SizeCategoryName" width="310" align="left">Size Name</th>
                                    </tr>
                                </thead>
                            </table>
                            <div id="SizeBankToolbar">
                                <input type="text" id="txtSearchSizeSequence" style="width:310px" placeholder="search By size name" />
                            </div>
                        </td>
                        <td style="width:50px; text-align:center; vertical-align:middle">
                            <input type="button" value="Add" id="btnAddTSSize" style="width:40px" />
                        </td>
                        <td style="width:310px; text-align:right">
                            <table id="tblTechnicalSheetSize" title="Size Sequence" class="easyui-datagrid" style="width: 310px; height: 300px" fit="true" fitcolumns="false" rownumbers="true" singleselect="true" autorowheight="false" toolbar="#SizeSequenceToolbar">
                                <thead>
                                    <tr>
                                        <th field="SizeCategoryName" width="250" align="left">Size Name</th>
                                        <th field="QtyInPercent" width="40" align="right">(%)</th>
                                    </tr>
                                </thead>
                            </table>
                            <div id="SizeSequenceToolbar">
                                <a id="btnSizeSequenceUp" style=" width:50px; text-align:left;" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-up" plain="true">Up</a>
                                <a id="btnSizeSequenceDown" style=" width:60px; text-align:left;" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-down" plain="true">Down</a>
                                <a id="btnSizeSequenceRemove" style=" width:80px; text-align:left;" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-remove" plain="true">Remove</a>
                            </div>
                        </td>
                    </tr>
                </table>
            </fieldset>

            <fieldset style="margin-bottom:3px">
                <legend style="font-weight:bold"> Action : </legend>
                <table border="0" cellspacing="2" cellpadding="2" style="font-size:11px; width:650px">
                    <tr>
                        <td style="width:550px; text-align:left">
                            <a id="btnNewSizeCategory" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-add" plain="true">Add New Size</a>
                        </td>
                        <td style="width:50px">
                            <a id="btnSizeSequenceSave" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-save" plain="true">Save</a>
                        </td>
                        <td style="width:50px">
                            <a id="btnSizeSequenceClose" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-cancel" plain="true">Close</a>
                        </td>
                    </tr>
                </table>
            </fieldset>
        </div>
    </div>

    <div id="winNewSize" class="easyui-window" title="Add Size" data-options="modal:true,closed:true,collapsible:false,minimizable:false,maximizable:false,closable:false">
        <div style="font-family:Tahoma">
            <fieldset style="margin-top:3px">
                <table border="0" style="font-size:12px">
                    <tr>
                        <td style="width:150px; text-align:right">Size Name:</td>
                        <td style="width:250px; text-align:left">
                            <input type="text" id="txtNewSizeName" style="width:220px" />
                        </td>
                    </tr>
                    <tr>
                        <td style="width:150px; text-align:right">Note :</td>
                        <td style="width:250px; text-align:left">
                            <input type="text" id="txtNewSizeNote" style="width:220px" />
                        </td>
                    </tr>
                </table>
            </fieldset>

            <fieldset style="margin-bottom:3px">
                <legend style="font-weight:bold"> Action : </legend>
                <table border="0" cellspacing="2" cellpadding="2" style="font-size:11px; width:400px">
                    <tr>
                        <td style="width:300px; text-align:right"></td>
                        <td style="width:50px">
                            <a id="btnNewSizeSave" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-save" plain="true">Save</a>
                        </td>
                        <td style="width:50px">
                            <a id="btnNewSizeClose" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-cancel" plain="true">Close</a>
                        </td>
                    </tr>
                </table>
            </fieldset>
        </div>
    </div>

    <div class="menuMainCollectionTable" id="divTS">
        <div class="easyui-panel" title="Technical Sheet" style="font-family:Tahoma;width:100%;height:100%;">
            <div id="TStabs" class="easyui-tabs" style="width:100%;height:90%;">
                <div title="Technical Sheet" data-options="" style="padding:10px; height:100%;">
                    <fieldset style="height:440px; text-align:center;">
                        <legend style="font-weight:bold"> Technical Sheet Informations : </legend>
                        <table border="0" cellpadding="0" cellspacing="0" width="100%;">
                            <tr>
                                <td style="width:47%;text-align:left">
                                    <table border="0" cellpadding="1" cellspacing="1" width="100%">
                                        <tr>
                                            <td style="width:25%; text-align:right">
                                                <label id="lblStyleStart" class="asterixStyle">*</label> Style Name:
                                            </td>
                                            <td style="width:75%; text-align:left">
                                                @Html.TextBoxFor(model => model.StyleNo, new { style = "width: 100%;", id = "txtStyleNo" })
                                            </td>
                                        </tr>
                                        <tr>
                                            <td style="width:25%; text-align:right">
                                                <label class="asterixStyle">*</label>Buyer :
                                            </td>
                                            <td style="width:75%; text-align:left">
                                                <table border="0" cellpadding="0" cellspacing="0" width="100%">
                                                    <tr>
                                                        <td style="width:40%">@Html.TextBoxFor(model => model.BuyerName, new { style = "width:100%", placeholder = "Type Buyer Name & Press Enter", id = "txtBuyerName" })<input id="txtBuyerID" type="hidden" /></td>
                                                        <td style="width:5%"><input type="button" style="width:100%; font-size:12px" id="btnBuyerPicker" value="P"></td>
                                                        <td style="width:35%"><select id="cboBuyerConcern" style="width:100%;" /></td>
                                                        <td style="width:10%"><input type="button" value="" id="btnRefreshBuyerConcern" style="background-image: url(../../Content/CSS/images/pagination_load.png); background-repeat: no-repeat; width: 25px; height: 22px;" onclick="LoadBuyerConcern()" /></td>
                                                        <td style="width:5%"><input type="button" value="+" id="btnAddBuyerConcern" style="width:100%" onclick="AddBuyerConcern()"></td>
                                                    </tr>
                                                </table>
                                            </td>
                                        </tr>
                                        <tr>
                                            <td style="width:25%; text-align:right">
                                                Brand :
                                            </td>
                                            <td style="width:75%; text-align:left">
                                                <select id="cboBrand" style="width:100%;"></select>
                                            </td>
                                        </tr>
                                        <tr>
                                            <td style="width:25%; text-align:right">
                                                <label class="asterixStyle">*</label>Gender/Dept :
                                            </td>
                                            <td style="width:75%; text-align:left">
                                                <table border="0" cellpadding="0" cellspacing="0" style="width: 100%;">
                                                    <tr>
                                                        <td style="width:48%"><select id="cboDept" style="width:100%;"></select></td>
                                                        <td style="width:4%">&nbsp;</td>
                                                        <td style="width:48%;"><select id="cboSubGender" style="width:100%;"></select></td>
                                                    </tr>
                                                </table>
                                            </td>
                                        </tr>
                                        <tr>
                                            <td style="width:25%; text-align:right">Guage :</td>
                                            <td style="width:75%; text-align:left">
                                                <table border="0" cellpadding="0" cellspacing="0">
                                                    <tr>
                                                        <td style="width:40%">
                                                            @Html.TextBoxFor(model => model.GG, new { style = "width:100%;", id = "txtGG" })
                                                        </td>
                                                        <td style="width:25%; text-align:right">Yarn/Count :</td>
                                                        <td style="width:35%"> @Html.TextBoxFor(model => model.Count, new { style = "width:100%;", id = "txtCount" })</td>
                                                    </tr>
                                                </table>
                                            </td>
                                        </tr>
                                        <tr>
                                            <td style="width:25%; text-align:right">Wash :</td>
                                            <td style="width:75%; text-align:left">@Html.TextBoxFor(model => model.Wash, new { style = "width:100%;", id = "txtWash" })</td>
                                        </tr>
                                        <tr>
                                            <td style="width:30%; text-align:right">Concern Merchandiser :</td>
                                            <td style="width:70%; text-align:left"><select id="cboMerchandiserID" style="width:100%;" /></td>
                                        </tr>
                                    </table>
                                </td>
                                <td style="width:6%;"></td>
                                <td style="width:47%;text-align:right;vertical-align:top;">
                                    <table border="0" cellpadding="1" cellspacing="1" width="100%">
                                        <tr>
                                            <td style="width:30%; text-align:right">
                                                <label id="lblSeason" class="asterixStyle">*</label>Season :
                                            </td>
                                            <td style="width:70%; text-align:left">
                                                @Html.DropDownListFor(model => model.BusinessSessionID, Model.BusinessSessions.Select(x => new SelectListItem() { Text = x.SessionName, Value = x.BusinessSessionID.ToString() }), new { id = "cboSeasons", style = "width:100%;" })
                                            </td>
                                        </tr>
                                        <tr>
                                            <td style="width:30%; text-align:right">
                                                <label class="asterixStyle">*</label>Product Type :
                                            </td>
                                            <td style="width:70%; text-align:left">
                                                <table border="0" cellpadding="0" cellspacing="0" width="100%">
                                                    <tr>
                                                        <td style="width:90%">
                                                            @Html.TextBoxFor(model => model.ProductName, new { style = "width:100%;", placeholder = "Type Product Name & Press Enter", id = "txtProductName" })
                                                        </td>
                                                        <td style="width:10%">
                                                            <input type="button" id="btnProductPiker" value="Pick" style="width:100%; text-align:center" />
                                                        </td>
                                                    </tr>
                                                </table>
                                            </td>
                                        </tr>
                                        <tr>
                                            <td style="width:30%; text-align:right">
                                                <label id="lblTSType" class="asterixStyle">*</label> Process:
                                            </td>
                                            <td style="width:70%; text-align:left">
                                                <select id="cboTSType" style="width:100%;" class="_select_change_TSType">
                                                    <option value="-1">Select TS Type</option>
                                                    <option value="0">Sweater</option>
                                                    <option value="1">Knit</option>
                                                    <option value="2">Woven</option>
                                                </select>
                                            </td>
                                        </tr>

                                        <tr>
                                            <td style="width:30%; text-align:right">
                                                <label class="asterixStyle">*</label> Knitting :
                                            </td>
                                            <td style="width:70%; text-align:left">
                                                <table border="0" cellpadding="0" cellspacing="0">
                                                    <tr>
                                                        <td style="width:35%"><select id="cboKnittingPattern" style="width:100%;"></select></td>
                                                        <td style="width:25%; text-align:right">GSM :</td>
                                                        <td style="width:33%"> @Html.TextBoxFor(model => model.GSMName, new { style = "width:100%;", id = "txtGSM" })</td>
                                                        <td style="width:7%"><input type="button" id="btnGSMPiker" value="P" style="width:100%; text-align:center" /></td>
                                                    </tr>
                                                </table>
                                            </td>
                                        </tr>

                                        <tr>
                                            <td style="width:30%; text-align:right"><label id="lblFabwidthAsterix" class="asterixStyle">*</label>Fab Width :</td>
                                            <td style="width:70%; text-align:left">
                                                <table border="0" cellpadding="0" cellspacing="0">
                                                    <tr>
                                                        <td style="width:40%">
                                                            @Html.TextBoxFor(model => model.FabWidth, new { style = "width:100%;", id = "txtFabWidth" })
                                                        </td>
                                                        <td style="width:25%; text-align:right">Fab Code :</td>
                                                        <td style="width:35%">@Html.TextBoxFor(model => model.FabCode, new { style = "width: 100%;", id = "txtFabCode" })</td>
                                                    </tr>
                                                </table>
                                            </td>
                                        </tr>

                                        <tr>
                                            <td style="width:30%; text-align:right">Special Finish :</td>
                                            <td style="width:70%; text-align:left">
                                                <table border="0" cellpadding="0" cellspacing="0">
                                                    <tr>
                                                        <td style="width:40%">
                                                            @Html.TextBoxFor(model => model.SpecialFinish, new { style = "width: 100%;", id = "txtSpecialFinish" })
                                                        </td>
                                                        <td style="width:25%; text-align:right">Designer :</td>
                                                        <td style="width:35%">@Html.TextBoxFor(model => model.Designer, new { style = "width: 100%;", id = "txtDesigner" })</td>
                                                    </tr>
                                                </table>
                                            </td>
                                        </tr>
                                        <tr>
                                            <td style="width:30%; text-align:right">Remarks :</td>
                                            <td style="width:70%; text-align:left">@Html.TextBoxFor(model => model.Note, new { style = "width:100%;", id = "txtNote" })</td>
                                        </tr>
                                    </table>
                                </td>
                            </tr>
                        </table>
                        <table border="0" cellpadding="0" cellspacing="0" width="100%;">
                            <tr>
                                <td style="width:14%; text-align:right;vertical-align:top;padding-left:0px;">Shipment Breakdown,<br>Color Range<br>& Size Range:</td>
                                <td style="width:86%">
                                    <div class="easyui-panel" style="font-family:Tahoma;width:100%;height:240px;">
                                        <div id="TSShipmenttabs" class="easyui-tabs" style="height:235px;">
                                            <div title="* Shipment BreakDown" data-options="" style="padding:10px; height:100%;">
                                                <div id="TechnicalSheetShipmenttoolbar">
                                                    <a id="btnAddTSShipment" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-add" plain="true" onclick="AddTSShipment()"></a>
                                                    <a id="btnRemoveTSShipment" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-remove" plain="true" onclick="RemoveTSShipment()"></a>
                                                    <a id="btnRefreshTSShipment" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-reload" plain="true" onclick="RefreshTSShipment()"></a>
                                                </div>
                                                <table id="tblTSShipment" class="easyui-datagrid" style="width:100%; height:180px" fitcolumns="false" rownumbers="true" pagination="false" singleselect="true" autorowheight="false" toolbar="#TechnicalSheetShipmenttoolbar" showfooter="true" data-options="onClickRow: onClickRowTSShipment">
                                                    <thead>
                                                        <tr>
                                                            <th field="DeliveryDate" width="48%" align="left" data-options="field:'DeliveryDate',editor:{type:'text'}"> Delivery Date</th>
                                                            <th field="Qty" width="20%" align="right" data-options="field:'Qty',editor:{type:'numberbox',options:{precision:0}}">Qty</th>
                                                            <th field="Remarks" width="28%" align="left" data-options="field:'Remarks',editor:{type:'text'}"> Note</th>
                                                        </tr>
                                                    </thead>
                                                </table>
                                            </div>
                                            <div title="* Size Range" data-options="" style="padding:10px; height:100%;">
                                                <div id="TSSizeStoolbar">
                                                    <input type="text" id="txtSizeRange" style="width:150px;" placeholder="Type Size" />
                                                    <input type="button" id="btnSizeRange" value="P" onclick="PickSize()" style="width:28px; text-align:center" />
                                                    <input type="button" id="btnNewSize" value="N" style="width:28px; text-align:center" />
                                                    <input type="button" id="btnRemoveTSSize" value="Delete" style="width:50px; text-align:center" />
                                                </div>
                                                <table id="tblTSSize" class="easyui-datagrid" style="width:100%; height:180px" fitcolumns="false" rownumbers="true" pagination="false" singleselect="true" autorowheight="false" toolbar="#TSSizeStoolbar" showfooter="true" data-options="onClickRow: onClickRowTSSize">
                                                    <thead>
                                                        <tr>
                                                            <th field="SizeCategoryName" width="65%" align="left">Size</th>
                                                            <th field="QtyInPercent" width="16%" align="right" data-options="field:'QtyInPercent',editor:{type:'numberbox',options:{precision:2}}">%</th>
                                                            <th field="Sequence" width="15%" align="center">Seq.</th>
                                                        </tr>
                                                    </thead>
                                                </table>

                                            </div>
                                            <div title="* Color Range" data-options="" style="padding:10px; height:100%;">
                                                <div id="TSColortoolbar">
                                                    <input type="text" id="txtColorRange" style="width:150px;" placeholder="Type Color" />
                                                    <input type="button" id="btnColorRange" value="P" style="width:28px; text-align:center" onclick="PickColor()" />
                                                    <input type="button" id="btnNewColor" value="N" style="width:28px; text-align:center" />
                                                    <input type="button" id="btnRemoveTSColor" value="Delete" style="width:50px; text-align:center" />
                                                </div>
                                                <table id="tblTSColor" class="easyui-datagrid" style="width:100%; height:180px" fitcolumns="false" rownumbers="true" pagination="false" singleselect="true" autorowheight="false" toolbar="#TSColortoolbar" showfooter="true" data-options="onClickRow: onClickRowTSColor">
                                                    <thead>
                                                        <tr>
                                                            <th field="ColorName" width="50%" align="left">Color</th>
                                                            <th field="PantonNo" width="30%" align="left" data-options="field:'PantonNo',editor:{type:'text'}">Panton No</th>
                                                            <th field="Sequence" width="15%" align="center">Seq.</th>
                                                        </tr>
                                                    </thead>
                                                </table>

                                            </div>
                                            <div title="* Fabric/Yarn" data-options="" style="padding:10px; height:100%;">
                                                <div id="TSFabrictoolbar">
                                                    Type:<select id="cboFabricType" style="width:22%;height:24px;"></select>
                                                    <input type="text" id="txtFabricName" style="width:30%;" placeholder="Type Fabric" />
                                                    <input type="button" id="btnFabric" value="P" style="width:28px; text-align:center" onclick="PickFabric()" />
                                                    <input type="button" id="btnRemoveFabric" value="Delete" style="width:53px; text-align:center" />
                                                </div>
                                                <table id="tblFabric" class="easyui-datagrid" style="width:100%; height:180px" fitcolumns="false" rownumbers="true" pagination="false" singleselect="true" autorowheight="false" toolbar="#TSFabrictoolbar" showfooter="true" data-options="onClickRow: onClickRowFabric">
                                                    <thead>
                                                        <tr>
                                                            <th field="YarnCode" width="15%">Code</th>
                                                            <th field="YarnName" width="50%">Fabric/Yarn Name</th>
                                                            <th field="YarnTypeSt" width="15%">Type</th>
                                                            <th width="17%" data-options="field:'Note',editor:{type:'text'}">Note</th>
                                                            @*<th field="YarnPly" width="250">Ply</th>*@
                                                        </tr>
                                                    </thead>
                                                </table>
                                            </div>
                                        </div>
                                    </div>
                                </td>
                            </tr>
                        </table>
                    </fieldset>
                </div>
                <div title="Measurement Specification" data-options="" style="padding:10px;">

                    <div style="margin-left:2px; height:380px">
                        <table id="tblMSD" title="Measurement Specification Detail" class="easyui-datagrid" style="width:100%;height:380px"
                               data-options="singleSelect: true,fitColumns:false,rownumbers:true,pagination:false,autoRowHeight:false,toolbar: '#MSToolbar',onClickRow: onClickRow"></table>
                        <div id="MSToolbar">
                            <label class="asterixStyle">*</label>SL No &nbsp; <input type="text" style="width:300px" id="txtDiagramIdentification" /> <input type="button" id="btnDiagramIdentification" value="...." style="width:45px" />
                            <a href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-ok" plain="true" onclick="PickOtherStyle()">Pick Other Style</a>
                            <select id="cboUnitType" style="width:150px;"></select>
                            <a href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-add" plain="true" onclick="AddMSDetail()">Add</a>
                            <a id="btnMSDelete" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-remove" plain="true" onclick="DeleteMSDetail()">Delete</a>
                            <a href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-reload" plain="true" onclick="RefreshMSDetail()">Refresh</a>
                            <a id="btnCommitMS" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-save" plain="true" onclick="CommitMeasurementSpecification()">Save</a>
                            <a href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-reload" plain="true" onclick="RefreshRatio()">Refresh Ratio</a>
                            <a id="btnUp" style=" width:50px; text-align:left;" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-up" plain="true" onclick="UPDiagram()">Up</a>
                            <a id="btnDown" style=" width:60px; text-align:left;" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-down" plain="true" onclick="DownDiagram()">Down</a>
                            <a id="btnAttachment" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-attachment" plain="true" onclick="Attchment()">Attchment</a>
                        </div>
                    </div>
                </div>
                <div title="Design sketches / Artwork" data-options="" style="padding:10px;">
                    <table border="0" cellpadding="0" cellspacing="0">
                        <tr>
                            <td style="width:500px; font-size:12px;">
                                <fieldset style="width:100%;">
                                    <legend style="font-weight:bold"> Design sketches / Artwork : </legend>
                                    <table border="0" cellpadding="0" cellspacing="0">
                                        <tr>
                                            <td style=" text-align:left; width:500px; font-size:12px; ">
                                                @using (Html.BeginForm("ReloadImage", "TechnicalSheet", FormMethod.Post, new { enctype = "multipart/form-data" }))
                                                {
                                                @Html.HiddenFor(model => model.TechnicalSheetID)
                                                <input id="btnUploadDesignSketche" type="button" value="Up Image" style="width:100px; font-weight:bold; margin-left:5px" onclick="UploadDesignsketches()" />
                                                <input id="btnRefresh" type="submit" value="Refresh" style="width:80px; font-weight:bold" />
                                                }
                                            </td>
                                        </tr>
                                        <tr>
                                            <td>
                                                <div id="ImagContaiiner" style="width:350px; height:284px; overflow:auto">
                                                    @foreach (ESimSol.BusinessObjects.TechnicalSheetImage oItem in Model.TechnicalSheetImages)
                                                    {
                                                    <div style="float:left;padding:5px;">
                                                        <div>
                                                            <img src="@Url.Action("GetImg", "TechnicalSheet", new { id = oItem.TechnicalSheetImageID})" alt="@oItem.ImageTitle" height="150px" width="150px" onclick="ChangeImage(@oItem.TechnicalSheetImageID)" />
                                                        </div>
                                                    </div>
                                                    }
                                                </div>
                                            </td>
                                        </tr>
                                    </table>
                                </fieldset>
                            </td>
                            <td style="width:25px;"></td>
                            <td style="width:480px; text-align:right;">
                                <div title="Comments for Image" style="text-align:right; width:100%;">
                                    <div id="ImageCommentstoolbar">
                                        <a id="btnRefreshComments" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-reload" plain="true" onclick="RefreshComments()"></a>
                                        <a id="btnAddComments" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-add" plain="true" onclick="AddComments()">Add</a>
                                        <a id="btnRemoveComments" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-remove" plain="true" onclick="RemoveComments()">Remove</a>
                                        <a id="btnSaveComments" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-save" plain="true" onclick="SaveComments()">Save</a>
                                        <a id="btnDesignAttachment" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-attachment" plain="true" onclick="DesignAttchment()">Attchment</a>
                                    </div>
                                    <table id="tblImageComments" title="Comments for Image" class="easyui-datagrid" style="width: 100%; height:335px" fitcolumns="false" rownumbers="true" pagination="false" singleselect="true" autorowheight="false" toolbar="#ImageCommentstoolbar" data-options="singleSelect: true, fitColumns:false,  rownumbers:true,pagination:false,autoRowHeight:false, onClickRow: onClickRowIC">
                                        <thead>
                                            <tr>
                                                <th field="Comments" width="450" align="left" data-options="field:'Comments',editor:{type:'text'}"> Comments </th>
                                            </tr>
                                        </thead>
                                    </table>
                                </div>
                            </td>
                        </tr>
                    </table>

                </div>
            </div>
            <fieldset style="width:auto;height:10%; vertical-align:top;">
                <legend style="font-weight:bold"> Action : </legend>
                <table border="0" cellspacing="2" cellpadding="2" style="font-size:11px; font-weight:bold;width:100%">
                    <tr>
                        <td style="width:137px; text-align:left">
                            <a href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-add" style="width:137px;" id="btnCreateDevelopmentRecap" plain="true" onclick="CreateDevelopmentRecap()">DevlopmentRecap</a>
                        </td>
                        <td style="width:100px; text-align:left">
                            <a href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-add" style="width:100px;" id="btnCreateOrderRecap" plain="true" onclick="CreateOrderRecap()">OrderRecap </a>
                        </td>
                        <td style="width:100px; text-align:left">
                            @*<a href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-add" style="width:100px;" id="btnCreateLabdipOrder" plain="true" onclick="CreateLabdipOrder()">LabdipOrder </a>*@
                        </td>
                        <td style="width:110px; text-align:left">
                            @*<a href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-add" style="width:110px;" id="btnCreateDyeingOrder" plain="true" onclick="CreateDyeingOder()">Dyeing Order</a>*@
                        </td>
                        <td style="width:300px; text-align:left">
                            @*<a href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-add" style="width:110px;" id="btnCreateSupplyOrder" plain="true" onclick="CreateWorkOrder()">Work Order</a>*@
                        </td>
                        <td style="width:50px">
                            <a id="btnTechnicalSheetPaste" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-paste" plain="true" onclick="Save()">Paste</a>
                            <a id="btnTechnicalSheetSave" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-save" plain="true" onclick="Save()">Save</a>
                        </td>
                        <td style="width:60px">
                            <a id="btnTSClose" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-cancel" plain="true" onclick="Close()">Close</a>
                        </td>
                    </tr>
                </table>
            </fieldset>
        </div>
    </div>
</body>
</html>


<script type="text/javascript">
    var _oTechnicalSheet=null;
    var _oTechnicalSheetSizeList =[];
    var _oDevelopmentRecap = null;
    var _sBaseAddress="";
    var _sobjName =null;
    var _oBuyerConcerns=[];
    var _oGarmentsSubClasss=[];
    var _oTempMeasurementSpecDetails=[];
    var _oSelectedDiagramidentifications=[];
    var _oMeasurementUnits=[];
    var _RawMaterialEstimation=[];
    var _nProductID =0;
    var _oMeasurementSpec =null;
    var _oMeasurementSpecDetails = null;
    var _oImageCommets=[];
    var _nMaxColorSequence = 0;
    var _nMaxSizeSequence = 0;
    var _nMaxDiagramSequence = 0;
    var _oStyleDepartments = [];
    var _oKnittingPatternList = [];
    var _oBuyerWiseBrands = [];
    var _nBOMSelectedIndex = 0;
    var _oSubGenders = [];
    var _oFabricTypes = [];
    var _oTechnicalSheetShipments = [];
    $(document).ready(function () {
        //debugger;
        _sBaseAddress =@Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(HttpContext.Current.Session[SessionInfo.BaseAddress]));
        _oTechnicalSheet =@Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(Model));
        _oSubGenders = @Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(ViewBag.SubGenders));
        _oFabricTypes = @Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(ViewBag.FabricTypes));
        var oEmployees = _oTechnicalSheet.Employees;
        $("#cboMerchandiserID").icsLoadCombo({ List: oEmployees, OptionValue: "EmployeeID", DisplayText: "Name",InitialValue:"-Select Merchandiser-" });
        _oMeasurementUnits =_oTechnicalSheet.MeasurementUnits;
        _oMeasurementSpec =_oTechnicalSheet.MeasurementSpec;
        _oMeasurementSpecDetails = _oTechnicalSheet.MeasurementSpecDetails;
        _oTempMeasurementSpecDetails = _oTechnicalSheet.TempMeasurementSpecDetails;
        //_oTechnicalSheetSizeList =_oTechnicalSheet.TechnicalSheetSizes;
        $('#divTS').data('TechnicalSheetSizeList',_oTechnicalSheet.TechnicalSheetSizes);
        $('#divTS').data('TechnicalSheetColorList',_oTechnicalSheet.TechnicalSheetColors );

        _oStyleDepartments = _oTechnicalSheet.StyleDepartments;
        _oKnittingPatternList = _oTechnicalSheet.KnittingPatternList;
        _oBuyerWiseBrands =  _oTechnicalSheet.BuyerWiseBrands;
        _oGarmentsSubClasss=_oTechnicalSheet.GarmentsSubClasss;
        _oImageCommets =_oTechnicalSheet.ImageComments;
        _oDevelopmentRecap = _oTechnicalSheet.DevelopmentRecap;
        _oTechnicalSheetShipments = _oTechnicalSheet.TechnicalSheetShipments;
        RefreshListIC(_oImageCommets);
        _nMaxColorSequence = _oTechnicalSheet.TechnicalSheetColors.length;
        _nMaxSizeSequence = _oTechnicalSheet.TechnicalSheetSizes.length;
        _nMaxDiagramSequence = _oTempMeasurementSpecDetails.length;
        _sobjName =sessionStorage.getItem("TSHeader");

        $('#TStabs').tabs({ onSelect: function () {TabClick();} });
        document.getElementById('btnTechnicalSheetPaste').style.display = 'none';
        $('#btnCreateDevelopmentRecap,#btnCreateOrderRecap,#btnCreateLabdipOrder,#btnCreateDyeingOrder,#btnCreateSupplyOrder').hide();

        $("#cboDept").icsLoadCombo({ List: _oStyleDepartments, OptionValue: "StyleDepartmentID", DisplayText: "Name" });
        $("#cboDept").val(_oTechnicalSheet.Dept);

        $("#cboKnittingPattern").icsLoadCombo({ List: _oKnittingPatternList, OptionValue: "KnittingID", DisplayText: "Name" });
        $("#cboKnittingPattern").val(_oTechnicalSheet.KnittingPattern);

        $("#cboBrand").icsLoadCombo({ List: _oBuyerWiseBrands, OptionValue: "BrandID", DisplayText: "BrandName" });
        $("#cboBrand").val(_oTechnicalSheet.BrandID);

        $("#cboSubGender").icsLoadCombo({ List: _oSubGenders, OptionValue: "id", DisplayText: "Value" });
        $("#cboSubGender").val(_oTechnicalSheet.SubGender);

        $("#cboFabricType").icsLoadCombo({ List: _oFabricTypes, OptionValue: "id", DisplayText: "Value" });
        //
        SetControl();
        //Control and disabled field of woven type
        var cboTSType = document.getElementById("cboTSType");
        if (parseInt(cboTSType.options[cboTSType.selectedIndex].value) == parseInt(2)) {

            $('#lblExtraYarnFabric').text('Extra Fabric Compo:');
            //Asterix
            $('#lblPocketFabAsterix').show();
            $('#lblFabwidthAsterix').show();
            $('#lblClassAsterix').hide();
            $('#lblSubClassAsterix').hide();

        } else {

            $('#lblExtraYarnFabric').text('Extra Fabric Type :');
            //Asterix
            $('#lblPocketFabAsterix').hide();
            $('#lblShellFabAsterix').hide();
            $('#lblFabwidthAsterix').hide();
            $('#lblClassAsterix').show();
            $('#lblSubClassAsterix').show();

        }
        //set control disabeld or enabled
        if (_sobjName == "View TechnicalSheet") {
            document.getElementById('btnTechnicalSheetSave').style.display = 'none';
            document.getElementById('btnTechnicalSheetPaste').style.display = 'none';
            document.getElementById('btnCommitMS').style.display = 'none';
            document.getElementById('btnDiagramIdentification').style.display = 'none';
            document.getElementById('btnMSDelete').style.display = 'none';
            $('#btnCreateDevelopmentRecap,#btnCreateOrderRecap,#btnCreateLabdipOrder,#btnCreateDyeingOrder,#btnCreateSupplyOrder').hide();

            document.getElementById("txtBuyerID").value = _oTechnicalSheet.BuyerID;
            GetBuyerConcern(_oTechnicalSheet.BuyerID);
            SetControl();
        }
        if (_sobjName == "Edit TechnicalSheet") {
            $('#btnCreateDevelopmentRecap').show();
            document.getElementById('btnTechnicalSheetPaste').style.display = 'none';
            if (_oTechnicalSheet.IsExistOrderRecap == false) {
                $('#btnCreateOrderRecap').show();
            }
            $('#btnCreateLabdipOrder,#btnCreateDyeingOrder,#btnCreateSupplyOrder').hide();
            SetControl();
            document.getElementById("txtBuyerID").value = _oTechnicalSheet.BuyerID;
            GetBuyerConcern(_oTechnicalSheet.BuyerID);
        }
        if (_sobjName == 'Copy TechnicalSheet')
        {
            debugger;
            document.getElementById('btnTechnicalSheetPaste').style.display = '';
            document.getElementById('btnTechnicalSheetSave').style.display = 'none';
            _oTechnicalSheet.OldTSID = _oTechnicalSheet.TechnicalSheetID;
            _oTechnicalSheet.TechnicalSheetID = 0;//Reset id
            _oTechnicalSheet.DevelopmentStatusInInt = 0; //Reset Intialize
            _oTechnicalSheet.MeasurementSpecID = 0;//Reset Measuremnt spec

            document.getElementById("txtBuyerID").value = _oTechnicalSheet.BuyerID;
            GetBuyerConcern(_oTechnicalSheet.BuyerID);
        }
        $('#txtQty').numberbox({ min: 0, precision: 0 });
        DynamicRefreshList(_oTechnicalSheet.TechnicalSheetColors,'tblTSColor');
        DynamicRefreshList($('#divTS').data('TechnicalSheetSizeList'),'tblTSSize');
        LoadMUnits();//_oMeasurementUnits cboUnitType
    });


    ///Buyer Pick
    $("#txtBuyerName").keydown(function (e) {
        debugger;
        var code = (e.keyCode ? e.keyCode : e.which);
        if (code == 13) // Enter Press
        {
            var oContractor = {
                Params: '2' + '~' + $.trim($('#txtBuyerName').val())+'~'+sessionStorage.getItem("BUID")
            };

            var obj = {
                BaseAddress: _sBaseAddress,
                Object: oContractor,
                ControllerName: "Contractor",
                ActionName: "ContractorSearchByNameType",
                IsWinClose: false
            };
            $.icsDataGets(obj, function (response) {
                debugger;
                if (response.status && response.objs.length > 0) {
                    if (response.objs[0].ContractorID > 0) {
                        debugger;
                        var tblColums = []; var oColumn = { field: "Name", title: "Name", width: 200, align: "left" }; tblColums.push(oColumn);
                        oColumn = { field: "Address", title: "Address", width: 120, align: "left" }; tblColums.push(oColumn);
                        oColumn = { field: "Email", title: "Email", width: 90, align: "left" }; tblColums.push(oColumn);
                        oColumn = { field: "ShortName", title: "Short Name", width: 90, align: "left" }; tblColums.push(oColumn);
                        var oPickerParam = {
                            winid: 'winBuyers',
                            winclass: 'clsBuyer',
                            winwidth: 600,
                            winheight: 460,
                            tableid: 'tblBuyers',
                            tablecolumns: tblColums,
                            datalist: response.objs,
                            multiplereturn: false,
                            searchingbyfieldName: 'Name',
                            windowTittle: 'Buyer List'
                        };
                        $.icsPicker(oPickerParam);
                        IntializePickerbutton(oPickerParam);
                    }
                    else { alert(response.objs[0].ErrorMessage); }
                }
                else{
                    alert("Data Not Found.");
                    return;
                }
            });
        }
    });
    $("#btnBuyerPicker").click(function () {

        var oContractor = {
            Params: '2' + '~' + ''+'~'+sessionStorage.getItem("BUID")
        };

        var obj = {
            BaseAddress: _sBaseAddress,
            Object: oContractor,
            ControllerName: "Contractor",
            ActionName: "ContractorSearchByNameType",
            IsWinClose: false
        };
        $.icsDataGets(obj, function (response) {
            debugger;
            if (response.status && response.objs.length > 0) {
                if (response.objs[0].ContractorID > 0) {
                    var tblColums = []; var oColumn = { field: "Name", title: "Name", width: 200, align: "left" }; tblColums.push(oColumn);
                    oColumn = { field: "Address", title: "Address", width: 120, align: "left" }; tblColums.push(oColumn);
                    oColumn = { field: "Email", title: "Email", width: 90, align: "left" }; tblColums.push(oColumn);
                    oColumn = { field: "ShortName", title: "Short Name", width: 90, align: "left" }; tblColums.push(oColumn);
                    var oPickerParam = {
                        winid: 'winBuyers',
                        winclass: 'clsBuyer',
                        winwidth: 600,
                        winheight: 460,
                        tableid: 'tblBuyers',
                        tablecolumns: tblColums,
                        datalist: response.objs,
                        multiplereturn: false,
                        searchingbyfieldName: 'Name',
                        windowTittle: 'Buyer List'
                    };
                    $.icsPicker(oPickerParam);
                    IntializePickerbutton(oPickerParam);
                }
                else { alert(response.objs[0].ErrorMessage); }
            } else{
                alert("Data Not Found.");
                return;
            }
        });

    });
    $('#txtBuyerName').keydown(function (e) {
        var code = (e.keyCode ? e.keyCode : e.which);
        if (code == 8) //backspace=8
        {
            //debugger;
            var txttBuyerName = document.getElementById("txtBuyerName");
            txttBuyerName.style.color = "black";
            txttBuyerName.style.fontWeight = "normal";
            $('#txtBuyerID').val(0);
            GetBuyerConcern(0);
        }
    });

    //Product Pick
    $("#txtProductName").keydown(function (e) {
        debugger;
        var code = (e.keyCode ? e.keyCode : e.which);
        if (code == 13) // Enter Press
        {
            var oProduct = { BUID: sessionStorage.getItem('BUID'),ProductName:$('#txtProductName').val()};
            var obj = {
                BaseAddress: sessionStorage.getItem('BaseAddress'),
                Object: oProduct,
                ControllerName: "TechnicalSheet",
                ActionName: "GetFinishGoods",
                IsWinClose: false
            };
            $.icsDataGets(obj, function (response) {
                debugger;
                if (response.status && response.objs.length > 0) {
                    if (response.objs[0].ProductID > 0) {
                        var tblColums = []; var oColumn = { field: "NameCode", title: "Product Name", width: 300, align: "left" }; tblColums.push(oColumn);
                        var oPickerParam = {
                            winid: 'winProductPicker',
                            winclass: 'clsProductPicker',
                            winwidth: 600,
                            winheight: 460,
                            tableid: 'tblProductPicker',
                            tablecolumns: tblColums,
                            datalist: response.objs,
                            multiplereturn: false,
                            searchingbyfieldName: 'NameCode',
                            windowTittle: 'Product List'
                        };
                        $.icsPicker(oPickerParam);
                        IntializePickerbutton(oPickerParam);
                    }
                    else {
                        alert(response.objs[0].ErrorMessage);
                    }

                } else{
                    alert("Data Not Found.");
                    return;
                }
            });
        }
    });
    $("#btnProductPiker").click(function () {
        var oProduct = { BUID: sessionStorage.getItem('BUID'),ProductName:''};
        var obj = {
            BaseAddress: sessionStorage.getItem('BaseAddress'),
            Object: oProduct,
            ControllerName: "TechnicalSheet",
            ActionName: "GetFinishGoods",
            IsWinClose: false
        };
        $.icsDataGets(obj, function (response) {
            debugger;
            if (response.status && response.objs.length > 0) {
                if (response.objs[0].ProductID > 0) {
                    var tblColums = []; var oColumn = { field: "NameCode", title: "Product Name", width: 300, align: "left" }; tblColums.push(oColumn);
                    var oPickerParam = {
                        winid: 'winProductPicker',
                        winclass: 'clsProductPicker',
                        winwidth: 600,
                        winheight: 460,
                        tableid: 'tblProductPicker',
                        tablecolumns: tblColums,
                        datalist: response.objs,
                        multiplereturn: false,
                        searchingbyfieldName: 'NameCode',
                        windowTittle: 'Product List'
                    };
                    $.icsPicker(oPickerParam);
                    IntializePickerbutton(oPickerParam);
                }
                else {
                    alert(response.objs[0].ErrorMessage);
                }

            } else{
                alert("Data Not Found.");
                return;
            }
        });

    });
    $('#txtProductName').keydown(function (e) {
        var code = (e.keyCode ? e.keyCode : e.which);
        if (code == 8) //backspace=8
        {
            //debugger;
            var txttProductName = document.getElementById("txtProductName");
            txttProductName.style.color = "black";
            txttProductName.style.fontWeight = "normal";
            _oTechnicalSheet.ProductID = 0;
        }
    });

    //Yarn Category pick
    $("#txtFabricName").keydown(function (e) {
        debugger;
        var code = (e.keyCode ? e.keyCode : e.which);
        if (code == 13) // Enter Press
        {
            if($('#cboFabricType').val()<=0){alert("Please Select Fabric.");return;}
            if($.trim($('#txtFabricName').val())==''){alert("Please type Fabric.");return;}
            PickFabric();
        }
    });
    function PickFabric()
    {
        $.icsProgressBar(true);
        if($('#cboFabricType').val()<=0){alert("Please Select Fabric.");return;}
        var oProduct = { BUID: sessionStorage.getItem('BUID'),ProductName:$('#txtFabricName').val()};
        var obj = {
            BaseAddress: sessionStorage.getItem('BaseAddress'),
            Object: oProduct,
            ControllerName: "TechnicalSheet",
            ActionName: "GetYarnCategory",
            IsWinClose: false
        };
        $.icsDataGets(obj, function (response) {
            debugger;
            $.icsProgressBar(false);
            if (response.status && response.objs.length > 0) {
                if (response.objs[0].ProductID > 0) {
                    var tblColums = []; var oColumn = { field: "NameCode", title: "Yarn Name", width: 300, align: "left" }; tblColums.push(oColumn);
                    var oPickerParam = {
                        winid: 'winFabric',
                        winclass: 'clsYarCategory',
                        winwidth: 600,
                        winheight: 460,
                        tableid: 'tblYarnPicker',
                        tablecolumns: tblColums,
                        datalist: response.objs,
                        multiplereturn: false,
                        searchingbyfieldName: 'NameCode',
                        windowTittle: 'Yarn List'
                    };
                    $.icsPicker(oPickerParam);
                    IntializePickerbutton(oPickerParam);
                }
                else {
                    alert(response.objs[0].ErrorMessage);
                }

            } else{
                alert("Data Not Found.");
                return;
            }
        });
    }
    $('#btnRemoveFabric').click(function(){
        var oFabric= $('#tblFabric').datagrid('getSelected');
        if(oFabric==null || oFabric.YarnID<=0)
        {
            alert("Invalid Field!!! please select a valid Field!");
            return false;
        }
        if (!confirm("Confirm to Delete?")) return ;
        var SelectedRowIndex=$('#tblFabric').datagrid('getRowIndex',oFabric);
        alert("Delete sucessfully");
        $('#tblFabric').datagrid('deleteRow',SelectedRowIndex);
    });

    //Color Range
    $("#txtColorRange").keydown(function (e) {
        debugger;
        var code = (e.keyCode ? e.keyCode : e.which);
        if (code == 13) // Enter Press
        {
            PickColor();
        }
    });


    function PickColor()
    {
        var txtColorRange = document.getElementById('txtColorRange').value;
        var oColorCategory = {Param: txtColorRange };
        var obj = {
            BaseAddress: _sBaseAddress,
            Object: oColorCategory,
            ControllerName:"ColorCategory",
            ActionName: "SearchColor",
            IsWinClose: false
        };
        $.icsProgressBar(true);
        $.icsDataGets(obj, function (response) {
            debugger;
            $.icsProgressBar(false);
            if (response.status && response.objs.length > 0) {
                if (response.objs[0].ColorCategoryID > 0) {
                    debugger;
                    var tblColums = []; var oColumn = { field: "ColorName", title: "Color Name", width: 250, align: "left" }; tblColums.push(oColumn);
                    oColumn = { field: "Note", title: "Note", width: 120, align: "left" }; tblColums.push(oColumn);
                    var oPickerParam = {
                        winid: 'winColorCategory',
                        winclass: 'clsColorCategory',
                        winwidth: 500,
                        winheight: 400,
                        tableid: 'tblColorCategory',
                        tablecolumns: tblColums,
                        datalist: response.objs,
                        multiplereturn: true,
                        searchingbyfieldName: 'ColorName',
                        windowTittle: 'Color Category List'
                    };
                    $.icsPicker(oPickerParam);
                    IntializePickerbutton(oPickerParam);
                }
                else { alert(response.objs[0].ErrorMessage); }
            } else{
                alert("Data Not Found.");
                return;
            }
        });
    }

    $('#btnRemoveTSColor').click(function(){
        var oTSColor= $('#tblTSColor').datagrid('getSelected');
        if(oTSColor==null || oTSColor.ColorCategoryID<=0)
        {
            alert("Invalid Field!!! please select a valid Field!");
            return false;
        }
        if (!confirm("Confirm to Delete?")) return ;
        var SelectedRowIndex=$('#tblTSColor').datagrid('getRowIndex',oTSColor);
        alert("Delete sucessfully");
        $('#tblTSColor').datagrid('deleteRow',SelectedRowIndex);
        ResetSequence(false);
    });
    //Size Range
    $("#txtSizeRange").keydown(function (e) {
        debugger;
        var code = (e.keyCode ? e.keyCode : e.which);
        if (code == 13) // Enter Press
        {
            PickSize();
        }
    });
    function PickSize(){

        var oSizeCategory = {Param:$.trim($('#txtSizeRange').val())};
        var obj = {
            BaseAddress: _sBaseAddress,
            Object: oSizeCategory,
            ControllerName: "SizeCategory",
            ActionName: "SearchSize",
            IsWinClose: false
        };
        $.icsProgressBar(true);
        $.icsDataGets(obj, function (response) {
            debugger;
            $.icsProgressBar(false);
            if (response.status && response.objs.length > 0) {
                if (response.objs[0].SizeCategoryID > 0) {
                    debugger;
                    var tblColums = []; var oColumn = { field: "SizeCategoryName", title: "Size Name", width: 250, align: "left" }; tblColums.push(oColumn);
                    oColumn = { field: "Note", title: "Note", width: 120, align: "left" }; tblColums.push(oColumn);
                    var oPickerParam = {
                        winid:'winSizeCategory',
                        winclass:'clsSizeCategory',
                        winwidth: 500,
                        winheight: 400,
                        tableid: 'tblSizeCategory',
                        tablecolumns: tblColums,
                        datalist: response.objs,
                        multiplereturn: true,
                        searchingbyfieldName: 'SizeCategoryName',
                        windowTittle: 'Size Category List'
                    };
                    $.icsPicker(oPickerParam);
                    IntializePickerbutton(oPickerParam);
                }
                else { alert(response.objs[0].ErrorMessage); }
            } else{
                alert("Data Not Found.");
                return;
            }
        });
    }


    $('#btnRemoveTSSize').click(function(){
        var oTSSize= $('#tblTSSize').datagrid('getSelected');
        if(oTSSize==null || oTSSize.SizeCategoryID<=0)
        {
            alert("Invalid Field!!! please select a valid Field!");
            return false;
        }
        if (!confirm("Confirm to Delete?")) return ;
        var SelectedRowIndex=$('#tblTSSize').datagrid('getRowIndex',oTSSize);
        alert("Delete sucessfully");
        $('#tblTSSize').datagrid('deleteRow',SelectedRowIndex);
        ResetSequence(true);
    });
    function ResetSequence(bIsSize)
    {
        var nSize = 1;
        var oTempList = [];
        if(bIsSize)
        {
            var oTSSizeList= $('#tblTSSize').datagrid('getRows');
            for(var i = 0;i<oTSSizeList.length;i++)
            {
                oTSSizeList[i].Sequence =nSize;nSize++;
            }
            DynamicRefreshList(oTSSizeList,'tblTSSize');
        }else
        {
            var oTSColorList= $('#tblTSColor').datagrid('getRows');
            for(var i = 0;i<oTSColorList.length;i++)
            {
                oTSColorList[i].Sequence =nSize;nSize++;
            }
            DynamicRefreshList(oTSColorList,'tblTSColor');
        }
    }

    function IsSelectedCategory(oTSColors, nCategoryID)
    {

        for (var j = 0;j<oTSColors.length; j++)
        {
            if (parseInt(oTSColors[j].ColorCategoryID) == parseInt(nCategoryID))
            {
                return true;
            }
        }
        return false;
    }

    function IsSelectedSize(oTSSizes, nSizeCategoryID) {

        for (var j = 0; j < oTSSizes.length; j++) {
            if (parseInt(oTSSizes[j].SizeCategoryID)== parseInt(nSizeCategoryID)) {
                return true;
            }
        }
        return false;
    }

    function Save()
    {
        endEditingTSColor();
        endEditingTSShipment();
        endEditingTSSize();
        endEditingFabric();
        if (!ValidateInput()) return;
        $.icsProgressBar(true);
        var oTechnicalSheet = RefreshObject();
        $.ajax({
            type: "POST",
            dataType: "json",
            url: _sBaseAddress + "/TechnicalSheet/Save",
            traditional: true,
            data: JSON.stringify(oTechnicalSheet),
            contentType: "application/json; charset=utf-8",
            success: function (data) {
                $.icsProgressBar(false);
                debugger;
                _oTechnicalSheet = jQuery.parseJSON(data);
                if (_oTechnicalSheet.ErrorMessage == '') {
                    alert("Data Saved sucessfully");
                    var oTechnicalSheets = sessionStorage.getItem("TechnicalSheets");
                    var nIndex = parseInt(sessionStorage.getItem("TSSelectedRowIndex"));
                    if (oTechnicalSheets != null) {
                        oTechnicalSheets = jQuery.parseJSON(oTechnicalSheets);
                    }
                    else {
                        oTechnicalSheets = [];
                    }
                    if (nIndex != -1) {
                        oTechnicalSheets[nIndex] = _oTechnicalSheet;
                    }
                    else {
                        sessionStorage.setItem("TSSelectedRowIndex", oTechnicalSheets.length);
                        oTechnicalSheets.push(_oTechnicalSheet);
                    }
                    sessionStorage.setItem("TechnicalSheets", JSON.stringify(oTechnicalSheets));
                    //divMaterial
                    if (confirm("Do you continue next Step?")) {
                        $('#TStabs').tabs({ selected: 1 });//select Row Material Tab
                        document.getElementById('btnTechnicalSheetSave').style.display = 'none';
                        document.getElementById('btnTechnicalSheetPaste').style.display = 'none';
                        $('#btnCreateDevelopmentRecap').show();
                        if (_oTechnicalSheet.IsExistOrderRecap == false) {
                            $('#btnCreateOrderRecap').show();
                        }
                        $('#btnCreateLabdipOrder,#btnCreateDyeingOrder,#btnCreateSupplyOrder').hide();
                        _oTechnicalSheet.TechnicalSheetSizes = $('#divTS').data('TechnicalSheetSizeList');
                        MakeMSTable($('#divTS').data('TechnicalSheetSizeList'));
                        RefreshMeasurementSpecDetails(_oTempMeasurementSpecDetails);
                    } else {
                        window.location.href = sessionStorage.getItem("BackLink");
                    }
                }
                else {
                    alert(_oTechnicalSheet.ErrorMessage);
                }
            },
            error: function (xhr, status, error) {
                alert(error);
            }

        });
    }
    function TabClick()
    {
        var tab = $('#TStabs').tabs('getSelected');
        var index = $('#TStabs').tabs('getTabIndex', tab);
        if (index!= 0)
        {
            document.getElementById('btnTechnicalSheetSave').style.display = 'none';
            document.getElementById('btnTechnicalSheetPaste').style.display = 'none';
        }
        else if (_sobjName != "View TechnicalSheet" && _sobjName != "Copy TechnicalSheet")
        {
            document.getElementById('btnTechnicalSheetSave').style.display = '';
        }else if(_sobjName == "Copy TechnicalSheet" )
        {
            document.getElementById('btnTechnicalSheetPaste').style.display = '';
        }
    }
    function ValidateInput()
    {
        debugger;
        if (document.getElementById("txtStyleNo").value == null || document.getElementById("txtStyleNo").value == "") {
            alert("Please enter Style No!");
            $('#txtStyleNo').focus();
            return false;
        }

        var cboTSType = document.getElementById("cboTSType");
        var nTSType = parseInt(cboTSType.options[cboTSType.selectedIndex].value);
        if (nTSType == parseInt(-1)) {
            alert("Select Technical Sheet Type");
            $('#cboTSType').focus();
            return;
        }

        if (document.getElementById("txtBuyerID").value == null || document.getElementById("txtBuyerID").value == "") {
            alert("Please select Buyer!");
            $('#txtBuyerName').focus();
            return;
        }

        var nBuyerID = document.getElementById("txtBuyerID").value;
        if (parseInt(nBuyerID) <= 0) {
            alert("Please select Buyer!");
            $('#txtBuyerName').focus();
            return false;
        }

        var sBaseAddress = sessionStorage.getItem('BaseAddress');
        if(sBaseAddress!="/amg" && sBaseAddress!="/tnz")
        {
            if (document.getElementById("cboBuyerConcern").value == null || document.getElementById("cboBuyerConcern").value == "") {
                alert("Please select Buyer Concern!");
                $('#cboBuyerConcern').focus();
                return false;
            }

            var cboBuyerConcern = document.getElementById("cboBuyerConcern");
            if (cboBuyerConcern.options[cboBuyerConcern.selectedIndex].value <= 0) {
                alert("Please select Buyer Concern!");
                $('#cboBuyerConcern').focus();
                return false;
            }

            if (_oTechnicalSheet.ProductID <= 0) {
                alert("Please select Product!");
                $('#btnProductPiker').focus();
                return false;
            }

            //if (_oTechnicalSheet.GSMID <= 0) {
            //    alert("Please select GSM!");
            //    $('#txtGSM').focus();
            //    return false;
            //}

            var cboSeasons = document.getElementById("cboSeasons");
            if (cboSeasons.options[cboSeasons.selectedIndex].value <= 0) {
                alert("Please select Session!");
                $('#cboSeasons').focus();
                return false;
            }

            if ($("#cboKnittingPattern").val()<= 0) {
                alert("Please select Knitting Pattern!");
                $('#cboKnittingPattern').focus();
                return false;
            }

            var oTSColors = $('#tblTSColor').datagrid('getRows');
            if (oTSColors == null || oTSColors.length <= 0) {
                alert("Please select Color Range!");
                $('#btnColorRange').focus();
                return false;
            }

            if ($('#divTS').data('TechnicalSheetSizeList') == null || $('#divTS').data('TechnicalSheetSizeList').length <= 0) {
                alert("Please select Size Range!");
                $('#btnSizeRange').focus();
                return false;
            }
            var oFabList = $('#tblFabric').datagrid('getRows');
            if(oFabList.length<=0)
            {
                alert("Please Add Fabric.");
                $('#TSShipmenttabs').tabs('select',3);
                $('#txtFabricName').focus();
                return false;
            }
            var bIsExistFabricType = false;
            for(var i=0;i<oFabList.length;i++)
            {
                if(oFabList[i].YarnType==1)
                {
                    bIsExistFabricType=true;break;
                }
            }
            if(!bIsExistFabricType)
            {
                alert("Sorry , There is No Fabric with Fabric Type.");
                $('#TSShipmenttabs').tabs('select',3);
                $('#txtFabricName').focus();
                return false;
            }

            if (nTSType == 2)//Woven
            {
                //if (_oTechnicalSheet.ShellFab <= 0) {
                //    alert("Please select Shell Fab!");
                //    $('#btnShellFabPiker').focus();
                //    return false;
                //}

                //if (_oTechnicalSheet.PocketingFab <= 0) {
                //    alert("Please select Pocketing Fab!");
                //    $('#btnPocketingFabPiker').focus();
                //    return false;
                //}
                if (document.getElementById("txtFabWidth").value == null || document.getElementById("txtFabWidth").value == "") {
                    alert("Please enter Fab Width!");
                    $('#txtFabWidth').focus();
                    return false;
                }
            }

            //debugger;
            var nSizeLength = 0;
            nSizeLength = _oTechnicalSheet.SizeRangeIDs.split(',').length;
            if (nSizeLength > 20) {
                alert("You can add maximum 20 color! Please try again!");
                $('#btnSizeRange').focus();
                return false;
            }

            if (parseInt($("#cboMerchandiserID").val()) <= 0) {
                alert("Please select Merchandiser!");
                $('#cboMerchandiserID').focus();
                return false;
            }
        }
        return true;
    }
    function RefreshObject() {
        debugger;
        var cboBuyerConcern = document.getElementById("cboBuyerConcern");
        var cboSeasons = document.getElementById("cboSeasons");
        var cboTSType = document.getElementById("cboTSType");
        var cboDept = document.getElementById("cboDept");
        var sBaseAddress = sessionStorage.getItem('BaseAddress');


        var oTechnicalSheet = {
            TechnicalSheetID: _oTechnicalSheet.TechnicalSheetID,
            StyleNo: $("#txtStyleNo").val(),
            BusinessSessionID: cboSeasons.options[cboSeasons.selectedIndex].value,
            DevelopmentStatusInInt: _oTechnicalSheet.DevelopmentStatusInInt,
            BuyerID: parseInt(document.getElementById("txtBuyerID").value),
            ProductID: _oTechnicalSheet.ProductID,
            Dept: cboDept.options[cboDept.selectedIndex].value,
            SubGender:$('#cboSubGender').val(),
            KnittingPattern: $("#cboKnittingPattern").val(),
            BrandID: $("#cboBrand").val(),
            BuyerConcernID: cboBuyerConcern.options[cboBuyerConcern.selectedIndex].value,
            YarnCategoryID: _oTechnicalSheet.YarnCategoryID,
            ExtraYarnCategoryID: _oTechnicalSheet.ExtraYarnCategoryID,
            GG: $("#txtGG").val(),
            GSMID:_oTechnicalSheet.GSMID,
            Count: $("#txtCount").val(),
            SpecialFinish: $("#txtSpecialFinish").val(),
            Weight: '',  //$("#txtWeight").val(),
            Designer: $("#txtDesigner").val(),
            Note: $("#txtNote").val(),
            ShellFab: _oTechnicalSheet.ShellFab,
            PocketingFab: _oTechnicalSheet.PocketingFab,
            FabWidth: $("#txtFabWidth").val(),
            Wash: $("#txtWash").val(),
            FabCode: $("#txtFabCode").val(),
            OldTSID: _oTechnicalSheet.OldTSID,
            BUID:sessionStorage.getItem("BUID"),
            MerchandiserID: parseInt($("#cboMerchandiserID").val()),
            TSTypeInInt: cboTSType.options[cboTSType.selectedIndex].value,
            ApproxQty:ICS_TotalCalculation($('#tblTSShipment').datagrid('getRows'),'Qty')  ,
            TechnicalSheetSizes: $('#tblTSSize').datagrid('getRows'),
            TechnicalSheetColors: $('#tblTSColor').datagrid('getRows'),
            TechnicalSheetShipments:$('#tblTSShipment').datagrid('getRows'),
            OrderRecapYarns:$('#tblFabric').datagrid('getRows')
        };
        return oTechnicalSheet;
    }
    function ColorExists(oColorCategory) {
        var oTSColors = $('#tblTSColor').datagrid('getRows');
        for (var i = 0; i < oTSColors.length; i++) {
            if (oTSColors[i].ColorCategoryID == oColorCategory.ColorCategoryID) {
                return true;
            }
        }
        return false;
    }
    function SizeExists(oSizeCategory) {
        var oTechnicalSheetSizeList = $('#divTS').data('TechnicalSheetSizeList');
        for (var i = 0; i < oTechnicalSheetSizeList.length; i++) {
            if (oTechnicalSheetSizeList[i].SizeCategoryID == oSizeCategory.SizeCategoryID) {
                return true;
            }
        }
        return false;
    }
    function GetTSSize(sSizeName) {
        var oTempSizeList = $('#divTS').data('TechnicalSheetSizeList');
        for (var i = 0; i < oTempSizeList.length; i++) {
            if (oTempSizeList[i].SizeCategoryName == sSizeName) {
                return oTempSizeList[i];
            }
        }
        return null;
    }

    var editTSSizeIndex = undefined;
    function endEditingTSSize(){
        if (editTSSizeIndex == undefined){return true}
        if ($('#tblTSSize').datagrid('validateRow', editTSSizeIndex)){
            $('#tblTSSize').datagrid('endEdit', editTSSizeIndex);
            editTSSizeIndex  = undefined;
            return true;
        }
        else
        {
            return false;
        }
    }
    function onClickRowTSSize(index){

        if (editTSSizeIndex != index)
        {
            if (endEditingTSSize())
            {
                $('#tblTSSize').datagrid('selectRow', index)
                        .datagrid('beginEdit', index);
                editTSSizeIndex  = index;
            }
            else
            {
                $('#tblTSSize').datagrid('selectRow', editTSSizeIndex);
            }
        }
    }
    var editTSColorIndex = undefined;
    function endEditingTSColor(){
        if (editTSColorIndex == undefined){return true}
        if ($('#tblTSColor').datagrid('validateRow', editTSColorIndex)){
            $('#tblTSColor').datagrid('endEdit', editTSColorIndex);
            editTSColorIndex  = undefined;
            return true;
        }
        else
        {
            return false;
        }
    }

    function onClickRowTSColor(index){

        if (editTSColorIndex != index)
        {
            if (endEditingTSColor())
            {
                $('#tblTSColor').datagrid('selectRow', index)
                        .datagrid('beginEdit', index);
                editTSColorIndex  = index;
            }
            else
            {
                $('#tblTSColor').datagrid('selectRow', editTSColorIndex);
            }
        }
    }

    var editFabricIndex = undefined;
    function endEditingFabric(){
        if (editFabricIndex == undefined){return true}
        if ($('#tblFabric').datagrid('validateRow', editFabricIndex)){
            $('#tblFabric').datagrid('endEdit', editFabricIndex);
            editFabricIndex  = undefined;
            return true;
        }
        else
        {
            return false;
        }
    }

    function onClickRowFabric(index){

        if (editFabricIndex != index)
        {
            if (endEditingFabric())
            {
                $('#tblFabric').datagrid('selectRow', index).datagrid('beginEdit', index);
                editFabricIndex  = index;
            }
            else
            {
                $('#tblFabric').datagrid('selectRow', editFabricIndex);
            }
        }
    }

    function AddBuyerConcern() {
        if (document.getElementById("txtBuyerID").value == null || document.getElementById("txtBuyerID").value == "") {
            alert("Please select Buyer!");
            $('#txtBuyerName').focus();
            return;
        }

        var nBuyerID = document.getElementById("txtBuyerID").value;
        if (parseInt(nBuyerID) <= 0) {
            alert("Please select Buyer!");
            $('#txtBuyerName').focus();
            return;
        }
        var oParameter = new Object();
        oParameter.Name = "Add Buyer Concern";
        var tsv = ((new Date()).getTime()) / 1000;
        var url = _sBaseAddress + "/Contractor/ViewBuyerConcern?id=" + parseInt(nBuyerID) + "&ts=" + tsv;
        var oBuyerConcern = window.showModalDialog(url, oParameter, 'dialogHeight:485px;dialogWidth:800px;dialogLeft:300;dialogTop:100;center:yes;resizable:no;status:no;scroll:no');
    }

    function LoadBuyerConcern() {
        if (document.getElementById("txtBuyerID").value == null || document.getElementById("txtBuyerID").value == "") {
            alert("Please select Buyer!");
            $('#txtBuyerName').focus();
            return;
        }
        var nBuyerID = document.getElementById("txtBuyerID").value;
        if (parseInt(nBuyerID) <= 0) {
            alert("Please select Buyer!");
            $('#txtBuyerName').focus();
            return;
        }
        GetBuyerConcern(nBuyerID);
    }

    function GetBuyerConcern(nBuyerID) {
        //debugger;
        var obj = window.dialogArguments;
        var nBuyerID = nBuyerID;
        var tsv = (new Date().getTime()) / 1000;
        var listItems = "";
        $.ajax
           ({
               type: "GET",
               dataType: "json",
               url: _sBaseAddress + "/TechnicalSheet/GetContactPersonnel",
               data: { nBuyerID: nBuyerID, ts: tsv },
               contentType: "application/json; charset=utf-8",
               success: function (data) {
                   //debugger;
                   var oContactPersonnels = jQuery.parseJSON(data);
                   if (oContactPersonnels != null) {
                       if (oContactPersonnels.length > 0)
                       {
                           for (i = 0; i < oContactPersonnels.length; i++)
                           {
                               listItems += "<option value='" + oContactPersonnels[i].ContactPersonnelID + "'>" + oContactPersonnels[i].Name + "</option>";
                           }
                           $("#cboBuyerConcern").html(listItems);
                           if (_sobjName == "View TechnicalSheet")
                           {
                               $('#cboBuyerConcern').val(_oTechnicalSheet.BuyerConcernID);
                           }
                           if (_sobjName == "Edit TechnicalSheet")
                           {
                               $('#cboBuyerConcern').val(_oTechnicalSheet.BuyerConcernID);
                           }
                       }
                       else {
                           $("#cboBuyerConcern").html(listItems);
                       }
                   }
                   else {
                       $("#cboBuyerConcern").html(listItems);
                   }
               },
               error: function (xhr, status, error) {
                   alert(error);
               }

           });

    }

    function GetBrands(nBuyerID)
    {
        var obj = window.dialogArguments;
        var nBuyerID = nBuyerID;
        var tsv = (new Date().getTime()) / 1000;
        var listItems = "";
        $.ajax
           ({
               type: "GET",
               dataType: "json",
               url: _sBaseAddress + "/Brand/GetBrands",
               data: { nBuyerID:nBuyerID, ts: tsv },
               contentType: "application/json; charset=utf-8",
               success: function (data) {
                   //debugger;
                   var oBuyerWiseBrands = jQuery.parseJSON(data);
                   if (oBuyerWiseBrands != null) {
                       if (oBuyerWiseBrands.length > 0)
                       {
                           $("#cboBrand").icsLoadCombo({ List: oBuyerWiseBrands, OptionValue: "BrandID", DisplayText: "BrandName" });
                       }
                   }
                   else {
                       $("#cboBrand").html(listItems);
                   }
               },
               error: function (xhr, status, error) {
                   alert(error);
               }

           });

    }

    function SetControl() {
        //debugger;

        var txttBuyerName = document.getElementById("txtBuyerName");
        txttBuyerName.style.color = "green";
        txttBuyerName.style.fontWeight = "bold";


        $("#txtGSM").addClass("fontColorOfPickItem");

        var txttProductName = document.getElementById("txtProductName");
        txttProductName.style.color = "green";
        txttProductName.style.fontWeight = "bold";


        if(_sobjName=="Add Technicalsheet")
        {
            $('#cboTSType').val(1);//Default set Knit
        }else
        {
            $('#cboTSType').val(_oTechnicalSheet.TSTypeInInt);
        }
        $("#cboMerchandiserID").val(_oTechnicalSheet.MerchandiserID);

        DynamicRefreshList(_oTechnicalSheet.OrderRecapYarns,'tblFabric');
        MakeMSTable($('#divTS').data('TechnicalSheetSizeList'));
        RefreshMeasurementSpecDetails(_oTempMeasurementSpecDetails);
        LoadAll(_oTechnicalSheet);
        DynamicRefreshList(_oTechnicalSheetShipments,'tblTSShipment');
        MakeFooterTSShipment();
    }

    function MakeFooterTSShipment()
    {
        var FooterField = [];
        var data = $('#tblTSShipment').datagrid('getRows');
        var obj = new Object();
        obj['DeliveryDate'] = " Global Qty :";obj['Qty'] = ICS_TotalCalculation(data,'Qty') ;FooterField.push(obj);
        $('#tblTSShipment').datagrid('reloadFooter', FooterField);
    }

    function AddTSShipment()
    {
        var oTechnicalSheetShipment={TechnicalSheetShipmentID : 0,TechnicalSheetID :_oTechnicalSheet.TechnicalSheetID,DeliveryDate :'Shipment WH Delivery 1',Qty:0,Remarks:""};
        $('#tblTSShipment').datagrid('appendRow',oTechnicalSheetShipment);
        MakeFooterTSShipment();
    }
    function RemoveTSShipment()
    {
        debugger;
        var oTSShipment= $('#tblTSShipment').datagrid('getSelected');
        if(oTSShipment==null || oTSShipment.DeliveryDate=="")
        {
            alert("Invalid Field!!! please select a valid Field!");
            return false;
        }
        if (!confirm("Confirm to Delete?")) return ;
        var SelectedRowIndex=$('#tblTSShipment').datagrid('getRowIndex',oTSShipment);
        alert("Delete sucessfully");
        $('#tblTSShipment').datagrid('deleteRow',SelectedRowIndex);
        MakeFooterTSShipment();MakeTSShipmentBoxReSet();$('#txtDD').focus();
    }
    function RefreshTSShipment()
    {
        endEditingTSShipment();
        var oTSShipments= $('#tblTSShipment').datagrid('getRows');
        DynamicRefreshList(oTSShipments,'tblTSShipment');
        MakeFooterTSShipment();
    }

    $('#txtSearchColorSequence').keyup(function(e){
        var oColorCategorys = $('#tblColorBank').data('ColorCategorys');
        $('#txtSearchColorSequence').icsSearchByText({
            Event: e,
            SearchProperty: "ColorName",
            GlobalObjectList: oColorCategorys,
            TableId: "tblColorBank"
        });
    });

    $('#btnColorSequenceClose').click(function(e){
        $("#winColorSequence").icsWindow('close');
    });

    $('#tblColorBank').datagrid({
        onDblClickRow: function(index,row){
            AddToColorList(row);
        }
    });

    $('#btnAddTSColor').click(function(e){
        var oColorCategory = $('#tblColorBank').datagrid('getSelected');
        if(oColorCategory===null || parseInt(oColorCategory.ColorCategoryID)<=0)
        {
            alert("Please select an color category!");
            return;
        }
        AddToColorList(oColorCategory);
    });

    $('#btnColorSequenceRemove').click(function(e){
        var oTechnicalSheetColor = $('#tblTechnicalSheetColor').datagrid('getSelected');
        if(oTechnicalSheetColor===null || parseInt(oTechnicalSheetColor.ColorCategoryID)<=0)
        {
            alert("Please select an color category!");
            return;
        }

        var nRowIndex = $('#tblTechnicalSheetColor').datagrid('getRowIndex', oTechnicalSheetColor);
        $('#tblTechnicalSheetColor').datagrid('deleteRow', nRowIndex);

    });

    $('#btnColorSequenceUp').click(function(e){
        var oTechnicalSheetColor = $('#tblTechnicalSheetColor').datagrid('getSelected');
        if(oTechnicalSheetColor==null || parseInt(oTechnicalSheetColor.ColorCategoryID)<=0)
        {
            alert("Please select color");
            return;
        }

        var SelectedRowIndex=$('#tblTechnicalSheetColor').datagrid('getRowIndex',oTechnicalSheetColor);
        var oTempTechnicalSheetColors = $('#tblTechnicalSheetColor').datagrid('getRows');
        if(SelectedRowIndex==0)return;
        var oTechnicalSheetColors=[];
        oTechnicalSheetColors=oTempTechnicalSheetColors;
        oTempTechnicalSheetColors=[];
        for(var i=0; i<oTechnicalSheetColors.length; i++)
        {
            if(i==(SelectedRowIndex-1))
            {
                oTempTechnicalSheetColors[i]=oTechnicalSheetColors[i+1];
            }
            else if(i==SelectedRowIndex)
            {
                oTempTechnicalSheetColors[i]=oTechnicalSheetColors[i-1];
            }
            else
            {
                oTempTechnicalSheetColors[i]=oTechnicalSheetColors[i];
            }
            oTempTechnicalSheetColors[i].Sequence=i+1;
        }

        data = oTempTechnicalSheetColors;
        data={"total":""+data.length+"","rows":data};
        $('#tblTechnicalSheetColor').datagrid('loadData',data);
        var newSelectedRowIndex=SelectedRowIndex-1;
        $('#tblTechnicalSheetColor').datagrid('selectRow',newSelectedRowIndex);
    });

    $('#btnColorSequenceDown').click(function(e){
        var oTechnicalSheetColor = $('#tblTechnicalSheetColor').datagrid('getSelected');
        if(oTechnicalSheetColor==null || parseInt(oTechnicalSheetColor.ColorCategoryID)<=0)
        {
            alert("Please select a item from list!");
            return;
        }
        var SelectedRowIndex=$('#tblTechnicalSheetColor').datagrid('getRowIndex',oTechnicalSheetColor);
        var oTempTechnicalSheetColors = $('#tblTechnicalSheetColor').datagrid('getRows');
        if(SelectedRowIndex==(oTempTechnicalSheetColors.length-1))return;
        var oTechnicalSheetColors=[];
        oTechnicalSheetColors=oTempTechnicalSheetColors;
        oTempTechnicalSheetColors=[];
        for(var i=0; i<oTechnicalSheetColors.length; i++)
        {
            if(i==(SelectedRowIndex+1))
            {
                oTempTechnicalSheetColors[i]=oTechnicalSheetColors[i-1];
            }
            else if(i==SelectedRowIndex)
            {
                oTempTechnicalSheetColors[i]=oTechnicalSheetColors[i+1];
            }
            else
            {
                oTempTechnicalSheetColors[i]=oTechnicalSheetColors[i];
            }
            oTempTechnicalSheetColors[i].Sequence=i+1;
        }
        data = oTempTechnicalSheetColors;
        data={"total":""+data.length+"","rows":data};
        $('#tblTechnicalSheetColor').datagrid('loadData',data);
        var newSelectedRowIndex=SelectedRowIndex+1;
        $('#tblTechnicalSheetColor').datagrid('selectRow',newSelectedRowIndex);
    });

    $('#btnColorSequenceSave').click(function(e){
        var oTechnicalSheetColorList = [];
        _nMaxColorSequence = 0;
        var oTechnicalSheetColor = $('#tblTechnicalSheetColor').datagrid('getRows');
        for (var i = 0; i < oTechnicalSheetColor.length; i++) {
            _nMaxColorSequence++;
            var oTSColor = {
                TechnicalSheetColorID: 0,
                TechnicalSheetID: _oTechnicalSheet.TechnicalSheetID,
                ColorCategoryID: oTechnicalSheetColor[i].ColorCategoryID,
                ColorName: oTechnicalSheetColor[i].ColorName,
                PantonNo: oTechnicalSheetColor[i].PantonNo,
                Sequence: _nMaxColorSequence
            };
            oTechnicalSheetColorList.push(oTSColor);
        }
        DynamicRefreshList(oTechnicalSheetColorList,'tblTSColor');
        $("#winColorSequence").icsWindow('close');

        $('#txtColorRange').focus();
    });

    function AddToColorList(oColorCategory)
    {
        var oTechnicalSheetColors = $('#tblTechnicalSheetColor').datagrid('getRows');
        for (var i = 0; i < oTechnicalSheetColors.length; i++) {
            if (parseInt(oTechnicalSheetColors[i].ColorCategoryID) === parseInt(oColorCategory.ColorCategoryID)) {
                alert("Your Selected Color Already Exists!");
                return;
            }
        }
        var oTechnicalSheetColor = {
            TechnicalSheetColorID: 0,
            TechnicalSheetID: _oTechnicalSheet.TechnicalSheetID,
            ColorCategoryID: oColorCategory.ColorCategoryID,
            ColorName: oColorCategory.ColorName,
            PantonNo:"",
            Sequence: ($('#tblTechnicalSheetColor').datagrid('getRows').length+1)
        };
        $('#tblTechnicalSheetColor').datagrid('appendRow',oTechnicalSheetColor);
    }

    $('#btnNewColor').click(function(e){
        var oColorCategory={ Param : '' };
        $.ajax({
            type: "POST",
            dataType: "json",
            url : _sBaseAddress+  "/ColorCategory/SearchColor",
            traditional: true,
            data:  JSON.stringify(oColorCategory),
            contentType: "application/json; charset=utf-8",
            success: function (data) {
                var oColorCategorys = jQuery.parseJSON(data);
                $('#tblColorBank').data('ColorCategorys', oColorCategorys);
                $("#winColorSequence").icsWindow('open', "Pick Color");
                DynamicRefreshList(oColorCategorys, 'tblColorBank');
                var oTSColors = $('#tblTSColor').datagrid('getRows');
                DynamicRefreshList(oTSColors, 'tblTechnicalSheetColor');
            },
            error: function (xhr, status, error) {
                alert(error);
            }
        });
    });

    $('#btnNewColorCategory').click(function(e){
        $("#winNewColor").icsWindow('open', "Add Color");
        $("#winNewColor input").not("input[type='button']").val("");
    });

    $('#btnNewColorSave').click(function(e){
        if($.trim($('#txtNewColorName').val())===null || $.trim($('#txtNewColorName').val())==="")
        {
            alert("Please Enter Color Name!");
            return;
        }
        var oColorCategory= {
            ColorCategoryID : 0,
            ColorName : $.trim($("#txtNewColorName").val()),
            Note : $.trim($("#txtNewColorNote").val())
        };

        $.ajax({
            type: "POST",
            dataType: "json",
            url : _sBaseAddress+  "/ColorCategory/Save",
            traditional: true,
            data:  JSON.stringify(oColorCategory),
            contentType: "application/json; charset=utf-8",
            success: function (data) {
                oColorCategory = jQuery.parseJSON(data);
                if (oColorCategory.ErrorMessage == null || oColorCategory.ErrorMessage == "") {
                    alert("Data Saved sucessfully");
                    $("#winNewColor").icsWindow('close');
                    var nRowIndex = $('#tblColorBank').datagrid('getRows').length;
                    $('#tblColorBank').datagrid('appendRow',oColorCategory);
                    $('#tblColorBank').datagrid('selectRow',nRowIndex);
                }
                else {
                    alert(oColorCategory.ErrorMessage);
                }
            },
            error: function (xhr, status, error) {
                alert(error);
            }
        });
    });

    $('#btnNewColorClose').click(function(e){
        $("#winNewColor").icsWindow('close');
    });

    $('#txtSearchSizeSequence').keyup(function(e){
        var oSizeCategorys = $('#tblSizeBank').data('SizeCategorys');
        $('#txtSearchSizeSequence').icsSearchByText({
            Event: e,
            SearchProperty: "SizeName",
            GlobalObjectList: oSizeCategorys,
            TableId: "tblSizeBank"
        });
    });

    $('#btnSizeSequenceClose').click(function(e){
        $("#winSizeSequence").icsWindow('close');
    });

    $('#tblSizeBank').datagrid({
        onDblClickRow: function(index,row){
            AddToSizeList(row);
        }
    });

    $('#btnAddTSSize').click(function(e){
        var oSizeCategory = $('#tblSizeBank').datagrid('getSelected');
        if(oSizeCategory===null || parseInt(oSizeCategory.SizeCategoryID)<=0)
        {
            alert("Please select an Size category!");
            return;
        }
        AddToSizeList(oSizeCategory);
    });

    $('#btnSizeSequenceRemove').click(function(e){
        var oTechnicalSheetSize = $('#tblTechnicalSheetSize').datagrid('getSelected');
        if(oTechnicalSheetSize===null || parseInt(oTechnicalSheetSize.SizeCategoryID)<=0)
        {
            alert("Please select an Size category!");
            return;
        }

        var nRowIndex = $('#tblTechnicalSheetSize').datagrid('getRowIndex', oTechnicalSheetSize);
        $('#tblTechnicalSheetSize').datagrid('deleteRow', nRowIndex);

    });

    $('#btnSizeSequenceUp').click(function(e){
        var oTechnicalSheetSize = $('#tblTechnicalSheetSize').datagrid('getSelected');
        if(oTechnicalSheetSize==null || parseInt(oTechnicalSheetSize.SizeCategoryID)<=0)
        {
            alert("Please select Size");
            return;
        }

        var SelectedRowIndex=$('#tblTechnicalSheetSize').datagrid('getRowIndex',oTechnicalSheetSize);
        var oTempTechnicalSheetSizes = $('#tblTechnicalSheetSize').datagrid('getRows');
        if(SelectedRowIndex==0)return;
        var oTechnicalSheetSizes=[];
        oTechnicalSheetSizes=oTempTechnicalSheetSizes;
        oTempTechnicalSheetSizes=[];
        for(var i=0; i<oTechnicalSheetSizes.length; i++)
        {
            if(i==(SelectedRowIndex-1))
            {
                oTempTechnicalSheetSizes[i]=oTechnicalSheetSizes[i+1];
            }
            else if(i==SelectedRowIndex)
            {
                oTempTechnicalSheetSizes[i]=oTechnicalSheetSizes[i-1];
            }
            else
            {
                oTempTechnicalSheetSizes[i]=oTechnicalSheetSizes[i];
            }
            oTempTechnicalSheetSizes[i].Sequence=i+1;
        }

        data = oTempTechnicalSheetSizes;
        data={"total":""+data.length+"","rows":data};
        $('#tblTechnicalSheetSize').datagrid('loadData',data);
        var newSelectedRowIndex=SelectedRowIndex-1;
        $('#tblTechnicalSheetSize').datagrid('selectRow',newSelectedRowIndex);
    });

    $('#btnSizeSequenceDown').click(function(e){
        var oTechnicalSheetSize = $('#tblTechnicalSheetSize').datagrid('getSelected');
        if(oTechnicalSheetSize==null || parseInt(oTechnicalSheetSize.SizeCategoryID)<=0)
        {
            alert("Please select a item from list!");
            return;
        }
        var SelectedRowIndex=$('#tblTechnicalSheetSize').datagrid('getRowIndex',oTechnicalSheetSize);
        var oTempTechnicalSheetSizes = $('#tblTechnicalSheetSize').datagrid('getRows');
        if(SelectedRowIndex==(oTempTechnicalSheetSizes.length-1))return;
        var oTechnicalSheetSizes=[];
        oTechnicalSheetSizes=oTempTechnicalSheetSizes;
        oTempTechnicalSheetSizes=[];
        for(var i=0; i<oTechnicalSheetSizes.length; i++)
        {
            if(i==(SelectedRowIndex+1))
            {
                oTempTechnicalSheetSizes[i]=oTechnicalSheetSizes[i-1];
            }
            else if(i==SelectedRowIndex)
            {
                oTempTechnicalSheetSizes[i]=oTechnicalSheetSizes[i+1];
            }
            else
            {
                oTempTechnicalSheetSizes[i]=oTechnicalSheetSizes[i];
            }
            oTempTechnicalSheetSizes[i].Sequence=i+1;
        }
        data = oTempTechnicalSheetSizes;
        data={"total":""+data.length+"","rows":data};
        $('#tblTechnicalSheetSize').datagrid('loadData',data);
        var newSelectedRowIndex=SelectedRowIndex+1;
        $('#tblTechnicalSheetSize').datagrid('selectRow',newSelectedRowIndex);
    });

    $('#btnSizeSequenceSave').click(function(e){
        var oTechnicalSheetSizeList = [];
        _nMaxSizeSequence = 0;
        var oTechnicalSheetSize = $('#tblTechnicalSheetSize').datagrid('getRows');
        for (var i = 0; i < oTechnicalSheetSize.length; i++)
        {
            _nMaxSizeSequence++;
            var oTSSize = {
                TechnicalSheetSizeID: 0,
                TechnicalSheetID: _oTechnicalSheet.TechnicalSheetID,
                SizeCategoryID: oTechnicalSheetSize[i].SizeCategoryID,
                SizeCategoryName: oTechnicalSheetSize[i].SizeCategoryName,
                QtyInPercent: oTechnicalSheetSize[i].QtyInPercent,
                Sequence: _nMaxSizeSequence
            };
            oTechnicalSheetSizeList.push(oTSSize);
            DynamicRefreshList(oTechnicalSheetSizeList,'tblTSSize');
            $('#divTS').data('TechnicalSheetSizeList',oTechnicalSheetSizeList);
        }
        $("#winSizeSequence").icsWindow('close');

        //$('#txtSizeRange').focus();
    });

    function AddToSizeList(oSizeCategory)
    {
        var oTechnicalSheetSizes = $('#tblTechnicalSheetSize').datagrid('getRows');
        for (var i = 0; i < oTechnicalSheetSizes.length; i++) {
            if (parseInt(oTechnicalSheetSizes[i].SizeCategoryID) === parseInt(oSizeCategory.SizeCategoryID)) {
                alert("Your Selected Size Already Exists!");
                return;
            }
        }
        var oTechnicalSheetSize = {
            TechnicalSheetSizeID: 0,
            TechnicalSheetID: _oTechnicalSheet.TechnicalSheetID,
            SizeCategoryID: oSizeCategory.SizeCategoryID,
            SizeCategoryName: oSizeCategory.SizeCategoryName,
            QtyInPercent:0,
            Sequence:parseInt($('#tblTechnicalSheetSize').datagrid('getRows').length)+1
        };
        $('#tblTechnicalSheetSize').datagrid('appendRow',oTechnicalSheetSize);
    }

    $('#btnNewSize').click(function(e){
        var oSizeCategory={ Param : '' };
        $.ajax({
            type: "POST",
            dataType: "json",
            url : _sBaseAddress+  "/SizeCategory/SearchSize",
            traditional: true,
            data:  JSON.stringify(oSizeCategory),
            contentType: "application/json; charset=utf-8",
            success: function (data) {
                var oSizeCategorys = jQuery.parseJSON(data);
                $('#tblSizeBank').data('SizeCategorys', oSizeCategorys);
                $("#winSizeSequence").icsWindow('open', "Pick Size");
                DynamicRefreshList(oSizeCategorys, 'tblSizeBank');
                var oList = $('#divTS').data('TechnicalSheetSizeList');
                DynamicRefreshList($('#divTS').data('TechnicalSheetSizeList'), 'tblTechnicalSheetSize');
            },
            error: function (xhr, status, error) {
                alert(error);
            }
        });
    });

    $('#btnNewSizeCategory').click(function(e){
        $("#winNewSize").icsWindow('open', "Add Size");
        $("#winNewSize input").not("input[type='button']").val("");
    });

    $('#btnNewSizeSave').click(function(e){
        if($.trim($('#txtNewSizeName').val())===null || $.trim($('#txtNewSizeName').val())==="")
        {
            alert("Please Enter Size Name!");
            return;
        }
        var oSizeCategory= {
            SizeCategoryID : 0,
            SizeCategoryName : $.trim($("#txtNewSizeName").val()),
            Note : $.trim($("#txtNewSizeNote").val())
        };

        $.ajax({
            type: "POST",
            dataType: "json",
            url : _sBaseAddress+  "/SizeCategory/Save",
            traditional: true,
            data:  JSON.stringify(oSizeCategory),
            contentType: "application/json; charset=utf-8",
            success: function (data) {
                oSizeCategory = jQuery.parseJSON(data);
                if (oSizeCategory.ErrorMessage == null || oSizeCategory.ErrorMessage == "") {
                    alert("Data Saved sucessfully");
                    $("#winNewSize").icsWindow('close');
                    var nRowIndex = $('#tblSizeBank').datagrid('getRows').length;
                    $('#tblSizeBank').datagrid('appendRow',oSizeCategory);
                    $('#tblSizeBank').datagrid('selectRow',nRowIndex);
                }
                else {
                    alert(oSizeCategory.ErrorMessage);
                }
            },
            error: function (xhr, status, error) {
                alert(error);
            }
        });
    });

    $('#btnNewSizeClose').click(function(e){
        $("#winNewSize").icsWindow('close');
    });

    $('#txtGSM').keydown(function (e) {
        var code = (e.keyCode ? e.keyCode : e.which);
        if(code==13)//enter
        {
            if($.trim($('#txtGSM').val())==null || $.trim($('#txtGSM').val())=="")
            {
                alert("Type GSM No.");
                return;
            }
            GsmPiker();
        }
        else if (code == 8) //backspace=8
        {
            _oTechnicalSheet.GSMID = 0;
            $("#txtGSM").removeClass("fontColorOfPickItem");

        }
    });

    $('#btnGSMPiker').click(function (e) {
        GsmPiker();
    });

    function GsmPiker()
    {

        var oGSMSearch = {
            SourcingConfigHeadName:$.trim($('#txtGSM').val()),
            SourcingConfigHeadType:2
        };
        var obj = {
            BaseAddress: sessionStorage.getItem('BaseAddress'),
            Object: oGSMSearch,
            ControllerName: "KnitDyeingProgram",
            ActionName: "GSMSearch",
            IsWinClose: false
        };
        $.icsProgressBar(true);
        $.icsDataGets(obj, function (response) {
            $.icsProgressBar(false);
            if (response.status && response.objs.length > 0) {
                if (response.objs[0].SourcingConfigHeadID > 0) {
                    var tblColums = [];
                    var oColumn = { field: "SourcingConfigHeadName", title: "GSM", width:200, align: "left" }; tblColums.push(oColumn);

                    var oPickerParam = {
                        winid: 'winGSM',
                        winclass: 'clsGSM',
                        winwidth: 600,
                        winheight: 460,
                        tableid: 'tblGSM',
                        tablecolumns: tblColums,
                        datalist: response.objs,
                        multiplereturn: false,
                        searchingbyfieldName: 'SourcingConfigHeadName',
                        windowTittle: 'GSM List'
                    };
                    $.icsPicker(oPickerParam);
                    IntializePickerbutton(oPickerParam);
                }
                else {
                    alert(response.objs[0].ErrorMessage);
                }

            } else{
                alert("Data Not Found.");
                return;
            }
        });
    }

    var editTSShipmentIndex = undefined;
    function endEditingTSShipment(){
        if (editTSShipmentIndex == undefined){return true}
        if ($('#tblTSShipment').datagrid('validateRow', editTSShipmentIndex))
        {
            $('#tblTSShipment').datagrid('endEdit', editTSShipmentIndex);
            MakeFooterTSShipment();
            editTSShipmentIndex  = undefined;
            return true;
        }
        else
        {
            return false;
        }
    }
    function onClickRowTSShipment(index){
        if (editTSShipmentIndex != index)
        {

            if (endEditingTSShipment())
            {
                $('#tblTSShipment').datagrid('selectRow', index).datagrid('beginEdit', index);
                editTSShipmentIndex  = index;
            }
            else
            {
                $('#tblTSShipment').datagrid('selectRow', editTSShipmentIndex);
            }
        }
    }
    function LoadAll(oTS) {
        //debugger;
        var listItems = "";
        var oTSSizes = oTS.TechnicalSheetSizes;
        var oGarmentTypes = oTS.GarmentsTypes;
        var oGarmentClasses = oTS.GarmentsClasss;
        var oMesurements = oTS.MeasurementUnits;
    }
    function IntializePickerbutton(oPickerobj) {
        debugger;
        $("#" + oPickerobj.winid).find("#btnOk").click(function () {
            debugger;
            //for Single Select
            SetPickerValueAssign(oPickerobj);
        });
        $(document).find('.' + oPickerobj.winclass).keydown(function (e) {
            if (e.which == 13)//enter=13
            {
                SetPickerValueAssign(oPickerobj);

            }
        });
    }
    function SetPickerValueAssign(oPickerobj)
    {
        var oreturnObj = null, oreturnobjs = [];
        if (oPickerobj.multiplereturn)
        {
            oreturnobjs = $('#'+oPickerobj.tableid).datagrid('getChecked');
        } else {
            oreturnObj = $('#'+oPickerobj.tableid).datagrid('getSelected');
        }
        $("#" + oPickerobj.winid).icsWindow("close");
        $("#" + oPickerobj.winid).remove();

        if (oPickerobj.winid == 'winBuyers') {
            if (oreturnObj != null && oreturnObj.ContractorID > 0) {
                var txtBuyerName = document.getElementById("txtBuyerName");
                txtBuyerName.value = oreturnObj.Name;
                txtBuyerName.style.color = "green";
                txtBuyerName.style.fontWeight = "bold";
                $('#txtBuyerID').val(oreturnObj.ContractorID);
                GetBuyerConcern(oreturnObj.ContractorID);
                GetBrands(oreturnObj.ContractorID);
                $('#txtBuyerName').focus();
            }

        }
        else if (oPickerobj.winid == 'winProductPicker')
        {
            if (oreturnObj != null && oreturnObj.ProductID > 0) {
                _oTechnicalSheet.ProductID = oreturnObj.ProductID;
                document.getElementById('txtProductName').value = oreturnObj.ProductName;

                var txttProductName = document.getElementById("txtProductName");
                txttProductName.style.color = "green";
                txttProductName.style.fontWeight = "bold";
                $('#txtProductName').focus();
            }
        }
        else if (oPickerobj.winid == 'winFabric')
        {
            if (oreturnObj != null && oreturnObj.ProductID > 0)
            {

                //_oTechnicalSheet.YarnCategoryID = oreturnObj.ProductID;

                var oFabrics = $('#tblFabric').datagrid('getRows');
                if(!ICS_IsExist(oFabrics,'YarnID',oreturnObj.ProductID))
                {
                    var oFabric={
                        OrderRecapYarnID: 0,
                        RefObjectID: _oTechnicalSheet.TechnicalSheetID,
                        YarnID :oreturnObj.ProductID,
                        //                        YarnPly = "";
                        Note:'',
                        YarnCode :oreturnObj.ProductCode,
                        YarnName :oreturnObj.ProductName,
                        RefType:1,//TechnicalSheet:1;OrderRecap:2
                        YarnTypeSt:$('#cboFabricType option:selected').text(),
                        YarnType:$('#cboFabricType').val()
                    };
                    $('#tblFabric').datagrid('appendRow',oFabric);
                }
                $('#txtFabric').focus();
            }
        }
        else if (oPickerobj.winid == 'winColorCategory')
        {
            debugger;
            if (oreturnobjs.length > 0)
            {
                // var oTechnicalSheetColorList = [];
                _nMaxColorSequence = $('#tblTSColor').datagrid('getRows').length;
                for (var i = 0; i < oreturnobjs.length; i++)
                {
                    if(!ColorExists(oreturnobjs[i]))
                    {
                        _nMaxColorSequence++;
                        var oTechnicalSheetColor = {
                            TechnicalSheetColorID: 0,
                            TechnicalSheetID: _oTechnicalSheet.TechnicalSheetID,
                            ColorCategoryID: oreturnobjs[i].ColorCategoryID,
                            ColorName: oreturnobjs[i].ColorName,
                            PantonNo:"",
                            Sequence: _nMaxColorSequence
                        };
                        $('#tblTSColor').datagrid('appendRow',oTechnicalSheetColor);
                    }
                }
                //DynamicRefreshList(oTechnicalSheetColorList,'tblTSColor');
                $('#divTS').data('TechnicalSheetColorList',$('#tblTSColor').datagrid('getRows'));
            }

            $('#txtColorRange').focus();
        }
        else if (oPickerobj.winid == 'winSizeCategory')
        {
            if (oPickerobj.multiplereturn)
            {
                if (oreturnobjs.length > 0)
                {
                    _nMaxSizeSequence = $('#tblTSSize').datagrid('getRows').length;
                    var oTechnicalSheetSizeList = [];
                    for (var i = 0; i < oreturnobjs.length; i++)
                    {
                        if (!SizeExists(oreturnobjs[i]))
                        {
                            _nMaxSizeSequence++;
                            var oTSSize = {
                                TechnicalSheetSizeID: 0,
                                TechnicalSheetID: _oTechnicalSheet.TechnicalSheetID,
                                SizeCategoryID: oreturnobjs[i].SizeCategoryID,
                                SizeCategoryName: oreturnobjs[i].SizeCategoryName,
                                QtyInPercent:0,
                                Sequence: _nMaxSizeSequence
                            };
                            $('#tblTSSize').datagrid('appendRow',oTSSize);
                            // oTechnicalSheetSizeList.push(oTSSize);
                        }
                    }
                    $('#divTS').data('TechnicalSheetSizeList',$('#tblTSSize').datagrid('getRows'));
                }
            }
            $('#txtSizeRange').focus();
        }
        else if (oPickerobj.winid == 'winDIF')
        {
            if (oPickerobj.multiplereturn)
            {
                if (oreturnobjs.length > 0)
                {
                    var txtDiagramIdentification = document.getElementById("txtDiagramIdentification");
                    txtDiagramIdentification.value = 'Selected items (' + oreturnobjs.length + ')';
                    txtDiagramIdentification.style.color = "green";
                    txtDiagramIdentification.style.fontWeight = "bold";
                    _oSelectedDiagramidentifications = oreturnobjs;
                }
            }
            else
            {
                var txtDiagramIdentification = document.getElementById("txtDiagramIdentification");
                txtDiagramIdentification.value = oreturnObj.PointName;
                txtDiagramIdentification.style.color = "green";
                txtDiagramIdentification.style.fontWeight = "bold";
                _oSelectedDiagramidentifications.push(oreturnObj);
            }
            $('#txtDiagramIdentification').focus();
        } else if(oPickerobj.winid == 'winGSM')
        {
            _oTechnicalSheet.GSMID = parseInt(oreturnObj.SourcingConfigHeadID);
            $('#txtGSM').val(oreturnObj.SourcingConfigHeadName);
            $("#txtGSM").addClass("fontColorOfPickItem");
            $('#txtGG').focus();
        }
    }

    //Measurement Spec part  Start
    $("#txtDiagramIdentification").keydown(function (e) {
        debugger;
        var code = (e.keyCode ? e.keyCode : e.which);
        if (code == 13) // Enter Press
        {
            var txtDiagramIdentification = document.getElementById('txtDiagramIdentification').value;
            var oDiagramIdentification = { Param: txtDiagramIdentification };
            var obj = {
                BaseAddress: _sBaseAddress,
                Object: oDiagramIdentification,
                ControllerName: "DiagramIdentification",
                ActionName: "DiagramIdentificationSearch",
                IsWinClose: false
            };
            $.icsDataGets(obj, function (response) {
                debugger;
                if (response.status && response.objs.length > 0) {
                    if (response.objs[0].DiagramIdentificationID > 0) {
                        debugger;
                        var tblColums = []; var oColumn = { field: "PointName", title: "Point Name", width: 200, align: "left" }; tblColums.push(oColumn);
                        oColumn = { field: "Note", title: "Note", width: 90, align: "left" }; tblColums.push(oColumn);
                        var oPickerParam = {
                            winid: 'winDIF',
                            winclass: 'clsDIF',
                            winwidth: 600,
                            winheight: 460,
                            tableid: 'tblDIF',
                            tablecolumns: tblColums,
                            datalist: response.objs,
                            multiplereturn: false,
                            searchingbyfieldName: 'PointName',
                            windowTittle: 'Diagram Identification List'
                        };
                        $.icsPicker(oPickerParam);
                        IntializePickerbutton(oPickerParam);
                    }
                    else { alert(response.objs[0].ErrorMessage); }
                }
            });
        }
    });
    $("#btnDiagramIdentification").click(function () {
        var oDiagramIdentification = { Param: '' };
        var obj = {
            BaseAddress: _sBaseAddress,
            Object: oDiagramIdentification,
            ControllerName: "DiagramIdentification",
            ActionName: "DiagramIdentificationSearch",
            IsWinClose: false
        };
        $.icsDataGets(obj, function (response) {
            debugger;
            if (response.status && response.objs.length > 0) {
                if (response.objs[0].DiagramIdentificationID > 0) {
                    debugger;
                    var tblColums = []; var oColumn = { field: "PointName", title: "Point Name", width: 200, align: "left" }; tblColums.push(oColumn);
                    oColumn = { field: "Note", title: "Note", width: 90, align: "left" }; tblColums.push(oColumn);
                    var oPickerParam = {
                        winid: 'winDIF',
                        winclass: 'clsDIF',
                        winwidth: 600,
                        winheight: 460,
                        tableid: 'tblDIF',
                        tablecolumns: tblColums,
                        datalist: response.objs,
                        multiplereturn: true,
                        searchingbyfieldName: 'PointName',
                        windowTittle: 'Diagram Identification List'
                    };
                    $.icsPicker(oPickerParam);
                    IntializePickerbutton(oPickerParam);
                }
                else { alert(response.objs[0].ErrorMessage); }
            }
        });

    });
    $('#txtDiagramIdentification').keydown(function (e) {
        var code = (e.keyCode ? e.keyCode : e.which);
        if (code == 8) //backspace=8
        {
            //debugger;
            var txttBuyerName = document.getElementById("txtDiagramIdentification");
            txttBuyerName.style.color = "black";
            txttBuyerName.style.fontWeight = "normal";
            _oSelectedDiagramidentifications = [];
        }
    });
    function LoadMUnits()
    {
        var listItems ="";
        if (_oMeasurementUnits.length > 0) {
            for (i = 0; i < _oMeasurementUnits.length; i++) {
                listItems += "<option value='" + _oMeasurementUnits[i].MeasurementUnitID + "'>" + _oMeasurementUnits[i].Symbol + "</option>";
            }
            $("#cboUnitType").html(listItems);
            $('#cboUnitType').val(_oTechnicalSheet.MeasurementSpec.MeasurementUnitID);
        }

    }
    function RefreshObjectForMS() {
        var oMSDetails = $('#tblMSD').datagrid('getRows');
        for (var i = 0; i < _oSelectedDiagramidentifications.length; i++) {

            if (!DiagramidentificationsAlreadyExists(_oSelectedDiagramidentifications[i].PointName)) {
                _nMaxDiagramSequence = parseInt(_nMaxDiagramSequence) + 1;
                var oMSDetail = {
                    MeasurementSpecDetailID: 0,
                    POM: '',
                    DescriptionNote: _oSelectedDiagramidentifications[i].PointName,
                    Addition: 0.00,
                    Deduction: 0.00,
                    Sequence: _nMaxDiagramSequence,
                    SizeValue1: 0.00,
                    SizeValue2: 0.00,
                    SizeValue3: 0.00,
                    SizeValue4: 0.00,
                    SizeValue5: 0.00,
                    SizeValue6: 0.00,
                    SizeValue7: 0.00,
                    SizeValue8: 0.00,
                    SizeValue9: 0.00,
                    SizeValue10: 0.00,
                    SizeValue11: 0.00,
                    SizeValue12: 0.00,
                    SizeValue13: 0.00,
                    SizeValue14: 0.00,
                    SizeValue15: 0.00


                };
                oMSDetails.push(oMSDetail);
            }
        }
        return oMSDetails;
    }
    function RefreshMSDetail() {
        //debugger;
        var oTempMeasurementSpecDetails = $('#tblMSD').datagrid('getRows');
        data = oTempMeasurementSpecDetails;
        data = { "total": "" + data.length + "", "rows": data };
        $('#tblMSD').datagrid('loadData', data);
    }
    function RefreshRatio() {
        endEditing();
        if ($('#tblMSD').datagrid('getRows').length <= 0) {
            alert("Please Add at Least One Diagram !");
            return;
        }
        var nSizeLength = $('#divTS').data('TechnicalSheetSizeList').length;
        var nGetRatioValue = 0;
        var nTempSizeLength = 0;
        var nDynamicCount = 0;
        nGetRatioValue = parseFloat(nGetRatioValue);
        var oMSDs = $('#tblMSD').datagrid('getRows');
        for (var i = 0; i < oMSDs.length; i++) {
            //Reset
            nGetRatioValue = oMSDs[i].GetRatio;
            nTempSizeLength = $('#divTS').data('TechnicalSheetSizeList').length;
            nDynamicCount = 0;
            if (nGetRatioValue > 0) {
                var oTempOMSD = oMSDs[i];//Reset OTemp OMSD
                if (parseFloat(oMSDs[i].SizeValue1) > 0) //If get value in 1st Size
                {
                    if (2 <= _oTechnicalSheet.TechnicalSheetSizes.length) { oMSDs[i].SizeValue2 = parseFloat(parseFloat(oMSDs[i].SizeValue1) + parseFloat(1 * parseFloat(nGetRatioValue))); }
                    if (3 <= _oTechnicalSheet.TechnicalSheetSizes.length) { oMSDs[i].SizeValue3 = parseFloat(parseFloat(oMSDs[i].SizeValue1) + parseFloat(2 * parseFloat(nGetRatioValue))); }
                    if (4 <= _oTechnicalSheet.TechnicalSheetSizes.length) { oMSDs[i].SizeValue4 = parseFloat(parseFloat(oMSDs[i].SizeValue1) + parseFloat(3 * parseFloat(nGetRatioValue))); }
                    if (5 <= _oTechnicalSheet.TechnicalSheetSizes.length) { oMSDs[i].SizeValue5 = parseFloat(parseFloat(oMSDs[i].SizeValue1) + parseFloat(4 * parseFloat(nGetRatioValue))); }
                    if (6 <= _oTechnicalSheet.TechnicalSheetSizes.length) { oMSDs[i].SizeValue6 = parseFloat(parseFloat(oMSDs[i].SizeValue1) + parseFloat(5 * parseFloat(nGetRatioValue))); }
                    if (7 <= _oTechnicalSheet.TechnicalSheetSizes.length) { oMSDs[i].SizeValue7 = parseFloat(parseFloat(oMSDs[i].SizeValue1) + parseFloat(6 * parseFloat(nGetRatioValue))); }
                    if (8 <= _oTechnicalSheet.TechnicalSheetSizes.length) { oMSDs[i].SizeValue8 = parseFloat(parseFloat(oMSDs[i].SizeValue1) + parseFloat(7 * parseFloat(nGetRatioValue))); }
                    if (9 <= _oTechnicalSheet.TechnicalSheetSizes.length) { oMSDs[i].SizeValue9 = parseFloat(parseFloat(oMSDs[i].SizeValue1) + parseFloat(8 * parseFloat(nGetRatioValue))); }
                    if (10 <= _oTechnicalSheet.TechnicalSheetSizes.length) { oMSDs[i].SizeValue10 = parseFloat(parseFloat(oMSDs[i].SizeValue1) + parseFloat(9 * parseFloat(nGetRatioValue))); }
                    if (11 <= _oTechnicalSheet.TechnicalSheetSizes.length) { oMSDs[i].SizeValue11 = parseFloat(parseFloat(oMSDs[i].SizeValue1) + parseFloat(10 * parseFloat(nGetRatioValue))); }
                    if (12 <= _oTechnicalSheet.TechnicalSheetSizes.length) { oMSDs[i].SizeValue12 = parseFloat(parseFloat(oMSDs[i].SizeValue1) + parseFloat(11 * parseFloat(nGetRatioValue))); }
                    if (13 <= _oTechnicalSheet.TechnicalSheetSizes.length) { oMSDs[i].SizeValue13 = parseFloat(parseFloat(oMSDs[i].SizeValue1) + parseFloat(12 * parseFloat(nGetRatioValue))); }
                    if (14 <= _oTechnicalSheet.TechnicalSheetSizes.length) { oMSDs[i].SizeValue14 = parseFloat(parseFloat(oMSDs[i].SizeValue1) + parseFloat(13 * parseFloat(nGetRatioValue))); }
                    if (15 <= _oTechnicalSheet.TechnicalSheetSizes.length) { oMSDs[i].SizeValue15 = parseFloat(parseFloat(oMSDs[i].SizeValue1) + parseFloat(14 * parseFloat(nGetRatioValue))); }
                } else if (parseFloat(oTempOMSD['SizeValue' + nSizeLength]) > 0)// for Last Value
                {
                    while (nTempSizeLength > 0) {
                        nTempSizeLength--;
                        nDynamicCount++;
                        oTempOMSD['SizeValue' + nTempSizeLength] = oTempOMSD['SizeValue' + nSizeLength] - parseFloat(nGetRatioValue * parseFloat(nDynamicCount));
                    }
                    oMSDs[i] = oTempOMSD;
                } else //for any Middle Value
                {
                    var nIdentifySizeNumber = FindSizeNumber(oTempOMSD);
                    var nTempFindingSize = nIdentifySizeNumber;
                    while (nTempFindingSize > 0)//for Decriment
                    {
                        nTempFindingSize--;
                        nDynamicCount++;
                        oTempOMSD['SizeValue' + nTempFindingSize] = parseFloat(oTempOMSD['SizeValue' + nIdentifySizeNumber]) - parseFloat(nGetRatioValue * parseFloat(nDynamicCount));
                    }
                    nTempFindingSize = nIdentifySizeNumber;//Reset
                    nDynamicCount = 0;//REset
                    while (nTempFindingSize < nSizeLength) // for Increment
                    {
                        nTempFindingSize++;
                        nDynamicCount++;
                        oTempOMSD['SizeValue' + nTempFindingSize] = parseFloat(oTempOMSD['SizeValue' + nIdentifySizeNumber]) + parseFloat(parseFloat(nGetRatioValue) * parseFloat(nDynamicCount));
                    }
                    oMSDs[i] = oTempOMSD;
                }
            }
        }
        RefreshMeasurementSpecDetails(oMSDs);
    }


    var editIndex = undefined;
    function endEditing() {
        if (editIndex == undefined) { return true }
        if ($('#tblMSD').datagrid('validateRow', editIndex)) {
            $('#tblMSD').datagrid('endEdit', editIndex);
            editIndex = undefined;
            return true;
        } else {
            return false;
        }
    }
    function onClickRow(index) {
        //debugger;
        if (editIndex != index) {
            if (endEditing()) {
                $('#tblMSD').datagrid('selectRow', index)
                        .datagrid('beginEdit', index);
                editIndex = index;
            } else {
                $('#tblMSD').datagrid('selectRow', editIndex);
            }
        }
    }
    function RefreshMeasurementSpecDetails(oTempMeasurementSpecDetails) {
        data = oTempMeasurementSpecDetails;
        data = { "total": "" + data.length + "", "rows": data };
        $('#tblMSD').datagrid('loadData', data);
        $('#tblMSD').datagrid({ selectOnCheck: false, checkOnSelect: false })
    }


    function AddMSDetail() {

        //debugger;
        if (!ValidateInputFORMS()) return;
        _oTempMeasurementSpecDetails = RefreshObjectForMS();
        RefreshMeasurementSpecDetails(_oTempMeasurementSpecDetails);
        $("#txtDiagramIdentification")[0].value = '';
        _oSelectedDiagramidentifications = [];

    }
    function DeleteMSDetail() {
        //debugger;
        var oMSDetail = $('#tblMSD').datagrid('getSelected');
        if (!confirm("Confirm to Delete?")) return;
        if (oMSDetail == null || oMSDetail.DescriptionNote == "") {
            alert("Invalid Selection!!! please select a valid Item!");
            return false;
        }
        var SelectedRowIndex = $('#tblMSD').datagrid('getRowIndex', oMSDetail);
        $('#tblMSD').datagrid('deleteRow', SelectedRowIndex);
        $('#tblMSD').datagrid({ selectOnCheck: false, checkOnSelect: false })
    }
    function PickOtherStyle() {
        var oParameter = new Object();
        oParameter.MultipleItemReturn = false;
        oParameter.Name = "";
        var url = _sBaseAddress + "/SaleOrder/StyleSearchPicker";
        var oSelectedStyle = window.showModalDialog(url, oParameter, 'dialogHeight:525px;dialogWidth:663px;dialogLeft:355;dialogTop:50;center:yes;resizable:yes;status:no;scroll:no');//window.showModalDialog(url, oParameter, 'dialogHeight:550px;dialogWidth:655px;dialogLeft:400;dialogTop:100;center:yes;resizable:no;status:no;scroll:no');
        debugger;
        if (oSelectedStyle != null) {
            if (parseInt(oSelectedStyle.TechnicalSheetID) > 0) {
                var tsv = (new Date().getTime()) / 1000;
                $.ajax({
                    type: "GET",
                    dataType: "json",
                    url: _sBaseAddress + "/TechnicalSheet/GetMeasermentSpecDetails",
                    data: { id: oSelectedStyle.TechnicalSheetID, ts: tsv },
                    contentType: "application/json; charset=utf-8",
                    success: function (data) {
                        //debugger;
                        var oTechnicalSheet = jQuery.parseJSON(data);
                        if (oTechnicalSheet.TempMeasurementSpecDetails.length > 0) {
                            //_oTechnicalSheetSizeList = oTechnicalSheet.TechnicalSheetSizes;
                            $('#divTS').data('TechnicalSheetSizeList', oTechnicalSheet.TechnicalSheetSizes);
                            MakeMSTable(oTechnicalSheet.TechnicalSheetSizes);
                            RefreshMeasurementSpecDetails(oTechnicalSheet.TempMeasurementSpecDetails);
                        } else {
                            MakeMSTable([]);
                            RefreshMeasurementSpecDetails([]);
                        }
                    },
                    error: function (xhr, status, error) {
                        alert(error);
                    }
                });
            }
        }

    }

    function DiagramidentificationsAlreadyExists(sPontName) {
        var oMSDetails = $('#tblMSD').datagrid('getRows');
        for (var i = 0; i < oMSDetails.length; i++) {
            if (oMSDetails[i].DescriptionNote == sPontName) {
                return true;
            }
        }
        return false;
    }

    function ValidateInputFORMS() {
        //debugger;
        if (_oTechnicalSheet.TechnicalSheetID <= 0) {
            alert("Please first of all save Technical Sheet!");
            return false;
        }
        if (_oSelectedDiagramidentifications == null || _oSelectedDiagramidentifications.length <= 0) {
            alert("There is no diagram selected!");
            $('#txtPOM').focus();
            return false;
        }
        return true;
    }

    function MSValidateInput() {

        var oMSDetails = $('#tblMSD').datagrid('getRows');
        var oTestMSDetails = $('#tblMSD').datagrid('getRows');
        for (var i = 0; i < oMSDetails.length; i++) {
            if (oMSDetails[i].POM == "") {
                alert("Type SL No for ' " + oMSDetails[i].DescriptionNote + " '");
                return;
            }
        }
        for (var i = 0; i < oMSDetails.length; i++) {
            for (var j = i + 1; j < oTestMSDetails.length; j++) {
                if (oMSDetails[i].POM == oTestMSDetails[j].POM) {
                    alert("Duplicate SL NO Not Allowed for ' " + oTestMSDetails[j].DescriptionNote + " '");
                    return;
                }
            }
        }
        return true;
    }

    function MSRefreshObject() {

        var oMSDetails = $('#tblMSD').datagrid('getRows');
        var oMeasurementSpec = {
            MeasurementSpecID: _oTechnicalSheet.MeasurementSpecID,
            TechnicalSheetID: _oTechnicalSheet.TechnicalSheetID,
            MeasurementUnitID: $('#cboUnitType').val(),
            TempMeasurementSpecDetails: oMSDetails,
            TechnicalSheetSizes: $('#divTS').data('TechnicalSheetSizeList')
        }


        return oMeasurementSpec;
    }

    function CommitMeasurementSpecification() {

        //debugger;
        endEditing();
        if (!MSValidateInput()) return;
        var oMeasurementSoec = MSRefreshObject();

        $.ajax({
            type: "POST",
            dataType: "json",
            url: _sBaseAddress + "/TechnicalSheet/CommitMeasurementSpece",
            traditional: true,
            data: JSON.stringify(oMeasurementSoec),
            contentType: "application/json; charset=utf-8",
            success: function (data) {
                // //debugger;
                oMeasurementSoec = jQuery.parseJSON(data);
                if (oMeasurementSoec.MeasurementSpecID > 0) {
                    _oTechnicalSheet.MeasurementSpecID = oMeasurementSoec.MeasurementSpecID;
                    alert("Data Saved sucessfully");
                }
                else {
                    alert(oMeasurementSoec.ErrorMessage);
                }
            },
            error: function (xhr, status, error) {
                alert(error);
            }

        });
    }


    function FindSizeNumber(oTempOMSD) {

        if (parseFloat(oTempOMSD.SizeValue2) > 0) {
            return 2;
        } else if (parseFloat(oTempOMSD.SizeValue3) > 0) {
            return 3;
        } else if (parseFloat(oTempOMSD.SizeValue4) > 0) {
            return 4;
        } else if (parseFloat(oTempOMSD.SizeValue5) > 0) {
            return 5;
        } else if (parseFloat(oTempOMSD.SizeValue6) > 0) {
            return 6;
        } else if (parseFloat(oTempOMSD.SizeValue7) > 0) {
            return 7;
        } else if (parseFloat(oTempOMSD.SizeValue8) > 0) {
            return 8;
        } else if (parseFloat(oTempOMSD.SizeValue9) > 0) {
            return 9;
        } else if (parseFloat(oTempOMSD.SizeValue10) > 0) {
            return 10;
        } else if (parseFloat(oTempOMSD.SizeValue11) > 0) {
            return 11;
        } else if (parseFloat(oTempOMSD.SizeValue12) > 0) {
            return 12;
        } else if (parseFloat(oTempOMSD.SizeValue13) > 0) {
            return 13;
        } else if (parseFloat(oTempOMSD.SizeValue14) > 0) {
            return 14;
        }

    }


    function GetMeasurementSpecDetail(nTechnicalSheetID) {
        //  debugger;

        $.ajax
          ({
              type: "GET",
              dataType: "json",
              url: _sBaseAddress + "/TechnicalSheet/GetTechnicalSheetSizes",
              data: { id: nTechnicalSheetID },
              contentType: "application/json; charset=utf-8",
              success: function (data) {
                  //debugger;
                  var oTS = jQuery.parseJSON(data);
                  if (oTS != null) {
                      var oTSSizes = oTS.TechnicalSheetSizes;
                      _oTechnicalSheet.TechnicalSheetSizes = oTS.TechnicalSheetSizes;
                      LoadAll(oTS);
                      if (oTSSizes.length > 0) {
                          MakeMSTable(oTSSizes);

                      }

                  }

              },
              error: function (xhr, status, error) {
                  alert(error);
              }

          });


    }

    function MakeMSTable(oTSSizes) {
        var tblColums = [];
        var oColumn = null;
        oColumn = { field: "POM", title: "SL No", width: "60", editor: { type: 'text' } };
        tblColums.push(oColumn);
        oColumn = { field: "DescriptionNote", title: "Description Note", width: "200" };
        tblColums.push(oColumn);
        oColumn = { field: "Deduction", title: "Tol(-)", width: "50", align: "right", editor: { type: 'numberbox', options: { precision: 2 } } };
        tblColums.push(oColumn);
        oColumn = { field: "Addition", title: "Tol(+)", width: "50", align: "right", editor: { type: 'numberbox', options: { precision: 2 } } };
        tblColums.push(oColumn);
        oColumn = { field: "GetRatio", title: "Get Ratio", width: "60", align: "right", editor: { type: 'numberbox', options: { precision: 2 } } };
        tblColums.push(oColumn);
        var count = 0;
        for (var i = 0; i < oTSSizes.length; i++) {
            count++;
            oColumn = {
                field: "SizeValue" + count,
                title: oTSSizes[i].SizeCategoryName,
                width: "50",
                align: "right",
                editor: { type: 'numberbox', options: { precision: 2 } },
                formatter: function (value, row, index) { return ValueFormat(value); }
            };
            tblColums.push(oColumn);
        }
        $('#tblMSD').datagrid({ columns: [tblColums] });
    }
    function UPDiagram() {
        //debugger;
        var oMeasermentSpecDetail = $('#tblMSD').datagrid('getSelected');
        if (oMeasermentSpecDetail == null || parseInt(oMeasermentSpecDetail.DiagramIdentificationID) <= 0) {
            alert("Please select Diagram");
            return;
        }

        var SelectedRowIndex = $('#tblMSD').datagrid('getRowIndex', oMeasermentSpecDetail);
        if (SelectedRowIndex == 0) return;
        var oMSDs = [];
        oMSDs = _oTempMeasurementSpecDetails;
        _oTempMeasurementSpecDetails = [];
        for (var i = 0; i < oMSDs.length; i++) {
            if (i == (SelectedRowIndex - 1)) {
                _oTempMeasurementSpecDetails[i] = oMSDs[i + 1];
            }
            else if (i == SelectedRowIndex) {
                _oTempMeasurementSpecDetails[i] = oMSDs[i - 1];
            }
            else {
                _oTempMeasurementSpecDetails[i] = oMSDs[i];
            }
            _oTempMeasurementSpecDetails[i].Sequence = i + 1;
        }
        data = _oTempMeasurementSpecDetails;
        data = { "total": "" + data.length + "", "rows": data };
        $('#tblMSD').datagrid('loadData', data);
        var newSelectedRowIndex = SelectedRowIndex - 1;
        $('#tblMSD').datagrid('selectRow', newSelectedRowIndex);

    }

    function DownDiagram() {
        //  debugger;
        var oMeasermentSpecDetail = $('#tblMSD').datagrid('getSelected');
        if (oMeasermentSpecDetail == null || parseInt(oMeasermentSpecDetail.DiagramIdentificationID) <= 0) {
            alert("Please select Diagram");
            return;
        }

        var SelectedRowIndex = $('#tblMSD').datagrid('getRowIndex', oMeasermentSpecDetail);
        if (SelectedRowIndex == (_oTempMeasurementSpecDetails.length - 1)) return;
        var oMSDs = [];
        oMSDs = _oTempMeasurementSpecDetails;
        _oTempMeasurementSpecDetails = [];
        for (var i = 0; i < oMSDs.length; i++) {
            if (i == (SelectedRowIndex + 1)) {
                _oTempMeasurementSpecDetails[i] = oMSDs[i - 1];
            }
            else if (i == SelectedRowIndex) {
                _oTempMeasurementSpecDetails[i] = oMSDs[i + 1];
            }
            else {
                _oTempMeasurementSpecDetails[i] = oMSDs[i];
            }
            _oTempMeasurementSpecDetails[i].Sequence = i + 1;
        }
        data = _oTempMeasurementSpecDetails;
        data = { "total": "" + data.length + "", "rows": data };
        $('#tblMSD').datagrid('loadData', data);
        var newSelectedRowIndex = SelectedRowIndex + 1;
        $('#tblMSD').datagrid('selectRow', newSelectedRowIndex);
    }


    //Measuremet Spec Part End


    function CreateDevelopmentRecap()
    {
        if(parseInt(_oTechnicalSheet.TechnicalSheetID)<=0)
        {alert("Please Add TechnicalSheet First Then Create Development Recap");return}
        var oParameter = new Object();
        sessionStorage.setItem("TSID", _oTechnicalSheet.TechnicalSheetID);
        window.location.href = _sBaseAddress+ "/DevelopmentRecap/ViewDevelopmentRecaps?nTSID="+_oTechnicalSheet.TechnicalSheetID+"&buid="+sessionStorage.getItem("BUID")+"&menuid=0";
    }

    function CreateOrderRecap()
    {
        if (!confirm("Create Order Recap?")) return ;
        if(_oTechnicalSheet.TechnicalSheetID<=0)
        {
            alert("Please Add TechnicalSheet First Then Create Order Recap");
            return;
        }
        var RecapHeader = "Edit Order Recap";
        var tsv=((new Date()).getTime())/1000;
        sessionStorage.setItem("SaleOrders", JSON.stringify([]));
        sessionStorage.setItem("SelectedRowIndex", -1);
        sessionStorage.setItem("RecapHeader", RecapHeader);
        var oBackLink = window.location.href;
        sessionStorage.setItem("OT", 1);
        sessionStorage.setItem("BackLink", oBackLink);
        window.location.href =_sBaseAddress+ "/OrderRecap/ViewOrderRecap?id=0&OT=1&TSID="+_oTechnicalSheet.TechnicalSheetID+"&buid="+sessionStorage.getItem("BUID")+"&ts="+tsv;
    }
    function CreateLabdipOrder()
    {

        if(_oTechnicalSheet.TechnicalSheetID<=0)
        {alert("Please Add TechnicalSheet First Then Create La bdip Order");return}
        var oParameter = new Object();
        oParameter.Name = "Lab Dip Order List for '"+_oTechnicalSheet.StyleNo+"'";
        oParameter.TechnicalSheetID = _oTechnicalSheet.TechnicalSheetID;
        oParameter.BuyerName = _oTechnicalSheet.BuyerName;
        var tsv=((new Date()).getTime())/1000;
        var url =_sBaseAddress+ "/LabDipOrder/ViewTSLabDipOrders?id="+_oTechnicalSheet.TechnicalSheetID+"&ts="+tsv;
        var oLabDipOrder = window.showModalDialog(url, oParameter, 'dialogHeight:450px;dialogWidth:950px;dialogLeft:290;dialogTop:100;center:yes;resizable:no;status:no;scroll:no');
        if(oLabDipOrder!=null)
        {
            if(oLabDipOrder.IsPrint==true)
            {
                window.Close();
            }
        }

    }

    function CreateDyeingOder()
    {

        if(_oTechnicalSheet.TechnicalSheetID<=0)
        {alert("Please Add TechnicalSheet First Then Create Dyeing  Order");return;}
        var oParameter = new Object();
        oParameter.TechnicalSheetID = parseInt(_oTechnicalSheet.TechnicalSheetID);
        var tsv=((new Date()).getTime())/1000;
        var url =_sBaseAddress+ "/DyeingOrder/ViewTSDyeingOrders?id="+parseInt(_oTechnicalSheet.TechnicalSheetID)+"&ts="+tsv;
        var oDyeingOrder = window.showModalDialog(url, oParameter, 'dialogHeight:440px;dialogWidth:885x;dialogLeft:300;dialogTop:80;center:yes;resizable:yes;status:no;scroll:no');
        if(oDyeingOrder!=null || oDyeingOrder!="")
        {
            if(oDyeingOrder.IsPrint==true)
            {
                window.Close();
            }
        }
    }


    function CreateWorkOrder()
    {

        if(_oTechnicalSheet.TechnicalSheetID<=0)
        {alert("Please Add TechnicalSheet First Then Create Supply  Order");return;}
        var oParameter = new Object();
        oParameter.Name = "Add Supply Order";
        oParameter.TechnicalSheetID = parseInt(_oTechnicalSheet.TechnicalSheetID);
        var tsv=((new Date()).getTime())/1000;
        var url =_sBaseAddress+ "/WorkOrder/ViewTSWorkOrderIssue?id="+parseInt(_oTechnicalSheet.TechnicalSheetID)+"&ts="+tsv;
        var oWorkOrder = window.showModalDialog(url, oParameter, 'dialogHeight:435px;dialogWidth:925x;dialogLeft:250;dialogTop:100;center:yes;resizable:yes;status:no;scroll:no');
        if(oWorkOrder!=null || oWorkOrder!="")
        {
            if(oWorkOrder.IsPrint==true)
            {
                window.Close();
            }
        }
    }


    function UploadDesignsketches()
    {
        //debugger;

        if(_oTechnicalSheet.TechnicalSheetID<=0)
        {
            alert("Please Save TechnicalSheet First then Up Image");
            return;
        }
        sessionStorage.setItem("TSHeader", _oTechnicalSheet.StyleNo);
        sessionStorage.setItem("EntryFromTSList", false);
        window.open(_sBaseAddress+ "/TechnicalSheet/ImageHelper?id="+_oTechnicalSheet.TechnicalSheetID,'_blank');
    }


    function Attchment() {
        debugger;
        if(_oTechnicalSheet==null || parseInt(_oTechnicalSheet.TechnicalSheetID)<=0)
        {
            alert("Invalid Technical Sheet!");
            return;
        }
        var tsv= ((new Date()).getTime())/1000;
        window.open( _sBaseAddress+  "/TechnicalSheet/Attachment?id="+parseInt(_oTechnicalSheet.TechnicalSheetID)+"&bIsMeasurmentSpecAttachment=true&ts="+tsv,'_blank');;
    }

    function DesignAttchment() {
        debugger;
        if(_oTechnicalSheet==null || parseInt(_oTechnicalSheet.TechnicalSheetID)<=0)
        {
            alert("Invalid Technical Sheet!");
            return;
        }

        var oParameter = new Object();
        oParameter.Name = "Design and Sketches Attachment";
        var tsv= ((new Date()).getTime())/1000;
        var url =_sBaseAddress+  "/TechnicalSheet/Attachment?id="+parseInt(_oTechnicalSheet.TechnicalSheetID)+"&bIsMeasurmentSpecAttachment=false&ts="+tsv;
        window.showModalDialog(url, oParameter, 'dialogHeight:445px;dialogWidth:700px;dialogLeft:350;dialogTop:70;center:yes;resizable:no;status:no;scroll:no');
    }
    function ValueFormat(val)
    {
        return parseFloat(val).toFixed(2);
    }


    function ChangeImage(nTechnicalSheetImageID)
    {
        //debugger;
        var oParameter = new Object();
        var url =_sBaseAddress+ "/TechnicalSheet/GetViewImage?id="+nTechnicalSheetImageID;
        var oTechnicalSheetImage = window.showModalDialog(url, oParameter, 'dialogHeight:600px;dialogWidth:420px;dialogLeft:300;dialogTop:65;center:yes;resizable:no;status:no;scroll:no');
    }


    function Close()
    {
        if(sessionStorage.getItem("BackLink")=="" || sessionStorage.getItem("BackLink")==null)
        {
            window.close();
        }else
        {
            window.location.href = sessionStorage.getItem("BackLink");
        }
    }



    var editICIndex = undefined;
    function endEditingIC(){
        if (editICIndex == undefined){return true}
        if ($('#tblImageComments').datagrid('validateRow', editICIndex)){

            $('#tblImageComments').datagrid('endEdit', editICIndex);
            editICIndex  = undefined;
            return true;
        }
        else
        {
            return false;
        }
    }

    function onClickRowIC(index){
        if (editICIndex != index){
            if (endEditingIC())
            {
                $('#tblImageComments').datagrid('selectRow', index)
                        .datagrid('beginEdit', index);
                editICIndex  = index;
            }
            else
            {
                $('#tblImageComments').datagrid('selectRow', editICIndex);
            }
        }
    }


    function AddComments()
    {
        if(_oTechnicalSheet==null || parseInt(_oTechnicalSheet.TechnicalSheetID)<=0)
        {
            alert("Please first off all save Technical Sheet!");
            return;
        }

        var oImageComment = {
            ImageCommentID : 0,
            TechnicalSheetID : parseInt(_oTechnicalSheet.TechnicalSheetID),
            Comments : ""

        };

        var oImageComments= $('#tblImageComments').datagrid('getRows');
        var nIndex=oImageComments.length;

        $('#tblImageComments').datagrid('appendRow',oImageComment);
        $('#tblImageComments').datagrid('selectRow', nIndex);
    }


    function RemoveComments()
    {
        var oImageComment= $('#tblImageComments').datagrid('getSelected');
        if(oImageComment==null || parseInt(oImageComment.TechnicalSheetID)<=0)
        {
            alert("Invalid Comments!!! please select a valid Comments!");
            return false;
        }
        if (!confirm("Confirm to Delete?")) return ;
        var SelectedRowIndex=$('#tblImageComments').datagrid('getRowIndex',oImageComment);
        $('#tblImageComments').datagrid('deleteRow',SelectedRowIndex);
    }


    function RefreshListIC(oImageComments)
    {
        data=oImageComments;
        data={"total":""+data.length+"","rows":data};
        $('#tblImageComments').datagrid('loadData',data);
    }



    function RefreshComments()
    {
        endEditingIC();
        var oImageComments= $('#tblImageComments').datagrid('getRows');
        data=oImageComments;
        data={"total":""+data.length+"","rows":data};
        $('#tblImageComments').datagrid('loadData',data);
    }


    function SaveComments()
    {
        endEditingIC();
        var oImageComments= $('#tblImageComments').datagrid('getRows');

        if(oImageComments.length<=0)
        {
            alert("Please enter atleast one Comments!");
            return;
        }

        var oTechnicalSheet = {
            TechnicalSheetID : parseInt(_oTechnicalSheet.TechnicalSheetID),
            ImageComments : oImageComments
        };
        $.icsProgressBar(true);
        $.ajax({
            type: "POST",
            dataType: "json",
            url : _sBaseAddress+  "/TechnicalSheet/SaveImageCommets",
            traditional: true,
            data:  JSON.stringify(oTechnicalSheet),
            contentType: "application/json; charset=utf-8",
            success: function (data) {
                //debugger;
                $.icsProgressBar(false);
                var oTempImageCommets = jQuery.parseJSON(data);
                if (oTempImageCommets!=null)
                {
                    if(oTempImageCommets.length>0)
                    {
                        if(oTempImageCommets[0].ErrorMessage=="")
                        {
                            alert("Data Save Successfully.");
                        }
                        else
                        {
                            alert(oTempImageCommets[0].ErrorMessage);
                        }
                    }
                    else
                    {
                        alert("Invalid Operation!");
                    }
                }
                else {
                    alert("Invalid Operation!");
                }
            },
            error: function (xhr, status, error) {
                alert(error);
            }

        });
    }

    $(document).keydown(function(e) {
        //debugger;
        if(e.which == 27)//escape=27
        {
            window.location.href = sessionStorage.getItem("BackLink");

        }
    });




</script>