<html>
<head>
    @{
        ViewBag.Title = "Production Request";
    }
</head>
<body>
    @model ESimSol.BusinessObjects.FabricSalesContract
    <div id="progressbarParent" style="width:100%;height:100%;margin:0 auto;text-align:center; margin-left: auto;margin-right: auto;left: 0;right: 0;z-index: 1;">
        <div style="margin: 0px auto;margin-top: 251px;text-align:center;width:390px;">
            <label style="font-size:18px;">Please wait</label>
            <div id="progressbar" style="width:100%;height:37px;"></div>
        </div>
    </div>

    <div class="menuMainCollectionTable">
        <div class="easyui-panel" title="" style="font-family:Tahoma; text-align:center; width:100%; height:100%;">
            <div id="tabFSC" class="easyui-tabs" style="width:100%;">
                <div title="Fabric Info" style="width:100%;">
                    <div>
                        <fieldset>
                            <legend style="font-weight:bold"> PO Information : </legend>
                            <table style="width:100%;" border="0" cellspacing="1" cellpadding="1">
                                <tr>
                                    <td style="width:10%; text-align:right;font-weight:bold">
                                        Order Type:
                                    </td>
                                    <td style="width:15%">
                                        <select id="cboOrderType" onchange="ChangeOrderType(true)" style=" width:95%;"></select>
                                    </td>
                                    <td style="width:35%;text-align:left">
                                        <table border="0" cellpadding="0" cellspacing="0" style="width:100%;text-align:left">
                                            <tr>
                                                <td style="width:22%"><input type="checkbox" id="chkIsInHouseYes" onclick="if(this.checked){IsInHouseYes()}else{IsInHouseNo()}" />InHouse </td>
                                                <td style="width:28%;text-align:left"><input type="checkbox" id="chkIsInHouseNo" onclick="if(this.checked){IsInHouseNo()}else{IsInHouseYes()}" />SubContract</td>
                                                <td style="width:25%;text-align:left">Is Print?<input type="checkbox" id="chkIsPrint"/></td>
                                                <td style="width:25%;text-align:left">Is Open PI?<input type="checkbox" id="chkIsOpenPI" onclick="if(this.checked){IsInOpenPIYes()}else{IsInOpenPINo()}" /></td>
                                            </tr>
                                        </table>

                                    </td>
                                    <td style="width:10%; text-align:right;font-weight:bold">
                                        PO No:
                                    </td>
                                    <td style="width:15%">
                                        @*<input type="text" style="width:20%;" id="txtSCNoOrderType" />*@
                                        <select id="txtSCNoOrderType" style=" width:30%;"></select>
                                        <input type="text" style="width:65%;" id="txtSCNo" placeholder="Auto Generated" />
                                    </td>
                                    <td style="width:5%; text-align:right;font-weight:bold">
                                        Date:
                                    </td>
                                    <td style="width:10%">
                                        <input type="text" style="width:100%;" id="txtSCDate" class="easyui-datebox" required="required" data-options="formatter:icsdateformat,parser:icsdateparser" />
                                    </td>
                                </tr>
                                <tr>
                                    <td style="width:10%; text-align:right;font-weight:bold">
                                        <span class="lblOrderType"></span>
                                    </td>
                                    <td colspan="2" style="width:50%;text-align:left">
                                        <table border="0" cellpadding="0" cellspacing="0" style="width:100%">
                                            <tr>
                                                <td style="width:32%"><input type="text" id="txtContractorName" type="text" class="reset-text" style="width:100%" placeholder="Type & Press Enter" /></td>
                                                <td style="width:6%;text-align:right;"><a id="btnPickContractor" href="javascript:void(0)" class="easyui-linkbutton ics-pick" iconcls="icon-pick" plain="true"></a></td>
                                                <td style="width:6%;text-align:right;"><a id="btnClrContractor" href="javascript:void(0)" class="easyui-linkbutton ics-pick" iconcls="icon-clear" plain="true"></a></td>
                                                <td style="width:14%;text-align:right;"><label>C. Person:</label></td>
                                                <td style="width:30%"><select id="cboContractorContactPerson" style=" width:100%;"></select></td>
                                                <td style="width:12%;text-align:right;float:left;padding-left:15px;"><a id="btnAddContractorContactPerson" href="javascript:void(0)" class="easyui-linkbutton" onclick="AddContactPerson(true)" iconcls="icon-pick" plain="true"></a></td>
                                            </tr>
                                        </table>
                                    </td>
                                    <td style="width:10%; text-align:right;font-weight:bold">
                                        PI No:
                                    </td>
                                    <td colspan="3" style="width:30%">
                                        <input type="text" style="width:100%;" id="txtPINo" />
                                    </td>

                                </tr>
                                <tr id="rtHandLoom">

                                    <td style="width:10%; text-align:right;font-weight:bold">
                                        Buying House :
                                    </td>
                                    <td colspan="2" style="width:50%;text-align:left">
                                        <table id="tblBuyingHouse" border="0" cellpadding="0" cellspacing="0" style="width:100%">
                                            <tr>
                                                <td style="width:32%"><input type="text" id="txtBuyingHouse" class="reset-text" style="width:100%" placeholder="Type & Press Enter" /></td>
                                                <td style="width:6%;text-align:right;"><a id="btnPickBuyingHouse" href="javascript:void(0)" class="easyui-linkbutton ics-pick" iconcls="icon-pick" plain="true"></a></td>
                                                <td style="width:6%;text-align:right;"><a id="btnClrBuyingHouse" href="javascript:void(0)" class="easyui-linkbutton ics-pick" iconcls="icon-clear" plain="true"></a></td>
                                                <td style="width:14%;text-align:right;"><label>C. Person:</label> </td>
                                                <td style="width:30%"><select id="cboBuyerContactPerson" style=" width:100%;"></select></td>
                                                <td style="width:12%;text-align:right;float:left;padding-left:15px;"><a id="btnAddContractorContactPerson" href="javascript:void(0)" class="easyui-linkbutton" onclick="AddContactPerson(false)" iconcls="icon-pick" plain="true"></a></td>
                                            </tr>
                                        </table>

                                    </td>
                                    <td style="width:10%; text-align:right;font-weight:bold">
                                        Currency:
                                    </td>
                                    <td style="width:15%">
                                        <select id="cboCurrency" style=" width:100%;"></select>
                                    </td>
                                    <td style="width:5%; text-align:right;font-weight:bold"></td>
                                    <td style="width:10%"></td>

                                </tr>
                                
                                <tr>
                                    <td style="width:10%; text-align:right;font-weight:bold">
                                        Mkt Account:
                                    </td>
                                    <td colspan="2" style="width:50%;text-align:left">
                                        <table id="tblBuyingHouse" border="0" cellpadding="0" cellspacing="0" style="width:100%">
                                            <tr>
                                                <td style="width:32%"><input type="text" id="txtMktAccount" class="reset-text" style="width:100%" placeholder="Search Concern Person" /></td>
                                                <td style="width:6%;text-align:right;"><a id="btnPickMktAccount" href="javascript:void(0)" class="easyui-linkbutton ics-pick" iconcls="icon-pick" plain="true"></a></td>
                                                <td style="width:6%;text-align:right;"><a id="btnResetMktPerson" href="javascript:void(0)" class="easyui-linkbutton ics-pick" iconcls="icon-clear" plain="true"></a></td>
                                                <td style="width:14%;text-align:right;"><label>Mkt.Group:</label> </td>
                                                <td style="width:30%"><input type="text" id="txtMktGroup" class="reset-text" style="width:100%" placeholder="Search Concern Person" /></td>
                                                <td style="width:12%;text-align:right;">
                                                    <a id="btnPickMktGroup" href="javascript:void(0)" class="easyui-linkbutton ics-pick" iconcls="icon-pick" plain="true"></a>
                                                    <a id="btnResetMktGroup" href="javascript:void(0)" class="easyui-linkbutton ics-pick" iconcls="icon-clear" plain="true"></a>
                                                </td>
                                            </tr>
                                        </table>

                                    </td>
                                    <td style="width:10%; text-align:right;font-weight:bold">
                                        Remarks:
                                    </td>
                                    <td colspan="3" style="width:30%">
                                        <input type="text" style="width:100%;" id="txtNote" placeholder="Note" />
                                    </td>
                                </tr>

                                <tr style="height:50px" id="rtIncreaseHide">
                                    <td colspan="6"></td>
                                </tr>
                            </table>
                        </fieldset>
                    </div>
                    <div id="divFSCDetail" style="margin-left:0px; margin-top:0px">
                        <table id="tblFSCDetails" title="Fabric Description" class="easyui-datagrid" style="width:100%;height:250px;" fitcolumns="false" rownumbers="true" pagination="false" singleselect="true" autorowheight="false" toolbar="#toolbarOne" data-options="onClickRow: onClickRow">
                            <thead>
                                <tr>
                                    <th field="IsProductionSt" width="6%" align="left">Is Production</th>
                                    <th field="ProductName" width="12%" align="left">Composition</th>
                                    <th field="FabricNo" width="10%" align="left">Mkt. Ref. No</th>
                                    <th field="Construction" width="10%">Construction</th>
                                    <th field="FabricWidth" width="10%">Fabric Width</th>
                                    <th data-options="field:'Size',width:150,height:60 ,align:'Left',editor:{type:'text'}" align="Left">Size</th>
                                    <th data-options="field:'Qty',width:100,align:'right',editor:{type:'numberbox',options:{precision:4}}" align="right">Qty(Y)</th>
                                    @*<th field="MUName" width="70" align="left">Unit</th>*@
                                    <th data-options="field:'UnitPrice',width:100,align:'right',editor:{type:'numberbox',options:{precision:8}}" formatter="formatPricePrice" align="right">Unit Price(Y)</th>
                                    <th data-options="field:'QtyTwo',width:100,align:'right',editor:{type:'numberbox',options:{precision:8}}" align="right">Qty(M)</th>
                                    @*<th field="MUNameTwo" width="70" align="left">Unit</th>*@
                                    <th data-options="field:'UnitPriceTwo',width:100,align:'right',editor:{type:'numberbox',options:{precision:8}}" formatter="formatPricePrice" align="right">Unit Price(M)</th>
                                    <th field="AmountSt" width="100" align="right">Value</th>
                                    <th data-options="field:'StyleNo',width:100,height:60 ,align:'Left',editor:{type:'text'}" align="Left">Style No</th>
                                    <th data-options="field:'BuyerReference',width:100,height:60 ,align:'Left',editor:{type:'text'}" align="Left">B.Ref</th>
                                    <th data-options="field:'ColorInfo',width:100,height:60 ,align:'Left',editor:{type:'text'}" align="Left">ColorInfo</th>
                                    <th data-options="field:'HLReference',width:80,height:60 ,align:'Left',editor:{type:'text'}" align="Left">H/L Ref</th>
                                    <th data-options="field:'Note',width:240,height:60 ,align:'Left',editor:{type:'text'}" align="Left">Note</th>
                                    <th data-options="field:'DesignPattern',width:100,height:60 ,align:'Left',editor:{type:'text'}" align="Left">Design&Pattern</th>
                                    <th field="FabricDesignName" width="100" align="right">FabricDesign</th>
                                    <th field="ExeNo" width="100" align="right">Dispo No</th>
                                    <th field="StatusSt" width="100" align="right">Status</th>
                                </tr>
                            </thead>
                        </table>
                        <div id="toolbarOne">
                          
                            <input type="checkbox" checked="checked" id="chkIsProduction" onchange="IsCheckedProduction()" /><label id="lbProduction">Production</label>
                            <input type="checkbox" id="chkOnlySale" onchange="IsCheckedOnlySale()" /><label id="lbOnlySale">Only Sale</label>
                            <select id="cboHandLoomType"> <option value="0">-Select-</option><option value="1">Small</option><option value="2">Medium</option><option value="3">Large</option><option value="3">Normal</option></select>
                            <input type="text" id="txtFabricNo" placeholder="Type p No & Press Enter" />
                            @*<input id="btnClrFabricNo" class="fabricItemsExportPI" type="button" value="C" />*@
                            <input id="btnPicFabricNo" type="button" value="Pick" />
                            <a id="btnPickDetail" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-edit" plain="true">Change</a>
                            <a id="btnRemoveDetail" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-remove" plain="true">Remove</a>
                            <a id="btnRefresh" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-reload" plain="true">Refresh</a>
                            <input type="text" id="txtPINo_Open" type="text" placeholder="Type Open P/I No & Press Enter" />
                            <input id="btnPicPINo_Open" type="button" value="Pick Detail" />
                            <a id="btnHoldRunning" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-add" plain="true">Hold</a>
                            <a id="btnCopyDetail" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-ok" onclick="CopyDetail()" plain="true">Copy</a>

                        </div>
                        <table id="tblTotalSumFSCDetails" style="width:100%;font-size:11px; font-weight:bold" border="0">
                            <tr>
                                <td id="tdTotalCaption" style="width: 40%; text-align: right; font-size: 12px; font-weight:bold"></td>
                                <td id="tdTotalCaption" style="width: 10%; text-align: right; font-size: 12px; font-weight:bold"> Total : </td>
                                <td style="width: 15%; text-align: right; font-size: 12px">
                                    <label id="lblTotalQty" style="text-align: right; font-size:12px; float: right; font-weight:bold;">0.00</label>
                                </td>
                                <td style="width: 15%; text-align: right; font-size: 12px">
                                    <label id="lblTotalAmount" style="text-align: right; font-size:12px; float: right; font-weight:bold;">0.00</label>
                                </td>
                                <td id="tdTotalCaption" style="width: 20%; text-align: right; font-size: 12px; font-weight:bold">  </td>
                            </tr>
                        </table>
                    </div>
                    <fieldset>
                        <legend style="font-weight:bold"> Action : </legend>
                        <div style="width:100%">
                            <div style=" float:left;  width:40%;text-align:left">
                                <a id="btnPrint" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-print" plain="true">Preview</a>
                            </div>
                            <div style="width:60%;float:left; text-align:right">
                                <input id="txtNote_Cancel" placeholder="Type Cancel Reason" style="width:200px" type="text" />
                                <label id="lblCreateReviseNo">Create Revise No?</label> <input id="chkIsCreateReviseNo" type="checkbox" checked="checked" />
                                <a id="btnCheck" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-save" plain="true">Check</a>
                                <a id="btnApprove" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-save" plain="true">Approve</a>
                                <a id="btnSave" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-save" plain="true">Save</a>
                                <a id="btnCancel" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-cancel" plain="true">Cancel</a>
                                <a id="btnSave_Copy" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-save" plain="true">Save(Copy)</a>
                                <a id="btnSaveLog" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-save" plain="true">Save(Revise)</a>
                                <a id="btnCloseTwo" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-closed" plain="true">Close</a>
                            </div>
                        </div>
                    </fieldset>
                </div>
                <div title="Delivery Specification" style="width:100%; height:100%;">
                    <div style="width:100%; height:100%;">
                        <div style=" margin-left:0px; margin-top:0px">
                            <fieldset>
                                <legend style="font-weight:bold">Delivery Schedule : </legend>
                                <table id="tblFabricDeliverySchedules" class="easyui-datagrid" style="width:100%; height:180px;" fitcolumns="false" rownumbers="true" pagination="false" singleselect="true"  toolbar="#toolbarFabricDeliverySchedules" data-options="singleSelect: true, fitColumns:true,  rownumbers:true,pagination:false,autoRowHeight:false">
                                    <thead>
                                        <tr>
                                            <th field="Name" width="20%" align="left">Fabric Delivery</th>
                                            <th field="DeliveryDateSt" width="12%" align="left">Required Date</th>
                                            <th field="Qty" width="10%" formatter="formatPrice" align="center">Qty(Yards)</th>
                                            <th field="Note" width="25%" align="left">Note</th>
                                            <th field="DeliveryAddress" width="15%" align="left">Delivery Address</th>
                                            <th field="DeliveryToName" width="25%" align="left">DeliveryTo</th>

                                        </tr>
                                    </thead>
                                </table>
                                <div id="toolbarFabricDeliverySchedules" style="width:100%;height:25px;">
                                    <div style="float:left;">
                                        <select id="cboDeliveryOrderName" onchange="cboDeliveryOrderName()" style=" width:10%;"></select>
                                        <label id="lblDeliveryQty" style="margin-left:10px;">Qty:</label>
                                        <input type="text" style="width:4%;" id="txtDeliveryQty" class="number" placeholder="Qty" />
                                        <input type="text" style="width:3%;" id="txtDeliveryDays" placeholder="Days" />
                                        Date : <input id="txtDeliveryDate" type="text" class="easyui-datebox" style="width:100px;" required="required" data-options="formatter:icsdateformat,parser:icsdateparser" />
                                        <label style="margin-left:10px;">Note:</label>
                                        <input type="text" style="width:10%;" id="txtNoteFDS" placeholder="Note" />

                                        <label style="margin-left:10px;">Address:</label>
                                        <label> Is HO?</label>
                                        <input type="checkbox" id="chkIsOwnDelivery" onclick="IsOwnDelivery()" />
                                        <input type="text" style="width:10%;" id="txtDeliveryToName" placeholder="Delivered To" />
                                        <a id="btnPickDeliveryTo" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-pick" plain="true"></a>
                                        <a id="btnUpdateFDSchedule" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-save" plain="true">Update</a>
                                        <a id="btnAddFDSchedule" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-add" plain="true">Add</a>
                                        <a id="btnEditFDSchedule" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-edit" plain="true">Edit</a>
                                        <a id="btnDelete_FabricDeliverySchedules" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-remove" plain="true">Remove</a>
                                    </div>
                                </div>
                                <table id="tblTotalSum_DeliverySchedule" style="width:100%;font-size:11px; font-weight:bold" border="0">
                                    <tr>
                                        <td id="tdTotalCaption" style="width: 10%; text-align: right; font-size: 12px; font-weight:bold"></td>
                                        <td id="tdTotalCaption" style="width: 10%; text-align: right; font-size: 12px; font-weight:bold"> Total : </td>
                                        <td style="width: 15%; text-align: right; font-size: 12px">
                                            <label id="lblTotalDelQty" style="text-align: right; font-size:12px; float: right; font-weight:bold;">0.00</label>
                                        </td>
                                        <td style="width: 15%; text-align: right; font-size: 12px">
                                            <label id="lblTotalDelQtyBalance" style="text-align: right; font-size:12px; float: right; font-weight:bold;">0.00</label>
                                        </td>
                                        <td style="width: 15%; text-align: right; font-size: 12px">
                                            <label id="lblTotalGreyQty" style="text-align: right; font-size:12px; float: right; font-weight:bold;"></label>
                                        </td>
                                        <td style="width: 15%; text-align: right; font-size: 12px">
                                            <label id="lblTotalGreyQtyBalance" style="text-align: right; font-size:12px; float: right; font-weight:bold;"></label>
                                        </td>
                                        <td id="tdTotalCaption" style="width:10%; text-align: right; font-size: 12px; font-weight:bold">  </td>
                                    </tr>
                                </table>
                            </fieldset>
                        </div>
                        <div style="margin-left:0px; margin-top:0px">
                            <fieldset>
                                <legend style="font-weight:bold">Instruction</legend>
                                <table style="width:100%;" border="0" cellspacing="2" cellpadding="1">

                                    <tr>
                                        <td style="width:15%; text-align:right;font-weight:bold">
                                            End Use:
                                        </td>
                                        <td style="width:30%;text-align:left">
                                            <input type="text" id="txtEndUse" style="width:100%" />

                                        </td>
                                        <td style="width:15%; text-align:right;font-weight:bold"> Light Source(Primary):</td>
                                        <td style="width:15%"><input type="text" id="txtLightSource" class="reset-text" style="width:100%" /></td>
                                        <td style="width:10%; text-align:right;font-weight:bold"> (Secondary):</td>
                                        <td style="width:15%"><input type="text" id="txtLightSourceTwo" class="reset-text" style="width:100%" /></td>
                                    </tr>

                                    <tr>
                                        <td style="width:15%; text-align:right;font-weight:bold">
                                            Quaility Parameters:
                                        </td>
                                        <td colspan="5" style="width:85%;text-align:left">
                                            <table border="0" cellpadding="0" cellspacing="0" style="width:100%">
                                                <tr>
                                                    <td style="width:95%"><input type="text" id="txtQualityParameters" style="width:100%" /></td>
                                                    @*<td style="text-align:left;"><a id="btnPickQualityParameters" href="javascript:void(0)" class="easyui-linkbutton ics-pick" iconcls="icon-pick" plain="true"></a></td>
                                                        <td style="text-align:left;"><a id="btnClrQualityParameters" href="javascript:void(0)" class="easyui-linkbutton ics-pick" iconcls="icon-clear" plain="true"></a></td>                                            </tr>*@
                                            </table>

                                        </td>

                                    </tr>

                                    <tr>
                                        <td style="width:15%; text-align:right;font-weight:bold">
                                            Quaility Tolerance:
                                        </td>
                                        <td style="width:30%;text-align:left">
                                            <input type="text" id="txtQtyTolarance" class="reset-text" style="width:100%" />

                                        </td>
                                        <td style="width:15%; text-align:right;font-weight:bold">
                                            Wash Type:
                                        </td>
                                        <td colspan="3" style="width:40%;text-align:left">
                                            <input type="text" id="txtGarmentWash" class="reset-text" style="width:100%" />
                                        </td>
                                    </tr>
                                </table>
                            </fieldset>
                        </div>
                        <div style="margin-left:0px; margin-top:0px">
                            <fieldset>
                                <legend style="font-weight:bold"> </legend>
                                <table id="tblLCTerm" style="width:100%;" border="0" cellspacing="1" cellpadding="1">
                                    <tr>
                                        <td style="width:15%; text-align:left;font-weight:bold">
                                            Payment Terms:
                                        </td>
                                        <td style="width:35%;text-align:left">
                                            <select style="width:150px;" id="cboLCTerm"></select>
                                            From
                                            <select style="width:150px;" id="cboPaymentInstruction"></select>
                                        </td>
                                        <td style="width:15%; text-align:right;font-weight:bold"></td>
                                        <td style="width:35%;text-align:left"></td>
                                    </tr>

                                </table>
                                <table id="tblLCTermTemp" style="width:100%;height:20px;" border="0" cellspacing="0" cellpadding="1">
                                    <tr>
                                        <td style="width:15%; text-align:left;font-weight:bold"></td>
                                    </tr>

                                </table>

                            </fieldset>
                        </div>
                        <fieldset class="actionfieldsetstyle">
                            <legend style="font-weight:bold"> Action : </legend>
                            <table style="width:100%" border="0" cellspacing="2" cellpadding="2" style="font-size:11px; font-weight:bold">
                                <tr>
                                    <td style=" float:left;  width:40%;text-align:left">
                                        <a id="btnPrintTwo" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-print" plain="true">Preview</a>
                                    </td>
                                    <td style="width:40%"></td>
                                    <td style="width:20%;text-align:right">
                                        <a id="btnApproveTwo" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-save" plain="true">Approve</a>
                                        <a id="btnSaveTwo" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-save" plain="true">Save</a>
                                        <a id="btnCloseTwo" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-closed" plain="true">Close</a>
                                    </td>
                                </tr>
                            </table>
                        </fieldset>
                    </div>
                </div>
                <div title="Special Instruction" style="width:100%; height:100%;">
                    <div title="Note(s)">
                        <table id="tblFSCNots" class="easyui-datagrid" style="width:100%; height:450px" fitcolumns="true" rownumbers="true" pagination="false" singleselect="false" autorowheight="false" toolbar="#TCtoolbar" data-options="singleSelect: true, fitColumns:false,  rownumbers:true,pagination:false,autoRowHeight:false, onClickRow: onClickRowTC">
                                <thead>
                                    <tr>
                                        <th data-options="field:'Selected',checkbox:true"></th>
                                        <th field="Note" width="850" align="left" data-options="field:'TermsAndCondition',editor:{type:'text',options:{precision:0}}"> Terms & Condition </th>
                                    </tr>
                                </thead>
                            </table>
                            <div id="TCtoolbar" style=" height:25px;">
                                <a id="btnAddTermsAndConditon" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-pick" onclick="PickTermsAndCondition()" plain="true">Pick</a>
                                <a id="btnRefreshTermsAndCondition" href="javascript:void(0)" class="easyui-linkbutton" onclick="RefreshTermsAndCondition()" iconcls="icon-reload" plain="true">Refresh</a>
                                <a id="btnRemoveTermsAndConditionAll" href="javascript:void(0)" class="easyui-linkbutton" onclick="RemoveTermsAndConditionAll()" iconcls="icon-remove" plain="true">Remove All</a>
                                <a id="btnRemoveTermsAndCondition" href="javascript:void(0)" class="easyui-linkbutton" onclick="RemoveTermsAndCondition()" iconcls="icon-remove" plain="true">Remove</a>
                            </div>
</div>
                    <fieldset class="actionfieldsetstyle">
                        <legend style="font-weight:bold"> Action : </legend>
                        <table style="width:100%" border="0" cellspacing="2" cellpadding="2" style="font-size:11px; font-weight:bold">
                            <tr>
                                <td style=" float:left;  width:40%;text-align:left">
                                    <a id="btnPrintThree" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-print" plain="true">Preview</a>
                                </td>
                                <td style="width:40%"></td>

                                <td style="width:20%;text-align:right">
                                    <a id="btnApproveThree" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-save" plain="true">Approve</a>
                                    <a id="btnSaveFSCNote" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-save" plain="true">Save</a>
                                    <a id="btnCloseThree" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-closed" plain="true">Close</a>
                                </td>
                            </tr>
                        </table>
                    </fieldset>
                </div>
            </div>
        </div>

    </div>

    <div id="winContactPersonnel" class="easyui-window" title="Add Contact Personeel" data-options="modal:true,closed:true,collapsible:false,minimizable:false,maximizable:false,closable:false">
        <div>
            <fieldset>
                <legend style="font-weight:bold"> Contact Personnel Informations : </legend>
                <table border="0" cellspacing="2" cellpadding="2" style="font-size:11px; font-weight:bold">
                    <tr>
                        <td style="width:125px; text-align:right">
                            Name :
                        </td>

                        <td style="width:200px">
                            <input type="text" style="width: 200px;" id="txtName" />
                        </td>
                        <td style="width:50px"> </td>
                        <td style="width:125px; text-align:right">
                            Address :
                        </td>
                        <td style="width:300px">
                            <input type="text" style="width: 300px;" id="txtAddress" />
                        </td>
                    </tr>
                    <tr>
                        <td style="width:125px; text-align:right">
                            Phone :
                        </td>

                        <td style="width:200px">
                            <input type="text" style="width: 200px;" id="txtPhone" />
                        </td>
                        <td style="width:50px"> </td>
                        <td style="width:125px; text-align:right">
                            Email :
                        </td>
                        <td style="width:300px">
                            <input type="text" style="width: 300px;" id="txtEmail" />
                        </td>
                    </tr>
                    <tr>
                        <td style="width:125px; text-align:right">
                            Note :
                        </td>
                        <td colspan="4">
                            <input type="text" style="width: 690px;" id="txtNote" />
                        </td>
                    </tr>
                </table>
            </fieldset>
        </div>
        <fieldset style="width:97%;height:8%; vertical-align:top;">
            <legend style="font-weight:bold"> Action : </legend>
            <table border="0" cellspacing="2" cellpadding="2" style="font-size:11px; font-weight:bold;">
                <tr>
                    <td style="width:7%;text-align:right;">
                        <a id="btnAddContactPersonnel" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-save" plain="true" onclick="AddContactPersonnel()">Save</a>
                        <a id="btnCloseContactPersonnel" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-cancel" plain="true" onclick="CloseContactPersonnel()">Close</a>
                    </td>

                </tr>
            </table>
        </fieldset>
    </div>
    <div id="winTermsAndCondition" style="width:70%; text-align:center;" class="easyui-window winstyle" title="Terms And Condition Picker" data-options="modal:true,closed:true,collapsible:false,minimizable:false,maximizable:false,closable:false">
        <div style="width:100%; text-align:left;">
            <input type="text" id="txtTermsAndCondition" placeholder="Search By Terms And Condition" style="width:350px; text-align:left;" />&nbsp;&nbsp;&nbsp;
            <table id="tblTermsAndCondition" title="" class="easyui-datagrid" style="height:300px; " fitcolumns="false" rownumbers="true" pagination="false" singleselect="false" autorowheight="false">
                <thead>
                    <tr>
                        <th data-options="field:'Selected',checkbox:true"></th>
                        <th field="Note" width="80%">Note</th>
                    </tr>
                </thead>
            </table>
        </div>

        <fieldset class="actionfieldsetstyle">
            <legend>Actions : </legend>
            <a id="btnOkFabricSalesContractNote" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-ok" plain="true">Ok</a>
            <a id="btnCloseTermsAndCondition" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-cancel" plain="true">Close</a>
        </fieldset>
    </div>
    <div id="winFabricInfo" style="width:620px;" class="easyui-window" title="Fabric info" data-options="modal:true,closed:true,collapsible:false,minimizable:false,maximizable:false,closable:false">
        <div>
            <fieldset>
                <legend style="font-weight:bold"> Fabric info Informations : </legend>
                <table border="0" cellspacing="2" cellpadding="2" style="width:100%; font-size:11px; font-weight:bold">
                    <tr>
                        <td style="width:30%;text-align:right">
                            <label id="lblFabricNo"></label>:
                        </td>

                        <td style="width:20%">
                            <input type="text" id="txtFabricNo_F" style="width:100%" />
                        </td>
                        <td style="width:20%;text-align:right">
                            Width:
                        </td>
                        <td style="width:30%">
                            <input type="text" id="txtFabricWidthFabric" style="width:100%" />
                        </td>
                    </tr>
                    <tr>
                        <td style="width:30%;text-align:right">
                            Composition:
                        </td>

                        <td style="width:20%">
                            <select style="width:100%" id="cboProductFabric"></select>
                        </td>
                        <td style="width:20%;text-align:right">
                            <label>Construction:</label>
                        </td>
                        <td style="width:30%;text-align:left">
                            <input  id="txtConstruction_F" type="text" style="width:100%" />
                        </td>

                    </tr>

                    <tr>
                        <td style="width:30%;text-align:right">
                            <label style="width:100%">Fabric Design:</label>
                        </td>
                        <td style="width:20%;text-align:left">
                            <select style="width:100%" id="cboFabricDesign"></select>
                        </td>
                        <td style="width:20%;text-align:right">
                            <label>Style:</label>
                        </td>
                        <td style="width:30%;text-align:left">
                            <input id="txtStyleNoFabric" type="text" style="width:100%" />
                        </td>
                    </tr>
                    <tr>
                        <td style="width:30%;text-align:right">
                            <label style="width:100%">Process Type:</label>
                        </td>
                        <td style="width:20% ;text-align:left">
                            <select style="width:100%" id="cboProcessTypeFabric"></select>
                        </td>
                        <td style="width:20%;text-align:right">
                            <label>Color:</label>
                        </td>
                        <td style="width:30%">
                            <input id="txtColorFabric" type="text" style="width:100%" />
                        </td>
                    </tr>
                    <tr>
                        <td style="width:30% ;text-align:right">
                            <label style="width:100%">Weave:</label>
                        </td>
                        <td style="width:20%">
                            <select style="width:100%" id="cboWeaveFabric"></select>
                        </td>
                        <td style="width:20% ;text-align:right">
                            <label style="width:100%">B.Ref :</label>
                        </td>
                        <td style="width:30% ;text-align:left">
                            <input id="txtBRef" type="text" style="width:100%" />
                        </td>
                    </tr>
                    <tr>
                        <td style="width:30% ;text-align:right">
                            <label style="width:100%">Finish Type:</label>
                        </td>
                        <td style="width:20%">
                            <select style="width:100%" id="cboFinishTypeFabric"></select>
                        </td>
                        <td style="width:20% ;text-align:right">
                            <label style="width:100%">H/L Ref:</label>
                        </td>
                        <td style="width:30%">
                            <input id="txtHLRef" type="text" style="width:100%" />
                        </td>
                    </tr>
                    <tr id="trIsLabDip">
                        <td style="width:30% ;text-align:right">
                            <label style="width:100%">LD No:</label>
                        </td>
                        <td style="width:20%">
                            <input id="txtLDNo" type="text" style="width:100%" />
                        </td>
                        <td style="width:20% ;text-align:right">
                            <label style="width:100%">Appr'd Option:</label>
                        </td>
                        <td style="width:30%">
                            <select style="width: 50%;" id="cboShade">
                                <option value="0">NA</option>
                                <option value="1">A</option>
                                <option value="2">B</option>
                                <option value="3">C</option>
                                <option value="4">D</option>
                                <option value="5">E</option>
                                <option value="6">F</option>
                                <option value="7">G</option>
                                <option value="8">H</option>
                                <option value="9">I</option>
                                <option value="10">J</option>
                                <option value="11">K</option>
                                <option value="12">L</option>
                                <option value="13">M</option>
                                <option value="14">N</option>
                                <option value="15">O</option>
                            </select>
                        </td>
                    </tr>
                    <tr id="trIsLabDip2">
                        <td style="width:30% ;text-align:right">
                            <label style="width:100%">Panton No:</label>
                        </td>
                        <td style="width:20%">
                            <input id="txtPantonNo" type="text" style="width:100%" />
                        </td>
                        <td style="width:20% ;text-align:right">
                            <label style="width:100%">Wash Type :</label>
                        </td>
                        <td style="width:30% ;text-align:left">
                            <input type="checkbox" checked="checked" id="chkIsBW" onclick="if(this.checked){IsBW()}else{IsAW()}" />B/W
                            <input type="checkbox" id="chkIsAW" onclick="if(this.checked){IsAW()}else{IsBW()}" />A/W
                        </td>
                    </tr>
                    <tr id="trIsLabDip3">
                        <td style="width:30% ;text-align:right">
                            <label style="width:100%">Weight:</label>
                        </td>
                        <td style="width:20%">
                            <input id="txtWeight" type="text" style="width:100%" />
                        </td>
                        <td style="width:20% ;text-align:right">
                            <label style="width:100%">Shrinkage :</label>
                        </td>
                        <td style="width:30% ;text-align:left">
                            <input id="txtShrinkage" type="text" style="width:100%" />
                        </td>
                    </tr>
                    <tr id="trIsLabDip4">
                        <td style="width:30% ;text-align:right">
                            <label style="width:100%">Yarn Type:</label>
                        </td>
                        <td colspan="3" style="width:70%">
                            <input id="txtYarnType" type="text" style="width:100%" />
                        </td>
                       
                    </tr>
                    <tr>

                        <td style="width:20% ;text-align:right">
                            <label>Note:</label>
                        </td>
                        <td colspan="3" style="width:30%">
                            <input id="txtNoteFSCD" type="text" style="width:100%" />
                        </td>
                    </tr>
                    <tr>

                        <td style="width:30% ;text-align:right">
                            <label id="lblDnP">Design & Pattern:</label>
                        </td>
                        <td colspan="3" style="width:70%">
                            <input id="txtDesignPattern" type="text" style="width:100%" />
                        </td>
                    </tr>
                    <tr id="trIsProduction">
                        <td style="width:30% ;text-align:right"></td>
                        <td colspan="3">
                            <input type="checkbox" checked="checked" id="chkIsProductionTwo" onchange="IsCheckedProduction()" />Production
                            <input type="checkbox" id="chkOnlySaleTwo" onchange="IsCheckedOnlySale()" />Only Sale
                        </td>

                    </tr>

                </table>
            </fieldset>
        </div>
        <fieldset>
            <legend style="font-weight:bold"> Action : </legend>
            <table border="0" cellspacing="2" cellpadding="2" style="width:100%; font-size:11px; font-weight:bold;">
                <tr>
                    <td style="width:100%;text-align:right;">
                        <a id="btnUpdateFSEDetail" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-save" plain="true">OK</a>
                        <a id="btnCloseFSEDetail" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-cancel" plain="true">Close</a>
                    </td>

                </tr>
            </table>
        </fieldset>
    </div>

</body>
</html>
<style type="text/css">
    .tdInput input {
        width: 48%;
    }

    .tdInputC input {
        width: 48%;
    }

    .tdInput select {
        width: 48%;
    }

    .alignLeft {
        text-align: left !important;
    }

    .lblStar {
        color: red;
        font-weight: bold;
    }
</style>
<script type="text/javascript">
    var _sBaseAddress = "";
    var _oFabricSalesContract=null;

    var _oCurrencys = [];
    var _oOrderTypes = [];
    var _nFNLabDipDetailID = 0;
    var _oPaymentInstructions = [];
    var _oLCTerms = [];
    var _nBUID=0;
    var _sBackLink="";
    var _nDeliveryToID=0;
    var _oDeliveryOrderNames=[];
    var _oFabricDeliverySchedules=[];
    var _oFabricDeliverySchedule=[];
    var _oFabricSalesContractNotes=[];
    var _oProcessTypes=[];
    var _oFabricWeaves=[];
    var _oFabricDesigns=[];
    var _oFinishTypes = [];
    var _oFabricPOSetup=[];
    var _oBusinessUnit=null;
    $(document).ready(function () {
        _sBaseAddress =@Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(HttpContext.Current.Session[SessionInfo.BaseAddress]));
        _oFabricSalesContract =@Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(Model));
        _oFabricSalesContract =@Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(Model));
        _oCurrencys = @Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(ViewBag.Currencys));
        _oLCTerms = @Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(ViewBag.LCTerms));
        _oOrderTypes = @Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(ViewBag.OrderTypes));
        _nBUID = @Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(ViewBag.BUID));
        _oDeliveryOrderNames = @Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(ViewBag.DeliveryOrderNames));
        _oFabricDeliverySchedules = @Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(ViewBag.FabricDeliverySchedules));
        _oPaymentInstructions = @Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(ViewBag.PaymentInstructions));
        _oLCTerms = @Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(ViewBag.LCTerms));
        _oFabricSalesContractNotes= @Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(ViewBag.FabricSalesContractNotes));
        _oFinishTypes = @Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(ViewBag.FinishTypes));
        _oProcessTypes = @Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(ViewBag.ProcessTypes));
        _oFabricWeaves = @Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(ViewBag.FabricWeaves));
        _oFabricDesigns = @Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(ViewBag.FabricDesigns));
        var oAuthorizationRolesMapping = @Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(HttpContext.Current.Session[SessionInfo.AuthorizationRolesMapping]));
        _oFabricPOSetup = @Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(ViewBag.FabricPOSetup));
        _oBusinessUnit = @Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(ViewBag.BusinessUnit));
        // DynamicRefreshList([], 'tblFabricSalesContracts');
        RefreshSetup(_oFabricPOSetup);
        debugger;

        Initialization(_oFabricSalesContract,((sessionStorage.length>0)?sessionStorage.getItem('Operation'):'New'));
        _sBackLink=sessionStorage.getItem("BackLink");
        Control_disabled();
        $("#progressbar").progressbar({ value: 0 });
        $("#progressbarParent").hide();
        $('.number').val("0.00");
        $("#btnUpdateFDSchedule").hide();
        RefreshControlLayout(oAuthorizationRolesMapping);
    });
    function RefreshSetup(oFabricPOSetup)
    {
        $('#lblFabricNo').html(oFabricPOSetup.FabricCode);
        $("#txtFabricNo").attr("placeholder","Search by "+oFabricPOSetup.NoCode+" No");
        if(!oFabricPOSetup.IsLDApply)
        {
            $("#trIsLabDip,#trIsLabDip2,#trIsLabDip3,#trIsLabDip4").hide();
        }

    }

    function RefreshControlLayout(oAuthorizationRolesMapping)
    {
        $("#tblFSCDetails").datagrid("hideColumn", "UnitPrice");
        $("#tblFSCDetails").datagrid("hideColumn", "UnitPriceTwo");
        $("#tblFSCDetails").datagrid("hideColumn", "AmountSt");
        $("#lblTotalAmount").hide();
        if(oAuthorizationRolesMapping.length>0)
        {
           
            if (PermissionChecker('RateView', 'FabricPO',oAuthorizationRolesMapping))
            {
                $("#tblFSCDetails").datagrid("showColumn", "UnitPrice");
                $("#tblFSCDetails").datagrid("showColumn", "UnitPriceTwo");
                $("#tblFSCDetails").datagrid("showColumn", "AmountSt");
                $("#lblTotalAmount").show();
            }
        }
    }

    $("#txtSCNo").keypress(function (e) {
        if (e.which != 8 && e.which != 0  && e.which != 46  && (e.which < 48 || e.which > 57)) {
            return false;
        }
    });
    $('#tabFSC').tabs({ onSelect: function () {TabClick();} });
    function TabClick()
    {
        debugger;
        var tab = $('#tabFSC').tabs('getSelected');
        var index = $('#tabFSC').tabs('getTabIndex', tab);
        if (parseInt(index)==1)
        {
            RefreshTotalSummery_FDS(0);
            IsOwnDelivery();
        }
    }

    function updateProgress() {
        var value =$('#progressbar').progressbar('getValue');
        if (value < 96){
            value += Math.floor(Math.random() * 10);
            $('#progressbar').progressbar('setValue', value);
        }
    }
    function hideShow(miliseconds) {
        $("#progressbarParent").hide();
    }
    function Initialization(oFabricSalesContract, sOperation){

        ResetControll();
        // LoadCombo();
        $('#btnApprove,#btnApproveTwo,#btnApproveThree,#btnSaveLog,#btnSave_Copy,#btnCancel,#btnHoldRunning,#btnCheck').hide();
        $("#chkIsCreateReviseNo").hide();
        $("#lblCreateReviseNo,#txtNote_Cancel").hide();
        if(sOperation=="View")
        {
            $('#TCtoolbar,#toolbarOne,#btnSave,#btnSaveTwo,#btnSaveFSCNote,.ics-pick').hide();
            $('input,select').not('#txtSCNo').prop('disabled',true);
        }
        else if(sOperation=="Approve")
        {
            $('#TCtoolbar,#toolbarOne,#btnSave,#btnSaveTwo,#btnSaveFSCNote,.ics-pick').hide();
            $('input,select').not('#txtSCNo').prop('disabled',true);
            $('#btnApprove,#btnApproveTwo,#btnApproveThree').show();
        }
        else if(sOperation=="Hold")
        {
            $('#btnCopyDetail,#btnSave,#btnSaveTwo,#btnSaveFSCNote,#btnApprove,#btnApproveTwo,.ics-pick,#btnPicPINo_Open,#btnPickDetail,#btnRemoveDetail,#btnRefresh,#btnPicFabricNo,#txtFabricNo').hide();
            $('input,select').not('#txtSCNo').prop('disabled',true);
            $('#txtPINo_Open').prop('disabled',false);
            $("#txtPINo_Open").attr("placeholder","Type Reason");
            $('#btnHoldRunning,#txtPINo_Open').show();
        }
        else if(sOperation=="Copy")
        {
            $('#txtSCDate').datebox('setValue', icsdateformat(new Date()));
            oFabricSalesContract.SCDateSt=icsdateformat(new Date());
            $('#btnSave').hide(); $("#txtSCNo").val("");
            $('#TCtoolbar,#toolbarOne,#btnSave_Copy,#btnSaveTwo,#btnSaveFSCNote,.ics-pick').show();
            $('input,select').not('#txtSCNo').prop('disabled',false);
            oFabricSalesContract.FabricSalesContractID=0;
        }
        else if(sOperation=="Cancel")
        {
            $('#TCtoolbar,#toolbarOne,#btnSave,#btnSaveTwo,#btnSaveFSCNote,.ics-pick,#btnApprove,#btnApproveTwo,#btnApproveThree').hide();
            $('input,select').not('#txtSCNo').prop('disabled',true);
            $('#txtNote_Cancel').prop('disabled',false);
            $('#btnCancel,#txtNote_Cancel').show();
        }
        else  if(sOperation=="Revise")
        {
            $('#btnSaveLog,#btnSaveTwo,#btnSaveFSCNote').show();
            $('input,select').not('#txtSCNo').prop('disabled',false);
            $('#btnApprove,#btnApproveTwo,#btnApproveThree,#btnSave').hide();
            $("#chkIsCreateReviseNo").show();
            $("#lblCreateReviseNo").show();
        }
        else if(sOperation=="Check")
        {
            $('#TCtoolbar,#toolbarOne,#btnSave,#btnSaveTwo,#btnSaveFSCNote,.ics-pick').hide();
            $('input,select').not('#txtSCNo').prop('disabled',true);
            $('#btnCheck').show();
        }
        else{
            $('#TCtoolbar,#toolbarOne,#btnSave,#btnSaveTwo,#btnSaveFSCNote,.ics-pick').show();
            $('input,select').not('#txtSCNo').prop('disabled',false);
            //$('.td-col-6 input').css('width','70%');
        }
        RefreshControl(oFabricSalesContract);
    }
    function IsInHouseYes() {
        document.getElementById("chkIsInHouseYes").checked = true;
        document.getElementById("chkIsInHouseNo").checked = false;
    }

    function IsInHouseNo() {
        document.getElementById("chkIsInHouseYes").checked = false;
        document.getElementById("chkIsInHouseNo").checked = true;
      
    }

    function IsBW() {
        $('#chkIsBW').prop('checked',true);
        $('#chkIsAW').prop('checked', false);
    }

    function IsAW() {
        $('#chkIsBW').prop('checked',false);
        $('#chkIsAW').prop('checked', true);
      
    }

    function IsInOpenPIYes() {
        $('#txtPINo_Open,#btnPicPINo_Open').show();
        $('#txtFabricNo,#btnPicFabricNo').hide();
    }

    function IsInOpenPINo() {
        $('#txtPINo_Open,#btnPicPINo_Open').hide();
        $('#txtFabricNo,#btnPicFabricNo').show();
    }

    function Control_disabled()
    {
        document.getElementById("txtPINo").disabled = true;
        //document.getElementById("txtSCNo").disabled = true;
    }
    function LoadCombo() {

        $("#cboCurrency").icsLoadCombo({
            List: _oCurrencys,
            OptionValue: "CurrencyID",
            DisplayText: "CurrencyName"
        });

        $("#cboOrderType").icsLoadCombo({
            List: _oOrderTypes,
            OptionValue: "FabricOrderType",
            DisplayText: "OrderName"
        });

        $("#txtSCNoOrderType").icsLoadCombo({
            List: _oOrderTypes,
            OptionValue: "FabricOrderType",
            DisplayText: "CodeName"
        });

        $("#cboLCTerm").icsLoadCombo({
            List: _oLCTerms,
            OptionValue: "LCTermID",
            DisplayText: "NameDaysInString"
        });

        $("#cboPaymentInstruction").icsLoadCombo({
            List: _oPaymentInstructions,
            OptionValue: "id",
            DisplayText: "Value"
        });


        $("#cboProcessTypeFabric").icsLoadCombo({  List: _oProcessTypes,  OptionValue: "FabricProcessID", DisplayText: "Name"});
        $("#cboWeaveFabric").icsLoadCombo({List: _oFabricWeaves, OptionValue: "FabricProcessID", DisplayText: "Name"});
        $("#cboFabricDesign").icsLoadCombo({ List: _oFabricDesigns, OptionValue: "FabricProcessID", DisplayText: "Name"});
        $("#cboFinishTypeFabric").icsLoadCombo({List: _oFinishTypes, OptionValue: "FabricProcessID", DisplayText: "Name"});
    }


    function ResetControll(){
        //  $('#txtSendToParty').datebox('setValue', icsdateformat(new Date()));
        $('.reset-text').val("");
    }

    function RefreshControl(oFabricSalesContract) {
        debugger;

        _oFabricSalesContract=oFabricSalesContract;
        if(_oFabricSalesContract.FabricSalesContractID>0)
        {
            $('#cboOrderType').prop('disabled',true);
        }
        else
        {
            $("#cboOrderType" ).prop({disabled:false});
        }
        LoadCombo();
        $("#txtSCNoOrderType" ).prop({disabled:true});
        
        $('#chkIsInHouseYes').prop('checked', _oFabricSalesContract.IsInHouse);
        $('#chkIsInHouseNo').prop('checked', !_oFabricSalesContract.IsInHouse);
        $('#chkIsPrint').prop('checked', _oFabricSalesContract.IsPrint);
        $('#chkIsOpenPI').prop('checked', _oFabricSalesContract.IsOpenPI);
      

        $("#cboCurrency").val(_oFabricSalesContract.CurrencyID);
        $("#cboCPerson").val(_oFabricSalesContract.ContactPersonnelID);
        $("#cboOrderType").val(_oFabricSalesContract.OrderType);
        $("#txtSCNo").val(_oFabricSalesContract.SCNo);
        $("#txtPINo").val(_oFabricSalesContract.PINo);
        $('#txtMktAccount').val(_oFabricSalesContract.MKTPName);
        $('#txtMktGroup').val(_oFabricSalesContract.MKTGroupName);
        //$("#txtAmount").val(_oFabricSalesContract.AmountSt);
        $("#txtNote").val(_oFabricSalesContract.Note);

        $("#cboCurrency").val(_oFabricSalesContract.CurrencyID);
        $("#cboLCTerm").val(_oFabricSalesContract.LCTermID);
        $("#cboPaymentInstruction").val(_oFabricSalesContract.PaymentInstruction);
        $("#txtLightSource").val(_oFabricSalesContract.LightSourceName);
        $("#txtLightSourceTwo").val(_oFabricSalesContract.LightSourceNameTwo);
        $("#txtEndUse").val(_oFabricSalesContract.EndUse);
        $("#txtQualityParameters").val(_oFabricSalesContract.QualityParameters);
        $("#txtQtyTolarance").val(_oFabricSalesContract.QtyTolarance);
        $("#txtGarmentWash").val(_oFabricSalesContract.GarmentWash);



        if (_oFabricSalesContract.SCDateSt != "-") {
            $('#txtSCDate').datebox('setValue', _oFabricSalesContract.SCDateSt);
        }
        if (_oFabricSalesContract.ContractorID > 0) {
            $("#txtContractorName").val(_oFabricSalesContract.ContractorName);
            $("#txtContractorName").addClass("fontColorOfPickItem");
        }
        else
        {
            $("#txtContractorName").removeClass("fontColorOfPickItem");
        }

        if (_oFabricSalesContract.BuyerID > 0) {
            $("#txtBuyingHouse").val(_oFabricSalesContract.BuyerName);
            $("#txtBuyingHouse").addClass("fontColorOfPickItem");
        } else {
            $("#txtBuyingHouse").removeClass("fontColorOfPickItem");
            $("#txtBuyingHouse").val("");
        }
        if(_oFabricSalesContract.FabricSalesContractDetails!=null )
        {
            DynamicRefreshList(_oFabricSalesContract.FabricSalesContractDetails, "tblFSCDetails");
        }
        else{
            DynamicRefreshList([], "tblFSCDetails");
        }

        if(_oFabricDeliverySchedules!=null )
        {
            DynamicRefreshList(_oFabricDeliverySchedules, "tblFabricDeliverySchedules");
        }
        else{
            DynamicRefreshList([], "tblFabricDeliverySchedules");
        }

        if(_oFabricSalesContractNotes!=null )
        {
            DynamicRefreshList(_oFabricSalesContractNotes, "tblFSCNots");
        }
        else{
            DynamicRefreshList([], "tblFSCNots");
        }
        RefreshTotalSummery();
        RefreshTotalSummery_FDS(0);
        GetContactPerson(_oFabricSalesContract.ContractorID,true);
        GetContactPerson(_oFabricSalesContract.BuyerID,false);
        ChangeOrderType(false);
        if(_oFabricSalesContract.IsOpenPI){ IsInOpenPIYes();} else {IsInOpenPINo();}
    }


    function RefreshTotalSummery() {
        var nTotalQty = 0;
        var nTotalValue = 0;
        var sCurrency = "";
        sCurrency = $("#cboCurrency option:selected").text();
        var oFSCDetails = $('#tblFSCDetails').datagrid('getRows');
        for (var i = 0; i < oFSCDetails.length; i++) {
            nTotalQty = nTotalQty + parseFloat(oFSCDetails[i].Qty);
            nTotalValue = nTotalValue + parseFloat(oFSCDetails[i].Qty*oFSCDetails[i].UnitPrice);
        }
        document.getElementById("lblTotalQty").innerHTML = formatPrice(nTotalQty)+' Y';
        document.getElementById("lblTotalAmount").innerHTML = sCurrency + " " + formatPrice(nTotalValue);
    }

    function RefreshTotalSummery_FDS(IsGrey) {

        var nTotalQty = 0;
        var nTotalGreyQty=0, nTotalDelQty = 0,nBalance=0,nBalanceGrey=0;

        var oFSCDetails = $('#tblFSCDetails').datagrid('getRows');
        for (var i = 0; i < oFSCDetails.length; i++) {
            nTotalQty = nTotalQty + parseFloat(oFSCDetails[i].Qty);
        }

        var oFabricDeliverySchedules = $('#tblFabricDeliverySchedules').datagrid('getRows');
        for (var i = 0; i < oFabricDeliverySchedules.length; i++) {
            if(!oFabricDeliverySchedules[i].IsFoc)
            {
                if(!oFabricDeliverySchedules[i].IsGrey)
                {
                    nTotalDelQty = nTotalDelQty + parseFloat(oFabricDeliverySchedules[i].Qty);
                }
                else{
                    nTotalGreyQty = nTotalGreyQty + parseFloat(oFabricDeliverySchedules[i].Qty);
                }
            }
        }
        nBalanceGrey=parseFloat(nTotalQty-nTotalGreyQty).toFixed(2);
        nBalance=parseFloat(nTotalQty-nTotalDelQty).toFixed(2);
      
        if(nBalance<=0)
        {
            nBalance=0;
        }
        document.getElementById("lblTotalDelQty").innerHTML = formatPrice(nTotalDelQty)+' Y';
        document.getElementById("lblTotalDelQtyBalance").innerHTML = "Balance: "+formatPrice(nBalance)+' Y';
        if(nTotalGreyQty>0)
        {
            document.getElementById("lblTotalGreyQty").innerHTML = formatPrice(nTotalGreyQty)+' Y';
            document.getElementById("lblTotalGreyQtyBalance").innerHTML = "Balance: "+formatPrice(nBalanceGrey)+' Y';
        }
        if(IsGrey)
        {
            $('#txtDeliveryQty').val(parseFloat(nBalanceGrey));
        }
        else{
            $('#txtDeliveryQty').val(parseFloat(nBalance));
        }
    }

    $("#btnSave").click(function (e) {
        endEditing();
        if (!ValidateInputFabricSalesContract()) return;
        var oFabricSalesContract = RefreshObjectFabricSalesContract();
        $("#btnSave").hide();
        $("#progressbar").progressbar({ value: 0 });
        $("#progressbarParent").show();
        var intervalID = setInterval(updateProgress, 250);
        $.ajax({
            type: "POST",
            dataType: "json",
            url: _sBaseAddress + "/FabricSalesContract/Save",
            traditional: true,
            data: JSON.stringify(oFabricSalesContract),
            contentType: "application/json; charset=utf-8",
            success: function (data) {
                debugger;
                var oELC = jQuery.parseJSON(data);
                $("#btnSave").show();
                clearInterval(intervalID);
                $("#progressbarParent").hide();
                if (oELC.ErrorMessage == "" || oELC.ErrorMessage == null) {

                    if(_oFabricSalesContract.FabricSalesContractID<=0)
                    {
                        oELC.EndUse=_oFabricSalesContract.EndUse;
                        oELC.LightSourceID=_oFabricSalesContract.LightSourceID;
                        oELC.LightSourceName=_oFabricSalesContract.LightSourceName;
                        oELC.LightSourceIDTwo=_oFabricSalesContract.LightSourceIDTwo;
                        oELC.LightSourceNameTwo=_oFabricSalesContract.LightSourceNameTwo;
                    }
                    _oFabricSalesContract = oELC;
                    RefreshControl(_oFabricSalesContract);
                    alert("Data Save Succesfully!!");
                    $('#tabFSC').tabs('select', 1);
                    IsOwnDelivery();
                    //if (_oPurchaseOrder.PurchaseOrderDetails != null) {
                    //    DynamicRefreshList(_oPurchaseOrder.PurchaseOrderDetails, 'tblPODetail');
                    //}
                }
                else {
                    alert(oELC.ErrorMessage);
                }
            },
            error: function (xhr, status, error) {
                alert(error);
            }
        });
    });
    $("#btnSave_Copy").click(function (e) {

        endEditing();
        if (!ValidateInputFabricSalesContract()) return;
        var oFabricSalesContract = RefreshObjectFabricSalesContract();

        var nTotalAmount = 0;
        var oFabricSalesContractDetails = $("#tblFSCDetails").datagrid("getRows");
        for (var i = 0; i < oFabricSalesContractDetails.length; i++)
        {
            oFabricSalesContractDetails[i].FabricSalesContractDetailID=0;
            nTotalAmount = parseFloat(nTotalAmount) + parseFloat(oFabricSalesContractDetails[i].Amount);
        }
        oFabricSalesContract.FabricSalesContractID=0;
        oFabricSalesContract.SCNo="";
        oFabricSalesContract.FabricSalesContractDetails=oFabricSalesContractDetails;

        $("#btnSave_Copy").hide();
        $.ajax({
            type: "POST",
            dataType: "json",
            url: _sBaseAddress + "/FabricSalesContract/Save",
            traditional: true,
            data: JSON.stringify(oFabricSalesContract),
            contentType: "application/json; charset=utf-8",
            success: function (data) {
                debugger;
                var oELC = jQuery.parseJSON(data);

                if (oELC.ErrorMessage == "" || oELC.ErrorMessage == null) {
                    _oFabricSalesContract = oELC;
                    RefreshControl(_oFabricSalesContract);
                    alert("Data Save Succesfully!!");
                    $("#btnSave").show();
                    $('#tabFSC').tabs('select', 1);
                    IsOwnDelivery();
                    //if (_oPurchaseOrder.PurchaseOrderDetails != null) {
                    //    DynamicRefreshList(_oPurchaseOrder.PurchaseOrderDetails, 'tblPODetail');
                    //}
                }
                else {
                    alert(oELC.ErrorMessage);
                    $("#btnSave_Copy").show();
                }
            },
            error: function (xhr, status, error) {
                alert(error);
            }
        });
    });
    $("#btnSaveLog").click(function (e) {

        endEditing();
        if (!ValidateInputFabricSalesContract()) return;
        var oFabricSalesContract = RefreshObjectFabricSalesContract();
        if ($("#chkIsCreateReviseNo").is(':checked'))
        {
            oFabricSalesContract.IsRevise=true;

            if (!confirm("Confirm to Change this Order with Revise No ?")) return false;
        }else{
            oFabricSalesContract.IsRevise=false;
            if (!confirm("Confirm to Change this Order without Revise No ?")) return false;
        }

        $.ajax({
            type: "POST",
            dataType: "json",
            url: _sBaseAddress + "/FabricSalesContract/SaveLog",
            traditional: true,
            data: JSON.stringify(oFabricSalesContract),
            contentType: "application/json; charset=utf-8",
            success: function (data) {
                debugger;
                var oELC = jQuery.parseJSON(data);
                if (oELC.ErrorMessage == "" || oELC.ErrorMessage == null) {
                    _oFabricSalesContract = oELC;
                    RefreshControl(_oFabricSalesContract);
                    alert("Data Save Succesfully!!");
                    $('#tabFSC').tabs('select', 1);
                    IsOwnDelivery();
                    //if (_oPurchaseOrder.PurchaseOrderDetails != null) {
                    //    DynamicRefreshList(_oPurchaseOrder.PurchaseOrderDetails, 'tblPODetail');
                    //}
                }
                else {
                    alert(oELC.ErrorMessage);
                }
            },
            error: function (xhr, status, error) {
                alert(error);
            }
        });
    });
    $("#btnSaveTwo").click(function (){


        if (_oFabricSalesContract.FabricSalesContractID <= 0 || _oFabricSalesContract == null)
        {
            alert("Please, First save LC from  previous tab!");
            return ;
        }
        if (!ValidateInputFabricSalesContract()) return;


        if (_oFabricSalesContract.CurrentStatusInt>=3)
        {
            alert("Already approve");

            return false;
        }


        if (parseInt($("#cboOrderType").val())===3  && $("#cboLCTerm").val() <= 0) {

            alert("Please select LC Term!"); $('#cboLCTerm').focus();
            $("#cboLCTerm").addClass("errorFieldBorder");
            return ;
        }
        else { $("#cboLCTerm").removeClass("errorFieldBorder"); }
        var oFabricSalesContract = RefreshObjectFabricSalesContract_TnC();

        $.ajax({
            type: "POST",
            dataType: "json",
            url : _sBaseAddress+"/FabricSalesContract/SaveTwo",
            traditional: true,
            data:  JSON.stringify(oFabricSalesContract),
            contentType: "application/json; charset=utf-8",
            success: function (data) {
                debugger;
                var oFabricSalesContract= jQuery.parseJSON(data);
                oFabricSalesContract.FabricSalesContractDetails=_oFabricSalesContract.FabricSalesContractDetails;
                if (oFabricSalesContract.ErrorMessage=="" || oFabricSalesContract.ErrorMessage==null)
                {
                    _oFabricSalesContract=oFabricSalesContract;
                    RefreshControl(_oFabricSalesContract);
                    _oFabricSalesContractNotes=_oFabricSalesContract.FabricSalesContractNotes;
                    DynamicRefreshList(_oFabricSalesContractNotes, "tblFSCNots");

                    alert("Data Save Succesfully!!");
                    $('#tabFSC').tabs('select', 2);
                    var oFabricSalesContracts =sessionStorage.getItem("FabricSalesContracts");
                    var nIndex= parseInt(sessionStorage.getItem("SelectedRowIndex"));
                    debugger;
                    if(oFabricSalesContracts!=null)
                    {
                        oFabricSalesContracts = jQuery.parseJSON(oFabricSalesContracts);
                    }
                    else
                    {
                        oFabricSalesContracts=[];
                    }
                    if(nIndex!=-1)
                    {
                        oFabricSalesContracts[nIndex]=_oFabricSalesContract;
                    }
                    else
                    {
                        sessionStorage.setItem("SelectedRowIndex", oFabricSalesContracts.length);
                        oFabricSalesContracts.push(_oFabricSalesContract);
                    }
                    sessionStorage.setItem("FabricSalesContracts", JSON.stringify(oFabricSalesContracts));
                  //  window.location.href = _sBackLink;
                }
                else
                {
                    alert(oFabricSalesContract.ErrorMessage);
                }
            },
            error: function (xhr, status, error)
            {
                alert(error);
            }
        });
    });
    $("#btnSaveFSCNote").click(function (){
        debugger;
        endEditingTC();
        if (!ValidateInputFabricSalesContract()) return;

        if (_oFabricSalesContract.FabricSalesContractID <= 0 || _oFabricSalesContract == null)
        {
            alert("Please, First save Order from  previous tab!");
            return ;
        }
        if (_oFabricSalesContract.CurrentStatusInt>=3)
        {
            alert("Already approve");

            return false;
        }

        var oFabricSalesContractNotes = $("#tblFSCNots").datagrid("getRows");
        if (oFabricSalesContractNotes.length <= 0 || oFabricSalesContractNotes == null)
        {

            if (parseInt($("#cboOrderType").val())===3 || parseInt($("#cboOrderType").val())===2)
            {
                alert("Please, Pick Note(s)");
                return ;
            }
        }
        if(oFabricSalesContractNotes.length>0)
        {
            var oFabricSalesContract = {
                FabricSalesContractID: (_oFabricSalesContract != null) ? _oFabricSalesContract.FabricSalesContractID : 0,
                EndUse: $("#txtEndUse").val(),
                ContractorID: _oFabricSalesContract.ContractorID,
                BuyerID : _oFabricSalesContract.BuyerID,
                CurrencyID: parseInt($("#cboCurrency").val()),
                GarmentWash: $("#txtGarmentWash").val(),
                QualityParameters :  $("#txtQualityParameters").val(),
                Emirzing: "",
                QtyTolarance: $("#txtQtyTolarance").val(),
                LightSourceID:_oFabricSalesContract.LightSourceID,
                LightSourceIDTwo:_oFabricSalesContract.LightSourceIDTwo,
                LCTermID: parseInt($("#cboLCTerm").val()),
                FabricSalesContractNotes: oFabricSalesContractNotes
            };

            $.ajax({
                type: "POST",
                dataType: "json",
                url : _sBaseAddress+"/FabricSalesContractNote/Save_FSCNote",
                traditional: true,
                data:  JSON.stringify(oFabricSalesContract),
                contentType: "application/json; charset=utf-8",
                success: function (data) {
                    debugger;
                    var oFabricSalesContract= jQuery.parseJSON(data);
                    if (oFabricSalesContract.ErrorMessage=="" || oFabricSalesContract.ErrorMessage==null)
                    {

                        _oFabricSalesContractNotes=oFabricSalesContract.FabricSalesContractNotes;
                        DynamicRefreshList(_oFabricSalesContractNotes, "tblFSCNots");

                        alert("Data Save Succesfully!!");
                        var oFabricSalesContracts =sessionStorage.getItem("FabricSalesContracts");
                        var nIndex= parseInt(sessionStorage.getItem("SelectedRowIndex"));
                        debugger;
                        if(oFabricSalesContracts!=null)
                        {
                            oFabricSalesContracts = jQuery.parseJSON(oFabricSalesContracts);
                        }
                        else
                        {
                            oFabricSalesContracts=[];
                        }
                        if(nIndex!=-1)
                        {
                            oFabricSalesContracts[nIndex]=_oFabricSalesContract;
                        }
                        else
                        {
                            sessionStorage.setItem("SelectedRowIndex", oFabricSalesContracts.length);
                            oFabricSalesContracts.push(_oFabricSalesContract);
                        }
                        sessionStorage.setItem("FabricSalesContracts", JSON.stringify(oFabricSalesContracts));
                        window.location.href = _sBackLink;
                    }
                    else
                    {
                        alert(oFabricSalesContract.ErrorMessage);
                    }
                },
                error: function (xhr, status, error)
                {
                    alert(error);
                }
            });
        }
        else{
            window.location.href = _sBackLink;
        }
    });
    $("#btnApprove,#btnApproveTwo,#btnApproveThree").click(function (){

        if (!ValidateInputFabricSalesContract()) return;

        if (_oFabricSalesContract.FabricSalesContractID <= 0 || _oFabricSalesContract == null)
        {
            alert("Please, First save LC from  previous tab!");
            return ;
        }

        if (parseInt($("#cboOrderType").val())===3 &&  $("#cboLCTerm").val() <= 0) {
            $('#tabFSC').tabs('select', 1);
            alert("Please select LC Term!"); $('#cboLCTerm').focus();
            $("#cboLCTerm").addClass("errorFieldBorder");
            return ;
        }
        else { $("#cboLCTerm").removeClass("errorFieldBorder"); }
        var oFabricSalesContract = RefreshObjectFabricSalesContract();

        $.ajax({
            type: "POST",
            dataType: "json",
            url : _sBaseAddress+"/FabricSalesContract/Approved",
            traditional: true,
            data:  JSON.stringify(oFabricSalesContract),
            contentType: "application/json; charset=utf-8",
            success: function (data) {
                debugger;
                var oFabricSalesContract= jQuery.parseJSON(data);
                if (oFabricSalesContract.ErrorMessage=="" || oFabricSalesContract.ErrorMessage==null)
                {
                    _oFabricSalesContract=oFabricSalesContract;
                    alert("Approved Succesfully!!");
                    var oFabricSalesContracts =sessionStorage.getItem("FabricSalesContracts");
                    var nIndex= parseInt(sessionStorage.getItem("SelectedRowIndex"));
                    debugger;
                    if(oFabricSalesContracts!=null)
                    {
                        oFabricSalesContracts = jQuery.parseJSON(oFabricSalesContracts);
                    }
                    else
                    {
                        oFabricSalesContracts=[];
                    }
                    if(nIndex!=-1)
                    {
                        oFabricSalesContracts[nIndex]=_oFabricSalesContract;
                    }
                    else
                    {
                        sessionStorage.setItem("SelectedRowIndex", oFabricSalesContracts.length);
                        oFabricSalesContracts.push(_oFabricSalesContract);
                    }
                    sessionStorage.setItem("FabricSalesContracts", JSON.stringify(oFabricSalesContracts));
                    window.location.href = _sBackLink;
                }
                else
                {
                    alert(oFabricSalesContract.ErrorMessage);
                }
            },
            error: function (xhr, status, error)
            {
                alert(error);
            }
        });
    });

    $("#btnCancel").click(function (){

        if (!ValidateInputFabricSalesContract()) return;

        if (_oFabricSalesContract.FabricSalesContractID <= 0 || _oFabricSalesContract == null)
        {
            alert("Please,Order not found!");
            return ;
        }
        if($("#txtNote_Cancel").val()==null || $("#txtNote_Cancel").val()=="")
        {
            alert("Please type Cancel Reason!");
            $('#txtNote_Cancel').focus();
            return false;
        }

        var oFabricSalesContract = RefreshObjectFabricSalesContract();
        oFabricSalesContract.Note=$.trim($("#txtNote_Cancel").val());

        $.ajax({
            type: "POST",
            dataType: "json",
            url : _sBaseAddress+"/FabricSalesContract/Cancel",
            traditional: true,
            data:  JSON.stringify(oFabricSalesContract),
            contentType: "application/json; charset=utf-8",
            success: function (data) {
                debugger;
                var oFabricSalesContract= jQuery.parseJSON(data);
                if (oFabricSalesContract.ErrorMessage=="" || oFabricSalesContract.ErrorMessage==null)
                {
                    _oFabricSalesContract=oFabricSalesContract;
                    alert("Cancel Succesfully!!");
                    var oFabricSalesContracts =sessionStorage.getItem("FabricSalesContracts");
                    var nIndex= parseInt(sessionStorage.getItem("SelectedRowIndex"));
                    debugger;
                    if(oFabricSalesContracts!=null)
                    {
                        oFabricSalesContracts = jQuery.parseJSON(oFabricSalesContracts);
                    }
                    else
                    {
                        oFabricSalesContracts=[];
                    }
                    if(nIndex!=-1)
                    {
                        oFabricSalesContracts[nIndex]=_oFabricSalesContract;
                    }
                    else
                    {
                        sessionStorage.setItem("SelectedRowIndex", oFabricSalesContracts.length);
                        oFabricSalesContracts.push(_oFabricSalesContract);
                    }
                    sessionStorage.setItem("FabricSalesContracts", JSON.stringify(oFabricSalesContracts));
                    window.location.href = _sBackLink;
                }
                else
                {
                    alert(oFabricSalesContract.ErrorMessage);
                }
            },
            error: function (xhr, status, error)
            {
                alert(error);
            }
        });
    });

    $("#btnCheck").click(function (){

        if (!ValidateInputFabricSalesContract()) return;

        if (_oFabricSalesContract.FabricSalesContractID <= 0 || _oFabricSalesContract == null)
        {
            alert("Order not found!");
            return ;
        }
        var oFabricSalesContract = RefreshObjectFabricSalesContract();

        $.ajax({
            type: "POST",
            dataType: "json",
            url : _sBaseAddress+"/FabricSalesContract/Check",
            traditional: true,
            data:  JSON.stringify(oFabricSalesContract),
            contentType: "application/json; charset=utf-8",
            success: function (data) {
                debugger;
                var oFabricSalesContract= jQuery.parseJSON(data);
                if (oFabricSalesContract.ErrorMessage=="" || oFabricSalesContract.ErrorMessage==null)
                {
                    _oFabricSalesContract=oFabricSalesContract;
                    alert("Checked Succesfully!!");
                    var oFabricSalesContracts =sessionStorage.getItem("FabricSalesContracts");
                    var nIndex= parseInt(sessionStorage.getItem("SelectedRowIndex"));
                    debugger;
                    if(oFabricSalesContracts!=null)
                    {
                        oFabricSalesContracts = jQuery.parseJSON(oFabricSalesContracts);
                    }
                    else
                    {
                        oFabricSalesContracts=[];
                    }
                    if(nIndex!=-1)
                    {
                        oFabricSalesContracts[nIndex]=_oFabricSalesContract;
                    }
                    else
                    {
                        sessionStorage.setItem("SelectedRowIndex", oFabricSalesContracts.length);
                        oFabricSalesContracts.push(_oFabricSalesContract);
                    }
                    sessionStorage.setItem("FabricSalesContracts", JSON.stringify(oFabricSalesContracts));
                    window.location.href = _sBackLink;
                }
                else
                {
                    alert(oFabricSalesContract.ErrorMessage);
                }
            },
            error: function (xhr, status, error)
            {
                alert(error);
            }
        });
    });

    function ValidateInputFabricSalesContract() {


        if (_oFabricSalesContract.ContractorID <= 0) {
            alert("Please select Customer Name!");
            $('#txtContractorName').focus();
            $("#txtContractorName").addClass("errorFieldBorder");
            return false;
        } else { $("#txtContractorName").removeClass("errorFieldBorder"); }

        if ($('#txtSCDate').datebox('getValue') == null || $('#txtSCDate').datebox('getValue') == "") {
            alert("Please give LC Open Date!"); $('#txtSCDate').focus();
            return false;
        }

        if(parseInt($("#cboOrderType").val()) ==0)
        {
            alert("Please Type Order Type");
            $("#cboOrderType").addClass("errorFieldBorder");
            $("#cboOrderType").focus();
            return false;
        }else{
            $("#cboOrderType").removeClass("errorFieldBorder");
        }

        if (parseInt($("#cboOrderType").val())===11||parseInt($("#cboOrderType").val())===12||parseInt($("#cboOrderType").val())===13||parseInt($("#cboOrderType").val())===10||parseInt($("#cboOrderType").val())===3 || parseInt($("#cboOrderType").val())===2|| parseInt($("#cboOrderType").val())===9)
        {
            var nTotalQty = 0;
            var oFabricSalesContractDetails = $("#tblFSCDetails").datagrid("getRows");
            for (var i = 0; i < oFabricSalesContractDetails.length; i++)
            {
                if( parseFloat(oFabricSalesContractDetails[i].Qty)<=0)
                {
                    alert("Quentity Required");
                    return false;
                }
            }
        }
        if (parseInt($("#cboOrderType").val())===3 )
        {
            var nTotalQty = 0;
            var oFabricSalesContractDetails = $("#tblFSCDetails").datagrid("getRows");
            for (var i = 0; i < oFabricSalesContractDetails.length; i++)
            {
                if( parseFloat(oFabricSalesContractDetails[i].UnitPrice)<=0)
                {
                    alert("UnitPrice Required");
                    return false;
                }

            }
        }
        return true;
    }
    function RefreshObjectFabricSalesContract() {
        debugger;
        var nTotalAmount = 0;
        var oFabricSalesContractDetails = $("#tblFSCDetails").datagrid("getRows");
        for (var i = 0; i < oFabricSalesContractDetails.length; i++)
        {
            nTotalAmount = parseFloat(nTotalAmount) + parseFloat(oFabricSalesContractDetails[i].Amount);
            oFabricSalesContractDetails[i].SLNo = i+1;
        }
        var oFabricSalesContract = {
            FabricSalesContractID: (_oFabricSalesContract != null) ? _oFabricSalesContract.FabricSalesContractID : 0,
            SCNo: $("#txtSCNo").val(),
            ContractorID: _oFabricSalesContract.ContractorID,
            BuyerID : _oFabricSalesContract.BuyerID,
            CurrencyID: parseInt($("#cboCurrency").val()),
            ContactPersonnelID: parseInt($("#cboContractorContactPerson").val()),
            ContactPersonnelID_Buyer: parseInt($("#cboBuyerContactPerson").val()),
            SCDate: $('#txtSCDate').datebox('getValue'),
            Note: $.trim($("#txtNote").val()),
            MktAccountID:_oFabricSalesContract.MktAccountID,
            MktGroupID:_oFabricSalesContract.MktGroupID,
            OrderType:$("#cboOrderType").val(),
            //LCTramsID: parseInt($("#cboLCTerm").val()),
            IsInHouse: $("#chkIsInHouseYes").is(":checked"),
            IsOpenPI: $("#chkIsOpenPI").is(":checked"),
            IsPrint: $("#chkIsPrint").is(":checked"),
            Amount: parseFloat(nTotalAmount),//_oFabricSalesContract.Amount,
            BUID: _nBUID,
            IsRevise:false,
            LCTermID: parseInt($("#cboLCTerm").val()),
            PaymentInstruction: $("#cboPaymentInstruction").val(),
            FabricSalesContractDetails:oFabricSalesContractDetails,
            LightSourceID:_oFabricSalesContract.LightSourceID,
            LightSourceIDTwo:_oFabricSalesContract.LightSourceIDTwo

        };
        return oFabricSalesContract;
    }

    function RefreshObjectFabricSalesContract_TnC() {
        if (_oFabricSalesContract.ContractorID <= 0) {
            alert("Please select Customer Name!");
            $('#txtContractorName').focus();
            $('#tabFSC').tabs('select', 1);
            $("#txtContractorName").addClass("errorFieldBorder");
            return false;
        } else { $("#txtContractorName").removeClass("errorFieldBorder"); }


        if(_oFabricSalesContract.LightSourceID<=0)
        {
            _oFabricSalesContract.LightSourceID=_oFabricSalesContract.LightSourceIDTwo;
            _oFabricSalesContract.LightSourceIDTwo=0;
        }

        var oFabricSalesContract = {
            FabricSalesContractID: (_oFabricSalesContract != null) ? _oFabricSalesContract.FabricSalesContractID : 0,
            EndUse: $("#txtEndUse").val(),
            ContractorID: _oFabricSalesContract.ContractorID,
            BuyerID : _oFabricSalesContract.BuyerID,
            CurrencyID: parseInt($("#cboCurrency").val()),
            GarmentWash: $("#txtGarmentWash").val(),
            QualityParameters :  $("#txtQualityParameters").val(),
            Emirzing: "",
            QtyTolarance: $("#txtQtyTolarance").val(),
            LightSourceID:_oFabricSalesContract.LightSourceID,
            LightSourceIDTwo:_oFabricSalesContract.LightSourceIDTwo,
            LCTermID: parseInt($("#cboLCTerm").val()),
            PaymentInstruction: $("#cboPaymentInstruction").val()
        };
        return oFabricSalesContract;
    }
    function formatPricePrice(val,row){
        //debugger;
        if(val==null)
        {
            val=0.00;
        }
        val=parseFloat(val);
        var test = val.toFixed(4);
        var tests = addComma(test);
        return tests;
    }

    function addComma(nStr)
    {
        nStr += '';
        x = nStr.split('.');
        x1 = x[0];
        x2 = x.length > 1 ? '.' + x[1] : '';
        var rgx = /(\d+)(\d{3})/;
        while (rgx.test(x1)) {
            x1 = x1.replace(rgx, '$1' + ',' + '$2');
        }
        return x1 + x2;
    }
    function PriceFormateInString(nVal, nDigitAfterDot) {
        if (nVal == null) {
            nVal = 0.00;
        }
        nVal = parseFloat(nVal);
        var test = nVal.toFixed(nDigitAfterDot);
        var tests = addComma(test);
        return tests;
    }
    var editIndex = undefined;
    function endEditing() {

        if (editIndex == undefined) {
            return true;
        }
        debugger;
        if ($('#tblFSCDetails').datagrid('validateRow', editIndex)) {
            $('#tblFSCDetails').datagrid('endEdit', editIndex);
            $('#tblFSCDetails').datagrid('selectRow', editIndex);
            var sCurrency = "";
            var oPIDetail = $('#tblFSCDetails').datagrid('getSelected');
            if (parseInt($("#cboCurrency").val()) > 0) {
                for (var i = 0; i < _oCurrencys.length; i++) {

                    if (parseInt($("#cboCurrency").val()) == _oCurrencys[i].CurrencyID)
                    {
                        sCurrency= _oCurrencys[i].Symbol;
                        break;
                    }
                }
            }


            if (oPIDetail == null) {
                return;
            }
            oPIDetail.Amount = parseFloat(oPIDetail.Qty * oPIDetail.UnitPrice)
            oPIDetail.AmountSt =sCurrency+""+formatPrice(oPIDetail.Amount);

            //if (parseInt($("#cboTextileUnit").val()))

            if (parseFloat(oPIDetail.QtyTwo) != _nQtyTwo || parseFloat(oPIDetail.UnitPriceTwo) != _nUnitPriceTwo)
            {

                    oPIDetail.Qty =parseFloat(oPIDetail.QtyTwo *1.0936132983).toFixed(8);
                    oPIDetail.UnitPrice =parseFloat(oPIDetail.UnitPriceTwo/1.0936133).toFixed(8);
                    oPIDetail.Amount = parseFloat(oPIDetail.Qty * oPIDetail.UnitPrice);
                    oPIDetail.MUNameTwo = 'MTR'
                    oPIDetail.MUnitID = 17

            }
            else
            {
                oPIDetail.QtyTwo = parseFloat(oPIDetail.Qty / 1.0936132983).toFixed(8);
                oPIDetail.UnitPriceTwo = parseFloat(oPIDetail.UnitPrice*1.0936133).toFixed(8);
                oPIDetail.Amount = parseFloat(oPIDetail.Qty * oPIDetail.UnitPrice);
                oPIDetail.MUNameTwo = 'MTR'
                oPIDetail.MUnitID = 17
            }
            $('#tblFSCDetails').datagrid('updateRow', { index: editIndex, row: oPIDetail });

            RefreshTotalSummery();
            _nQty = 0.00;
            _nUnitPrice = 0.00;
            _nQtyTwo = 0.0000;
            _nUnitPriceTwo = 0.0000;
            _sDescription = "";

            editIndex = undefined;
            return true;
        }
        else {
            return false;
        }
    }

    var _nQty = 0.00;
    var _nUnitPrice = 0.00;
    var _nQtyTwo = 0.0000;
    var _nUnitPriceTwo = 0.000;
    var _sDescription = "";

    function onClickRow(index) {

        if (editIndex != index) {
            if (endEditing()) {
                $('#tblFSCDetails').datagrid('selectRow', index).datagrid('beginEdit', index);
                var oExportPIDetail = $('#tblFSCDetails').datagrid('getSelected');
                _nQty = parseFloat(oExportPIDetail.Qty).toFixed(2);
                _nUnitPrice = parseFloat(oExportPIDetail.UnitPrice).toFixed(2);
                _nQtyTwo = parseFloat(oExportPIDetail.QtyTwo).toFixed(8);
                _nUnitPriceTwo = parseFloat(oExportPIDetail.UnitPriceTwo).toFixed(8);
                _sDescription = oExportPIDetail.Description;
                editIndex = index;
            }
            else {
                $('#tblFSCDetails').datagrid('selectRow', editIndex);
            }
        }
    }

    //// TnC
    /// Pick Object
    $("#btnClrContractor").click(function () {
        $("#txtContractorName").val("");
        _oFabricSalesContract.ContractorID=0;
        $("#cboContractorContactPerson").empty();
    });
    $("#btnPickContractor").click(function () {
        if (parseInt($("#cboOrderType").val())===11 ||parseInt($("#cboOrderType").val())===12 ||parseInt($("#cboOrderType").val())===13 ||parseInt($("#cboOrderType").val())===10 || parseInt($("#cboOrderType").val())===3 || parseInt($("#cboOrderType").val())===2 || parseInt($("#cboOrderType").val())===9)
        {
            var oContractor = {
                Params: '3' + '~' + $.trim($("#txtContractorName").val()+'~'+_nBUID)
            };
        }
        else{
            var oContractor = {
                Params: '2' + '~' + $.trim($("#txtContractorName").val()+'~'+_nBUID)
            };
        }


        GetContractors(oContractor);
    });
    $("#txtContractorName").keydown(function (e) {
        var nkeyCode = e.keyCode || e.which;
        if(nkeyCode==13){
            var sContractorName=$.trim($("#txtContractorName").val());
            if(sContractorName=="" || sContractorName==null)
            {
                alert("Please, Type name or part of Name");
                $("#txtContractorName").focus();
                $("#txtContractorName").addClass("errorFieldBorder");
                return;
            }
            if (parseInt($("#cboOrderType").val())===11 ||parseInt($("#cboOrderType").val())===12 ||parseInt($("#cboOrderType").val())===13 || parseInt($("#cboOrderType").val())===10 || parseInt($("#cboOrderType").val())===3 || parseInt($("#cboOrderType").val())===2|| parseInt($("#cboOrderType").val())===9)
            {
                var oContractor = {
                    Params: '3' + '~' + $.trim($("#txtContractorName").val()+'~'+_nBUID)
                };
            }
            else{
                var oContractor = {
                    Params: '2' + '~' + $.trim($("#txtContractorName").val()+'~'+_nBUID)
                };
            }
            GetContractors(oContractor);
        }
        else if(nkeyCode==8){
            $("#txtContractorName").val("");
            _oFabricSalesContract.ContractorID=0;
            $("#cboContractorContactPerson").empty();
        }
    });
    function GetContractors(oContractor){


        var obj = {
            BaseAddress: _sBaseAddress,
            Object: oContractor,
            ControllerName: "Contractor",
            ActionName: "ContractorSearchByNameType",
            IsWinClose: false
        };
        $("#progressbar").progressbar({ value: 0 });
        $("#progressbarParent").show();
        var intervalID = setInterval(updateProgress, 250);
        $.icsDataGets(obj, function (response) {

            clearInterval(intervalID);
            $("#progressbarParent").hide();
            if (response.status && response.objs.length > 0) {
                if (response.objs[0].ContractorID > 0) {
                    debugger;
                    var tblColums = [];
                    var oColumn = { field: "ContractorID", title: "Code", width: 50, align: "center" };tblColums.push(oColumn);
                    oColumn = { field: "Name", title: "Name", width: 190, align: "left" };tblColums.push(oColumn);
                    oColumn = { field: "Phone", title: "Phone", width: 140, align: "left" };tblColums.push(oColumn);

                    var oPickerParam = {
                        winid: 'winContractorPicker',
                        winclass:'clsContractorPicker',
                        winwidth: 460,
                        winheight: 460,
                        tableid: 'tblContractorPicker',
                        tablecolumns: tblColums,
                        datalist: response.objs,
                        multiplereturn: false,
                        searchingbyfieldName:'Name',
                        windowTittle: 'Contractor List'
                    };
                    $.icsPicker(oPickerParam);
                    IntializePickerbutton(oPickerParam);//multiplereturn, winclassName
                }
                else { alert(response.objs[0].ErrorMessage); }
            }
            else{
                alert("No contractor found.");
            }
        });
    }

    $("#btnClrBuyingHouse").click(function () {
        $("#txtBuyingHouse").val("");
        _oFabricSalesContract.BuyerID=0;
        $("#cboBuyerContactPerson").empty();
    });
    $("#btnPickBuyingHouse").click(function () {

        var oContractor = {
            Params: '2' + '~' + $.trim($("#txtBuyingHouse").val()+'~'+_nBUID)
        };
        GetBuyingHouse(oContractor);
    });
    $("#txtBuyingHouse").keydown(function (e) {
        var nkeyCode = e.keyCode || e.which;
        if(nkeyCode==13){
            var sContractorName=$.trim($("#txtBuyingHouse").val());
            if(sContractorName=="" || sContractorName==null)
            {
                alert("Please, Type name or part of Name");
                $("#txtBuyingHouse").focus();
                $("#txtBuyingHouse").addClass("errorFieldBorder");
                return;
            }
            var oContractor = {
                Params: '2' + '~' + $.trim($("#txtBuyingHouse").val()+'~'+_nBUID)
            };
            GetBuyingHouse(oContractor);
        }
        else if(nkeyCode==8){
            $("#txtBuyingHouse").val("");
            _oFabricSalesContract.BuyerID=0;
            $("#txtBuyingHouse").empty();
            $("#cboBuyerContactPerson").empty();

        }
    });
    function GetBuyingHouse(oContractor){


        var obj = {
            BaseAddress: _sBaseAddress,
            Object: oContractor,
            ControllerName: "Contractor",
            ActionName: "ContractorSearchByNameType",
            IsWinClose: false
        };
        $("#progressbar").progressbar({ value: 0 });
        $("#progressbarParent").show();
        var intervalID = setInterval(updateProgress, 250);
        $.icsDataGets(obj, function (response) {
            clearInterval(intervalID);
            $("#progressbarParent").hide();
            if (response.status && response.objs.length > 0)
            {
                if (response.objs[0].ContractorID > 0) {
                    debugger;
                    var tblColums = [];
                    var oColumn = { field: "ContractorID", title: "Code", width: 50, align: "center" };tblColums.push(oColumn);
                    oColumn = { field: "Name", title: "Name", width: 190, align: "left" };tblColums.push(oColumn);
                    oColumn = { field: "Phone", title: "Phone", width: 140, align: "left" };tblColums.push(oColumn);

                    var oPickerParam = {
                        winid: 'winBuyingHousePicker',
                        winclass:'clsBuyingHousePicker',
                        winwidth: 460,
                        winheight: 460,
                        tableid: 'tblBuyingHousePicker',
                        tablecolumns: tblColums,
                        datalist: response.objs,
                        multiplereturn: false,
                        searchingbyfieldName:'Name',
                        windowTittle: 'Buying House List'
                    };
                    $.icsPicker(oPickerParam);
                    IntializePickerbutton(oPickerParam);//multiplereturn, winclassName
                }
                else { alert(response.objs[0].ErrorMessage); }
            }
            else{
                alert("No contractor found.");
            }
        });
    }


    $("#btnPickDeliveryTo").click(function () {

            var oContractor = {
                Params: '3' + '~' + $.trim($("#txtDeliveryToName").val()+'~'+_nBUID)
            };
            GetDeliveryTo(oContractor);
    });
    $("#txtDeliveryToName").keydown(function (e) {
        var nkeyCode = e.keyCode || e.which;
        if(nkeyCode==13){
            var sContractorName=$.trim($("#txtDeliveryToName").val());
            if(sContractorName=="" || sContractorName==null)
            {
                alert("Please, Type name or part of Name");
                $("#txtDeliveryToName").focus();
                $("#txtDeliveryToName").addClass("errorFieldBorder");
                return;
            }

            var oContractor = {
                Params: '3' + '~' + $.trim($("#txtDeliveryToName").val()+'~'+_nBUID)
            };

            GetDeliveryTo(oContractor);
        }
        else if(nkeyCode==8){
            $("#txtDeliveryToName").val("");
            _nDeliveryToID=0;

        }
    });
    function GetDeliveryTo(oContractor){


        var obj = {
            BaseAddress: _sBaseAddress,
            Object: oContractor,
            ControllerName: "Contractor",
            ActionName: "ContractorSearchByNameType",
            IsWinClose: false
        };
        $("#progressbar").progressbar({ value: 0 });
        $("#progressbarParent").show();
        var intervalID = setInterval(updateProgress, 250);
        $.icsDataGets(obj, function (response) {
            clearInterval(intervalID);
            $("#progressbarParent").hide();
            if (response.status && response.objs.length > 0) {
                if (response.objs[0].ContractorID > 0) {
                    debugger;
                    var tblColums = [];
                    var oColumn = { field: "ContractorID", title: "Code", width: 50, align: "center" };tblColums.push(oColumn);
                    oColumn = { field: "Name", title: "Name", width: 150, align: "left" };tblColums.push(oColumn);
                    oColumn = { field: "Address", title: "Address", width: 140, align: "left" };tblColums.push(oColumn);
                    oColumn = { field: "Address2", title: "Address(Ho)", width: 140, align: "left" };tblColums.push(oColumn);
                    oColumn = { field: "Address3", title: "Address(Factory)", width: 140, align: "left" };tblColums.push(oColumn);
                    var oPickerParam = {
                        winid: 'winDeliverToPicker',
                        winclass:'clsDeliverToPicker',
                        winwidth: 600,
                        winheight: 460,
                        tableid: 'tblDeliverToPicker',
                        tablecolumns: tblColums,
                        datalist: response.objs,
                        multiplereturn: false,
                        searchingbyfieldName:'Name',
                        windowTittle: 'Delivert To List'
                    };
                    $.icsPicker(oPickerParam);
                    IntializePickerbutton(oPickerParam);//multiplereturn, winclassName
                }
                else { alert(response.objs[0].ErrorMessage); }
            }
            else{
                alert("No contractor found.");
            }
        });
    }
    //Fabric Pick
    $("#txtFabricNo").keydown(function (e) {
        debugger;
        var code = (e.keyCode ? e.keyCode : e.which);
        if (code == 13) // Enter Press
        {
            if($('#txtFabricNo').val()==null || $('#txtFabricNo').val()=="")
            {
                alert("Please Type Product and Press Enter.");
                $('#txtFabricNo').focus();
                return;
            }
            if(parseInt($("#cboOrderType").val())!=13 &&parseInt($("#cboOrderType").val())!=10 && parseInt($("#cboOrderType").val())!=3 && parseInt($("#cboOrderType").val())!=2 && parseInt($("#cboOrderType").val())!=9)
            {
                if( parseInt($("#cboHandLoomType").val())<=0)
                {
                    alert("Invalid Selection!!! please select a valid Size!");
                    $('#cboHandLoomType').focus();
                    return ;
                }
            }
            var oFabric = {
                FabricNo: $.trim($("#txtFabricNo").val()),
                BuyerID: 0,
                BuyerName:""
            };
            PickFabricInExportPI(oFabric);

        }
        if (code == 8) //backspace=8
        {
            //debugger;
            $("#txtFabricNo").removeClass("fontColorOfPickItem");

        }
    });
    $("#btnPicFabricNo").click(function () {

        if(parseInt($("#cboOrderType").val())==1 && parseInt($("#cboHandLoomType").val())<=0)
        {
            alert("Invalid Selection!!! please select a valid Size!");
            $('#cboHandLoomType').focus();
            $("#cboHandLoomType").addClass("errorFieldBorder");
            return ;
        }
        if(parseInt(_oFabricSalesContract.BuyerID)<=0 && parseInt(_oFabricSalesContract.ContractorID)<=0)
        {
            alert("Invalid Selection!!! please first select Factory/Buyer Name!");
            $('#txtContractorName').focus();
            $("#txtContractorName").addClass("errorFieldBorder");
            return ;
        }
        else {
            $("#txtContractorName").removeClass("errorFieldBorder");
        }


        var oFabric = {
            FabricNo: $.trim($("#txtFabricNo").val()),
            BuyerID: 0,
            BuyerName:_oFabricSalesContract.BuyerID+","+_oFabricSalesContract.ContractorID
        };
        PickFabricInExportPI(oFabric);
    });

    function PickFabricInExportPI(oFabric) {

        var obj = {
            BaseAddress: _sBaseAddress,
            Object: oFabric,
            ControllerName: "Fabric",
            ActionName: "GetsFabricsForPI",
            IsWinClose: false
        };
        $("#progressbar").progressbar({ value: 0 });
        $("#progressbarParent").show();
        var sNoCode=_oFabricPOSetup.NoCode;
        var intervalID = setInterval(updateProgress, 250);
        $.icsDataGets(obj, function (response)
        {
            clearInterval(intervalID);
            $("#progressbarParent").hide();
            debugger;
            if (response.status && response.objs.length > 0) {
                if (response.objs[0].FabricID > 0) {
                    var tblColums = [];
                    var oColumn = { field: "FabricNo", title: _oFabricPOSetup.NoCode+" Number", width: 100, align: "left" }; tblColums.push(oColumn);
                    oColumn = { field: "BuyerName", title: "Buyer Name", width: 250, align: "left" }; tblColums.push(oColumn);
                    oColumn = { field: "IssueDateInString", title: "Issue Date", width: 100, align: "left" }; tblColums.push(oColumn);
                    oColumn = { field: "Construction", title: "Construction", width: 100, align: "left" }; tblColums.push(oColumn);
                    oColumn = { field: "StyleNo", title: "StyleNo", width: 100, align: "left" }; tblColums.push(oColumn);
                    oColumn = { field: "FinishTypeName", title: "Finish Type", width: 100, align: "left" }; tblColums.push(oColumn);
                    oColumn = { field: "ColorInfo", title: "Color", width: 100, align: "left" }; tblColums.push(oColumn);
                    oColumn = { field: "FabricWeaveName", title: "Weave", width: 100, align: "left" }; tblColums.push(oColumn);
                    oColumn = { field: "FabricWidth", title: "Width", width: 100, align: "left" }; tblColums.push(oColumn);

                    var oPickerParam = {
                        winid: 'winFabricPicker',
                        winclass: 'clsFabricPicker',
                        winwidth: 700,
                        winheight: 460,
                        tableid: 'tblFabricPicker',
                        tablecolumns: tblColums,
                        datalist: response.objs,
                        multiplereturn: true,
                        searchingbyfieldName: 'FabricNo',
                        windowTittle: _oFabricPOSetup.NoCode+' List'
                    };
                    $.icsPicker(oPickerParam);
                    IntializePickerbutton(oPickerParam);
                }
                else {
                    alert(response.objs[0].ErrorMessage);
                }

            }else{
                alert("Data Not Found.");
            }
        });
    }
    // Pick PI

    ///// Open PI

    $("#txtPINo_Open").keydown(function (e) {
        debugger;
        var code = (e.keyCode ? e.keyCode : e.which);
        if (code == 13) // Enter Press
        {
            //if($('#txtPINo_Open').val()==null || $('#txtPINo_Open').val()=="")
            //{
            //    alert("Please Type Product and Press Enter.");
            //    $('#txtPINo_Open').focus();
            //    return;
            //}

            var oFabricSalesContract = {
                PINo: $.trim($("#txtPINo_Open").val()),
                ContractorID:_oFabricSalesContract.ContractorID,
                BuyerID:_oFabricSalesContract.BuyerID,
                BUID:_nBUID,
                Params:""
            };
            PickExportPI_Open(oFabricSalesContract);

        }
        if (code == 8) //backspace=8
        {
            //debugger;
            $("#txtPINo_Open").removeClass("fontColorOfPickItem");

        }
    });
    $("#btnPicPINo_Open").click(function () {

        if(parseInt($("#cboOrderType").val())==1 && parseInt($("#cboHandLoomType").val())<=0)
        {
            alert("Invalid Selection!!! please select a valid Size!");
            $('#cboHandLoomType').focus();
            $("#cboHandLoomType").addClass("errorFieldBorder");
            return ;
        }
        if(parseInt(_oFabricSalesContract.ExportPIID)<=0)
        {
            alert("Invalid Selection!!! please first Pick PI !");
            $('#txtPINo_Open').focus();
            $("#txtPINo_Open").addClass("errorFieldBorder");
            return ;
        }
        else {
            $("#txtPINo_Open").removeClass("errorFieldBorder");
        }
        if(parseInt(_oFabricSalesContract.BuyerID)<=0 && parseInt(_oFabricSalesContract.ContractorID)<=0)
        {
            alert("Invalid Selection!!! please first select Factory/Buyer Name!");
            $('#txtContractorName').focus();
            $("#txtContractorName").addClass("errorFieldBorder");
            return ;
        }
        else {
            $("#txtContractorName").removeClass("errorFieldBorder");
        }


        var oFabricSalesContract = {
            PINo: $.trim($("#txtPINo_Open").val()),
            ContractorID:_oFabricSalesContract.ContractorID,
            ExportPIID:_oFabricSalesContract.ExportPIID,
            BuyerID:_oFabricSalesContract.BuyerID,
            BUID:_nBUID,
            Params:""
        };
        PickExportPI_OpenDetail(oFabricSalesContract);
    });

    function PickExportPI_Open(oFabricSalesContract) {

        var obj = {
            BaseAddress: _sBaseAddress,
            Object: oFabricSalesContract,
            ControllerName: "FabricSalesContract",
            ActionName: "GetsOpenPI",
            IsWinClose: false
        };
        $("#progressbar").progressbar({ value: 0 });
        $("#progressbarParent").show();
        //var sNoCode=_oFabricPOSetup.NoCode;
        var intervalID = setInterval(updateProgress, 250);
        $.icsDataGets(obj, function (response)
        {
            clearInterval(intervalID);
            $("#progressbarParent").hide();
            debugger;
            if (response.status && response.objs.length > 0) {
                if (response.objs[0].ExportPIID>0) {
                    var tblColums = [];
                    var oColumn = { field: "PINo",  title: "P/I No", width: 150, align: "left" }; tblColums.push(oColumn);
                    oColumn = { field: "ContractorName", title: "ContractorName", width: 150, align: "left" }; tblColums.push(oColumn);
                    oColumn = { field: "BuyerName", title: "BuyerName", width: 100, align: "left" }; tblColums.push(oColumn);
                    oColumn = { field: "Qty", title: "Qty(Y)", width: 100, align: "left" }; tblColums.push(oColumn);
                    var oPickerParam = {
                        winid: 'winExportPIPicker',
                        winclass: 'clsExportPIPicker',
                        winwidth: 700,
                        winheight: 460,
                        tableid: 'tblExportPIPicker',
                        tablecolumns: tblColums,
                        datalist: response.objs,
                        multiplereturn: false,
                        searchingbyfieldName: 'PINo',
                        windowTittle:'PINo List'
                    };
                    $.icsPicker(oPickerParam);
                    IntializePickerbutton(oPickerParam);
                }
                else {
                    alert(response.objs[0].ErrorMessage);
                }

            }else{
                alert("Data Not Found.");
            }
        });
    }
    function PickExportPI_OpenDetail(oFabricSalesContract) {

        var obj = {
            BaseAddress: _sBaseAddress,
            Object: oFabricSalesContract,
            ControllerName: "FabricSalesContract",
            ActionName: "GetsOpenPIFabric",
            IsWinClose: false
        };
        $("#progressbar").progressbar({ value: 0 });
        $("#progressbarParent").show();
        //var sNoCode=_oFabricPOSetup.NoCode;
        var intervalID = setInterval(updateProgress, 250);
        $.icsDataGets(obj, function (response)
        {
            clearInterval(intervalID);
            $("#progressbarParent").hide();
            debugger;
            if (response.status && response.objs.length > 0) {
                if (response.objs[0].ExportPIDetailID>0) {
                    var tblColums = [];
                    var oColumn = { field: "FabricNo", title: _oFabricPOSetup.NoCode+" Number", width: 100, align: "left" }; tblColums.push(oColumn);
                    oColumn = { field: "PINo", title: "P/I No", width: 150, align: "left" }; tblColums.push(oColumn);
                    //oColumn = { field: "IssueDateInString", title: "Issue Date", width: 100, align: "left" }; tblColums.push(oColumn);
                    oColumn = { field: "Construction", title: "Construction", width: 100, align: "left" }; tblColums.push(oColumn);
                    oColumn = { field: "StyleNo", title: "StyleNo", width: 100, align: "left" }; tblColums.push(oColumn);
                    oColumn = { field: "FinishTypeName", title: "Finish Type", width: 100, align: "left" }; tblColums.push(oColumn);
                    oColumn = { field: "ColorInfo", title: "Color", width: 100, align: "left" }; tblColums.push(oColumn);
                    oColumn = { field: "FabricWeaveName", title: "Weave", width: 100, align: "left" }; tblColums.push(oColumn);
                    oColumn = { field: "FabricWidth", title: "Width", width: 100, align: "left" }; tblColums.push(oColumn);

                    var oPickerParam = {
                        winid: 'winExportPIDetailPicker',
                        winclass: 'clsExportPIDetailPicker',
                        winwidth: 700,
                        winheight: 460,
                        tableid: 'tblExportPIDetailPicker',
                        tablecolumns: tblColums,
                        datalist: response.objs,
                        multiplereturn: true,
                        searchingbyfieldName: 'FabricNo',
                        windowTittle: _oFabricPOSetup.NoCode+' List'
                    };
                    $.icsPicker(oPickerParam);
                    IntializePickerbutton(oPickerParam);
                }
                else {
                    alert(response.objs[0].ErrorMessage);
                }

            }else{
                alert("Data Not Found.");
            }
        });
    }

    /// End Ope PI


    $("#btnResetMktPerson").click(function () {
        $("#txtMktAccount").val("");
        _oFabricSalesContract.MktAccountID=0;
    });

    $("#btnPickMktAccount").click(function () {
        debugger;
        var sName=$.trim($("#txtMktAccount").val());
        GetMktPersons(sName);
    });

    $("#txtMktAccount").keydown(function (e) {
        var nkeyCode = e.keyCode || e.which;
        if(nkeyCode==13){
            var sName=$.trim($("#txtMktAccount").val());
            //if($('#txtMktAccount').val()==null || $('#txtMktAccount').val()=="")
            //{
            //    alert("Please Type Name or part Name and Press Enter.");
            //    $('#txtMktAccount').focus();
            //    return;
            //}
            GetMktPersons(sName);
        }
        else if(nkeyCode==8){
            $("#txtMktAccount").val("");
            _oFabricSalesContract.MktAccountID=0;
        }
    });

    function GetMktPersons(sName){

        var oMarketingAccount_BU = {
            Name:sName,
            BUID:sessionStorage.getItem("BUID")
        };
        var obj = {
            BaseAddress: _sBaseAddress,
            Object: oMarketingAccount_BU,
            ControllerName: "MarketingAccount",
            ActionName: "GetsMktByUser",
            IsWinClose: false
        };
        $("#progressbar").progressbar({ value: 0 });
        $("#progressbarParent").show();
        var intervalID = setInterval(updateProgress, 250);
        $.icsDataGets(obj, function (response) {
            clearInterval(intervalID);
            $("#progressbarParent").hide();
            if (response.status && response.objs.length > 0) {
                if (response.objs[0].MarketingAccountID > 0) {
                    debugger;
                    var tblColums = [];
                    var oColumn = { field: "MarketingAccountID", title: "Code", width: 50, align: "left" };tblColums.push(oColumn);
                    oColumn = { field: "Name", title: "Name", width: 180, align: "left" };tblColums.push(oColumn);
                    oColumn = { field: "GroupName", title: "Group Name", width: 120, align: "left" };tblColums.push(oColumn);
                    oColumn = { field: "Phone", title: "Phone", width: 100, align: "left" };tblColums.push(oColumn);

                    var oPickerParam = {
                        winid: 'winMktAccount',
                        winclass:'clsMktPersonPicker',
                        winwidth: 460,
                        winheight: 460,
                        tableid: 'tblMktPersonPicker',
                        tablecolumns: tblColums,
                        datalist: response.objs,
                        multiplereturn: false,
                        searchingbyfieldName:'Name',
                        windowTittle: 'MKT Person List'
                    };
                    $.icsPicker(oPickerParam);
                    IntializePickerbutton(oPickerParam);//multiplereturn, winclassName
                }
                else { alert(response.objs[0].ErrorMessage); }
            }
            else{
                alert("No marketing person found.");
            }
        });


    }

    $("#btnResetMktGroup").click(function () {
        $("#txtMktGroup").val("");
        _oFabricSalesContract.MktGroupID=0;
    });

    $("#btnPickMktGroup").click(function () {
        debugger;
        var sName=$.trim($("#txtMktGroup").val());
        GetMktGroups(sName);
    });

    $("#txtMktGroup").keydown(function (e) {
        var nkeyCode = e.keyCode || e.which;
        if(nkeyCode==13){
            var sName=$.trim($("#txtMktGroup").val());
            //if($('#txtMktGroup').val()==null || $('#txtMktGroup').val()=="")
            //{
            //    alert("Please Type Name or part Name and Press Enter.");
            //    $('#txtMktGroup').focus();
            //    return;
            //}
            GetMktGroups(sName);
        }
        else if(nkeyCode==8){
            $("#txtMktGroup").val("");
            _oFabricSalesContract.MktGroupID=0;
        }
    });

    function GetMktGroups(sName){

        var oMarketingAccount_BU = {
            Name:sName,
            BUID:sessionStorage.getItem("BUID")
        };
        var obj = {
            BaseAddress: _sBaseAddress,
            Object: oMarketingAccount_BU,
            ControllerName: "MarketingAccount",
            ActionName: "GetsAllGroup",
            IsWinClose: false
        };
        $("#progressbar").progressbar({ value: 0 });
        $("#progressbarParent").show();
        var intervalID = setInterval(updateProgress, 250);
        $.icsDataGets(obj, function (response) {
            clearInterval(intervalID);
            $("#progressbarParent").hide();
            if (response.status && response.objs.length > 0) {
                if (response.objs[0].MarketingAccountID > 0) {
                    debugger;
                    var tblColums = [];
                    var oColumn = { field: "MarketingAccountID", title: "Code", width: 50, align: "left" };tblColums.push(oColumn);
                    oColumn = { field: "Name", title: "Name", width: 180, align: "left" };tblColums.push(oColumn);
                    oColumn = { field: "GroupName", title: "Group Name", width: 120, align: "left" };tblColums.push(oColumn);
                    oColumn = { field: "Phone", title: "Phone", width: 100, align: "left" };tblColums.push(oColumn);

                    var oPickerParam = {
                        winid: 'winMktGroup',
                        winclass:'clsMktgroupPicker',
                        winwidth: 460,
                        winheight: 460,
                        tableid: 'tblMktGroupPicker',
                        tablecolumns: tblColums,
                        datalist: response.objs,
                        multiplereturn: false,
                        searchingbyfieldName:'Name',
                        windowTittle: 'MKT Group List'
                    };
                    $.icsPicker(oPickerParam);
                    IntializePickerbutton(oPickerParam);//multiplereturn, winclassName
                }
                else { alert(response.objs[0].ErrorMessage); }
            }
            else{
                alert("No marketing person found.");
            }
        });


    }

    ////LD///
    $("#btnResetLDNon").click(function () {

        $("#txtLDNo").val("");
        _nFNLabDipDetailID=0;
    });

    $("#btnPickLDNo").click(function () {
        debugger;
        var sName=$.trim($("#txtLDNo").val());
        GetsLabDip(sName);
    });

    $("#txtLDNo").keydown(function (e) {
        var nkeyCode = e.keyCode || e.which;
        if(nkeyCode==13){

            var sName=$.trim($("#txtLDNo").val());
            //if($('#txtMktAccount').val()==null || $('#txtMktAccount').val()=="")
            //{
            //    alert("Please Type Name or part Name and Press Enter.");
            //    $('#txtMktAccount').focus();
            //    return;
            //}
            GetsLabDip(sName);
        }
        else if(nkeyCode==8){
            $("#txtLDNo").val("");
            _nFNLabDipDetailID=0;
        }
    });

    function GetsLabDip(sName){
        debugger
        //alert($('#divFSCDetail').data('FSCDetail').FabricID);
        var oFNLabDipDetail = {
            LabdipNo:sName,
            FabricID:$('#divFSCDetail').data('FSCDetail').FabricID
        };
        var obj = {
            BaseAddress: _sBaseAddress,
            Object: oFNLabDipDetail,
            ControllerName: "FNLabDipDetail",
            ActionName: "GetbyLDNo",
            IsWinClose: false
        };
        //$("#progressbar").progressbar({ value: 0 });
        //$("#progressbarParent").show();
        //var intervalID = setInterval(updateProgress, 250);
        $.icsDataGets(obj, function (response)
        {
            //clearInterval(intervalID);
            //$("#progressbarParent").hide();
            if (response.status && response.objs.length > 0) {
                if (response.objs[0].FNLabDipDetailID > 0) {
                    debugger;
                    var tblColums = [];
                    var oColumn = { field: "LabdipNo", title: "LabdipNo", width: 100, align: "left" };tblColums.push(oColumn);
                    oColumn = { field: "ColorName", title: "ColorName", width: 180, align: "left" };tblColums.push(oColumn);
                    oColumn = { field: "PantonNo", title: "PantonNo", width: 120, align: "left" };tblColums.push(oColumn);
                    oColumn = { field: "FabricNo", title: "Fabric", width: 120, align: "left" };tblColums.push(oColumn);

                    var oPickerParam = {
                        winid: 'winFNLabDipDetail',
                        winclass:'clsFNLabDipDetailPicker',
                        winwidth: 460,
                        winheight: 460,
                        tableid: 'tblFNLabDipDetailPicker',
                        tablecolumns: tblColums,
                        datalist: response.objs,
                        multiplereturn: false,
                        searchingbyfieldName:'LabdipNo',
                        windowTittle: 'Labdip List'
                    };
                    $.icsPicker(oPickerParam);
                    IntializePickerbutton(oPickerParam);//multiplereturn, winclassName
                }
                else { alert(response.objs[0].ErrorMessage); }
            }
            else{
                alert("Data not found.");
            }
        });


    }
    ////LD///


    $("#btnPickLightSource").click(function () {
        debugger;
        var sName=$.trim($("#txtLightSource").val());
        GetLightSources(sName);
    });

    $("#txtLightSource").keydown(function (e) {
        var nkeyCode = e.keyCode || e.which;
        if(nkeyCode==13){
            var sName=$.trim($("#txtLightSource").val());
            //if(sName==null ||sName=="")
            //{
            //    alert("Please Type Name or part Name and Press Enter.");
            //    $('#txtLightSource').focus();
            //    return;
            //}
            GetLightSources(sName);
        }
        else if(nkeyCode==8){
            $("#txtLightSource").val("");
            _oFabricSalesContract.LightSourceID=0;
        }
    });
    function GetLightSources(sName){

        var oLightSource = {
            Descriptions:sName
        };
        var obj = {
            BaseAddress: _sBaseAddress,
            Object: oLightSource,
            ControllerName: "LightSource",
            ActionName: "GetsLightSource",
            IsWinClose: false
        };
        $("#progressbar").progressbar({ value: 0 });
        $("#progressbarParent").show();
        var intervalID = setInterval(updateProgress, 250);
        $.icsDataGets(obj, function (response) {
            clearInterval(intervalID);
            $("#progressbarParent").hide();
            if (response.status && response.objs.length > 0) {
                if (response.objs[0].LightSourceID > 0) {
                    debugger;
                    var tblColums = [];
                    var oColumn = { field: "LightSourceID", title: "Code", width: 50, align: "left" };tblColums.push(oColumn);
                    oColumn = { field: "Descriptions", title: "Name", width: 250, align: "left" };tblColums.push(oColumn);

                    var oPickerParam = {
                        winid: 'winLightSource',
                        winclass:'clsLightSourcePicker',
                        winwidth: 460,
                        winheight: 460,
                        tableid: 'tblLightSourcePicker',
                        tablecolumns: tblColums,
                        datalist: response.objs,
                        multiplereturn: false,
                        searchingbyfieldName:'Descriptions',
                        windowTittle: 'LightSource List'
                    };
                    $.icsPicker(oPickerParam);
                    IntializePickerbutton(oPickerParam);//multiplereturn, winclassName
                }
                else { alert(response.objs[0].ErrorMessage); }
            }
            else{
                alert("No marketing person found.");
            }
        });


    }



    $("#btnPickLightSourceTwo").click(function () {
        debugger;
        if( _oFabricSalesContract.LightSourceID<=0)
        {
            alert("Primary Lighi source is empty!!!");
            $('#txtLightSource').focus();
            $("#txtLightSource").addClass("errorFieldBorder");
            return;
        }
        var sName=$.trim($("#txtLightSourceTwo").val());
        GetLightSourcesTwo(sName);
    });

    $("#txtLightSourceTwo").keydown(function (e) {
        var nkeyCode = e.keyCode || e.which;
        if(nkeyCode==13){

            if( _oFabricSalesContract.LightSourceID<=0 ||  _oFabricSalesContract.LightSourceID==null)
            {
                alert("Primary Lighi source is empty!!!");
                $('#txtLightSource').focus();
                $("#txtLightSource").addClass("errorFieldBorder");
                return;
            }
            var sName=$.trim($("#txtLightSourceTwo").val());

            GetLightSourcesTwo(sName);
        }
        else if(nkeyCode==8){
            $("#txtLightSourceTwo").val("");
            _oFabricSalesContract.LightSourceIDTwo=0;
        }
    });
    function GetLightSourcesTwo(sName){

        var oLightSource = {
            Descriptions:sName
        };
        var obj = {
            BaseAddress: _sBaseAddress,
            Object: oLightSource,
            ControllerName: "LightSource",
            ActionName: "GetsLightSource",
            IsWinClose: false
        };
        $("#progressbar").progressbar({ value: 0 });
        $("#progressbarParent").show();
        var intervalID = setInterval(updateProgress, 250);
        $.icsDataGets(obj, function (response) {
            clearInterval(intervalID);
            $("#progressbarParent").hide();
            if (response.status && response.objs.length > 0) {
                if (response.objs[0].LightSourceID > 0) {
                    debugger;
                    var tblColums = [];
                    var oColumn = { field: "LightSourceID", title: "Code", width: 50, align: "left" };tblColums.push(oColumn);
                    oColumn = { field: "Descriptions", title: "Name", width: 250, align: "left" };tblColums.push(oColumn);

                    var oPickerParam = {
                        winid: 'winLightSourceTwo',
                        winclass:'clsLightSourceTwoPicker',
                        winwidth: 460,
                        winheight: 460,
                        tableid: 'tblLightSourcePickerTwo',
                        tablecolumns: tblColums,
                        datalist: response.objs,
                        multiplereturn: false,
                        searchingbyfieldName:'Descriptions',
                        windowTittle: 'LightSource List'
                    };
                    $.icsPicker(oPickerParam);
                    IntializePickerbutton(oPickerParam);//multiplereturn, winclassName
                }
                else { alert(response.objs[0].ErrorMessage); }
            }
            else{
                alert("No marketing person found.");
            }
        });


    }


    $("#btnClrEndUser").click(function () {

        $("#txtEndUse").val("");
        _oFabricSalesContract.EndUse="";
    });

    $("#btnPickEndUse").click(function () {
        debugger;
        var sName=$.trim($("#txtEndUse").val());
        //if(sName==null ||sName=="")
        //{
        //    alert("Please Type Name or part Name and Press Enter.");
        //    $('#txtEndUse').focus();
        //    return;
        //}
        var oFabricSalesContract= {
            EndUse:sName
        };
        GetsDistingItem(oFabricSalesContract);
    });

    $("#txtEndUse").keydown(function (e) {
        var nkeyCode = e.keyCode || e.which;
        if(nkeyCode==13){
            var sName=$.trim($("#txtEndUse").val());

            var oFabricSalesContract= {
                EndUse:'EndUse',
                Params:sName
            };
            GetsDistingItem(oFabricSalesContract);
        }
        else if(nkeyCode==8){
            //$("#txtEndUse").val("");
            _oFabricSalesContract.EndUse="";
            _oFabricSalesContract.Params="";
        }
    });
    function GetsDistingItem(oFabricSalesContract){

        var obj = {
            BaseAddress: _sBaseAddress,
            Object: oFabricSalesContract,
            ControllerName: "FabricSalesContract",
            ActionName: "GetsDistingItem",
            IsWinClose: false
        };
        $("#progressbar").progressbar({ value: 0 });
        $("#progressbarParent").show();
        var intervalID = setInterval(updateProgress, 250);
        $.icsDataGets(obj, function (response) {
            clearInterval(intervalID);
            $("#progressbarParent").hide();
            if (response.status && response.objs.length > 0) {
                if (response.objs[0].FabricSalesContractID > 0) {
                    debugger;
                    var tblColums = [];
                    var oColumn = { field: "EndUse", title: "Name", width: 250, align: "left" };tblColums.push(oColumn);

                    var oPickerParam = {
                        winid: 'winEndUse',
                        winclass:'clsEndUsePicker',
                        winwidth: 460,
                        winheight: 460,
                        tableid: 'tblEndUsePicker',
                        tablecolumns: tblColums,
                        datalist: response.objs,
                        multiplereturn: false,
                        searchingbyfieldName:'EndUse',
                        windowTittle: 'End Use List'
                    };
                    $.icsPicker(oPickerParam);
                    IntializePickerbutton(oPickerParam);//multiplereturn, winclassName
                }
                else { alert(response.objs[0].ErrorMessage); }
            }
            else{
                alert("No End Use found.");
            }
        });


    }

    $("#btnClrQualityParameters").click(function () {

        $("#txtQualityParameters").val("");
        _oFabricSalesContract.QualityParameters="";
    });

    $("#btnPickQualityParameters").click(function () {
        debugger;
        var sName=$.trim($("#txtQualityParameters").val());
        //if(sName==null ||sName=="")
        //{
        //    alert("Please Type Name or part Name and Press Enter.");
        //    $('#txtQualityParameters').focus();
        //    return;
        //}
        var oFabricSalesContract= {
            QualityParameters:'QualityParameters'
        };
        GetsDistingItemQP(oFabricSalesContract);
    });

    $("#txtQualityParameters").keydown(function (e) {
        var nkeyCode = e.keyCode || e.which;
        if(nkeyCode==13){
            var sName=$.trim($("#txtQualityParameters").val());
            var oFabricSalesContract= {
                QualityParameters:'QualityParameters',
                Params:sName
            };
            GetsDistingItemQP(oFabricSalesContract);
        }
        else if(nkeyCode==8){
            //$("#txtQualityParameters").val("");
            _oFabricSalesContract.QualityParameters='';
            _oFabricSalesContract.Params='';
        }
    });
    function GetsDistingItemQP(oFabricSalesContract){

        var obj = {
            BaseAddress: _sBaseAddress,
            Object: oFabricSalesContract,
            ControllerName: "FabricSalesContract",
            ActionName: "GetsDistingItem",
            IsWinClose: false
        };
        $("#progressbar").progressbar({ value: 0 });
        $("#progressbarParent").show();
        var intervalID = setInterval(updateProgress, 250);
        $.icsDataGets(obj, function (response) {
            clearInterval(intervalID);
            $("#progressbarParent").hide();
            if (response.status && response.objs.length > 0) {
                if (response.objs[0].FabricSalesContractID > 0) {
                    debugger;
                    var tblColums = [];
                    var oColumn = { field: "QualityParameters", title: "Name", width: 250, align: "left" };tblColums.push(oColumn);

                    var oPickerParam = {
                        winid: 'winQP',
                        winclass:'clsQPPicker',
                        winwidth: 460,
                        winheight: 460,
                        tableid: 'tblQPPicker',
                        tablecolumns: tblColums,
                        datalist: response.objs,
                        multiplereturn: false,
                        searchingbyfieldName:'QualityParameters',
                        windowTittle: 'Quality Parameters List'
                    };
                    $.icsPicker(oPickerParam);
                    IntializePickerbutton(oPickerParam);//multiplereturn, winclassName
                }
                else { alert(response.objs[0].ErrorMessage); }
            }
            else{
                alert("No End Use found.");
            }
        });


    }


    $("#btnClrQtyTolarance").click(function () {

        $("#txtQtyTolarance").val("");
        _oFabricSalesContract.QtyTolarance="";
    });

    $("#btnPickQtyTolarance").click(function () {
        debugger;
        var sName=$.trim($("#txtQualityParameters").val());
        //if(sName==null ||sName=="")
        //{
        //    alert("Please Type Name or part Name and Press Enter.");
        //    $('#txtQtyTolarance').focus();
        //    return;
        //}
        var oFabricSalesContract= {
            QtyTolarance:sName
        };
        GetsDistingItemQtyTolarance(oFabricSalesContract);
    });

    $("#txtQtyTolarance").keydown(function (e) {
        var nkeyCode = e.keyCode || e.which;
        if(nkeyCode==13){
            var sName=$.trim($("#txtQtyTolarance").val());
            //if(sName==null ||sName=="")
            //{
            //    alert("Please Type Name or part Name and Press Enter.");
            //    $('#txtQtyTolarance').focus();
            //    return;
            //}
            var oFabricSalesContract= {
                QtyTolarance:'QtyTolarance',
                Params:sName
            };
            GetsDistingItemQtyTolarance(oFabricSalesContract);
        }
        else if(nkeyCode==8){
            //$("#txtQtyTolarance").val("");
            _oFabricSalesContract.QtyTolarance='';
            _oFabricSalesContract.Params='';
        }
    });
    function GetsDistingItemQtyTolarance(oFabricSalesContract){

        var obj = {
            BaseAddress: _sBaseAddress,
            Object: oFabricSalesContract,
            ControllerName: "FabricSalesContract",
            ActionName: "GetsDistingItem",
            IsWinClose: false
        };
        $("#progressbar").progressbar({ value: 0 });
        $("#progressbarParent").show();
        var intervalID = setInterval(updateProgress, 250);
        $.icsDataGets(obj, function (response) {
            clearInterval(intervalID);
            $("#progressbarParent").hide();
            if (response.status && response.objs.length > 0) {
                if (response.objs[0].FabricSalesContractID > 0) {
                    debugger;
                    var tblColums = [];
                    var oColumn = { field: "QtyTolarance", title: "Name", width: 250, align: "left" };tblColums.push(oColumn);

                    var oPickerParam = {
                        winid: 'winQtyTolarance',
                        winclass:'clsQtyTolarancePicker',
                        winwidth: 460,
                        winheight: 460,
                        tableid: 'tblQtyTolarancePicker',
                        tablecolumns: tblColums,
                        datalist: response.objs,
                        multiplereturn: false,
                        searchingbyfieldName:'QtyTolarance',
                        windowTittle: 'Qty Tolerance List'
                    };
                    $.icsPicker(oPickerParam);
                    IntializePickerbutton(oPickerParam);//multiplereturn, winclassName
                }
                else {  alert("Data not found."); }
            }
            else{
                alert("No QtyTolarance found.");
            }
        });


    }



    $("#btnClrGarmentWash").click(function () {
        //$("#txtGarmentWash").val("");
        _oFabricSalesContract.GarmentWash="";
    });

    $("#btnPickGarmentWash").click(function () {
        debugger;
        var sName=$.trim($("#txtGarmentWash").val());
        var oFabricSalesContract= {
            GarmentWash:"GarmentWash",
            Params:sName
        };
        GetsDistingItem_GarmentWash(oFabricSalesContract);
    });

    $("#txtGarmentWash").keydown(function (e) {
        var nkeyCode = e.keyCode || e.which;
        if(nkeyCode==13){
            var sName=$.trim($("#txtGarmentWash").val());

            var oFabricSalesContract= {
                GarmentWash:"GarmentWash",
                Params:sName
            };
            GetsDistingItem_GarmentWash(oFabricSalesContract);
        }
        else if(nkeyCode==8){
            //$("#txtGarmentWash").val("");
            _oFabricSalesContract.GarmentWash="";
            _oFabricSalesContract.Params="";
        }
    });
    function GetsDistingItem_GarmentWash(oFabricSalesContract){

        var obj = {
            BaseAddress: _sBaseAddress,
            Object: oFabricSalesContract,
            ControllerName: "FabricSalesContract",
            ActionName: "GetsDistingItem",
            IsWinClose: false
        };
        $("#progressbar").progressbar({ value: 0 });
        $("#progressbarParent").show();
        var intervalID = setInterval(updateProgress, 250);
        $.icsDataGets(obj, function (response) {
            clearInterval(intervalID);
            $("#progressbarParent").hide();
            if (response.status && response.objs.length > 0) {
                if (response.objs[0].FabricSalesContractID > 0) {
                    debugger;
                    var tblColums = [];
                    var oColumn = { field: "GarmentWash", title: "Name", width: 250, align: "left" };tblColums.push(oColumn);

                    var oPickerParam = {
                        winid: 'winGarmentWash',
                        winclass:'clsGarmentWashPicker',
                        winwidth: 460,
                        winheight: 460,
                        tableid: 'tblGarmentWashPicker',
                        tablecolumns: tblColums,
                        datalist: response.objs,
                        multiplereturn: false,
                        searchingbyfieldName:'GarmentWash',
                        windowTittle: 'Garment Wash Type List'
                    };
                    $.icsPicker(oPickerParam);
                    IntializePickerbutton(oPickerParam);//multiplereturn, winclassName
                }
                else { alert(response.objs[0].ErrorMessage); }
            }
            else{
                alert("No End Use found.");
            }
        });


    }


    /// End Pick PI
    function IntializePickerbutton(oPickerobj) {
        $("#" + oPickerobj.winid).find("#btnOk").click(function () {
            //for Single Select
            SetPickerValueAssign(oPickerobj);
        });
        $(document).find('.' + oPickerobj.winclass).keydown(function (e) {
            if (e.which == 13)//enter=13
            {
                SetPickerValueAssign(oPickerobj);
            }
        });
    }

    function SetPickerValueAssign(oPickerobj) {
        debugger;
        var oreturnObj = null, oreturnobjs = [];
        if (oPickerobj.multiplereturn) {
            oreturnobjs = $('#' + oPickerobj.tableid).datagrid('getChecked');
        } else {
            oreturnObj = $('#' + oPickerobj.tableid).datagrid('getSelected');
        }
        $("#" + oPickerobj.winid).icsWindow("close");
        $("#" + oPickerobj.winid).remove();
        if (oPickerobj.winid == 'winContractorPicker') {
            if (oreturnObj != null && oreturnObj.ContractorID > 0)
            {
                $('#txtContractorName').val(oreturnObj.Name);
                _oFabricSalesContract.ContractorID= oreturnObj.ContractorID;
                GetContactPerson(_oFabricSalesContract.ContractorID,true);
            }
            else{
                alert("Data not found");
            }
        }
        else if (oPickerobj.winid == 'winBuyingHousePicker') {
            if (oreturnObj != null && oreturnObj.ContractorID > 0)
            {
                debugger;
                $('#txtBuyingHouse').val(oreturnObj.Name);
                _oFabricSalesContract.BuyerID= oreturnObj.ContractorID;
                GetContactPerson(_oFabricSalesContract.BuyerID,false);
            }
            else{
                alert("Data not found");
            }
        }
        else if (oPickerobj.winid == 'winDeliverToPicker') {
            if (oreturnObj != null && oreturnObj.ContractorID > 0)
            {
                debugger;
                $('#txtDeliveryToName').val(oreturnObj.Name);
                _nDeliveryToID= oreturnObj.ContractorID;
            }
            else{
                alert("Data not found");
            }
        }
        else  if (oPickerobj.winid == 'winExportPIPicker')
        {
            if (oreturnObj != null && oreturnObj.ExportPIID > 0)
            {
                if ( oreturnObj.ExportPIID > 0)
                {
                    if (_oFabricSalesContract.ContractorID == 0) {
                        _oFabricSalesContract.ContractorID = oreturnObj.ContractorID;
                        if (_oFabricSalesContract.ContractorID > 0)
                        {
                            $("#txtContractorName").addClass("fontColorOfPickItem");
                            $("#txtContractorName").val(oreturnObj.ContractorName);
                            $("#cboLCTerm").val(oreturnObj.LCTermID);
                            //$("#cboLCTerm").val(oreturnObj.LCTermID);
                        }
                        if (_oFabricSalesContract.BuyerID<=0)
                        {
                            _oFabricSalesContract.BuyerID = oreturnObj.BuyerID;
                            $("#txtBuyingHouse").val(oreturnObj.BuyerName);
                        }

                    }

                    if (parseInt($("#cboCurrency").val()) == 0) {
                        $("#cboCurrency").val(oreturnObj.CurrencyID);
                    }
                    _oFabricSalesContract.ExportPIID = oreturnObj.ExportPIID;
                    $('#txtPINo_Open').val(oreturnObj.PINo);
                    $('#txtPINo_Open').focus();

                }
                //PickPIFabricSalesContract(oreturnObj);
            }
            else{
                alert("Data not found");
            }
        }
        else if (oPickerobj.winid=='winMktAccount')
        {
            if(oreturnObj!=null && parseInt(oreturnObj.MarketingAccountID)>0)
            {
                var txtMktAccount = document.getElementById("txtMktAccount");
                txtMktAccount.style.color = "blue";
                txtMktAccount.style.fontWeight = "bold";
                $('#txtMktAccount').val(oreturnObj.Name);
                _oFabricSalesContract.MktAccountID= oreturnObj.MarketingAccountID;
            }
            else{
                alert("Data Not Found.");
            }
        }
        else if (oPickerobj.winid=='winMktGroup')
        {
            if(oreturnObj!=null && parseInt(oreturnObj.MarketingAccountID)>0)
            {
                var txtMktGroup = document.getElementById("txtMktGroup");
                txtMktGroup.style.color = "blue";
                txtMktGroup.style.fontWeight = "bold";
                $('#txtMktGroup').val(oreturnObj.Name);
                _oFabricSalesContract.MktGroupID= oreturnObj.MarketingAccountID;
            }
            else{
                alert("Data Not Found.");
            }
        }
        else if (oPickerobj.winid=='winFNLabDipDetail')
        {

            if(oreturnObj!=null && parseInt(oreturnObj.FNLabDipDetailID)>0)
            {
                var txtLDNo = document.getElementById("txtLDNo");
                txtLDNo.style.color = "blue";
                txtLDNo.style.fontWeight = "bold";
                $('#txtLDNo').val(oreturnObj.LabdipNo);
                $('#txtColorFabric').val(oreturnObj.ColorName);

                _nFNLabDipDetailID= oreturnObj.FNLabDipDetailID;

            }
            else{
                alert("Data Not Found.");
            }
        }
        else if (oPickerobj.winid=='winLightSource')
        {
            if(oreturnObj!=null && parseInt(oreturnObj.LightSourceID)>0)
            {
                var txtName = document.getElementById("txtLightSource");
                txtName.style.color = "blue";
                txtName.style.fontWeight = "bold";
                $('#txtLightSource').val(oreturnObj.Descriptions);
                _oFabricSalesContract.LightSourceID= oreturnObj.LightSourceID;
                $('#txtLightSourceTwo').focus();
                $("#txtLightSourceTwo").addClass("errorFieldBorder");
            }
            else{
                alert("Data Not Found.");
            }
        }
        else if (oPickerobj.winid=='winLightSourceTwo')
        {
            if(oreturnObj!=null && parseInt(oreturnObj.LightSourceID)>0)
            {
                var txtName = document.getElementById("txtLightSourceTwo");
                txtName.style.color = "blue";
                txtName.style.fontWeight = "bold";
                $('#txtLightSourceTwo').val(oreturnObj.Descriptions);
                _oFabricSalesContract.LightSourceIDTwo= oreturnObj.LightSourceID;
                $('#txtQualityParameters').focus();
                $("#txtQualityParameters").addClass("errorFieldBorder");
            }
            else{
                alert("Data Not Found.");
            }
        }
        else if (oPickerobj.winid=='winEndUse')
        {
            if(oreturnObj!=null && parseInt(oreturnObj.FabricSalesContractID)>0)
            {
                var txtName = document.getElementById("txtEndUse");
                txtName.style.color = "blue";
                txtName.style.fontWeight = "bold";
                $('#txtEndUse').val(oreturnObj.EndUse);
                $('#txtLightSource').focus();
                $("#txtLightSource").addClass("errorFieldBorder");
            }
            else{
                alert("Data Not Found.");
            }
        }
        else if (oPickerobj.winid=='winQP')
        {
            if(oreturnObj!=null && parseInt(oreturnObj.FabricSalesContractID)>0)
            {
                var txtName = document.getElementById("txtQualityParameters");
                txtName.style.color = "blue";
                txtName.style.fontWeight = "bold";
                $('#txtQualityParameters').val(oreturnObj.QualityParameters);
                $('#txtQtyTolarance').focus();
                $("#txtQtyTolarance").addClass("errorFieldBorder");
            }
            else{
                alert("Data Not Found.");
            }
        }
        else if (oPickerobj.winid=='winQtyTolarance')
        {
            if(oreturnObj!=null && parseInt(oreturnObj.FabricSalesContractID)>0)
            {
                var txtName = document.getElementById("txtQtyTolarance");
                txtName.style.color = "blue";
                txtName.style.fontWeight = "bold";
                $('#txtQtyTolarance').val(oreturnObj.QtyTolarance);
                $('#txtGarmentWash').focus();
                $("#txtGarmentWash").addClass("errorFieldBorder");
            }
            else{
                alert("Data Not Found.");
            }
        }
        else if (oPickerobj.winid=='winGarmentWash')
        {
            if(oreturnObj!=null && parseInt(oreturnObj.FabricSalesContractID)>0)
            {
                var txtName = document.getElementById("txtGarmentWash");
                txtName.style.color = "blue";
                txtName.style.fontWeight = "bold";
                $('#txtGarmentWash').val(oreturnObj.GarmentWash);

            }
            else{
                alert("Data Not Found.");
            }
        }
        else if (oPickerobj.winid == 'winFabricPicker')
        {
            if (oreturnobjs!= null && oreturnobjs.length> 0)
            {
                $('#txtFabricNo').val(oreturnobjs.length+" Item Selected.");
                $('#txtFabricNo').addClass('fontColorOfPickItem');
                debugger;
                var oFabrics  = oreturnobjs;
                for(var i =0;i<oFabrics.length;i++)
                {
                    if(_oFabricSalesContract.MktAccountID<=0 || _oFabricSalesContract.MktAccountID==null)
                    {
                        var txtMktAccount = document.getElementById("txtMktAccount");
                        txtMktAccount.style.color = "blue";
                        txtMktAccount.style.fontWeight = "bold";
                        $('#txtMktAccount').val(oFabrics[i].MKTPersonName);
                        _oFabricSalesContract.MktAccountID= oFabrics[i].MKTPersonID;
                    }
                    if(_oFabricSalesContract.MktGroupID<=0 || _oFabricSalesContract.MktGroupID==null)
                    {
                        var txtMktGroup = document.getElementById("txtMktGroup");
                        txtMktGroup.style.color = "blue";
                        txtMktGroup.style.fontWeight = "bold";
                        $('#txtMktGroup').val(oFabrics[i].MKTPersonName);
                        _oFabricSalesContract.MktGroupID= oFabrics[i].MKTPersonID;
                    }
                    if(_oFabricSalesContract.LightSourceID<=0 || _oFabricSalesContract.LightSourceID==null)
                    {
                        _oFabricSalesContract.LightSourceID= oFabrics[i].PrimaryLightSourceID;
                        _oFabricSalesContract.LightSourceName= oFabrics[i].PrimaryLightSource;
                        $('#txtLightSource').val( _oFabricSalesContract.LightSourceName);
                    }
                    if(_oFabricSalesContract.LightSourceIDTwo<=0 || _oFabricSalesContract.LightSourceIDTwo==null)
                    {
                        _oFabricSalesContract.LightSourceIDTwo= oFabrics[i].SecondaryLightSourceID;
                        _oFabricSalesContract.LightSourceNameTwo= oFabrics[i].SecondaryLightSource;
                        $('#txtLightSourceTwo').val( _oFabricSalesContract.LightSourceNameTwo);
                    }
                    if( _oFabricSalesContract.EndUse==null||  _oFabricSalesContract.EndUse=="")
                    {
                        _oFabricSalesContract.EndUse= oFabrics[i].EndUse;
                        $('#txtEndUse').val( _oFabricSalesContract.EndUse);
                    }

                    if(parseInt($("#cboOrderType").val())===1 && parseInt($("#cboHandLoomType").val())<=0)
                    {
                        alert("Invalid Selection!!! please select a valid Size!");
                        $('#cboHandLoomType').focus();
                        return ;
                    }
                    var ncboPaymentType = document.getElementById("cboHandLoomType");
                    var selectedText = ncboPaymentType.options[ncboPaymentType.selectedIndex].text;
                    var sIsPr="";
                    if($("#chkIsProduction").is(":checked"))
                    {
                        sIsPr="Production";
                    }
                    else{
                        sIsPr="Only Sale";
                    }
                    debugger;
                    var   oFabricSalesContractDetail= {
                        ExportPIDetailID : 0,
                        ExportPIID: 0,
                        ProductID: oFabrics[i].ProductID,
                        Qty :0.00,
                        UnitPrice:0.00,
                        QtyTwo:0.0000,
                        UnitPriceTwo:0.0000,
                        FabricID : oFabrics[i].FabricID,
                        FabricNo: oFabrics[i].FabricNo,
                        MUnitID: oFabrics[i].MUID,
                        MUName:oFabrics[i].MUName,
                        ProductCode :oFabrics[i].ProductCode,
                        ProductName :oFabrics[i].ProductName,
                        Construction: oFabrics[i].Construction,
                        StyleNo: oFabrics[i].StyleNo,
                        BuyerReference :oFabrics[i].BuyerReference,
                        ColorInfo :oFabrics[i].ColorInfo,
                        ProcessType :oFabrics[i].ProcessType,
                        FinishType :oFabrics[i].FinishType,
                        FabricWeave :oFabrics[i].FabricWeave,
                        FabricDesignID :oFabrics[i].FabricDesignID,
                        FabricDesignName :oFabrics[i].FabricDesignName,
                        FabricWidth:oFabrics[i].FabricWidth,
                        Note :oFabrics[i].Remarks,
                        Weight:oFabrics[i].WeightDec,
                        Size:selectedText,
                        IsProduction:$("#chkIsProduction").is(":checked"),
                        IsBWash:false,
                        IsProductionSt:sIsPr,
                        ExeNo:'',
                        Amount:0
                    };
                    var bExists= IsExist_Fabric(oFabrics[i].FabricID)
                    if(!bExists)
                    {
                        $('#tblFSCDetails').datagrid('appendRow',oFabricSalesContractDetail);
                    }
                    if(bExists)
                    {
                        if (confirm('Are you sure you want to add duplicate P ?'))
                        {
                            $('#tblFSCDetails').datagrid('appendRow',oFabricSalesContractDetail);
                        }
                    }

                }
                RefreshTotalSummery();

                $('#txtFabricNo').val("");
                $('#txtFabricNo').focus();


            }
        }
        else if (oPickerobj.winid == 'winExportPIDetailPicker')
        {
            if (oreturnobjs!= null && oreturnobjs.length> 0)
            {
                $('#txtPINo_Open').val(oreturnobjs.length+" Item Selected.");
                $('#txtPINo_Open').addClass('fontColorOfPickItem');

                var oFabricSalesContractDetails  = oreturnobjs;
                for(var i =0;i<oFabricSalesContractDetails.length;i++)
                {
                    if(_oFabricSalesContract.MktAccountID<=0 || _oFabricSalesContract.MktAccountID==null)
                    {
                        var txtMktAccount = document.getElementById("txtMktAccount");
                        txtMktAccount.style.color = "blue";
                        txtMktAccount.style.fontWeight = "bold";
                        $('#txtMktAccount').val(oFabricSalesContractDetails[i].MKTPersonName);
                        _oFabricSalesContract.MktAccountID= oFabricSalesContractDetails[i].MKTPersonID;
                    }
                    if(_oFabricSalesContract.MktGroupID<=0 || _oFabricSalesContract.MktGroupID==null)
                    {
                        var txtMktGroup = document.getElementById("txtMktGroup");
                        txtMktGroup.style.color = "blue";
                        txtMktGroup.style.fontWeight = "bold";
                        $('#txtMktGroup').val(oFabricSalesContractDetails[i].MKTPersonName);
                        _oFabricSalesContract.MktGroupID= oFabricSalesContractDetails[i].MKTPersonID;
                    }

                    if(parseInt($("#cboOrderType").val())===1 && parseInt($("#cboHandLoomType").val())<=0)
                    {
                        alert("Invalid Selection!!! please select a valid Size!");
                        $('#cboHandLoomType').focus();
                        return ;
                    }
                    var ncboPaymentType = document.getElementById("cboHandLoomType");
                    var selectedText = ncboPaymentType.options[ncboPaymentType.selectedIndex].text;
                    var sIsPr="";
                    if($("#chkIsProduction").is(":checked"))
                    {
                        sIsPr="Production";
                    }
                    else{
                        sIsPr="Only Sale";
                    }
                    debugger;

                    var bExists= IsExist_Fabric(oFabricSalesContractDetails[i].FabricID)
                    if(!bExists)
                    {
                        $('#tblFSCDetails').datagrid('appendRow',oFabricSalesContractDetails[i]);
                    }
                    if(bExists)
                    {
                        if (confirm('Are you sure you want to add duplicate No ?'))
                        {
                            $('#tblFSCDetails').datagrid('appendRow',oFabricSalesContractDetails[i]);
                        }
                    }

                }
                RefreshTotalSummery();

                $('#txtPINo_Open').val("");
                $('#txtPINo_Open').focus();


            }
        }
        else
        {
            alert("Data not found");
            return false;
        }
    }

    function IsExist_Fabric(nFabricID)
    {
        var oFSCDetails = $('#tblFSCDetails').datagrid('getRows');
        for (var i = 0; i < oFSCDetails.length; i++) {
            if (parseInt(oFSCDetails[i].FabricID) == parseInt(nFabricID))
            {
                return true;
            }
        }
        return false;
    }

    $("#btnRemoveDetail").click(function () {
        var oFSCDetails = $("#tblFSCDetails").datagrid("getSelected");
        if (oFSCDetails == null) { alert("Please select an item from list!"); return false; }
        if (oFSCDetails.ExeNo!='') { alert("Already Dispo Issue, You can't remove it.(But Revise it)!"); return false;}
        var nIndex=$('#tblFSCDetails').datagrid('getRowIndex',oFSCDetails);
        if (!confirm("Confirm to Delete?")) return false;
        $("#tblFSCDetails").datagrid("deleteRow", nIndex);
        RefreshTotalSummery();
        editIndex = undefined;
    });


    $('#btnClose,#btnCloseTwo,#btnCloseThree').click(function(e){
        window.location.href = sessionStorage.getItem("BackLink");
    });

    function AddContactPerson(bIsBuyer) {
        _bIsBuyer = bIsBuyer;
        if(bIsBuyer)
        {
            if (parseInt(_oFabricSalesContract.ContractorID) <= 0)
            {
                alert("Please select Buyer!");
                $('#txtContractorName').focus();
                return;
            }
        }else{
            if (parseInt(_oFabricSalesContract.BuyerID) <= 0)
            {
                alert("Please select Delivery To!");
                $('#txtBuyingHouse').focus();
                return;
            }
        }
        $("#winContactPersonnel").icsWindow('open', "Add Contact Person");
        $("#winContactPersonnel input").not("input[type='button']").val("");
    }

    function ValidateInputContactPersonnel()
    {
        if(document.getElementById("txtName").value==null || document.getElementById("txtName").value=="")
        {
            alert("Please enter name!");
            $('#txtName').focus();
            return false;
        }

        if(document.getElementById("txtPhone").value==null || document.getElementById("txtPhone").value=="")
        {
            alert("Please enter phone number!");
            $('#txtPhone').focus();
            return false;
        }
        return true;
    }

    function RefreshObjectCP()
    {
        debugger;
        var oContactPersonnel= {
            ContactPersonnelID : 0,
            ContractorID : (_bIsBuyer==true)? _oFabricSalesContract.ContractorID:_oFabricSalesContract.BuyerID,
            Name : $("#txtName").val(),
            Address : $("#txtAddress").val(),
            Phone :$("#txtPhone").val(),
            Email : $("#txtEmail").val(),
            Note : $("#txtNote").val()
        };
        return oContactPersonnel;
    }

    function AddContactPersonnel()
    {
        debugger;
        if(!ValidateInputContactPersonnel()) return;
        var oContactPersonnel=RefreshObjectCP();
        $.ajax({
            type: "POST",
            dataType: "json",
            url : _sBaseAddress+  "/Contractor/SaveContactPersonnel",
            traditional: true,
            data:  JSON.stringify(oContactPersonnel),
            contentType: "application/json; charset=utf-8",
            success: function (data) {
                //debugger;
                _oContactPersonnel = jQuery.parseJSON(data);
                if(parseInt(_oContactPersonnel.ContactPersonnelID)>0)
                {
                    alert("Data Saved sucessfully");
                    document.getElementById("txtName").value="";
                    document.getElementById("txtAddress").value="";
                    document.getElementById("txtPhone").value="";
                    document.getElementById("txtEmail").value="";
                    document.getElementById("txtNote").value="";
                    $("#winContactPersonnel").icsWindow('close');
                    if(_bIsBuyer)
                    {
                        GetContactPerson(_oFabricSalesContract.ContractorID,true);//load Buyer Contact peron
                    }else
                    {
                        GetContactPerson(_oFabricSalesContract.BuyerID,false);//load Accounts of contactperson
                    }
                }
                else {
                    alert(_oContactPersonnel.ErrorMessage);
                }
            },
            error: function (xhr, status, error) {
                alert(error);
            }

        });
    }

    function CloseContactPersonnel()
    {
        $("#winContactPersonnel").icsWindow('close');
    }


    function GetContactPerson(nContractorID, bIsBuyer) {
        debugger;
        var oContractor = {ContractorID:nContractorID};
        $.ajax
           ({
               type: "POST",
               dataType: "json",
               url: _sBaseAddress + "/Contractor/GetContactPersonnels",
               traditional: true,
               data:  JSON.stringify(oContractor),
               contentType: "application/json; charset=utf-8",
               success: function (data) {
                   //debugger;
                   var _oContactPersonnels = jQuery.parseJSON(data);
                   if (_oContactPersonnels != null)
                   {
                       if(!bIsBuyer)
                       {
                           $("#cboBuyerContactPerson").icsLoadCombo({List: _oContactPersonnels,OptionValue: "ContactPersonnelID",DisplayText: "Name"});
                           $('#cboBuyerContactPerson').val(_oFabricSalesContract.ContactPersonnelID_Buyer);
                       }else{
                           $("#cboContractorContactPerson").icsLoadCombo({List: _oContactPersonnels,OptionValue: "ContactPersonnelID",DisplayText: "Name"});
                           $('#cboContractorContactPerson').val(_oFabricSalesContract.ContactPersonnelID);
                       }

                   }
                   else {
                       if(!bIsBuyer)
                       {
                           $("#cboBuyerContactPerson").icsLoadCombo({List: _oContactPersonnels,OptionValue: "ContactPersonnelID",DisplayText: "Name"});
                       }else{
                           $("#cboContractorContactPerson").icsLoadCombo({List: _oContactPersonnels,OptionValue: "ContactPersonnelID",DisplayText: "Name"});
                       }
                   }
               },
               error: function (xhr, status, error) {
                   alert(error);
               }

           });

    }

    ///*** Delivery Schedule**////

    function cboDeliveryOrderName()
    {
     
        var bIsGrey=false;
        if(parseInt($("#cboDeliveryOrderName").val())>0)
        {
            for(var i = 0;i<_oDeliveryOrderNames.length;i++)
            {
                if(_oDeliveryOrderNames[i].DeliveryOrderNameID===parseInt($("#cboDeliveryOrderName").val()))
                {

                    if(_oDeliveryOrderNames[i].IsGrey==true)
                    {
                        bIsGrey=_oDeliveryOrderNames[i].IsGrey;
                        break;
                    }
                    //break;
                }
            }
            RefreshTotalSummery_FDS(bIsGrey);
        }
    }

    function ValidationFDSchedule() {
        if (_oFabricSalesContract.FabricSalesContractID <= 0 || _oFabricSalesContract==null ) {
            alert("Please, First Save PO, from previous tab ");

            return false;
        }
        //if (_oFabricSalesContract.CurrentStatusInt>=3)
        //{
        //    alert("Already approve");

        //    return false;
        //}

        if(parseInt($("#cboDeliveryOrderName").val())<=0)
        {
            $("#cboDeliveryOrderName").focus();
            $("#cboDeliveryOrderName").addClass("errorFieldBorder");
            alert('Delivery Name required.');
            return false;
        } else {
            $("#cboDeliveryOrderName").removeClass("errorFieldBorder");
        }

        var bIsFoC=false;
        var bIsGrey=false;
        for(var i = 0;i<_oDeliveryOrderNames.length;i++)
        {
            if(_oDeliveryOrderNames[i].DeliveryOrderNameID===parseInt($("#cboDeliveryOrderName").val()))
            {
                if(_oDeliveryOrderNames[i].IsFoc==true)
                {
                    bIsFoC=_oDeliveryOrderNames[i].IsFoc;
                }
                if(_oDeliveryOrderNames[i].IsGrey==true)
                {
                    bIsGrey=_oDeliveryOrderNames[i].IsGrey;
                }
                //break;
            }
        }



        if(parseFloat($('#txtDeliveryQty').val())<=0){
            $("#txtDeliveryQty").focus();
            $("#txtDeliveryQty").addClass("errorFieldBorder");
            alert('Quantity required.');
            return false;
        } else {
            $("#txtDeliveryQty").removeClass("errorFieldBorder");
        }


        var dDeliveryDate = new Date($('#txtDeliveryDate').datebox('getValue'));
        var dSCDate = new Date($('#txtSCDate').datebox('getValue'));
        if (dDeliveryDate==null ||dDeliveryDate=='')
        {
            $("#txtDeliveryDate").focus();
            $("#txtDeliveryDate").addClass("errorFieldBorder");
            alert('Quantity Delivery Date.');
            return false;
        }
        else {
            $("#txtDeliveryDate").removeClass("errorFieldBorder");
        }
        if (dDeliveryDate <= dSCDate)
        {
            alert("Delivery Date cannot be smaller than  PO Date .");
            return false;
        }

        ////

        debugger;
        var nTotalFSCQty=0,nTotalDSQty=0,nQty=0,nPrevQty=0,nFocQty=0,nTotalGreyQty=0;



        nQty=parseFloat($('#txtDeliveryQty').val());
        var oFSCDetails = $('#tblFSCDetails').datagrid('getRows');
        for (var i = 0; i < oFSCDetails.length; i++) {
            nTotalFSCQty = nTotalFSCQty + parseFloat(oFSCDetails[i].Qty);
        }

        if(bIsFoC)
        {
            nFocQty= (parseFloat(nFocQty)+parseFloat(nTotalFSCQty)*5)/100;
        }

        var oFabricDeliverySchedules = $('#tblFabricDeliverySchedules').datagrid('getRows');
        for (var i = 0; i < oFabricDeliverySchedules.length; i++)
        {
            if(!oFabricDeliverySchedules[i].IsFoc)
            {
                if(!oFabricDeliverySchedules[i].IsGrey)
                {
                    nTotalDSQty = nTotalDSQty + parseFloat(oFabricDeliverySchedules[i].Qty);
                }
                else{
                    nTotalGreyQty = nTotalGreyQty + parseFloat(oFabricDeliverySchedules[i].Qty);
                }
            }
        }
        if(_oFabricDeliverySchedule!=null && _oFabricDeliverySchedule.FabricDeliveryScheduleID>0)
        {
            nPrevQty=parseFloat(_oFabricDeliverySchedule.Qty);
        }
        if(parseInt($("#cboOrderType").val())===11 ||parseInt($("#cboOrderType").val())===12 ||parseInt($("#cboOrderType").val())===13 ||parseInt($("#cboOrderType").val())===10 ||parseInt($("#cboOrderType").val())===3 || parseInt($("#cboOrderType").val())===2)
        {
            //  alert("A-"+nTotalFSCQty+",B-"+nTotalDSQty+", C-"+nPrevQty+", D-"+nQty+",E"+nFocQty+',F'+bIsFoC)
            if(bIsGrey)
            {
                if(nTotalFSCQty+nFocQty+0.2<(nTotalGreyQty-parseFloat(nPrevQty)+nQty))
                {
                    alert("Delivery Qty exced order Qty.!!!");
                    return false;
                }
            }
            else{
                if(nTotalFSCQty+nFocQty+0.2<(nTotalDSQty-parseFloat(nPrevQty)+nQty))
                {
                    alert("Delivery Qty exced order Qty.!!!");
                    return false;
                }
            }
        }


        return true;
    }

    $("#btnAddFDSchedule").click(function () {
        _oFabricDeliverySchedule=null;
        AddNewFDSchedule();

    });
    /// end FabricDeliverySchedules
    $("#btnEditFDSchedule").click(function(){
        var oFabricDeliverySchedule = $("#tblFabricDeliverySchedules").datagrid("getSelected");
        if(oFabricDeliverySchedule == null || oFabricDeliverySchedule.FabricDeliveryScheduleID <=0)
        {
            alert("Please select an item from list.");
            return;
        }
        debugger;
        _oFabricDeliverySchedule = oFabricDeliverySchedule;
        $("#cboDeliveryOrderName").val(_oFabricDeliverySchedule.DeliveryOrderNameID);
        $("#txtDeliveryQty").val(_oFabricDeliverySchedule.Qty);
        $("#txtNoteFDS").val(_oFabricDeliverySchedule.Note);
        $('#txtDeliveryDate').datebox('setValue', oFabricDeliverySchedule.DeliveryDateSt);
        $("#txtDeliveryToName").val(_oFabricDeliverySchedule.DeliveryAddress);
        $('#chkIsOwnDelivery').prop('checked',_oFabricDeliverySchedule.IsOwn);
        $("#btnUpdateFDSchedule").show();
        $("#btnDelete_FabricDeliverySchedules").hide();
    });

    $("#btnUpdateFDSchedule").click(function(){
        AddNewFDSchedule();
    });
    function AddNewFDSchedule()
    {
        if (!ValidationFDSchedule())
        {
            return false;
        }
        else
        {
            var oFabricDeliverySchedule = {
                FabricDeliveryScheduleID: (_oFabricDeliverySchedule == null ? 0 : _oFabricDeliverySchedule.FabricDeliveryScheduleID),
                FabricSalesContractID:_oFabricSalesContract.FabricSalesContractID,
                DeliveryOrderNameID: parseInt($("#cboDeliveryOrderName").val()),
                DeliveryDate: $('#txtDeliveryDate').datebox('getValue'),
                Qty: parseFloat(icsRemoveComma($('#txtDeliveryQty').val())),
                DeliveryAddress:$('#txtDeliveryToName').val(),
                DeliveryToID:_nDeliveryToID,
                IsOwn: $("#chkIsOwnDelivery").is(":checked"),
                Note:$('#txtNoteFDS').val()
            };
            var obj = {
                BaseAddress: _sBaseAddress,
                Object: oFabricDeliverySchedule,
                ObjectId: oFabricDeliverySchedule.FabricDeliveryScheduleID,
                ControllerName: "FabricSalesContract",
                ActionName: "Save_FabricDeliverySchedule",
                TableId: "tblFabricDeliverySchedules",
                IsWinClose: true,
                Message:""
            };
            $.icsSave(obj, function (response) {
                if (response.status && response.obj != null) {
                    if (response.obj.FabricDeliveryScheduleID > 0) {
                        $("#cboDeliveryOrderName").val(0);
                        $("#txtDeliveryQty").attr("placeholder", "Entry Qty");
                        $("#txtDeliveryQty").val("");
                        $("#txtNoteFDS").val("");
                        $("#txtDeliveryToName").val("");
                        RefreshTotalSummery_FDS(response.obj.IsGrey);
                        $("#btnUpdateFDSchedule").hide();
                        $("#btnDelete_FabricDeliverySchedules").show();

                    }
                }
            });
        }
    }
    $("#btnDelete_FabricDeliverySchedules").click(function () {
        var oFabricDeliverySchedule = $("#tblFabricDeliverySchedules").datagrid("getSelected");
        if (oFabricDeliverySchedule == null || oFabricDeliverySchedule.FabricDeliveryScheduleID <= 0) {
            alert("Please select an item from list.");
            return false;
        }
        if (!confirm("Confirm to Delete?")) return false;

        var obj =
        {
            BaseAddress: _sBaseAddress,
            Object: oFabricDeliverySchedule,
            ObjectId: oFabricDeliverySchedule.FabricDeliveryScheduleID,
            ControllerName: "FabricSalesContract",
            ActionName: "Delete_FabricDeliverySchedule",
            TableId: "tblFabricDeliverySchedules",
            IsWinClose: false
        };

        $.icsDelete(obj, function (response) {
            RefreshTotalSummery_FDS(0);
        });

    });
    function IsOwnDelivery()
    {
        var IsOwnDelivery=false;
        IsOwnDelivery= $("#chkIsOwnDelivery").is(":checked");
        if(IsOwnDelivery)
        {
            _nDeliveryToID=0;
            $('#txtDeliveryToName').val(_oBusinessUnit.ShortName+" H/O");
            $('#btnPickDeliveryTo').hide();
        }
        else
        {
            $('#txtDeliveryToName').val("");
            _nDeliveryToID=_oFabricSalesContract.ContractorID;
            $('#btnPickDeliveryTo').show();
            $("#txtDeliveryToName").attr("placeholder", _oFabricSalesContract.ContractorName);

        }
    }


    ///// end Delivery Schedule///
    $('#btnPrint,#btnPrintTwo,#btnPrintThree').click(function (e)
    {
        if (_oFabricSalesContract ==null || _oFabricSalesContract.FabricSalesContractID <=0 ) { alert("Please select an item from list."); return ; }
        var tsv=((new Date()).getTime())/1000;
     //   window.open(_sBaseAddress+ "/FabricSalesContract/PrintPreview?nID="+ _oFabricSalesContract.FabricSalesContractID+"&bIsRnd=false&nts="+tsv, "_blank");
        window.open(_sBaseAddress+ "/FabricSalesContract/PrintPreview?nID="+_oFabricSalesContract.FabricSalesContractID+"&bIsRnd=false&nts="+tsv+"&bPrintFormat=true&nTitleTypeInImg=1", "_blank");
        //window.open(_sBaseAddress+ "/FabricSalesContract/PrintPreview?nID="+_oFabricSalesContract.FabricSalesContractID+"&bIsRnd=false&nts="+tsv+"&bPrintFormat="+sessionStorage.getItem("QtyFormat") + "&nTitleTypeInImg="+sessionStorage.getItem("ImageFormat"), "_blank");

    });

    /////
    function PickTermsAndCondition() {

        var oFabricSalesContractNote = {
            Note:"",
            FabricSalesContractID:0
        };
        var obj = {
            BaseAddress: _sBaseAddress,
            Object: oFabricSalesContractNote,
            ControllerName: "FabricSalesContractNote",
            ActionName: "Gets",
            IsWinClose: false
        };
        $("#progressbar").progressbar({ value: 0 });
        $("#progressbarParent").show();
        var intervalID = setInterval(updateProgress, 250);
        $.icsDataGets(obj, function (response) {
            clearInterval(intervalID);
            $("#progressbarParent").hide();
            if (response.status && response.objs.length > 0) {
                if (response.objs[0].FabricSalesContractNoteID > 0)
                {
                    debugger;
                    $("#winTermsAndCondition input").val("");
                    sessionStorage.setItem('FabricSalesContractNote',JSON.stringify(response.objs));
                    DynamicRefreshList(response.objs, "tblTermsAndCondition");
                    $("#winTermsAndCondition").icsWindow('open', "Special instruction Picker");
                }
                else {
                    sessionStorage.setItem('FabricSalesContractNote',JSON.stringify([]));
                    alert(response.objs[0].ErrorMessage);
                }
            }
            else {
                alert("Sorry, There is No Terms and Condition Found.");
            }
        });
    }

    $("#btnOkFabricSalesContractNote").click(function () {
        debugger;
        var oSelectedObjs = $('#tblTermsAndCondition').datagrid('getChecked');
        if(oSelectedObjs.length>0)
        {
            var oExistingItems = [];
            oExistingItems = $('#tblFSCNots').datagrid('getRows');
            if(_oFabricSalesContract.FabricSalesContractID<=0)
            {
                alert("Invaild Object");
                return;
            }
            for(var i = 0;i<oSelectedObjs.length;i++)
            {
                    var oFSCNote = {
                        FabricSalesContractNoteID: 0,
                        FabricSalesContractID: _oFabricSalesContract.FabricSalesContractID,
                        Sequence:0,
                        Note: oSelectedObjs[i].Note
                    };
                    var bExists= IsExist(oSelectedObjs[i].Note)
                    if(!bExists)
                    {
                        $('#tblFSCNots').datagrid('appendRow', oFSCNote);
                    }

            }
        }
        $("#winTermsAndCondition").icsWindow('close');
    });

    function IsExist(nNote)
    {
        var oFSCNots = $('#tblFSCNots').datagrid('getRows');
        for (var i = 0; i < oFSCNots.length; i++) {
            if (oFSCNots[i].Note === nNote)
            {
                return true;
            }
        }
        return false;
    }

    $("#btnCloseTermsAndCondition").click(function () {
        $("#winTermsAndCondition").icsWindow('close');
    });
    $('#txtTermsAndCondition').keyup(function (e) {
        var c = String.fromCharCode(e.which);
        var txtTermsAndCondition = $('#txtTermsAndCondition').val();
        var oSearchedPITAndCs = [];  var sTempName="";
        var oFabricSalesContractNotes = $('#tblTermsAndCondition').datagrid('getRows');
        if (e.which == 8)
        {
            oFabricSalesContractNotes = jQuery.parseJSON(sessionStorage.getItem('FabricSalesContractNote'));
        }
        for(var i=0;i<oFabricSalesContractNotes.length;++i){
            sTempName=oFabricSalesContractNotes[i].Clause;
            n=sTempName.toUpperCase().indexOf(txtTermsAndCondition.toUpperCase())
            if(n!=-1)
            {
                oSearchedPITAndCs.push(oFabricSalesContractNotes[i]);
            }
        }
        DynamicRefreshList(oSearchedPITAndCs, "tblTermsAndCondition");
    });


    function RefreshTermsAndCondition()
    {

        endEditingTC();
        sTableId='tblFSCNots';
        var oTermsConditions = $('#'+sTableId).datagrid('getRows');
        DynamicRefreshList(oTermsConditions, sTableId);
    }
    
    function RemoveTermsAndCondition()
    {
        var oFabricSalesContractNote = $("#tblFSCNots").datagrid("getSelected");
        if (oFabricSalesContractNote == null) { alert("Please select an item from list!"); return false; }
        var nIndex=$('#tblFSCNots').datagrid('getRowIndex',oFabricSalesContractNote);
        if (!confirm("Confirm to Delete?")) return false;

        if(oFabricSalesContractNote.FabricSalesContractNoteID<=0)
        {
            $("#tblFSCNots").datagrid("deleteRow", nIndex);
        }
        else
        {
            var obj =
                     {
                         BaseAddress: _sBaseAddress,
                         Object: oFabricSalesContractNote,
                         ControllerName: "FabricSalesContractNote",
                         ActionName: "Delete",
                         TableId: "tblFSCNots",
                         IsWinClose: false
                     };
            $.icsDelete(obj);
        }

    }
    function RemoveTermsAndConditionAll()
    {
        debugger;
        var sFabricSalesContractNoteID ="";
        var oFabricSalesContractNotes = $('#tblFSCNots').datagrid('getChecked');

        if(oFabricSalesContractNotes==null || oFabricSalesContractNotes.length<=0)
        {
            alert("Please checked at least one item from list.");
            return
        }

        var nSelectedIndex = 0;
        var indexLists = [];
        for (i = 0; i < oFabricSalesContractNotes.length; ++i) {
            if (oFabricSalesContractNotes[i].FabricSalesContractNoteID != 0) {
                sFabricSalesContractNoteID += oFabricSalesContractNotes[i].FabricSalesContractNoteID +',';
            }
            nSelectedIndex = $('#tblFSCNots').datagrid('getRowIndex', oFabricSalesContractNotes[i]);
            indexLists.push(nSelectedIndex);
        }
        sFabricSalesContractNoteID = sFabricSalesContractNoteID.substring(0, sFabricSalesContractNoteID.length - 1);
        if(sFabricSalesContractNoteID.length>0)
        {
            var oFabricSalesContractNote = {
                FabricSalesContractNoteID: 0,
                FabricSalesContractID: _oFabricSalesContract.FabricSalesContractID,
                ErrorMessage:sFabricSalesContractNoteID,
                Sequence:0,
                Note:''
            };
       
            var obj =
                     {
                         BaseAddress: _sBaseAddress,
                         Object: oFabricSalesContractNote,
                         ControllerName: "FabricSalesContractNote",
                         ActionName: "DeleteAll",
                         TableId: "",
                         IsWinClose: false
                     };
            $.icsDelete(obj, function (response) {
                if (response.status && response.Message =='deleted') 
                {
                    debugger
                    for (i = 0; i < oFabricSalesContractNotes.length; ++i) {
                        nSelectedIndex = $('#tblFSCNots').datagrid('getRowIndex', oFabricSalesContractNotes[i]);
                        $("#tblFSCNots").datagrid("deleteRow",nSelectedIndex);
                    }
                   
                }
            });
        }
        else
        {
            for (i = 0; i < oFabricSalesContractNotes.length; ++i) {
                nSelectedIndex = $('#tblFSCNots').datagrid('getRowIndex', oFabricSalesContractNotes[i]);
                $("#tblFSCNots").datagrid("deleteRow", nSelectedIndex);
            }
            alert("Delete Successfully"); 
        }


    }
    var editTCIndex = undefined;
    function endEditingTC() {
        if (editTCIndex == undefined) { return true }
        if ($('#tblFSCNots').datagrid('validateRow', editTCIndex)) {

            $('#tblFSCNots').datagrid('endEdit', editTCIndex);
            editTCIndex = undefined;
            return true;
        }
        else {
            return false;
        }
    }

    function onClickRowTC(index) {

        if (editTCIndex != index) {
            if (endEditingTC()) {
                $('#tblFSCNots').datagrid('selectRow', index)
                        .datagrid('beginEdit', index);
                editTCIndex = index;
            }
            else {
                $('#tblFSCNots').datagrid('selectRow', editTCIndex);
            }
        }
    }
    function ChangeOrderType(bChange)
    {
        var ncboOrderType= parseInt($('#cboOrderType').val());
        $("#txtSCNoOrderType").val(ncboOrderType);
        $("#rtHandLoom").show();
        $("#tblTotalSumFSCDetails").show();
        $("#tblTotalSum_DeliverySchedule").show();
        $("#cboHandLoomType").hide();
        $("#tblLCTerm").hide();
        $("#tblLCTermTemp").show();
        $("#chkIsProduction").hide();
        $("#chkOnlySale").hide();
        $("#lbProduction").hide();
        $("#lbOnlySale").hide();
        debugger;
        var sOperation =sessionStorage.getItem("Operation");
        if(sOperation!='Copy')
        {
            if(bChange)
            {
                $("#txtContractorName").val("");
                _oFabricSalesContract.ContractorID=0;
                $("#cboContractorContactPerson").empty();

                $("#txtBuyingHouse").val("");
                _oFabricSalesContract.BuyerID=0;
                $("#cboBuyerContactPerson").empty();
            }
        }

        if(ncboOrderType===12 ||ncboOrderType===11 ||ncboOrderType===13 || ncboOrderType===10 ||ncboOrderType===2 || ncboOrderType===3 || ncboOrderType===9)
        {
            document.getElementById("lblDeliveryQty").innerHTML = 'Qty';
            $("#tblLCTermTemp").hide();
            if(ncboOrderType===2 )
            {
                $(".lblOrderType").html("Debt Note Acc:");

            }
            else if (ncboOrderType===9)
            {
                $(".lblOrderType").html("Issue To:");
                $("#tblLCTerm").show();
            }
            else if (ncboOrderType===3)
            {
                $(".lblOrderType").html("(P/I)Issue To:");
                $("#tblLCTerm").show();
            }
            else if (ncboOrderType===13)
            {
                $(".lblOrderType").html("(P/I)Issue To:");
                $("#tblLCTerm").show();
            }
            else if (ncboOrderType===10)
            {
                $(".lblOrderType").html("(P/I)Issue To:");
                $("#tblLCTerm").show();
            }
        }
        else{
            $(".lblOrderType").html("Buying House:");
            document.getElementById("lblDeliveryQty").innerHTML = 'Set(s)';
            $("#rtHandLoom").hide();
            $("#tblTotalSumFSCDetails").hide();
            $("#tblTotalSum_DeliverySchedule").hide();
            $("#cboHandLoomType").show();
            $("#tblLCTerm").hide();
        }


        if(ncboOrderType===12 ||ncboOrderType===11 ||ncboOrderType===13 || ncboOrderType===2 || ncboOrderType===3|| ncboOrderType===9 ||  ncboOrderType===10)
        {
            $("#lbProduction").show();
            $("#lbOnlySale").show();
            $("#chkIsProduction").show();
            $("#chkOnlySale").show();
            $("#cboHandLoomType").hide();
            $("#tblFSCDetails").datagrid("showColumn", "IsProductionSt");
            $("#tblFSCDetails").datagrid("showColumn", "Qty");
            $("#tblFSCDetails").datagrid("showColumn", "QtyTwo");
            $("#tblFSCDetails").datagrid("showColumn", "UnitPrice");
            $("#tblFSCDetails").datagrid("showColumn", "UnitPriceTwo");
            $("#tblFSCDetails").datagrid("showColumn", "AmountSt");
            $("#tblFSCDetails").datagrid("showColumn", "FabricWidth");
            $("#tblFSCDetails").datagrid("showColumn", "HLReference");
            $("#tblFSCDetails").datagrid("hideColumn", "Size");
            $("#tblFSCDetails").datagrid("hideColumn", "DesignPattern");
            $("#rtIncreaseHide").hide();

            $('#chkIsOwnDelivery').prop('checked',false);
            //if(ncboOrderType===2)
            //{
            //    $("#txtSCNoOrderType").val("SM");
            //}
            //if( ncboOrderType===3)
            //{
            //    $("#txtSCNoOrderType").val("BK");
            //}
            if( ncboOrderType===10)
            {
                //$("#txtSCNoOrderType").val("SS");
                $("#chkIsProduction").hide();
                $("#chkOnlySale").hide();
                $("#lbProduction").hide();
                $("#lbOnlySale").hide();
            }
            if( ncboOrderType===9)
            {
                //$("#txtSCNoOrderType").val("SM");
                $("#tblFSCDetails").datagrid("hideColumn", "UnitPrice");
                $("#tblFSCDetails").datagrid("hideColumn", "UnitPriceTwo");
            }

        }
        else{

            $("#tblFSCDetails").datagrid("hideColumn", "IsProductionSt");
            $("#tblFSCDetails").datagrid("hideColumn", "Qty");
            $("#tblFSCDetails").datagrid("hideColumn", "QtyTwo");
            $("#tblFSCDetails").datagrid("hideColumn", "UnitPrice");
            $("#tblFSCDetails").datagrid("hideColumn", "UnitPriceTwo");
            $("#tblFSCDetails").datagrid("hideColumn", "AmountSt");
            $("#tblFSCDetails").datagrid("hideColumn", "FabricWidth");
            $("#tblFSCDetails").datagrid("hideColumn", "HLReference");
            $("#tblFSCDetails").datagrid("showColumn", "Size");
            $("#tblFSCDetails").datagrid("showColumn", "DesignPattern");
            $("#rtIncreaseHide").show();
            $("#txtDeliveryQty").val(1);
            //if(ncboOrderType===1)
            //{
            //    $("#txtSCNoOrderType").val("H/L");
            //}
            //else{
            //    $("#txtSCNoOrderType").val("RD");
            //}
            $('#chkIsOwnDelivery').prop('checked',true);
        }
        debugger;
        var oDeliveryOrderNames=[];
        var nSelected=0;
        if(ncboOrderType>0)
        {
            for(var i = 0;i<_oDeliveryOrderNames.length;i++)
            {
                if(parseInt(ncboOrderType)===_oDeliveryOrderNames[i].OrderType)
                {
                    oDeliveryOrderNames.push(_oDeliveryOrderNames[i]);
                }
            }
        }
        $("#cboDeliveryOrderName").icsLoadCombo({
            List: oDeliveryOrderNames,
            OptionValue: "DeliveryOrderNameID",
            DisplayText: "Name"
        });
        for(var i = 0;i<oDeliveryOrderNames.length;i++)
        {
            if(oDeliveryOrderNames[i].DeliveryOrderNameID>0)
            {
                nSelected=oDeliveryOrderNames[i].DeliveryOrderNameID;
                break;
            }
        }
        if(oDeliveryOrderNames.length>0)
        {
            $("#cboDeliveryOrderName").val(nSelected);
        }
        IsOwnDelivery();
    }
    $(document).keydown(function (e) { if (e.keyCode == 27) { $('div').icsWindow('close'); } });


    $("#txtDeliveryDays").keypress(function (e) {
        if (e.which != 8 && e.which != 0  && e.which != 46  && (e.which < 48 || e.which > 57)) {
            return false;
        }
    });

    $("#txtDeliveryDays").keydown(function (e){
        var nkeyCode = e.keyCode || e.which;
        if(nkeyCode==13)
        {
            var dDate= new Date($('#txtSCDate').datebox('getValue'));
            $("#txtDeliveryDate").datebox("setValue", icsdateformat(new Date(dDate.getFullYear(), dDate.getMonth(), dDate.getDate()+parseInt( $("#txtDeliveryDays").val()))));
        }
    });

    //// Update Detail

    $("#btnPickDetail").click(function () {
        debugger;
        $("#winFabricInfo input").val("");
        $("#trIsProduction").hide();
        var oFSCDetail = $('#tblFSCDetails').datagrid('getSelected');
        if (oFSCDetail ==null ) { alert("Please select an item from list."); return ; }
        _nFNLabDipDetailID=oFSCDetail.FNLabdipDetailID;
        PickProductInFabric(oFSCDetail.ProductID);
        $('#divFSCDetail').data('FSCDetail',oFSCDetail);
        $("#cboProductFabric").val(oFSCDetail.ProductID);
        $('#txtFabricNo_F').prop('disabled',true);

        $("#txtFabricNo_F").val(oFSCDetail.FabricNo);
        $("#txtConstruction_F").val(oFSCDetail.Construction);
        $("#txtFabricWidthFabric").val(oFSCDetail.FabricWidth);
        $("#cboFinishTypeFabric").val(oFSCDetail.FinishType);

        $("#cboProcessTypeFabric").val(oFSCDetail.ProcessType);
        $("#cboFabricDesign").val(oFSCDetail.FabricDesignID);
        $("#cboWeaveFabric").val(oFSCDetail.FabricWeave);
        $("#txtStyleNoFabric").val(oFSCDetail.StyleNo);
        $("#txtColorFabric").val(oFSCDetail.ColorInfo);

        $("#txtBRef").val(oFSCDetail.BuyerReference);
        $("#txtHLRef").val(oFSCDetail.HLReference);
        $("#txtNoteFSCD").val(oFSCDetail.Note);
        $("#txtDesignPattern").val(oFSCDetail.DesignPattern);
        $("#cboShade").val(parseInt(oFSCDetail.ShadeID));
        $("#txtLDNo").val(oFSCDetail.LDNo);
        $("#txtPantonNo").val(oFSCDetail.PantonNo);
        
        $("#txtWeight").val(oFSCDetail.Weight);
        $("#txtShrinkage").val(oFSCDetail.Shrinkage);
        $("#txtYarnType").val(oFSCDetail.YarnType);
        var ncboOrderType= parseInt($('#cboOrderType').val());
        $("#chkIsProductionTwo").prop("checked", oFSCDetail.IsProduction);
        $("#chkOnlySaleTwo").prop("checked", !oFSCDetail.IsProduction);

        $('#chkIsBW').prop('checked', oFSCDetail.IsBWash);
        $('#chkIsAW').prop('checked',!oFSCDetail.IsBWash);

        if(ncboOrderType===2 || ncboOrderType===3|| ncboOrderType===9|| ncboOrderType===13 || ncboOrderType===12 ||ncboOrderType===11 )
        {
            $("#txtDesignPattern").hide();
            $("#lblDnP").hide();
            $("#trIsProduction").show();
        }

        $("#winFabricInfo").icsWindow("open","Change Fabric info");
    });
    $("#btnUpdateFSEDetail").click(function () {
        var sIsPr="";
        if($("#chkIsProductionTwo").is(":checked"))
        {
            sIsPr="Production";
        }
        else{
            sIsPr="Only Sale";
        }
        debugger;
        var oFSCDetail = $('#tblFSCDetails').datagrid('getSelected');
        if (oFSCDetail ==null ) { alert("Please select an item from list."); return ; }
        var nSelectedRowIndex=$('#tblFSCDetails').datagrid('getRowIndex',oFSCDetail);
        var ncboProductFabric = document.getElementById("cboProductFabric");
        if($("#cboProductFabric").val()==null)
        {
            alert("Invalid Selection!!! please select a valid Composition!");
            $('#cboProductFabric').focus();
            return ;
        }
        if(parseInt($("#cboProductFabric").val())<=0)
        {
            alert("Invalid Selection!!! please select a valid Composition!");
            $('#cboProductFabric').focus();
            return ;
        }
        var sText = ncboProductFabric.options[ncboProductFabric.selectedIndex].text;
        oFSCDetail.ProductID=$("#cboProductFabric").val();
        oFSCDetail.ProductName=sText;
        oFSCDetail.FNLabdipDetailID=_nFNLabDipDetailID;
        oFSCDetail.ShadeID=parseInt($("#cboShade").val());
        oFSCDetail.Construction= $.trim($("#txtConstruction_F").val()),  
        oFSCDetail.FabricWidth=$.trim($("#txtFabricWidthFabric").val()),  
        oFSCDetail.LDNo= $("#txtLDNo").val();
        oFSCDetail.PantonNo= $.trim($("#txtPantonNo").val()),
        oFSCDetail.Weight= $.trim($("#txtWeight").val()),
        oFSCDetail.Shrinkage= $.trim($("#txtShrinkage").val()),
        oFSCDetail.YarnType= $.trim($("#txtYarnType").val()),
        oFSCDetail.FinishType=$("#cboFinishTypeFabric").val();
        oFSCDetail.StyleNo= $.trim($("#txtStyleNoFabric").val()), 
        oFSCDetail.ColorInfo=$.trim($("#txtColorFabric").val()),
        oFSCDetail.ProcessType=$("#cboProcessTypeFabric").val();
        oFSCDetail.FabricDesignID=$("#cboFabricDesign").val();
        oFSCDetail.FabricWeave=$("#cboWeaveFabric").val();
        oFSCDetail.SCDetailTypeInt=0;
        oFSCDetail.BuyerReference=$.trim($("#txtBRef").val()),
        oFSCDetail.HLReference=$.trim($("#txtHLRef").val()),
        oFSCDetail.Note=$.trim($("#txtNoteFSCD").val()),
        oFSCDetail.IsProduction=$("#chkIsProductionTwo").is(":checked");
        oFSCDetail.IsBWash=$("#chkIsBW").is(":checked");
        oFSCDetail.IsProductionSt=sIsPr;
        oFSCDetail.DesignPattern=$("#txtDesignPattern").val();
       
        $('#tblFSCDetails').datagrid('updateRow', { index: nSelectedRowIndex, row: oFSCDetail });
        endEditing();
        $("#winFabricInfo").icsWindow("close");

    });
    $("#btnCloseFSEDetail").click(function () {
        debugger;
        $("#winFabricInfo").icsWindow("close");

    });
    $("#btnRefresh").click(function () {
        endEditing();
    });
    /////


    ///
    function IsCheckedProduction()
    {
        if(document.getElementById("chkIsProduction").checked==true)
        {
            document.getElementById("chkOnlySale").checked=false;

        }
        if(document.getElementById("chkIsProductionTwo").checked==true)
        {
            document.getElementById("chkOnlySaleTwo").checked=false;
            document.getElementById("chkOnlySale").checked=false;
            document.getElementById("chkIsProduction").checked=true;
        }
    }
    function IsCheckedOnlySale()
    {
        if(document.getElementById("chkOnlySale").checked==true)
        {
            document.getElementById("chkIsProduction").checked=false;
        }
        if(document.getElementById("chkOnlySaleTwo").checked==true)
        {
            document.getElementById("chkIsProduction").checked=false;
            document.getElementById("chkIsProductionTwo").checked=false;
            document.getElementById("chkOnlySale").checked=true;
        }
    }
    function PickProductInFabric(nProductID) {

        var oProduct = { BUID:sessionStorage.getItem("BUID"),ProductName:""};
        var obj = {
            BaseAddress: _sBaseAddress,
            Object: oProduct,
            ControllerName: "Fabric",
            ActionName: "GetProducts",
            IsWinClose: false
        };

        $.icsDataGets(obj, function (response) {
            if (response.status && response.objs.length > 0) {
                if (response.objs[0].ProductID > 0) {
                    debugger;
                    $("#cboProductFabric").icsLoadCombo({
                        List: response.objs,
                        OptionValue: "ProductID",
                        DisplayText: "ProductName"
                    });
                    $("#cboProductFabric").val(nProductID);

                }
                else {
                    $("#cboProductFabric").empty();
                }
            }
            else {
                $("#cboProductFabric").empty();
            }
        });
    }



    $("#btnHoldRunning").click(function () {
        debugger;
        $('#txtPINo_Open').show();
        var oFSCDetail = $("#tblFSCDetails").datagrid("getSelected");
        if (oFSCDetail == null) { alert("Please select an item from list!"); return false; }
        var nIndex=$('#tblFSCDetails').datagrid('getRowIndex',oFSCDetail);
        if( oFSCDetail.Status==3)
        {
            if (!confirm("Confirm to running?")) return false;
            oFSCDetail.Status=2;
        }
        else{
            if (!confirm("Confirm to Hold?")) return false;
            oFSCDetail.Status=3;
        }

        if($("#txtPINo_Open").val()==null || $("#txtPINo_Open").val()=="")
        {
            alert("Please type  Reason!");
            $('#txtPINo_Open').focus();
            return false;
        }
        oFSCDetail.Note=$.trim($("#txtPINo_Open").val());

        var obj = {
            BaseAddress: _sBaseAddress,
            Object: oFSCDetail,
            ObjectId: oFSCDetail.FabricSalesContractDetailID,
            ControllerName: "FabricSalesContract",
            ActionName: "OrderHold",
            TableId: "tblFSCDetails",
            IsWinClose: false
        };
        $.icsSave(obj);
        //var SelectedRowIndex = $('#tblFSCDetails').datagrid('getRowIndex', oFSCDetail);
        $('#tblFSCDetails').datagrid('updateRow', { index: nIndex, row: oFSCDetail });


    });

    function CopyDetail()
    {
        debugger;
        var oFSCDetail = $('#tblFSCDetails').datagrid('getSelected');
        if (oFSCDetail ==null ) { alert("Please select an item from list."); return ; }
        if (!confirm("Confirm to copy?")) return false;
        var SelectedRowIndex=$('#tblFSCDetails').datagrid('getRowIndex',oFSCDetail);



        var oFSCDetailNew={
            FabricSalesContractDetailID:0,
            ProductID: oFSCDetail.ProductID,
            FabricSalesContractID:  (_oFabricSalesContract != null) ? _oFabricSalesContract.FabricSalesContractID : 0,
            Qty :0.00,
            UnitPrice:0.00,
            QtyTwo:0.0000,
            UnitPriceTwo:0.0000,
            Qty_PI:0,
            Amount:0,
            FabricID : oFSCDetail.FabricID,
            FabricNo: oFSCDetail.FabricNo,
            MUnitID: oFSCDetail.MUnitID,
            MUName:oFSCDetail.MUName,
            ProductCode :oFSCDetail.ProductCode,
            ProductName :oFSCDetail.ProductName,
            Construction:oFSCDetail.Construction,
            StyleNo: oFSCDetail.StyleNo,
            BuyerReference :oFSCDetail.BuyerReference,
            ColorInfo :oFSCDetail.ColorInfo,
            ProcessType :oFSCDetail.ProcessType,
            FinishType :oFSCDetail.FinishType,
            FabricWeave :oFSCDetail.FabricWeave,
            FabricDesignID :oFSCDetail.FabricDesignID,
            FabricDesignName :oFSCDetail.FabricDesignName,
            FabricWidth:oFSCDetail.FabricWidth,
            Note :oFSCDetail.Note,
            Size:oFSCDetail.Size,
            IsProduction:oFSCDetail.IsProduction,
            IsProductionSt:oFSCDetail.IsProductionSt,
            DesignPattern:oFSCDetail.DesignPattern,
            HLReference: oFSCDetail.HLReference,
            Status:oFSCDetail.Status,
            FNLabdipDetailID:oFSCDetail.FNLabdipDetailID,
            ShadeID:oFSCDetail.ShadeID,
            LDNo:oFSCDetail.LDNo,
            Shrinkage:oFSCDetail.Shrinkage,
            Weight:oFSCDetail.Weight,
            SLNo:0,
            IsDeduct:false,
            ExeNo:oFSCDetail.ExeNo,
            OptionNo:oFSCDetail.OptionNo,
            Currency:oFSCDetail.Currency

        }

        var oFSCDetails = $('#tblFSCDetails').datagrid('getRows');
        var nLength = oFSCDetails.length;
        $('#tblFSCDetails').datagrid('appendRow',oFSCDetailNew);
        $('#tblFSCDetails').datagrid('selectRow', nLength);
       
    }
</script>