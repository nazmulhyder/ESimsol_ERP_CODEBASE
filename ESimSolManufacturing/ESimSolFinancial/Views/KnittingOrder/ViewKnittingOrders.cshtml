@{
    ViewBag.Title = "Knitting Order List";
}
@model IEnumerable<ESimSol.BusinessObjects.KnittingOrder>
    <div id="progressbarParent" style="width:100%;height:100%;margin:0 auto;text-align:center; margin-left: auto;margin-right: auto;left: 0;right: 0;z-index: 1;">
        <div style="margin: 0px auto;margin-top: 251px;text-align:center;width:390px;">
            <label style="font-size:18px;">Please wait</label>
            <div id="progressbar" style="width:100%;height:37px;"></div>
        </div>
    </div>

    <div id="winAdvanceSearchPicker" class="easyui-window winstyle" title="Advance Search Picker" style="width:460px; height:460px" data-options="modal:true,closed:true,collapsible:false,minimizable:false,maximizable:false,closable:false">
        <div style="font-family:Tahoma"> 
            <table border="0" style="background-color:#CFB53B">
                <tr>
                    <td style="background-color:#CFB53B; text-align:center; width:460px; color:White">
                        <label id="lblHeaderName" style="font-size:15px; font-weight:bold; text-decoration:Underline"> Search Knitting Order</label>
                    </td>
                </tr>
            </table>
            <table border="0" cellpadding="0" cellspacing="0">
                <tr style="height:100px">
                    <td style="width:460px">
                        <table border="0" cellpadding="0" cellspacing="0" style="font-size:12px">
                            <tr style="height:220px">
                                <td style="width:460px; vertical-align:top;height:320px">
                                    <fieldset>
                                        <legend style="font-weight:bold; font-size:12px"> Searching Criteria : </legend>
                                        <table border="0" cellpadding="0" cellspacing="0" style=" width:380px; font-size:12px">

                                            <tr style=" width:380px;">
                                                <td style=" width:120px;float:right;">
                                                    <label>Order No :</label>
                                                </td>
                                                <td style=" width:260px;">
                                                    <input type="text" id="txtKnittingOrderNo" style=" width:100%;" />
                                                </td>
                                            </tr>
                                            <tr style=" width:380px;">
                                                <td style=" width:120px;float:right;">
                                                    <label>Order Date :</label>
                                                </td>
                                                <td style=" width:260px;">
                                                    <table>
                                                        <tr>
                                                            <td style=" width:86px;"><select id="cboOrderDate" style=" width:86px;height:22px;"></select> </td>
                                                            <td style="width: 84px;"><input id="txtOrderDateStart" type="text" style="width: 84px;" class="easyui-datebox" data-options="formatter:icsdateformat,parser:icsdateparser" /></td>
                                                            <td style="width: 6px;text-align:center">To</td>
                                                            <td style="width: 84px;"><input id="txtOrderDateEnd" type="text" style="width: 84px;" class="easyui-datebox" data-options="formatter:icsdateformat,parser:icsdateparser" /></td>
                                                        </tr>
                                                    </table>
                                                </td>
                                            </tr>
                                            <tr style=" width:380px;">
                                                <td style=" width:120px;float:right;">
                                                    <label>Start Date :</label>
                                                </td>
                                                <td style=" width:260px;">
                                                    <table>
                                                        <tr>
                                                            <td style=" width:86px;"><select id="cboStartDate" style=" width:86px;height:22px;"></select> </td>
                                                            <td style="width: 84px;"><input id="txtStartDateStart" type="text" style="width: 84px;" class="easyui-datebox" data-options="formatter:icsdateformat,parser:icsdateparser" /></td>
                                                            <td style="width: 6px;text-align:center">To</td>
                                                            <td style="width: 84px;"><input id="txtStartDateEnd" type="text" style="width: 84px;" class="easyui-datebox" data-options="formatter:icsdateformat,parser:icsdateparser" /></td>
                                                        </tr>
                                                    </table>
                                                </td>
                                            </tr>
                                            <tr style=" width:380px;">
                                                <td style=" width:120px;float:right;">
                                                    <label>Complete Date :</label>
                                                </td>
                                                <td style=" width:260px;">
                                                    <table>
                                                        <tr>
                                                            <td style=" width:86px;"><select id="cboCompleteDate" style=" width:86px;height:22px;"></select> </td>
                                                            <td style="width: 84px;"><input id="txtCompleteDateStart" type="text" style="width: 84px;" class="easyui-datebox" data-options="formatter:icsdateformat,parser:icsdateparser" /></td>
                                                            <td style="width: 6px;text-align:center">To</td>
                                                            <td style="width: 84px;"><input id="txtCompleteDateEnd" type="text" style="width: 84px;" class="easyui-datebox" data-options="formatter:icsdateformat,parser:icsdateparser" /></td>
                                                        </tr>
                                                    </table>
                                                </td>
                                            </tr>
                                            <tr style=" width:380px;">
                                                <td style=" width:120px;float:right;">
                                                    <label>Factory :</label>
                                                </td>
                                                <td style=" width:260px;">
                                                    <table style=" width:100%;">
                                                        <tr style=" width:100%;">
                                                            <td style=" width:78%;"><input type="text" style=" width:100%;" id="txtFactory" onkeydown="FactoryKeyDown(event);" /> </td>
                                                            <td style="width: 20%;"><input type="button" id="btnFactory" onclick="PickFactory()" style="width:100%;float:right;" value="Pick" /></td>
                                                        </tr>
                                                    </table>
                                                </td>
                                            </tr>
                                            <tr style=" width:380px;">
                                                <td style=" width:120px;float:right;">
                                                    <label>Buyer :</label>
                                                </td>
                                                <td style=" width:260px;">
                                                    <table style=" width:100%;">
                                                        <tr style=" width:100%;">
                                                            <td style=" width:78%;"><input type="text" style=" width:100%;" id="txtBuyer" onkeydown="BuyerKeyDown(event);" />  </td>
                                                            <td style="width: 20%;"><input type="button" id="btnBuyer" onclick="PickBuyer()" style="width:100%;float:right;" value="Pick" /></td>
                                                        </tr>
                                                    </table>
                                                </td>
                                            </tr>
                                            <tr style=" width:380px;">
                                                <td style=" width:120px;float:right;">
                                                    <label>Business Session :</label>
                                                </td>
                                                <td style=" width:260px;">
                                                    <select id="cboBusinessSession" style="width:100%;height:22px;"></select>
                                                </td>
                                            </tr>
                                            <tr style=" width:380px;">
                                                <td style=" width:120px;float:right;">
                                                    <label>Style :</label>
                                                </td>
                                                <td style=" width:260px;">
                                                    <table style=" width:100%;">
                                                        <tr style=" width:100%;">
                                                            <td style=" width:78%;"><input type="text" id="txtStyle" style="width:100%;" onkeydown="StyleKeyDown(event)" /></td>
                                                            <td style="width: 20%;"><input type="button" id="btnStyle" style="width:100%;float:right" onclick="PickStyle()" value="Pick" /></td>
                                                        </tr>
                                                    </table>
                                                </td>
                                            </tr>
                                            <tr style=" width:380px;">
                                                <td style=" width:120px;float:right;">
                                                    <label>Fabric :</label>
                                                </td>
                                                <td style=" width:260px;">
                                                    <table style=" width:100%;">
                                                        <tr style=" width:100%;">
                                                            <td style=" width:78%;"><input type="text" id="txtFabric" style="width:100%;" onkeydown="FabricKeyDown(event)" /></td>
                                                            <td style="width: 20%;"><input type="button" id="btnFabric" style="width:100%;float:right" onclick="PickFabric()" value="Pick" /></td>
                                                        </tr>
                                                    </table>
                                                </td>
                                            </tr>
                                            <tr style=" width:380px;">
                                                <td style=" width:120px;float:right;">
                                                    <label>Yarn :</label>
                                                </td>
                                                <td style=" width:260px;">
                                                    <table style=" width:100%;">
                                                        <tr style=" width:100%;">
                                                            <td style=" width:78%;"><input type="text" id="txtProduct" style="width:100%;" onkeydown="ProductKeyDown(event)" /></td>
                                                            <td style="width: 20%;"><input type="button" id="btnProduct" style="width:100%;float:right" onclick="PickProduct()" value="Pick" /></td>
                                                        </tr>
                                                    </table>
                                                </td>
                                            </tr>
                                            <tr style=" width:380px;">
                                                <td style=" width:120px;float:right;">
                                                    <label>MIC Dia :</label>
                                                </td>
                                                <td style=" width:260px;">
                                                    <input type="text" id="txtMICDia" style=" width:100%;" />
                                                </td>
                                            </tr>
                                            <tr style=" width:380px;">
                                                <td style=" width:120px;float:right;">
                                                    <label>Finish Dia :</label>
                                                </td>
                                                <td style=" width:260px;">
                                                    <input type="text" id="txtFinishDia" style=" width:100%;" />
                                                </td>
                                            </tr>

                                            <tr style="height:75px; vertical-align:bottom">
                                                <td colspan="2" style="text-align:right">
                                                    @*<input type="button" value="Reset" id="btnResetForAdvSearch" style="width:70px;font-size:12px" />*@
                                                    <input type="button" value="Refresh" id="btnRefreshForAdvSearch" style="width:70px;font-size:12px" />
                                                    <input type="button" value="Close" id="btnCloseForAdvSearch" style="width:70px;font-size:12px" />
                                                </td>
                                            </tr>
                                        </table>
                                    </fieldset>
                                </td>
                            </tr>
                        </table>
                    </td>
                </tr>
            </table>
        </div>
    </div>
    <div id="winKnittingConsumption" class="easyui-window" style="height: 600px; width: 800px;" data-options="modal:true,closed:true,collapsible:false,minimizable:false,maximizable:false,closable:false">
        <div id="p" style="width:99%; height:100%; padding:1px">
            <div style="width:100%; height:85%; padding-top:2px">
                <fieldset style="width:98%; height:100%">
                    <legend>
                        <label style="font-size:15px; font-weight:bold" id="lblWinConsumptionHeader"></label>
                    </legend>
                    <table border="0" cellpadding="2" cellspacing="2" style="width:100%">
                        <tr>
                            <td style="width:12%; text-align:right; font-weight:bold">Fabric Detail:</td>
                            <td style="width:88%" colspan="5">
                                <select id="cboFabricOrderDetail" style="width:100%;height:22px;"></select>
                            </td>
                         </tr>
                        <tr>
                            <td style="width:12%; text-align:right; font-weight:bold">Style :</td>
                            <td style="width:21%">
                                <input type="text" id="txtStyleNo" style="width:100%" readonly="readonly" />
                            </td>
                            <td style="width:12%; font-weight:bold; text-align:right">Order Qty :</td>
                            <td style="width:21%">
                                <input type="text" id="txtOrderQty" style="width:100%; text-align:right" readonly="readonly" />
                            </td>
                            <td style="width:12%; font-weight:bold; text-align:right"> Color :</td>
                            <td style="width:21%; text-align:right">
                                <input type="text" id="txtColor" style="width:100%; text-align:right" readonly="readonly" />
                            </td>
                        </tr>
                        <tr>
                            <td style="width:12%; text-align:right; font-weight:bold">Fabric Name :</td>
                            <td style="width:54%" colspan="3">
                                <input type="text" id="txtFabricName" style="width:100%" readonly="readonly" />
                            </td>
                            <td style="width:12%; font-weight:bold; text-align:right"> Knitting Qty :</td>
                            <td style="width:21%; text-align:right">
                                <input type="text" id="txtReqQty" style="width:100%; text-align:right" readonly="readonly" />
                            </td>
                        </tr>
                        <tr>
                            <td style="width:12%; text-align:right; font-weight:bold">Finish Dia :</td>
                            <td style="width:21%">
                                <input type="text" id="txtFinishDiaNew" style="width:100%" readonly="readonly" />
                            </td>
                            <td style="width:12%; font-weight:bold; text-align:right"> MIC Dia :</td>
                            <td style="width:21%; text-align:right">
                                <input type="text" id="txtMICDiaNew" style="width:100%" readonly="readonly" />
                            </td>
                            <td style="width:12%; font-weight:bold; text-align:right">GSM :</td>
                            <td style="width:21%">
                                <input type="text" id="txtGSM" style="width:30%; text-align:right" readonly="readonly" />
                                <label style="font-weight:bold; margin-left:20px;">PAM :</label>  
                                <input type="text" id="txtPAM" style="width:30%; text-align:right; float:right" readonly="readonly" />
                            </td>
                        </tr>
                        <tr>
                            <td colspan="6" style="width:100%">
                                <table style="height:330px; width:100%" id="tblKnittingConsumption" title="Composition Details" class="easyui-datagrid" singleselect="true" showfooter="true" toolbar="#toolbarKntComposition" data-options="onClickRow: onClickRow" showfooter="true">
                                    <thead>
                                        <tr>
                                            <th field="YarnCode" width="15%">Yarn Code</th>
                                            <th field="YarnName" width="35%">Yarn Name</th>
                                            <th field="Qty" width="12%" align="right" >Qty</th>
                                            <th field="RatioInPercent" width="12%" align="right">Ratio(%)</th>
                                            <th width="12%" align="left" data-options="field:'LotNo',editor:{type:'text'}">Lot No</th>
                                            <th width="12%" align="left" data-options="field:'ColorName',editor:{type:'text'}">Color</th>
                                            <th width="12%" align="left" data-options="field:'BrandName',editor:{type:'text'}">Brand</th>
                                            @*<th formatter="formatPrice" width="15%" align="right" data-options="field:'Qty',align:'right',editor:{type:'numberbox',options:{precision:2}}">Qty</th>
                                            <th formatter="formatPrice" width="15%" align="right" data-options="field:'RatioInPercent',align:'right',editor:{type:'numberbox',options:{precision:2}}">Ratio(%)</th>*@
                                        </tr>
                                    </thead>
                                </table>
                                <div style="width:100%" id="toolbarKntComposition">
                                    <input type="text" id="txtYarn" style="width:200px" onkeydown="YarnKeyDown(event)" placeholder="Type Yarn Name & Press Enter" />
                                    <input type="button" id="btnPickYarnCancel" value="C"/>
                                    <input type="button" id="btnPickYarnOK" value="P" />  
                                    <label style="margin-left:30px">Qty :</label><input type="text" id="txtYarnQty" style="width:80px" class="number" onkeyup="AddYarnIntoGridQty(event)" />
                                    <label style="margin-left:15px">Parcent(%) :</label><input type="text" id="txtYarnRatio" style="width:80px" class="number" onkeyup="AddYarnIntoGridRatio(event)" />

                                    <a id="btnAddKntComposition" href="javascript:void(0)" class="easyui-linkbutton easyui-tooltip" iconcls="icon-add" plain="true"></a>
                                    <a id="btnUpdateKntComposition" href="javascript:void(0)" class="easyui-linkbutton easyui-tooltip" iconcls="icon-ok" plain="true"></a>
                                    <a id="btnEditKntComposition" href="javascript:void(0)" class="easyui-linkbutton easyui-tooltip" iconcls="icon-edit" plain="true"></a>
                                    <a id="btnDeleteKntComposition" href="javascript:void(0)" class="easyui-linkbutton easyui-tooltip" iconcls="icon-remove" plain="true"></a>
                                </div>
                            </td>
                        </tr>
                    </table>
                       
                </fieldset>
            </div>
            <div style="width:100%; height:15%">
                <fieldset style="width:100%; height:100%">
                    <legend> Action:</legend>
                    <table border="0" cellpadding="0" cellspacing="0" style="width:100%">
                        <tr style="height:100%">
                            <td style="width:70%; text-align:left; font-size:12px; font-weight:bold">
                                <label id="lblStlmtLoanBalance" style="font-size:15px; font-weight:bold; "></label>
                            </td>
                            <td style="width:10%; text-align: right; font-size: 12px; font-weight: bold; vertical-align: bottom;">
                                <a id="btnSaveComposition" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-save" plain="true">Save</a>
                            </td>
                            <td style="width:10%; text-align:right; font-size:12px; font-weight:bold; vertical-align:bottom">
                                <a id="btnWinCompositionClose" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-cancel" plain="true">Close</a>
                            </td>
                        </tr>
                    </table>
                </fieldset>
            </div>

        </div>
    </div>
    
    <div class="menuMainCollectionTable" id="regionKnittingOrder">
        <table id="tblKnittingOrders" title="Knitting Order List" class="easyui-datagrid" fit="true" fitcolumns="false" rownumbers="true" pagination="true" singleselect="true" autorowheight="false" toolbar="#toolbar">
            <thead>
                <tr>
                    <th field="OrderNo" width="9%">Order No</th>
                    <th field="OrderDateInString" width="9%">Order Date</th>
                    <th field="FactoryName" width="15%">Factory</th>
                    <th field="StartDateInString" width="9%">Start Date</th>
                    <th field="ApproxCompleteDateInString" width="9%">Complete Date</th>                    
                    <th field="IssueQtyInString" width="9%" align="right">IssueQty</th>
                    <th field="AmountInString" width="9%" align="right">Amount</th>
                    <th field="ApprovedByName" width="12%">Approved By</th>
                    <th field="YarnDeliveryStatusInString" width="12%">Delivery Status</th>
                    <th field="FabricReceivedStatusInString" width="12%">Receive Status</th>
                    <th field="Remarks" width="15%">Remarks</th>
                </tr>
            </thead>
        </table>
        <div id="toolbar">
            <input type="text" id="txtKntOrderNo" placeholder="Enter Order No &Press Enter" style="width:120px;" />
            <input type="text" id="txtKntStyleNo" placeholder="Enter Style No &Press Enter" style="width:120px;" />
            <a id="btnAdvSearch" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-search" plain="true">Adv. Search</a>
            <a id="btnAdd" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-add" plain="true">Add</a>
            <a id="btnEdit" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-edit" plain="true">Edit</a>
            <a id="btnView" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-details" plain="true">View</a>
            <a id="btnDelete" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-remove" plain="true">Delete</a>
            <a id="btnApprove" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-ok" plain="true">Approve</a>
            <a id="btnUnApprove" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-undo" plain="true">Un-Approve</a>
            <a id="btnYarnChallan" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-add" plain="true">Yarn Challan</a>
            <a id="btnFinishYarnChallan" href="javascript:void(0)" title="Finish Yarn Challan" class="easyui-linkbutton easyui-tooltip" iconcls="icon-add" plain="true">Finish Y/C</a>
            <a id="btnFabricReceive" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-add" plain="true">Fabric Receive</a>
            <a id="btnFinishFabricReceive" href="javascript:void(0)" title="Finish Fabric Receive" class="easyui-linkbutton easyui-tooltip" iconcls="icon-add" plain="true">Finish F/R</a>
            <a id="btnAddConsumption" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-add" plain="true">Composition</a>
            <a id="btnAddYarnChallanReturn" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-add" plain="true">Loose Return</a>
            <a id="btnPreview" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-print" plain="true">Preview</a>
            <a id="btnPrintList" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-print" plain="true">Print List</a>
        </div>
    </div>

    <script type="text/javascript">
    debugger;
    var _oKnittingOrder=null;
    var _oKnittingOrders=[];
    var _sBaseAddress="";    
    var _oCompareOperators=[];
    var _oBusinessSessions=[];
    var oKntDetails = [];
    var nYarnID = 0;
    var nFabricIDNew = 0;
    var nYarnName = "";
    var nYarnCode = "";
    var oKntCompositionForEdit = [];
    var SelectedRowIndexForEdit = 0;

    $(document).ready(function () {
        debugger;
        _oKnittingOrders =@Html.Raw( new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(Model));
        _sBaseAddress =@Html.Raw( new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(HttpContext.Current.Session[SessionInfo.BaseAddress]));
        var oAuthorizationRolesMappings =@Html.Raw( new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(HttpContext.Current.Session[SessionInfo.AuthorizationRolesMapping]));
        var nBUID = @Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(ViewBag.BUID));
        sessionStorage.setItem("BUID",nBUID);
        var _oCompareOperators = @Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(ViewBag.CompareOperators));
        var _oBusinessSessions = @Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(ViewBag.BusinessSessions));
        var oKnittingOrders =sessionStorage.getItem("KnittingOrders");
        if(oKnittingOrders!=null)
        {
            oKnittingOrders = jQuery.parseJSON(oKnittingOrders);
        }
        else
        {
            oKnittingOrders=_oKnittingOrders;
        }
        RefreshList(oKnittingOrders);
        RefreshControlLayout(oAuthorizationRolesMappings);
        $("#progressbar").progressbar({ value: 0 });
        $("#progressbarParent").hide();
        $('#btnUpdateKntComposition').hide();
        //advance search
        $("#cboOrderDate").icsLoadCombo({List:_oCompareOperators,OptionValue: "id",DisplayText: "Value",});
        $("#cboStartDate").icsLoadCombo({List:_oCompareOperators,OptionValue: "id",DisplayText: "Value",});
        $("#cboCompleteDate").icsLoadCombo({List:_oCompareOperators,OptionValue: "id",DisplayText: "Value",});
        $("#cboBusinessSession").icsLoadCombo({List:_oBusinessSessions,OptionValue: "BusinessSessionID",DisplayText: "SessionName",});
        $("#winAdvanceSearchPicker").data("FactoryID",0);
        $("#winAdvanceSearchPicker").data("BuyerID",0);
        $("#winAdvanceSearchPicker").data("StyleID",0);
        $("#winAdvanceSearchPicker").data("YarnID",0);
        $("#winAdvanceSearchPicker").data("FabricID",0);

        $('#txtOrderDateStart').datebox({ disabled : true });
        $('#txtOrderDateEnd').datebox({ disabled : true });
        $('#txtStartDateStart').datebox({ disabled : true });
        $('#txtStartDateEnd').datebox({ disabled : true });
        $('#txtCompleteDateStart').datebox({ disabled : true });
        $('#txtCompleteDateEnd').datebox({ disabled : true });
        $('#txtOrderDateStart').datebox('setValue',icsdateformat(new Date()));
        $('#txtOrderDateEnd').datebox('setValue',icsdateformat(new Date()));
        $('#txtStartDateStart').datebox('setValue',icsdateformat(new Date()));
        $('#txtStartDateEnd').datebox('setValue',icsdateformat(new Date()));
        $('#txtCompleteDateStart').datebox('setValue',icsdateformat(new Date()));
        $('#txtCompleteDateEnd').datebox('setValue',icsdateformat(new Date()));

    });

    function updateProgress() {
        var value =$('#progressbar').progressbar('getValue');
        if (value < 96){
            value += Math.floor(Math.random() * 10);
            $('#progressbar').progressbar('setValue', value);
        }
    }
    function hideShow(miliseconds) {
        $("#progressbarParent").hide();
    }
    $("#txtKntOrderNo").keydown(function (e) {
       
        var code = (e.keyCode ? e.keyCode : e.which);
        if (code == 13) // Enter Press
        {
            var sOrderNo =$(this).val();
            if(sOrderNo==undefined || sOrderNo==""){
                alert("Please Type Order No & Press Enter");
                return;
            }
             
            var obj = {
                BaseAddress: sessionStorage.getItem("BaseAddress"),
                Object: {OrderNo:sOrderNo, BUID: sessionStorage.getItem('BUID')},
                ControllerName:"KnittingOrder",
                ActionName:"GetsByOrderNo",
                IsWinClose: false
            };
          
            $.icsDataGets(obj, function (response) {
              
                if (response.status && response.objs.length > 0) {
                    if (response.objs[0].KnittingOrderID > 0) {
                        DynamicRefreshList(response.objs, "tblKnittingOrders");
                    }
                    else { alert(response.objs[0].ErrorMessage); }
                }else{
                    alert("Data Not Found.");
                    return;
                }
            });
        }
      
    });
    function RefreshKnittingOrderDetail(oKntDetail)
    {
        $('#txtStyleNo').val(oKntDetail.StyleNo);
        $('#txtOrderQty').val(oKntDetail.OrderQty);
        $('#txtFabricName').val(oKntDetail.FabricName);
        $('#txtReqQty').val(oKntDetail.Qty);
        $('#txtFinishDiaNew').val(oKntDetail.FinishDia);
        $('#txtColor').val(oKntDetail.ColorName);
        $('#txtPAM').val(oKntDetail.PAM);
        $('#txtGSM').val(oKntDetail.GSM);
        $('#txtMICDiaNew').val(oKntDetail.MICDia);
    }
    $("#txtKntStyleNo").keydown(function (e) {
       
        var code = (e.keyCode ? e.keyCode : e.which);
        if (code == 13) // Enter Press
        {
            var sStyleNo =$(this).val();
            if(sStyleNo==undefined || sStyleNo==""){
                alert("Please Type Style No & Press Enter");
                return;
            }
             
            var obj = {
                BaseAddress: sessionStorage.getItem("BaseAddress"),
                Object: {Params:sStyleNo, BUID: sessionStorage.getItem('BUID')},
                ControllerName:"KnittingOrder",
                ActionName:"GetsByStyleNo",
                IsWinClose: false
            };
          
            $.icsDataGets(obj, function (response) {
              
                if (response.status && response.objs.length > 0) {
                    if (response.objs[0].KnittingOrderID > 0) {
                        DynamicRefreshList(response.objs, "tblKnittingOrders");
                    }
                    else { alert(response.objs[0].ErrorMessage); }
                }else{
                    alert("Data Not Found.");
                    return;
                }
            });
        }
      
    });

    $("#btnAdd").click(function(){
        var oKnittingOrders= $('#tblKnittingOrders').datagrid('getRows');
        sessionStorage.setItem("KnittingOrders", JSON.stringify(oKnittingOrders));
        sessionStorage.setItem("SelectedRowIndex", -1);
        sessionStorage.setItem("KnittingOrderHeader", "Add Knitting Order");
        sessionStorage.setItem('Action','Add')
        sessionStorage.setItem("BackLink", window.location.href);
        var tsv=((new Date()).getTime())/1000;
        window.location.href = _sBaseAddress+ "/KnittingOrder/ViewKnittingOrder?id=0&buid="+sessionStorage.getItem('BUID');  //
    });

        $("#btnEdit").click(function () {
            debugger;
        var oKnittingOrder= $('#tblKnittingOrders').datagrid('getSelected');
        if(oKnittingOrder==null || oKnittingOrder.KnittingOrderID<=0)
        {
            alert("Please select a item from list!");
            return;
        }

        if(oKnittingOrder.ApprovedBy != 0)
        {
            alert("Already approved!");
            return false;
        }


        var tsv=((new Date()).getTime())/1000;
        var SelectedRowIndex=$('#tblKnittingOrders').datagrid('getRowIndex',oKnittingOrder);
        var oKnittingOrders= $('#tblKnittingOrders').datagrid('getRows');
        sessionStorage.setItem("KnittingOrders", JSON.stringify(oKnittingOrders));
        sessionStorage.setItem("SelectedRowIndex", SelectedRowIndex);
        sessionStorage.setItem("KnittingOrderHeader", "Edit Knitting Order");
        sessionStorage.setItem('Action','Edit')
        sessionStorage.setItem("BackLink", window.location.href);
        window.location.href = _sBaseAddress+  "/KnittingOrder/ViewKnittingOrder?id="+oKnittingOrder.KnittingOrderID+"&buid="+sessionStorage.getItem('BUID');
    });

    $("#btnView").click(function(){
        var oKnittingOrder= $('#tblKnittingOrders').datagrid('getSelected');
        if(oKnittingOrder==null || oKnittingOrder.KnittingOrderID<=0)
        {
            alert("Please select a item from list!");
            return;
        }
        var tsv=((new Date()).getTime())/1000;
        var SelectedRowIndex=$('#tblKnittingOrders').datagrid('getRowIndex',oKnittingOrder);
        var oKnittingOrders= $('#tblKnittingOrders').datagrid('getRows');
        sessionStorage.setItem("KnittingOrders", JSON.stringify(oKnittingOrders));
        sessionStorage.setItem("SelectedRowIndex", SelectedRowIndex);
        sessionStorage.setItem("KnittingOrderHeader", "View Knitting Order");
        sessionStorage.setItem('Action','View')
        sessionStorage.setItem("BackLink", window.location.href);
        window.location.href = _sBaseAddress+  "/KnittingOrder/ViewKnittingOrder?id="+oKnittingOrder.KnittingOrderID+"&buid="+sessionStorage.getItem('BUID');
    });

    $("#btnDelete").click(function(){
        var oKnittingOrder= $('#tblKnittingOrders').datagrid('getSelected');
        if(oKnittingOrder==null || oKnittingOrder.KnittingOrderID<=0)
        {
            alert("Invalid Field!!! please select a valid Field!");
            return false;
        }

        if(oKnittingOrder.ApprovedBy != 0)
        {
            alert("Already approved!");
            return false;
        }


        if (!confirm("Confirm to Delete?")) return ;
        var SelectedRowIndex=$('#tblKnittingOrders').datagrid('getRowIndex',oKnittingOrder);
        if (oKnittingOrder.KnittingOrderID > 0)
        {
            $.ajax
            ({
                type: "POST",
                dataType: "json",
                url : _sBaseAddress+  "/KnittingOrder/Delete",
                data: JSON.stringify(oKnittingOrder),
                contentType: "application/json; charset=utf-8",
                success: function (data) {
                    var feedbackmessage = jQuery.parseJSON(data);
                    if (feedbackmessage.toLowerCase() == "deleted")
                    {
                        alert("Delete sucessfully");
                        $('#tblKnittingOrders').datagrid('deleteRow',SelectedRowIndex);
                        var oKnittingOrders= $('#tblKnittingOrders').datagrid('getRows');
                        sessionStorage.setItem("KnittingOrders", JSON.stringify(oKnittingOrders));
                    }
                    else
                    {
                        alert(feedbackmessage);
                    }
                },
                error: function (xhr, status, error)
                {
                    alert(error);
                }
            });
        }
    });

    function RefreshList(oKnittingOrders)
    {
        debugger;
        var data=oKnittingOrders;
        data={"total":""+data.length+"","rows":data};
        $('#tblKnittingOrders').datagrid('loadData',data);
        var nIndex= parseInt(sessionStorage.getItem("SelectedRowIndex"));
        $('#tblKnittingOrders').datagrid('selectRow',nIndex);
    }

    $("#btnYarnChallan").click(function(){
        var oKnittingOrder= $('#tblKnittingOrders').datagrid('getSelected');
        if(oKnittingOrder==null || oKnittingOrder.KnittingOrderID<=0)
        {
            alert("Invalid Field!!! please select a valid Field!");
            return false;
        }
        if(oKnittingOrder.ApprovedBy == 0)
        {
            alert("Item is not approved!");
            return false;
        }
        window.open (_sBaseAddress+ "/KnittingYarnChallan/ViewKnittingYarnChallans?nKntOrderID=" + oKnittingOrder.KnittingOrderID);
    });

    $("#btnApprove").click(function(){
        debugger;
        var oKnittingOrder= $('#tblKnittingOrders').datagrid('getSelected');
        if(oKnittingOrder==null || oKnittingOrder.KnittingOrderID<=0)
        {
            alert("Invalid Field!!! please select a valid Field!");
            return false;
        }
        if(oKnittingOrder.ApprovedBy > 0)
        {
            alert("Already Approved!");
            return false;
        }
        if (!confirm("Confirm to Approve?")) return ;
        var SelectedRowIndex=$('#tblKnittingOrders').datagrid('getRowIndex',oKnittingOrder);
        $.ajax({
            type: "POST",
            dataType: "json",
            url : _sBaseAddress+"/KnittingOrder/Approve",
            traditional: true,
            data:  JSON.stringify(oKnittingOrder),
            contentType: "application/json; charset=utf-8",
            success: function (data) {
                //debugger;
                oKnittingOrder = jQuery.parseJSON(data);
                if (oKnittingOrder.ErrorMessage==null || oKnittingOrder.ErrorMessage=="") {
                    alert("Data Approved successfully");
                    $('#tblKnittingOrders').datagrid('updateRow',{index: SelectedRowIndex,	row: oKnittingOrder});
                    var oKnittingOrders= $('#tblKnittingOrders').datagrid('getRows');
                    sessionStorage.setItem("KnittingOrders", JSON.stringify(oKnittingOrders));
                }
                else {
                    alert(oKnittingOrder.ErrorMessage);
                }
            },
            error: function (xhr, status, error) {
                alert(error);
            }

        });
    });

    $("#btnUnApprove").click(function(){
        debugger;
        var oKnittingOrder= $('#tblKnittingOrders').datagrid('getSelected');
        if(oKnittingOrder==null || oKnittingOrder.KnittingOrderID<=0)
        {
            alert("Invalid Field!!! please select a valid Field!");
            return false;
        }
        if(parseInt(oKnittingOrder.ApprovedBy)==0)
        {
            alert("Already Un-Approved!");
            return false;
        }
        if (!confirm("Confirm to Un-Approve?")) return ;
        var SelectedRowIndex=$('#tblKnittingOrders').datagrid('getRowIndex',oKnittingOrder);
        $.ajax({
            type: "POST",
            dataType: "json",
            url : _sBaseAddress+"/KnittingOrder/UnApprove",
            traditional: true,
            data:  JSON.stringify(oKnittingOrder),
            contentType: "application/json; charset=utf-8",
            success: function (data) {
                //debugger;
                oKnittingOrder = jQuery.parseJSON(data);
                if (oKnittingOrder.ErrorMessage==null || oKnittingOrder.ErrorMessage=="") {
                    alert("Data Un-Approved successfully");
                    $('#tblKnittingOrders').datagrid('updateRow',{index: SelectedRowIndex,	row: oKnittingOrder});
                    var oKnittingOrders= $('#tblKnittingOrders').datagrid('getRows');
                    sessionStorage.setItem("KnittingOrders", JSON.stringify(oKnittingOrders));
                }
                else {
                    alert(oKnittingOrder.ErrorMessage);
                }
            },
            error: function (xhr, status, error) {
                alert(error);
            }

        });
    });
    

    $("#btnFinishYarnChallan").click(function(){
        debugger;
        var oKnittingOrder= $('#tblKnittingOrders').datagrid('getSelected');
        if(oKnittingOrder==null || oKnittingOrder.KnittingOrderID<=0)
        {
            alert("Invalid Field!!! please select a valid Field!");
            return false;
        }
     
        if(oKnittingOrder.ApprovedBy == 0)
        {
            alert("Item is not approved!");
            return false;
        }
        if(oKnittingOrder.YarnDeliveryStatus == 2)
        {
            alert("Already Finished!");
            return false;
        }
        if (!confirm("Confirm to Finish?")) return ;
        var SelectedRowIndex=$('#tblKnittingOrders').datagrid('getRowIndex',oKnittingOrder);
        $.ajax({
            type: "POST",
            dataType: "json",
            url : _sBaseAddress+"/KnittingOrder/FinishYarnChallan",
            traditional: true,
            data:  JSON.stringify(oKnittingOrder),
            contentType: "application/json; charset=utf-8",
            success: function (data) {
                //debugger;
                oKnittingOrder = jQuery.parseJSON(data);
                if (oKnittingOrder.ErrorMessage==null || oKnittingOrder.ErrorMessage=="") {
                    alert("Finished successfully");
                    $('#tblKnittingOrders').datagrid('updateRow',{index: SelectedRowIndex,	row: oKnittingOrder});
                    var oKnittingOrders= $('#tblKnittingOrders').datagrid('getRows');
                    sessionStorage.setItem("KnittingOrders", JSON.stringify(oKnittingOrders));
                }
                else {
                    alert(oKnittingOrder.ErrorMessage);
                }
            },
            error: function (xhr, status, error) {
                alert(error);
            }

        });
    });

    $("#btnFinishFabricReceive").click(function(){
        debugger;
        var oKnittingOrder= $('#tblKnittingOrders').datagrid('getSelected');
        if(oKnittingOrder==null || oKnittingOrder.KnittingOrderID<=0)
        {
            alert("Invalid Field!!! please select a valid Field!");
            return false;
        }
        if(oKnittingOrder.ApprovedBy == 0)
        {
            alert("Item is not approved!");
            return false;
        }
        if(oKnittingOrder.FabricReceivedStatus == 2)
        {
            alert("Already Finished!");
            return false;
        }
        if (!confirm("Confirm to Finish?")) return ;
        var SelectedRowIndex=$('#tblKnittingOrders').datagrid('getRowIndex',oKnittingOrder);
        $.ajax({
            type: "POST",
            dataType: "json",
            url : _sBaseAddress+"/KnittingOrder/FinishFabricReceive",
            traditional: true,
            data:  JSON.stringify(oKnittingOrder),
            contentType: "application/json; charset=utf-8",
            success: function (data) {
                //debugger;
                oKnittingOrder = jQuery.parseJSON(data);
                if (oKnittingOrder.ErrorMessage==null || oKnittingOrder.ErrorMessage=="") {
                    alert("Finished successfully");
                    $('#tblKnittingOrders').datagrid('updateRow',{index: SelectedRowIndex,	row: oKnittingOrder});
                    var oKnittingOrders= $('#tblKnittingOrders').datagrid('getRows');
                    sessionStorage.setItem("KnittingOrders", JSON.stringify(oKnittingOrders));
                }
                else {
                    alert(oKnittingOrder.ErrorMessage);
                }
            },
            error: function (xhr, status, error) {
                alert(error);
            }

        });
    });

    $("#btnFabricReceive").click(function(){
        var oKnittingOrder= $('#tblKnittingOrders').datagrid('getSelected');
        if(oKnittingOrder==null || oKnittingOrder.KnittingOrderID<=0)
        {
            alert("Invalid Field!!! please select a valid Field!");
            return false;
        }
        if(oKnittingOrder.ApprovedBy == 0)
        {
            alert("Item is not approved!");
            return false;
        }
        window.open (_sBaseAddress+ "/KnittingFabricReceive/ViewKnittingFabricReceives?nKntOrderID=" + oKnittingOrder.KnittingOrderID);
    });
    $("#btnAddYarnChallanReturn").click(function(){
        var oKnittingOrder= $('#tblKnittingOrders').datagrid('getSelected');
        if(oKnittingOrder==null || oKnittingOrder.KnittingOrderID<=0)
        {
            alert("Invalid Field!!! please select a valid Field!");
            return false;
        } 
        if(oKnittingOrder.ApprovedBy == 0)
        {
            alert("Item is not approved!");
            return false;
        }
        window.open (_sBaseAddress+ "/KnittingYarnReturn/ViewKnittingYarnReturnChallans?nKntOrderID=" + oKnittingOrder.KnittingOrderID);
          
    });

    //Advance search
    $('#btnCloseForAdvSearch').click(function(e) {
        $("#winAdvanceSearchPicker").icsWindow('close');
    });

    $("#btnAdvSearch").click(function(){
        $("#winAdvanceSearchPicker").icsWindow('open', "Advance Search");
    });

    $('#btnRefreshForAdvSearch').click(function(){
        //debugger;
        var sKnittingOrderNo = $("#txtKnittingOrderNo").val();
        var nOrderDate = parseInt($("#cboOrderDate").val());
        var dOrderDateStart = $('#txtOrderDateStart').datebox('getValue');
        var dOrderDateEnd = $('#txtOrderDateEnd').datebox('getValue');
        var nStartDate = parseInt($("#cboStartDate").val());
        var dStartDateStart = $('#txtStartDateStart').datebox('getValue');
        var dStartDateEnd = $('#txtStartDateEnd').datebox('getValue');
        var nCompleteDate = parseInt($("#cboCompleteDate").val());
        var dCompleteDateStart = $('#txtCompleteDateStart').datebox('getValue');
        var dCompleteDateEnd = $('#txtCompleteDateEnd').datebox('getValue');
        var nFactoryID = parseInt($("#winAdvanceSearchPicker").data("FactoryID"));
        var nBuyerID = parseInt($("#winAdvanceSearchPicker").data("BuyerID"));
        var nBusinessSessionID = parseInt($("#cboBusinessSession").val());

        var nStyleID = parseInt($("#winAdvanceSearchPicker").data("StyleID"));
        var nFabricID = parseInt($("#winAdvanceSearchPicker").data("FabricID"));
        var nYarnID = parseInt($("#winAdvanceSearchPicker").data("YarnID"));

        var sMICDia = $("#txtMICDia").val();
        var sFinishDia = $("#txtFinishDia").val();

        if((sKnittingOrderNo == "" || sKnittingOrderNo == null) && nOrderDate <= 0 && nStartDate <= 0 && nCompleteDate<= 0 && nFactoryID <= 0 && nBuyerID <= 0 && nBusinessSessionID <= 0 && nStyleID <= 0 && nFabricID <= 0 && nYarnID <= 0 && (sMICDia == "" || sMICDia == null) && (sFinishDia == "" || sFinishDia == null)){
            alert("Please enter at least one field!!!");
            return false;
        }

        var sTempString = sKnittingOrderNo+'~'+nOrderDate+'~'+dOrderDateStart+'~'+dOrderDateEnd+'~'+nStartDate+'~'+dStartDateStart+'~'+dStartDateEnd+'~'+nCompleteDate+'~'+dCompleteDateStart+'~'+dCompleteDateEnd+'~'+nFactoryID+'~'+nBuyerID+'~'+nBusinessSessionID+'~'+nStyleID+'~'+nFabricID+'~'+nYarnID+'~'+sMICDia+'~'+sFinishDia + '~' + sessionStorage.getItem('BUID');

        $.ajax({
            type: "GET",
            dataType: "json",
            url: '@Url.Action("Gets", "KnittingOrder")',
            data: { Temp: sTempString },
            contentType: "application/json; charset=utf-8",
            success: function (data) {
                debugger;
                oKnittingOrders = jQuery.parseJSON(data);
                if (oKnittingOrders != null) {
                    if(oKnittingOrders.length>0)
                    {
                        DynamicRefreshList(oKnittingOrders, "tblKnittingOrders");
                        $("#winAdvanceSearchPicker").icsWindow('close');
                    }
                    else
                    {
                        alert("Data not found!!");
                    }
                }
            },
            error: function (xhr, status, error) {
                alert(error);
            }
        });
    });

    $('#cboOrderDate').change(function(e){
        //EqualTo = 1, NotEqualTo = 2, GreaterThen = 3, SmallerThen = 4, Between = 5, NotBetween = 6
        var nCompareOperator =   parseInt($('#cboOrderDate').val());
        if(nCompareOperator===0)
        {
            $('#txtOrderDateStart').datebox({ disabled : true });
            $('#txtOrderDateEnd').datebox({ disabled : true });
        }
        else if (nCompareOperator===1 || nCompareOperator===2 || nCompareOperator===3 || nCompareOperator===4)
        {
            $('#txtOrderDateStart').datebox({ disabled : false });
            $('#txtOrderDateEnd').datebox({ disabled : true });
        }
        else
        {
            $('#txtOrderDateStart').datebox({ disabled : false });
            $('#txtOrderDateEnd').datebox({ disabled : false });
        }
        $('#txtOrderDateStart').datebox('setValue', icsdateformat(new Date()));
        $('#txtOrderDateEnd').datebox('setValue', icsdateformat(new Date()));
    });

    $('#cboStartDate').change(function(e){
        //EqualTo = 1, NotEqualTo = 2, GreaterThen = 3, SmallerThen = 4, Between = 5, NotBetween = 6
        var nCompareOperator =   parseInt($('#cboStartDate').val());
        if(nCompareOperator===0)
        {
            $('#txtStartDateStart').datebox({ disabled : true });
            $('#txtStartDateEnd').datebox({ disabled : true });
        }
        else if (nCompareOperator===1 || nCompareOperator===2 || nCompareOperator===3 || nCompareOperator===4)
        {
            $('#txtStartDateStart').datebox({ disabled : false });
            $('#txtStartDateEnd').datebox({ disabled : true });
        }
        else
        {
            $('#txtStartDateStart').datebox({ disabled : false });
            $('#txtStartDateEnd').datebox({ disabled : false });
        }
        $('#txtStartDateStart').datebox('setValue', icsdateformat(new Date()));
        $('#txtStartDateEnd').datebox('setValue', icsdateformat(new Date()));
    });

    $('#cboCompleteDate').change(function(e){
        //EqualTo = 1, NotEqualTo = 2, GreaterThen = 3, SmallerThen = 4, Between = 5, NotBetween = 6
        var nCompareOperator =   parseInt($('#cboCompleteDate').val());
        if(nCompareOperator===0)
        {
            $('#txtCompleteDateStart').datebox({ disabled : true });
            $('#txtCompleteDateEnd').datebox({ disabled : true });
        }
        else if (nCompareOperator===1 || nCompareOperator===2 || nCompareOperator===3 || nCompareOperator===4)
        {
            $('#txtCompleteDateStart').datebox({ disabled : false });
            $('#txtCompleteDateEnd').datebox({ disabled : true });
        }
        else
        {
            $('#txtCompleteDateStart').datebox({ disabled : false });
            $('#txtCompleteDateEnd').datebox({ disabled : false });
        }
        $('#txtCompleteDateStart').datebox('setValue', icsdateformat(new Date()));
        $('#txtCompleteDateEnd').datebox('setValue', icsdateformat(new Date()));
    });

    function FactoryKeyDown(event) {
        //return;
        if (event.which == 13) {
            var oTxtName=$("#txtFactory").val();
            if (oTxtName != null) {
                PickFactory(oTxtName);
            }
        }
        if (event.which == 8) {
            $("#winAdvanceSearchPicker").data("FactoryID",0);
            txtFactory.style.color="Black";
        }
    }

    function PickFactory(oTxtName)
    {
        var oStyleSearch = {
            Params: '3' + '~' + (typeof(oTxtName) != 'undefined'?oTxtName:"")+'~'+sessionStorage.getItem("BUID")
        };

        debugger;
        var obj = {
            BaseAddress:_sBaseAddress,
            Object: (oStyleSearch) ,
            ControllerName: "Contractor", 
            ActionName: "ContractorSearchByNameType",
            IsWinClose: false
        };
        var tblColums = []; var oColumn = { field: "Name", title: "Name", width: 200, align: "left" }; tblColums.push(oColumn);
        oColumn = { field: "Address", title: "Address", width: 120, align: "left" }; tblColums.push(oColumn);
        oColumn = { field: "Email", title: "Email", width: 90, align: "left" }; tblColums.push(oColumn);
        oColumn = { field: "ShortName", title: "Short Name", width: 90, align: "left" }; tblColums.push(oColumn);
        DynamicPiker('Factory',obj,tblColums,false,'Name','ContractorID',400); //pickerName(unique),obj,table,multiReturn,SearchingField, pkID
    }

    function SetFactory(oSelectedStyle) {
        debugger;
        document.getElementById("txtFactory").value = oSelectedStyle.Name;
        $("#winAdvanceSearchPicker").data("FactoryID",oSelectedStyle.ContractorID);
        txtFactory.style.color="Blue";
    }

    function BuyerKeyDown(event) {
        //return;
        if (event.which == 13) {
            var oTxtName=$("#txtBuyer").val();
            if (oTxtName != null) {
                PickBuyer(oTxtName);
            }
        }
        if (event.which == 8) {
            $("#winAdvanceSearchPicker").data("BuyerID",0);
            txtBuyer.style.color="Black";
        }
    }

    function PickBuyer(oTxtName)
    {
        var oStyleSearch = {
            Params: '2' + '~' + (typeof(oTxtName) != 'undefined'?oTxtName:"")+'~'+sessionStorage.getItem("BUID")
        };

        debugger;
        var obj = {
            BaseAddress:_sBaseAddress,
            Object: (oStyleSearch) ,
            ControllerName: "Contractor", 
            ActionName: "ContractorSearchByNameType",
            IsWinClose: false
        };
        var tblColums = []; var oColumn = { field: "Name", title: "Name", width: 200, align: "left" }; tblColums.push(oColumn);
        oColumn = { field: "Address", title: "Address", width: 120, align: "left" }; tblColums.push(oColumn);
        oColumn = { field: "Email", title: "Email", width: 90, align: "left" }; tblColums.push(oColumn);
        oColumn = { field: "ShortName", title: "Short Name", width: 90, align: "left" }; tblColums.push(oColumn);
        DynamicPiker('Buyer',obj,tblColums,false,'Name','ContractorID',400); //pickerName(unique),obj,table,multiReturn,SearchingField, pkID
    }

    function SetBuyer(oSelectedStyle) {
        debugger;
        document.getElementById("txtBuyer").value = oSelectedStyle.Name;
        $("#winAdvanceSearchPicker").data("BuyerID",oSelectedStyle.ContractorID);
        txtBuyer.style.color="Blue";
    }

    function StyleKeyDown(event) {
        //return;
        if (event.which == 13) {
            var oTxtName=$("#txtStyle").val();
            if (oTxtName != null) {
                PickStyle(oTxtName);
            }
        }
        if (event.which == 8) {
            txtStyle.style.color="Black";
            $("#winAdvanceSearchPicker").data("StyleID",0);
        }
    }

    function PickStyle(oTxtName)
    {
        debugger;
        var oStyleSearch = {
            StyleNo: (typeof(oTxtName) != 'undefined'?oTxtName:"")
        };

        debugger;
        var obj = {
            BaseAddress:_sBaseAddress,
            Object: (oStyleSearch) ,
            ControllerName: "TechnicalSheet",
            ActionName: "StyleSearch",
            IsWinClose: false
        };
        var tblColums = []; var oColumn = { field: "StyleNo", title: "Style No", width: 100, align: "left" }; tblColums.push(oColumn);
        oColumn = { field: "BuyerName", title: "Buyer Name", width: 200, align: "left" }; tblColums.push(oColumn);
        oColumn = { field: "SessionName", title: "Business Session", width: 100, align: "left" }; tblColums.push(oColumn);
        DynamicPiker('Style',obj,tblColums,false,'StyleNo','TechnicalSheetID',500); //pickerName(unique),obj,table,multiReturn,SearchingField, pkID
    }

    function SetStyle(oSelectedStyle) {
        debugger;
        document.getElementById("txtStyle").value = oSelectedStyle.StyleNo;
        $("#winAdvanceSearchPicker").data("StyleID",oSelectedStyle.TechnicalSheetID);
        txtStyle.style.color="Blue";
    }

    function ProductKeyDown(event) {
        //return;
        if (event.which == 13) {
            var oTxtName=$("#txtProduct").val();
            if (oTxtName != null) {
                PickProduct(oTxtName);
            }
        }
        if (event.which == 8) {
            txtProduct.style.color="Black";
            $("#winAdvanceSearchPicker").data("YarnID",0);
        }
    }

    function PickProduct(oTxtName)
    {
        debugger;
        var oStyleSearch = {
            BUID:sessionStorage.getItem("BUID"),
            ProductName: $("#txtProduct").val()
        };

        console.log(oStyleSearch);
        debugger;
        var obj = {
            BaseAddress:_sBaseAddress,
            Object: (oStyleSearch) ,
            ControllerName: "KnittingOrder", //Product
            ActionName: "GetYarnCategory",//SearchByProductBUWise
            IsWinClose: false
        };
        var tblColums = []; var oColumn = []; var oColumn = { field: "ProductName", title: "Product Name", width: 150, align: "left" }; tblColums.push(oColumn);
        oColumn = { field: "ProductCode", title: "Code", width: 150, align: "left" }; tblColums.push(oColumn);
        DynamicPiker('Product',obj,tblColums,true,'ProductName','ProductID',500); //pickerName(unique),obj,table,multiReturn,SearchingField, pkID
    }

    function SetProduct(oSelectedStyle) {
        document.getElementById("txtProduct").value = oSelectedStyle.ProductName;
        $("#winAdvanceSearchPicker").data("YarnID",oSelectedStyle.ProductID);
        txtProduct.style.color="Blue";

    }

    function FabricKeyDown(event) {
        //return;
        if (event.which == 13) {
            var oTxtName=$("#txtFabric").val();
            if (oTxtName != null) {
                PickFabric(oTxtName);
            }
        }
        if (event.which == 8) {
            txtFabric.style.color="Black";
            $("#winAdvanceSearchPicker").data("FabricID",0);
        }
    }

    function PickFabric(oTxtName)
    {
        debugger;
        var oStyleSearch = {
            BUID:sessionStorage.getItem("BUID"),
            ProductName: $("#txtFabric").val()
        };

        debugger;
        var obj = {
            BaseAddress:_sBaseAddress,
            Object: (oStyleSearch) ,
            ControllerName: "KnittingOrder", //Product
            ActionName: "GetFabricCategory",//SearchByProductBUWise
            IsWinClose: false
        };
        var tblColums = []; var oColumn = []; var oColumn = { field: "ProductName", title: "Product Name", width: 150, align: "left" }; tblColums.push(oColumn);
        oColumn = { field: "ProductCode", title: "Code", width: 150, align: "left" }; tblColums.push(oColumn);
        DynamicPiker('Fabric',obj,tblColums,false,'ProductName','ProductID',500); //pickerName(unique),obj,table,multiReturn,SearchingField, pkID
    }

    function SetFabric(oSelectedStyle) {
        debugger;
        document.getElementById("txtFabric").value = oSelectedStyle.ProductName;
        $("#winAdvanceSearchPicker").data("FabricID",oSelectedStyle.ProductID);
        txtFabric.style.color="Blue";
    }

    function SetPickerValueAssign(oPickerobj)
    {
        debugger;
        var oResult;
        if (oPickerobj.multiplereturn)
        {
            oResult = $('#'+oPickerobj.tableid).datagrid('getChecked');
        }
        else
        {
            oResult = $('#'+oPickerobj.tableid).datagrid('getSelected');
        }

        if (oPickerobj.winid == 'winFactory')
        {
            SetFactory(oResult);
        }
        else if (oPickerobj.winid == 'winBuyer')
        {
            SetBuyer(oResult);
        }
        else if (oPickerobj.winid == 'winStyle')
        {
            SetStyle(oResult);
        }
        else if (oPickerobj.winid == 'winProduct')
        {
            SetProduct(oResult);
        }
        else if (oPickerobj.winid == 'winFabric')
        {
            SetFabric(oResult);
        }
        
        $("#" + oPickerobj.winid).icsWindow("close");
        $("#" + oPickerobj.winid).remove();
    }

    function updateProgress() {
        var value =$('#progressbar').progressbar('getValue');
        if (value < 90){
            value += Math.floor(Math.random() * 10);
            $('#progressbar').progressbar('setValue', value);
        }
    }
    
    function hideShow(miliseconds) {
        $("#progressbarParent").hide();
    }
    
    function DynamicPiker(pickerName,obj,pTblColums,pMultiReturn,pSearchField,pID,nWidth)
    {
        debugger;
        $("#progressbar").progressbar({ value: 0 });
        $("#progressbarParent").show();
        setInterval(updateProgress,250);

        $.icsDataGets(obj, function (response) {
            debugger;
            if (response.status && response.objs.length > 0) {
                if (response.objs[0][pID] > 0) {
                    debugger;
                    var tblColums = pTblColums;
                    var oPickerParam = {
                        winid: 'win'+pickerName,
                        winclass: 'cls'+pickerName,
                        winwidth: nWidth,
                        winheight: 460,
                        tableid: 'tbl'+pickerName+'s',
                        tablecolumns: tblColums,
                        datalist: response.objs,
                        multiplereturn: pMultiReturn,
                        searchingbyfieldName: pSearchField,
                        windowTittle: pickerName+' List',
                        colsable:true
                    };
                    $.icsPicker(oPickerParam);
                    $("#progressbar").progressbar({ value: 0 });//hide
                    $("#progressbarParent").hide();
                    IntializePickerbutton(oPickerParam);
                }
                else {
                    alert(response.objs[0].ErrorMessage);
                    $("#progressbar").progressbar({ value: 0 });//hide
                    $("#progressbarParent").hide();
                }
            }
            else{
                alert("Data Not Found.");
                $("#progressbar").progressbar({ value: 0 });//hide
                $("#progressbarParent").hide();
                return;
            }
        });
    }
    
    function IntializePickerbutton(oPickerobj) {
        debugger;
        $("#" + oPickerobj.winid).find("#btnOk").click(function () {
            debugger;
            //for Single Select
            SetPickerValueAssign(oPickerobj);
        });
        $(document).find('.' + oPickerobj.winclass).keydown(function (e) {
            if (e.which == 13)//enter=13
            {
                SetPickerValueAssign(oPickerobj);
            }
        });
    }
    //Advance search

    $('#btnPrintList').click(function(){

        var oKnittingOrders= $('#tblKnittingOrders').datagrid('getRows');
        if(oKnittingOrders.length<=0)
        {
            alert("Data not found ");
            return;
        }
        var sKnittingOrderIDs = "";
        for(var i = 0;i<oKnittingOrders.length;i++)
        {
            sKnittingOrderIDs+= oKnittingOrders[i].KnittingOrderID+",";
        }
        sKnittingOrderIDs = sKnittingOrderIDs.substring(0, sKnittingOrderIDs.length-1);
        var oKnittingOrder = {ErrorMessage:sKnittingOrderIDs};
        $.ajax({
            type: "POST",
            dataType: "json",
            url : _sBaseAddress+  "/KnittingOrder/SetKnittingOrderListData",
            traditional: true,
            data:  JSON.stringify(oKnittingOrder),
            contentType: "application/json; charset=utf-8",
            success: function (data) {
                var sFeedBackMessage = jQuery.parseJSON(data);
                if (sFeedBackMessage==="Successful")
                {
                    window.open (_sBaseAddress+ "/KnittingOrder/PrintKnittingOrders");
                }
            },
            error: function (xhr, status, error) {
                alert(error);
            }
        });

    });

    $('#btnPreview').click(function(){
        var oKnittingOrder=$('#tblKnittingOrders').datagrid('getSelected');
        if(oKnittingOrder==null || parseInt(oKnittingOrder.KnittingOrderID)<=0)
        {
            alert("Please select Knitting Order ");
            return;
        }
        window.open(_sBaseAddress+ "/KnittingOrder/KnittingOrderPrintPreview?id="+oKnittingOrder.KnittingOrderID);
    });


    function RefreshControlLayout(oAuthorizationRolesMappings)
    {
        $('#btnAdd,#btnEdit,#btnDelete,#btnView,#btnYarnChallan,#btnApprove,#btnUnApprove,#btnFinishYarnChallan,#btnPreview,#btnAdvSearch,#btnFabricReceive,#btnFinishFabricReceive,#btnAddConsumption,#btnPrintList,#btnAddYarnChallanReturn').hide(); //

        if(PermissionChecker('Add','KnittingOrder', oAuthorizationRolesMappings)){$('#btnAdd').show();}
        if(PermissionChecker('Edit','KnittingOrder', oAuthorizationRolesMappings)){$('#btnEdit').show(); }
        if(PermissionChecker('View','KnittingOrder', oAuthorizationRolesMappings)){$('#btnView').show(); }
        if(PermissionChecker('Delete','KnittingOrder', oAuthorizationRolesMappings)){ $('#btnDelete').show(); }                
        if(PermissionChecker('Approved','KnittingOrder', oAuthorizationRolesMappings)){$('#btnApprove,#btnUnApprove').show();}       
        
        
        if(PermissionChecker('Preview','KnittingOrder', oAuthorizationRolesMappings)){$('#btnPreview').show();  }
        if(PermissionChecker('AdvSearch','KnittingOrder', oAuthorizationRolesMappings)){$('#btnAdvSearch').show();}        
        if(PermissionChecker('PrintList','KnittingOrder', oAuthorizationRolesMappings)){$('#btnPrintList').show();}
        if(PermissionChecker('Add','KnittingYarnChallan', oAuthorizationRolesMappings)){$('#btnYarnChallan').show();}
        if(PermissionChecker('Approved','KnittingYarnChallan', oAuthorizationRolesMappings)){$('#btnFinishYarnChallan').show();}

        if(PermissionChecker('Add','KnittingFabricReceive', oAuthorizationRolesMappings)){$('#btnFabricReceive').show();}
        if(PermissionChecker('Approved','KnittingFabricReceive', oAuthorizationRolesMappings)){$('#btnFinishFabricReceive').show();}

        if(PermissionChecker('Add','KnittingComposition', oAuthorizationRolesMappings)){$('#btnAddConsumption').show();}
        if(PermissionChecker('Add','KnittingYarnReturn', oAuthorizationRolesMappings)){$('#btnAddYarnChallanReturn').show();}
    }

        /*--------------- Region Knitting Composition----------*/
        $("#btnWinCompositionClose").click(function(){
            RefreshConsumption();
            $("#winKnittingConsumption").icsWindow('close');
        });
       
        function RefreshConsumption()
        {
            $('#txtStyleNo').val("");
            $('#txtOrderQty').val("");
            $('#txtColor').val("");
            $('#txtFabricName').val("");
            $('#txtReqQty').val("");
            $('#txtFinishDiaNew').val("");
            $('#txtYarn').val("");
            $('#txtYarnRatio').val("");
            $('#txtMICDiaNew').val("");
            $('#txtGSM').val("");
            $('#txtPAM').val("");
            $('#txtYarnQty').val("");
            nYarnID = 0;
            nYarnName = "";
            nYarnCode = "";
        }
        $("#btnAddConsumption").click(function(){
            var oKnittingOrder= $('#tblKnittingOrders').datagrid('getSelected');
            if(oKnittingOrder==null || oKnittingOrder.KnittingOrderID<=0)
            {
                alert("Invalid Field!!! please select a valid Field!");
                return false;
            }
            if(oKnittingOrder.ApprovedBy== 0)
            {
                alert("Select Approved Item!");
                return false;
            }
           
            $.ajax({
                type: "POST",
                dataType: "json",
                url: _sBaseAddress + "/KnittingOrder/GetsDetailsByKnitOrderID",
                traditional: true,
                data:  JSON.stringify(oKnittingOrder),
                contentType: "application/json; charset=utf-8",
                success: function (data) {
                    debugger;
                    oKntDetails = jQuery.parseJSON(data);
                    if (oKntDetails.length>0)
                    {  
                        $.icsMakeFooterColumn('tblKnittingConsumption',['YarnCode','Qty','RatioInPercent']);
                        $("#winKnittingConsumption").icsWindow('open', "");
                        $("#lblWinConsumptionHeader").text("Add Composition For - "+oKnittingOrder.OrderNo);
                        DynamicRefreshList([], "tblKnittingConsumption"); 
                        $("#cboFabricOrderDetail").icsLoadCombo({ List: oKntDetails, OptionValue: "KnittingOrderDetailID", DisplayText: "FabricWithCodeColor"});
                    }
                    else
                    {
                        alert("No Fabric align with order");
                   
                    }
                },
                error: function (xhr, status, error) {
                    alert(error);
                }
            });
          
        });
       
        var editIndex = undefined;

        function onClickRow(index) {
            if (editIndex != index) {
          
                if (endEditing()) {
                    $('#tblKnittingConsumption').datagrid('selectRow', index).datagrid('beginEdit', index);
                    var oData= $('#tblKnittingConsumption').datagrid('getSelected');
                    _dQtyBeforEdit = oData.Qty;
                    _dParcentBeforEdit = oData.RatioInPercent;
                    editIndex = index;
                }
                else {
                    $('#tblKnittingConsumption').datagrid('selectRow', editIndex);
                }
          
            }
        }

        function endEditing() {

            if (editIndex == undefined) {
                return true;
            }
            if ($('#tblKnittingConsumption').datagrid('validateRow', editIndex)) 
            {
                $('#tblKnittingConsumption').datagrid('endEdit', editIndex);
                $('#tblKnittingConsumption').datagrid('selectRow', editIndex);
                $.icsMakeFooterColumn('tblKnittingConsumption',['YarnCode','Qty','RatioInPercent']);
                editIndex = undefined;
                return true;
            }
            else {
                return false;
            }
        }


        $("#cboFabricOrderDetail").on('change',function(){
            editIndex = undefined;
            DynamicRefreshList([], "tblKnittingConsumption"); 
            var nKnittingOrderDetailID =$("#cboFabricOrderDetail").val();
            for(var i=0; i<oKntDetails.length;i++)
            {
                if(nKnittingOrderDetailID == oKntDetails[i].KnittingOrderDetailID)
                {
                    RefreshKnittingOrderDetail(oKntDetails[i]);
                }
            }

            if(nKnittingOrderDetailID>0){

                $.ajax({
                    type: "POST",
                    dataType: "json",
                    url: _sBaseAddress + "/KnittingOrder/GetsKnittingCompositionByDetail",
                    traditional: true,
                    data:  JSON.stringify({KnittingOrderDetailID:nKnittingOrderDetailID}),
                    contentType: "application/json; charset=utf-8",
                    success: function (data) {
                
                        oKntCompositions = jQuery.parseJSON(data);
                        if (oKntCompositions.length>0)
                        { 

                            DynamicRefreshList(oKntCompositions, "tblKnittingConsumption"); 

                            $.icsMakeFooterColumn('tblKnittingConsumption',['YarnCode','Qty','RatioInPercent']);
                        }
                        else
                        {
                            alert("No Composition align with order");
                   
                        }
                    },
                    error: function (xhr, status, error) {
                        alert(error);
                    }

                });
            }
        });
        $("#btnSaveComposition").click(function () {
            endEditing();
            var oKntCompositions= $('#tblKnittingConsumption').datagrid('getRows');
            var nTtlRatio= 0;
            var nTotalQty = 0;
            var finalKntCompositions=[];
            for(var i=0;i<oKntCompositions.length;i++){
                if(oKntCompositions[i].RatioInPercent>0)
                {
                    finalKntCompositions.push(oKntCompositions[i]);
                }
            }            
            for(var i=0;i<oKntCompositions.length;i++){
                nTtlRatio+=parseFloat(oKntCompositions[i].RatioInPercent);
                nTotalQty+=parseFloat(oKntCompositions[i].Qty);
            }
            var nBalance = (100 - parseFloat(nTtlRatio));
            if(nBalance<0)
            {
                nBalance = (nBalance * (-1));
            }

            if(nBalance>0.2)
            {
                alert("Total Ration Sum must be 100% !!");
                return false;
            }
            nBalance = (parseFloat($('#txtReqQty').val()) - parseFloat(nTotalQty));
            if(nBalance<0)
            {
                nBalance = (nBalance * (-1));
            }
            if(nBalance>0.2)
            {
                alert("Total Qty Sum must be Equal To Knitting Qty !!");
                return false;
            }

            var oKnittingComposition= {
                KnittingCompositions:finalKntCompositions
            }
            $.ajax({
                type: "POST",
                dataType: "json",
                url: _sBaseAddress + "/KnittingOrder/SaveKnittingComposition",
                traditional: true,
                data:  JSON.stringify(oKnittingComposition),
                contentType: "application/json; charset=utf-8",
                success: function (data) {
                
                    var oKntComposition = jQuery.parseJSON(data);
                    if (oKntComposition.ErrorMessage =="" || oKntComposition.ErrorMessage==null)
                    {
                        alert("Data Saved sucessfully");
                        DynamicRefreshList(oKntComposition.KnittingCompositions, "tblKnittingConsumption");
                    
                    }
                    else
                    {
                        alert(oKntComposition.ErrorMessage);
                   
                    }
                },
                error: function (xhr, status, error) {
                    alert(error);
                }
            });

        });
        $('#btnDeleteKntComposition').click(function(){
            //debugger;
            var oSelected= $('#tblKnittingConsumption').datagrid('getSelected');
            if(oSelected==null)
            {
                alert("Invalid Field!!! please select a valid Field!");
                return false;
            }
        
            if (!confirm("Confirm to Delete?")) return ;

            var SelectedRowIndex=$('#tblKnittingConsumption').datagrid('getRowIndex',oSelected);
            $('#tblKnittingConsumption').datagrid('deleteRow',SelectedRowIndex);
            $.icsMakeFooterColumn('tblKnittingConsumption',['YarnCode','Qty','RatioInPercent']);
          
        });
        /*---------------Endregion----------------------------*/
        $('#btnAddKntComposition').click(function(){
            debugger;
            if($('#cboFabricOrderDetail').val()<=0)
            {
                alert("Please Select Any Fabric Detail");
                $('#cboFabricOrderDetail').focus();
                return;
            }
            if(nYarnID<=0)
            {
                alert("Please Enter Any Yarn");
                $('#txtYarn').focus();
                return;
            }
            var oKnittingOrder= $('#tblKnittingOrders').datagrid('getSelected');
            for(var i=0; i<oKntDetails.length;i++)
            {
                if($('#cboFabricOrderDetail').val() == oKntDetails[i].KnittingOrderDetailID)
                {
                    nFabricIDNew = oKntDetails[i].FabricID;
                }
            }
            var oKnittingComposition = {
                KnittingCompositionID : 0,
                KnittingOrderID : oKnittingOrder.KnittingOrderID,
                KnittingOrderDetailID : $('#cboFabricOrderDetail').val(),
                YarnID : nYarnID,
                FabricID : nFabricIDNew,
                YarnName : nYarnName,
                YarnCode : nYarnCode,
                Qty : parseFloat($('#txtYarnQty').val()),
                RatioInPercent : parseFloat($('#txtYarnRatio').val())
            }
            $('#tblKnittingConsumption').datagrid('appendRow', oKnittingComposition);
            $.icsMakeFooterColumn('tblKnittingConsumption',['YarnCode','Qty','RatioInPercent']);
            $('#btnPickYarnCancel').click()
        });

        $('#btnEditKntComposition').click(function(){
            oKntCompositionForEdit = $('#tblKnittingConsumption').datagrid('getSelected');
            SelectedRowIndexForEdit=$('#tblKnittingConsumption').datagrid('getRowIndex',oKntCompositionForEdit);
            if(oKntCompositionForEdit==null)
            {
                alert("Please select a item from list!");
                return;
            }
            $('#txtYarnQty').val(oKntCompositionForEdit.Qty);
            $('#txtYarnRatio').val(oKntCompositionForEdit.RatioInPercent);
            $('#btnUpdateKntComposition').show();
            $('#btnAddKntComposition').hide();
            $('#btnDeleteKntComposition').hide();
        });
        $('#btnUpdateKntComposition').click(function(){
            oKntCompositionForEdit.Qty = parseFloat($('#txtYarnQty').val());
            oKntCompositionForEdit.RatioInPercent = parseFloat($('#txtYarnRatio').val());
            $('#txtYarnQty').val(oKntCompositionForEdit.Qty);
            $('#txtYarnRatio').val(oKntCompositionForEdit.RatioInPercent);
            $('#btnAddKntComposition').show();
            $('#btnEditKntComposition').show();
            $('#btnDeleteKntComposition').show();
            $('#btnUpdateKntComposition').hide();
            $('#tblKnittingConsumption').datagrid('updateRow',{index: SelectedRowIndexForEdit,	row: oKntCompositionForEdit});
            $('#txtYarnQty').val(parseFloat(0));
            $('#txtYarnRatio').val(parseFloat(0));
            $.icsMakeFooterColumn('tblKnittingConsumption',['YarnCode','Qty','RatioInPercent']);
        });
        
        function AddYarnIntoGridQty(event) {
            debugger;
            var dValue =  parseFloat($('#txtYarnQty').val())/ parseFloat($('#txtReqQty').val()) * 100;
            dValue = dValue.toFixed(2);
            $('#txtYarnRatio').val(dValue);
            if (event.which == 13) {
                $('#btnAddKntComposition').click();
            }
        }
        function AddYarnIntoGridRatio(event) {
            debugger;
            var dValue =  parseFloat($('#txtYarnRatio').val()) / 100 * parseFloat($('#txtReqQty').val());
            dValue = dValue.toFixed(2);
            $('#txtYarnQty').val(dValue);
            if (event.which == 13) {
                $('#btnAddKntComposition').click();
            }
        }
        //--------------------------Pick Yarn---------------------------
        $('#btnPickYarnCancel').click(function(){
            debugger;
            nYarnID = 0;
            nFabricIDNew = 0;
            nYarnName = "";
            nYarnCode = "";
            $('#txtYarn').val("");
            $('#txtYarnQty').val(0);
            $('#txtYarnRatio').val(0);
        });
        function YarnKeyDown(event) {
            //return;
            if (event.which == 13) {
                var oTxtName=$("#txtYarn").val();
                if (oTxtName != null) {
                    PickYarn(oTxtName);
                }
            }
            if (event.which == 8) {
                nYarnID = 0;
                nFabricIDNew = 0;
                nYarnName = "";
                nYarnCode = "";
            }
        }
        $('#btnPickYarnOK').click(function(){
            debugger;
            var sYarnName = "  ";
            PickYarn(sYarnName);
          
        });
        function PickYarn(oTxtName)
        {
            if(oTxtName == '' || oTxtName == null || oTxtName == 'undefined')
            {
                alert("Please enter Yarn name and press enter!!");
                return;
            }
            debugger;
            var oStyleSearch = {
                BUID:sessionStorage.getItem("BUID"),
                ProductName: oTxtName
            };
            console.log(oStyleSearch);
            debugger;
            var obj = {
                BaseAddress:_sBaseAddress,
                Object: (oStyleSearch) ,
                ControllerName: "KnittingOrder", //Product
                ActionName: "GetYarnCategory",//SearchByProductBUWise
                IsWinClose: false
            };
            var tblColums = []; var oColumn = []; var oColumn = { field: "ProductName", title: "Product Name", width: 250, align: "left" }; tblColums.push(oColumn);
            oColumn = { field: "ProductCode", title: "Code", width: 150, align: "left" }; tblColums.push(oColumn);
            DynamicPiker('Product',obj,tblColums,true,'ProductName','ProductID',500); //pickerName(unique),obj,table,multiReturn,SearchingField, pkID
        }
        function DynamicPiker(pickerName,obj,pTblColums,pMultiReturn,pSearchField,pID,nWidth)
        {
            debugger;
            $("#progressbar").progressbar({ value: 0 });
            $("#progressbarParent").show();
            setInterval(updateProgress,250);

            $.icsDataGets(obj, function (response) {
                debugger;
                if (response.status && response.objs.length > 0) {
                    if (response.objs[0][pID] > 0) {
                        debugger;
                        var tblColums = pTblColums;
                        var oPickerParam = {
                            winid: 'win'+pickerName,
                            winclass: 'cls'+pickerName,
                            winwidth: nWidth,
                            winheight: 460,
                            tableid: 'tbl'+pickerName+'s',
                            tablecolumns: tblColums,
                            datalist: response.objs,
                            multiplereturn: false,
                            searchingbyfieldName: pSearchField,
                            windowTittle: pickerName+' List',
                            colsable:true
                        };
                        $.icsPicker(oPickerParam);
                        $("#progressbar").progressbar({ value: 0 });//hide
                        $("#progressbarParent").hide();
                        IntializePickerbuttonYarn(oPickerParam);
                    }
                    else {
                        alert(response.objs[0].ErrorMessage);
                        $("#progressbar").progressbar({ value: 0 });//hide
                        $("#progressbarParent").hide();
                    }
                }
                else{
                    alert("Data Not Found.");
                    $("#progressbar").progressbar({ value: 0 });//hide
                    $("#progressbarParent").hide();
                    return;
                }
            });
        }
        function IntializePickerbuttonYarn(oPickerobj) {
            debugger;
            $("#" + oPickerobj.winid).find("#btnOk").click(function () {
                debugger;
                //for Single Select
                SetPickerValueAssignYarn(oPickerobj);
            });
            $(document).find('.' + oPickerobj.winclass).keydown(function (e) {
                if (e.which == 13)//enter=13
                {
                    SetPickerValueAssignYarn(oPickerobj);
                }
            });
        }
        function SetPickerValueAssignYarn(oPickerobj)
        {
            debugger;
            var oResult;
            if (oPickerobj.multiplereturn)
            {
                oResult = $('#'+oPickerobj.tableid).datagrid('getChecked');
            }
            else
            {
                oResult = $('#'+oPickerobj.tableid).datagrid('getSelected');
            }

            if (oPickerobj.winid == 'winProduct')
            {
                SetYarn(oResult);
            }
            $("#" + oPickerobj.winid).icsWindow("close");
            $("#" + oPickerobj.winid).remove();
        }
        function SetYarn(oSelectedStyle) {
            debugger;
            nYarnID = oSelectedStyle.ProductID;
            nYarnName = oSelectedStyle.ProductName;
            nYarnCode = oSelectedStyle.ProductCode;
            $('#txtYarn').val(nYarnName);
            $('#txtYarnQty').val(0);
            $('#txtYarnRatio').val(0);
        }


        


</script>
