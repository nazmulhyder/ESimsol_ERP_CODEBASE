@model IEnumerable<ESimSol.BusinessObjects.FabricSCReport>
    @{
        ViewBag.Title = "Fabric Receive";
    }

    <head>
        <title></title>
    </head>

    <div id="progressbarParent" style="width:100%;height:100%;margin:0 auto;text-align:center; margin-left: auto;margin-right: auto;left: 0;right: 0;z-index: 1;">
        <div style="margin: 0px auto;margin-top: 251px;text-align:center;width:390px;">
            <label style="font-size:18px;">Please wait</label>
            <div id="progressbar" style="width:100%;height:37px;"></div>
        </div>
    </div> 
    <div class="menuMainCollectionTable">
        @*<table id="tblFabricSCReports" title="PO(s)" class="easyui-datagrid" style="width:100%; height:100%" singleselect="true" data-options="fitColumns:false, rownumbers:true, pagination:false, autoRowHeight:false, toolbar: '#toolbarFabricSCReport'">*@
            <table id="tblFabricSCReports" title="PO(s)" style="width:100%; height:100%" class="easyui-datagrid" fit="true" fitcolumns="false" rownumbers="true" pagination="false" singleselect="true" autorowheight="true" toolbar="#toolbarFabricSCReport" data-options="rowStyler: function(index,row){

                                        if (row.CurrentStatusSt=='Received'){
                                            return 'color:#265a88; font-weight:bold;';
                                        }
                                        else if (row.CurrentStatusSt==''){
                                            return 'color:#f21443; font-weight:bold;';
                                        }
                                    }
                    ">
                <thead>

                <th field="SCNoFull" width="11%" align="left">PO No</th>
                <th field="SCDateSt" width="8%" align="center">PO Issue Date</th>
                <th field="LabDipNo" width="11%" align="left">LD No</th>
                <th field="BuyerName" width="15%" align="left">Buying House</th>
                <th field="MKTGroup" width="8%" align="left"> MKT Team</th>
                <th field="MKTPName" width="8%" align="left"> Concern Person</th>
                <th field="FabricNo" width="10%" align="left"> MKT Ref</th>
                <th field="FabricReceiveDateStr" width="8%" align="left">Receive Date</th>
                <th field="ExeNo" width="10%" align="left"> <span id="lblDispoHLGrd">H/L No</span> </th>
                <th field="StyleNo" width="10%" align="left">Style No</th>
                <th field="BuyerReference" width="10%" align="left">Buyer Ref</th>
                <th field="HLReference" width="10%" align="left"> Dispo No/ H/L Ref</th>
                <th field="ColorInfo" width="10%" align="left"> Color</th>
                <th field="Construction" width="10%" align="left"> Construction</th>
                <th field="ProductName" width="10%" align="left">Composition</th>
                <th field="ProcessTypeName" width="10%" align="left"> Fabric type </th>
                <th field="FabricWeaveName" width="10%" align="left"> Weave</th>
                <th field="Size" width="10%" align="left"> Size</th>
                <th field="FinishTypeName" width="10%" align="left">Finish Type</th>
                <th field="FabricWidth" width="15%" align="left">Width</th>
                <th field="CurrentStatusSt" width="7%" align="left"> Status</th>
                <th field="LabStatusST" width="9%" align="left">Lab Status</th>
                <th field="StatusSt" width="7%" align="left">Order Status</th>
                </thead>
            </table>

        <div id="toolbarFabricSCReport">
            <input id="txtSearchbyPONo" type="text" placeholder="Search by PO No" style="width:120px" />
            <input id="txtSearchbyFabricNo" type="text" placeholder="Search by Ref No" style="width:120px" />
            <input id="txtHLNO" type="text" placeholder="Search by HL No" style="width:120px" />
            <a id="btnAdvSearch" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-search" plain="true">Adv. Search</a>
            <a id="btnReceive" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-ok" plain="true">Receive</a>
            <a id="btnExeNoEntry" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-ok" plain="true"><span id="lblDispoHL">Entry No</span></a>
            @*<a id="btnReceive" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-ok" plain="true">Receive</a>*@
            @*<a id="btnEditFabric" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-ok" plain="true">Edit Fabric</a>*@

            <a id="btnEditFabric_New" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-ok" plain="true">Analysis Result</a>
            <a id="btnRevise" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-ok" plain="true">Detail Info</a>
            @*<a id="btnRevise" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-ok" plain="true">Revise Fabric</a>*@
            
            <a id="btnForwardLab" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-ok" plain="true">FW Lab</a>
            <a id="btnUndoLab" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-ok" plain="true">Undo FW</a>
             @*<a id="btnExeNoEntry" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-ok" plain="true"><span id="lblDispoHL">Dispo No</span></a>*@
            @*<a id="btnDyeingOrder" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-ok" plain="true"><span id="lblDispoHL">Dyeing Order</span></a>*@
            @*<a id="btnRequestForLabdipTemp" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-ok" plain="true">Req For Labdip</a>*@
            @*<a id="btnRequestForLabdip" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-ok" plain="true">Labdip</a>*@

            <a id="btnReLab" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-ok" plain="true">Re Lab</a>
            <a id="btnPrintPO" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-print" plain="true">Preview(PO)</a>
            <a id="btnPrintLD" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-print" plain="true">Preview(Labdip)</a>        
            @*<a id="btnPrint" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-print" plain="true">Print</a>*@
            <a id="btnPrintXL" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-excel" plain="true">ExportXL</a>
            <a id="btnPrintHLDelivery" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-print" plain="true">HL Delivery</a>
            <a id="btnPrintHLSwatch" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-print" plain="true">HL Swatch</a>
            <a id="btnFabricPattern" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-ok" plain="true">Pattern</a>
            <a id="btnSubmit" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-ok" plain="true">Submit</a>
            @*<a id="btnSubmitFabricInFabricPattern" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-ok" plain="true">Submit to HO</a>*@

            <a id="btnSendMail" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-email" plain="true">Send Mail</a>
            @*<a id="btnSpecification" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-details" plain="true">Specification</a>*@
            <a id="btnFabricHistory" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-details" plain="true">Fabric History</a>
        </div>
    </div>
    <div id="winAdvSearch" class="easyui-window winClass" style="width:620px" title="Adv. Search" data-options="modal:true,closed:true,collapsible:false,minimizable:false,maximizable:false,closable:false">
        <div>
            <fieldset style="margin-bottom: 0px;">
                <legend>Searching Criteria</legend>
                <table style="width:100%;text-align:right;">
                    <tr>
                        <td style="width:20%;text-align:right;">
                            <label>P/I No :</label>
                        </td>
                        <td style=" width:30%;text-align:left;">
                            <input id="txtPINo" style="width:100%;" type="text" />
                        </td>
                        <td style=" width:20%;text-align:right;">
                            <label id="lblFabricNoAdv"> Mkt Ref No :</label>
                        </td>
                        <td style=" width:30%;text-align:left;">
                            <input id="txtFabricID" style="width:80%;" type="text" />
                        </td>
                    </tr>

                    <tr>
                        <td style=" width:20%;text-align:right;">
                            <label>Issue To :</label>
                        </td>
                        <td colspan="3" style=" width:80%;text-align:left;">
                            <input id="txtContractorAdvS" style="width:80%;" type="text" placeholder="Type & Press Enter" />
                            <a id="btnPickContractorAdvS" href="javascript:void(0)" class="easyui-linkbutton ics-pick" iconcls="icon-pick" plain="true"></a>
                            <a id="btnClrContractorAdvS" href="javascript:void(0)" class="easyui-linkbutton ics-pick" iconcls="icon-clear" plain="true"></a>
                        </td>
                    </tr>

                    <tr>
                        <td style=" width:20%;text-align:right;">
                            <label>Buying House :</label>
                        </td>
                        <td colspan="3" style=" width:80%;text-align:left;">
                            <input id="txtDeliverTo" style="width:80%;" type="text" placeholder="Type & Press Enter" />
                            <a id="btnPickDeliverTo" href="javascript:void(0)" class="easyui-linkbutton ics-pick" iconcls="icon-pick" plain="true"></a>
                            <a id="btnClrDeliverTo" href="javascript:void(0)" class="easyui-linkbutton ics-pick" iconcls="icon-clear" plain="true"></a>
                        </td>
                    </tr>
                    <tr>
                        <td style=" width:20%;text-align:right;">
                            <label>Mkt Account:</label>
                        </td>
                        <td colspan="3" style=" width:80%;text-align:left;">
                            <input id="txtMktAccount" class="reset-text" placeholder="Search Concern Person" style="width:80%" />
                            <a id="btnPickMktAccount" href="javascript:void(0)" class="easyui-linkbutton ics-pick" iconcls="icon-pick" plain="true"></a>
                            <a id="btnResetMktPerson" href="javascript:void(0)" class="easyui-linkbutton ics-pick" iconcls="icon-clear" plain="true"></a>
                        </td>
                    </tr>
                    <tr>
                        <td style=" width:20%;text-align:right;">
                            <label>PO Date:</label>
                        </td>
                        <td colspan="3" style=" width:80%;text-align:right;">
                            <div style="float:left; width:100%">
                                <div style="float:left; width:30%">
                                    <select style="width:95%;" id="cboPODate" onchange="DateActions_OPDate(); "></select>
                                </div>
                                <div style="float:left; width:25%; padding-left:5px;">
                                    <input id="txtFromPODate" type="text" style="width: 110px;" class="easyui-datebox" required="required" data-options="formatter:icsdateformat,parser:icsdateparser" />
                                </div>
                                <div style="float:left; width:5%; text-align:center">to</div>
                                <div style="float:left; width:25%; padding-left:5px;">
                                    <input id="txtToPODate" type="text" style="width: 110px;" class="easyui-datebox" required="required" data-options="formatter:icsdateformat,parser:icsdateparser" />
                                </div>
                            </div>
                        </td>
                    </tr>
                    <tr>
                        <td style=" width:20%;text-align:right;">
                            <label>Approve Date:</label>
                        </td>
                        <td colspan="3" style=" width:80%;text-align:right;">
                            <div style="float:left; width:100%">
                                <div style="float:left; width:30%">
                                    <select style="width:95%;" id="cboApproveDate" onchange="DateActions_ApproveDate(); "></select>
                                </div>
                                <div style="float:left; width:25%; padding-left:5px;">
                                    <input id="txtFromApproveDate" type="text" style="width: 110px;" class="easyui-datebox" required="required" data-options="formatter:icsdateformat,parser:icsdateparser" />
                                </div>
                                <div style="float:left; width:5%; text-align:center">to</div>
                                <div style="float:left; width:25%; padding-left:5px;">
                                    <input id="txtToApproveDate" type="text" style="width: 110px;" class="easyui-datebox" required="required" data-options="formatter:icsdateformat,parser:icsdateparser" />
                                </div>
                            </div>
                        </td>
                    </tr>
                    <tr>
                        <td style=" width:20%;text-align:right;">
                            <label>Production Type:</label>
                        </td>
                        <td style=" width:30%;text-align:left;">
                            <select id="cboProductionType" style="width:90%;"><option value="0">All</option><option value="1">In House</option><option value="2">Sub Contract</option></select>
                        </td>
                        <td style=" width:20%;text-align:right;">
                            <label>Print PO:</label>
                        </td>
                        <td style=" width:30%;text-align:left;">
                            <select style="width:80%;" id="cboIsPrinting">
                                <option value="0">Default</option>
                                <option value="1">Print</option>
                                <option value="2">Not Print</option>
                            </select>
                        </td>
                    </tr>
                    <tr>
                        <td colspan="4" style="width:95%;text-align:left;">
                            <div>
                                <fieldset>
                                    <legend>Lab :</legend>
                                    <div style="float:left; width:100%">
                                        <div style="float:left; width:10%">
                                            <label>Status:</label>
                                        </div>
                                        <div style="float:left; width:20%">
                                            <select style="width:95%;" id="cboLabStatus"></select>
                                        </div>
                                        <div style="float:left; width:25%">
                                            <label>Date:</label>
                                            <select style="width:70%;" id="cboLabDate" onchange="DateActions_LabDate(); "></select>
                                        </div>
                                        <div style="float:left; width:20%; padding-left:5px;">
                                            <input id="txtFromLabDate" type="text" style="width: 110px;" class="easyui-datebox" required="required" data-options="formatter:icsdateformat,parser:icsdateparser" />
                                        </div>
                                        <div style="float:left; width:5%; text-align:center">to</div>
                                        <div style="float:left; width:20%; padding-left:5px;">
                                            <input id="txtToLabDate" type="text" style="width: 110px;" class="easyui-datebox" required="required" data-options="formatter:icsdateformat,parser:icsdateparser" />
                                        </div>
                                    </div>
                                </fieldset>
                            </div>
                            <div style="margin-top: 2px;">
                                <table style="width:100%; height: 150px;">
                                    <tr>
                                        <td style="width:35%;">
                                            <table id="tblOrderTypes" class="easyui-datagrid" title="Order Type" style="width:99%; height: 150px;" data-options="singleSelect: false,fitColumns:false, rownumbers:true, pagination:false, autoRowHeight:false, ">
                                                <thead>
                                                    <tr>
                                                        <th data-options="field:'Selected',checkbox:true"></th>
                                                        <th field="Value" width="80%"></th>
                                                    </tr>
                                                </thead>
                                            </table>
                                        </td>
                                        <td style="width:30%;">
                                            <table id="tblCurrentStatuss" class="easyui-datagrid" title="Order Status" style="width:99%; height: 150px;" data-options="singleSelect: false,fitColumns:false, rownumbers:true, pagination:false, autoRowHeight:false, ">
                                                <thead>
                                                    <tr>
                                                        <th data-options="field:'Selected',checkbox:true"></th>
                                                        <th field="Value" width="80%"></th>
                                                    </tr>
                                                </thead>
                                            </table>
                                        </td>
                                        <td style="width:35%;">
                                            <table id="tblLabStatuss" class="easyui-datagrid" title="Lab Status" style="width:99%; height: 150px;" data-options="singleSelect: false,fitColumns:false, rownumbers:true, pagination:false, autoRowHeight:false, ">
                                                <thead>
                                                    <tr>
                                                        <th data-options="field:'Selected',checkbox:true"></th>
                                                        <th field="Value" width="80%"></th>
                                                    </tr>
                                                </thead>
                                            </table>
                                        </td>
                                    </tr>
                                </table>
                            </div>
                        </td>
                    </tr>
                    <tr> 

                        <td colspan="4" style="width:50%;text-align:left;">
                            <div style="margin-top: 0px;">
                                <table style="width:100%;">
                                    <tr>
                                        <td style=" width:20%;text-align:right;"></td>
                                        <td style="width:40%; text-align:left;">
                                            <div><input type="checkbox" id="chkReceived" /> <span><label>Received</label></span></div>
                                            <div><input type="checkbox" id="chkSubmittedHO" /><span><label>Submitted HO</label></span></div>
                                           
                                        </td>

                                        <td style="width:40%;text-align:left;">
                                            <div><input type="checkbox" id="chkWatingForLab" /> <span><label>Waiting For Lab</label></span></div>
                                            <div><input type="checkbox" id="chkYetToSubmittedHO" /> <span><label>Yet To Submit HO</label></span></div>
                                        </td>
                                    </tr>
                                </table>


                            </div>
                        </td>
                    </tr>

                </table>
            </fieldset>

            <fieldset>
                <legend>Actions : </legend>
                <table style="width:100%;text-align:right;">
                    <tr>
                        <td style="width:20%;text-align:right;">
                            <a id="btnResetAdvSearch" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-reload" plain="true">Reset</a>
                        </td>
                        <td style="width:80%;text-align:right;">
                            <label class="lblLoadingMessage" style="float: left;">Loading Please Wait...</label>
                            <a id="btnSearchAdvSearch" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-search" plain="true">Search</a>
                            <a id="btnCloseAdvSearch" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-cancel" plain="true">Close</a>
                        </td>
                    </tr>
                </table>

            </fieldset>
        </div>
    </div>
    <div id="winExeEntry" class="easyui-window" title="Dispo No" data-options="modal:true,closed:true,collapsible:false,minimizable:false,maximizable:false,closable:true">
        <div>
            <div style="margin-left:0px; margin-top:0px">
                <fieldset>
                    <legend> </legend>
                    <table cellpadding="2" cellspacing="2" style="width:100%;">
                        <tr>
                            <td style="width:15%;text-align:right">
                                PO No:
                            </td>

                            <td style="width:20%">
                                <input type="text" id="txtSCNo_ExC" style="width:100%" disabled="disabled" />
                            </td>
                            <td style="width:20%;text-align:right">
                                Mkt Ref:
                            </td>
                            <td style="width:20%">
                                <input type="text" id="txtFabricID_Exc" style="width:100%" disabled="disabled" />
                            </td>
                            <td style="width:25%;text-align:right"></td>

                        </tr>

                        <tr>
                            <td style="width:15%;text-align:right">
                                Issue To:
                            </td>

                            <td colspan="3" style="width:60%;text-align:left">
                                <input type="text" style="width:100%;" id="txtContractor_EXC" disabled="disabled" />
                            </td>
                            <td style="width:25%;text-align:right"></td>
                        </tr>
                    </table>
                </fieldset>
            </div>
            <div style="margin-left:0px; margin-top:0px">
                <fieldset>
                    <legend>Entry/Change No : </legend>
                    <table cellpadding="2" cellspacing="2" style="width:100%;">
                        <tr>
                            <td style="width:20%;text-align:right">
                                Order Type:
                            </td>

                            <td style="width:20%">
                                <input type="text" id="txtOrderType" style="width:100%" disabled="disabled" />
                            </td>

                            <td style="width:10%;text-align:right">
                                Process type:
                            </td>

                            <td style="width:40%">
                                <select id="cboProcessTypeEnt"></select>
                            </td>
                            <td style="width:10%;text-align:right"></td>

                        </tr>
                        <tr>
                            <td style="width:20%;text-align:right">
                                Receive Date:
                            </td>

                            <td style="width:20%">
                                <input id="txtReceiveDate" type="text" style="width: 110px;" class="easyui-datebox" required="required" data-options="formatter:icsdateformat,parser:icsdateparser" />
                            </td>

                            <td style="width:10%;text-align:right">
                            H/L No:
                            </td>

                            <td style="width:40%">
                                <input type="text" id="txtExcNo" style="width:100%" />
                            </td>
                            <td style="width:10%;text-align:right"></td>
                        </tr>
                    </table>
                </fieldset>
            </div>
        </div>
        <fieldset class="actionfieldsetstyle">
            <legend>Actions : </legend>
            <a id="btnSaveExeNo" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-save" plain="true">Save</a>
            <a id="btnCloseExeNo" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-cancel" plain="true">Close</a>
        </fieldset>
    </div>
    
    <div id="winFabricHistory" class="easyui-window" title="Fabric Suggestion History" data-options="modal:true,closed:true,collapsible:false,minimizable:false,maximizable:false,closable:true">
        <table id="tblFabricHistory" class="easyui-datagrid" style="width:100%;height:298px;" fitcolumns="false" rownumbers="true" pagination="false" singleselect="true" autorowheight="false">
            <thead>
                <tr>
                    <th field="ModifiedTimeStr" width="12%">Modified Time</th>
                    <th field="ModifiedByName" width="10%">Modified By</th>
                    <th field="FabricNo" width="10%" align="left">Mkt. Ref. No</th>
                    <th field="ProductName" width="12%" align="left">Composition</th>
                    <th field="Construction" width="10%">Construction</th>
                    <th field="ColorInfo" width="10%">Color Info</th>
                    <th field="FabricWidth" width="10%">Fabric Width</th>
                    <th field="WeftColor" width="10%">Weft Color</th>
                    <th field="ActualConstruction" width="12%">Actual Construction</th>
                    <th field="FinishTypeName" width="10%">Finish Type</th>
                    <th field="ProcessTypeName" width="10%">Process Type</th>
                    <th field="CreatedByName" width="10%">Created By</th>
                </tr>
            </thead>
        </table>
        <fieldset class="actionfieldsetstyle">
            <legend>Actions : </legend>
            <a id="btnCloseFabricHistory" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-cancel" plain="true">Close</a>
        </fieldset>
    </div>
    <div id="winLabDip" style="width:80%;text-align:left" class="easyui-window" title="LabDip" data-options="modal:true,closed:true,collapsible:false,minimizable:false,maximizable:false,closable:true">

                          <div>

                              <div style="margin-left:0px; margin-top:0px">
                                  <fieldset style="height:50%">
                                      <legend style="font-weight:bold">Fabric Information :</legend>
                                      <table cellpadding="2" cellspacing="2" style="width:100%;">
                                          @*<tr>
                                <td style="width:15%;text-align:right">
                                    Issue To:
                                </td>

                                <td colspan="2" style="width:30%;text-align:left">
                                    <input type="text" style="width:100%;" id="txtContractor_EXC" disabled="disabled" />
                                </td>
                                <td style="width:20%;text-align:right">
                                    Order Type:
                                </td>
                                <td style="width:15%">
                                    <input type="text" id="txtOrderType" style="width:100%" disabled="disabled" />
                                </td>
                                <td style="width:20%;text-align:right"></td>
                            </tr>*@
                                          <tr>
                                              <td style="width:15%;text-align:right">
                                                  Dispo No :
                                              </td>

                                              <td style="width:20%">
                                                  <input type="text" id="txtDispoNo " style="width:100%" disabled="disabled" />
                                              </td>
                                              <td style="width:15%;text-align:right">
                                                  Mkt Ref No:
                                              </td>

                                              <td style="width:20%">
                                                  <input type="text" id="txtFabricNo_Lab" style="width:100%" disabled="disabled" />
                                              </td>
                                              <td style="width:10%;text-align:right">
                                                  PO No:
                                              </td>
                                              <td style="width:20%">
                                                  <input type="text" id="txtSCNo_Lab" style="width:100%" disabled="disabled" />
                                              </td>

                                          </tr>
                                          <tr>
                                              <td style="width:15%;text-align:right">
                                                  Composition :
                                              </td>
                                              <td style="width:20%">
                                                  <input type="text" id="txtComposition" style="width:100%" disabled="disabled" />
                                              </td>
                                              <td style="width:15%;text-align:right">
                                                  Construction :
                                              </td>
                                              <td style="width:20%">
                                                  <input type="text" id="txtConstruction" style="width:100%" disabled="disabled" />
                                              </td>
                                              <td style="width:10%;text-align:right">
                                                  Fabric type :
                                              </td>
                                              <td style="width:20%">
                                                  <input type="text" id="txtFabrictype" style="width:100%" disabled="disabled" />
                                              </td>

                                          </tr>
                                      </table>
                                  </fieldset>
                                  <div>
                                      <fieldset style="height:50%">
                                          <legend style="font-weight:bold">Lab Operation :</legend>
                                          <table  cellpadding="2" cellspacing="2" style="width:100%;font-size:12px; font-weight:normal">
                                              
                                                  <tr>
                                                      
                                                      <td style="width:55% ;height:150px">
                                                          <table id="tblLabdipHistory" class="easyui-datagrid" style="width:100%;height:150px;" fitcolumns="false" rownumbers="true" pagination="false" singleselect="true" autorowheight="false">
                                                              <thead>
                                                                  <tr>
                                                                      <th field="DateTimeSt" width="20%" align="left">Date</th>
                                                                      <th field="StatusSt" width="25%" align="left">Status</th>
                                                                      <th field="UserName" width="30%" align="left">User</th>
                                                                      <th field="Days" width="18%">Days</th>
                                                                      
                                                                  </tr>
                                                              </thead>
                                                          </table>
                                                          @*<div id="toolbarLDH">
                                                              <a id="btnRefreshLDH" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-reload" plain="true">Refresh</a>
                                                          </div>*@
                                                          </td>
                                                        <td style="width:5% ;height:150px">
                                                            </td>
                                                      <td style="width:40% ;height:150px;vertical-align:top;">
                                                          <table cellpadding="2"cellspacing="5" style="width:100%;border-top:1px solid black;border-right:1px solid black;border-left:1px solid black;border-bottom:1px solid black">
                                                              <tr style="width:40%; vertical-align:top; ">
                                                                  <td style="width:40%; text-align:left; ">Labdip Order No:</td>
                                                                  <td style="width:60%;"><input id="txtLabDipOrderNo" type="text" style="width:100%;" disabled="disabled" /></td>
                                                                
                                                              </tr>
                                                              <tr>
                                                                  <td style="width:40%; text-align:left;"> Labdip Status:</td>
                                                                  <td style="width:60%;"><input id="txtLabdipStatus" type="text" style="width:100%;" disabled="disabled" /></td>
                                                              </tr>
                                                              <tr>
                                                                  <td style="width:17%; text-align:left; "></td>
                                                                  <td style="width:10%;"></td>
                                                              </tr>
                                                              <tr style ="height:30px">
                                                                  <td style="width:17%; text-align:left; "></td>
                                                                  <td style="width:10%;"></td>
                                                              </tr>
                                                              <tr id="trLabdipRequest">
                                                                  <td style="width:17%; text-align:left; ">Request For Lab Dip:</td>
                                                                  <td style="width:10%;"><input id="btnSaveLabDip" type="button" value="Update" style="width:100%;" /></td>
                                                              </tr>
                                                              <tr id="trLabdipReceive">
                                                                  <td style="width:17%; text-align:left; ">Receive From Lab:</td>
                                                                  <td style="width:10%;"><input id="btnSaveLabRecd" type="button" value="Update" style="width:100%;" /></td>
                                                              </tr>
                                                              <tr style="height:30px">
                                                                  <td style="width:17%; text-align:left; "></td>
                                                                  <td style="width:10%;"></td>
                                                              </tr>
                                                             <tr id="trLabdipSubmit">
                                                                  <td style="width:17%; text-align:left; ">Submit To HO:</td>
                                                                  <td style="width:10%;"><input id="btnSaveLabdipSubmit" type="button" value="Update" style="width:100%;" /></td>
                                                              </tr>
                                                              <tr style="height:20px">
                                                                  <td style=" width:17%; text-align:left; "></td>
                                                                  <td style="width:10%;"></td>
                                                              </tr>
                                                          </table>
                                                      </td>
</tr>
                                          


                                          </table>
                                      </fieldset>
                                  </div>
                                 

                              </div>

                          </div>
                          <fieldset class="actionfieldsetstyle">
                              <legend>Actions : </legend>
                              @*<a id="btnSaveExeNo" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-save" plain="true">Save</a>*@
                              <a id="btnCloseLabDip" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-cancel" plain="true">Close</a>
                          </fieldset>
                      </div>
    <style type="text/css">
        .lines-no .datagrid-body td {
            border-right: 1px dotted transparent;
            border-bottom: 1px dotted transparent;
        }

     
        .lblStar {
            color: red;
            font-weight: bold;
        }
        .tdInputChk {
            width: 100%;
        }
        .tdInputChk ul{
            padding: 0;
            margin: 0;
        }
        .tdInputChk ul li{
            display: inline;
            list-style-type: none;
            margin:0 9px 0 0;   
        }
        /*.tdInputChk ul li input{
            margin: 0 2px 0 0;
        }*/
        .tdInput input {
            width: 96%;
        }
        .tdInputC input {
            width: 96%;
        }
        .tdInput select {
            width: 96%;
        }
    </style>

    <script type="text/javascript">
    var _sBaseAddress="";
    var _oFabricSCReport=null;
    var _oFabricSCReports=[];
    var _oCompareOperators=[];
    var _oFabricPOStatus = [];
    var _oOrderTypes=[];
    var _nBUID = 0;
    var _sContractorIds = '';
    var _sBuyerIds = '';
    var _sMAccountIds='';
    var _oBU = null;
    var _nReportType=0;
    var _sProductIds="";
    var _oProducts=[];
    var _oPriorityLevels=[];
    var _oFinishTypes=[];
    var _oProcessTypes=[];
    var _oFabricWeaves=[];
    var _oFabricDesigns=[];
    var _oLightSources=[];
    var _typeOfReceive =[];
    var _oLabdipStatus=[];
    var _oFabric=null;
    $(document).ready(function () {

        _sBaseAddress =@Html.Raw( new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(HttpContext.Current.Session[SessionInfo.BaseAddress]));
        _oFabricSCReports =@Html.Raw( new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(Model));
        _oCompareOperators = @Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(ViewBag.CompareOperators));
        _nBUID = @Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(ViewBag.BUID));
        _oOrderTypes = @Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(ViewBag.OrderTypes));
        _oLabdipStatus = @Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(ViewBag.LabdipStatus));
        _oFabricPOStatus = @Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(ViewBag.FabricPOStatus));

        _oPriorityLevels = @Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(ViewBag.PriorityLevels));
        _oFinishTypes = @Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(ViewBag.FinishTypes));
        _oProcessTypes = @Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(ViewBag.ProcessTypes));
        _oFabricWeaves = @Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(ViewBag.FabricWeaves));
        _oFabricDesigns = @Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(ViewBag.FabricDesigns));
        _oLightSources = @Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(ViewBag.LightSources));
        _typeOfReceive = @Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(ViewBag.Type));
        _oProducts = @Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(ViewBag.Products));
        var oFabricPOSetup = @Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(ViewBag.FabricPOSetup));
        debugger;
        //if(parseInt(_typeOfReceive)==1){
        //    $('#tblFabricSCReports').datagrid({title:'Analysis PO'});
        //    $('#btnSpecification').hide();
        //}
        //else if(parseInt(_typeOfReceive)==2){
        //    $('#tblFabricSCReports').datagrid({title:'H/L PO'})
        //    $('#lblDispoHL').text("H/L NO Entry");
        //    $('#lblDispoHLGrd').text("H/L NO");
        //    $('#lblDispoHLEntry').text("H/L NO");
        //    $('#btnSpecification').hide();

        //}
        //else if(parseInt(_typeOfReceive)==3){
        //    $('#tblFabricSCReports').datagrid({title:'BULK PO'});
        //    $('#btnEditFabric').hide();
        //    $('#btnSpecification').show();
        //}


        var nIndex=-1;

        if(sessionStorage.getItem("FabricSCReports")!=null && sessionStorage.getItem("FabricSCReports").length>0)
        {
            _oFabricSCReports= jQuery.parseJSON(sessionStorage.getItem('FabricSCReports'));
            nIndex= sessionStorage.getItem('SelectedRowIndex');
        }

        $('#tblFabricSCReports').data('FDPs',_oFabricSCReports);
     
        DynamicRefreshList(_oFabricSCReports, 'tblFabricSCReports');
        if(nIndex>-1)
        {
            $('#tblFabricSCReports').datagrid('selectRow',nIndex);
        }
        SetGridData();

        $("#progressbar").progressbar({ value: 0 });
        $("#progressbarParent").hide();
        $(".lblLoadingMessage").hide();
        LoadComboAdv();
        LoadComboboxesFabric();
        RefreshSetup(oFabricPOSetup);
    });


    function SetGridData(){
        sessionStorage.setItem("FabricSCReports", JSON.stringify($('#tblFabricSCReports').data('FDPs')));
        //sessionStorage.setItem("CellRowSpans", JSON.stringify($('#tblFabricSCReports').data('CellRowSpan')));
        sessionStorage.setItem("BackLink", window.location.href);
    }

    function SetSelectedRowIndex(oItem){
        var nSelectedIndex= $('#tblFabricSCReports').datagrid('getRowIndex',oItem);
        sessionStorage.setItem("SelectedRowIndex", nSelectedIndex);
    }

    $(document).keydown(function (e) { if (e.keyCode == 27) { $('div').icsWindow('close'); } });

    $("#btnPrint").click(function () {

        var sParams=sessionStorage.getItem("ParamsP");
        window.open(_sBaseAddress + '/FabricSCReport/Print_SampleOrderReport?sTempString=' + sParams, "_blank");
    });
    
    $("#btnPrintLD").click(function () 
    {
        var oFabric= $('#tblFabricSCReports').datagrid('getSelected');
        if(oFabric==null || oFabric.FabricID<=0){
            alert("Please select an item from list.");
            return false;
        }
        
        var obj = {
            BaseAddress: _sBaseAddress,
            Object: oFabric,
            ControllerName: "FabricSCReport",
            ActionName: "GetsLabDip_byFSCD",
            IsWinClose: false
        };

        $("#progressbar").progressbar({ value: 0 });
        $("#progressbarParent").show();
        var intervalID = setInterval(updateProgress, 250);

        $.icsDataGets(obj, function (response) {
            clearInterval(intervalID);
            $("#progressbarParent").hide();
            if (response.status && response.objs.length > 0) 
            {
                if (response.objs[0].FSCDetailID > 0) 
                {
                    
                    if(response.objs.length==1)
                    {
                        var tsv=((new Date()).getTime())/1000;
                        window.open(_sBaseAddress+ "/LabDip/PrintLabDipWU_Fabric?nId="+response.objs[0].FSCDetailID+"&vno="+response.objs[0].RelabCount+"&nview=0&nts="+tsv, "_blank");
                        return;
                    }
                   //<th field="OrderStatusStr" width="10%" align="left">Order Status</th>
                   //<th field="LabStatusST" width="10%" align="left">Lab Status</th>

                   var tblColums = []; 
                   var oColumn = { field: "SCNo", title: "PO No", width: 120, align: "left" }; 
                   tblColums.push(oColumn); oColumn = { field: "ExeNo", title: "H/L No", width: 120, align: "left" }; tblColums.push(oColumn);
                   oColumn = { field: "RelabCount", title: "Version", width: 50, align: "left" }; tblColums.push(oColumn);
                   oColumn = { field: "FabricNo", title: "MKT Ref No", width: 120, align: "left" }; tblColums.push(oColumn);
                   oColumn = { field: "OrderDateStr", title: "Order Date", width: 120, align: "left" }; tblColums.push(oColumn);
                   oColumn = { field: "ContractorName", title: "Buyer", width: 140, align: "left" }; tblColums.push(oColumn);
                   oColumn = { field: "MktPerson", title: "Concern Person", width: 140, align: "left" }; tblColums.push(oColumn);

                        var oPickerParam = {
                            winid: 'winLabDipPicker',
                            winclass: 'clsLabDip',
                            winwidth: 600,
                            winheight: 460,
                            tableid: 'tblLabDip',
                            tablecolumns: tblColums,
                            datalist: response.objs,
                            multiplereturn: false,
                            searchingbyfieldName: 'ExeNo',
                            windowTittle: 'Lab List'
                        };
                        $.icsPicker(oPickerParam);
                        IntializePickerbutton(oPickerParam);
                }
                else 
                {
                    alert(response.objs[0].ErrorMessage);
                }
            }
            else {
                alert("Sorry, No Data Found.");
            }
        });
    });

    $("#btnPrintXL").click(function ()
    {
        var sParams=sessionStorage.getItem("ParamsP");
        window.open(_sBaseAddress + '/FabricSCReport/Print_ReportRnDXL?sTempString=' + sParams+"&BUID="+_nBUID, "_blank");
    });

    $('#btnPrintHLDelivery').click(function(e){

        var oFSC = $('#tblFabricSCReports').datagrid('getSelected');

        if(oFSC==null || oFSC.FabricSalesContractDetailID<=0){
            alert("Select an item from list");
            return false;
        }
        var nts=(new Date()).getTime()/1000;
        window.open(_sBaseAddress + '/FabricSCReport/PrintHandLoomDelivery?nId=' + oFSC.FabricSalesContractDetailID+"&nBUID="+_nBUID+"&nts="+nts, "_blank");
    });

    $('#btnPrintHLSwatch').click(function(e){

        var oFSC = $('#tblFabricSCReports').datagrid('getSelected');

        if(oFSC==null || oFSC.FabricSalesContractDetailID<=0){
            alert("Select an item from list");
            return false;
        }
        var nts=(new Date()).getTime()/1000;
        window.open(_sBaseAddress + '/FabricSCReport/PrintHandLoomSwatch?nId=' + oFSC.FabricSalesContractDetailID+"&nBUID="+_nBUID+"&nts="+nts, "_blank");
    });

        
    $('#btnFabricPattern').click(function (e) {

        var data= $('#tblFabricSCReports').datagrid('getSelected');
        if(data==null || data.FabricID<=0){
            alert("Please select an item from list.");
            return false;
        }
        if(data.FabricReceiveBy==0){
            alert("Sorry, Without receive this fabric's pattern cannot create.");
            return false;
        }
        SetSelectedRowIndex(data);
        var rnd = parseInt((Math.random()*1000)+1);
        window.location.href = _sBaseAddress + '/Fabric/ViewFabricPatterns?menuid=' + rnd+ "&nFSCDetailID=" + data.FabricSalesContractDetailID+"&nFabricID=" + data.FabricID+"&nBUID="+_nBUID;

    });
    ////Start adv Searching

    function updateProgress() {
        var value =$('#progressbar').progressbar('getValue');
        if (value < 96){
            value += Math.floor(Math.random() * 10);
            $('#progressbar').progressbar('setValue', value);
        }
    }
    function hideShow(miliseconds) {
        $("#progressbarParent").hide();
    }
    //Account Of Picker

    $("#txtContractorAdvS").keydown(function (e) {
        if (e.keyCode === 13) // Enter Press
        {
            PickContractors_AdvS();
        }
        else if (e.keyCode === 08) {
            $("#txtContractorAdvS").removeClass("fontColorOfPickItem");
            _sContractorIds = '';
        }
    });

    $("#btnClrContractorAdvS").click(function () {
        $("#txtContractorAdvS").removeClass("fontColorOfPickItem");
        $("#txtContractorAdvS").val("");
        _sContractorIds = '';
    });

    $("#btnPickContractorAdvS").click(function () {
        PickContractors_AdvS();
    });
    function PickContractors_AdvS() {
        var oContractor = {
            Params: '2,3' + '~' + $.trim($("#txtContractorAdvS").val()+"~"+_nBUID)
        };
        var obj = {
            BaseAddress: _sBaseAddress,
            Object: oContractor,
            ControllerName: "Contractor",
            ActionName: "ContractorSearchByNameType",
            IsWinClose: false
        };

        $("#progressbar").progressbar({ value: 0 });
        $("#progressbarParent").show();
        var intervalID = setInterval(updateProgress, 250);

        DynamicRefreshList([], "tblAccountsPickerAdvSearch");
        $.icsDataGets(obj, function (response) {
            clearInterval(intervalID);
            $("#progressbarParent").hide();
            if (response.status && response.objs.length > 0) {
                if (response.objs[0].ContractorID > 0) 
                {
                    var tblColums = []; var oColumn = { field: "ContractorID", title: "Code", width: 50, align: "left" }; tblColums.push(oColumn);
                    oColumn = { field: "Name", title: "Name", width: 280, align: "left" }; tblColums.push(oColumn);

                    var oPickerParam = {
                        winid: 'winContractorPicker',
                        winclass: 'clsAccountOf',
                        winwidth: 400,
                        winheight: 460,
                        tableid: 'tblAccountOfs',
                        tablecolumns: tblColums,
                        datalist: response.objs,
                        multiplereturn: true,
                        searchingbyfieldName: 'Name',
                        windowTittle: 'Contactor List'
                    };
                    $.icsPicker(oPickerParam);
                    IntializePickerbutton(oPickerParam);
                }
                else {
                    alert(response.objs[0].ErrorMessage);
                }
            }
            else {
                alert("Sorry, No Contactor Found.");
            }
        });
    }
    //End Account Of Picker
    $("#btnClrDeliverTo").click(function () {
        $("#txtDeliverTo").val("");
        _sBuyerIds="";
    });

    $("#btnPickDeliverTo").click(function () {

        var oContractor = {
            Params: '2,3' + '~' + $.trim($("#txtDeliverTo").val()+'~'+_nBUID)
        };
        GetDeliverTo(oContractor);
    });

    $("#txtDeliverTo").keydown(function (e) {
        var nkeyCode = e.keyCode || e.which;
        if(nkeyCode==13){
            var sContractorName=$.trim($("#txtDeliverTo").val());
            if(sContractorName=="" || sContractorName==null)
            {
                alert("Please, Type name or part of Name");
                $("#txtDeliverTo").focus();
                $("#txtDeliverTo").addClass("errorFieldBorder");
                return;
            }
            var oContractor = {
                Params: '2,3' + '~' + $.trim($("#txtDeliverTo").val()+'~'+_nBUID)
            };
            GetDeliverTo(oContractor);
        }
        else if(nkeyCode==8){
            $("#txtDeliverTo").val("");
            _sBuyerIds="";

        }
    });

    function GetDeliverTo(oContractor){


        var obj = {
            BaseAddress: _sBaseAddress,
            Object: oContractor,
            ControllerName: "Contractor",
            ActionName: "ContractorSearchByNameType",
            IsWinClose: false
        };
        $("#progressbar").progressbar({ value: 0 });
        $("#progressbarParent").show();
        var intervalID = setInterval(updateProgress, 250);
        $.icsDataGets(obj, function (response) {
            clearInterval(intervalID);
            $("#progressbarParent").hide();
            if (response.status && response.objs.length > 0)
            {
                if (response.objs[0].ContractorID > 0) {
                    debugger;
                    var tblColums = [];
                    var oColumn = { field: "ContractorID", title: "Code", width: 50, align: "center" };tblColums.push(oColumn);
                    oColumn = { field: "Name", title: "Name", width: 190, align: "left" };tblColums.push(oColumn);
                    oColumn = { field: "Phone", title: "Phone", width: 140, align: "left" };tblColums.push(oColumn);

                    var oPickerParam = {
                        winid: 'winDeliverToPicker',
                        winclass:'clsDeliverToPicker',
                        winwidth: 460,
                        winheight: 460,
                        tableid: 'tblDeliverToPicker',
                        tablecolumns: tblColums,
                        datalist: response.objs,
                        multiplereturn: true,
                        searchingbyfieldName:'Name',
                        windowTittle: 'Deliver To List'
                    };
                    $.icsPicker(oPickerParam);
                    IntializePickerbutton(oPickerParam);//multiplereturn, winclassName
                }
                else { alert(response.objs[0].ErrorMessage); }
            }
            else{
                alert("No contractor found.");
            }
        });
    }

    $("#btnResetMktPerson").click(function () {

        $("#txtMktAccount").val("");
        _sMAccountIds="";
    });

    $("#btnPickMktAccount").click(function () {
        debugger;
        var sName=$.trim($("#txtMktAccount").val());
        GetMktPersons(sName);
    });

    $("#txtMktAccount").keydown(function (e) {
        var nkeyCode = e.keyCode || e.which;
        if(nkeyCode==13){
            var sName=$.trim($("#txtMktAccount").val());
            if($('#txtMktAccount').val()==null || $('#txtMktAccount').val()=="")
            {
                alert("Please Type Name or part Name and Press Enter.");
                $('#txtMktAccount').focus();
                return;
            }
            GetMktPersons(sName);
        }
        else if(nkeyCode==8){
            $("#txtMktAccount").val("");
            _sMAccountIds="";
        }
    });
    function GetMktPersons(sName){

        var oMarketingAccount_BU = {
            Name:sName,
            BUID:sessionStorage.getItem("BUID")
        };
        var obj = {
            BaseAddress: _sBaseAddress,
            Object: oMarketingAccount_BU,
            ControllerName: "MarketingAccount",
            ActionName: "MarketingAccountSearchByNameAndGroup",
            IsWinClose: false
        };

        $.icsDataGets(obj, function (response) {

            if (response.status && response.objs.length > 0) {
                if (response.objs[0].MarketingAccountID > 0) {
                    debugger;
                    var tblColums = [];
                    var oColumn = { field: "MarketingAccountID", title: "Code", width: 50, align: "left" };tblColums.push(oColumn);
                    oColumn = { field: "Name", title: "Name", width: 180, align: "left" };tblColums.push(oColumn);
                    oColumn = { field: "GroupName", title: "GroupName", width: 120, align: "left" };tblColums.push(oColumn);
                    oColumn = { field: "Phone", title: "Phone", width: 100, align: "left" };tblColums.push(oColumn);

                    var oPickerParam = {
                        winid: 'winMktAccount',
                        winclass:'clsMktPersonPicker',
                        winwidth: 460,
                        winheight: 460,
                        tableid: 'tblMktPersonPicker',
                        tablecolumns: tblColums,
                        datalist: response.objs,
                        multiplereturn: true,
                        searchingbyfieldName:'Name',
                        windowTittle: 'MKT Person List'
                    };
                    $.icsPicker(oPickerParam);
                    IntializePickerbutton(oPickerParam);//multiplereturn, winclassName
                }
                else { alert(response.objs[0].ErrorMessage); }
            }
            else{
                alert("No marketing person found.");
            }
        });


    }
    //End Pick Mkt

    function IntializePickerbutton(oPickerobj) {
        $("#" + oPickerobj.winid).find("#btnOk").click(function () {
            SetPickerValueAssign(oPickerobj);
        });
        $(document).find('.' + oPickerobj.winclass).keydown(function (e) {
            if (e.which === 13) {
                SetPickerValueAssign(oPickerobj);
            }
        });
    }

    function SetPickerValueAssign(oPickerobj) {
        var oreturnObj = null, oreturnObjs = [];
        if (oPickerobj.multiplereturn) {
            oreturnObjs = $('#' + oPickerobj.tableid).datagrid('getChecked');
        } else {
            oreturnObj = $('#' + oPickerobj.tableid).datagrid('getSelected');
        }

        
        if (oPickerobj.winid == 'winFSC_Mail')
        {
            SetMailConfigutation(oreturnObjs);
        }

        if (oPickerobj.winid == 'winLabDipPicker')
        {
            if (oreturnObj != null && oreturnObj.FSCDetailID> 0)
            {
                var tsv=((new Date()).getTime())/1000;
                window.open(_sBaseAddress+ "/LabDip/PrintLabDipWU_Fabric?nId="+oreturnObj.FSCDetailID+"&vno="+oreturnObj.RelabCount+"&nview=0&nts="+tsv, "_blank");
            }
            else
            {
                alert("Please select a lab.");
                return false;
            }
        }


        if (oPickerobj.winid == 'winContractorPicker')
        {
            if (oreturnObjs != null && oreturnObjs.length> 0)
            {

                _sContractorIds=''; var sMessage='';
                sMessage=(oreturnObjs.length>1)? oreturnObjs.length +" Contractors Selected" : oreturnObjs[0].Name;
                $('#txtContractorAdvS').val(sMessage);
                $("#txtContractorAdvS").addClass("fontColorOfPickItem");

                for(var i=0;i<oreturnObjs.length;i++){
                    _sContractorIds=_sContractorIds+oreturnObjs[i].ContractorID+',';
                }
                _sContractorIds=_sContractorIds.substring(0,_sContractorIds.length-1);

            }
            else
            {
                alert("Please select a contractor.");
                return false;
            }
        }

        else if (oPickerobj.winid == 'winDeliverToPicker')
        {
            if (oreturnObjs != null && oreturnObjs.length> 0)
            {
                var sMessage='';
                _sBuyerIds="";
                sMessage=(oreturnObjs.length>1)? oreturnObjs.length +" Buying House(s) Selected" : oreturnObjs[0].Name;
                $('#txtDeliverTo').val(sMessage);
                $("#txtDeliverTo").addClass("fontColorOfPickItem");

                for(var i=0;i<oreturnObjs.length;i++){
                    _sBuyerIds=_sBuyerIds+oreturnObjs[i].ContractorID+',';
                }
                _sBuyerIds=_sBuyerIds.substring(0,_sBuyerIds.length-1);

            }
            else
            {
                alert("Please select a Buying House.");
                return false;
            }
        }
        else if (oPickerobj.winid == 'winMktAccount')
        {
            if (oreturnObjs != null && oreturnObjs.length> 0)
            {
                var sMessage='';
                _sMAccountIds="";
                sMessage=(oreturnObjs.length>1)? oreturnObjs.length +"MKT Account(s) Selected" : oreturnObjs[0].Name;
                $('#txtMktAccount').val(sMessage);
                $("#txtMktAccount").addClass("fontColorOfPickItem");
                for(var i=0;i<oreturnObjs.length;i++){
                    _sMAccountIds=_sMAccountIds+oreturnObjs[i].MarketingAccountID+',';
                }
                _sMAccountIds=_sMAccountIds.substring(0,_sMAccountIds.length-1);
            }
            else
            {
                alert("Please select a MKt Account.");
                return false;
            }
        }

        $("#" + oPickerobj.winid).icsWindow("close");
        $("#" + oPickerobj.winid).remove();
    }


    //End Buyer Search
    $("#btnResetAdvSearch").click(function () {
        ResetAdvSearchWindow();
        LoadComboAdv();
    });
    $("#btnSearchAdvSearch").click(function ()
    {
        $(".lblLoadingMessage").show();
        var sOrderTypeIDs = "";

        var oOrderType = $("#tblOrderTypes").datagrid("getChecked");
        if (oOrderType.length > 0)
        {
            for (var i = 0;i<oOrderType.length; i++){
                sOrderTypeIDs = oOrderType[i].id + "," + sOrderTypeIDs;
            }
            sOrderTypeIDs = sOrderTypeIDs.substring(0, sOrderTypeIDs.length - 1);
        }
        var sPONo="";
        var sCurrentStatus = "";
        var oCurrentStatuss = $("#tblCurrentStatuss").datagrid("getChecked");
        if (oCurrentStatuss.length > 0)
        {
            for (var i = 0;i<oCurrentStatuss.length; i++){
                sCurrentStatus = oCurrentStatuss[i].id + "," + sCurrentStatus;
            }
            sCurrentStatus = sCurrentStatus.substring(0, sCurrentStatus.length - 1);
        }

        var sLabStatus = "";
        var oLabStatus = $("#tblLabStatuss").datagrid("getChecked");
        if (oLabStatus.length > 0)
        {
            for (var i = 0;i<oLabStatus.length; i++){
                sLabStatus = oLabStatus[i].id + "," + sLabStatus;
            }
            sLabStatus = sLabStatus.substring(0, sLabStatus.length - 1);
        }

        var sTempString = $.trim($("#txtPINo").val()) + '~'
                        + $.trim($("#txtFabricID").val()) + '~'
                        + _sContractorIds + '~'
                        + _sBuyerIds + '~'
                        + _sMAccountIds + '~'
                        + $("#cboPODate").val() + '~'
                        + $("#txtFromPODate").datebox("getValue") + '~'
                        + $("#txtToPODate").datebox("getValue") + '~'
                        + $("#cboApproveDate").val() + '~'
                        + $("#txtFromApproveDate").datebox("getValue") + '~'
                        + $("#txtToApproveDate").datebox("getValue") + '~'
                        + $("#cboProductionType").val() + '~'
                         + $("#cboIsPrinting").val() + '~'
                        + sOrderTypeIDs  + '~'
                        + sCurrentStatus  + '~'
                        + _nBUID + '~'
                        + sPONo +'~'
                        + _typeOfReceive+'~'
                        +''+'~'
                        + $('#chkReceived').is(':checked')+'~'
                        + $('#chkSubmittedHO').is(':checked')+'~'
                        + $('#chkWatingForLab').is(':checked')+'~'
                        + $('#chkYetToSubmittedHO').is(':checked')+'~'
                        + sLabStatus+'~'
                        +'~'
                        +'~'
                        +'~'
                        +'~'
                        +'~'
                        +'~'
                        + $("#cboLabStatus").val() + '~'
                        + $("#cboLabDate").val() + '~'
                        + $("#txtFromLabDate").datebox("getValue") + '~'
                        + $("#txtToLabDate").datebox("getValue") + '~'  ;


        var oFabricSCReport = {
            ErrorMessage: sTempString
        }
        sessionStorage.setItem("ParamsP", sTempString);
        $.ajax({
            type: "POST",
            dataType: "json",
            url: _sBaseAddress + "/FabricSCReport/AdvanchSearchTwo",
            traditional: true,
            data: JSON.stringify(oFabricSCReport),
            contentType: "application/json; charset=utf-8",
            success: function (data) {
                debugger;
                var oResult = data;
               
              
                var oResult = data;
                if(oResult.length<=0){
                    alert("No data found");
                }
                else{
                    $('#tblFabricSCReports').data('FDPs',oResult)
                    DynamicRefreshList(oResult,'tblFabricSCReports');
                    SetGridData();
                    $("#winAdvSearch").icsWindow("close");
                    $(".lblLoadingMessage").hide();

                }


            }
        });
    });
    ////Start adv Searching
    /// Search By No and Date
    $('#txtSearchbyPONo').keypress(function (e) {

        var code = (e.keyCode ? e.keyCode : e.which);
        if (code == 13)//Enter key-13
        {
            if ($.trim($("#txtSearchbyPONo").val()) == "")
            {
                alert("Please give PO No.");
                return false;
            }
            var sPONo=$.trim($("#txtSearchbyPONo").val());
            var sOrderTypeIDs = "";
            var sCurrentStatus = "";
            _sContractorIds="";
            debugger;
            var sTempString = "" + '~'
                            + "" + '~'//$.trim($("#txtFabricID").val()) + '~'
                            + _sContractorIds + '~'
                            + _sBuyerIds + '~'
                            + _sMAccountIds + '~'
                            + 0 + '~'
                            + icsdateformat(new Date())+ '~'
                            + icsdateformat(new Date())+ '~'
                            + 0+ '~'
                            + icsdateformat(new Date()) + '~'
                            + icsdateformat(new Date())+ '~'
                            + 0 + '~'
                            + 0 + '~'
                            + sOrderTypeIDs  + '~'
                            + sCurrentStatus  + '~'
                            + _nBUID  + '~'
                            + sPONo+'~'
                            + _typeOfReceive +'~'
                            + "";




            var oFabricSCReport = {
                SCNoFull:$.trim($("#txtSearchbyPONo").val()),
                ErrorMessage: sTempString
            }
            sessionStorage.setItem("ParamsP", sTempString);
            $.ajax({
                type: "POST",
                dataType: "json",
                url: _sBaseAddress + "/FabricSCReport/AdvanchSearchTwo",
                traditional: true,
                data: JSON.stringify(oFabricSCReport),
                contentType: "application/json; charset=utf-8",
                success: function (data)
                {
                    var oResult = data;
                    if(oResult.length<=0){
                        alert("No data found");
                    }
                    else{
                        $('#tblFabricSCReports').data('FDPs',oResult)
                        DynamicRefreshList(oResult,'tblFabricSCReports');
                        SetGridData();
                        $(".lblLoadingMessage").hide();

                    }



                }
            });
        }
    });
    $('#txtSearchbyFabricNo').keypress(function (e) {

        var code = (e.keyCode ? e.keyCode : e.which);
        if (code == 13)//Enter key-13
        {
            if ($.trim($("#txtSearchbyFabricNo").val()) == "")
            {
                alert("Please give Ref No.");
                return false;
            }
            var sOrderTypeIDs = "";
            var sCurrentStatus = "";
            _sContractorIds="";
            var sPONo="";
            debugger;
            var sTempString = "" + '~'
                            + $.trim($("#txtSearchbyFabricNo").val()) + '~'
                            + _sContractorIds + '~'
                            + _sBuyerIds + '~'
                            + _sMAccountIds + '~'
                            + 0 + '~'
                            + icsdateformat(new Date())+ '~'
                            + icsdateformat(new Date())+ '~'
                            + 0+ '~'
                            + icsdateformat(new Date()) + '~'
                            + icsdateformat(new Date())+ '~'
                            + 0 + '~'
                              + 0 + '~'  
                            + sOrderTypeIDs  + '~'
                            + sCurrentStatus  + '~'
                            + _nBUID  + '~'
                            + sPONo+'~'
                            + _typeOfReceive +'~'
                            + "";




            var oFabricSCReport = {
                SCNoFull:"",
                ErrorMessage: sTempString
            }
            sessionStorage.setItem("ParamsP", sTempString);
            $.ajax({
                type: "POST",
                dataType: "json",
                url: _sBaseAddress + "/FabricSCReport/AdvanchSearchTwo",
                traditional: true,
                data: JSON.stringify(oFabricSCReport),
                contentType: "application/json; charset=utf-8",
                success: function (data)
                {
                    var oResult = data;
                    if(oResult.length<=0){
                        alert("No data found");
                    }
                    else{
                        $('#tblFabricSCReports').data('FDPs',oResult)
                        DynamicRefreshList(oResult,'tblFabricSCReports');
                        SetGridData();
                        $(".lblLoadingMessage").hide();

                    }


                }
            });
        }
    });
    $('#txtHLNO').keypress(function (e) {

        var code = (e.keyCode ? e.keyCode : e.which);
        if (code == 13)//Enter key-13
        {
            if ($.trim($("#txtHLNO").val()) == "")
            {
                alert("Please give HL No.");
                return false;
            }
            var sOrderTypeIDs = "";
            var sCurrentStatus = "";
            _sContractorIds="";
            var sPONo="";
            debugger;
            var sTempString = "" + '~'
                            + "" + '~'
                            + _sContractorIds + '~'
                            + _sBuyerIds + '~'
                            + _sMAccountIds + '~'
                            + 0 + '~'
                            + icsdateformat(new Date())+ '~'
                            + icsdateformat(new Date())+ '~'
                            + 0+ '~'
                            + icsdateformat(new Date()) + '~'
                            + icsdateformat(new Date())+ '~'
                            + 0 + '~'
                              + 0 + '~'
                            + sOrderTypeIDs  + '~'
                            + sCurrentStatus  + '~'
                            + _nBUID  + '~'
                            + sPONo+'~'
                            + _typeOfReceive +'~'
                            + $.trim($("#txtHLNO").val());

            console.log(sTempString.split('~'))
            var oFabricSCReport = {
                SCNoFull:"",
                ErrorMessage: sTempString
            }
            sessionStorage.setItem("ParamsP", sTempString);
            $.ajax({
                type: "POST",
                dataType: "json",
                url: _sBaseAddress + "/FabricSCReport/AdvanchSearchTwo",
                traditional: true,
                data: JSON.stringify(oFabricSCReport),
                contentType: "application/json; charset=utf-8",
                success: function (data)
                {
                    var oResult = data;
                    if(oResult.length<=0){
                        alert("No data found");
                    }
                    else{
                        $('#tblFabricSCReports').data('FDPs',oResult)
                        DynamicRefreshList(oResult,'tblFabricSCReports');
                        SetGridData();
                        $(".lblLoadingMessage").hide();

                    }


                }
            });
        }
    });

    function RefreshSetup(oFabricPOSetup)
    {
        $('#lblFabricNoTwo,#lblFabricNo,#lblFabricNoAdv').html(oFabricPOSetup.FabricCode);
        $("#txtSearchbyFabricNo,#txtFabricID").attr("placeholder","Search by "+oFabricPOSetup.NoCode+" No");
        $("#txtFabricID").attr("placeholder",""+oFabricPOSetup.NoCode+" No");
        $("#txtP").attr("placeholder",oFabricPOSetup.NoCode);
        //if(oFabricPOSetup.IsLDApply==false)
        //{
        //    $('#btnAddFNLabdipDetail,#btnAddFNLabdipColor').hide();
        //}
      
    }

    function LoadComboboxesFabric() {

        //$('#txtDateFabric,#txtFabricNoFabric,#txtDateFabric,#txtMktPersonsFabric,#txtContractorName,#txtBuyerReferenceFabric,#txtStyleNoFabric,#txtConstructionFabricPI,#cboPriorityLevelFabric,#txtHLNo,#txtNoteFabric,#tdInputDateBox,#txtHandLoomDate,#chkIsSample,#chkIsHandLoom, #chkIsBulk,#chkIsAnalysis ,#chkIsCAD,,#chkIsColor,#chkIsLabdip ,#chkIsYarnSkein').prop('disabled',true); 
        
        $("#cboFinishTypeFabric").icsLoadCombo({ List: _oFinishTypes,OptionValue: "FabricProcessID",   DisplayText: "Name" });
        $("#cboProductFabric").icsLoadCombo({    List: _oProducts,    OptionValue: "ProductID",    DisplayText: "ProductName"   });
        $("#cboPriorityLevelFabric").icsLoadCombo({    List: _oPriorityLevels,    OptionValue: "Value",   DisplayText: "Text" });
        $("#cboProcessTypeFabric").icsLoadCombo({  List: _oProcessTypes, OptionValue: "FabricProcessID",  DisplayText: "Name" });
        $("#cboWeaveFabric").icsLoadCombo({  List: _oFabricWeaves,   OptionValue: "FabricProcessID",   DisplayText: "Name" });
        $("#cboFabricDesign").icsLoadCombo({  List: _oFabricDesigns,   OptionValue: "FabricProcessID",    DisplayText: "Name"  });
        $("#cboPrimaryLightSource,#cboSecondaryLightSource").icsLoadCombo({ List: _oLightSources,   OptionValue: "LightSourceID",   DisplayText: "Descriptions" });
    }
    function LoadComboAdv()
    {
        DynamicRefreshList(_oOrderTypes, "tblOrderTypes");
        DynamicRefreshList(_oLabdipStatus, "tblLabStatuss");
        DynamicRefreshList(_oFabricPOStatus, "tblCurrentStatuss");
        $("#cboPODate,#cboApproveDate,#cboLabDate").icsLoadCombo({
            List: _oCompareOperators,
            OptionValue: "id",
            DisplayText: "Value"
        });
        $("#cboLabStatus").icsLoadCombo({
            List: _oLabdipStatus,
            OptionValue: "id",
            DisplayText: "Value"
        });
    }
    function CheckFromAndToDateValidation(OperationComboId, FromDateId, ToDateId) {
        $("#" + OperationComboId).parent().parent().parent().find("select").removeClass("errorFieldBorder");
        var nCboVal = $("#" + OperationComboId).val();
        if (parseInt(nCboVal) == 5 || parseInt(nCboVal) == 6) {
            var fromDate = $("#" + FromDateId).datebox("getValue");
            var toDate = $("#" + ToDateId).datebox("getValue");
            if (new Date(fromDate) > new Date(toDate)) {
                $("#" + ToDateId).focus();
                $("#" + OperationComboId).addClass("errorFieldBorder");
                $(".lblLoadingMessage").hide();
                return false;
            } else {
                $("#" + OperationComboId).removeClass("errorFieldBorder");
                return true;
            }
        } else {
            return true;
        }
    }

    function ResetAdvSearchWindow() {
        _sContractorIds = '';
        _sBankBranch_IssueIds = "";
        $(".lblLoadingMessage").hide();
        $("#winAdvSearch input").not("input[type='button']").val("");
        $("#winAdvSearch input").removeClass("fontColorOfPickItem");
        $("#winAdvSearch select").val(0);
        DateActions_OPDate();
        DateActions_ApproveDate();
        $("#txtFromPODate,#txtToPODate").datebox({ disabled: true });
        $("#txtFromPODate,#txtToPODate").datebox("setValue", icsdateformat(new Date()));

        $("#txtFromApproveDate,#txtToApproveDate").datebox({ disabled: true });
        $("#txtFromApproveDate,#txtToApproveDate").datebox("setValue", icsdateformat(new Date()));

        $('#chkReceived,#chkSubmittedHO,#chkWatingForLab').prop('checked',false);
    }

    function DateActions_OPDate() {
        DynamicDateActions("cboPODate", "txtFromPODate", "txtToPODate");
    }
    function DateActions_ApproveDate() {
        DynamicDateActions("cboApproveDate", "txtFromApproveDate", "txtToApproveDate");
    }
    function DateActions_LabDate() {
        debugger;

        if($('#cboLabStatus').val()<=0)
        {
            $('#cboLabDate').val(0);
            alert("Please select a lab status and try again!");return;
        }
        else
            DynamicDateActions("cboLabDate", "txtFromLabDate", "txtToLabDate");
    }

    $("#btnCloseAdvSearch").click(function () {
        $("#winAdvSearch").icsWindow("close");
    });
    $("#btnAdvSearch").click(function () {
        debugger;
        $(".lblLoadingMessage").hide();
        $("#winAdvSearch").icsWindow("open", "Production Request Advance Search");
        //DynamicRefreshList([], "tblExportPIAdvSearch");
        DynamicResetAdvSearchWindow("winAdvSearch");
        ResetAdvSearchWindow();
        LoadComboAdv();
    });

    /// end Adv Searching

        /// Update H/L No

    ///Update Exc No
    $("#btnExeNoEntry ").click(function () {
        debugger;
        var oFSC = $('#tblFabricSCReports').datagrid('getSelected');
        var nSelectedIndex= $('#tblFabricSCReports').datagrid('getRowIndex',oFSC);
        $('#tblFabricSCReports').data('Index', nSelectedIndex);
        if (oFSC ==null || oFSC.FabricSalesContractID<=0) { alert("Please select an item from list."); return ; }

        //alert(data.CurrentStatus);
        if(oFSC.CurrentStatus!=3 && oFSC.CurrentStatus!=4)
        {
            alert("Yet Not Approve.");
            return false;
        }
        $('#txtSCNo_ExC').val(oFSC.SCNoFull);
        $('#txtFabricID_Exc').val(oFSC.FabricNo);
        $('#txtContractor_EXC').val(oFSC.ContractorName);
        $('#txtOrderType').val(oFSC.OrderTypeSt);
        $('#cboProcessTypeEnt').val(oFSC.ProcessType);
        if(oFSC.FabricReceiveDateStr=="" || oFSC.FabricReceiveDateStr==null ){        $('#txtReceiveDate').datebox('setValue',icsdateformat(new Date()));}
        else {$('#txtReceiveDate').datebox('setValue',oFSC.FabricReceiveDateStr);}
        $('#txtExcNo').val(oFSC.ExeNo);
        //$('#txtPINo_Cur').prop('disabled',true);
        $("#winExeEntry").icsWindow("open", "Receive & Issue No");
    });
    $("#btnSaveExeNo").click(function (e) {
        SaveExeNo();
    });
    function SaveExeNo()
    {
        var oFSC = $('#tblFabricSCReports').datagrid('getSelected');
        var nSelectedIndex= $('#tblFabricSCReports').datagrid('getRowIndex',oFSC);
        $('#tblFabricSCReports').data('Index', nSelectedIndex);
        if (oFSC ==null || oFSC.FabricSalesContractID<=0) { alert("Please select an item from list."); return ; }

        //alert(data.CurrentStatus);
        if(oFSC.CurrentStatus!=3 && oFSC.CurrentStatus!=4)
        {
            alert("Yet Not Approve.");
            return false;
        }
        oFSC.ExeNo=  $.trim($('#txtExcNo').val());
        oFSC.ProcessType= $('#cboProcessTypeEnt').val();
        oFSC.FabricReceiveDate= $("#txtReceiveDate").datebox("getValue");
        //if(oFSC.ExeNo=="" || oFSC.ExeNo==null)
        //{
        //    alert("Please entry valid No");
        //    return;
        //}
        var obj =
            {
                BaseAddress: _sBaseAddress,
                Object: oFSC,
                ObjectId: oFSC.FabricSalesContractDetailID,
                ControllerName: "FabricSCReport",
                ActionName: "SaveExcNo",
                TableId: "tblFabricSCReports",
                IsWinClose: true
            };
        $.icsSave(obj, function (response)
        {
            if (response.status && response.obj != null)
            {
                if (response.obj.ErrorMessage=="")
                {
                    SetGridData();
                    $("#winExeEntry").icsWindow("close");
                }
                else {
                    alert(response.obj.ErrorMessage);
                }
            }
            else {
                alert("No information found.");
            }
        });
    }

    $("#btnCloseExeNo").click(function () {
        $("#winExeEntry").icsWindow("close");
    });
    ///New PI No
    $("#txtExcNo").keypress(function (e) 
    {
        if (e.which != 8 && e.which != 0  && e.which != 46  && (e.which < 48 || e.which > 57)) {
            return false;
        }
    });
 
    function RefreshTotalSummery() {
        var nTotalQty = 0;
        var nTotalValue = 0;
        var sCurrency = "";
        sCurrency = "";
        var oFSCDetails = $('#tblFSCDetails').datagrid('getRows');
        for (var i = 0; i < oFSCDetails.length; i++) {
            nTotalQty = nTotalQty + parseFloat(oFSCDetails[i].Qty);
        }
        document.getElementById("lblTotalQty").innerHTML = formatPrice(nTotalQty)+' Y';
    }

    /*---------------- Receive Fabric---------*/
    $('#btnForwardLab').click(function(e){

        debugger;

        var oFabricSCReport= $('#tblFabricSCReports').datagrid('getSelected');

        if(oFabricSCReport==null || oFabricSCReport.FabricSalesContractID<=0){
            alert("Please select an item from list.");
            return false;
        }

        if(oFabricSCReport.FabricReceiveBy==0){
            alert("This item has not Recevied Yet.");
            return false;
        }
        if(oFabricSCReport.LabStatus>1){
            alert("Already Forwarded To Lab.");
            return false;
        }
        if (!confirm("Confirm to Forward Lab?")) return;
       
        var obj = {}; $.extend(obj, oFabricSCReport);
        obj.LabStatus=4;

        //oFabricSCReport.LabStatus=4;
        LabDip_Operation(obj, "Forwarded");
    });

    $('#btnUndoLab').click(function(e)
    {
        debugger;
        var oFabricSCReport= $('#tblFabricSCReports').datagrid('getSelected');

        if(oFabricSCReport==null || oFabricSCReport.FabricSalesContractID<=0){
            alert("Please select an item from list.");
            return false;
        }
        if(oFabricSCReport.LabStatus!=4){
            alert("Sorry, this item is not in Lab !!");
            return false;
        }
        if (!confirm("Confirm to Undo Lab?")) return;
       
        var obj = {}; $.extend(obj, oFabricSCReport);
        obj.LabStatus=17;

        //oFabricSCReport.LabStatus=10;
        LabDip_Operation(obj, "Undo Forwarded");
    });

    $('#btnReLab').click(function(e)
    {
        debugger;
        var oFabricSCReport= $('#tblFabricSCReports').datagrid('getSelected');

        if(oFabricSCReport==null || oFabricSCReport.FabricSalesContractID<=0){
            alert("Please select an item from list.");
            return false;
        }

        if(oFabricSCReport.FabricReceiveBy==0){
            alert("This item has not Recevied Yet.");
            return false;
        }
        if(oFabricSCReport.LabStatus!=5){
            alert("Lab Is Not Done Yet.");
            return false;
        }
        if (!confirm("Confirm to Revise Lab?")) return;
       
        var obj = {}; $.extend(obj, oFabricSCReport);
        obj.LabStatus=16;

        LabDip_Operation(obj, "Revise");
    });
        
    $('#btnSubmit').click(function(e)
    {
        debugger;
        var oFabricSCReport= $('#tblFabricSCReports').datagrid('getSelected');

        if(oFabricSCReport==null || oFabricSCReport.FabricSalesContractID<=0){
            alert("Please select an item from list.");
            return false;
        }

        if(oFabricSCReport.FabricReceiveBy==0){
            alert("This item has not Recevied Yet.");
            return false;
        }
        if(oFabricSCReport.LabStatus!=5){
            alert("Lab Is Not Done Yet.");
            return false;
        }
        if (!confirm("Confirm to Submit?")) return;
       
        var obj = {}; $.extend(obj, oFabricSCReport);
        obj.LabStatus=8;

        LabDip_Operation(obj, "Submitted");
    });

    function LabDip_Operation(obj, sMsg)
    {
        $.ajax({
            type: "POST",
            url: _sBaseAddress + "/FabricSCReport/LabOperation",
            traditional: true,
            data: JSON.stringify(obj),
            contentType: "application/json; charset=utf-8",
            success: function (data) {
                debugger;
                var oResult = jQuery.parseJSON(data);
                if (oResult.ErrorMessage == '' || oResult.ErrorMessage == null)
                {
                    var oRows=$("#tblFabricSCReports").datagrid('getRows');
                    console.log(oResult);

                    if(sMsg=='Forwarded')
                    {
                        for(var i=0;i<oRows.length;i++)
                        {
                            if(parseInt(oRows[i].FabricSalesContractID)==parseInt(oResult.FabricSalesContractID))
                            {
                                oRows[i].LabStatus=oResult.LabStatus;
                                oRows[i].LabStatusST=oResult.LabStatusST;
                                $('#tblFabricSCReports').datagrid('updateRow', { index: i, row: oRows[i] });
                            }
                        }
                    }
                    else 
                        for(var i=0;i<oRows.length;i++)
                        {
                            if(parseInt(oRows[i].FabricSalesContractDetailID)==parseInt(oResult.FabricSalesContractDetailID))
                            {
                                oRows[i].LabStatus=oResult.LabStatus;
                                oRows[i].LabStatusST=oResult.LabStatusST;
                                $('#tblFabricSCReports').datagrid('updateRow', { index: i, row: oRows[i] });
                            }
                        }
                    SetGridData();
                    alert(sMsg+" Successfully.");
                }
                else{
                    alert(oResult.ErrorMessage);
                }
            }
        });

    }
    
    $('#btnReceive').click(function(e){

        debugger;

        var oFabricSCReport= $('#tblFabricSCReports').datagrid('getSelected');

        if(oFabricSCReport==null || oFabricSCReport.FabricSalesContractID<=0){
            alert("Please select an item from list.");
            return false;
        }
        if(oFabricSCReport.FabricReceiveBy!=0){
            alert("Already Received.");
            return false;
        }
        if (!confirm("Confirm to Receive?")) return;
        //alert(data.CurrentStatus);
        //if(data.CurrentStatus!=3 && data.CurrentStatus!=4)
        //{
        //    alert("Yet Not Approve.");
        //    return false;
        //}
        var nIndex=0;
        var oRows=$("#tblFabricSCReports").datagrid('getRows');
        var indexLists = [];
      
        for(var i=0;i<oRows.length;i++){
            if(parseInt(oRows[i].FabricSalesContractID)==parseInt(oFabricSCReport.FabricSalesContractID))
            {
                //alert("ff -"+oRows[i].FabricSalesContractID+"  gg-"+oFabricSCReport.FabricSalesContractID);
                nIndex=$('#tblFabricSCReports').datagrid('getRowIndex',oRows[i]);
                indexLists.push(nIndex);
            }
        }

        $.ajax({
            type: "POST",
            url: _sBaseAddress + "/FabricSCReport/Received",
            traditional: true,
            data: JSON.stringify(oFabricSCReport),
            contentType: "application/json; charset=utf-8",
            success: function (data) {
                debugger;
                var oFabricSCReports = jQuery.parseJSON(data);
                if (oFabricSCReports[0].ErrorMessage == '' || oFabricSCReports[0].ErrorMessage == null)
                {
                    if(oFabricSCReports.length>0)
                    {
                        for (i = 0; i < oFabricSCReports.length; ++i) {
                            $('#tblFabricSCReports').datagrid('updateRow', { index: indexLists[i], row: oFabricSCReports[i] });
                            $('#tblFabricSCReports').datagrid('selectRow', indexLists[i]);
                        }
                    }
                    SetGridData();
                    alert("Receive Successfully.");
                }
                else{
                    alert(oFabricSCReports[0].ErrorMessage);
                }
               
            }
        });

    });

    
        
    $("#btnStatus").click(function () 
    {
        var oFabricSalesContract = $("#tblFabricSCReports").datagrid("getSelected");
        if (oFabricSalesContract == null || oFabricSalesContract.FabricSalesContractID <= 0) { alert("Please select an item from list!"); return; }
        var oFabricSalesContracts= $('#tblFabricSCReports').datagrid('getRows');

        sessionStorage.setItem("Operation", "Update");
        sessionStorage.setItem("FabricSCReports", JSON.stringify(oFabricSalesContracts));
        var SelectedRowIndex=$('#tblFabricSCReports').datagrid('getRowIndex',oFabricSalesContract);
        sessionStorage.setItem("SelectedRowIndex", SelectedRowIndex);
        sessionStorage.setItem("FabricSalesContractHeader", "Production Request Status");
        sessionStorage.setItem("BUID", _nBUID);
        sessionStorage.setItem("BackLink", window.location.href);
        window.location.href = _sBaseAddress+ "/FabricSalesContract/ViewFabricSalesContractStatus?id="+parseInt(oFabricSalesContract.FabricSalesContractDetailID)+"&buid="+_nBUID;
    });
    $("#btnRevise").click(function () 
    {
        var oFabricSalesContract = $("#tblFabricSCReports").datagrid("getSelected");
        if (oFabricSalesContract == null || oFabricSalesContract.FabricSalesContractID <= 0) { alert("Please select an item from list!"); return; }
        var oFabricSalesContracts= $('#tblFabricSCReports').datagrid('getRows');

        sessionStorage.setItem("Operation", "Revise");
        sessionStorage.setItem("FabricSCReports", JSON.stringify(oFabricSalesContracts));
        var SelectedRowIndex=$('#tblFabricSCReports').datagrid('getRowIndex',oFabricSalesContract);
        sessionStorage.setItem("SelectedRowIndex", SelectedRowIndex);
        sessionStorage.setItem("FabricSalesContractHeader", "Revise Production Request");
        sessionStorage.setItem("BUID", _nBUID);
        sessionStorage.setItem("BackLink", window.location.href);
        window.location.href = _sBaseAddress+ "/FabricSalesContract/ViewFabricSalesContractRevise?id="+parseInt(oFabricSalesContract.FabricSalesContractDetailID)+"&buid="+_nBUID;
    });
    /*---------------- Edit Fabric---------*/
    $("#btnEditFabric").click(function () {
        var oFabricSCReport= $('#tblFabricSCReports').datagrid('getSelected');

        if(oFabricSCReport==null || oFabricSCReport.FabricID<=0){
            alert("Please select an item from list.");
            return false;
        }

        //alert(data.CurrentStatus);
        if(oFabricSCReport.CurrentStatus!=3 && oFabricSCReport.CurrentStatus!=4)
        {
            alert("Yet Not Approve.");
            return false;
        }

        if(oFabricSCReport.FabricReceiveBy==0){
            alert("Yet not receive, Receive first.");
            return false;
        }

      
        $("#winFabric").icsWindow('open', "Fabric Info");
      
        GetFabricInformation(oFabricSCReport);
    });
    $("#btnEditFabric_New").click(function () {
        var oFabricSCReport= $('#tblFabricSCReports').datagrid('getSelected');

        if(oFabricSCReport==null || oFabricSCReport.FabricID<=0){
            alert("Please select an item from list.");
            return false;
        }
        if( oFabricSCReport.FabricSalesContractDetailID<=0){
            alert("Select an item from list");
            return false;
        }
        var nRowIndexBank = $("#tblFabricSCReports").datagrid("getRowIndex", oFabricSCReport);
        sessionStorage.setItem("SelectedRowIndex", nRowIndexBank);
     
        var nts=((new Date()).getTime())/1000;

        sessionStorage.setItem("FabricHeader", "Edit from Rnd");
        sessionStorage.setItem("BUID", _nBUID);
        sessionStorage.setItem("BackLink", window.location.href);
        window.location.href = _sBaseAddress+ "/FabricSCReport/ViewFabric?id="+parseInt(oFabricSCReport.FabricSalesContractDetailID)+"&buid="+_nBUID;
     
    });


    $("#btnViewFabric").click(function () {

        var oFabricSCReport= $('#tblFabricSCReports').datagrid('getSelected');

        if(oFabricSCReport==null || oFabricSCReport.FabricID<=0){
            alert("Please select an item from list.");
            return false;
        }
      

        $('#btnSave_submit').hide();
        $('input,select').prop('disabled',true);
        $("#winFabric").icsWindow('open', "View Fabric");
      
        GetFabricInformation(oFabricSCReport);

    });
    $('#btnCloseFabric').click(function(e){
        $('#winFabric').icsWindow('close');
    });
    function GetFabricInformation(oFabricTemp) {
        var oFabric={FabricID:oFabricTemp.FabricID};
        var obj =
        {
            BaseAddress: _sBaseAddress,
            Object: oFabric,
            ControllerName: "Fabric",
            ActionName: "Get",
            IsWinClose: false
        };

        $.icsDataGet(obj, function (response) {
            if (response.status && response.obj != null) {
                if (response.obj.FabricID > 0) {
                    RefreshFabricControl(response.obj);
                }
                else {
                    alert(response.obj.ErrorMessage);
                }
            }
            else { alert("No information found."); }
        });
    }
    function RefreshFabricControl(oFabric) {
        debugger;
        _oFabric = oFabric;
        //if (oFabric.FabricNo.length > 0)
        //{
        //    oFabric.FabricNo = oFabric.FabricNo.substring(oFabric.FabricNo.length, 1);
        //}

        if (oFabric.FabricID>0)
            $('#btnShowHistory').show();
        //else
        //    $('#btnShowHistory').hide();

        $("#txtFabricNoFabric").val(oFabric.FabricNum);
        $("#txtBuyerReferenceFabric").val(oFabric.BuyerReference);
        //  $("#txtProduct").val(oFabric.ProductName);
        //_nProductId = oFabric.ProductID;
        $("#txtConstructionFabric").val(oFabric.Construction);
        $("#txtConstructionFabricPI").val(oFabric.ConstructionPI);
        $("#txtFabricWidthFabric").val(oFabric.FabricWidth);
        $("#cboFinishTypeFabric").val(oFabric.FinishType);
        $("#txtContractorName").val(oFabric.BuyerName);
        $("#txtMktPersonsFabric").val(oFabric.MKTPersonName);

        $("#txtStyleNoFabric").val(oFabric.StyleNo);
        $("#txtColorFabric").val(oFabric.ColorInfo);
        $("#chkWashFabric").prop("checked", oFabric.IsWash);
        $("#chkFinishFabric").prop("checked", oFabric.IsFinish);
        $("#chkDyeingFabric").prop("checked", oFabric.IsDyeing);
        $("#chkPrintFabric").prop("checked", oFabric.IsPrint);
        $("#txtNoteFabric").val(oFabric.Remarks);
        $("#txtDateFabric").datebox("setValue", oFabric.IssueDateInString);
        //$("#txtSeekingDateFabric").datebox("setValue", oFabric.SeekingSubmissionDateInString);
        $("#txtSubDateFabric").datebox("setValue", oFabric.SubmissionDateInString);
        $("#cboPriorityLevelFabric").val(oFabric.PriorityLevelInInt);
        $('#txtHLNo').val(oFabric.HandLoomNo);
        $('#txtWarpCount').val(oFabric.WarpCount);
        $('#txtWeftCount').val(oFabric.WeftCount);
        $('#txtEPI').val(oFabric.EPI);
        $('#txtPPI').val(oFabric.PPI);
        $('#cboPrimaryLightSource').val(oFabric.PrimaryLightSourceID);
        $('#cboSecondaryLightSource').val(oFabric.SecondaryLightSourceID);
        $('#txtEndUse').val(oFabric.EndUse);
        $('#txtNoOfFrame').val(oFabric.NoOfFrame);
        $('#txtWeftColor').val(oFabric.WeftColor);

        $("#txtReceiveDateFabric").datebox("setValue", oFabric.ReceiveDateInString);
        $("#cboProcessTypeFabric").val(oFabric.ProcessType);
        $("#cboFabricDesign").val(oFabric.FabricDesignID);
        $("#cboWeaveFabric").val(oFabric.FabricWeave);
        $("#cboProductFabric").val(oFabric.ProductID);
    }

    /* ================= SEND MAIL ==============*/
    function SetMailConfigutation(oreturnObjs)
    {
        if(oreturnObjs.length>0)
        {
            var sIDs = "";
            for(var i = 0; i < oreturnObjs.length; i++)
            {
                sIDs += oreturnObjs[i].FabricSalesContractDetailID+',';
            }
            sIDs=sIDs.substring(0,sIDs.length-1);

            window.open(_sBaseAddress+ "/FabricSCReport/ViewFabricMail?ids="+sIDs+"&buid="+_nBUID, "_blank");
   
            // window.open = _sBaseAddress+ "/FabricSCReport/ViewFabricMail?ids="+sIDs+"&buid="+_nBUID;
        }
    }
    $("#btnSendMail").click(function () 
    {
        var oFabricSCReport= $('#tblFabricSCReports').datagrid('getSelected');

        if(oFabricSCReport==null || oFabricSCReport.FabricSalesContractID<=0){
            alert("Please select an item from list.");
            return false;
        }
        debugger;
        var oFabricSCReports= $('#tblFabricSCReports').datagrid('getRows');

        var oList=[];
        for(var i=0; i<oFabricSCReports.length; i++)
        {
            if(oFabricSCReports[i].MktAccountID==oFabricSCReport.MktAccountID)
                oList.push(oFabricSCReports[i]);
        }

        if(oList==null || oList.length<=0){
            alert("No data found.");
            return false;
        }

        var tblColums = [];
        var oColumn = { field: "SCNoFull", title: "PO No", width: 120, align: "left" };tblColums.push(oColumn);
        oColumn = { field: "BuyerName", title: "Buying House", width: 180, align: "left" };tblColums.push(oColumn);
        oColumn = { field: "FabricNo", title: "MKT Ref", width: 120, align: "left" };tblColums.push(oColumn);
        oColumn = { field: "MKTPName", title: "C. Person", width: 120, align: "left" };tblColums.push(oColumn);
        oColumn = { field: "Construction", title: "Construction", width: 120, align: "left" };tblColums.push(oColumn);
        oColumn = { field: "ProductName", title: "Composition", width: 100, align: "left" };tblColums.push(oColumn);
        oColumn = { field: "CurrentStatusSt", title: "Status", width: 100, align: "left" };tblColums.push(oColumn);
        oColumn = { field: "LabStatusST", title: "Lab Status", width: 100, align: "left" };tblColums.push(oColumn);

        var oPickerParam = {
            winid: 'winFSC_Mail',
            winclass:'clsFSC_Mail',
            winwidth: 960,
            winheight: 660,
            tableid: 'tblFSC_Mail',
            tablecolumns: tblColums,
            datalist: oList,
            multiplereturn: true,
            searchingbyfieldName:'SCNoFull',
            windowTittle: 'PO List'
        };
        $.icsPicker(oPickerParam);
        IntializePickerbutton(oPickerParam);//multiplereturn, winclassName

    });

    
    function RefreshObjectFabric() {
        debugger;
        var oFabric = {
            FabricID: (_oFabric == null ? 0 : _oFabric.FabricID),
            FabricNo: _oFabric.FabricNo,
            BuyerReference:_oFabric.BuyerReference,
            ProductID: parseInt($("#cboProductFabric").val()),     //Composition
            Construction: $.trim($("#txtConstructionFabric").val()),
            ConstructionPI: $.trim($("#txtConstructionFabricPI").val()),
            FabricWidth: $.trim($("#txtFabricWidthFabric").val()),
            FinishType: parseInt($("#cboFinishTypeFabric").val()),
            IssueDate: $('#txtDateFabric').datebox('getValue'),
            BuyerID:_oFabric.BuyerID,
            MKTPersonID: _oFabric.MKTPersonID,
            StyleNo: $.trim($("#txtStyleNoFabric").val()),
            ColorInfo: $.trim($("#txtColorFabric").val()),
            IsWash: $("#chkWashFabric").is(':checked'),
            IsFinish: $("#chkFinishFabric").is(':checked'),
            IsDyeing: $("#chkDyeingFabric").is(':checked'),
            IsPrint: $("#chkPrintFabric").is(':checked'),
            Remarks: $.trim($("#txtNoteFabric").val()),
            PriorityLevelInInt: parseInt($("#cboPriorityLevelFabric").val()),
            SeekingSubmissionDate: $('#txtBulkDate').datebox('getValue'),
            ProcessType: parseInt($("#cboProcessTypeFabric").val()),
            FabricWeave: parseInt($("#cboWeaveFabric").val()),
            FabricDesignID: parseFloat($("#cboFabricDesign").val()),
            FabricSeekingDates: [],
            PrimaryLightSourceID: $('#cboPrimaryLightSource').val(),
            SecondaryLightSourceID: $('#cboSecondaryLightSource').val(),
            EndUse: $.trim($('#txtEndUse').val()),
            NoOfFrame: $('#txtNoOfFrame').val(),
            WeftColor: $('#txtWeftColor').val(),
            WarpCount: $('#txtWarpCount').val(),
            WeftCount: $('#txtWeftCount').val(),
            EPI: $('#txtEPI').val(),
            PPI: $('#txtPPI').val()
        };
        return oFabric;
    }
    $("#btnSave_submit").click(function () {

        debugger;
        //if (!ValidateInputFabric()) return;
        var oFabricSCReport= $('#tblFabricSCReports').datagrid('getSelected');

        if(oFabricSCReport==null || oFabricSCReport.FabricID<=0){
            alert("Please select an item from list.");
            return false;
        }


        //var oFabric= $('#tblFabrics').datagrid('getSelected');
        //_oFabric=oFabric;

        if(_oFabric==null || _oFabric.FabricID<=0){
            alert("Please select an item from list.");
            return false;
        }
        if(_oFabric.ApprovedBy==0){
            alert("Yet Not Approve.");
            return false;
        }
        //if(oFabric.HandLoomNo==null || oFabric.HandLoomNo==''){
        //    alert("Yet Not Received.");
        //    return false;
        //}
        var nSelectedRowIndex=$('#tblFabricSCReports').datagrid('getRowIndex',oFabricSCReport);
        var oFabric = RefreshObjectFabric();
     
        oFabric.IssueDate = icsdateformat(new Date());
        oFabric.SeekingSubmissionDate = icsdateformat(new Date());
        oFabric.SubmissionDate = icsdateformat(new Date());
        oFabric.ReceiveDate = icsdateformat(new Date());
        debugger;
        $.ajax({
            type: "POST",
            dataType: "json",
            url: _sBaseAddress + "/Fabric/SaveSubmission",
            traditional: true,
            data: JSON.stringify(oFabric),
            contentType: "application/json; charset=utf-8",
            success: function (data) {
                var oFabric = jQuery.parseJSON(data);
                if (oFabric.ErrorMessage == "") {
                    if (oFabric.FabricID > 0) {
                        alert("Re Febric Submit Successful.");
                        $("#winFabric").icsWindow("close");
                     
                        $('#tblFabricSCReports').datagrid('updateRow', { index: nSelectedRowIndex, row: tblFabricSCReports });
                        $("#tblFabricSCReports").datagrid("selectRow", nSelectedRowIndex);
                    }
                }
                else {
                    alert(oFabric.ErrorMessage);
                }
            },
            error: function (xhr, status, error) {
                alert(error);
            }
        });
    });
/*---------end edit Fabric---------*/

    $("#btnSubmitFabricInFabricPattern").click(function () {
        var data = $("#tblFabricSCReports").datagrid("getSelected");
        if (data == null || data.FabricID <= 0) { alert("Please select an item from list!"); return; }
        if (data.SubmissionDateSt != "-") {
            alert("Already Submited.");
            return false;
        }
        if (data.FabricReceiveBy == 0) {
            alert("Sorry, Only Received fabric can Submit.");
            return false;
        }

        $("#winFabric").icsWindow('open', "Fabric Request");
        $("#winFabric").data('FSCD', data);
       
        var obj =
         {
             BaseAddress: _sBaseAddress,
             Object: data,
             ControllerName: "Fabric",
             ActionName: "GetForSubmitDate",
             IsWinClose: false
         };

        $.icsDataGet(obj, function (response) {
            if (response.status && response.obj != null) {
                if (response.obj.FabricID > 0) {
                    RefreshFabricLayout("btnSubmitFabricInFabricPattern");
                    RefreshFabricControl(response.obj);
                }
                else {
                    alert(response.obj.ErrorMessage);
                }
            }
            else { alert("No information found."); }
        });
    });

    $("#btnSubmitFabricInFabric").click(function () {
        if (!ValidateInputFabric()) return;

        var dIssueDate = $('#txtDateFabric').datebox('getValue');
        var dSubDate = $('#txtSubDateFabric').datebox('getValue');

        if (new Date(dSubDate) < new Date(dIssueDate)) {
            alert("Submission Date must greater than Issue Date.");
            return false;
        }

        var obj = {
            FabricID: RefreshObjectFabric().FabricID,
            SubmissionDate: $('#txtSubDateFabric').datebox('getValue')
        };
        
       

        $.ajax({
            type: "POST",
            url: _sBaseAddress + "/Fabric/SaveSubmissionDate",
            traditional: true,
            data: JSON.stringify(obj),
            contentType: "application/json; charset=utf-8",
            success: function (data) {
                debugger;
                var oFabric = jQuery.parseJSON(data);
                if(oFabric.FabricID>0)
                {
                    var oFSCD =  $("#winFabric").data('FSCD');
                    var nRowIndexBank = $("#tblFabricSCReports").datagrid("getRowIndex", oFSCD);
                    var oRows=$("#tblFabricSCReports").datagrid('getRows');

                    oRows[nRowIndexBank].SubmissionDate = oFabric.SubmissionDate;
                    oRows[nRowIndexBank].SubmissionDateSt = oFabric.SubmissionDateSt;

                    $('#tblFabricSCReports').data('FDPs',oRows)
                    DynamicRefreshList(oRows,'tblFabricSCReports');
                    alert("Submission Successfully.");

                    $("#tblFabricSCReports").datagrid("selectRow", nRowIndexBank);
                }
                else{
                    alert(oFabric.ErrorMessage);
                }
                $('#winFabric').icsWindow('close');
            }
        });
    });

     //Sales Contract Specification

    $('#btnSpecification').click(function(e){

        var row = $('#tblFabricSCReports').datagrid('getSelected');

        if(row==null || row.FabricSalesContractDetailID<=0){
            alert("Select an item from list");
            return false;
        }
        var nRowIndexBank = $("#tblFabricSCReports").datagrid("getRowIndex", row);
        sessionStorage.setItem("SelectedRowIndex", nRowIndexBank);
        sessionStorage.setItem("BackLink", window.location.href);
        var nts=((new Date()).getTime())/1000;
        window.location.href = _sBaseAddress+"/FabricExecutionOrderSpecification/ViewSpecification?nFSCDID="+ row.FabricSalesContractDetailID+"&nts="+nts;
        //window.open(_sBaseAddress+ "/FabricExecutionOrderSpecification/ViewSpecification?nFSCDID="+ row.FabricSalesContractDetailID+"&nts="+nts, "_blank");
    });

     //Fabric History

    $('#btnFabricHistory,#btnShowHistory').click(function(e){

        var row = $('#tblFabricSCReports').datagrid('getSelected');

        if(row==null || row.FabricSalesContractDetailID<=0){
            alert("Select an item from list");
            return false;
        }

        $.ajax({
            type: "POST",
            url: _sBaseAddress + "/Fabric/GetsFabricHistory",
            traditional: true,
            data: JSON.stringify({FabricID:row.FabricID}),
            contentType: "application/json; charset=utf-8",
            success: function (data) {
                debugger;
                var results = jQuery.parseJSON(data);
                if(results!=null  && results.any())
                {
                    $("#winFabricHistory").icsWindow("open");
                    DynamicRefreshList(results,'tblFabricHistory');
                }
                else{
                    alert("No history found.");
                }
            }
        });

        
        
    });
 
    $('#btnCloseFabricHistory').click(function(e){
        $('#winFabricHistory').icsWindow('close');
    });
    
        /// LabdipOperation
    $("#btnRequestForLabdip").click(function () {
        debugger;
        var oFSC = $('#tblFabricSCReports').datagrid('getSelected');
        var nSelectedIndex= $('#tblFabricSCReports').datagrid('getRowIndex',oFSC);
        $('#tblFabricSCReports').data('Index', nSelectedIndex);
        if (oFSC ==null || oFSC.FabricSalesContractDetailID<=0) { alert("Please select an item from list."); return ; }
        $('#txtDispoNo').val(oFSC.ExeNo);
        $('#txtSCNo_Lab').val(oFSC.SCNoFull);
        $('#txtFabricNo_Lab').val(oFSC.FabricNo);
        $('#txtComposition').val(oFSC.ProductName);
        $('#txtConstruction').val(oFSC.Construction);
        $('#txtFabrictype').val(oFSC.FinishTypeName);

        $.ajax({
            type: "POST",
            url: _sBaseAddress + "/LabDip/GetLDByFabric",
            traditional: true,
            data: JSON.stringify(oFSC),
            contentType: "application/json; charset=utf-8",
            success: function (data) {
                debugger;
                var oLabDip = jQuery.parseJSON(data);
                if(oLabDip!=null )
                {
                    LoadLabdip(oLabDip);
                    $('#winLabDip').data('LabDip', oLabDip);
                  
                }
                $("#winLabDip").icsWindow("open", "Labdip Request");

            }
        });

    });
    $("#btnSaveLabDip").click(function (e) {
       
        var oFSCD = $('#tblFabricSCReports').datagrid('getSelected');
        var nSelectedIndex= $('#tblFabricSCReports').datagrid('getRowIndex',oFSCD);
        $('#tblFabricSCReports').data('Index', nSelectedIndex);
        if (oFSCD ==null || oFSCD.FabricSalesContractDetailID<=0) { alert("Please select an item from list."); return ; }
        var obj =
            {
                BaseAddress: _sBaseAddress,
                Object: oFSCD,
                ObjectId: oFSCD.FabricSalesContractDetailID,
                ControllerName: "LabDip",
                ActionName: "SaveByFabric",
                TableId: "",
                IsWinClose: false,
                Message:''
            };
        $.icsSave(obj, function (response) {
            if (response.status) {
                debugger;
                if(response.obj.LabDipID>0){
                    LoadLabdip(response.obj);
                    alert("LabDip Request done successfully.");
                }
                //OperationPerformsExportLC(nRowIndex, response.obj);
            }
        });
    });
    $("#btnSaveLabRecd").click(function () {
        ChangeOrderState(7,"Receive From Lab");
    });

    $("#btnSaveLabdipSubmit").click(function () {
        ChangeOrderState(8,"Submit To HO ");
    });

    function ChangeOrderState(sStatus,sMessage)
    {
        var oLabDip = $('#winLabDip').data('LabDip');
        if (oLabDip ==null || oLabDip.LabDipID <=0 ) { alert("Please select an item from list."); return ; }

        if(!confirm("Confirm to "+sMessage)) return false;
        oLabDip.Params=sStatus;

        var obj = {
            BaseAddress: _sBaseAddress,
            Object: oLabDip,
            ObjectId: oLabDip.LabDipID,
            ControllerName: "LabDip",
            ActionName: "ChangeStatusFromFabric",
            TableId: "",
            IsWinClose: false,
            Message: sMessage.charAt(0).toUpperCase()+sMessage.slice(1) +" Successfully."
        };
        $.icsSave(obj, function (response) {
            if (response.status && response.obj != null) {
                if (response.obj.LabDipID > 0) {
                    LoadLabdip(response.obj);
                }
            }
        });
    }
    function LoadLabdip(oLabdip)
    {
        debugger;
     
        $('#trLabdipReceive,#trLabdipSubmit').hide();
        if(oLabdip.OrderStatus>1)
        {
             $('#trLabdipRequest').hide();
        }
        if(oLabdip.OrderStatus>=5&&oLabdip.OrderStatus<7)
        {
            $('#trLabdipReceive').show();
        }
        if(oLabdip.OrderStatus>=7&&oLabdip.OrderStatus<=8)
        {
            $('#trLabdipSubmit').show();
            
        }
        $('#txtLabDipOrderNo').val(oLabdip.LabdipNo);
        $('#txtLabdipStatus').val(oLabdip.OrderStatusStr);
        DynamicRefreshList(oLabdip.LabdipHistorys,'tblLabdipHistory');
    }

    $("#btnCloseLabDip").click(function () {
        $("#winLabDip").icsWindow("close");
    });
        ///End Labdip Operation

    ///// Entry Dyeing Order
 
   
        ///

    $("#btnDyeingOrder").click(function(){
        debugger;
        var oFSC = $('#tblFabricSCReports').datagrid('getSelected');
        var nSelectedIndex= $('#tblFabricSCReports').datagrid('getRowIndex',oFSC);
        $('#tblFabricSCReports').data('Index', nSelectedIndex);
        if (oFSC ==null || oFSC.FabricSalesContractID<=0) { alert("Please select an item from list."); return ; }

        var SelectedRowIndex=$('#tblFabricSCReports').datagrid('getRowIndex',oFSC);
        var oFabricSCReports= $('#tblFabricSCReports').datagrid('getRows');
        sessionStorage.setItem("FabricSCReports", JSON.stringify(oFabricSCReports));
        sessionStorage.setItem("SelectedRowIndex", SelectedRowIndex);
        sessionStorage.setItem("ExportSCHeader", "View ExportSC");

        sessionStorage.setItem("BackLink", window.location.href);
        var nts=((new Date()).getTime())/1000;
        window.location.href = _sBaseAddress+ "/DyeingOrder/ViewFNSaleOrder?nId=0&nFSCDID="+oFSC.FabricSalesContractDetailID+"&IsInHouse=true&buid="+_nBUID+"&ts="+nts;
        //window.location.href = _sBaseAddress+  "/DyeingOrder/ViewFNSaleOrder?nId=0&nFSCDID="+oFSC.FabricSalesContractID+"&buid="+_nBUID+"&ts="+nts;
    });
    $('#btnPrintPO').click(function (e)
    {
        var oFabricSalesContract = $("#tblFabricSCReports").datagrid("getSelected");
        if (oFabricSalesContract == null || oFabricSalesContract.FabricSalesContractID <= 0) {
            alert("Invalid Field!!! please select a valid Field!");
            return false;
        }
        var tsv=((new Date()).getTime())/1000;
        //window.open(_sBaseAddress+ "/FabricSalesContract/PrintPreview?nID="+oFabricSalesContract.FabricSalesContractID+"&bIsRnd=true&nts="+tsv, "_blank");
        window.open(_sBaseAddress+ "/FabricSalesContract/PrintPreview?nID="+oFabricSalesContract.FabricSalesContractID+"&bIsRnd=true&nts="+tsv+"&bPrintFormat=true&nTitleTypeInImg=1", "_blank");

    });
</script>


