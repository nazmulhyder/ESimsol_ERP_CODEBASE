@{
    ViewBag.Title = "Order Update Status";
}
@model IEnumerable<ESimSol.BusinessObjects.FNOrderUpdateStatus>
    <div id="progressbarParent" style="width:100%;height:100%;margin:0 auto;text-align:center; margin-left: auto;margin-right: auto;left: 0;right: 0;z-index: 1;">
        <div style="margin: 0px auto;margin-top: 251px;text-align:center;width:390px;">
            <label style="font-size:18px;">Please wait</label>
            <div id="progressbar" style="width:100%;height:37px;"></div>
        </div>
    </div>
    
    <div class="menuMainCollectionTable" id="regionFNOrderUpdateStatus">
        <table id="tblFNOrderUpdateStatuss" title="Order Update Status" class="easyui-datagrid" fit="true" fitcolumns="false" rownumbers="true" pagination="false" singleselect="true" showFooter="true" autorowheight="false" toolbar="#toolbar">
            <thead>
                <tr>
                    <th field="ExeNo" width="8%">Dispo No</th>
                    <th field="SCNo" width="8%">PO NO</th>
                    <th field="BuyerName" width="12%">Buyer</th>
                    <th field="ContractorName" width="12%">Garments Name</th>
                    <th field="Construction" width="10%">Construction</th>
                    <th field="ColorInfo" width="8%">Color</th>
                    <th field="OrderQty" align="right" formatter="formatPrice" width="8%">Order Qty</th>
                    <th field="ReqGreyRcv" align="right" formatter="formatPrice" width="8%">Req. Grey Rcv.</th>
                    <th field="GreyRecd" align="right" formatter="formatPrice" width="8%">Grey Recd</th>
                    <th field="PendingGreyRcv" align="right" formatter="formatPrice" width="8%">Pending Grey Rcv.</th>
                    <th field="BatchQty" align="right" formatter="formatPrice" width="8%">Batch Qty</th>
                    <th field="GradeAQty" align="right" formatter="formatPrice" width="8%">Grade-A</th>
                    <th field="GradeBQty" align="right" formatter="formatPrice" width="8%">Grade-B</th>
                    <th field="GradeCQty" align="right" formatter="formatPrice" width="8%">Grade-C</th>
                    <th field="GradeDQty" align="right" formatter="formatPrice" width="8%">Grade-D</th>
                    <th field="RejQty" align="right" formatter="formatPrice" width="8%">(Reject + Cut Pcs)</th>
                    <th field="TotalQty" align="right" formatter="formatPrice" width="8%">Total Ins. Qty</th>
                    <th field="StoreRcvQty" align="right" formatter="formatPrice" width="8%">Store Recd Qty</th>
                    <th field="WForRcvQtyInCalST" align="right" formatter="formatPrice" width="8%">Waiting For Recd</th>
                    <th field="DCQty" align="right" formatter="formatPrice" width="8%">Delivery Qty</th>
                    <th field="RCQty" align="right" formatter="formatPrice" width="8%">Return Qty</th>
                    <th field="BalanceQty" align="right" formatter="formatPrice" width="8%">Balance Qty</th>
                    <th field="StoreRcvQtyDay" align="right" formatter="formatPrice" width="8%">Store Recd (Day) </th>
                    <th field="DCQtyDay" align="right" formatter="formatPrice" width="8%">Delivery Qty(Day)</th>
                    <th field="StockInHand" align="right" formatter="formatPrice" width="8%">Stock In Hand</th>
                    <th field="ExcessQty" align="right" formatter="formatPrice" width="8%">Excess Qty</th>
                </tr>
            </thead>
        </table>
        <div id="toolbar">
            <input type="text" id="txtDispoNo" placeholder="Search by Dispo No" style="width:100px;text-align:left" />
            <a id="btnAdvSearch" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-search" plain="true">Adv. Search</a>
            <a id="btnShowDetail" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-details" plain="true">Show Roll</a>
            <a id="btnPrint" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-print" plain="true">Preview</a>
            <a id="btnPrintList" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-print" plain="true">Print List</a>
            <a id="btnExcel" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-excel" plain="true">Excel</a>
            <a id="btnStatement" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-print" plain="true">Statement</a>
        </div>
    </div>

    <div id="winAdvSearch" class="easyui-window winClass" style=" width:680px;" title=" adv. search" data-options="modal:true,closed:true,collapsible:false,minimizable:false,maximizable:false,closable:false">
            <table style="width:100%;">
                <tr style="width:100%;">
                    <td style="width:100%;">
                        <fieldset style="margin-bottom: 0px;">
                            <legend>Searching Criteria</legend>
                            <table style="width:100%;">

                                <tr>
                                    <td style=" width:20%;text-align:right;">
                                        <label>Type : </label>
                                    </td>
                                    <td colspan="3" style="width:80%;text-align:left;">
                                        <select id="cboTypeAdvS" style="width:25%;height:22px;">
                                            <option value="0">--Select One--</option>
                                            <option value="1">Inspection To Finish Store Date</option>
                                            <option value="2">Received In Finish Store Date</option>
                                            <option value="3">Delivery Challan Date</option>
                                            <option value="4">Dispo Date</option>
                                            <option value="5">PO Date</option>
                                        </select>
                                        <select id="cboTypeDateAdvS" style="width:20%;" onchange="DateActionsTypeDateAdvS();"></select>
                                        <input id="txtFromTypeDateAdvSearch" type="text" style="width: 25%;" class="easyui-datebox" required="required" data-options="formatter:icsdateformat,parser:icsdateparser" />To
                                        <input id="txtToTypeDateAdvSearch" type="text" style="width: 25%;" class="easyui-datebox" required="required" data-options="formatter:icsdateformat,parser:icsdateparser" />
                                    </td>
                                </tr>
                                <tr>
                                    <td style=" width:20%;text-align:right;">
                                        <label>PO Date : </label>
                                    </td>
                                    <td colspan="3" style="width:80%;text-align:left;">
                                        <select id="cboPODateAdvS" style="width:20%;" onchange="DateActionsPODateAdvS();"></select>
                                        <input id="txtFromPODateAdvSearch" type="text" style="width: 25%;" class="easyui-datebox" required="required" data-options="formatter:icsdateformat,parser:icsdateparser" />To
                                        <input id="txtToPODateAdvSearch" type="text" style="width: 25%;" class="easyui-datebox" required="required" data-options="formatter:icsdateformat,parser:icsdateparser" />
                                    </td>
                                </tr>
                                <tr>
                                    <td style=" width:20%;text-align:right;">
                                        <label>PO No : </label>
                                    </td>
                                    <td colspan="3" style="width:80%;text-align:left;">
                                        <input id="txtPONoAdvSearch" type="text" style="width:99%" />
                                    </td>
                                </tr>
                                <tr>
                                    <td style=" width:20%;text-align:right;">
                                        <label>Customer Name : </label>
                                    </td>
                                    <td colspan="3" style=" width:80%;text-align:left;">
                                        <input id="txtCustomerName" style="width:88%;" type="text" placeholder="Type Party Name & Press Enter" />
                                        <a id="btnCustomerPiker" href="javascript:void(0)" class="easyui-linkbutton ics-pick" iconcls="icon-pick" plain="true"></a>
                                        <a id="btnClrCustomerPiker" href="javascript:void(0)" class="easyui-linkbutton ics-pick" iconcls="icon-clear" plain="true"></a>
                                    </td>
                                </tr>
                              
                                <tr>
                                    <td style=" width:20%;text-align:right;">
                                        <label>Status : </label>
                                    </td>
                                    <td colspan="3" style="width:80%;text-align:left;">
                                        <select id="cboStatusAdvS" style="width:99%;height:22px;">
                                            <option value="0">--Select One--</option>
                                            <option value="1">Current Stock</option>
                                            <option value="2">Excess Stock</option>
                                            <option value="3">Waiting for Grey Received</option>
                                            <option value="4">Grey Received but Batch not issue</option>
                                            <option value="5"> Batch  issue but Inspection not received</option>
                                            <option value="6"> Wating for Receive Bulk From </option>
                                            <option value="7"> Wating for Receive Excess</option>
                                            <option value="8"> Wating for Delivery</option>
                                            
                                        </select>
                                    </td>
                                </tr>

                                <tr>
                                    <td style=" width:20%;text-align:right;">
                                        <label>Buying House : </label>
                                    </td>
                                    <td colspan="3" style=" width:80%;text-align:left;">
                                        <input id="txtBuyingHouse" style="width:88%;" type="text" placeholder="Type Name & Press Enter" />
                                        <a id="btnBuyingHousePiker" href="javascript:void(0)" class="easyui-linkbutton ics-pick" iconcls="icon-pick" plain="true"></a>
                                        <a id="btnClrBuyingHousePiker" href="javascript:void(0)" class="easyui-linkbutton ics-pick" iconcls="icon-clear" plain="true"></a>
                                    </td>
                                </tr>

                                <tr>
                                    <td style=" width:20%;text-align:right;">
                                        <label>Mkt. Account : </label>
                                    </td>
                                    <td colspan="3" style=" width:80%;text-align:left;">
                                        <input id="txtMktAccount" style="width:88%;" type="text" placeholder="Type Name & Press Enter" />
                                        <a id="btnMktAccountPiker" href="javascript:void(0)" class="easyui-linkbutton ics-pick" iconcls="icon-pick" plain="true"></a>
                                        <a id="btnClrMktAccountPiker" href="javascript:void(0)" class="easyui-linkbutton ics-pick" iconcls="icon-clear" plain="true"></a>
                                    </td>
                                </tr>

                                <tr>
                                    <td style=" width:20%;text-align:right;">
                                        <label>Mkt. Group : </label>
                                    </td>
                                    <td colspan="3" style=" width:80%;text-align:left;">
                                        <input id="txtMktGroup" style="width:88%;" type="text" placeholder="Type Name & Press Enter" />
                                        <a id="btnMktGroupPiker" href="javascript:void(0)" class="easyui-linkbutton ics-pick" iconcls="icon-pick" plain="true"></a>
                                        <a id="btnClrMktGroupPiker" href="javascript:void(0)" class="easyui-linkbutton ics-pick" iconcls="icon-clear" plain="true"></a>
                                    </td>
                                </tr>

                                <tr>
                                    <td height="30px" colspan="4"></td>
                                </tr>
                            </table>
                        </fieldset>
                    </td>
                </tr>
            </table>

            <fieldset class="actionfieldsetstyle">
                <legend>Actions : </legend>
                <label class="lblLoadingMessage" style="float: left;">Loading Please Wait...</label>
                <a id="btnSearchAdvSearch" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-search" plain="true">Search</a>
                <a id="btnCloseAdvSearch" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-cancel" plain="true">Close</a>
            </fieldset>
        </div>
    <div id="winFNBatchQCDetail" class="easyui-window winstyle" title="Batch Roll Information" style="width:80%;" data-options="modal:true,closed:true,collapsible:false,minimizable:false,maximizable:false,closable:false">
        <div >
            <fieldset style="height:10%">
                <legend style="font-weight: bold">FN Batch QC Details</legend>
                <div style="overflow:hidden;display:block">
                    <div style="overflow:hidden;float:left; width:32%">
                        <div style="overflow:hidden;float:left;width:30%;text-align:right">
                            Dispo:
                        </div>
                        <div style="overflow:hidden;float:left;width:70%">
                            <input id="txtDispo" type="text" style=" width:100%;" disabled />
                        </div>
                    </div>
                    <div style="overflow:hidden;float:left; width:32%">
                        <div style="overflow:hidden;float:left;width:30%;text-align:right">
                            Garment:
                        </div>
                        <div style="overflow:hidden;float:left;width:70%">
                            <input id="txtGarment" type="text" style=" width:100%;" disabled />
                        </div>
                    </div>
                    <div style="overflow:hidden;float:left; width:32%">
                        <div style="overflow:hidden;float:left;width:30%;text-align:right">
                            Construction:
                        </div>
                        <div style="overflow:hidden;float:left;width:70%">
                            <input id="txtConstruction" type="text" style=" width:100%;" disabled />
                        </div>
                    </div>
                </div>
            </fieldset>
            <div >
                <table id="tblFNBatchQCDetail" style="width:100%;height:500px " class="easyui-datagrid" fitcolumns="false" rownumbers="true" pagination="false" singleselect="true" autorowheight="false" toolbar="#toolbarKnittingConsumption" data-options="onClickRow: onClickRow" showfooter="true">
                    <thead>
                        <tr>
                            <th data-options="field:'Selected',checkbox:true"></th>
                            <th field="LotNo" width="8%">Roll No</th>
                            <th field="GradeStr" width="8%">Grade</th>
                            <th field="Qty" align="right" formatter="formatPrice" width="10%">Qty(y)</th>
                            <th field="QtyDC" align="right" formatter="formatPrice" width="10%">Delivery Qty(y)</th>
                            <th field="QtyRC" align="right" formatter="formatPrice" width="10%">Return Qty(y)</th>
                            <th field="Balance" align="right" formatter="formatPrice" width="10%">Balancey(y)</th>
                            <th width="7%" align="right" data-options="field:'QtyExe',editor:{type:'numberbox',options:{precision:2}}">Excess Entry Qty</th>
                            @*<th field="QtyExe" align="right" formatter="formatPrice" width="10%">Excess Qty</th>*@
                            <th field="LockDateStr" align="center" width="10%">Forward Date</th>
                            <th field="StoreRcvDateStr" align="center" width="10%">Store Rcv Date</th>
                        </tr>
                    </thead>
                </table>
                <div id="toolbarKnittingConsumption">

                </div>
            </div>
            <div style="display:block;overflow:hidden;">
                <fieldset style="height:10%">
                    <legend style="font-weight: bold">Action : </legend>
                    <table border="0" cellspacing="2" cellpadding="2" style="font-size: 11px; font-weight: bold; width:100%">
                        <tr>
                            <td style="width:60%; text-align:right"></td>
                            <td style="width:40%;text-align:right;">
                                <a id="btnExcessQtyUpdate" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-ok" plain="true">Save(ExcessQty)</a>
                                <a id="btnFNBatchQCDetailClose" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-cancel" plain="true">Close</a>
                            </td>
                        </tr>
                    </table>
                </fieldset>
            </div>
        </div>
      </div>

    <script type="text/javascript">
    debugger;
    var _oFNOrderUpdateStatuss=[];
    var _sBaseAddress="";
    var _oAuthorizationRolesMapping=[];
    var _oCompareOperators=[];
    $(document).ready(function () {
        debugger;
        _oFNOrderUpdateStatuss =@Html.Raw( new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(Model));
        _sBaseAddress =@Html.Raw( new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(HttpContext.Current.Session[SessionInfo.BaseAddress]));
        _oAuthorizationRolesMapping =@Html.Raw( new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(HttpContext.Current.Session[SessionInfo.AuthorizationRolesMapping]));
        var nBUID = @Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(ViewBag.BUID));
        _oCompareOperators =@Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(ViewBag.CompareOperators));
        sessionStorage.setItem("BUID",nBUID);
        RefreshList(_oFNOrderUpdateStatuss);

        //RefreshControlLayout();
        $("#progressbar").progressbar({ value: 0 });
        $("#progressbarParent").hide();
        $("#winAdvSearch").data("CustomerIDs","");
        $("#winAdvSearch").data("BuyingHouseIDs","");
        $("#winAdvSearch").data("MktPersonIDs","");
        $("#winAdvSearch").data("MktGroupIDs","");
    });

        function RefreshList(oFNOrderUpdateStatuss)
        {
            debugger;
            var data=oFNOrderUpdateStatuss;
            data={"total":""+data.length+"","rows":data};
            $('#tblFNOrderUpdateStatuss').datagrid('loadData',data);
            $.icsMakeFooterColumn('tblFNOrderUpdateStatuss',['ExeNo','OrderQty','GreyRecd','BatchQty','GradeAQty','GradeBQty','GradeCQty','RejQty','TotalQty','StoreRcvQty','WForRcvQtyInCalST','DCQty','RCQty','BalanceQty','StoreRcvQtyDay','DCQtyDay','StockInHand','ExcessQty']);
        }
            function updateProgress() {
                var value =$('#progressbar').progressbar('getValue');
                if (value < 96){
                    value += Math.floor(Math.random() * 10);
                    $('#progressbar').progressbar('setValue', value);
                }
            }
            function hideShow(miliseconds) {
                $("#progressbarParent").hide();
            }

            $('#txtDispoNo').keypress(function (e) {
                var code = (e.keyCode ? e.keyCode : e.which);
                if (code == 13)//Enter key-13
                {
                    debugger;
                    if($("#txtDispoNo").val()==null && $("#txtDispoNo").val()=="")
                    {
                        alert("Please Type a dispo no");
                        $("#txtDispoNo").focus();
                        return;
                    }
                    var sParams =   sessionStorage.getItem("BUID") + "~" + 
                            0 + "~"+0+"~" + icsdateformat(new Date()) + "~" + icsdateformat(new Date()) + "~" +
                            0 + "~" + icsdateformat(new Date()) + "~" + icsdateformat(new Date()) + "~" +
                            ""+"~" +
                            ""+"~"+ $.trim($("#txtDispoNo").val())+"~"+ 0;

                    sessionStorage.setItem("AdvSearchString", sParams);
                    var oFNOrderUpdateStatus = {
                        ErrorMessage: sParams
                    }
                    Search(oFNOrderUpdateStatus);
                }
            });
    
            $("#btnClrCustomerPiker").click(function () {
                $("#txtCustomerName").val("");
                $("#winAdvSearch").data("CustomerIDs","");
            });
            $("#btnCustomerPiker").click(function () {
                var sCustomerName=$.trim($("#txtCustomerName").val());
                GetCustomers("", 3, "Customer");
            });
            $("#txtCustomerName").keydown(function (e) {
                var nkeyCode = e.keyCode || e.which;
                if(nkeyCode==13){
                    var sCustomerName=$.trim($("#txtCustomerName").val());
                    if(sCustomerName==""){ alert("Type Party name to search."); return false; }
                    GetCustomers(sCustomerName, 3, "Customer");
                }
                else if(nkeyCode==8){
                    $("#txtCustomerName").val("");
                    $("#winAdvSearch").data("CustomerIDs","");
                }
            });

            $("#btnClrBuyingHousePiker").click(function () {
                $("#txtBuyingHouse").val("");
                $("#winAdvSearch").data("BuyingHouseIDs","");
            });
            $("#btnBuyingHousePiker").click(function () {
                var sCustomerName=$.trim($("#txtBuyingHouse").val());
                GetCustomers("", 2, "BuyingHouse");
            });
            $("#txtBuyingHouse").keydown(function (e) {
                var nkeyCode = e.keyCode || e.which;
                if(nkeyCode==13){
                    var sCustomerName=$.trim($("#txtBuyingHouse").val());
                    if(sCustomerName==""){ alert("Type Party name to search."); return false; }
                    GetCustomers(sCustomerName, 2, "BuyingHouse");
                }
                else if(nkeyCode==8){
                    $("#txtBuyingHouse").val("");
                    $("#winAdvSearch").data("BuyingHouseIDs","");
                }
            });

            function GetCustomers(sCustomerName, nType, sDivID){
                var oCustomer = {
                    Params: nType + '~' + sCustomerName + '~' + sessionStorage.getItem("BUID")
                };
                var obj = {
                    BaseAddress: _sBaseAddress,
                    Object: oCustomer,
                    ControllerName: "Contractor",
                    ActionName: "ContractorSearchByNameType",
                    IsWinClose: false
                };

                $.icsDataGets(obj, function (response) {
                    debugger;
                    if (response.status && response.objs.length > 0) {
                        if (response.objs[0].ContractorID > 0) {
                            debugger;
                            var tblColums = [];
                            var oColumn = { field: "Name", title: "Party Name", width: 200, align: "left" }; tblColums.push(oColumn);
                            oColumn = { field: "Address", title: "Address", width: 120, align: "left" }; tblColums.push(oColumn);
                            //oColumn = { field: "Email", title: "Email", width: 90, align: "left" }; tblColums.push(oColumn);
                            //oColumn = { field: "ShortName", title: "Short Name", width: 90, align: "left" }; tblColums.push(oColumn);

                            var oPickerParam = {
                                winid: 'win'+sDivID+'sPicker',
                                winclass:'cls'+sDivID+'sPicker',
                                winwidth: 480,
                                winheight: 460,
                                tableid: 'tbl'+sDivID+'sPicker',
                                tablecolumns: tblColums,
                                datalist: response.objs,
                                multiplereturn: true,
                                searchingbyfieldName:'Name',
                                windowTittle: sDivID + ' List'
                            };
                            $.icsPicker(oPickerParam);
                            IntializePickerbutton(oPickerParam);//multiplereturn, winclassName
                        }
                        else { alert(response.objs[0].ErrorMessage); }
                    }
                    else{
                        alert("No Customer found.");
                    }
                });
            }

            $("#btnClrMktAccountPiker").click(function () {
                $("#txtMktAccount").val("");
                $("#winAdvSearch").data("MktPersonIDs","");
            });
            $("#btnMktAccountPiker").click(function () {
                debugger;
                var sName=$.trim($("#txtMktAccount").val());
                GetMktPersons(sName);
            });
            $("#txtMktAccount").keydown(function (e) {
                var nkeyCode = e.keyCode || e.which;
                if(nkeyCode==13){
                    var sName=$.trim($("#txtMktAccount").val());
                    GetMktPersons(sName);
                }
                else if(nkeyCode==8){
                    $("#txtMktAccount").val("");
                    $("#winAdvSearch").data("MktPersonIDs","");
                }
            });
            function GetMktPersons(sName){

                var oMarketingAccount_BU = {
                    Name:sName,
                    BUID:sessionStorage.getItem("BUID")
                };
                var obj = {
                    BaseAddress: _sBaseAddress,
                    Object: oMarketingAccount_BU,
                    ControllerName: "MarketingAccount",
                    ActionName: "MarketingAccountSearchByName",
                    IsWinClose: false
                };
                $("#progressbar").progressbar({ value: 0 });
                $("#progressbarParent").show();
                var intervalID = setInterval(updateProgress, 250);
                $.icsDataGets(obj, function (response) {
                    clearInterval(intervalID);
                    $("#progressbarParent").hide();
                    if (response.status && response.objs.length > 0) {
                        if (response.objs[0].MarketingAccountID > 0) {
                            debugger;
                            var tblColums = [];
                            var oColumn = { field: "MarketingAccountID", title: "Code", width: 50, align: "left" };tblColums.push(oColumn);
                            oColumn = { field: "Name", title: "Name", width: 180, align: "left" };tblColums.push(oColumn);
                            oColumn = { field: "GroupName", title: "Group Name", width: 120, align: "left" };tblColums.push(oColumn);
                            oColumn = { field: "Phone", title: "Phone", width: 100, align: "left" };tblColums.push(oColumn);

                            var oPickerParam = {
                                winid: 'winMktAccount',
                                winclass:'clsMktPersonPicker',
                                winwidth: 460,
                                winheight: 460,
                                tableid: 'tblMktPersonPicker',
                                tablecolumns: tblColums,
                                datalist: response.objs,
                                multiplereturn: true,
                                searchingbyfieldName:'Name',
                                windowTittle: 'MKT Person List'
                            };
                            $.icsPicker(oPickerParam);
                            IntializePickerbutton(oPickerParam);//multiplereturn, winclassName
                        }
                        else { alert(response.objs[0].ErrorMessage); }
                    }
                    else{
                        alert("No marketing person found.");
                    }
                });


            }

            $("#btnClrMktGroupPiker").click(function () {
                $("#txtMktGroup").val("");
                $("#winAdvSearch").data("MktGroupIDs","");
            });

            $("#btnMktGroupPiker").click(function () {
                debugger;
                var sName=$.trim($("#txtMktGroup").val());
                GetMktGroups(sName);
            });

            $("#txtMktGroup").keydown(function (e) {
                var nkeyCode = e.keyCode || e.which;
                if(nkeyCode==13){
                    var sName=$.trim($("#txtMktGroup").val());
                    GetMktGroups(sName);
                }
                else if(nkeyCode==8){
                    $("#txtMktGroup").val("");
                    $("#winAdvSearch").data("MktGroupIDs","");
                }
            });

            function GetMktGroups(sName){
                var oMarketingAccount_BU = {
                    Name:sName,
                    BUID:sessionStorage.getItem("BUID")
                };
                var obj = {
                    BaseAddress: _sBaseAddress,
                    Object: oMarketingAccount_BU,
                    ControllerName: "MarketingAccount",
                    ActionName: "GetsGroupHead",
                    IsWinClose: false
                };
                $("#progressbar").progressbar({ value: 0 });
                $("#progressbarParent").show();
                var intervalID = setInterval(updateProgress, 250);
                $.icsDataGets(obj, function (response) {
                    clearInterval(intervalID);
                    $("#progressbarParent").hide();
                    if (response.status && response.objs.length > 0) {
                        if (response.objs[0].MarketingAccountID > 0) {
                            debugger;
                            var tblColums = [];
                            var oColumn = { field: "MarketingAccountID", title: "Code", width: 50, align: "left" };tblColums.push(oColumn);
                            oColumn = { field: "Name", title: "Name", width: 180, align: "left" };tblColums.push(oColumn);
                            oColumn = { field: "GroupName", title: "Group Name", width: 120, align: "left" };tblColums.push(oColumn);
                            oColumn = { field: "Phone", title: "Phone", width: 100, align: "left" };tblColums.push(oColumn);

                            var oPickerParam = {
                                winid: 'winMktGroup',
                                winclass:'clsMktgroupPicker',
                                winwidth: 460,
                                winheight: 460,
                                tableid: 'tblMktGroupPicker',
                                tablecolumns: tblColums,
                                datalist: response.objs,
                                multiplereturn: true,
                                searchingbyfieldName:'Name',
                                windowTittle: 'MKT Group List'
                            };
                            $.icsPicker(oPickerParam);
                            IntializePickerbutton(oPickerParam);//multiplereturn, winclassName
                        }
                        else { alert(response.objs[0].ErrorMessage); }
                    }
                    else{
                        alert("No marketing person found.");
                    }
                });


            }

            function IntializePickerbutton(oPickerobj) {
                $("#" + oPickerobj.winid).find("#btnOk").click(function () {
                    //for Single Select
                    SetPickerValueAssign(oPickerobj);
                });
                $(document).find('.' + oPickerobj.winclass).keydown(function (e) {
                    if (e.which == 13)//enter=13
                    {
                        SetPickerValueAssign(oPickerobj);

                    }
                });
            }

            function SetPickerValueAssign(oPickerobj) {
                //debugger;
                var oreturnObj = null, oreturnobjs = [];
                if (oPickerobj.multiplereturn) {
                    oreturnobjs = $('#' + oPickerobj.tableid).datagrid('getChecked');
                } else {
                    oreturnObj = $('#' + oPickerobj.tableid).datagrid('getSelected');
                }
                $("#" + oPickerobj.winid).icsWindow("close");
                $("#" + oPickerobj.winid).remove();

                if (oPickerobj.winid == 'winCustomersPicker')
                {
                    if(oreturnobjs.length > 0){
                        if(oreturnobjs.length == 1){
                            $("#txtCustomerName").val(oreturnobjs[0].Name);
                            $("#winAdvSearch").data("CustomerIDs",oreturnobjs[0].ContractorID);
                        }else{
                            var ids = "";
                            for(var i=0;i<oreturnobjs.length;i++){
                                ids += oreturnobjs[i].ContractorID + ",";
                            }
                            if(ids.length > 0) ids = ids.substring(0, ids.length-1);
                            $("#txtCustomerName").val("You select " + oreturnobjs.length + " Customers");
                            $("#winAdvSearch").data("CustomerIDs",ids);
                        }
                    }else{
                        alert("Please select Party!!");
                    }
                }
                else if (oPickerobj.winid == 'winBuyingHousesPicker')
                {
                    if(oreturnobjs.length > 0){
                        if(oreturnobjs.length == 1){
                            $("#txtBuyingHouse").val(oreturnobjs[0].Name);
                            $("#winAdvSearch").data("BuyingHouseIDs",oreturnobjs[0].ContractorID);
                        }else{
                            var ids = "";
                            for(var i=0;i<oreturnobjs.length;i++){
                                ids += oreturnobjs[i].ContractorID + ",";
                            }
                            if(ids.length > 0) ids = ids.substring(0, ids.length-1);
                            $("#txtBuyingHouse").val("You select " + oreturnobjs.length + " items");
                            $("#winAdvSearch").data("BuyingHouseIDs",ids);
                        }
                    }else{
                        alert("Please select item!!");
                    }
                }
                else if (oPickerobj.winid=='winMktAccount')
                {
                    if(oreturnobjs.length > 0){
                        if(oreturnobjs.length == 1){
                            $("#txtMktAccount").val(oreturnobjs[0].Name);
                            $("#winAdvSearch").data("MktPersonIDs",oreturnobjs[0].MarketingAccountID);
                        }else{
                            var ids = "";
                            for(var i=0;i<oreturnobjs.length;i++){
                                ids += oreturnobjs[i].MarketingAccountID + ",";
                            }
                            if(ids.length > 0) ids = ids.substring(0, ids.length-1);
                            $("#txtMktAccount").val("You select " + oreturnobjs.length + " items");
                            $("#winAdvSearch").data("MktPersonIDs",ids);
                        }
                    }else{
                        alert("Please select item!!");
                    }
                }
                else if (oPickerobj.winid=='winMktGroup')
                {
                    if(oreturnobjs.length > 0){
                        if(oreturnobjs.length == 1){
                            $("#txtMktGroup").val(oreturnobjs[0].Name);
                            $("#winAdvSearch").data("MktGroupIDs",oreturnobjs[0].MarketingAccountID);
                        }else{
                            var ids = "";
                            for(var i=0;i<oreturnobjs.length;i++){
                                ids += oreturnobjs[i].MarketingAccountID + ",";
                            }
                            if(ids.length > 0) ids = ids.substring(0, ids.length-1);
                            $("#txtMktGroup").val("You select " + oreturnobjs.length + " items");
                            $("#winAdvSearch").data("MktGroupIDs",ids);
                        }
                    }else{
                        alert("Please select item!!");
                    }
                }
            }

            function DateActionsTypeDateAdvS() {
                DynamicDateActions("cboTypeDateAdvS", "txtFromTypeDateAdvSearch", "txtToTypeDateAdvSearch");
            }
            function DateActionsPODateAdvS() {
                DynamicDateActions("cboPODateAdvS", "txtFromPODateAdvSearch", "txtToPODateAdvSearch");
            }
  

            $("#btnCloseAdvSearch").click(function () {
                $("#winAdvSearch").icsWindow("close");
            });

            function ResetAdvSearchWindow() {
                $("#winAdvSearch input").not("input[type='button']").val("");
                $("#winAdvSearch input").removeClass("fontColorOfPickItem");
                $("#winAdvSearch select").val(0);
                DateActionsTypeDateAdvS();
                DateActionsPODateAdvS();
                $("#txtFromTypeDateAdvSearch,#txtToTypeDateAdvSearch,#txtFromPODateAdvSearch,#txtToPODateAdvSearch").datebox({ disabled: true });
                $("#txtFromTypeDateAdvSearch,#txtToTypeDateAdvSearch,#txtFromPODateAdvSearch,#txtToPODateAdvSearch").datebox("setValue", icsdateformat(new Date()));
                $("#winAdvSearch").data("CustomerIDs","");
                $("#winAdvSearch").data("BuyingHouseIDs","");
                $("#winAdvSearch").data("MktPersonIDs","");
                $("#winAdvSearch").data("MktGroupIDs","");

            }

            $("#btnAdvSearch").click(function () {
                debugger;
                DynamicResetAdvSearchWindow("winAdvSearch");
                ResetAdvSearchWindow();
       
                $("#cboTypeDateAdvS").icsLoadCombo({List: _oCompareOperators,OptionValue: "id",DisplayText: "Value"});
                $("#cboPODateAdvS").icsLoadCombo({List: _oCompareOperators,OptionValue: "id",DisplayText: "Value"});
                $(".lblLoadingMessage").hide();
                $("#winAdvSearch").icsWindow("open", " Advance Search");
            });

            $("#btnSearchAdvSearch").click(function () {
                debugger;        
                var nType = parseInt($("#cboTypeAdvS").val());
                var ncboTypeDateAdvS = parseInt($("#cboTypeDateAdvS").val());
                var dFromTypeDateAdvSearch = $('#txtFromTypeDateAdvSearch').datebox('getValue');
                var dToTypeDateAdvSearch = $('#txtToTypeDateAdvSearch').datebox('getValue');

                var nStatus = parseInt($("#cboStatusAdvS").val());
   
                var nPODateAdvSAdvS = parseInt($("#cboPODateAdvS").val());
                var dFromPODateAdvSAdvSearch = $('#txtFromPODateAdvSearch').datebox('getValue');
                var dToPODateAdvSAdvSearch = $('#txtToPODateAdvSearch').datebox('getValue');

                var sPONoAdvSearch = $.trim($("#txtPONoAdvSearch").val());
                var sContractorIDs = $("#winAdvSearch").data("CustomerIDs");

                var sBuyingHouseIDs = $("#winAdvSearch").data("BuyingHouseIDs");
                var sMktPersonIDs = $("#winAdvSearch").data("MktPersonIDs");
                var sMktGroupIDs = $("#winAdvSearch").data("MktGroupIDs");


                if(nType>0){
                    if(ncboTypeDateAdvS==0){
                        alert("Please enter atleast one searching criteria!!");
                        $("#cboTypeDateAdvS").focus()
                        return;
                    }
                }


                //if(nCboOrderDate <= 0 && sExeNo == "" && sConstruction == "" && sMachineIDs == "" && sCustomerIDs == "" && nDesign <= 0 && nPlanStatus <= 0 && sBatchNo == "" && bIsPending==false){
                //    alert("Please enter atleast one searching criteria!!");
                //    return;
                //}

                debugger;
                var sParams =   sessionStorage.getItem("BUID") + "~" + 
                                nType + "~"+ncboTypeDateAdvS+"~" + dFromTypeDateAdvSearch + "~" + dToTypeDateAdvSearch + "~" +
                                nPODateAdvSAdvS + "~" + dFromPODateAdvSAdvSearch + "~" + dToPODateAdvSAdvSearch + "~" +
                                sPONoAdvSearch+"~" +
                                sContractorIDs+"~"+
                                ""+"~"+
                                nStatus+"~"+
                                sBuyingHouseIDs+"~"+
                                sMktPersonIDs+"~"+
                                sMktGroupIDs;

                //console.log(sParams);
                sessionStorage.setItem("AdvSearchString", sParams);
                var oFNOrderUpdateStatus = {
                    ErrorMessage: sParams
                }
                $(".lblLoadingMessage").show();
      
                Search(oFNOrderUpdateStatus);
            });


            function Search(oFNOrderUpdateStatus)
            {

                $.ajax({
                    type: "POST",
                    dataType: "json",
                    url: _sBaseAddress + "/RptExecutionOrderUpdateStatus/AdvanceSearch",
                    traditional: true,
                    data: JSON.stringify(oFNOrderUpdateStatus),
                    contentType: "application/json; charset=utf-8",
                    success: function (data) {
                        var results = data;
                        if (results.length > 0)
                        {
                            debugger;
                            if (results.ErrorMessage == '' || results.ErrorMessage == null)
                            {
                                DynamicRefreshList(results, "tblFNOrderUpdateStatuss");
                       
                                $("#winAdvSearch").icsWindow("close");
                                $.icsMakeFooterColumn('tblFNOrderUpdateStatuss',['ExeNo','OrderQty','GreyRecd','BatchQty','GradeAQty','GradeBQty','GradeCQty','RejQty','TotalQty','StoreRcvQty','WForRcvQtyInCalST','DCQty','RCQty','BalanceQty','StoreRcvQtyDay','DCQtyDay','StockInHand','ExcessQty']);
                            }
                            else
                            {
                                alert(results[0].ErrorMessage);
                            }

                        }else {
                            alert("Sorry, No data found. ");
                        }
                        $(".lblLoadingMessage").hide();
                    }
                });
            }

            $("#btnExcel").click(function () {
                debugger;
                var sParam = "";
                sParam = sessionStorage.getItem("AdvSearchString");
                if(sParam == "" || sParam == null)
                {
                    alert("Please Search Any Data");
                    return;
                }
                window.open(_sBaseAddress+ "/RptExecutionOrderUpdateStatus/ExcelFNOrderUpdateStatus?sParam="+sParam, "_blank");
            });

            $("#btnPrintList").click(function () {
                debugger;
                var sParam = "";
                sParam = sessionStorage.getItem("AdvSearchString");
                if(sParam == "" || sParam == null)
                {
                    alert("Please Search Any Data");
                    return;
                }
                window.open(_sBaseAddress+ "/RptExecutionOrderUpdateStatus/PrintFNOrderUpdateStatus?sParam="+sParam, "_blank");
            });


            function RefreshControlLayout()
            {
                $('#btnAdvSearch,#btnExcel').hide();

                if(HavePermission('AdvSearch','FNOrderUpdateStatus')){$('#btnAdvSearch').show();}
                if(HavePermission('Excel','FNOrderUpdateStatus')){$('#btnExcel').show(); }
            }
            function HavePermission(sOperationType, sModuleName)
            {
                var nSessionID =@Html.Raw( new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(HttpContext.Current.Session[SessionInfo.currentUserID]));
                if(nSessionID == -9) //check SuperUser
                {
                    return true;
                }else
                {
                    for(var i =0;i<_oAuthorizationRolesMapping.length;i++)
                    {
                        if(_oAuthorizationRolesMapping[i].OperationTypeST == sOperationType && _oAuthorizationRolesMapping[i].ModuleNameST == sModuleName)
                            return  true;
                    }
                    return false;
                }
            }

            $("#btnShowDetail").click(function(){
                debugger;
                var oFNOrderUpdateStatus = $('#tblFNOrderUpdateStatuss').datagrid('getSelected');
           
                if(oFNOrderUpdateStatus==null || oFNOrderUpdateStatus.FSCDID<=0)
                {
                    alert("Please Select a row!");
                    return;
                }
            
                $('#txtDispo').data('Dispo',oFNOrderUpdateStatus.ExeNo);
                $('#txtGarment').data('GarmentName',oFNOrderUpdateStatus.ContractorName);
                $('#txtConstruction').data('Construction',oFNOrderUpdateStatus.Construction);
           
                var oFNBatchQCDetail={
                    FSCDID : parseInt(oFNOrderUpdateStatus.FSCDetailID),
                }
                $.ajax({
                    type: "POST",
                    dataType: "json",
                    url :  _sBaseAddress+ "/RptExecutionOrderUpdateStatus/GetFNBatchQCDetail",
                    traditional: true,
                    data:  JSON.stringify(oFNBatchQCDetail),
                    contentType: "application/json; charset=utf-8",
                    success: function (data)
                    {
                        debugger;
                        _oFNBatchQCDetail = jQuery.parseJSON(data);
                        if (_oFNBatchQCDetail.length>0)
                        {
                            RefreshConsumption();
                            DynamicRefreshListForMultipleSelection(_oFNBatchQCDetail,"tblFNBatchQCDetail");
                            $.icsMakeFooterColumn('tblFNBatchQCDetail',['LotNo','Qty','QtyDC','Balance','QtyExe','QtyRC']);
                        }
                        else
                        {
                            DynamicRefreshListForMultipleSelection([],'tblFNBatchQCDetail');
                        }
                    },
                    error: function (xhr, status, error) {
                        alert(error);
                    }
                });
                $("#winFNBatchQCDetail").icsWindow('open',"Batch Roll information");
            });
            $("#btnFNBatchQCDetailClose").click(function(){
                $("#winFNBatchQCDetail").icsWindow('close');
            })

            function RefreshConsumption(){   
                var val = $('#txtConstruction').data('Construction');
                $('#txtDispo').val($('#txtDispo').data('Dispo'));
                $('#txtGarment').val($('#txtGarment').data('GarmentName'));
                $('#txtConstruction').val($('#txtConstruction').data('Construction'));
            }

            $('#btnPrint').click(function(){
          
                var oFNOrderUpdateStatus = $('#tblFNOrderUpdateStatuss').datagrid('getSelected');
                if(oFNOrderUpdateStatus==null || oFNOrderUpdateStatus.FSCDetailID<=0)
                {
                    alert("Please Select a item from list!");
                    return;
                }
                window.open( _sBaseAddress+ "/RptExecutionOrderUpdateStatus/PrintStockLedger?nID=" + oFNOrderUpdateStatus.FSCDetailID, "_blank");
            });

            var editIndex = undefined;
            function endEditing(){
                if (editIndex == undefined){return true}
                if ($('#tblFNBatchQCDetail').datagrid('validateRow', editIndex)){
                    $('#tblFNBatchQCDetail').datagrid('endEdit', editIndex);
                    $('#tblFNBatchQCDetail').datagrid('selectRow',editIndex);
                    var oFNBatchQCDetail=$('#tblFNBatchQCDetail').datagrid('getSelected');
           
                    editIndex = undefined;
                    return true;
                }
                else
                {
                    return false;
                }
            }
            function onClickRow(index){
                if (editIndex != index){
                    if (endEditing())
                    {
                        $('#tblFNBatchQCDetail').datagrid('selectRow', index).datagrid('beginEdit', index);
                        $.icsMakeFooterColumn('tblFNBatchQCDetail',['LotNo','Qty','QtyDC','Balance','QtyExe','QtyRC']);
                        editIndex = index;
                    }
                    else
                    {
                        $('#tblFNBatchQCDetail').datagrid('selectRow', editIndex);
                    }
                }
            }
     
            $('#btnExcessQtyUpdate').click(function (e) {
        
                var oFNBatchQCDetails=$("#tblFNBatchQCDetail").datagrid("getChecked");
                debugger;
                if (oFNBatchQCDetails.length==0) {
                    alert("Please check minimum one item!");
                    return false;
                }
                var nLength = oFNBatchQCDetails.length;
                endEditing();
                var nSelectedIndex = 0;
                var indexLists = [];
                for (i = 0; i < oFNBatchQCDetails.length; ++i) {

                    if (oFNBatchQCDetails[i].QtyExe<=0) {
                        alert("Please entry Excess Qty:!!." + "  No:" + oFNBatchQCDetails[i].LotNo + ".");
                        return;
                    }
                    
                    if ((oFNBatchQCDetails[i].Qty+oFNBatchQCDetails[i].QtyRC-oFNBatchQCDetails[i].QtyDC)<oFNBatchQCDetails[i].QtyExe) {
                        alert("You exced your limit:!!." + "  No:" + oFNBatchQCDetails[i].LotNo + ".");
                        return;
                    }
                    nSelectedIndex = $('#tblFNBatchQCDetail').datagrid('getRowIndex', oFNBatchQCDetails[i]);
                    indexLists.push(nSelectedIndex);
                }

                if (!confirm("Confirm to send this qty as Excess?")) return false;

                $.ajax({
                    type: "POST",
                    dataType: "json",
                    url: _sBaseAddress + "/FNBatch/ExcessQtyUpdate",
                    traditional: true,
                    data: JSON.stringify(oFNBatchQCDetails),
                    contentType: "application/json; charset=utf-8",
                    success: function (data) {
                        oFNBatchQCDetails = jQuery.parseJSON(data);

                        if (oFNBatchQCDetails[0].ErrorMessage == '' || oFNBatchQCDetails[0].ErrorMessage == null) {
                            for (i = 0; i < oFNBatchQCDetails.length; ++i) {
                                //oFabrics[i].IsOparate=-1;
                                $('#tblFNBatchQCDetail').datagrid('updateRow', { index: indexLists[i], row: oFNBatchQCDetails[i] });
                                $('#tblFNBatchQCDetail').datagrid('selectRow', indexLists[i]);
                            }
                            alert("Data Save Successfully");

                        }
                        else {
                            alert(oFNBatchQCDetails[0].ErrorMessage);
                        }
                    },
                    error: function (xhr, status, error) {
                        alert(xhr + '~' + status + '~' + error);
                    }
                });
            });
        
            $('#btnStatement').click(function(){
                var oFNOrderUpdateStatus = $('#tblFNOrderUpdateStatuss').datagrid('getSelected');
                if(oFNOrderUpdateStatus==null || oFNOrderUpdateStatus.FSCDetailID<=0)
                {
                    alert("Please Select a item from list!");
                    return;
                }
                window.open( _sBaseAddress+ "/RptExecutionOrderUpdateStatus/PrintStatement?nFSCDID=" + oFNOrderUpdateStatus.FSCDetailID + "&nBUID="+sessionStorage.getItem("BUID"), "_blank");
            });

</script>
