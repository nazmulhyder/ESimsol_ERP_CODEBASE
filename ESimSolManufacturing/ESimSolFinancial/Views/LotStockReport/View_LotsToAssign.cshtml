@model IEnumerable<ESimSol.BusinessObjects.ReportingObject.LotStockReport>
    @{
        ViewBag.Title = "Lot Assigning";
    }

    <div ng-app="LotStockApp" class="form-horizontal menuMainCollectionTable" style="height:90%">
        <div ng-controller="LotStockCntrl" style="height:90%">
            <div class="ui-grid-top-panel">
                <div class="container">
                    <div class="form-inline">
                        <label>BU :</label>
                        <div class="input-group">
                            <select id="cboUnit" ng-model="BusinessUnitID" style="width:120px;" ng-options="obj.BusinessUnitID as obj.ShortName for obj in BusinessUnits" ng-disabled="ExportBusinessUnitID > 0" class="form-control">
                                <option value="">--Select One--</option>
                            </select>
                        </div>
                        <label>  Store :</label>
                        <div class="input-group">
                            <input id="txtStore" type="text" class="form-control" ng-keydown="PickStore()" style="width:120px" ng-model="IssueStore" disabled>
                            <span class="input-group-addon"><button class="btn-group-lg btn-primary" ng-click="PickStore()">PICK</button></span>
                        </div>
                        <input id="txtLotNo" type="text" class="form-control" placeholder="Type Lot No & Press Enter" ng-disabled="disabled" ng-keydown="SearchKeyDownLot($event)" style="width:100px" ng-model="txtLotNo" disabled>
                        <input id="txtDispoNo" type="text" class="form-control" placeholder="Type Dispo No & Press Enter" ng-disabled="disabled" ng-keydown="SearchKeyDownDispo($event)" style="width:100px" ng-model="txtDispoNo" disabled>
                        @*<button type="button" class="btn btn-sm btn-primary" aria-label="Left Align" ng-click="RefreshAll()"> <span class="glyphicon glyphicon-refresh" aria-hidden="true"></span> Refresh</button>*@
                        @*<button type="button" class="btn btn-primary btn-sm" aria-label="Left Align" ng-click="AdvanceSearch()"><span class="glyphicon glyphicon-search" aria-hidden="true"> Advance</span></button>*@
                        <button type="button" class="btn btn-sm btn-primary" aria-label="Left Align" ng-click="AssignToOrder()"> <span class="glyphicon glyphicon-plus" aria-hidden="true"> Assign</span></button>
                        <button type="button" class="btn btn-sm btn-primary" aria-label="Left Align" ng-click="printView(1)"> <span class="glyphicon glyphicon-print" aria-hidden="true"> Preview</span></button>
                        <button type="button" class="btn btn-sm btn-primary" aria-label="Left Align" ng-click="printViewTwo(1)"> <span class="glyphicon glyphicon-print" aria-hidden="true"> Preview(All)</span></button>
                        <button type="button" class="btn btn-sm btn-primary" aria-label="Left Align" ng-click="printView_Report()"> <span class="glyphicon glyphicon-print" aria-hidden="true"> Preview(Report)</span></button>
                        <button type="button" class="btn btn-sm btn-success" aria-label="Left Align" ng-click="PrintExcelSingle(1)"> <span class="glyphicon glyphicon-print" aria-hidden="true"> XLs</span></button>
                    </div>
                </div>
            </div>
            <section>
                <ul class="nav nav-tabs" style="background:#d6dbdf; color:white;">
                    <li>
                        <a href="" ng-click="SetTab(1)" style="color:black;">Detail View</a>
                    </li>
                    <li>
                        <a href="" ng-click="SetTab(2)" style="color:black;">Product View</a>
                    </li>
                </ul>

                <div ng-if="IsSet==1" style="height:90%">
                    <div style="height:480px" ui-grid="gridOptionsDetail" ui-grid-cellnav ui-grid-pinning ui-grid-selection ui-grid-resize-columns ui-grid-key-nav class="grid-angular ui-grid-selectable"></div>
                </div>
                <div ng-if="IsSet==2" style="height:90%">
                    <div style="height:480px"  ui-grid="gridOptionsProduct" ui-grid-pinning ui-grid-selection ui-grid-resize-columns ui-grid-key-nav class="grid-angular ui-grid-selectable"></div>
                </div>
            </section>
        </div>
    </div>

    <style type="text/css">
        .form-control {
            height: 26px;
            padding: 0px 6px;
            font-size: 12px;
        }

        .grid-angular {
            height: 500px;
            width: 99%;
        }

        .btn-sm {
            padding: 3px 10px;
        }

        .ui-grid-top-panel .btn-sm, .input-group-addon {
            padding: 3px 10px;
        }
    </style>

    <script type="text/javascript">
    _sBaseAddress =@Html.Raw( new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(HttpContext.Current.Session[SessionInfo.BaseAddress]));
    var _oLotStockLists =@Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(Model));
    var _nBUID = @Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(ViewBag.BUID));
    var oBusinessUnits =@Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(ViewBag.BusinessUnits));
    var oCompareOperators =@Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(ViewBag.CompareOperators));

    sessionStorage.setItem('BUID',_nBUID);
    var  LotStockApp = angular.module('LotStockApp', ['ngAnimate','ui.bootstrap','ui.grid', 'ui.grid.pinning','ui.grid.selection','ui.grid.resizeColumns','ms.service']);
    LotStockApp.controller('LotStockCntrl', function ($scope,$http,$uibModal,$log,uiGridConstants,msModal,userSession,icsMethod,advanceSearch)
    {
        $scope.BusinessUnits=oBusinessUnits;
        $scope.BusinessUnitID=_nBUID;
        $scope.ExportBusinessUnitID=_nBUID; //ForDisable CBO_BusinessUnit
        $scope.WorkingUnitIds=sessionStorage.getItem("WorkingUnitIds");
        if($scope.WorkingUnitIds!=null && $scope.WorkingUnitIds.length>0)
            $scope.IssueStore=" "+$scope.WorkingUnitIds.length+" Stores Selected ";

        var oDetailColumns = [];
        var oColumn = { name: '#', width:'3%', cellTemplate: '<div style="padding-top:5px;"><span>{{grid.renderContainers.body.visibleRowCache.indexOf(row)+1}}</span></div>',cellClass: 'text-center', enableCellEdit: false, enableSorting:false, enableColumnResizing:false, enableColumnMenu:false,pinnedLeft:true};oDetailColumns.push(oColumn);
        oColumn=    { field:'ProductCode', name: 'Code', width:'8%',  cellClass: 'text-left',pinnedLeft:true };oDetailColumns.push(oColumn);
        oColumn = { field: 'ProductName', name: 'Yarn Type', width: '17%' ,  cellClass: 'text-left',pinnedLeft:true };oDetailColumns.push(oColumn);
        oColumn = { field: 'LotNo', name: 'Lot No', width: '10%' ,  cellClass: 'text-left' };oDetailColumns.push(oColumn);
        oColumn = { field: 'Qty_Total', name: 'Total Qty', width: '10%' ,  cellClass: 'text-right', cellFilter: 'number: 2', aggregationType: uiGridConstants.aggregationTypes.sum, aggregationHideLabel: true, footerCellFilter: 'number:2', footerCellClass: 'text-right'  };oDetailColumns.push(oColumn);
        oColumn = { field: 'QtyAssign', name: 'Assign Lot', width: '10%' ,  cellClass: 'text-right', cellFilter: 'number: 2', aggregationType: uiGridConstants.aggregationTypes.sum, aggregationHideLabel: true, footerCellFilter: 'number:2', footerCellClass: 'text-right'  };oDetailColumns.push(oColumn);
        oColumn = { field: 'QtyTr', name: 'Transfer uuu Out', width: '10%' ,  cellClass: 'text-right', cellFilter: 'number: 2', aggregationType: uiGridConstants.aggregationTypes.sum, aggregationHideLabel: true, footerCellFilter: 'number:2', footerCellClass: 'text-right'  };oDetailColumns.push(oColumn);
        oColumn = { field: 'Balance', name: 'Balance', width: '10%' ,  cellClass: 'text-right', cellFilter: 'number: 2', aggregationType: uiGridConstants.aggregationTypes.sum, aggregationHideLabel: true, footerCellFilter: 'number:2', footerCellClass: 'text-right'  };oDetailColumns.push(oColumn);
        oColumn = { field: 'ContractorName', name: 'Supplier', width: '14%' ,  cellClass: 'text-left' };oDetailColumns.push(oColumn);
        oColumn = { field: 'LCNo', name: 'L/C No', width: '10%' ,  cellClass: 'text-left' };oDetailColumns.push(oColumn);
        oColumn = { field: 'CategoryName', name: 'Category', width: '10%' ,  cellClass: 'text-left',pinnedLeft:true };oDetailColumns.push(oColumn);
        oColumn = { field: 'OperationUnitName', name: 'Store', width: '12%' ,  cellClass: 'text-left' };oDetailColumns.push(oColumn);
        oColumn = { field: 'InvoiceNo', name: 'Invoice No', width: '10%' ,  cellClass: 'text-left' };oDetailColumns.push(oColumn);
        oColumn = { field: 'ProductName_Base', name: 'Base Product', width: '10%' ,  cellClass: 'text-left',pinnedLeft:true };oDetailColumns.push(oColumn);

        var oLotStockReports=userSession.getData('LotStockList');
        $scope.gridOptionsDetail ={
            enableFullRowSelection: true,
            enableRowHeaderSelection: false,
            multiSelect: true,
            enableColumnResizing: true,
            showColumnFooter: true,
            enableHorizontalScrollbar : 2,
            enableVerticalScrollbar : 2,
            columnDefs: oDetailColumns,
            data:oLotStockReports,
            onRegisterApi:function(gridApi) {
                $scope.gridApi = gridApi;
                $scope.gridApi = gridApi;
                $scope.gridApi.selection.clearSelectedRows();
                $scope.gridApi.grid.modifyRows(oLotStockReports);
                $scope.gridApi.selection.selectRow(oLotStockReports[userSession.getRowIndex()]);

                //var grid = $scope.gridOptionsDetail.ngGrid;
                //grid.$viewport.scrollTop(rowItem.offsetTop - (grid.config.rowHeight * 2));
                //angular.forEach($scope.myData, function(data, index){
                //    $scope.gridOptionsDetail.selectRow(index, false);
                //});

                userSession.clear();
                debugger;
                //$scope.gridApi.cellNav.on.navigate($scope,function(newRowCol, oldRowCol)
                //{
                //    $scope.gridApi.selection.selectRow(newRowCol.row.entity);
                //})
            }
        };

        var oProductColumns = [];
        var oColumn = { name: '#', width:'3%', cellTemplate: '<div style="padding-top:5px;"><span>{{grid.renderContainers.body.visibleRowCache.indexOf(row)+1}}</span></div>',cellClass: 'text-center', enableCellEdit: false, enableSorting:false, enableColumnResizing:false, enableColumnMenu:false,pinnedLeft:true};oProductColumns.push(oColumn);
        oColumn =  { field:'ProductCode', name: 'Code', width:'10%',  cellClass: 'text-left',pinnedLeft:true };oProductColumns.push(oColumn);
        oColumn = { field: 'CategoryName', name: 'Category', width: '10%' ,  cellClass: 'text-left',pinnedLeft:true };oProductColumns.push(oColumn);
        oColumn = { field: 'ProductName_Base', name: 'Base Product', width: '12%' ,  cellClass: 'text-left',pinnedLeft:true };oProductColumns.push(oColumn);
        oColumn = { field: 'ProductName', name: 'Product', width: '20%' ,  cellClass: 'text-left',pinnedLeft:true };oProductColumns.push(oColumn);
        oColumn = { field: 'Qty_Total', name: 'Total Qty', width: '10%' ,  cellClass: 'text-right', cellFilter: 'number: 2', aggregationType: uiGridConstants.aggregationTypes.sum, aggregationHideLabel: true, footerCellFilter: 'number:2', footerCellClass: 'text-right' };oProductColumns.push(oColumn);
        oColumn = { field: 'Balance', name: 'Balance', width: '10%' ,  cellClass: 'text-right', cellFilter: 'number: 2', aggregationType: uiGridConstants.aggregationTypes.sum, aggregationHideLabel: true, footerCellFilter: 'number:2', footerCellClass: 'text-right'};oProductColumns.push(oColumn);
        oColumn = { field: 'OperationUnitName', name: 'Store', width: '10%' ,  cellClass: 'text-left'};oProductColumns.push(oColumn);

        $scope.gridOptionsProduct ={
            enableFullRowSelection: true,
            enableRowHeaderSelection: false,
            enableColumnResizing: true,
            showColumnFooter: true,
            enableSelectAll: false,
            multiSelect:true,
            //enableHorizontalScrollbar : 2,
            //enableVerticalScrollbar : 2,
            columnDefs: oProductColumns,
            data:[],
            onRegisterApi:function(gridApi) {
                $scope.gridProductApi = gridApi;
            }
        };

        $scope.SearchKeyDownLot = function (e){
            //debugger;
            var code = (e.keyCode ? e.keyCode : e.which);
            if (code == 13)
            {
                var sOrderRefNo=$scope.txtLotNo;
                var txtLotNo = $.trim(sOrderRefNo);
                if(txtLotNo=="" || txtLotNo==null)
                {
                    alert("Type Lot No and Press Enter");
                    return;
                }

                //if($scope.WorkingUnitIds==null || $scope.WorkingUnitIds=='')
                //{
                //    alert("Please Pick Store!!");
                //    angular.element('#txtStore').trigger('focus');
                //    return;
                //}
                $scope.oLotStockReport= {
                    SearchingCriteria: $scope.WorkingUnitIds,
                    BUID:$scope.BusinessUnitID,
                    LotNo:txtLotNo
                }
                debugger;
                $http.post(_sBaseAddress + '/LotStockReport/GetsAll_LotStockReport',JSON.stringify($scope.oLotStockReport)).then(
                      function (response) {
                          debugger;
                          $scope.results = response.data;
                          if ($scope.results.Item1.length > 0 && $scope.results.Item1[0].ProductID > 0) {
                              $scope.gridOptionsDetail.data=$scope.results.Item1;
                              $scope.gridOptionsProduct.data=$scope.results.Item2;
                          }
                          else
                          {
                              //alert($scope.results.Item1[0].ErrorMessage);
                              msModal.Message({ headerTitle: '', bodyText: 'No Data Found !!', sucessText: ' Yes', cancelText: ' Close', feedbackType: false, autoClose: false });
                              return;
                          }
                      },
                      function (response) { alert(jQuery.parseJSON(response.data)[0].ErrorMessage); }
                );
            }
        };
        $scope.SearchKeyDownDispo = function (e){
            //debugger;
            var code = (e.keyCode ? e.keyCode : e.which);
            if (code == 13)
            {
                var sOrderRefNo=$scope.txtDispoNo;
                var txtDispoNo = $.trim(sOrderRefNo);
                if(txtDispoNo=="" || txtDispoNo==null)
                {
                    alert("Type Dispo No and Press Enter");
                    return;
                }

                $scope.oLotStockReport= {
                    SearchingCriteria: $scope.WorkingUnitIds,
                    BUID:$scope.BusinessUnitID,
                    OrderNo:txtDispoNo
                }
                debugger;
                $http.post(_sBaseAddress + '/LotStockReport/AdvSearch_Assign',JSON.stringify($scope.oLotStockReport)).then(
                      function (response) {
                          debugger;
                          $scope.results = response.data;
                          if ($scope.results.Item1.length > 0 && $scope.results.Item1[0].ProductID > 0) {
                              $scope.gridOptionsDetail.data=$scope.results.Item1;
                              $scope.gridOptionsProduct.data=$scope.results.Item2;
                          }
                          else
                          {
                              //alert($scope.results.Item1[0].ErrorMessage);
                              msModal.Message({ headerTitle: '', bodyText: 'No Data Found !!', sucessText: ' Yes', cancelText: ' Close', feedbackType: false, autoClose: false });
                              return;
                          }
                      },
                      function (response) { alert(jQuery.parseJSON(response.data)[0].ErrorMessage); }
                );
            }
        };
        
        $scope.PickStore= function ()
        {
            var oLotStockReport= {
                BUID:$scope.BusinessUnitID
            }
            var config = { headers: { 'Content-Type': 'application/x-www-form-urlencoded;charset=utf-8;' } };
            $http.post(_sBaseAddress+'/LotStockReport/GetsIssueStore_Permission',$.param(oLotStockReport), config).then(
                                function (response)
                                {
                                    debugger;
                                    var oColumns = [];
                                    var oColumn = { field: 'OperationUnitName', name: 'Store',width: '30%'  };oColumns.push(oColumn);
                                    oColumn = { field: 'WorkingUnitNameWithBU', name: 'Unit',width: '70%', enableSorting: false  };oColumns.push(oColumn);
                                    var results=response.data;
                                    var modalObj={
                                        size:'md',
                                        modalcontroller:'ModalCommonListCtrl',
                                        appcontroller:'LotStockCntrl',
                                        objs:results,
                                        multiSelect:true,
                                        pickertitle:'Applicant List',
                                        searchingbyfieldName:'Name',
                                        columns:oColumns
                                    }
                                    var modalInstance=msModal.Instance(modalObj);
                                    modalInstance.result.then(function (result)
                                    {
                                        debugger;
                                        if(result.length>0)
                                        {
                                            $scope.WorkingUnitIds=result[0].WorkingUnitID;
                                            $scope.IssueStore=result[0].OperationUnitName;
                                            for(var i=1;i<result.length;i++)
                                            {
                                                $scope.WorkingUnitIds+=","+result[i].WorkingUnitID;
                                                $scope.IssueStore=" "+(i+1)+" Stores Selected "
                                            }
                                            $scope.RefreshAll();
                                        }
                                    }, function () {
                                        $log.info('Modal dismissed at: ' + new Date());
                                    });
                                },
                                  function (response) { alert(jQuery.parseJSON(response.data).Message);}
                            );

        };
        $scope.RefreshAll = function ()
        {
            if($scope.WorkingUnitIds==null || $scope.WorkingUnitIds=='')
            {
                alert("Please Pick Store!!");
                angular.element('#txtStore').trigger('focus');
                return;
            }

            $scope.oLotStockReport= {
                SearchingCriteria: $scope.WorkingUnitIds,
                BUID:$scope.BusinessUnitID
            }
            debugger;
            $http.post(_sBaseAddress + '/LotStockReport/GetsAll_LotStockReport',JSON.stringify($scope.oLotStockReport)).then(
                  function (response) {
                      debugger;
                      $scope.results = response.data;
                      if ($scope.results.Item1.length > 0 && $scope.results.Item1[0].ProductID > 0) {
                          $scope.gridOptionsDetail.data=$scope.results.Item1;
                          $scope.gridOptionsProduct.data=$scope.results.Item2;
                      }
                      else {
                          alert($scope.results.Item1[0].ErrorMessage);
                          msModal.Message({ headerTitle: '', bodyText: 'No Data Found !!', sucessText: ' Yes', cancelText: ' Close', feedbackType: false, autoClose: false });
                          return;
                      }
                  },
                  function (response) { alert(jQuery.parseJSON(response.data)[0].ErrorMessage); }
            );
        };
        $scope.printView = function(nLayout)
        {
            var oLotStocks = $scope.gridApi.selection.getSelectedRows();
            if(oLotStocks==null || oLotStocks.length<=0)
            {
                alert("Please Select at least an item !!");
                return;
            }
            debugger;

            var sParam= oLotStocks[0].LotID;
            var sLCNo= oLotStocks[0].LCNo;
            for(var i=1; i<oLotStocks.length;i++)
            {
                sParam+= ","+oLotStocks[i].LotID;
                sLCNo+= "~"+oLotStocks[i].LCNo;
            }

            window.open(_sBaseAddress + '/LotStockReport/PrintOrderWise?sParam='+ sParam+"&sLCNo="+sLCNo+"&nBUID="+$scope.BusinessUnitID, "_blank");
        };
        $scope.printView_Report = function()
        {
            var oLotStocks = $scope.gridApi.selection.getSelectedRows();
            if(oLotStocks==null || oLotStocks.length<=0)
            {
                alert("Please Select at least an item !!");
                return;
            }
            debugger;

            var sParam= oLotStocks[0].LotID;
            var sLCNo= oLotStocks[0].LCNo;
            for(var i=1; i<oLotStocks.length;i++)
            {
                sParam+= ","+oLotStocks[i].LotID;
             
            }

            window.open(_sBaseAddress + '/LotStockReport/PrintRawLot_Order_Req_RS?sParam='+ sParam+"&buid="+$scope.BusinessUnitID, "_blank");
        };
        $scope.PrintExcelSingle = function(nLayout)
        {
            var oLotStocks = $scope.gridApi.selection.getSelectedRows();
            if(oLotStocks==null || oLotStocks.length<=0)
            {
                alert("Please Select at least an item !!");
                return;
            }
            debugger;

            var sParam= oLotStocks[0].LotID;
            for(var i=1; i<oLotStocks.length;i++)
            {
                sParam+= ","+oLotStocks[i].LotID;
            }

            window.open(_sBaseAddress + '/LotStockReport/PrintExcelSingle?sParam='+ sParam, "_blank");
        };

        $scope.AdvanceSearch=function()
        {
            //oColumns1 = [];
            //var oColumn1 = { field: 'Name', name: 'Buyer Name',width: '70%', enableSorting: false  };oColumns1.push(oColumn1);
            //oColumn1 = { field: 'Address', name: 'Address',width: '30%', enableSorting: false  };oColumns1.push(oColumn1);

            //var paramObj_Buyer={
            //    obj:{Params: '2,3' + '~' +'@@ContractorID'+'~'+_nBUID},
            //    objName:'Params',
            //    objField:'ContractorID',
            //    url:_sBaseAddress+'/Contractor/ContractorSearchByNameType',
            //    title:'Buyer List',
            //    multiSelect:true,
            //    columns:oColumns1
            //}

            //var oColumns = [];
            //var oColumn = { field: 'ModelNo', name: 'ModelNo',width: '30%'  };oColumns.push(oColumn);
            //oColumn = { field: 'CategoryName', name: 'CategoryName',width: '40%', enableSorting: false  };oColumns.push(oColumn);

            //var paramObj_Model={
            //    obj:{ModelNo: '@@VehicleModelID'},
            //    objName:'ModelNo',
            //    url:_sBaseAddress+'/VehicleModel/GetVehicleModels',
            //    title:'Model List',
            //    multiSelect:true,
            //    columns:oColumns
            //}

            //var oStatusList=oDyeingOrderFabricDetailStatusList;
            var oElementList = [
                                { DisplayName: "Dispo No",  BOField: "OrderNo",      InputType: 'text' },
                                ////{ DisplayName: "OrderType",    BOField: "OrderType",       InputType: 'select', OptionList: $scope.OrderTypes},
                                //{ DisplayName: "Buyer Name",       BOField: "BuyerName",           InputType: 'picker', PickerObject:paramObj_Buyer },
                                //{ DisplayName: "Customer Name",       BOField: "CustomerName",           InputType: 'picker', PickerObject:paramObj_Buyer },
                                //{ DisplayName: "Model No",  BOField: "VehicleModelID",   InputType: 'picker', PickerObject:paramObj_Model }
                                //{ DisplayName: ["Yet To Lot Assign"],  BOField: ["YetToLotAssign"],   InputType: 'bool'},
                                { BOField: 'BUID',   InputType: 'hidden', Value:_nBUID},
                                //{ DisplayName: "SomeType",    BOField: "SomeType",       InputType: 'select', OptionList:[{id:2,Value:"KisuNai"}]},
            ];
            var modalObj={
                size:'md',
                title:"Advance Search",
                url:_sBaseAddress+'/Home/AdvanceSearch',
                CompareOperators:oCompareOperators,
                HtmlElements:oElementList,
                isAdvanceSearch:true, // if TRUE: 'urlAdvanceSearch' has to be defined
                urlAdvanceSearch:_sBaseAddress + '/LotStockReport/AdvSearch_Assign'
            }

            var modalInstance=advanceSearch.Instance(modalObj);
            modalInstance.result.then(function (result)
            {
                console.log(result);
                if ($scope.result.Item1.length > 0 && $scope.result.Item1[0].ProductID > 0) {
                    $scope.gridOptionsDetail.data=$scope.result.Item1;
                    $scope.gridOptionsProduct.data=$scope.result.Item2;
                }
            }, function ()
            {
                $log.info('Modal dismissed at: ' + new Date());
            });
        };
        $scope.printViewTwo = function(nLayout)
        {
            var oLotStock = $scope.gridApi.selection.getSelectedRows()[0];
            if(oLotStock==null || oLotStock.LotID<=0)
            {
                alert("Please Select an item from list");
                return;
            }
            debugger;
            sTemp =oLotStock.LotID+"~"+  $scope.BusinessUnitID;
            window.open(_sBaseAddress + '/LotTraking/PrintStockLotTracking?sTempString='+sTemp+"&nts=1.2", "_blank");
        };

        $scope.printExcel = function(nLayout)
        {
            if($scope.BusinessUnitID<=0)
            {
                alert("Please Select a Unit!!");
                angular.element('#cboUnit').trigger('focus');
                return;
            }
            var  sTemp =  "";
            debugger;
            sTemp =$scope.BusinessUnitID+'~'+$scope.WorkingUnitIds+'~'+0+'~'+$scope.tab;
            window.open(_sBaseAddress + '/LotStockReport/PrintToExcel?sTempString='+sTemp, "_blank");
        };
        $scope.AssignToOrder =  function ()
        {
            debugger;
            var oLotStocks = $scope.gridApi.selection.getSelectedRows();
            if(oLotStocks==null || oLotStocks.length<=0)
            {
                alert("Please Select an item from list");
                return;
            }
            if(oLotStocks.length!=1 || oLotStocks[0].LotID<=0)
            {
                alert("Please Select Only One Item From The List");
                return;
            }

            var oLotStock =oLotStocks[0];
            angular.forEach($scope.gridOptionsDetail.data, function (value, index) {
                if (value.LotID == oLotStock.LotID)
                {
                    sessionStorage.setItem("LotStockList", JSON.stringify($scope.gridOptionsDetail.data));
                    sessionStorage.setItem("SelectedLot", JSON.stringify(oLotStock));
                    sessionStorage.setItem("WorkingUnitIds", $scope.WorkingUnitIds);
                    sessionStorage.setItem("SelectedRowIndex", index);
                    sessionStorage.setItem("LotStockHeader", "View Lot Stock");
                    sessionStorage.setItem("BackLink", window.location.href);
                    debugger;
                    window.location.href =sessionStorage.getItem('BaseAddress')+"/LotStockReport/View_LotToAssignDU?id="+oLotStock.LotID;
                }
            }, $scope.gridOptionsDetail.data);
        }

        $scope.tab = 1;
        $scope.IsSet=1;
        $scope.SetTab = function (tabId)
        {
            $scope.tab = tabId;
            $scope.IsSet=tabId;
        }
    });
    </script>
