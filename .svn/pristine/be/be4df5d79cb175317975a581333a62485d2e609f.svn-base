
<html>
@{
    ViewBag.Title = "Loan List";
}

<body>
    @model IEnumerable <ESimSol.BusinessObjects.Loan>
        <div id="divLoanCollection" class="menuMainCollectionTable">
            <table id="tblLoans" title="Loans List" class="easyui-datagrid" fit="true" fitcolumns="true" rownumbers="true" pagination="true" singleselect="true" autorowheight="false" toolbar="#toolbarBusinessUnit">

                <thead data-options="frozen:true">
                    <tr>
                        <th field="LoanNo" width="11%">Loan No</th>
                        <th field="LoanTypeSt" width="7%" align="center">Loan Type</th>
                        <th field="LoanRefTypeSt" width="6%">Ref Type</th>
                        <th field="LoanRefNo" width="10%">Ref No</th>
                    </tr>
                </thead>
                <thead>
                    <tr>
                        <th field="InterestRate" formatter="formatPrice" width="7%" align="right">Interest(%)</th>
                        <th field="PrincipalAmountSt" width="9%" align="right">Amount</th>
                        <th field="TotalInterestAmountSt" width="8%" align="right">IR Amount</th>
                        <th field="TotalChargeAmountSt" width="8%" align="right">Bank Charge</th>
                        <th field="TotalPaybleAmountSt" width="8%" align="right">Payble Amount</th>
                        <th field="PaidAmountSt" width="8%" align="right">Paid Amount</th>
                        <th field="LoanAmountSt" width="8%" align="right">Remaining Balance</th>
                        <th field="BankName" width="12%">Receive Bank</th>
                        <th field="BankAccNo" width="10%">Account No</th>
                        <th field="LoanStartDateInString" width="7%" align="center">Issue Date</th>
                        <th field="RcvDateInString" width="7%" align="center">Receive Date</th>
                        <th field="FullFileNo" width="7%">File No</th>
                        <th field="ApprovedByName" width="10%">Approve By</th>
                        <th field="ReceivedByName" width="10%">Received By</th>
                        <th field="SettlementByName" width="10%">Settle By</th>
                        <th field="LoanStatusSt" width="10%">Loan Status</th>
                    </tr>
                </thead>
            </table>
            <div id="toolbarBusinessUnit">
                <table>
                    <tr>
                        <td>
                            <input type="text" id="txtSearchByLoanNo" placeholder="Search by LoanNo" style="width:393px" />                            
                            <a id="btnAdvSearch" href="javascript:void(0)" class="easyui-linkbutton easyui-tooltip" iconcls="icon-search" title="Advance Search" plain="true">Adv Search</a>
                            <a id="btnAddLoan" href="javascript:void(0)" class="easyui-linkbutton easyui-tooltip" iconcls="icon-add" title="Add Loan" plain="true">Add</a>
                            <a id="btnEditLoan" href="javascript:void(0)" class="easyui-linkbutton easyui-tooltip" iconcls="icon-edit" title="Edit Loan" plain="true">Edit</a>
                            <a id="btnViewLoan" href="javascript:void(0)" class="easyui-linkbutton easyui-tooltip" iconcls="icon-details" title="View Loan" plain="true">View</a>
                            <a id="btnDelete" href="javascript:void(0)" class="easyui-linkbutton easyui-tooltip" iconcls="icon-remove" title="Delete" plain="true">Delete</a>
                            <a id="btnApproveLoan" href="javascript:void(0)" class="easyui-linkbutton easyui-tooltip" iconcls="icon-approved" title="Approve" plain="true">Approve</a>
                            <a id="btnReceiveLoan" href="javascript:void(0)" class="easyui-linkbutton easyui-tooltip" iconcls="icon-receive" title="Settlement" plain="true">Receive</a>
                        </td>
                    </tr>
                    <tr>
                        <td>                            
                            <select id="cboSrcLoanRefTypeCollection" style="width:100px;"></select>
                            <label id="spanImportOrExportRefNoCollection" style="width:86px; text-align:right">ExportLC :</label>
                            <input type="text" id="txtSearchByImportInvoiceOrExportLC" placeholder="Search by Invoice or ExportLC No" disabled style="width:200px" />
                            <a id="btnSettlementLoan" href="javascript:void(0)" class="easyui-linkbutton easyui-tooltip" iconcls="icon-edit" title="Settlement" plain="true">Settlement</a>
                            <a id="btnTagLCLoan" href="javascript:void(0)" class="easyui-linkbutton easyui-tooltip" iconcls="icon-edit" title="Settlement" plain="true"> Tag LC(PC)</a>
                            <a id="btnUpdateStmlStartDateLoan" href="javascript:void(0)" class="easyui-linkbutton easyui-tooltip" iconcls="icon-edit" title="Edit Loan" plain="true">Update Stml Start Date</a>
                            <a id="btnPrint" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-print" plain="true">Print List</a>
                            <a id="btnPrintPreview" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-print" plain="true">Preview</a>
                        </td>
                    </tr>
                </table>
            </div>

            <div id="winAdvanceSearch" class="easyui-window" title="Advance Search" style="width:570px;height:570px;padding:2px;" data-options="modal:true,closed:true,collapsible:false,minimizable:false,maximizable:false,closable:false">
                <div>
                    <fieldset>
                        <legend style="font-weight:bold"> Searching Criteria : </legend>
                        <table border="0" cellspacing="4" cellpadding="4" style="font-size:11px; font-weight:bold">
                            <tr>
                                <td style="width:117px; text-align:right">
                                    Loan No :
                                </td>
                                <td style="width:170px">
                                    <input type="text" style="width: 90%;" id="txtSrcLoanNo" />
                                </td>
                                <td style="width:117px; text-align:right">
                                    Loan Type :
                                </td>
                                <td style="width:170px">
                                    <select id="cboSrcLoanType" style="width: 90%"></select>
                                </td>
                            </tr>
                            <tr>
                                <td style="width:117px; text-align:right">
                                    Rcv Bank A/C :
                                </td>
                                <td style="width:170px" colspan="1">
                                    <select id="cboSrcBankAC" style="width: 90%"></select>
                                </td>
                                <td style="width:117px; text-align:right">
                                    B Unit :
                                </td>
                                <td style="width:170px">
                                    <select id="cboSrcBUnitType" style="width: 90%"></select>
                                </td>
                            </tr>
                            <tr>
                                <td style="width:117px; text-align:right">
                                    Loan Ref Type :
                                </td>
                                <td style="width:170px">
                                    <select id="cboSrcLoanRefType" style="width: 86%"></select>
                                </td>
                                <td style="width:370px" colspan="2">
                                    <label id="spanImportOrExportRefNo" style="width:86px; text-align:left">ExportLC :</label>
                                    <input type="text" style="width: 143px;" id="txtSrcLoanRefNo" disabled />
                                </td>
                            </tr>

                            <tr>
                                <td style="width:117px; text-align:right">
                                    Loan Amount :
                                </td>
                                <td style="width:520px" colspan="3">
                                    <table border="0" cellpadding="0" cellspacing="0" style="font-size: 12px">
                                        <tr>
                                            <td style="width: 170px; font-size: 12px; text-align: left">
                                                <select id="cboSrcLoanAmount" style="width: 90%"></select>
                                            </td>
                                            <td style="width: 10px; font-size: 12px"></td>
                                            <td style="width: 151px; font-size: 12px">
                                                <input id="txtSrcLoanAmountStart" style="width: 90%" />
                                            </td>
                                            <td style="width: 10px; font-size: 12px">
                                                To
                                            </td>
                                            <td style="width: 151px; font-size: 12px">
                                                <input id="txtSrcLoanAmountEnd" style="width: 90%" />
                                            </td>
                                        </tr>
                                    </table>
                                </td>
                            </tr>
                            <tr>
                                <td style="width:117px; text-align:right">
                                    Interest Rate :
                                </td>
                                <td style="width:370px" colspan="3">
                                    <table border="0" cellpadding="0" cellspacing="0" style="font-size: 12px">
                                        <tr>
                                            <td style="width: 170px; font-size: 12px; text-align: left">
                                                <select id="cboSrcInterestRate" style="width: 90%"></select>
                                            </td>
                                            <td style="width: 10px; font-size: 12px"></td>
                                            <td style="width: 151px; font-size: 12px">
                                                <input id="txtSrcInterestRateStart" style="width: 90%" />
                                            </td>
                                            <td style="width: 10px; font-size: 12px">
                                                To
                                            </td>
                                            <td style="width: 151px; font-size: 12px">
                                                <input id="txtSrcInterestRateEnd" style="width: 90%" />
                                            </td>
                                        </tr>
                                    </table>
                                </td>
                            </tr>
                            <tr>
                                <td style="width:117px; text-align:right">
                                    Libor Rate :
                                </td>
                                <td style="width:370px" colspan="3">
                                    <table border="0" cellpadding="0" cellspacing="0" style="font-size: 12px">
                                        <tr>
                                            <td style="width: 170px; font-size: 12px; text-align: left">
                                                <select id="cboSrcLiborRate" style="width: 90%"></select>
                                            </td>
                                            <td style="width: 10px; font-size: 12px"></td>
                                            <td style="width: 151px; font-size: 12px">
                                                <input id="txtSrcLiborRateStart" style="width: 90%" />
                                            </td>
                                            <td style="width: 10px; font-size: 12px">
                                                To
                                            </td>
                                            <td style="width: 151px; font-size: 12px">
                                                <input id="txtSrcLiborRateEnd" style="width: 90%" />
                                            </td>
                                        </tr>
                                    </table>
                                </td>
                            </tr>
                            <tr>
                                <td style="width:117px; text-align:right">
                                    Loan Charge :
                                </td>
                                <td style="width:520px" colspan="3">
                                    <table border="0" cellpadding="0" cellspacing="0" style="font-size: 12px">
                                        <tr>
                                            <td style="width: 170px; font-size: 12px; text-align: left">
                                                <select id="cboSrcLoanCharge" style="width: 90%"></select>
                                            </td>
                                            <td style="width: 10px; font-size: 12px"></td>
                                            <td style="width: 151px; font-size: 12px">
                                                <input id="txtSrcLoanChargeStart" style="width: 90%" />
                                            </td>
                                            <td style="width: 10px; font-size: 12px">
                                                To
                                            </td>
                                            <td style="width: 151px; font-size: 12px">
                                                <input id="txtSrcLoanChargeEnd" style="width: 90%" />
                                            </td>
                                        </tr>
                                    </table>
                                </td>
                            </tr>
                            <tr>
                                <td style="width:117px; text-align:right">
                                    Total Interest :
                                </td>
                                <td style="width:520px" colspan="3">
                                    <table border="0" cellpadding="0" cellspacing="0" style="font-size: 12px">
                                        <tr>
                                            <td style="width: 170px; font-size: 12px; text-align: left">
                                                <select id="cboSrcTotalInterest" style="width: 90%"></select>
                                            </td>
                                            <td style="width: 10px; font-size: 12px"></td>
                                            <td style="width: 151px; font-size: 12px">
                                                <input id="txtSrcTotalInterestStart" style="width: 90%" />
                                            </td>
                                            <td style="width: 10px; font-size: 12px">
                                                To
                                            </td>
                                            <td style="width: 151px; font-size: 12px">
                                                <input id="txtSrcTotalInterestEnd" style="width: 90%" />
                                            </td>
                                        </tr>
                                    </table>
                                </td>
                            </tr>
                            <tr>
                                <td style="width:117px; text-align:right">
                                    Settlement Amt :
                                </td>
                                <td style="width:520px" colspan="3">
                                    <table border="0" cellpadding="0" cellspacing="0" style="font-size: 12px">
                                        <tr>
                                            <td style="width: 170px; font-size: 12px; text-align: left">
                                                <select id="cboSrcSettlementAmt" style="width: 90%"></select>
                                            </td>
                                            <td style="width: 10px; font-size: 12px"></td>
                                            <td style="width: 151px; font-size: 12px">
                                                <input id="txtSrcTotalSettlementAmtStart" style="width: 90%" />
                                            </td>
                                            <td style="width: 10px; font-size: 12px">
                                                To
                                            </td>
                                            <td style="width: 151px; font-size: 12px">
                                                <input id="txtSrcSettlementAmtEnd" style="width: 90%" />
                                            </td>
                                        </tr>
                                    </table>
                                </td>
                            </tr>
                            <tr>
                                <td style="width:117px; text-align:right">
                                    Issue Date :
                                </td>
                                <td style="width:370px" colspan="3">
                                    <table border="0" cellpadding="0" cellspacing="0" style="font-size: 12px">
                                        <tr>
                                            <td style="width: 135px; font-size: 12px; text-align: left">
                                                <select id="cboSrcLoanIssueDate" style="width: 90%"></select>
                                            </td>
                                            <td style="width: 10px; font-size: 12px"></td>
                                            <td style="width:30%; font-size: 12px">
                                                <input id="txtSrcLoanIssueStartDate" type="text" style="width: 100px;" class="easyui-datebox" disabled="disabled" data-options="formatter:icsdateformat,parser:icsdateparser" />
                                            </td>
                                            <td style="width: 10px; font-size: 12px">
                                                To
                                            </td>
                                            <td style="width:30%; font-size: 12px">
                                                <input id="txtSrcLoanIssueEndDate" type="text" style="width: 100px;" class="easyui-datebox" disabled="disabled" data-options="formatter:icsdateformat,parser:icsdateparser" />
                                            </td>
                                        </tr>
                                    </table>
                                </td>
                            </tr>
                            <tr>
                                <td style="width:117px; text-align:right">
                                    Start Date :
                                </td>
                                <td style="width:370px" colspan="3">
                                    <table border="0" cellpadding="0" cellspacing="0" style="font-size: 12px">
                                        <tr>
                                            <td style="width: 135px; font-size: 12px; text-align: left">
                                                <select id="cboSrcLoanStartDate" style="width: 90%"></select>
                                            </td>
                                            <td style="width: 10px; font-size: 12px"></td>
                                            <td style="width:30%; font-size: 12px">
                                                <input id="txtSrcLoanStartStartDate" type="text" style="width: 100px;" class="easyui-datebox" disabled="disabled" data-options="formatter:icsdateformat,parser:icsdateparser" />
                                            </td>
                                            <td style="width: 10px; font-size: 12px">
                                                To
                                            </td>
                                            <td style="width:30%; font-size: 12px">
                                                <input id="txtSrcLoanStartEndDate" type="text" style="width: 100px;" class="easyui-datebox" disabled="disabled" data-options="formatter:icsdateformat,parser:icsdateparser" />
                                            </td>
                                        </tr>
                                    </table>
                                </td>
                            </tr>
                            <tr>
                                <td style="width:117px; text-align:right">
                                    Approx Date :
                                </td>
                                <td style="width:370px" colspan="3">
                                    <table border="0" cellpadding="0" cellspacing="0" style="font-size: 12px">
                                        <tr>
                                            <td style="width: 135px; font-size: 12px; text-align: left">
                                                <select id="cboSrcLoanApproxDate" style="width: 90%"></select>
                                            </td>
                                            <td style="width: 10px; font-size: 12px"></td>
                                            <td style="width:30%; font-size: 12px">
                                                <input id="txtSrcLoanApproxStartDate" type="text" style="width: 100px;" class="easyui-datebox" disabled="disabled" data-options="formatter:icsdateformat,parser:icsdateparser" />
                                            </td>
                                            <td style="width: 10px; font-size: 12px">
                                                To
                                            </td>
                                            <td style="width:30%; font-size: 12px">
                                                <input id="txtSrcLoanApproxEndDate" type="text" style="width: 100px;" class="easyui-datebox" disabled="disabled" data-options="formatter:icsdateformat,parser:icsdateparser" />
                                            </td>
                                        </tr>
                                    </table>
                                </td>
                            </tr>
                            <tr>
                                <td style="width:117px; text-align:right">
                                    Transfer Date :
                                </td>
                                <td style="width:370px" colspan="3">
                                    <table border="0" cellpadding="0" cellspacing="0" style="font-size: 12px">
                                        <tr>
                                            <td style="width: 135px; font-size: 12px; text-align: left">
                                                <select id="cboSrcLoanTransferDate" style="width: 90%"></select>
                                            </td>
                                            <td style="width: 10px; font-size: 12px"></td>
                                            <td style="width:30%; font-size: 12px">
                                                <input id="txtSrcLoanTransferStartDate" type="text" style="width: 100px;" class="easyui-datebox" disabled="disabled" data-options="formatter:icsdateformat,parser:icsdateparser" />
                                            </td>
                                            <td style="width: 10px; font-size: 12px">
                                                To
                                            </td>
                                            <td style="width:30%; font-size: 12px">
                                                <input id="txtSrcLoanTransferEndDate" type="text" style="width: 100px;" class="easyui-datebox" disabled="disabled" data-options="formatter:icsdateformat,parser:icsdateparser" />
                                            </td>
                                        </tr>
                                    </table>
                                </td>
                            </tr>
                            <tr>
                                <td style="width:117px; text-align:right">
                                    Setlement Date :
                                </td>
                                <td style="width:370px" colspan="3">
                                    <table border="0" cellpadding="0" cellspacing="0" style="font-size: 12px">
                                        <tr>
                                            <td style="width: 135px; font-size: 12px; text-align: left">
                                                <select id="cboSrcLoanSettlementDate" style="width: 90%"></select>
                                            </td>
                                            <td style="width: 10px; font-size: 12px"></td>
                                            <td style="width:30%; font-size: 12px">
                                                <input id="txtSrcLoanSettlementStartDate" type="text" style="width: 100px;" class="easyui-datebox" disabled="disabled" data-options="formatter:icsdateformat,parser:icsdateparser" />
                                            </td>
                                            <td style="width: 10px; font-size: 12px">
                                                To
                                            </td>
                                            <td style="width:30%; font-size: 12px">
                                                <input id="txtSrcLoanSettlementEndDate" type="text" style="width: 100px;" class="easyui-datebox" disabled="disabled" data-options="formatter:icsdateformat,parser:icsdateparser" />
                                            </td>
                                        </tr>
                                    </table>
                                </td>
                            </tr>
                        </table>
                    </fieldset>
                </div>
                <fieldset style="width:100%; vertical-align:top;">
                    <legend style="font-weight:bold"> Action : </legend>
                    <table border="0" cellspacing="2" cellpadding="2" style="font-size:11px; font-weight:bold;">
                        <tr>
                            <td style="width:130px;text-align:right">
                                <a id="btnSrcReset" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-reload" plain="true"> Reset</a>
                            </td>
                            <td style="width:408px;text-align:right;">
                                <a id="btnSearch" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-search" plain="true">Search</a>
                                <a id="btnSrcClose" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-cancel" plain="true">Close</a>
                            </td>
                        </tr>
                    </table>
                </fieldset>
            </div>

            <div id="winLoanTagLC" class="easyui-window" title="LC Tag" style="height: 400px; width: 1020px;" data-options="modal:true,closed:true,collapsible:false,minimizable:false,maximizable:false,closable:false">
                <div id="p" style="width:99%; height:100%; padding:1px">
                    <div style="width:100%; height:85%; padding-top:2px">
                        <fieldset style="width:100%; height:100%">
                            <legend>Loan Info:</legend>
                            <table border="0" cellpadding="2" cellspacing="2" style="width:100%">
                                <tr>
                                    <td style="width:10%; text-align:right">File No:</td>
                                    <td style="width:15%">
                                        <input type="text" id="txtTagLCLoanFileNo" style="width:100%; font-weight:bold" disabled="disabled" />
                                    </td>
                                    <td style="width: 10%; text-align: right">Loan No:</td>
                                    <td style="width: 15%">
                                        <input type="text" id="txtTagLCLoanNumber" style="width: 100%; font-weight: bold" disabled="disabled" />
                                    </td>
                                    <td style="width: 10%; text-align: right">Loan Type:</td>
                                    <td style="width: 15%">
                                        <input type="text" id="txtTagLCLoanType" style="width: 100%; font-weight: bold" disabled="disabled" />
                                    </td>
                                    <td style="width: 10%; text-align: right">Issue/Stlmt :</td>
                                    <td style="width: 15%">
                                        <table border="0" cellpadding="0" cellspacing="0">
                                            <tr>
                                                <td style="width:50%">
                                                    <input type="text" id="txtTagLCLoanIssueDate" style="width: 100%; font-weight: bold" disabled="disabled" />
                                                </td>
                                                <td style="width:50%">
                                                    <input type="text" id="txtTagLCApproxStlmtDate" style="width: 100%; font-weight: bold" disabled="disabled" />
                                                </td>
                                            </tr>
                                        </table>
                                    </td>
                                </tr>
                                <tr>
                                    <td style="width:10%; text-align:right">Loan Start DT:</td>
                                    <td style="width:15%">
                                        <input type="text" id="txtTagLCLoanStartDate" style="width: 100%; font-weight: bold" disabled="disabled" />
                                    </td>
                                    <td style="width: 10%; text-align: right">Export LC:</td>
                                    <td style="width: 15%">
                                        <input type="text" id="txtTagLCLoanExportLC" style="width: 100%; font-weight: bold" disabled="disabled" />
                                    </td>
                                    <td style="width: 10%; text-align: right">Loan A/C:</td>
                                    <td style="width: 15%">
                                        <input type="text" id="txtTagLCLoanAccountNo" style="width: 100%; font-weight: bold" disabled="disabled" />
                                    </td>
                                    <td style="width: 10%; text-align: right">Loan Amt:</td>
                                    <td style="width: 15%">
                                        <table border="0" cellpadding="0" cellspacing="0">
                                            <tr>
                                                <td style="width:25%">
                                                    <input type="text" id="txtTagLCLoanAmountCurrency" style="width: 100%; text-align: center; font-weight: bold; " disabled="disabled" />
                                                </td>
                                                <td style="width:75%">
                                                    <input type="text" id="txtTagLCLoanAmount" style="width: 100%; text-align: right; font-weight: bold; " disabled="disabled" />
                                                </td>
                                            </tr>
                                        </table>
                                    </td>
                                </tr>
                                <tr>
                                    <td colspan="8" style="width:100%">
                                        <table style="height:210px; width:100%" id="tblTagLCLoanCharge" title="Loan Charge Details" class="easyui-datagrid" singleselect="true" showfooter="true" toolbar="#toolStlmtLoanCharge" data-options="onClickRow: onClickRow">
                                            <thead>
                                                <tr>
                                                    <th field="ExportLCNo" width="35%">Export LCNo</th>
                                                    <th field="ExportLCCurrencySymbol" width="15%"> LC Curency</th>
                                                    <th field="ExportLCAmount" formatter="formatPrice" width="15%" align="right">LC Amount</th>
                                                    <th formatter="formatPrice" width="15%" align="right" data-options="field:'Amount',align:'right',editor:{type:'numberbox',options:{precision:2}}">Amount</th>
                                                    <th width="15%" align="right" data-options="field:'Remarks',editor:{type:'textbox'}">Remarks</th>
                                                </tr>
                                            </thead>
                                        </table>
                                        <div style="width:100%" id="toolStlmtLoanCharge">

                                            <input type="text" style="width:25%" id="txtWinTagLCExportLC" placeholder="Type LC No & Enter" />

                                            @*<a id="btnStlmtAddCharge" href="javascript:void(0)" class="easyui-linkbutton easyui-tooltip" iconcls="icon-add" plain="true"></a>*@
                                            <a id="btnDeleteLoanExportLC" href="javascript:void(0)" class="easyui-linkbutton easyui-tooltip" iconcls="icon-remove" plain="true"></a>
                                        </div>
                                    </td>

                                </tr>
                            </table>
                        </fieldset>
                    </div>
                    <div style="width:100%; height:15%">
                        <fieldset style="width:100%; height:100%">
                            <legend> Action:</legend>
                            <table border="0" cellpadding="0" cellspacing="0" style="width:100%">
                                <tr style="height:100%">
                                    <td style="width:70%; text-align:left; font-size:12px; font-weight:bold">
                                        <label id="lblStlmtLoanBalance" style="font-size:15px; font-weight:bold; "></label>
                                    </td>
                                    <td style="width:10%; text-align: right; font-size: 12px; font-weight: bold; vertical-align: bottom;">
                                        <a id="btnSaveTagExportLC" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-save" plain="true">Save</a>
                                    </td>
                                    <td style="width:10%; text-align:right; font-size:12px; font-weight:bold; vertical-align:bottom">
                                        <a id="btnWinTagLCCloseLoan" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-cancel" plain="true">Close</a>
                                    </td>
                                </tr>
                            </table>
                        </fieldset>
                    </div>

                </div>
            </div>

            <div id="winStmlDateUpdateWindow" class="easyui-window" title="Stml Date Update" style="height: 350px; width: 400px;" data-options="modal:true,closed:true,collapsible:false,minimizable:false,maximizable:false,closable:false">
                <div id="p" style="width:99%; height:100%; padding:1px">
                    <div style="width:100%; height:85%; padding-top:2px">
                        <fieldset style="width:100%; height:100%">
                            <legend>Loan Info:</legend>
                            <table border="0" cellpadding="2" cellspacing="2" style="width:100%">
                                <tr>
                                    <td style="width:30%; text-align:right">File No:</td>
                                    <td style="width:70%">
                                        <input type="text" id="txtStmlDateUpdateLoanFileNo" style="width:100%; font-weight:bold" disabled="disabled" />
                                    </td>
                                </tr>
                                <tr>
                                    <td style="width: 30%; text-align: right">Loan No:</td>
                                    <td style="width: 70%">
                                        <input type="text" id="txtStmlDateUpdateLoanNumber" style="width: 100%; font-weight: bold" disabled="disabled" />
                                    </td>
                                </tr>
                                <tr>
                                    <td style="width: 30%; text-align: right">Loan Type:</td>
                                    <td style="width: 70%">
                                        <input type="text" id="txtStmlDateUpdateLoanType" style="width: 100%; font-weight: bold" disabled="disabled" />
                                    </td>
                                </tr>
                                <tr>
                                    <td style="width: 30%; text-align: right">Stml Start:</td>
                                    <td style="width: 70%">
                                        <input type="text" id="txtStmlDateUpdateLoanStmlDate" style="width: 100%; font-weight: bold" disabled="disabled" />
                                    </td>
                                </tr>   
                                <tr>
                                    <td style="width: 30%; text-align: right">New Stml Start:</td>
                                    <td style="width: 70%">
                                        <input id="txtStmlDateUpdateLoanStmlDateNew" type="text" class="easyui-datebox" style="width: 100%;" data-options="formatter:icsdateformat,parser:icsdateparser" />                                        
                                    </td>
                                </tr>                           
                            </table>
                        </fieldset>
                    </div>
                    <div style="width:100%; height:15%">
                        <fieldset style="width:100%; height:100%">
                            <legend> Action:</legend>
                            <table border="0" cellpadding="0" cellspacing="0" style="width:100%">
                                <tr style="height:100%">
                                    <td style="width:70%; text-align:left; font-size:12px; font-weight:bold">                                        
                                    </td>
                                    <td style="width:10%; text-align: right; font-size: 12px; font-weight: bold; vertical-align: bottom;">
                                        <a id="btnSaveStmlDateUpdate" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-save" plain="true">Update</a>
                                    </td>
                                    <td style="width:10%; text-align:right; font-size:12px; font-weight:bold; vertical-align:bottom">
                                        <a id="btnWinStmlDateUpdateCloseLoan" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-cancel" plain="true">Close</a>
                                    </td>
                                </tr>
                            </table>
                        </fieldset>
                    </div>

                </div>
            </div>
        </div>

</body>
</html>

<style>
    .avro {
        font-family: Kalpurush;
    }

    .bijoy {
        font-family: SutonnyMJ;
    }
</style>
<script type="text/javascript">

    $(document).ready(function () {
        var oLoans =@Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(Model));
        var oLoansObj = sessionStorage.getItem("Loans");
        var header = sessionStorage.getItem("Operation");

        var oDateCompareOperatorObjs =@Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(ViewBag.DateCompareOperatorObjs));
        var oAmountCompareOperatorObjs =@Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(ViewBag.AmountCompareOperatorObjs));
        var LoanTypes = @Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(@ViewBag.LoanTypes));
        var LoanRefTypes = @Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(@ViewBag.LoanRefTypes));
        var LoanCompoundTypes = @Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(@ViewBag.LoanCompoundTypes));
        var CycleTypes = @Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(@ViewBag.CycleTypes));
        var LoanTransferTypes = @Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(@ViewBag.LoanTransferTypes));
        var BaseCurrency = @Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(@ViewBag.BaseCurrency));
        var Currencys = @Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(@ViewBag.Currencys));
        var BankAccounts = @Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(@ViewBag.BankAccounts));
        var BUs = @Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(@ViewBag.BUs));

        $('#AppMainLayout').layout('collapse', 'west');
        $('#AppMainLayout').layout('expand', 'west');
        $('#AppMainLayout').layout('collapse', 'west');

        $("#cboSrcLoanRefType").icsLoadCombo({ List: LoanRefTypes, OptionValue: "id", DisplayText: "Description"});
        $("#cboSrcLoanRefTypeCollection").icsLoadCombo({ List: LoanRefTypes, OptionValue: "id", DisplayText: "Description"});

        $('#divLoanCollection').data("DateCompareOperatorObjs", oDateCompareOperatorObjs);
        $('#divLoanCollection').data("AmountCompareOperatorObjs", oAmountCompareOperatorObjs);
        $('#divLoanCollection').data("LoanTypes", LoanTypes);
        $('#divLoanCollection').data("LoanRefTypes", LoanRefTypes);
        $('#divLoanCollection').data("CycleTypes", CycleTypes);
        $('#divLoanCollection').data("LoanTransferTypes", LoanTransferTypes);
        $('#divLoanCollection').data("BaseCurrency", BaseCurrency);
        $('#divLoanCollection').data("Currencys", Currencys);
        $('#divLoanCollection').data("BankAccounts", BankAccounts);
        $('#divLoanCollection').data("BUs", BUs);

        if(oLoansObj!=null)
        {
            oLoans  = jQuery.parseJSON(oLoansObj);
        }
        else
        {
            oLoans = oLoans ;
        }

        $('#divLoanCollection').data("Loans", oLoans);
        $('#divLoanCollection').data("Operation", header);
        RefreshList(oLoans);

    });

    // Advance Search

    function InitializeSearchControls()
    {
        $('#txtSrcLoanNo').val("");
        $('#txtSrcLoanRefNo').val("");

        $('#txtSrcLoanAmountStart').val('0.00');
        $('#txtSrcLoanAmountEnd').val('0.00');
        $('#txtSrcInterestRateStart').val('0.00');
        $('#txtSrcInterestRateEnd').val('0.00');
        $('#txtSrcLiborRateStart').val('0.00');
        $('#txtSrcLiborRateEnd').val('0.00');
        $('#txtSrcLoanChargeStart').val('0.00');
        $('#txtSrcLoanChargeEnd').val('0.00');
        $('#txtSrcTotalInterestStart').val('0.00');
        $('#txtSrcTotalInterestEnd').val('0.00');
        $('#txtSrcTotalSettlementAmtStart').val('0.00');
        $('#txtSrcSettlementAmtEnd').val('0.00');

        $('#txtSrcLoanIssueStartDate').datebox({disabled: true});
        $('#txtSrcLoanIssueEndDate').datebox({disabled: true});
        $('#txtSrcLoanStartStartDate').datebox({disabled: true});
        $('#txtSrcLoanStartEndDate').datebox({disabled: true});
        $('#txtSrcLoanApproxStartDate').datebox({disabled: true});
        $('#txtSrcLoanApproxEndDate').datebox({disabled: true});
        $('#txtSrcLoanTransferStartDate').datebox({disabled: true});
        $('#txtSrcLoanTransferEndDate').datebox({disabled: true});
        $('#txtSrcLoanSettlementStartDate').datebox({disabled: true});
        $('#txtSrcLoanSettlementEndDate').datebox({disabled: true});

        $('#txtSrcLoanIssueStartDate').datebox('setValue',icsdateformat(new Date()));
        $('#txtSrcLoanIssueEndDate').datebox('setValue',icsdateformat(new Date()));
        $('#txtSrcLoanStartStartDate').datebox('setValue',icsdateformat(new Date()));
        $('#txtSrcLoanStartEndDate').datebox('setValue',icsdateformat(new Date()));
        $('#txtSrcLoanApproxStartDate').datebox('setValue',icsdateformat(new Date()));
        $('#txtSrcLoanApproxEndDate').datebox('setValue',icsdateformat(new Date()));
        $('#txtSrcLoanTransferStartDate').datebox('setValue',icsdateformat(new Date()));
        $('#txtSrcLoanTransferEndDate').datebox('setValue',icsdateformat(new Date()));
        $('#txtSrcLoanSettlementStartDate').datebox('setValue',icsdateformat(new Date()));
        $('#txtSrcLoanSettlementEndDate').datebox('setValue',icsdateformat(new Date()));
    }

    function RefreshComboBoxControls()
    {
        var DateCompareOperatorObjs = $('#divLoanCollection').data('DateCompareOperatorObjs');
        var AmountCompareOperatorObjs = $('#divLoanCollection').data('AmountCompareOperatorObjs');
        var LoanTypes = $('#divLoanCollection').data('LoanTypes');
        var LoanRefType = $('#divLoanCollection').data("LoanRefTypes");
        var LoanTransferTypes = $('#divLoanCollection').data('LoanTransferTypes');
        var BankAccounts = $('#divLoanCollection').data('BankAccounts');
        var BUs = $('#divLoanCollection').data('BUs');

        DateCompareOperatorObjs = [DateCompareOperatorObjs[1], DateCompareOperatorObjs[5]];
        AmountCompareOperatorObjs = [AmountCompareOperatorObjs[1], AmountCompareOperatorObjs[5]];

        $("#cboSrcBUnitType").icsLoadCombo({ List: BUs, OptionValue: "BusinessUnitID", DisplayText: "ShortName"});
        $("#cboSrcLoanType").icsLoadCombo({ List: LoanTypes, OptionValue: "id", DisplayText: "Description"});
        $("#cboSrcLoanRefType").icsLoadCombo({ List: LoanRefType, OptionValue: "id", DisplayText: "Description"});
        $("#cboSrcBankAC").icsLoadCombo({ List: BankAccounts, OptionValue: "BankAccountID", DisplayText: "AccountName"});
        $("#cboLoanTransferType").icsLoadCombo({ List: LoanTransferTypes, OptionValue: "id", DisplayText: "Description"});

        $("#cboSrcLoanAmount").icsLoadCombo({ List: AmountCompareOperatorObjs, OptionValue: "id", DisplayText: "Value"});
        $("#cboSrcInterestRate").icsLoadCombo({ List: AmountCompareOperatorObjs, OptionValue: "id", DisplayText: "Value"});
        $("#cboSrcLiborRate").icsLoadCombo({ List: AmountCompareOperatorObjs, OptionValue: "id", DisplayText: "Value"});
        $("#cboSrcLoanCharge").icsLoadCombo({ List: AmountCompareOperatorObjs, OptionValue: "id", DisplayText: "Value"});
        $("#cboSrcTotalInterest").icsLoadCombo({ List: AmountCompareOperatorObjs, OptionValue: "id", DisplayText: "Value"});
        $("#cboSrcSettlementAmt").icsLoadCombo({ List: AmountCompareOperatorObjs, OptionValue: "id", DisplayText: "Value"});

        $("#cboSrcLoanIssueDate").icsLoadCombo({ List: DateCompareOperatorObjs, OptionValue: "id", DisplayText: "Value"});
        $("#cboSrcLoanStartDate").icsLoadCombo({ List: DateCompareOperatorObjs, OptionValue: "id", DisplayText: "Value"});
        $("#cboSrcLoanApproxDate").icsLoadCombo({ List: DateCompareOperatorObjs, OptionValue: "id", DisplayText: "Value"});
        $("#cboSrcLoanTransferDate").icsLoadCombo({ List: DateCompareOperatorObjs, OptionValue: "id", DisplayText: "Value"});
        $("#cboSrcLoanSettlementDate").icsLoadCombo({ List: DateCompareOperatorObjs, OptionValue: "id", DisplayText: "Value"});
    }

    $('#btnAdvSearch').click(function(){
        debugger;

        $("#winAdvanceSearch").icsWindow('open', "Advance Search");
        $("#txtSrcLoanRefNo").prop("disabled", true);
        RefreshComboBoxControls();
        InitializeSearchControls();
    });

    $('#btnSrcReset').click(function(){
        debugger;

        $("#txtSrcLoanRefNo").prop("disabled", true);
        RefreshComboBoxControls();
        InitializeSearchControls();
    });

    function DateValidation(value, startDate, EndDate)
    {
        if(value===1 || value===2 || value===3 || value===4)
        {
            if(startDate===null || startDate==="")
            {
                return 1;
            }
        }
        if(value===5 || value===6)
        {
            if(startDate===null || startDate==="")
            {
                return 2;
            }
            if(EndDate===null || EndDate==="")
            {

                return 3;
            }
            if(new Date(startDate) > new Date(EndDate))
            {
                return 4;
            }
        }
        return 5;
    }

    function ValidateSearch()
    {
        debugger;

        var cboSrcLoanType = parseInt($('#cboSrcLoanType').val());
        var cboSrcBankAC = parseInt($('#cboSrcBankAC').val());
        var cboSrcLoanRefType = parseInt($('#cboSrcLoanRefType').val());

        var cboSrcLoanAmount = parseInt($('#cboSrcLoanAmount').val());
        var cboSrcInterestRate = parseInt($('#cboSrcInterestRate').val());
        var cboSrcLiborRate = parseInt($('#cboSrcLiborRate').val());
        var cboSrcLoanCharge = parseInt($('#cboSrcLoanCharge').val());
        var cboSrcTotalInterest = parseInt($('#cboSrcTotalInterest').val());
        var cboSrcSettlementAmt = parseInt($('#cboSrcSettlementAmt').val());

        var cboSrcLoanIssueDate = parseInt($('#cboSrcLoanIssueDate').val());
        var cboSrcLoanStartDate = parseInt($('#cboSrcLoanStartDate').val());
        var cboSrcLoanApproxDate = parseInt($('#cboSrcLoanApproxDate').val());
        var cboSrcLoanTransferDate = parseInt($('#cboSrcLoanTransferDate').val());
        var cboSrcLoanSettlementDate = parseInt($('#cboSrcLoanSettlementDate').val());

        var txtSrcLoanAmountStart   = $.trim($('#txtSrcLoanAmountStart').val());
        var txtSrcLoanAmountEnd = $.trim($('#txtSrcLoanAmountEnd').val());

        var cboSrcBUnitType = $.trim($('#cboSrcBUnitType').val());

        //if(cboSrcBUnitType == 0){
        //    alert("Please Select Business Unit");
        //    return false;
        //}

        if(cboSrcLoanAmount===1 || cboSrcLoanAmount===2 || cboSrcLoanAmount===3 || cboSrcLoanAmount===4)
        {

            if(txtSrcLoanAmountStart===null || txtSrcLoanAmountStart==="")
            {
                alert("Please enter Loan start Amount!");
                $('#txtSrcLoanAmountStart').focus();
                return false;
            }
            if(icsRemoveComma(txtSrcLoanAmountStart)<=0)
            {
                alert("Please enter Loan start Amount!");
                $('#txtSrcLoanAmountStart').focus();
                return false;
            }
        }
        if(cboSrcLoanAmount===5 || cboSrcLoanAmount===6)
        {
            if(txtSrcLoanAmountStart===null || txtSrcLoanAmountStart==="")
            {
                alert("Please enter Loan start Amount!");
                $('#txtSrcLoanAmountStart').focus();
                return false;
            }
            if(icsRemoveComma(txtSrcLoanAmountStart)<=0)
            {
                alert("Please enter Loan start Amount!");
                $('#txtSrcLoanAmountStart').focus();
                return false;
            }


            if(txtSrcLoanAmountEnd===null || txtSrcLoanAmountEnd==="")
            {
                alert("Please enter Loan end Amount!");
                $('#txtSrcLoanAmountEnd').focus();
                return false;
            }
            if(icsRemoveComma(txtSrcLoanAmountEnd)<=0)
            {
                alert("Please enter Loan end Amount!");
                $('#txtSrcLoanAmountEnd').focus();
                return false;
            }
            if(icsRemoveComma(txtSrcLoanAmountStart) >= icsRemoveComma(txtSrcLoanAmountEnd))
            {
                alert("Start amount must be smallar than end amount!");
                $('#txtSrcLoanAmountStart').focus();
                return false;
            }
        }

        var txtSrcInterestRateStart   = $.trim($('#txtSrcInterestRateStart').val());
        var txtSrcInterestRateEnd = $.trim($('#txtSrcInterestRateEnd').val());
        if(cboSrcInterestRate===1 || cboSrcInterestRate===2 || cboSrcInterestRate===3 || cboSrcInterestRate===4)
        {
            if(txtSrcInterestRateStart===null || txtSrcInterestRateStart==="")
            {
                alert("Please enter InterestRate start Amount!");
                $('#txtSrcInterestRateStart').focus();
                return false;
            }
            if(icsRemoveComma(txtSrcInterestRateStart)<=0)
            {
                alert("Please enter InterestRate start Amount!");
                $('#txtSrcInterestRateStart').focus();
                return false;
            }
        }
        if(cboSrcInterestRate===5 || cboSrcInterestRate===6)
        {
            if(txtSrcInterestRateStart===null || txtSrcInterestRateStart==="")
            {
                alert("Please enter InterestRate start Amount!");
                $('#txtSrcInterestRateStart').focus();
                return false;
            }
            if(icsRemoveComma(txtSrcInterestRateStart)<=0)
            {
                alert("Please enter InterestRate start Amount!");
                $('#txtSrcInterestRateStart').focus();
                return false;
            }

            if(txtSrcInterestRateEnd===null || txtSrcInterestRateEnd==="")
            {
                alert("Please enter InterestRate end Amount!");
                $('#txtSrcInterestRateEnd').focus();
                return false;
            }
            if(icsRemoveComma(txtSrcInterestRateEnd)<=0)
            {
                alert("Please enter InterestRate end Amount!");
                $('#txtSrcInterestRateEnd').focus();
                return false;
            }
            if(icsRemoveComma(txtSrcInterestRateStart) >= icsRemoveComma(txtSrcInterestRateEnd))
            {
                alert("Start amount must be smallar than end amount!");
                $('#txtSrcInterestRateStart').focus();
                return false;
            }
        }

        var txtSrcLiborRateStart   = $.trim($('#txtSrcLiborRateStart').val());
        var txtSrcLiborRateEnd = $.trim($('#txtSrcLiborRateEnd').val());
        if(cboSrcLiborRate===1 || cboSrcLiborRate===2 || cboSrcLiborRate===3 || cboSrcLiborRate===4)
        {
            if(txtSrcLiborRateStart===null || txtSrcLiborRateStart==="")
            {
                alert("Please enter LiborRate start Amount!");
                $('#txtSrcLiborRateStart').focus();
                return false;
            }
            if(icsRemoveComma(txtSrcLiborRateStart)<=0)
            {
                alert("Please enter LiborRate start Amount!");
                $('#txtSrcLiborRateStart').focus();
                return false;
            }
        }
        if(cboSrcLiborRate===5 || cboSrcLiborRate===6)
        {
            if(txtSrcLiborRateStart===null || txtSrcLiborRateStart==="")
            {
                alert("Please enter LiborRate start Amount!");
                $('#txtSrcLiborRateStart').focus();
                return false;
            }
            if(icsRemoveComma(txtSrcLiborRateStart)<=0)
            {
                alert("Please enter LiborRate start Amount!");
                $('#txtSrcLiborRateStart').focus();
                return false;
            }


            if(txtSrcLiborRateEnd===null || txtSrcLiborRateEnd==="")
            {
                alert("Please enter LiborRate end Amount!");
                $('#txtSrcLiborRateEnd').focus();
                return false;
            }
            if(icsRemoveComma(txtSrcLiborRateEnd)<=0)
            {
                alert("Please enter LiborRate end Amount!");
                $('#txtSrcLiborRateEnd').focus();
                return false;
            }
            if(icsRemoveComma(txtSrcLiborRateStart) >= icsRemoveComma(txtSrcLiborRateEnd))
            {
                alert("Start amount must be smallar than end amount!");
                $('#txtSrcLiborRateStart').focus();
                return false;
            }
        }

        var txtSrcLoanChargeStart   = $.trim($('#txtSrcLoanChargeStart').val());
        var txtSrcLoanChargeEnd = $.trim($('#txtSrcLoanChargeEnd').val());
        if(cboSrcLoanCharge===1 || cboSrcLoanCharge===2 || cboSrcLoanCharge===3 || cboSrcLoanCharge===4)
        {
            if(txtSrcLoanChargeStart===null || txtSrcLoanChargeStart==="")
            {
                alert("Please enter LoanCharge start Amount!");
                $('#txtSrcLoanChargeStart').focus();
                return false;
            }
            if(icsRemoveComma(txtSrcLoanChargeStart)<=0)
            {
                alert("Please enter LoanCharge start Amount!");
                $('#txtSrcLoanChargeStart').focus();
                return false;
            }
        }
        if(cboSrcLoanCharge===5 || cboSrcLoanCharge===6)
        {
            if(txtSrcLoanChargeStart===null || txtSrcLoanChargeStart==="")
            {
                alert("Please enter LoanCharge start Amount!");
                $('#txtSrcLoanChargeStart').focus();
                return false;
            }
            if(icsRemoveComma(txtSrcLoanChargeStart)<=0)
            {
                alert("Please enter LoanCharge start Amount!");
                $('#txtSrcLoanChargeStart').focus();
                return false;
            }

            if(txtSrcLoanChargeEnd===null || txtSrcLoanChargeEnd==="")
            {
                alert("Please enter LoanCharge end Amount!");
                $('#txtSrcLoanChargeEnd').focus();
                return false;
            }
            if(icsRemoveComma(txtSrcLoanChargeEnd)<=0)
            {
                alert("Please enter LoanCharge end Amount!");
                $('#txtSrcLoanChargeEnd').focus();
                return false;
            }
            if(icsRemoveComma(txtSrcLoanChargeStart) >= icsRemoveComma(txtSrcLoanChargeEnd))
            {
                alert("Start amount must be smallar than end amount!");
                $('#txtSrcLoanChargeStart').focus();
                return false;
            }
        }

        var txtSrcTotalInterestStart   = $.trim($('#txtSrcTotalInterestStart').val());
        var txtSrcTotalInterestEnd = $.trim($('#txtSrcTotalInterestEnd').val());
        if(cboSrcTotalInterest===1 || cboSrcTotalInterest===2 || cboSrcTotalInterest===3 || cboSrcTotalInterest===4)
        {
            if(txtSrcTotalInterestStart===null || txtSrcTotalInterestStart==="")
            {
                alert("Please enter TotalInterest start Amount!");
                $('#txtSrcTotalInterestStart').focus();
                return false;
            }
            if(icsRemoveComma(txtSrcTotalInterestStart)<=0)
            {
                alert("Please enter TotalInterest start Amount!");
                $('#txtSrcTotalInterestStart').focus();
                return false;
            }
        }
        if(cboSrcTotalInterest===5 || cboSrcTotalInterest===6)
        {
            if(txtSrcTotalInterestStart===null || txtSrcTotalInterestStart==="")
            {
                alert("Please enter TotalInterest start Amount!");
                $('#txtSrcTotalInterestStart').focus();
                return false;
            }
            if(icsRemoveComma(txtSrcTotalInterestStart)<=0)
            {
                alert("Please enter TotalInterest start Amount!");
                $('#txtSrcTotalInterestStart').focus();
                return false;
            }

            if(txtSrcTotalInterestEnd===null || txtSrcTotalInterestEnd==="")
            {
                alert("Please enter TotalInterest end Amount!");
                $('#txtSrcTotalInterestEnd').focus();
                return false;
            }
            if(icsRemoveComma(txtSrcTotalInterestEnd)<=0)
            {
                alert("Please enter TotalInterest end Amount!");
                $('#txtSrcTotalInterestEnd').focus();
                return false;
            }
            if(icsRemoveComma(txtSrcTotalInterestStart) >= icsRemoveComma(txtSrcTotalInterestEnd))
            {
                alert("Start amount must be smallar than end amount!");
                $('#txtSrcTotalInterestStart').focus();
                return false;
            }
        }

        var txtSrcTotalSettlementAmtStart   = $.trim($('#txtSrcTotalSettlementAmtStart').val());
        var txtSrcSettlementAmtEnd = $.trim($('#txtSrcSettlementAmtEnd').val());
        if(cboSrcSettlementAmt===1 || cboSrcSettlementAmt===2 || cboSrcSettlementAmt===3 || cboSrcSettlementAmt===4)
        {
            if(txtSrcTotalSettlementAmtStart===null || txtSrcTotalSettlementAmtStart==="")
            {
                alert("Please enter TotalSettlement start Amount!");
                $('#txtSrcTotalSettlementAmtStart').focus();
                return false;
            }
            if(icsRemoveComma(txtSrcTotalSettlementAmtStart)<=0)
            {
                alert("Please enter TotalSettlement start Amount!");
                $('#txtSrcTotalSettlementAmtStart').focus();
                return false;
            }
        }
        if(cboSrcSettlementAmt===5 || cboSrcSettlementAmt===6)
        {
            if(txtSrcTotalSettlementAmtStart===null || txtSrcTotalSettlementAmtStart==="")
            {
                alert("Please enter TotalSettlement start Amount!");
                $('#txtSrcTotalSettlementAmtStart').focus();
                return false;
            }
            if(icsRemoveComma(txtSrcTotalSettlementAmtStart)<=0)
            {
                alert("Please enter TotalSettlement start Amount!");
                $('#txtSrcTotalSettlementAmtStart').focus();
                return false;
            }

            if(txtSrcSettlementAmtEnd===null || txtSrcSettlementAmtEnd==="")
            {
                alert("Please enter TotalSettlement end Amount!");
                $('#txtSrcSettlementAmtEnd').focus();
                return false;
            }
            if(icsRemoveComma(txtSrcSettlementAmtEnd)<=0)
            {
                alert("Please enter TotalSettlement end Amount!");
                $('#txtSrcSettlementAmtEnd').focus();
                return false;
            }
            if(icsRemoveComma(txtSrcTotalSettlementAmtStart) >= icsRemoveComma(txtSrcSettlementAmtEnd))
            {
                alert("Start amount must be smallar than end amount!");
                $('#txtSrcTotalSettlementAmtStart').focus();
                return false;
            }
        }

        var txtSrcLoanIssueStartDate   = $('#txtSrcLoanIssueStartDate').datebox('getValue');
        var txtSrcLoanIssueEndDate   = $('#txtSrcLoanIssueEndDate').datebox('getValue');
        var value = DateValidation(cboSrcLoanIssueDate, txtSrcLoanIssueStartDate, txtSrcLoanIssueEndDate);
        if(value==1)
        {
            alert("Please select Loan Issue Start Date!");
            $('#txtSrcLoanIssueStartDate').focus();
        }
        else if(value==2)
        {
            alert("Please select Loan Issue Start Date!");
            $('#txtSrcLoanIssueStartDate').focus();
        }
        else if(value==3)
        {
            alert("Please select Loan Issue End Date!");
            $('#txtSrcLoanIssueEndDate').focus();
        }
        else if(value==4)
        {
            alert("Start date must be smallar than or equal end date!");
            $('#txtSrcLoanIssueStartDate').focus();
        }

        var txtSrcLoanStartStartDate   = $('#txtSrcLoanStartStartDate').datebox('getValue');
        var txtSrcLoanStartEndDate   = $('#txtSrcLoanStartEndDate').datebox('getValue');
        var value = DateValidation(cboSrcLoanStartDate, txtSrcLoanStartEndDate, txtSrcLoanStartEndDate);
        if(value==1)
        {
            alert("Please select Loan Start Date!");
            $('#txtSrcLoanStartStartDate').focus();
        }
        else if(value==2)
        {
            alert("Please select Loan Start Date!");
            $('#txtSrcLoanStartStartDate').focus();
        }
        else if(value==3)
        {
            alert("Please select Loan End Date!");
            $('#txtSrcLoanStartEndDate').focus();
        }
        else if(value==4)
        {
            alert("Start date must be smallar than or equal end date!");
            $('#txtSrcLoanStartStartDate').focus();
        }

        var txtSrcLoanApproxStartDate   = $('#txtSrcLoanApproxStartDate').datebox('getValue');
        var txtSrcLoanApproxEndDate   = $('#txtSrcLoanApproxEndDate').datebox('getValue');
        var value = DateValidation(cboSrcLoanApproxDate, txtSrcLoanApproxStartDate, txtSrcLoanApproxEndDate);
        if(value==1)
        {
            alert("Please select Approx Start Date!");
            $('#txtSrcLoanApproxStartDate').focus();
        }
        else if(value==2)
        {
            alert("Please select Approx Start Date!");
            $('#txtSrcLoanApproxStartDate').focus();
        }
        else if(value==3)
        {
            alert("Please select Approx End Date!");
            $('#txtSrcLoanApproxEndDate').focus();
        }
        else if(value==4)
        {
            alert("Start date must be smallar than or equal end date!");
            $('#txtSrcLoanApproxStartDate').focus();
        }

        var txtSrcLoanTransferStartDate   = $('#txtSrcLoanTransferStartDate').datebox('getValue');
        var txtSrcLoanTransferEndDate   = $('#txtSrcLoanTransferEndDate').datebox('getValue');
        var value = DateValidation(cboSrcLoanTransferDate, txtSrcLoanTransferStartDate, txtSrcLoanTransferEndDate);
        if(value==1)
        {
            alert("Please select Transfer Start Date!");
            $('#txtSrcLoanTransferStartDate').focus();
        }
        else if(value==2)
        {
            alert("Please select Transfer Start Date!");
            $('#txtSrcLoanTransferStartDate').focus();
        }
        else if(value==3)
        {
            alert("Please select Transfer End Date!");
            $('#txtSrcLoanTransferEndDate').focus();
        }
        else if(value==4)
        {
            alert("Start date must be smallar than or equal end date!");
            $('#txtSrcLoanTransferStartDate').focus();
        }

        var txtSrcLoanSettlementStartDate   = $('#txtSrcLoanSettlementStartDate').datebox('getValue');
        var txtSrcLoanSettlementEndDate   = $('#txtSrcLoanSettlementEndDate').datebox('getValue');
        var value = DateValidation(cboSrcLoanSettlementDate, txtSrcLoanSettlementStartDate, txtSrcLoanSettlementEndDate);
        if(value==1)
        {
            alert("Please select Settlement Start Date!");
            $('#txtSrcLoanSettlementStartDate').focus();
        }
        else if(value==2)
        {
            alert("Please select Settlement Start Date!");
            $('#txtSrcLoanSettlementStartDate').focus();
        }
        else if(value==3)
        {
            alert("Please select Settlement End Date!");
            $('#txtSrcLoanSettlementEndDate').focus();
        }
        else if(value==4)
        {
            alert("Start date must be smallar than or equal end date!");
            $('#txtSrcLoanSettlementStartDate').focus();
        }

        var txtSrcLoanNo =$.trim($('#txtSrcLoanNo').val());

        if(txtSrcLoanNo===null)
        {
            $('#txtSrcLoanNo').val("");
        }

        if(cboSrcLoanRefType > 1)
        {
            var txtSrcLoanRefNo =$.trim($('#txtSrcLoanRefNo').val());
            if(txtSrcLoanRefNo == ""){
                alert("Please Enter Loan Ref No!")
                $('#txtSrcLoanRefNo').focus();
                return false;
            }
        }

        if(txtSrcLoanNo==="" && cboSrcBUnitType===0 && cboSrcLoanType===0 && cboSrcBankAC===0 && cboSrcLoanRefType===0 && cboSrcLoanAmount===0 && cboSrcInterestRate===0 && cboSrcLiborRate===0 && cboSrcLoanCharge===0 && cboSrcTotalInterest===0 && cboSrcSettlementAmt ===0 && cboSrcLoanIssueDate ===0 && cboSrcLoanStartDate===0 && cboSrcLoanApproxDate===0 && cboSrcLoanTransferDate===0 && cboSrcLoanSettlementDate===0)
        {
            alert("Please select atleast one searching criteriea!");
            return false;
        }
        return true;
    }

    $('#btnSearch').click(function(e){
        if(!ValidateSearch()) return false;

        var cboSrcBUnitType =parseInt($.trim($('#cboSrcBUnitType').val()));

        var txtSrcLoanNo =$.trim($('#txtSrcLoanNo').val());
        var cboSrcLoanType = parseInt($('#cboSrcLoanType').val());
        var cboSrcBankAC = parseInt($('#cboSrcBankAC').val());

        var cboSrcLoanRefType = parseInt($('#cboSrcLoanRefType').val());
        var txtSrcLoanRefNo = parseInt($('#txtSrcLoanRefNo').val());

        var cboSrcLoanIssueDate = parseInt($('#cboSrcLoanIssueDate').val());
        var txtSrcLoanIssueStartDate   = $('#txtSrcLoanIssueStartDate').datebox('getValue');
        var txtSrcLoanIssueEndDate   = $('#txtSrcLoanIssueEndDate').datebox('getValue');

        var cboSrcLoanStartDate = parseInt($('#cboSrcLoanStartDate').val());
        var txtSrcLoanStartStartDate   = $('#txtSrcLoanStartStartDate').datebox('getValue');
        var txtSrcLoanStartEndDate   = $('#txtSrcLoanStartEndDate').datebox('getValue');

        var cboSrcLoanApproxDate = parseInt($('#cboSrcLoanApproxDate').val());
        var txtSrcLoanApproxStartDate   = $('#txtSrcLoanApproxStartDate').datebox('getValue');
        var txtSrcLoanApproxEndDate   = $('#txtSrcLoanApproxEndDate').datebox('getValue');

        var cboSrcLoanTransferDate = parseInt($('#cboSrcLoanTransferDate').val());
        var txtSrcLoanTransferStartDate   = $('#txtSrcLoanTransferStartDate').datebox('getValue');
        var txtSrcLoanTransferEndDate   = $('#txtSrcLoanTransferEndDate').datebox('getValue');

        var cboSrcLoanSettlementDate = parseInt($('#cboSrcLoanSettlementDate').val());
        var txtSrcLoanSettlementStartDate   = $('#txtSrcLoanSettlementStartDate').datebox('getValue');
        var txtSrcLoanSettlementEndDate   = $('#txtSrcLoanSettlementEndDate').datebox('getValue');

        var cboSrcLoanAmount = parseInt($('#cboSrcLoanAmount').val());
        var txtSrcLoanAmountStart = icsRemoveComma($.trim($('#txtSrcLoanAmountStart').val()));
        var txtSrcLoanAmountEnd = icsRemoveComma($.trim($('#txtSrcLoanAmountEnd').val()));

        var cboSrcInterestRate = parseInt($('#cboSrcInterestRate').val());
        var txtSrcInterestRateStart = icsRemoveComma($.trim($('#txtSrcInterestRateStart').val()));
        var txtSrcInterestRateEnd = icsRemoveComma($.trim($('#txtSrcInterestRateEnd').val()));

        var cboSrcLiborRate = parseInt($('#cboSrcLiborRate').val());
        var txtSrcLiborRateStart = icsRemoveComma($.trim($('#txtSrcLiborRateStart').val()));
        var txtSrcLiborRateEnd = icsRemoveComma($.trim($('#txtSrcLiborRateEnd').val()));

        var cboSrcLoanCharge = parseInt($('#cboSrcLoanCharge').val());
        var txtSrcLoanChargeStart = icsRemoveComma($.trim($('#txtSrcLoanChargeStart').val()));
        var txtSrcLoanChargeEnd = icsRemoveComma($.trim($('#txtSrcLoanChargeEnd').val()));

        var cboSrcTotalInterest = parseInt($('#cboSrcTotalInterest').val());
        var txtSrcTotalInterestStart = icsRemoveComma($.trim($('#txtSrcTotalInterestStart').val()));
        var txtSrcTotalInterestEnd = icsRemoveComma($.trim($('#txtSrcTotalInterestEnd').val()));

        var cboSrcSettlementAmt = parseInt($('#cboSrcSettlementAmt').val());
        var txtSrcTotalSettlementAmtStart = icsRemoveComma($.trim($('#txtSrcTotalSettlementAmtStart').val()));
        var txtSrcSettlementAmtEnd = icsRemoveComma($.trim($('#txtSrcSettlementAmtEnd').val()));

        if(txtSrcLoanNo===null){ txtSrcLoanNo = ""; }
        if(txtSrcLoanRefNo===null){ txtSrcLoanRefNo = ""; }

        debugger;
        var sSearchingData  =  "";
        sSearchingData = sSearchingData + cboSrcLoanIssueDate+'~'+ txtSrcLoanIssueStartDate+'~'+ txtSrcLoanIssueEndDate+'~';
        sSearchingData = sSearchingData + cboSrcLoanStartDate+'~'+ txtSrcLoanStartStartDate+'~'+ txtSrcLoanStartEndDate+'~';
        sSearchingData = sSearchingData + cboSrcLoanApproxDate+'~'+ txtSrcLoanApproxStartDate+'~'+ txtSrcLoanApproxEndDate+'~';
        sSearchingData = sSearchingData + cboSrcLoanTransferDate+'~'+ txtSrcLoanTransferStartDate+'~'+ txtSrcLoanTransferEndDate+'~';
        sSearchingData = sSearchingData + cboSrcLoanSettlementDate+'~'+ txtSrcLoanSettlementStartDate+'~'+ txtSrcLoanSettlementEndDate+'~';

        sSearchingData = sSearchingData + cboSrcLoanAmount+'~'+ txtSrcLoanAmountStart+'~'+ txtSrcLoanAmountEnd+'~';
        sSearchingData = sSearchingData + cboSrcInterestRate+'~'+ txtSrcInterestRateStart+'~'+ txtSrcInterestRateEnd+'~';
        sSearchingData = sSearchingData + cboSrcLiborRate+'~'+ txtSrcLiborRateStart+'~'+ txtSrcLiborRateEnd+'~';
        sSearchingData = sSearchingData + cboSrcLoanCharge+'~'+ txtSrcLoanChargeStart+'~'+ txtSrcLoanChargeEnd+'~';
        sSearchingData = sSearchingData + cboSrcTotalInterest+'~'+ txtSrcTotalInterestStart+'~'+ txtSrcTotalInterestEnd+'~';
        sSearchingData = sSearchingData + cboSrcSettlementAmt+'~'+ txtSrcTotalSettlementAmtStart+'~'+ txtSrcSettlementAmtEnd;

        var LoanObj = {
            LoanNo : txtSrcLoanNo,
            BUID : cboSrcBUnitType,
            LoanTypeInt : cboSrcLoanType,
            RcvBankAccountID : cboSrcBankAC,
            LoanRefTypeInt : cboSrcLoanRefType,
            LoanRefNo : txtSrcLoanRefNo,
            SearchingData : sSearchingData
        };

        $.ajax({
            type: "POST",
            dataType: "JSON",
            url: sessionStorage.getItem("BaseAddress")+  "/Loan/AdvanceSearch",
            data:  JSON.stringify(LoanObj),
            contentType: "application/json; charset=utf-8",
            success: function (data) {
                debugger;
                var oLoans = data;
                if (oLoans != null) {
                    if(oLoans.length>0)
                    {
                        if(oLoans[0].ErrorMessage=="")
                        {
                            RefreshList(oLoans);
                            $("#winAdvanceSearch").icsWindow('close');
                        }
                        else
                        {
                            alert(oLoans[0].ErrorMessage);
                        }
                    }
                    else
                    {
                        alert("Data not found!!");
                    }
                }
            },
            error: function (xhr, status, error) {
                alert(error);
            }
        });
    });

    $('#btnSrcClose').click(function(e){
        $("#winAdvanceSearch").icsWindow('close');
    });

    $("#cboSrcLoanRefType").change(function(e)
    {
        debugger;
        $("#txtSrcLoanRefNo").prop("disabled", true);
        $("#txtImportOrExportRefNo").val("");
        if($("#cboSrcLoanRefType").val() == 1)
        {
            $('#spanImportOrExportRefNo').html('Imp. Invoice :');
            $("#txtSrcLoanRefNo").prop("disabled", false);
        }
        else if($("#cboSrcLoanRefType").val() == 2)
        {
            $('#spanImportOrExportRefNo').html('ExportLC :');
            $("#txtSrcLoanRefNo").prop("disabled", false);
        }

    });

    $('#cboSrcLoanIssueDate').change(function(e){
        //EqualTo = 1, NotEqualTo = 2, GreaterThen = 3, SmallerThen = 4, Between = 5, NotBetween = 6
        var nCompareOperator =   parseInt($('#cboSrcLoanIssueDate').val());
        if(nCompareOperator===0)
        {
            $('#txtSrcLoanIssueStartDate').datebox({ disabled : true });
            $('#txtSrcLoanIssueEndDate').datebox({ disabled : true });
        }
        else if (nCompareOperator===1 || nCompareOperator===2 || nCompareOperator===3 || nCompareOperator===4)
        {
            $('#txtSrcLoanIssueStartDate').datebox({ disabled : false });
            $('#txtSrcLoanIssueEndDate').datebox({ disabled : true });
        }
        else
        {
            $('#txtSrcLoanIssueStartDate').datebox({ disabled : false });
            $('#txtSrcLoanIssueEndDate').datebox({ disabled : false });
        }
        $('#txtSrcLoanIssueStartDate').datebox('setValue', icsdateformat(new Date()));
        $('#txtSrcLoanIssueEndDate').datebox('setValue', icsdateformat(new Date()));
    });

    $('#cboSrcLoanStartDate').change(function(e){
        //EqualTo = 1, NotEqualTo = 2, GreaterThen = 3, SmallerThen = 4, Between = 5, NotBetween = 6
        var nCompareOperator =   parseInt($('#cboSrcLoanStartDate').val());
        if(nCompareOperator===0)
        {
            $('#txtSrcLoanStartStartDate').datebox({ disabled : true });
            $('#txtSrcLoanStartEndDate').datebox({ disabled : true });
        }
        else if (nCompareOperator===1 || nCompareOperator===2 || nCompareOperator===3 || nCompareOperator===4)
        {
            $('#txtSrcLoanStartStartDate').datebox({ disabled : false });
            $('#txtSrcLoanStartEndDate').datebox({ disabled : true });
        }
        else
        {
            $('#txtSrcLoanStartStartDate').datebox({ disabled : false });
            $('#txtSrcLoanStartEndDate').datebox({ disabled : false });
        }
        $('#txtSrcLoanStartStartDate').datebox('setValue', icsdateformat(new Date()));
        $('#txtSrcLoanStartEndDate').datebox('setValue', icsdateformat(new Date()));
    });

    $('#cboSrcLoanApproxDate').change(function(e){
        //EqualTo = 1, NotEqualTo = 2, GreaterThen = 3, SmallerThen = 4, Between = 5, NotBetween = 6
        var nCompareOperator =   parseInt($('#cboSrcLoanApproxDate').val());
        if(nCompareOperator===0)
        {
            $('#txtSrcLoanApproxStartDate').datebox({ disabled : true });
            $('#txtSrcLoanApproxEndDate').datebox({ disabled : true });
        }
        else if (nCompareOperator===1 || nCompareOperator===2 || nCompareOperator===3 || nCompareOperator===4)
        {
            $('#txtSrcLoanApproxStartDate').datebox({ disabled : false });
            $('#txtSrcLoanApproxEndDate').datebox({ disabled : true });
        }
        else
        {
            $('#txtSrcLoanApproxStartDate').datebox({ disabled : false });
            $('#txtSrcLoanApproxEndDate').datebox({ disabled : false });
        }
        $('#txtSrcLoanApproxStartDate').datebox('setValue', icsdateformat(new Date()));
        $('#txtSrcLoanApproxEndDate').datebox('setValue', icsdateformat(new Date()));
    });

    $('#cboSrcLoanTransferDate').change(function(e){
        //EqualTo = 1, NotEqualTo = 2, GreaterThen = 3, SmallerThen = 4, Between = 5, NotBetween = 6
        var nCompareOperator =   parseInt($('#cboSrcLoanTransferDate').val());
        if(nCompareOperator===0)
        {
            $('#txtSrcLoanTransferStartDate').datebox({ disabled : true });
            $('#txtSrcLoanTransferEndDate').datebox({ disabled : true });
        }
        else if (nCompareOperator===1 || nCompareOperator===2 || nCompareOperator===3 || nCompareOperator===4)
        {
            $('#txtSrcLoanTransferStartDate').datebox({ disabled : false });
            $('#txtSrcLoanTransferEndDate').datebox({ disabled : true });
        }
        else
        {
            $('#txtSrcLoanTransferStartDate').datebox({ disabled : false });
            $('#txtSrcLoanTransferEndDate').datebox({ disabled : false });
        }
        $('#txtSrcLoanTransferStartDate').datebox('setValue', icsdateformat(new Date()));
        $('#txtSrcLoanTransferEndDate').datebox('setValue', icsdateformat(new Date()));
    });

    $('#cboSrcLoanSettlementDate').change(function(e){
        //EqualTo = 1, NotEqualTo = 2, GreaterThen = 3, SmallerThen = 4, Between = 5, NotBetween = 6
        var nCompareOperator =   parseInt($('#cboSrcLoanSettlementDate').val());
        if(nCompareOperator===0)
        {
            $('#txtSrcLoanSettlementStartDate').datebox({ disabled : true });
            $('#txtSrcLoanSettlementEndDate').datebox({ disabled : true });
        }
        else if (nCompareOperator===1 || nCompareOperator===2 || nCompareOperator===3 || nCompareOperator===4)
        {
            $('#txtSrcLoanSettlementStartDate').datebox({ disabled : false });
            $('#txtSrcLoanSettlementEndDate').datebox({ disabled : true });
        }
        else
        {
            $('#txtSrcLoanSettlementStartDate').datebox({ disabled : false });
            $('#txtSrcLoanSettlementEndDate').datebox({ disabled : false });
        }
        $('#txtSrcLoanSettlementStartDate').datebox('setValue', icsdateformat(new Date()));
        $('#txtSrcLoanSettlementEndDate').datebox('setValue', icsdateformat(new Date()));
    });

    //End Advance Search

    function RefreshList(oLoans)
    {
        debugger;
        data=oLoans;
        data={"total":""+data.length+"","rows":data};
        $('#tblLoans').datagrid('loadData',data);
        var nIndex= parseInt(sessionStorage.getItem("SelectedRowIndex"));
        $('#tblLoans').datagrid('selectRow',nIndex);
    }

    $("#btnAddLoan").click(function()
    {
        debugger;
        //var oLoans= $('#tblLoans').datagrid('getRows');
        //sessionStorage.setItem("Loans", JSON.stringify(oLoans));
        sessionStorage.setItem("SelectedRowIndex", -1);
        sessionStorage.setItem("Operation", "Add Loan");
        sessionStorage.setItem("BackLink", window.location.href);
        window.location.href = sessionStorage.getItem("BaseAddress")+ "/Loan/ViewLoan?id=0";
    });

    $("#btnEditLoan").click(function()
    {
        debugger;
        var oLoan= $('#tblLoans').datagrid('getSelected');
        if(oLoan==null || oLoan.LoanID<=0)
        {
            alert("Please select a item from list!");
            return;
        }
        if(parseInt(oLoan.ApprovedBy)!=0)
        {
            alert("Sorry, Selected Item Already Approved.");
            return;
        }
        var SelectedRowIndex=$('#tblLoans').datagrid('getRowIndex',oLoan);
        var oLoans= $('#tblLoans').datagrid('getRows');
        sessionStorage.setItem("Loans", JSON.stringify(oLoans));
        sessionStorage.setItem("SelectedRowIndex", SelectedRowIndex);
        sessionStorage.setItem("Operation", "Edit Loan");
        sessionStorage.setItem("BackLink", window.location.href);

        window.location.href = sessionStorage.getItem("BaseAddress")+ "/Loan/ViewLoan?id="+oLoan.LoanID;
    });
       
    $("#btnViewLoan").click(function()
    {
        debugger;
        var oLoan= $('#tblLoans').datagrid('getSelected');
        if(oLoan==null || oLoan.LoanID<=0)
        {
            alert("Please select a item from list!");
            return;
        }

        var SelectedRowIndex=$('#tblLoans').datagrid('getRowIndex',oLoan);
        var oLoans= $('#tblLoans').datagrid('getRows');
        sessionStorage.setItem("Loans", JSON.stringify(oLoans));
        sessionStorage.setItem("SelectedRowIndex", SelectedRowIndex);
        sessionStorage.setItem("Operation", "View Loan");
        sessionStorage.setItem("BackLink", window.location.href);
        window.location.href = sessionStorage.getItem("BaseAddress")+ "/Loan/ViewLoan?id="+oLoan.LoanID;
    });

    $('#btnDelete').click(function(){
        //debugger;
        var oLoan= $('#tblLoans').datagrid('getSelected');
        if(oLoan==null || oLoan.LoanID<=0)
        {
            alert("Invalid Field!!! please select a valid Field!");
            return false;
        }
        if(parseInt(oLoan.ApprovedBy)!=0)
        {
            alert("Sorry, Selected Item Already Approved.");
            return;
        }
        if (!confirm("Confirm to Delete?")) return ;

        var SelectedRowIndex=$('#tblLoans').datagrid('getRowIndex',oLoan);

        if (parseInt(oLoan.LoanID) > 0)
        {
            $.ajax
            ({
                type: "GET",
                dataType: "json",
                url : sessionStorage.getItem("BaseAddress")+"/Loan/Delete",
                data: { id: oLoan.LoanID},
                contentType: "application/json; charset=utf-8",
                success: function (data) {
                    //debugger;
                    feedbackmessage = jQuery.parseJSON(data);
                    if (feedbackmessage == "Deleted")
                    {
                        alert("Delete sucessfully");
                        $('#tblLoans').datagrid('deleteRow',SelectedRowIndex);

                    }
                    else
                    {
                        alert(feedbackmessage);
                    }
                },
                error: function (xhr, status, error)
                {
                    alert(error);
                }

            });
        }
    });

    $("#btnApproveLoan").click(function()
    {
        debugger;
        var oLoan= $('#tblLoans').datagrid('getSelected');
        if(oLoan==null || oLoan.LoanID<=0)
        {
            alert("Please select a item from list!");
            return;
        }
        if(parseInt(oLoan.ApprovedBy)!=0)
        {
            alert("Sorry, Selected Item Already Approved.");
            return;
        }
        var SelectedRowIndex=$('#tblLoans').datagrid('getRowIndex',oLoan);
        var oLoans= $('#tblLoans').datagrid('getRows');
        sessionStorage.setItem("Loans", JSON.stringify(oLoans));
        sessionStorage.setItem("SelectedRowIndex", SelectedRowIndex);
        sessionStorage.setItem("Operation", "Approve Loan");
        sessionStorage.setItem("BackLink", window.location.href);
        window.location.href = sessionStorage.getItem("BaseAddress")+ "/Loan/ViewLoan?id="+oLoan.LoanID;
    });
    $("#btnReceiveLoan").click(function()
    {
        debugger;
        var oLoan= $('#tblLoans').datagrid('getSelected');
        if(oLoan==null || oLoan.LoanID<=0)
        {
            alert("Please select a item from list!");
            return;
        }
        if(parseInt(oLoan.ApprovedBy)==0)
        {
            alert("Sorry, Selected an Approved Loan!");
            return;
        }
        if(parseInt(oLoan.ReceivedBy)!=0)
        {
            alert("Sorry, Selected Item Already Received.");
            return;
        }
        var SelectedRowIndex=$('#tblLoans').datagrid('getRowIndex',oLoan);
        var oLoans= $('#tblLoans').datagrid('getRows');
        sessionStorage.setItem("Loans", JSON.stringify(oLoans));
        sessionStorage.setItem("SelectedRowIndex", SelectedRowIndex);
        sessionStorage.setItem("Operation", "Receive Loan");
        sessionStorage.setItem("BackLink", window.location.href);
        window.location.href = sessionStorage.getItem("BaseAddress")+ "/Loan/ViewLoan?id="+oLoan.LoanID;
    });
    $("#btnSettlementLoan").click(function()
    {
        debugger;
        var oLoan= $('#tblLoans').datagrid('getSelected');
        if(oLoan==null || oLoan.LoanID<=0)
        {
            alert("Please select a item from list!");
            return;
        }
        if(parseInt(oLoan.ReceivedBy)==0)
        {
            alert("Without Receive Can't Settle.");
            return false;
        }
        if(oLoan.LoanType == 5)
        {
            alert("Settlement can not be done for Term Loan Type!");
            return false;
        }

        var SelectedRowIndex=$('#tblLoans').datagrid('getRowIndex',oLoan);
        var oLoans= $('#tblLoans').datagrid('getRows');
        sessionStorage.setItem("Loans", JSON.stringify(oLoans));
        sessionStorage.setItem("SelectedRowIndex", SelectedRowIndex);
        sessionStorage.setItem("Operation", "View Loan");
        sessionStorage.setItem("BackLink", window.location.href);

        window.location.href = sessionStorage.getItem("BaseAddress")+ "/Loan/ViewLoan?id="+oLoan.LoanID;
    });


    $("#txtSearchByLoanNo").keydown(function (e) {
        var code = (e.keyCode ? e.keyCode : e.which);
        if (code == 13) // Enter Press
        {
            if($.trim($('#txtSearchByLoanNo').val())===null || $.trim($('#txtSearchByLoanNo').val())==="")
            {
                alert("Press enter with Loan No");
                return false;
            }
            var oLoan = {
                LoanNo : $.trim($('#txtSearchByLoanNo').val()),
                LoanRefTypeInt : 0,
                LoanRefNo : ""
            }
            LoanGetsByLoanORRefNo(oLoan);
        }
    });

    $("#cboSrcLoanRefTypeCollection").change(function(e)
    {
        debugger;
        $("#txtSearchByImportInvoiceOrExportLC").prop("disabled", true);
        $("#txtSearchByImportInvoiceOrExportLC").val("");
        if($("#cboSrcLoanRefTypeCollection").val() == 1)
        {
            $('#spanImportOrExportRefNoCollection').html('Imp. Invoice :');
            $("#txtSearchByImportInvoiceOrExportLC").prop("disabled", false);
        }
        else if($("#cboSrcLoanRefTypeCollection").val() == 2)
        {
            $('#spanImportOrExportRefNoCollection').html('ExportLC :');
            $("#txtSearchByImportInvoiceOrExportLC").prop("disabled", false);
        }

    });

    $("#txtSearchByImportInvoiceOrExportLC").keydown(function (e)
    {
        debugger;
        var code = (e.keyCode ? e.keyCode : e.which);
        if (code == 13) // Enter Press
        {
            if($("#cboSrcLoanRefTypeCollection").val() == 0)
            {
                alert("Please Select Loan Ref Type!");
                return false;
            }

            if($.trim($('#txtSearchByImportInvoiceOrExportLC').val())===null || $.trim($('#txtSearchByImportInvoiceOrExportLC').val())==="")
            {
                alert("Please enter in Correct Format!");
                return false;
            }

            var oLoan = {
                LoanRefTypeInt : parseInt($('#cboSrcLoanRefTypeCollection').val()),
                LoanRefNo : $.trim($('#txtSearchByImportInvoiceOrExportLC').val()),
                LoanNo : ""
            }
            LoanGetsByLoanORRefNo(oLoan);

        }
    });


    function LoanGetsByLoanORRefNo(oLoan)
    {
        $.ajax({
            type: "POST",
            dataType: "json",
            url: sessionStorage.getItem("BaseAddress")+ "/Loan/GetByLoanORRefNo",
            traditional: true,
            data:  JSON.stringify(oLoan),
            contentType: "application/json; charset=utf-8",
            success: function (data) {
                var oLoans = data;
                if (oLoans[0].ErrorMessage =="" || oLoans[0].ErrorMessage==null) {
                    $('#divLoanCollection').data("Loans", oLoans);
                    RefreshList(oLoans);
                }
                else
                {
                    alert("Data not found!!");
                }
            },
            error: function (xhr, status, error) {
                alert(error);
            }
        });
    }

    $('#btnPrint').click(function(){
        var oLoans= $('#tblLoans').datagrid('getRows');
        var ids ="";
        if(oLoans.length >0)
        {
            for(var i =0;i<oLoans.length;i++)
            {
                ids =ids+oLoans[i].LoanID+",";
            }
            ids = ids.substring(0, ids.length - 1);
        }
        else{
            return;
        }

        var LoanObj = {
            SearchingData : ids
        };

        $.ajax({
            type: "POST",
            dataType: "JSON",
            url: sessionStorage.getItem("BaseAddress")+  "/Loan/SetPrintingData",
            data:  JSON.stringify(LoanObj),
            contentType: "application/json; charset=utf-8",
            success: function (data) {
                debugger;
                window.open(sessionStorage.getItem('BaseAddress') + '/Loan/PrintLoans', "_blank");
            },
            error: function (xhr, status, error) {
                alert(error);
            }
        });

    });

    $('#btnPrintPreview').click(function(){
        var oLoan= $('#tblLoans').datagrid('getSelected');

        if(oLoan==null || oLoan.LoanID<=0)
        {
            alert("Please select a item from list!");
            return false;
        }

        var id = oLoan.LoanID;

        var LoanObj = {
            SearchingData : id
        };

        $.ajax({
            type: "POST",
            dataType: "JSON",
            url: sessionStorage.getItem("BaseAddress")+  "/Loan/SetPrintingData",
            data:  JSON.stringify(LoanObj),
            contentType: "application/json; charset=utf-8",
            success: function (data) {
                debugger;
                window.open(sessionStorage.getItem('BaseAddress') + '/Loan/PrintPreview', "_blank");
            },
            error: function (xhr, status, error) {
                alert(error);
            }
        });

    });

    /*-----------------Region Tag LC (Tonmoy Bhowmik) ---------------- */
    function InitializeWIndowPickerForTagLC(oLoan){
        //txtTagLCLoanFileNo txtTagLCLoanNumber txtTagLCLoanType txtTagLCLoanIssueDate txtTagLCApproxStlmtDate txtTagLCLoanStartDate txtTagLCLoanExportLC txtTagLCLoanAccountNo txtTagLCLoanAmountCurrency txtTagLCLoanAmount
        $("#txtTagLCLoanFileNo").val(oLoan.FullFileNo);
        $("#txtTagLCLoanNumber").val(oLoan.LoanNo);
        $("#txtTagLCLoanType").val(oLoan.LoanTypeSt);
        $("#txtTagLCLoanIssueDate").val(oLoan.IssueDateInString);
        $("#txtTagLCApproxStlmtDate").val(oLoan.ApproxSettlementInString);
        $("#txtTagLCLoanStartDate").val(oLoan.LoanStartDateInString);
        $("#txtTagLCLoanExportLC").val(oLoan.LoanRefNo);
        $("#txtTagLCLoanAccountNo").val(oLoan.BankAccNo);
        $("#txtTagLCLoanAmountCurrency").val(oLoan.CurrencySymbol);
        $("#txtTagLCLoanAmount").val(icsFormatPrice(parseFloat(oLoan.PrincipalAmount), null, 2));

        var LoanObj = {
            LoanID:oLoan.LoanID,
            LoanRefID:oLoan.LoanRefID
        };

        $.ajax({
            type: "POST",
            dataType: "JSON",
            url: sessionStorage.getItem("BaseAddress")+  "/Loan/GetLoanExportLC",
            data:  JSON.stringify(LoanObj),
            contentType: "application/json; charset=utf-8",
            success: function (data) {

                DynamicRefreshList(JSON.parse(data), "tblTagLCLoanCharge");
            },
            error: function (xhr, status, error) {
                alert(error);
            }
        });

    }
    $("#btnWinTagLCCloseLoan").click(function (){
        $("#winLoanTagLC").icsWindow('close');
    });
    function SetPickerValueAssign(oPickerobj) {

        var oreturnObj = null, oreturnobjs = [];
        if (oPickerobj.multiplereturn) {
            oreturnobjs = $('#' + oPickerobj.tableid).datagrid('getChecked');
        } else {
            oreturnObj = $('#' + oPickerobj.tableid).datagrid('getSelected');
        }
        $("#" + oPickerobj.winid).icsWindow("close");
        $("#" + oPickerobj.winid).remove();

        if (oPickerobj.winid === 'winExportOrImports')
        {
            if (oreturnobjs.length>0)
            {

                for(var i=0;i<oreturnobjs.length;i++){
                    $('#tblTagLCLoanCharge').datagrid('appendRow',oreturnobjs[i]);
                }
                $("#txtWinTagLCExportLC").val("");

            }
        }

    }
    function IntializePickerbutton(oPickerobj) {
        $("#" + oPickerobj.winid).find("#btnOk").click(function () {
            //for Single Select
            SetPickerValueAssign(oPickerobj);
        });
        $(document).find('.' + oPickerobj.winclass).keydown(function (e) {
            if (e.which == 13)//enter=13
            {
                SetPickerValueAssign(oPickerobj);
            }
        });
    }
    function PickImportOrExport()
    {
        var oRefObject = null, sRefControllerName="", sActionName="", sRefObjectID="",searchingbyfieldName = "", tblColums = [],sExportLCIDs="";
        var oSelectedLoan=JSON.parse($("#winLoanTagLC").data('SelectedLoanOrder'));
        var oLoanExportLCs= $("#tblTagLCLoanCharge").datagrid("getRows");
        for(var i=0;i<oLoanExportLCs.length;i++){
            sExportLCIDs+=oLoanExportLCs[i].ExportLCID+",";
        }
        sExportLCIDs=sExportLCIDs.substring(0,sExportLCIDs.length-1);
        sRefControllerName="Loan";
        sActionName="GetExportLCForLoanExportLC";
        sRefObjectID = "ExportLCID";
        oRefObject={
            BUID:oSelectedLoan.BUID,
            ExportLCNo:$.trim($('#txtWinTagLCExportLC').val()),
            Params:sExportLCIDs+'~'+oSelectedLoan.LoanID
        };
        var oColumn = { field: "ExportLCNo", title: "LC No", width: 200, align: "left" }; tblColums.push(oColumn);
        //oColumn = { field: "ApplicantName", title: "Applicant", width: 300, align: "left" }; tblColums.push(oColumn);
        //oColumn = { field: "OpeningDateST", title: "LC Date", width: 100, align: "left" }; tblColums.push(oColumn);
        //oColumn = { field: "AmountSt", title: "Amount", width: 100, align: "right" }; tblColums.push(oColumn);
        searchingbyfieldName="ExportLCNo";
        var obj = {
            BaseAddress: sessionStorage.getItem("BaseAddress"),
            Object: oRefObject,
            ControllerName:sRefControllerName,
            ActionName: sActionName,
            IsWinClose: false
        };
        $.icsProgressBar(true);
        $.icsDataGets(obj, function (response) {
            $.icsProgressBar(false);
            if (response.status && response.objs.length > 0) {
                if (response.objs[0].ExportLCID > 0) {
                    var oPickerParam = {
                        winid: 'winExportOrImports',
                        winclass: 'clsExportOrImports',
                        winwidth: 450,
                        winheight: 450,
                        tableid: 'tblExportOrImports',
                        tablecolumns: tblColums,
                        datalist: response.objs,
                        multiplereturn: true,
                        searchingbyfieldName: searchingbyfieldName,
                        windowTittle: 'Item List'
                    };
                    $.icsPicker(oPickerParam);
                    IntializePickerbutton(oPickerParam);
                }
                else { alert(response.objs[0].ErrorMessage); }
            }else{
                alert("Data Not Found.");
                return;
            }
        });
    }
    $("#txtWinTagLCExportLC").keydown(function (e) {
        var code = (e.keyCode ? e.keyCode : e.which);
        if (code == 13) // Enter Press
        {
            if($.trim($('#txtWinTagLCExportLC').val())===null || $.trim($('#txtWinTagLCExportLC').val())==="")
            {
                alert("Press enter with LC No");
                return false;
            }
            PickImportOrExport();
        }
    });
    $('#btnTagLCLoan').click(function(){
        var oLoan= $('#tblLoans').datagrid('getSelected');

        if(oLoan==null || oLoan.LoanID<=0)
        {
            alert("Please select a item from list!");
            return false;
        }
        if(oLoan.ReceivedBy==0)
        {
            alert("Sorry, Selected Item Not Received.");
            return;
        }
        if(parseInt(oLoan.LoanStatus)!=3)
        {
            alert("Sorry, Selected Item Not PC Loan.");
            return;
        }

        if(parseInt(oLoan.LoanRefType)!=2)
        {
            alert("Sorry, Selected Item  Ref. Not Export LC.");
            return;
        }
        editIndex = undefined;
        InitializeWIndowPickerForTagLC(oLoan);
        $("#winLoanTagLC").icsWindow('open');
        $("#winLoanTagLC").data('SelectedLoanOrder',JSON.stringify(oLoan));


    });

    var editIndex = undefined;

    function onClickRow(index) {
        if (editIndex != index) {

                if (endEditing()) {
                    $('#tblTagLCLoanCharge').datagrid('selectRow', index).datagrid('beginEdit', index);

                    editIndex = index;
                }
                else {
                    $('#tblTagLCLoanCharge').datagrid('selectRow', editIndex);
                }

        }
    }

    function endEditing() {

        if (editIndex == undefined) {
            return true;
        }
        if ($('#tblTagLCLoanCharge').datagrid('validateRow', editIndex)) {
            $('#tblTagLCLoanCharge').datagrid('endEdit', editIndex);
            $('#tblTagLCLoanCharge').datagrid('selectRow', editIndex);

            editIndex = undefined;
            return true;
        }
        else {
            return false;
        }
    }

    $("#btnSaveTagExportLC").click(function () {

        endEditing();
        debugger;
        var oLoanExportLCs= $('#tblTagLCLoanCharge').datagrid('getRows');

        //var oSelectedLoan=JSON.parse($("#winLoanTagLC").data('SelectedLoanOrder'));
        //for(var i=0;i<oLoanExportLCs.length;i++){
        //    if(oLoanExportLCs[i].Amount<=0){
        //        alert("Amount Can not Be Zero Or Negative");
        //        var SelectedRowIndex=$('#tblTagLCLoanCharge').datagrid('getRowIndex',oLoanExportLCs[i]);
        //        $('#tblTagLCLoanCharge').datagrid('selectRow', SelectedRowIndex);
        //        return false;
        //    }
        //}
        //var nTtlAmount= 0;
        //for(var i=0;i<oLoanExportLCs.length;i++){
        //    nTtlAmount+=parseFloat(oLoanExportLCs[i].Amount);
        //}
        //if(nTtlAmount!=oSelectedLoan.LoanAmount){
        //    alert("Amount Sum is not equal to Loan Amount");
        //    return false;
        //}
        var oloanExportLC= {
            LoanExportLCs:oLoanExportLCs
        }
        $.ajax({
            type: "POST",
            dataType: "json",
            url: _sBaseAddress + "/Loan/SaveLoanExportLC",
            traditional: true,
            data:  JSON.stringify(oloanExportLC),
            contentType: "application/json; charset=utf-8",
            success: function (data) {

                oLoan = jQuery.parseJSON(data);
                if (oLoan.ErrorMessage =="" || oLoan.ErrorMessage==null)
                {
                    alert("Data Saved sucessfully");
                    DynamicRefreshList(oLoan.LoanExportLCs, "tblTagLCLoanCharge");

                }
                else
                {
                    alert(oLoan.ErrorMessage);

                }
            },
            error: function (xhr, status, error) {
                alert(error);
            }
        });

    });
    $('#btnDeleteLoanExportLC').click(function(){
        //debugger;
        var oSelected= $('#tblTagLCLoanCharge').datagrid('getSelected');
        if(oSelected==null)
        {
            alert("Invalid Field!!! please select a valid Field!");
            return false;
        }
        if(oSelected.isDeletable==false)
        {
            alert("Base LC Can not be Deleted");
            return false;
        }

        if (!confirm("Confirm to Delete?")) return ;

        var SelectedRowIndex=$('#tblTagLCLoanCharge').datagrid('getRowIndex',oSelected);

        //if (parseInt(oSelected.LoanExportLCID) > 0)
        //{
        //    $.ajax
        //    ({
        //        type: "GET",
        //        dataType: "json",
        //        url : sessionStorage.getItem("BaseAddress")+"/Loan/DeleteExportLC",
        //        data: {id:oSelected.LoanExportLCID},
        //        contentType: "application/json; charset=utf-8",
        //        success: function (data) {
        //            //debugger;
        //            feedbackmessage = jQuery.parseJSON(data);
        //            if (feedbackmessage == "Deleted")
        //            {
        //                alert("Delete sucessfully");
        //                $('#tblTagLCLoanCharge').datagrid('deleteRow',SelectedRowIndex);

        //            }
        //            else
        //            {
        //                alert(feedbackmessage);
        //            }
        //        },
        //        error: function (xhr, status, error)
        //        {
        //            alert(error);
        //        }

        //    });
        //}
        //else{
            $('#tblTagLCLoanCharge').datagrid('deleteRow',SelectedRowIndex);
        //}
    });

    /*----------------End Region---------------------------------------*/


    /*-----------------Region Stml Start Date ---------------- */
    $("#btnUpdateStmlStartDateLoan").click(function()
    {        
        var oLoan= $('#tblLoans').datagrid('getSelected');
        if(oLoan==null || oLoan.LoanID<=0)
        {
            alert("Please select a item from list!");
            return;
        }  

        $("#txtStmlDateUpdateLoanFileNo").val(oLoan.FullFileNo);
        $("#txtStmlDateUpdateLoanNumber").val(oLoan.LoanNo);
        $("#txtStmlDateUpdateLoanType").val(oLoan.LoanTypeSt);        
        $("#txtStmlDateUpdateLoanStmlDate").val(oLoan.StlmtStartDateInString);        
        $('#txtStmlDateUpdateLoanStmlDateNew').datebox('setValue',oLoan.StlmtStartDateInString);

        $("#winStmlDateUpdateWindow").icsWindow('open');
        $("#winStmlDateUpdateWindow").data('SelectedLoan',JSON.stringify(oLoan));
    });

    $("#btnWinStmlDateUpdateCloseLoan").click(function (){
        $("#winStmlDateUpdateWindow").icsWindow('close');
    });

    $("#btnSaveStmlDateUpdate").click(function (){
        var oLoan= $('#tblLoans').datagrid('getSelected');
        if(oLoan==null || oLoan.LoanID<=0)
        {
            alert("Please select a item from list!");
            return;
        }  

        if($("#txtStmlDateUpdateLoanStmlDateNew").datebox('getValue')==null || $("#txtStmlDateUpdateLoanStmlDateNew").datebox('getValue')=="")
        {
            alert("Please enter Stml Start Date!");
            $('#txtStmlDateUpdateLoanStmlDateNew').focus();
            return false;
        }
        var SelectedRowIndex=$('#tblLoans').datagrid('getRowIndex',oLoan);
        oLoan.StlmtStartDate = $("#txtStmlDateUpdateLoanStmlDateNew").datebox('getValue');
               
        $.ajax({
            type: "POST",
            dataType: "json",
            url: _sBaseAddress + "/Loan/UpdateStmlStartDate",
            traditional: true,
            data:  JSON.stringify(oLoan),
            contentType: "application/json; charset=utf-8",
            success: function (data) {
                oLoan = jQuery.parseJSON(data);
                if (oLoan.ErrorMessage =="" || oLoan.ErrorMessage==null)
                {
                    alert("Data Saved sucessfully");
                    $('#tblLoans').datagrid('updateRow',{ index: SelectedRowIndex, row: oLoan });
                    $("#winStmlDateUpdateWindow").icsWindow('close');                    
                }
                else
                {
                    alert(oLoan.ErrorMessage);
                }
            },
            error: function (xhr, status, error) {
                alert(error);
            }
        });
    });
    /*-----------------End Region Stml Start Date ---------------- */
</script>


