@{
    ViewBag.Title = "Specification";
}

@model ESimSol.BusinessObjects.FabricExecutionOrderSpecification

 <html>
    <head>
        <meta name="viewport" content="width=device-width" />
        <title></title>
    </head>
    <body>
        <div id="progressbarParent" style="width:100%;height:100%;margin:0 auto;text-align:center; margin-left: auto;margin-right: auto;left: 0;right: 0;z-index: 1;">
            <div style="margin: 0px auto;margin-top: 251px;text-align:center;width:390px;">
                <label style="font-size:18px;">Please wait</label>
                <div id="progressbar" style="width:100%;height:37px;"></div>
            </div>
        </div>
        <div class="menuMainCollectionTable">
            <fieldset class="actionfieldsetstyle">
                <legend> </legend>
                <table class="tbl">
                    <tr>
                        <td class="tdtblorder">
                            <div class="divLabel">
                                <label> PO No :</label>
                            </div>
                            <div class="divInput">
                                <input id="txtOrderNoFS" class="resetfield disablefield" type="text" placeholder="Execution no" disabled />
                            </div>
                        </td>
                        <td class="tdtblorder">
                            <div class="divLabel">
                                <label> Type:</label>
                            </div>
                            <div class="divInput">
                                @*<input id="txtCopyFromFS" class="resetfield" type="text" placeholder="Type exe no & press enter" />*@
                                @*<input id="txtFabricIDFS" class="resetfield disablefield" type="text" placeholder="Fabric ID" disabled />*@
                                <select style="width: 95%;" class="resetfield disablefield" onchange="ChangecboFSpcType(true)" id="cboFSpcType">
                                    <option value="0">General</option>
                                    <option value="1">Seer Sucker</option>
                                    <option value="2">Injected Slub</option>
                                </select>
                            </div>
                        </td>
                        <td class="tdtblorder">
                            <div class="divLabel">
                                <label> Job. No :</label>
                            </div>
                            <div class="divInput" >
                                <input id="txtConsumptionNoFS" style="width:35%;text-align:left" type="text" placeholder="Job No" disabled />
                                <input id="txtExeNo" style="width:36%;text-align:left" type="text" placeholder="Dispo No" />
                                <a id="btnExeNo" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-pick" plain="true">Pick</a>
                            </div>
                        </td>
                    </tr>

                    <tr>
                        <td class="tdtblorder">
                            <div class="divLabel">
                                <label> Mkt Ref No:</label>
                            </div>
                            <div class="divInput">
                                <input id="txtFabricIDFS" class="resetfield disablefield" type="text" placeholder="Fabric ID" disabled />
                                @*<input id="txtPINoFS" class="resetfield disablefield" type="text" placeholder="PI No" disabled />*@
                            </div>
                        </td>
                        <td class="tdtblorder">
                            <div class="divLabel">
                                <label> Construction :</label>
                            </div>
                            <div class="divInput">
                                <input id="txtConstructionFS" class="resetfield disablefield" type="text" placeholder="Construction no" disabled />
                            </div>
                        </td>

                        <td class="tdtblorder">
                            <div class="divLabel">
                                <label> Fabric Width :</label>
                            </div>
                            <div class="divInput">
                                <input id="txtFabricWidthFS" class="resetfield disablefield" type="text" placeholder="Fabric Width" disabled />
                            </div>
                        </td>
                    </tr>

                    <tr>
                        <td class="tdtblorder">
                            <div class="divLabel">
                                <label> Buyer :</label>
                            </div>
                            <div class="divInput">
                                <input id="txtBuyerFS" class="resetfield disablefield" type="text" placeholder="Buyer Name" disabled />
                            </div>
                        </td>
                        <td class="tdtblorder">
                            <div class="divLabel">
                                <label> Composition :</label>
                            </div>
                            <div class="divInput">
                                <input id="txtCompositionFS" class="resetfield disablefield" type="text" placeholder="Composition" disabled />
                            </div>
                        </td>

                        <td class="tdtblorder">
                            <div class="divLabel">
                                <label> Weave :</label>
                            </div>
                            <div class="divInput">
                                <input id="txtWeaveFS" class="resetfield disablefield" type="text" placeholder="Weave No" disabled />
                            </div>
                        </td>
                    </tr>

                    <tr>
                        <td class="tdtblorder">
                            <div class="divLabel">
                                <label> H/L Ref :</label>
                            </div>
                            <div class="divInput">
                                <input id="txtHLRefFS" class="resetfield disablefield" type="text" placeholder="Order Ref." disabled />
                            </div>
                        </td>
                        <td class="tdtblorder">
                            <div class="divLabel">
                                <label> Finish Type :</label>
                            </div>
                            <div class="divInput">
                                <input id="txtFinishTypeFS" class="resetfield disablefield" type="text" placeholder="Finish Type" disabled />
                            </div>
                        </td>

                        <td class="tdtblorder">
                            <div class="divLabel">
                                <label> Order Qty :</label>
                            </div>
                            <div class="divInput twoRegion">
                                <input id="txtQtyInYardFS" class="resetfield disablefield" type="text" disabled />
                                <label>(Y)</label>
                                <input id="txtQtyInMeterFS" class="resetfield disablefield" type="text" disabled />
                                <label>(M)</label>
                            </div>
                        </td>
                    </tr>
                </table>
            </fieldset>
            <table style="width:100% ;">
                <tr>

                    <td style="width:32%;">
                        <fieldset>
                            <legend style="text-align:left; font-weight:bold;">Finished Fabric info : </legend>
                            <table class="tbl">

                                <tr>
                                    <td class="tdtblFS">
                                        <div class="regionLeftFS">
                                            <label> Ends X Picks :</label>
                                        </div>
                                        <div class="regionRightFS">
                                            <input id="txtFinishEndFS" class="numberfield" type="text" style="width:47%;" />
                                            <span>x</span>
                                            <input id="txtFinishPickFS" class="numberfield" type="text" style="width:46%;" />
                                        </div>
                                    </td>

                                </tr>
                                <tr>
                                    <td class="tdtblFS">
                                        <div class="regionLeftFS">
                                            <label> Finish Width  :</label>
                                        </div>
                                        <div class="regionRightFS">
                                            <input id="txtFabricWidth" class="number" type="text" style="width:47%;" />

                                        </div>
                                    </td>
                                </tr>
                                <tr>
                                    <td class="tdtblFS">
                                        <div class="regionLeftFS">
                                            <label> Req length(M):</label>
                                        </div>
                                        <div class="regionRightFS">
                                            <input id="txtReqFinishLen" type="text" class="number" style="width:35%;">
                                            + Qty(M)
                                            <input id="txtQtyExtraMet" class="number" type="text" style=" width:34%;" />
                                        </div>
                                    </td>
                                </tr>
                                <tr>
                                    <td class="tdtblFS">
                                        <div class="regionLeftFS">
                                            <label> NoOfFrame:</label>
                                        </div>
                                        <div class="regionRightFS">
                                            <input id="txtNoOfFrame" type="text" style="width:100%;">
                                        </div>
                                    </td>
                                </tr>
                                <tr>
                                    <td class="tdtblFS">
                                        <div class="regionLeftFS">
                                            <label> Warp X Weft :</label>
                                        </div>
                                        <div class="regionRightFS">
                                            <input id="txtWarpCount" type="text" style="width:47%;" />
                                            <span>x</span>
                                            <input id="txtWeftCount"  type="text" style="width:46%;" />
                                        </div>
                                    </td>
                                </tr>
                                <tr id="trSeersucker">
                                    <td class="tdtblFS">
                                        <div class="regionLeftFS">
                                            <label> Seer sucker</label>
                                        </div>
                                        <div class="regionRightFS">
                                           
                                        </div>
                                    </td>
                                </tr>
                            </table>
                        </fieldset>
                    </td>
                    <td style="width:68%;">
                        <fieldset>
                            <legend style="text-align:left; font-weight:bold;">Greige Fabric Detail : </legend>
                            <table class="tbl">

                                <tr>
                                    <td class="tdtblFS2">
                                        <div class="regionLeftFS">
                                            <label> Ends X Picks :</label>
                                        </div>
                                        <div class="regionRightFS">
                                            <input id="txtEndsFS" class="numberfield" type="text" style="width:47%;" />
                                            <span>x</span>
                                            <input id="txtPicksFS" class="numberfield" type="text" style="width:46%;" />
                                        </div>
                                    </td>
                                    <td class="tdtblFS3">
                                        <div class="regionLeftFS">
                                            <label> Reed :</label>
                                        </div>
                                        <div class="regionRightFS">
                                            <div class="divleftFS" style="width:100%;">
                                                <input id="txtReedFS" class="number" type="text" style="width:30%;" />
                                                /
                                                Dent
                                                <input id="txtDent" class="number" type="text" style="width:20%;" />
                                            </div>
                                        </div>
                                    </td>
                                </tr>
                                <tr>
                                    <td class="tdtblFS2">
                                        <div class="regionLeftFS">
                                            <label> Greige Width  :</label>
                                        </div>
                                        <div class="regionRightFS">
                                            <input id="txtGreigeWidthFS" class="numberfield" type="text" disabled="disabled" />
                                        </div>
                                    </td>
                                    <td class="tdtblFS3">
                                        <div class="regionLeftFS">
                                            <label> Reed Width :</label>
                                        </div>
                                        <div class="regionRightFS">
                                            <div class="divleftFS" style="width:100%;">
                                                <input id="txtReedWidthFS" class="number" type="text" style="width:50px;" disabled="disabled" />
                                                +
                                                <input id="txtCrimpFS" class="number" type="text" style="width:28px;" />
                                                Crimp
                                                <input id="txtTotalCrimpFS" class="number" type="text" style="width:43px;" disabled="disabled" />
                                            </div>
                                        </div>
                                    </td>
                                </tr>
                                <tr>
                                    <td class="tdtblFS2">
                                        <div class="regionLeftFS">
                                            <label> Req length(M):</label>
                                        </div>
                                        <div class="regionRightFS">
                                            <input id="txtGriegeDemandFSDefault" type="text" class="number" style="width:55px;" disabled="disabled">
                                            <span>+</span>
                                            <input id="txtGriegeDemandFSPercentage" type="text" class="number" style="width:30px;">%
                                            <span>+</span>
                                            <input id="txtReqLenAdd" type="text" class="number" style="width:30px;" disabled="disabled">=
                                            <span style="margin-left:0px;">
                                                <input id="txtGriegeDemandFS" type="text" class="number" style="width:58px;">
                                            </span>
                                        </div>

                                    </td>
                                    <td class="tdtblFS3">
                                        <div class="regionLeftFS">
                                            <label>Total Ends :</label>
                                        </div>
                                        <div class="regionRightFS">
                                            <input id="txtTotalEnds" class="numberfield" type="text" style="width:40%;" disabled="disabled" />

                                            <select style="width:18%;" id="cboAdd">
                                                <option value="1">+</option>
                                                <option value="0">-</option>
                                            </select>
                                            <input id="txtTotalEndsAdd" class="numberfield" type="text" style="width:20%;" />
                                        </div>
                                    </td>
                                </tr>
                                <tr>
                                    <td class="tdtblFS2">
                                        <div class="regionLeftFS">
                                            <label> Rq. Loom Prod :</label>
                                        </div>
                                        <div class="regionRightFS">
                                            <input id="txtReqLoomProdDefault" type="text" class="number" style="width:55px;" disabled>
                                            <span>+</span>
                                            <input id="txtReqLoomPP" type="text" class="number" style="width:30px;">%
                                            <span>+</span>
                                            <input id="txtLoomPPAdd" type="text" class="number" style="width:30px;">=
                                            <span style="margin-left:0px;">
                                                <input id="txtReqLoomProduction" class="numberfield" type="text" style="text-align:right; width:58px;">
                                            </span>
                                        </div>


                                    </td>
                                    <td class="tdtblFS3">
                                        <div class="regionLeftFS">
                                            <label>Selvedge Ends:</label>
                                        </div>
                                        <div class="regionRightFS">
                                            <input id="txtSelvedgeEnds" class="number" type="text" style="width:43px;" />
                                            +
                                            <input id="txtSelvedgeEndTwo" class="number" type="text" style="width:43px;" />
                                            =
                                            <input id="txtSelvedgeTotal" class="number" type="text" style="width:43px;" disabled />

                                        </div>
                                    </td>
                                </tr>

                                <tr>
                                    <td class="tdtblFS2">
                                        <div class="regionLeftFS">
                                            <label id="lblReqWarpLen">Req. Warp Len(U):</label>
                                        </div>
                                        <div class="regionRightFS">
                                            <input id="txtReqWarpLenFSDefault" class="number" type="text" style="width:55px;" disabled />
                                            <span>+</span>
                                            <input id="txtReqWarpLenFSPercentage" class="number" type="text" style="width:30px;" />%
                                            <span>+</span>
                                            <input id="txtWarpLenAdd" type="text" class="number" style="width:30px;">=
                                            <span style="margin-left:0px;">
                                                <input id="txtReqWarpLenFS" class="number" type="text" style="width:58px;" />
                                            </span>
                                        </div>
                                    </td>
                                    <td class="tdtblFS3">
                                        <div class="regionLeftFS">
                                            <label>Ground Ends :</label>
                                        </div>
                                        <div class="regionRightFS">
                                            <input id="txtGroundEndsFS" class="number" type="text" style="width:60%;text-align:left" disabled="disabled" />
                                            <select style="width:35%;" id="cboSEBeamType">
                                                <option value="1">U Beam</option>
                                                <option value="2">L Beam</option>
                                            </select>
                                        </div>
                                    </td>
                                </tr>

                                <tr id="trTotalEndULBeam">
                                    <td class="tdtblFS2">
                                        <div class="regionLeftFS">
                                            <label>Req. Warp Len(L)</label>
                                        </div>
                                        <div class="regionRightFS">
                                            @*<input id="txtReqWarpLenFSDefault" class="number" type="text" style="width:55px;" disabled />
                                            <span>+</span>
                                            <input id="txtReqWarpLenFSPercentage" class="number" type="text" style="width:30px;" />%
                                            <span>+</span>
                                            <input id="txtWarpLenAdd" type="text" class="number" style="width:30px;">=*@
                                            <span style="margin-left:0px;">
                                                <input id="txtReqWarpLenLB" class="number" type="text" style="width:58px;" />
                                            </span>
                                        </div>
                                    </td>
                                    <td class="tdtblFS3">
                                        <div class="regionLeftFS">
                                            <label>Total Ends(U):</label>
                                        </div>
                                        <div class="regionRightFS">
                                            <input id="txtTotalEndsU" class="number" type="text" style="width:40%;text-align:left" />
                                            <label>(L):</label>
                                            <input id="txtTotalEndsL" class="number" type="text" style="width:40%;text-align:left" />
                                        </div>
                                    </td>
                                </tr>


                            </table>
                        </fieldset>
                    </td>
                </tr>

            </table>
            <fieldset>
                <table>
                    <tr>
                        <td style="width:20%;" class="tbtblWarpingProgram">
                            <div class="regionLeftWP">
                                <label>Ref Note :</label>
                            </div>
                            <div class="regionRightWP">
                                <input id="txtRefNo" type="text" />
                            </div>
                        </td>
                        <td style="width:35%;" class="tbtblWarpingProgram">
                            <div class="regionLeftWP">
                                <label>Req Note :</label>
                            </div>
                            <div class="regionRightWP">
                                <input id="txtRefNote" type="text" />
                            </div>
                        </td>
                        <td style="width:45%;" class="tbtblWarpingProgram">
                            <div class="regionLeftWP">
                                <label>Color :</label>
                            </div>
                            <div class="regionRightWP">
                                <input id="txtWeftColor" type="text" />
                            </div>
                        </td>
                    </tr>
                    <tr>
                        <td style="width:20%;" class="tbtblWarpingProgram">
                            <div class="regionLeftWP">
                                <label>Ends/ Repeat :</label>
                            </div>
                            <div class="regionRightWP">
                                <label id="lblEndsRepeat" class="resetlbl"></label>
                            </div>
                        </td>
                        <td style="width:35%;" class="tbtblWarpingProgram">
                            <div class="regionLeftWP">
                                <label>Repeat :</label>
                            </div>
                            <div class="regionRightWP">
                                <input id="txtRepeatSection" class="number" type="text" />
                            </div>
                        </td>
                        <td style="width:45%;" class="tbtblWarpingProgram">
                            <div class="regionLeftWP">
                                <label>Section Ends :</label>
                            </div>
                            <div class="regionRightWP">
                                <label id="lblSectionEnds" class="resetlbl"></label>
                            </div>
                        </td>
                    </tr>
                    <tr>
                        <td style="width:20%;" class="tbtblWarpingProgram">
                            <div class="regionLeftWP">
                                <label id="lblNoOfSectionorBeam">No of Section:</label>
                            </div>
                            <div class="regionRightWP">
                                <input id="chkIsSepBeam" style="width:20%;" type="checkbox" /> 
                                <input id="txtNoOfSection" style="width:40%;" class="numberfield" type="text" />
                                <label id="lblNoOfSection" style="width:30%;" class="resetlbl"></label>
                               
                      
                        </div>
                        </td>
                        <td style="width:35%;" class="tbtblWarpingProgram">
                            <div class="regionLeftWP">
                                <label>Per Cone Length(Mtr) :</label>
                            </div>
                            <div class="regionRightWP">
                                <label style="width:30%;" id="lblPerConeLength" class="resetlbl"></label>
                            </div>
                        </td>
                        <td style="width:45%;" class="tbtblWarpingProgram">
                            <div class="regionLeftWP">
                                <label>Per Cone Dia(gm) :</label>
                            </div>
                            <div class="regionRightWP">
                                <label style="width:30%;" id="lblPerConeDia" class="resetlbl"></label>
                            </div>
                        </td>
                    </tr>
                </table>
            </fieldset>

            <table class="tbl">

                <tr>
                    <td colspan="3"></td>
                </tr>
                <tr>
                    <td colspan="3">
                        <div class="easyui-accordion">
                            <div title="Warp Plan" data-options="iconCls:'icon-details'" style="overflow: auto;">
                                <table id="tblWarpPlan" style="width:100%; height:200px" class="easyui-datagrid" fitcolumns="false" rownumbers="true" pagination="false" singleselect="true" autorowheight="false" toolbar="#toolbar_Warp" data-options="onLoadSuccess: onLoadSuccess, onClickRow: onClickRowFESDWarp,rowStyler: function(index,row){
                                         if (row.ColorName=='Total'){
                                            return 'color:#016B18; font-weight:bold;';
                                        }
                                    }
                    ">
                                    <thead>
                                        <tr>
                                            <th field="ProductName" width="15%"> Count</th>
                                            @*<th field="ColorName" width="15%">Color</th>*@
                                            <th data-options="field:'ColorName',width:120,height:60 ,align:'Left',editor:{type:'text'}" align="Left">Color</th>
                                            <th field="ColorNo" width="10%">LDNo</th>
                                            @*<th field="EndsCount" width="10%">Qty</th>*@
                                            <th field="EndsCount" width="10%">EndsCount</th>
                                            <th field="TotalEnd" width="12%">TotalEnd</th>
                                            <th data-options="field:'TotalEndActual',width:100,align:'right',editor:{type:'numberbox',options:{precision:0}}" align="right">Actual End</th>
                                            <th field="Qty" width="12%">Qty</th>
                                            <th data-options="field:'AllowanceWarp',width:50,align:'right',editor:{type:'numberbox',options:{precision:2}}" align="right">Allowance(%)</th>
                                            <th data-options="field:'LDNo',width:100,height:60 ,align:'Left',editor:{type:'text'}" align="Left">LDNo</th>

                                            <th field="TwistedGroup" width="6%" align="center" formatter="formatTwisted">Twisted</th>
                                            <th data-options="field:'ValueMin',width:50,align:'right',editor:{type:'numberbox',options:{precision:2}}" align="right">Value(Deduct)</th>
                                            <th data-options="field:'SLNo',width:20,height:60 ,align:'Left',editor:{type:'text'}" align="Left">SLNo</th>
                                        </tr>
                                    </thead>
                                </table>
                                <div id="toolbar_Warp">
                                    <input type="text" id="txtLDNo_Warp" style="width:10%" placeholder="Enter LD No and Press Enter">
                                    <a id="btnAddLD_Warp" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-pick" plain="true">Pick</a>
                                    <a id="btnRemoveDetail" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-remove" plain="true">Remove</a>
                                    <a id="btnPickDetailWarp" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-edit" plain="true">Change</a>
                                </div>
                                @*<table id="tblWarpPlan" title="" class="easyui-datagrid" style="width:100%;height:220px;" rownumbers="true" pagination="false" singleselect="true" autorowheight="false" autorowwidth="false"></table>*@
                            </div>

                            <div title="Weft Plan" data-options="iconCls:'icon-details'" style="overflow: auto;">
                                <table id="tblWeftPlan" style="width:100%; height:200px" class="easyui-datagrid" fitcolumns="false" rownumbers="true" pagination="false" singleselect="true" autorowheight="false" toolbar="#toolbar_Weft" data-options="onLoadSuccess: onLoadSuccessWeft,onClickRow: onClickRowFESDWeft,rowStyler: function(index,row){
                                         if (row.ColorName=='Total'){
                                            return 'color:#016B18; font-weight:bold;';
                                        }
                                    }
                    ">
                                    <thead>
                                        <tr>
                                            <th field="ProductName" width="15%"> Count</th>
                                            <th data-options="field:'ColorName',width:120,height:60 ,align:'Left',editor:{type:'text'}" align="Left">Color</th>
                                            <th field="ColorNo" width="10%">LDNo</th>
                                            <th field="EndsCount" width="10%">EndsCount</th>
                                            <th field="TotalEnd" width="12%">TotalEnd</th>
                                            <th field="Qty" width="12%">Qty</th>
                                            <th data-options="field:'LDNo',width:100,height:60 ,align:'Left',editor:{type:'text'}" align="Left">LDNo</th>
                                            <th data-options="field:'AllowanceWarp',width:40,align:'right',editor:{type:'numberbox',options:{precision:2}}" align="right">Allowance(%)</th>
                                            <th field="TwistedGroup" width="6%" align="center" formatter="formatTwisted">Twisted</th>
                                            <th data-options="field:'ValueMin',width:50,align:'right',editor:{type:'numberbox',options:{precision:2}}" align="right">Value(Deduct)</th>
                                            <th data-options="field:'SLNo',width:25,height:60 ,align:'Left',editor:{type:'text'}" align="Left">SLNo</th>
                                        </tr>
                                    </thead>
                                </table>
                                <div id="toolbar_Weft">
                                    <input type="text" id="txtLDNo_Weft" style="width:10%" placeholder="Enter LD No and Press Enter">
                                    <a id="btnAddLD_Weft" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-pick" plain="true">Pick</a>
                                    <a id="btnPickDetailWeft" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-edit" plain="true">Change</a>
                                 
                                </div>
                            </div>
                            <div style="width:100%;" title="Yarn Dyeing Beak Down & Warping Program" data-options="iconCls:'icon-details'" style="overflow: auto; float:left;">
                                @*<table id="tblYarnDyeingBreakDown" title="Yarn Dyeing Beak Down" class="easyui-datagrid" style="width:630px;height:205px;" rownumbers="true" pagination="false" singleselect="true" autorowheight="false" autorowwidth="false" toolbar="#toolbarYDBD"></table>*@
                                <table id="tblYarnDyeingBreakDown" class="easyui-datagrid" style="width:100%;height:200px;" fitcolumns="true" singleselect="true" rownumbers="true" pagination="false" autorowheight="false"
                                       data-options="onClickRow:onClickRow"></table>
                                <div id="toolbarYDBD">
                                </div>
                            </div>
                            <div title="Comments from RnD" data-options="iconCls:'icon-details'" style="overflow: auto; float:left;">
                                <div style="margin-left:0px;width:100%;height:200px">
                                    <table id="tblFabricSpecificationNotes" style="width:100%;height:150px " class="easyui-datagrid" fit="true" fitcolumns="true" rownumbers="true" pagination="false" singleselect="true" autorowheight="false" toolbar="#toolbarFSNote">
                                        <thead>
                                            <tr>
                                                <th field="Note" width="80%"></th>
                                            </tr>
                                        </thead>
                                    </table>
                                    <div id="toolbarFSNote">
                                        @*<a href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-reload" plain="true" onclick="Refresh()"></a>*@
                                        <input type="text" id="txtFabricSpecificationNote" style="width:50%" placeholder="Enter Note and Press Enter">
                                        <a id="btnUpdateFSNote" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-save" plain="true">Update</a>
                                        <a id="btnAddFSNote" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-add" plain="true">Save</a>
                                        <a id="btnEditFSNote" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-edit" plain="true">Edit</a>
                                        <a id="btnDeleteFSNote" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-remove" plain="true">Delete</a>
                                    </div>
                                </div>
                                <div style="margin-left:0px;width:100%;">
                                    <div id="divOutside" >
                                        <label id="lblOutSide">For Out Side:</label>
                                        <input id="chkIsOutSide" style="width:6%;" type="checkbox" />
                                        <input id="txtContractorName" style="width:20%;" placeholder="Type Name" type="text" />
                                        <a id="btnPickContractor" href="javascript:void(0)" class="easyui-linkbutton ics-pick" iconcls="icon-pick" plain="true"></a>
                                        <select id="cboWarpWeftType"></select>
                                        @*<label >Qty(M):</label>
                                        <input id="txtQtySub" class="numberfield" type="text" style="width:10%;" />*@
                                        <a id="btnSaveOutSide" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-add" plain="true">Update Out Side</a>
                                      
                                    </div>
                                </div>
                                </div>
                        </div>
                    </td>
                </tr>

                <tr>
                    <td colspan="3"></td>
                </tr>

                <tr>
                    <td colspan="3"></td>
                </tr>
            </table>
            <fieldset class="actionfieldsetstyle">
                <legend>Actions : </legend><table class="tbl">
                    <tr>
                        <td class="tdActionLabel">
                            <label id="lblFEOSpecificationStaus"></label>
                            <a id="btnApproveFEOS" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-approved" plain="true">Approve</a>
                            <a id="btnSaveDO" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-approved" plain="true">Forward To Dyeing</a>
                            <span>
                                <select id="cboFEOSpecification"></select>
                            </span>
                        </td>
                        <td class="tdAction">
                            @*<a id="btnCancelFEOS" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-remove" plain="true">Delete</a>*@
                            <a id="btnPrintFEOS" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-print" plain="true">Print</a>
                            <label id="lblCreateReviseNo">Create Revise No?</label> <input id="chkIsCreateReviseNo" type="checkbox" checked="checked" />
                            <select style="width:15%;" onchange="ChangeOrderType(true)" id="cboDispoProType">
                                <option value="2">Excess Fabric</option>
                                <option value="3">Excess Dyeing Qty</option>
                                <option value="4">Out Side</option>
                            </select>
                            <a id="btnSave" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-save" plain="true">Save</a>
                            <a id="btnSave_Copy" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-save" plain="true">Save(R)</a>
                            <a id="btnSave_OutSideAll" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-save" plain="true">Save(OutSide)</a>
                            <a id="btnSaveLog" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-save" plain="true">Save(Revise)</a>
                            <a id="btnCloseFEOS" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-cancel" plain="true">Close</a>
                        </td>
                    </tr>
                </table>

            </fieldset>
        </div>
        <div id="winExPIDetail" style="width:550px;" class="easyui-window" title="Fabric info" data-options="modal:true,closed:true,collapsible:false,minimizable:false,maximizable:false,closable:false">
            <div>
                <fieldset>
                    <legend style="font-weight:bold"> Change Informations : </legend>
                    <table border="0" cellspacing="2" cellpadding="2" style="width:100%; font-size:11px; font-weight:bold">

                        <tr id="trIsDeduct">
                            <td style="width:25% ;text-align:right">
                                <label style="width:100%">Beam Type:</label>
                            </td>
                            <td style="width:30%">
                                <select style="width:80%;" id="cboBeamType">
                                    <option value="0">Select one </option>
                                    <option value="1">U Beam</option>
                                    <option value="2">L Beam</option>
                                </select>
                            </td>
                            <td style="width:10% ;text-align:right"></td>
                            <td style="width:35% ;text-align:left"></td>
                        </tr>
                    
                        <tr  style="text-align:left;">
                            <td style="width:25% ;text-align:right">
                                <label>Already Exists?:</label>
                            </td>
                            <td colspan="2" style="width:40%">
                                <table>
                                    <tr>
                                        <td style="text-align:left;"><input id="chkIsDeductYes" type="checkbox" onclick="if(this.checked){IsDeductYes()}else{IsDeductNo()}" /> Yes</td>
                                        <td style="text-align:left;"><input id="chkIsDeductNo" type="checkbox" onclick="if(this.checked){IsDeductNo()}else{IsDeductYes()}" /> No</td>
                                    </tr>
                                </table>
                            </td>
                            <td style="width:35% ;text-align:left"></td>
                        </tr>
                        <tr style="text-align:left;">
                            <td style="width:25% ;text-align:right">
                                <label>Yarn:</label>
                            </td>
                            <td colspan="2" style="width:40%">
                                <table>
                                    <tr>
                                        <td style="text-align:left;"><input id="txtSearchByProductNameWarp" style="width:100%" class="resetfield" type="text" placeholder="Type product name & press enter" /></td>
                                    </tr>
                                </table>
                            </td>
                            <td style="width:35% ;text-align:left"> Value :<input id="txtPValue" style="width:30%" class="resetfield" type="text" /> 
                            Pick :<input id="txtPickEPPI" style="width:30%" class="resetfield" type="text" /></td>
                        </tr>
                        <tr id="trDyeingQtyExtra" style="text-align:left;">
                            <td style="width:25% ;text-align:right">
                                <label>Qty(Kg):</label>
                            </td>
                            <td style="width:30% ;text-align:left"> <input id="txtQty_DO" style="width:30%" class="number" type="text" /></td>
                            <td colspan="2" style="width:45%"></td>
                        </tr>
                        
                    </table>
                </fieldset>
            </div>
            <fieldset>
                <legend style="font-weight:bold"> Action : </legend>
                <table border="0" cellspacing="2" cellpadding="2" style="width:100%; font-size:11px; font-weight:bold;">
                    <tr>
                        <td style="width:100%;text-align:right;">
                            <a id="btnUpdateFSEDetail" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-save" plain="true">OK</a>
                            <a id="btnCloseFSEDetail" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-cancel" plain="true">Close</a>
                        </td>

                    </tr>
                </table>
            </fieldset>
        </div>
</body>
</html>

<style type="text/css">


     .divLabel {
        float: left;
        width: 29%;
        text-align: right;
        margin-right: 3px;
    }

    .divInput {
        float: left;
        width: 69%;
    }

    .tdtblorder, .tdtblFS {
        width: 33.33%;
    }

      .tdtblorder, .tdtblFS2 {
        width: 37.33%;
    }
     .tdtblorder, .tdtblFS3 {
        width: 30.00%;
    }
    .tbl .tdActionLabel {
        font-size: 11px;
        text-align: left;
    }
    
    .tbl .tdAction {
        text-align: right;
    }
   
     .divInput input {
        width: 97%;
        font-size: 11px;
    }
   
     .divInput select {
        width: 99.5%;
    }
    
    .divInput .pickfield {
        width: 85%;
    }

    .divInput .pickBtn {
        width: 10%;
    }

    .divInput .numberfield {
        width: 220px;
    }

    .twoRegion input {
        width: 35%;
        font-size: 11px;
    }

    .twoRegion .numberfield {
        width: 80px;
    }

    
    .tbltdFS {
        font-size: 11px;
    }

    .regionLeftFS {
        float: left;
        width: 32%;
        text-align: right;
        margin-right: 1px;
    }

    .regionRightFS {
        float: left;
        width: 65%;
    }

    .regionRightFS .divleftFS {
        float: left;
        width: 32%;
    }

    .regionRightFS .divrightFS {
        float: left;
        width: 68%;
        text-align: right;
    }

    .regionRightFS .numberfield {
        width: 60px;
    }

    .regionRightFS #txtGroundEndsFS {
        width: 210%;
    }

    .tbtblWarpingProgram {
        font-size: 11px;
    }

    .regionLeftWP {
        float: left;
        width: 55%;
        text-align: right;
        margin-right: 3px;
    }

    .regionRightWP {
        float: left;
        width: 40%;
    }

    .regionRightWP .numberfield {
        width: 138px;
    }
</style>

<script type="text/javascript">
    var _nFSCDID = 0;
    var _nReferenceFSCDID = 0;
    var _oFEOS = null;
    var _bIsApprove = false;
    var _nWarpEnds = 0;
    var _nAllowance = 0;
    var _sBatchNo = "";
    var _sLDNo="";
    var _IsWarp=true;
    var _oFabricSpecificationNotes=[];
    var _oCellRowSpans=[];
    var _oCellRowSpansWeft=[];
    var _nProductID=0;
    var _oAuthorizationRolesMapping=null;
    $(document).ready(function () {

        _sBaseAddress =@Html.Raw( new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(HttpContext.Current.Session[SessionInfo.BaseAddress]));
        var oFEOS =@Html.Raw( new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(Model));
        var nFSCDetailID = @Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(ViewBag.FSCDID));
        _oFabricSpecificationNotes = @Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(ViewBag.FabricSpecificationNotes));
        var oContractor = @Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(ViewBag.Contractor));
        var oWarpWeftTypes=@Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(@ViewBag.WarpWeftTypes));
        _oAuthorizationRolesMapping =@Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(HttpContext.Current.Session[SessionInfo.AuthorizationRolesMapping]));
        
       
        debugger;
        if(oContractor.ContractorID>0)
        {
            $('#txtContractorName').val(oContractor.Name);
        }
        DynamicRefreshList(_oFabricSpecificationNotes, "tblFabricSpecificationNotes");
        $("#cboWarpWeftType").icsLoadCombo({ List: oWarpWeftTypes, OptionValue: "id",  DisplayText: "Value", });
        //$('#txtReedFS').numberbox({ onChange: GetReedWidth, min: 0, precision: 0 });
        $('#txtReedWidthFS').val(0);
        $('#txtCrimpFS').val(3);
        CalculateTotalCrimp();

        $('#txtEndsFS').numberbox({ min: 0, precision: 0 });
        $('#txtPicksFS').numberbox({ min: 0, precision: 0 });

        $('#txtFinishPickFS,#txtFinishEndFS').numberbox({ min: 0, precision: 0 });
        $('#txtGreigeWidthFS').numberbox({ min: 2, precision: 2 });
        $('#txtFabricWidth').numberbox({ min: 2, precision: 2 });

        $(".number").val(0);

        $('#txtSelvedgeEnds,#txtSelvedgeTotal,#txtSelvedgeEndTwo').val(0);
        Initialization(oFEOS,((sessionStorage.length>0)?sessionStorage.getItem('Operation'):'New'));
        //if(oFEOS.FEOSID<=0){
        //    GetFabricSalesContactDetail(nFSCDetailID)
        //}
        RefreshControlLayout();
        $("#btnUpdateFSNote").hide();
        $("#progressbar").progressbar({ value: 0 });
        $("#progressbarParent").hide();
        
    });

    function updateProgress() {
        var value =$('#progressbar').progressbar('getValue');
        if (value < 96){
            value += Math.floor(Math.random() * 10);
            $('#progressbar').progressbar('setValue', value);
        }
    }
    function hideShow(miliseconds) {
        $("#progressbarParent").hide();
    }
    function Initialization(oFEOS, sOperation){
        ResetControllFEOS();
        debugger;
        $('#btnApproveFEOS,#btnSaveLog,#btnSave_Copy,#btnCancel,#btnExeNo,#btnSave_OutSideAll').hide();
        $("#chkIsCreateReviseNo,#lblCreateReviseNo,#cboDispoProType").hide();
        if(sOperation!="Copy")
        {
            if(oFEOS.ApproveBy!=0)
            {
                $('#btnApproveFEOS,#btnSave,#btnExeNo').hide();
                sOperation="View";
            }
        }
        if(oFEOS.IsOutSide==true)
        {
            $('btnSaveOutSide').show();
        }
        else{
            $('btnSaveOutSide').hide();
        }
        if(sOperation=="View")
        {
            $('#toolbarOne,#btnSave,#btnApproveFEOS,#toolbarFSNote,#btnExeNo,.ics-pick').hide();
            $('input,select').not('#txtConsumptionNoFS').prop('disabled',true);
        }
       
        else if(sOperation=="Copy")
        {
            $('#btnSave').hide(); $("#txtConsumptionNoFS").val("");
            $('#toolbarOne,#btnSave_Copy,#toolbarFSNote,.ics-pick').show();
            $('input,select').prop('disabled',false);
            $('#cboDispoProType').show();
        }
        else if(sOperation=="Cancel")
        {
            $('#toolbarOne,#btnSave,#toolbarFSNote,.ics-pick,#btnApproveFEOS').hide();
            $('input,select').not('#txtConsumptionNoFS').prop('disabled',true);
            //$('#txtNote_Cancel').prop('disabled',false);
            //$('#btnCancel,#txtNote_Cancel').show();
        }
        else  if(sOperation=="Revise")
        {
            $('#btnSaveLog,#toolbarFSNote').show();
            //$('#toolbarOne,#btnSave,#toolbarFSNote,.ics-pick').show();
            //$('input,select').not('#txtConsumptionNoFS').prop('disabled',false);
            $('#btnApproveFEOS,#btnSave,#btnExeNo').hide();
            $("#chkIsCreateReviseNo").show();
            $("#lblCreateReviseNo").show();
            $('#txtReqFinishLen').prop('disabled',false);
            
        }
        else{
            $('#toolbarOne,#btnSave,#toolbarFSNote,#btnExeNo,#txtExeNo,.ics-pick').show();
           // oFEOS.ForwardToDOby=0;
            //$('input,select').not('#txtConsumptionNoFS').prop('disabled',false);
            //$('.td-col-6 input').css('width','70%');
        }
        //if(oFEOS.ApproveBy!=0)
        //{
        //    $('#toolbarOne,#btnSave,#toolbarFSNote,.ics-pick,#btnApproveFEOS').hide();
        //    $('input,select').not('#txtConsumptionNoFS').prop('disabled',true);
        //}
      
        RefreshControlFEOS(oFEOS);
        ChangecboFSpcType();
    }
    $("#btnSave").click(function () {
        if (!ValidateInputFEOS()) return;
        debugger;
        endEditing();
        endEditingFabricPatternWarp();
        endEditingFabricPatternWeft();
        var oFEOS = RefreshObjectFEOS();
        var obj = {
            BaseAddress: _sBaseAddress,
            Object: oFEOS,
            ObjectId: oFEOS.FEOSID,
            ControllerName: "FabricExecutionOrderSpecification",
            ActionName: "SaveFEOSpecification",
            TableId: "",
            IsWinClose: false,
            Message: (oFEOS.FEOSID>0)?"Update Successfully." : "Save Successfully."
        };
        $.icsSave(obj, function (response)
        {
            if (response.status && response.obj != null) {
                debugger
                if (response.obj.ErrorMessage=="" || response.obj.ErrorMessage==null)
                {
                    _oFEOS = response.obj;
                    RefreshControlFEOS(_oFEOS);
                }
                //if (_oFEOS.FEOSID > 0)  {   RefreshControlFEOS(_oFEOS);}
            }
        });
    });
    $("#btnSaveLog").click(function () {
        if (!ValidateInputFEOS()) return;
        debugger;
        endEditing();
        endEditingFabricPatternWarp();
        endEditingFabricPatternWeft();
        var oFEOS = RefreshObjectFEOS();
       
        if ($("#chkIsCreateReviseNo").is(':checked'))
        {
            oFEOS.IsRevise=true;

            if (!confirm("Confirm to Change this Order with Revise No ?")) return false;
        }else{
            oFEOS.IsRevise=false;
            if (!confirm("Confirm to Change this Order without Revise No ?")) return false;
        }

        var obj = {
            BaseAddress: _sBaseAddress,
            Object: oFEOS,
            ObjectId: oFEOS.FEOSID,
            ControllerName: "FabricExecutionOrderSpecification",
            ActionName: "SaveLog",
            TableId: "",
            IsWinClose: false,
            Message: (oFEOS.FEOSID>0)?"Update Successfully." : "Save Successfully."
        };
        $.icsSave(obj, function (response)
        {
            if (response.status && response.obj != null) {
                if (response.obj.FEOSID > 0)
                    _oFEOS = response.obj;
                if (_oFEOS.FEOSID > 0)  {   RefreshControlFEOS(_oFEOS);}
            }
        });
    });
    function ChangeOrderType(bChange)
    {
        if(parseInt($('#cboDispoProType').val())<=1) return;
        if(parseInt($('#cboDispoProType').val())==4) 
        {
            $('#divOutside').show();
            $("#chkIsOutSide").prop("checked",true);
        }
        else{
            $("#chkIsOutSide").prop("checked",false);
            $('#divOutside').hide();
        }

    }
    $("#btnSave_Copy").click(function () {
        if (!ValidateInputFEOS()) return;
        debugger;
        endEditing();
        endEditingFabricPatternWarp();
        endEditingFabricPatternWeft();
        var oFEOS = RefreshObjectFEOS();

        //if ($("#chkIsRePro").is(':checked'))
        //{
        //    oFEOS.ProdtionType=true;

        //    if (!confirm("Confirm to Issue Re-Production ?")) return false;
        //}else{
        //    oFEOS.ProdtionType=false;
        //    if (!confirm("Confirm to Issue New another Dispo for This Order?")) return false;
        //}

        oFEOS.ProdtionTypeInt= parseInt($('#cboDispoProType').val());
     
        if(oFEOS.ProdtionTypeInt<=1)
        {
            alert("Select a valid Type.");
            $('#cboDispoProType').focus()
            return ;
        }
      
        oFEOS.IsOutSide=false;
        if(oFEOS.ProdtionTypeInt==4)
        {
            oFEOS.IsOutSide=true;
        }

        var ocboDispoProType = document.getElementById("cboDispoProType");
        var selectedText = ocboDispoProType.options[ocboDispoProType.selectedIndex].text;
        if (!confirm("Confirm to Issue New another Dispo for :?"+selectedText)) return false;

      
        oFEOS.FEOSID=0;
        for (var i = 0; i <  oFEOS.FEOSDetails.length; i++)
        {
            oFEOS.FEOSDetails[i].FEOSDID=0;
        }
        for (var i = 0; i <  oFEOS.FabricSpecificationNotes.length; i++)
        {
            oFEOS.FabricSpecificationNotes[i].FEOSID=0;
            oFEOS.FabricSpecificationNotes[i].FabricSpecificationNoteID=0;
            
        }
        var obj = {
            BaseAddress: _sBaseAddress,
            Object: oFEOS,
            ObjectId: oFEOS.FEOSID,
            ControllerName: "FabricExecutionOrderSpecification",
            ActionName: "SaveLog",
            TableId: "",
            IsWinClose: false,
            Message: (oFEOS.FEOSID>0)?"Update Successfully." : "Save Successfully."
        };
        $.icsSave(obj, function (response)
        {
            if (response.status && response.obj != null) {
                if (response.obj.FEOSID > 0)
                {  
                    if (response.obj.ErrorMessage == '' || response.obj.ErrorMessage == null)
                    {
                        _oFEOS=response.obj;
                        RefreshControlFEOS(_oFEOS);
                        window.location.href =  sessionStorage.getItem("BackLink");
                        var nIndex=sessionStorage.getItem('SelectedRowIndex');
                        var oFESs= (sessionStorage.getItem('FabricExecutionOrderSpecifications').length>0)? jQuery.parseJSON(sessionStorage.getItem('FabricExecutionOrderSpecifications')):[] ;
                        oFESs.push(_oFEOS);
                        nIndex=oFESs.length-1;
                        sessionStorage.setItem("SelectedRowIndex", nIndex);
                        sessionStorage.setItem("FabricExecutionOrderSpecifications", JSON.stringify(oFESs));
                        sessionStorage.setItem("BackLink", sBackLink);
                    }
                }
            }
        });
    });

    $("#btnApproveFEOS").click(function (e) {
        debugger;
      
        //if (_bIsApprove) { alert("Unable to approve. Already a specification is approved."); return; }
        if (_oFEOS == null || _oFEOS.FEOSID <= 0) { alert("No valid fabric specification found to approve."); return; }
        if (_oFEOS.ApproveBy != 0) { alert('Already Approved.'); return; }
        var obj =
            {
                BaseAddress: _sBaseAddress,
                Object: _oFEOS,
                ObjectId: _oFEOS.FEOSID,
                ControllerName: "FabricExecutionOrderSpecification",
                ActionName: "ApproveFEOSpecification",
                TableId: "",
                IsWinClose: false,
                Message: "Approved Successfully."
            };
        $.icsSave(obj, function (response) {

            if (response.status && response.obj != null) {

                if (response.obj.FEOSID > 0) {
                    _oFEOS = response.obj;
                    if (_oFEOS.ApproveBy != 0) {
                        RefreshControlFEOS(_oFEOS);
                        $('#btnSave').hide();
                        $("#btnApproveFEOS").hide();
                        $("#btnCancelFEOS").hide();
                        //var nIndex=sessionStorage.getItem('SelectedRowIndex');
                        //var oFESs= (sessionStorage.getItem('FabricExecutionOrderSpecifications').length>0)? jQuery.parseJSON(sessionStorage.getItem('FabricExecutionOrderSpecifications')):[] ;
                        //oFESs.push(_oFEOS);
                        //nIndex=oFESs.length-1;
                        //sessionStorage.setItem("SelectedRowIndex", nIndex);
                        //sessionStorage.setItem("FabricExecutionOrderSpecifications", JSON.stringify(oFESs));
                        //sessionStorage.setItem("BackLink", sBackLink);
                    }
                }
            }
        });

    });
    $("#btnSaveDO").click(function (e) {

        //if (_bIsApprove) { alert("Unable to approve. Already a specification is approved."); return; }
        if (_oFEOS == null || _oFEOS.FEOSID <= 0) { alert("No valid fabric specification found to approve."); return; }
        //if (_oFEOS.ApproveBy == 0) { alert('Yet Not  Approved.'); return; }
        var obj =
            {
                BaseAddress: _sBaseAddress,
                Object: _oFEOS,
                ObjectId: _oFEOS.FEOSID,
                ControllerName: "FabricExecutionOrderSpecification",
                ActionName: "SaveDyeingOrder",
                TableId: "",
                IsWinClose: false,
                Message: "Forward Successfully."
            };
        $.icsSave(obj, function (response) {

            if (response.status && response.obj != null) {

                if (response.obj.FEOSID > 0) {
                    _oFEOS = response.obj;
                    if (_oFEOS.ApproveBy != 0) {
                        RefreshControlFEOS(_oFEOS);
                        $('#btnSave').hide();
                        $("#btnApproveFEOS").hide();
                        $("#btnCancelFEOS").hide();
                    }
                }
            }
        });
    });
    $("#btnSave_OutSideAll").click(function () {
        if (!ValidateInputFEOS()) return;
        debugger;
        endEditing();
        endEditingFabricPatternWarp();
        endEditingFabricPatternWeft();
        var oFEOS = RefreshObjectFEOS();

        oFEOS.IsOutSide=true;

        //if ($("#chkIsRePro").is(':checked'))
        //{
        //    oFEOS.ProdtionType=true;

        //    if (!confirm("Confirm to Issue Re-Production ?")) return false;
        //}else{
        //    oFEOS.ProdtionType=false;
        //    if (!confirm("Confirm to Issue New another Dispo for This Order?")) return false;
        //}
      
        oFEOS.FEOSID=0;
        for (var i = 0; i <  oFEOS.FEOSDetails.length; i++)
        {
            oFEOS.FEOSDetails[i].FEOSDID=0;
        }
        for (var i = 0; i <  oFEOS.FabricSpecificationNotes.length; i++)
        {
            oFEOS.FabricSpecificationNotes[i].FEOSID=0;
            oFEOS.FabricSpecificationNotes[i].FabricSpecificationNoteID=0;
        }
        var obj = {
            BaseAddress: _sBaseAddress,
            Object: oFEOS,
            ObjectId: oFEOS.FEOSID,
            ControllerName: "FabricExecutionOrderSpecification",
            ActionName: "SaveLog",
            TableId: "",
            IsWinClose: false,
            Message: (oFEOS.FEOSID>0)?"Update Successfully." : "Save Successfully."
        };
        $.icsSave(obj, function (response)
        {
            if (response.status && response.obj != null) {
                if (response.obj.FEOSID > 0)
                    response.obj.ContractorID=_oFEOS.ContractorID;
                response.obj.IsOutSide=true;
                    _oFEOS = response.obj;
                RefreshOutParty(_oFEOS);
                if (_oFEOS.FEOSID > 0)  {   RefreshControlFEOS(_oFEOS);}
                window.location.href =  sessionStorage.getItem("BackLink");
                var nIndex=sessionStorage.getItem('SelectedRowIndex');
                var oFESs= (sessionStorage.getItem('FabricExecutionOrderSpecifications').length>0)? jQuery.parseJSON(sessionStorage.getItem('FabricExecutionOrderSpecifications')):[] ;
                oFESs.push(_oFEOS);
                nIndex=oFESs.length-1;
                sessionStorage.setItem("SelectedRowIndex", nIndex);
                sessionStorage.setItem("FabricExecutionOrderSpecifications", JSON.stringify(oFESs));
                sessionStorage.setItem("BackLink", sBackLink);
            }
        });
    });


    $("#cboFEOSpecification").change(function (e) {

        if ($("#cboFEOSpecification").val() > 0) {

            var oFEOS = {
                FEOSID: $("#cboFEOSpecification").val(),
                FSCDID: _oFEOS.FSCDID
            };

            var obj =
            {
                BaseAddress: _sBaseAddress,
                Object: oFEOS,
                ControllerName: "FabricExecutionOrderSpecification",
                ActionName: "GetFEOSpecification",
                IsWinClose: false
            };

            $.icsDataGet(obj, function (response) {
                if (response.status && response.obj != null) {
                    var oFEOS = response.obj;
                    if (oFEOS.FEOSID > 0) {

                        ResetControllFEOS();
                        if (oFEOS.ApproveBy != 0) {
                            $('#btnApproveFEOS').hide();
                            $('#btnSaveLabDipRequest').hide();
                            $("#lblFEOSpecificationStaus").html(" <b> Approved </b>  ");
                        }
                        else {
                            $('#btnApproveFEOS').show();
                            $('#btnSaveLabDipRequest').show();
                            $("#lblFEOSpecificationStaus").html("");
                        }
                        $('#cboFEOSpecification').show();
                        RefreshControlFEOS(oFEOS);
                        RefreshReqQtyLenLoomWarp();
                        DynamicRefreshList(oFEOS.FabricSpecificationNotes, "tblFabricSpecificationNotes");
                        //$("#winFabricSpecification").icsWindow('open', 'Fabric Specification');
                    }
                }
            });
        }
    });


    $("#btnCancelFEOS").click(function () {

        if (_oFEOS == null || _oFEOS.FEOSID <= 0) { alert("No valid fabric specification found to delete."); return; }
        if (_oFEOS.ApproveBy != 0) { alert('Already Approved.'); return; }
        if (!confirm("Confirm to Delete?")) return;
        var obj =
        {
            BaseAddress: _sBaseAddress,
            Object: _oFEOS,
            ControllerName: "FabricExecutionOrderSpecification",
            ActionName: "DeleteFEOSpecification",
            TableId: "",
            IsWinClose: false
        };
        $.icsDelete(obj, function (response) {

            if (response.status && response.Message != "") {

                if (response.Message == "deleted") {
                    ResetControllFEOS();
                }
            }
        });



    });

  

    $("#btnPrintFEOS").click(function () {
        if (_oFEOS == null || _oFEOS.FEOSID <= 0) { alert("Yet not created."); return; }
        var nts = ((new Date()).getTime()) / 1000;
        window.open(_sBaseAddress + '/FabricExecutionOrderSpecification/PrintFabricSpecification?nId=' + _oFEOS.FEOSID + "&nts=" + nts, "_blank");
    });

    $("#btnCloseFEOS").click(function (e) {
        window.location.href =  sessionStorage.getItem("BackLink");
    });

  
    $("#txtReqFinishLen").keyup(function (e) {

        RefreshReqQtyLenLoomWarp();
    });
   

    $("#txtGriegeDemandFSPercentage,#txtReqLenAdd,#txtQtyExtraMet,#txtReqLoomPP,#txtLoomPPAdd").keyup(function (e) {

        RefreshReqQtyLenLoomWarp();
    });

    function RefreshReqQtyLenLoomWarp() {

        debugger;
        var txtQtyExtraMet=parseFloat($("#txtQtyExtraMet").val());
        if (isNaN(txtQtyExtraMet)) {txtQtyExtraMet = 0;}
        $('#txtGriegeDemandFSDefault').val(parseFloat($("#txtReqFinishLen").val())+parseFloat(txtQtyExtraMet.toFixed(2)));

        var nGriegeDemandDefault = $('#txtGriegeDemandFSDefault').val();
        var nPercentage = $('#txtGriegeDemandFSPercentage').val();
        var nReqLoomPP = $('#txtReqLoomPP').val();
        var ntxtReqLenAdd = $('#txtReqLenAdd').val();
        var ntxtLoomPPAdd = $('#txtLoomPPAdd').val();
        if (isNaN(ntxtReqLenAdd)) {
            ntxtReqLenAdd = 0;
        }
        var nReqWarpLenFSPercentage = $('#txtReqWarpLenFSPercentage').val();
        debugger;
        var nGriegeDemand = 0;
        if (nGriegeDemandDefault > 0) {
            nGriegeDemand =parseFloat(ntxtReqLenAdd)+ parseFloat(parseFloat(nGriegeDemandDefault) / ((100-parseFloat(nPercentage)) / 100)); //parseFloat(nGriegeDemandDefault) + ((parseFloat(nGriegeDemandDefault) * parseFloat(nPercentage)) / 100);
        }
        if (isNaN(nGriegeDemand)) {
            nGriegeDemand = 0;
        }
        $('#txtGriegeDemandFS,#txtReqLoomProdDefault').val(nGriegeDemand.toFixed(2));
        if (nGriegeDemand > 0) {
            nGriegeDemand= parseFloat(ntxtLoomPPAdd)+parseFloat(nGriegeDemand) / ((100- parseFloat(nReqLoomPP)) / 100);//parseFloat((parseFloat(nGriegeDemand)+parseFloat($('#txtLoomPPAdd').val()))/ ((100-parseFloat(nReqLoomPP)) / 100));/// parseFloat(nGriegeDemand) + ((parseFloat(nGriegeDemand) * parseFloat(nReqLoomPP)) / 100);
            $('#txtReqLoomProduction,#txtReqWarpLenFSDefault').val(parseFloat(nGriegeDemand.toFixed(2)));
        }
        if (nGriegeDemand > 0) {
            nGriegeDemand= parseFloat($('#txtWarpLenAdd').val())+parseFloat(nGriegeDemand.toFixed(2))/((100- parseFloat(nReqWarpLenFSPercentage))/100.0);
           // nGriegeDemand=parseFloat((parseFloat(nGriegeDemand)+parseFloat($('#txtWarpLenAdd').val()))/((100-parseFloat(nReqWarpLenFSPercentage)) / 100));// parseFloat(nGriegeDemand) + ((parseFloat(nGriegeDemand) * parseFloat(nReqWarpLenFSPercentage)) / 100);
            $('#txtReqWarpLenFS').val(parseFloat(nGriegeDemand.toFixed(2)));
        }
    }
    $("#txtReqWarpLenFSPercentage,#txtReqWarpLenFSDefault,#txtWarpLenAdd").keyup(function (e) {
        RefreshReqQtyLenLoomWarp();
        //var nGriegeDemandDefault = $('#txtReqWarpLenFSDefault').val();
        //var nPercentage = $('#txtReqWarpLenFSPercentage').val();
        //var ntxtWarpLenAdd = $('#txtWarpLenAdd').val();
        //debugger;
        //var nGriegeDemand = 0;
        //if (nGriegeDemandDefault > 0) {
        //    nGriegeDemand = parseFloat(ntxtWarpLenAdd)+(parseFloat(nGriegeDemandDefault)/((100- parseFloat(nPercentage)) / 100));
        //}
        //if (isNaN(nGriegeDemand)) {
        //    nGriegeDemand = 0;
        //}
        //$('#txtReqWarpLenFS').val(nGriegeDemand.toFixed(2));
    });

 

    $("#txtGriegeDemandFS").keyup(function (e) {
        var nGriegeDemandFS = parseFloat($('#txtGriegeDemandFS').val());
        var nGriegeDemandFSDefault = parseFloat($('#txtGriegeDemandFSDefault').val());
        var nReqLoomPP = $('#txtReqLoomPP').val();
        var nReqWarpLenFSPercentage = $('#txtReqWarpLenFSPercentage').val();
        var ntxtLoomPPAdd = $('#txtLoomPPAdd').val();
        var ntxtWarpLenAdd = $('#txtWarpLenAdd').val();
        var nPercentage1 = 0;
        if ((nGriegeDemandFS - nGriegeDemandFSDefault) == 0) {
            nPercentage1 = 0;
        }
        else {
            nPercentage1 =(100-((nGriegeDemandFSDefault*100/nGriegeDemandFS)));
        }
        if (isNaN(nPercentage1)) {
            nPercentage1 = 0;
        }
        $('#txtGriegeDemandFSPercentage').val(parseFloat(nPercentage1.toFixed(2)));
        if (nGriegeDemandFS > 0) {
            $('#txtReqLoomProdDefault').val(parseFloat(nGriegeDemandFS.toFixed(2)));
        }
        debugger;
        if (nGriegeDemandFS > 0) {
            nGriegeDemandFS= (parseFloat(nGriegeDemandFS)/ ((100-parseFloat(nReqLoomPP))/100))+parseFloat(ntxtLoomPPAdd);
            $('#txtReqLoomProduction,#txtReqWarpLenFSDefault').val(parseFloat(nGriegeDemandFS.toFixed(2)));
        }
        if (nGriegeDemandFS > 0) {
            nGriegeDemandFS= (parseFloat(nGriegeDemandFS) /((100- parseFloat(nReqWarpLenFSPercentage)) / 100))+parseFloat(ntxtWarpLenAdd);
            $('#txtReqWarpLenFS').val(parseFloat(nGriegeDemandFS.toFixed(2)));
        }
    });

    $("#txtReqLoomProduction").keyup(function (e) {
        debugger;
        var nGriegeDemandRLP = parseFloat($('#txtReqLoomProdDefault').val());
        var nReqLoomProduction = parseFloat($('#txtReqLoomProduction').val());
        var nReqWarpLenFSPercentage = $('#txtReqWarpLenFSPercentage').val();
        var ntxtLoomPPAdd = $('#txtLoomPPAdd').val();
        var ntxtWarpLenAdd = $('#txtWarpLenAdd').val();

        if (isNaN(ntxtLoomPPAdd)) {
            ntxtLoomPPAdd = 0;
        }
        var nPercentage1 = 0;
        if ((nReqLoomProduction - nGriegeDemandRLP) == 0) {
            nPercentage1 = 0;
        }
        else {
            nPercentage1 =  100-((nGriegeDemandRLP*100)/(nReqLoomProduction-ntxtLoomPPAdd))
        }
        if (isNaN(nPercentage1)) {
            nPercentage1 = 0;
        }
        $('#txtReqLoomPP').val(parseFloat(nPercentage1.toFixed(2)));
        $('#txtReqWarpLenFSDefault').val(parseFloat(nReqLoomProduction.toFixed(2)));
       
        if (nReqLoomProduction > 0) {
           // nReqLoomProduction=parseFloat(nReqLoomProduction) + ((parseFloat(nReqLoomProduction) * parseFloat(nReqWarpLenFSPercentage)) / 100);
            nReqLoomProduction=  (parseFloat(nReqLoomProduction) /((100- parseFloat(nReqWarpLenFSPercentage)) / 100))+parseFloat(ntxtWarpLenAdd);
            $('#txtReqWarpLenFS').val(parseFloat(nReqLoomProduction.toFixed(2)));
        }
    });
    $("#txtReqWarpLenFS").keyup(function (e) {

        _oFEOS.RequiredWarpLength = parseFloat($('#txtReqWarpLenFS').val());
        var nGriegeDemandFSDefault = parseFloat(  $('#txtReqWarpLenFSDefault').val());
        var txtWarpLenAdd = parseFloat($('#txtWarpLenAdd').val());
     
        var nPercentage = 100.0-(nGriegeDemandFSDefault*100.0/(parseFloat(_oFEOS.RequiredWarpLength-txtWarpLenAdd)));
        if (isNaN(nPercentage)) {
            nPercentage = 0;
        }
        $('#txtReqWarpLenFSPercentage').val(parseFloat(nPercentage.toFixed(2)));

    });
   

  
    $("#txtReedWidthFS").keyup(function (e) {
        var nReedWidth = parseFloat($(this).val());
        var nCrimp = parseFloat($("#txtCrimpFS").val());
        $("#txtTotalCrimpFS").val(nReedWidth + nCrimp);
    });

    $("#txtCrimpFS").keyup(function (e) {
        var nCrimp = parseFloat($(this).val());
        var nReedWidth = parseFloat($("#txtReedWidthFS").val());
        $("#txtTotalCrimpFS").val(nReedWidth + nCrimp);
    });

    $("#txtSelvedgeEndTwo,#txtSelvedgeEnds").keyup(function (e) {
        GetTotalEnds();
    });
    
    $("#txtReedFS,#txtDent").keyup(function (e) {
        debugger;
        GetTotalEnds();
    });

    $("#txtTotalEndsAdd").keyup(function (e) {
        debugger;
        GetTotalEnds();
    });

    $("#txtRepeatSection").keyup(function (e) {
        GetSectionEnds(); 
    });

    function GetTotalEnds() {
        debugger;
        var ntxtReedFS = parseFloat($('#txtReedFS').val());
        var txtDent = parseFloat($('#txtDent').val());
        var ntxtReedWidth=0;
        var txtFinishEndFS = parseFloat($('#txtFinishEndFS').val());
        var ntxtFabricWidth = parseFloat($('#txtFabricWidth').val());
        var ntxtTotalEndsAdd = parseFloat($('#txtTotalEndsAdd').val());
        var ncboAdd = parseFloat($('#cboAdd').val());
        var ntxtTotalEnds =0;
        if (isNaN(txtDent)) {txtDent = 2;}
        if (isNaN(ntxtReedFS)) {ntxtReedFS = 0;}
        if (isNaN(txtFinishEndFS)) {txtFinishEndFS = 0;}
        if (isNaN(ntxtFabricWidth)) {ntxtFabricWidth = 0;}
        ntxtReedFS=(ntxtReedFS*txtDent)/2;
        if(ntxtReedFS>0)
        {
            ntxtReedWidth=(txtFinishEndFS*ntxtFabricWidth)/ntxtReedFS;
        }
        $("#txtTotalEnds").val(parseFloat(ntxtReedWidth*ntxtReedFS).toFixed(0));
        if(ncboAdd==1){
            $('#txtReedWidthFS').val(((parseFloat($('#txtTotalEnds').val())+parseFloat(ntxtTotalEndsAdd))/parseFloat(ntxtReedFS)).toFixed(2));
            ntxtTotalEnds=(parseFloat($('#txtTotalEnds').val())+parseFloat(ntxtTotalEndsAdd));
        }
        else{
            $('#txtReedWidthFS').val(((parseFloat($('#txtTotalEnds').val())-parseFloat(ntxtTotalEndsAdd))/parseFloat(ntxtReedFS)).toFixed(2));
            ntxtTotalEnds=(parseFloat($('#txtTotalEnds').val())-parseFloat(ntxtTotalEndsAdd));
        }
        var ntxtSelvedgeEnds = parseFloat($('#txtSelvedgeEnds').val());
        var ntxtSelvedgeEndTwo = parseFloat($('#txtSelvedgeEndTwo').val());
        if (isNaN(ntxtSelvedgeEndTwo)) {ntxtSelvedgeEndTwo = 0;}
        if (isNaN(ntxtSelvedgeEnds)) {ntxtSelvedgeEnds = 0;}
        ntxtSelvedgeEndTwo=ntxtSelvedgeEndTwo+ntxtSelvedgeEnds;
        $('#txtSelvedgeTotal').val(parseFloat(ntxtSelvedgeEndTwo.toFixed(2)));
        $("#txtGroundEndsFS").val(parseFloat(ntxtTotalEnds).toFixed(0)-parseFloat(ntxtSelvedgeEndTwo).toFixed(0));
        var nGroundEnd=parseFloat(ntxtTotalEnds).toFixed(0)-parseFloat(ntxtSelvedgeEndTwo).toFixed(0);
        var ntxtEndsFS =$('#txtEndsFS').numberbox('getValue');
        if(ntxtEndsFS>0)
        {
            $('#txtGreigeWidthFS').numberbox('setValue', (parseFloat(ntxtTotalEnds).toFixed(0)/ ntxtEndsFS));
        }
        if(parseFloat(nGroundEnd)>0)
        {
            if(parseInt( $('#cboSEBeamType').val()==1))
            {
                _oFEOS.TotalEndsUB=parseFloat(nGroundEnd)/2+parseFloat(ntxtSelvedgeEndTwo).toFixed(0);
                _oFEOS.TotalEndsLB=parseFloat( nGroundEnd)/2;
            }
            else if(parseInt( $('#cboSEBeamType').val()==2))
            {
                _oFEOS.TotalEndsUB=parseFloat(nGroundEnd)/2+parseFloat(ntxtSelvedgeEndTwo).toFixed(0);
                _oFEOS.TotalEndsLB=parseFloat(nGroundEnd)/2;
            }
        }
        $('#txtTotalEndsU').val(parseFloat(_oFEOS.TotalEndsUB.toFixed(2)));
        $('#txtTotalEndsL').val(parseFloat(_oFEOS.TotalEndsLB.toFixed(2)));
    }
    

    /*-------------- Reference FEO Value set -----------------*/

    function SetRefFEOSValue(oFEOS) {
        $('#txtFinishPickFS').numberbox('setValue', (oFEOS != null) ? oFEOS.FinishPick : 0);
        $('#txtFinishEndFS').numberbox('setValue', (oFEOS != null) ? oFEOS.FinishEnd : 0);
        $('#txtGreigeWidthFS').numberbox('setValue', (oFEOS != null) ? oFEOS.GreigeFabricWidth : 0);
        $('#txtFabricWidth').numberbox('setValue', (oFEOS != null) ? oFEOS.FinishWidth : 0);
        $('#txtEndsFS').numberbox('setValue', (oFEOS != null) ? oFEOS.Ends : 0);
        $('#txtPicksFS').numberbox('setValue', (oFEOS != null) ? oFEOS.Picks : 0);
        $('#txtGriegeDemandFS').val((oFEOS != null) ? oFEOS.GreigeDemand : 0);
        $('#txtDent').val((oFEOS != null) ? oFEOS.Dent : 0);
        $('#txtReqWarpLenFSDefault').val($("#txtReqFinishLen").val());
        $('#txtGriegeDemandFSDefault').val(parseFloat($("#txtReqFinishLen").val())+parseFloat($("#txtQtyExtraMet").val()));
        $('#txtReqWarpLenFS').val((oFEOS != null) ? oFEOS.RequiredWarpLength : $("#txtReqFinishLen").val());
        //$('#txtGroundEndsFS').numberbox('setValue', (oFEOS != null) ? oFEOS.GroundEnds : 0);
        $('#txtGroundEndsFS').val((oFEOS != null) ? oFEOS.GroundEnds : 0);
        //$('#txtReqLoomProduction').numberbox('setValue', (oFEOS != null) ? oFEOS.ReqLoomProduction : 0);
        $('#txtSelvedgeEnds').val((oFEOS != null) ? oFEOS.SelvedgeEnds : 0);
        $('#txtSelvedgeEndTwo').val((oFEOS != null) ? oFEOS.SelvedgeEndTwo : 0);
        $('#txtSelvedgeTotal').val((oFEOS != null) ? oFEOS.SelvedgeEnds+oFEOS.SelvedgeEndTwo : 0);

        $('#txtReedFS').val((oFEOS != null) ? oFEOS.Reed : 0);
        //$('#txtReedFS').numberbox('setValue', (oFEOS != null) ? oFEOS.Reed : 0);
        $('#txtReedWidthFS').val((oFEOS != null) ? oFEOS.ReedWidth : 0);
        $("#txtCrimpFS").val((oFEOS != null) ? oFEOS.Crimp : 3);
        $('#txtDent').val((oFEOS != null) ? oFEOS.Dent : 0);
        CalculateTotalCrimp();
        GenerateWarpingPrograms(oFEOS);
    }

    function CalculateTotalCrimp() {
        var nReedWidth = parseFloat($("#txtReedWidthFS").val());
        var nCrimp = parseFloat($("#txtCrimpFS").val());
        $("#txtTotalCrimpFS").val(nReedWidth + nCrimp);
    }


    /*-------------- FEO Specification -----------------*/

    function RefreshControlFEOS(oFEOS) {
        debugger

        _oFEOS = oFEOS;
        _nFSCDID = oFEOS.FSCDID;
        _nReferenceFSCDID = _oFEOS.ReferenceFSCDID;
        
        $("#txtExeNo").val(_oFEOS.ExeNo);
        $("#txtOrderNoFS").val(_oFEOS.SCNoFull);
        $("#txtFabricIDFS").val(_oFEOS.FabricNo);
        $("#txtConsumptionNoFS").val(_oFEOS.FESONo);
        //$("#txtPINoFS").val(_oFEOS.PINo);
        $("#txtConstructionFS").val(_oFEOS.Construction);
        $("#txtCompositionFS").val(_oFEOS.Composition);
        $("#txtFabricWidthFS").val(_oFEOS.FinishWidthFS);
        $("#txtBuyerFS").val(_oFEOS.BuyerName);
        $("#txtWeaveFS").val(_oFEOS.Weave);
        $("#txtHLRefFS").val(_oFEOS.HLReference);
        $("#txtFinishTypeFS").val(_oFEOS.FinishType);
        $("#txtQtyInYardFS").val(_oFEOS.QtyOrder);
        var nQtyInMtr = parseFloat((_oFEOS.QtyOrder/ 1.09361).toFixed(2));
        $("#txtQtyInMeterFS").val(nQtyInMtr);
    
        $("#txtQtyExtraMet").val(_oFEOS.QtyExtraMet);
        $("#txtWarpCount").val(_oFEOS.WarpCount);
        $("#txtWeftCount").val(_oFEOS.WeftCount);
        //$('#txtFinishEndFS').numberbox('setValue', (_oFEOS.FinishPick == 0 ? _oFEOS.FabricPattern.Pick : _oFEOS.FinishPick));
        $('#txtFinishEndFS').numberbox('setValue', _oFEOS.FinishEnd);
        $('#txtFinishPickFS').numberbox('setValue', _oFEOS.FinishPick);
        $('#txtGreigeWidthFS').numberbox('setValue', _oFEOS.GreigeFabricWidth);
        $('#txtFabricWidth').numberbox('setValue', _oFEOS.FinishWidth);
        $('#txtEndsFS').numberbox('setValue', _oFEOS.Ends);
        $('#txtPicksFS').numberbox('setValue', _oFEOS.Picks);
      
      
        //$("#txtAllowancePercent").val((_oFEOS.AllowancePercent == 0 ? 4 : _oFEOS.AllowancePercent));
    
        debugger;
        //var nReqWarpLenFS = parseFloat($('#txtReqWarpLenFS').val());
        //var nReqWarpLenFSDefault = parseFloat($('#txtReqWarpLenFSDefault').val());
        //var nPercentage = (100 * (nReqWarpLenFS - nReqWarpLenFSDefault)) / nReqWarpLenFSDefault;
        //$('#txtReqWarpLenFSPercentage').val(parseFloat(nPercentage.toFixed(2)));


        $("#txtReqFinishLen").val(_oFEOS.OrderQtyInMeter);
        $("#txtGriegeDemandFSDefault").val(parseFloat(_oFEOS.OrderQtyInMeter.toFixed(2))+parseFloat(_oFEOS.QtyExtraMet.toFixed(2)));
        $("#txtGriegeDemandFS,#txtReqLoomProdDefault").val(_oFEOS.GreigeDemand);

        var nGriegeDemandFS = parseFloat($('#txtGriegeDemandFS').val());
        var nGriegeDemandFSDefault = parseFloat($('#txtGriegeDemandFSDefault').val());
        if(_oFEOS.FEOSID>0)
        {
            var nPercentage1 = 100-(((parseFloat(nGriegeDemandFSDefault.toFixed(2)))*100)/nGriegeDemandFS);
            if (isNaN(nPercentage1)||parseFloat(nPercentage1)<=0) {nPercentage1 = 0;}
            $('#txtGriegeDemandFSPercentage').val(parseFloat(nPercentage1.toFixed(2)));
        }
        else{
            $('#txtGriegeDemandFSPercentage').val(parseFloat(_oFEOS.GrayTargetInPercent.toFixed(2)));
        }

        

        // Re. Loom
        $("#txtLoomPPAdd").val(parseFloat(_oFEOS.LoomPPAdd).toFixed(2));
        $('#txtReqLoomProduction').val(parseFloat(_oFEOS.ReqLoomProduction.toFixed(2)));
        var nPercentage1 = 100-(_oFEOS.GreigeDemand*100/(_oFEOS.ReqLoomProduction-_oFEOS.LoomPPAdd));
        $('#txtReqLoomPP').val(parseFloat(nPercentage1.toFixed(2)));

        // WarpLength
        $('#txtReqWarpLenFS').val(_oFEOS.RequiredWarpLength);
        $('#txtReqWarpLenFSDefault').val(_oFEOS.ReqLoomProduction.toFixed(2));
        $("#txtWarpLenAdd").val(parseFloat(_oFEOS.WarpLenAdd).toFixed(2));
        var nPercentage = 100.0-(_oFEOS.ReqLoomProduction*100.0/(parseFloat(_oFEOS.RequiredWarpLength-_oFEOS.WarpLenAdd)));
        if (isNaN(nPercentage)||parseFloat(nPercentage)<=0) {nPercentage = 0;}
        $('#txtReqWarpLenFSPercentage').val(parseFloat(nPercentage.toFixed(2)));
        //  RefreshReqQtyLenLoomWarp();
        //$('#txtReqLoomProduction').numberbox('setValue', _oFEOS.ReqLoomProduction);
        $('#txtSelvedgeEnds').val( _oFEOS.SelvedgeEnds);
        $('#txtSelvedgeEndTwo').val(_oFEOS.SelvedgeEndTwo);
        $('#txtSelvedgeTotal').val(_oFEOS.SelvedgeEnds+_oFEOS.SelvedgeEndTwo);
        $('#txtNoOfFrame').val( _oFEOS.NoOfFrame);
        $('#txtNoOfSection').val( _oFEOS.NoOfSection);
        $('#txtGroundEndsFS').val( _oFEOS.GroundEnds);
       
        //  $('#txtGroundEndsFS').numberbox('setValue', _oFEOS.GroundEnds);
        $('#txtDent').val((oFEOS != null) ? parseFloat(oFEOS.Dent) : 0);
        //$('#txtReedFS').numberbox('setValue', (_oFEOS.Reed == 0 ? _oFEOS.FabricPattern.Reed : _oFEOS.Reed));
        $('#txtReedFS').val( (_oFEOS.Reed == 0 ? 0 : _oFEOS.Reed));
        $('#txtReedWidthFS').val((_oFEOS.ReedWidth == 0 ? GetReedWidthFS() : _oFEOS.ReedWidth));
        $("#txtCrimpFS").val(_oFEOS.Crimp);
        $("#txtTotalEnds").val(parseFloat(_oFEOS.TotalEnds).toFixed(0));
        $("#txtTotalEndsAdd").val(parseFloat(_oFEOS.TotalEndsAdd).toFixed(0));
      
        if(_oFEOS.IsTEndsAdd){ $('#cboAdd').val(1)};
        if(!_oFEOS.IsTEndsAdd){ $('#cboAdd').val(0)};
        $('#txtWeftColor').val(_oFEOS.WeftColor);
        $('#txtRefNote').val(_oFEOS.RefNote);
    
        $('#cboFSpcType').val((oFEOS != null) ? parseInt(oFEOS.FSpcType) : 0);
        $('#cboSEBeamType').val((oFEOS != null) ? parseInt(oFEOS.SEBeamType) : 0);
        $('#txtTotalEndsU').val((oFEOS != null) ? parseFloat(oFEOS.TotalEndsUB) : 0);
        $('#txtTotalEndsL').val((oFEOS != null) ? parseFloat(oFEOS.TotalEndsLB) : 0);
        $('#txtReqWarpLenLB').val((oFEOS != null) ? parseFloat(oFEOS.ReqWarpLenLB) : 0);
        $("#chkIsSepBeam").prop("checked", oFEOS.IsSepBeam);
        $("#chkIsOutSide").prop("checked", oFEOS.IsOutSide);
        $('#cboWarpWeftType').val(oFEOS.WarpWeftType); 
        $('#cboDispoProType').val(oFEOS.ProdtionTypeInt);
        ChangeOrderType(false);
       
        
    

        //$('#txtQtySub').val(oFEOS.QtySub);
     //   $('#txtQtySub').numberbox('setValue', ((oFEOS.IsOutSide==true) ? oFEOS.QtySub : oFEOS.Qty));
        CalculateTotalCrimp();
        _nWarpEnds=0;
        debugger;
        //GenerateWarpWeftGrid(_oFEOS.WarpPlans, true);
        //GenerateWarpWeftGrid(_oFEOS.WeftPlans, false);
        $("#tblWarpPlan").datagrid("hideColumn", "TwistedGroup");
        $("#tblWeftPlan").datagrid("hideColumn", "TwistedGroup");
        //$("#tblWeftPlan").datagrid("hideColumn", "AllowanceWarp");
        if(oFEOS.FEOSDetails.length>0 && oFEOS.FEOSDetails[0].ProductID>0){
            _oCellRowSpans=oFEOS.FEOSDetails[0].CellRowSpans;
            _oCellRowSpansWeft=oFEOS.FEOSDetails[0].CellRowSpansWeft;
            if(_oCellRowSpans.length>0)
            {
                $("#tblWarpPlan").datagrid("showColumn", "TwistedGroup");
                $("#tblWeftPlan").datagrid("showColumn", "TwistedGroup");
                //$("#tblWeftPlan").datagrid("showColumn", "AllowanceWarp");
            }
           
        }
        else{
            _oCellRowSpans=[];
            _oCellRowSpansWeft=[];
        }
        var oWarpPlans = [];
        var oWeftPlans = [];
        debugger
        for (var i = 0; i < oFEOS.FEOSDetails.length ; i++)
        {
            if( oFEOS.FEOSDetails[i].IsWarp==true)
            {
                if(!IsExistTwist(oFEOS.FEOSDetails[i],oWarpPlans))
                {
                    _nWarpEnds= _nWarpEnds+parseFloat(oFEOS.FEOSDetails[i].EndsCount);
                }
                oWarpPlans.push( oFEOS.FEOSDetails[i]);
            }
            else
            {
                oWeftPlans.push( oFEOS.FEOSDetails[i]);
            }
        }
     
        DynamicRefreshList(oWarpPlans, "tblWarpPlan");
        DynamicRefreshList(oWeftPlans, "tblWeftPlan");
        RefreshSummary_Warp();
        RefreshSummary_Weft();
        GenerateYarnDyeingBreakDown(_oFEOS.YarnDyeingBreakDowns);
        GenerateWarpingPrograms(_oFEOS);
        GetSectionEnds();
        if (_bIsApprove) { $("#lblFEOSpecificationStaus").html("<b>Approved</b>"); $("#btnCancelFEOS").hide(); $("#btnSave").show(); }
        if (_oFEOS.FabricSpecifications.length > 0) {

            for (var i = 0; i < _oFEOS.FabricSpecifications.length; i++) {

                if (_oFEOS.FabricSpecifications[i].ApproveBy > 0) {
                    _bIsApprove = true;
                    $("#lblFEOSpecificationStaus").html("<b>" + _oFEOS.FabricSpecifications[i].SpecificationNo +" "+_oFEOS.FabricSpecifications[i].ProdtionTypeSt+ " Is Approved.</b>");
                    $("#btnCancelFEOS").show();
                    $("#btnSave").show();
                }
            }

            $("#cboFEOSpecification").show();
            $("#cboFEOSpecification").icsLoadCombo({
                List: _oFEOS.FabricSpecifications,
                OptionValue: "FEOSID",
                DisplayText: "SpecificationNo",
            });
        }
        //if (_oFEOS.ApproveBy == 0) { $('#btnApproveFEOS').show(); } else { $('#btnApproveFEOS').hide(); }
    }

    function IsExistTwist(oFEOSDetail ,oWarpPlans)
    {
        for (var i = 0; i < oWarpPlans.length; i++) {
            if ( parseInt(oFEOSDetail.TwistedGroup)>0 && parseInt(oWarpPlans[i].TwistedGroup) ==parseInt(oFEOSDetail.TwistedGroup))
            {
                return true;
            }
        }
        return false;
    }

    function ValidateInputFEOS() {
        if (_nFSCDID <= 0) {
            alert("Select a valid fabric execution order.");
            return false;
        }
        return true;
    }

    function RefreshObjectFEOS() {
        var oWarpPlans = [];
        var oDetails = [];
        var oWeftPlans = [];
        var oWarpPlans = $("#tblWarpPlan").datagrid("getRows");
        var oWeftPlans = $("#tblWeftPlan").datagrid("getRows");
        for (var i = 0; i < oWarpPlans.length; i++)
        {
            oDetails.push(oWarpPlans[i]);
        }
        for (var i = 0; i < oWeftPlans.length; i++)
        {
            oDetails.push(oWeftPlans[i]);
        }
        var bIsTEndsAdd=false;
        if($("#cboAdd").val()==1){bIsTEndsAdd=true}

        var oFEOS = {
            FEOSID: (_oFEOS != null) ? _oFEOS.FEOSID : 0,
            FSCDID: (_oFEOS != null) ? _oFEOS.FSCDID : _nFSCDID,
            ReferenceFSCDID: _nReferenceFSCDID,
            Reed: parseFloat($('#txtReedFS').val()),// $('#txtReedFS').numberbox('getValue'),
            Dent: parseFloat($('#txtDent').val()),
            ReedWidth: parseFloat($('#txtReedWidthFS').val()),
            Crimp: parseFloat($('#txtCrimpFS').val()),
            TotalEnds:$("#txtTotalEnds").val(),
            TotalEndsAdd:$("#txtTotalEndsAdd").val(),
            IsTEndsAdd:bIsTEndsAdd,
            WarpLenAdd:$("#txtWarpLenAdd").val(),
            LoomPPAdd:$("#txtLoomPPAdd").val(),
            GreigeFabricWidth: $('#txtGreigeWidthFS').numberbox('getValue'),
            FinishWidth: $('#txtFabricWidth').numberbox('getValue'),
            Ends: $('#txtEndsFS').numberbox('getValue'),
            Picks: $('#txtPicksFS').numberbox('getValue'),
            FinishPick: $('#txtFinishPickFS').numberbox('getValue'),
            FinishEnd: $('#txtFinishEndFS').numberbox('getValue'),
            GreigeDemand: parseFloat($('#txtGriegeDemandFS').val()),
            GrayTargetInPercent: parseFloat($('#txtGriegeDemandFSPercentage').val()),
            RequiredWarpLength: $('#txtReqWarpLenFS').val(),
            GroundEnds:$('#txtGroundEndsFS').val(),// $('#txtGroundEndsFS').numberbox('getValue'),
            //WarpSet: $('#txtWarpSet').numberbox('getValue'),
            WeftColor:$("#txtWeftColor").val(),
            RefNote: $('#txtRefNote').val(),
            RefNo: $('#txtRefNo').val(),
            EndsRepeat: parseInt($("#lblEndsRepeat").html()),
            RepeatSection: parseFloat($('#txtRepeatSection').val()), // $('#txtRepeatSection').numberbox('getValue'),
            SectionEnds: parseInt($("#lblSectionEnds").html()),
            //NoOfSection: parseFloat($("#lblNoOfSection").html()),
            NoOfSection: parseFloat($('#txtNoOfSection').val()),
            PerConeLength: parseFloat($("#lblPerConeLength").html()),
            PerConeDia: parseFloat($("#lblPerConeDia").html()),
            Qty:  parseFloat($("#txtReqFinishLen").val())* 1.09361, //gets yeard  $("#txtReqFinishLen").val(_oFEOS.OrderQtyInMeter);
            ReqLoomProduction:parseFloat($("#txtReqLoomProduction").val()),//$('#txtReqLoomProduction').numberbox('getValue'),
            NoOfFrame:$('#txtNoOfFrame').val(),
            SelvedgeEnds:parseInt($('#txtSelvedgeEnds').val()),
            SelvedgeEndTwo:parseInt($('#txtSelvedgeEndTwo').val()),
            QtyExtraMet: $("#txtQtyExtraMet").val(),
            WarpCount: $("#txtWarpCount").val(),
            WeftCount: $("#txtWeftCount").val(),
            IsRevise:false,
            ProdtionType:false,
            IsOutSide:_oFEOS.IsOutSide,
            FEOSDetails:oDetails,
            FSpcType:parseInt($('#cboFSpcType').val()),
            SEBeamType:parseInt( $('#cboSEBeamType').val()),
            TotalEndsUB: parseFloat($('#txtTotalEndsU').val()),
            TotalEndsLB:parseFloat($('#txtTotalEndsL').val()),
            ReqWarpLenLB:parseFloat($('#txtReqWarpLenLB').val()),
            IsSepBeam:$("#chkIsSepBeam").is(":checked"),
            FabricSpecificationNotes:$('#tblFabricSpecificationNotes').datagrid('getRows')

        };
        return oFEOS;

    }

    function SetFEOToFEOS(oFSCDetail) {
        _nFSCDID = oFSCDetail.FabricSalesContractDetailID;
        $("#txtOrderNoFS").val(oFSCDetail.SCNoFull);
        $("#txtFabricIDFS").val(oFSCDetail.FabricNo);
        $("#txtConsumptionNoFS").val("");
        //$("#txtPINoFS").val(oFSCDetail.PINo);
        $("#txtConstructionFS").val(oFSCDetail.Construction);
        $("#txtFabricWidthFS").val(oFSCDetail.FinishWidthFS);
        $("#txtBuyerFS").val(oFSCDetail.BuyerName);
        $("#txtCompositionFS").val(oFSCDetail.ProductName);
        $("#txtWeaveFS").val(oFSCDetail.FabricWeaveName);
        $("#txtHLRefFS").val(oFSCDetail.HLReference);
        $("#txtFinishTypeFS").val(oFSCDetail.FinishTypeName);
        var nQtyInMtr = oFSCDetail.Qty/1.09361;
        $("#txtQtyInYardFS").val(oFSCDetail.Qty);
        $("#txtQtyInMeterFS").val(nQtyInMtr);

        //$('#txtReqWarpLenFSDefault,#txtGriegeDemandFSDefault').val(nQtyInMtr);
        $('#txtReqWarpLenFS,#txtGriegeDemandFS').val(nQtyInMtr);
    }

    function ResetControllFEOS() {

        _oFEOS = null;
        _nFSCDID = 0;
        _nReferenceFSCDID = 0;
        _bIsApprove = false;
        _nWarpEnds = 0;
        $(".resetfield").val("");

        $(".resetlbl").html("");

        //$('#txtReedFS').numberbox('setValue', 0);
        $('#txtReedWidthFS,#txtRepeatSection').val(0);
        $("#txtCrimpFS").val(3);
        CalculateTotalCrimp();

        $('#txtEndsFS').numberbox('setValue', 0);
        $('#txtPicksFS').numberbox('setValue', 0);

        $('#txtReqWarpLenFSDefault').val(0);
        $('#txtReqWarpLenFSPercentage').val(0);
        $('#txtReqWarpLenFS,#txtReqLoomProduction').val(0);


        $('#txtFinishPickFS').numberbox('setValue', 0);
        $('#txtGreigeWidthFS').numberbox('setValue', 0);
        $('#txtFabricWidth').numberbox('setValue', 0);

        $('#txtGriegeDemandFSPercentage').val(0);
        $('#txtGriegeDemandFS').val(0);

        //$('#txtGroundEndsFS').numberbox('setValue', 0);

        //$('#txtWarpSet').numberbox('setValue', 0);
        //$('#txtRepeatSection').numberbox('setValue', 0);
        //$("#txtAllowancePercent").val(4);

        DynamicRefreshList([], "tblWarpPlan");
        DynamicRefreshList([], "tblWeftPlan");
        DynamicRefreshList([], "tblYarnDyeingBreakDown");

        $("#lblFEOSpecificationStaus").html("");
        //$('#cboFEOSpecification').empty();
        $('#cboFEOSpecification').hide();
        $('#btnApproveFEOS').hide();
        //$("#btnCancelFEOS").hide();
        $("#btnSave").show();
    }

    /*------------------------ Generate Reed Width, Warp Length, Griege Demand, Section Ends -----------------------*/

    function GetReedWidth() {
        var nGroundEnds =0;// $('#txtGroundEndsFS').numberbox('getValue');
        var nReed =0;// $('#txtReedFS').numberbox('getValue');

        var nReedWidth = 0;
        if (nGroundEnds > 0 && nReed > 0) { nReedWidth = parseFloat(nGroundEnds) / parseFloat(nReed); }
        $('#txtReedWidthFS').val(nReedWidth.toFixed(2));
        CalculateTotalCrimp();
    }

    function GetReedWidthFS() {
        var nGroundEnds =0;// $('#txtGroundEndsFS').numberbox('getValue');
        var nReed =0;// $('#txtReedFS').numberbox('getValue');

        var nReedWidth = 0;
        if (nGroundEnds > 0 && nReed > 0) { nReedWidth = parseFloat(nGroundEnds) / parseFloat(nReed); }
        return nReedWidth.toFixed(2);
    }

    function GetReqWarpLength() {
        var nWarpLenDefault = $('#txtReqWarpLenFSDefault').val();
        var nPercentage = $('#txtReqWarpLenFSPercentage').val();

        var nWarpLen = 0;
        if (nWarpLenDefault > 0) {
            nWarpLen = parseFloat(nWarpLenDefault) + ((parseFloat(nWarpLenDefault) * parseFloat(nPercentage)) / 100);
        }
        if (isNaN(nWarpLen)) {
            nWarpLen = 0;
        }
        $('#txtReqWarpLenFS').val(nWarpLen.toFixed(2));
    }


    function GetSectionEnds() {
        var nRepreatSection =  parseFloat($('#txtRepeatSection').val());
        var nSectionEnds = 0;

        if (nRepreatSection > 0) { nSectionEnds = parseInt(nRepreatSection) * parseInt(_nWarpEnds); }
        $("#lblSectionEnds").html(nSectionEnds);

        var ncboAdd = parseFloat($('#cboAdd').val());
        if(ncboAdd==1)
        {
            $("#lblNoOfSection").html(($('#txtTotalEnds').val() > 0 && nSectionEnds>0) ? ((parseFloat($('#txtTotalEnds').val())+parseFloat($('#txtTotalEndsAdd').val())) / parseInt($("#lblSectionEnds").html())).toFixed(2) : 0);
        }
        else
        {
            $("#lblNoOfSection").html(($('#txtTotalEnds').val() > 0 && nSectionEnds>0) ? ((parseFloat($('#txtTotalEnds').val())-parseFloat($('#txtTotalEndsAdd').val())) / parseInt($("#lblSectionEnds").html())).toFixed(2) : 0);
        }
        debugger;
        if(_oFEOS.FEOSID<=0)  // if(parseFloat($("#txtNoOfSection").val())<=0 ) //
        {
            $("#txtNoOfSection").val(parseFloat($("#lblNoOfSection").html()));
        }
        var nPerConeDia = 0;
        if (parseFloat($("#lblNoOfSection").html()) > 0 && parseFloat($('#txtReqWarpLenFS').val()) > 0)
        {
            nPerConeDia = parseFloat((parseFloat($("#lblNoOfSection").html()) * parseFloat($('#txtReqWarpLenFS').val())) / (1.6933 * 40));
        }
        $("#lblPerConeDia").html(nPerConeDia.toFixed(2));

        var nPerConeLength = 0;
        if (parseFloat($("#lblPerConeDia").html()) > 0)
        {
            nPerConeLength = parseFloat((parseFloat($("#lblPerConeDia").html()) / 1000) * (1693.3 * 40) + 500);
        }
        $("#lblPerConeLength").html(nPerConeLength.toFixed(2));

        var oWarpPlans = $("#tblWarpPlan").datagrid("getRows");
   
        var txtReqWarpLenFS = $('#txtReqWarpLenFS').val();
        if(_nWarpEnds<=4 && oWarpPlans.length<=3 && parseFloat(txtReqWarpLenFS)>=4000 )
        {
            $('#lblNoOfSectionorBeam').html("Beam");
            //$('#chkIsSepBeam').show();
            if(_oFEOS.FEOSID<=0)  
            {
                $("#chkIsSepBeam").prop("checked", true);
            }
            
        }
        else{ $('#lblNoOfSectionorBeam').html("No of Section"); 
            //if(_oFEOS.FEOSID<=0)  
            //{    
                $("#chkIsSepBeam").prop("checked", false);
            //}
        }
    }


    /*------------------- Region Warp/Weft Grid Generation-------------------*/

   

    function GenerateYarnDyeingBreakDown(oYarnDyeingBreakDown) {

        if(oYarnDyeingBreakDown==null || oYarnDyeingBreakDown.length<=0)
            return false;
        MakeGrid();
      

        var oYDBDs = [];
        for (var i = 0; i < oYarnDyeingBreakDown.length; i++) {
            var nCount = 0;
            var oYDBD = {};
            while (oYarnDyeingBreakDown[i].length > nCount) {
                oYDBD[oYarnDyeingBreakDown[i][nCount].Key] = oYarnDyeingBreakDown[i][nCount].Value;
                nCount++;
            }
            oYDBDs.push(oYDBD);
        }

        if (oYDBDs.length > 0) {

            var nWarpWeightInkg = 0, nWeftWeightInkg = 0, nTotalWeightInkg = 0, nWeightWithAllowanceInkg = 0;

            for (var i = 0; i < oYDBDs.length; i++) {
                nWarpWeightInkg = nWarpWeightInkg + oYDBDs[i].WarpWeightInkg;
                nWeftWeightInkg = nWeftWeightInkg + oYDBDs[i].WeftWeightInkg;
                nTotalWeightInkg = nTotalWeightInkg + oYDBDs[i].TotalWeightInkg;
                nWeightWithAllowanceInkg = nWeightWithAllowanceInkg + oYDBDs[i].WeightWithAllowanceInkg;
            }
            var oYDBD = {
                ProductName: '',
                ColorName: '<b>Total</b>',
                WarpWeightInkg: nWarpWeightInkg,
                WeftWeightInkg: nWeftWeightInkg,
                TotalWeightInkg: nTotalWeightInkg,
                BatchNo: '',
                Allowance:0,
                WeightWithAllowanceInkg: nWeightWithAllowanceInkg,
            };
            oYDBDs.push(oYDBD);
        }
        DynamicRefreshList(oYDBDs, "tblYarnDyeingBreakDown");
    }

    function MakeGrid()
    {
        var tblColums=[];
        var oColumn=null;
        oColumn= { field :"BatchNo", title:"BatchNo", width:"10%", align: "left",editor: {type:'text'}}; tblColums.push(oColumn);
        oColumn= { field :"LDNo", title:"LDNo", width:"10%", align: "left",editor: {type:'text'}}; tblColums.push(oColumn);
        oColumn= { field :"ProductName", title:"ProductName", width:"20%"}; tblColums.push(oColumn);
        oColumn= { field :"ColorName", title:"Color", width:"20%"}; tblColums.push(oColumn);
        oColumn= { field :"WarpWeightInkg", title:"Warp(kg)", width:"10%", align: "right",  formatter: function(value,row,index){ return formatPrice(value, 0); }}; tblColums.push(oColumn);
        oColumn= { field :"WeftWeightInkg", title:"Weft(kg) ", width:"10%", align: "right",  formatter: function(value,row,index){ return formatPrice(value, 0); }}; tblColums.push(oColumn);
        oColumn= { field :"TotalWeightInkg", title:"Total(kg) ", width:"10%", align: "right",  formatter: function(value,row,index){ return formatPrice(value, 0); }}; tblColums.push(oColumn);
        oColumn= { field :"Allowance", title:"Allowance", width:"10%", align: "right",editor: {type:'numberbox',options:{ precision:2}},  formatter: function(value,row,index){ return formatPrice(value, 2); }}; tblColums.push(oColumn);
        oColumn= { field :"WeightWithAllowanceInkg", title:"Greige Yarn(KG)", width:"10%", align: "right",  formatter: function(value,row,index){ return formatPrice(value, 0); }}; tblColums.push(oColumn);

        $('#tblYarnDyeingBreakDown').datagrid({ columns:[tblColums]});
    }




    function GenerateWarpingPrograms(oFEOS) {

        //$('#txtWarpSet').numberbox('setValue', (oFEOS != null) ? oFEOS.WarpSet : 0);
       
        $('#txtRefNo').val((oFEOS != null) ? oFEOS.RefNo : "");
        $("#lblEndsRepeat").html(parseInt(_nWarpEnds));
        //$('#txtRepeatSection').numberbox('setValue', (oFEOS != null) ? oFEOS.RepeatSection : 1);
        $('#txtRepeatSection').val((oFEOS != null) ? oFEOS.RepeatSection : 1);
      
    }

    var editIndex = undefined;
    function endEditing() {
        if (editIndex == undefined) { return true }
        if ($('#tblYarnDyeingBreakDown').datagrid('validateRow', editIndex)) {
            $('#tblYarnDyeingBreakDown').datagrid('endEdit', editIndex);
            $('#tblYarnDyeingBreakDown').datagrid('selectRow', editIndex);
            debugger;
            //InvoiceType: Standard = 1, Advance = 2
            //ReferenceType : Open = 1, PO = 2, Import = 3
            var oYarnDyeingBreakDown = $('#tblYarnDyeingBreakDown').datagrid('getSelected');


            if (oYarnDyeingBreakDown.Allowance==_nAllowance && oYarnDyeingBreakDown.BatchNo==_sBatchNo && oYarnDyeingBreakDown.LDNo==_sLDNo) {
                editIndex = undefined;
                return true;
            }
            else
            {
                if(!_oFEOS.IsYD){oYarnDyeingBreakDown.Allowance=0;}
                UpdateFP(oYarnDyeingBreakDown, editIndex);
                $('#tblYarnDyeingBreakDown').datagrid('updateRow', { index: editIndex, row: oYarnDyeingBreakDown });
            }
            //else
            //{
            //    $('#tblYarnDyeingBreakDown').datagrid('updateRow', { index: editIndex, row: oYarnDyeingBreakDown });
            //}

            //  RefreshSummery();
            //editIndex = undefined;
            return true;
        }
        else {
            return false;
        }
    }

    function onClickRow(index) {
        if (editIndex != index && _oFEOS.ForwardToDOby==0) {
            //if (_oFEOS.ForwardToDOby==0 ) {
                if (endEditing()) {
                    $('#tblYarnDyeingBreakDown').datagrid('selectRow', index).datagrid('beginEdit', index);
                    var oYarnDyeingBreakDown= $('#tblYarnDyeingBreakDown').datagrid('getSelected');
                    _nAllowance = oYarnDyeingBreakDown.Allowance;
                    _sBatchNo = oYarnDyeingBreakDown.BatchNo;
                    _sLDNo = oYarnDyeingBreakDown.LDNo;
                    editIndex = index;
                }
                else {
                    $('#tblYarnDyeingBreakDown').datagrid('selectRow', editIndex);
                }
            }
            //else {
            //    editIndex = index;
            //}
       // }
    }

    function UpdateFP(oYarnDyeingBreakDown, SelectedRowIndex)
    {
        $.ajax({
            type: "POST",
            dataType: "json",
            url: _sBaseAddress + "/FabricExecutionOrderSpecification/UpdateAllowance",
            traditional: true,
            data: JSON.stringify(oYarnDyeingBreakDown),
            contentType: "application/json; charset=utf-8",
            success: function (data) {

                var oFESD = jQuery.parseJSON(data);
                debugger;
                oYarnDyeingBreakDown.Allowance=oFESD.Allowance;
                oYarnDyeingBreakDown.WeightWithAllowanceInkg=oYarnDyeingBreakDown.TotalWeightInkg+(oYarnDyeingBreakDown.TotalWeightInkg* oYarnDyeingBreakDown.Allowance)/100;
                //alert(   oYarnDyeingBreakDown.Allowance);
                if (parseInt(oYarnDyeingBreakDown.ProductID) > 0) {
                    $('#tblYarnDyeingBreakDown').datagrid('updateRow', { index: SelectedRowIndex, row: oYarnDyeingBreakDown });
                    // RefreshTotalSummery();
                }
                else {
                    alert(oYarnDyeingBreakDown.ErrorMessage);
                }
            },
            error: function (xhr, status, error) {
                alert(error);
            }
        });
    }


    var editIndexFabricPatternWarp = undefined;
    function endEditingFabricPatternWarp() {
        if (editIndexFabricPatternWarp == undefined) {
            return true;
        }
        if ($('#tblWarpPlan').datagrid('validateRow', editIndexFabricPatternWarp)) {
            $('#tblWarpPlan').datagrid('endEdit', editIndexFabricPatternWarp);
            $('#tblWarpPlan').datagrid('selectRow', editIndexFabricPatternWarp);
            //_IsWarp = true;
            debugger;
            var oFPDetail = $('#tblWarpPlan').datagrid('getSelected');
            //RefreshSummary_Warp();
          editIndexFabricPatternWarp = undefined;
            return true;
            //if (parseInt(oFPDetail.EndsCount) <= 0 || (parseInt(oFPDetail.EndsCount) == parseInt(_nEndsCountWarp) && _sColorWarp == oFPDetail.ColorName && _nValueWarp == oFPDetail.Value)) {
            //    editIndexFabricPatternWarp = undefined;
            //    return true;
            //}
            //else {
            //    var obj = {
            //        BaseAddress: _sBaseAddress,
            //        Object: oFPDetail,
            //        ObjectId: oFPDetail.FPDID,
            //        ControllerName: "Fabric",
            //        ActionName: "SaveFPDetail",
            //        TableId: (_IsWarp) ? "tblWarpPlan" : "tblWeftPlan",
            //        IsWinClose: false,
            //        Message: ""
            //    };

            //    $.icsSave(obj, function (response) {
            //        var oFPs = $("#tblWarpPlan").datagrid("getRows");
            //        CalculateTotalWarpOrWeft(oFPs, "Warp");
            //        editIndexFabricPatternWarp = undefined;
            //        return true;

            //    });
            //}
        }
        else { return false; }
    }

    function onClickRowFESDWarp(index) {
        if (editIndexFabricPatternWarp != index) {
            //if (_oFEOS.ForwardToDOby==0 ) {
                if (endEditingFabricPatternWarp()) {
                    $('#tblWarpPlan').datagrid('selectRow', index).datagrid('beginEdit', index);
                    var oFPDetail=$('#tblWarpPlan').datagrid('getSelected');
                    //_nEndsCountWarp = parseInt(oFPDetail.EndsCount);
                    //_sColorWarp = oFPDetail.ColorName;
                    //_nValueWarp = oFPDetail.Value;
                    editIndexFabricPatternWarp = index;
                }
                else {
                    $('#tblWarpPlan').datagrid('selectRow', editIndexFabricPatternWarp);
                }
            //}
            //else{
            //    editIndexFabricPatternWarp = index;
            //}
        }
    }


    var editIndexFabricPatternWeft = undefined;
    function endEditingFabricPatternWeft() {

        if (editIndexFabricPatternWeft == undefined) {
            return true;
        }
        if ($('#tblWeftPlan').datagrid('validateRow', editIndexFabricPatternWeft)) {
            $('#tblWeftPlan').datagrid('endEdit', editIndexFabricPatternWeft);
            $('#tblWeftPlan').datagrid('selectRow', editIndexFabricPatternWeft);
            editIndexFabricPatternWeft = undefined;
            return true;
         
        }
        else {
            return false;
        }
    }

    function onClickRowFESDWeft(index) {
        if (editIndexFabricPatternWeft != index) {
          //if (_oFEOS.ForwardToDOby==0 ) {
                if (endEditingFabricPatternWeft()) {
                    $('#tblWeftPlan').datagrid('selectRow', index).datagrid('beginEdit', index);
                    var oFPDetail = $('#tblWeftPlan').datagrid('getSelected');

                    editIndexFabricPatternWeft = index;
                }
                else {
                    $('#tblWeftPlan').datagrid('selectRow', editIndexFabricPatternWeft);
                }
            }
            //else{
            //    editIndexFabricPatternWeft = index;
            //}
        //}
    }


    ////new

    function Validation_FSNote()
    {
        if($.trim($("#txtFabricSpecificationNote").val()) == "")
        {
            alert("Please Type Note and Press Add Button");
            $("#txtFabricSpecificationNote").addClass("errorFieldBorder");
            $("#txtFabricSpecificationNote").focus();
            return false;
        }else{
            $("#txtFabricSpecificationNote").removeClass("errorFieldBorder");
        }
        //if(_oFEOS.FEOSID<=0)
        //{
        //    alert("Specification yet not confirm.");
        //    $("#txtFabricSpecificationNote").addClass("errorFieldBorder");
        //    $("#txtFabricSpecificationNote").focus();
        //    return false;
        //}else{
        //    $("#txtFabricSpecificationNote").removeClass("errorFieldBorder");
        //}
        return true;
    }

    function RefreshObject_FSNote() {
        var oFabricSpecificationNote = {
            FabricSpecificationNoteID : (_oFabricSpecificationNote == null ? 0 : _oFabricSpecificationNote.FabricSpecificationNoteID),
            Note : $("#txtFabricSpecificationNote").val(),
            FEOSID:_oFEOS.FEOSID
        }
        return oFabricSpecificationNote;
    }

    $("#btnAddFSNote").click(function(){
        _oFabricSpecificationNote= null;
        AddNew();
    });

    $("#txtFabricSpecificationNote").keydown(function(e){
        if(e.keyCode === 13)
        {
            _oFabricSpecificationNote = null;
            AddNew();
        }
    });

    function AddNew()
    {
        debugger;
        if (!Validation_FSNote())
        {
            return false;
        }
        else
        {
            debugger;
            var oFabricSpecificationNote = RefreshObject_FSNote();
            var obj = {
                BaseAddress: _sBaseAddress,
                Object: oFabricSpecificationNote,
                ObjectId: oFabricSpecificationNote.FabricSpecificationNoteID,
                ControllerName: "FabricExecutionOrderSpecification",
                ActionName: "SaveFabricSpecificationNote",
                TableId: "tblFabricSpecificationNotes",
                IsWinClose: false,
                Message:""
            };
            $.icsSave(obj, function (response) {
                if (response.status && response.obj != null) {
                    debugger;
                 
                    if (response.obj.FabricSpecificationNoteID > 0) {
                        $("#txtFabricSpecificationNote").val("");
                        $("#txtFabricSpecificationNote").focus();
                        $("#btnUpdateFSNote").hide();

                    }
                }
            });
        }
    }
   

    $("#btnDeleteFSNote").click(function(){
        var oFabricSpecificationNote = $("#tblFabricSpecificationNotes").datagrid("getSelected");
        if(oFabricSpecificationNote == null)
        {
            alert("Please select an item from list.");
            return;
        }
        if (!confirm("Confirm to Delete?")) return;
        if(oFabricSpecificationNote.FabricSpecificationNoteID>0)
        {
        
          
            var obj =
            {
                BaseAddress: _sBaseAddress,
                Object: oFabricSpecificationNote,
                ControllerName: "FabricExecutionOrderSpecification",
                ActionName: "DeleteFabricSpecificationNote",
                TableId: "tblFabricSpecificationNotes",
                IsWinClose: false
            };
            $.icsDelete(obj);
        }
        else{
            var SelectedRowIndex = $('#tblFabricSpecificationNotes').datagrid('getRowIndex', oFabricSpecificationNote);
            $('#tblFabricSpecificationNotes').datagrid('deleteRow',SelectedRowIndex);
        }
    });

    $("#btnEditFSNote").click(function(){
        var oFabricSpecificationNote = $("#tblFabricSpecificationNotes").datagrid("getSelected");
        var nIndex=$('#tblFabricSpecificationNotes').datagrid('getRowIndex',oFabricSpecificationNote);
        sessionStorage.setItem("SelectedRowIndex", nIndex);
        if(oFabricSpecificationNote== null)
        {
            alert("Please select an item from list.");
            return;
        }
        _oFabricSpecificationNote= oFabricSpecificationNote;
        $("#txtFabricSpecificationNote").removeClass("errorFieldBorder");
        $("#txtFabricSpecificationNote").val(oFabricSpecificationNote.Note);
        $("#btnUpdateFSNote").show();
    });

    $("#btnUpdateFSNote").click(function(){
        // AddNew();
        var nIndex= sessionStorage.getItem('SelectedRowIndex');
        _oFabricSpecificationNote.Note =$("#txtFabricSpecificationNote").val();
        if(nIndex>=0)
        {
            $('#tblFabricSpecificationNotes').datagrid('updateRow', { index: nIndex, row: _oFabricSpecificationNote });
        }
    });


    //$("#btnUpdateFSNote").click(function(){
    //    AddNew();
    //});
    $("#btnAddLD_Warp").click(function(){
      
        var oWarpPlan = $('#tblWarpPlan').datagrid('getSelected');
        if (oWarpPlan == null ) {
            alert("Please select a Warp color from list!");
            return;
        }

        GetsWaftWarp($("#txtColorWarp").val(),true);
    });
    $("#btnAddLD_Weft").click(function(){
        var oWeftPlan = $('#tblWeftPlan').datagrid('getSelected');
        if (oWeftPlan == null) {
            alert("Please select a  weft color from list!");
            return;
        }
        _IsWarp = false;
        GetsWaftWarp($("#txtColorWeft").val(),false);
    });

    $("#txtLDNo_Warp").keydown(function (e) {
        if (e.keyCode == 13) // Enter Press
        {
            var oWarpPlan = $('#tblWarpPlan').datagrid('getSelected');
            if (oWarpPlan == null ) {
                alert("Please select a warp color from list!");
                return;
            }
            _IsWarp = true;
            GetsWaftWarp($("#txtLDNo_Warp").val(),true);
        }
    });

    $("#txtLDNo_Weft").keydown(function (e) {
        if (e.keyCode === 13) // Enter Press
        {
            debugger;
            var oWeftPlan = $('#tblWeftPlan').datagrid('getSelected');
            if (oWeftPlan == null  ) {
                alert("Please select a  Weft color from list!");
                return;
            }
            _IsWarp = false;
            GetsWaftWarp($("#txtLDNo_Weft").val(),false);
        }
    });
    function GetsWaftWarp(sColorNo,_IsWarp) {


        debugger;
        var oFESDetail = {
            FabricID: 0,
            ColorName: "" ,
            ColorNo: sColorNo ,
            ProductID:0
            // here Note property use for color name string
        };
        if(_IsWarp==true)
        {
            var oWarpPlan = $('#tblWarpPlan').datagrid('getSelected');
            oFESDetail.ProductID=oWarpPlan.ProductID;
           
            
        }
        else{
            var oWeftPlan = $('#tblWeftPlan').datagrid('getSelected');
            oFESDetail.ProductID=oWeftPlan.ProductID;
        }
       
        var obj = {
            BaseAddress: _sBaseAddress,
            Object: oFESDetail,
            ControllerName: "FabricExecutionOrderSpecification",
            ActionName: "GetsLabdips",
            IsWinClose: false
        };
        if(oFESDetail.ProductID<=0)
        {
            alert("Please select a item from list!");
            return;
        }
        $("#progressbar").progressbar({ value: 0 });
        $("#progressbarParent").show();
        var intervalID = setInterval(updateProgress, 250);
        $.icsDataGets(obj, function (response) {
            clearInterval(intervalID);
            $("#progressbarParent").hide();
            if (response.status && response.objs.length > 0) {

                if (response.objs[0].LabDipDetailID> 0) {
                    var tblColums = [];
                    var oColumn = { field: "ColorName", title: "ColorName", width: 120, align: "left" }; tblColums.push(oColumn);
                    //oColumn = { field: "ColorName", title: "ColorName", width: 300, align: "left" }; tblColums.push(oColumn);
                    oColumn = { field: "ColorNo", title: "LD No", width: 80, align: "left" }; tblColums.push(oColumn);
                    oColumn = { field: "PantonNo", title: "Panton No", width: 80, align: "left" }; tblColums.push(oColumn);

                    var oPickerParam = {
                        winid: 'winFPColorPicker',
                        winclass: 'clsFPColorPicker',
                        winwidth: 450,
                        winheight: 400,
                        tableid: 'tblFPColorPicker',
                        tablecolumns: tblColums,
                        datalist: response.objs,
                        multiplereturn: false,
                        searchingbyfieldName: 'ColorName',
                        windowTittle: 'Color List'
                    };
                    $.icsPicker(oPickerParam);
                    IntializePickerbuttonTwo(oPickerParam,_IsWarp);//multiplereturn, winclassName
                }
                else { alert(response.objs[0].ErrorMessage); }
            }
            else { alert("No Product Found."); }
        });
    }
    
    function IntializePickerbuttonTwo(oPickerobj,_IsWarp) {
        $("#" + oPickerobj.winid).find("#btnOk").click(function () {
            SetPickerValueAssignTwo(oPickerobj,_IsWarp);
        });
        $(document).find('.' + oPickerobj.winclass).keydown(function (e) {
            if (e.which === 13) {
                SetPickerValueAssignTwo(oPickerobj,_IsWarp);
            }
        });
    }

    function SetPickerValueAssignTwo(oPickerobj,_IsWarp) {
        var oreturnObj = null, oreturnObjs = [];
        if (oPickerobj.multiplereturn) {
            oreturnObjs = $('#' + oPickerobj.tableid).datagrid('getChecked');
        } else {
            oreturnObj = $('#' + oPickerobj.tableid).datagrid('getSelected');
        }
        debugger;

        if (oPickerobj.winid == 'winFPColorPicker')
        {
            if (oreturnObj != null) {
                debugger;
                if(_IsWarp==true)
                {
                    var oWarpPlan = $('#tblWarpPlan').datagrid('getSelected');
                    var nSelectedIndex = $('#tblWarpPlan').datagrid('getRowIndex', oWarpPlan);
                    if (oWarpPlan == null ) {
                        alert("Please select a item from list!");
                        return;
                    }
                    oWarpPlan.ColorNo=oreturnObj.ColorNo;
                    oWarpPlan.ColorName=oreturnObj.ColorName;
                    oWarpPlan.LabdipDetailID=oreturnObj.LabDipDetailID;
                    $('#tblWarpPlan').datagrid('updateRow', { index: nSelectedIndex, row: oWarpPlan });
                }
                else{
                    var oWeftPlan = $('#tblWeftPlan').datagrid('getSelected');
                    var nSelectedIndex = $('#tblWeftPlan').datagrid('getRowIndex', oWeftPlan);
                    if (oWeftPlan == null ) {
                        alert("Please select a item from list!");
                        return;
                    }
                    oWeftPlan.ColorNo=oreturnObj.ColorNo;
                    oWeftPlan.ColorName=oreturnObj.ColorName;
                    oWeftPlan.LabdipDetailID=oreturnObj.LabDipDetailID;
                    $('#tblWeftPlan').datagrid('updateRow', { index: nSelectedIndex, row: oWeftPlan });
                }
                endEditingFabricPatternWarp();
                endEditingFabricPatternWeft();
            }
            else {
                alert("Data not found.");
                return false;
            }
        }
        
        else if (oPickerobj.winid == 'winContractorPicker') {
            if (oreturnObj != null && oreturnObj.ContractorID > 0)
            {
                $('#txtContractorName').val(oreturnObj.Name);
                _oFEOS.ContractorID= oreturnObj.ContractorID;
              
            }
            else{
                alert("Data not found");
            }
        }
        else if (oPickerobj.winid == 'winProductPicker') {
            if (oreturnObj != null && oreturnObj.ProductID > 0)
            {
                $('#txtSearchByProductNameWarp').val(oreturnObj.ProductName);
                _nProductID= oreturnObj.ProductID;
            }
            else{
                alert("Data not found");
            }
        }
        else  if (oPickerobj.winid == 'winExeNoPicker')
        {
            if (oreturnObj != null) {
                debugger;
               
                oreturnObj.FSCDID=_nFSCDID;
                LoadFSCS(oreturnObj);
                endEditingFabricPatternWarp();
                endEditingFabricPatternWeft();
            }
            else {
                alert("Data not found.");
                return false;
            }
        }

        $("#" + oPickerobj.winid).icsWindow("close");
        $("#" + oPickerobj.winid).remove();
    }
    function RefreshSummary_Warp()
    {
        var oRows = $('#tblWarpPlan').datagrid('getRows');
        var nTwistedGroup=0;
        if(oRows.length>0)
        {
            var nTotalEnd = 0,nTotalEndActual=0,nQty=0;
            for(var i=0;i<oRows.length;i++)
            {
                    nTotalEnd = parseFloat(nTotalEnd)+parseFloat(oRows[i].TotalEnd);
                    nTotalEndActual = parseFloat(nTotalEndActual)+parseFloat(oRows[i].TotalEndActual);
                    nQty = parseFloat(nQty)+parseFloat(oRows[i].Qty);
            }
            nTotalEnd = parseFloat(nTotalEnd).toFixed(2);
            nTotalEndActual = parseFloat(nTotalEndActual).toFixed(2);
            nQty = parseFloat(nQty).toFixed(2);
            debugger
            var oRow =
            {
                ColorName : 'Total',
                ProductName:'',
                LDNo:'',
                SLNo:0,
                TwistedGroup:0,
                ProductID:0,
                Value:0,
                TotalEnd:nTotalEnd,
                TotalEndActual:nTotalEndActual,
                Qty:nQty
            }
            $('#tblWarpPlan').datagrid('appendRow',oRow); 
        } 
    }
    function RefreshSummary_Weft()
    {
        var oRows = $('#tblWeftPlan').datagrid('getRows');
        if(oRows.length>0)
        {
            var nTotalEnd = 0,nTotalEndActual=0,nQty=0;
            for(var i=0;i<oRows.length;i++)
            {
                nTotalEnd = parseFloat(nTotalEnd)+parseFloat(oRows[i].TotalEnd);
                nTotalEndActual = parseFloat(nTotalEndActual)+parseFloat(oRows[i].TotalEndActual);
                nQty = parseFloat(nQty)+parseFloat(oRows[i].Qty);
            }
            nTotalEnd = parseFloat(nTotalEnd).toFixed(2);
            nTotalEndActual = parseFloat(nTotalEndActual).toFixed(2);
            nQty = parseFloat(nQty).toFixed(2);
            debugger
            var oRow =
            {
                ColorName : 'Total',
                TwistedGroup:0,
                ProductID:0,
                Value:0,
                TotalEnd:nTotalEnd,
                TotalEndActual:nTotalEndActual,
                Qty:nQty
            }
            $('#tblWeftPlan').datagrid('appendRow',oRow); 
        } 
    }
    $("#btnRemoveDetail").click(function () {

        if (_oFEOS.ApproveBy != 0) { alert('Already Approved. You can not delete it.'); return; }
        if (!confirm("Confirm to Delete?")) return false;
        var oFESDetail={FEOSID:_oFEOS.FEOSID }
        debugger;
        if(oFESDetail.FEOSID>0)  
        {
            $.ajax
         ({
             type: "POST",
             dataType: "json",
             url : _sBaseAddress+  "/FabricExecutionOrderSpecification/DeleteFDetailAll",
             traditional: true,
             data:JSON.stringify(oFESDetail),
             contentType: "application/json; charset=utf-8",
             success: function (data) {
                 debugger;
                 feedbackmessage = jQuery.parseJSON(data);
                 if (feedbackmessage == "Deleted")
                 {
                     alert("Delete sucessfully");
                     DynamicRefreshList([], "tblWarpPlan");
                    DynamicRefreshList([], "tblWeftPlan");

                 }
                 else
                 {
                     alert(feedbackmessage);
                 }
             },
             error: function (xhr, status, error)
             {
                 alert(error);
             }

         });


            //var obj =
            //             {
            //                 BaseAddress: _sBaseAddress,
            //                 Object: oFESDetail,
            //                 ControllerName: "FabricExecutionOrderSpecification",
            //                 ActionName: "DeleteFDetailAll",
            //                 TableId: "tblWeftPlan",
            //                 IsWinClose: false
            //             };
          
            //$.icsDelete(obj, function (response) {
            //    debugger;
            //    if (response.status && response.Message != "") {
            //        alert(response.Message);
            //        if (response.Message == "Deleted") {
            //            DynamicRefreshList([], "tblWarpPlan");
            //            DynamicRefreshList([], "tblWeftPlan");
            //        }
            //    }
            //});

        }
        else{
            DynamicRefreshList([], "tblWarpPlan");
            DynamicRefreshList([], "tblWeftPlan");
        }
    
    });

    function onLoadSuccess(data)
    {
        debugger;
        var nIndex=0;
        var nSpan=0;
        for(var i=0;i<_oCellRowSpans.length;i++){
            var oMCell=[_oCellRowSpans[i].mergerCell];
            nIndex=oMCell[0][0];
            nSpan= oMCell[0][1];
            if(_oCellRowSpans[i].FieldName=="TwistedGroup" ){
                $(this).datagrid('mergeCells',{index: nIndex, field: 'TwistedGroup', rowspan: nSpan});
                $(this).datagrid('mergeCells',{index: nIndex, field: 'EndsCount', rowspan: nSpan});
                $(this).datagrid('mergeCells',{index: nIndex, field: 'TotalEnd', rowspan: nSpan});
                var ncboFSpcType= parseInt($('#cboFSpcType').val());
                if(ncboFSpcType==2)
                {
                    $(this).datagrid('mergeCells',{index: nIndex, field: 'Qty', rowspan: nSpan});
                }
            }
        }
    }
    function onLoadSuccessWeft(data)
    {
        debugger;
        var nIndex=0;
        var nSpan=0;
        for(var i=0;i<_oCellRowSpansWeft.length;i++){
            var oMCell=[_oCellRowSpansWeft[i].mergerCell];
            nIndex=oMCell[0][0];
            nSpan= oMCell[0][1];
            if(_oCellRowSpansWeft[i].FieldName=="TwistedGroup" ){
                $(this).datagrid('mergeCells',{index: nIndex, field: 'TwistedGroup', rowspan: nSpan});
                $(this).datagrid('mergeCells',{index: nIndex, field: 'EndsCount', rowspan: nSpan});
                $(this).datagrid('mergeCells',{index: nIndex, field: 'TotalEnd', rowspan: nSpan});
                var ncboFSpcType= parseInt($('#cboFSpcType').val());
                if(ncboFSpcType==2)
                {
                    $(this).datagrid('mergeCells',{index: nIndex, field: 'Qty', rowspan: nSpan});
                }
            }
        }
    }
    function formatTwisted(value){

        if(value>0){
            return "Twisted";
        }
        else{
            return "";
        }
    }
    $("#btnExeNo").click(function () {

        var oExeNo = $("#txtExeNo").val();
   
        GetsExeNo($("#txtExeNo").val());
    
    });

    $("#txtExeNo").keydown(function (e) {
        if (e.keyCode == 13) // Enter Press
        {
          
            var oExeNo = $("#txtExeNo").val();
            if (oExeNo == null ) {
                alert("Please select a warp color from list!");
                return;
            }
            GetsExeNo($("#txtExeNo").val());
        }
    });
    function GetsExeNo(sExeNo) {
        debugger;
        var oFEOS = {
            FabricID: _oFEOS.FabricID,
            FEOSID:0,
            ExeNo:sExeNo,
            FSCDID:_nFSCDID
        };
       
        var obj = {
            BaseAddress: _sBaseAddress,
            Object: oFEOS,
            ControllerName: "FabricExecutionOrderSpecification",
            ActionName: "GetsByExeNo",
            IsWinClose: false
        };
        if(oFEOS.FSCDID<=0)
        {
            alert("Please select a item from list!");
            return;
        }
        $("#progressbar").progressbar({ value: 0 });
        $("#progressbarParent").show();
        var intervalID = setInterval(updateProgress, 250);
        $.icsDataGets(obj, function (response) {
            clearInterval(intervalID);
            $("#progressbarParent").hide();
            if (response.status && response.objs.length > 0) {

                if (response.objs[0].FSCDID> 0) {
                    var tblColums = [];
                    var oColumn ={ field: "ExeNo", title: "Dispo No", width: 80, align: "left" }; tblColums.push(oColumn);
                    oColumn = { field: "FabricNo", title: "Fabric No", width: 80, align: "left" }; tblColums.push(oColumn);
                    oColumn = { field: "FESONo", title: "Job No", width: 120, align: "left" }; tblColums.push(oColumn);
                    var oPickerParam = {
                        winid: 'winExeNoPicker',
                        winclass: 'clsExeNoPicker',
                        winwidth: 450,
                        winheight: 400,
                        tableid: 'tblExeNoPicker',
                        tablecolumns: tblColums,
                        datalist: response.objs,
                        multiplereturn: false,
                        searchingbyfieldName: 'ExeNo',
                        windowTittle: 'Dispo List'
                    };
                    $.icsPicker(oPickerParam);
                    IntializePickerbuttonTwo(oPickerParam,_IsWarp);//multiplereturn, winclassName
                }
                else { alert(response.objs[0].ErrorMessage); }
            }
            else { alert("No Product Found."); }
        });
    }

    function LoadFSCS(oFEOS)
    {
        if (parseInt(oFEOS.FSCDID) > 0)
        {
            $.ajax
            ({
                type: "POST",
                dataType: "json",
                url: sessionStorage.getItem("BaseAddress")+"/FabricExecutionOrderSpecification/GetsFEOSID",
                data: JSON.stringify(oFEOS),
                contentType: "application/json; charset=utf-8",
                success: function (data)
                {
                    var oFEOS = jQuery.parseJSON(data);
                    debugger;
                    RefreshControlFEOS(oFEOS);
                    RefreshReqQtyLenLoomWarp();
                },
                error: function (xhr, status, error) {
                    alert(error);
                }

            });

            $.ajax
           ({
               type: "POST",
               dataType: "json",
               url: sessionStorage.getItem("BaseAddress")+"/FabricExecutionOrderSpecification/GetsFSpecNote",
               data: JSON.stringify(oFEOS),
               contentType: "application/json; charset=utf-8",
               success: function (data)
               {
                   var oFabricSpecificationNotes = jQuery.parseJSON(data);
                   debugger;
                   if(oFabricSpecificationNotes.length>0)
                   {
                       DynamicRefreshList(oFabricSpecificationNotes, "tblFabricSpecificationNotes");
                   }
               },
               error: function (xhr, status, error) {
                   alert(error);
               }

           });
        }
    }

    function ChangecboFSpcType(isTrue)
    {
        var ncboFSpcType= parseInt($('#cboFSpcType').val());

        if(ncboFSpcType==1)
        {
            $("#trTotalEndULBeam,#trSeersucker").show();
            $("#cboSEBeamType").show();
            $('#lblReqWarpLen').html("Req. Warp Len(U):");
            //$("#tblFSCDetails").datagrid("showColumn", "Qty");
        }
        else
        {
            $("#trTotalEndULBeam,#trSeersucker").hide();
            $("#cboSEBeamType").hide();
            $('#lblReqWarpLen').html("Req. Warp Len(M):");
        }

    
    }

    $("#btnPickDetailWarp").click(function () {
        debugger;
        _IsWarp=true;
        Detsetail(_IsWarp);
      
    });
    $("#btnPickDetailWeft").click(function () {
        debugger;
        _IsWarp=false;
        Detsetail(_IsWarp);
    });
    function Detsetail(_IsWarp)
    {
        var oFESDetail=null;
        if(_IsWarp==true)
        {
            oFESDetail = $('#tblWarpPlan').datagrid('getSelected');
            var oFESDetail = $('#tblWarpPlan').datagrid('getSelected');
            if (oFESDetail ==null ) { alert("Please select an item from list."); return ; }
            
        }
        else{
            oFESDetail = $('#tblWeftPlan').datagrid('getSelected');
            var oFESDetail = $('#tblWeftPlan').datagrid('getSelected');
            if (oFESDetail ==null ) { alert("Please select an item from list."); return ; }
        }
        //$('#txtWeight,#txtShrinkage').icsCurrencyBox();
        $("#winExPIDetail input").val("");
        _nProductID=oFESDetail.ProductID;
        $("#cboBeamType").val(oFESDetail.BeamType);
        $("#chkIsDeductYes").prop("checked", oFESDetail.IsYarnExist);
        $("#chkIsDeductNo").prop("checked", !oFESDetail.IsYarnExist);
        $("#txtSearchByProductNameWarp").val(oFESDetail.ProductName);
        $("#txtPValue").val(oFESDetail.Value);
        $("#txtPickEPPI").val(oFESDetail.EndsCount);
        $("#trDyeingQtyExtra").hide();
        if(parseInt($('#cboDispoProType').val())==3) 
        {
            $("#trDyeingQtyExtra").show();
            $("#txtQty_DO").val(parseFloat(oFESDetail.Qty));
        }
        var ncboFSpcType= parseInt($('#cboFSpcType').val());
        if(ncboFSpcType==1)
        {
            $("#trIsDeduct").show();

        }
        else
        {
            $("#trIsDeduct").hide();
        }
        $("#winExPIDetail").icsWindow("open","Change  info");
    }
    $("#btnUpdateFSEDetail").click(function () {
        debugger;
     
        if(_IsWarp==true)
        {
            oFESDetail = $('#tblWarpPlan').datagrid('getSelected');
            var oFESDetail = $('#tblWarpPlan').datagrid('getSelected');
            if (oFESDetail ==null ) { alert("Please select an item from list."); return ; }
            var nSelectedRowIndex=$('#tblWarpPlan').datagrid('getRowIndex',oFESDetail);
       
        }
        else{
            oFESDetail = $('#tblWeftPlan').datagrid('getSelected');
            var oFESDetail = $('#tblWeftPlan').datagrid('getSelected');
            if (oFESDetail ==null ) { alert("Please select an item from list."); return ; }
            var nSelectedRowIndex=$('#tblWeftPlan').datagrid('getRowIndex',oFESDetail);
           
        }
        
        oFESDetail.ProductName=$("#txtSearchByProductNameWarp").val();
    
        oFESDetail.Value=parseFloat($("#txtPValue").val());
        oFESDetail.EndsCount=parseFloat($("#txtPickEPPI").val());
        oFESDetail.ProductID=parseInt(_nProductID);
        oFESDetail.BeamType=parseInt($("#cboBeamType").val());
        oFESDetail.IsYarnExist=$("#chkIsDeductYes").is(":checked");
        if(parseInt($('#cboDispoProType').val())==3) 
        {
            oFESDetail.Qty=parseFloat($("#txtQty_DO").val());
        }

        if(_IsWarp==true)
        {
            $('#tblWarpPlan').datagrid('updateRow', { index: nSelectedRowIndex, row: oFESDetail });
        }
        else{
            $('#tblWeftPlan').datagrid('updateRow', { index: nSelectedRowIndex, row: oFESDetail });
        }

        endEditingFabricPatternWarp();
        endEditingFabricPatternWeft();
        editIndex = undefined;

        $("#winExPIDetail").icsWindow("close");
        //RefreshTotalSummery();
    });
    $("#btnCloseFSEDetail").click(function () {

        $("#winExPIDetail").icsWindow("close");

    });
    /// end Update Detail

    /// For Out Party
    $("#btnClrContractor").click(function () {
        $("#txtContractorName").val("");
        _oFEOS.ContractorID=0;
      
    });
    $("#btnPickContractor").click(function () {
      
            var oContractor = {
                Params: '3,2' + '~' + $.trim($("#txtContractorName").val()+'~'+sessionStorage.getItem("BUID"))
            };

        GetContractors(oContractor);
    });
    $("#txtContractorName").keydown(function (e) {
        var nkeyCode = e.keyCode || e.which;
        if(nkeyCode==13){
            var sContractorName=$.trim($("#txtContractorName").val());
            if(sContractorName=="" || sContractorName==null)
            {
                alert("Please, Type name or part of Name");
                $("#txtContractorName").focus();
                $("#txtContractorName").addClass("errorFieldBorder");
                return;
            }
            var oContractor = {
                Params: '3,2' + '~' + $.trim($("#txtContractorName").val()+'~'+sessionStorage.getItem("BUID"))
            };
            GetContractors(oContractor);
        }
        else if(nkeyCode==8){
            $("#txtContractorName").val("");
            _oFEOS.ContractorID=0;
          
        }
    });
    function GetContractors(oContractor){


        var obj = {
            BaseAddress: _sBaseAddress,
            Object: oContractor,
            ControllerName: "Contractor",
            ActionName: "ContractorSearchByNameType",
            IsWinClose: false
        };
        $("#progressbar").progressbar({ value: 0 });
        $("#progressbarParent").show();
        var intervalID = setInterval(updateProgress, 250);
        $.icsDataGets(obj, function (response) {

            clearInterval(intervalID);
            $("#progressbarParent").hide();
            if (response.status && response.objs.length > 0) {
                if (response.objs[0].ContractorID > 0) {
                    debugger;
                    var tblColums = [];
                    var oColumn = { field: "ContractorID", title: "Code", width: 50, align: "center" };tblColums.push(oColumn);
                    oColumn = { field: "Name", title: "Name", width: 190, align: "left" };tblColums.push(oColumn);
                    oColumn = { field: "Phone", title: "Phone", width: 140, align: "left" };tblColums.push(oColumn);

                    var oPickerParam = {
                        winid: 'winContractorPicker',
                        winclass:'clsContractorPicker',
                        winwidth: 460,
                        winheight: 460,
                        tableid: 'tblContractorPicker',
                        tablecolumns: tblColums,
                        datalist: response.objs,
                        multiplereturn: false,
                        searchingbyfieldName:'Name',
                        windowTittle: 'Contractor List'
                    };
                    $.icsPicker(oPickerParam);
                    IntializePickerbuttonTwo(oPickerParam);//multiplereturn, winclassName
                }
                else { alert(response.objs[0].ErrorMessage); }
            }
            else{
                alert("No contractor found.");
            }
        });
    }
    $("#btnSaveOutSide").click(function (e) {
        debugger;
        if(_oFEOS.FEOSID<=0)
        {
            alert("First Save Specification");
            return;
        }
        RefreshOutParty(_oFEOS);
    });

    function RefreshOutParty(oFEOS)
    {
        if(parseInt(oFEOS.ContractorID)>0){oFEOS.IsOutSide=true}else {oFEOS.IsOutSide=false}
        var oFEOSTemp={FEOSID:oFEOS.FEOSID,  ContractorID: oFEOS.ContractorID,IsOutSide:oFEOS.IsOutSide,WarpWeftType:parseInt($('#cboWarpWeftType').val()) }
    
        $.ajax({
            type: "POST",
            dataType: "json",
            url: _sBaseAddress + "/FabricExecutionOrderSpecification/UpdateOutSide",
            traditional: true,
            data: JSON.stringify(oFEOSTemp),
            contentType: "application/json; charset=utf-8",
            success: function (data) {
                debugger;
                var oELC = jQuery.parseJSON(data);
                if (oELC.ErrorMessage == "" || oELC.ErrorMessage == null) {
                    alert("Data Save Succesfully!!");
                }
                else {
                    alert(oELC.ErrorMessage);
                }
            },
            error: function (xhr, status, error) {
                alert(error);
            }
        });
    }

    $("#txtSearchByProductNameWarp").keydown(function (e) {
        if (e.keyCode == 13) // Enter Press
        {
            ProductSearch($("#txtSearchByProductNameWarp").val());
        }
    });

    //$("#txtSearchByProductNameWarp").keydown(function (e) {
    //    if (e.keyCode === 13) // Enter Press
    //    {
    //        ProductSearch($("#txtSearchByProductNameWeft").val());
    //    }
    //});

    
    function ProductSearch(sProductName)
    {

    
        DynamicRefreshList([], "tblProductPickerByName");
  
        var oProduct = {
            BUID: sessionStorage.getItem("BUID"),
            ModuleNameInInt:201, //FabricPattern
            ProductUsagesInInt:1, //Regular
            ProductName: sProductName,
        };

        var obj = {
            BaseAddress: _sBaseAddress,
            Object: oProduct,
            ControllerName: "Product",
            ActionName: "GetProductsByBUModuleWithProductUse",
            IsWinClose: false
        };


        $.icsDataGets(obj, function (response) {

            if (response.status && response.objs.length > 0) {

                if (response.objs[0].ProductID > 0) {
                    var tblColums = [];
                    var oColumn = { field: "ProductCode", title: "Code", width: 120, align: "left" }; tblColums.push(oColumn);
                    oColumn = { field: "ProductName", title: "ProductName", width: 300, align: "left" }; tblColums.push(oColumn);
                    oColumn = { field: "ProductCategoryName", title: "Type", width: 80, align: "left" }; tblColums.push(oColumn);

                    var oPickerParam = {
                        winid: 'winProductPicker',
                        winclass: 'clsProductPicker',
                        winwidth: 600,
                        winheight: 480,
                        tableid: 'tblProductPicker',
                        tablecolumns: tblColums,
                        datalist: response.objs,
                        multiplereturn: false,
                        searchingbyfieldName: 'ProductName',
                        windowTittle: 'Product List'
                    };
                    $.icsPicker(oPickerParam);
                    IntializePickerbuttonTwo(oPickerParam);//multiplereturn, winclassName
                }
                else { alert(response.objs[0].ErrorMessage); }
            }
            else { alert("No Product Found."); }
        });
    }

    function RefreshControlLayout()
    {
        //debugger;
        $('#btnApproveFEOS').hide();
        if(HavePermission('Approved','FabricSpecification')){  $('#btnApproveFEOS').show();}
    }

    function HavePermission(sOperationType, sDbObject)
    {
        var nSessionID =@Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(HttpContext.Current.Session[SessionInfo.currentUserID]));
        if(nSessionID == -9)
        {
            return true;
        }
        else
        {
            if(_oAuthorizationRolesMapping!=null)
            {
                for(var i =0;i<_oAuthorizationRolesMapping.length;i++)
                {
                    if(_oAuthorizationRolesMapping[i].OperationTypeST == sOperationType && _oAuthorizationRolesMapping[i].ModuleNameST == sDbObject)
                        return  true;
                }
            }
            return false;
        }
    }

</script>
