@model IEnumerable<ESimSol.BusinessObjects.FabricSCReport>
    @{
        ViewBag.Title = "Fabric Receive";
    }

    <head>
        <title></title>
        <script src="@Url.Content("~/Views/Fabric/Fabric.js")" type="text/javascript"></script>
    </head>

    <div id="progressbarParent" style="width:100%;height:100%;margin:0 auto;text-align:center; margin-left: auto;margin-right: auto;left: 0;right: 0;z-index: 1;">
        <div style="margin: 0px auto;margin-top: 251px;text-align:center;width:390px;">
            <label style="font-size:18px;">Please wait</label>
            <div id="progressbar" style="width:100%;height:37px;"></div>
        </div>
    </div>
                    
    <div class="menuMainCollectionTable">
        <table id="tblFabricSCReports" title="PO(s)" class="easyui-datagrid" style="width:100%; height:100%" singleselect="true" data-options="fitColumns:false, rownumbers:true, pagination:false, autoRowHeight:false, toolbar: '#toolbarFabricSCReport', onLoadSuccess: onLoadSuccess">
            <thead>
            <th field="SCNoFull" width="11%" align="left">PO No</th>
            <th field="SCDateSt" width="6%" align="center">PO Issue Date</th>
            <th field="BuyerName" width="15%" align="left">Buying House</th>
            <th field="MKTGroup" width="8%" align="left"> MKT Team</th>
            <th field="MKTPName" width="8%" align="left"> Concern Person</th>
            <th field="CurrentStatusSt" width="6%" align="left"> Status</th>
            <th field="LabStatusST" width="10%" align="left">Lab Status</th>
            <th field="FabricNo" width="10%" align="left"> MKT Ref</th>
            <th field="StyleNo" width="10%" align="left">Style No</th>
            <th field="BuyerReference" width="10%" align="left">Buyer Ref</th>
            <th field="HLReference" width="10%" align="left"> Dispo No/ H/L Ref</th>
            <th field="ExeNo" width="10%" align="left"> <span id="lblDispoHLGrd">Dispo No</span> </th>
            @*<th field="HLReference" width="10%" align="left"> Approval Ref.</th>*@
            <th field="BuyerReference" width="10%" align="left"> Buyer Ref.</th>
            <th field="Construction" width="10%" align="left"> Construction</th>
            <th field="ProductName" width="10%" align="left">Composition</th>
            <th field="ProcessTypeName" width="10%" align="left"> Fabric type </th>
            <th field="FabricWeaveName" width="10%" align="left"> Weave</th>
            <th field="Size" width="10%" align="left"> Size</th>
            <th field="FinishTypeName" width="10%" align="left">Finish Type</th>
            <th field="ColorInfo" width="10%" align="left"> Color</th>
            <th field="FabricWidth" width="15%" align="left">Width</th>

            </thead>
        </table>

        <div id="toolbarFabricSCReport">
            <input id="txtSearchbyPONo" type="text" placeholder="Search by PO No" style="width:120px" />
            <input id="txtSearchbyFabricNo" type="text" placeholder="Search by Ref No" style="width:120px" />
            <input id="txtHLNO" type="text" placeholder="Search by HL No" style="width:120px" />
            <a id="btnAdvSearch" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-search" plain="true">Adv. Search</a>
            <a id="btnExeNoEntry" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-ok" plain="true"><span id="lblDispoHL">Receive& Issue No</span></a>
            @*<a id="btnReceive" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-ok" plain="true">Receive</a>*@
            <a id="btnEditFabric" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-ok" plain="true">Edit Fabric</a>
            @*<a id="btnExeNoEntry" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-ok" plain="true"><span id="lblDispoHL">Dispo No</span></a>*@
            <a id="btnDyeingOrder" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-ok" plain="true"><span id="lblDispoHL">Dyeing Order</span></a>
            @*<a id="btnRequestForLabdipTemp" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-ok" plain="true">Req For Labdip</a>*@
            <a id="btnRequestForLabdip" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-ok" plain="true">Labdip</a>
            <a id="btnPrintLD" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-print" plain="true">Preview(Labdip)</a>        
    @*<a id="btnPrint" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-print" plain="true">Print</a>*@
            <a id="btnPrintXL" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-excel" plain="true">ExportXL</a>
            <a id="btnPrintHLDelivery" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-print" plain="true">HL Delivery</a>
            <a id="btnPrintHLSwatch" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-print" plain="true">HL Swatch</a>
            <a id="btnFabricPattern" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-ok" plain="true">Pattern</a>
            <a id="btnSubmitFabricInFabricPattern" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-ok" plain="true">Submit to HO</a>
            <a id="btnSpecification" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-details" plain="true">Specification</a>
            <a id="btnFabricHistory" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-details" plain="true">Fabric History</a>
        </div>
    </div>
   
    <div id="winAdvSearch" class="easyui-window winClass" style="width:620px" title="Adv. Search" data-options="modal:true,closed:true,collapsible:false,minimizable:false,maximizable:false,closable:false">
        <div>
            <fieldset style="margin-bottom: 0px;">
                <legend>Searching Criteria</legend>
                <table style="width:100%;text-align:right;">
                    <tr>
                        <td style="width:20%;text-align:right;">
                            <label>P/I No :</label>
                        </td>
                        <td style=" width:30%;text-align:left;">
                            <input id="txtPINo" style="width:100%;" type="text" />
                        </td>
                        <td style=" width:20%;text-align:right;">
                            <label>Mkt Ref No :</label>
                        </td>
                        <td style=" width:30%;text-align:left;">
                            <input id="txtFabricID" style="width:80%;" type="text" />
                        </td>
                    </tr>

                    <tr>
                        <td style=" width:20%;text-align:right;">
                            <label>Issue To :</label>
                        </td>
                        <td colspan="3" style=" width:80%;text-align:left;">
                            <input id="txtContractorAdvS" style="width:80%;" type="text" placeholder="Type & Press Enter" />
                            <a id="btnPickContractorAdvS" href="javascript:void(0)" class="easyui-linkbutton ics-pick" iconcls="icon-pick" plain="true"></a>
                            <a id="btnClrContractorAdvS" href="javascript:void(0)" class="easyui-linkbutton ics-pick" iconcls="icon-clear" plain="true"></a>
                        </td>
                    </tr>

                    <tr>
                        <td style=" width:20%;text-align:right;">
                            <label>Buying House :</label>
                        </td>
                        <td colspan="3" style=" width:80%;text-align:left;">
                            <input id="txtDeliverTo" style="width:80%;" type="text" placeholder="Type & Press Enter" />
                            <a id="btnPickDeliverTo" href="javascript:void(0)" class="easyui-linkbutton ics-pick" iconcls="icon-pick" plain="true"></a>
                            <a id="btnClrDeliverTo" href="javascript:void(0)" class="easyui-linkbutton ics-pick" iconcls="icon-clear" plain="true"></a>
                        </td>
                    </tr>
                    <tr>
                        <td style=" width:20%;text-align:right;">
                            <label>Mkt Account:</label>
                        </td>
                        <td colspan="3" style=" width:80%;text-align:left;">
                            <input id="txtMktAccount" class="reset-text" placeholder="Search Concern Person" style="width:80%" />
                            <a id="btnPickMktAccount" href="javascript:void(0)" class="easyui-linkbutton ics-pick" iconcls="icon-pick" plain="true"></a>
                            <a id="btnResetMktPerson" href="javascript:void(0)" class="easyui-linkbutton ics-pick" iconcls="icon-clear" plain="true"></a>
                        </td>
                    </tr>
                    <tr>
                        <td style=" width:20%;text-align:right;">
                            <label>PO Date:</label>
                        </td>
                        <td colspan="3" style=" width:80%;text-align:right;">
                            <div style="float:left; width:100%">
                                <div style="float:left; width:30%">
                                    <select style="width:95%;" id="cboPODate" onchange="DateActions_OPDate(); "></select>
                                </div>
                                <div style="float:left; width:25%; padding-left:5px;">
                                    <input id="txtFromPODate" type="text" style="width: 110px;" class="easyui-datebox" required="required" data-options="formatter:icsdateformat,parser:icsdateparser" />
                                </div>
                                <div style="float:left; width:5%; text-align:center">to</div>
                                <div style="float:left; width:25%; padding-left:5px;">
                                    <input id="txtToPODate" type="text" style="width: 110px;" class="easyui-datebox" required="required" data-options="formatter:icsdateformat,parser:icsdateparser" />
                                </div>
                            </div>
                        </td>
                    </tr>
                    <tr>
                        <td style=" width:20%;text-align:right;">
                            <label>Approve Date:</label>
                        </td>
                        <td colspan="3" style=" width:80%;text-align:right;">
                            <div style="float:left; width:100%">
                                <div style="float:left; width:30%">
                                    <select style="width:95%;" id="cboApproveDate" onchange="DateActions_ApproveDate(); "></select>
                                </div>
                                <div style="float:left; width:25%; padding-left:5px;">
                                    <input id="txtFromApproveDate" type="text" style="width: 110px;" class="easyui-datebox" required="required" data-options="formatter:icsdateformat,parser:icsdateparser" />
                                </div>
                                <div style="float:left; width:5%; text-align:center">to</div>
                                <div style="float:left; width:25%; padding-left:5px;">
                                    <input id="txtToApproveDate" type="text" style="width: 110px;" class="easyui-datebox" required="required" data-options="formatter:icsdateformat,parser:icsdateparser" />
                                </div>
                            </div>
                        </td>
                    </tr>
                    <tr>
                        <td style=" width:20%;text-align:right;">
                            <label>Production Type:</label>
                        </td>
                        <td style=" width:30%;text-align:left;">
                            <select id="cboProductionType" style="width:90%;"><option value="0">All</option><option value="1">In House</option><option value="2">Sub Contract</option></select>
                        </td>
                        <td style=" width:20%;text-align:right;">
                            <label>Print PO:</label>
                        </td>
                        <td style=" width:30%;text-align:left;">
                            <select style="width:80%;" id="cboIsPrinting">
                                <option value="0">Default</option>
                                <option value="1">Print</option>
                                <option value="2">Not Print</option>
                            </select>
                        </td>
                    </tr>
                    <tr>
                     
                        <td colspan="4" style="width:95%;text-align:left;">
                            <div style="margin-top: 2px;">
                                <table style="width:100%; height: 150px;">
                                    <tr>
                                        <td style="width:35%;">
                                            <table id="tblOrderTypes" class="easyui-datagrid" title="Order Type" style="width:99%; height: 150px;" data-options="singleSelect: false,fitColumns:false, rownumbers:true, pagination:false, autoRowHeight:false, ">
                                                <thead>
                                                    <tr>
                                                        <th data-options="field:'Selected',checkbox:true"></th>
                                                        <th field="Value" width="80%"></th>
                                                    </tr>
                                                </thead>
                                            </table>
                                        </td>
                                        <td style="width:30%;">
                                            <table id="tblCurrentStatuss" class="easyui-datagrid" title="Order Status" style="width:99%; height: 150px;" data-options="singleSelect: false,fitColumns:false, rownumbers:true, pagination:false, autoRowHeight:false, ">
                                                <thead>
                                                    <tr>
                                                        <th data-options="field:'Selected',checkbox:true"></th>
                                                        <th field="Value" width="80%"></th>
                                                    </tr>
                                                </thead>
                                            </table>
                                        </td>
                                        <td style="width:35%;">
                                            <table id="tblLabStatuss" class="easyui-datagrid" title="Lab Status" style="width:99%; height: 150px;" data-options="singleSelect: false,fitColumns:false, rownumbers:true, pagination:false, autoRowHeight:false, ">
                                                <thead>
                                                    <tr>
                                                        <th data-options="field:'Selected',checkbox:true"></th>
                                                        <th field="Value" width="80%"></th>
                                                    </tr>
                                                </thead>
                                            </table>
                                        </td>
                                    </tr>
                                </table>


                            </div>
                        </td>
                    </tr>
                    <tr> 

                        <td colspan="4" style="width:50%;text-align:left;">
                            <div style="margin-top: 0px;">
                                <table style="width:100%;">
                                    <tr>
                                        <td style=" width:20%;text-align:right;"></td>
                                        <td style="width:40%; text-align:left;">
                                            <div><input type="checkbox" id="chkReceived" /> <span><label>Received</label></span></div>
                                            <div><input type="checkbox" id="chkSubmittedHO" /><span><label>Submitted HO</label></span></div>
                                           
                                        </td>

                                        <td style="width:40%;text-align:left;">
                                            <div><input type="checkbox" id="chkWatingForLab" /> <span><label>Waiting For Lab</label></span></div>
                                            <div><input type="checkbox" id="chkYetToSubmittedHO" /> <span><label>Yet To Submit HO</label></span></div>
                                        </td>
                                    </tr>
                                </table>


                            </div>
                        </td>

                        
                        
                    </tr>

                </table>
            </fieldset>

            <fieldset>
                <legend>Actions : </legend>
                <table style="width:100%;text-align:right;">
                    <tr>
                        <td style="width:20%;text-align:right;">
                            <a id="btnResetAdvSearch" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-reload" plain="true">Reset</a>
                        </td>
                        <td style="width:80%;text-align:right;">
                            <label class="lblLoadingMessage" style="float: left;">Loading Please Wait...</label>
                            <a id="btnSearchAdvSearch" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-search" plain="true">Search</a>
                            <a id="btnCloseAdvSearch" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-cancel" plain="true">Close</a>
                        </td>
                    </tr>
                </table>

            </fieldset>
        </div>
    </div>

    <div id="winExeEntry" class="easyui-window" title="Dispo No" data-options="modal:true,closed:true,collapsible:false,minimizable:false,maximizable:false,closable:true">

        <div>

            <div style="margin-left:0px; margin-top:0px">
                <table cellpadding="2" cellspacing="2" style="width:100%;">
                    <tr>
                        <td style="width:15%;text-align:right">
                            PO No:
                        </td>

                        <td style="width:20%">
                            <input type="text" id="txtSCNo_ExC" style="width:100%" disabled="disabled" />
                        </td>
                        <td style="width:20%;text-align:right">
                            Order Type:
                        </td>
                        <td style="width:20%">
                            <input type="text" id="txtOrderType" style="width:100%" disabled="disabled" />
                        </td>
                        <td style="width:25%;text-align:right"></td>

                    </tr>

                    <tr>
                        <td style="width:15%;text-align:right">
                            Issue To:
                        </td>

                        <td colspan="3" style="width:60%;text-align:left">
                            <input type="text" style="width:100%;" id="txtContractor_EXC" disabled="disabled" />
                        </td>
                        <td style="width:25%;text-align:right"></td>
                    </tr>
                </table>
                <table id="tblFSCDetails" title="Fabric Description" class="easyui-datagrid" style="width:100%;height:298px;" fitcolumns="false" rownumbers="true" pagination="false" singleselect="true" autorowheight="false" toolbar="#toolbarOne" data-options="onClickRow: onClickRow">
                    <thead>
                        <tr>
                            <th field="IsProductionSt" width="6%" align="left"></th>
                            <th field="ProductName" width="12%" align="left">Composition</th>
                            <th field="FabricNo" width="10%" align="left">Mkt. Ref. No</th>
                            <th field="Construction" width="10%">Construction</th>
                            <th data-options="field:'ExeNo',width:180,height:60 ,align:'Left',editor:{type:'text'}" align="Left"><span id="lblDispoHLEntry">Dispo No</span></th>
                            <th data-options="field:'OptionNo',width:180,height:60 ,align:'Left',editor:{type:'text'}" align="Left">Option No</th>
                            <th field="Qty" formatter="formatPrice" width="8%" align="right">Qty (Y)</th>
                            <th field="QtyTwo" formatter="formatPrice" width="8%" align="right">Qty (Y)</th>
                            <th field="FabricWidth" width="10%">Fabric Width</th>
                            <th field="StyleNo" width="10%">Style No</th>
                            <th field="BuyerReference" width="10%">Buyer Ref</th>
                            <th field="ColorInfo" width="10%">Buyer Ref</th>
                            <th field="DesignPattern" width="10%">Design&Pattern</th>
                            <th field="Note" width="10%">Note</th>
                        </tr>
                    </thead>
                </table>
                <div id="toolbarOne">
                    <a id="btnRefresh" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-reload" plain="true">Refresh</a>
                </div>
                <table id="tblTotalSumFSCDetails" style="width:100%;font-size:11px; font-weight:bold" border="0">
                    <tr>
                        <td id="tdTotalCaption" style="width: 40%; text-align: right; font-size: 12px; font-weight:bold"></td>
                        <td id="tdTotalCaption" style="width: 10%; text-align: right; font-size: 12px; font-weight:bold"> Total : </td>
                        <td style="width: 15%; text-align: right; font-size: 12px">
                            <label id="lblTotalQty" style="text-align: right; font-size:12px; float: right; font-weight:bold;">0.00</label>
                        </td>
                        <td style="width: 15%; text-align: right; font-size: 12px"></td>
                        <td id="tdTotalCaption" style="width: 20%; text-align: right; font-size: 12px; font-weight:bold">  </td>
                    </tr>
                </table>
            </div>
        </div>
        <fieldset class="actionfieldsetstyle">
            <legend>Actions : </legend>
            <a id="btnSaveExeNo" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-save" plain="true">Save</a>
            <a id="btnCloseExeNo" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-cancel" plain="true">Close</a>
        </fieldset>
    </div>

    <div id="winFabricReceive" class="easyui-window" title="Receive Fabrci Sales Contract" data-options="modal:true,closed:true,collapsible:false,minimizable:false,maximizable:false,closable:true">
        <fieldset>
            <div class="col-lg-12">
                <div class="col-lg-4 text-right">
                    <label>PO No:</label>
                </div>
                <div class="col-lg-8 text-left">
                    <label id="lblPONO">heoo!</label>
                </div>
            </div>
            <div class="col-lg-12">
                <div class="col-lg-4 text-right">
                    <label>Recevie Date:</label>
                </div>
                <div class="col-lg-8 text-left">
                    <input id="dtFSCReceiveDate" type="text" style="width: 110px;" class="easyui-datebox" required="required" data-options="formatter:icsdateformat,parser:icsdateparser" />
                </div>
            </div>
            
        </fieldset>
        <fieldset class="actionfieldsetstyle">
            <legend>Actions : </legend> 
            <a id="btnRecFabricSalesContact" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-ok" plain="true">Receive</a>
            <a id="btnCloseFabricSalesContact" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-cancel" plain="true">Close</a>
        </fieldset>
     </div>
  
    <div id="winFabric" style="width:900px;" class="easyui-window winstyle" title="Fabric" data-options="modal:true,closed:true,collapsible:false,minimizable:false,maximizable:false,closable:false">
        <fieldset>
            <table class="tbl">
                <tr style="vertical-align:top">
                    <td style="width:50%">
                        <table cellspacing="1" cellpadding="1" border="0" class="tbl">
                            <tr>
                                <td class="tdLabel">
                                    <label>P Number :</label>
                                </td>
                                <td class="tdInput">
                                    <div style="float:left">
                                        <div style="float:left; width:6%">
                                            <input id="txtP" placeholder="P" type="text" />
                                        </div>
                                        <div style="float:left; width:29%">
                                            <input id="txtFabricNoFabric" placeholder="YY MM XXXXX" type="text" />
                                        </div>
                                        <div style="float:left; width:25%" class="text-right">
                                            <label>Issue Date :</label>
                                        </div>
                                        <div style="float:left; width:35%">
                                            <input id="txtDateFabric" type="text" style="width: 100%;" class="easyui-datebox" required="required" data-options="formatter:icsdateformat,parser:icsdateparser" />
                                        </div>
                                    </div>

                                </td>
                            </tr>
                            <tr class="oneTextTwoButton">
                                <td class="tdLabel">
                                    <label class="lblStar">*</label>
                                    <label>Mkt. Person :</label>
                                </td>
                                <td class="tdInput">
                                    <select id="cboMktPersonsFabric"></select>
                                </td>
                            </tr>
                            <tr class="oneTextTwoButton">
                                <td class="tdLabel">
                                    <label class="lblStar">*</label>
                                    <label>Buyer :</label>
                                </td>
                                <td class="tdInput">
                                    <input id="txtContractorName" class="reset-text" style="width:76%;" placeholder="Type & Press Enter" />
                                    <a id="btnContractor" href="javascript:void(0)" class="easyui-linkbutton ics-pick" iconcls="icon-pick" plain="true"></a>
                                    <a id="btnResetContractor" href="javascript:void(0)" class="easyui-linkbutton ics-pick" iconcls="icon-clear" plain="true"></a>
                                </td>
                            </tr>
                            <tr>
                                <td class="tdLabel">
                                    <label>Buyer Ref :</label>
                                </td>
                                <td class="tdInput">
                                    <input id="txtBuyerReferenceFabric" type="text" />
                                </td>
                            </tr>
                            <tr class="oneTextTwoButton">
                                <td class="tdLabel">
                                    <label class="lblStar">*</label>
                                    <label>Composition :</label>
                                </td>
                                <td class="tdInput">
                                    <select id="cboProductFabric"></select>
                                </td>
                            </tr>
                            <tr>
                                <td class="tdLabel">
                                    <label>Construction :</label>
                                </td>
                                <td class="tdInput">
                                    <input id="txtConstructionFabric" type="text" />
                                </td>
                            </tr>
                            <tr>
                                <td class="tdLabel">
                                    <label>Construction(PI):</label>
                                </td>
                                <td class="tdInput">
                                    <input id="txtConstructionFabricPI" type="text" />
                                </td>
                            </tr>
                            <tr>
                                <td class="tdLabel">
                                    <label>Width :</label>
                                </td>
                                <td class="tdInput">
                                    <input id="txtFabricWidthFabric" type="text" />
                                </td>
                            </tr>
                            <tr>
                                <td class="tdLabel">
                                    <label>Process Type :</label>
                                </td>
                                <td class="tdInput">
                                    <select id="cboProcessTypeFabric"></select>
                                </td>
                            </tr>
                            <tr>
                                <td class="tdLabel">
                                    <label>Fabric Design :</label>
                                </td>
                                <td class="tdInput">
                                    <select id="cboFabricDesign"></select>
                                </td>
                            </tr>
                            <tr>
                                <td class="tdLabel">
                                    <label>Weave:</label>
                                </td>
                                <td class="tdInput">
                                    <select id="cboWeaveFabric"></select>
                                </td>
                            </tr>
                            <tr>
                                <td class="tdLabel">
                                    <label>Finish Type :</label>
                                </td>
                                <td class="tdInput">
                                    <select id="cboFinishTypeFabric"></select>
                                </td>
                            </tr>

                            <tr>
                                <td class="tdLabel">
                                    <label>Style No :</label>
                                </td>
                                <td class="tdInputC">
                                    <input id="txtStyleNoFabric" type="text" />
                                </td>
                            </tr>
                            <tr>
                                <td class="tdLabel">
                                    <label>Color :</label>
                                </td>
                                <td class="tdInputC">
                                    <input id="txtColorFabric" type="text" />
                                </td>
                            </tr>
                            <tr>
                                <td class="tdLabel">
                                    <label>Actual Construction:</label>
                                </td>
                                <td class="tdInputC">
                                    <input id="txtActualConstruction" type="text"/>
                                </td>
                            </tr>
                        </table>
                    </td>
                    <td style="vertical-align:top; width:50%">
                        <table class="tbl">

                            <tr style="vertical-align:top">
                                <td style="width:32%"></td>
                                <td class="tdLabel">
                                    <table style="width:100%;border:1px solid grey; border-collapse:collapse;text-align:left" border="1" cellpadding="0" cellspacing="0">
                                        <tr>
                                            <td style="width:40%;font-size:13px; font-weight: bold;text-align:center">Buyer Request</td>
                                            <td style="width:30%;font-size:13px; font-weight: bold;text-align:center">Seeking Date</td>
                                            <td style="width:30%;font-size:13px; font-weight: bold;text-align:center">Sets</td>
                                        </tr>
                                        <tr style="text-align:left;">
                                            <td style="text-align:left; width:40%;"><input id="chkIsHandLoom" type="checkbox" />Hand Loom</td>
                                            <td class="tdInputDateBox" style="width:30%;">
                                                <input id="txtHandLoomDate" type="text" style="width: 100px;" class="easyui-datebox" data-options="formatter:icsdateformat,parser:icsdateparser" />
                                            </td>
                                            <td style="text-align:left; width:30%;"><input id="txtHandLommSet" class="numberField" type="text" style="width:100%;" /></td>
                                        </tr>
                                        <tr class="regionFabricStage">
                                            <td style="text-align:left; width:40%;"><input id="chkIsSample" type="checkbox" />Sample</td>
                                            <td class="tdInputDateBox" style="width:30%;">
                                                <input id="txtSampleDate" type="text" style="width: 100px;" class="easyui-datebox" data-options="formatter:icsdateformat,parser:icsdateparser" />
                                            </td>
                                            <td style="text-align:left; width:30%;"><input id="txtSampleSet" class="numberField" type="text" style="width:100%;" /></td>
                                        </tr>
                                        <tr class="regionFabricStage">
                                            <td style="text-align:left; width:40%;"><input id="chkIsBulk" type="checkbox" />Bulk</td>
                                            <td class="tdInputDateBox" style="width:30%;">
                                                <input id="txtBulkDate" type="text" style="width: 100px;" class="easyui-datebox" required="required" data-options="formatter:icsdateformat,parser:icsdateparser" />
                                            </td>
                                            <td style="text-align:left; width:30%;"><input id="txtBulkSet" class="numberField" type="text" style="width:100%;" /></td>
                                        </tr>
                                        <tr>
                                            <td style="text-align:left; width:40%;"><input id="chkIsAnalysis" type="checkbox" />Analysis</td>
                                            <td class="tdInputDateBox" style="width:30%;">
                                                <input id="txtAnalysis" type="text" style="width: 100px;" class="easyui-datebox" required="required" data-options="formatter:icsdateformat,parser:icsdateparser" />
                                            </td>
                                            <td style="text-align:left; width:30%;"><input id="txtAnalysisSet" class="numberField" type="text" style="width:100%;" /></td>
                                        </tr>
                                        <tr class="regionFabricStage">
                                            <td style="text-align:left; width:40%;"><input id="chkIsCAD" type="checkbox" />CAD</td>
                                            <td class="tdInputDateBox" style="width:30%;">
                                                <input id="txtCADDate" type="text" style="width: 100px;" class="easyui-datebox" required="required" data-options="formatter:icsdateformat,parser:icsdateparser" />
                                            </td>
                                            <td style="text-align:left; width:30%;"><input id="txtCadSet" class="numberField" type="text" style="width:100%;" /></td>
                                        </tr>
                                        <tr class="regionFabricStage">
                                            <td style="text-align:left; width:40%;"><input id="chkIsColor" type="checkbox" />Color Standard</td>
                                            <td class="tdInputDateBox" style="width:30%;">
                                                <input id="txtColorDate" type="text" style="width: 100px;" class="easyui-datebox" required="required" data-options="formatter:icsdateformat,parser:icsdateparser" />
                                            </td>
                                            <td style="text-align:left; width:30%;"><input id="txtColorSet" class="numberField" type="text" style="width:100%;" /></td>
                                        </tr>
                                        <tr>
                                            <td style="text-align:left; width:40%;"><input id="chkIsLabdip" type="checkbox" />Labdip</td>
                                            <td class="tdInputDateBox" style="width:30%;">
                                                <input id="txtLabdipDate" type="text" style="width: 100px;" class="easyui-datebox" required="required" data-options="formatter:icsdateformat,parser:icsdateparser" />
                                            </td>
                                            <td style="text-align:left; width:30%;"><input id="txtLabdipSet" class="numberField" type="text" style="width:100%;" /></td>
                                        </tr>
                                        <tr>
                                            <td style="text-align:left; width:40%;"><input id="chkIsYarnSkein" type="checkbox" />YarnSkein</td>
                                            <td class="tdInputDateBox" style="width:30%;">
                                                <input id="txtYarnSkein" type="text" style="width: 100px;" class="easyui-datebox" required="required" data-options="formatter:icsdateformat,parser:icsdateparser" />
                                            </td>
                                            <td style="text-align:left; width:30%;"><input id="txtYarnSkeinSet" class="numberField" type="text" style="width:100%;" /></td>
                                        </tr>
                                    </table>

                                </td>
                            </tr>
                            <tr>
                                <td style="width:32%"></td>
                                <td class="tdInputChk">

                                    <ul style="margin-left:0px;">
                                        <li><input id="chkWashFabric" type="checkbox" />Wash</li>
                                        <li><input id="chkFinishFabric" type="checkbox" />Finish</li>
                                        <li><input id="chkDyeingFabric" type="checkbox" />Dyeing</li>
                                        <li><input id="chkPrintFabric" type="checkbox" />Print</li>
                                    </ul>

                                </td>
                            </tr>
                            <tr>
                                <td class="tdLabel">
                                    <label>Priority Level :</label>
                                </td>
                                <td class="tdInput">
                                    <select id="cboPriorityLevelFabric"></select>
                                </td>
                            </tr>
                            <tr>
                                <td class="tdLabel">
                                    <label>Note :</label>
                                </td>
                                <td class="tdInputC">
                                    @*<input id="txtNoteFabric" type="text" />*@
                                    <textarea rows="1" id="txtNoteFabric" style="text-align:left; width:99%; height:40px; font-family:Tahoma; font-size:12px" placeholder="Narration"></textarea>
                                </td>
                            </tr>
                            <tr>
                                <td class="tdLabel">
                                    <label>H/L No:</label>
                                </td>
                                <td class="tdInputC">
                                    <input id="txtHLNo" type="text" style="width:100%;" />
                                </td>
                            </tr>
                            <tr>
                                <td class="tdLabel">
                                    <label>Primary Light Src. :</label>
                                </td>
                                <td class="tdInputC">
                                    <select id="cboPrimaryLightSource" style="width:100%;"></select>
                                </td>
                            </tr>
                            <tr>
                                <td class="tdLabel">
                                    <label>Secondary Light Src. :</label>
                                </td>
                                <td class="tdInputC">
                                    <select id="cboSecondaryLightSource" style="width:100%;"></select>
                                </td>
                            </tr>
                            <tr>
                                <td class="tdLabel">
                                    <label>End Use:</label>
                                </td>
                                <td class="tdInputC">
                                    <input id="txtEndUse" type="text" style="width:100%;" />                                   
                                </td>
                            </tr>
                            <tr>
                                <td class="tdLabel">
                                    <label>No of Frame:</label>
                                </td>
                                <td class="tdInputC">
                                    <div style="float:left; width:100%">
                                        <div style="float:left; width:30%">
                                            <input id="txtNoOfFrame" class="numberFormat" type="text" style="width:100%;" />
                                        </div>
                                        <div style="float:left; width:25%; text-align:right">
                                            <label>Weft Color:</label>
                                        </div>
                                        <div style="float:left; width:45%">
                                            <input id="txtWeftColor" type="text" style="width:100%;" />
                                        </div>
                                    </div>
                                </td>
                            </tr>


                            <tr id="trFabricHideShowFields">
                                <td class="tdLabel">
                                    <label class="">Receive Date : </label>
                                </td>
                                <td class="tdInput">
                                    <input id="txtReceiveDateFabric" type="text" style="width: 100px;" class="easyui-datebox" required="required" data-options="formatter:icsdateformat,parser:icsdateparser" />
                                    <label style="margin-left: 1px;">Sub Date : </label>
                                    <input id="txtSubDateFabric" type="text" style="width: 100px;" class="easyui-datebox" required="required" data-options="formatter:icsdateformat,parser:icsdateparser" />
                                </td>
                            </tr>
                            @*<tr>
                <td class="tdLabel">
                    <label>Seeking Date:</label>
                </td>
                <td class="tdInputDateBox">

                    <input id="txtSeekingDateFabric" type="text" style="width: 100px;" class="easyui-datebox" required="required" data-options="formatter:icsdateformat,parser:icsdateparser" />
                </td>
            </tr>*@
                        </table>
                    </td>
                </tr>
            </table>
        </fieldset>
        <fieldset class="actionfieldsetstyle">
            <legend>Actions : </legend>
            <table border="0" cellpadding="0" cellspacing="0" style="float:right; width:100%;">
                <tr>
                    <td style="text-align:left">
                        <a id="btnShowHistory" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-details" plain="true">History</a>
                    </td>
                    <td>
                        <a id="btnSubmitFabricInFabric" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-ok" plain="true">Submit</a>
                        <label id="lblGiveInfo" style="color:#c00;">No Of Copy</label>
                        <input id="txtCopyNo" style="width:2%" placeholder="1" class="number" type="text" />
                        <a id="btnReFabricSubmissionSave" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-save" plain="true">Save</a>
                        <a id="btnCopyFabric" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-copy" plain="true">Copy</a>
                        <a id="btnSaveFabric" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-save" plain="true">Save</a>
                        <a id="btnCloseFabric" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-cancel" plain="true">Close</a>
                    </td>
                </tr>
            </table>
        </fieldset>
    </div>

    <div id="winFabricHistory" class="easyui-window" title="Fabric Suggestion History" data-options="modal:true,closed:true,collapsible:false,minimizable:false,maximizable:false,closable:true">
        <table id="tblFabricHistory" class="easyui-datagrid" style="width:100%;height:298px;" fitcolumns="false" rownumbers="true" pagination="false" singleselect="true" autorowheight="false">
            <thead>
                <tr>
                    <th field="ModifiedTimeStr" width="12%">Modified Time</th>
                    <th field="ModifiedByName" width="10%">Modified By</th>
                    <th field="FabricNo" width="10%" align="left">Mkt. Ref. No</th>
                    <th field="ProductName" width="12%" align="left">Composition</th>
                    <th field="Construction" width="10%">Construction</th>
                    <th field="ColorInfo" width="10%">Color Info</th>
                    <th field="FabricWidth" width="10%">Fabric Width</th>
                    <th field="WeftColor" width="10%">Weft Color</th>
                    <th field="ActualConstruction" width="12%">Actual Construction</th>
                    <th field="FinishTypeName" width="10%">Finish Type</th>
                    <th field="ProcessTypeName" width="10%">Process Type</th>
                    <th field="CreatedByName" width="10%">Created By</th>
                </tr>
            </thead>
        </table>
        <fieldset class="actionfieldsetstyle">
            <legend>Actions : </legend>
            <a id="btnCloseFabricHistory" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-cancel" plain="true">Close</a>
        </fieldset>
    </div>

    <div id="winLabDip" style="width:80%;text-align:left" class="easyui-window" title="LabDip" data-options="modal:true,closed:true,collapsible:false,minimizable:false,maximizable:false,closable:true">

                          <div>

                              <div style="margin-left:0px; margin-top:0px">
                                  <fieldset style="height:50%">
                                      <legend style="font-weight:bold">Fabric Information :</legend>
                                      <table cellpadding="2" cellspacing="2" style="width:100%;">
                                          @*<tr>
                                <td style="width:15%;text-align:right">
                                    Issue To:
                                </td>

                                <td colspan="2" style="width:30%;text-align:left">
                                    <input type="text" style="width:100%;" id="txtContractor_EXC" disabled="disabled" />
                                </td>
                                <td style="width:20%;text-align:right">
                                    Order Type:
                                </td>
                                <td style="width:15%">
                                    <input type="text" id="txtOrderType" style="width:100%" disabled="disabled" />
                                </td>
                                <td style="width:20%;text-align:right"></td>
                            </tr>*@
                                          <tr>
                                              <td style="width:15%;text-align:right">
                                                  Dispo No :
                                              </td>

                                              <td style="width:20%">
                                                  <input type="text" id="txtDispoNo " style="width:100%" disabled="disabled" />
                                              </td>
                                              <td style="width:15%;text-align:right">
                                                  Mkt Ref No:
                                              </td>

                                              <td style="width:20%">
                                                  <input type="text" id="txtFabricNo_Lab" style="width:100%" disabled="disabled" />
                                              </td>
                                              <td style="width:10%;text-align:right">
                                                  PO No:
                                              </td>
                                              <td style="width:20%">
                                                  <input type="text" id="txtSCNo_Lab" style="width:100%" disabled="disabled" />
                                              </td>

                                          </tr>
                                          <tr>
                                              <td style="width:15%;text-align:right">
                                                  Composition :
                                              </td>
                                              <td style="width:20%">
                                                  <input type="text" id="txtComposition" style="width:100%" disabled="disabled" />
                                              </td>
                                              <td style="width:15%;text-align:right">
                                                  Construction :
                                              </td>
                                              <td style="width:20%">
                                                  <input type="text" id="txtConstruction" style="width:100%" disabled="disabled" />
                                              </td>
                                              <td style="width:10%;text-align:right">
                                                  Fabric type :
                                              </td>
                                              <td style="width:20%">
                                                  <input type="text" id="txtFabrictype" style="width:100%" disabled="disabled" />
                                              </td>

                                          </tr>
                                      </table>
                                  </fieldset>
                                  <div>
                                      <fieldset style="height:50%">
                                          <legend style="font-weight:bold">Lab Operation :</legend>
                                          <table  cellpadding="2" cellspacing="2" style="width:100%;font-size:12px; font-weight:normal">
                                              
                                                  <tr>
                                                      
                                                      <td style="width:55% ;height:150px">
                                                          <table id="tblLabdipHistory" class="easyui-datagrid" style="width:100%;height:150px;" fitcolumns="false" rownumbers="true" pagination="false" singleselect="true" autorowheight="false">
                                                              <thead>
                                                                  <tr>
                                                                      <th field="DateTimeSt" width="20%" align="left">Date</th>
                                                                      <th field="StatusSt" width="25%" align="left">Status</th>
                                                                      <th field="UserName" width="30%" align="left">User</th>
                                                                      <th field="Days" width="18%">Days</th>
                                                                      
                                                                  </tr>
                                                              </thead>
                                                          </table>
                                                          @*<div id="toolbarLDH">
                                                              <a id="btnRefreshLDH" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-reload" plain="true">Refresh</a>
                                                          </div>*@
                                                          </td>
                                                        <td style="width:5% ;height:150px">
                                                            </td>
                                                      <td style="width:40% ;height:150px;vertical-align:top;">
                                                          <table cellpadding="2"cellspacing="5" style="width:100%;border-top:1px solid black;border-right:1px solid black;border-left:1px solid black;border-bottom:1px solid black">
                                                              <tr style="width:40%; vertical-align:top; ">
                                                                  <td style="width:40%; text-align:left; ">Labdip Order No:</td>
                                                                  <td style="width:60%;"><input id="txtLabDipOrderNo" type="text" style="width:100%;" disabled="disabled" /></td>
                                                                
                                                              </tr>
                                                              <tr>
                                                                  <td style="width:40%; text-align:left;"> Labdip Status:</td>
                                                                  <td style="width:60%;"><input id="txtLabdipStatus" type="text" style="width:100%;" disabled="disabled" /></td>
                                                              </tr>
                                                              <tr>
                                                                  <td style="width:17%; text-align:left; "></td>
                                                                  <td style="width:10%;"></td>
                                                              </tr>
                                                              <tr style ="height:30px">
                                                                  <td style="width:17%; text-align:left; "></td>
                                                                  <td style="width:10%;"></td>
                                                              </tr>
                                                              <tr id="trLabdipRequest">
                                                                  <td style="width:17%; text-align:left; ">Request For Lab Dip:</td>
                                                                  <td style="width:10%;"><input id="btnSaveLabDip" type="button" value="Update" style="width:100%;" /></td>
                                                              </tr>
                                                              <tr id="trLabdipReceive">
                                                                  <td style="width:17%; text-align:left; ">Receive From Lab:</td>
                                                                  <td style="width:10%;"><input id="btnSaveLabRecd" type="button" value="Update" style="width:100%;" /></td>
                                                              </tr>
                                                              <tr style="height:30px">
                                                                  <td style="width:17%; text-align:left; "></td>
                                                                  <td style="width:10%;"></td>
                                                              </tr>
                                                             <tr id="trLabdipSubmit">
                                                                  <td style="width:17%; text-align:left; ">Submit To HO:</td>
                                                                  <td style="width:10%;"><input id="btnSaveLabdipSubmit" type="button" value="Update" style="width:100%;" /></td>
                                                              </tr>
                                                              <tr style="height:20px">
                                                                  <td style=" width:17%; text-align:left; "></td>
                                                                  <td style="width:10%;"></td>
                                                              </tr>
                                                          </table>
                                                      </td>
</tr>
                                          


                                          </table>
                                      </fieldset>
                                  </div>
                                 

                              </div>

                          </div>
                          <fieldset class="actionfieldsetstyle">
                              <legend>Actions : </legend>
                              @*<a id="btnSaveExeNo" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-save" plain="true">Save</a>*@
                              <a id="btnCloseLabDip" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-cancel" plain="true">Close</a>
                          </fieldset>
                      </div>
    <div id="winDyeingOrder" class="easyui-window" title="DyeingOrder No" data-options="modal:true,closed:true,collapsible:false,minimizable:false,maximizable:false,closable:true">

                          <div>

                              <div style="margin-left:0px; margin-top:0px">
                                  <table cellpadding="2" cellspacing="2" style="width:100%;">
                                      <tr>
                                          <td style="width:15%;text-align:right">
                                              PO No:
                                          </td>

                                          <td style="width:20%">
                                              <input type="text" id="txtSCNo_ExC" style="width:100%" disabled="disabled" />
                                          </td>
                                          <td style="width:20%;text-align:right">
                                              Order Type:
                                          </td>
                                          <td style="width:20%">
                                              <input type="text" id="txtOrderType" style="width:100%" disabled="disabled" />
                                          </td>
                                          <td style="width:25%;text-align:right"></td>

                                      </tr>

                                      <tr>
                                          <td style="width:15%;text-align:right">
                                              Issue To:
                                          </td>

                                          <td colspan="3" style="width:60%;text-align:left">
                                              <input type="text" style="width:100%;" id="txtContractor_EXC" disabled="disabled" />
                                          </td>
                                          <td style="width:25%;text-align:right"></td>
                                      </tr>
                                  </table>
                                  <table id="tblDyeingOrders" title="Order Detail(s)" class="easyui-datagrid" style="width:100%;height:298px;" fitcolumns="false" rownumbers="true" pagination="false" singleselect="true" autorowheight="false" toolbar="#toolbarOne" data-options="onClickRow: onClickRow">
                                      <thead>
                                          <tr>
                                              <th field="IsProductionSt" width="6%" align="left"></th>
                                              <th field="ProductName" width="12%" align="left">Composition</th>
                                              <th field="FabricNo" width="10%" align="left">Mkt. Ref. No</th>
                                              <th field="Construction" width="10%">Construction</th>
                                              <th data-options="field:'ExeNo',width:180,height:60 ,align:'Left',editor:{type:'text'}" align="Left"><span id="lblDispoHLEntry">Dispo No</span></th>
                                              <th data-options="field:'OptionNo',width:180,height:60 ,align:'Left',editor:{type:'text'}" align="Left">Option No</th>
                                              <th field="Qty" formatter="formatPrice" width="8%" align="right">Qty (Y)</th>
                                              <th field="QtyTwo" formatter="formatPrice" width="8%" align="right">Qty (Y)</th>
                                              <th field="FabricWidth" width="10%">Fabric Width</th>
                                              <th field="StyleNo" width="10%">Style No</th>
                                              <th field="BuyerReference" width="10%">Buyer Ref</th>
                                              <th field="ColorInfo" width="10%">Buyer Ref</th>
                                              <th field="DesignPattern" width="10%">Design&Pattern</th>
                                              <th field="Note" width="10%">Note</th>
                                          </tr>
                                      </thead>
                                  </table>
                                  <div id="toolbarOne">
                                      <a id="btnRefresh" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-reload" plain="true">Refresh</a>
                                  </div>
                                  <table id="tblTotalSumFSCDetails" style="width:100%;font-size:11px; font-weight:bold" border="0">
                                      <tr>
                                          <td id="tdTotalCaption" style="width: 40%; text-align: right; font-size: 12px; font-weight:bold"></td>
                                          <td id="tdTotalCaption" style="width: 10%; text-align: right; font-size: 12px; font-weight:bold"> Total : </td>
                                          <td style="width: 15%; text-align: right; font-size: 12px">
                                              <label id="lblTotalQty" style="text-align: right; font-size:12px; float: right; font-weight:bold;">0.00</label>
                                          </td>
                                          <td style="width: 15%; text-align: right; font-size: 12px"></td>
                                          <td id="tdTotalCaption" style="width: 20%; text-align: right; font-size: 12px; font-weight:bold">  </td>
                                      </tr>
                                  </table>
                              </div>
                          </div>
                          <fieldset class="actionfieldsetstyle">
                              <legend>Actions : </legend>
                              <a id="btnSaveDO" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-save" plain="true">Save</a>
                              <a id="btnCloseDO" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-cancel" plain="true">Close</a>
                          </fieldset>
                      </div>
    <style type="text/css">
        .lines-no .datagrid-body td {
            border-right: 1px dotted transparent;
            border-bottom: 1px dotted transparent;
        }

        #winFabricReceive{
            width:400px;
        }

        .lblStar {
            color: red;
            font-weight: bold;
        }
        .tdInputChk {
            width: 100%;
        }
        .tdInputChk ul{
            padding: 0;
            margin: 0;
        }
        .tdInputChk ul li{
            display: inline;
            list-style-type: none;
            margin:0 9px 0 0;   
        }
        /*.tdInputChk ul li input{
            margin: 0 2px 0 0;
        }*/
        .tdInput input {
            width: 96%;
        }
        .tdInputC input {
            width: 96%;
        }
        .tdInput select {
            width: 96%;
        }
    </style>

    <script type="text/javascript">
    var _sBaseAddress="";
    var _oFabricSCReport=null;
    var _oFabricSCReports=[];
    var _oBankBranchs=[];
    var _oCurrencys=[];
    var _oLCTerms=[];
    var _oCompanys=[];
    var _oLCTerms=[];
    var _oCompareOperators=[];
    var _oPaymentInstructions=[];
    var _oFabricPOStatus = [];
    var _oOrderTypes=[];
    var _nBUID = 0;
    var _sContractorIds = '';
    var _sBuyerIds = '';
    var _sMAccountIds='';
    var _oBU = null;
    var _nReportType=0;
    var _sProductIds="";

    var _oPriorityLevels=[];
    var _oMktPersons=[];
    var _oFinishTypes=[];
    var _oProcessTypes=[];
    var _oFabricWeaves=[];
    var _oFabricDesigns=[];
    var _oLightSources=[];
    var _typeOfReceive =[];
    var _oLabdipStatus=[];
    $(document).ready(function () {

        _sBaseAddress =@Html.Raw( new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(HttpContext.Current.Session[SessionInfo.BaseAddress]));
        _oFabricSCReports =@Html.Raw( new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(Model));
        _oCurrencys = @Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(ViewBag.Currencys));
        _oLCTerms = @Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(ViewBag.LCTerms));
        _oCompareOperators = @Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(ViewBag.CompareOperators));
        _nBUID = @Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(ViewBag.BUID));
        _oPaymentInstructions = @Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(ViewBag.PaymentInstructions));
        _oOrderTypes = @Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(ViewBag.OrderTypes));
        _oLabdipStatus = @Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(ViewBag.LabdipStatus));
        _oFabricPOStatus = @Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(ViewBag.FabricPOStatus));

        _oPriorityLevels = @Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(ViewBag.PriorityLevels));
        _oMktPersons = @Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(ViewBag.MktPersons));
        _oFinishTypes = @Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(ViewBag.FinishTypes));
        _oProcessTypes = @Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(ViewBag.ProcessTypes));
        _oFabricWeaves = @Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(ViewBag.FabricWeaves));
        _oFabricDesigns = @Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(ViewBag.FabricDesigns));
        _oLightSources = @Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(ViewBag.LightSources));
        _typeOfReceive = @Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(ViewBag.Type));
        debugger;
        if(parseInt(_typeOfReceive)==1){
            $('#tblFabricSCReports').datagrid({title:'Analysis PO'});
            $('#btnSpecification').hide();
        }
        else if(parseInt(_typeOfReceive)==2){
            $('#tblFabricSCReports').datagrid({title:'H/L PO'})
            $('#lblDispoHL').text("H/L NO Entry");
            $('#lblDispoHLGrd').text("H/L NO");
            $('#lblDispoHLEntry').text("H/L NO");
            $('#btnSpecification').hide();

        }
        else if(parseInt(_typeOfReceive)==3){
            $('#tblFabricSCReports').datagrid({title:'BULK PO'});
            $('#btnEditFabric').hide();
            $('#btnSpecification').show();
        }




        var oAuthorizationRolesMapping = @Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(HttpContext.Current.Session[SessionInfo.AuthorizationRolesMapping]));
        var oCellRowSpans = @Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(@ViewBag.CellRowSpans));

        InitializeFabricEvents();
       
        // DynamicRefreshList(_oFabricSCReports,'tblFabricSCReports');
        //sessionStorage.setItem("FabricSCReports", JSON.stringify(oCellRowSpans));

        var nIndex=-1;
        if(sessionStorage.getItem("CellRowSpans")!=null && sessionStorage.getItem("CellRowSpans").length>0)
        {
            oCellRowSpans= jQuery.parseJSON(sessionStorage.getItem('CellRowSpans'));
        }

        if(sessionStorage.getItem("FabricSCReports")!=null && sessionStorage.getItem("FabricSCReports").length>0)
        {
            _oFabricSCReports= jQuery.parseJSON(sessionStorage.getItem('FabricSCReports'));
            nIndex= sessionStorage.getItem('SelectedRowIndex');
        }

        $('#tblFabricSCReports').data('FDPs',_oFabricSCReports);
        $('#tblFabricSCReports').data('CellRowSpan',oCellRowSpans);
        DynamicRefreshList(_oFabricSCReports, 'tblFabricSCReports');
        if(nIndex>-1)
        {
            $('#tblFabricSCReports').datagrid('selectRow',nIndex);
        }
        SetGridData();

        if(sessionStorage.getItem("SelectedRowIndex")!=undefined){
            $("#tblFabricSCReports").datagrid("selectRow", parseInt(sessionStorage.getItem("SelectedRowIndex")));
        }

        $("#progressbar").progressbar({ value: 0 });
        $("#progressbarParent").hide();
        $(".lblLoadingMessage").hide();
        LoadComboAdv();
    });


    function SetGridData(){
        sessionStorage.setItem("FabricSCReports", JSON.stringify($('#tblFabricSCReports').data('FDPs')));
        sessionStorage.setItem("CellRowSpans", JSON.stringify($('#tblFabricSCReports').data('CellRowSpan')));
        sessionStorage.setItem("BackLink", window.location.href);
    }

    function SetSelectedRowIndex(oItem){
        var nSelectedIndex= $('#tblFabricSCReports').datagrid('getRowIndex',oItem);
        sessionStorage.setItem("SelectedRowIndex", nSelectedIndex);
    }

    $(document).keydown(function (e) { if (e.keyCode == 27) { $('div').icsWindow('close'); } });

    $("#btnPrint").click(function () {

        var sParams=sessionStorage.getItem("ParamsP");
        window.open(_sBaseAddress + '/FabricSCReport/Print_SampleOrderReport?sTempString=' + sParams, "_blank");
    });

    $("#btnPrintLD").click(function () {
        var oFabric= $('#tblFabricSCReports').datagrid('getSelected');
        if(oFabric==null || oFabric.FabricID<=0){
            alert("Please select an item from list.");
            return false;
        }
        var tsv=((new Date()).getTime())/1000;
        window.open(_sBaseAddress+ "/LabDip/PrintLabDipByFabric?nId="+oFabric.FabricSalesContractDetailID+"&nts="+tsv, "_blank");
    });

    $("#btnPrintXL").click(function ()
    {
        var sParams=sessionStorage.getItem("ParamsP");
        window.open(_sBaseAddress + '/FabricSCReport/Print_ReportRnDXL?sTempString=' + sParams+"&BUID="+_nBUID, "_blank");
    });

    $('#btnPrintHLDelivery').click(function(e){

        var oFSC = $('#tblFabricSCReports').datagrid('getSelected');

        if(oFSC==null || oFSC.FabricSalesContractDetailID<=0){
            alert("Select an item from list");
            return false;
        }
        var nts=(new Date()).getTime()/1000;
        window.open(_sBaseAddress + '/FabricSCReport/PrintHandLoomDelivery?nId=' + oFSC.FabricSalesContractDetailID+"&nBUID="+_nBUID+"&nts="+nts, "_blank");
    });

    $('#btnPrintHLSwatch').click(function(e){

        var oFSC = $('#tblFabricSCReports').datagrid('getSelected');

        if(oFSC==null || oFSC.FabricSalesContractDetailID<=0){
            alert("Select an item from list");
            return false;
        }
        var nts=(new Date()).getTime()/1000;
        window.open(_sBaseAddress + '/FabricSCReport/PrintHandLoomSwatch?nId=' + oFSC.FabricSalesContractDetailID+"&nBUID="+_nBUID+"&nts="+nts, "_blank");
    });


    $('#btnFabricPattern').click(function (e) {

        var data= $('#tblFabricSCReports').datagrid('getSelected');
        if(data==null || data.FabricID<=0){
            alert("Please select an item from list.");
            return false;
        }
        if(data.FabricReceiveBy==0){
            alert("Sorry, Without receive this fabric's pattern cannot create.");
            return false;
        }

        SetSelectedRowIndex(data);

        var rnd = parseInt((Math.random()*1000)+1);
        window.location.href = _sBaseAddress + '/Fabric/ViewFabricPatterns?menuid=' + rnd+ "&nFabricID=" + data.FabricID+"&nBUID="+_nBUID;

    });

    ////Start adv Searching

    function updateProgress() {
        var value =$('#progressbar').progressbar('getValue');
        if (value < 96){
            value += Math.floor(Math.random() * 10);
            $('#progressbar').progressbar('setValue', value);
        }
    }
    function hideShow(miliseconds) {
        $("#progressbarParent").hide();
    }
    //Account Of Picker

    $("#txtContractorAdvS").keydown(function (e) {
        if (e.keyCode === 13) // Enter Press
        {
            PickContractors_AdvS();
        }
        else if (e.keyCode === 08) {
            $("#txtContractorAdvS").removeClass("fontColorOfPickItem");
            _sContractorIds = '';
        }
    });

    $("#btnClrContractorAdvS").click(function () {
        $("#txtContractorAdvS").removeClass("fontColorOfPickItem");
        $("#txtContractorAdvS").val("");
        _sContractorIds = '';
    });

    $("#btnPickContractorAdvS").click(function () {
        PickContractors_AdvS();
    });
    function PickContractors_AdvS() {
        var oContractor = {
            Params: '2,3' + '~' + $.trim($("#txtContractorAdvS").val()+"~"+_nBUID)
        };
        var obj = {
            BaseAddress: _sBaseAddress,
            Object: oContractor,
            ControllerName: "Contractor",
            ActionName: "ContractorSearchByNameType",
            IsWinClose: false
        };

        $("#progressbar").progressbar({ value: 0 });
        $("#progressbarParent").show();
        var intervalID = setInterval(updateProgress, 250);

        DynamicRefreshList([], "tblAccountsPickerAdvSearch");
        $.icsDataGets(obj, function (response) {
            clearInterval(intervalID);
            $("#progressbarParent").hide();
            if (response.status && response.objs.length > 0) {
                if (response.objs[0].ContractorID > 0) {
                    var tblColums = []; var oColumn = { field: "ContractorID", title: "Code", width: 50, align: "left" }; tblColums.push(oColumn);
                    oColumn = { field: "Name", title: "Name", width: 280, align: "left" }; tblColums.push(oColumn);

                    var oPickerParam = {
                        winid: 'winContractorPicker',
                        winclass: 'clsAccountOf',
                        winwidth: 400,
                        winheight: 460,
                        tableid: 'tblAccountOfs',
                        tablecolumns: tblColums,
                        datalist: response.objs,
                        multiplereturn: true,
                        searchingbyfieldName: 'Name',
                        windowTittle: 'Contactor List'
                    };
                    $.icsPicker(oPickerParam);
                    IntializePickerbutton(oPickerParam);
                }
                else {
                    alert(response.objs[0].ErrorMessage);
                }
            }
            else {
                alert("Sorry, No Contactor Found.");
            }
        });
    }
    //End Account Of Picker
    $("#btnClrDeliverTo").click(function () {
        $("#txtDeliverTo").val("");
        _sBuyerIds="";
    });

    $("#btnPickDeliverTo").click(function () {

        var oContractor = {
            Params: '2,3' + '~' + $.trim($("#txtDeliverTo").val()+'~'+_nBUID)
        };
        GetDeliverTo(oContractor);
    });

    $("#txtDeliverTo").keydown(function (e) {
        var nkeyCode = e.keyCode || e.which;
        if(nkeyCode==13){
            var sContractorName=$.trim($("#txtDeliverTo").val());
            if(sContractorName=="" || sContractorName==null)
            {
                alert("Please, Type name or part of Name");
                $("#txtDeliverTo").focus();
                $("#txtDeliverTo").addClass("errorFieldBorder");
                return;
            }
            var oContractor = {
                Params: '2,3' + '~' + $.trim($("#txtDeliverTo").val()+'~'+_nBUID)
            };
            GetDeliverTo(oContractor);
        }
        else if(nkeyCode==8){
            $("#txtDeliverTo").val("");
            _sBuyerIds="";

        }
    });

    function GetDeliverTo(oContractor){


        var obj = {
            BaseAddress: _sBaseAddress,
            Object: oContractor,
            ControllerName: "Contractor",
            ActionName: "ContractorSearchByNameType",
            IsWinClose: false
        };
        $("#progressbar").progressbar({ value: 0 });
        $("#progressbarParent").show();
        var intervalID = setInterval(updateProgress, 250);
        $.icsDataGets(obj, function (response) {
            clearInterval(intervalID);
            $("#progressbarParent").hide();
            if (response.status && response.objs.length > 0)
            {
                if (response.objs[0].ContractorID > 0) {
                    debugger;
                    var tblColums = [];
                    var oColumn = { field: "ContractorID", title: "Code", width: 50, align: "center" };tblColums.push(oColumn);
                    oColumn = { field: "Name", title: "Name", width: 190, align: "left" };tblColums.push(oColumn);
                    oColumn = { field: "Phone", title: "Phone", width: 140, align: "left" };tblColums.push(oColumn);

                    var oPickerParam = {
                        winid: 'winDeliverToPicker',
                        winclass:'clsDeliverToPicker',
                        winwidth: 460,
                        winheight: 460,
                        tableid: 'tblDeliverToPicker',
                        tablecolumns: tblColums,
                        datalist: response.objs,
                        multiplereturn: true,
                        searchingbyfieldName:'Name',
                        windowTittle: 'Deliver To List'
                    };
                    $.icsPicker(oPickerParam);
                    IntializePickerbutton(oPickerParam);//multiplereturn, winclassName
                }
                else { alert(response.objs[0].ErrorMessage); }
            }
            else{
                alert("No contractor found.");
            }
        });
    }

    $("#btnResetMktPerson").click(function () {

        $("#txtMktAccount").val("");
        _sMAccountIds="";
    });

    $("#btnPickMktAccount").click(function () {
        debugger;
        var sName=$.trim($("#txtMktAccount").val());
        GetMktPersons(sName);
    });

    $("#txtMktAccount").keydown(function (e) {
        var nkeyCode = e.keyCode || e.which;
        if(nkeyCode==13){
            var sName=$.trim($("#txtMktAccount").val());
            if($('#txtMktAccount').val()==null || $('#txtMktAccount').val()=="")
            {
                alert("Please Type Name or part Name and Press Enter.");
                $('#txtMktAccount').focus();
                return;
            }
            GetMktPersons(sName);
        }
        else if(nkeyCode==8){
            $("#txtMktAccount").val("");
            _sMAccountIds="";
        }
    });
    function GetMktPersons(sName){

        var oMarketingAccount_BU = {
            Name:sName,
            BUID:sessionStorage.getItem("BUID")
        };
        var obj = {
            BaseAddress: _sBaseAddress,
            Object: oMarketingAccount_BU,
            ControllerName: "MarketingAccount",
            ActionName: "MarketingAccountSearchByNameAndGroup",
            IsWinClose: false
        };

        $.icsDataGets(obj, function (response) {

            if (response.status && response.objs.length > 0) {
                if (response.objs[0].MarketingAccountID > 0) {
                    debugger;
                    var tblColums = [];
                    var oColumn = { field: "MarketingAccountID", title: "Code", width: 50, align: "left" };tblColums.push(oColumn);
                    oColumn = { field: "Name", title: "Name", width: 180, align: "left" };tblColums.push(oColumn);
                    oColumn = { field: "GroupName", title: "GroupName", width: 120, align: "left" };tblColums.push(oColumn);
                    oColumn = { field: "Phone", title: "Phone", width: 100, align: "left" };tblColums.push(oColumn);

                    var oPickerParam = {
                        winid: 'winMktAccount',
                        winclass:'clsMktPersonPicker',
                        winwidth: 460,
                        winheight: 460,
                        tableid: 'tblMktPersonPicker',
                        tablecolumns: tblColums,
                        datalist: response.objs,
                        multiplereturn: true,
                        searchingbyfieldName:'Name',
                        windowTittle: 'MKT Person List'
                    };
                    $.icsPicker(oPickerParam);
                    IntializePickerbutton(oPickerParam);//multiplereturn, winclassName
                }
                else { alert(response.objs[0].ErrorMessage); }
            }
            else{
                alert("No marketing person found.");
            }
        });


    }
    //End Pick Mkt

    function IntializePickerbutton(oPickerobj) {
        $("#" + oPickerobj.winid).find("#btnOk").click(function () {
            SetPickerValueAssign(oPickerobj);
        });
        $(document).find('.' + oPickerobj.winclass).keydown(function (e) {
            if (e.which === 13) {
                SetPickerValueAssign(oPickerobj);
            }
        });
    }

    function SetPickerValueAssign(oPickerobj) {
        var oreturnObj = null, oreturnObjs = [];
        if (oPickerobj.multiplereturn) {
            oreturnObjs = $('#' + oPickerobj.tableid).datagrid('getChecked');
        } else {
            oreturnObj = $('#' + oPickerobj.tableid).datagrid('getSelected');
        }

        if (oPickerobj.winid == 'winContractorPicker')
        {
            if (oreturnObjs != null && oreturnObjs.length> 0)
            {

                _sContractorIds=''; var sMessage='';
                sMessage=(oreturnObjs.length>1)? oreturnObjs.length +" Contractors Selected" : oreturnObjs[0].Name;
                $('#txtContractorAdvS').val(sMessage);
                $("#txtContractorAdvS").addClass("fontColorOfPickItem");

                for(var i=0;i<oreturnObjs.length;i++){
                    _sContractorIds=_sContractorIds+oreturnObjs[i].ContractorID+',';
                }
                _sContractorIds=_sContractorIds.substring(0,_sContractorIds.length-1);

            }
            else
            {
                alert("Please select a contractor.");
                return false;
            }
        }

        else if (oPickerobj.winid == 'winDeliverToPicker')
        {
            if (oreturnObjs != null && oreturnObjs.length> 0)
            {
                var sMessage='';
                _sBuyerIds="";
                sMessage=(oreturnObjs.length>1)? oreturnObjs.length +" Buying House(s) Selected" : oreturnObjs[0].Name;
                $('#txtDeliverTo').val(sMessage);
                $("#txtDeliverTo").addClass("fontColorOfPickItem");

                for(var i=0;i<oreturnObjs.length;i++){
                    _sBuyerIds=_sBuyerIds+oreturnObjs[i].ContractorID+',';
                }
                _sBuyerIds=_sBuyerIds.substring(0,_sBuyerIds.length-1);

            }
            else
            {
                alert("Please select a Buying House.");
                return false;
            }
        }
        else if (oPickerobj.winid == 'winMktAccount')
        {
            if (oreturnObjs != null && oreturnObjs.length> 0)
            {
                var sMessage='';
                _sMAccountIds="";
                sMessage=(oreturnObjs.length>1)? oreturnObjs.length +"MKT Account(s) Selected" : oreturnObjs[0].Name;
                $('#txtMktAccount').val(sMessage);
                $("#txtMktAccount").addClass("fontColorOfPickItem");
                for(var i=0;i<oreturnObjs.length;i++){
                    _sMAccountIds=_sMAccountIds+oreturnObjs[i].MarketingAccountID+',';
                }
                _sMAccountIds=_sMAccountIds.substring(0,_sMAccountIds.length-1);
            }
            else
            {
                alert("Please select a MKt Account.");
                return false;
            }
        }

        $("#" + oPickerobj.winid).icsWindow("close");
        $("#" + oPickerobj.winid).remove();
    }


    //End Buyer Search
    $("#btnResetAdvSearch").click(function () {
        ResetAdvSearchWindow();
        LoadComboAdv();
    });


    $("#btnSearchAdvSearch").click(function ()
    {
        $(".lblLoadingMessage").show();
        var sOrderTypeIDs = "";

        var oOrderType = $("#tblOrderTypes").datagrid("getChecked");
        if (oOrderType.length > 0)
        {
            for (var i = 0;i<oOrderType.length; i++){
                sOrderTypeIDs = oOrderType[i].id + "," + sOrderTypeIDs;
            }
            sOrderTypeIDs = sOrderTypeIDs.substring(0, sOrderTypeIDs.length - 1);
        }
        var sPONo="";
        var sCurrentStatus = "";
        var oCurrentStatuss = $("#tblCurrentStatuss").datagrid("getChecked");
        if (oCurrentStatuss.length > 0)
        {
            for (var i = 0;i<oCurrentStatuss.length; i++){
                sCurrentStatus = oCurrentStatuss[i].id + "," + sCurrentStatus;
            }
            sCurrentStatus = sCurrentStatus.substring(0, sCurrentStatus.length - 1);
        }

        var sLabStatus = "";
        var oLabStatus = $("#tblLabStatuss").datagrid("getChecked");
        if (oLabStatus.length > 0)
        {
            for (var i = 0;i<oLabStatus.length; i++){
                sLabStatus = oLabStatus[i].id + "," + sLabStatus;
            }
            sLabStatus = sLabStatus.substring(0, sLabStatus.length - 1);
        }

        var sTempString = $.trim($("#txtPINo").val()) + '~'
                        + $.trim($("#txtFabricID").val()) + '~'
                        + _sContractorIds + '~'
                        + _sBuyerIds + '~'
                        + _sMAccountIds + '~'
                        + $("#cboPODate").val() + '~'
                        + $("#txtFromPODate").datebox("getValue") + '~'
                        + $("#txtToPODate").datebox("getValue") + '~'
                        + $("#cboApproveDate").val() + '~'
                        + $("#txtFromApproveDate").datebox("getValue") + '~'
                        + $("#txtToApproveDate").datebox("getValue") + '~'
                        + $("#cboProductionType").val() + '~'
                         + $("#cboIsPrinting").val() + '~'
                        + sOrderTypeIDs  + '~'
                        + sCurrentStatus  + '~'
                        + _nBUID + '~'
                        + sPONo +'~'
                        + _typeOfReceive+'~'
                        +''+'~'
                        + $('#chkReceived').is(':checked')+'~'
                        + $('#chkSubmittedHO').is(':checked')+'~'
                        + $('#chkWatingForLab').is(':checked')+'~'
                        + $('#chkYetToSubmittedHO').is(':checked')+'~'
                        + sLabStatus+'~';


        var oFabricSCReport = {
            ErrorMessage: sTempString
        }
        sessionStorage.setItem("ParamsP", sTempString);
        $.ajax({
            type: "POST",
            dataType: "json",
            url: _sBaseAddress + "/FabricSCReport/AdvanchSearch",
            traditional: true,
            data: JSON.stringify(oFabricSCReport),
            contentType: "application/json; charset=utf-8",
            success: function (data) {
                debugger;
                var result = data;

                //var result = jQuery.parseJSON(data);
                if(result.Item1.length<=0){
                    alert("No data found");
                }
                else{
                    $('#tblFabricSCReports').data('FDPs',result.Item1)
                    $('#tblFabricSCReports').data('CellRowSpan',result.Item2);
                    DynamicRefreshList(result.Item1,'tblFabricSCReports');
                    SetGridData();
                    $(".lblLoadingMessage").hide();
                    $("#winAdvSearch").icsWindow("close");
                }



            }
        });
    });
    function onLoadSuccess(data)
    {
        var oCellRowSpans=$('#tblFabricSCReports').data('CellRowSpan');
        var nIndex=0;
        var nSpan=0;
        for(var i=0;i<oCellRowSpans.length;i++){
            var oMCell=[oCellRowSpans[i].mergerCell];
            nIndex=oMCell[0][0];
            nSpan= oMCell[0][1];
            if(oCellRowSpans[i].FieldName=="Span"){
                $(this).datagrid('mergeCells',{index: nIndex, field: 'SCNoFull', rowspan: nSpan});
                $(this).datagrid('mergeCells',{index: nIndex, field: 'SCDateSt', rowspan: nSpan});
                $(this).datagrid('mergeCells',{index: nIndex, field: 'ContractorName', rowspan: nSpan});
                $(this).datagrid('mergeCells',{index: nIndex, field: 'BuyerName', rowspan: nSpan});
                $(this).datagrid('mergeCells',{index: nIndex, field: 'MKTGroup', rowspan: nSpan});
                $(this).datagrid('mergeCells',{index: nIndex, field: 'MKTPName', rowspan: nSpan});
                $(this).datagrid('mergeCells',{index: nIndex, field: 'OrderTypeSt', rowspan: nSpan});
                $(this).datagrid('mergeCells',{index: nIndex, field: 'OrderTypeSt', rowspan: nSpan});
                $(this).datagrid('mergeCells',{index: nIndex, field: 'ApproveByName', rowspan: nSpan});
                $(this).datagrid('mergeCells',{index: nIndex, field: 'ApprovedDateSt', rowspan: nSpan});
                $(this).datagrid('mergeCells',{index: nIndex, field: 'CurrentStatusSt', rowspan: nSpan});


            }
        }
    }
    ////Start adv Searching
    /// Search By No and Date
    $('#txtSearchbyPONo').keypress(function (e) {

        var code = (e.keyCode ? e.keyCode : e.which);
        if (code == 13)//Enter key-13
        {
            if ($.trim($("#txtSearchbyPONo").val()) == "")
            {
                alert("Please give PO No.");
                return false;
            }
            var sPONo=$.trim($("#txtSearchbyPONo").val());
            var sOrderTypeIDs = "";
            var sCurrentStatus = "";
            _sContractorIds="";
            debugger;
            var sTempString = "" + '~'
                            + "" + '~'//$.trim($("#txtFabricID").val()) + '~'
                            + _sContractorIds + '~'
                            + _sBuyerIds + '~'
                            + _sMAccountIds + '~'
                            + 0 + '~'
                            + icsdateformat(new Date())+ '~'
                            + icsdateformat(new Date())+ '~'
                            + 0+ '~'
                            + icsdateformat(new Date()) + '~'
                            + icsdateformat(new Date())+ '~'
                            + 0 + '~'
                            + 0 + '~'
                            + sOrderTypeIDs  + '~'
                            + sCurrentStatus  + '~'
                            + _nBUID  + '~'
                            + sPONo+'~'
                            + _typeOfReceive +'~'
                            + "";




            var oFabricSCReport = {
                SCNoFull:$.trim($("#txtSearchbyPONo").val()),
                ErrorMessage: sTempString
            }
            sessionStorage.setItem("ParamsP", sTempString);
            $.ajax({
                type: "POST",
                dataType: "json",
                url: _sBaseAddress + "/FabricSCReport/AdvanchSearch",
                traditional: true,
                data: JSON.stringify(oFabricSCReport),
                contentType: "application/json; charset=utf-8",
                success: function (data)
                {
                    var result = data;
                    //var result = jQuery.parseJSON(data);
                    if(result.Item1.length<=0){
                        alert("No data found");
                    }
                    else{
                        $('#tblFabricSCReports').data('FDPs',result.Item1)
                        $('#tblFabricSCReports').data('CellRowSpan',result.Item2);
                        DynamicRefreshList(result.Item1,'tblFabricSCReports');
                        SetGridData();
                        $(".lblLoadingMessage").hide();

                    }



                }
            });
        }
    });
    $('#txtSearchbyFabricNo').keypress(function (e) {

        var code = (e.keyCode ? e.keyCode : e.which);
        if (code == 13)//Enter key-13
        {
            if ($.trim($("#txtSearchbyFabricNo").val()) == "")
            {
                alert("Please give Ref No.");
                return false;
            }
            var sOrderTypeIDs = "";
            var sCurrentStatus = "";
            _sContractorIds="";
            var sPONo="";
            debugger;
            var sTempString = "" + '~'
                            + $.trim($("#txtSearchbyFabricNo").val()) + '~'
                            + _sContractorIds + '~'
                            + _sBuyerIds + '~'
                            + _sMAccountIds + '~'
                            + 0 + '~'
                            + icsdateformat(new Date())+ '~'
                            + icsdateformat(new Date())+ '~'
                            + 0+ '~'
                            + icsdateformat(new Date()) + '~'
                            + icsdateformat(new Date())+ '~'
                            + 0 + '~'
                              + 0 + '~'  
                            + sOrderTypeIDs  + '~'
                            + sCurrentStatus  + '~'
                            + _nBUID  + '~'
                            + sPONo+'~'
                            + _typeOfReceive +'~'
                            + "";




            var oFabricSCReport = {
                SCNoFull:"",
                ErrorMessage: sTempString
            }
            sessionStorage.setItem("ParamsP", sTempString);
            $.ajax({
                type: "POST",
                dataType: "json",
                url: _sBaseAddress + "/FabricSCReport/AdvanchSearch",
                traditional: true,
                data: JSON.stringify(oFabricSCReport),
                contentType: "application/json; charset=utf-8",
                success: function (data)
                {
                    var result = data;
                    if(result.Item1.length<=0){
                        alert("No data found");
                    }
                    else{
                        $('#tblFabricSCReports').data('FDPs',result.Item1)
                        $('#tblFabricSCReports').data('CellRowSpan',result.Item2);
                        DynamicRefreshList(result.Item1,'tblFabricSCReports');
                        SetGridData();
                        $(".lblLoadingMessage").hide();

                    }


                }
            });
        }
    });
    $('#txtHLNO').keypress(function (e) {

        var code = (e.keyCode ? e.keyCode : e.which);
        if (code == 13)//Enter key-13
        {
            if ($.trim($("#txtHLNO").val()) == "")
            {
                alert("Please give HL No.");
                return false;
            }
            var sOrderTypeIDs = "";
            var sCurrentStatus = "";
            _sContractorIds="";
            var sPONo="";
            debugger;
            var sTempString = "" + '~'
                            + "" + '~'
                            + _sContractorIds + '~'
                            + _sBuyerIds + '~'
                            + _sMAccountIds + '~'
                            + 0 + '~'
                            + icsdateformat(new Date())+ '~'
                            + icsdateformat(new Date())+ '~'
                            + 0+ '~'
                            + icsdateformat(new Date()) + '~'
                            + icsdateformat(new Date())+ '~'
                            + 0 + '~'
                              + 0 + '~'
                            + sOrderTypeIDs  + '~'
                            + sCurrentStatus  + '~'
                            + _nBUID  + '~'
                            + sPONo+'~'
                            + _typeOfReceive +'~'
                            + $.trim($("#txtHLNO").val());

            console.log(sTempString.split('~'))
            var oFabricSCReport = {
                SCNoFull:"",
                ErrorMessage: sTempString
            }
            sessionStorage.setItem("ParamsP", sTempString);
            $.ajax({
                type: "POST",
                dataType: "json",
                url: _sBaseAddress + "/FabricSCReport/AdvanchSearch",
                traditional: true,
                data: JSON.stringify(oFabricSCReport),
                contentType: "application/json; charset=utf-8",
                success: function (data)
                {
                    var result = data;
                    if(result.Item1.length<=0){
                        alert("No data found");
                    }
                    else{
                        $('#tblFabricSCReports').data('FDPs',result.Item1)
                        $('#tblFabricSCReports').data('CellRowSpan',result.Item2);
                        DynamicRefreshList(result.Item1,'tblFabricSCReports');
                        $(".lblLoadingMessage").hide();

                    }


                }
            });
        }
    });




    function LoadComboAdv()
    {
        DynamicRefreshList(_oOrderTypes, "tblOrderTypes");
        DynamicRefreshList(_oLabdipStatus, "tblLabStatuss");
        DynamicRefreshList(_oFabricPOStatus, "tblCurrentStatuss");
        $("#cboPODate,#cboApproveDate").icsLoadCombo({
            List: _oCompareOperators,
            OptionValue: "id",
            DisplayText: "Value"
        });
    }
    function CheckFromAndToDateValidation(OperationComboId, FromDateId, ToDateId) {
        $("#" + OperationComboId).parent().parent().parent().find("select").removeClass("errorFieldBorder");
        var nCboVal = $("#" + OperationComboId).val();
        if (parseInt(nCboVal) == 5 || parseInt(nCboVal) == 6) {
            var fromDate = $("#" + FromDateId).datebox("getValue");
            var toDate = $("#" + ToDateId).datebox("getValue");
            if (new Date(fromDate) > new Date(toDate)) {
                $("#" + ToDateId).focus();
                $("#" + OperationComboId).addClass("errorFieldBorder");
                $(".lblLoadingMessage").hide();
                return false;
            } else {
                $("#" + OperationComboId).removeClass("errorFieldBorder");
                return true;
            }
        } else {
            return true;
        }
    }

    function ResetAdvSearchWindow() {
        _sContractorIds = '';
        _sBankBranch_IssueIds = "";
        $(".lblLoadingMessage").hide();
        $("#winAdvSearch input").not("input[type='button']").val("");
        $("#winAdvSearch input").removeClass("fontColorOfPickItem");
        $("#winAdvSearch select").val(0);
        DateActions_OPDate();
        DateActions_ApproveDate();
        $("#txtFromPODate,#txtToPODate").datebox({ disabled: true });
        $("#txtFromPODate,#txtToPODate").datebox("setValue", icsdateformat(new Date()));

        $("#txtFromApproveDate,#txtToApproveDate").datebox({ disabled: true });
        $("#txtFromApproveDate,#txtToApproveDate").datebox("setValue", icsdateformat(new Date()));

        $('#chkReceived,#chkSubmittedHO,#chkWatingForLab').prop('checked',false);
    }

    function DateActions_OPDate() {
        DynamicDateActions("cboPODate", "txtFromPODate", "txtToPODate");
    }
    function DateActions_ApproveDate() {
        DynamicDateActions("cboApproveDate", "txtFromApproveDate", "txtToApproveDate");
    }


    $("#btnCloseAdvSearch").click(function () {
        $("#winAdvSearch").icsWindow("close");
    });
    $("#btnAdvSearch").click(function () {
        debugger;
        $(".lblLoadingMessage").hide();
        $("#winAdvSearch").icsWindow("open", "Production Request Advance Search");
        //DynamicRefreshList([], "tblExportPIAdvSearch");
        DynamicResetAdvSearchWindow("winAdvSearch");
        ResetAdvSearchWindow();
        LoadComboAdv();
    });

    /// end Adv Searching

    /// Update H/L No
    $("#btnExeNoEntry").click(function () {
        editIndex = undefined;
        var oFSC = $('#tblFabricSCReports').datagrid('getSelected');
        var nSelectedIndex= $('#tblFabricSCReports').datagrid('getRowIndex',oFSC);
        $('#tblFabricSCReports').data('Index', nSelectedIndex);
        if (oFSC ==null || oFSC.FabricSalesContractID<=0) { alert("Please select an item from list."); return ; }

        //alert(data.CurrentStatus);
        if(oFSC.CurrentStatus!=3 && oFSC.CurrentStatus!=4)
        {
            alert("Yet Not Approve.");
            return false;
        }

        $('#txtSCNo_ExC').val(oFSC.SCNoFull);
        $('#txtContractor_EXC').val(oFSC.ContractorName);
        $('#txtOrderType').val(oFSC.OrderTypeSt);

        $.ajax({
            type: "POST",
            url: _sBaseAddress + "/FabricSalesContract/GetsDetailByFSC",
            traditional: true,
            data: JSON.stringify(oFSC),
            contentType: "application/json; charset=utf-8",
            success: function (data) {
                debugger;
                var oFSCDetails = jQuery.parseJSON(data);
                if(oFSCDetails!=null )
                {
                    DynamicRefreshList(oFSCDetails, "tblFSCDetails");
                }
                else{
                    DynamicRefreshList([], "tblFSCDetails");
                }
                RefreshTotalSummery();
                $("#winExeEntry").icsWindow("open", "Receive & Issue No");

            }
        });

    });

    function RefreshTotalSummery() {
        var nTotalQty = 0;
        var nTotalValue = 0;
        var sCurrency = "";
        sCurrency = "";
        var oFSCDetails = $('#tblFSCDetails').datagrid('getRows');
        for (var i = 0; i < oFSCDetails.length; i++) {
            nTotalQty = nTotalQty + parseFloat(oFSCDetails[i].Qty);
        }
        document.getElementById("lblTotalQty").innerHTML = formatPrice(nTotalQty)+' Y';
    }

    $('#btnSaveExeNo').click(function (e) {
        debugger;

        endEditing();
        var oFSC = $('#tblFabricSCReports').datagrid('getSelected');
        var nSelectedIndex= $('#tblFabricSCReports').datagrid('getRowIndex',oFSC);
        if (oFSC ==null || oFSC.FabricSalesContractID<=0) { alert("Please select an item from list 1."); return ; }
      
        var oFSCDetails = $('#tblFSCDetails').datagrid('getRows');

        if(oFSCDetails==null || oFSCDetails.length<=0)
        {
            alert("Please select a item from list==!");
            return;
        }
        oFSC.FabricSalesContractDetails=oFSCDetails;


        $.ajax({
            type: "POST",
            dataType: "json",
            url: _sBaseAddress + "/FabricSalesContract/SetFabricExcNo",
            traditional: true,
            data: JSON.stringify(oFSC),
            contentType: "application/json; charset=utf-8",
            success: function (data) {
             oFSCDetails = jQuery.parseJSON(data);
             if (oFSCDetails[0].ErrorMessage==null || oFSCDetails[0].ErrorMessage=="") 
             {
                 var oRows=$("#tblFabricSCReports").datagrid('getRows');
                 debugger;
                 for(var i=0;i<oRows.length;i++)
                 {
                     if(oRows[i].FabricSalesContractID==oFSC.FabricSalesContractID)
                     {
                         for(var j=0;j<oFSCDetails.length;j++)
                         {
                             if(oFSCDetails[j].FabricSalesContractDetailID == oRows[i].FabricSalesContractDetailID)
                             {
                                 var nRowIndexBank = $("#tblFabricSCReports").datagrid("getRowIndex",  oRows[i]);
                                 oRows[i].ExeNo = oFSCDetails[j].ExeNo;
                                 oRows[i].OptionNo = oFSCDetails[j].OptionNo;
                                 oRows[i].CurrentStatusSt = "Received";
                                 $('#tblFabricSCReports').datagrid('updateRow', { index: nRowIndexBank, row: oRows[i] });
                                 $('#tblFabricSCReports').datagrid('selectRow',nRowIndexBank);
                             }
                         }
                     }
                 }
                 $("#winExeEntry").icsWindow("close");
             }
             else
             {
             }
                //if (oFabrics[0].ErrorMessage == '' || oFabrics[0].ErrorMessage == null) {
                //    for (i = 0; i < oFabrics.length; ++i) {
                //        //oFabrics[i].IsOparate=-1;
                //        $('#tblFabrics').datagrid('updateRow', { index: indexLists[i], row: oFabrics[i] });
                //        $('#tblFabrics').datagrid('selectRow', indexLists[i]);
                //    }
                //    alert("Received  Successfully");

                //}
                //else {
                //    alert(oFabrics[0].ErrorMessage);
                //}
            },
            error: function (xhr, status, error) {
                alert(xhr + '~' + status + '~' + error);
            }
        });
    });
    //$("#btnSaveExeNo").click(function (e) {
    //    var oFSCDetails = $('#tblFSCDetails').datagrid('getRows');

    //    if(oFSCDetails==null || oFSCDetails.length<=0)
    //    {
    //        alert("Please select a item from list==!");
    //        return;
    //    }
    //    endEditing();
    //    var oFSC = $('#tblFabricSCReports').datagrid('getSelected');
    //    var nSelectedIndex= $('#tblFabricSCReports').datagrid('getRowIndex',oFSC);
    //    if (oFSC ==null || oFSC.FabricSalesContractID<=0) { alert("Please select an item from list 1."); return ; }
    //    oFSC.FabricSalesContractDetails=oFSCDetails;
    //    var status=oFSC.CurrentStatusSt;

    //    var obj =
    //        {
    //            BaseAddress: _sBaseAddress,
    //            Object: oFSC,
    //            ObjectId: oFSC.FabricSalesContractID,
    //            ControllerName: "FabricSalesContract",
    //            ActionName: "SetFabricExcNo",
    //            TableId: "tblFabricSCReports",
    //            IsWinClose: true,
    //            Message:''
    //        };
    //    $.icsSave(obj, function (response) {
    //        if (response.status) {

    //            if(response.obj.FabricSalesContractID>0){

    //                alert(((_typeOfReceive==2)?"Set H/L no successfully":"Save Dispo no successfully."));

    //                //var oRows=$("#tblFabricSCReports").datagrid('getRows');
    //                //debugger;
    //                //for(var i=0;i<oRows.length;i++)
    //                //{
    //                //    if(oRows[i].FabricSalesContractID==oFSC.FabricSalesContractID)
    //                //    {
    //                //        for(var j=0;j<response.obj.FabricSalesContractDetails.length;j++)
    //                //        {
    //                //            if(response.obj.FabricSalesContractDetails[j].FabricSalesContractDetailID == oRows[i].FabricSalesContractDetailID)
    //                //            {
    //                //                oRows[i].ExeNo = response.obj.FabricSalesContractDetails[j].ExeNo;
    //                //                oRows[i].OptionNo = response.obj.FabricSalesContractDetails[j].OptionNo;
    //                //                oRows[i].CurrentStatusSt = status;
    //                //            }
    //                //        }
    //                //    }
    //                //}
    //                //$('#tblFabricSCReports').data('FDPs',oRows)
    //                //DynamicRefreshList(oRows,'tblFabricSCReports');
    //                //$("#tblFabricSCReports").datagrid("selectRow", parseInt($('#tblFabricSCReports').data('Index')));
    //            }


    //           // OperationPerformsExportLC(nRowIndex, response.obj);
    //        }
    //    });
    //});
    $("#btnCloseExeNo").click(function () {
        $("#winExeEntry").icsWindow("close");
    });
    ///

    var editIndex = undefined;
    function endEditing() {

        if (editIndex == undefined) {
            return true;
        }
        debugger;
        if ($('#tblFSCDetails').datagrid('validateRow', editIndex)) {
            $('#tblFSCDetails').datagrid('endEdit', editIndex);
            $('#tblFSCDetails').datagrid('selectRow', editIndex);
            var sCurrency = "";
            var oPIDetail = $('#tblFSCDetails').datagrid('getSelected');

            if (oPIDetail == null) {
                return;
            }
            $('#tblFSCDetails').datagrid('updateRow', { index: editIndex, row: oPIDetail });
            // RefreshTotalSummery();


            editIndex = undefined;
            return true;
        }
        else {
            return false;
        }
    }


    function onClickRow(index) {

        if (editIndex != index) {
            if (endEditing()) {
                $('#tblFSCDetails').datagrid('selectRow', index).datagrid('beginEdit', index);
                var oExportPIDetail = $('#tblFSCDetails').datagrid('getSelected');
                editIndex = index;
            }
            else {
                $('#tblFSCDetails').datagrid('selectRow', editIndex);
            }
        }
    }


    /*---------------- Receive Fabric---------*/

    $('#btnReceive').click(function(e){

        var data= $('#tblFabricSCReports').datagrid('getSelected');

        if(data==null || data.FabricSalesContractID<=0){
            alert("Please select an item from list.");
            return false;
        }
        if(data.FabricReceiveBy!=0){
            alert("Already Received.");
            return false;
        }
        //alert(data.CurrentStatus);
        if(data.CurrentStatus!=3 && data.CurrentStatus!=4)
        {
            alert("Yet Not Approve.");
            return false;
        }
        

        $('#winFabricReceive').data('FSCD',data);
        $('#lblPONO').text(data.SCNoFull);
        $('#dtFSCReceiveDate').datebox('setValue',icsdateformat(new Date()));
        $('#winFabricReceive').icsWindow('open');
    });

    $('#btnRecFabricSalesContact').click(function(e){


        var dtReceive =  $('#dtFSCReceiveDate').datebox('getValue');

        if(new Date(dtReceive) == 'Invalid Date'){
            alert('Valid date required.');
            return false;
        }

        else if (new Date(dtReceive) < new Date (icsdateformat(new Date()))){
            alert('Receive date must be later than or equal to current date.');
            return false;
        }


        var oFSCD = $('#winFabricReceive').data('FSCD');

        var obj={
            Params: oFSCD.FabricSalesContractID+'~'+dtReceive
        }


        $.ajax({
            type: "POST",
            url: _sBaseAddress + "/FabricSCReport/ReceiveFabricSC",
            traditional: true,
            data: JSON.stringify(obj),
            contentType: "application/json; charset=utf-8",
            success: function (data) {
                debugger;
                var oFSC = jQuery.parseJSON(data);
                if(oFSC.FabricSalesContractID>0)
                {

                    var nRowIndexBank = $("#tblFabricSCReports").datagrid("getRowIndex", oFSCD);
                    var oRows=$("#tblFabricSCReports").datagrid('getRows');

                    for(var i=0;i<oRows.length;i++){
                        if(oRows[i].FabricSalesContractID==oFSC.FabricSalesContractID){
                            oRows[i].FabricReceiveDate = oFSC.FabricReceiveDate;
                            oRows[i].FabricReceiveDate = oFSC.FabricReceiveDate;
                            oRows[i].FabricReceiveBy = oFSC.FabricReceiveBy;
                            oRows[i].CurrentStatusSt = 'Received';
                        }
                    }
                    $('#tblFabricSCReports').data('FDPs',oRows)
                    DynamicRefreshList(oRows,'tblFabricSCReports');
                    alert("Receive Successfully.");

                    $("#tblFabricSCReports").datagrid("selectRow", nRowIndexBank);
                }
                else{
                    alert(oFSC.ErrorMessage);
                }
                $('#winFabricReceive').icsWindow('close');
            }
        });

    });

    $('#btnCloseFabricSalesContact').click(function(e){
        $('#winFabricReceive').icsWindow('close');
    });



    /*---------------- Edit Fabric---------*/
    $("#btnEditFabric").click(function () {


        var oFabric= $('#tblFabricSCReports').datagrid('getSelected');

        if(oFabric==null || oFabric.FabricID<=0){
            alert("Please select an item from list.");
            return false;
        }

        //alert(data.CurrentStatus);
        if(oFabric.CurrentStatus!=3 && oFabric.CurrentStatus!=4)
        {
            alert("Yet Not Approve.");
            return false;
        }

        if(oFabric.FabricReceiveBy==0){
            alert("Yet not receive, Receive first.");
            return false;
        }


        $("#winFabric").icsWindow('open', "Edit Fabric");
        $("#btnSaveFabric").data('FabricSC',true);
        _oFabric = oFabric;
        RefreshFabricLayout("btnEditFabric");
        if(_typeOfReceive==1 || _typeOfReceive==3)
            $('#txtHLNo').prop('disabled', true);
        GetFabricInformation(oFabric);

        UnselectAllRowsOfATable();

        $("#btnSaveFabric").show();
        $("#txtFabricNoFabric").prop("disabled", false);
        $("#btnReFabricSubmissionSave").hide();
        $("#cboMktPersonsFabric").focus();
        $("#lblGiveInfo, #txtCopyNo").hide();

        $('#btnContractor, #btnResetContractor').hide();
        if(parseInt(_typeOfReceive)==1){
            $('#cboMktPersonsFabric,#txtContractorName').prop('disabled',true);
        }
        else{
            $('#cboMktPersonsFabric,#txtContractorName,#cboProductFabric').prop('disabled',true);
        }
    });

    $("#btnSubmitFabricInFabricPattern").click(function () {
        var data = $("#tblFabricSCReports").datagrid("getSelected");
        if (data == null || data.FabricID <= 0) { alert("Please select an item from list!"); return; }
        if (data.SubmissionDateSt != "-") {
            alert("Already Submited.");
            return false;
        }
        if (data.FabricReceiveBy == 0) {
            alert("Sorry, Only Received fabric can Submit.");
            return false;
        }

        $("#winFabric").icsWindow('open', "Fabric Request");
        $("#winFabric").data('FSCD', data);
       
        var obj =
         {
             BaseAddress: _sBaseAddress,
             Object: data,
             ControllerName: "Fabric",
             ActionName: "GetForSubmitDate",
             IsWinClose: false
         };

        $.icsDataGet(obj, function (response) {
            if (response.status && response.obj != null) {
                if (response.obj.FabricID > 0) {
                    RefreshFabricLayout("btnSubmitFabricInFabricPattern");
                    RefreshFabricControl(response.obj);
                }
                else {
                    alert(response.obj.ErrorMessage);
                }
            }
            else { alert("No information found."); }
        });
    });

    $("#btnSubmitFabricInFabric").click(function () {
        if (!ValidateInputFabric()) return;

        var dIssueDate = $('#txtDateFabric').datebox('getValue');
        var dSubDate = $('#txtSubDateFabric').datebox('getValue');

        if (new Date(dSubDate) < new Date(dIssueDate)) {
            alert("Submission Date must greater than Issue Date.");
            return false;
        }

        var obj = {
            FabricID: RefreshObjectFabric().FabricID,
            SubmissionDate: $('#txtSubDateFabric').datebox('getValue')
        };
        
       

        $.ajax({
            type: "POST",
            url: _sBaseAddress + "/Fabric/SaveSubmissionDate",
            traditional: true,
            data: JSON.stringify(obj),
            contentType: "application/json; charset=utf-8",
            success: function (data) {
                debugger;
                var oFabric = jQuery.parseJSON(data);
                if(oFabric.FabricID>0)
                {
                    var oFSCD =  $("#winFabric").data('FSCD');
                    var nRowIndexBank = $("#tblFabricSCReports").datagrid("getRowIndex", oFSCD);
                    var oRows=$("#tblFabricSCReports").datagrid('getRows');

                    oRows[nRowIndexBank].SubmissionDate = oFabric.SubmissionDate;
                    oRows[nRowIndexBank].SubmissionDateSt = oFabric.SubmissionDateSt;

                    $('#tblFabricSCReports').data('FDPs',oRows)
                    DynamicRefreshList(oRows,'tblFabricSCReports');
                    alert("Submission Successfully.");

                    $("#tblFabricSCReports").datagrid("selectRow", nRowIndexBank);
                }
                else{
                    alert(oFabric.ErrorMessage);
                }
                $('#winFabric').icsWindow('close');
            }
        });
    });

  

     //Sales Contract Specification

    $('#btnSpecification').click(function(e){

        var row = $('#tblFabricSCReports').datagrid('getSelected');

        if(row==null || row.FabricSalesContractDetailID<=0){
            alert("Select an item from list");
            return false;
        }
        var nRowIndexBank = $("#tblFabricSCReports").datagrid("getRowIndex", row);
        sessionStorage.setItem("SelectedRowIndex", nRowIndexBank);
        sessionStorage.setItem("BackLink", window.location.href);
        var nts=((new Date()).getTime())/1000;
        window.location.href = _sBaseAddress+"/FabricExecutionOrderSpecification/ViewSpecification?nFSCDID="+ row.FabricSalesContractDetailID+"&nts="+nts;
        //window.open(_sBaseAddress+ "/FabricExecutionOrderSpecification/ViewSpecification?nFSCDID="+ row.FabricSalesContractDetailID+"&nts="+nts, "_blank");
    });

     //Fabric History

    $('#btnFabricHistory,#btnShowHistory').click(function(e){

        var row = $('#tblFabricSCReports').datagrid('getSelected');

        if(row==null || row.FabricSalesContractDetailID<=0){
            alert("Select an item from list");
            return false;
        }

        $.ajax({
            type: "POST",
            url: _sBaseAddress + "/Fabric/GetsFabricHistory",
            traditional: true,
            data: JSON.stringify({FabricID:row.FabricID}),
            contentType: "application/json; charset=utf-8",
            success: function (data) {
                debugger;
                var results = jQuery.parseJSON(data);
                if(results!=null  && results.any())
                {
                    $("#winFabricHistory").icsWindow("open");
                    DynamicRefreshList(results,'tblFabricHistory');
                }
                else{
                    alert("No history found.");
                }
            }
        });

        
        
    });
 
    $('#btnCloseFabricHistory').click(function(e){
        $('#winFabricHistory').icsWindow('close');
    });
    
        /// LabdipOperation
    $("#btnRequestForLabdip").click(function () {
        debugger;
        var oFSC = $('#tblFabricSCReports').datagrid('getSelected');
        var nSelectedIndex= $('#tblFabricSCReports').datagrid('getRowIndex',oFSC);
        $('#tblFabricSCReports').data('Index', nSelectedIndex);
        if (oFSC ==null || oFSC.FabricSalesContractDetailID<=0) { alert("Please select an item from list."); return ; }
        $('#txtDispoNo').val(oFSC.ExeNo);
        $('#txtSCNo_Lab').val(oFSC.SCNoFull);
        $('#txtFabricNo_Lab').val(oFSC.FabricNo);
        $('#txtComposition').val(oFSC.ProductName);
        $('#txtConstruction').val(oFSC.Construction);
        $('#txtFabrictype').val(oFSC.FinishTypeName);

        $.ajax({
            type: "POST",
            url: _sBaseAddress + "/LabDip/GetLDByFabric",
            traditional: true,
            data: JSON.stringify(oFSC),
            contentType: "application/json; charset=utf-8",
            success: function (data) {
                debugger;
                var oLabDip = jQuery.parseJSON(data);
                if(oLabDip!=null )
                {
                    LoadLabdip(oLabDip);
                    $('#winLabDip').data('LabDip', oLabDip);
                  
                }
                $("#winLabDip").icsWindow("open", "Labdip Request");

            }
        });

    });
    $("#btnSaveLabDip").click(function (e) {
       
        var oFSCD = $('#tblFabricSCReports').datagrid('getSelected');
        var nSelectedIndex= $('#tblFabricSCReports').datagrid('getRowIndex',oFSCD);
        $('#tblFabricSCReports').data('Index', nSelectedIndex);
        if (oFSCD ==null || oFSCD.FabricSalesContractDetailID<=0) { alert("Please select an item from list."); return ; }
        var obj =
            {
                BaseAddress: _sBaseAddress,
                Object: oFSCD,
                ObjectId: oFSCD.FabricSalesContractDetailID,
                ControllerName: "LabDip",
                ActionName: "SaveByFabric",
                TableId: "",
                IsWinClose: false,
                Message:''
            };
        $.icsSave(obj, function (response) {
            if (response.status) {
                debugger;
                if(response.obj.LabDipID>0){
                    LoadLabdip(response.obj);
                    alert("LabDip Request done successfully.");
                }
                //OperationPerformsExportLC(nRowIndex, response.obj);
            }
        });
    });
    $("#btnSaveLabRecd").click(function () {
        ChangeOrderState(7,"Receive From Lab");
    });

    $("#btnSaveLabdipSubmit").click(function () {
        ChangeOrderState(8,"Submit To HO ");
    });

    function ChangeOrderState(sStatus,sMessage)
    {
        var oLabDip = $('#winLabDip').data('LabDip');
        if (oLabDip ==null || oLabDip.LabDipID <=0 ) { alert("Please select an item from list."); return ; }

        if(!confirm("Confirm to "+sMessage)) return false;
        oLabDip.Params=sStatus;

        var obj = {
            BaseAddress: _sBaseAddress,
            Object: oLabDip,
            ObjectId: oLabDip.LabDipID,
            ControllerName: "LabDip",
            ActionName: "ChangeStatusFromFabric",
            TableId: "",
            IsWinClose: false,
            Message: sMessage.charAt(0).toUpperCase()+sMessage.slice(1) +" Successfully."
        };
        $.icsSave(obj, function (response) {
            if (response.status && response.obj != null) {
                if (response.obj.LabDipID > 0) {
                    LoadLabdip(response.obj);
                }
            }
        });
    }
    function LoadLabdip(oLabdip)
    {
        debugger;
     
        $('#trLabdipReceive,#trLabdipSubmit').hide();
        if(oLabdip.OrderStatus>1)
        {
             $('#trLabdipRequest').hide();
        }
        if(oLabdip.OrderStatus>=5&&oLabdip.OrderStatus<7)
        {
            $('#trLabdipReceive').show();
        }
        if(oLabdip.OrderStatus>=7&&oLabdip.OrderStatus<=8)
        {
            $('#trLabdipSubmit').show();
            
        }
        $('#txtLabDipOrderNo').val(oLabdip.LabdipNo);
        $('#txtLabdipStatus').val(oLabdip.OrderStatusStr);
        DynamicRefreshList(oLabdip.LabdipHistorys,'tblLabdipHistory');
    }

    $("#btnCloseLabDip").click(function () {
        $("#winLabDip").icsWindow("close");
    });
        ///End Labdip Operation

    ///// Entry Dyeing Order
    //$("#btnDyeingOrder").click(function () {
    
    //    var oFSC = $('#tblFabricSCReports').datagrid('getSelected');
    //    var nSelectedIndex= $('#tblFabricSCReports').datagrid('getRowIndex',oFSC);
    //    $('#tblFabricSCReports').data('Index', nSelectedIndex);
    //    if (oFSC ==null || oFSC.FabricSalesContractID<=0) { alert("Please select an item from list."); return ; }
    //    //$('#txtSCNo_ExC').val(oFSC.SCNoFull);
    //    //$('#txtContractor_EXC').val(oFSC.ContractorName);
    //    //$('#txtOrderType').val(oFSC.OrderTypeSt);

    //    $.ajax({
    //        type: "POST",
    //        url: _sBaseAddress + "/FabricSalesContract/GetsDetailByFSC",
    //        traditional: true,
    //        data: JSON.stringify(oFSC),
    //        contentType: "application/json; charset=utf-8",
    //        success: function (data) {
    //            debugger;
    //            var oFSCDetails = jQuery.parseJSON(data);
    //            if(oFSCDetails!=null )
    //            {
    //                DynamicRefreshList(oFSCDetails, "tblDyeingOrders");
    //            }
    //            else{
    //                DynamicRefreshList([], "tblDyeingOrders");
    //            }
    //            RefreshTotalSummery();
    //            $("#winDyeingOrder").icsWindow("open", "Dyeing Order Entry");

    //        }
    //    });

    //});

    //$("#btnSaveExeNo").click(function (e) {
    //    var oFSCDetails = $('#tblDyeingOrders').datagrid('getRows');

    //    if(oFSCDetails==null || oFSCDetails.length<=0)
    //    {
    //        alert("Please select a item from list!");
    //        return;
    //    }
    //    endEditing();
    //    var oFSC = $('#tblFabricSCReports').datagrid('getSelected');
    //    var nSelectedIndex= $('#tblFabricSCReports').datagrid('getRowIndex',oFSC);
    //    if (oFSC ==null || oFSC.FabricSalesContractID<=0) { alert("Please select an item from list."); return ; }
    //    oFSC.FabricSalesContractDetails=oFSCDetails;
    //    var status=oFSC.CurrentStatusSt;

    //    var obj =
    //        {
    //            BaseAddress: _sBaseAddress,
    //            Object: oFSC,
    //            ObjectId: oFSC.FabricSalesContractID,
    //            ControllerName: "FabricSalesContract",
    //            ActionName: (_typeOfReceive==2) ? "SetHandLoomNo" : "Save_UpdateDispoNo",
    //            TableId: "tblFabricSCReports",
    //            IsWinClose: true,
    //            Message:''
    //        };
    //    $.icsSave(obj, function (response) {
    //        if (response.status) {

    //            if(response.obj.FabricSalesContractID>0){

    //                alert(((_typeOfReceive==2)?"Set H/L no successfully":"Save Dispo no successfully."));

    //                var oRows=$("#tblFabricSCReports").datagrid('getRows');
    //                debugger;
    //                for(var i=0;i<oRows.length;i++){

    //                    if(oRows[i].FabricSalesContractID==oFSC.FabricSalesContractID){
    //                        console.log(oRows[i].CurrentStatusSt);
    //                        for(var j=0;j<response.obj.FabricSalesContractDetails.length;j++){
    //                            if(response.obj.FabricSalesContractDetails[j].FabricSalesContractDetailID == oRows[i].FabricSalesContractDetailID){
    //                                oRows[i].ExeNo = response.obj.FabricSalesContractDetails[j].ExeNo;
    //                                oRows[i].OptionNo = response.obj.FabricSalesContractDetails[j].OptionNo;
    //                                oRows[i].CurrentStatusSt = status;
    //                            }
    //                        }
    //                    }
    //                }
    //                $('#tblFabricSCReports').data('FDPs',oRows)
    //                DynamicRefreshList(oRows,'tblFabricSCReports');
    //                $("#tblFabricSCReports").datagrid("selectRow", parseInt($('#tblFabricSCReports').data('Index')));
    //            }


    //            //OperationPerformsExportLC(nRowIndex, response.obj);
    //        }
    //    });
    //});
    $("#btnCloseDO").click(function () {
        $("#winDyeingOrder").icsWindow("close");
    });
        ///

    $("#btnDyeingOrder").click(function(){
        debugger;
        var oFSC = $('#tblFabricSCReports').datagrid('getSelected');
        var nSelectedIndex= $('#tblFabricSCReports').datagrid('getRowIndex',oFSC);
        $('#tblFabricSCReports').data('Index', nSelectedIndex);
        if (oFSC ==null || oFSC.FabricSalesContractID<=0) { alert("Please select an item from list."); return ; }

        var SelectedRowIndex=$('#tblFabricSCReports').datagrid('getRowIndex',oFSC);
        var oFabricSCReports= $('#tblFabricSCReports').datagrid('getRows');
        sessionStorage.setItem("FabricSCReports", JSON.stringify(oFabricSCReports));
        sessionStorage.setItem("SelectedRowIndex", SelectedRowIndex);
        sessionStorage.setItem("ExportSCHeader", "View ExportSC");

        sessionStorage.setItem("BackLink", window.location.href);
        var nts=((new Date()).getTime())/1000;
        window.location.href = _sBaseAddress+ "/DyeingOrder/ViewFNSaleOrder?nId=0&nFSCDID="+oFSC.FabricSalesContractDetailID+"&IsInHouse=true&buid="+_nBUID+"&ts="+nts;
        //window.location.href = _sBaseAddress+  "/DyeingOrder/ViewFNSaleOrder?nId=0&nFSCDID="+oFSC.FabricSalesContractID+"&buid="+_nBUID+"&ts="+nts;
    });

</script>


