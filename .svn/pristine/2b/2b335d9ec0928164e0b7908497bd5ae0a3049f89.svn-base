@model IEnumerable<ESimSol.BusinessObjects.ImportPI>
@{
    ViewBag.Title = "View Fancy/Sample Yarn Invoice";
}
<div class="menuMainCollectionTable" id="divImportPIs" style="margin-left: 0px; height:100%; width:100%">
    <table id="tblImportPIs" title="Fancy/Sample Yarn Receive List" class="easyui-datagrid" fit="true" fitcolumns="true" rownumbers="true" pagination="true" singleselect="true" autorowheight="false" toolbar="#toolbar">
        <thead>
            <tr>
                <th field="PINoWithVersion" width="120" align="left">SL/File No</th>
                <th field="ImportPINo" width="120" align="left">Party Con No</th>
                <th field="IssueDateSt" width="110" align="left">Date</th>
                <th field="SupplierName" width="180" align="left">Buyer Name</th>
                <th field="ImportPIStatusSt" width="120" align="left"> Status</th>
                <th field="AmountSt" width="120" align="right">Amount</th>
                <th field="ApproveByName" width="180" align="left">Approve</th>
            </tr>
        </thead>
    </table>
    <div id="toolbar">        
        <input type="text" id="txtSearchbyImportPINo" placeholder="Search by  No" style="width:200px"/>
        <a href="javascript:void(0)" id="btnSearch" class="easyui-linkbutton" iconcls="icon-search" plain="true">Adv. Search</a>
        <a href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-add" plain="true" onclick="Add()" id="btnAdd">New</a>
        <a href="javascript:void(0)" id="btnEdit" class="easyui-linkbutton" iconcls="icon-edit" plain="true" onclick="Edit()">Edit</a>
        <a href="javascript:void(0)" id="btnEdit" class="easyui-linkbutton" iconcls="icon-details" plain="true" onclick="View()">View</a>
        <a href="javascript:void(0)" id="btnDelete" class="easyui-linkbutton" iconcls="icon-remove" plain="true" onclick="Delete()">Delete</a>
        <a href="javascript:void(0)" id="btnApproved" class="easyui-linkbutton" iconcls="icon-ok" plain="true" onclick="Approve()">Approve</a>  
        <a href="javascript:void(0)" id="btnRequestForRevise" class="easyui-linkbutton" iconcls="icon-redo" plain="true" onclick="RequestForRevise()">Request For Revise</a>        
        <a href="javascript:void(0)" id="btnAcceptRevise" class="easyui-linkbutton" iconcls="icon-add" plain="true" onclick="AcceptRevise()">Accept Revise</a> 
        @*<a href="javascript:void(0)" id="btnGRNProduct" class="easyui-linkbutton" iconcls="icon-add" plain="true" onclick="GRNProduct()">GRN Product</a>*@  
        <a id="btnPackingList" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-add" plain="true">Packing List</a>
        <a id="btnAttachment" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-attachment" plain="true" onclick="Attchment()">Attchment</a>
        <a href="javascript:void(0)" id="btnIPIHistory" class="easyui-linkbutton" iconcls="icon-details" plain="true">View History</a>
        <a id="btnPreViewPI" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-print" plain="true">Print Preview</a>
        <a id="btnPrintGRN" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-print" plain="true">Print Challan</a>
        @*<a id="btnPrintPIList" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-print" plain="true">Print List</a>*@
    </div>
</div>
<div id="winAdvSearchImportPI" class="easyui-window winClass" title="Advance Search" data-options="modal:true,closed:true,collapsible:false,minimizable:false,maximizable:false,closable:false">
    <div style="width:800px; float: left;">
        <table border="0" cellpadding="0" cellspacing="0" style="font-size: 12px;width:100%">
                        <tr>
                            <td  style="width:100%;">
                                <fieldset>
                                    <legend style="font-weight: bold; font-size: 12px">Searching Criteria : </legend>
                                    <table border="0" cellpadding="0" cellspacing="0" style="width:100%; font-size: 12px">
                                        <tr>
                                            <td style="width:15%; text-align: right; font-weight: bold">
                                                Contract No:
                                            </td>
                                            <td style="width: 45%; text-align: left">
                                                @Html.TextBox("txtImportPINo_Adv", "", new { style = "width:90%", id = "txtImportPINo_Adv" })
                                            </td>
                                            <td style="width: 15%; text-align: right; font-weight: bold" rowspan="7">
                                                Status :
                                            </td>
                                            <td style="width: 25%; text-align: left; font-size: 12px" rowspan="6">
                                                <table id="tblCurrentStatusAdvSearch" class="easyui-datagrid" title="" style="width:100%; height:200px;" data-options="singleSelect: false,fitColumns:false, rownumbers:true, pagination:false, autoRowHeight:false">
                                                    <thead>
                                                        <tr>
                                                            <th data-options="field:'Selected',checkbox:true"></th>
                                                            <th field="Value" width="70%">Status Name</th>
                                                        </tr>
                                                    </thead>
                                                </table>
                                            </td>
                                        </tr>
                                        <tr>
                                            <td style="width: 15%; text-align: right; font-weight: bold">
                                                Supplier/Buyer :
                                            </td>
                                            <td style="width: 45%; text-align: left">
                                                @Html.TextBox("txtSupplier", "", new { style = "width: 72%", id = "txtSupplier", placeholder = "Type Supplier & Press Enter" }) <input type="button" style="width:20px; font-size: 12px" id="btnClnSupplier" value="C" /> <input type="button" style="width:33px; font-size: 12px" id="btnSupplierPicker" value="Pick" />
                                            </td>
                                        </tr>
                                        <tr>
                                            <td style="width: 15%; text-align: right; font-weight: bold">
                                                Agent :
                                            </td>
                                            <td style="width: 45%; text-align: left">
                                                @Html.TextBox("txtAgent", "", new { style = "width: 72%", id = "txtAgent", placeholder = "Type Agent Name & Press Enter" }) <input type="button" style="width:20px; font-size: 12px" id="btnClnAgent" value="C" /> <input type="button" style="width:33px; font-size: 12px" id="btnAgentPicker" value="Pick" />
                                            </td>
                                        </tr>
                                        <tr>
                                            <td style="width: 15%; text-align: right; font-weight: bold">
                                                Product :
                                            </td>
                                            <td style="width: 45%; text-align: left">
                                                @Html.TextBox("txtProduct", "", new { style = "width: 72%", id = "txtProduct", placeholder = "Type Product Name & Press Enter" }) <input type="button" style="width:20px; font-size: 12px" id="btnClnProduct" value="C" /> <input type="button" style="width:33px; font-size: 12px" id="btnProduct" value="Pick" />
                                            </td>
                                        </tr>
                                        <tr>
                                            <td style="width: 15%; text-align: right; font-weight: bold">
                                                Beneficiary Bank :
                                            </td>
                                            <td style="width: 45%; text-align: left">
                                                @Html.TextBox("txtBankBranch", "", new { style = "width: 72%", id = "txtBankBranch", placeholder = "Type Negotiation Bank Branch Name & Press Enter" }) <input type="button" style="width:20px; font-size: 12px" id="btnClnBranch" value="C" /> <input type="button" style="width:33px; font-size: 12px" id="btnBranchAdvicePicker" value="Pick" />
                                            </td>
                                        </tr>
                           
                                        <tr>
                                            <td style="width: 15%; text-align: right; font-weight: bold">
                                                Contract Date:
                                            </td>
                                            <td style="width:45%; text-align: left; font-size: 12px" >
                                                <select  id="cboDateSearch" onchange="DateActionsIssueDateAdvSearch()" style="width:100px;text-align:left"></select>
                                                <input id="txtStartDate" type="text" class="easyui-datebox" required="required" data-options="formatter:icsdateformat,parser:icsdateparser" style="width: 98px;" />To
                                                <input id="txtEndDate" type="text" class="easyui-datebox" required="required" data-options="formatter:icsdateformat,parser:icsdateparser" style="width: 98px;" />
                                            </td>
                                        </tr>

             
                                        <tr>
                                            <td style="width: 15%; text-align: right; font-weight: bold">
                                                Receive Date:
                                            </td>
                                            <td style="width: 45%; text-align: left; font-size: 12px">
                                                <select id="cboValidityDateSearch" onchange="DateActionsValidityDateAdvSearch()" style="width:100px;text-align:left"></select>
                                                <input id="txtValidityStartDate" type="text" class="easyui-datebox" required="required" data-options="formatter:icsdateformat,parser:icsdateparser" style="width: 98px;" />To
                                                <input id="txtValidityEndDate" type="text" class="easyui-datebox" required="required" data-options="formatter:icsdateformat,parser:icsdateparser" style="width: 98px;" />
                                            </td>
                                            
                                        </tr>

                                   
                                        <tr>
                                            <td style="width: 15%; text-align: right; font-weight: bold">
                                                Approve Date:
                                            </td>
                                            <td style="width: 45%; text-align: left; font-size: 12px">
                                                <select id="cboApproveDateSearch" onchange="DateActionsApproveDateAdvSearch()" style="width:100px;text-align:left"></select>
                                                <input id="txtApproveStartDate" type="text" class="easyui-datebox" required="required" data-options="formatter:icsdateformat,parser:icsdateparser" style="width: 98px;" />To
                                                <input id="txtApproveEndDate" type="text" class="easyui-datebox" required="required" data-options="formatter:icsdateformat,parser:icsdateparser" style="width: 98px;" />
                                            </td>
                                            <td style="width:15%; text-align: right; font-weight: bold">
                                                Approve By:
                                            </td>
                                            <td style="width: 25%; text-align: left">
                                                <select id="cboApprovedBY" style="width:100%"></select>
                                            </td>
                                        </tr>

                                        <tr>
                                            <td style="width: 15%; text-align: right; font-weight: bold">
                                                Amount:
                                            </td>
                                            <td style="width: 45%; text-align: left; font-size: 12px">
                                                <select id="cboAmountSearch" onchange="ActionsAmountAdvSearch()" style="width:100px;text-align:left"></select>
                                                <input id="txtAmountStart" type="text"  style="width: 94px;" />To
                                                <input id="txtAmountEnd" type="text" style="width: 94px;" />
                                            </td>
                                            <td style="width:15%; text-align: right; font-weight: bold">
                                                Remarks:
                                            </td>
                                            <td style="width: 25%; text-align: left">
                                                @Html.TextBox("txtRemarks", "", new { style = "width:98%", id = "txtRemarks" })
                                            </td>
                                        </tr>
                                    </table>
                                </fieldset>
                            </td>
                        </tr>
                    </table>
              
        <fieldset class="actionfieldsetstyle">
            <legend>Actions : </legend>
            <label class="lblLoadingMessage" style="float:left;">Loading Please Wait...</label>
            <a id="btnReset" href="javascript:void(0)" class="easyui-linkbutton" onclick="Reset()" iconcls="icon-reload" plain="true">Reset</a>
            <a id="btnRefresh" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-search" plain="true">Search</a>
            <a id="btnSearchClose" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-cancel" plain="true">Close</a>
        </fieldset>
    </div>
</div>
  <script type="text/javascript">
    var _sBaseAddress="";
    $(document).ready(function ()
    {
        _sBaseAddress =@Html.Raw( new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(HttpContext.Current.Session[SessionInfo.BaseAddress]));
        var oImportPIs =@Html.Raw( new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(Model));
        var nBUID = @Html.Raw( new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(ViewBag.BUID));
        var oPIStatusObjs = @Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(ViewBag.PIStatusObjs));
        var oApprovedByUsers = @Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(ViewBag.ApprovedByUsers));
        DynamicRefreshList(oPIStatusObjs, "tblCurrentStatusAdvSearch");
        $("#cboApprovedBY").icsLoadCombo({List: oApprovedByUsers,OptionValue: "UserID",DisplayText: "UserName"});
        sessionStorage.setItem('BUID',nBUID);
        $('#txtAmountStart,#txtAmountEnd').icsCurrencyBox();
        var oTempImportPIs =sessionStorage.getItem("ImportPIs");
        if(oTempImportPIs!=null )
        {
            oTempImportPIs = jQuery.parseJSON(oTempImportPIs );
        }
        else
        {
            oTempImportPIs =oImportPIs;
        }
        $('#divImportPIs').data('ImportPIs',oTempImportPIs);
        $('#divImportPIs').data('PIStatus',oPIStatusObjs);
        $('#divImportPIs').data('SupplierIDs',"");
        $('#divImportPIs').data('AgentIDs',"");
        $('#divImportPIs').data('ProductIDs',"");
        $('#divImportPIs').data('BankBranchIDs',"");
        LoadintoGrid(oTempImportPIs);
        $(".lblLoadingMessage").hide();
  });


        function Add()
        {
            var oImportPIs= $('#tblImportPIs').datagrid('getRows');
            sessionStorage.setItem("ImportPIs", JSON.stringify(oImportPIs));
            sessionStorage.setItem("SelectedRowIndex", -1);
            sessionStorage.setItem("ImportPIHeader", "Add Import PI");
            sessionStorage.setItem("BackLink", window.location.href);
            window.location.href = _sBaseAddress+ "/ImportPI/ViewImportPIFancy?id=0&buid="+sessionStorage.getItem("BUID");
        }

        function View() {
            var oImportPI = $('#tblImportPIs').datagrid('getSelected');
            var nSelectedIndex = $('#tblImportPIs').datagrid('getRowIndex', oImportPI);

            if (oImportPI == null || oImportPI.ImportPIID <= 0) {
                alert("Please select an item from list!");
                return;
            }
            var oImportPIs= $('#tblImportPIs').datagrid('getRows');
            sessionStorage.setItem("ImportPIs", JSON.stringify(oImportPIs));
            sessionStorage.setItem("SelectedRowIndex", nSelectedIndex);
            sessionStorage.setItem("ImportPIHeader", "View ImportPI");
            sessionStorage.setItem("BackLink", window.location.href);
            window.location.href = _sBaseAddress+ "/ImportPI/ViewImportPIFancy?id="+oImportPI.ImportPIID+"&buid="+sessionStorage.getItem("BUID");
        }
        function Edit() {
            var oImportPI = $('#tblImportPIs').datagrid('getSelected');
            var nSelectedIndex = $('#tblImportPIs').datagrid('getRowIndex', oImportPI);

            if (oImportPI == null || oImportPI.ImportPIID <= 0) {
                alert("Please select an item from list!");
                return;
            }
            if (parseInt(oImportPI.ApprovedBy)>0) {
                alert("Already Approved!");
                return;
            }
            var oImportPIs= $('#tblImportPIs').datagrid('getRows');
            sessionStorage.setItem("ImportPIs", JSON.stringify(oImportPIs));
            sessionStorage.setItem("SelectedRowIndex", nSelectedIndex);
            sessionStorage.setItem("ImportPIHeader", "Edit ImportPI");
            sessionStorage.setItem("BackLink", window.location.href);
            window.location.href = _sBaseAddress+ "/ImportPI/ViewImportPIFancy?id="+oImportPI.ImportPIID+"&buid="+sessionStorage.getItem("BUID");
        }

        function Approve() {
            var oImportPI=$('#tblImportPIs').datagrid('getSelected');
            if(oImportPI==null || oImportPI.ImportPIID<=0)
            {
                alert("Please select an item from list!");
                return;
            }
            if (parseInt(oImportPI.ApprovedBy)>0) {
                alert("Already Approved!");
                return;
            }
            var nSelectedIndex= $('#tblImportPIs').datagrid('getRowIndex',oImportPI);
            var oImportPIs= $('#tblImportPIs').datagrid('getRows');
            sessionStorage.setItem("ImportPIs", JSON.stringify(oImportPIs));
            sessionStorage.setItem("SelectedRowIndex", nSelectedIndex);
            sessionStorage.setItem("ImportPIHeader", "Approve ImportPI");
            sessionStorage.setItem("BackLink", window.location.href);
            window.location.href = _sBaseAddress+ "/ImportPI/ViewImportPIFancy?id="+oImportPI.ImportPIID+"&buid="+sessionStorage.getItem("BUID");
        }
        function RequestForRevise()
        {
            var oImportPI=$('#tblImportPIs').datagrid('getSelected');
            if(oImportPI==null || oImportPI.ImportPIID<=0)
            {
                alert("Please select an item from list!");
                return;
            }
           
            var nSelectedIndex= $('#tblImportPIs').datagrid('getRowIndex',oImportPI);
            var oImportPIs= $('#tblImportPIs').datagrid('getRows');
            sessionStorage.setItem("ImportPIs", JSON.stringify(oImportPIs));
            sessionStorage.setItem("SelectedRowIndex", nSelectedIndex);
            sessionStorage.setItem("ImportPIHeader", "ReviseReq ImportPI");
            sessionStorage.setItem("BackLink", window.location.href);
            window.location.href = _sBaseAddress+ "/ImportPI/ViewImportPIFancy?id="+oImportPI.ImportPIID+"&buid="+sessionStorage.getItem("BUID");

         
        }

        function AcceptRevise()
        {
            var oImportPI=$('#tblImportPIs').datagrid('getSelected');
            if(oImportPI==null || oImportPI.ImportPIID<=0)
            {
                alert("Please select an item from list!");
                return;
            }
            if (parseInt(oImportPI.ImportPIStatusInt)!=5) {
                alert("Without Request for Revise. Can't Accept !");
                return;
            }
            var nSelectedIndex= $('#tblImportPIs').datagrid('getRowIndex',oImportPI);
            var oImportPIs= $('#tblImportPIs').datagrid('getRows');
            sessionStorage.setItem("ImportPIs", JSON.stringify(oImportPIs));
            sessionStorage.setItem("SelectedRowIndex", nSelectedIndex);
            sessionStorage.setItem("ImportPIHeader", "Revise Import PI");
            sessionStorage.setItem("BackLink", window.location.href);
            window.location.href = _sBaseAddress+ "/ImportPI/ViewImportPIFancy?id="+oImportPI.ImportPIID+"&buid="+sessionStorage.getItem("BUID");
        }
        function Delete() {

            var oImportPI = $('#tblImportPIs').datagrid('getSelected');
            if (oImportPI == null || oImportPI.ImportPIID <= 0) {
                alert("Please select a item from list!");
                return false;
            }
            if (parseInt(oImportPI.ImportPIStatusInt)== 1) {
                alert("Sorry, Can't delete an Approved ImportPI!");
                return false;
            }
            if (!confirm("Confirm to Delete?")) return;

            var SelectedRowIndex = $('#tblImportPIs').datagrid('getRowIndex', oImportPI);

            if (oImportPI.ImportPIID > 0) {

                $.ajax
                ({
                    type: "POST",
                    dataType: "json",
                    url: _sBaseAddress + "/ImportPI/Delete",
                    traditional: true,
                    data: JSON.stringify(oImportPI),
                    contentType: "application/json; charset=utf-8",
                    success: function(data) {

                        feedbackmessage = jQuery.parseJSON(data);
                        if (feedbackmessage == "Deleted") {
                            $('#tblImportPIs').datagrid('deleteRow', SelectedRowIndex);
                            alert("Delete sucessfully");

                        } else {
                            alert(feedbackmessage);
                        }
                    },
                    error: function(xhr, status, error) {
                        alert(error);
                    }

                });

            }
        }
        $("#btnPackingList").click(function(){
            var oImportPI=$('#tblImportPIs').datagrid('getSelected');
            if(oImportPI==null || oImportPI.ImportPIID<=0)
            {
                alert("Please select an item from list!");
                return;
            }
            if (parseInt(oImportPI.ApprovedBy)==0) {
                alert("Yet Not Approved!");
                return;
            }
            var nSelectedIndex= $('#tblImportPIs').datagrid('getRowIndex',oImportPI);
            var oImportPIs= $('#tblImportPIs').datagrid('getRows');
            sessionStorage.setItem("ImportPIs", JSON.stringify(oImportPIs));
            sessionStorage.setItem("SelectedRowIndex", nSelectedIndex);
            sessionStorage.setItem("Header", "Packing List");
            sessionStorage.setItem("BackLink", window.location.href);
            window.location.href = _sBaseAddress+  "/ImportInvoice/ViewImportInvoicePackingListPI?id="+parseInt(oImportPI.ImportPIID);
        });
        $("#btnIPIHistory").click(function(){
            debugger;
            var oImportPI=$('#tblImportPIs').datagrid('getSelected');
            if(oImportPI==null || oImportPI.ImportPIID<=0)
            {
                alert("Please select an item from list!");
                return;
            }
           
            var nSelectedIndex= $('#tblImportPIs').datagrid('getRowIndex',oImportPI);
            var oImportPIs= $('#tblImportPIs').datagrid('getRows');
            sessionStorage.setItem("ImportPIs", JSON.stringify(oImportPIs));
            sessionStorage.setItem("SelectedRowIndex", nSelectedIndex);
            sessionStorage.setItem("ImportPIHeader", "View History");
            sessionStorage.setItem("BackLink", window.location.href);
            var tsv=((new Date()).getTime())/1000;
            window.location.href = _sBaseAddress+ "/ImportPI/ViewImportPI_History?nId="+oImportPI.ImportPIID+"&ts="+tsv;
        });
        function LoadintoGrid(oImportPIs) {
            data = oImportPIs;
            data = { "total": "" + data.length + "", "rows": data };
            $('#tblImportPIs').datagrid('loadData', data);
            var nIndex= parseInt(sessionStorage.getItem("SelectedRowIndex"));
            if(nIndex!=null)
            {
                $('#tblImportPIs').datagrid('selectRow',nIndex);
            }
        }

        function RowSelect(rowIndex, rowData)
        {

            //debugger;
            if(rowData.Status ==0)
            {
                document.getElementById("btnApproved").style.display = '';
                document.getElementById("btnEdit").style.display = '';
                document.getElementById("btnDelete").style.display = '';
                document.getElementById("btnRevice").style.display = 'none';
            }
            else if(rowData.Status == 1)
            {
                document.getElementById("btnApproved").style.display = '';
                document.getElementById("btnEdit").style.display = 'none';
                document.getElementById("btnDelete").style.display = 'none';


                if(rowData.IsReviseRequest)
                {
                    document.getElementById("btnRevice").style.display = '';
                }
                else
                {
                    document.getElementById("btnRevice").style.display = 'none';
                }

            }
            else if(rowData.Status == 2)
            {
                document.getElementById("btnApproved").style.display = '';
                document.getElementById("btnEdit").style.display = 'none';
                document.getElementById("btnDelete").style.display = 'none';
                document.getElementById("btnRevice").style.display = 'none';
                if(rowData.IsReviseRequest)
                {
                    document.getElementById("btnRevice").style.display = '';
                }
                else
                {
                    document.getElementById("btnRevice").style.display = 'none';
                }
            }
            else if(rowData.Status == 3)
            {
                document.getElementById("btnApproved").style.display = 'none';
                document.getElementById("btnEdit").style.display = 'none';
                document.getElementById("btnDelete").style.display = 'none';
                document.getElementById("btnRevice").style.display = 'none';
                if(rowData.IsReviseRequest)
                {
                    document.getElementById("btnRevice").style.display = '';
                }
                else
                {
                    document.getElementById("btnRevice").style.display = 'none';
                }
            }
            else if(rowData.Status == 4)
            {
                document.getElementById("btnApproved").style.display = 'none';
                document.getElementById("btnEdit").style.display = 'none';
                document.getElementById("btnDelete").style.display = 'none';

                document.getElementById("btnRevice").style.display = 'none';
                if(rowData.IsReviseRequest)
                {
                    document.getElementById("btnRevice").style.display = '';
                }
                else
                {
                    document.getElementById("btnRevice").style.display = 'none';
                }
            }
            else
            {

                document.getElementById("btnAuthorize").style.display = 'none';
                document.getElementById("btnDisburse").style.display = 'none';
                document.getElementById("btnReceive").style.display = 'none';
            }

        }

        function Refresh() {
            document.getElementById('txtSearchbyImportPINo').value = "Search by ImportPI No";
            LoadintoGrid($('#divImportPIs').data('ImportPIs'));
        }

        $("#txtSearchbyImportPINo").keyup(function (e) {
            if (e.keyCode == 13) {
                var oImportPI = {
                    ImportPINo : $("#txtSearchbyImportPINo").val(),
                    ImportPITypeInt:5,
                    BUID:sessionStorage.getItem('BUID')
                };

                if (oImportPI.BUID<=0)
                {
                    alert("Invalid Business unit.");
                    return false;
                }

                $.ajax({
                    type: "POST",
                    dataType: "json",
                    url: _sBaseAddress + "/ImportPI/GetsBySearchKey",
                    traditional: true,
                    data: JSON.stringify(oImportPI),
                    contentType: "application/json; charset=utf-8",
                    success: function (data) {
                        var oImportPIs = jQuery.parseJSON(data);
                        if (oImportPIs != null) {
                            if (oImportPIs.length > 0) {
                                DynamicRefreshList(oImportPIs, "tblImportPIs");
                            }
                            else {
                                DynamicRefreshList([], "tblImportPIs");
                            }
                        } else {
                            DynamicRefreshList([], "tblImportPIs");
                        }
                    },
                    error: function (xhr, status, error) {
                        alert(error);
                    }
                });
            }
            else {

                var txtSearchBy = $("#txtSearchbyImportPINo").val();
                var oCurrentLists = $("#tblImportPIs").datagrid("getRows");
                var sTempSearchString = "";
                var oSearchedLists = [];
                if (e.keyCode == 8) {
                    oCurrentLists = _oImportPIs;
                }
                for (var i = 0; i < oCurrentLists.length; i++) {
                    sTempSearchString = oCurrentLists[i].ImportPINo;
                    var n = sTempSearchString.toUpperCase().indexOf(txtSearchBy.toUpperCase());
                    if (n != -1) {
                        if (parseInt(nTextileUnitInInt) > 0) {
                            if (oCurrentLists[i].TextileUnitInInt == parseInt(nTextileUnitInInt)) {
                                oSearchedLists.push(oCurrentLists[i]);
                            }
                        }
                        else {
                            oSearchedLists.push(oCurrentLists[i]);
                        }
                    }
                }
                DynamicRefreshList(oSearchedLists, "tblImportPIs");
            }
        });


       

        function GRNProduct()
        {
            var oImportPI=$('#tblImportPIs').datagrid('getSelected');
            if(oImportPI==null || oImportPI.ImportPIID<=0)
            {
                alert("Please select an item from list!");
                return;
            }
            if (parseInt(oImportPI.ImportPIStatusInt)!=1) {
                alert("Without Approve. Can't Add GRN Product!");
                return;
            }
            var nSelectedIndex= $('#tblImportPIs').datagrid('getRowIndex',oImportPI);
            var oImportPIs= $('#tblImportPIs').datagrid('getRows');
            sessionStorage.setItem("ImportPIs", JSON.stringify(oImportPIs));
            sessionStorage.setItem("SelectedRowIndex", nSelectedIndex);
            sessionStorage.setItem("ImportPIHeader", "GRN Product of (Import PI)");
            sessionStorage.setItem("BackLink", window.location.href);
            window.location.href = _sBaseAddress+ "/ImportPI/ViewImportPIGRNProduct?id="+oImportPI.ImportPIID+"&buid="+sessionStorage.getItem("BUID");
        }

        function Attchment()
        {
            var oImportPI = $('#tblImportPIs').datagrid('getSelected');
            if(oImportPI==null || parseInt(oImportPI.ImportPIID)<=0)
            {
                alert("Please select a item from list!");
                return;
            }
            window.open(_sBaseAddress + '/AttachDocument/Attachment?id='+oImportPI.ImportPIID+'&RefType=12&OperationInfo= Attachment of Import PI No : '+oImportPI.ImportPINo, '_blank');
        }

        ///////Search
        $("#btnSearch").click(function () {
            $("#winAdvSearchImportPI").icsWindow('open', "Advance Search");
            Reset();
        });
        function RefreshDateSearch()
        {
            debugger;
            SetTodayDate();
            $('#cboDateSearch,#cboValidityDateSearch,#cboApproveDateSearch,#cboAmountSearch').empty();
            var listDates = "<option value='"+"0"+"'>" + "None" + "</option>";
            listDates+= "<option value='"+"1"+"'>" + "EqualTo" + "</option>";
            listDates+= "<option value='"+"2"+"'>" + "Not EqualTo" + "</option>";
            listDates+= "<option value='"+"3"+"'>" + "Greater Than" + "</option>";
            listDates+= "<option value='"+"4"+"'>" + "Less Than" + "</option>";
            listDates+= "<option value='"+"5"+"'>" + "Between" + "</option>";
            $('#cboDateSearch,#cboValidityDateSearch,#cboApproveDateSearch,#cboAmountSearch').html(listDates);
        }
        //Pick Supplier
        $("#txtSupplier").keydown(function (e) {
            debugger;
            var code = (e.keyCode ? e.keyCode : e.which);
            if (code == 13) // Enter Press
            {
                GetSuppliers($.trim($('#txtSupplier').val()));
            }
            if (code == 8) //backspace=8
            {
                $("#txtSupplier").val('');
                $("#txtSupplier").removeClass("fontColorOfPickItem");
                $('#divImportPIs').data('SupplierIDs',"");
            }
        });
        $("#btnSupplierPicker").click(function () {
            GetSuppliers("");
        });

        $('#btnClnSupplier').click(function(e){
            //debugger;
            $("#txtSupplier").val('');
            $("#txtSupplier").removeClass("fontColorOfPickItem");
            $('#divImportPIs').data('SupplierIDs',"");
        });
        function GetSuppliers(sSuplierName)
        {
            var oContractor = { Params:1+'~'+sSuplierName+'~'+sessionStorage.getItem('BUID') };
            var obj = {
                BaseAddress: sessionStorage.getItem('BaseAddress'),
                Object: oContractor,
                ControllerName: "Contractor",
                ActionName: "ContractorSearchByNameType",
                IsWinClose: false
            };
            $.icsDataGets(obj, function (response) {
                debugger;
                if (response.status && response.objs.length > 0) {
                    if (response.objs[0].ContractorID > 0) {
                        debugger;
                        var tblColums = []; var oColumn = { field: "Name", title: "Name", width: 200, align: "left" }; tblColums.push(oColumn);
                        oColumn = { field: "ContractorTypeInString", title: "Type", width: 150, align: "left" }; tblColums.push(oColumn);
                        var oPickerParam = {
                            winid: 'winSupplier',
                            winclass: 'clsSupplier',
                            winwidth: 450,
                            winheight: 460,
                            tableid: 'tblBuyers',
                            tablecolumns: tblColums,
                            datalist: response.objs,
                            multiplereturn: true,
                            searchingbyfieldName: 'Name',
                            windowTittle: 'Supplier List'
                        };
                        $.icsPicker(oPickerParam);
                        IntializePickerbutton(oPickerParam);
                    }
                    else { alert(response.objs[0].ErrorMessage); }
                }
            });
        }

        //Pick Agent
        $("#txtAgent").keydown(function (e) {
            debugger;
            var code = (e.keyCode ? e.keyCode : e.which);
            if (code == 13) // Enter Press
            {
                GetAgents($.trim($('#txtAgent').val()));
            } if (code == 8) //backspace=8
            {
                $("#txtAgent").val('');
                $("#txtAgent").removeClass('fontColorOfPickItem');
                $('#divImportPIs').data('AgentIDs',"");
            }
        });
        $("#btnAgentPicker").click(function () {
            GetAgents("");
        });
        $('#btnClnAgent').click(function(e){
            //debugger;
            $("#txtAgent").val('');
            $("#txtAgent").removeClass("fontColorOfPickItem");
            $('#divImportPIs').data('AgentIDs',"");
        });
        function GetAgents(sSuplierName)
        {
            var oContractor = { Params:5+'~'+sSuplierName+'~'+sessionStorage.getItem('BUID') };
            var obj = {
                BaseAddress: sessionStorage.getItem('BaseAddress'),
                Object: oContractor,
                ControllerName: "Contractor",
                ActionName: "ContractorSearchByNameType",
                IsWinClose: false
            };
            $.icsDataGets(obj, function (response) {
                debugger;
                if (response.status && response.objs.length > 0) {
                    if (response.objs[0].ContractorID > 0) {
                        debugger;
                        var tblColums = []; var oColumn = { field: "Name", title: "Name", width: 200, align: "left" }; tblColums.push(oColumn);
                        oColumn = { field: "ContractorTypeInString", title: "Type", width: 150, align: "left" }; tblColums.push(oColumn);
                        var oPickerParam = {
                            winid: 'winAgent',
                            winclass: 'clsAgent',
                            winwidth: 450,
                            winheight: 460,
                            tableid: 'tblBuyers',
                            tablecolumns: tblColums,
                            datalist: response.objs,
                            multiplereturn: true,
                            searchingbyfieldName: 'Name',
                            windowTittle: 'Agent List'
                        };
                        $.icsPicker(oPickerParam);
                        IntializePickerbutton(oPickerParam);
                    }
                    else { alert(response.objs[0].ErrorMessage); }
                }
            });
        }

      //Propduct
        $("#txtProduct").keydown(function (e)
        {
            var code = (e.keyCode ? e.keyCode : e.which);
            if (code == 13) // Enter Press
            {
                if($('#txtProduct').val()=="" || $('#txtProduct').val()==null)
                {
                    alert("Please Type Product Name And Press Enter.");
                    return;
                }
                GetProducts($.trim($('#txtProduct').val()));
            }
            if (code == 8) //backspace=8
            {
                //
                $("#txtProduct").val('');
                $("#txtProduct").removeClass('fontColorOfPickItem');
                $('#divImportPIs').data('ProductIDs',"");
            }
        });
        $("#btnProduct").click(function () {
            GetProducts($.trim($('#txtProduct').val()));
        });
        $('#btnClnProduct').click(function(e){
            //debugger;
            $("#txtProduct").val('');
            $("#txtProduct").removeClass("fontColorOfPickItem");
            $('#divImportPIs').data('ProductIDs',"");
        });
        function GetProducts(sProductName)
        {
            var oProduct = { BUID: sessionStorage.getItem('BUID'),ProductName:sProductName};
            var obj = {
                BaseAddress: $('#divImportPI').data('BaseAddress'),
                Object: oProduct,
                ControllerName: "ImportPI",
                ActionName: "GetProducts",
                IsWinClose: false
            };
            $.icsDataGets(obj, function (response) {

                if (response.status && response.objs.length > 0)
                {
                    if (response.objs[0].ProductID > 0) {
                        var tblColums = [], searcingField = "", windowTittle = "";
                        var oColumn = { field: "ProductCode", title: "Code", width: 100, align: "left" }; tblColums.push(oColumn);
                        oColumn = { field: "FullName", title: "Item Name", width: 250, align: "left" }; tblColums.push(oColumn);
                        var oPickerParam = {
                            winid: 'winProduct',
                            winclass: 'clsProduct',
                            winwidth: 450,
                            winheight: 460,
                            tableid: 'tblProduct',
                            tablecolumns: tblColums,
                            datalist: response.objs,
                            multiplereturn: true,
                            searchingbyfieldName: searcingField,
                            windowTittle: windowTittle
                        };
                        $.icsPicker(oPickerParam);
                        IntializePickerbutton(oPickerParam);//multiple return
                    }
                    else {
                        alert(response.objs[0].ErrorMessage);
                    }


                }
                else { alert("Data not Found"); }
            });
        }

      //bank Branch
        $('#txtBankBranch').keydown(function (e){
            var code = (e.keyCode ? e.keyCode : e.which);
            if(code === 13)
            {
                if($.trim($('#txtBankBranch').val())==null || $.trim($('#txtBankBranch').val())=="")
                {
                    alert("Please Pick Bank Branch.");
                    return;
                }
                GetBankBranchs($.trim($('#txtBankBranch').val()));
            }if(code===8)
            {
                $("#txtBankBranch").val('');
                $("#txtBankBranch").removeClass('fontColorOfPickItem');
                $('#divImportPIs').data('BankBranchIDs',"");
            }
        });
        $('#btnBranchAdvicePicker').click(function (e){
            GetBankBranchs($.trim($('#txtBankBranch').val()));
        });
        $('#btnClnBranch').click(function(e){
            //debugger;
            $("#txtBankBranch").val('');
            $("#txtBankBranch").removeClass("fontColorOfPickItem");
            $('#divImportPIs').data('BankBranchIDs',"");
        });
        function GetBankBranchs(txtBankBranch)
        {
            var oBankBranch = {
                BUID:sessionStorage.getItem('BUID'),
                DeptIDs:'3', //EnumOperationalDept:Import_Party = 3,
                BankName : txtBankBranch,
                BankID : 0
            };
            var obj = {
                BaseAddress: $('#divImportPI').data('BaseAddress'),
                Object: oBankBranch,
                ControllerName: "BankBranch",
                ActionName: "GetsBankBranchSearchByBankName",
                IsWinClose: false
            };
            $.icsDataGets(obj, function (response) {
                if (response.status && response.objs.length > 0) {
                    if (parseInt(response.objs[0].BankBranchID) > 0) {
                        var tblColums = []; var oColumn = { field: "BranchCode", title: "Code", width: 100, align: "left" }; tblColums.push(oColumn);
                        oColumn = { field: "BankName", title: "Bank Name", width: 150, align: "left" }; tblColums.push(oColumn);
                        oColumn = { field: "BranchName", title: "Branch Name", width: 200, align: "left" }; tblColums.push(oColumn);
                        oColumn = { field: "PhoneNo", title: "Phone No", width: 100, align: "left" }; tblColums.push(oColumn);
                        var oPickerParam = {
                            winid: 'winBranch',
                            winclass: 'clsBranch',
                            winwidth: 500,
                            winheight: 420,
                            tableid: 'tblBranch',
                            tablecolumns: tblColums,
                            datalist: response.objs,
                            multiplereturn: true,
                            searchingbyfieldName: 'BranchName',
                            windowTittle: 'Branch List'
                        };
                        $.icsPicker(oPickerParam);
                        IntializePickerbutton(oPickerParam);
                    }
                    else { alert(response.objs[0].ErrorMessage); }
                }
                else
                {
                    alert("Data Not Found!");
                }
            });

        }
        //Refresh
        $('#btnRefresh').click(function () {
            debugger;
            /* Issue Date*/
            var nIssueDate = $('#cboDateSearch').val();
            var dIssueStartDate = $('#txtStartDate').datebox('getValue');
            var dIssueEndDate = $('#txtEndDate').datebox('getValue');

            /* Validity Date*/
            var nValidityDate = $('#cboValidityDateSearch').val();
            var dValidityStartDate = $('#txtValidityStartDate').datebox('getValue');
            var dValidityEndDate = $('#txtValidityEndDate').datebox('getValue');

            /* Approve Date*/
            var nApproveDate = $('#cboApproveDateSearch').val();
            var dApproveStartDate = $('#txtApproveStartDate').datebox('getValue');
            var dApproveEndDate = $('#txtApproveEndDate').datebox('getValue');

            /* Amount*/
            var ncboAmount = $('#cboAmountSearch').val();
            var nAmountStart = $('#txtAmountStart').val();
            var nAmountEnd= $('#txtAmountEnd').val();

            var sImportPINo = document.getElementById("txtImportPINo_Adv").value;
            var nApprovedBY =  $('#cboApprovedBY').val();
            var sRemarks = $('#txtRemarks').val();
            var chkResult = CheckEmpty();
            if (chkResult!= true) {
                alert("Please Select at lease one Criteria !!");
                return;
            }
            $(".lblLoadingMessage").show();
            var sCurrentStatus = "";
            var oPIStatus = $("#tblCurrentStatusAdvSearch").datagrid("getChecked");
            for (var i = 0; i < oPIStatus.length; i++) {
                sCurrentStatus = oPIStatus[i].id + "," +sCurrentStatus;
            }
            sCurrentStatus = sCurrentStatus.substring(0, sCurrentStatus.length - 1);
            var sTempString = nIssueDate + '~' + dIssueStartDate + '~' + dIssueEndDate + '~' +nValidityDate + '~' + dValidityStartDate+ '~' + dValidityEndDate+ '~' +nApproveDate+ '~' + dApproveStartDate + '~' + dApproveEndDate+'~' +ncboAmount+ '~' + nAmountStart+ '~' + nAmountEnd+ '~' + sImportPINo + '~' + $('#divImportPIs').data('SupplierIDs')+'~' + $('#divImportPIs').data('AgentIDs')+'~' + $('#divImportPIs').data('ProductIDs')+'~' + $('#divImportPIs').data('BankBranchIDs')+'~'+sCurrentStatus+'~'+sessionStorage.getItem('BUID')+'~'+nApprovedBY+'~'+sRemarks;
            var oImportPI={ErrorMessage:sTempString,ImportPITypeInt:5};
            $.ajax({
                type: "POST",
                dataType: "json",
                url : _sBaseAddress+"/ImportPI/GetsSearchedData",
                traditional: true,
                data:  JSON.stringify(oImportPI),
                contentType: "application/json; charset=utf-8",
                success: function (data) {
                    debugger;
                    var oImportPIs = jQuery.parseJSON(data);
                    debugger;
                    if (oImportPIs != null)
                    {
                        if (oImportPIs.length > 0)
                        {
                            DynamicRefreshList(oImportPIs,'tblImportPIs');
                            $("#winAdvSearchImportPI").icsWindow("close");
                        }
                        else {
                            alert("Data not found!!");
                            DynamicRefreshList([],'tblImportPIs');
                        }
                    }
                    $(".lblLoadingMessage").hide();
                },
                error: function (xhr, status, error) {
                    alert(error);
                }
            });

        });

        //Reset
        function Reset() {
            debugger;
            DynamicRefreshList([],'tblImportPIs');
            $("#txtImportPINo_Adv,#txtSupplier,#txtAgent,#txtProduct,#txtBankBranch").val('');
            RefreshDateSearch();
            $("#txtSupplier,#txtAgent ,#txtProduct,#txtBankBranch").removeClass("fontColorOfPickItem");
            var oPIStatusObjs= $('#divImportPIs').data('PIStatus');
            DynamicRefreshList(oPIStatusObjs, "tblCurrentStatusAdvSearch");
            $('#divImportPIs').data('SupplierIDs',"");
            $('#divImportPIs').data('AgentIDs',"");
            $('#divImportPIs').data('ProductIDs',"");
            $('#divImportPIs').data('BankBranchIDs',"");
            $('#cboApprovedBY').val(0);
            $('#txtRemarks').val('');
            $('#txtAmountStart,#txtAmountEnd').val(0.0);
        }


        //Close Picker
        $('#btnSearchClose').click(function () {
            $("#winAdvSearchImportPI").icsWindow('close');
        });


        function DateActionsIssueDateAdvSearch() {
            DynamicDateActions("cboDateSearch", "txtStartDate", "txtEndDate");
        }
        function DateActionsValidityDateAdvSearch() {
            DynamicDateActions("cboValidityDateSearch", "txtValidityStartDate", "txtValidityEndDate");
        }
        function DateActionsApproveDateAdvSearch() {
            DynamicDateActions("cboApproveDateSearch", "txtApproveStartDate", "txtApproveEndDate");
        }
        function ActionsAmountAdvSearch() {
            DynamicValueActions("cboAmountSearch", "txtAmountStart", "txtAmountEnd");
        }
        function SetTodayDate() {
            $('#txtStartDate,#txtEndDate,#txtValidityStartDate,#txtValidityEndDate,#txtApproveStartDate,#txtApproveEndDate').datebox('setValue', icsdateformat(new Date()));
        }

        function CheckEmpty() {

            var nIssueDate = $("#cboDateSearch").val();
            var nValidityDate = $("#cboValidityDateSearch").val();
            var nApproveDate = $("#cboApproveDateSearch").val();
            var sPINo = $("#txtImportPINo_Adv").val();
            var oPIStatus = $("#tblCurrentStatusAdvSearch").datagrid("getChecked");
            if (nIssueDate == 0 && nValidityDate==0 && nApproveDate==0 && sPINo=="" && $('#divImportPIs').data('SupplierIDs')== "" && $('#divImportPIs').data('AgentIDs')== "" && $('#divImportPIs').data('ProductIDs')== ""&& $('#divImportPIs').data('BankBranchIDs')== "" && $('#cboApprovedBY').val()==0 && $('#txtRemarks').val()=="" && oPIStatus==null)
            {
                return false;
            }
            return true;
        }

        function IntializePickerbutton(oPickerobj) {
            debugger;
            $("#" + oPickerobj.winid).find("#btnOk").click(function () {
                debugger;
                //for Single Select
                PickerEvents(oPickerobj);
            });
            $(document).find('.' + oPickerobj.winclass).keydown(function (e) {
                if (e.which == 13)//enter=13
                {
                    PickerEvents(oPickerobj);
                }
            });
        }
        function PickerEvents(oPickerobj) {
            var oreturnobj = null, oreturnobjs = [];
            if (oPickerobj.multiplereturn)
            {
                oreturnobjs = $('#' + oPickerobj.tableid).datagrid('getChecked');
            } else
            {
                oreturnobj = $('#' + oPickerobj.tableid).datagrid('getSelected');
            }

            $("#" + oPickerobj.winid).icsWindow("close");
            $("#" + oPickerobj.winid).remove();
            if (oPickerobj.winclass == 'clsSupplier')
            {
                $('#divImportPIs').data('SupplierIDs',"");
                var nSupplierIDs = "";
                if (oPickerobj.multiplereturn)
                {
                    var ncount = 0;
                    for (var i = 0; i <oreturnobjs.length; i++) {
                        var nSupplierID = oreturnobjs[i].ContractorID;
                        nSupplierIDs = nSupplierIDs + nSupplierID + ',';
                        ncount++;
                    }
                    if (ncount > 1)
                    {
                        $('#txtSupplier').val("Select " + ncount + " Supplier's");
                    } else
                    {
                        $('#txtSupplier').val(oreturnobjs[0].Name);
                    }
                    nSupplierIDs = nSupplierIDs.substring(0, nSupplierIDs.length - 1);

                } else
                {
                    $('#txtSupplier').val(oreturnobj.Name);
                    nSupplierIDs = "" + oreturnobj.ContractorID + "";
                    $('#txtSupplier').focus();
                }
                $('#divImportPIs').data('SupplierIDs',nSupplierIDs);
                $("#txtSupplier").addClass('fontColorOfPickItem');
            }else  if (oPickerobj.winclass == 'clsAgent')
            {
                $('#divImportPIs').data('AgentIDs',"");
                var nAgentIDs = "";
                if (oPickerobj.multiplereturn)
                {
                    var ncount = 0;
                    for (var i = 0; i <oreturnobjs.length; i++) {
                        var nAgentID = oreturnobjs[i].ContractorID;
                        nAgentIDs = nAgentIDs + nAgentID + ',';
                        ncount++;
                    }
                    if (ncount > 1)
                    {
                        $('#txtAgent').val("Select " + ncount + " Agent's");
                    } else
                    {
                        $('#txtAgent').val(oreturnobjs[0].Name);
                    }
                    nAgentIDs = nAgentIDs.substring(0, nAgentIDs.length - 1);
                } else
                {
                    $('#txtAgent').val(oreturnobj.Name);
                    nAgentIDs = "" + oreturnobj.ContractorID + "";
                    $('#txtAgent').focus();
                }
                $('#divImportPIs').data('AgentIDs',nAgentIDs);
                $("#txtAgent").addClass('fontColorOfPickItem');
            }else  if (oPickerobj.winclass == 'clsProduct')
            {
                $('#divImportPIs').data('ProductIDs',"");
                var nProductIDs = "";
                if (oPickerobj.multiplereturn)
                {
                    var ncount = 0;
                    for (var i = 0; i <oreturnobjs.length; i++) {
                        var nProductID = oreturnobjs[i].ProductID;
                        nProductIDs = nProductIDs + nProductID + ',';
                        ncount++;
                    }
                    if (ncount > 1)
                    {
                        $('#txtProduct').val("Select " + ncount + " Product's");
                    } else
                    {
                        $('#txtProduct').val(oreturnobjs[0].Name);
                    }
                    nProductIDs = nProductIDs.substring(0, nProductIDs.length - 1);
                } else
                {
                    $('#txtProduct').val(oreturnobj.Name);
                    nProductIDs = "" + oreturnobj.ContractorID + "";
                    $('#txtProduct').focus();
                }
                $('#divImportPIs').data('ProductIDs',nProductIDs);
                $("#txtProduct").addClass('fontColorOfPickItem');
            }else  if (oPickerobj.winclass == 'clsBranch')
            {
                $('#divImportPIs').data('BankBranchIDs',"");
                var nBankBranchIDs = "";
                if (oPickerobj.multiplereturn)
                {
                    var ncount = 0;
                    for (var i = 0; i <oreturnobjs.length; i++) {
                        var nBankBranchID = oreturnobjs[i].BankBranchID;
                        nBankBranchIDs = nBankBranchIDs + nBankBranchID + ',';
                        ncount++;
                    }
                    if (ncount > 1)
                    {
                        $('#txtBankBranch').val("Select " + ncount + " BankBranch's");
                    } else
                    {
                        $('#txtBankBranch').val(oreturnobjs[0].Name);
                    }
                    nBankBranchIDs = nBankBranchIDs.substring(0, nBankBranchIDs.length - 1);
                } else
                {
                    $('#txtBankBranch').val(oreturnobj.Name);
                    nBankBranchIDs = "" + oreturnobj.ContractorID + "";
                    $('#txtBankBranch').focus();
                }
                $('#divImportPIs').data('BankBranchIDs',nBankBranchIDs);
                $("#txtBankBranch").addClass('fontColorOfPickItem');
            }
        }

        $(document).keydown(function (e) {
            //debugger;
            if (e.which == 27)//escape=27
            {
                //debugger;
                $("#winAdvSearchImportPI").icsWindow('close');
            }
        });

        $("#btnPrintPIList").click(function (){
            var oImportPIs= $('#tblImportPIs').datagrid('getRows');
            if(oImportPIs.length<=0)
            {
                alert("Data not found ");
                return;
            }
            var sImportPIIDs = "";
            for(var i = 0;i<oImportPIs.length;i++)
            {
                sImportPIIDs+= oImportPIs[i].ImportPIID+",";
            }
            sImportPIIDs = sImportPIIDs.substring(0, sImportPIIDs.length-1);
            var oImportPI = {Note:sImportPIIDs};
            $.ajax({
                type: "POST",
                dataType: "json",
                url : _sBaseAddress+  "/ImportPI/SetImportPIListData",
                traditional: true,
                data:  JSON.stringify(oImportPI),
                contentType: "application/json; charset=utf-8",
                success: function (data) {
                    var sFeedBackMessage = jQuery.parseJSON(data);
                    if (sFeedBackMessage==="Successful")
                    {
                        window.open (_sBaseAddress+ "/ImportPI/PrintImportPIs");
                    }
                },
                error: function (xhr, status, error) {
                    alert(error);
                }
            });
        });
        $("#btnPreViewPI").click(function () {
            debugger;
            var oImportPI = $('#tblImportPIs').datagrid('getSelected');
            if (oImportPI == null || oImportPI.ImportPIID <= 0) {
                alert("Please select an item from list!");
                return;
            }
            window.open(_sBaseAddress + '/ImportPI/PrintoImportPIPreview?id='+oImportPI.ImportPIID, "_blank");
        });
        $("#btnPrintGRN").click(function () {
            debugger;
            var oImportPI = $('#tblImportPIs').datagrid('getSelected');
            if (oImportPI == null || oImportPI.ImportPIID <= 0) {
                alert("Please select an item from list!");
                return;
            }
            window.open(_sBaseAddress + '/ImportPI/PrintInvoice_GRN?id='+oImportPI.ImportPIID, "_blank");
        });
    </script>


