@{
    ViewBag.Title = "Technical Sheets List";    
}
@model IEnumerable<ESimSol.BusinessObjects.TechnicalSheet>
<div id="winApprovalRequest" class="easyui-window" title="Request For Approval" data-options="modal:true,closed:true,collapsible:false,minimizable:false,maximizable:false,closable:false">
    <div style="font-family:Tahoma">
        <fieldset style="margin-top:3px">
            <table border="0" style="font-size:12px">
                <tr>
                    <td style="width:150px; text-align:right">Request To:</td>
                    <td style="width:250px; text-align:left"><select id="cboApprovalRequestTo" style="width:225px;font-size:12px;" /></td>
                </tr>
                <tr>
                    <td style="width:150px; text-align:right">Note :</td>
                    <td style="width:250px; text-align:left">
                        <input type="text" id="txtApprovalRequestNote" style="width:220px" />
                    </td>
                </tr>
            </table>
        </fieldset>

        <fieldset style="margin-bottom:3px">
            <legend style="font-weight:bold"> Action : </legend>
            <table border="0" cellspacing="2" cellpadding="2" style="font-size:11px; width:400px">
                <tr>
                    <td style="width:300px; text-align:right"></td>
                    <td style="width:50px">
                        <a id="btnApprovalRequestConfirm" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-save" plain="true">Confirm</a>
                    </td>
                    <td style="width:50px">
                        <a id="btnApprovalRequestClose" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-cancel" plain="true">Close</a>
                    </td>
                </tr>
            </table>
        </fieldset>
    </div>
</div>
 <div id="winTSAdvanceSearch" class="easyui-window winClass" title="Advance Search" data-options="modal:true,closed:true,collapsible:false,minimizable:false,maximizable:false,closable:false">
    <div style="width:760px; float: left;">
        <table border="0" cellpadding="0" cellspacing="0">
            <tr style="height:410px">
                <td style="width:850px">
                    <table border="0" cellpadding="0" cellspacing="0">
                        <tr style="height:400px">
                            <td style="width:300px; vertical-align:top;height:385px">
                                <fieldset style="height:98%;">
                                    <legend style="font-weight:bold; font-size:12px"> Searching Criteria : </legend>
                                    <table border="0" cellpadding="0" cellspacing="2">
                                        <tr>
                                            <td style="width:300px;font-size:12px;">
                                                Style Description:
                                            </td>
                                        </tr>
                                        <tr>
                                            <td style="width:350px">
                                                @Html.TextBox("txtStyleDescription", "", new { style = "width: 325px", id = "txtStyleDescription" })
                                            </td>
                                        </tr>
                                        <tr>
                                            <td style="width:300px;font-size:12px;">
                                                Prepared By:
                                            </td>
                                        </tr>
                                        <tr>
                                            <td style="width:350px">
                                                <select id="cboPreparedBy" style="width:325px;"></select>
                                            </td>
                                        </tr>

                                        <tr>
                                            <td style="width:300px;font-size:12px;">
                                                Entry Date:
                                            </td>
                                        </tr>
                                        <tr>
                                            <td style="width:300px">
                                                <table border="0" cellpadding="0" cellspacing="0">
                                                    <tr>
                                                        <td style="width:97px;font-size:12px;">@Html.DropDownList("cboTSDate", new SelectList(Enum.GetValues(typeof(ESimSol.BusinessObjects.EnumCompareOperator))), new { id = "cboTSDate", style = "width: 97px;font-size:12px;", @class = "_select_changeA" })</td>
                                                        <td style="width:97px;font-size:12px;"><input type="text" id="dtTSDateFrom" value="" style="width: 108px;font-size:12px;" class="easyui-datebox" data-options="formatter:icsdateformat,parser:icsdateparser" /></td>
                                                        <td style="width:9px;font-size:12px;" id="enddateT">To</td>
                                                        <td style="width:97px;font-size:12px;" id="enddate"><input type="text" id="dtTSDateTo" value="" style="width: 108px;font-size:12px;" class="easyui-datebox" data-options="formatter:icsdateformat,parser:icsdateparser" /></td>
                                                    </tr>
                                                </table>
                                            </td>
                                        </tr>
                                        <tr>
                                            <td style="width: 130px; text-align: left;font-size:12px;">
                                                Session:
                                            </td>
                                        </tr>
                                        <tr>
                                            <td style="width: 325px; text-align: left">
                                                <select id="cboSession_AdvSearch" style=" width:320px;"></select>
                                            </td>
                                        </tr>
                                        <tr>
                                            <td style="width:300px;font-size:12px;">
                                                Buyer Name:
                                            </td>
                                        </tr>
                                        <tr>
                                            <td style="width:300px;font-size:12px;">
                                                @Html.TextBox("txtBuyer", "", new { style = "width: 260px;font-size:12px;", id = "txtBuyer", placeholder = " Type Buyer & Press Enter" }) <input type="button" id="btnBuyerPicker" style="width:60px;" onclick="BuyerPiker()" value="Pick" />

                                            </td>
                                        </tr>
                                        <tr>
                                            <td style="width:300px;font-size:12px;">
                                                Merchandiser:
                                            </td>
                                        </tr>
                                        <tr>
                                            <td style="width:300px;font-size:12px;">
                                                @Html.TextBox("txtMerchandiser", "", new { style = "width: 260px;font-size:12px;", id = "txtMerchandiser", placeholder = "Type Merchandiser & Press Enter" }) <input type="button" style="width:60px;" onclick="MerchandiserPiker()" value="Pick" />
                                            </td>
                                        </tr>
                                        <tr>
                                            <td style="width:300px;font-size:12px;">
                                                Department:
                                            </td>
                                        </tr>
                                        <tr>
                                            <td style="width:300px;font-size:12px;">
                                                @Html.TextBox("txtDepartment", "", new { style = "width: 260px;font-size:12px;", id = "txtDepartment", placeholder = "Type Department & Press Enter" }) <input type="button" style="width:60px;" onclick="DepartmentPiker()" value="Pick" />
                                            </td>
                                        </tr>
                                        <tr style="height:55px; vertical-align:bottom">
                                            <td style=" text-align:left; width:330px;">
                                                <table border="0" cellpadding="0" cellspacing="0">
                                                    <tr>
                                                        <td style=" text-align:left;"><input type="button" value="Reset" id="btnReset" onclick="Reset()" style="width:70px; text-align:left;" /></td>
                                                        <td style=" text-align:right; width:260px;"><input type="button" value="Search" id="btnRefresh" style="width:70px; text-align:right;" /></td>
                                                    </tr>
                                                </table>
                                            </td>
                                        </tr>
                                    </table>
                                </fieldset>
                            </td>
                            <td style="width:400px; vertical-align:top">
                                <div style="margin-left:0px; margin-top:6px; height:400px">
                                    <table id="tblTechnicalsList" title="Technical Sheet List" class="easyui-datagrid" style="width:400px;height:375px" fitcolumns="false" rownumbers="true" pagination="false" singleselect="false" autorowheight="false">
                                        <thead>
                                            <tr>
                                                <th data-options="field:'Selected',checkbox:true"></th>
                                                <th field="StyleNo" width="60"> Style No </th>
                                                <th field="TSTypeInString" width="60"> TS Type </th>
                                                <th field="SessionName" width="80"> Session </th>
                                                <th field="DevelopmentStatusInString" width="100"> Status </th>
                                                <th field="BuyerName" width="140"> Buyer Name </th>
                                            </tr>
                                        </thead>
                                    </table>
                                </div>
                            </td>
                        </tr>
                    </table>
                </td>
            </tr>
            <tr style="height:50px">
                <td style="width:850px; text-align:right">
                    <a href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-ok" plain="true" onclick="OkButtonClick()">Ok</a>
                    <a href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-cancel" plain="true" onclick="Close()">Close</a>
                </td>
            </tr>
        </table>
    </div>
  </div>


<div class="menuMainCollectionTable">
  <table id="tblTechnicalSheets" title="Technical Sheet List" class="easyui-datagrid"fit="true" fitcolumns="true" rownumbers="true" pagination="true"singleselect="true" autorowheight="false" toolbar="#toolbar">
     <thead>
            <tr>
                <th field="StyleNo" width="60"> Style No </th>
                <th field="TSTypeInString" width="60"> TS Type </th>
                <th field="SessionName" width="80"> Session </th>
                <th field="DevelopmentStatusInString" width="100"> Status </th>
                <th field="BuyerName" width="140"> Buyer Name </th>
                <th field="BrandName" width="100">Brand</th>
                <th field="ProductName" width="130"> Product Name </th>
                <th field="YarnCategoryName" width="130"> Fabric Content </th>
                <th field="SizeRange" width="100"> Size Range</th>
                <th field="DBServerDateTimeInSt" width="100"> Entry Date</th>
                <th field="UserName" width="100">Prepared By</th>            
                <th field="TSCountInString" width="80" formatter="formatAttachment" align="center">Attachment</th>    
            </tr>
    </thead>
   </table>
  <div id="toolbar">
            <input type="text" id="txtStyleNo" placeholder="Type Style No & Press Enter" style="width: 150px;" />
            <select id="cboBuyer" style="width: 120px;font-size:12px;"></select>
            <select id="cboSession" style="width:90px;font-size:12px;"></select>
            <select id="cboMerchendiser" style="width:90px;font-size:12px;"></select>
            <a id="btnSearch" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-search" plain="true" onclick="Search()"></a>
            <a id="btnAdvSearch" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-search" plain="true" onclick="AdvanceSearch()">Search</a>
            <a id="btnAdd" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-add" plain="true" onclick="Add()">Add</a>
            <a id="btnEdit" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-edit" plain="true" onclick="Edit()">Edit</a>
            <a id="btnView" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-details" plain="true" onclick="Details()">View</a>
            <a id="btnCopy" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-copy" plain="true" onclick="CopyStyle()">Copy</a>
            <a id="btnDelete" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-remove" plain="true" onclick="Delete()">Delete</a>
            <a id="btnReqForApproved" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-redo" plain="true" onclick="RequestForApproval()">R. for App</a>
            <a id="btnWaitforApproval" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-waitforapproval" plain="true" onclick="WaitforApproval()"> Wait for App</a>
            <a id="btnApproved" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-approved" plain="true">Approved</a>
            <a id="btnUploadDesignSketche" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-add" plain="true" onclick="UploadDesignsketches()"> Up Image</a>
            <a id="btnPreview" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-print" plain="true" onclick="Sheetprint()">Preview</a>
            <a id="btnPrint" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-print" plain="true" onclick="PrintList()"> Print</a>
            <a id="btnBillOfMaterial" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-details" plain="true">Material</a>
            <a id="btnPAM" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-details" plain="true">PAM</a>
            <a id="btnAttachment" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-attachment" plain="true" onclick="Attachiment()">Attachment</a>
        </div>
 </div>
<script type="text/javascript">
    var _oTechnicalSheets=[];
    var oBusinessSessions = [];    
    var _sBaseAddress = "";
    $(document).ready(function () {
        debugger;
        _sBaseAddress =@Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(HttpContext.Current.Session[SessionInfo.BaseAddress]));
        _oTechnicalSheets =@Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(Model));
        var oAuthorizationRolesMapping =@Html.Raw( new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(HttpContext.Current.Session[SessionInfo.AuthorizationRolesMapping]));
        var oEmployees = @Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(ViewBag.Employees));
        var BUID = @Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(ViewBag.BUID));
        oBusinessSessions = @Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(ViewBag.BusinessSessions));
        var oBuyers = @Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(ViewBag.Buyers));
        var oUsers = @Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(ViewBag.Users));
        $('#txtDepartment').data('DepartmentIDs',"");
        $('#txtMerchandiser').data('MerchandiserIDs',"");
        $('#txtBuyer').data('BuyerIDs',"");
        sessionStorage.setItem("BUID",BUID);
        var oTechnicalSheets =sessionStorage.getItem("TechnicalSheets");
        if(oTechnicalSheets!=null)
        {
            oTechnicalSheets = jQuery.parseJSON(oTechnicalSheets);
        }
        else
        {
            oTechnicalSheets=_oTechnicalSheets;
        }
        RefreshList(oTechnicalSheets);
        $("#cboBuyer").icsLoadCombo({ List: oBuyers, OptionValue: "ContractorID", DisplayText: "Name" ,InitialValue:"-Select Buyer-" });
        $("#cboSession").icsLoadCombo({ List: oBusinessSessions, OptionValue: "BusinessSessionID", DisplayText: "SessionName",InitialValue:"-Season-" });
        $("#cboMerchendiser").icsLoadCombo({ List: oEmployees, OptionValue: "EmployeeID", DisplayText: "Name", InitialValue:"-Merchendiser-"});
        $("#cboPreparedBy").icsLoadCombo({ List: oUsers, OptionValue: "UserID", DisplayText: "UserName" , InitialValue:"-Prepared By-"});
        $('#cboBuyer,#cboSession,#cboMerchendiser').val(0);
        RefreshControlLayout(oAuthorizationRolesMapping);
    });

    //start Advance search
    $("#btnAdvSearch").click(function () {
        $("#winTSAdvanceSearch").icsWindow('open', "Advance Search");
        $("#winTSAdvanceSearch input").not("input[type='button']").val("");
        $("#winTSAdvanceSearch select").val(0);
        SetTodayDate();
        Reset();
    });
    function SetTodayDate()
    {
        $('#dtTSDateFrom').datebox('setValue', icsdateformat(new Date()));
        $('#dtTSDateTo').datebox('setValue', icsdateformat(new Date()));
    }
    $('._select_changeA').change(function () {
        //debugger;
        var x = $("#cboTSDate").val();
        if (x == "EqualTo" || x == "NotEqualTo" || x == "GreaterThen" || x == "SmallerThen") {
            document.getElementById("enddate").style.display = 'none';
            document.getElementById("enddateT").style.display = 'none';
        }
        else {
            document.getElementById("enddate").style.display = '';
            document.getElementById("enddateT").style.display = '';
        }
        if (x == "None")
        {

            $('#dtTSDateFrom').datebox('setValue', icsdateformat(new Date()));
            $('#dtTSDateTo').datebox('setValue', icsdateformat(new Date()));
        }
    });

    $('#btnRefresh').click(function () {
        debugger;
        var sStyleDescription= $("#txtStyleDescription").val();
        var cboTSDate = document.getElementById("cboTSDate");
        var nOrderCreateDate=cboTSDate.options[cboTSDate.selectedIndex].index;
        var sOrderDates=$('#dtTSDateFrom').datebox('getValue');
        var sOrderDatee=$('#dtTSDateTo').datebox('getValue');
        var nPreparedBy = $("#cboPreparedBy").val();
        var nBusinessSession = $("#cboSession_AdvSearch").val();
   
        if(nOrderCreateDate==0 && sStyleDescription==""  && nPreparedBy==0 && nBusinessSession==0 && $('#txtDepartment').data('DepartmentIDs')=="" && $('#txtMerchandiser').data('MerchandiserIDs')=="" && $('#txtBuyer').data('BuyerIDs')=="")
        {
            alert('Please Select a Search Criteria');
            return false;
        }
        var sTempString = nOrderCreateDate+'~'+sOrderDates+'~'+sOrderDatee+'~'+sStyleDescription+'~'+nPreparedBy+'~'+sessionStorage.getItem("BUID")+'~'+nBusinessSession+'~'+$('#txtDepartment').data('DepartmentIDs')+'~'+$('#txtMerchandiser').data('MerchandiserIDs')+'~'+$('#txtBuyer').data('BuyerIDs');
        $.ajax({
            type: "GET",
            dataType: "json",
            url: '@Url.Action("AdvanceSearch", "TechnicalSheet")',
            data: { Temp: sTempString },
            contentType: "application/json; charset=utf-8",
            success: function (data) {
                ////debugger;
                oTechnicalSheets = jQuery.parseJSON(data);
                if (oTechnicalSheets != null) {
                    if(oTechnicalSheets.length>0)
                    {
                        RefreshListForSearch(oTechnicalSheets);
                    }
                    else
                    {
                        alert("Data not found!!");
                        RefreshListForSearch([]);
                    }
                }
            },
            error: function (xhr, status, error) {
                alert(error);
            }
        });

    });

    function Reset() {
        debugger;
        $("#cboSession_AdvSearch").icsLoadCombo({ List: oBusinessSessions, OptionValue: "BusinessSessionID", DisplayText: "SessionName" });
        $("#txtStyleDescription,#txtDepartment,#txtMerchandiser,#txtBuyer").val('');
        document.getElementById("enddate").style.display = '';
        document.getElementById("enddateT").style.display = '';
        $("#cboPreparedBy,#cboSession_AdvSearch").val(0);
        $('#cboTSDate').val('None');
        $('#txtDepartment').data('DepartmentIDs',"");
        $('#txtMerchandiser').data('MerchandiserIDs',"");
        $('#txtBuyer').data('BuyerIDs',"");
        $('#txtDepartment,#txtMerchandiser,#txtBuyer').removeClass('fontColorOfPickItem');
        SetTodayDate();
        RefreshListForSearch([]);
    }
    function RefreshListForSearch(oList)
    {
        data =oList;
        data={"total":""+data.length+"","rows":data};
        $('#tblTechnicalsList').datagrid('loadData',data);
    }
    function Close()
    {
        $("#winTSAdvanceSearch").icsWindow('close');
    }

    function OkButtonClick() {
        debugger;
        var oTechnicalSheets=[];
        var oTechnicalSheets = $('#tblTechnicalsList').datagrid('getChecked');
        if(oTechnicalSheets.length<=0)
        {
            alert("please select at least one item");
            return;
        }
        RefreshList(oTechnicalSheets);
        $("#winTSAdvanceSearch").icsWindow('close');
    }



    //Attachment Count start
    function formatAttachment(value)
    {
        debugger
        var values;
        var nTechnicalSheetID=0;
        var nAttachmentCount=0;
        var sStyleNo = '';
        if(value!=undefined)
        {
            values=value.split("~");
            nTechnicalSheetID=values[0];
            nAttachmentCount=values[1];
            sStyleNo = values[2];
        }
        var s = '<a  href="javascript:void(0)"  onclick = "StyleAttachment('+nTechnicalSheetID+','+sStyleNo+')"">'+nAttachmentCount+'</a>';
        return s;
    }    
    function StyleAttachment( nTechnicalSheetID, sStyleNo)
    {
        debugger;

        if(nTechnicalSheetID<=0)
        {
                alert("Sorry, there is No Technical Sheet.!");
                return;
        }
                
        //EnumAttchRefType : 1 Production Order;2 Delivery Order;3 Style ..... 19:Order Recap Packing Policy        
        window.open(_sBaseAddress + '/AttachDocument/Attachment?id='+nTechnicalSheetID+'&RefType=19&OperationInfo= Attachment of Style No : '+sStyleNo, '_blank');
    }

    //end Advance Search
    $(document).keydown(function (e) { if (e.keyCode == 27) { $('#winBuyers').icsWindow('close'); } });
    $('#btnBillOfMaterial').click(function(){
        var oTechnicalSheet= $('#tblTechnicalSheets').datagrid('getSelected');
        if(oTechnicalSheet==null || oTechnicalSheet.TechnicalSheetID<=0)
        {
            alert("Please select a item from list!");
            return;
        }
        var SelectedRowIndex=$('#tblTechnicalSheets').datagrid('getRowIndex',oTechnicalSheet);
        var tsv=((new Date()).getTime())/1000;
        var oTechnicalSheets= $('#tblTechnicalSheets').datagrid('getRows');
        sessionStorage.setItem("TechnicalSheets", JSON.stringify(oTechnicalSheets));
        sessionStorage.setItem("TSSelectedRowIndex", SelectedRowIndex);
        sessionStorage.setItem("BackLink", window.location.href);
        window.location.href = _sBaseAddress+ "/BillOfMaterial/ViewBillOfMaterial?tsid="+oTechnicalSheet.TechnicalSheetID+"&ms=''&ts="+tsv;
    });

    
    $('#btnPAM').click(function(){
        var oTechnicalSheet= $('#tblTechnicalSheets').datagrid('getSelected');
        if(oTechnicalSheet==null || oTechnicalSheet.TechnicalSheetID<=0)
        {
            alert("Please select a item from list!");
            return;
        }
        var SelectedRowIndex=$('#tblTechnicalSheets').datagrid('getRowIndex',oTechnicalSheet);
        var tsv=((new Date()).getTime())/1000;
        var oTechnicalSheets= $('#tblTechnicalSheets').datagrid('getRows');
        sessionStorage.setItem("TechnicalSheets", JSON.stringify(oTechnicalSheets));
        sessionStorage.setItem("TSSelectedRowIndex", SelectedRowIndex);
        sessionStorage.setItem("BackLink", window.location.href);
        window.open(_sBaseAddress+ "/PAM/ViewPAMs?id="+oTechnicalSheet.TechnicalSheetID+"&ts="+tsv, '_blank');
        
    });

    $('#txtStyleNo').keypress(function (e)
    {
        var code = (e.keyCode ? e.keyCode : e.which);
        if (code == 13) {
            var txtStyleNo = document.getElementById('txtStyleNo').value;
            if(txtStyleNo!="")
            {
                //debugger;
                var tsv=((new Date()).getTime())/1000;
                $.ajax
             ({
                 type: "GET",
                 dataType: "json",
                 url : _sBaseAddress+"/TechnicalSheet/SearchStyle",
                 data: {sStyleNo:txtStyleNo,sBUIDs:''+sessionStorage.getItem('BUID'), ts:tsv},
                 contentType: "application/json; charset=utf-8",
                 success: function (data) {
                     //debugger;
                     var _oTechnicalSheets = jQuery.parseJSON(data);
                     if (_oTechnicalSheets.length>0)
                     {
                         var  data=_oTechnicalSheets;
                         data={"total":""+data.length+"","rows":data};
                         $('#tblTechnicalSheets').datagrid('loadData',data);
                     }
                     else
                     {
                         alert("Data Not found");
                     }
                 },
                 error: function (xhr, status, error)
                 {
                     alert(error);
                 }
             });             //debugger;

            }
        }

    });

    $('#txtStyleNo').keydown(function (e) {
        var code = (e.keyCode ? e.keyCode : e.which);
        if (code == 8) //backspace=8
        {
            var txtStyleNo=document.getElementById("txtStyleNo");
            //txtStyleNo.value='';
            txtStyleNo.style.color="Normal";
            txtStyleNo.style.fontWeight="Black";

        }
    });

    function Search()
    {
        //debugger;
        var parameter="";
        var cboBuyer = document.getElementById("cboBuyer");
        var styleno=document.getElementById("txtStyleNo").value;
        var cboSession = document.getElementById("cboSession");
        var cboMerchendiser = document.getElementById("cboMerchendiser");
        var nEmployeeID = $('#cboMerchendiser').val();
        if((styleno== "Style No" || styleno=="" || styleno==null || cboMerchendiser=="") && cboBuyer.options[cboBuyer.selectedIndex].value<=0 && cboSession.options[cboSession.selectedIndex].text =="--Session--" && nEmployeeID<=0)
        {
            alert("Please select at least one searching criteria");
            return;
        }
        if(cboBuyer.options[cboBuyer.selectedIndex].value>0)
        {
            parameter=parameter+cboBuyer.options[cboBuyer.selectedIndex].value;
        }
        else
        {
            parameter=parameter+'0';
        }


        if(styleno!=null)
        {
            if(styleno!="")
            {
                parameter=parameter+'~'+styleno;
            }
            else
            {
                parameter=parameter+'~'+"";
            }
        }
        else
        {
            parameter=parameter+'~'+"";
        }


        if(parseInt(cboSession.options[cboSession.selectedIndex].value)>0)
        {
            parameter=parameter+'~'+ parseInt(cboSession.options[cboSession.selectedIndex].value);
        }
        else
        {
            parameter=parameter+'~'+"0";
        }

        if(parseInt(nEmployeeID)>0)
        {
            parameter=parameter+'~'+nEmployeeID;
        }
        else
        {
            parameter=parameter+'~'+'0';
        }


        var oTechnicalSheet={
            Note:parameter,
            BUID:sessionStorage.getItem("BUID")
        }
        $.ajax
        ({
            type: "POST",
            dataType: "json",
            url : _sBaseAddress+  "/TechnicalSheet/Gets",
            data:  JSON.stringify(oTechnicalSheet),
            contentType: "application/json; charset=utf-8",
            success: function (data) {
                ////debugger;
                oTechnicalSheets = jQuery.parseJSON(data);
                if(oTechnicalSheets!=null)
                {
                    data=oTechnicalSheets;
                    data={"total":""+data.length+"","rows":data};
                    $('#tblTechnicalSheets').datagrid('loadData',data);
                }
                else
                {
                    data=[];
                    data={"total":""+data.length+"","rows":data};
                    $('#tblTechnicalSheets').datagrid('loadData',data);
                }
            },
            error: function (xhr, status, error)
            {
                alert(error);
            }

        });
    }

    function AdvanceSearch()
    {

    }

    function WaitforApproval()
    {
        var oTechnicalSheet= {BUID:sessionStorage.getItem("BUID")};
        $.ajax
        ({
            type: "POST",
            dataType: "json",
            url : _sBaseAddress+"/TechnicalSheet/WaitForApproval",
            data:  JSON.stringify(oTechnicalSheet),
            contentType: "application/json; charset=utf-8",
            success: function (data) {
                //debugger;
                oTechnicalSheets = jQuery.parseJSON(data);
                if (oTechnicalSheets.length>0)
                {
                    var  data=oTechnicalSheets;
                    data={"total":""+data.length+"","rows":data};
                    $('#tblTechnicalSheets').datagrid('loadData',data);
                }
                else
                {
                    alert("Data Not found");
                    var  data=[];
                    data={"total":""+data.length+"","rows":data};
                    $('#tblTechnicalSheets').datagrid('loadData',data);
                }
            },
            error: function (xhr, status, error)
            {
                alert(error);
            }

        });
    }

    function UploadDesignsketches()
    {
        ////debugger;
        var oTechnicalSheet= $('#tblTechnicalSheets').datagrid('getSelected');
        if(oTechnicalSheet==null || oTechnicalSheet.TechnicalSheetID<=0)
        {
            alert("Please select a item from list!");
            return;
        }
        var SelectedRowIndex=$('#tblTechnicalSheets').datagrid('getRowIndex',oTechnicalSheet);
        var oTechnicalSheets= $('#tblTechnicalSheets').datagrid('getRows');
        sessionStorage.setItem("TechnicalSheets", JSON.stringify(oTechnicalSheets));
        sessionStorage.setItem("TSSelectedRowIndex",SelectedRowIndex);
        sessionStorage.setItem("TSHeader", oTechnicalSheet.StyleNo);
        sessionStorage.setItem("EntryFromTSList", true);
        sessionStorage.setItem("BackLink", window.location.href);
        window.location.href = _sBaseAddress+ "/TechnicalSheet/ImageHelper?id="+oTechnicalSheet.TechnicalSheetID;
    }


    $('#txtStyleNo').keypress(function (e) {
        ////debugger;
        var c = String.fromCharCode(e.which);
        var txtStyleNo = document.getElementById('txtStyleNo').value;
        txtStyleNo = txtStyleNo + c;
        var bFlag=false;
        var sTempCode="";
        var rows = $('#tblTechnicalSheets').datagrid('getRows');
        for(i=0;i<rows.length;++i)
        {
            sTempCode=rows[i]['StyleNo'].substring(0, txtStyleNo.length);
            if(txtStyleNo.toUpperCase()==sTempCode.toUpperCase())
            {
                bFlag=true;
                break;
            }
        }
        if(bFlag)
        {
            $('#tblTechnicalSheets').datagrid('selectRow', i);
        }
    });

    function ClearStyleNofield()
    {
        $("#txtStyleNo")[0].value='';
    }

    function Refresh()
    {
        var oTechnicalSheets = $('#tblTechnicalSheets').datagrid('getRows');
        data=oTechnicalSheets;
        data={"total":""+data.length+"","rows":data};
        $('#tblTechnicalSheets').datagrid('loadData',data);
    }

    function RequestForApproval()
    {
        ////debugger;
        var oTechnicalSheet= $('#tblTechnicalSheets').datagrid('getSelected');
        if(oTechnicalSheet==null || oTechnicalSheet.TechnicalSheetID<=0)
        {
            alert("Please select a item from list!");
            return;
        }

        if(oTechnicalSheet.DevelopmentStatus!=0)
        {
            alert("Please select Only Initilized Item");
            return;
        }

        var SelectedRowIndex=$('#tblTechnicalSheets').datagrid('getRowIndex', oTechnicalSheet);
        var oEmployee = { DesignationName : '23' };//Merchandiser
        $.ajax({
            type: "POST",
            dataType: "json",
            url : _sBaseAddress+"/User/GetsRequestedUsers",
            traditional: true,
            data:  JSON.stringify(oEmployee),
            contentType: "application/json; charset=utf-8",
            success: function (data) {
                var oUsers = jQuery.parseJSON(data);
                if(oUsers===null){ oUsers=[]; }
                $("#cboApprovalRequestTo").icsLoadCombo({ List: oUsers, OptionValue: "UserID", DisplayText: "UserName" });
                 $("#winApprovalRequest").icsWindow('open', "Request For Approval");
                $("#winApprovalRequest input").not("input[type='button']").val("");
            },
            error: function (xhr, status, error) {
                alert(error);
            }
        });

    }

    $('#btnApprovalRequestClose').click(function(e){
        $("#winApprovalRequest").icsWindow('close');
    });

    $('#btnApprovalRequestConfirm').click(function(e){
        var oTechnicalSheet = $('#tblTechnicalSheets').datagrid('getSelected');
        if(oTechnicalSheet==null || parseInt(oTechnicalSheet.TechnicalSheetID)<=0)
        {
            alert("Please select a item from list!");
            return;
        }
        if(parseInt($('#cboApprovalRequestTo').val())==0)
        {
            alert('Please Select Approval User');
            $('#cboApprovalRequestTo').focus();
            return false;
        }
        var oApprovalRequest= {
            ApprovalRequestID :0,
            OperationObjectID : parseInt(oTechnicalSheet.TechnicalSheetID),
            RequestTo : parseInt($('#cboApprovalRequestTo').val()),
            Note :$.trim($("#txtApprovalRequestNote").val())
        };

        var SelectedRowIndex=$('#tblTechnicalSheets').datagrid('getRowIndex', oTechnicalSheet);
        $.ajax({
            type: "POST",
            dataType: "json",
            url : _sBaseAddress+"/TechnicalSheet/RequestForApproval",
            traditional: true,
            data:  JSON.stringify(oApprovalRequest),
            contentType: "application/json; charset=utf-8",
            success: function (data) {
                var oTechnicalSheet = jQuery.parseJSON(data);
                if(oTechnicalSheet!=null)
                {
                    if(oTechnicalSheet.ErrorMessage=="" || oTechnicalSheet.ErrorMessage == null)
                    {
                         alert("Style Approval Request  Successfully.");
                        $('#tblTechnicalSheets').datagrid('updateRow',{index: SelectedRowIndex,	row: oTechnicalSheet});
                        $("#winApprovalRequest").icsWindow('close');
                    }
                    else
                    {
                        alert(oTechnicalSheet.ErrorMessage);
                    }
                }
                else
                {
                    alert("Invalid Operation!");
                }
            },
            error: function (xhr, status, error) {
                alert(error);
            }
        });

    });

    $('#btnApproved').click(function(){
        debugger;
        var oTechnicalSheet= $('#tblTechnicalSheets').datagrid('getSelected');
        if(oTechnicalSheet==null || oTechnicalSheet.TechnicalSheetID<=0)
        {
            alert("Invalid Field!!! please select a valid Field!");
            return false;
        }
        if (!confirm("Confirm to Approved?")) return ;
        var SelectedRowIndex=$('#tblTechnicalSheets').datagrid('getRowIndex',oTechnicalSheet);

        if (oTechnicalSheet.TechnicalSheetID > 0)
        {
            oTechnicalSheet.DevelopmentStatusInInt=2;
            $.ajax
            ({
                type: "POST",
                dataType: "json",
                url : _sBaseAddress+  "/TechnicalSheet/Approved",
                data:  JSON.stringify(oTechnicalSheet),
                contentType: "application/json; charset=utf-8",
                success: function (data) {
                    ////debugger;
                    oTechnicalSheet = jQuery.parseJSON(data);
                    if(oTechnicalSheet!=null)
                    {
                        if(oTechnicalSheet.ErrorMessage=="")
                        {
                            alert('Data save Successfully');
                            $('#tblTechnicalSheets').datagrid('updateRow',{index: SelectedRowIndex,	row: oTechnicalSheet});
                        }
                        else
                        {
                            alert(oTechnicalSheet.ErrorMessage);
                        }
                    }
                    else
                    {
                        alert(oTechnicalSheet.ErrorMessage);
                    }
                },
                error: function (xhr, status, error)
                {
                    alert(error);
                }

            });
        }

    });


    function Add()
    {
        var tsv=((new Date()).getTime())/1000;
        var oTechnicalSheets= $('#tblTechnicalSheets').datagrid('getRows');
        sessionStorage.setItem("TechnicalSheets", JSON.stringify(oTechnicalSheets));
        sessionStorage.setItem("TSSelectedRowIndex", -1);
        sessionStorage.setItem("TSHeader", "Add Technicalsheet");
        sessionStorage.setItem("BackLink", window.location.href);
        window.location.href = _sBaseAddress+ "/TechnicalSheet/ViewTechnicalSheet?id=0&ts="+tsv;
    }
    function Edit()
    {
        //debugger;
        var oTechnicalSheet= $('#tblTechnicalSheets').datagrid('getSelected');
        if(oTechnicalSheet==null || oTechnicalSheet.TechnicalSheetID<=0)
        {
            alert("Please select a item from list!");
            return;
        }
        var SelectedRowIndex=$('#tblTechnicalSheets').datagrid('getRowIndex',oTechnicalSheet);
        var tsv=((new Date()).getTime())/1000;
        var oTechnicalSheets= $('#tblTechnicalSheets').datagrid('getRows');
        sessionStorage.setItem("TechnicalSheets", JSON.stringify(oTechnicalSheets));
        sessionStorage.setItem("TSSelectedRowIndex", SelectedRowIndex);
        sessionStorage.setItem("TSHeader", "Edit TechnicalSheet");
        sessionStorage.setItem("BackLink", window.location.href);
        window.location.href = _sBaseAddress+ "/TechnicalSheet/ViewTechnicalSheet?id="+oTechnicalSheet.TechnicalSheetID+"&ts="+tsv;

    }
    function Details()
    {
        var oTechnicalSheet= $('#tblTechnicalSheets').datagrid('getSelected');
        if(oTechnicalSheet==null || oTechnicalSheet.TechnicalSheetID<=0)
        {
            alert("Please select a item from list!");
            return;
        }
        var SelectedRowIndex=$('#tblTechnicalSheets').datagrid('getRowIndex',oTechnicalSheet);
        var tsv=((new Date()).getTime())/1000;
        var oTechnicalSheets= $('#tblTechnicalSheets').datagrid('getRows');
        sessionStorage.setItem("TechnicalSheets", JSON.stringify(oTechnicalSheets));
        sessionStorage.setItem("TSSelectedRowIndex", SelectedRowIndex);
        sessionStorage.setItem("TSHeader", "View TechnicalSheet");
        sessionStorage.setItem("BackLink", window.location.href);
        window.location.href = _sBaseAddress+ "/TechnicalSheet/ViewTechnicalSheet?id="+oTechnicalSheet.TechnicalSheetID+"&ts="+tsv;

    }
    function CopyStyle()
    {
        //debugger;
        var oTechnicalSheet= $('#tblTechnicalSheets').datagrid('getSelected');
        if(oTechnicalSheet==null || oTechnicalSheet.TechnicalSheetID<=0)
        {
            alert("Please select a item from list!");
            return;
        }
        var SelectedRowIndex=$('#tblTechnicalSheets').datagrid('getRowIndex',oTechnicalSheet);
        var tsv=((new Date()).getTime())/1000;
        var oTechnicalSheets= $('#tblTechnicalSheets').datagrid('getRows');
        sessionStorage.setItem("TechnicalSheets", JSON.stringify(oTechnicalSheets));
        sessionStorage.setItem("TSSelectedRowIndex", -1);
        sessionStorage.setItem("TSHeader", "Copy TechnicalSheet");
        window.location.href = _sBaseAddress+ "/TechnicalSheet/ViewTechnicalSheet?id="+oTechnicalSheet.TechnicalSheetID+"&ts="+tsv;
    }
    function Delete()
    {
        ////debugger;
        var oTechnicalSheet= $('#tblTechnicalSheets').datagrid('getSelected');
        if (!confirm("Confirm to Delete?")) return ;

        if(oTechnicalSheet==null || oTechnicalSheet.TechnicalSheetID<=0)
        {
            alert("Invalid Field!!! please select a valid Field!");
            return false;
        }
        var SelectedRowIndex=$('#tblTechnicalSheets').datagrid('getRowIndex',oTechnicalSheet);

        if (oTechnicalSheet.TechnicalSheetID > 0)
        {
            $.ajax
            ({
                type: "GET",
                dataType: "json",
                url : _sBaseAddress+  "/TechnicalSheet/Delete",
                data: { id: oTechnicalSheet.TechnicalSheetID},
                contentType: "application/json; charset=utf-8",
                success: function (data) {
                    ////debugger;
                    feedbackmessage = jQuery.parseJSON(data);
                    if (feedbackmessage == "Data delete successfully")
                    {
                        alert("Delete sucessfully");
                        $('#tblTechnicalSheets').datagrid('deleteRow',SelectedRowIndex);

                    }
                    else
                    {
                        alert(feedbackmessage);
                    }
                },
                error: function (xhr, status, error)
                {
                    alert(error);
                }

            });
        }
    }
    function RefreshList(oTechnicalSheets)
    {
        data=oTechnicalSheets;
        data={"total":""+data.length+"","rows":data};
        $('#tblTechnicalSheets').datagrid('loadData',data);
        var nIndex= parseInt(sessionStorage.getItem("TSSelectedRowIndex"));
        $('#tblTechnicalSheets').datagrid('selectRow',nIndex);

        //$('#tblTechnicalSheetss').datagrid({onSelect: function(rowIndex, rowData){ RowSelect(rowIndex, rowData);}});
    }
    function TechnicalSheetBranch()
    {
        ////debugger;
        var oTechnicalSheet = $('#tblTechnicalSheetss').datagrid('getSelected');
        if(oTechnicalSheet==null || oTechnicalSheet.TechnicalSheetID<=0)
        {
            alert("Please select a item from list!");
            return;
        }
        window.location.href = '/TechnicalSheetBranch/Add?id='+oTechnicalSheet.TechnicalSheetID;
    }
    function Sheetprint()
    {
        var oTechnicalSheet= $('#tblTechnicalSheets').datagrid('getSelected');
        if(oTechnicalSheet==null || oTechnicalSheet.TechnicalSheetID<=0)
        {
            alert("Please select a item from list!");
            return;
        }
        window.open(_sBaseAddress + '/TechnicalSheet/PrintTechnicalSheet?id='+oTechnicalSheet.TechnicalSheetID);

    }
    function PrintList()
    {
        //debugger;


        var oTechnicalsheets= $('#tblTechnicalSheets').datagrid('getRows');
        var ids ="";
        if(oTechnicalsheets.length >0)
        {

            for(var i =0;i<oTechnicalsheets.length;i++)
            {
                ids =ids+oTechnicalsheets[i].TechnicalSheetID+",";
            }
            ids= ids.substring(0, ids.length - 1);
        }
        else{

            alert("Data not found ");
            return;
        }



        window.open(_sBaseAddress + '/TechnicalSheet/PrintTechnicalSheets?sParam='+ids);
    }
    function Report()
    {
        //    //debugger;
        //       var parameter="";
        //    var cboBuyer = document.getElementById("cboBuyer");
        //    if(cboBuyer.options[cboBuyer.selectedIndex].value>0)
        //    {
        //        parameter=parameter+cboBuyer.options[cboBuyer.selectedIndex].value;
        //    }
        //    else
        //    {
        //        parameter=parameter+'0';
        //    }

        //    var styleno=document.getElementById("txtStyleNo").value;
        //    if(styleno!=null)
        //    {
        //        if(styleno!="")
        //        {
        //            parameter=parameter+'~'+styleno;
        //        }
        //        else
        //        {
        //            parameter=parameter+'~'+"";
        //        }
        //    }
        //    else
        //    {
        //        parameter=parameter+'~'+"";
        //    }

        window.open('/Report/About.aspx');
        //  window.open('/WebForm1.aspx');
    }

    // Search By Merchandiser Start
    $("#txtMerchandiser").keydown(function (e)
    {
        var code = (e.keyCode ? e.keyCode : e.which);
        if (code == 13) // Enter Press
        {
            if( $('#txtMerchandiser').val()==null ||  $('#txtMerchandiser').val()=="")
            {
                alert("Type Merchandiser & Press Enter");
                return;
            }
            MerchandiserPiker();
        }else if (code == 8) //backspace=8
        {
            $('#txtMerchandiser').removeClass('fontColorOfPickItem');
            $('#txtMerchandiser').data('MerchandiserIDs',"");
        }
    });
    function MerchandiserPiker(){
        //
        var oEmployee = { Name: $('#txtMerchandiser').val(),EmployeeTypeID:23};//EnumEmployeeType:23-Merchandiser
        var obj = {
            BaseAddress: _sBaseAddress,
            Object: oEmployee,
            ControllerName: "Employee",
            ActionName: "EmployeeSearchByName",
            IsWinClose: false
        };
        $.icsDataGets(obj, function (response) {

            if (response.status && response.objs.length > 0) {
                if (response.objs[0].EmployeeID > 0) {

                    var tblColums = []; var oColumn = { field: "Name", title: "Name", width: 150, align: "left" }; tblColums.push(oColumn);
                    var oPickerParam = {
                        winid: 'winMerchandisers',
                        winclass: 'clsMerchandiser',
                        winwidth: 600,
                        winheight: 460,
                        tableid: 'tblMerchandisers',
                        tablecolumns: tblColums,
                        datalist: response.objs,
                        multiplereturn: true,
                        searchingbyfieldName: 'Name',
                        windowTittle: 'Merchandiser List'
                    };
                    $.icsPicker(oPickerParam);
                    IntializePickerbutton(oPickerParam);
                }
                else { alert(response.objs[0].ErrorMessage); }
            }else
            {
                alert("Data Not Found.");
            }
        });
    }
    //Merchandiser Search End

    //start Buyer
    $("#txtBuyer").keydown(function (e) {

        var code = (e.keyCode ? e.keyCode : e.which);
        if (code == 13) // Enter Press
        {
            if($.trim($('#txtBuyer').val())==null || $.trim($('#txtBuyer').val())=="")
            {
                alert("Type Buyer and Press Enter.");
                return;
            }
            GetBuyers();
        }else if (code == 8) //backspace=8
        {
            //
            
            $('#txtBuyer').removeClass('fontColorOfPickItem');
            $('#txtBuyer').data('BuyerIDs',"");

        }
    });
    $("#btnBuyerPicker").click(function () {
        GetBuyers();
    });  
    function GetBuyers()
    {
        var oContractor = { Params: 2 + '~' + $.trim($('#txtBuyer').val())+'~'+sessionStorage.getItem("BUID")};
        var obj = {
            BaseAddress: _sBaseAddress,
            Object: oContractor,
            ControllerName: "Contractor",
            ActionName: "ContractorSearchByNameType",
            IsWinClose: false
        };
        $.icsDataGets(obj, function (response) {

            if (response.status && response.objs.length > 0) {
                if (response.objs[0].ContractorID > 0) {

                    var tblColums = []; var oColumn = { field: "Name", title: "Name", width: 150, align: "left" }; tblColums.push(oColumn);
                    oColumn = { field: "ContractorTypeInString", title: "Type", width: 150, align: "left" }; tblColums.push(oColumn);
                    var oPickerParam = {
                        winid: 'winBuyers',
                        winclass: 'clsBuyer',
                        winwidth: 600,
                        winheight: 460,
                        tableid: 'tblBuyers',
                        tablecolumns: tblColums,
                        datalist: response.objs,
                        multiplereturn: true,
                        searchingbyfieldName: 'Name',
                        windowTittle: 'Buyer List'
                    };
                    $.icsPicker(oPickerParam);
                    IntializePickerbutton(oPickerParam);
                }
                else { alert(response.objs[0].ErrorMessage); }
            }
        });
    }
    //End Buyer


    // Search By Department Start
    $("#txtDepartment").keydown(function (e)
    {
        var code = (e.keyCode ? e.keyCode : e.which);
        if (code == 13) // Enter Press
        {
            if( $('#txtDepartment').val()==null ||  $('#txtDepartment').val()=="")
            {
                alert("Type Department & Press Enter");
                return;
            }
            DepartmentPiker();
            
        }else if (code == 8) //backspace=8
        {
            
            $('#txtDepartment').removeClass('fontColorOfPickItem');
            $('#txtDepartment').data('DepartmentIDs',"");
        }
    });
    function DepartmentPiker(){
       
        var oStyleDepartment = {
            Name: $.trim( $("#txtDepartment").val())
        };
        var obj = {
            BaseAddress: _sBaseAddress,
            Object: oStyleDepartment,
            ControllerName: "StyleDepartment",
            ActionName: "GetStyleDepartments",
            IsWinClose: false
        };
        $.icsDataGets(obj, function (response) {

            if (response.status && response.objs.length > 0) {
                if (response.objs[0].StyleDepartmentID > 0) {

                    var tblColums = []; var oColumn = { field: "Name", title: "Name", width: 150, align: "left" }; tblColums.push(oColumn);
                    var oPickerParam = {
                        winid: 'winDepartments',
                        winclass: 'clsDepartment',
                        winwidth: 600,
                        winheight: 460,
                        tableid: 'tblDepartments',
                        tablecolumns: tblColums,
                        datalist: response.objs,
                        multiplereturn: true,
                        searchingbyfieldName: 'Name',
                        windowTittle: 'Department List'
                    };
                    $.icsPicker(oPickerParam);
                    IntializePickerbutton(oPickerParam);
                }
                else { alert(response.objs[0].ErrorMessage); }
            }else
            {
                alert("Data Not Found.");
            }
        });
    }
    //Department Search End


    
    function IntializePickerbutton(oPickerobj) {

        $("#" + oPickerobj.winid).find("#btnOk").click(function () {

            //for Single Select
            PickerEvents(oPickerobj);
        });
        $(document).find('.' + oPickerobj.winclass).keydown(function (e) {
            if (e.which == 13)//enter=13
            {
                PickerEvents(oPickerobj);
            }
        });
    }
    function PickerEvents(oPickerobj) {
        var oreturnobj = null, oreturnobjs = [];
        if (oPickerobj.multiplereturn)
        {
            oreturnobjs = $('#' + oPickerobj.tableid).datagrid('getChecked');
        } else
        {
            oreturnobj = $('#' + oPickerobj.tableid).datagrid('getSelected');
        }

        $("#" + oPickerobj.winid).icsWindow("close");
        $("#" + oPickerobj.winid).remove();
        if (oPickerobj.winclass == 'clsBuyer')
        {
            var sBuyerIDs = "";
                var ncount = 0;
                for (var i = 0; i <oreturnobjs.length; i++) {
                    var nBuyerID = oreturnobjs[i].ContractorID;
                    sBuyerIDs = sBuyerIDs + nBuyerID + ',';
                    ncount++;
                }
                if (ncount > 1)
                {
                    $('#txtBuyer').val("Select " + ncount + " Buyer's");
                } else
                {
                    $('#txtBuyer').val(oreturnobjs[0].Name);
                }
                sBuyerIDs = sBuyerIDs.substring(0, sBuyerIDs.length - 1);
      
            
            $('#txtBuyer').addClass('fontColorOfPickItem');
            $('#txtBuyer').data('BuyerIDs',sBuyerIDs);
            $('#txtBuyer').focus();
        } else if (oPickerobj.winclass == 'clsMerchandiser')
        {
            var nMerchandiserIDs = "";

                var ncount = 0;
                for (var i = 0; i <oreturnobjs.length; i++) {
                    var nEmployeeID = oreturnobjs[i].EmployeeID;
                    nMerchandiserIDs = nMerchandiserIDs + nEmployeeID + ',';
                    ncount++;
                }
                if (ncount > 1)
                {
                    $('#txtMerchandiser').val("Select " + ncount + " Merchandiser's");
                } else
                {
                    $('#txtMerchandiser').val(oreturnobjs[0].Name);
                }
                nMerchandiserIDs = nMerchandiserIDs.substring(0, nMerchandiserIDs.length - 1);

                $('#txtMerchandiser').addClass('fontColorOfPickItem');
            $('#txtMerchandiser').data('MerchandiserIDs',nMerchandiserIDs);
            $('#txtMerchandiser').focus();
        }else if (oPickerobj.winclass == 'clsDepartment')
        {
            debugger;
            var nStyleDepartmentIDs = "";
            var ncount = 0;
            for (var i = 0; i<oreturnobjs.length; i++) 
            {
                var nStyleDepartmentID = oreturnobjs[i].StyleDepartmentID;
                nStyleDepartmentIDs = nStyleDepartmentIDs + nStyleDepartmentID + ',';
                ncount++;
            }
            if (ncount > 1)
            {
                $('#txtDepartment').val("Select " + ncount + " Department's");
            } else
            {
                $('#txtDepartment').val(oreturnobjs[0].Name);
            }
            nStyleDepartmentIDs = nStyleDepartmentIDs.substring(0, nStyleDepartmentIDs.length - 1);
            $('#txtDepartment').addClass('fontColorOfPickItem');
            $('#txtDepartment').data('DepartmentIDs',nStyleDepartmentIDs);
            $('#txtDepartment').focus();
        }
    }
    function Attachiment()
    {
        debugger;
        var oTechnicalSheet= $('#tblTechnicalSheets').datagrid('getSelected');
        if(oTechnicalSheet==null || oTechnicalSheet.TechnicalSheetID<=0)
        {
            alert("Please select a item from list!");
            return;
        }
        
        //EnumAttchRefType : 1 Production Order;2 Delivery Order;3 Delivery Challan ..... 19 :Style /TechnicalSheet
        window.open(_sBaseAddress + '/AttachDocument/Attachment?id='+oTechnicalSheet.TechnicalSheetID+'&RefType=19&OperationInfo= Attachment of Style No : '+oTechnicalSheet.StyleNo, '_blank');
    }

    function RefreshControlLayout(oAuthorizationRolesMapping)
    {        
        $("#btnAdvSearch,#btnAdd,#btnEdit,#btnView,#btnCopy,#btnDelete,#btnReqForApproved,#btnWaitforApproval,#btnApproved,#btnPreview,#btnPrint,#btnBillOfMaterial").hide();

        if (PermissionChecker('AdvSearch', 'TechnicalSheet',oAuthorizationRolesMapping)) {$("#btnAdvSearch").show();}
        if (PermissionChecker('Add', 'TechnicalSheet',oAuthorizationRolesMapping)) {$("#btnAdd").show();}
        if (PermissionChecker('Copy', 'TechnicalSheet',oAuthorizationRolesMapping)) {$("#btnCopy").show();}
        if (PermissionChecker('Edit', 'TechnicalSheet',oAuthorizationRolesMapping)) {$("#btnEdit").show();}
        if (PermissionChecker('View', 'TechnicalSheet',oAuthorizationRolesMapping)) {$("#btnView").show();}
        if (PermissionChecker('Delete', 'TechnicalSheet',oAuthorizationRolesMapping)) {$("#btnDelete").show();}
        if (PermissionChecker('Add', 'TechnicalSheet',oAuthorizationRolesMapping)) {$("#btnReqForApproved").show();}
        if (PermissionChecker('Approved', 'TechnicalSheet',oAuthorizationRolesMapping)) {$("#btnWaitforApproval").show();}
        if (PermissionChecker('Approved', 'TechnicalSheet',oAuthorizationRolesMapping)) {$("#btnApproved").show();}
        if (PermissionChecker('PrintList', 'TechnicalSheet',oAuthorizationRolesMapping)) {$("#btnPrint").show();}        
        if (PermissionChecker('Preview', 'TechnicalSheet',oAuthorizationRolesMapping)) {$("#btnPreview").show();}
        if (PermissionChecker('Add', 'TechnicalSheet',oAuthorizationRolesMapping)) {$("#btnBillOfMaterial").show();}        
    }
</script>
