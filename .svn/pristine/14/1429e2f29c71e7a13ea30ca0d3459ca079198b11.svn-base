@{
    ViewBag.Title = "Merchandiser Report";
}
@model IEnumerable<ESimSol.BusinessObjects.MerchanidisingReport>
<body >
    <div id="winOrderRecapAdvanceSearch" class="easyui-window winClass" title="Advance Search" data-options="modal:true,closed:true,collapsible:false,minimizable:false,maximizable:false,closable:false">
        <div style="width:460px; float: left;">
            <table border="0" cellpadding="0" cellspacing="0">
                 <tr style="height:320px">
                   <td style="width:300px; vertical-align:top;height:300px">
                        <fieldset>
                            <legend style="font-weight:bold; font-size:12px"> Searching Criteria : </legend>
                            <table border="0" cellpadding="0" cellspacing="2">   
                                <tr>
                                    <td style="width:300px;font-size:12px;">
                                        Buyer Name:
                                    </td>
                                </tr>
                                <tr>
                                    <td style="width:300px;font-size:12px;">
                                        @Html.TextBox("txtBuyer", "", new { style = "width: 260px;font-size:12px;", id = "txtBuyer", placeholder = " Type Buyer & Press Enter" }) <input type="button" id="btnBuyerPicker" style="width:60px;" onclick="BuyerPiker()" value="Pick" />

                                    </td>
                                </tr>
                                <tr>
                                    <td style="width:300px;font-size:12px;">
                                        Department:
                                    </td>
                                </tr>
                                <tr>
                                    <td style="width:300px;font-size:12px;">
                                        @Html.TextBox("txtDepartment", "", new { style = "width: 260px;font-size:12px;", id = "txtDepartment", placeholder = "Type Department & Press Enter" }) <input type="button" style="width:60px;" onclick="DepartmentPiker()" value="Pick" />
                                    </td>
                                </tr>

                                <tr>
                                    <td style="width: 130px; text-align: left;font-size:12px;">
                                        Session:
                                    </td>
                                </tr>
                                <tr>
                                    <td style="width: 325px; text-align: left">
                                        <select id="cboSession" style=" width:320px;"></select>
                                    </td>
                                </tr>
                                           
                                <tr>
                                    <td style="width:300px;font-size:12px;">
                                        Style Input Date:
                                    </td>
                                </tr>
                                <tr>
                                    <td style="width:300px">
                                        <table border="0" cellpadding="0" cellspacing="0">
                                            <tr>
                                                <td style="width:97px;font-size:12px;">@Html.DropDownList("cboStyleIssueDate", new SelectList(Enum.GetValues(typeof(ESimSol.BusinessObjects.EnumCompareOperator))), new { id = "cboStyleIssueDate", style = "width: 97px;font-size:12px;", @class = "_select_changeB" })</td>
                                                <td style="width:97px;font-size:12px;"><input type="text" id="txtStartStyleIssueDate" value="" style="width: 102px;font-size:12px;" class="easyui-datebox" data-options="formatter:icsdateformat,parser:icsdateparser" /></td>
                                                <td style="width:9px;font-size:12px;" id="enddateIsue">To</td>
                                                <td style="width:97px;font-size:12px;" id="enddateIssueEnd"><input type="text" id="txtEndStyleIssueDate" value="" style="width: 102px;font-size:12px;" class="easyui-datebox" data-options="formatter:icsdateformat,parser:icsdateparser" /></td>
                                            </tr>
                                        </table>
                                    </td>
                                </tr>

                                <tr>
                                    <td style="width:300px;font-size:12px;">
                                        Order Input Date:
                                    </td>
                                </tr>
                                <tr>
                                    <td style="width:300px">
                                        <table border="0" cellpadding="0" cellspacing="0">
                                            <tr>
                                                <td style="width:97px;font-size:12px;">@Html.DropDownList("cboOrderCreateDate", new SelectList(Enum.GetValues(typeof(ESimSol.BusinessObjects.EnumCompareOperator))), new { id = "cboOrderCreateDate", style = "width: 97px;font-size:12px;", @class = "_select_changeA" })</td>
                                                <td style="width:97px;font-size:12px;"><input type="text" id="txtStartOrderDate" value="" style="width: 108px;font-size:12px;" class="easyui-datebox" data-options="formatter:icsdateformat,parser:icsdateparser" /></td>
                                                <td style="width:9px;font-size:12px;" id="enddateT">To</td>
                                                <td style="width:97px;font-size:12px;" id="enddate"><input type="text" id="txtEndOrderDate" value="" style="width: 108px;font-size:12px;" class="easyui-datebox" data-options="formatter:icsdateformat,parser:icsdateparser" /></td>
                                            </tr>
                                        </table>
                                    </td>
                                </tr>

                                <tr>
                                    <td style="width:300px;font-size:12px;">
                                        Costing Date:
                                    </td>
                                </tr>
                                <tr>
                                    <td style="width:300px">
                                        <table border="0" cellpadding="0" cellspacing="0">
                                            <tr>
                                                <td style="width:97px;font-size:12px;">@Html.DropDownList("cboCostingCreateDate", new SelectList(Enum.GetValues(typeof(ESimSol.BusinessObjects.EnumCompareOperator))), new { id = "cboCostingCreateDate", style = "width: 97px;font-size:12px;", @class = "_select_changeC" })</td>
                                                <td style="width:97px;font-size:12px;"><input type="text" id="txtStartCostingDate" value="" style="width: 108px;font-size:12px;" class="easyui-datebox" data-options="formatter:icsdateformat,parser:icsdateparser" /></td>
                                                <td style="width:9px;font-size:12px;" id="enddateTS">To</td>
                                                <td style="width:97px;font-size:12px;" id="enddateS"><input type="text" id="txtEndCostingDate" value="" style="width: 108px;font-size:12px;" class="easyui-datebox" data-options="formatter:icsdateformat,parser:icsdateparser" /></td>
                                            </tr>
                                        </table>
                                    </td>
                                </tr>

                                <tr>
                                    <td style="width:300px;font-size:12px;">
                                        Plan Date:
                                    </td>
                                </tr>
                                <tr>
                                    <td style="width:300px">
                                        <table border="0" cellpadding="0" cellspacing="0">
                                            <tr>
                                                <td style="width:97px;font-size:12px;">@Html.DropDownList("cboPlanCreateDate", new SelectList(Enum.GetValues(typeof(ESimSol.BusinessObjects.EnumCompareOperator))), new { id = "cboPlanCreateDate", style = "width: 97px;font-size:12px;", @class = "_select_changeD" })</td>
                                                <td style="width:97px;font-size:12px;"><input type="text" id="txtStartPlaneDate" value="" style="width: 108px;font-size:12px;" class="easyui-datebox" data-options="formatter:icsdateformat,parser:icsdateparser" /></td>
                                                <td style="width:9px;font-size:12px;" id="enddateTP">To</td>
                                                <td style="width:97px;font-size:12px;" id="enddateP"><input type="text" id="txtEndPlaneDate" value="" style="width: 108px;font-size:12px;" class="easyui-datebox" data-options="formatter:icsdateformat,parser:icsdateparser" /></td>
                                            </tr>
                                        </table>
                                    </td>
                                </tr>  
                                <tr style="height:20px; vertical-align:bottom">
                                    <td style=" text-align:left; width:330px;">
                                        <table border="0" cellpadding="0" cellspacing="0">
                                            <tr>
                                                <td style=" text-align:left;"><input type="button" value="Reset" onclick="Reset()" id="btnReset" style="width:70px; text-align:left;" /></td>
                                                <td style=" text-align:right; width:260px;"><input type="button" value="Search" id="btnRefresh" style="width:70px; text-align:right;" /></td>
                                            </tr>
                                        </table>
                                    </td>
                                </tr>
                            </table>
                        </fieldset>
                   </td>
                 </tr>
                <tr style="height:50px">
                    <td style="width:850px; text-align:right">
                        <a href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-cancel" plain="true" onclick="Close()">Close</a>
                    </td>
                </tr>
            </table>
        </div>
    </div>

    <div class="menuMainCollectionTable" id="divMerchandisingReport">
        <table id="tblMerchanidisingReport" title="Buyer Wise  Merchandising Report" class="easyui-datagrid" fit="true" fitcolumns="false" rownumbers="true" pagination="true" singleselect="true" autorowheight="false" toolbar="#toolbar">
           <thead>
                <tr>
                    <th field="BuyerName" width="180">Buyer</th>
                    <th field="NumberOfStyleInString" align="right" width="100" formatter="formatStylelabel">Technical Sheet </th>
                    <th field="NumberOfOrderRecapInString" align="right" width="120" formatter="formatOrderRecaplabel">Order Recap </th>
                    <th field="NumberOfCostSheetInString" align="right" width="120" formatter="formatCostSheetlabel">Cost Sheet</th>
                    <th field="NumberOfTAPInString" align="right" width="120" formatter="formatNumberOfTAPlabel">Time Action Plan</th>
                </tr>
            </thead>
        </table>
        <div id="toolbar">
            <a id="btnAdvanceSearch" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-search" plain="true" onclick="AdvanceSearch()">Search</a>
            <a id="btnPreView" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-print" plain="true" onclick="PrintPreview()">Preview</a>
        </div>
    </div>
</body>
<script type="text/javascript">
    var _sBaseAddress = "";
    $(document).ready(function () {
        //debugger;
         _sBaseAddress =@Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(HttpContext.Current.Session[SessionInfo.BaseAddress]));
        var oMerchanidisingReports =@Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(Model));
        var oBusinessSessions=@Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(ViewBag.BusinessSessions));
        $('#divMerchandisingReport').data('BusinessSessions',oBusinessSessions);
        $('#txtBuyer').data('BuyerIDs',"");
        $('#txtDepartment').data('DeptIDs',"");
        sessionStorage.setItem('BaseAddress',_sBaseAddress);
        //RefreshList(oMerchanidisingReports);
    });

    function AdvanceSearch()
    {
        $("#winOrderRecapAdvanceSearch").icsWindow('open', "Advance Search");
        $("#winOrderRecapAdvanceSearch input").not("input[type='button']").val("");
        $("#winOrderRecapAdvanceSearch select").val(0);
        SetTodayDate();
        $("#cboSession").icsLoadCombo({ List: $('#divMerchandisingReport').data('BusinessSessions'), OptionValue: "BusinessSessionID", DisplayText: "SessionName" });
    }

    function SetTodayDate()
    {
        $("#cboStyleIssueDate,#cboOrderCreateDate,#cboCostingCreateDate,#cboPlanCreateDate").val(0);
        $('#txtStartOrderDate,#txtEndOrderDate,#txtStartStyleIssueDate,#txtEndStyleIssueDate,#txtStartCostingDate,#txtEndCostingDate,#txtStartPlaneDate,#txtEndPlaneDate').datebox('setValue', icsdateformat(new Date()));
        document.getElementById("enddate").style.display = '';
        document.getElementById("enddateT").style.display ='';
        document.getElementById("enddateIsue").style.display ='';
        document.getElementById("enddateIssueEnd").style.display ='';
        document.getElementById("enddateS").style.display ='';
        document.getElementById("enddateTS").style.display ='';
        document.getElementById("enddateTP").style.display ='';
        document.getElementById("enddateP").style.display ='';
    }
    $('._select_changeA').change(function () {
        //
        var x = $("#cboOrderCreateDate").val();
        if (x == "EqualTo" || x == "NotEqualTo" || x == "GreaterThen" || x == "SmallerThen") {
            document.getElementById("enddate").style.display = 'none';
            document.getElementById("enddateT").style.display = 'none';
        }
        else {
            document.getElementById("enddate").style.display = '';
            document.getElementById("enddateT").style.display = '';
        }
        if (x == "None")
        {

            $('#txtStartOrderDate').datebox('setValue', icsdateformat(new Date()));
            $('#txtEndOrderDate').datebox('setValue', icsdateformat(new Date()));
        }
    });
    $('._select_changeB').change(function () {
        //
        var x = $("#cboStyleIssueDate").val();
        if (x == "EqualTo" || x == "NotEqualTo" || x == "GreaterThen" || x == "SmallerThen") {
            document.getElementById("enddateIssueEnd").style.display = 'none';
            document.getElementById("enddateIsue").style.display = 'none';
        }
        else {
            document.getElementById("enddateIsue").style.display = '';
            document.getElementById("enddateIssueEnd").style.display = '';
        }
        if (x == "None")
        {

            $('#txtStartStyleIssueDate').datebox('setValue', icsdateformat(new Date()));
            $('#txtEndStyleIssueDate').datebox('setValue', icsdateformat(new Date()));
        }
    });
    $('._select_changeC').change(function () {
        //
        var x = $("#cboCostingCreateDate").val();
        if (x == "EqualTo" || x == "NotEqualTo" || x == "GreaterThen" || x == "SmallerThen") {
            document.getElementById("enddateTS").style.display = 'none';
            document.getElementById("enddateS").style.display = 'none';
        }
        else {
            document.getElementById("enddateS").style.display = '';
            document.getElementById("enddateTS").style.display = '';
        }
        if (x == "None")
        {

            $('#txtStartCostingDate').datebox('setValue', icsdateformat(new Date()));
            $('#txtEndCostingDate').datebox('setValue', icsdateformat(new Date()));
        }
    });
    $('._select_changeD').change(function () {
        var x = $("#cboPlanCreateDate").val();
        if (x == "EqualTo" || x == "NotEqualTo" || x == "GreaterThen" || x == "SmallerThen") {
            document.getElementById("enddateTP").style.display = 'none';
            document.getElementById("enddateP").style.display = 'none';
        }
        else {
            document.getElementById("enddateP").style.display = '';
            document.getElementById("enddateTP").style.display = '';
        }
        if (x == "None")
        {
            $('#txtStartPlaneDate,#txtEndPlaneDate').datebox('setValue', icsdateformat(new Date()));
        }
    });

    //Buyer Pick start
    $("#txtBuyer").keydown(function (e) {

        var code = (e.keyCode ? e.keyCode : e.which);
        if (code == 13) // Enter Press
        {
            if($.trim($('#txtBuyer').val())==null || $.trim($('#txtBuyer').val())=="")
            {
                alert("Type Buyer and Press Enter.");
                return;
            }
            GetBuyers();
        }else if (code == 8) //backspace=8
        {
            //
            
            $('#txtBuyer').removeClass('fontColorOfPickItem');
            $('#txtBuyer').data('BuyerIDs',"");

        }
    });
    $("#btnBuyerPicker").click(function () {
        GetBuyers();
    });  
    function GetBuyers()
    {
        var oContractor = { Params: 2 + '~' + $.trim($('#txtBuyer').val())+'~'+sessionStorage.getItem("BUID")};
        var obj = {
            BaseAddress: _sBaseAddress,
            Object: oContractor,
            ControllerName: "Contractor",
            ActionName: "ContractorSearchByNameType",
            IsWinClose: false
        };
        $.icsDataGets(obj, function (response) {

            if (response.status && response.objs.length > 0) {
                if (response.objs[0].ContractorID > 0) {

                    var tblColums = []; var oColumn = { field: "Name", title: "Name", width: 150, align: "left" }; tblColums.push(oColumn);
                    oColumn = { field: "ContractorTypeInString", title: "Type", width: 150, align: "left" }; tblColums.push(oColumn);
                    var oPickerParam = {
                        winid: 'winBuyers',
                        winclass: 'clsBuyer',
                        winwidth: 600,
                        winheight: 460,
                        tableid: 'tblBuyers',
                        tablecolumns: tblColums,
                        datalist: response.objs,
                        multiplereturn: true,
                        searchingbyfieldName: 'Name',
                        windowTittle: 'Buyer List'
                    };
                    $.icsPicker(oPickerParam);
                    IntializePickerbutton(oPickerParam);
                }
                else { alert(response.objs[0].ErrorMessage); }
            }
        });
    }
    //Buyer Pick End

    // Search By Department Start
    $("#txtDepartment").keydown(function (e)
    {
        var code = (e.keyCode ? e.keyCode : e.which);
        if (code == 13) // Enter Press
        {
            if( $('#txtDepartment').val()==null ||  $('#txtDepartment').val()=="")
            {
                alert("Type Department & Press Enter");
                return;
            }
            DepartmentPiker();
            
        }else if (code == 8) //backspace=8
        {
            
            $('#txtDepartment').removeClass('fontColorOfPickItem');
            $('#txtDepartment').data('DeptIDs',"");
        }
    });
    function DepartmentPiker(){
       
        var oStyleDepartment = {
            Name: $.trim( $("#txtDepartment").val())
        };
        var obj = {
            BaseAddress: _sBaseAddress,
            Object: oStyleDepartment,
            ControllerName: "StyleDepartment",
            ActionName: "GetStyleDepartments",
            IsWinClose: false
        };
        $.icsDataGets(obj, function (response) {

            if (response.status && response.objs.length > 0) {
                if (response.objs[0].StyleDepartmentID > 0) {

                    var tblColums = []; var oColumn = { field: "Name", title: "Name", width: 150, align: "left" }; tblColums.push(oColumn);
                    var oPickerParam = {
                        winid: 'winDepartments',
                        winclass: 'clsDepartment',
                        winwidth: 600,
                        winheight: 460,
                        tableid: 'tblDepartments',
                        tablecolumns: tblColums,
                        datalist: response.objs,
                        multiplereturn: true,
                        searchingbyfieldName: 'Name',
                        windowTittle: 'Department List'
                    };
                    $.icsPicker(oPickerParam);
                    IntializePickerbutton(oPickerParam);
                }
                else { alert(response.objs[0].ErrorMessage); }
            }else
            {
                alert("Data Not Found.");
            }
        });
    }
    //Department Search End

    function IntializePickerbutton(oPickerobj) {

        $("#" + oPickerobj.winid).find("#btnOk").click(function () {

            //for Single Select
            PickerEvents(oPickerobj);
        });
        $(document).find('.' + oPickerobj.winclass).keydown(function (e) {
            if (e.which == 13)//enter=13
            {
                PickerEvents(oPickerobj);
            }
        });
    }
    function PickerEvents(oPickerobj) {
        var oreturnobj = null, oreturnobjs = [];
        if (oPickerobj.multiplereturn)
        {
            oreturnobjs = $('#' + oPickerobj.tableid).datagrid('getChecked');
        } else
        {
            oreturnobj = $('#' + oPickerobj.tableid).datagrid('getSelected');
        }

        $("#" + oPickerobj.winid).icsWindow("close");
        $("#" + oPickerobj.winid).remove();
        if (oPickerobj.winclass == 'clsBuyer')
        {
            var sBuyerIDs = "";
            var ncount = 0;
            for (var i = 0; i <oreturnobjs.length; i++) {
                var nBuyerID = oreturnobjs[i].ContractorID;
                sBuyerIDs = sBuyerIDs + nBuyerID + ',';
                ncount++;
            }
            if (ncount > 1)
            {
                $('#txtBuyer').val("Select " + ncount + " Buyer's");
            } else
            {
                $('#txtBuyer').val(oreturnobjs[0].Name);
            }
            sBuyerIDs = sBuyerIDs.substring(0, sBuyerIDs.length - 1);
            $('#txtBuyer').addClass('fontColorOfPickItem');
            $('#txtBuyer').data('BuyerIDs',sBuyerIDs);
            $('#txtBuyer').focus();
        } else if (oPickerobj.winclass == 'clsDepartment')
        {
            debugger;
            var nStyleDepartmentIDs = "";
            var ncount = 0;
            for (var i = 0; i<oreturnobjs.length; i++) 
            {
                var nStyleDepartmentID = oreturnobjs[i].StyleDepartmentID;
                nStyleDepartmentIDs = nStyleDepartmentIDs + nStyleDepartmentID + ',';
                ncount++;
            }
            if (ncount > 1)
            {
                $('#txtDepartment').val("Select " + ncount + " Department's");
            } else
            {
                $('#txtDepartment').val(oreturnobjs[0].Name);
            }
            nStyleDepartmentIDs = nStyleDepartmentIDs.substring(0, nStyleDepartmentIDs.length - 1);
            $('#txtDepartment').addClass('fontColorOfPickItem');
            $('#txtDepartment').data('DeptIDs',nStyleDepartmentIDs);
            $('#txtDepartment').focus();
        }
    }

    $('#btnRefresh').click(function () {
        var cboStyleIssueDate = document.getElementById("cboStyleIssueDate");
        var ncboStyleIssueDate=cboStyleIssueDate.options[cboStyleIssueDate.selectedIndex].index;

        var cboOrderCreateDate = document.getElementById("cboOrderCreateDate");
        var nOrderCreateDate=cboOrderCreateDate.options[cboOrderCreateDate.selectedIndex].index;

        var cboCostingCreateDate = document.getElementById("cboCostingCreateDate");
        var ncboCostingDate=cboCostingCreateDate.options[cboCostingCreateDate.selectedIndex].index;
        var cboPlanCreateDate = document.getElementById("cboPlanCreateDate");
        var ncboPlanDate=cboPlanCreateDate.options[cboPlanCreateDate.selectedIndex].index;

        var dStartStyleIssuDates=$('#txtStartStyleIssueDate').datebox('getValue');
        var dStartStyleEndDates=$('#txtEndStyleIssueDate').datebox('getValue');

        var dStartOrderStartDate=$('#txtStartOrderDate').datebox('getValue');
        var dEndOrderStartDate=$('#txtEndOrderDate').datebox('getValue');

        var dCostingStarteDate=$('#txtStartCostingDate').datebox('getValue');
        var dCostingEndDate=$('#txtEndCostingDate').datebox('getValue');

        var dPlanStarteDate=$('#txtStartPlaneDate').datebox('getValue');
        var dPlanEndDate=$('#txtEndPlaneDate').datebox('getValue');

        /*Business Session */
        var nSessionID= parseInt($('#cboSession').val());
        if(nOrderCreateDate==0 &&  ncboStyleIssueDate ==0 && ncboCostingDate ==0 &&  ncboPlanDate== 0 && $('#txtBuyer').data('BuyerIDs')=="" && $('#txtDepartment').data('DeptIDs')==""  && nSessionID==0 )
        {
            alert('Please Select a Search Criteria');
            return false;
        }

        if($('#txtBuyer').data('BuyerIDs')=="" && ncboStyleIssueDate==0)
        {
            alert('Please Select Must Be Either Buyer OR  Style Date Criteria.');
            return false;
        }

        var sTempString = $('#txtBuyer').data('BuyerIDs')+'~'+$('#txtDepartment').data('DeptIDs')+'~'+nSessionID+'~'+ncboStyleIssueDate+'~'+dStartStyleIssuDates+'~'+ dStartStyleEndDates+'~' + nOrderCreateDate+'~'+dStartOrderStartDate+'~'+dEndOrderStartDate+'~'+ncboCostingDate+'~'+dCostingStarteDate+'~'+dCostingEndDate+'~'+ncboPlanDate+'~'+dPlanStarteDate+'~'+dPlanEndDate+'~'+sessionStorage.getItem("BUID");
        var oMerchanidisingReport = {sParam:sTempString};
        $.ajax({
            type: "POST",
            dataType: "json",
            url : _sBaseAddress+  "/MerchanidisingReport/Gets",
            traditional: true,
            data:  JSON.stringify(oMerchanidisingReport),
            contentType: "application/json; charset=utf-8",
            success: function (data) {
                var oMerchanidisingReports = jQuery.parseJSON(data);
                if(oMerchanidisingReports.length>0)
                {
                    RefreshList(oMerchanidisingReports);
                    Reset();
                    $("#winOrderRecapAdvanceSearch").icsWindow('close');
                }
                else
                {
                    alert("Data not found!!");
                    RefreshList([]);
                }
                
            },
            error: function (xhr, status, error) {
                alert(error);
            }
        });

    });
    function Reset()
    {
        SetTodayDate();
        $('#txtBuyer').data('BuyerIDs',"");
        $('#txtDepartment').data('DeptIDs',"");
        $('#cboSession').val(0);

        $("#txtDepartment,#txtBuyer").val('');
        var txtFactory=document.getElementById("txtDepartment");
        txtFactory.style.color="black";
        txtFactory.style.fontWeight="normal";

        var txtBuyer=document.getElementById("txtBuyer");
        txtBuyer.style.color="black";
        txtBuyer.style.fontWeight="normal";
        
    }
    function Close()
    {
        Reset();
        $("#winOrderRecapAdvanceSearch").icsWindow('close');
    }


    function RefreshList(oMerchanidisingReports)
    {
        data=oMerchanidisingReports;
        data={"total":""+data.length+"","rows":data};
        $('#tblMerchanidisingReport').datagrid('loadData',data);
    }
    function formatStylelabel(value)
    {
        debugger;
        var values=value.split("~");
        var BuyerID=values[0];
        var nStyleCount=values[1];
        var s = '<a  href="javascript:void(0)" id="idStyle~'+BuyerID+' value="'+BuyerID+'"  onclick = "PickCommonPicker('+BuyerID+','+nStyleCount+',1)"">'+nStyleCount+'</a>';
        return s;
    }
    function formatOrderRecaplabel(value)
    {
        var values=value.split("~");
        var BuyerID=values[0];
        var nRecapCount=values[1];
        var s = '<a  href="javascript:void(0)" id="idOR~'+BuyerID+' value="'+BuyerID+'"  onclick = "PickCommonPicker('+BuyerID+','+nRecapCount+',2)"">'+nRecapCount+'</a>';
        return s;
    }
    function formatCostSheetlabel(value)
    {
        var values=value.split("~");
        var BuyerID=values[0];
        var nNumberOfCostSheet=values[1];
        var s = '<a  href="javascript:void(0)" id="idCS~'+BuyerID+' value="'+BuyerID+'"  onclick = "PickCommonPicker('+BuyerID+','+nNumberOfCostSheet+',3)"">'+nNumberOfCostSheet+'</a>';
        return s;
    }
    function formatNumberOfTAPlabel(value)
    {
        var values=value.split("~");
        var BuyerID=values[0];
        var nNumberOfTAP=values[1];
        var s = '<a  href="javascript:void(0)" id="idTAP~'+BuyerID+' value="'+BuyerID+'"  onclick = "PickCommonPicker('+BuyerID+','+nNumberOfTAP+',4)"">'+nNumberOfTAP+'</a>';
        return s;
    }
    function PickCommonPicker(nBuyerID,nCount, nOperationType)
    {
        if(parseInt(nCount)<=0)
        {
            alert("Sorry, There is No Item");
            return;
        }
        
        //nOperationType :1:Style,2:Order Recap, 3:Cost Sheet, 4:TAP
        var tblColums = []; var oColumn = null; 
        if(nOperationType==1)//Style
        {
            //TSCountInString
            oColumn = { field: "StyeleWithIDInString", title: "Style No", width: 150, align: "left", formatter:Refformat }; tblColums.push(oColumn);
            oColumn = { field: "SessionName", title: "Session Name", width:150, align: "left" }; tblColums.push(oColumn);
        }else if(nOperationType==2)//Order REcap
        {
            oColumn = { field: "OrderRecapWithIDInString", title: "Recap No", width:130, align: "left", formatter:Refformat }; tblColums.push(oColumn);
            oColumn = { field: "StyleNo", title: "Style No", width: 150, align: "left" }; tblColums.push(oColumn);
            oColumn = { field: "SessionName", title: "Session Name", width:150, align: "left" }; tblColums.push(oColumn);
        }else if(nOperationType==3)//Cost Sheet
        {
            oColumn = { field: "FileNoWithIDInString", title: "CS No", width:130, align: "left" , formatter:Refformat}; tblColums.push(oColumn);
            oColumn = { field: "StyleNo", title: "Style No", width: 150, align: "left" }; tblColums.push(oColumn);
            
        }else if(nOperationType==4)//TAP
        {
            oColumn = { field: "PlanNoWithIDInString", title: "Plan No", width:130, align: "left", formatter:Refformat }; tblColums.push(oColumn);
            oColumn = { field: "StyleNo", title: "Style No", width: 150, align: "left" }; tblColums.push(oColumn);
        }
        oColumn = { field: "MerchandiserName", title: "Merchandiser Name", width:130, align: "left" }; tblColums.push(oColumn);
        $.icsProgressBar(true);
        var oMerchanidisingReport = { sParam:nBuyerID+'~'+nOperationType};
        var obj = {
            BaseAddress: _sBaseAddress,
            Object: oMerchanidisingReport,
            ControllerName: "MerchanidisingReport",
            ActionName: "GetsPickerValue",
            IsWinClose: false
        };
        $.icsDataGets(obj, function (response) 
        {
            if (response.status && response.objs.length > 0) {
                if (response.objs[0].ErrorMessage=="" || response.objs[0].ErrorMessage==null)
                {
                    var oPickerParam = {
                        winid:'winTempPicker',
                        winclass:'clsTempPicker',
                        winwidth:600,
                        winheight:460,
                        tableid:'tblTempPickers',
                        tablecolumns:tblColums,
                        datalist: response.objs,
                        multiplereturn: false,
                        searchingbyfieldName: 'Name',
                        windowTittle: 'Item List'
                    };
                    $.icsProgressBar(false);
                    $.icsPicker(oPickerParam);
                    $('#btnOk').hide();
                    //IntializePickerbutton(oPickerParam);
                }
                else { alert(response.objs[0].ErrorMessage); }
            }
        });

    }

    function PickOperationView(nRefID, nRefType)
    {
        debugger;
        if(parseInt(nRefID)<=0)
        {
            alert("Sorry, There is No Value.");
            return;
        }
        var tsv=((new Date()).getTime())/1000;
        sessionStorage.setItem("BackLink","");
        if(nRefType==1)//TS
        {
            sessionStorage.setItem("TSHeader", "View TechnicalSheet");
            window.open(_sBaseAddress+ "/TechnicalSheet/ViewTechnicalSheet?id="+nRefID+"&ts="+tsv);
        }else  if(nRefType==2)//OR
        {
            sessionStorage.setItem("RecapHeader", "View Order Recap");
            sessionStorage.setItem("OT", 1);
            window.open(_sBaseAddress+ "/OrderRecap/ViewOrderRecap?id="+nRefID+"&OT=1&TSID=0&ts="+tsv);
        }else  if(nRefType==3)//CS
        {
            sessionStorage.setItem("CostSheetHeader", "View Cost Sheet");
            sessionStorage.setItem("CostSheetType", 1);//default woven type may can change depends on User Requirement
            window.open(_sBaseAddress+"/CostSheet/ViewCostSheetWoven?id="+nRefID);
        }else  if(nRefType==4)//TAP
        {
            sessionStorage.setItem("TAPHeader", 'View Time Action Plan');
            window.open(_sBaseAddress+  "/TAP/ViewTAP?id="+nRefID);
        }
    }

    function Refformat(value)
    {
        debugger;
        var values=value.split("~");
        var RefID=values[0];
        var sRefNo = values[1];
        var nRefType = values[2];
        var s = '<a  href="javascript:void(0)" id="id~'+RefID+' value="'+RefID+'"  onclick = "PickOperationView('+RefID+','+nRefType+')"">'+sRefNo+'</a>';
        return s;
    }



    function PrintPreview()
    {
        var oMerchanidisingReports= $('#tblMerchanidisingReport').datagrid('getRows');
        if(oMerchanidisingReports.length<=0)
        {           
            alert("Data not found ");
            return;
        }
        window.open(_sBaseAddress + '/MerchanidisingReport/PrintMerchandisingReport?nBUID='+sessionStorage.getItem("BUID"));
    }

</script>
