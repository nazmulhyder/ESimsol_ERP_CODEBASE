@{
    ViewBag.Title = "Email Configs";
}
@model IEnumerable<ESimSol.BusinessObjects.EmailConfig>

    <div class="menuMainCollectionTable" style="height:100%">
        <table id="tblEmailConfigs" title="Email Configs" class="easyui-datagrid" fit="true" fitcolumns="true" rownumbers="true" pagination="true" singleselect="true" autorowheight="false" toolbar="#toolbar">
            <thead>
                <tr>
                    <th field="BUName" width="100">BU Name</th>
                    <th field="EmailAddress" width="100">Email Address</th>
                    <th field="EmailDisplayName" width="100">Email Display Name</th>
                    <th field="PortNumber" width="100">Port Number</th>
                    <th field="HostName" width="100">Host Name</th>
                    <th field="SSLRequiredSt" width="100">SSL Required</th>                 
                    <th field="Remarks" width="100">Remarks</th>
                </tr>
            </thead>
        </table>
        <div id="toolbar">
            <a id="btnAdd" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-add" plain="true">Add</a>
            <a id="btnEdit" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-edit" plain="true">Edit</a>
            <a id="btnView" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-details" plain="true">View</a>
            <a id="btnDelete" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-remove" plain="true">Delete</a>            
        </div>
    </div>

 <script type="text/javascript">
    $(document).ready(function () {
        var oEmailConfigs =@Html.Raw( new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(Model));
        var sBaseAddress =@Html.Raw( new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(HttpContext.Current.Session[SessionInfo.BaseAddress]));
        $('#tblEmailConfigs').data('BaseAddress', sBaseAddress);
        var oTempEmailConfigs =sessionStorage.getItem("EmailConfigs");
        if(oTempEmailConfigs!=null)
        {
            oEmailConfigs = jQuery.parseJSON(oTempEmailConfigs);
        }
        RefreshList(oEmailConfigs);
    });


    $('#btnAdd').click(function(){
        var oEmailConfigs= $('#tblEmailConfigs').datagrid('getRows');
        sessionStorage.setItem("EmailConfigs", JSON.stringify(oEmailConfigs));
        sessionStorage.setItem("SelectedRowIndex", -1);
        sessionStorage.setItem("EmailConfigHeader", "Add EmailConfig");
        sessionStorage.setItem("BackLink", window.location.href);
        window.location.href = $('#tblEmailConfigs').data('BaseAddress')+ "/EmailConfig/ViewEmailConfig?id=0";
    });

    $('#btnEdit').click(function(){
        debugger;
        var oEmailConfig= $('#tblEmailConfigs').datagrid('getSelected');
        if(oEmailConfig==null || oEmailConfig.EmailConfigID<=0)
        {
            alert("Please select a item from list!");
            return;
        }
        var SelectedRowIndex=$('#tblEmailConfigs').datagrid('getRowIndex',oEmailConfig);
        var oEmailConfigs= $('#tblEmailConfigs').datagrid('getRows');
        sessionStorage.setItem("EmailConfigs", JSON.stringify(oEmailConfigs));
        sessionStorage.setItem("SelectedRowIndex", SelectedRowIndex);
        sessionStorage.setItem("EmailConfigHeader", "Edit EmailConfig");
        sessionStorage.setItem("BackLink", window.location.href);
        window.location.href =  $('#tblEmailConfigs').data('BaseAddress')+  "/EmailConfig/ViewEmailConfig?id="+oEmailConfig.EmailConfigID;
    });

    $('#btnView').click(function(){
        var oEmailConfig= $('#tblEmailConfigs').datagrid('getSelected');
        if(oEmailConfig==null || oEmailConfig.EmailConfigID<=0)
        {
            alert("Please select a item from list!");
            return;
        }
        var SelectedRowIndex=$('#tblEmailConfigs').datagrid('getRowIndex',oEmailConfig);
        var oEmailConfigs= $('#tblEmailConfigs').datagrid('getRows');
        sessionStorage.setItem("EmailConfigs", JSON.stringify(oEmailConfigs));
        sessionStorage.setItem("SelectedRowIndex", SelectedRowIndex);
        sessionStorage.setItem("EmailConfigHeader", "View EmailConfig");
        sessionStorage.setItem("BackLink", window.location.href);
        window.location.href =  $('#tblEmailConfigs').data('BaseAddress')+  "/EmailConfig/ViewEmailConfig?id="+oEmailConfig.EmailConfigID;
    });

    $('#btnDelete').click(function(){
        var oEmailConfig= $('#tblEmailConfigs').datagrid('getSelected');
        if (!confirm("Confirm to Delete?")) return ;

        if(oEmailConfig==null || oEmailConfig.EmailConfigID<=0)
        {
            alert("Invalid Field!!! please select a valid Field!");
            return false;
        }
        var SelectedRowIndex=$('#tblEmailConfigs').datagrid('getRowIndex',oEmailConfig);

        if (oEmailConfig.EmailConfigID > 0)
        {
            $.ajax
            ({
                type: "GET",
                dataType: "json",
                url : $('#tblEmailConfigs').data('BaseAddress')+  "/EmailConfig/Delete",
                data: { id: oEmailConfig.EmailConfigID},
                contentType: "application/json; charset=utf-8",
                success: function (data) {
                    //debugger;
                    feedbackmessage = jQuery.parseJSON(data);
                    if (feedbackmessage == "Data delete successfully")
                    {
                        alert("Delete sucessfully");
                        $('#tblEmailConfigs').datagrid('deleteRow',SelectedRowIndex);

                    }
                    else
                    {
                        alert(feedbackmessage);
                    }
                },
                error: function (xhr, status, error)
                {
                    alert(error);
                }

            });
        }
    });

  
    function RefreshList(oEmailConfigs)
    {
        data={"total":""+oEmailConfigs.length+"","rows":oEmailConfigs};
        $('#tblEmailConfigs').datagrid('loadData',data);
        var nSelectedRowIndex =parseInt(sessionStorage.getItem("SelectedRowIndex"));
        if(nSelectedRowIndex!=-1)
        {
            $('#tblEmailConfigs').datagrid('selectRow', nSelectedRowIndex);
        }
    }
    </script>
