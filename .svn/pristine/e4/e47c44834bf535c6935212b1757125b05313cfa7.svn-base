<!DOCTYPE html />
<html>
<head>
    <title>Production Sheet(Cartooning)</title>
    <script src="@Url.Content("~/Scripts/jquery-1.7.1.min.js")" type="text/javascript"></script>
    <script src="@Url.Content("~/Scripts/jquery-latest.js")" type="text/javascript"></script>
    <link href="../../Content/CSS/newPikerview.css" rel="stylesheet" type="text/css" />
    <script src="@Url.Content("~/Scripts/jquery-ui-1.8.22.custom.min.js")" type="text/javascript"></script>
    <script src="@Url.Content("~/Scripts/UserControlScript/GlobalScript.js")" type="text/javascript"></script>
    <link href="@Url.Content("~/Content/CSS/jquery-ui-1.8.22.custom.css")" rel="stylesheet" type="text/css" />
    <script src="@Url.Content("~/Scripts/jquery.unobtrusive-ajax.js")" type="text/javascript"></script>
    @* Following Reference For menu *@
    <link href="@Url.Content("~/Content/CSS/easyui.css")" rel="stylesheet" type="text/css" />
    <link href="@Url.Content("~/Content/CSS/icon.css")" rel="stylesheet" type="text/css" />
    <script src="@Url.Content("~/Scripts/jquery.easyui.min.js")" type="text/javascript"></script>
    @*Datetime format piker*@
    <script src="@Url.Content("~/Scripts/Date-Format-1.2.3.js")" type="text/javascript"></script>
    <script src="@Url.Content("~/Scripts/jquery.json.js")" type="text/javascript"></script>
    @*for json stringify *@
    <script src="@Url.Content("~/Scripts/jquery-ui.min.js")" type="text/javascript"></script>
    <script src="@Url.Content("~/Scripts/json2.js")" type="text/javascript"></script>
</head>
<body>
    @model ESimSol.BusinessObjects.EmployeeProduction
    <div style="font-family: Tahoma">
        <table border="0" cellspacing="0" cellpadding="0">
            <tr>
                <td style="background-color: #cfb53b; text-align: center; width: 670px; color: White">
                    <label id="lblHeaderName" style="font-size: 17px; font-weight: bold; text-decoration: Underline">
                        Cartooning Receive</label>
                </td>
            </tr>
            <tr>
                <td style="background-color: #cfb53b; text-align: center; width: 670px; color: White">
                    <label id="lblHeader" style="font-size: 14px; font-weight: bold; text-decoration: Underline">
                        Cartooning Receive</label>
                </td>
            </tr>
        </table>
        <fieldset>
            <legend style="font-weight: bold">Cartooning Receive</legend>@* table1 start*@
            <table border="0" cellspacing="2" cellpadding="2" style="font-size: 11px; font-weight: bold;">
                <tr>
                    <td style="width: 150px; text-align: right;">
                        Employee :
                    </td>
                    <td>
                      <input id="txtEmployee" type="text" style="width:200px;" disabled="disabled" />
                    </td>
                    <td style="width: 120px; text-align: right;">
                       Issue Date :
                    </td>
                    <td>
                       <input id="dtIssueDate" disabled="disabled" type="text" style="width: 200px"/>
                    </td>
                </tr>
                <tr>
                    <td style="width: 150px; text-align: right;">
                        Official Info :
                    </td>
                    <td>
                        <input id="txtOfficialInfo" type="text" style="width: 200px;" disabled="disabled" />
                    </td>
                    <td style="width: 120px; text-align: right;">
                        PSNo :
                    </td>
                    <td >
                        <input id="txtPSNo" type="text" style="width:200px;" disabled="disabled" />
                    </td>
                </tr>
                <tr>
                    <td style="width: 150px; text-align: right;">
                        Machine Number :
                    </td>
                    <td>
                      <input id="txtMachineNo" type="text" style="width:200px;" disabled="disabled" />
                    </td>
                    <td style="width: 150px; text-align: right;">
                        Color With Size:
                    </td>
                    <td>
                        <input id="txtColorWithSize" type="text" style="width:200px;" disabled="disabled" />
                    </td>
                </tr>
                
                <tr>
                    <td style="width: 150px; text-align: right;">
                        Rcv Qty:
                    </td>
                    <td>
                       <input id="txtRcvQty" type="text" style="width:200px;" />
                    </td>
                    <td style="width: 150px; text-align: right;">
                        Issue Qty:
                    </td>
                    <td>
                       <input id="txtIssueQty" type="text" style="width:170px;" disabled="disabled" />(Pcs) 
                    </td>
                   
                </tr>

                <tr>
                    <td style="width: 150px; text-align: right;">
                        
                    </td>
                    <td>
                        Already Rcv : 
                       <label id="lblAlreadyRcv"></label>
                       &nbsp;Balance : 
                       <label id="lblBalance"></label>
                    </td>
                    <td style="width: 120px; text-align: right;">
                        Rcv Date :
                    </td>
                    <td>
                        <input id="dtRcvDate" type="text" style="width: 200px" class="easyui-datebox" required="required" data-options="formatter:icsdateformat" />
                    </td>
                </tr>
                
            </table>
            <table border="0" cellspacing="2" cellpadding="2" style="font-size: 11px; font-weight: bold;">
                <tr>
                    <td style="width: 650px; text-align: right;">
                        <a id="btnSave" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-save" plain="true">Save</a>
                        <a id="btnCancel" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-cancel" plain="true">Close</a>
                    </td>
                </tr>
            </table>
            @* table1 end*@
            
        </fieldset>
    </div>
</body>
</html>

<script type="text/javascript">
var _oEmployeeProduction=null;
var _sBaseAddress="";
var _obj=null;
var _oEmployee=null;
$(document).ready(function ()
{

    _sBaseAddress =@Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(HttpContext.Current.Session[SessionInfo.BaseAddress]));  
    _oEmployeeProduction =@Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(Model)); 
    _obj = window.dialogArguments;
    
    document.getElementById("lblHeader").innerHTML= "Order No : "+_obj.oOrderRecape.OrderRecapNo+", Style : "+_obj.oOrderRecape.StyleNo+", Buyer : "+_obj.oOrderRecape.BuyerName;
    $("#txtRcvQty").numberbox();
    $('#dtRcvDate').datebox('setValue', _oEmployeeProduction.IssueDateInString);
    document.getElementById("txtEmployee").value=_obj.oCartooning.EmployeeNameCode;
    document.getElementById("dtIssueDate").value=_obj.oCartooning.IssueDateInString;
    document.getElementById("txtOfficialInfo").value=_obj.oCartooning.EmpOfficial;
    document.getElementById("txtPSNo").value=_obj.oCartooning.EPSNO;
    document.getElementById("txtMachineNo").value=_obj.oCartooning.MachineNo;
    document.getElementById("txtColorWithSize").value=_obj.oCartooning.ColorName+"["+_obj.oCartooning.SizeCategoryName+"]";
    document.getElementById("txtIssueQty").value=_obj.oCartooning.IssueQty;
    document.getElementById("lblAlreadyRcv").innerHTML=_obj.oCartooning.RcvQty;
    document.getElementById("lblBalance").innerHTML=_obj.oCartooning.EmpWiseBalanceQty;
     
});

function  icsdateformat(date)
{
    var mthNames = ["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];
    var y = date.getFullYear();
    var m = date.getMonth();
    var d = date.getDate();
    var result= d +' '+ mthNames[m]+' '+ y;
    return result;
}

function ValidateInput() 
{
    if(_obj.oCartooning.EmpWiseBalanceQty==0)
    {
        alert("Balance Qty Is Zero. You Have Nothing To Receive !");
        $("#txtRcvQty").focus();
        return false;
    }

    if(document.getElementById("txtRcvQty").value=="")
    {
        alert("Please Enter Receive Qty!");
        $("#txtRcvQty").focus();
        return false;
    }
   
    var nRcvQty=document.getElementById("txtRcvQty").value;
    if(nRcvQty>_obj.oCartooning.EmpWiseBalanceQty)
    {
        alert("ReceiveQty Must Not be Greater Than Balance Qty !");
        $("#txtRcvQty").focus();
        return false;
    }

    var RcvDate=$('#dtRcvDate').datebox('getValue');
    var RcvDateTime=new Date(RcvDate);
    var ND= new Date();
    ND.setHours(0,0,0,0);
    if(RcvDateTime<ND)
    {
        alert("ReceiveDate Must Not be Less Than Current Date !");
        $("#dtRcvDate").focus();
        return false;
    }
    
    return true;
}

function RefreshObject() 
{
    var oEmployeeProductionReceiveDetail=
    {
        EPSRDID : 0,
        EPSID : _obj.oCartooning.EPSID,
        RcvQty : document.getElementById("txtRcvQty").value,
        RcvByDate : $('#dtRcvDate').datebox('getValue')
    }
    return oEmployeeProductionReceiveDetail;
}

$('#btnSave').click(function (e) 
{

    if (!ValidateInput()) return;
    var nRcvQty=document.getElementById("txtRcvQty").value;
    var nNewRcvQty=parseFloat(nRcvQty)+parseFloat( _obj.oCartooning.RcvQty);
    var oEmployeeProductionReceiveDetail = RefreshObject();
    $.ajax({
            type: "POST",
            dataType: "json",
            url: _sBaseAddress + "/EmployeeProduction/EmployeeProductionReceiveDetail_IU",
            traditional: true,
            data: JSON.stringify({oEmployeeProductionReceiveDetail:oEmployeeProductionReceiveDetail,nNewRcvQty:nNewRcvQty}),
            contentType: "application/json; charset=utf-8",

            success: function(data)
            {
                //debugger
                 _oEmployeeProduction = jQuery.parseJSON(data);
                if (_oEmployeeProduction.ErrorMessage == "") 
                {
                    alert("Data Saved sucessfully");
                    window.returnValue = _oEmployeeProduction;
                    window.close();
                } 
                else 
                {
                    alert(_oEmployeeProduction.ErrorMessage);
                }
             },
             error: function(xhr, status, error)
             {
                alert(error);
             }
          });
});

$('#btnCancel').click(function (e) 
{
    window.close();
});

</script>