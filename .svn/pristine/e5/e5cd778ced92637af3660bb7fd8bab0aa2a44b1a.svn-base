@{
ViewBag.Title = "Transfer Requisition List";
}
@model IEnumerable<ESimSol.BusinessObjects.TransferRequisitionSlip>
<div id="progressbarParent" style="width:100%;height:100%;margin:0 auto;text-align:center; margin-left: auto;margin-right: auto;left: 0;right: 0;z-index: 1;">
    <div style="margin: 0px auto;margin-top: 251px;text-align:center;width:390px;">
        <label style="font-size:18px;">Please wait</label>
        <div id="progressbar" style="width:100%;height:37px;"></div>
    </div>
</div>

<div id="winTRSAdvSearch" class="easyui-window winClass" title="Advance Search" data-options="modal:true,closed:true,collapsible:false,minimizable:false,maximizable:false,closable:false">
    <div style="width:760px; float: left;">
        <table border="0" cellpadding="0" cellspacing="0">
            <tr style="height:330px">
                <td style="width:850px">
                    <table border="0" cellpadding="0" cellspacing="0">
                        <tr style="height:340px">
                            <td style="width:300px; vertical-align:top;height:330px">
                                <fieldset>
                                    <legend style="font-weight:bold; font-size:12px"> Searching Criteria : </legend>
                                    <table border="0" cellpadding="0" cellspacing="2">
                                        <tr>
                                            <td style="width:300px;font-size:12px;">
                                                Transfer No:
                                            </td>
                                        </tr>
                                        <tr>
                                            <td style="width:350px">
                                                @Html.TextBox("txtTransferRequisitionSlipNo", "", new { style = "width: 325px", id = "txtTransferRequisitionSlipNo" })
                                            </td>
                                        </tr>
                                        <tr>
                                            <td style="width:300px;font-size:12px;">
                                                Transfer Date:
                                            </td>
                                        </tr>
                                        <tr>
                                            <td style="width:300px">
                                                <table border="0" cellpadding="0" cellspacing="0">
                                                    <tr>
                                                        <td style="width:97px;font-size:12px;">@Html.DropDownList("cboTRDate", new SelectList(Enum.GetValues(typeof(ESimSol.BusinessObjects.EnumCompareOperator))), new { id = "cboTRDate", style = "width: 97px;font-size:12px;" })</td>
                                                        <td style="width:97px;font-size:12px;"><input type="text" id="txtTRStartDate" value="" style="width: 108px;font-size:12px;" class="easyui-datebox" data-options="formatter:icsdateformat,parser:icsdateparser" /></td>
                                                        <td style="width:9px;font-size:12px;" id="enddateT">To</td>
                                                        <td style="width:97px;font-size:12px;" id="enddate"><input type="text" id="txtTREndDate" value="" style="width: 108px;font-size:12px;" class="easyui-datebox" data-options="formatter:icsdateformat,parser:icsdateparser" /></td>
                                                    </tr>
                                                </table>
                                            </td>
                                        </tr>
                                        <tr>
                                            <td style="width: 130px; text-align: left;font-size:12px;">
                                                Requisition Type :
                                            </td>
                                        </tr>
                                        <tr>
                                            <td style="width: 325px; text-align: left">
                                                <select id="cboRequisitionType" style=" width:320px;"></select>
                                            </td>
                                        </tr>
                                        <tr>
                                            <td style="width: 130px; text-align: left;font-size:12px;">
                                                <label id="lblBusinessUnit">Business Unit :</label>
                                            </td>
                                        </tr>
                                        <tr>
                                            <td style="width: 325px; text-align: left">
                                                <select id="cboBusinessUnit" style=" width:320px;"></select>
                                            </td>
                                        </tr>
                                      
                                        <tr>
                                            <td>
                                                <input type="checkbox" name="chkApproved" id="chkApproved" /><label style="width:150px;font-size:12px;" onclick="IsChecked()">Approved</label>
                                                <input type="checkbox" name="chkNotApproved" id="chkNotApproved" /><label style="width:150px;font-size:12px;" onclick="IsChecked()">Not Approved</label>
                                            </td>
                                        </tr>
                                        <tr style="height:120px; vertical-align:bottom">
                                            <td style=" text-align:left; width:330px;">
                                                <table border="0" cellpadding="0" cellspacing="0">
                                                    <tr>
                                                        <td style=" text-align:left;"><input type="button" value="Reset" id="btnReset" onclick="Reset()" style="width:70px; text-align:left;" /></td>
                                                        <td style=" text-align:right; width:260px;"><input type="button" value="Search" id="btnRefresh" style="width:70px; text-align:right;" /></td>
                                                    </tr>
                                                </table>
                                            </td>
                                        </tr>
                                    </table>
                                </fieldset>
                            </td>
                            <td style="width:400px; vertical-align:top">
                                <div style="margin-left:0px; margin-top:6px; height:330px">
                                    <table id="tblTransferRequisitionSlipsList" title="Transfer Requisition List" class="easyui-datagrid" style="width:400px;height:335px" fitcolumns="false" rownumbers="true" pagination="false" singleselect="false" autorowheight="false">
                                        <thead>
                                            <tr>
                                                <th data-options="field:'Selected',checkbox:true"></th>
                                                <th field="TRSNO" width="80">Transfer No</th>
                                                <th field="TransferStatusSt" width="100">Transfer Status</th>
                                                <th field="IssueDateTimeSt" width="80">Issue Date</th>                                                
                                                <th field="RequisitionTypeSt" width="150">Requisition Type</th>
                                            </tr>
                                        </thead>
                                    </table>
                                </div>
                            </td>

                        </tr>
                    </table>
                </td>
            </tr>
            <tr style="height:50px">
                <td style="width:850px; text-align:right">
                    <a href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-ok" plain="true" onclick="OkButtonClick()">Ok</a>
                    <a href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-cancel" plain="true" onclick="Close()">Close</a>
                </td>
            </tr>
        </table>
    </div>
</div>

<div class="menuMainCollectionTable">
    <table id="tblTransferRequisitionSlips" title="Transfer Requisition List" class="easyui-datagrid" fit="true" fitcolumns="false" rownumbers="true" pagination="true" singleselect="true" autorowheight="false" toolbar="#toolbar">
        <thead>
            <tr>
                <th field="FullTRSNO" width="100">Transfer No</th>
                <th field="RequisitionTypeSt" width="100">Transfer Type</th>
                <th field="IssueDateTimeSt" width="100">Issue Date</th>
                <th field="TransferStatusSt" width="100">Transfer Status</th>
                <th field="IssueStoreName" width="180">Issue Store</th>
                <th field="ReceivedStoreName" width="180">Receive Store</th>
                <th field="PreparedByName" width="180">Prepared By</th>
                <th field="AythorisedByName" width="180">Approved By</th>
                <th field="DisbursedByName" width="180">Disbursed By</th>
                <th field="ReceivedByName" width="180">Received By</th>
                <th field="IsWillVoucherEffectSt" width="80" align="left">Voucher Effect</th>
            </tr>
        </thead>
    </table>
    <div id="toolbar">
        <input type="text" id="txtTransferNo" placeholder="Search By Transfer No" style="width:200px" />
        <a id="btnSearch" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-search" plain="true"></a>
        <a id="btnAdd" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-add" plain="true">Add</a>
        <a id="btnEdit" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-edit" plain="true">Edit</a>
        <a id="btnView" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-details" plain="true">View</a>
        <a id="btnDelete" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-remove" plain="true">Delete</a>
        <a id="btnApprove" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-approved" plain="true">Approve</a>
        <a id="btnUndoApprove" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-undo" plain="true">Undo Approve</a>
        <a id="btnDisburse" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-redo" plain="true">Disburse</a>
        <a id="btnReceive" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-back" plain="true">Receive</a>
        <a id="btnChangeVoucherEffect" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-edit" plain="true">Voucher Effect</a>
        <a id="btnPreview" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-print" plain="true">Preview</a>
        @*<a id="btnPreviewClientCopy" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-print" plain="true">Preview(Client)</a>
        <a id="btnPreviewGatePass" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-print" plain="true">Preview(Gate Pass)</a>
        <a id="btnPreviewClientGatePass" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-print" plain="true">Preview(Client Gate Pass)</a>*@
        <a id="btnPrintList" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-print" plain="true">Print List</a>
    </div>
</div>

<style>
th td
{
    padding:1px;
}
</style>
<script type="text/javascript">
    $(document).ready(function () {
        var oTempTransferRequisitionSlips =@Html.Raw( new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(Model));
        var oBusinessUnits =@Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(ViewBag.BusinessUnits));
        var oRequisitionTypes =@Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(ViewBag.RequisitionTypes));        
        var oAURolesMapping =@Html.Raw( new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(HttpContext.Current.Session[SessionInfo.AuthorizationRolesMapping]));
        var nOPT =@Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(ViewBag.OPT));
        sessionStorage.setItem('OPT', nOPT);
        $('#cboBusinessUnit').data('BusinessUnits', oBusinessUnits);
        $('#cboRequisitionType').data('RequisitionTypes', oRequisitionTypes);

        var oTransferRequisitionSlips =sessionStorage.getItem("TransferRequisitionSlips");
        if(oTransferRequisitionSlips!=null)
        {
            oTransferRequisitionSlips = jQuery.parseJSON(oTransferRequisitionSlips);
        }
        else
        {
            oTransferRequisitionSlips=oTempTransferRequisitionSlips;
        }
        RefreshList(oTransferRequisitionSlips);
        RefreshControlLayout(oAURolesMapping);
        $("#progressbar").progressbar({ value: 0 });
        $("#progressbarParent").hide();
    });

   
    function updateProgress() {
        var value =$('#progressbar').progressbar('getValue');
        if (value < 96){
            value += Math.floor(Math.random() * 10);
            $('#progressbar').progressbar('setValue', value);
        }
    }
    function hideShow(miliseconds) {
        $("#progressbarParent").hide();
    }

    //Search Property
    $("#btnSearch").click(function () {
        debugger;
        $("#winTRSAdvSearch").icsWindow('open', "Advance Search");
        $("#winTRSAdvSearch input").not("input[type='button']").val("");
        $("#winTRSAdvSearch select").val(0);
        SetTodayDate();
        Reset();
        var oBusinessUnits = $('#cboBusinessUnit').data('BusinessUnits');
        var oRequisitionTypes = $('#cboRequisitionType').data('RequisitionTypes');

        $("#cboBusinessUnit").icsLoadCombo({ List: oBusinessUnits, OptionValue: "BusinessUnitID", DisplayText: "Name" });
        $("#cboRequisitionType").icsLoadCombo({ List: oRequisitionTypes, OptionValue: "id", DisplayText: "Value" });

        var nOPT = parseInt(sessionStorage.getItem('OPT'));
        if(nOPT===0)
        {
            $('#lblBusinessUnit').text('Receive Business Unit :');
        }
        else
        {
            $('#lblBusinessUnit').text('Issue Business Unit :');
        }
    });

    function SetTodayDate()
    {
        $('#txtTRStartDate').datebox('setValue', icsdateformat(new Date()));
        $('#txtTREndDate').datebox('setValue', icsdateformat(new Date()));
    }

    $('#cboTRDate').change(function () {
        var x = $("#cboTRDate").val();
        if (x == "EqualTo" || x == "NotEqualTo" || x == "GreaterThen" || x == "SmallerThen") {
            document.getElementById("enddate").style.display = 'none';
            document.getElementById("enddateT").style.display = 'none';
        }
        else {
            document.getElementById("enddate").style.display = '';
            document.getElementById("enddateT").style.display = '';
        }
        if (x == "None")
        {

            $('#txtTRStartDate').datebox('setValue', icsdateformat(new Date()));
            $('#txtTREndDate').datebox('setValue', icsdateformat(new Date()));
        }
    });

    $('#chkApproved').click(function(){
        if (this.checked) {
            document.getElementById("chkNotApproved").checked = false;
        }
    });

    $('#chkNotApproved').click(function(){
        if (this.checked) {
            document.getElementById("chkApproved").checked = false;
        }
    });

    $('#btnRefresh').click(function (){
        var sTransferRequisitionSlipNo = $("#txtTransferRequisitionSlipNo").val();
        var cboTRDate = document.getElementById("cboTRDate");
        var nTransferRequisitionSlipDate=cboTRDate.options[cboTRDate.selectedIndex].index;
        var sStartDate=$('#txtTRStartDate').datebox('getValue');
        var sEndDate=$('#txtTREndDate').datebox('getValue');
        var nRequisitionType = parseInt($('#cboRequisitionType').val());
        var nBusinessUnitID = parseInt($('#cboBusinessUnit').val());
        var nApproved = 0;
        var nNotApproved = 0;
        if(document.getElementById("chkApproved").checked == true)
        {
            nApproved = 1;
        }
        else
        {
            nApproved = 0;
        }
        if(document.getElementById("chkNotApproved").checked == true)
        {
            nNotApproved = 1;
        }
        else
        {
            nNotApproved = 0;
        }
        if(nTransferRequisitionSlipDate === 0 && sTransferRequisitionSlipNo ==="" && nApproved === 0 && nNotApproved === 0 && nRequisitionType===0 && nBusinessUnitID === 0 )
        {
            alert('Please Select a Search Criteria');
            return false;
        }
        var sTempString = nTransferRequisitionSlipDate+'~'+sStartDate+'~'+sEndDate+'~'+sTransferRequisitionSlipNo+'~'+ nApproved +'~'+ nNotApproved+'~'+ nRequisitionType+'~'+nBusinessUnitID+'~'+sessionStorage.getItem('BUID')+'~'+sessionStorage.getItem('OPT');
        $.ajax({
            type: "GET",
            dataType: "json",
            url:  sessionStorage.getItem('BaseAddress')+'/TransferRequisitionSlip/TransferRequisitionSlipsAdvSearch',
            data: { Temp: sTempString },
            contentType: "application/json; charset=utf-8",
            success: function (data) {
                oTransferRequisitionSlips = jQuery.parseJSON(data);
                if (oTransferRequisitionSlips != null) {
                    if(oTransferRequisitionSlips.length>0)
                    {
                        RefreshListForSearch(oTransferRequisitionSlips);
                    }
                    else
                    {
                        alert("Data not found!!");
                        RefreshListForSearch([]);
                    }
                }
            },
            error: function (xhr, status, error) {
                alert(error);
            }
        });
    });

    function Reset()
    {
        $("#winTRSAdvSearch input").not("input[type='button']").val("");
        document.getElementById("enddate").style.display = '';
        document.getElementById("enddateT").style.display = '';
        document.getElementById("chkNotApproved").checked = false;
        document.getElementById("chkApproved").checked = false;
        $('#cboTRDate').val('None');
        $('#cboBusinessUnit').val(0);
        SetTodayDate();
        data ="";
        data={"total":""+data.length+"","rows":data};
        $('#tblTransferRequisitionSlipsList').datagrid('loadData',data);
    }

    function RefreshListForSearch(oTransferRequisitionSlips)
    {
        data =oTransferRequisitionSlips;
        data={"total":""+data.length+"","rows":data};
        $('#tblTransferRequisitionSlipsList').datagrid('loadData',data);

    }

    function Close()
    {
        $("#winTRSAdvSearch").icsWindow('close');
    }

    function OkButtonClick() {

        var oTransferRequisitionSlips=[];
        var oTransferRequisitionSlips = $('#tblTransferRequisitionSlipsList').datagrid('getChecked');
        if(oTransferRequisitionSlips.length<=0)
        {
            alert("please select at least one item");
            return;
        }
        RefreshList(oTransferRequisitionSlips);
        $("#winTRSAdvSearch").icsWindow('close');
    }
    //Adv Search end
    $("#btnChangeVoucherEffect").click(function(){
        var oTransferRequisitionSlip= $('#tblTransferRequisitionSlips').datagrid('getSelected');
        if(oTransferRequisitionSlip==null || parseInt(oTransferRequisitionSlip.TRSID)<=0)
        {
            alert("Please select a item from list!");
            return;
        }

        if(oTransferRequisitionSlip.IsWillVoucherEffect==false)
        {
            if (!confirm("Confirm to Effect?")) return;
            oTransferRequisitionSlip.IsWillVoucherEffect=true;
        }else
        {
            if (!confirm("Confirm to Not Effect?")) return;
            oTransferRequisitionSlip.IsWillVoucherEffect=false;
        }
        var SelectedRowIndex = $('#tblTransferRequisitionSlips').datagrid('getRowIndex', oTransferRequisitionSlip);      
        $.ajax({
            type: "POST",
            dataType: "json",
            url : sessionStorage.getItem('BaseAddress')+"/TransferRequisitionSlip/UpdateVoucherEffect",
            traditional: true,
            data:  JSON.stringify(oTransferRequisitionSlip),
            contentType: "application/json; charset=utf-8",
            success: function (data) {
                var oTransferRequisitionSlip = jQuery.parseJSON(data);
                if (parseInt(oTransferRequisitionSlip.TRSID)>0)
                {
                    alert("Data Saved sucessfully");
                    debugger;
                    $('#tblTransferRequisitionSlips').datagrid('updateRow',{index: SelectedRowIndex,row: oTransferRequisitionSlip});
                }
                else {
                    alert(oTransferRequisitionSlip.ErrorMessage);
                }
            },
            error: function (xhr, status, error) {
                alert(error);
            }
        });
    });

    //Searching End
    $("#txtTransferNo").keyup(function (e) {
        if (e.keyCode == 13) {
            if($.trim($('#txtTransferNo').val())===null || $.trim($('#txtTransferNo').val())==="")
            {
                alert("Press enter with Transfer No!");
                return;
            }
            var nBUID = parseInt(sessionStorage.getItem('BUID'));
            if(nBUID<=0)
            {
                alert("Invalid Business Unit!");
                return;
            }

            var oTransferRequisitionSlip = {
                TRSNO : $("#txtTransferNo").val(),
                OPT : parseInt(sessionStorage.getItem('OPT')),
                IssueBUID : nBUID
            };

            $.ajax({
                type: "POST",
                dataType: "json",
                url: sessionStorage.getItem('BaseAddress') + "/TransferRequisitionSlip/GetsByTransferNo",
                traditional: true,
                data: JSON.stringify(oTransferRequisitionSlip),
                contentType: "application/json; charset=utf-8",
                success: function (data) {
                    var oTransferRequisitionSlips = jQuery.parseJSON(data);
                    if (oTransferRequisitionSlips != null) {
                        if (oTransferRequisitionSlips.length > 0) {
                            DynamicRefreshList(oTransferRequisitionSlips, "tblTransferRequisitionSlips");
                        }
                        else {
                            //alert("There is no Data!");
                            DynamicRefreshList([], "tblTransferRequisitionSlips");
                        }
                    } else {
                        //alert("There is no Data!");
                        DynamicRefreshList([], "tblTransferRequisitionSlips");
                    }
                },
                error: function (xhr, status, error) {
                    alert(error);
                }
            });
        }
    });

    $("#btnAdd").click(function(){
        var oTransferRequisitionSlips= $('#tblTransferRequisitionSlips').datagrid('getRows');
        sessionStorage.setItem("TransferRequisitionSlips", JSON.stringify(oTransferRequisitionSlips));
        sessionStorage.setItem("SelectedRowIndex", -1);
        sessionStorage.setItem("TransferRequisitionSlipHeader", "Add Transfer Requisition");
        sessionStorage.setItem("BUID", sessionStorage.getItem('BUID'));
        sessionStorage.setItem("BackLink", window.location.href);
        var tsv=((new Date()).getTime())/1000;
        window.location.href = sessionStorage.getItem('BaseAddress')+ "/TransferRequisitionSlip/View_TransferRequisitionSlip?id=0&buid="+sessionStorage.getItem('BUID');
    });

    $("#btnEdit").click(function(){
        var oTransferRequisitionSlip= $('#tblTransferRequisitionSlips').datagrid('getSelected');
        if(oTransferRequisitionSlip==null || oTransferRequisitionSlip.TRSID<=0)
        {
            alert("Please select a item from list!");
            return;
        }
        if(parseInt(oTransferRequisitionSlip.TransferStatusInt)!=0)
        {
            alert("Please select Only Intialize item from list!");
            return;
        }

        var SelectedRowIndex=$('#tblTransferRequisitionSlips').datagrid('getRowIndex',oTransferRequisitionSlip);
        var oTransferRequisitionSlips= $('#tblTransferRequisitionSlips').datagrid('getRows');
        sessionStorage.setItem("TransferRequisitionSlips", JSON.stringify(oTransferRequisitionSlips));
        sessionStorage.setItem("SelectedRowIndex", SelectedRowIndex);
        sessionStorage.setItem("TransferRequisitionSlipHeader", "Edit Transfer Requisition");
        sessionStorage.setItem("BUID", sessionStorage.getItem('BUID'));
        sessionStorage.setItem("BackLink", window.location.href);
        window.location.href = sessionStorage.getItem('BaseAddress')+ "/TransferRequisitionSlip/View_TransferRequisitionSlip?id="+  parseInt(oTransferRequisitionSlip.TRSID) +"&buid="+parseInt(oTransferRequisitionSlip.IssueBUID);
    });

    $("#btnView").click(function(){
        var oTransferRequisitionSlip= $('#tblTransferRequisitionSlips').datagrid('getSelected');
        if(oTransferRequisitionSlip==null || oTransferRequisitionSlip.TRSID<=0)
        {
            alert("Please select a item from list!");
            return;
        }
        var tsv=((new Date()).getTime())/1000;
        var SelectedRowIndex=$('#tblTransferRequisitionSlips').datagrid('getRowIndex',oTransferRequisitionSlip);
        var oTransferRequisitionSlips= $('#tblTransferRequisitionSlips').datagrid('getRows');
        sessionStorage.setItem("TransferRequisitionSlips", JSON.stringify(oTransferRequisitionSlips));
        sessionStorage.setItem("SelectedRowIndex", SelectedRowIndex);
        sessionStorage.setItem("TransferRequisitionSlipHeader", "View Transfer Requisition");
        sessionStorage.setItem("BUID", sessionStorage.getItem('BUID'));
        sessionStorage.setItem("BackLink", window.location.href);
        window.location.href = sessionStorage.getItem('BaseAddress')+ "/TransferRequisitionSlip/View_TransferRequisitionSlip?id="+  parseInt(oTransferRequisitionSlip.TRSID) +"&buid="+parseInt(oTransferRequisitionSlip.IssueBUID);
    });

    $("#btnDelete").click(function(){
        var oTransferRequisitionSlip= $('#tblTransferRequisitionSlips').datagrid('getSelected');
        if(oTransferRequisitionSlip==null || oTransferRequisitionSlip.TRSID<=0)
        {
            alert("Invalid Field!!! please select a valid Field!");
            return false;
        }
        if(parseInt(oTransferRequisitionSlip.TransferStatusInt)!=0)
        {
            alert("Please select Only Intialize item from list!");
            return;
        }
        if (!confirm("Confirm to Delete?")) return ;
        var SelectedRowIndex=$('#tblTransferRequisitionSlips').datagrid('getRowIndex',oTransferRequisitionSlip);
        if (oTransferRequisitionSlip.TRSID > 0)
        {
            $.ajax
            ({
                type: "POST",
                dataType: "json",
                url : sessionStorage.getItem('BaseAddress')+  "/TransferRequisitionSlip/Delete",
                data: JSON.stringify(oTransferRequisitionSlip),
                contentType: "application/json; charset=utf-8",
                success: function (data) {
                    var feedbackmessage = jQuery.parseJSON(data);
                    if (feedbackmessage === "Deleted")
                    {
                        alert("Delete sucessfully");
                        $('#tblTransferRequisitionSlips').datagrid('deleteRow',SelectedRowIndex);
                        var oTransferRequisitionSlips= $('#tblTransferRequisitionSlips').datagrid('getRows');
                        sessionStorage.setItem("TransferRequisitionSlips", JSON.stringify(oTransferRequisitionSlips));
                    }
                    else
                    {
                        alert(feedbackmessage);
                    }
                },
                error: function (xhr, status, error)
                {
                    alert(error);
                }
            });
        }
    });

    $("#btnApprove").click(function(){
        var oTransferRequisitionSlip= $('#tblTransferRequisitionSlips').datagrid('getSelected');
        if(oTransferRequisitionSlip==null || oTransferRequisitionSlip.TRSID<=0)
        {
            alert("Invalid Field!!! please select a valid Field!");
            return false;
        }
        if(parseInt(oTransferRequisitionSlip.TransferStatusInt)!=0)
        {
            alert("Please select Only Intialize item from list!");
            return;
        }
        if (!confirm("Confirm to Approved?")) return ;
        var SelectedRowIndex=$('#tblTransferRequisitionSlips').datagrid('getRowIndex',oTransferRequisitionSlip);
        if (oTransferRequisitionSlip.TRSID > 0)
        {
            $.ajax
            ({
                type: "POST",
                dataType: "json",
                url : sessionStorage.getItem('BaseAddress')+  "/TransferRequisitionSlip/Approved",
                data: JSON.stringify(oTransferRequisitionSlip),
                contentType: "application/json; charset=utf-8",
                success: function (data) {
                    var oTransferRequisitionSlip = jQuery.parseJSON(data);
                    if (oTransferRequisitionSlip.ErrorMessage === "")
                    {
                        alert("Approved sucessfully");
                        $('#tblTransferRequisitionSlips').datagrid('updateRow',{index:SelectedRowIndex, row : oTransferRequisitionSlip});
                    }
                    else
                    {
                        alert(oTransferRequisitionSlip.ErrorMessage);
                    }
                },
                error: function (xhr, status, error)
                {
                    alert(error);
                }
            });
        }
    });
    $("#btnUndoApprove").click(function(){
        var oTransferRequisitionSlip= $('#tblTransferRequisitionSlips').datagrid('getSelected');
        if(oTransferRequisitionSlip==null || oTransferRequisitionSlip.TRSID<=0)
        {
            alert("Invalid Field!!! please select a valid Field!");
            return false;
        }
        if(parseInt(oTransferRequisitionSlip.AuthorisedByID)==0)
        {
            alert("Please select Only Approved item from list!");
            return;
        }
        if(parseInt(oTransferRequisitionSlip.DisburseByUserID)!=0)
        {
            alert("Sorry, Already Disbursed.");
            return;
        }
        if (!confirm("Confirm to Undo Approved?")) return ;
        var SelectedRowIndex=$('#tblTransferRequisitionSlips').datagrid('getRowIndex',oTransferRequisitionSlip);
        if (oTransferRequisitionSlip.TRSID > 0)
        {
            $.ajax
            ({
                type: "POST",
                dataType: "json",
                url : sessionStorage.getItem('BaseAddress')+  "/TransferRequisitionSlip/UndoApproved",
                data: JSON.stringify(oTransferRequisitionSlip),
                contentType: "application/json; charset=utf-8",
                success: function (data) {
                    var oTransferRequisitionSlip = jQuery.parseJSON(data);
                    if (oTransferRequisitionSlip.ErrorMessage === "")
                    {
                        alert("Sucessfully Undo Approved.");
                        $('#tblTransferRequisitionSlips').datagrid('updateRow',{index:SelectedRowIndex, row : oTransferRequisitionSlip});
                    }
                    else
                    {
                        alert(oTransferRequisitionSlip.ErrorMessage);
                    }
                },
                error: function (xhr, status, error)
                {
                    alert(error);
                }
            });
        }
    });

    $("#btnDisburse").click(function(){
        var oTransferRequisitionSlip= $('#tblTransferRequisitionSlips').datagrid('getSelected');
        if(oTransferRequisitionSlip==null || oTransferRequisitionSlip.TRSID<=0)
        {
            alert("Invalid Field!!! please select a valid Field!");
            return false;
        }
        if(parseInt(oTransferRequisitionSlip.TransferStatusInt)!=2)
        {
            alert("Please select Only Approved item from list!");
            return;
        }
        if (!confirm("Confirm to Disburse?")) return ;
        var SelectedRowIndex=$('#tblTransferRequisitionSlips').datagrid('getRowIndex',oTransferRequisitionSlip);
        if (oTransferRequisitionSlip.TRSID > 0)
        {
            $.ajax
            ({
                type: "POST",
                dataType: "json",
                url : sessionStorage.getItem('BaseAddress')+  "/TransferRequisitionSlip/Disburse",
                data: JSON.stringify(oTransferRequisitionSlip),
                contentType: "application/json; charset=utf-8",
                success: function (data) {
                    var oTransferRequisitionSlip = jQuery.parseJSON(data);
                    if (oTransferRequisitionSlip.ErrorMessage === "")
                    {
                        alert("Disburse sucessfully");
                        $('#tblTransferRequisitionSlips').datagrid('updateRow',{index:SelectedRowIndex, row : oTransferRequisitionSlip});
                    }
                    else
                    {
                        alert(oTransferRequisitionSlip.ErrorMessage);
                    }
                },
                error: function (xhr, status, error)
                {
                    alert(error);
                }
            });
        }
    });

    $("#btnReceive").click(function(){
        var oTransferRequisitionSlip= $('#tblTransferRequisitionSlips').datagrid('getSelected');
        if(oTransferRequisitionSlip==null || oTransferRequisitionSlip.TRSID<=0)
        {
            alert("Invalid Field!!! please select a valid Field!");
            return false;
        }
        if(parseInt(oTransferRequisitionSlip.TransferStatusInt)!=3)
        {
            alert("Please select Only Disbursed item from list!");
            return;
        }
        if (!confirm("Confirm to Received?")) return ;
        var SelectedRowIndex=$('#tblTransferRequisitionSlips').datagrid('getRowIndex',oTransferRequisitionSlip);
        if (oTransferRequisitionSlip.TRSID > 0)
        {
            $.ajax
            ({
                type: "POST",
                dataType: "json",
                url : sessionStorage.getItem('BaseAddress')+  "/TransferRequisitionSlip/Received",
                data: JSON.stringify(oTransferRequisitionSlip),
                contentType: "application/json; charset=utf-8",
                success: function (data) {
                    var oTransferRequisitionSlip = jQuery.parseJSON(data);
                    if (oTransferRequisitionSlip.ErrorMessage === "")
                    {
                        alert("Received sucessfully");
                        $('#tblTransferRequisitionSlips').datagrid('updateRow',{index:SelectedRowIndex, row : oTransferRequisitionSlip});
                    }
                    else
                    {
                        alert(oTransferRequisitionSlip.ErrorMessage);
                    }
                },
                error: function (xhr, status, error)
                {
                    alert(error);
                }
            });
        }
    });

    $('#btnPrintList').click(function(){
        var oTransferRequisitionSlips=$('#tblTransferRequisitionSlips').datagrid('getRows');
        if(oTransferRequisitionSlips.length<=0)
        {
            alert("Sorry, there is no data to Print");
        }
        var ids = ICS_PropertyConcatation(oTransferRequisitionSlips, 'TRSID');
        var oTransferRequisitionSlip = {Param:ids};
        $.ajax({
            type: "POST",
            dataType: "json",
            url : sessionStorage.getItem('BaseAddress')+  "/TransferRequisitionSlip/SetTransferRequisitionSlipListData",
            traditional: true,
            data:  JSON.stringify(oTransferRequisitionSlip),
            contentType: "application/json; charset=utf-8",
            success: function (data) {
                var sFeedBackMessage = jQuery.parseJSON(data);
                if (sFeedBackMessage==="Successful")
                {
                    window.open (sessionStorage.getItem('BaseAddress')+ "/TransferRequisitionSlip/PrintTransferRequisitionSlips");
                }
            },
            error: function (xhr, status, error) {
                alert(error);
            }
        });


    });

    $('#btnPreview').click(function(){
        var oTransferRequisitionSlip=$('#tblTransferRequisitionSlips').datagrid('getSelected');
        if(oTransferRequisitionSlip==null || parseInt(oTransferRequisitionSlip.TRSID)<=0)
        {
            alert("Please select Transfer Requisition ");
            return;
        }
        window.open(sessionStorage.getItem('BaseAddress')+ "/TransferRequisitionSlip/TransferRequisitionSlipPrintPreview?id="+oTransferRequisitionSlip.TRSID+"&copy=Office Copy");
    });

    //$('#btnPreviewClientCopy').click(function(){
    //    var oTransferRequisitionSlip=$('#tblTransferRequisitionSlips').datagrid('getSelected');
    //    if(oTransferRequisitionSlip==null || parseInt(oTransferRequisitionSlip.TRSID)<=0)
    //    {
    //        alert("Please select Transfer Requisition ");
    //        return;
    //    }
    //    window.open(sessionStorage.getItem('BaseAddress')+ "/TransferRequisitionSlip/TransferRequisitionSlipPrintPreview?id="+oTransferRequisitionSlip.TRSID+"&copy=Client Copy");
    //});

    //$('#btnPreviewGatePass').click(function(){
    //    var oTransferRequisitionSlip=$('#tblTransferRequisitionSlips').datagrid('getSelected');
    //    if(oTransferRequisitionSlip==null || parseInt(oTransferRequisitionSlip.TRSID)<=0)
    //    {
    //        alert("Please select Transfer Requisition ");
    //        return;
    //    }
    //    window.open(sessionStorage.getItem('BaseAddress')+ "/TransferRequisitionSlip/TransferRequisitionSlipPrintPreview?id="+oTransferRequisitionSlip.TRSID);//+"&copy=Gate Pass"
    //});

    //$('#btnPreviewClientGatePass').click(function(){
    //    var oTransferRequisitionSlip=$('#tblTransferRequisitionSlips').datagrid('getSelected');
    //    if(oTransferRequisitionSlip==null || parseInt(oTransferRequisitionSlip.TRSID)<=0)
    //    {
    //        alert("Please select Transfer Requisition ");
    //        return;
    //    }
    //    window.open(sessionStorage.getItem('BaseAddress')+ "/TransferRequisitionSlip/TransferRequisitionSlipPrintPreview?id="+oTransferRequisitionSlip.TRSID+"&copy=Client Gate Pass");
    //});


    function RefreshList(oTransferRequisitionSlips)
    {
        var data=oTransferRequisitionSlips;
        data={"total":""+data.length+"","rows":data};
        $('#tblTransferRequisitionSlips').datagrid('loadData',data);
        var nIndex= parseInt(sessionStorage.getItem("SelectedRowIndex"));
        $('#tblTransferRequisitionSlips').datagrid('selectRow',nIndex);
    }

    function RefreshControlLayout(oAURolesMapping)
    {
        debugger;
        $("#btnSearch").hide();
        $("#btnAdd").hide();
        $("#btnEdit").hide();
        $("#btnView").hide();
        $("#btnDelete").hide();
        $("#btnApprove").hide();
        $("#btnDisburse").hide();
        $("#btnReceive").hide();
        $("#btnPreview").hide();
        $("#btnPrintList").hide();
        $("#btnUndoApprove").hide();
        $("#btnChangeVoucherEffect").hide();

        if(PermissionChecker('AdvSearch','TransferRequisitionSlip',oAURolesMapping)){$("#btnSearch").show();}
        if(PermissionChecker('Add','TransferRequisitionSlip',oAURolesMapping)){$("#btnAdd").show();}
        if(PermissionChecker('Edit','TransferRequisitionSlip',oAURolesMapping)){$("#btnEdit").show();}
        if(PermissionChecker('View','TransferRequisitionSlip',oAURolesMapping)){$("#btnView").show();}
        if(PermissionChecker('Delete','TransferRequisitionSlip', oAURolesMapping)){$("#btnDelete").show();}
        if(PermissionChecker('Approved','TransferRequisitionSlip', oAURolesMapping)){$("#btnApprove").show();}
        if(PermissionChecker('Disburse','TransferRequisitionSlip', oAURolesMapping)){$("#btnDisburse").show();}
        if(PermissionChecker('Received','TransferRequisitionSlip', oAURolesMapping)){$("#btnReceive").show();}
        if(PermissionChecker('Preview','TransferRequisitionSlip', oAURolesMapping)){$("#btnPreview").show();}
        if(PermissionChecker('PrintList','TransferRequisitionSlip', oAURolesMapping)){$("#btnPrintList").show();}
        if(PermissionChecker('UnApproved','TransferRequisitionSlip', oAURolesMapping)){$("#btnUndoApprove").show();}
        if(PermissionChecker('VoucherModify','TransferRequisitionSlip', oAURolesMapping)){$("#btnChangeVoucherEffect").show();}

        //OPT = 0 means TransferRequisitionSlip Issue & OPT = 1 means TransferRequisitionSlip Received
        var nOPT = parseInt(sessionStorage.getItem('OPT'));
        if(nOPT === 0)
        {
            $("#btnReceive").hide();
        }
        else if(nOPT === 1)
        {
            $("#btnAdd").hide();
            $("#btnEdit").hide();
            $("#btnDelete").hide();
            $("#btnApprove").hide();
            $("#btnDisburse").hide();
        }
    }
</script>