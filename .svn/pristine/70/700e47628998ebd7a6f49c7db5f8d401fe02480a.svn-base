@{
    ViewBag.Title = "Order Recap Report";
}
@model IEnumerable<ESimSol.BusinessObjects.OrderRecap>
  <div class="menuMainCollectionTable" id="divOR">
      <div id="divParty" class="easyui-panel" title="Order Recap Report" style="font-family:Tahoma;width:101%;height:88%;">
          <fieldset>
              <legend style="font-weight: bold; font-size: 12px">Searching Criteria : </legend>
              <table border="0" cellpadding="3" cellspacing="2" style=" height:225px;" style="font-size: 12px">
                  <tr>
                      <td style="width: 150px; text-align: right; font-weight: bold">
                          Order No:
                      </td>
                      <td style="width: 400px; text-align: left">
                          @Html.TextBox("txtOrderRecapNo", "", new { style = "width: 326px", id = "txtOrderRecapNo" })
                      </td>
                      <td style="width: 150px; text-align: right; font-weight: bold">
                          Style No:
                      </td>
                      <td style="width: 250px; text-align: left">
                          @Html.TextBox("txtStyleNo", "", new { style = "width: 243px", id = "txtStyleNo" })
                      </td>
                  </tr>

                  <tr>
                      <td style="width: 150px; text-align: right; font-weight: bold">
                          Buyer :
                      </td>
                      <td style="width: 400px; text-align: left">
                          @Html.TextBox("txtBuyerName", "", new { style = "width: 287px", id = "txtBuyerName" })<input type="button" id="btnBuyer" style="width: 40px; font-size: 12px" value="Pick" />
                      </td>
                      <td style="width: 150px; text-align: right; font-weight: bold">
                          Product Category :
                      </td>
                      <td style="width: 250px; text-align: left">
                          <select id="cboProductCategory" style="width:100%"></select>
                      </td>
                  </tr>

                  <tr>
                      <td style="width: 150px; text-align: right; font-weight: bold">
                          Order Date:
                      </td>
                      <td style="width: 400px; text-align: left; font-size: 12px">
                          <table border="0" style="font-size: 12px">
                              <tr>
                                  <td style="width: 85px; font-size: 12px; text-align: left">
                                      @Html.DropDownList("cboOrderDate", new SelectList(Enum.GetValues(typeof(ESimSol.BusinessObjects.EnumCompareOperator))), new { id = "cboOrderDate", style = "width: 85px;font-size:12px;text-align:left", @class = "_select_changeA" })
                                  </td>
                                  <td style="width: 100px; font-size: 12px">
                                      <input id="txtOrderStartDate" type="text" style="width: 110px;" class="easyui-datebox"
                                             required="required" data-options="formatter:icsdateformat,parser:icsdateparser" />
                                  </td>
                                  <td style="width: 9px; font-size: 12px" id="enddateT">
                                      To
                                  </td>
                                  <td style="width: 110px; font-size: 12px" id="enddate">
                                      <input id="txtOrderEndDate" type="text" style="width: 110px;" class="easyui-datebox"
                                             required="required" data-options="formatter:icsdateformat,parser:icsdateparser" />
                                  </td>
                              </tr>
                          </table>
                      </td>
                      <td style="width: 150px; text-align: right; font-weight: bold; vertical-align: middle">
                          Merchandiser:
                      </td>
                      <td style="width: 250px; text-align: left; font-size: 12px; height:35px;">
                          @Html.TextBox("txtMerchandiserName", "", new { style = "width:203px", id = "txtMerchandiserName" })<input type="button" style="width: 40px; font-size: 12px" id="btnPickMerchandiser" value="Pick" />
                      </td>
                  </tr>

                  <tr>
                      <td style="width: 150px; text-align: right; font-weight: bold">
                          Shipment Date:
                      </td>
                      <td style="width: 400px; text-align: left; font-size: 12px">
                          <table border="0" style="font-size: 12px">
                              <tr>
                                  <td style="width: 85px; font-size: 12px; text-align: left">
                                      @Html.DropDownList("cboShipmentDate", new SelectList(Enum.GetValues(typeof(ESimSol.BusinessObjects.EnumCompareOperator))), new { id = "cboShipmentDate", style = "width: 85px;font-size:12px;text-align:left", @class = "_select_changeB" })
                                  </td>
                                  <td style="width: 110px; font-size: 12px">
                                      <input id="txtShipmentStartDate" type="text" style="width: 110px;" class="easyui-datebox"
                                             required="required" data-options="formatter:icsdateformat,parser:icsdateparser" />
                                  </td>
                                  <td style="width: 9px; font-size: 12px" id="SampleT">
                                      To
                                  </td>
                                  <td style="width: 110px; font-size: 12px" id="Sampleenddate">
                                      <input id="txtShipmentEndDate" type="text" style="width: 110px;" class="easyui-datebox"
                                             required="required" data-options="formatter:icsdateformat,parser:icsdateparser" />
                                  </td>
                              </tr>
                          </table>
                      </td>
                      <td style="width: 150px; text-align: right; font-weight: bold;  height:30px;">
                          Session:
                      </td>
                      <td style="width: 250px; text-align: left; font-size: 12px; height:40px;">
                          <select id="cboSession" style="width:250px;"></select>
                      </td>

                  </tr>

                  <tr>
                      <td style="width: 150px; text-align: right; font-weight: bold">
                          Qty Range:
                      </td>
                      <td style="width: 400px; text-align: left; font-size: 12px">
                          <table border="0" style="font-size: 12px">
                              <tr>
                                  <td style="width: 90px; font-size: 12px; text-align: left">
                                      @Html.DropDownList("cboOrderQty", new SelectList(Enum.GetValues(typeof(ESimSol.BusinessObjects.EnumCompareOperator))), new { id = "cboOrderQty", style = "width: 90px;font-size:12px;text-align:left", @class = "_select_changeC" })
                                  </td>
                                  <td style="width: 110px; font-size: 12px">
                                      <input id="txtOrderStartQty" type="text" style="width: 102px; text-align:right;" />
                                  </td>
                                  <td style="width: 9px; font-size: 12px" id="OrderqtyT">
                                      To
                                  </td>
                                  <td style="width: 110px; font-size: 12px" id="OrderqtyTo">
                                      <input id="txtOrderEndQty" type="text" style="width: 103px;text-align:right;" />
                                  </td>
                              </tr>
                          </table>
                      </td>
                      <td style="width: 150px; text-align: right; font-weight: bold">
                          Gender/Dept:
                      </td>
                      <td style="width:250px; text-align: right; font-size: 12px; height:40px;">
                          <table border="0" cellpadding="0" cellspacing="0" width="100%">
                              <tr>
                                  <td style="width:50%"><select id="cboGender" style="width:100%;"></select></td>
                                  <td style="width:50%"><select id="cboSubGender" style="width:100%;"></select></td>
                              </tr>
                          </table>
                      </td>
                  </tr>

                  <tr>
                      <td style="width: 150px; text-align: right; font-weight: bold">
                          FOB Range:
                      </td>
                      <td style="width: 400px; text-align: left; font-size: 12px">
                          <table border="0" style="font-size: 12px">
                              <tr>
                                  <td style="width: 90px; font-size: 12px; text-align: left">
                                      @Html.DropDownList("cboFOB", new SelectList(Enum.GetValues(typeof(ESimSol.BusinessObjects.EnumCompareOperator))), new { id = "cboFOB", style = "width: 90px;font-size:12px;text-align:left", @class = "_select_changeD" })
                                  </td>
                                  <td style="width: 110px; font-size: 12px">
                                      <input id="txtFOBStartQty" type="text" style="width: 102px; text-align:right;" />
                                  </td>
                                  <td style="width: 9px; font-size: 12px" id="FOBT">
                                      To
                                  </td>
                                  <td style="width: 110px; font-size: 12px" id="FOBTo">
                                      <input id="txtFOBEndQty" type="text" style="width: 103px; text-align:right;" />
                                  </td>
                              </tr>
                          </table>
                      </td>
                      <td style="width: 150px; text-align: right; font-weight: bold;  height:30px;  vertical-align: bottom">
                          Status:
                      </td>
                      <td style="width: 250px; text-align: left; font-size: 12px; height:40px; vertical-align: middle" rowspan="4">
                          <table id="tblStatusLoad" title="" class="easyui-datagrid" style="width: 250px; height: 140px;
                        font-size: 12px" fitcolumns="false" rownumbers="true" pagination="false" singleselect="false"
                                 autorowheight="false">
                              <thead>
                                  <tr>
                                      <th data-options="field:'Selected',checkbox:true">
                                      </th>
                                      <th field="Value" width="170">
                                          Order Recap Status
                                      </th>
                                  </tr>
                              </thead>
                          </table>
                      </td>
                  </tr>

                  <tr>
                      <td style="width: 150px; text-align: right; font-weight: bold">
                          Agent :
                      </td>
                      <td style="width: 400px; text-align: left">
                          @Html.TextBox("txtAgentName", "", new { style = "width: 288px", id = "txtAgentName" })<input type="button" style="width: 40px; font-size: 12px" id="btnAgent" value="Pick" />
                      </td>
                      <td style="width: 150px; text-align: right; font-weight: bold"></td>
                  </tr>
                  <tr>
                      <td style="width: 150px; text-align: right; font-weight: bold">
                          Style Type:
                      </td>
                      <td style="width: 400px; text-align: left">
                          <select id="cboTSType" style="width:335px;">
                              <option value="-1">--Select One--</option>
                              <option value="0">Sweater</option>
                              <option value="1">Knit</option>
                              <option value="2">Woven</option>
                          </select>
                      </td>
                      <td style="width: 150px; text-align: right; font-weight: bold"></td>
                  </tr>
                  <tr>
                      <td style="width: 150px; text-align: right; font-weight: bold">
                          <input type="button" value="Reset" id="btnReset" style="width: 70px; font-size: 12px" />
                      </td>
                      <td style="width: 400px; text-align: left">
                          <input type="checkbox" style="font-weight:bold; color:green; text-align:right;" id="chkIsrunning"><label id="lblRunning" style="font-weight:bold; color:green; font-size:12px;"> Running</label>
                      </td>
                      <td style="width: 150px; text-align: right; font-weight: bold"></td>
                  </tr>
              </table>
          </fieldset>
        </div>
          <fieldset style="height:50px; vertical-align:middle;text-align:right;">
              <legend style="font-size: 12px; font-weight:bold;">Action </legend>
              <table border="0" cellpadding="0" cellspacing="0" style="text-align:right;font-weight:bold;color:green;">
                  <tr>
                      <td style="text-align:right; width:65%; vertical-align:middle;">
                          Report Layout :
                      </td>
                      <td style="text-align: left; width:35%;font-weight:bold;">
                          <select style="width:200px" id="cboReportLayout"></select>
                          <input type="button" value="Print" id="btnPrintBuyingCom" style="width: 50px; font-size: 12px" />
                          <input type="button" value="Print" id="btnPrint" style="width: 50px; font-size: 12px" />
                          <input type="button" value="XL" id="btnPrintXL" style="width: 50px; font-size: 12px" />
                          <input type="button" value="XL" id="btnPrintBuyingComXL" style="width:50px; font-size: 12px" />
                      </td>
              </table>
          </fieldset>
      </div>
<script type="text/javascript">
    var _oOrderRecaps=[];
    var _sBaseAddress="";
    $(document).ready(function () {
    _oOrderRecaps =@Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(Model));
    _sBaseAddress =@Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(HttpContext.Current.Session[SessionInfo.BaseAddress]));
    var oBusinessSessions =@Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(ViewBag.BusinessSessions));
    var oSubGenders = @Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(ViewBag.SubGenders));
    var oStyleDepartments = @Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(ViewBag.StyleDepartments));
    var oReportFormats = @Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(ViewBag.ReportFormats));
    var bCommissionStatement = @Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(ViewBag.CommissionStatement));
    var nBUID = @Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(ViewBag.BUID));
    var oOrderRecapStatus = @Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(ViewBag.OrderRecapStatus));
    var oProductCategories = @Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(ViewBag.ProductCategories));
    $('#divOR').data('BuyerIDs',"");
    $('#divOR').data('AgentIDs',"");
    $('#divOR').data('MerchandiserIDs',"");
    sessionStorage.setItem("BUID",nBUID);
    SetTodayDate();
    RefreshStatusList(oOrderRecapStatus);
    $("#cboSession").icsLoadCombo({ List: oBusinessSessions, OptionValue: "BusinessSessionID", DisplayText: "SessionName" });
    $("#cboGender").icsLoadCombo({ List:oStyleDepartments, OptionValue:"StyleDepartmentID",DisplayText:"Name" });
    $("#cboSubGender").icsLoadCombo({ List:oSubGenders, OptionValue:"id",DisplayText:"Value" });
    $("#cboReportLayout").icsLoadCombo({ List:oReportFormats, OptionValue:"id",DisplayText:"Value" });
    $("#cboProductCategory").icsLoadCombo({ List: oProductCategories, OptionValue: "ProductCategoryID", DisplayText: "ProductCategoryName" });
    $("#cboTSType").val(-1);
    $('#txtOrderStartQty').numberbox({min:0.0, precision:2});
    $('#txtOrderEndQty').numberbox({min:0, precision:2});
    $('#txtFOBStartQty').numberbox({min:0, precision:2});
    $('#txtFOBEndQty').numberbox({min:0, precision:2 });
    SetValue();
    if(bCommissionStatement)
    {
        $('#btnPrintXL,#btnPrint').hide();
    }else{
        $('#btnPrintBuyingCom,#btnPrintBuyingComXL').hide();
    }
});

function SetValue()
{
    $('#txtOrderStartQty').numberbox('setValue', 0);
    $('#txtOrderEndQty').numberbox('setValue', 0);
    $('#txtFOBStartQty').numberbox('setValue', 0);
    $('#txtFOBEndQty').numberbox('setValue', 0);
}

function SetTodayDate()
{
    $('#txtOrderStartDate').datebox('setValue', icsdateformat(new Date()));
    $('#txtOrderEndDate').datebox('setValue', icsdateformat(new Date()));
    $('#txtShipmentStartDate').datebox('setValue', icsdateformat(new Date()));
    $('#txtShipmentEndDate').datebox('setValue', icsdateformat(new Date()));

}

$('._select_changeA').change(function () {
    //
    var x = $("#cboOrderDate").val();
    if (x == "EqualTo" || x == "NotEqualTo" || x == "GreaterThen" || x == "SmallerThen") {
        document.getElementById("enddate").style.display = 'none';
        document.getElementById("enddateT").style.display = 'none';
    }
    else {
        document.getElementById("enddate").style.display = '';
        document.getElementById("enddateT").style.display = '';
    }
});

$('._select_changeB').change(function () {
    //
    var x = $("#cboShipmentDate").val();
    if (x == "EqualTo" || x == "NotEqualTo" || x == "GreaterThen" || x == "SmallerThen") {
        document.getElementById("Sampleenddate").style.display = 'none';
        document.getElementById("SampleT").style.display = 'none';
    }
    else {
        document.getElementById("Sampleenddate").style.display = '';
        document.getElementById("SampleT").style.display = '';
    }
});

$('._select_changeC').change(function () {
    //
    var x = $("#cboOrderQty").val();
    if (x == "EqualTo" || x == "NotEqualTo" || x == "GreaterThen" || x == "SmallerThen") {
        document.getElementById("OrderqtyTo").style.display = 'none';
        document.getElementById("OrderqtyT").style.display = 'none';
    }
    else {
        document.getElementById("OrderqtyTo").style.display = '';
        document.getElementById("OrderqtyT").style.display = '';
    }
});

$('._select_changeD').change(function () {
    //
    var x = $("#cboFOB").val();
    if (x == "EqualTo" || x == "NotEqualTo" || x == "GreaterThen" || x == "SmallerThen") {
        document.getElementById("FOBTo").style.display = 'none';
        document.getElementById("FOBT").style.display = 'none';
    }
    else {
        document.getElementById("FOBTo").style.display = '';
        document.getElementById("FOBT").style.display = '';
    }
});


function  icsdateformat(date)
{
    //
    var mthNames = ["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];
    var y = date.getFullYear();
    var m = date.getMonth();
    var d = date.getDate();
    //return m+'/'+d+'/'+y;
    var result= d +' '+ mthNames[m]+' '+ y;
    return result
}

function RefreshStatusList(oLoadOrderRecapStatus)
{
    data=oLoadOrderRecapStatus;
    data={"total":""+data.length+"","rows":data};
    $('#tblStatusLoad').datagrid('loadData',data);
}




    $('#btnPrint').click(function () {
        debugger;
        /* order Date*/
        var cboOrderDate = document.getElementById("cboOrderDate");
        var nInqueryDate=cboOrderDate.options[cboOrderDate.selectedIndex].index;
        var dOrderStartDate=$('#txtOrderStartDate').datebox('getValue');
        var dOrderEndDate=$('#txtOrderEndDate').datebox('getValue');

        /* Shipment Date*/
        var cboShipmentDate = document.getElementById("cboShipmentDate");
        var nShipmentDate=cboShipmentDate.options[cboShipmentDate.selectedIndex].index;
        var dShipmentStartDate=$('#txtShipmentStartDate').datebox('getValue');
        var dShipmentEndDate=$('#txtShipmentEndDate').datebox('getValue');

        /* Order Qty*/
        var cboOrderQty = document.getElementById("cboOrderQty");
        var ncboOrderQty = cboOrderQty.options[cboOrderQty.selectedIndex].index;
        var nStartOrderQty = $('#txtOrderStartQty').numberbox('getValue');
        var nEndOrderQty = $('#txtOrderEndQty').numberbox('getValue');

        /* FOB*/
        var cboFOB = document.getElementById("cboFOB");
        var ncboFOB=cboFOB.options[cboFOB.selectedIndex].index;
        var nStartFOBQty = $('#txtFOBStartQty').numberbox('getValue');
        var nEndFOBQty = $('#txtFOBEndQty').numberbox('getValue');

        var sOrderNo= document.getElementById("txtOrderRecapNo").value;
        var sStyleNo= document.getElementById("txtStyleNo").value;
        var sBuyerName =document.getElementById("txtBuyerName").value;
        var nBusinessSessionID = $('#cboSession').val();
        debugger;
        var nGender = $('#cboGender').val();
        var nSubGender = $('#cboSubGender').val();
        var nTSType = $("#cboTSType").val();

        if(parseInt($('#cboReportLayout').val())<=0)
        {
            alert("Please select Reporting Format");
            return;
        }
        var sStatus =  $('#tblStatusLoad').datagrid('getChecked');
        var chkResult = CheckEmpty();
        if(chkResult!=true)
        {
            alert("Please Select at lease one Criteria !!");
            return;
        }
        var sMakStatsQry ="";
        if(sStatus.length>0)
        {
            sMakStatsQry = sMakeQuery(sStatus);
        }
        var nRunning=0;
        if(document.getElementById("chkIsrunning").checked===true)
        {
            nRunning=1;
        }
        var sTempString =nInqueryDate+'~'+ dOrderStartDate+'~'+dOrderEndDate+'~'+nShipmentDate+'~'+dShipmentStartDate+'~'+dShipmentEndDate+'~'+sOrderNo+'~'+sStyleNo+'~'+$('#divOR').data('BuyerIDs')+'~'+parseInt($('#cboProductCategory').val())+'~'+ncboOrderQty+'~'+nStartOrderQty+'~'+ nEndOrderQty+'~'+ncboFOB+'~'+nStartFOBQty+'~'+nEndFOBQty+'~'+sMakStatsQry+'~'+$('#divOR').data('MerchandiserIDs')+'~'+nBusinessSessionID+'~'+$('#divOR').data('AgentIDs')+'~'+nRunning+'~'+nGender+'~'+nSubGender+'~'+nTSType+'~'+sessionStorage.getItem("BUID");
        window.open(_sBaseAddress + '/OrderRecap/OrderRecapManagementReport?sParam='+sTempString+'&ReportFormat='+parseInt($('#cboReportLayout').val()));

    });

    $('#btnPrintXL').click(function () {

        /* order Date*/
        var cboOrderDate = document.getElementById("cboOrderDate");
        var nInqueryDate=cboOrderDate.options[cboOrderDate.selectedIndex].index;
        var dOrderStartDate=$('#txtOrderStartDate').datebox('getValue');
        var dOrderEndDate=$('#txtOrderEndDate').datebox('getValue');

        /* Shipment Date*/
        var cboShipmentDate = document.getElementById("cboShipmentDate");
        var nShipmentDate=cboShipmentDate.options[cboShipmentDate.selectedIndex].index;
        var dShipmentStartDate=$('#txtShipmentStartDate').datebox('getValue');
        var dShipmentEndDate=$('#txtShipmentEndDate').datebox('getValue');

        /* Order Qty*/
        var cboOrderQty = document.getElementById("cboOrderQty");
        var ncboOrderQty = cboOrderQty.options[cboOrderQty.selectedIndex].index;
        var nStartOrderQty = $('#txtOrderStartQty').numberbox('getValue');
        var nEndOrderQty = $('#txtOrderEndQty').numberbox('getValue');

        /* FOB*/
        var cboFOB = document.getElementById("cboFOB");
        var ncboFOB=cboFOB.options[cboFOB.selectedIndex].index;
        var nStartFOBQty = $('#txtFOBStartQty').numberbox('getValue');
        var nEndFOBQty = $('#txtFOBEndQty').numberbox('getValue');

        var sOrderNo= document.getElementById("txtOrderRecapNo").value;
        var sStyleNo= document.getElementById("txtStyleNo").value;
        var sBuyerName =document.getElementById("txtBuyerName").value;
        var nBusinessSessionID = $('#cboSession').val();

        var nGender = $('#cboGender').val();
        var nSubGender = $('#cboSubGender').val();
        if(parseInt($('#cboReportLayout').val())<=0)
        {
            alert("Please select Reporting Format");
            return;
        }
        var sStatus =  $('#tblStatusLoad').datagrid('getChecked');
        var chkResult = CheckEmpty();
        if(chkResult!=true)
        {
            alert("Please Select at lease one Criteria !!");
            return;
        }
        var sMakStatsQry ="";
        if(sStatus.length>0)
        {
            sMakStatsQry = sMakeQuery(sStatus);
        }
        var nRunning=0;
        if(document.getElementById("chkIsrunning").checked===true)
        {
            nRunning=1;
        }
        var sTempString =nInqueryDate+'~'+ dOrderStartDate+'~'+dOrderEndDate+'~'+nShipmentDate+'~'+dShipmentStartDate+'~'+dShipmentEndDate+'~'+sOrderNo+'~'+sStyleNo+'~'+$('#divOR').data('BuyerIDs')+'~'+parseInt($('#cboProductCategory').val())+'~'+ncboOrderQty+'~'+nStartOrderQty+'~'+ nEndOrderQty+'~'+ncboFOB+'~'+nStartFOBQty+'~'+nEndFOBQty+'~'+sMakStatsQry+'~'+$('#divOR').data('MerchandiserIDs')+'~'+nBusinessSessionID+'~'+$('#divOR').data('AgentIDs')+'~'+nRunning+'~'+nGender+'~'+nSubGender;
        window.open(_sBaseAddress + '/OrderRecap/OrderRecapManagementReportXL?sParam='+sTempString+'&ReportFormat='+parseInt($('#cboReportLayout').val()), "_blank");

    });


    $('#btnPrintBuyingCom').click(function () {

        /* order Date*/
        var cboOrderDate = document.getElementById("cboOrderDate");
        var nInqueryDate=cboOrderDate.options[cboOrderDate.selectedIndex].index;
        var dOrderStartDate=$('#txtOrderStartDate').datebox('getValue');
        var dOrderEndDate=$('#txtOrderEndDate').datebox('getValue');

        /* Shipment Date*/
        var cboShipmentDate = document.getElementById("cboShipmentDate");
        var nShipmentDate=cboShipmentDate.options[cboShipmentDate.selectedIndex].index;
        var dShipmentStartDate=$('#txtShipmentStartDate').datebox('getValue');
        var dShipmentEndDate=$('#txtShipmentEndDate').datebox('getValue');

        /* Order Qty*/
        var cboOrderQty = document.getElementById("cboOrderQty");
        var ncboOrderQty = cboOrderQty.options[cboOrderQty.selectedIndex].index;
        var nStartOrderQty = $('#txtOrderStartQty').numberbox('getValue');
        var nEndOrderQty = $('#txtOrderEndQty').numberbox('getValue');

        /* FOB*/
        var cboFOB = document.getElementById("cboFOB");
        var ncboFOB=cboFOB.options[cboFOB.selectedIndex].index;
        var nStartFOBQty = $('#txtFOBStartQty').numberbox('getValue');
        var nEndFOBQty = $('#txtFOBEndQty').numberbox('getValue');

        var sOrderNo= document.getElementById("txtOrderRecapNo").value;
        var sStyleNo= document.getElementById("txtStyleNo").value;
        var sBuyerName =document.getElementById("txtBuyerName").value;
        var nBusinessSessionID = $('#cboSession').val();

        var nGender = $('#cboGender').val();
        var nSubGender = $('#cboSubGender').val();
        var nTSType = $("#cboTSType").val();
        if(parseInt($('#cboReportLayout').val())<=0)
        {
            alert("Please select Reporting Format");
            return;
        }
        var sStatus =  $('#tblStatusLoad').datagrid('getChecked');
        var chkResult = CheckEmpty();
        if(chkResult!=true)
        {
            alert("Please Select at lease one Criteria !!");
            return;
        }
        var sMakStatsQry ="";
        if(sStatus.length>0)
        {
            sMakStatsQry = sMakeQuery(sStatus);
        }
        var nRunning=0;
        if(document.getElementById("chkIsrunning").checked===true)
        {
            nRunning=1;
        }
        var sTempString =nInqueryDate+'~'+ dOrderStartDate+'~'+dOrderEndDate+'~'+nShipmentDate+'~'+dShipmentStartDate+'~'+dShipmentEndDate+'~'+sOrderNo+'~'+sStyleNo+'~'+$('#divOR').data('BuyerIDs')+'~'+parseInt($('#cboProductCategory').val())+'~'+ncboOrderQty+'~'+nStartOrderQty+'~'+ nEndOrderQty+'~'+ncboFOB+'~'+nStartFOBQty+'~'+nEndFOBQty+'~'+sMakStatsQry+'~'+$('#divOR').data('MerchandiserIDs')+'~'+nBusinessSessionID+'~'+$('#divOR').data('AgentIDs')+'~'+nRunning+'~'+nGender+'~'+nSubGender+'~'+nTSType+'~'+sessionStorage.getItem("BUID");
        window.open(_sBaseAddress + '/OrderRecap/OrderRecapBuyingStatement?sParam='+sTempString+'&ReportFormat='+parseInt($('#cboReportLayout').val()));

    });

    $('#btnPrintBuyingComXL').click(function () {

        /* order Date*/
        var cboOrderDate = document.getElementById("cboOrderDate");
        var nInqueryDate=cboOrderDate.options[cboOrderDate.selectedIndex].index;
        var dOrderStartDate=$('#txtOrderStartDate').datebox('getValue');
        var dOrderEndDate=$('#txtOrderEndDate').datebox('getValue');

        /* Shipment Date*/
        var cboShipmentDate = document.getElementById("cboShipmentDate");
        var nShipmentDate=cboShipmentDate.options[cboShipmentDate.selectedIndex].index;
        var dShipmentStartDate=$('#txtShipmentStartDate').datebox('getValue');
        var dShipmentEndDate=$('#txtShipmentEndDate').datebox('getValue');

        /* Order Qty*/
        var cboOrderQty = document.getElementById("cboOrderQty");
        var ncboOrderQty = cboOrderQty.options[cboOrderQty.selectedIndex].index;
        var nStartOrderQty = $('#txtOrderStartQty').numberbox('getValue');
        var nEndOrderQty = $('#txtOrderEndQty').numberbox('getValue');

        /* FOB*/
        var cboFOB = document.getElementById("cboFOB");
        var ncboFOB=cboFOB.options[cboFOB.selectedIndex].index;
        var nStartFOBQty = $('#txtFOBStartQty').numberbox('getValue');
        var nEndFOBQty = $('#txtFOBEndQty').numberbox('getValue');

        var sOrderNo= document.getElementById("txtOrderRecapNo").value;
        var sStyleNo= document.getElementById("txtStyleNo").value;
        var sBuyerName =document.getElementById("txtBuyerName").value;
        var nBusinessSessionID = $('#cboSession').val();

        var nGender = $('#cboGender').val();
        var nSubGender = $('#cboSubGender').val();
        var nTSType = $("#cboTSType").val();
        if(parseInt($('#cboReportLayout').val())<=0)
        {
            alert("Please select Reporting Format");
            return;
        }
        var sStatus =  $('#tblStatusLoad').datagrid('getChecked');
        var chkResult = CheckEmpty();
        if(chkResult!=true)
        {
            alert("Please Select at lease one Criteria !!");
            return;
        }
        var sMakStatsQry ="";
        if(sStatus.length>0)
        {
            sMakStatsQry = sMakeQuery(sStatus);
        }
        var nRunning=0;
        if(document.getElementById("chkIsrunning").checked===true)
        {
            nRunning=1;
        }
        var sTempString =nInqueryDate+'~'+ dOrderStartDate+'~'+dOrderEndDate+'~'+nShipmentDate+'~'+dShipmentStartDate+'~'+dShipmentEndDate+'~'+sOrderNo+'~'+sStyleNo+'~'+$('#divOR').data('BuyerIDs')+'~'+parseInt($('#cboProductCategory').val())+'~'+ncboOrderQty+'~'+nStartOrderQty+'~'+ nEndOrderQty+'~'+ncboFOB+'~'+nStartFOBQty+'~'+nEndFOBQty+'~'+sMakStatsQry+'~'+$('#divOR').data('MerchandiserIDs')+'~'+nBusinessSessionID+'~'+$('#divOR').data('AgentIDs')+'~'+nRunning+'~'+nGender+'~'+nSubGender+'~'+nTSType+'~'+sessionStorage.getItem("BUID");
        window.open(_sBaseAddress + '/OrderRecap/OrderRecapBuyingStatementXL?sParam='+sTempString+'&ReportFormat='+parseInt($('#cboReportLayout').val()), "_blank");

    });

    $('#btnPrintXL').click(function () {

        /* order Date*/
        var cboOrderDate = document.getElementById("cboOrderDate");
        var nInqueryDate=cboOrderDate.options[cboOrderDate.selectedIndex].index;
        var dOrderStartDate=$('#txtOrderStartDate').datebox('getValue');
        var dOrderEndDate=$('#txtOrderEndDate').datebox('getValue');

        /* Shipment Date*/
        var cboShipmentDate = document.getElementById("cboShipmentDate");
        var nShipmentDate=cboShipmentDate.options[cboShipmentDate.selectedIndex].index;
        var dShipmentStartDate=$('#txtShipmentStartDate').datebox('getValue');
        var dShipmentEndDate=$('#txtShipmentEndDate').datebox('getValue');

        /* Order Qty*/
        var cboOrderQty = document.getElementById("cboOrderQty");
        var ncboOrderQty = cboOrderQty.options[cboOrderQty.selectedIndex].index;
        var nStartOrderQty = $('#txtOrderStartQty').numberbox('getValue');
        var nEndOrderQty = $('#txtOrderEndQty').numberbox('getValue');

        /* FOB*/
        var cboFOB = document.getElementById("cboFOB");
        var ncboFOB=cboFOB.options[cboFOB.selectedIndex].index;
        var nStartFOBQty = $('#txtFOBStartQty').numberbox('getValue');
        var nEndFOBQty = $('#txtFOBEndQty').numberbox('getValue');

        var sOrderNo= document.getElementById("txtOrderRecapNo").value;
        var sStyleNo= document.getElementById("txtStyleNo").value;
        var sBuyerName =document.getElementById("txtBuyerName").value;
        var nBusinessSessionID = $('#cboSession').val();

        var nGender = $('#cboGender').val();
        var nSubGender = $('#cboSubGender').val();
        if(parseInt($('#cboReportLayout').val())<=0)
        {
            alert("Please select Reporting Format");
            return;
        }
        var sStatus =  $('#tblStatusLoad').datagrid('getChecked');
        var chkResult = CheckEmpty();
        if(chkResult!=true)
        {
            alert("Please Select at lease one Criteria !!");
            return;
        }
        var sMakStatsQry ="";
        if(sStatus.length>0)
        {
            sMakStatsQry = sMakeQuery(sStatus);
        }
        var nRunning=0;
        if(document.getElementById("chkIsrunning").checked===true)
        {
            nRunning=1;
        }
        var sTempString =nInqueryDate+'~'+ dOrderStartDate+'~'+dOrderEndDate+'~'+nShipmentDate+'~'+dShipmentStartDate+'~'+dShipmentEndDate+'~'+sOrderNo+'~'+sStyleNo+'~'+$('#divOR').data('BuyerIDs')+'~'+parseInt($('#cboProductCategory').val())+'~'+ncboOrderQty+'~'+nStartOrderQty+'~'+ nEndOrderQty+'~'+ncboFOB+'~'+nStartFOBQty+'~'+nEndFOBQty+'~'+sMakStatsQry+'~'+$('#divOR').data('MerchandiserIDs')+'~'+nBusinessSessionID+'~'+$('#divOR').data('AgentIDs')+'~'+nRunning+'~'+nGender+'~'+nSubGender;
        window.open(_sBaseAddress + '/OrderRecap/OrderRecapManagementReportXL?sParam='+sTempString+'&ReportFormat='+parseInt($('#cboReportLayout').val()), "_blank");

    });

    function sMakeQuery(sStauses)
    {
        var sSatusRes="";
        for(var i =0;i<sStauses.length;i++)
        {
            var status=sStauses[i].id;
            sSatusRes=sSatusRes+status+',';
        }
        return sSatusRes.substring(0, sSatusRes.length - 1);
    }

    function RefreshList(oOrderRecaps)
    {
        data =oOrderRecaps;
        data={"total":""+data.length+"","rows":data};
        $('#tblOrderRecap').datagrid('loadData',data);
    }

    $('#btnReset').click(function () {
        window.location.href = window.location.href;
    });


    function CheckEmpty()
    {
        var cboOrderDate = document.getElementById("cboOrderDate");
        var nInqueryDate=cboOrderDate.options[cboOrderDate.selectedIndex].index;

        var cboShipmentDate = document.getElementById("cboShipmentDate");
        var nShipmentDate=cboShipmentDate.options[cboShipmentDate.selectedIndex].index;

        /* Order Qty*/
        var cboOrderQty = document.getElementById("cboOrderQty");
        var nOrderQty=cboOrderQty.options[cboOrderQty.selectedIndex].index;

        /* FOB*/
        var cboFOB = document.getElementById("cboFOB");
        var ncboFOB=cboFOB.options[cboFOB.selectedIndex].index;
        var sOrderNo= document.getElementById("txtOrderRecapNo").value;
        var sStyleNo= document.getElementById("txtStyleNo").value;
        var sStatus =  $('#tblStatusLoad').datagrid('getChecked');
        var nBusinessSessionID = $('#cboSession').val();
        var nGender = $('#cboGender').val();
        var nSubGender = $('#cboSubGender').val();
        var nRunning=0;
        if(document.getElementById("chkIsrunning").checked===true)
        {
            nRunning=1;
        }
        if(nInqueryDate==0 && nShipmentDate==0 && nOrderQty==0 && ncboFOB==0&& nBusinessSessionID==0 && nRunning==0 && nGender==0 && nSubGender==0 && parseInt($("#cboTSType").val())==-1)
        {
            if(sOrderNo=="" && $('#divOR').data('BuyerIDs')=="" && $('#divOR').data('AgentIDs')=="" && $('#divOR').data('MerchandiserIDs')=="" && sStyleNo=="" && parseInt($('#cboProductCategory').val())== 0 && sStatus=="")
            {
                return false;
            }
            return true;
        }
        return true;
    }

    function Close()
    {
        window.close();
    }

    function OkButtonClick()
    {
        //
        var oOrderRecaps=[];
        var oOrderRecaps = $('#tblOrderRecap').datagrid('getChecked');
        if(oOrderRecaps.length<=0)
        {
            alert("please select atleast one item");
            return;
        }
        window.returnValue= oOrderRecaps;
        window.close();
    }

    // Search Buyer Start
    $("#txtBuyerName").keydown(function (e) {
        debugger;
        var code = (e.keyCode ? e.keyCode : e.which);
        if (code == 13) // Enter Press
        {
            if($.trim($('#txtBuyerName').val())==null || $.trim($('#txtBuyerName').val())=="")
            {
                alert("Type Buyer Name and Press Enter.");
                return;
            }
            GetBuyers();
        }if (code == 8) //backspace=8
        {
            //debugger;
            $("#txtBuyerName").removeClass('fontColorOfPickItem');
            $('#divDR').data('BuyerIDS',"");
        }
    });
    $("#btnBuyer").click(function () {
        GetBuyers();
    });
    function GetBuyers()
    {
        var oContractor = {
            Params: '2' + '~' + $.trim($('#txtBuyerName').val())+'~'+sessionStorage.getItem("BUID")
        };
        var obj = {
            BaseAddress: _sBaseAddress,
            Object: oContractor,
            ControllerName: "Contractor",
            ActionName: "ContractorSearchByNameType",
            IsWinClose: false
        };
        $.icsDataGets(obj, function (response) {
            debugger;
            if (response.status && response.objs.length > 0) {
                if (response.objs[0].ContractorID > 0) {
                    debugger;
                    var tblColums = []; var oColumn = { field: "Name", title: "Name", width: 200, align: "left" }; tblColums.push(oColumn);
                    oColumn = { field: "Address", title: "Address", width: 120, align: "left" }; tblColums.push(oColumn);
                    oColumn = { field: "Email", title: "Email", width: 90, align: "left" }; tblColums.push(oColumn);
                    oColumn = { field: "ShortName", title: "Short Name", width: 90, align: "left" }; tblColums.push(oColumn);
                    var oPickerParam = {
                        winid: 'winBuyers',
                        winclass: 'clsBuyer',
                        winwidth: 600,
                        winheight: 460,
                        tableid: 'tblBuyers',
                        tablecolumns: tblColums,
                        datalist: response.objs,
                        multiplereturn: true,
                        searchingbyfieldName: 'Name',
                        windowTittle: 'Buyer List'
                    };
                    $.icsPicker(oPickerParam);
                    IntializePickerbutton(oPickerParam);
                }
                else { alert(response.objs[0].ErrorMessage); }
            }
            else{
                alert("Data Not Found.");
                return;
            }
        });
    }

    //Merchandiser Part
    $("#txtMerchandiserName").keydown(function (e) {
        debugger;
        var code = (e.keyCode ? e.keyCode : e.which);
        if (code == 13) // Enter Press
        {
            if($.trim($('#txtMerchandiserName').val())==null || $('#txtMerchandiserName').val()=="")
            {
                alert("Please Type Merchandiser Name and Press Enter.");
                $('#txtMerchandiserName').focus();
                return;
            }
            GetEmployees();
        }else if (code == 8) //backspace=8
        {
            //debugger;
            var txtMerchandiserName = document.getElementById("txtMerchandiserName");
            txtMerchandiserName.style.color = "black";
            txtMerchandiserName.style.fontWeight = "normal";
            $('#divDR').data('MerchandiserIDs',"");
        }
    });
    $("#btnPickMerchandiser").click(function () {
        GetEmployees();
    });

    // Search Agent Start
    $("#txtAgentName").keydown(function (e) {
        debugger;
        var code = (e.keyCode ? e.keyCode : e.which);
        if (code == 13) // Enter Press
        {
            if($.trim($('#txtAgentName').val())==null || $.trim($('#txtAgentName').val())=="")
            {
                alert("Type Agent Name and Press Enter.");
                return;
            }
            GetAgents();
        }if (code == 8) //backspace=8
        {
            //debugger;
            $("#txtAgentName").removeClass('fontColorOfPickItem');
            $('#divDR').data('AgentIDS',"");
        }
    });
    $("#btnAgent").click(function () {
        GetAgents();
    });
    function GetAgents()
    {
        var oContractor = {
            Params: '2' + '~' + $.trim($('#txtAgentName').val())+'~'+sessionStorage.getItem("BUID")
        };
        var obj = {
            BaseAddress: _sBaseAddress,
            Object: oContractor,
            ControllerName: "Contractor",
            ActionName: "ContractorSearchByNameType",
            IsWinClose: false
        };
        $.icsDataGets(obj, function (response) {
            debugger;
            if (response.status && response.objs.length > 0) {
                if (response.objs[0].ContractorID > 0) {
                    debugger;
                    var tblColums = []; var oColumn = { field: "Name", title: "Name", width: 200, align: "left" }; tblColums.push(oColumn);
                    oColumn = { field: "Address", title: "Address", width: 120, align: "left" }; tblColums.push(oColumn);
                    oColumn = { field: "Email", title: "Email", width: 90, align: "left" }; tblColums.push(oColumn);
                    oColumn = { field: "ShortName", title: "Short Name", width: 90, align: "left" }; tblColums.push(oColumn);
                    var oPickerParam = {
                        winid: 'winAgents',
                        winclass: 'clsAgent',
                        winwidth: 600,
                        winheight: 460,
                        tableid: 'tblAgents',
                        tablecolumns: tblColums,
                        datalist: response.objs,
                        multiplereturn: true,
                        searchingbyfieldName: 'Name',
                        windowTittle: 'Agent List'
                    };
                    $.icsPicker(oPickerParam);
                    IntializePickerbutton(oPickerParam);
                }
                else { alert(response.objs[0].ErrorMessage); }
            }
            else{
                alert("Data Not Found.");
                return;
            }
        });
    }

    function GetEmployees()
    {
        var oEmployee = { Params:$('#txtMerchandiserName').val()+"~23"};//for Development type : Merchandiser
        var obj = {
            BaseAddress: _sBaseAddress,
            Object: oEmployee,
            ControllerName: "Employee",
            ActionName: "GetsByEmployeeNameType",
            IsWinClose: false
        };
        $.icsDataGets(obj, function (response) {
            debugger;
            if (response.status && response.objs.length > 0) {
                if (response.objs[0].EmployeeID > 0) {
                    var tblColums = []; var oColumn = { field: "Name", title: "Merchandiser Name", width: 150, align: "left" }; tblColums.push(oColumn);
                    oColumn = { field: "ContactNo", title: "Contact No", width: 100, align: "left" }; tblColums.push(oColumn);
                    oColumn = { field: "PresentAddress", title: "Address", width: 150, align: "left" }; tblColums.push(oColumn);
                    var oPickerParam = {
                        winid: 'winMerchandiserPicker',
                        winclass: 'clsMerchandiser',
                        winwidth: 600,
                        winheight: 460,
                        tableid: 'tblMerchandisersPicker',
                        tablecolumns: tblColums,
                        datalist: response.objs,
                        multiplereturn: true,
                        searchingbyfieldName: 'Name',
                        windowTittle: 'Merchandiser List'
                    };
                    $.icsPicker(oPickerParam);
                    IntializePickerbutton(oPickerParam);
                }
                else {
                    alert(response.objs[0].ErrorMessage);
                }

            }
        });
    }

    function IntializePickerbutton(oPickerobj) {
        debugger;
        $("#" + oPickerobj.winid).find("#btnOk").click(function () {
            debugger;
            //for Single Select
            SetPickerValueAssign(oPickerobj);
        });
        $(document).find('.' + oPickerobj.winclass).keydown(function (e) {
            if (e.which == 13)//enter=13
            {
                SetPickerValueAssign(oPickerobj);
            }
        });
    }

    function SetPickerValueAssign(oPickerobj)
    {
        var oreturnObj = null, oreturnobjs = [];
        if (oPickerobj.multiplereturn)
        {
            oreturnobjs = $('#'+oPickerobj.tableid).datagrid('getChecked');
        } else {
            oreturnObj = $('#'+oPickerobj.tableid).datagrid('getSelected');
        }
        $("#" + oPickerobj.winid).icsWindow("close");
        $("#" + oPickerobj.winid).remove();

        if (oPickerobj.winclass == 'clsBuyer')
        {
            var sBuyerIDs = "";
            if (oPickerobj.multiplereturn)
            {
                var ncount = 0;
                for (var i = 0; i <oreturnobjs.length; i++) {
                    var nBuyerID = oreturnobjs[i].ContractorID;
                    sBuyerIDs = sBuyerIDs + nBuyerID + ',';
                    ncount++;
                }
                if (ncount > 1)
                {
                    $('#txtBuyerName').val("Select " + ncount + " Buyer's");
                } else
                {
                    $('#txtBuyerName').val(oreturnobjs[0].Name);
                }
                sBuyerIDs = sBuyerIDs.substring(0, sBuyerIDs.length - 1);
            } else
            {
                $('#txtBuyerName').val(oreturnobj.Name);
                sBuyerIDs = "" + oreturnobj.ContractorID + "";
                $('#txtBuyerName').focus();
            }
            var txtBuyerName = document.getElementById("txtBuyerName");
            txtBuyerName.style.color = "blue";
            txtBuyerName.style.fontWeight = "bold";
            $('#divOR').data('BuyerIDs',sBuyerIDs);
        }else  if (oPickerobj.winclass == 'clsMerchandiser')
        {
            var sMerchandiserIDs = "";
            if (oPickerobj.multiplereturn)
            {
                var ncount = 0;
                for (var i = 0; i <oreturnobjs.length; i++) {
                    var nMerchandiserID = oreturnobjs[i].EmployeeID;
                    sMerchandiserIDs = sMerchandiserIDs + nMerchandiserID + ',';
                    ncount++;
                }
                if (ncount > 1)
                {
                    $('#txtMerchandiserName').val("Select " + ncount + " Merchandiser's");
                } else
                {
                    $('#txtMerchandiserName').val(oreturnobjs[0].Name);
                }
                sMerchandiserIDs = sMerchandiserIDs.substring(0, sMerchandiserIDs.length - 1);
            } else
            {
                $('#txtMerchandiserName').val(oreturnobj.Name);
                sMerchandiserIDs = "" + oreturnobj.EmployeeID + "";
                $('#txtMerchandiserName').focus();
            }
            var txtMerchandiserName = $("#txtMerchandiserName").val();
            txtMerchandiserName.style.color = "blue";
            txtMerchandiserName.style.fontWeight = "bold";
            $('#divOR').data('MerchandiserIDs',sMerchandiserIDs);
        }else  if (oPickerobj.winclass == 'clsAgent')
        {
            var sAgentIDs = "";
            if (oPickerobj.multiplereturn)
            {
                var ncount = 0;
                for (var i = 0; i <oreturnobjs.length; i++) {
                    var nAgentID = oreturnobjs[i].ContractorID;
                    sAgentIDs = sAgentIDs + nAgentID + ',';
                    ncount++;
                }
                if (ncount > 1)
                {
                    $('#txtAgentName').val("Select " + ncount + " Agent's");
                } else
                {
                    $('#txtAgentName').val(oreturnobjs[0].Name);
                }
                sAgentIDs = sAgentIDs.substring(0, sAgentIDs.length - 1);
            } else
            {
                $('#txtAgentName').val(oreturnobj.Name);
                sAgentIDs = "" + oreturnobj.ContractorID + "";
                $('#txtAgentName').focus();
            }
            var txtAgentName = document.getElementById("txtAgentName");
            txtAgentName.style.color = "blue";
            txtAgentName.style.fontWeight = "bold";
            $('#divOR').data('AgentIDs',sAgentIDs);
        }
    }


</script>
