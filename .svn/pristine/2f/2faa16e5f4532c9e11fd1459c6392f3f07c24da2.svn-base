@{
    ViewBag.Title = "Sale Order(s)";
}

@model IEnumerable<ESimSol.BusinessObjects.DyeingOrder>

    <head>
        <title>Orders</title>
    </head>
    <body>
        <div id="progressbarParent" style="width:100%;height:100%;margin:0 auto;text-align:center; margin-left: auto;margin-right: auto;left: 0;right: 0;z-index: 1;">
            <div style="margin: 0px auto;margin-top: 251px;text-align:center;width:390px;">
                <label style="font-size:18px;">Please wait</label>
                <div id="progressbar" style="width:100%;height:37px;"></div>
            </div>
        </div>
        <div class="menuMainCollectionTable">
            <table id="tblDyeingOrder" title="Order List" class="easyui-datagrid" fit="true" fitcolumn="true" rownumbers="true" pagination="false" singleselect="true" autorowheight="false" toolbar="#toolbarDyeingOrder">
                <thead>
                    <tr>
                        @*<th data-options=" field:'selected',checkbox:true"></th>*@
                        <th field="OrderNoFull" width="12%">OrderNo</th>
                        <th field="OrderDateSt" width="10%">Issue Date</th>
                        <th field="ContractorName" width="20%">Buyer</th>
                        <th field="QtySt" width="12%" align="right">Qty(<label id="lblMUName"></label>)</th>
                        <th field="CPName" width="12%">Buyer Concern Person</th>
                        <th field="StateSt" width="12%">Status</th>
                        @*<th field="IsInHouseSt" width="12%">owner</th>*@
                        <th field="ApproveByName" width="12%">ApproveBy</th>
                        <th field="IsCloseSt" width="12%"></th>
                    </tr>
                </thead>

            </table>

            <div id="toolbarDyeingOrder">
                <a href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-reload" plain="true" id="btnReload"></a>
                <input type="text" id="txtSearchByOrderNo" placeholder="Search by order No" style="width:100px;text-align:left" />
                @*<input type="text" id="txtSearchByInvoiceNo" placeholder="Search Invoice No" style="width:100px;text-align:left" />*@
                <a id="btnAdvSearch" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-search" plain="true">Adv. Search</a>
                <a id="btnAdd" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-add" plain="true">New</a>
                <a id="btnEdit" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-edit" plain="true">Edit</a>
                <a id="btnDelete" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-remove" plain="true">Delete</a>
                <a id="btnView" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-details" plain="true">View</a>
                @*<a id="btnCreateInvoice" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-add" plain="true">Create Invoice</a>*@
                <a id="btnRevise" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-add" plain="true">Revise</a>
                <a id="btnApprove" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-approved" plain="true"> <label id="lblOrderStatus">Approve</label> </a>
                <a id="btnCancel" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-cancel" plain="true">Cancel</a>
                <a id="btnLotTransfer" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-add" plain="true">Lot Transfer</a>
                <a id="btnCreateDO" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-add" plain="true">Create DO</a>
                <a id="btnPrint" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-print" plain="true">Print</a>
                <a id="btnOrderClose" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-ok" plain="true">Close/Hold</a>
                <a id="btnExcel" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-excel" plain="true">Loan Order Report</a>
                <a id="btnExcel2" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-excel" plain="true">Report</a>
            </div>
        </div>
        <div id="winAdvSearch" class="easyui-window winClass" style="width:600px" title=" adv. search" data-options="modal:true,closed:true,collapsible:false,minimizable:false,maximizable:false,closable:false">
            <table style="width:100%;">
                <tr>
                    <td>
                        <fieldset style="margin-bottom: 0px;">
                            <legend>Searching Criteria</legend>
                            <table>
                                <tr>
                                    <td style=" width:25%;text-align:right;">
                                        <label>Issue To:</label>
                                    </td>
                                    <td colspan="3" style=" width:75%;text-align:left;">
                                        <input id="txtContractorAdvS" style="width:70%;" type="text" placeholder="Type & Press Enter" />
                                        <a id="btnPickContractorAdvS" href="javascript:void(0)" class="easyui-linkbutton ics-pick" iconcls="icon-pick" plain="true"></a>
                                        <a id="btnClrContractorAdvS" href="javascript:void(0)" class="easyui-linkbutton ics-pick" iconcls="icon-clear" plain="true"></a>

                                    </td>
                                </tr>
                                <tr>
                                    <td style=" width:25%;text-align:right;">
                                        <label>Deliver To:</label>
                                    </td>
                                    <td colspan="3" style=" width:75%;text-align:left;">
                                        <input id="txtDeliverToAdvS" style="width:70%;" type="text" placeholder="Type & Press Enter" />
                                        <a id="btnPickDeliverToAdvS" href="javascript:void(0)" class="easyui-linkbutton ics-pick" iconcls="icon-pick" plain="true"></a>
                                        <a id="btnClrDeliverToAdvS" href="javascript:void(0)" class="easyui-linkbutton ics-pick" iconcls="icon-clear" plain="true"></a>
                                    </td>
                                </tr>
                                <tr>
                                    <td style=" width:25%;text-align:right;">
                                        <label>Yarn:</label>
                                    </td>
                                    <td colspan="3" style=" width:75%;text-align:left;">
                                        <input id="txtProductName" style="width:70%;" type="text" placeholder="Type & Press Enter" />
                                        <a id="btnProductPiker" href="javascript:void(0)" class="easyui-linkbutton ics-pick" iconcls="icon-pick" plain="true"></a>
                                        <a id="btnClrProductPiker" href="javascript:void(0)" class="easyui-linkbutton ics-pick" iconcls="icon-clear" plain="true"></a>
                                    </td>
                                </tr>
                                <tr>
                                    <td style=" width:25%;text-align:right;">
                                        <label>Order Date:</label>
                                    </td>
                                    <td colspan="3" style=" width:75%;text-align:left;">
                                        <select id="cboOrderDateAdvS" style="width:30%;" onchange="DateActionsOrderDateAdvSearch();"></select>
                                        <input id="txtFromOrderDateAdvSearch" type="text" style="width: 100px;" class="easyui-datebox" required="required" data-options="formatter:icsdateformat,parser:icsdateparser" />To
                                        <input id="txtToOrderDateAdvSearch" type="text" style="width: 100px;" class="easyui-datebox" required="required" data-options="formatter:icsdateformat,parser:icsdateparser" />
                                    </td>
                                </tr>
                                <tr>
                                    <td style=" width:25%;text-align:right;">
                                        <label>Invoice Date:</label>
                                    </td>
                                    <td colspan="3" style=" width:75%;text-align:left;">
                                        <select id="cboInvoiceDateAdvSearch" style="width:30%;" onchange=" DateActionsInvoiceDateAdvSearch(); "></select>
                                        <input id="txtFromInvoiceDateAdvSearch" type="text" style="width: 100px;" class="easyui-datebox" required="required" data-options="formatter:icsdateformat,parser:icsdateparser" />To
                                        <input id="txtToInvoiceDateAdvSearch" type="text" style="width: 100px;" class="easyui-datebox" required="required" data-options="formatter:icsdateformat,parser:icsdateparser" />
                                    </td>
                                </tr>
                                <tr>
                                    <td style=" width:25%;text-align:right;">
                                        <label>Delivery Date:</label>
                                    </td>
                                    <td colspan="3" style=" width:75%;text-align:left;">
                                        <select id="cboDeliveryDateAdvS" style="width:30%;" onchange=" DateActionsDeliveryDateAdvSearch(); "></select>
                                        <input id="txtFromDeliveryDateAdvSearch" type="text" style="width: 100px;" class="easyui-datebox" required="required" data-options="formatter:icsdateformat,parser:icsdateparser" />To
                                        <input id="txtToDeliveryDateAdvSearch" type="text" style="width: 100px;" class="easyui-datebox" required="required" data-options="formatter:icsdateformat,parser:icsdateparser" />
                                    </td>
                                </tr>

                                <tr>
                                    <td style=" width:25%;text-align:right;">
                                        <label>Payment Type:</label>
                                    </td>
                                    <td style=" width:30%;text-align:left;">
                                        <select id="cboPaymentType" style="width: 100%;"></select>
                                    </td>
                                    <td style=" width:15%;text-align:right;">
                                        <label>Order:</label>
                                    </td>
                                    <td style=" width:30%;text-align:left;">
                                        <select id="cboOrderType" style="width: 100%;"></select>
                                    </td>
                                </tr>
                                <tr>
                                    <td style=" width:25%;text-align:right;">
                                        <label>Concern Person:</label>
                                    </td>
                                    <td colspan="3" style=" width:75%;text-align:left;">
                                        <select id="cboMkPersonAdvSearch" style="width:100%;"></select>
                                    </td>
                                </tr>



                                <tr>
                                    <td style=" width:25%;text-align:right;">
                                        <label>Invoice No:</label>
                                    </td>
                                    <td style=" width:30%;text-align:left;">
                                        <input id="txtInvoiceNo" type="text" style="width:100%" />
                                    </td>
                                    <td style=" width:15%;text-align:right;">
                                        <label>P/I No:</label>
                                    </td>
                                    <td style=" width:30%;text-align:left;">
                                        <input id="txtPINo" type="text" style="width:95%" />
                                    </td>
                                </tr>
                                <tr>
                                    <td style=" width:25%;text-align:right;">
                                        <label>Style No:</label>
                                    </td>
                                    <td style=" width:30%;text-align:left;">
                                        <input id="txtStyleNoAdvS" type="text" style="width:100%" />
                                    </td>
                                    <td style=" width:15%;text-align:right;">
                                        <label>Ref No:</label>
                                    </td>
                                    <td style="width:30%;text-align:left;">
                                        <input id="txtRefNoAdvS" type="text" style="width:95%" />
                                    </td>
                                </tr>


                                <tr>
                                    <td style=" width:25%;text-align:right;"></td>
                                    <td style="width:30%;text-align:right;">
                                        <input id="chkYetNotSendLabReq" type="checkbox" />
                                        <label>Pending LabDip:</label>
                                    </td>
                                    <td colspan="2" style="width:45%;text-align:right;">
                                        <input id="chkYetNotSendPro" type="checkbox" />
                                        <label>Yet not Send Production</label>
                                    </td>
                                </tr>
                                <tr id="tdDyeingStepType">
                                    <td style=" width:25%;text-align:right;">
                                        <label>Dyeing Step: </label>
                                    </td>
                                    <td style=" width:30%;text-align:left;">
                                        <select id="cboDyeingStepType" style="width: 100%;"></select>
                                    </td>
                                    <td style=" width:15%;text-align:right;"></td>
                                    <td style=" width:30%;text-align:left;"></td>
                                </tr>
                                <tr>
                                    <td height="5px" colspan="4"></td>
                                </tr>
                                @*<tr>
                                        <td class="btnResetSearch" colspan="4">
                                            <a id="btnSearchAdvSearch" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-search" plain="true">Search</a>
                                            <a id="btnResetAdvSearch" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-reload" plain="true">Reset</a>
                                        </td>
                                    </tr>*@
                            </table>
                        </fieldset>
                    </td>
                </tr>
            </table>

            <fieldset class="actionfieldsetstyle">
                <legend>Actions : </legend>
                <label class="lblLoadingMessage" style="float: left;">Loading Please Wait...</label>
                <a id="btnResetAdvSearch" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-reload" plain="true">Reset</a>
                <a id="btnSearchAdvSearch" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-search" plain="true">Search</a>
                <a id="btnCloseAdvSearch" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-cancel" plain="true">Close</a>
            </fieldset>
        </div>
    </body>


    <script type="text/javascript">
        var _sBaseAddress="";
        var _oDyeingOrders=[];
        var _sMessage='';
        var _nNextStatus=-1;
        var _nContractorIDs="";
        var _sMenuID=0;
        var _nBUID = 0;
        var _sContractorIds = '';
        var _sProductIds = '';
        var _sDeliverToIDs = '';
        var _oPaymentTypes=[];
        var _oOrderTypes=[];
        var _oDUDyeingSteps=[];
        var _nOrderType=0;
        var _bIsInHouse=false;
        $(document).ready(function () {
            _sBaseAddress = @Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(HttpContext.Current.Session[SessionInfo.BaseAddress]));
            _oDyeingOrders =@Html.Raw( new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(Model));
            _oCompareOperators = @Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(ViewBag.CompareOperators));
            _sMenuID =@Html.Raw( new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(HttpContext.Current.Session[SessionInfo.MenuID]));
            _nBUID = @Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(ViewBag.BUID));
            _oMktPersons = @Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(ViewBag.MktPersons));
            _oPaymentTypes = @Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(ViewBag.PaymentTypes));
            _oOrderTypes = @Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(ViewBag.OrderTypes));
            var oDUOrderSetup =@Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(@ViewBag.DUOrderSetup));
            _oDUDyeingSteps= @Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(ViewBag.DUDyeingSteps));
            _nOrderType= @Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(ViewBag.OrderType));
            _bIsInHouse= @Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(ViewBag.IsInHouse));
            if(sessionStorage.getItem("DyeingOrders")!=null && sessionStorage.getItem("DyeingOrders").length>0)
            {
                _oDyeingOrders= jQuery.parseJSON(sessionStorage.getItem('DyeingOrders'));
                var nIndex= sessionStorage.getItem('SelectedRowIndex');
                DynamicRefreshList(_oDyeingOrders, 'tblDyeingOrder');
                if(nIndex>-1){
                    $('#tblDyeingOrder').datagrid('selectRow',nIndex);
                }
            }
            else{
                DynamicRefreshList(_oDyeingOrders, 'tblDyeingOrder');
            }
            debugger;
            $("#progressbar").progressbar({ value: 0 });
            $("#progressbarParent").hide();
            $(".lblLoadingMessage").hide();
            $('#lblMUName').html("");
            if(!oDUOrderSetup.IsApplyDyeingStep){ $("#tdDyeingStepType").hide();}
            LoadComboAdv();
        });

        $(document).keydown(function (e) { if (e.keyCode == 27) { $('#winDyeingOrderOrder').icsWindow('close'); } });


        $('#tblDyeingOrder').datagrid({ onSelect: function (rowIndex, rowData) { OperationPerforms(rowIndex, rowData); } });

        function OperationPerforms(rowIndex, rowData)
        {
            if (rowData != null && rowData.DyeingOrderID > 0)
            {
                if (rowData.ApproveBy!=0)
                {
                    $('#btnEdit,#btnDelete,#btnApprove').hide();
                    $('#btnRevise,#btnCreateDO').show();
                }
                else
                {
                    $('#btnEdit,#btnDelete,#btnApprove').show();
                    $('#btnRevise,#btnCreateDO').hide();
                }
            }
        }



        /*------------------------------------*/

        $("#btnAdd").click(function(){
            debugger;
            sessionStorage.setItem("Operation", "New");
            sessionStorage.setItem("SelectedRowIndex", -1);
            sessionStorage.setItem("DyeingOrderHeader", "Add DyeingOrder");
            sessionStorage.setItem("DyeingOrders", JSON.stringify($('#tblDyeingOrder').datagrid('getRows')));
            sessionStorage.setItem("BackLink", window.location.href);
            sessionStorage.setItem("BUID", _nBUID);
            var tsv=((new Date()).getTime())/1000;
            window.location.href = _sBaseAddress+ "/DyeingOrder/ViewSampleOrder_Sampling?nId=0&IsInHouse="+_bIsInHouse+"&OrderType="+_nOrderType+"&ts="+tsv;
        });

        $('#btnEdit').click(function (e)
        {

            var oDyeingOrder = $('#tblDyeingOrder').datagrid('getSelected');
            if (oDyeingOrder ==null || oDyeingOrder.DyeingOrderID <=0 ) { alert("Please select an item from list."); return ; }

            var nIndex=$('#tblDyeingOrder').datagrid('getRowIndex',oDyeingOrder);

            sessionStorage.setItem("Operation", "Edit");
            sessionStorage.setItem("SelectedRowIndex", nIndex);
            sessionStorage.setItem("DyeingOrderHeader", "Edit Production");
            sessionStorage.setItem("DyeingOrders", JSON.stringify($('#tblDyeingOrder').datagrid('getRows')));
            sessionStorage.setItem("BackLink", window.location.href);
            sessionStorage.setItem("BUID", _nBUID);
            var tsv=((new Date()).getTime())/1000;
            //   window.location.href = _sBaseAddress+ "/DyeingOrder/ViewSaleOrder?nId="+oDyeingOrder.DyeingOrderID+"&ts="+tsv;
            window.location.href = _sBaseAddress+ "/DyeingOrder/ViewSampleOrder_Sampling?nId="+oDyeingOrder.DyeingOrderID+"&IsInHouse="+_bIsInHouse+"&OrderType="+oDyeingOrder.DyeingOrderType+"&ts="+tsv;
        });
        $('#btnRevise').click(function (e)
        {
            var oDyeingOrder = $('#tblDyeingOrder').datagrid('getSelected');
            if (oDyeingOrder ==null || oDyeingOrder.DyeingOrderID <=0 ) { alert("Please select an item from list."); return ; }

            var nIndex=$('#tblDyeingOrder').datagrid('getRowIndex',oDyeingOrder);

            sessionStorage.setItem("Operation", "Revise");
            sessionStorage.setItem("SelectedRowIndex", nIndex);
            sessionStorage.setItem("DyeingOrderHeader", "Revise Production");
            sessionStorage.setItem("DyeingOrders", JSON.stringify($('#tblDyeingOrder').datagrid('getRows')));
            sessionStorage.setItem("BackLink", window.location.href);
            sessionStorage.setItem("BUID", _nBUID);
            var tsv=((new Date()).getTime())/1000;
            window.location.href = _sBaseAddress+ "/DyeingOrder/ViewSampleOrder_Sampling?nId="+oDyeingOrder.DyeingOrderID+"&IsInHouse="+_bIsInHouse+"&OrderType="+oDyeingOrder.DyeingOrderType+"&ts="+tsv;
        });
        $("#btnCancel").click(function(){

            var oDyeingOrder = $('#tblDyeingOrder').datagrid('getSelected');
            if (oDyeingOrder ==null || oDyeingOrder.DyeingOrderID <=0 ) { alert("Please select an item from list."); return ; }

            var nIndex=$('#tblDyeingOrder').datagrid('getRowIndex',oDyeingOrder);
            sessionStorage.setItem("Operation", "Cancel");
            sessionStorage.setItem("SelectedRowIndex", nIndex);
            sessionStorage.setItem("DyeingOrderHeader", "Cancel Production");
            sessionStorage.setItem("DyeingOrders", JSON.stringify($('#tblDyeingOrder').datagrid('getRows')));
            sessionStorage.setItem("BackLink", window.location.href);
            var tsv=((new Date()).getTime())/1000;
            //window.location.href = _sBaseAddress+ "/DyeingOrder/ViewSaleOrder?nId="+oDyeingOrder.DyeingOrderID+"&ts="+tsv;
            window.location.href = _sBaseAddress+ "/DyeingOrder/ViewSampleOrder_Sampling?nId="+oDyeingOrder.DyeingOrderID+"&IsInHouse="+_bIsInHouse+"&OrderType="+oDyeingOrder.DyeingOrderType+"&ts="+tsv;
        });

        $('#btnDelete').click(function(e){
            var oDyeingOrder = $('#tblDyeingOrder').datagrid('getSelected');
            if (oDyeingOrder ==null || oDyeingOrder.DyeingOrderID <=0 ) { alert("Please select an item from list."); return ; }
            if (!confirm("Confirm to delete?")) return;
            sessionStorage.clear();
            var obj =
            {
                BaseAddress: _sBaseAddress,
                Object: oDyeingOrder,
                ControllerName: "DyeingOrder",
                ActionName: "Delete",
                TableId: "tblDyeingOrder",
                IsWinClose: false
            };
            $.icsDelete(obj);

        });

        $('#btnView').click(function (e)
        {
            var oDyeingOrder = $('#tblDyeingOrder').datagrid('getSelected');
            if (oDyeingOrder ==null || oDyeingOrder.DyeingOrderID <=0 ) { alert("Please select an item from list."); return ; }

            var nIndex=$('#tblDyeingOrder').datagrid('getRowIndex',oDyeingOrder);

            sessionStorage.clear();
            sessionStorage.setItem("Operation", "View");
            sessionStorage.setItem("SelectedRowIndex", nIndex);
            sessionStorage.setItem("DyeingOrderHeader", "View Production");
            sessionStorage.setItem("DyeingOrders", JSON.stringify($('#tblDyeingOrder').datagrid('getRows')));
            sessionStorage.setItem("BackLink", window.location.href);
            var tsv=((new Date()).getTime())/1000;
            window.location.href = _sBaseAddress+ "/DyeingOrder/ViewSampleOrder_Sampling?nId="+oDyeingOrder.DyeingOrderID+"&IsInHouse="+_bIsInHouse+"&OrderType="+oDyeingOrder.DyeingOrderType+"&ts="+tsv;
        });

        $('#btnPrint').click(function (e)
        {
            var oDyeingOrder = $('#tblDyeingOrder').datagrid('getSelected');
            if (oDyeingOrder ==null || oDyeingOrder.DyeingOrderID <=0 ) { alert("Please select an item from list."); return ; }
            var tsv=((new Date()).getTime())/1000;

            window.open(_sBaseAddress+ "/DyeingOrder/PrintDyeingOrder?nId="+oDyeingOrder.DyeingOrderID+"&bIsPrintHistory=false&nts="+tsv, "_blank");

        });
        $('#btnExcel').click(function (e)
        {
            debugger;
            //var oDyeingOrder = $('#tblDyeingOrder').datagrid('getSelected');
            //if (oDyeingOrder ==null || oDyeingOrder.DyeingOrderID <=0 ) { alert("Please select an item from list."); return ; }
            //var tsv=((new Date()).getTime())/1000;
            var sString = sessionStorage.getItem("AdvSearchingString");
            if(sString == "" || sString == null)
            {
                alert("Please Search First");
                return;
            }
            window.open(_sBaseAddress+ "/DyeingOrder/ExportToExcel?sParams="+sString+"&nReportType=1");

        });

        $('#btnExcel2').click(function (e)
        {
            debugger;
            //var oDyeingOrder = $('#tblDyeingOrder').datagrid('getSelected');
            //if (oDyeingOrder ==null || oDyeingOrder.DyeingOrderID <=0 ) { alert("Please select an item from list."); return ; }
            //var tsv=((new Date()).getTime())/1000;
            var sString = sessionStorage.getItem("AdvSearchingString");
            if(sString == "" || sString == null)
            {
                alert("Please Search First");
                return;
            }
            window.open(_sBaseAddress+ "/DyeingOrder/ExportToExcel2?sParams="+sString+"&nReportType=1"+"&nBUID="+_nBUID);

        });


        /*----------Order Status Change----------------*/

        //$("#btnOrderStatus").click(function () {
        //    ChangeOrderState();
        //});



        //$("#btnCancel").click(function () {
        //    _nNextStatus=10;
        //    _sMessage="cancel.";
        //    ChangeOrderState();
        //});

        //function ChangeOrderState(){
        //    var oDyeingOrder = $('#tblDyeingOrder').datagrid('getSelected');
        //    if (oDyeingOrder ==null || oDyeingOrder.DyeingOrderID <=0 ) { alert("Please select an item from list."); return ; }

        //    if(!confirm("Confirm to "+_sMessage)) return false;
        //    oDyeingOrder.Params=_nNextStatus;

        //    var obj = {
        //        BaseAddress: _sBaseAddress,
        //        Object: oDyeingOrder,
        //        ObjectId: oDyeingOrder.DyeingOrderID,
        //        ControllerName: "DyeingOrder",
        //        ActionName: "ChangeOrderStatus",
        //        TableId: "tblDyeingOrder",
        //        IsWinClose: false,
        //        Message: _sMessage.charAt(0).toUpperCase()+_sMessage.slice(1) +" Successfully."
        //    };
        //    $.icsSave(obj, function (response) {
        //        if (response.status && response.obj != null) {
        //            if (response.obj.DyeingOrderID > 0) {
        //                OperationPerforms(-1, response.obj);
        //            }
        //        }
        //    });
        //}


        $('#btnCreateInvoice').click(function(e){
            debugger;


            var oDyeingOrders=[];
            var oDyeingOrder = $('#tblDyeingOrder').datagrid('getSelected');
            if (oDyeingOrder ==null || oDyeingOrder.DyeingOrderID <=0 ) { alert("Please select an item from list."); return ; }

            if( oDyeingOrder.SampleInvoiceID>0)
            {
                alert("Invoice Already Create.");
                return;
            }
            oDyeingOrder.BUID=_nBUID;
            //oDyeingOrders.push(oDyeingOrder);
            var  nSelectedIndex = $('#tblDyeingOrder').datagrid('getRowIndex', oDyeingOrder);

            if(!confirm("Confirm To Create Invoice")) return false;

            $.ajax({
                type: "POST",
                dataType: "json",
                url : _sBaseAddress+"/DyeingOrder/CreateInvoice",
                traditional: true,
                data:  JSON.stringify(oDyeingOrder),
                contentType: "application/json; charset=utf-8",
                success: function (data) {
                    var  oDyeingOrder = jQuery.parseJSON(data);
                    debugger;
                    if (oDyeingOrder.ErrorMessage == '' || oDyeingOrder.ErrorMessage == null)
                    {
                        debugger;
                        $('#tblDyeingOrder').datagrid('updateRow', { index: nSelectedIndex, row: oDyeingOrder });

                    }
                    else
                    {
                        alert(oDyeingOrder.ErrorMessage);

                    }
                },
                error: function (xhr, status, error)
                {
                    alert(xhr+'~' +status+'~'+error);
                }
            });
        });
        $('#btnCreateDO').click(function(e){
            debugger;
            var oDyeingOrder = $('#tblDyeingOrder').datagrid('getSelected');
            if (oDyeingOrder ==null || oDyeingOrder.DyeingOrderID <=0 ) { alert("Please select an item from list."); return ; }
            if (oDyeingOrder.ApproveBy ==0 ) { alert("This order Yet not approve."); return ; }

            var  nSelectedIndex = $('#tblDyeingOrder').datagrid('getRowIndex', oDyeingOrder);

            if(!confirm("Confirm To Create Delivery Order(DO)")) return false;

            $.ajax({
                type: "POST",
                dataType: "json",
                url : _sBaseAddress+"/DyeingOrder/DOSave_Auto",
                traditional: true,
                data:  JSON.stringify(oDyeingOrder),
                contentType: "application/json; charset=utf-8",
                success: function (data) {
                    var  oDyeingOrder = jQuery.parseJSON(data);
                    debugger;
                    if (oDyeingOrder.ErrorMessage == '' || oDyeingOrder.ErrorMessage == null)
                    {
                        debugger;
                        $('#tblDyeingOrder').datagrid('updateRow', { index: nSelectedIndex, row: oDyeingOrder });
                        alert("DO Create Successfully");
                    }
                    else
                    {
                        alert(oDyeingOrder.ErrorMessage);
                    }
                },
                error: function (xhr, status, error)
                {
                    alert(xhr+'~' +status+'~'+error);
                }
            });
        });


        $("#txtSearchByInvoiceNo").keydown(function (e) {
            var nkeyCode = e.keyCode || e.which;
            if(nkeyCode==13){

                var oDyeingOrder= {
                    OrderNo: '',
                    DyeingOrderType:_nOrderType,  // Sale Order
                    SampleInvocieNo: $.trim($("#txtSearchByInvoiceNo").val())
                };
                GetsOrders(oDyeingOrder);
            }
            else if(nkeyCode==8){
                $("#txtSearchByInvoiceNo").val("");

            }
        });

        $("#txtSearchByOrderNo").keydown(function (e) {
            var nkeyCode = e.keyCode || e.which;
            if(nkeyCode==13){
                var oDyeingOrder= {
                    DyeingOrderID : 0,
                    OrderNo: $.trim($("#txtSearchByOrderNo").val()),
                    SampleInvocieNo: '',
                    DyeingOrderType:_nOrderType
                };
                GetsOrders(oDyeingOrder);
            }
            else if(nkeyCode==8){
                $("#txtSearchByOrderNo").val("");

            }
        });

        //$("#txtSearchByExportPINo").keydown(function (e) {
        //    var nkeyCode = e.keyCode || e.which;
        //    if(nkeyCode==13){

        //        var oDyeingOrder= {
        //            OrderNo: "",
        //            SampleInvocieNo: $.trim($("#txtSearchByExportPINo").val()),
        //            DyeingOrderType:3
        //        };
        //        GetsOrders(oDyeingOrder);
        //    }
        //    else if(nkeyCode==8){
        //        $("#txtSearchByExportPINo").val("");

        //    }
        //});

        function GetsOrders(oDyeingOrder)
        {


            $.ajax({
                type: "POST",
                dataType: "json",
                url : _sBaseAddress+"/DyeingOrder/GetsbyNo",
                traditional: true,
                data:  JSON.stringify(oDyeingOrder),
                contentType: "application/json; charset=utf-8",
                success: function (data) {

                    var oDyeingOrders = jQuery.parseJSON(data);
                    if (oDyeingOrders.length>0)
                    {
                        if(oDyeingOrders[0].ErrorMessage==="")
                        {
                            DynamicRefreshList(oDyeingOrders, "tblDyeingOrder");
                        }
                        else
                        {
                            alert(oDyeingOrders[0].ErrorMessage);
                        }
                    }
                    else
                    {
                        alert("Data Not found");
                        DynamicRefreshList([], "tblDyeingOrder");
                    }
                },
                error: function (xhr, status, error) {
                    alert(error);
                }
            });
        }




        ////Start adv Searching

        function updateProgress() {
            var value =$('#progressbar').progressbar('getValue');
            if (value < 96){
                value += Math.floor(Math.random() * 10);
                $('#progressbar').progressbar('setValue', value);
            }
        }
        function hideShow(miliseconds) {
            $("#progressbarParent").hide();
        }
        //Account Of Picker

        $("#txtContractorAdvS").keydown(function (e) {
            if (e.keyCode === 13) // Enter Press
            {
                PickContractors_AdvS();
            }
            else if (e.keyCode === 08) {
                $("#txtContractorAdvS").removeClass("fontColorOfPickItem");
                _sContractorIds = '';
            }
        });

        $("#btnClrContractorAdvS").click(function () {
            $("#txtContractorAdvS").removeClass("fontColorOfPickItem");
            $("#txtContractorAdvS").val("");
            _sContractorIds = '';
        });

        $("#btnPickContractorAdvS").click(function () {
            PickContractors_AdvS();
        });
        $("#txtSearchByAccountNamePickerAdvSearch").keydown(function (e) {
            var obj = {
                Event: e,
                SearchProperty: "Name",
                GlobalObjectList: _oAccountsOf,
                TableId: "tblAccountsPickerAdvSearch"
            };
            $('#txtSearchByAccountNamePickerAdvSearch').icsSearchByText(obj);
        });
        //End Account Of Picker
        $("#txtDeliverToAdvS").keydown(function (e) {
            if (e.keyCode === 13) // Enter Press
            {
                PickDeliverTo_AdvS();
            }
            else if (e.keyCode === 08) {
                $("#txtDeliverToAdvS").removeClass("fontColorOfPickItem");
                _sDeliverToIDs ="";
            }
        });

        $("#btnClrDeliverToAdvS").click(function () {
            $("#txtDeliverToAdvS").removeClass("fontColorOfPickItem");
            $("#txtDeliverToAdvS").val("");
            _sDeliverToIDs ="";
        });

        $("#btnPickDeliverToAdvS").click(function () {
            PickDeliverTo_AdvS();
        });

        //Product Pick
        $("#txtProductName").keydown(function (e) {
            debugger;
            var code = (e.keyCode ? e.keyCode : e.which);
            if (code == 13) // Enter Press
            {
                if($('#txtProductName').val()==null || $('#txtProductName').val()=="")
                {
                    alert("Please Type Product and Press Enter.");
                    $('#txtProductName').focus();
                    return;
                }
                PickProduct($('#txtProductName').val());
            }
            if (code == 8) //backspace=8
            {
                //debugger;
                $("#txtProductName").removeClass("fontColorOfPickItem");
                _sProductIds= [];
            }
        });
        $("#btnProductPiker").click(function () {
            PickProduct("");
        });
        $("#btnClrProductPiker").click(function () {
            $("#txtProductName").val('');
            $("#txtProductName").removeClass("fontColorOfPickItem");
            _sProductIds= [];
        });
        function PickProduct(sProductName)
        {
            var oProduct = { BUID:sessionStorage.getItem("BUID"),ProductName:sProductName};
            var obj = {
                BaseAddress: _sBaseAddress,
                Object: oProduct,
                ControllerName: "Product",
                ActionName: "SearchByProductBUWise",
                IsWinClose: false
            };
            $.icsDataGets(obj, function (response) {
                debugger;
                if (response.status && response.objs.length > 0) {
                    if (response.objs[0].ProductID > 0) {
                        var tblColums = [];
                        var oColumn = { field: "ProductCode", title: "Code", width: 100, align: "left" }; tblColums.push(oColumn);
                        oColumn = { field: "ProductName", title: "Name", width: 300, align: "left" }; tblColums.push(oColumn);
                        oColumn = { field: "MUnit", title: "Unit", width: 70, align: "left" }; tblColums.push(oColumn);
                        var oPickerParam = {
                            winid: 'winProductPicker',
                            winclass: 'clsProductPicker',
                            winwidth: 600,
                            winheight: 460,
                            tableid: 'tblProductPicker',
                            tablecolumns: tblColums,
                            datalist: response.objs,
                            multiplereturn: true,
                            searchingbyfieldName: 'NameCode',
                            windowTittle: 'Product List'
                        };
                        $.icsPicker(oPickerParam);
                        IntializePickerbutton(oPickerParam);
                    }
                    else {
                        alert(response.objs[0].ErrorMessage);
                    }

                }else{
                    alert("Data Not Found.");
                }
            });
        }
        //End Buyer Search
        $("#btnResetAdvSearch").click(function () {
            ResetAdvSearchWindow();
            DateActionsOrderDateAdvSearch();
            DateActionsInvoiceDateAdvSearch();
            DateActionsDeliveryDateAdvSearch();
            DateActionsStatusDateAdvSearch();
        });

        $("#btnSearchAdvSearch").click(function () {
            debugger;

            $(".lblLoadingMessage").show();

            var checkDate = CheckFromAndToDateValidation("cboOrderDateAdvS", "txtFromOrderDateAdvSearch", "txtToOrderDateAdvSearch");
            if (!checkDate) {
                alert("Start date must be greater than end date.");
                return false;
            }
            checkDate = CheckFromAndToDateValidation("cboInvoiceDateAdvSearch", "txtFromOrderDateAdvSearch", "txtToInvoiceDateAdvSearch");
            if (!checkDate) {
                alert("Start date must be greater than end date.");
                return false;
            }
            checkDate = CheckFromAndToDateValidation("cboDeliveryDateAdvS", "txtFromDeliveryDateAdvSearch", "txtToDeliveryDateAdvSearch");
            if (!checkDate) {
                alert("Start date must be greater than end date.");
                return false;
            }


            //var nContractorID = parseInt(_sContractorIds);
            //var nBuyerID = parseInt(_sDeliverToIDs);
            var nCboOrderDate = parseInt($("#cboOrderDateAdvS").val());
            var dFromOrderDate = $('#txtFromOrderDateAdvSearch').datebox('getValue');
            var dToOrderDate = $('#txtToOrderDateAdvSearch').datebox('getValue');

            var ncboInvoiceDate = parseInt($("#cboInvoiceDateAdvSearch").val());
            var dFromInvoiceDate = $('#txtFromInvoiceDateAdvSearch').datebox('getValue');
            var dToInvoiceDate = $('#txtToInvoiceDateAdvSearch').datebox('getValue');

            var ncboDeliveryDate = parseInt($("#cboDeliveryDateAdvS").val());
            var dFromDeliveryDate = $('#txtFromDeliveryDateAdvSearch').datebox('getValue');
            var dToDeliveryDate = $('#txtToDeliveryDateAdvSearch').datebox('getValue');

            var ncboPaymentType = parseInt($("#cboPaymentType").val());
            var nCboMkPerson = parseInt($("#cboMkPersonAdvSearch").val());

            var nOrderType ="";
            if(parseInt($("#cboOrderType").val())<=0)
            {
                for (var i = 0; i < _oOrderTypes.length; i++) {
                    nOrderType = _oOrderTypes[i].OrderType + "," +nOrderType;
                }
                nOrderType = nOrderType.substring(0, nOrderType.length - 1);
            }
            else
            {
                nOrderType = parseInt($("#cboOrderType").val());
            }



            var sPINo = $.trim($("#txtPINo").val());
            var sInvoiceNo = $.trim($("#txtInvoiceNo").val());
            var sStyleNo = $.trim($("#txtStyleNoAdvS").val());
            var sRefNo = $.trim($("#txtRefNoAdvS").val());

            var bYetNotSendLabReq = $("#chkYetNotSendLabReq").is(':checked');
            var bYetNotSendPro = $("#chkYetNotSendPro").is(':checked');

            var nOrderTypeFixec =0;

            var sParams = _sContractorIds + "~" +
                          _sDeliverToIDs + "~" +
                          nCboOrderDate + "~" +
                          dFromOrderDate + "~" +
                          dToOrderDate + "~" +
                          ncboInvoiceDate + "~" +
                          dFromInvoiceDate + "~" +
                          dToInvoiceDate + "~" +
                          ncboDeliveryDate + "~" +
                          dFromDeliveryDate + "~" +
                          dToDeliveryDate + "~" +
                          nCboMkPerson + "~" +
                          ncboPaymentType + "~" +
                          nOrderType + "~" +
                          sPINo+"~"+
                          sInvoiceNo+"~"+
                          sStyleNo+"~"+
                          sRefNo+"~"+
                           _sProductIds+"~"+
                          bYetNotSendLabReq + "~" +
                          bYetNotSendPro + "~" +
                          nOrderTypeFixec + "~" +
                          _nBUID;
            var oDyeingOrder = {
                Note : sParams
            };
            sessionStorage.setItem("AdvSearchingString",sParams);
            $.ajax({
                type: "POST",
                dataType: "json",
                url: _sBaseAddress + "/DyeingOrder/AdvSearch",
                traditional: true,
                data: JSON.stringify(oDyeingOrder),
                contentType: "application/json; charset=utf-8",
                success: function (data) {
                    var oDyeingOrders = jQuery.parseJSON(data);
                    debugger;
                    if (oDyeingOrders != null) {
                        if (oDyeingOrders.length > 0)
                        {

                            DynamicRefreshList(oDyeingOrders, "tblDyeingOrder");
                            $("#winAdvSearch").icsWindow("close");

                        }
                        else
                        {
                            alert("Sorry, No data found.");
                            DynamicRefreshList([], "tblDyeingOrder");
                        }

                    } else {
                        alert("Sorry, No data found.");
                        DynamicRefreshList([], "tblDyeingOrder");
                    }
                    $(".lblLoadingMessage").hide();
                }
            });
        });

        function LoadComboAdv()
        {
            $("#cboDyeingStepType").icsLoadCombo({
                List: _oDUDyeingSteps,
                OptionValue: "DyeingStepType",
                DisplayText: "Name",

            });

            $("#cboOrderType").icsLoadCombo({
                List: _oOrderTypes,
                OptionValue: "OrderType",
                DisplayText: "ShortName",
            });
            $("#cboPaymentType").icsLoadCombo({
                List: _oPaymentTypes,
                OptionValue: "Value",
                DisplayText: "Text"
            });
            $("#cboOrderDateAdvS, #cboInvoiceDateAdvSearch, #cboDeliveryDateAdvS").icsLoadCombo({
                List: _oCompareOperators,
                OptionValue: "id",
                DisplayText: "Value"
            });
            $("#cboMkPersonAdvSearch").icsLoadCombo({
                List: _oMktPersons,
                OptionValue: "MarketingAccountID",
                DisplayText: "Name"
            });
        }
        function CheckFromAndToDateValidation(OperationComboId, FromDateId, ToDateId) {
            $("#" + OperationComboId).parent().parent().parent().find("select").removeClass("errorFieldBorder");
            var nCboVal = $("#" + OperationComboId).val();
            if (parseInt(nCboVal) == 5 || parseInt(nCboVal) == 6) {
                var fromDate = $("#" + FromDateId).datebox("getValue");
                var toDate = $("#" + ToDateId).datebox("getValue");
                if (new Date(fromDate) > new Date(toDate)) {
                    $("#" + ToDateId).focus();
                    $("#" + OperationComboId).addClass("errorFieldBorder");
                    $(".lblLoadingMessage").hide();
                    return false;
                } else {
                    $("#" + OperationComboId).removeClass("errorFieldBorder");
                    return true;
                }
            } else {
                return true;
            }
        }

        function ResetAdvSearchWindow() {
            _sContractorIds = '';
            _sDeliverToIDs = "";
            $("#winAdvSearch input").not("input[type='button']").val("");
            $("#winAdvSearch input").removeClass("fontColorOfPickItem");
            $("#winAdvSearch select").val(0);
            DateActionsOrderDateAdvSearch();
            DateActionsInvoiceDateAdvSearch();
            DateActionsDeliveryDateAdvSearch();
            $("#txtFromOrderDateAdvSearch,#txtToOrderDateAdvSearch,#txtFromInvoiceDateAdvSearch,#txtToInvoiceDateAdvSearch,#txtFromDeliveryDateAdvSearch,#txtToDeliveryDateAdvSearch").datebox({ disabled: true });
            $("#txtFromOrderDateAdvSearch,#txtToOrderDateAdvSearch,#txtFromInvoiceDateAdvSearch,#txtToInvoiceDateAdvSearch,#txtFromDeliveryDateAdvSearch,#txtToDeliveryDateAdvSearch").datebox("setValue", icsdateformat(new Date()));
        }

        function PickContractors_AdvS() {
            var oContractor = {
                Params: '2,3' + '~' + $.trim($("#txtContractorAdvS").val()+"~"+_nBUID)
            };
            var obj = {
                BaseAddress: _sBaseAddress,
                Object: oContractor,
                ControllerName: "Contractor",
                ActionName: "ContractorSearchByNameType",
                IsWinClose: false
            };

            $("#progressbar").progressbar({ value: 0 });
            $("#progressbarParent").show();
            var intervalID = setInterval(updateProgress, 250);

            DynamicRefreshList([], "tblAccountsPickerAdvSearch");
            $.icsDataGets(obj, function (response) {
                clearInterval(intervalID);
                $("#progressbarParent").hide();
                if (response.status && response.objs.length > 0) {
                    if (response.objs[0].ContractorID > 0) {
                        var tblColums = []; var oColumn = { field: "ContractorID", title: "Code", width: 50, align: "left" }; tblColums.push(oColumn);
                        oColumn = { field: "Name", title: "Name", width: 280, align: "left" }; tblColums.push(oColumn);

                        var oPickerParam = {
                            winid: 'winContractorPicker',
                            winclass: 'clsAccountOf',
                            winwidth: 400,
                            winheight: 460,
                            tableid: 'tblAccountOfs',
                            tablecolumns: tblColums,
                            datalist: response.objs,
                            multiplereturn: true,
                            searchingbyfieldName: 'Name',
                            windowTittle: 'Contactor List'
                        };
                        $.icsPicker(oPickerParam);
                        IntializePickerbutton(oPickerParam);
                    }
                    else {
                        alert(response.objs[0].ErrorMessage);
                    }
                }
                else {
                    alert("Sorry, No Contactor Found.");
                }
            });
        }

        function PickDeliverTo_AdvS() {
            var oContractor = {
                Params: '2' + '~' + $.trim($("#txtDeliverToAdvS").val()+"~"+_nBUID)
            };
            var obj = {
                BaseAddress: _sBaseAddress,
                Object: oContractor,
                ControllerName: "Contractor",
                ActionName: "ContractorSearchByNameType",
                IsWinClose: false
            };
            $("#progressbar").progressbar({ value: 0 });
            $("#progressbarParent").show();
            var intervalID = setInterval(updateProgress, 250);
            DynamicRefreshList([], "tblContractorsPickerAdvSearch");
            $.icsDataGets(obj, function (response) {
                clearInterval(intervalID);
                $("#progressbarParent").hide();
                if (response.status && response.objs.length > 0) {
                    if (response.objs[0].ContractorID > 0) {
                        var tblColums = []; var oColumn = { field: "ContractorID", title: "Code", width: 50, align: "left" }; tblColums.push(oColumn);
                        oColumn = { field: "Name", title: "Name", width: 280, align: "left" }; tblColums.push(oColumn);
                        var oPickerParam = {
                            winid: 'winBuyers',
                            winclass: 'clsBuyer',
                            winwidth: 400,
                            winheight: 460,
                            tableid: 'tblBuyers',
                            tablecolumns: tblColums,
                            datalist: response.objs,
                            multiplereturn: true,
                            searchingbyfieldName: 'Name',
                            windowTittle: 'Buyer List'
                        };
                        $.icsPicker(oPickerParam);
                        IntializePickerbutton(oPickerParam);
                    }
                    else {
                        alert(response.objs[0].ErrorMessage);
                    }
                }
                else {
                    alert("Sorry, No Contactor Found.");
                }
            });
        }

        function DateActionsOrderDateAdvSearch() {
            DynamicDateActions("cboOrderDateAdvS", "txtFromOrderDateAdvSearch", "txtToOrderDateAdvSearch");
        }
        function DateActionsInvoiceDateAdvSearch() {
            DynamicDateActions("cboInvoiceDateAdvSearch", "txtFromInvoiceDateAdvSearch", "txtToInvoiceDateAdvSearch");
        }
        function DateActionsDeliveryDateAdvSearch() {
            DynamicDateActions("cboDeliveryDateAdvS", "txtFromDeliveryDateAdvSearch", "txtToDeliveryDateAdvSearch");
        }

        $("#btnCloseAdvSearch").click(function () {
            $("#winAdvSearch").icsWindow("close");
        });
        $("#btnAdvSearch").click(function () {
            debugger;
            $("#winAdvSearch").icsWindow("open", "Sample Order Advance Search");
            //DynamicRefreshList([], "tblExportPIAdvSearch");
            DynamicResetAdvSearchWindow("winAdvSearch");
            DynamicDateActions("cboDateOptionAdvSearch", "txtFromDateAdvSearch", "txtToDateAdvSearch");
            DynamicDateActions("cboInvoiceDateAdvSearch", "txtFromInvoiceDateAdvSearch", "txtToInvoiceDateAdvSearch");
            DynamicDateActions("cboDeliveryDateAdvS", "txtFromDeliveryDateAdvSearch", "txtToDeliveryDateAdvSearch");
            ResetAdvSearchWindow();
        });

        function IntializePickerbutton(oPickerobj) {
            $("#" + oPickerobj.winid).find("#btnOk").click(function () {
                SetPickerValueAssign(oPickerobj);
            });
            $(document).find('.' + oPickerobj.winclass).keydown(function (e) {
                if (e.which === 13) {
                    SetPickerValueAssign(oPickerobj);
                }
            });
        }

        function SetPickerValueAssign(oPickerobj) {
            var oreturnObj = null, oreturnObjs = [];
            if (oPickerobj.multiplereturn) {
                oreturnObjs = $('#' + oPickerobj.tableid).datagrid('getChecked');
            } else {
                oreturnObj = $('#' + oPickerobj.tableid).datagrid('getSelected');
            }

            if (oPickerobj.winid == 'winContractorPicker')
            {
                if (oreturnObjs != null && oreturnObjs.length> 0)
                {

                    _sContractorIds=''; var sMessage='';
                    sMessage=(oreturnObjs.length>1)? oreturnObjs.length +" Contractors Selected" : oreturnObjs[0].Name;
                    $('#txtContractorAdvS').val(sMessage);
                    $("#txtContractorAdvS").addClass("fontColorOfPickItem");

                    for(var i=0;i<oreturnObjs.length;i++){
                        _sContractorIds=_sContractorIds+oreturnObjs[i].ContractorID+',';
                    }
                    _sContractorIds=_sContractorIds.substring(0,_sContractorIds.length-1);

                }
                else
                {
                    alert("Please select a contractor.");
                    return false;
                }
            }

            else if (oPickerobj.winid == 'winBuyers') {
                if (oreturnObjs != null && oreturnObjs.length> 0)
                {
                    _sDeliverToIDs='';
                    var sMessage='';
                    sMessage=(oreturnObjs.length>1)? oreturnObjs.length +" Contractors Selected" : oreturnObjs[0].Name;
                    $('#txtDeliverToAdvS').val(sMessage);
                    $("#txtDeliverToAdvS").addClass("fontColorOfPickItem");

                    for(var i=0;i<oreturnObjs.length;i++){
                        _sDeliverToIDs=_sDeliverToIDs+oreturnObjs[i].ContractorID+',';
                    }
                    _sDeliverToIDs=_sDeliverToIDs.substring(0,_sDeliverToIDs.length-1);
                }
                else
                {
                    alert("Please select a buyer.");
                    return false;
                }
            }
            else if (oPickerobj.winid == 'winProductPicker')
            {
                if (oreturnObjs!= null && oreturnObjs.length> 0)
                {
                    _sProductIds=''; var sMessage='';
                    sMessage=(oreturnObjs.length>1)? oreturnObjs.length +" ProductName Selected" : oreturnObjs[0].ProductName;
                    $('#txtProductName').val(sMessage);
                    $("#txtProductName").addClass("fontColorOfPickItem");

                    for(var i=0;i<oreturnObjs.length;i++){
                        _sProductIds=_sProductIds+oreturnObjs[i].ProductID+',';
                    }
                    _sProductIds=_sProductIds.substring(0,_sProductIds.length-1);
                }
                else
                {
                    alert("Please select a Product.");
                    return false;
                }
            }
            $("#" + oPickerobj.winid).icsWindow("close");
            $("#" + oPickerobj.winid).remove();
        }
        /// end Adv Searching
        $("#btnReload").click(function() {
            window.location.href = _sBaseAddress+ '/DyeingOrder/ViewSaleOrdersTwo?IsInHouse='+_bIsInHouse+'&OrderType='+_nOrderType+"&buid="+_nBUID+"&menuid="+_sMenuID;

        });
     
        $('#btnApprove').click(function(e){
            debugger;
            var oDyeingOrder = $('#tblDyeingOrder').datagrid('getSelected');
            if (oDyeingOrder ==null || oDyeingOrder.DyeingOrderID <=0 ) { alert("Please select an item from list."); return ; }

            var nIndex=$('#tblDyeingOrder').datagrid('getRowIndex',oDyeingOrder);
            sessionStorage.clear();
            sessionStorage.setItem("Operation", "Approve");
            sessionStorage.setItem("SelectedRowIndex", nIndex);
            sessionStorage.setItem("DOHeader", "Approve");
            sessionStorage.setItem("DyeingOrders", JSON.stringify($('#tblDyeingOrder').datagrid('getRows')));
            sessionStorage.setItem("BackLink", window.location.href);
            var tsv=((new Date()).getTime())/1000;
            window.location.href = _sBaseAddress+ "/DyeingOrder/ViewSampleOrder_Sampling?nId="+oDyeingOrder.DyeingOrderID+"&IsInHouse="+_bIsInHouse+"&OrderType="+oDyeingOrder.DyeingOrderType+"&ts="+tsv;

        });

        $('#btnOrderClose').click(function(e){

            debugger;
            var oDyeingOrder = $('#tblDyeingOrder').datagrid('getSelected');
            if (oDyeingOrder ==null || oDyeingOrder.DyeingOrderID <=0 ) { alert("Please select an item from list."); return ; }

            var nIndex=$('#tblDyeingOrder').datagrid('getRowIndex',oDyeingOrder);
            sessionStorage.clear();
            sessionStorage.setItem("Operation", "Entry");
            sessionStorage.setItem("SelectedRowIndex", nIndex);
            sessionStorage.setItem("DOHeader", "Close/Hold");
            sessionStorage.setItem("DyeingOrders", JSON.stringify($('#tblDyeingOrder').datagrid('getRows')));
            sessionStorage.setItem("BackLink", window.location.href);
            var tsv=((new Date()).getTime())/1000;
            window.location.href = _sBaseAddress+ "/DyeingOrder/ViewOrderView?nId="+oDyeingOrder.DyeingOrderID+"&ts="+tsv;
            //window.location.href = _sBaseAddress+ "/DyeingOrder/ViewOrderView?nId="+oDyeingOrder.DyeingOrderID+"&OrderType="+oDyeingOrder.DyeingOrderType+"&ts="+tsv;
        });
        $('#btnLotTransfer').click(function (e)
        {

            var oDyeingOrder = $('#tblDyeingOrder').datagrid('getSelected');
            if (oDyeingOrder ==null || oDyeingOrder.DyeingOrderID <=0 ) { alert("Please select an item from list."); return ; }

            var nIndex=$('#tblDyeingOrder').datagrid('getRowIndex',oDyeingOrder);

            sessionStorage.setItem("Operation", "Edit");
            sessionStorage.setItem("SelectedRowIndex", nIndex);
            sessionStorage.setItem("DyeingOrderHeader", "Edit Production");
            sessionStorage.setItem("DyeingOrders", JSON.stringify($('#tblDyeingOrder').datagrid('getRows')));
            sessionStorage.setItem("BackLink", window.location.href);
            sessionStorage.setItem("BUID", _nBUID);
            var tsv=((new Date()).getTime())/1000;
            //   window.location.href = _sBaseAddress+ "/DyeingOrder/ViewSaleOrder?nId="+oDyeingOrder.DyeingOrderID+"&ts="+tsv;
            window.location.href = _sBaseAddress+ "/DULotDistribution/ViewDUDyeingOrderDetails?nDOID="+oDyeingOrder.DyeingOrderID+"&buid="+_nBUID;
        });
        //// Add Details
    </script>
