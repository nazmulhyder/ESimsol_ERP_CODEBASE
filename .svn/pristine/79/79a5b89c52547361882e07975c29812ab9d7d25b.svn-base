@{
    ViewBag.Title = "Human Interaction Agent(HIA) list";
}
@model IEnumerable<ESimSol.BusinessObjects.HIASetup>
<div style="margin-left:0px; height:100%; width:100%">
    <table id="tblHIASetup" title="HIA Setup" class="easyui-datagrid" fit="true" fitcolumns="true" rownumbers="true" pagination="true" singleselect="true" autorowheight="false" toolbar="#toolbar">
        <thead>
            <tr>               
                <th field="SetupName" width="180"> Setup Name </th>
                <th field="DBTable" width="100"> DBTable </th>
                <th field="KeyColumn" width="100"> KeyColumn </th>
                <th field="SenderColumn" width="100"> Sender Column </th>
                <th field="ReceiverColumn" width="100"> Receiver Column </th>
                <th field="MessageBodyText" width="250"> Note </th>                
            </tr>
        </thead>
    </table>​
    <div id="toolbar">
        <a id="btnRefresh" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-reload" plain="true" onclick="Refresh()">Refresh</a>
        <a id="btnAdd" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-add"plain="true" onclick="Add()">Add</a> 
        <a id="btnEdit" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-edit" plain="true" onclick="Edit()">Edit</a>  
        <a id="btnDetails" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-details" plain="true" onclick="View()">View</a>
        <a id="btnDelete" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-remove"plain="true" onclick="Delete()">Delete</a>
    </div>
</div>


<script type="text/javascript">
var _oHIASetups=[];
var _sBaseAddress ="";
var _oAuthorizationRolesMapping = [];
$(document).ready(function () {
    //debugger;
    _sBaseAddress =@Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(HttpContext.Current.Session[SessionInfo.BaseAddress]));                  
    _oHIASetups =@Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(Model));
    var oHIASetups =sessionStorage.getItem("HIASetups");
    if(oHIASetups!=null)
    {
        oHIASetups = jQuery.parseJSON(oHIASetups);            
    }
    else
    {
        oHIASetups=_oHIASetups;
    }
    RefreshList(oHIASetups);
});

function RefreshList(oHIASetups)
{    
    data=oHIASetups;
    data={"total":""+data.length+"","rows":data};
    $('#tblHIASetup').datagrid('loadData',data);
    var nIndex= parseInt(sessionStorage.getItem("SelectedRowIndex"));
    $('#tblHIASetup').datagrid('selectRow',nIndex);       
}

function Refresh()
{    
    data=$('#tblHIASetup').datagrid('getRows');
    data={"total":""+data.length+"","rows":data};
    $('#tblHIASetup').datagrid('loadData',data);
}

function Add()
{
    debugger;     
    var tsv=((new Date()).getTime())/1000;
    var oHIASetups= $('#tblHIASetup').datagrid('getRows');
    sessionStorage.setItem("HIASetups", JSON.stringify(oHIASetups)); 
    sessionStorage.setItem("SelectedRowIndex", -1);   
    sessionStorage.setItem("HIAHeader", "Add HIA Setup");
    var oBackLink = window.location.href;
    sessionStorage.setItem("BackLink", oBackLink);
    window.location.href = _sBaseAddress+ "/HumanInteractionAgent/ViewHIASetup?nHIASetupID=0&ts="+tsv; 
} 


function Edit()
{
    //debugger;

    var oHIASetup = $('#tblHIASetup').datagrid('getSelected'); 
    if(oHIASetup==null || oHIASetup.HIASetupID<=0)
    {
        alert("Please select a item from list!");
        return;
    }
    
    var SelectedRowIndex=$('#tblHIASetup').datagrid('getRowIndex',oHIASetup);
    var tsv=((new Date()).getTime())/1000;
    var oHIASetups= $('#tblHIASetup').datagrid('getRows');
    sessionStorage.setItem("HIASetups", JSON.stringify(oHIASetups)); 
    sessionStorage.setItem("SelectedRowIndex", SelectedRowIndex);   
    sessionStorage.setItem("HIAHeader", "Edit  HIA Setup");
    var oBackLink = window.location.href;
    sessionStorage.setItem("BackLink", oBackLink);
    if(oHIASetup.HIASetupTypeInInt==0)//Manual
    {
        window.location.href = _sBaseAddress+ "/HumanInteractionAgent/ViewHIASetup?nHIASetupID="+oHIASetup.HIASetupID+"&ts="+tsv; 
    }else{
        window.location.href = _sBaseAddress+ "/HumanInteractionAgent/ViewSystemGeneratedHIASetup?nHIASetupID="+oHIASetup.HIASetupID+"&nOrderStepID="+oHIASetup.OrderStepID+"&ts="+tsv; //systme generated
    }
    
} 

 

function View()
{   
    var oHIASetup = $('#tblHIASetup').datagrid('getSelected'); 
    if(oHIASetup==null || oHIASetup.HIASetupID<=0)
    {
        alert("Please select a item from list!");
        return;
    }
    var SelectedRowIndex=$('#tblHIASetup').datagrid('getRowIndex',oHIASetup);
    var tsv=((new Date()).getTime())/1000;
    var oHIASetups= $('#tblHIASetup').datagrid('getRows');
    sessionStorage.setItem("HIASetups", JSON.stringify(oHIASetups)); 
    sessionStorage.setItem("SelectedRowIndex", SelectedRowIndex);   
    sessionStorage.setItem("HIAHeader", "View  HIA Setup");
    var oBackLink = window.location.href;
    sessionStorage.setItem("BackLink", oBackLink);
    if(oHIASetup.HIASetupTypeInInt==0)//Manual
    {
        window.location.href = _sBaseAddress+ "/HumanInteractionAgent/ViewHIASetup?nHIASetupID="+oHIASetup.HIASetupID+"&ts="+tsv; 
    }else{
        window.location.href = _sBaseAddress+ "/HumanInteractionAgent/ViewSystemGeneratedHIASetup?nHIASetupID="+oHIASetup.HIASetupID+"&nOrderStepID="+oHIASetup.OrderStepID+"&ts="+tsv; //systme generated
    } 
}

 
function Delete()
{        
    //debugger;  
    var oHIASetup = $('#tblHIASetup').datagrid('getSelected'); 
    if(oHIASetup==null || oHIASetup.HIASetupID<=0)
    {
        alert("Please select a item from list!");
        return;
    }
       
    if (!confirm("Confirm to Delete?")) return ;
    var SelectedRowIndex=$('#tblHIASetup').datagrid('getRowIndex',oHIASetup);
    if (oHIASetup.HIASetupID> 0) 
    {
        $.ajax
        ({
            type: "GET",
            dataType: "json",            
            url : _sBaseAddress+  "/HumanInteractionAgent/Delete",
            data: { id:oHIASetup.HIASetupID},
            contentType: "application/json; charset=utf-8",
            success: function (data) {
                //debugger;
                feedbackmessage = jQuery.parseJSON(data);
                if (feedbackmessage == "Delete sucessfully") 
                {
                    alert("Delete sucessfully");                        
                    $('#tblHIASetup').datagrid('deleteRow',SelectedRowIndex);
                          
                }
                else
                {
                    alert(feedbackmessage);
                }
            },
            error: function (xhr, status, error) 
            {
                alert(error);
            }
                      
        });
    }
}
</script>
