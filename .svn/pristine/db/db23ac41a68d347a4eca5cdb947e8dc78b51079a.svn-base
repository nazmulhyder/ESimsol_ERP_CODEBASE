<html>
@{
    ViewBag.Title = "Service Order Entry";
}
<body>
    @model ESimSol.BusinessObjects.ServiceOrder
    <script src="~/Views/VehicleChassis/VehicleChassiss.js"></script>
    <script src="~/Views/VehicleEngine/VehicleEngine.js"></script>

    <div class="menuMainCollectionTable" ng-app="ServiceOrderApp" ng-controller="ServiceOrderController as SODC" style="height:100%; width:100%; overflow:hidden" id="divServiceOrder">
        <div style="height:4%; overflow:hidden;" class="ui-grid-top-panel">
            <label ng-model="HeaderStatus">Update Service Status</label>
        </div>

        <div class="regionVR" style="height:80%;">
            <div style="font-family:Tahoma;text-align:center;height:80%; padding-right:24px" class="regionVR">
                <div class="col-md-12" style="height:42%;">
                    <fieldset style="height:460px;width:100%">
                        <div class="row" style="padding-top:120px;">
                            <div class="col-md-12 ">
                                <div class="col-md-2 text-right"><label class="control-label">Order No:</label></div>
                                <div class="col-md-4 text-left">
                                    <input type="text" ng-model="ServiceOrder.ServiceOrderNo" class="form-control" disabled>
                                </div>
                                <div class="col-md-2 text-right"><label class="control-label">V Type:</label></div>
                                <div class="col-md-4 text-left">
                                    <input type="text" ng-model="ServiceOrder.VehicleTypeName" class="form-control" disabled>
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-12 ">
                                <div class="col-md-2 text-right"><label class="control-label">Reg. No:</label></div>
                                <div class="col-md-4 text-left">
                                    <input type="text" ng-model="ServiceOrder.VehicleRegNo" class="form-control" disabled>
                                </div>
                                <div class="col-md-2 text-right"><label class="control-label">VIN No:</label></div>
                                <div class="col-md-4 text-left">
                                    <input type="text" ng-model="ServiceOrder.ChassisNo" class="form-control" disabled>
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-12 ">
                                <div class="col-md-2 text-right"><label class="control-label">Model No:</label></div>
                                <div class="col-md-4 text-left">
                                    <input type="text" ng-model="ServiceOrder.VehicleModelNo" class="form-control" disabled>
                                </div>
                                <div class="col-md-2 text-right"><label class="control-label">Engine No:</label></div>
                                <div class="col-md-4 text-left">
                                    <input type="text" ng-model="ServiceOrder.EngineNo" class="form-control" disabled>
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-12 ">
                                <div class="col-md-2 text-right"><label class="control-label">Customer:</label></div>
                                <div class="col-md-4 text-left">
                                    <input type="text" ng-model="ServiceOrder.CustomerName" class="form-control" disabled>
                                </div>
                                <div class="col-md-2 text-right"><label class="control-label">Customer Phone:</label></div>
                                <div class="col-md-4 text-left">
                                    <input type="text" ng-model="ServiceOrder.CustomerPhone" class="form-control" disabled>
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-12 ">
                                <div class="col-md-2 text-right"><label class="control-label">Contact Person:</label></div>
                                <div class="col-md-4 text-left">
                                    <input type="text" ng-model="ServiceOrder.ContactPerson" class="form-control" disabled>
                                </div>
                                <div class="col-md-2 text-right"><label class="control-label">Contact P. Phone:</label></div>
                                <div class="col-md-4 text-left">
                                    <input type="text" ng-model="ServiceOrder.ContactPersonPhone" class="form-control" disabled>
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-12 ">
                                <div class="col-md-2 text-right"><label class="control-label"> {{lblDateTime}}</label></div>
                                <div class="col-md-4 text-left">
                                    <input id="txtDateTime" type="text" class="easyui-datetimebox" data-options="formatter:icsdatetimeformat,parser:icsdatetimeparser,showSeconds:false" required="required" style="width:100%" />
                                </div>
                                <div class="col-md-2 text-right"><label class="control-label">Serive Advisor:</label></div>
                                <div class="col-md-4 text-left">
                                    <input type="text" ng-model="ServiceOrder.AdvisorName" class="form-control" disabled>
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-12 ">
                                <div class="col-md-2 text-right"><label class="control-label">Comments:</label></div>
                                <div class="col-md-10 text-left">
                                    <input type="text" ng-model="ServiceOrder.Comments" class="form-control" placeholder="Write a comment..">
                                </div>
                            </div>
                        </div>
                    </fieldset>
                </div>
            </div>
        </div>

        <div class="row" style="width:100%; height:10%">
            <fieldset style="margin-left:22px; margin-right:11px">
                <legend>Action</legend>
                <div class="row col-md-12 text-right">
                    <button type="button" class="btn-primary btn-sm" ng-show="btnApprove" aria-label="Left Align" ng-click="Approve()"> <span class="glyphicon glyphicon-ok" aria-hidden="true"></span> Approve</button>
                    <button type="button" class="btn-primary btn-sm" ng-show="btnReceive" aria-label="Left Align" ng-click="Receive()"> <span class="glyphicon glyphicon-ok" aria-hidden="true"></span> Receive</button>
                    <button type="button" class="btn-primary btn-sm" ng-show="btnDelivered" aria-label="Left Align" ng-click="Delivered()"> <span class="glyphicon glyphicon-ok" aria-hidden="true"></span> Delivered</button>
                    <button type="button" class="btn-warning btn-sm" ng-show="btnCancel" aria-label="Left Align" ng-click="Cancel()"> <span class="glyphicon glyphicon-stop" aria-hidden="true"></span> Cancel</button>
                    <button type="button" class="btn-danger btn-sm" aria-label="Right Align" ng-click="Close()"> <span class="glyphicon glyphicon-remove" aria-hidden="true"></span> Close</button>
                </div>
            </fieldset>
        </div>
    </div>
</body>
</html>
<style type="text/css">
    .regionVR .form-horizontal .control-label {
        padding-top: 1px;
    }

    .regionVR .form-control {
        height: 22px;
        padding: 0px 6px;
        font-size: 12px;
    }
    .regionVR regionVROT .form-control {
        height: 20px;
        padding: 0px 6px;
        font-size: 12px;
    }
    .regionVR .col-md-12 {
        width: 100%;
        padding-right: 5px;
        padding-left: 5px;
        margin-bottom: 5px;
    }
  
    .regionVR .col-md-2 {
        width: 16%;
        padding-right: 5px;
        padding-left: 5px;
    }
    .regionVR .col-md-10 {
        width: 82.5%;
        padding-right: 5px;
        padding-left: 5px;
    }
     .regionVR .col-md-4 {
        width: 33.33%;
        padding-right: 5px;
        padding-left: 5px;
    }
    
    .regionVR .col-md-6 {
        width: 50%;
        padding-right: 5px;
        padding-left: 5px;
    }
 
    .regionVR .btn-sm {
        padding: 2px 8px;
    }

    .regionVR .input-group-addon {
        padding: 2px 5px;
    }
    /*.ui-grid-top-panel {
        background: linear-gradient(to bottom,#EFF5FF 0,#E0ECFF 100%);
    } 
    .ui-grid-panel {
        background: linear-gradient(to bottom,#EFF5FF 0,#E0ECFF 100%);
    }*/
</style>
<script type="text/javascript">
    var oServiceOrder =@Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(Model));
    var ServiceOrderApp = angular.module('ServiceOrderApp', ['ngAnimate', 'ui.bootstrap','ui.grid', 'ui.grid.selection', 'ui.grid.edit', 'ms.service','chassis.service','engine.service']);
    ServiceOrderApp.controller('ServiceOrderController', function ($scope,$http,$uibModal,$log,uiGridConstants,msModal,userSession,icsMethod,msGridControl, chassisservice, engineservice) {
       
        $scope.ServiceOrder=oServiceOrder;
        $scope.ServiceOrder.BUID=sessionStorage.getItem('BUID');
      
        $scope.Operation=sessionStorage.getItem("Operation");
        debugger;
        $scope.btnApprove= $scope.btnDelivered = $scope.btnReceive= $scope.btnCancel= false;
        if($scope.Operation=="Approve")
        {
            $scope.btnApprove=true;
            $scope.lblDateTime="Order Date: ";
            $scope.Date_disabled= true;
            $('#txtDateTime').datetimebox('setValue', icsdatetimeformat(new Date(oServiceOrder.ServiceOrderDateSt)));
        }
        else if($scope.Operation=="Receive")
        {
            $scope.btnReceive=true;
            $scope.lblDateTime="Receive Date: ";
            $('#txtDateTime').datetimebox('setValue', icsdatetimeformat(new Date()));
        }
        else if($scope.Operation=="Deliver")
        {
            $scope.lblDateTime="Delivery Date: ";
            $scope.btnDelivered =true;
            $('#txtDateTime').datetimebox('setValue', icsdatetimeformat(new Date()));
        }
        else if($scope.Operation=="Cancel")
        {
            $scope.lblDateTime="Order Date: ";
            $scope.btnCancel= true;
            $scope.Date_disabled= true;
            $('#txtDateTime').datetimebox('setValue', icsdatetimeformat(new Date(oServiceOrder.ServiceOrderDateSt)));
            $("#txtDateTime").datebox("disable");
        }
        

        $scope.Approve= function () {

            var oServiceOrder=$scope.ServiceOrder;
            oServiceOrder.nRequest=1; // 1: Approve
            oServiceOrder.Remarks=$scope.ServiceOrder.Comments; 
            oServiceOrder.ActualRcvDateTime= $('#txtDateTime').datebox('getValue');

            $http.post(sessionStorage.getItem('BaseAddress')+'/ServiceOrder/UpdateStatus', JSON.stringify(oServiceOrder)).then(
                            function (response) {
                                if (jQuery.parseJSON(response.data) == 'Approved') 
                                {
                                    var oServiceOrder=$scope.ServiceOrder;
                                    alert("Successfully Approved.");
                                    oServiceOrder.OrderStatusInt=1;
                                    oServiceOrder.OrderStatusSt="Approved";

                                    userSession.setData('ServiceOrderList',oServiceOrder);
                                    userSession.previousPage();
                                    $scope.Close();
                                }
                                else 
                                {
                                    alert(jQuery.parseJSON(response.data));
                                }
                            },
                            function (response) { alert(jQuery.parseJSON(response.data)); }
                        );
        };
        $scope.Receive= function () {

            var oServiceOrder=$scope.ServiceOrder;
            oServiceOrder.nRequest=2; // 2: Receive
            oServiceOrder.Remarks=$scope.ServiceOrder.Comments; 
            oServiceOrder.ActualRcvDateTime= $('#txtDateTime').datebox('getValue');

            $http.post(sessionStorage.getItem('BaseAddress')+'/ServiceOrder/UpdateStatus', JSON.stringify(oServiceOrder)).then(
                            function (response) {
                                if (jQuery.parseJSON(response.data) == 'Received') 
                                {
                                    var oServiceOrder=$scope.ServiceOrder;
                                    alert("Successfully Received.");
                                    oServiceOrder.OrderStatusInt=2;
                                    oServiceOrder.OrderStatusSt="Receive";

                                    userSession.setData('ServiceOrderList',oServiceOrder);
                                    userSession.previousPage();
                                    $scope.Close();
                                }
                                else 
                                {
                                    alert(jQuery.parseJSON(response.data));
                                }
                            },
                            function (response) { alert(jQuery.parseJSON(response.data)); }
                        );
        };
        $scope.Delivered= function () {

            var oServiceOrder=$scope.ServiceOrder;
            oServiceOrder.nRequest=3; // 3: Delivered
            oServiceOrder.Remarks=$scope.ServiceOrder.Comments; 
            oServiceOrder.ActualRcvDateTime= $('#txtDateTime').datebox('getValue');

            $http.post(sessionStorage.getItem('BaseAddress')+'/ServiceOrder/UpdateStatus', JSON.stringify(oServiceOrder)).then(
                            function (response) {
                                if (jQuery.parseJSON(response.data) == 'Delivered') 
                                {
                                    alert("Successfully Delivered.");
                                    var oServiceOrder=$scope.ServiceOrder;
                                    oServiceOrder.OrderStatusInt=3;
                                    oServiceOrder.OrderStatusSt="Delivered";

                                    userSession.setData('ServiceOrderList',oServiceOrder);
                                    userSession.previousPage();
                                    $scope.Close();
                                }
                                else 
                                {
                                    alert(jQuery.parseJSON(response.data));
                                }
                            },
                            function (response) { alert(jQuery.parseJSON(response.data)); }
                        );
        };
        $scope.Cancel= function () {

            var oServiceOrder=$scope.ServiceOrder;
            oServiceOrder.nRequest=4; // 4: Cancel
            oServiceOrder.Remarks=$scope.ServiceOrder.Comments; 
            oServiceOrder.ActualRcvDateTime= $('#txtDateTime').datebox('getValue');

            $http.post(sessionStorage.getItem('BaseAddress')+'/ServiceOrder/UpdateStatus', JSON.stringify(oServiceOrder)).then(
                            function (response) {
                                if (jQuery.parseJSON(response.data) == 'Cancel') 
                                {
                                    alert("Successfully Canceled.");
                                    $scope.ServiceOrder.OrderStatusInt=4;
                                    $scope.ServiceOrder.OrderStatusSt="Cancel";

                                    userSession.setData('ServiceOrderList',oServiceOrder);
                                    userSession.previousPage();
                                    $scope.Close();
                                }
                                else 
                                {
                                    alert(jQuery.parseJSON(response.data));
                                }
                            },
                            function (response) { alert(jQuery.parseJSON(response.data)); }
                        );
        };
      

        $scope.Close=function ()
        {
            debugger;
            window.location.href = sessionStorage.getItem("BackLink");
        };
    });

</script>