<html>
<body>
    <head>
        <title>Advance Search</title>
        <link href="@Url.Content("~/Content/CSS/icon.css")" rel="stylesheet" type="text/css" />
        <link href="@Url.Content("~/Content/CSS/easyui.css")" rel="stylesheet" type="text/css" />
        <link href="@Url.Content("~/Content/CSS/Pikerstyle.css")" rel="stylesheet" type="text/css" />
        <script src="@Url.Content("~/Scripts/jquery-1.7.1.min.js")" type="text/javascript"></script>
        <script src="@Url.Content("~/Scripts/jquery.ics.customize.js")" type="text/javascript"></script>
        <script src="@Url.Content("~/Scripts/jquery.easyui.min.js")" type="text/javascript"></script>
        <script src="@Url.Content("~/Scripts/jquery-ui.min.js")" type="text/javascript"></script>
        <script src="@Url.Content("~/Scripts/json2.js")" type="text/javascript"></script>
    </head>
    @model ESimSol.BusinessObjects.ProductionSchedule
    <div style="font-family: Tahoma">
        <table border="0" cellspacing="2" cellpadding="2">
            <tr>
                <td style="background-color: #CFB53B; text-align: center; width: 890px; color: white">
                    <label id="lblHeaderName" style="font-size: 15px; color: white; font-weight: bold;
                        text-decoration: Underline">
                        Production Schedule</label>
                </td>
            </tr>
        </table>
    </div>
    <div style="font-family: Verdana; font-size: 12px; padding-left: 10px;">
        <fieldset>
            <legend><b>Searching Criteria</b></legend>
            <div style="float: left; width: 47%;">
                <table border="0" cellspacing="2" cellpadding="1" style="font-size: 11px; font-weight: bold;">
                    <tr>
                        <td style="width: 130px; text-align: right">
                            Plan Date:
                        </td>
                        <td style="width: 240px;">
                            @Html.DropDownList("cboUpdateDate", new SelectList(Enum.GetValues(typeof(ICS.Core.Utility.EnumCompareOperator))), new { id = "cboUpdateDate", style = "width: 235px;", @class = "_select_changeA" })
                        </td>
                    </tr>
                    <tr>
                        <td style="width: 130px; text-align: right">
                        </td>
                        <td style="width: 240px;">
                            <span>
                                <input type="text" class="easyui-datebox" style="width: 105px;" id="txtSearchStartDate"
                                    data-options="formatter:icsdateformat,parser:icsdateparser" />
                            </span><span id="tdDate">To
                                <input type="text" class="easyui-datebox" style="width: 105px;" id="txtSearchEndDate"
                                    data-options="formatter:icsdateformat,parser:icsdateparser" />
                            </span>
                        </td>
                    </tr>
                    <tr>
                        <td style="width: 130px; text-align: right">
                            Machine Date:
                        </td>
                        <td style="width: 240px;">
                            @Html.DropDownList("cboLoadUnloadDate", new SelectList(Enum.GetValues(typeof(ICS.Core.Utility.EnumCompareOperator))), new { id = "cboLoadUnloadDate", style = "width: 235px;", @class = "_select_changeB" })
                        </td>
                    </tr>
                    <tr>
                        <td style="width: 130px; text-align: right">
                        </td>
                        <td style="width: 240px;">
                            <span>
                                <input type="text" class="easyui-datebox" style="width: 105px;" id="txtLoadUnloadStartDate"
                                    data-options="formatter:icsdateformat,parser:icsdateparser" />
                            </span><span id="tdLoadUnloadDate">To
                                <input type="text" class="easyui-datebox" style="width: 105px;" id="txtLoadUnloadEndDate"
                                    data-options="formatter:icsdateformat,parser:icsdateparser" />
                            </span>
                        </td>
                    </tr>
                    <tr>
                        <td style="width: 130px; text-align: right">
                        </td>
                        <td style="width: 240px;">
                            <input type="checkbox" id="chkDyeLoad" />Load
                            <input type="checkbox" id="chkDyeUnLoad" />Unload
                            <div id="regionForDyeLoad">
                                <input type="checkbox" id="chkDyeLoadEqual" />Equal
                                <input type="checkbox" id="chkDyeLoadBefore" />Before</div>
                            <div id="regionForDyeUnLoad">
                                <input type="checkbox" id="chkDyeUnLoadEqual" />Equal
                                <input type="checkbox" id="chkDyeUnLoadAfter" />After</div>
                        </td>
                    </tr>
                    <tr>
                        <td style="width: 130px; text-align: right">
                            Machine Name:
                        </td>
                        <td style="width: 240px;">
                            <input type="text" id="txtMachineName" style="width: 180px;" />
                            <span>
                                <input type="button" id="btnPickMachine" value="P" style="width: 25px; font-size: 11px;" /></span>
                            <span>
                                <input type="button" id="btnResetMachine" value="R" style="width: 25px; font-size: 11px;" /></span>
                        </td>
                    </tr>
                    <tr>
                        <td style="width: 130px; text-align: right">
                            Yarn Name:
                        </td>
                        <td style="width: 240px;">
                            <input type="text" id="txtYarnName" style="width: 180px;" />
                            <span>
                                <input type="button" id="btnPickYarn" value="P" style="width: 25px; font-size: 11px;" /></span>
                            <span>
                                <input type="button" id="btnResetYarn" value="R" style="width: 25px; font-size: 11px;" /></span>
                        </td>
                    </tr>
                    <tr>
                        <td style="width: 130px; text-align: right">
                            Execution No:
                        </td>
                        <td style="width: 240px;">
                            <input id="txtJobCode" type="text" placeholder="Code" value="33" style="width: 33px;
                                font-size: 11px;" maxlength="2" />
                            <input id="txtJobNo" type="text" placeholder="Exe No" style="width: 60px; font-size: 11px;"
                                maxlength="5" />
                            <input id="txtJobYear" type="text" placeholder="Year" style="width: 33px; font-size: 11px;"
                                maxlength="2" />
                            <span>
                                <input type="button" id="btnResetExe" value="R" style="width: 25px; font-size: 11px;" /></span>
                        </td>
                    </tr>
                    <tr>
                        <td style="width: 130px; text-align: right;">
                            Schedule No:
                        </td>
                        <td style="width: 240px;">
                            <input id="txtSchedule" type="text" value="PS" style="width: 33px; font-size: 11px;"
                                maxlength="2" disabled />
                            <input id="txtScheduleNo" type="text" placeholder="PS No" style="width: 60px; font-size: 11px;" />
                            <input id="txtScheduleYear" type="text" placeholder="Year" style="width: 47px; font-size: 11px;"
                                maxlength="4" />
                            <span>
                                <input type="button" id="btnResetSchedule" value="R" style="width: 25px; font-size: 11px;" /></span>
                        </td>
                    </tr>
                    <tr>
                        <td style="width: 130px; text-align: right;">
                            Production Type
                        </td>
                        <td style="width: 240px;">
                            <input id="chkInHouse" type="checkbox" />In House
                            <input id="chkOutSide" type="checkbox" />Outside
                        </td>
                    </tr>
                    <tr>
                        <td style="width: 130px; text-align: right;">Order Type</td>
                        <td style="width: 240px;">
                            <input id="chkBulk" type="checkbox" />Bulk
                            <input id="chkSample" type="checkbox" />Sample
                        </td>
                    </tr>
                </table>
                <div style="float: right; padding-right: 5px; padding-top: 220px;">
                    <a href="javascript:void(0)" class="easyui-linkbutton" id="btnResetAll" iconcls="icon-reload"
                        plain="true">Reset</a> <a href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-search"
                            plain="true" onclick="Search()">Search</a>
                </div>
            </div>
            <div style="float: left; width: 52%;">
                <div id="OrderWise" style="margin-left: 0px; height: 500px; width: 400px; padding-top: 5px;
                    padding-left: 15px;">
                    <table id="tblProductionScheduleDetail" class="easyui-datagrid" style="width: 400px;
                        height: 500px" fitcolumns="false" rownumbers="true" pagination="false" singleselect="true"
                        autorowheight="false" toolbar="#orderWisetoolbar">
                        <thead>
                            <tr>
                                <th data-options="field:'Selected',checkbox:true">
                                </th>
                                <th field="ProductionScheduleNo" width="110" align="left">
                                    Schedule No
                                </th>
                                <th field="ProductName" width="140" align="left">
                                    Product Name
                                </th>
                                <th field="ProductionQty" width="100" align="right">
                                    Quantity
                                </th>
                                <th field="OrderNo" width="140" align="left">
                                    Order No
                                </th>
                            </tr>
                        </thead>
                    </table>
                    ​
                    <div id="orderWisetoolbar">
                        <a href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-reload" plain="true"
                            onclick="productWiseRefresh()"></a>
                        <input type="text" id="txtSearchbyProductWiseProductName" placeholder="Search by Product Name"
                            style="width: 170px" onclick="productWiseClearfield()" />
                    </div>
                </div>
                <div style="float: right; padding-right: 1px; padding-top: 15px;">
                    <a href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-ok" plain="true"
                        onclick="ok()">Ok</a> <a href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-cancel"
                            plain="true" onclick="Close()">Close</a>
                </div>
            </div>
        </fieldset>
    </div>
</body>
</html>
<script type="text/javascript">


 var _bMultipleItemReturn=true;
 var _sBaseAddress="";
 var _oProductionSchedule=null;
 var obj=window.dialogArguments;
 var _sProductIDs="";
 var _sPSSIDs="";
 var _nLocationID=0;
 var _sDyeLoadUnLoad="";
 var _oProductionScheduleDetails=[];
 var _sStatus="";
 var _bIsInHouse=null; 
 var _nOrderType=-1;
 var _oMergeCells=[];


   $(document).ready(function () 
  {
       _sBaseAddress =@Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(HttpContext.Current.Session[SessionInfo.BaseAddress]));                  
       _oProductionSchedule =@Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(Model));
       document.getElementById('regionForDyeLoad').style.display='none';
       document.getElementById('regionForDyeUnLoad').style.display='none';
       SetCurrenDate();
       $('#txtJobCode').numberbox({min:0,precision:0});
       $('#txtJobYear').numberbox({min:0,precision:0});
       $('#txtScheduleNo').numberbox({min:0,precision:0});  
       $('#txtScheduleYear').numberbox({min:0,precision:0});
       var sYear=(new Date()).getFullYear().toString();
       $('#txtJobYear').numberbox('setValue',parseInt(sYear.substring(2,sYear.length)));
       $('#txtScheduleYear').numberbox('setValue',parseInt(sYear));
        
        if($("#cboLoadUnloadDate").val()=="None")
        {
            document.getElementById("chkDyeLoad").disabled=true;
            document.getElementById("chkDyeUnLoad").disabled=true; 
            _sDyeLoadUnLoad="";    
        }

        if(_bMultipleItemReturn==false)
        {
            $('#tblProductionScheduleDetail').datagrid('hideColumn','Selected'); 
            $('#tblProductionScheduleDetail').datagrid({ onDblClickRow: function (rowIndex, rowData) { RowDoubleClickEvent(rowIndex, rowData); } });
        } 

   });


   function SetCurrenDate()
   {
       $('#txtSearchStartDate').datebox('setValue', icsdateformat(new Date()));
       $('#txtSearchEndDate').datebox('setValue', icsdateformat(new Date()));
       $('#txtLoadUnloadStartDate').datebox('setValue', icsdateformat(new Date()));
       $('#txtLoadUnloadEndDate').datebox('setValue', icsdateformat(new Date()));
   }

 $('._select_changeA').change(function () {
        //debugger
        var x = $("#cboUpdateDate").val();
        if (x == "EqualTo" || x == "NotEqualTo" || x == "GreaterThen" || x == "SmallerThen") 
        {
            document.getElementById("tdDate").style.display = 'none';
                    
        }
        else 
        {   
            document.getElementById("tdDate").style.display = '';
        }
    });

     $('._select_changeB').change(function () {
        //debugger 
        var x = $("#cboLoadUnloadDate").val();
        if(x=="None")
        {
            document.getElementById("chkDyeLoad").checked=false;
            document.getElementById("chkDyeUnLoad").checked=false; 
            document.getElementById("chkDyeLoad").disabled=true;
            document.getElementById("chkDyeUnLoad").disabled=true; 
            document.getElementById('regionForDyeLoad').style.display='none';
            document.getElementById('regionForDyeUnLoad').style.display='none';
            _sDyeLoadUnLoad="";    
        }
        else
        {
            document.getElementById("chkDyeLoad").disabled=false;
            document.getElementById("chkDyeUnLoad").disabled=false; 
            _sDyeLoadUnLoad="";  
        }
        if (x == "EqualTo" || x == "NotEqualTo" || x == "GreaterThen" || x == "SmallerThen") 
        {
            document.getElementById("tdLoadUnloadDate").style.display = 'none';       
        }
        else 
        {   
            document.getElementById("tdLoadUnloadDate").style.display = '';
        }
    });




 $('#txtMachineName').keypress(function (e) 
{
        debugger;
        var code = (e.keyCode ? e.keyCode : e.which);
        var sName=document.getElementById("txtMachineName").value;
        
        if (code == 13)//Enter key-13
        {
            if($.trim(sName)!="")
            {  
                _sPSSIDs=""; _nLocationID=0;
                var nts=(new Date()).getTime()/1000;
                var oParameter = new Object();
                oParameter.MultipleItemReturn = true;
                oParameter.Name=sName;
                var url = _sBaseAddress + "/ProductionSchedule/ViewMachineByName?sStr="+$.trim(sName)+"&nts="+nts;
                var oReturnObjects = window.showModalDialog(url, oParameter, 'dialogHeight:400px;dialogWidth:400px;dialogLeft:400;dialogTop:100;center:yes;resizable:no;status:no;scroll:no');
                if (oReturnObjects!=null)
                {
                    SetMachineInfo(oReturnObjects);
                }
            }
            else
            {
                alert("Please enter somethig to seach machine.");
            }
        }
});

$('#btnPickMachine').click(function(e)
{
        var oParameter = new Object();
       
        oParameter.Name = "AdSearch";
        oParameter.MultipleReturn=true;
        var url =_sBaseAddress+ "/ProductionSchedule/ViewMachine";
        var oReturnObject=window.showModalDialog(url, oParameter,'dialogHeight:400px;dialogWidth:600px;dialogLeft:450;dialogTop:150;center:yes;resizable:no;status:no;scroll:yes');
        if(oReturnObject.DyeMachines!=null)
        {
               SetMachineInfo(oReturnObject.DyeMachines);
        }
});

function SetMachineInfo(oReturnObjects)
{
        var sMachineName="";
        if(oReturnObjects.length>0)
        {
            for(var i=0; i<oReturnObjects.length;i++)
            {
                sMachineName=sMachineName+oReturnObjects[i].MachineName+", "
                _sPSSIDs=_sPSSIDs+oReturnObjects[i].PSSID+",";
            }
            sMachineName= ($.trim(sMachineName)).substring(0,$.trim(sMachineName).length-1);
            _sPSSIDs=_sPSSIDs.substring(0,_sPSSIDs.length-1);
            $("#txtMachineName")[0].value=sMachineName;
            _nLocationID = oReturnObjects[0].LocationID;
        }
        else
        {
            _sPSSIDs="";
            $("#txtMachineName")[0].value="";
            _nLocationID = 0;
            alert("No information found.");
        }
}

$('#btnResetMachine').click(function(e)
{
   _sPSSIDs="";
   $("#txtMachineName")[0].value="";
  _nLocationID = 0;
});


$('#txtYarnName').keypress(function (e) 
{
        ////debugger;
        var code = (e.keyCode ? e.keyCode : e.which);
        if (code == 13)//Enter key-13
        {
            var sName=document.getElementById("txtYarnName").value;
            if($.trim(sName)!="")
            {
                var InOutType =  100;                
                var DBObjectName='PIProducts';
                var TriggerParentsType=102; // _DeliveryChallanDetail = 102,
                var OperationalEvent=704;   // _Add = 701,//insert
                var Direction=0;
                var StoreID=0;
                var MapStoreID=0;     
           
                var sValue=DBObjectName+'~'+ TriggerParentsType+'~'+InOutType +'~'+ OperationalEvent +'~'+ Direction +'~'+ StoreID +'~'+MapStoreID;
       
                var nts=(new Date()).getTime()/1000;
                var oParameter = new Object();
                oParameter.MultipleItemReturn = true;
                oParameter.Name=sName;
                oParameter.Value=sValue;
                var url = _sBaseAddress + "/Product/ProductSearchingByName?&ts="+nts;
                var oReturnObjects =  window.showModalDialog(url, oParameter, 'dialogHeight:615px;dialogWidth:652px;dialogLeft:450;dialogTop:50;center:yes;resizable:yes;status:no;scroll:no');
                if(oReturnObjects!=null)
                {
                    var sProductName="";
                    if(oReturnObjects.length>0)
                    {
                       for(var i=0; i<oReturnObjects.length;i++)
                       {
                           sProductName=sProductName+oReturnObjects[i].ProductName+',';
                           _sProductIDs=_sProductIDs+oReturnObjects[i].ProductID+',';
                       }
                       sProductName= sProductName.substring(0,sProductName.length-1);
                       _sProductIDs=_sProductIDs.substring(0,_sProductIDs.length-1);
                    }
                    $("#txtYarnName")[0].value =sProductName;
                }
             }
         }
 });
   
$('#btnPickYarn').click(function (e) {
    //debugger;
    var tsv = ((new Date()).getTime()) / 1000;
    var oParameter = new Object();
    oParameter.MultipleItemReturn = true;
    var url = _sBaseAddress + "/Product/ProductSearching?ts="+tsv;
    var oReturnObjects = window.showModalDialog(url, oParameter, 'dialogHeight:650px;dialogWidth:650px;dialogLeft:100;dialogTop:50;center:yes;resizable:no;status:no;scroll:no');
    ////debugger;
    if(oReturnObjects!=null)
    {
        var sProductName="";
        if(oReturnObjects.length>0)
        {
            for(var i=0; i<oReturnObjects.length;i++)
            {
                sProductName=sProductName+oReturnObjects[i].ProductName+',';
                _sProductIDs=_sProductIDs+oReturnObjects[i].ProductID+',';
            }
            sProductName= sProductName.substring(0,sProductName.length-1);
            _sProductIDs=_sProductIDs.substring(0,_sProductIDs.length-1);
        }
        $("#txtYarnName")[0].value =sProductName;
    }
  
});  

$('#btnResetYarn').click(function (e) {

 $("#txtYarnName")[0].value ='';
 _sProductIDs='';

});

$('#btnResetExe').click(function (e) { ResetExe();});

function ResetExe()
{ 
     var sYear=(new Date()).getFullYear().toString();
     $('#txtJobCode').numberbox('setValue',33);
     $("#txtJobNo")[0].value ='';  
     $('#txtJobYear').numberbox('setValue',parseInt(sYear.substring(2,sYear.length))); 
}

$('#btnResetSchedule').click(function (e) { ResetSchedule();});

function ResetSchedule()
{
     var sYear=(new Date()).getFullYear();
     $('#txtScheduleNo').numberbox('setValue',''); 
     $('#txtScheduleYear').numberbox('setValue',parseInt(sYear)); 
}


$('#btnResetAll').click(function (e) {

    $('#cboUpdateDate').val(0);    
    $('#cboLoadUnloadDate').val(0); 
    SetCurrenDate();
    document.getElementById("tdDate").style.display = '';
    document.getElementById("tdLoadUnloadDate").style.display = ''; 
    document.getElementById("chkDyeLoad").checked=false;
    document.getElementById("chkDyeUnLoad").checked=false; 
    document.getElementById('regionForDyeLoad').style.display='none';
    document.getElementById('regionForDyeUnLoad').style.display='none';
    _sDyeLoadUnLoad="";     
    _sPSSIDs="";
    $("#txtMachineName")[0].value="";
    _nLocationID = 0;
    $("#txtYarnName")[0].value ='';
    _sProductIDs='';
    ResetExe();
    ResetSchedule();
    _bIsInHouse=null; 

    
    $('#chkInHouse,#chkOutSide,#chkBulk,#chkSample').prop("checked",false);
 
});


function GenerateExeNo()
{
     
       debugger;
       var sExecution="";
       var sYear=(new Date()).getFullYear().toString();
       var nYear= parseInt(sYear.substring(2,sYear.length));

       var sExeCode=$('#txtJobCode').numberbox('getValue');
       var sExeNo=document.getElementById('txtJobNo').value;
       var sExeYear=$('#txtJobYear').numberbox('getValue');  
       if( (sExeCode=='33' && $.trim(sExeNo)=='' &&  parseInt(sExeYear)==nYear) || $.trim(sExeCode)=='' || $.trim(sExeNo)=='' || $.trim(sExeYear)=='') { sExecution="";}
       else{ sExecution=sExeCode+'-'+$.trim(sExeNo)+'/'+sExeYear;}
       
       return sExecution;
}


function GenerateScheduleNo()
{
       debugger;
       var sScheduleNo="";
       var sYear=(new Date()).getFullYear().toString();
       var nYear= parseInt(sYear.substring(2,sYear.length));

       var sScheduleNo= $('#txtScheduleNo').numberbox('getValue'); 
       var sScheduleYear= $('#txtScheduleYear').numberbox('getValue');
       if( ($.trim(sScheduleNo)=='' &&  sScheduleYear==sYear) || $.trim(sScheduleNo)=='' ||  $.trim(sScheduleYear)=='') { sScheduleNo="";}
       else{ sScheduleNo= document.getElementById('txtSchedule').value +'-'+$.trim(sScheduleNo)+'-'+sScheduleYear;}

       return sScheduleNo;
}
 function Validation()
 {    
       debugger;  

       var bExecutionSearch=true;
       var bScheduleSearch=true;
  
       if(GenerateExeNo()==""){bExecutionSearch=false;}

       if(GenerateScheduleNo()=="") { bScheduleSearch=false;}

       if(bExecutionSearch)
       {
           if(  $.trim($('#txtJobCode').numberbox('getValue')).length!=2){ alert("Exe code must be two digit"); document.getElementById('txtJobCode').focus(); return false;}
           else if( $.trim(document.getElementById('txtJobNo').value).length!=5){ alert("Exe no must be five digit"); document.getElementById('txtJobNo').focus(); return false;}
           else if(  $.trim($('#txtJobYear').numberbox('getValue')).length!=2){ alert("Please enter last two digit of a year."); document.getElementById('txtJobYear').focus(); return false;}
       }
       if(bScheduleSearch)
       {
           if(  $.trim($('#txtScheduleNo').numberbox('getValue')).length<=0){ alert("Please enter schedule no"); document.getElementById('txtScheduleNo').focus(); return false;}
           else if(  $.trim( $('#txtScheduleYear').numberbox('getValue')).length!=4){ alert("Schedule year must be four digit. Like "+(new Date()).getFullYear()+" ."); document.getElementById('txtScheduleYear').focus(); return false;}
       }

       if( $('#cboUpdateDate').val()=='None' &&$('#cboLoadUnloadDate').val()=='None' && $.trim(_sDyeLoadUnLoad)=="" && $.trim(_sPSSIDs)=="" && _nLocationID==0 && $.trim(_sProductIDs)=="" && !bExecutionSearch && !bScheduleSearch && _bIsInHouse==null && _nOrderType==-1)
       {
          alert("Please select at least one criteria."); return false;
       }

       return true;

 } 
 function MakeQueryString()
 {
       var sPlanDateType=$('#cboUpdateDate').val();
       var dStartTime=$("#txtSearchStartDate").datebox('getValue');
       var dEndTime=$("#txtSearchEndDate").datebox('getValue'); 
       var sLoadUnloadDateType=$('#cboLoadUnloadDate').val();
       var dLoadUnloadStartTime=$("#txtLoadUnloadStartDate").datebox('getValue'); 
       var dLoadUnloadEndTime=$("#txtLoadUnloadEndDate").datebox('getValue');
       var nInHouse=-1; // Both(Inhouse & OutSide)
       if(_bIsInHouse){nInHouse=1;}
       else if(_bIsInHouse==false){nInHouse=0;}

       var sValue=sPlanDateType +'~'+ dStartTime +'~'+ dEndTime +'~'+ sLoadUnloadDateType +'~'+ dLoadUnloadStartTime +'~'+ dLoadUnloadEndTime +'~'+
                  _sPSSIDs +'~'+ _nLocationID +'~'+ _sProductIDs +'~'+ GenerateExeNo() +'~'+ GenerateScheduleNo()+'~'+ $.trim(_sDyeLoadUnLoad)+'~'+$.trim(_sStatus)+'~'+nInHouse+'~'+_nOrderType;
       return sValue;
        
 }
 function Search()
 {

        debugger;
        if(!Validation()){return;}

        var sValue=MakeQueryString();

        var nts=(new Date()).getTime()/1000;
        $.ajax({
        type: "POST",
        dataType: "json",            
        url : _sBaseAddress+  "/ProductionSchedule/AdvanceSearch",
        traditional: true,
        data:  JSON.stringify({sValue:sValue, nts:nts}),
        contentType: "application/json; charset=utf-8",
        success: function (data)
        {
             
               debugger;
                 var oPS= jQuery.parseJSON(data);
                _oProductionScheduleDetails=oPS.ProductionScheduleDetailList;
                _oMergeCells=oPS.MergeCells;
                if (_oProductionScheduleDetails != null) {                   
                    if(_oProductionScheduleDetails.length>0 && _oProductionScheduleDetails[0].ErrorMessage=="")
                    {
                     
                        data =_oProductionScheduleDetails;       
                        data={"total":""+data.length+"","rows":data};
                        $('#tblProductionScheduleDetail').datagrid('loadData',data); 
                        $('#tblProductionScheduleDetail').datagrid({selectOnCheck:false, checkOnSelect:false})
                        if(_bMultipleItemReturn==false)
                        {
                             $('#tblProductionScheduleDetail').datagrid('hideColumn','Selected'); 
                             $('#tblProductionScheduleDetail').datagrid({ onDblClickRow: function (rowIndex, rowData) { RowDoubleClickEvent(rowIndex, rowData); } });
                        }

                    }    
                    else
                    {
                        alert( _oProductionScheduleDetails[0].ErrorMessage);
                        data =[];       
                        data={"total":""+data.length+"","rows":data};
                        $('#tblProductionScheduleDetail').datagrid('loadData',data); 
                    }              
                }
            },
            error: function (xhr, status, error) {
                alert(error);
            }
        });

 }



function ok()
{

        var oPS=new Object();
        var SelectedProductionSchedules=[];
         if(_bMultipleItemReturn==true)
         {
            SelectedProductionSchedules = $('#tblProductionScheduleDetail').datagrid('getChecked');               
            if(SelectedProductionSchedules.length<=0)
            {
                alert("please select atleast one item");                                          
                return;
            }
            oPS.SelectedProductionSchedules= SelectedProductionSchedules;
            oPS.MergeCells=_oMergeCells;
            window.returnValue= oPS;
         }
         else
         {
             SelectedProductionSchedules= $('#tblProductionScheduleDetail').datagrid('getSelected'); 
             if(SelectedProductionSchedules==null)
             {
                    alert("please select a Product");
                    return;
             }
             oPS.SelectedProductionSchedules= SelectedProductionSchedules;
             oPS.MergeCells=_oMergeCells;
             window.returnValue= oPS;
         }
         window.close(); 


}


function Close()
{
  window.close();
}

function RefreshListProductWise(oScheduleDtails)
{    
        data=oScheduleDtails;
        data={"total":""+data.length+"","rows":data};
        $('#tblProductionScheduleDetail').datagrid('loadData',data);
        $('#tblProductionScheduleDetail').datagrid({selectOnCheck:false, checkOnSelect:false})

}

function productWiseRefresh()
{  
    document.getElementById("txtSearchbyProductWiseProductName").value="Search by Product Name";  
    RefreshListProductWise(_oProductionScheduleDetails);
} 
function productWiseClearfield()
{
    $("#txtSearchbyProductWiseProductName")[0].value='';
} 

$('#txtSearchbyProductWiseProductName').keypress(function (e) {

    debugger;
    var code = (e.keyCode ? e.keyCode : e.which);
    if (code == 13)//Enter key-13
    {
        SearchbyProductName();
    }
    $('#txtSearchbyProductWiseProductName').focus();


});

function  SearchbyProductName()
{
    if (_oProductionScheduleDetails.length <= 0)
    {
            alert("There are no data for searching!!!!");
            return;
    }
    var sSearchbyProductName= document.getElementById('txtSearchbyProductWiseProductName').value;
    if(sSearchbyProductName=="")
    {
        RefreshListProductWise(_oProductionScheduleDetails);
    }
    else
    {

        var sName = "";
        var oSearchedData = [];
            
        var n = 0;
        for (i = 0; i < _oProductionScheduleDetails.length; ++i)
        {
        sName = _oProductionScheduleDetails[i].ProductName;
        n = 0;
        n = sName.toUpperCase().indexOf(sSearchbyProductName.toUpperCase());
        if (n != -1)
        {
            oSearchedData.push(_oProductionScheduleDetails[i]);
        }
        }

        $('#tblProductionScheduleDetail').empty();
        data = oSearchedData;
        data={"total":""+data.length+"","rows":data};
        $('#tblProductionScheduleDetail').datagrid('loadData',data); 
               
        }
}

 
$('#chkDyeLoad').change(function(e)
{
   _sDyeLoadUnLoad="";
   document.getElementById('regionForDyeLoad').style.display='none';
   document.getElementById('regionForDyeUnLoad').style.display='none';
   document.getElementById('chkDyeLoadEqual').checked=false; 
   document.getElementById('chkDyeLoadBefore').checked=false; 
   if(document.getElementById('chkDyeLoad').checked==true)
   {
      _sDyeLoadUnLoad="DyeLoad";
      document.getElementById('chkDyeUnLoad').checked=false;
      document.getElementById('regionForDyeLoad').style.display=''; 
   }

});

$('#chkDyeUnLoad').change(function(e)
{
   _sDyeLoadUnLoad="";
   document.getElementById('regionForDyeLoad').style.display='none';
   document.getElementById('regionForDyeUnLoad').style.display='none';
   document.getElementById('chkDyeUnLoadEqual').checked=false;   
   document.getElementById('chkDyeUnLoadAfter').checked=false; 
   if(document.getElementById('chkDyeUnLoad').checked==true)
   {
      _sDyeLoadUnLoad="DyeUnLoad";
      document.getElementById('chkDyeLoad').checked=false; 
      document.getElementById('regionForDyeUnLoad').style.display='';
   }
});



$('#chkDyeLoadEqual').change(function(e)
{
   _sStatus="";
   if(document.getElementById('chkDyeLoadEqual').checked==true)
   {
      _sStatus="DyeLoad";
      document.getElementById('chkDyeLoadBefore').checked=false; 
   }
});

$('#chkDyeLoadBefore').change(function(e)
{
   _sStatus="";
   if(document.getElementById('chkDyeLoadBefore').checked==true)
   {
      _sStatus="BeforeDyeLoad";
      document.getElementById('chkDyeLoadEqual').checked=false; 
   }
});

$('#chkDyeUnLoadEqual').change(function(e)
{
   _sStatus="";
   if(document.getElementById('chkDyeUnLoadEqual').checked==true)
   {
      _sStatus="DyeUnLoad";
      document.getElementById('chkDyeUnLoadAfter').checked=false; 
   }
});

$('#chkDyeUnLoadAfter').change(function(e)
{
   _sStatus="";
   if(document.getElementById('chkDyeUnLoadAfter').checked==true)
   {
      _sStatus="AfterDyeUnLoad";
      document.getElementById('chkDyeUnLoadEqual').checked=false; 
   }
});


$('#chkInHouse').change(function(e)
{
   _bIsInHouse=null;
   if(document.getElementById('chkInHouse').checked==true)
   {
      _bIsInHouse=true;
      document.getElementById('chkOutSide').checked=false; 
   }

});

$('#chkOutSide').change(function(e)
{
   _bIsInHouse=null;
   if(document.getElementById('chkOutSide').checked==true)
   {
      _bIsInHouse=false;
      document.getElementById('chkInHouse').checked=false; 
   }
});

$('#chkBulk').change(function(e)
{
    _nOrderType=-1;
    if(document.getElementById('chkBulk').checked==true)
    {
        _nOrderType=1;
        document.getElementById('chkSample').checked=false; 
    }

});

$('#chkSample').change(function(e)
{
    _nOrderType=-1;
    if(document.getElementById('chkSample').checked==true)
    {
        _nOrderType=2;
        document.getElementById('chkBulk').checked=false; 
    }
});

</script>
