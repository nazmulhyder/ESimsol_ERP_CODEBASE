@model ESimSol.BusinessObjects.SaleInvoice

    @{
        ViewBag.Title = "Performane Report";
    }

<div ng-app="DUSApp" class="form-horizontal regionSaleInvoice">
    <div ng-controller="DUSCntrl">

        @*<div class="ui-grid-top-panel" style="height:50px">
            <div class="text-left" style="padding-left:3px;padding-top:16px">
                <div class="row col-md-12">
                    <div class="col-md-2 text-right">
                        <label class="control-label">Business Unit :</label>
                    </div>
                    <div class="col-md-2 text-left">
                        <select id="cboUnit" ng-model="SaleInvoice.BUID" style="width:220px; margin:0 5px 0 0px" ng-options="obj.BusinessUnitID as obj.Name for obj in BusinessUnits" ng-disabled="DUBusinessUnitID > 0" class="form-control">
                            <option value="">--Select One--</option>
                        </select>
                    </div>
                </div>
            </div>
        </div>*@
      
        <div style="height:70%">
            <fieldset style="height:100%">
                @*<div class="row col-md-12" style="padding-top:50px;">
                    <div class="col-md-2 text-right">
                        <label class="control-label">Invoice No :</label>
                    </div>
                    <div class="col-md-10 text-left">
                        <div class="form-inline">
                            <input class="form-control" ng-style="stlInvoiceNo" ng-model="SaleInvoice.InvoiceNo" placeholder="Type Invoice No & Press Enter" ng-disabled="disabled" ng-keydown="SearchKeyDownInvoice($event)" style="width:50%" required />
                            <button type="button" class="btn btn-primary btn-sm" aria-label="right Align" ng-click="PickInvoice()" ng-disabled="disabled"><span aria-hidden="true"> Pick </span></button>
                            <button type="button" class="btn btn-danger btn-sm" aria-label="right Align" ng-click="RemoveInvoice()" ng-disabled="disabled"><span aria-hidden="true"> Remove </span></button>
                        </div>
                    </div>
                </div>

                <div class="row col-md-12">
                    <div class="col-md-2 text-right">
                        <label class="control-label">SQ No :</label>
                    </div>
                    <div class="col-md-10 text-left">
                        <div class="input-group" style=" width: 181%">
                            <input ng-model="SaleInvoice.ReceivedByName" class="form-control" ng-keydown="SearchKeyDownReceivedBy($event)" placeholder="Type Sales Quotation No & Press Enter" required />
                            <span class="input-group-btn">
                                @*<button style="margin-left:3px" type="button" class="btn btn-sm" aria-label="left Align" ng-click="ClearReceivedBy()">C </button>
                                <button style="margin-left:3px" type="button" class="btn btn-sm" aria-label="Left Align" ng-click="PickReceivedBy()"> <span class="glyphicon glyphicon-search" aria-hidden="true"></span></button>*@
                                @*<button type="button" class="btn btn-primary btn-sm" aria-label="right Align" ng-click="PickSQ()" ng-disabled="disabled"><span aria-hidden="true"> Pick </span></button>
                                <button type="button" class="btn btn-danger btn-sm" aria-label="right Align" ng-click="RemoveSQ()" ng-disabled="disabled"><span aria-hidden="true"> Remove </span></button>
                            </span>
                        </div>
                    </div>
                </div>*@
               
                <div class="row col-md-12" style="padding-top:80px;">
                    <div class="col-md-2 text-right">
                        <label class="control-label">Report Date:</label>
                    </div>
                    <div class="col-md-10 text-left">
                        <div class="form-inline" style="width:51%">
                            <select class="form-control" style="width:27%;" ng-model="cboReportDate" ng-change="ReportDateChange()" ng-options="item.id as item.Value for item in CompareOperators"></select>
                            <div class="input-group date date-container" style="width:32%;">
                                <input type="text" class="form-control" ng-model="ReportDateFrom"><span class="input-group-addon"><i class="glyphicon glyphicon-th"></i></span>
                            </div>
                            <span class="label label-primary">To</span>
                            <div class="input-group date date-container" style="width:32%;">
                                <input type="text" class="form-control" ng-model="ReportDateTo" ng-disabled="txtReportDateToDisabled"><span class="input-group-addon"><i class="glyphicon glyphicon-th"></i></span>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="row col-md-12">
                    <div class="col-md-2 text-right">
                        <label class="control-label">Marketing Person:</label>
                    </div>
                    <div class="col-md-10 text-left">
                        <div class="form-inline">
                            <input class="form-control" ng-style="stlInvoiceNo" ng-model="txtMarketingPerson" placeholder="Marketing Person Name.. " style="width:50%" disabled />
                            <button type="button" class="btn btn-primary btn-sm" aria-label="right Align" ng-click="PickMarketingPerson()" ng-disabled="disabled"><span aria-hidden="true"> Pick </span></button>
                            <button type="button" class="btn btn-danger btn-sm" aria-label="right Align" ng-click="RemoveMarketingPerson()" ng-disabled="disabled"><span aria-hidden="true"> Remove </span></button>
                        </div>
                    </div>
                </div>
                <div class="row col-md-12">
                    <div class="col-md-2 text-right">
                        <label class="control-label">Customer:</label>
                    </div>
                    <div class="col-md-10 text-left">
                        <div class="form-inline">
                            <input type="text" ng-model="CustomerName" class="form-control" style="width:50%" ng-keydown="SearchKeyDownReceivedBy($event)" placeholder="Type Customer Name & Press Enter" required />

                            <button type="button" class="btn btn-primary btn-sm" aria-label="right Align" ng-click="PickReceivedBy()" ng-disabled="disabled"><span aria-hidden="true"> Pick </span></button>
                            <button type="button" class="btn btn-danger btn-sm" aria-label="right Align" ng-click="ClearReceivedBy()" ng-disabled="disabled"><span aria-hidden="true"> Remove </span></button>
                        </div>
                    </div>
                </div>
                <div class="row col-md-12">
                    <div class="col-md-2 text-right">
                        <label class="control-label">Model No :</label>
                    </div>
                    <div class="col-md-10 text-left">
                        <div class="form-inline">
                            <input type="text" ng-model="ModelNo" class="form-control" style="width:50%" ng-keydown="SearchKeyDownVehicleModel($event)" placeholder="Type Customer Name & Press Enter" required />

                            <button type="button" class="btn btn-primary btn-sm" aria-label="right Align" ng-click="PickVehicleModel()" ng-disabled="disabled"><span aria-hidden="true"> Pick </span></button>
                            <button type="button" class="btn btn-danger btn-sm" aria-label="right Align" ng-click="ClearVehicleModel()" ng-disabled="disabled"><span aria-hidden="true"> Remove </span></button>

                        </div>
                    </div>
                </div>
                <div class="row col-md-12">
                    <div class="col-md-2 text-right">
                        <label class="control-label">Report Type:</label>
                    </div>
                    <div class="col-md-10 text-left">
                        <select id="cboFDOType" style="width:50%" ng-model="ReportTypeInt" ng-options="obj.id as obj.Value for obj in ReportTypes" ng-disabled="disabledType" class="form-control">
                            <option value="">----Select Report Type----</option>
                        </select>
                    </div>
                </div>
                <div class="row col-md-12" style="padding-bottom:21%;">
                    <div class=" col-md-2 text-right">
                    <label class="control-label">Report Layout:</label>
                </div>
                    <div class="col-md-10 text-left">
                        <select id="cboFDOType" style="width:50%" ng-model="ReportLayoutInt" ng-options="obj.id as obj.Value for obj in ReportLayouts" ng-disabled="disabledType" class="form-control">
                            <option value="">----Select Report Layout----</option>
                        </select>
                    </div>
                </div>
               
            </fieldset>
        </div>
        <div style="height:25%">
            <fieldset style="height:100%">
                <div class="row col-md-12" >
                    <div class="navbar-form">
                        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                        <button type="button" class="btn btn-warning btn-group-sm" aria-label="right Align" ng-click="Reset()" ng-disabled="disabled"><span aria-hidden="true"> Reset </span></button>
                        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;                        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                        <button type="button" class="btn btn-primary btn-sm" style="float:right; margin-right:22%" aria-label="left Align" ng-click="printPreformanceReport()" ng-disabled="disabled"><span class="glyphicon glyphicon-print" aria-hidden="true"> Preview </span></button>
                        <button type="button" class="btn btn-primary btn-sm" style="float:right;"aria-label="left Align" ng-click="printPreformanceReportExcel()" ng-disabled="disabled"><span class="glyphicon glyphicon-download-alt" aria-hidden="true"> Excel </span></button>
                    </div>
                </div>
            </fieldset>
        </div>
    </div>
</div>

<style type="text/css">
    .grid {
        width: 100%;
        height: 290px;
    }

    .regionSaleInvoice .form-horizontal .control-label {
        padding-top: 3px;
    }

    .regionSaleInvoice .form-control {
        height: 26px;
        padding: 0px 6px;
        font-size: 12px;
    }

    .regionSaleInvoice .col-md-12 {
        width: 100%;
        padding-right: 5px;
        padding-left: 5px;
        margin-bottom: 5px;
    }

    .regionSaleInvoice .col-md-2 {
        width: 16.6%;
        padding-right: 5px;
        padding-left: 5px;
    }

    .regionSaleInvoice .col-md-3 {
        width: 20%;
        padding-right: 5px;
        padding-left: 5px;
    }

    .regionSaleInvoice .col-md-4 {
        width: 28%;
        padding-right: 5px;
        padding-left: 5px;
    }

    .regionSaleInvoice .col-md-5 {
        width: 40%;
        padding-right: 5px;
        padding-left: 0px;
    }

    .regionSaleInvoice .col-md-6 {
        width: 50%;
        padding-right: 5px;
        padding-left: 5px;
    }

    .regionSaleInvoice .col-md-10 {
        width: 83%;
        padding-right: 5px;
        padding-left: 5px;
    }

    .regionSaleInvoice .col-md-8 {
        width: 69%;
        padding-right: 5px;
        padding-left: 5px;
    }

    .regionSaleInvoice .btn-sm {
        padding: 3px 10px;
    }

    .regionSaleInvoice .input-group-addon {
        padding: 4px 8px;
    }
</style>

<script type="text/javascript">

_sBaseAddress =@Html.Raw( new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(HttpContext.Current.Session[SessionInfo.BaseAddress]));
var oSaleInvoices =@Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(Model));
var nBUID = @Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(ViewBag.BUID));
var oBusinessUnits = @Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(ViewBag.BusinessUnits));
var oCompareOperators = @Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(ViewBag.CompareOperators));
var oReportTypes = @Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(ViewBag.ReportTypes));
var oReportLayouts = @Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(ViewBag.ReportLayouts));
var oMarketingAccounts = @Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(ViewBag.MarketingAccounts));
    
sessionStorage.setItem('BUID',nBUID);

var  DUSApp = angular.module('DUSApp',['ngAnimate','ui.bootstrap','ui.grid','ui.grid.selection','ui.grid.resizeColumns','ms.service']);
DUSApp.controller('DUSCntrl', function ($scope,$http,$uibModal,$log,uiGridConstants,msModal,userSession,icsMethod)
{
    $('.date-container').datepicker({
        format: "dd M yyyy",
        calendarWeeks: true,
        autoclose: true,
        todayHighlight: true
    });

    $scope.CompareOperators=oCompareOperators;
    $scope.ReportTypes=oReportTypes;
    $scope.ReportLayouts=oReportLayouts;
    $scope.BusinessUnits=oBusinessUnits;
    $scope.BusinessUnitID=nBUID;
    $scope.DUBusinessUnitID=nBUID;

    $scope.Reset= function ()
    {
        $scope.CompareOperators=oCompareOperators;
        $scope.ReportTypes=oReportTypes;
        $scope.ReportLayouts=oReportLayouts;

        $scope.cboReportDate = 0;
        $scope.ReportTypeInt = 0;
        $scope.ReportLayoutInt = 0;
        $scope.ReportDateFrom = $scope.ReportDateTo = icsdateformat(new Date());

        $scope.CustomerName='';
        $scope.ModelNo="";  
        $scope.txtMarketingPerson='';
        $scope.SaleInvoice={};

        //$scope.stlMarketingPerson= $scope.stlSQNo= $scope.stlInvoiceNo= $scope.stlModelNo= $scope.stlLCNo=$scope.stlDONo= {
        //    "color" : "black",
        //    "font-size" : "12px",
        //}
    }
    $scope.Reset();

    //------------PICKERS-------------

    //------------MarketingPerson-------------
    $scope.PickMarketingPerson= function ()
    {
        var oColumns = [];
        var oColumn = { field: 'Name', name: 'Applicant Name',width: '100%', enableSorting: false  };oColumns.push(oColumn);
        debugger;
        var results=oMarketingAccounts;

        if(results.length<=0)
        {
            alert("No Data Found!!"); return;
        }

        var modalObj={
            size:'md',
            modalcontroller:'ModalCommonListCtrl',
            appcontroller:'SalesQuotationController',
            objs:results,
            multiSelect:true,
            pickertitle:'Marketing Person List',
            searchingbyfieldName:'Name',
            columns:oColumns
        }
        var modalInstance=msModal.Instance(modalObj);
        modalInstance.result.then(function (result)
        {
            if(result.length>0)
            {
                if(result.length==1)
                {
                    $scope.SaleInvoice.MarketingAccountName=result[0].MarketingAccountID;
                    $scope.txtMarketingPerson=result[0].Name;
                }else
                {
                    $scope.txtMarketingPerson=result.length+" marketing person(s) are selected";
                    $scope.SaleInvoice.MarketingAccountName=result[0].MarketingAccountID;
                    for(var i=1;i< result.length; i++)
                    {
                        $scope.SaleInvoice.MarketingAccountName+=","+result[i].MarketingAccountID;
                    }
                }
            }

        }, function () {
            $log.info('Modal dismissed at: ' + new Date());
        });
                          
    };
    $scope.RemoveMarketingPerson= function ()
    {
        $scope.SaleInvoice.MarketingAccountName='';
        $scope.txtMarketingPerson='';
    }

    //------------SQ-------------
    $scope.PickSQ= function ()
    {
        var oDO= {
            SQNo:($scope.txtSQNo == undefined ? "" : $scope.txtSQNo),
            //ExportPIID:0,//DyeingSQID
            //SampleInvoiceID:0,
            ContractorID:$scope.MarketingPersonID,
            BUID:$scope.BusinessUnitID
        };

        var config = { headers: { 'Content-Type': 'application/x-www-form-urlencoded;charset=utf-8;' } };
        $http.post(sessionStorage.getItem('BaseAddress')+'/SaleInvoice/GetDyeingSQs',$.param(oDO), config).then(
                    function (response)
                    {
                        debugger;
                        var oDetailColumns = [];
                        var oColumn = { field: 'SQNoFull', name:'SQ No', width:'30%',cellClass: 'text-left', enableCellEdit:false };oDetailColumns.push(oColumn);
                        oColumn = { field: 'DyeingSQTypeSt', name:'Type', width:'15%',cellClass: 'text-left', enableCellEdit:false };oDetailColumns.push(oColumn);
                        oColumn = { field: 'ContractorName', name:'MarketingPerson', width:'30%',cellClass: 'text-left', enableCellEdit:false };oDetailColumns.push(oColumn);
                        oColumn = { field: 'SQDateSt', name:'SQ Date', width:'15%',cellClass: 'text-left', enableCellEdit:false };oDetailColumns.push(oColumn);
                        
                        var results=jQuery.parseJSON(response.data);

                        if(results.length<=0)
                        {
                            alert("No SQ Found!!"); return;
                        }else if(results[0].DyeingSQID==0)
                        {
                            alert(results[0].ErrorMessage);return;
                        }

                        var modalObj={
                            size:'lg',
                            modalcontroller:'',
                            appcontroller:'',
                            objs:results,
                            multiSelect:false,
                            pickertitle:'SQ List',
                            searchingbyfieldName:'SQNoFull',
                            columns:oDetailColumns
                        }
                        var modalInstance=msModal.Instance(modalObj);

                        modalInstance.result.then(function (result)
                        {
                            if(result.DyeingSQID>0)
                            {
                                $scope.stlSQNo= {
                                    "color" : "blue",
                                    "font-size" : "12px"
                                };
                                $scope.DyeingSQID=result.DyeingSQID;
                                $scope.txtSQNo=result.SQNo;
                            }
                            else
                                alert(result.ErrorMessage);
                               
                        }, function () {
                            $log.info('Modal dismissed at: ' + new Date());
                        });
                    },
                        function (response) { debugger; alert(jQuery.parseJSON(response.data).Message);}
                );
    };
    $scope.SearchKeyDownSQ = function (e){
        //debugger;
        var code = (e.keyCode ? e.keyCode : e.which);
        if (code == 13) 
        {
            var txtSQ = $.trim($scope.txtSQNo);
            if(txtSQ=="" || txtSQ==null)
            {
                alert("Type SQ No and Press Enter");
                return;
            }
            $scope.PickSQ();
        }else if (code == 8) //backspace=8
        {
            //debugger;
            $scope.txtSQNo='';
            $scope.DyeingSQID=0;
        }
    };
    $scope.RemoveSQ= function ()
    {
        $scope.stlSQNo= {
            "color" : "black",
            "font-size" : "12px"
        };
        $scope.DyeingSQID=0;
        $scope.txtSQNo="";
    }
    //------------Invoice-------------
    $scope.PickInvoice= function ()
    {
        debugger;
        var oInvoice= {
            SampleInvoiceNo:($scope.txtInvoiceNo == undefined ? "" : $scope.txtInvoiceNo),
            ///ExportModelNo:"",
            ContractorID:$scope.MarketingPersonID,
            SQNo:($scope.DyeingSQID<=0? "": $scope.txtSQNo),
            BUID:$scope.BusinessUnitID
        };

        var config = { headers: { 'Content-Type': 'application/x-www-form-urlencoded;charset=utf-8;' } };
        $http.post(sessionStorage.getItem('BaseAddress')+'/SaleInvoice/GetSampleInvoices',$.param(oInvoice), config).then(
                    function (response)
                    {
                        debugger;
                        var oDetailColumns = [];
                        var oColumn = { field: 'SampleInvoiceNo', name:'Invoice No', width:'30%',cellClass: 'text-left', enableCellEdit:false };oDetailColumns.push(oColumn);
                        oColumn = { field: 'ContractorName', name:'MarketingPerson', width:'45%',cellClass: 'text-left', enableCellEdit:false };oDetailColumns.push(oColumn);
                        oColumn = { field: 'SampleInvoiceDateST', name:'Date', width:'20%',cellClass: 'text-left', enableCellEdit:false };oDetailColumns.push(oColumn);

                        var results=jQuery.parseJSON(response.data);

                        if(results.length<=0)
                        {
                            alert("No Data Found!!"); return;
                        }else if(results[0].SampleInvoiceID==0)
                        {
                            alert(results[0].ErrorMessage);return;
                        }

                        var modalObj={
                            size:'md',
                            modalcontroller:'',
                            appcontroller:'',
                            objs:results,
                            multiSelect:false,
                            pickertitle:'Invoice List',
                            searchingbyfieldName:'SampleInvoiceNo',
                            columns:oDetailColumns
                        }
                        var modalInstance=msModal.Instance(modalObj);

                        modalInstance.result.then(function (result)
                        {
                            if(result.SampleInvoiceID>0)
                            {
                                $scope.stlInvoiceNo= {
                                    "color" : "blue",
                                    "font-size" : "12px"
                                };
                                $scope.SampleInvoiceID=result.SampleInvoiceID;
                                $scope.txtInvoiceNo=result.SampleInvoiceNo;
                            }
                            else
                                alert(result.ErrorMessage);
                        }, function () {
                            $log.info('Modal dismissed at: ' + new Date());
                        });
                    },
                        function (response) {  debugger; alert(jQuery.parseJSON(response.data).Message);}
                );
    };
    $scope.SearchKeyDownInvoice = function (e){
        //debugger;
        var code = (e.keyCode ? e.keyCode : e.which);
        if (code == 13) 
        {
            var txtSQ = $.trim($scope.txtInvoiceNo);
            if(txtSQ=="" || txtSQ==null)
            {
                alert("Type Invoice No and Press Enter");
                return;
            }
            $scope.PickInvoice();
        }else if (code == 8) //backspace=8
        {
            $scope.RemoveInvoice();
        }
    };
    $scope.RemoveInvoice= function ()
    {
        $scope.stlInvoiceNo= {
            "color" : "black",
            "font-size" : "12px"
        };
        $scope.txtInvoiceNo="";
        $scope.SampleInvoiceID=0;
    }
    
    //Received By
    $scope.PickReceivedBy= function ()
    {
        var oContractor = {
            Params: '2' + '~' + $.trim($scope.CustomerName)+'~'+sessionStorage.getItem('BUID')
        };
        var config = { headers: { 'Content-Type': 'application/x-www-form-urlencoded;charset=utf-8;' } };
        $http.post(_sBaseAddress+'/Contractor/ContractorSearchByNameType',$.param(oContractor), config).then(
                            function (response)
                            {
                                debugger;
                                var results=(response.data);
                                if(results.length<=0 || (results[0].ErrorMessage!=null && results[0].ErrorMessage!=""))
                                {
                                    alert(results[0].ErrorMessage); return;
                                }
                                console.log(results);
                                var oColumns = [];
                                var oColumn = { field: 'ContractorID', name: 'Code',width: '20%'  };oColumns.push(oColumn);
                                oColumn = { field: 'Name', name: 'Applicant Name',width: '50%', enableSorting: false  };oColumns.push(oColumn);
                                oColumn = { field: 'Address', name: 'Address',width: '30%', enableSorting: false  };oColumns.push(oColumn);

                                var modalObj={
                                    size:'md',
                                    modalcontroller:'ModalCommonListCtrl',
                                    appcontroller:'SaleInvoiceController',
                                    objs:results,
                                    multiSelect:true,
                                    pickertitle:'Applicant List',
                                    searchingbyfieldName:'Name',
                                    columns:oColumns
                                }
                                var modalInstance=msModal.Instance(modalObj);
                                modalInstance.result.then(function (result)
                                {
                                    debugger;
                                    if(result.length>0)
                                    {
                                        if(result.length==1)
                                        {
                                            $scope.SaleInvoice.CustomerName=result[0].ContractorID;
                                            $scope.CustomerName=result[0].Name;
                                        }else
                                        {
                                            $scope.CustomerName=result.length+" Customers are selected";
                                            $scope.SaleInvoice.CustomerName=result[0].ContractorID;
                                            for(var i=1;i< result.length; i++)
                                            {
                                                $scope.SaleInvoice.CustomerName+=","+result[i].ContractorID;
                                            }
                                        }
                                    }
                                }, function () {
                                    $log.info('Modal dismissed at: ' + new Date());
                                });
                            },
                              function (response) { alert((response.data).Message);}
                        );

    };
    $scope.SearchKeyDownReceivedBy = function (e){
        //debugger;
        var code = (e.keyCode ? e.keyCode : e.which);
        if (code == 13) {
            var RefNo = $.trim($scope.CustomerName);
            if(RefNo=="" || RefNo==null)
            {
                alert("Type Customer Name and Press Enter");
                return;
            }
            $scope.PickReceivedBy();
        }else if (code == 8) //backspace=8
        {
            //debugger;
            $scope.SaleInvoice.CustomerName="";
            //$scope.CustomerName='';
        }
    };
    $scope.ClearReceivedBy= function ()
    {
        $scope.SaleInvoice.CustomerName="";
        $scope.CustomerName='';
    }

    //------------PickVehicleModel-------------
    $scope.PickVehicleModel= function ()
    {
        debugger;
        var oVehicleModel = {
            ModelNo: $.trim($scope.ModelNo)
        };
        var config = { headers: { 'Content-Type': 'application/x-www-form-urlencoded;charset=utf-8;' } };
        $http.post(sessionStorage.getItem('BaseAddress')+'/VehicleModel/GetVehicleModels',$.param(oVehicleModel), config).then(
                    function (response)
                    {
                        var oColumns = [];
                        var oColumn = { field: 'ModelNo', name: 'ModelNo',width: '30%'  };oColumns.push(oColumn);
                        oColumn = { field: 'CategoryName', name: 'CategoryName',width: '40%', enableSorting: false  };oColumns.push(oColumn);
                        var results=jQuery.parseJSON(response.data);
                        var modalObj={
                            size:'md',
                            modalcontroller:'',
                            appcontroller:'',
                            objs:results,
                            multiSelect:true,
                            pickertitle:'Model List',
                            searchingbyfieldName:'ModelNo',
                            columns:oColumns
                        }
                        var modalInstance=msModal.Instance(modalObj);
                        modalInstance.result.then(function (result)
                        {
                            if(result.length>0)
                            {
                                if(result.length==1)
                                {
                                    $scope.SaleInvoice.ModelNo=result[0].VehicleModelID;
                                    $scope.ModelNo=result[0].ModelNo;
                                }else
                                {
                                    $scope.ModelNo=result.length+" items are selected";
                                    $scope.SaleInvoice.ModelNo=result[0].VehicleModelID;
                                    for(var i=1;i< result.length; i++)
                                    {
                                        $scope.SaleInvoice.ModelNo+=","+result[i].VehicleModelID;
                                    }
                                }
                            }
                        }, function () {
                            $log.info('Modal dismissed at: ' + new Date());
                        });
                    },
                        function (response) { alert(jQuery.parseJSON(response.data).Message);}
                );

    };
    $scope.SearchKeyDownVehicleModel = function (e) {
        //debugger;
        var code = (e.keyCode ? e.keyCode : e.which);
        if (code == 13) {
            var ModelNo = $.trim($scope.ModelNo);
            if(ModelNo=="" || ModelNo==null)
            {
                alert("Type Model No and Press Enter");
                return;
            }
            $scope.PickVehicleModel();
        }else if (code == 8) //backspace=8
        {
            //debugger;
            $scope.SaleInvoice.ModelNo='';
            //$scope.ModelNo=0;
        }
    };
    $scope.ClearVehicleModel= function ()
    {
        $scope.SaleInvoice.ModelNo='';
        $scope.ModelNo=0;
    }
    //-----------PICKERS__END---------------

    $scope.printPreformanceReport = function(){

        if (($scope.ReportTypeInt == undefined ? 0 : $scope.ReportTypeInt) <= 0 
            || ($scope.ReportLayoutInt == undefined ? 0 : $scope.ReportLayoutInt) <= 0  
            || $scope.cboReportDate == 0 )
            //|| ($scope.SaleInvoice.MarketingAccountName == undefined ? "" : $scope.SaleInvoice.MarketingAccountName) == "" )
        {
            alert("Please Select Date & Reports Criteria !!"); ///at least one Criteria
            return;
        }
        $scope.lblLoadingMessage = false;
        var sTempString = $scope.cboReportDate + '~' + $scope.ReportDateFrom + '~' + $scope.ReportDateTo
                        + '~' + ($scope.SaleInvoice.MarketingAccountName == undefined ? "" : $scope.SaleInvoice.MarketingAccountName) 
                        + '~' + ($scope.SaleInvoice.CustomerName == undefined ? "" : $scope.SaleInvoice.CustomerName) 
                        + '~' + ($scope.SaleInvoice.ModelNo == undefined ? "" : $scope.SaleInvoice.ModelNo) 
                        + '~' + ($scope.ReportTypeInt == undefined ? 0 : $scope.ReportTypeInt)
                        + '~' + ($scope.ReportLayoutInt == undefined ? 0 : $scope.ReportLayoutInt)
                        + '~' + nBUID;
          
        window.open(_sBaseAddress + '/SaleInvoice/PrintPerformanceReport?sTempString='+sTempString
            +"&nReportType="+($scope.ReportTypeInt == undefined ? 0 : $scope.ReportTypeInt)
            +"&nReportLayout="+ ($scope.ReportLayoutInt == undefined ? 0 : $scope.ReportLayoutInt), "_blank");
    };
    $scope.printPreformanceReportExcel = function(){

        if (($scope.ReportTypeInt == undefined ? 0 : $scope.ReportTypeInt) <= 0 
            || ($scope.ReportLayoutInt == undefined ? 0 : $scope.ReportLayoutInt) <= 0  
            || $scope.cboReportDate == 0 )
            //|| ($scope.SaleInvoice.MarketingAccountName == undefined ? "" : $scope.SaleInvoice.MarketingAccountName) == "" )
        {
            alert("Please Select Date & Reports Criteria !!"); ///at least one Criteria
            return;
        }
        $scope.lblLoadingMessage = false;
        var sTempString = $scope.cboReportDate + '~' + $scope.ReportDateFrom + '~' + $scope.ReportDateTo
                        + '~' + ($scope.SaleInvoice.MarketingAccountName == undefined ? "" : $scope.SaleInvoice.MarketingAccountName) 
                        + '~' + ($scope.SaleInvoice.CustomerName == undefined ? "" : $scope.SaleInvoice.CustomerName) 
                        + '~' + ($scope.SaleInvoice.ModelNo == undefined ? "" : $scope.SaleInvoice.ModelNo) 
                        + '~' + ($scope.ReportTypeInt == undefined ? 0 : $scope.ReportTypeInt)
                        + '~' + ($scope.ReportLayoutInt == undefined ? 0 : $scope.ReportLayoutInt)
                        + '~' + nBUID;

        debugger;
        if($scope.ReportLayoutInt == 20)
        {
            window.open(_sBaseAddress + '/SaleInvoice/PrintPerformanceReportExcelMonthWise?sTempString='+sTempString
           +"&nReportType="+($scope.ReportTypeInt == undefined ? 0 : $scope.ReportTypeInt)
           +"&nReportLayout="+ ($scope.ReportLayoutInt == undefined ? 0 : $scope.ReportLayoutInt), "_blank");
        }
        if($scope.ReportLayoutInt == 37)
        {
            window.open(_sBaseAddress + '/SaleInvoice/PrintPerformanceReportExcelMKTPersonWise?sTempString='+sTempString
           +"&nReportType="+($scope.ReportTypeInt == undefined ? 0 : $scope.ReportTypeInt)
           +"&nReportLayout="+ ($scope.ReportLayoutInt == undefined ? 0 : $scope.ReportLayoutInt), "_blank");
        }
        if($scope.ReportLayoutInt == 38)
        {
            window.open(_sBaseAddress + '/SaleInvoice/PrintPerformanceReportExcelModelWise?sTempString='+sTempString
           +"&nReportType="+($scope.ReportTypeInt == undefined ? 0 : $scope.ReportTypeInt)
           +"&nReportLayout="+ ($scope.ReportLayoutInt == undefined ? 0 : $scope.ReportLayoutInt), "_blank");
        }
    };




    
});

</script>
