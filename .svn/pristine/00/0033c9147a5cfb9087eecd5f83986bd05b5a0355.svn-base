@{
    ViewBag.Title = "MarketingSchedules List";
}

@model IEnumerable<ESimSol.BusinessObjects.MarketingSchedule>
    <head>
        <title></title>
        <link href="@Url.Content("~/Content/CSS/MeetingSummary.css")" rel="stylesheet" type="text/css" /> 

        <script src="@Url.Content("~/Views/MarketingSchedule/MarketingSchedule.js")" type="text/javascript"></script>
        <script src="@Url.Content("~/Views/MarketingSchedule/MarketingSchedules.js")" type="text/javascript"></script>
        <script src="@Url.Content("~/Views/MarketingSchedule/MeetingSummary.js")" type="text/javascript"></script>

        <script src="@Url.Content("~/Views/Employee/EmployeePicker.js")" type="text/javascript"></script>
        <script src="@Url.Content("~/Views/Contractor/ContractorPicker.js")" type="text/javascript"></script>
        
        
    </head>
    <body>
        <div id="winMarketingSummarys" style="width:660px;" class="easyui-window winstyle" title="Marketing Meeting Summary" data-options="modal:true,closed:true,collapsible:false,minimizable:false,maximizable:false,closable:false">
            <div id="OperationsMeetingSummary" style="width:645px;">
                <div>
                    <table>
                        <tr>
                            <td style="width:100px;" align="right">
                                <label>MKT Person :</label>
                            </td>
                            <td style="width:190px;">
                                <input id="txtMKTPersonMeetingSummary" type="text" placeholder="Type and press enter" style="width:190px;" />
                            </td>
                            <td style="width:70px;" align="right">
                                <label>Buyer :</label>
                            </td>
                            <td style="width:190px;">
                                <input id="txtBuyerMeetingSummary" type="text" placeholder="Type and press enter" style="width:190px;" />
                            </td>
                            <td style="width:80px;">
                                <a id="btnRefreshMeetingSummary" href="javascript:void(0)" class="easyui-linkbutton easyui-tooltip" title="Refresh" iconcls="icon-reload" plain="true">Refresh</a>
                            </td>
                        </tr>
                    </table>
                </div>
                <div style="border-top:2px;border-top-style:solid">
                    <table>
                        <tr>
                            <td style="width:100px;" align="right">
                                <label>Summary Point :</label>
                            </td>
                            <td style="width:460px;">
                                <textarea id="txtMeetingSummaryText" rows="1" cols="50" style="width:460px;font-family:Tahoma;font-size:14px;"></textarea>
                            </td>
                            <td style="width:80px;">
                                <a id="btnAddMeetingSummary" href="javascript:void(0)" class="easyui-linkbutton easyui-tooltip" title="Add" iconcls="icon-add" plain="true">Add</a>
                                @*<a id="btnRemoveMeetingSummary" href="javascript:void(0)" class="easyui-linkbutton easyui-tooltip" title="Remove" iconcls="icon-remove" plain="true">Remove</a>*@
                            </td>
                        </tr>
                    </table>
                </div>
            </div>
            <div style="border-top:2px;border-top-style:solid;">
                
                    <div id="ListMeetingSummary" style="width:645px; height:400px; overflow-y: scroll;">

                    </div>
                
            </div>
            <fieldset class="actionfieldsetstyle">
                <legend>Actions : </legend>

                <a id="btnCloseMeetingSummary" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-cancel" plain="true">Close</a>
            </fieldset>
        </div>
        <div id="winContractorPicker" class="easyui-window" title="Contractor" data-options="modal:true,closed:true,collapsible:false,minimizable:false,maximizable:false,closable:false">
            <div id="divContractorPicker" tabindex="-1">
                <table id="tblContractorsPicker" class="easyui-datagrid" style="width:400px;height:350px;margin:0;"
                       data-options="singleSelect: true,fitColumns:false, rownumbers:true, pagination:false, autoRowHeight:false, toolbar: '#toolbarContractorPicker' ">
                    <thead>
                        <tr>
                            <th data-options="field:'Selected',checkbox:true"></th>
                            <th field="Name" width="240" align="left">Name</th>
                            <th field="ContractorTypeInString" width="100" align="left">Type</th>
                        </tr>
                    </thead>
                </table>
                <div id="toolbarContractorPicker">
                    <input id="txtSearchByContractorNamePicker" class="txtPickerSearchInputField" type="text" placeholder="Search by name" />
                </div>

            </div>

            <fieldset class="actionfieldsetstyle">
                <legend>Actions : </legend>
                <a id="btnOkContractorPicker" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-ok" plain="true">Ok</a>
                <a id="btnCloseContractorPicker" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-cancel" plain="true">Close</a>
            </fieldset>
        </div>
        <div id="winEmployeePickerByName" class="easyui-window" title="Employee" data-options="modal:true,closed:true,collapsible:false,minimizable:false,maximizable:false,closable:false">
            <div id="divEmployeePickerByName" tabindex="-1">
                <table id="tblEmployeePickerByName" class="easyui-datagrid" style="width:400px;height:350px;margin:0;"
                       data-options="singleSelect: true,fitColumns:false, rownumbers:true, pagination:false, autoRowHeight:false, toolbar: '#toolbarEmployeePicker' ">
                    <thead>
                        <tr>
                            <th field="Name" width="240" align="left">Name</th>
                            <th field="EmployeeDesignationTypeInString" width="100" align="left">Type</th>
                        </tr>
                    </thead>
                </table>
                <div id="toolbarEmployeePicker">
                    <input id="txtSearchByEmployeeNamePicker" class="txtPickerSearchInputField" type="text" placeholder="Search by name" />
                </div>
            </div>
            <fieldset class="actionfieldsetstyle">
                <legend>Actions : </legend>
                <a id="btnOkEmployeePickerByName" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-ok" plain="true">Ok</a>
                <a id="btnCloseEmployeePickerByName" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-cancel" plain="true">Close</a>
            </fieldset>
        </div>
            <div id="winMarketingSchedule" style="width:960px;" class="easyui-window winstyle" title="MarketingSchedule Informations" data-options="modal:true,closed:true,collapsible:false,minimizable:false,maximizable:false,closable:false">
              
                    
                <table id="tblMarketingSchedules" class="easyui-datagrid" style="width:945px;height:250px;"
                       data-options="singleSelect: true,fitColumns:false, rownumbers:true, pagination:false, autoRowHeight:false" toolbar="#toolbarMarketingSchedule">

                </table>
                    <div id="toolbarMarketingSchedule">
                        <table>
                            <tr>

                                <td style="width:90px;" align="right">
                                    <label>MKT Person :</label>
                                </td>
                                <td style="width:160px;">
                                    <input id="txtMKTPerson" type="text" placeholder="Type and press enter" style="width:160px;" />
                                </td>
                                <td style="width:70px;" align="right">
                                    <label>Buyer :</label>
                                </td>
                                <td style="width:160px;">
                                    <input id="txtBuyer" type="text" placeholder="Type and press enter" style="width:160px;" />
                                </td>

                                <td style="width:120px;" align="right">
                                    <label>Schedule Date :</label>
                                </td>
                                <td style="width:144px;">
                                    <input id="txtScheduleDate" type="text" style="width:164px;" class="easyui-datetimebox" required="required" data-options="formatter:icsdatetimeformat,parser:icsdatetimeparser,showSeconds:false" />
                                </td>

                                <td style="width:140px;">
                                    <a id="btnRefreshMarketingSchedule" href="javascript:void(0)" class="easyui-linkbutton easyui-tooltip" title="Refresh" iconcls="icon-reload" plain="true">Refresh Schedule</a>
                                </td>
                            </tr>
                            <tr>

                                <td style="width:90px;" align="right">
                                    <label>Location :</label>
                                </td>
                                <td style="width:160px;">
                                    <input id="txtMeetingLocation" type="text" style="width:160px;" />
                                </td>


                                <td style="width:70px;" align="right">
                                    <label>Duration :</label>
                                </td>
                                <td style="width:160px;">
                                    <input id="txtMeetingDuration" type="text" style="width:143px;" /><input id="txtHour" type="text" placeholder="H" style="width:10px;" disabled /> 
                                </td>


                                <td style="width:120px;" align="right">
                                    <label>Remark :</label>
                                </td>
                                <td style="width:120px;">
                                    <input id="txtRemark" type="text" style="width:160px;" />
                                </td>
                                
                                <td style="width:140px;">
                                    <a id="btnAddMarketingSchedule" href="javascript:void(0)" class="easyui-linkbutton easyui-tooltip" title="Add" iconcls="icon-add" plain="true">Add</a>
                                    <a id="btnRemoveMarketingSchedule" href="javascript:void(0)" class="easyui-linkbutton easyui-tooltip" title="Remove" iconcls="icon-remove" plain="true">Remove</a>
                                </td>
                            </tr>
                        </table>

                    </div>
                
                <fieldset class="actionfieldsetstyle">
                        <legend>Actions : </legend>
                    <table>
                        <tr>
                            <td style="width:860px; text-align:right"></td>
                            <td style ="width:50px;">
                                @using (Html.BeginForm("PrintMarketingSchedules", "MarketingSchedule", FormMethod.Post, new { enctype = "multipart/form-data", target = "_blank" }))
                                {
                                    <input type="text" name="txtCollectionPrintText" id="txtCollectionPrintText" hidden="hidden" />
                                    <input type="submit" id="btnPrintList" value="     Print List" class="icon-print PrintList" />
                                }
                            </td>
                            <td style="width:50px; text-align:right;">
                                <a id="btnClose" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-cancel" plain="true">Close</a>
                            </td>
                        </tr>
                    </table>
                </fieldset>
            </div>
            
            
            <div class="menuMainCollectionTable">
                <table id="tblSchedules" title="Schedule Date List" class="easyui-datagrid" fit="true" fitcolumns="false" rownumbers="true" pagination="true" singleselect="true" autorowheight="false" toolbar="#toolbarScheduleDate"></table>
                <div id="toolbarScheduleDate">
                    
                   
                    <a id="btnPreviousMarketingSchedule" href="javascript:void(0)" class="easyui-linkbutton" class="easyui-linkbutton easyui-tooltip" title="Previous" iconcls="icon-back" plain="true"></a>
                    <input id="txtDateSchedule" type="text" class="easyui-datebox" required="required" data-options="formatter:icsmonthformat,parser:icsmonthparser" style="width:118px" />
                    <a id="btnNextMarketingSchedule" href="javascript:void(0)" class="easyui-linkbutton" class="easyui-linkbutton easyui-tooltip" title="Next" iconcls="icon-forword" plain="true"></a>
                    <a id="btnRefresh" href="javascript:void(0)" class="easyui-linkbutton easyui-tooltip" title="Refresh" iconcls="icon-reload" plain="true">Refresh</a>

                    
                </div>
            </div>
    </body>
    
    <script type="text/javascript">
    var _oMeetingSummary={ErrorMessage:''};
    var _oMeetingSummarys=[];
    var _oMarketingSchedule = {ErrorMessage:"",MKTPersonID:0,ScheduleDateTime:''};
    var _oBaseMarketingSchedule = {ErrorMessage:"",MKTPersonID:0,ScheduleDateTime:''};
    var _oMarketingSchedules = [];
    var _oDBMarketingSchedules = [];
    var _sBaseAddress = "";
    var _oCurrentUser={};
    var _oAuthorizationRolesMapping = [];
    var _oMarketingScheduleBranch = null;
    var _oEmployees=[];
    var _oSchedule=null;
    var _oSchedules=[];
    var _otblColumns=[];
    var _oEmployeesPicker=[];
    var _oMKTPerson={EmployeeID:0};
    var _oContractorsPicker=[];
    var _oBuyer={ContractorID:0};
    var _nbtnIDNo =0;
    var _bIsFromCalendar=false;
    $(document).ready(function() {
        //debugger;
        _sBaseAddress = @Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(HttpContext.Current.Session[SessionInfo.BaseAddress]));
        _oCurrentUser=@Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(HttpContext.Current.Session[SessionInfo.CurrentUser]));
        _oDBMarketingSchedules = @Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(Model));
        _oEmployees=@Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(ViewBag.Employees));
                
        InitializeMarketingSchedulesEvents();
        InitializeMarketingScheduleEvents();
        InitializeEmployeePickerByNameEvents();
        InitializeContractorPickerEvents();
        InitializeMeetingSummaryEvents();
    });

    
    $("#winContractorPicker").on( "keydown", function(e){
        //alert(e.type + ": " +  e.which );
        var oContractor= $('#tblContractorsPicker').datagrid('getSelected'); 
        var nIndex=$('#tblContractorsPicker').datagrid('getRowIndex', oContractor); 
        if(e.which == 38)//up arrow=38
        {
            if(nIndex<=0)
            {
                $('#tblContractorsPicker').datagrid('selectRow', 0); 
            }
            else
            {
                $('#tblContractorsPicker').datagrid('selectRow', nIndex-1); 
            }
            $('#txtBuyer').blur();
        }
        if(e.which == 40)//down arrow=40
        {
            var oCurrentList = $('#tblContractorsPicker').datagrid('getRows'); 
            if(nIndex>=oCurrentList.length-1)
            {
                $('#tblContractorsPicker').datagrid('selectRow', oCurrentList.length-1); 
            }
            else
            {
                $('#tblContractorsPicker').datagrid('selectRow', nIndex+1); 
            }
            $('#txtBuyer').blur();
        }
        if(e.which == 13)//enter=13
        {            
            var oContractor = $("#tblContractorsPicker").icsGetSelectedItem();            
            if (oContractor != null && oContractor.ContractorID > 0) {
                $('#txtBuyer').val(oContractor.Name);
                $('#txtBuyer').addClass("fontColorOfPickItem");
                $('#txtBuyer').css("border", "");
                _oBuyer = oContractor;                
                $('#txtMeetingLocation').focus();
            }              
        }
        if(e.which == 27)//escape=27
        {
            $("#winContractorPicker").icsWindow("close");                
        }
    });
</script>
