<html>
<head>

</head>
<body>
    @model ESimSol.BusinessObjects.ImportSetup
    <div class="menuMainCollectionTable" style="margin-left: 0px; height:98%; width:99.5%">
        <div style="margin-left: 2px; height:88%; width:100%">
            <fieldset style="margin-top: 10px; height:97%;">
                <legend style="font-weight: bold">Import Commercial Setup </legend>
                <table border="0" style="margin-top: 5px; height:20%; width:100%;font-size:12px">
                    
                    
                    <tr>
                        <td style="width: 40%; text-align: right; font-size:12px;">
                            Unit Name:
                        </td>
                        <td style="width:60%">
                            <table border="0" cellpadding="0" cellspacing="0" style="font-size:11px; font-weight:bold">
                                <tr>
                                    <td style="width:200px">
                                        <select id="cboBU" style="width:80%"></select>
                                    </td>
                                </tr>
                            </table>
                        </td>
                    </tr>
                    <tr>
                        <td style="width:  40%; text-align: right; font-size:12px;">
                            P/I entry aganist Purchase Request (Apply?)
                        </td>
                        <td style="width:60%">
                            <table border="0" cellpadding="0" cellspacing="0" style="font-size:11px; font-weight:bold">
                                <tr>
                                    <td style="width:65px"><input type="checkbox" id="chkIsApplyPO_Yes" value="value" onclick="if(this.checked){IsBankFDDYes()}else{IsBankFDDNo()}" />Yes </td>
                                    <td style="width:80px"><input type="checkbox" id="chkIsApplyPO_No" value="value" onclick="if(this.checked){IsBankFDDNo()}else{IsBankFDDYes()}" />No</td>
                                </tr>
                            </table>
                        </td>
                    </tr>
                    <tr>
                        <td style="width:  40%; text-align: right; font-size:12px;">
                            TT Payment (Apply?)
                        </td>
                        <td style="width:60%">
                            <table border="0" cellpadding="0" cellspacing="0" style="font-size:11px; font-weight:bold">
                                <tr>
                                    <td style="width:65px"><input type="checkbox" id="chkIsApplyTT_Yes" value="value" onclick="if(this.checked){IsBankFDDYes()}else{IsBankFDDNo()}" />Yes </td>
                                    <td style="width:80px"><input type="checkbox" id="chkIsApplyTT_No" value="value" onclick="if(this.checked){IsBankFDDNo()}else{IsBankFDDYes()}" />No</td>
                                </tr>
                            </table>
                        </td>
                    </tr>
                    <tr>
                        <td style="width:  40%; text-align: right; font-size:12px;">
                            Open Back To Back L/C Aganist a Master L/C  (Apply?)
                        </td>
                        <td style="width:60%">
                            <table border="0" cellpadding="0" cellspacing="0" style="font-size:11px; font-weight:bold">
                                <tr>
                                    <td style="width:65px"><input type="checkbox" id="chkIsApplyMasterLC_Yes" value="value" onclick="if(this.checked){IsBankFDDYes()}else{IsBankFDDNo()}" />Yes </td>
                                    <td style="width:80px"><input type="checkbox" id="chkIsApplyMasterLC_No" value="value" onclick="if(this.checked){IsBankFDDNo()}else{IsBankFDDYes()}" />No</td>
                                </tr>
                            </table>
                        </td>
                    </tr>
                    <tr>
                        <td style="width:  40%; text-align: right; font-size:12px;">
                            Durring P/I entry, Freight Rate (Apply?)
                        </td>
                        <td style="width:60%">
                            <table border="0" cellpadding="0" cellspacing="0" style="font-size:11px; font-weight:bold">
                                <tr>
                                    <td style="width:65px"><input type="checkbox" id="chkIsFreightRate_Yes" value="value" onclick="if(this.checked){IsBankFDDYes()}else{IsBankFDDNo()}" />Yes </td>
                                    <td style="width:80px"><input type="checkbox" id="chkIsFreightRate_No" value="value" onclick="if(this.checked){IsBankFDDNo()}else{IsBankFDDYes()}" />No</td>
                                </tr>
                            </table>
                        </td>
                    </tr>
                    <tr>
                        <td style="width:  40%; text-align: right; font-size:12px;">
                            Durring P/I entry, Rate On (Apply?)
                        </td>
                        <td style="width:60%">
                            <table border="0" cellpadding="0" cellspacing="0" style="font-size:11px; font-weight:bold">
                                <tr>
                                    <td style="width:65px"><input type="checkbox" id="chkIsApplyRateOn_Yes" value="value" onclick="if(this.checked){IsBankFDDYes()}else{IsBankFDDNo()}" />Yes </td>
                                    <td style="width:80px"><input type="checkbox" id="chkIsApplyRateOn_No" value="value" onclick="if(this.checked){IsBankFDDNo()}else{IsBankFDDYes()}" />No</td>
                                </tr>
                            </table>
                        </td>
                    </tr>
                    <tr>
                        <td style="width: 40%; text-align: right; font-size:12px;">
                            Default Currency:
                        </td>
                        <td style="width:60%">
                            <table border="0" cellpadding="0" cellspacing="0" style="font-size:11px; font-weight:bold">
                                <tr>
                                    <td style="width:200px">
                                        <select id="cboCurrency" style="width:80%"></select>
                                    </td>
                                </tr>
                            </table>
                        </td>
                    </tr>
                    <tr>
                        <td style="width: 40%; text-align: right; font-size:12px;">
                            File Numbating Type:
                        </td>
                        <td style="width:60%">
                            <table border="0" cellpadding="0" cellspacing="0" style="font-size:11px; font-weight:bold">
                                <tr>
                                    <td style="width:200px">
                                        <select id="cboFileType" style="width:80%"></select>
                                    </td>
                                </tr>
                            </table>
                        </td>
                    </tr>
                    <tr>
                        <td style="width: 40%; text-align: right; font-size:12px;">
                            Shipment & Expire Date Calculate From:
                        </td>
                        <td style="width:60%">
                            <table border="0" cellpadding="0" cellspacing="0" style="font-size:11px; font-weight:bold">
                                <tr>
                                    <td style="width:200px">
                                        <select id="cboDaysCalculateOn" style="width:80%"></select>
                                    </td>
                                </tr>
                            </table>
                        </td>
                    </tr>
                    <tr>
                        <td style="width: 40%; text-align: right; font-size:12px;">
                            Default Shipment Days:
                        </td>
                        <td style="width:60%">
                            <table border="0" cellpadding="0" cellspacing="0" style="font-size:11px; font-weight:bold">
                                <tr>
                                    <td style="width:200px">
                                        <input id="txtShipmentDay" type="number" min="0" pattern="^[0-9]" step="1" class="only-number" style="width: 70%" />
                                    </td>
                                </tr>
                            </table>
                        </td>
                    </tr>
                    <tr>
                        <td style="width: 40%; text-align: right; font-size:12px;">
                            Default Expire Days:
                        </td>
                        <td style="width:60%">
                            <table border="0" cellpadding="0" cellspacing="0" style="font-size:11px; font-weight:bold">
                                <tr>
                                    <td style="width:200px">
                                        <input id="txtExpireDay" type="number" min="0" pattern="^[0-9]" step="1" class="only-number" style="width: 70%" />
                                    </td>
                                </tr>
                            </table>
                        </td>
                    </tr>
                    <tr>
                        <td style="width: 40%; text-align: right; font-size:12px;">
                            Cover Note Number:
                        </td>
                        <td style="width:60%">
                            <table border="0" cellpadding="0" cellspacing="0" style="font-size:11px; font-weight:bold">
                                <tr>
                                    <td style="width:200px">
                                        <input id="txtCoverNoteNumber" type="text" style="width: 70%" />
                                    </td>
                                </tr>
                            </table>
                        </td>
                    </tr>
                    <tr>
                        <td style="width: 40%; text-align: right; font-size:12px;">
                            Cover Note Date:
                        </td>
                        <td style="width:60%">
                            <table border="0" cellpadding="0" cellspacing="0" style="font-size:11px; font-weight:bold">
                                <tr>
                                    <td style="width:200px">
                                        <input id="txtCoverNoteDate" type="text" class="easyui-datebox" 
                                               data-options="formatter:icsdateformat,parser:icsdateparser" style="width: 70%;" />
                                    </td>
                                </tr>
                            </table>
                        </td>
                    </tr>
                    
                </table>
            </fieldset>
        </div>
        <div style="margin-left: 2px; height:10%; width:100%">
            <fieldset >
                <legend style="font-weight: bold">Action </legend>
                <table border="0" cellspacing="2" cellpadding="2" style="font-size: 11px; width: 100%;font-weight: bold; font-size: 12px;">
                    <tr>
                        <td style="width: 80%; text-align: right"></td>
                        <td style="width: 10%; font-size: 13px">
                            <a id="btnSave" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-save" plain="true" onclick="Save()">Save</a>
                        </td>
                        <td style="width: 10%; font-size: 13px">
                            <a id="btnClose" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-cancel"
                               plain="true" onclick="Close()">Close</a>
                        </td>
                    </tr>
                </table>
            </fieldset>
        </div>
    </div>
    
</body>
</html>
<script type="text/javascript">
    var _oImportSetup=null;
    var _sBaseAddress="";
    var _oBusinessUnits = [];
    var _oImportFileTyps=[];
    var _oImportDateCalBy=[];
    var _nBUID=0;
    var _sBackLink="";
    $(document).ready(function () {
        debugger;
        _sBaseAddress =@Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(HttpContext.Current.Session[SessionInfo.BaseAddress]));
        _oImportSetup =@Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(Model));
        _oBusinessUnits= @Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(ViewBag.BusinessUnits));
        _oCurrencys = @Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(ViewBag.Currencys));
        _oImportFileTyps = @Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(ViewBag.ImportFileTyps));
        _oImportDateCalBy = @Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(ViewBag.ImportDateCalBy));
        Initialization(_oImportSetup,((sessionStorage.length>0)?sessionStorage.getItem('Operation'):'New'));
        _sBackLink=sessionStorage.getItem("BackLink");

    });

    function RefreshCBO()
    {
        $("#cboBU").icsLoadCombo({
            List: _oBusinessUnits,
            OptionValue: "BusinessUnitID",
            DisplayText: "BUTypeSt"
        });

        $("#cboCurrency").icsLoadCombo({
            List: _oCurrencys,
            OptionValue: "CurrencyID",
            DisplayText: "CurrencyName"
        });

        $("#cboFileType").icsLoadCombo({
            List: _oImportFileTyps,
            OptionValue: "id",
            DisplayText: "Value",
            
        });
        $("#cboDaysCalculateOn").icsLoadCombo({
            List: _oImportDateCalBy,
            OptionValue: "id",
            DisplayText: "Value",
        });
    }

    function Initialization(oImportSetup, sOperation)
    {
        //ResetControll();
        RefreshCBO();
        RefreshControl(oImportSetup);
        if(sOperation=="View")
        {
            $('#btnSave').hide();
            $('input,select').prop('disabled',true);
        }

        else{
            $('btnSave').show();
            $('input,select').prop('disabled',false);
        }
    }

    function RefreshControl(oImportSetup)
    {
        _oImportSetup=oImportSetup;
        $("#cboBU").val(_oImportSetup.BUID);
        $("#cboCurrency").val(_oImportSetup.CurrencyID);
        $("#cboFileType").val(_oImportSetup.FileTypeInt);
        $("#cboDaysCalculateOn").val(_oImportSetup.DaysCalculateOnInt);
        $('#txtShipmentDay').val(_oImportSetup.ShipmentDay);
        $('#txtExpireDay').val(_oImportSetup.ExpireDay);

        $("#chkIsApplyPO_Yes").prop("checked", _oImportSetup.IsApplyPO);
        $("#chkIsApplyTT_Yes").prop("checked", _oImportSetup.IsApplyTT);
        $("#chkIsApplyMasterLC_Yes").prop("checked", _oImportSetup.IsApplyMasterLC);
        $("#chkIsApplyRateOn_Yes").prop("checked", _oImportSetup.IsApplyRateOn);
        $("#txtCoverNoteNumber").val(_oImportSetup.CoverNoteNumber);
        $('#txtCoverNoteDate').datebox('setValue', _oImportSetup.CoverNoteDateST);


 }
function Save()
{
   debugger;


   var oImportSetup=RefreshObject();

       $.ajax({
                type: "POST",
                dataType: "json",
                url : _sBaseAddress+"/ImportSetup/Save",
                traditional: true,
                data:  JSON.stringify(oImportSetup),
                contentType: "application/json; charset=utf-8",
                success: function (data) {
               debugger;
                var oImportSetup= jQuery.parseJSON(data);
                if (oImportSetup.ErrorMessage=="" || oImportSetup.ErrorMessage==null)
                    {
                    _oImportSetup=oImportSetup;
                    alert("Data Saved successfully");
                    var oImportSetups =sessionStorage.getItem("ImportSetups");
                    var nIndex= parseInt(sessionStorage.getItem("SelectedRowIndex"));
                    if(oImportSetups!=null)
                    {
                        oImportSetups = jQuery.parseJSON(oImportSetups);
                    }
                    else
                    {
                        oImportSetups=[];
                    }
                    if(nIndex!=-1)
                    {
                        oImportSetups[nIndex]=oImportSetup;
                    }
                    else
                    {
                        sessionStorage.setItem("SelectedRowIndex", oImportSetups.length);
                        oImportSetups.push(oImportSetup);
                    }
                    sessionStorage.setItem("ImportSetups", JSON.stringify(oImportSetups));
                    window.location.href = sessionStorage.getItem("BackLink");

                    }
                else
                    {
                        alert(oImportSetup.ErrorMessage);
                    }
                 },
            error: function (xhr, status, error)
                {
                    alert(error);
                }
            });

}



function RefreshObject()
{
    debugger;
    var oImportSetup= {
        ImportSetupID: (_oImportSetup != null) ? _oImportSetup.ImportSetupID : 0,
        CurrencyID:$("#cboCurrency").val(),
        IsApplyPO :$("#chkIsApplyPO_Yes").is(":checked"),
        IsApplyTT:$("#chkIsApplyTT_Yes").is(":checked"),
        IsApplyMasterLC :$("#chkIsApplyMasterLC_Yes").is(":checked"),
        IsApplyRateOn :$("#chkIsApplyRateOn_Yes").is(":checked"),
        IsFreightRate :$("#chkIsFreightRate_Yes").is(":checked"),
        FileTypeInt : $("#cboFileType").val(),
        DaysCalculateOnInt : $("#cboDaysCalculateOn").val(),
        ShipmentDay:$('#txtShipmentDay').val(),
        ExpireDay:$('#txtExpireDay').val(),
        CoverNoteNumber : $('#txtCoverNoteNumber').val(),
        CoverNoteDate : new Date($('#txtCoverNoteDate').datebox('getValue')),
        BUID:$("#cboBU").val()

    };
    return oImportSetup;
}


function Close()
{

    window.location.href = sessionStorage.getItem("BackLink");
}
</script>
