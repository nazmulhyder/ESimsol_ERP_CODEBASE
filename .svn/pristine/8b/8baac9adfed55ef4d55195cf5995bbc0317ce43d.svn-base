@{
    ViewBag.Title = "QC Test Group List";
}
@model IEnumerable<ESimSol.BusinessObjects.FnQCTestGroup>
    <div id="progressbarParent" style="width:100%;height:100%;margin:0 auto;text-align:center; margin-left: auto;margin-right: auto;left: 0;right: 0;z-index: 1;">
        <div style="margin: 0px auto;margin-top: 251px;text-align:center;width:390px;">
            <label style="font-size:18px;">Please wait</label>
            <div id="progressbar" style="width:100%;height:37px;"></div>
        </div>
    </div>
    
    <div class="menuMainCollectionTable" id="regionFnQCTestGroup">
        <table id="tblFnQCTestGroups" title="QC Test Group List" class="easyui-datagrid" fit="true" fitcolumns="false" rownumbers="true" pagination="true" singleselect="true" autorowheight="false" toolbar="#toolbar">
            <thead>
                <tr>
                    <th field="Name" width="30%">Name</th>
                    <th field="Note" width="40%">Note</th>
                    <th field="SLNo" width="20%">Sequence</th>
                </tr>
            </thead>
        </table>
        <div id="toolbar">
            <a id="btnAdd" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-add" plain="true">Add</a>
            <a id="btnEdit" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-edit" plain="true">Edit</a>
            <a id="btnView" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-details" plain="true">View</a>
            <a id="btnDelete" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-remove" plain="true">Delete</a>
            @*<a id="btnUp" style=" width:50px; text-align:left;" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-up" plain="true" onclick="UP()">Up</a>
            <a id="btnDown" style=" width:60px; text-align:left;" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-down" plain="true" onclick="Down()">Down</a>*@
            @*<a id="btnPreview" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-print" plain="true">Preview</a>
            <a id="btnPrintList" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-print" plain="true">Print List</a>*@
        </div>
    </div>

    <script type="text/javascript">
 debugger;
    var _oFnQCTestGroup=null;
    var _oFnQCTestGroups=[];
    var _sBaseAddress="";
    var _oAuthorizationRolesMapping=[];

    $(document).ready(function () {
        debugger;
        _oFnQCTestGroups =@Html.Raw( new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(Model));
        _sBaseAddress =@Html.Raw( new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(HttpContext.Current.Session[SessionInfo.BaseAddress]));
        _oAuthorizationRolesMapping =@Html.Raw( new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(HttpContext.Current.Session[SessionInfo.AuthorizationRolesMapping]));
        var oFnQCTestGroups =sessionStorage.getItem("FnQCTestGroups");
        if(oFnQCTestGroups!=null)
        {
            oFnQCTestGroups = jQuery.parseJSON(oFnQCTestGroups);
        }
        else
        {
            oFnQCTestGroups=_oFnQCTestGroups;
        }
        RefreshList(oFnQCTestGroups);
        $("#progressbar").progressbar({ value: 0 });
        $("#progressbarParent").hide();
    });

    function updateProgress() {
        var value =$('#progressbar').progressbar('getValue');
        if (value < 96){
            value += Math.floor(Math.random() * 10);
            $('#progressbar').progressbar('setValue', value);
        }
    }
    function hideShow(miliseconds) {
        $("#progressbarParent").hide();
    }


    $("#btnAdd").click(function(){
        var oFnQCTestGroups= $('#tblFnQCTestGroups').datagrid('getRows');
        sessionStorage.setItem("FnQCTestGroups", JSON.stringify(oFnQCTestGroups));
        sessionStorage.setItem("SelectedRowIndex", -1);
        sessionStorage.setItem("FnQCTestGroupHeader", "Add QC Test Group");
        sessionStorage.setItem('Action','Add')
        sessionStorage.setItem("BackLink", window.location.href);
        var tsv=((new Date()).getTime())/1000;
        window.location.href = _sBaseAddress+ "/FnQCTestGroup/ViewFnQCTestGroup?id=0&buid="+sessionStorage.getItem('BUID');  //
    });

    $("#btnEdit").click(function(){
        var oFnQCTestGroup= $('#tblFnQCTestGroups').datagrid('getSelected');
        if(oFnQCTestGroup==null || oFnQCTestGroup.FnQCTestGroupID<=0)
        {
            alert("Please select a item from list!");
            return;
        }
        
        var tsv=((new Date()).getTime())/1000;
        var SelectedRowIndex=$('#tblFnQCTestGroups').datagrid('getRowIndex',oFnQCTestGroup);
        var oFnQCTestGroups= $('#tblFnQCTestGroups').datagrid('getRows');
        sessionStorage.setItem("FnQCTestGroups", JSON.stringify(oFnQCTestGroups));
        sessionStorage.setItem("SelectedRowIndex", SelectedRowIndex);
        sessionStorage.setItem("FnQCTestGroupHeader", "Edit QC Test Group");
        sessionStorage.setItem('Action','Edit')
        sessionStorage.setItem("BackLink", window.location.href);
        window.location.href = _sBaseAddress+  "/FnQCTestGroup/ViewFnQCTestGroup?id="+oFnQCTestGroup.FnQCTestGroupID+"&buid="+sessionStorage.getItem('BUID');
    });

    $("#btnView").click(function(){
        var oFnQCTestGroup= $('#tblFnQCTestGroups').datagrid('getSelected');
        if(oFnQCTestGroup==null || oFnQCTestGroup.FnQCTestGroupID<=0)
        {
            alert("Please select a item from list!");
            return;
        }
        var tsv=((new Date()).getTime())/1000;
        var SelectedRowIndex=$('#tblFnQCTestGroups').datagrid('getRowIndex',oFnQCTestGroup);
        var oFnQCTestGroups= $('#tblFnQCTestGroups').datagrid('getRows');
        sessionStorage.setItem("FnQCTestGroups", JSON.stringify(oFnQCTestGroups));
        sessionStorage.setItem("SelectedRowIndex", SelectedRowIndex);
        sessionStorage.setItem("FnQCTestGroupHeader", "View QC Test Group");
        sessionStorage.setItem('Action','View')
        sessionStorage.setItem("BackLink", window.location.href);
        window.location.href = _sBaseAddress+  "/FnQCTestGroup/ViewFnQCTestGroup?id="+oFnQCTestGroup.FnQCTestGroupID+"&buid="+sessionStorage.getItem('BUID');
    });

    $("#btnDelete").click(function(){
        var oFnQCTestGroup= $('#tblFnQCTestGroups').datagrid('getSelected');
        if(oFnQCTestGroup==null || oFnQCTestGroup.FnQCTestGroupID<=0)
        {
            alert("Invalid Field!!! please select a valid Field!");
            return false;
        }
        
        if (!confirm("Confirm to Delete?")) return ;
        var SelectedRowIndex=$('#tblFnQCTestGroups').datagrid('getRowIndex',oFnQCTestGroup);
        if (oFnQCTestGroup.FnQCTestGroupID > 0)
        {
            $.ajax
            ({
                type: "POST",
                dataType: "json",
                url : _sBaseAddress+  "/FnQCTestGroup/Delete",
                data: JSON.stringify(oFnQCTestGroup),
                contentType: "application/json; charset=utf-8",
                success: function (data) {
                    var feedbackmessage = jQuery.parseJSON(data);
                    if (feedbackmessage.toLowerCase() == "deleted")
                    {
                        alert("Delete sucessfully");
                        $('#tblFnQCTestGroups').datagrid('deleteRow',SelectedRowIndex);
                        var oFnQCTestGroups= $('#tblFnQCTestGroups').datagrid('getRows');
                        sessionStorage.setItem("FnQCTestGroups", JSON.stringify(oFnQCTestGroups));
                    }
                    else
                    {
                        alert(feedbackmessage);
                    }
                },
                error: function (xhr, status, error)
                {
                    alert(error);
                }
            });
        }
    });
  
    function RefreshList(oFnQCTestGroups)
    {
        debugger;
        var data=oFnQCTestGroups;
        data={"total":""+data.length+"","rows":data};
        $('#tblFnQCTestGroups').datagrid('loadData',data);
        var nIndex= parseInt(sessionStorage.getItem("SelectedRowIndex"));
        $('#tblFnQCTestGroups').datagrid('selectRow',nIndex);
    }

        
    //function UP()
    //{
    //    debugger;
    //    var oFnQCTestGroup = $('#tblFnQCTestGroups').datagrid('getSelected');
    //    if(oFnQCTestGroup==null || parseInt(oFnQCTestGroup.FnQCTestGroupID)<=0)
    //    {
    //        alert("Please select an item");
    //        return;
    //    }

    //    var SelectedRowIndex=$('#tblFnQCTestGroups').datagrid('getRowIndex',oFnQCTestGroup);
    //    if(SelectedRowIndex==0)return;
    //    var oFnQCTestGroups=[];
    //    oFnQCTestGroups=_oFnQCTestGroups;
    //    _oFnQCTestGroups=[];
    //    for(var i=0; i<oFnQCTestGroups.length; i++)
    //    {
    //        if(i==(SelectedRowIndex-1))
    //        {
    //            _oFnQCTestGroups[i]=oFnQCTestGroups[i+1];
    //        }
    //        else if(i==SelectedRowIndex)
    //        {
    //            _oFnQCTestGroups[i]=oFnQCTestGroups[i-1];
    //        }
    //        else
    //        {
    //            _oFnQCTestGroups[i]=oFnQCTestGroups[i];
    //        }
    //        _oFnQCTestGroups[i].SLNo=i+1;
    //    }
    //    data = _oFnQCTestGroups;
    //    data={"total":""+data.length+"","rows":data};
    //    $('#tblFnQCTestGroups').datagrid('loadData',data);
    //    var newSelectedRowIndex=SelectedRowIndex-1;
    //    $('#tblFnQCTestGroups').datagrid('selectRow',newSelectedRowIndex);
    //}

    //function Down()
    //{
    //    debugger;
    //    var oFnQCTestGroup = $('#tblFnQCTestGroups').datagrid('getSelected');
    //    if(oFnQCTestGroup==null || parseInt(oFnQCTestGroup.FnQCTestGroupID)<=0)
    //    {
    //        alert("Please select a item from list!");
    //        return;
    //    }
    //    var SelectedRowIndex=$('#tblFnQCTestGroups').datagrid('getRowIndex',oFnQCTestGroup);
    //    if(SelectedRowIndex==(_oFnQCTestGroups.length-1))return;
    //    var oFnQCTestGroups=[];
    //    oFnQCTestGroups=_oFnQCTestGroups;
    //    _oFnQCTestGroups=[];
    //    for(var i=0; i<oFnQCTestGroups.length; i++)
    //    {
    //        if(i==(SelectedRowIndex+1))
    //        {
    //            _oFnQCTestGroups[i]=oFnQCTestGroups[i-1];
    //        }
    //        else if(i==SelectedRowIndex)
    //        {
    //            _oFnQCTestGroups[i]=oFnQCTestGroups[i+1];
    //        }
    //        else
    //        {
    //            _oFnQCTestGroups[i]=oFnQCTestGroups[i];
    //        }
    //        _oFnQCTestGroups[i].SLNo=i+1;
    //    }
    //    data = _oFnQCTestGroups;
    //    data={"total":""+data.length+"","rows":data};
    //    $('#tblFnQCTestGroups').datagrid('loadData',data);
    //    var newSelectedRowIndex=SelectedRowIndex+1;
    //    $('#tblFnQCTestGroups').datagrid('selectRow',newSelectedRowIndex);
    //}

    $('#btnPrintList').click(function(){
      
        var oFnQCTestGroups= $('#tblFnQCTestGroups').datagrid('getRows');
        if(oFnQCTestGroups.length<=0)
        {
            alert("Data not found ");
            return;
        }
        var sFnQCTestGroupIDs = "";
        for(var i = 0;i<oFnQCTestGroups.length;i++)
        {
            sFnQCTestGroupIDs+= oFnQCTestGroups[i].FnQCTestGroupID+",";
        }
        sFnQCTestGroupIDs = sFnQCTestGroupIDs.substring(0, sFnQCTestGroupIDs.length-1);
        var oFnQCTestGroup = {ErrorMessage:sFnQCTestGroupIDs};
        $.ajax({
            type: "POST",
            dataType: "json",
            url : _sBaseAddress+  "/FnQCTestGroup/SetFnQCTestGroupListData",
            traditional: true,
            data:  JSON.stringify(oFnQCTestGroup),
            contentType: "application/json; charset=utf-8",
            success: function (data) {
                var sFeedBackMessage = jQuery.parseJSON(data);
                if (sFeedBackMessage==="Successful")
                {
                    window.open (_sBaseAddress+ "/FnQCTestGroup/PrintFnQCTestGroups");
                }
            },
            error: function (xhr, status, error) {
                alert(error);
            }
        });

    });

    $('#btnPreview').click(function(){
        var oFnQCTestGroup=$('#tblFnQCTestGroups').datagrid('getSelected');
        if(oFnQCTestGroup==null || parseInt(oFnQCTestGroup.FnQCTestGroupID)<=0)
        {
            alert("Please select QC Test Group ");
            return;
        }
        window.open(_sBaseAddress+ "/FnQCTestGroup/FnQCTestGroupPrintPreview?id="+oFnQCTestGroup.FnQCTestGroupID);
    });


    </script>
