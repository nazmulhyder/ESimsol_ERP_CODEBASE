@model ESimSol.BusinessObjects.AttendanceDaily
@{
    ViewBag.Title = "Absent";
}

<div class="menuMainCollectionTable" style="padding:2px; font-size:12px; font-style:normal;width:90%;height:auto">
    <div style="text-align:center; overflow:hidden; width: 90%; margin-left: 5%; margin-right: 5%; margin-top: 5%;">
        <fieldset style="text-align:left">
            <legend>Check Absent List</legend>
            <table style="width:100%;" cellpadding="3" cellspacing="2">
                <tr style="width:100%;">
                    <td style="width:10%;text-align:left;" colspan="2">
                        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Check Absent List for :<input id="dtAttDate" name="dtAttDate" type="text" style="width: 150px;" class="easyui-datebox" data-options="formatter:icsdateformat,parser:icsdateparser" />
                    </td>
                    <td style="width:20%;text-align:left;">
                        <input type="radio" id="rdAnd" name="operation" value="1" /> AND
                        <input type="radio" id="rdOr" name="operation" value="2" /> OR
                    </td>
                </tr>
                <tr>
                    <td style="width:5%;"></td>
                    <td colspan ="2">
                        <input id="txtBusinessUnit_Collection" type="text" style="width:35%;" placeholder="Pick Business Unit" />
                        <a id="btnBusinessUnitPicker_Collection" href="javascript:void(0)" class="easyui-linkbutton" plain="true" iconcls="icon-pick"></a>
                        <a id="btnResetBusinessUnitPicker_Collection" href="javascript:void(0)" class="easyui-linkbutton" plain="true" iconcls="icon-clear"></a>
                    </td>
                </tr>
                <tr>
                    <td style="width:5%;"></td>
                    <td colspan="2">
                        <input id="txtLocation_Colection" style="width:35%;" placeholder="Pick Location" type="text" />
                        <a id="btnLocationPicker_Colection" href="javascript:void(0)" class="easyui-linkbutton" plain="true" iconcls="icon-pick"></a>
                        <a id="btnResetLocationPicker_Colection" href="javascript:void(0)" class="easyui-linkbutton" plain="true" iconcls="icon-clear"></a>
                    </td>
                </tr>
                <tr>
                    <td style="width:5%;"></td>
                    <td colspan="2">
                        <input id="txtDepartment_Collection" style="width:35%;" type="text" placeholder="Pick Department" />
                        <a id="btnDepartmentPicker_Collection" href="javascript:void(0)" class="easyui-linkbutton" plain="true" iconcls="icon-pick"></a>
                        <a id="btnResetDepartmentPicker_Collection" href="javascript:void(0)" class="easyui-linkbutton" plain="true" iconcls="icon-clear"></a>
                    </td>
                </tr>
                <tr>
                    <td style="width:5%;"></td>
                    <td colspan="2">
                        <input id="txtDesignation_Collection" type="text" style="width:35%;" placeholder="Pick Designation" />
                        <a id="btnDesignationPicker_Collection" href="javascript:void(0)" class="easyui-linkbutton" plain="true" iconcls="icon-pick"></a>
                        <a id="btnResetDesignationPicker_Collection" href="javascript:void(0)" class="easyui-linkbutton" plain="true" iconcls="icon-clear"></a>
                    </td>
                </tr>
                <tr>
                    <td style="width:5%;"></td>
                    <td style="width:10%;text-align:left;">
                        <h4 style="text-decoration:underline">Before & After</h4>
                    </td>
                    <td><h4 style="text-decoration:underline">Today</h4></td>
                </tr>

                <tr>
                    <td style="width:5%;"></td>
                    <td style="width:10%;text-align:left;">
                        If&nbsp;&nbsp;<input type="checkbox" id="chkIsLeaveBefore" />Leave before the Date <br />
                        &nbsp;&nbsp;&nbsp;&nbsp;<input type="checkbox" id="chkIsLeaveAfter" />Leave after the Date<br />
                        &nbsp;&nbsp;&nbsp;&nbsp;<input type="checkbox" id="chkIsAbsentBefore" />Absent before the Date<br />
                        &nbsp;&nbsp;&nbsp;&nbsp;<input type="checkbox" id="chkIsAbsentAfter" />Absent after the Date<br />
                        &nbsp;&nbsp;&nbsp;&nbsp;<input type="checkbox" id="chkIsHolidayBefore" />Holiday before the Date<br />
                        &nbsp;&nbsp;&nbsp;&nbsp;<input type="checkbox" id="chkIsHolidayAfter" />Holiday after the Date<br />
                        &nbsp;&nbsp;&nbsp;&nbsp;<input type="checkbox" id="chkIsDayOffBefore" />DayOff before the Date<br />
                        &nbsp;&nbsp;&nbsp;&nbsp;<input type="checkbox" id="chkIsDayOffAfter" />DayOff after the Date<br />

                    </td>
                    <td>

                        Time Card:
                        <select id="cboPrintType" style="width:120px;"></select><br />

                        &nbsp;&nbsp;<input type="checkbox" id="chkIsDayoffThisDay" />Dayoff This Day<br />

                        &nbsp;&nbsp;<input type="checkbox" id="chkIsMakeLeave" onclick="FuncMakeLeave()" />Make Leave<br />

                        
                        <div id="divMakeLeave">
                            Leave :&nbsp; <select id="cboLeave" style="width:40%"></select><br />
                            Date &nbsp;&nbsp;: &nbsp;&nbsp;<input id="dtStartDate" type="text" style="width: 100px;" class="easyui-datebox" data-options="formatter:icsdateformat,parser:icsdateparser" />
                            <input id="dtEndDate" type="text" style="width: 100px;" class="easyui-datebox" data-options="formatter:icsdateformat,parser:icsdateparser" />
                        </div>

                    </td>
                </tr>
                <tr style="width:10%;height: 40px;">
                    <td style="width:5%;"></td>
                    <td style="text-align:center;">
                        <a id="btnMakeAbsent" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-excel" plain="true">Excel Before&After</a>
                    </td>
                    <td style="text-align:left;">
                        <a id="btnDayoffList" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-excel" plain="true">ExcelToday</a>
                        <a id="btnMakeLeave" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-ok" plain="true">Make Leave</a>
                    </td>
                </tr>
            </table>
        </fieldset>
    </div>
</div>
<div id="winLocationPicker" class="easyui-window winstyle" title="Location Picker" style="width:350px; height:400px" data-options="modal:true,closed:true,collapsible:false,minimizable:false,maximizable:false,closable:false">
    <div style="font-family:Tahoma">
        <div class="easyui-panel" style="width:335px;height:300px;overflow:auto">
            <ul id="locationtree" data-options="checkbox:true" singleselect="false"></ul>
        </div>

        <fieldset>
            <legend style="font-weight:bold"> Action : </legend>
            <table border="0" cellspacing="2" cellpadding="2" style="font-size:11px; font-weight:bold">
                <tr>
                    <td style="width:400px; text-align:right"></td>

                    <td style="width:50px">
                        <a id="btnLocationPickerOk" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-ok" plain="true" onclick="OkButtonClick()">Ok</a>
                    </td>
                    <td style="width:50px">
                        <a id="btnLocationPickerClose" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-cancel" plain="true">Close</a>
                    </td>
                </tr>
            </table>
        </fieldset>
    </div>

    <div id="winDepartmentPicker_Collection" class="easyui-window winstyle" title="Department Picker" style="width:350px; height:400px" data-options="modal:true,closed:true,collapsible:false,minimizable:false,maximizable:false,closable:false">
        <div style="font-family:Tahoma">
            <div class="easyui-panel" style="width:335px;height:300px;overflow:auto">
                <ul id="departmenttree_Collection" data-options="checkbox:true" singleselect="false"></ul>
            </div>
            <fieldset>
                <legend style="font-weight:bold"> Action : </legend>
                <table border="0" cellspacing="2" cellpadding="2" style="font-size:11px; font-weight:bold">
                    <tr>
                        <td style="width:400px; text-align:right"></td>

                        <td style="width:50px">
                            <a id="btnDepartmentPickerOk_Collection" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-ok" plain="true">Ok</a>
                        </td>
                        <td style="width:50px">
                            <a id="btnDepartmentPickerClose_Collection" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-cancel" plain="true">Close</a>
                        </td>
                    </tr>
                </table>
            </fieldset>
        </div>
    </div>

    <div id="winDepartmentPicker" class="easyui-window winstyle" title="Department Picker" style="width:350px; height:400px" data-options="modal:true,closed:true,collapsible:false,minimizable:false,maximizable:false,closable:false">
        <div style="font-family:Tahoma">
            <div class="easyui-panel" style="width:335px;height:300px;overflow:auto">
                <ul id="departmenttree" data-options="checkbox:false" singleselect="true"></ul>
            </div>
            <fieldset>
                <legend style="font-weight:bold"> Action : </legend>
                <table border="0" cellspacing="2" cellpadding="2" style="font-size:11px; font-weight:bold">
                    <tr>
                        <td style="width:400px; text-align:right"></td>

                        <td style="width:50px">
                            <a id="btnDepartmentPickerOk" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-ok" plain="true">Ok</a>
                        </td>
                        <td style="width:50px">
                            <a id="btnDepartmentPickerClose" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-cancel" plain="true">Close</a>
                        </td>
                    </tr>
                </table>
            </fieldset>
        </div>
    </div>


</div>

<script type="text/javascript">

    var _oAttendanceDailys=[];
    var _sBaseAddress="";

    var _sBusinessUnitIds = "";
    var _sDepartmentNames = "";
    var _sDepartmentIds = "";
    var _sDesignationNames = "";
    var _sDesignationIds = "";
    var _sLocationID = "";
    var _oMaxOTTimeCards = [];
    var _oLeaveHeads = [];

    $(document).ready(function () {
        debugger;
        _oAttendanceDaily =@Html.Raw( new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(Model));
        _sBaseAddress =@Html.Raw( new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(HttpContext.Current.Session[SessionInfo.BaseAddress]));

        _oMaxOTTimeCards=@Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(@ViewBag.MaxOTTimeCard));
        _oLeaveHeads=@Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(@ViewBag.LeaveHeads));

        $('#divMakeLeave').hide();

        $("#cboPrintType").icsLoadCombo({
            List: _oMaxOTTimeCards,
            OptionValue: "MOCID",
            DisplayText: "TimeCardName"
        });

        $("#cboLeave").icsLoadCombo({
            List: _oLeaveHeads,
            OptionValue: "LeaveHeadID",
            DisplayText: "Name"
        });
        $('#dtAttDate').datebox('setValue',icsdateformat(new Date()));

        $('#dtStartDate').datebox('setValue', icsdateformat(new Date()));
        $('#dtEndDate').datebox('setValue', icsdateformat(new Date()));
    });
    function FuncMakeLeave() {
        if($("#chkIsMakeLeave").is(":checked")) {
            $('#divMakeLeave').show();
        } else {
            $('#divMakeLeave').hide();
        }
    }

    


    $("#btnMakeLeave").click(function(){
        debugger;
        //var op = false;
        //if($('input[name=operation]:checked').val() == 1)
        //    op=true;
        //else op = false;
        
        var nType = $('#cboPrintType').val();

        if(nType <= 0) {
            alert("Select a time card first");
            return;
        }

        var nLeaveHeadID = $('#cboLeave').val();
        
        var sStartDate = $('#dtStartDate').datebox('getValue');
        var sEndDate = $('#dtEndDate').datebox('getValue');



        var sTemp= $('#dtAttDate').datebox('getValue')+"~" +
            $("#chkIsDayoffThisDay").is(":checked")+"~" +
            _sBusinessUnitIds+"~" +
            _sLocationID+"~" +
            _sDepartmentIds+"~" +
            _sDesignationIds+"~" +
            true + "~" +
            nType + "~" +
            nLeaveHeadID + "~" +
            sStartDate + "~" +
            sEndDate

        $.ajax({

            type: "POST",
            dataType: "json",
            url: _sBaseAddress + "/Compliance/MakeLeaveOnDayoff",
            traditional: true,
            data: JSON.stringify({sTemp : sTemp}),
            contentType: "application/json; charset=utf-8",

            success: function (data)
            {
                var obj = [];
                obj = jQuery.parseJSON(data);
                if (obj.length > 0)
                {
                    if(obj[0].ErrorMessage == "")
                    {
                        alert("Process successful.");
                    }
                } else {
                    alert("Not Successful.");
                }
            },

            error: function (xhr, status, error)
            {
                alert(error);
            }

        });

    });
    $("#btnDayoffList").click(function(){
        debugger;
        //var op = false;
        //if($('input[name=operation]:checked').val() == 1)
        //    op=true;
        //else op = false;

        var nType = $('#cboPrintType').val();

        if(nType <= 0) {
            alert("Select a time card first");
            return;
        }

        var oParam= "sAttendanceDate="+$('#dtAttDate').datebox('getValue')+
            //"&bOperation="+ op+
            "&bIsDayoffThisDay="+ $("#chkIsDayoffThisDay").is(":checked")+
            "&BUIDs="+ _sBusinessUnitIds+
            "&LocIDs="+ _sLocationID+
            "&DepartmentIDs="+ _sDepartmentIds+
            "&DesignationIDs="+ _sDesignationIds+
            "&IsComp="+ true + 
            "&nType=" + nType


        window.open(_sBaseAddress+ "/Compliance/DayoffListExcel?"+oParam);

    });

    $("#btnMakeAbsent").click(function(){
        debugger;
        var op = false;
        if($('input[name=operation]:checked').val() == 1)
            op=true;
        else op = false;

        var oParam= "sAttendanceDate="+$('#dtAttDate').datebox('getValue')+
            "&bOperation="+ op+
            "&bIsLeaveBefore="+ $("#chkIsLeaveBefore").is(":checked")+
            "&bIsLeaveAfter="+ $("#chkIsLeaveAfter").is(":checked")+
            "&bIsAbsentBefore="+ $("#chkIsAbsentBefore").is(":checked")+
            "&bIsAbsentAfter="+ $("#chkIsAbsentAfter").is(":checked")+
            "&bIsHolidayBefore="+ $("#chkIsHolidayBefore").is(":checked")+
            "&bIsHolidayAfter="+ $("#chkIsHolidayAfter").is(":checked")+
            "&bIsDayOffBefore="+ $("#chkIsDayOffBefore").is(":checked")+
            "&bIsDayOffAfter="+ $("#chkIsDayOffAfter").is(":checked")+
            "&BUIDs="+ _sBusinessUnitIds+
            "&LocIDs="+ _sLocationID+
            "&DepartmentIDs="+ _sDepartmentIds+
            "&DesignationIDs="+ _sDesignationIds+
            "&IsComp="+ true


        window.open(_sBaseAddress+ "/Compliance/MakeBridgeAbsent?"+oParam);

    });

    /*-------------Start Business Unit Picker----------------*/
    $("#btnBusinessUnitPicker_Collection").click(function(e){
        BusinessUnitPicker();
    });

    $("#txtBusinessUnit_Collection").keypress(function(e){
        if (e.which == 13)//enter=13
        {
            BusinessUnitPicker();
        }
    });

    function BusinessUnitPicker()
    {
        var oBusinessUnit={
            BusinessUnitID:0
        };
        var obj = {
            BaseAddress: _sBaseAddress,
            Object: oBusinessUnit,
            ControllerName: "BusinessUnit",
            ActionName: "GetsBusinessUnitWithPermission",
            IsWinClose: false
        };
        $.icsDataGets(obj, function (response) {
            if (response.status && response.objs.length > 0) {
                if (response.objs[0].BusinessUnitID > 0) {
                    var tblColums = [];
                    var oColumn = { field: "Code", title: "Code", width: 50, align: "left" };tblColums.push(oColumn);
                    oColumn = { field: "Name", title: "Name", width: 170, align: "left" };tblColums.push(oColumn);

                    var bmultiplereturn=true;

                    var oPickerParam = {
                        winid: 'winBusinessUnit',
                        winclass:'clsBusinessUnit',
                        winwidth: 320,
                        winheight: 400,
                        tableid: 'tblBusinessUnit',
                        tablecolumns: tblColums,
                        datalist: response.objs,
                        multiplereturn: bmultiplereturn,
                        searchingbyfieldName:'Name',
                        windowTittle: 'Business Unit List'
                    };
                    $.icsPicker(oPickerParam);
                    IntializeBusinessUnitPickerbutton(oPickerParam);//multiplereturn, winclassName
                }
                else { alert(response.objs[0].ErrorMessage); }
            }
        });
    }

    function IntializeBusinessUnitPickerbutton(oPickerobj)
    {
        $("#" + oPickerobj.winid).find("#btnOk").click(function () {
            var oBusinessUnits=[];
            oBusinessUnits = $('#'+oPickerobj.tableid).datagrid('getChecked');
            if (oPickerobj.winid == 'winBusinessUnit')
            {
                if(oBusinessUnits!=null && oBusinessUnits.length>0)
                {
                    $("#"+oPickerobj.winid).icsWindow("close");
                    $("#" + oPickerobj.winid).remove();
                    var sBusinessUnitName = "";
                    for(var i=0; i<oBusinessUnits.length; i++)
                    {
                        sBusinessUnitName+=oBusinessUnits[i].Name+",";
                        _sBusinessUnitIds+=oBusinessUnits[i].BusinessUnitID+",";
                    }

                    sBusinessUnitName=sBusinessUnitName.substring(0,sBusinessUnitName.length-1);
                    _sBusinessUnitIds=_sBusinessUnitIds.substring(0,_sBusinessUnitIds.length-1);
                    $("#txtBusinessUnit_Collection").val(sBusinessUnitName);
                }
                else
                {
                    alert("Please select a Business Unit.");
                }
            }
        });
    }

    $("#btnResetBusinessUnitPicker_Collection").click(function(e){
        $('#txtBusinessUnit_Collection').val("");
        _sBusinessUnitIds="";
    });
    /*-------------End Business Unit Picker----------------*/

    /*-------------Location Picker----------------*/
    var btnLocation="";
    $("#btnLocationPicker,#btnLocationPicker_Colection").click(function(e){
        btnLocation = $(this).attr("id");
        var sBusinessUnitIDs ="";
        var nBusinessUnitID=0;
        if(btnLocation=="btnLocationPicker")
        {
            nBusinessUnitID = $("#cboBU").val();
            sBusinessUnitIDs = String(nBusinessUnitID);
        }
        else{sBusinessUnitIDs=_sBusinessUnitIds;}
        $("#winLocationPicker").icsWindow('open');
        var oLocation={LocationID:0,BusinessUnitIDs:sBusinessUnitIDs};
        var obj = {
            BaseAddress: _sBaseAddress,
            Object: oLocation,
            ControllerName: "Location",
            ActionName: "GetsLocationMenuTree",
            IsWinClose: false
        };

        $.icsDataGet(obj, function (response) {
            if (response.status && response.obj!=null) {
                if (response.obj.TLocation.id > 0) {
                    $('#locationtree').tree({ data: [response.obj.TLocation] });
                }
            }
        });
    });

    $("#btnLocationPickerOk").click(function(e){
        if(btnLocation=="btnLocationPicker")
        {
            var oLocation = $('#locationtree').tree('getSelected');
            if(oLocation!=null && oLocation.id>0){
                $("#winLocationPicker").icsWindow('close');
                _sLocationID=oLocation.id;
                $('#txtLocation').val(oLocation.text);
            }
            else{
                alert("Please select a location.");
            }
        }
        else
        {
            var oLocations = $('#locationtree').tree('getChecked');
            if(oLocations!=null && oLocations.length>0)
            {
                var LocationName="";
                for(var i=0; i<oLocations.length; i++)
                {
                    if(oLocations[i].id !=1)
                    {
                        LocationName+=oLocations[i].text+",";
                        _sLocationID+=oLocations[i].id+",";
                    }
                }

                LocationName=LocationName.substring(0,LocationName.length-1);
                _sLocationID=_sLocationID.substring(0,_sLocationID.length-1);
                $("#winLocationPicker").icsWindow('close');
                $('#txtLocation_Colection').val(LocationName);
            }
            else
            {
                alert("Please select a location.");
            }
        }
    });

    $('#txtLocation_Colection').keypress(function (e)
    {
        var code = (e.keyCode ? e.keyCode : e.which);
        if (code == 13)//Enter key-13
        {
            var sBusinessUnitIDs ="";
            sBusinessUnitIDs=_sBusinessUnitIds;
            $("#winLocationPicker").icsWindow('open');
            var oLocation={LocationID:0,BusinessUnitIDs:sBusinessUnitIDs};
            var obj = {
                BaseAddress: _sBaseAddress,
                Object: oLocation,
                ControllerName: "Location",
                ActionName: "GetsLocationMenuTree",
                IsWinClose: false
            };
            $.icsDataGet(obj, function (response) {

                if (response.status && response.obj!=null) {
                    if (response.obj.TLocation.id > 0) {
                        $('#locationtree').tree({ data: [response.obj.TLocation] });
                    }
                }
            });
        }
    });

    $("#btnLocationPickerClose").click(function(e){
        $("#winLocationPicker").icsWindow('close');
    });

    $("#btnResetLocationPicker,#btnResetLocationPicker_Colection").click(function(e){
        $('#txtLocation').val("");
        $('#txtLocation_Colection').val("");
        _sLocationID="";
    });
    /*-------------Department Picker----------------*/

    $("#btnDepartmentPicker").click(function(e){
        $("#winDepartmentPicker").icsWindow('open');
        var oDepartment={DepartmentID:0,BusinessUnitIDs:_sBusinessUnitIds,LocationIDs:_sLocationID};
        var obj = {
            BaseAddress: _sBaseAddress,
            Object: oDepartment,
            ControllerName: "Department",
            ActionName: "GetsDepartments",
            IsWinClose: false
        };

        $.icsDataGet(obj, function (response) {
            if (response.status && response.obj!=null) {
                if (response.obj.id > 0) {
                    $('#departmenttree').tree({ data: [response.obj] });
                }
            }
        });
    });

    $("#btnDepartmentPickerOk").click(function(e){
        _sDepartmentNames = "";
        _sDepartmentIds= "";
        var oDepartment = $('#departmenttree').tree('getSelected');
        if(oDepartment!=null && oDepartment.id>0){
            $("#winDepartmentPicker").icsWindow('close');
            $('#txtDepartment').val(oDepartment.text);
            _sDepartmentIds= oDepartment.id;
        }
        else{
            alert("Please select a department.");
        }
    });

    $("#btnDepartmentPickerClose,#btnDepartmentPickerClose_Collection").click(function(e){
        $("#winDepartmentPicker").icsWindow('close');
        $("#winDepartmentPicker_Collection").icsWindow('close');
    });

    $("#btnResetDepartmentPicker,#btnResetDepartmentPicker_Collection").click(function(e){
        $('#txtDepartment,#txtDepartment_Collection').val("");
        _sDepartmentIds="";
        _sDepartmentNames = "";
    });

    /*-------------Designation Picker----------------*/
    var btnDesignation="";
    $("#btnDesignationPicker,#btnDesignationPicker_Collection").click(function(e){
        btnDesignation = $(this).attr("id");
        DesignationPicker();
    });

    $("#txtDesignation_Collection").keypress(function(e){
        if (e.which == 13)//enter=13
        {
            btnDesignation ="btnDesignationPicker_Collection";
            DesignationPicker();
        }
    });

    function DesignationPicker()
    {
        var oDesignation={
            DesignationID:0,
            Params: _sBusinessUnitIds+'~'+_sLocationID+'~'+ _sDepartmentIds
        };
        var obj = {
            BaseAddress: _sBaseAddress,
            Object: oDesignation,
            ControllerName: "Designation",
            ActionName: "Gets",
            IsWinClose: false
        };
        $.icsDataGets(obj, function (response) {
            _sDesignationNames = "";
            _sDesignationIds = "";
            if (response.status && response.objs.length > 0) {
                if (response.objs[0].DesignationID > 0) {
                    var tblColums = [];
                    var oColumn = { field: "Code", title: "Code", width: 50, align: "left" };tblColums.push(oColumn);
                    oColumn = { field: "Name", title: "Name", width: 170, align: "left" };tblColums.push(oColumn);

                    var bmultiplereturn=false;
                    if(btnDesignation=="btnDesignationPicker_Collection"){bmultiplereturn=true;}

                    var oPickerParam = {
                        winid: 'winDesignation',
                        winclass:'clsDesignation',
                        winwidth: 320,
                        winheight: 460,
                        tableid: 'tblDesignation',
                        tablecolumns: tblColums,
                        datalist: response.objs,
                        multiplereturn: bmultiplereturn,
                        searchingbyfieldName:'Name',
                        windowTittle: 'Designation List'
                    };
                    $.icsPicker(oPickerParam);
                    IntializeDesignationPickerbutton(oPickerParam);//multiplereturn, winclassName
                }
                else { alert(response.objs[0].ErrorMessage); }
            }
        });
    }

    function IntializeDesignationPickerbutton(oPickerobj)
    {
        $("#" + oPickerobj.winid).find("#btnOk").click(function () {
            var oDesignations=[];

            if(btnDesignation=="btnDesignationPicker_Collection")
            {
                oDesignations = $('#'+oPickerobj.tableid).datagrid('getChecked');
            }
            else
            {
                var oDesignation = $('#'+oPickerobj.tableid).datagrid('getSelected');
                oDesignations.push(oDesignation);
            }

            if (oPickerobj.winid == 'winDesignation')
            {
                if(oDesignations!=null && oDesignations.length>0){
                    $("#"+oPickerobj.winid).icsWindow("close");
                    $("#" + oPickerobj.winid).remove();

                    for(var i=0; i<oDesignations.length; i++)
                    {
                        _sDesignationNames+=oDesignations[i].Name+",";
                        _sDesignationIds+=oDesignations[i].DesignationID+",";
                    }

                    _sDesignationNames=_sDesignationNames.substring(0,_sDesignationNames.length-1);
                    _sDesignationIds=_sDesignationIds.substring(0,_sDesignationIds.length-1);
                    if(btnDesignation=="btnDesignationPicker_Collection")
                    {
                        $("#txtDesignation_Collection").val(_sDesignationNames);
                    }
                    else
                    {
                        $("#txtDesignation").val(_sDesignationNames);
                    }
                }
                else{
                    alert("Please select a designation.");
                }
            }
        });
    }

    $("#btnResetDesignationPicker,#btnResetDesignationPicker_Collection").click(function(e){
        $('#txtDesignation').val("");
        $('#txtDesignation_Collection').val("");
        _sDesignationIds="";
        _sDesignationNames = "";
    });

    /*-------------Department Picker start Collection----------------*/
    $("#btnDepartmentPicker_Collection").click(function(e){
        DepartmentPicker();
    });

    $("#txtDepartment_Collection").keypress(function(e){
        if (e.which == 13)//enter=13
        {
            DepartmentPicker();
        }
    });

    function DepartmentPicker()
    {
        $("#winDepartmentPicker_Collection").icsWindow('open');
        var oDepartment={DepartmentID:0,BusinessUnitIDs:_sBusinessUnitIds,LocationIDs:_sLocationID};
        var obj = {
            BaseAddress: _sBaseAddress,
            Object: oDepartment,
            ControllerName: "Department",
            ActionName: "GetsDepartments",
            IsWinClose: false
        };

        $.icsDataGet(obj, function (response) {
            if (response.status && response.obj!=null) {
                if (response.obj.id > 0) {
                    $('#departmenttree_Collection').tree({ data: [response.obj] });
                }
            }
        });
    }

    $("#btnDepartmentPickerOk_Collection").click(function(e){
        _sDepartmentNames = "";
        _sDepartmentIds= "";
        var oDepartments = $('#departmenttree_Collection').tree('getChecked');
        if(oDepartments!=null && oDepartments.length>0){
            $("#winDepartmentPicker_Collection").icsWindow('close');
            for(var i=0; i<oDepartments.length; i++)
            {
                _sDepartmentNames+=oDepartments[i].text+",";
                _sDepartmentIds+=oDepartments[i].id+",";
            }

            _sDepartmentNames=_sDepartmentNames.substring(0,_sDepartmentNames.length-1);
            _sDepartmentIds=_sDepartmentIds.substring(0,_sDepartmentIds.length-1);
            $("#txtDepartment_Collection").val(_sDepartmentNames);
        }
        else{
            alert("Please select a department.");
        }
    });

</script>
