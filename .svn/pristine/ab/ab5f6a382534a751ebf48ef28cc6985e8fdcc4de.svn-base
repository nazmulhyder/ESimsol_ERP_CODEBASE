@model ESimSol.BusinessObjects.ProductionSchedule
<link href="../../Content/CSS/AjaxLoader.css" rel="stylesheet" type="text/css" />
<link href="../../Content/CSS/icon.css" rel="stylesheet" type="text/css" />
<html>
@{
    ViewBag.Title = "View Machine Wise Production Schedule";
}
<head>
 
</head>
<body>
    <div id="winPrintTypeSelector" class="easyui-window winClass" title="Print Type" data-options="modal:true,closed:true,collapsible:false,minimizable:false,maximizable:false,closable:false">
        <div style="width:360px; float: left;">
            <table border="0" cellpadding="0" cellspacing="0">
                <tr>
                    <td style="width: 50px; text-align: right">
                        Type:
                    </td>
                    <td style="width:120px">
                            <input type="checkbox" id="chkPortrait" />Portrait 
                    </td>
                    <td style="width:120px">
                        <input type="checkbox" id="chkLandScape" />Landscape
                    </td>
                  </tr>
                <tr style="height:50px">
                    <td style="width:350px; text-align:right" colspan="3">
                        <a href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-ok" plain="true" onclick="OkPrintTypeButtonClick()()">Ok</a>
                        <a href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-cancel" plain="true" onclick="ClosePrintType()">Close</a>
                    </td>
                </tr>
            </table>
        </div>
    </div>

    <div class="menuMainCollectionTable" id="divPS">
        <div id="cc" class="easyui-layout" style="width: 100%; height: 564px;">
            <div id="divContentWest" data-options="region:'west',title:'Searching Criteria',split:true"
                style="width: 270px;">
                <table style="padding-top:5px; padding-left:5px; font-size: 11px; font-weight: bold;
                    width: 98%;">
                    <tr>
                        <td style="padding-bottom: 5px;">
                            Create Date <span style="padding-left: 5px;">
                                <select style="width: 160px;" id="cboDateSelection">
                                    <option value="None">None</option>
                                    <option value="Equal">Equal</option>
                                    <option value="Between">Between</option>
                                </select>
                            </span>
                        </td>
                    </tr>
                    <tr>
                        <td>
                            <div>
                                <div id="regionStartDate" style="float: left;">
                                    <input type="text" class="easyui-datebox" style="width: 105px;" id="txtStartDate"
                                        data-options="formatter:icsdateformat,parser:icsdateparser" />
                                </div>
                                <div id="regionEndDate" style="float: left;">
                                    <span style="padding-left: 8px; padding-right: 3px;">To</span>
                                    <input type="text" class="easyui-datebox" style="width: 105px;" id="txtEndDate" data-options="formatter:icsdateformat,parser:icsdateparser" />
                                </div>
                            </div>
                        </td>
                    </tr>
                    <tr>
                        <td style="padding-top: 5px; padding-bottom: 5px;">
                            <div>
                                <span style="padding-left:25px; text-align:right;">Order No</span>
                                <span style="text-align:right;">
                                    <input type="text" id="txtOrderNo" placeholder="Order No" style="width:90px; font-size:11px;height: 17px;"  />
                                </span>
                                <span><a href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-search" plain="true" id="btnOrderNoSearch"></a></span>
                                <span>
                                    <a href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-clear" plain="true" id="btnOrderNoReset"></a>
                                </span>
                                    
                            </div>
                            <div id="divExeFound" style="padding-top: 5px;">
                                <span style="padding-right: 8px;">Total Order Found :</span><span><label id="lblExeFound" /></span>
                                <span><a href="javascript:void(0)" class="easyui-linkbutton" id="btnOrderFound"title="Show" iconcls="icon-details" plain="true"></a></span>
                            </div>
                        </td>
                    </tr>
                </table>
                <table style="padding-top:5px; padding-left:30px; font-size: 11px; font-weight: bold;
                    width: 98%;">
                    <tr>
                        <td>
                            Location
                            <select id="cboLocation" onchange="ChangeOnlaocation()" style="width:157px;">
                            </select>
                        </td>
                    </tr>
                    <tr>
                        <td style="padding-top: 5px;">
                            <div>
                                <div style="float: left;">
                                    @*Machine Type*@</div>
                                <div style="float: left; padding-left: 12px;">
                                    <select id="cboMachineType" onchange="ChangeOnMachineType()" style="width: 120px">
                                        <option value='0'>All</option>
                                        <option value='1'>Cone</option>
                                        <option value='2'>Hank</option>
                                    </select>
                                </div>
                            </div>
                        </td>
                    </tr>
                    <tr>
                        <td style="padding-bottom: 5px;">
                            <div>
                                <div style="float: left;">
                                    <div style="float: left;">
                                       
                                    </div>
                                </div>
                            </div>
                        </td>
                    </tr>
                </table>
                <div style="padding-left: 12px; width: 95%;">
                    <table id="tblMachineName" class="easyui-datagrid" style="width: 95%; height: 300px;
                        overflow: scroll;" fitcolumns="false" rownumbers="true" pagination="false" single="true"
                        autorowheight="false">
                        <thead>
                            <tr>
                                <th data-options="field:'Selected',checkbox:true">
                                </th>
                                <th field="MachineNameWithCapacity" width="150">
                                    Machine Name
                                </th>
                            </tr>
                        </thead>
                    </table>
                    <table style="padding-top: 10px; font-size: 12px; width: 95%;">
                        <tr>
                            <td style="padding-left: 8px; float: right">
                                <a href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-reload" plain="true"
                                    onclick="Refresh()">Refresh</a>
                            </td>
                        </tr>
                    </table>
                </div>
            </div>
            <div id="divContentCenter" data-options="region:'center'" style="padding: 2px; width: 100%">
            
                        <div id="scheduleViewOption" style="padding-left: 5px; background-color: gray;">
                            <label>
                                <input type="button" value="<" style="width: 20px; font-size: 10px;" onclick="Prevoius()" />
                            </label>
                            <label id="dateHeader" style="font-size: 12px; padding-left: 0px; color: White; font-family: Verdana;">
                            </label>
                            <label>
                                <input type="button" value=">" style="width: 20px; font-size: 10px;" onclick="Next()" />
                            </label>
                            <a href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-reload" plain="true"onclick="ToolbarRefresh()"></a>
                            <label>
                                <input type="button" value="Today" style="width: 40px; font-size: 10px;" onclick="TodayView()" />
                            </label>
                            <label>
                                <input type="button" value="Day" style="width: 30px; font-size: 10px;" onclick="DayView()" />
                            </label>
                            <label>
                                <input type="button" value="Week" style="width: 37px; font-size: 10px;" onclick="WeekView()" />
                            </label>
                            <label>
                                <input type="button" value="Month" style="width: 40px; font-size: 10px;" onclick="MonthView()" />
                            </label>
                            <label>
                                <input type="button" id="btnInComplete" value="In Cmp" style="width: 45px; font-size: 10px;" />
                            </label>
                            <label>
                                <a href="javascript:void(0)" class="easyui-linkbutton" id="btnUndo" title="Undo"iconcls="icon-undo" plain="true"></a>
                            </label>
                            <label>
                                <a href="javascript:void(0)" class="easyui-linkbutton" id="btnRedo" title="Redo"iconcls="icon-redo" plain="true"></a>
                            </label>
                            <span style="padding-top: 20px;"><span style="padding-left: 5px; color: Black">All</span>
                            <input type="checkbox" id="chkboxUptoUnloadDyeMachine" onchange="RefreshForUnloadDyemachine()" />
                            </span><a href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-print"plain="true" onclick="print()">Print</a>
                        </div>
                   
                    <div>
                        @*<table id="tblSchedule" style="width: 100%; height: 530px;" border="0" cellpadding="0" cellspacing="0"></table>*@
                      <table id="tblSchedule" class="easyui-datagrid" style="width: 100%; height: 530px;" fitcolumns="false" rownumbers="false" pagination="false" singleselect="true" autorowheight="true" toolbar="#toolbar"></table>
                    </div>
               
            </div>
        </div>

    <div id="divAjaxLoader" style="width: 500px;">
        <img src="../../Content/Images/Ajaxloader.GIF" class="ajax-loader" />
    </div>
    </div>
    <div id="winDUProductionSchedule" style="width:960px;" class="easyui-window winstyle" title="MarketingSchedule Informations" data-options="modal:true,closed:true,collapsible:false,minimizable:false,maximizable:false,closable:false">

   

        <div style="padding-top: 10px;">
            <div style="padding-left: 11px; padding-right:10px; padding-top:5px;">
                <table id="tblProductionScheduleDetail" title="Production Schedule Details" class="easyui-datagrid" style="width:100%; height:320px" fitcolumns="false" rownumbers="true" pagination="false" singleselect="true" autorowheight="false" toolbar="#toolbar">
                    <thead>
                        <tr>
                            <th field="OrderNo" width="120" align="left">
                                Order No
                            </th>
                            <th field="BuyerName" width="140" align="left">
                                Buyer Name
                            </th>
                            <th field="ProductName" width="160" align="left">
                                Product Name
                            </th>
                            <th field="ColorName" width="125" align="left">
                                Color Name
                            </th>
                            <th field="RouteSheetNo" width="70" align="left">
                                DL No
                            </th>
                            <th field="CombineRSNo" width="70" align="left">
                                CDL No
                            </th>
                            <th width="100" align="right" field="ProductionQty" formatter="formatPrice">
                                Production Qty
                            </th>
                        </tr>
                    </thead>
                </table>
                <div id="toolbar">
                    <a href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-reload" plain="true" onclick="Refresh()"></a>
                    <a id="btnAddDyelineSheet" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-add" plain="true">DL</a>
                    <a id="btnPrintBatchCard" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-print" plain="true">Batch Card</a>
                </div>
            </div>
        </div>

        <fieldset class="actionfieldsetstyle">
            <legend>Actions : </legend>
            <table border="0" cellspacing="2" cellpadding="2" style="width:100%; font-size:11px; font-weight:bold;">
                <tr>
                    <td style="width:100%;text-align:right;">
                        <a id="btnUpdateFSEDetail" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-save" plain="true">OK</a>
                        <a id="btnClosePS" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-cancel" plain="true">Close</a>
                    </td>

                </tr>
            </table>
        </fieldset>
    </div>

</body>
</html>
<script type="text/javascript">
    var _value ="";
    var _sBaseAddress="";
    var _oUnit=[];
    var _oProductionSchedule;
    var _oLocation=[] ;
    var _oDyeMachines=[];
    var _activeMachines=[];
    var _oSelectedDyeMachine=[];
    var obj=window.dialogArguments;
    var nProductionScheduleID;
    var stableContents="";
    var _nfirstLoad=1;
    var mouseMoveFlag=1;
    var nflagWeekValue=0;
    var _nView=0;
    var _nFirstDatetimeLoad=0;
    var _nWeek=0;
    var _nContinuation=0;
    var _JobPerMonths=[];
    var _oCRIDs=[];
    var _oPSIDs=[];
    var _oProductionSchedules=[];
    var _bToolbarRefresh=false;
    var _bSelectedMachinePrint=false;
    var _oPS=null;
    var _bCopy=false;
    var _bCut=false;
    var _bUndoCopyPaste=false;
    var _bRedoCopyPaste=false;
    var _bUndoCutPaste=false;
    var _bRedoCutPaste=false;
    var _bUndoSwap=false;
    var _bRedoSwap=false;
    var _oUndoPaste=null;
    var _oRedoPaste=null;
    var _oOldPS=null;
    var _oPSCopy=null;
    var _sUndoSwapPSIDs="";
    var _sIncDecTime="";
    var _sCheckTime="";
    var _oDyeMachines_temp=[];
    var _oDyeMachine={};

    $(document).ready(function ()
    {

        //debugger;
        _sBaseAddress =@Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(HttpContext.Current.Session[SessionInfo.BaseAddress]));
        _oProductionSchedule =@Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(Model));
        _oDyeMachines=  @Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(@ViewBag.CapitalResources));
        _oLocation=  @Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(@ViewBag.Locations));
        _oProductionSchedules= @Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(@ViewBag.ProductionSchedules));
        var nBUID = @Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(@ViewBag.BUID));
        sessionStorage.setItem('BUID',nBUID);
        $("#divPS").data("PrintParam","");
        $("#divPS").data("PrintType","");
        $('#btnUndo,#btnRedo').linkbutton('disable');
        $('#txtStartDate,#txtEndDate').datebox('setValue',icsdateformat(new Date()));

        var oDate=new Date();
        var Month=['Jan','Feb','Mar','Apr','May','Jun','Jul','Aug','Sep','Oct','Nov','Dec'];
        document.getElementById("dateHeader").innerHTML=Month[oDate.getMonth()] +" "+ oDate.getFullYear();
        MakeTable(_oDyeMachines);
        GenerateTableData(_oDyeMachines);
       // LoadIntoGrid(_oProductionSchedules);
        $("#divAjaxLoader,#cboMachineType,#divExeFound").hide();
        var x = $("#cboDateSelection").val();
        if(x == "None")
        {
            document.getElementById("regionStartDate").style.display = 'none';
            document.getElementById("regionEndDate").style.display = 'none';
        }
        $("#cboLocation").empty();
        var listLocation="";
        if(_oLocation.length>0)
        {
            for (var i = 0; i < _oLocation.length; i++)
            {
                listLocation += "<option value='" + _oLocation[i].LocationID +"'>" + _oLocation[i].Name+"</option>";
            }
        }
        $("#cboLocation").html(listLocation);
        FindMachineName();
    });

    $('#cboDateSelection').change(function ()
    {
        //debugger;
        var x = $("#cboDateSelection").val();
        if(x == "None")
        {
            document.getElementById("regionStartDate").style.display = 'none';
            document.getElementById("regionEndDate").style.display = 'none';
        }
        else if (x == "Equal")
        {
            document.getElementById("regionStartDate").style.display = '';
            document.getElementById("regionEndDate").style.display = 'none';
        }
        else
        {
            document.getElementById("regionStartDate").style.display = '';
            document.getElementById("regionEndDate").style.display = '';
        }
    });

    function FindMachineName()
    {
        debugger;
        _oSelectedDyeMachine=[];
        var locationId= document.getElementById("cboLocation").value;
        var machineType= document.getElementById("cboMachineType").value;

        //debugger;
        for(var i=0;i< _oDyeMachines.length;i++)
        {
            if(machineType>0)
            {
                //var machineTypeId=Number(machineType)-1;

                if(_oDyeMachines[i].LocationID==locationId && _oDyeMachines[i].IsActive==true && _oDyeMachines[i].MachineType==machineType)
                {
                    _oSelectedDyeMachine.push(_oDyeMachines[i]);
                }

            }

            else
            {

                if(_oDyeMachines[i].LocationID==locationId && _oDyeMachines[i].IsActive==true)
                {
                    _oSelectedDyeMachine.push(_oDyeMachines[i]);
                }

            }

        }
        //debugger;
        $('#tblMachineName').empty;
        data=_oSelectedDyeMachine;
        data={"total":""+data.length+"","rows":data};
        $('#tblMachineName').datagrid('loadData',data);
        $('#tblMachineName').datagrid({selectOnCheck:true, checkOnSelect:false});

    }

    function MakeTable(oMachines)
    {
       
        var tblfrozenColumns=[];
        var tblColums=[];
        var oColumn=null;
        oColumn= { field :"sDate", title:"Date", width:"100", align: "center"  };
        tblfrozenColumns.push(oColumn);
        if(oMachines.length<=0)
        {
            alert("Please Choose at least one Machine!");
            return;
        }
        var count =0;
        _oDyeMachine["sDate"] ="";
        for(var i=0; i<oMachines.length;i++)
        {
            count++;
            oColumn= {
                field:"CRID"+oMachines[i].CRID,
                title:  oMachines[i].MachineNoWithCapacityAndTotalSchedule ,
                width: "150",
                align: "left",
                formatter: function (value, row, index) { return FormatDetailSchedule(value, index); }
            };
            tblColums.push(oColumn);
            _oDyeMachine["CRID"+oMachines[i].CRID] =oMachines[i].CRID;
            _oDyeMachine["Note"] ="";
            _oDyeMachine["SL"] =count;
             
        }
        $('#tblSchedule').datagrid({
            frozenColumns:[tblfrozenColumns],
            columns:[tblColums]
        });
       
    }

    function GenerateTableData(oMachines)
    {
        debugger;
        for(var i=0; i<5;i++)
        {
            _oDyeMachine={}  ;
            for (var j = 0; j < oMachines.length; j++) 
            {
                _oDyeMachine.sDate = "Date";
                _oDyeMachine["SL"] =i;
                _oDyeMachine['Note'] =  i;
                _oDyeMachine["CRID"+oMachines[j].CRID] = GenerateCellValue(oMachines[j].CRID, j);
               
            }
         
            _oDyeMachines_temp.push(_oDyeMachine);
        }
    
       DynamicRefreshList(_oDyeMachines_temp, 'tblSchedule');
    }
  
    function GenerateCellValue(nCRID, j) {
       
        var sDateString = "";
        var sReturn = nCRID + '~' + sDateString + '~';
        var sBuyersName = '';
        for (var i = 0; i < _oProductionSchedules.length; i++) {
            if (_oProductionSchedules[i].MachineID == nCRID && _oProductionSchedules[i].DBUserID!=5 ) {
                sBuyersName = sBuyersName + _oProductionSchedules[i].ProductionScheduleNo + '~'+_oProductionSchedules[i].ProductionScheduleID+",";
                _oProductionSchedules[i].DBUserID=5;
                break;
            }
        }

        sBuyersName = sBuyersName.substring(0, sBuyersName.length - 1);
        sReturn =sReturn+ sBuyersName+'~';
        return sReturn;
    }

    
    function FormatDetailSchedule(value, index) {
       
        var aValues = value.split('~');
        var nObjectID = parseInt(aValues[0]);
        var sDate = aValues[1];
        var sPSID = aValues[3];
     //   alert("MNo=" + nObjectID +" Date :"+sDate+" PSID :"+sPS);
        var sParam = "" + nObjectID + ",'" + sDate + "'," + index + ","+sPSID;
        var s = (aValues[2] == null || aValues[2] == '') ?
            ' <input type="image" src="'+ _sBaseAddress +'/Content/CSS/icons/pencil.png", id="btnDetail' + nObjectID + '", onclick="DetailViewSchedule(' + sParam + ')", value=""/>'
            : ' <label id="btnDetail' + nObjectID + '" onclick="DetailViewSchedule(' + sParam + ')">' + aValues[2] + '</label>';

        return s;
    }
    function DetailViewSchedule(nObjectID, sDate, index,sPSID) {
        debugger;
        alert("index=" + index +" MID:"+nObjectID+" PSID:"+sPSID);
        if (nObjectID == null || nObjectID <= 0) {
            alert("Please select a item from list!");
            return;
        }
        //var nRowIndex=$("#tblSchedule").data('selectedIndex');
        //var oProductionSchedule=$("#tblSchedule").data('rows')[nRowIndex];

        //if (oProductionSchedule.CRID <= 0) {
        //    alert("Please select a item from list!");
        //    return;
        //}
      
        _oProductionSchedule = { ErrorMessage: "", ProductionScheduleID: sPSID, MachineID: nObjectID };
    
        $.ajax({
            type: "POST",
            url: _sBaseAddress + "/ProductionSchedule/GetPS",
            traditional: true,
            data: JSON.stringify(_oProductionSchedule),
            contentType: "application/json; charset=utf-8",
            success: function (data) {
                debugger;
                _oProductionSchedule = { ErrorMessage: "", ProductionScheduleID: 0, MachineID: 0 };
                _oProductionSchedule = jQuery.parseJSON(data);
            
                //RefreshControlMarketingSchedule(_oProductionSchedule);
                $("#winDUProductionSchedule").icsWindow("open", "Schedule Entry");
             

            }
        });
    }


    $("#btnUpdateFSEDetail").click(function () {
       
        var oFSCDetail = $('#tblFSCDetails').datagrid('getSelected');
        if (oFSCDetail ==null ) { alert("Please select an item from list."); return ; }
        var nSelectedRowIndex=$('#tblFSCDetails').datagrid('getRowIndex',oFSCDetail);

        oFSCDetail.Construction=$("#txtConstruction_F").val();
        oFSCDetail.FabricWidth=$("#txtFabricWidthFabric").val();

       
        $('#tblFSCDetails').datagrid('updateRow', { index: nSelectedRowIndex, row: oFSCDetail });
      //  endEditing();
        $("#winDUProductionSchedule").icsWindow("close");

    });
    $("#btnClosePS").click(function () {
        debugger;
        $("#winDUProductionSchedule").icsWindow("close");

    });


    function LoadIntoGrid(oRows)
    {
        debugger;
        data=oRows;
        data={"total":""+data.length+"","rows":data};
        $('#tblSchedule').datagrid('loadData',data);
        var nView=sessionStorage.getItem("View");
        if(parseInt(nView)>=0)
        {
            if(nView==0)
            {
                _oProductionSchedule.sDay= "Day";
            }
            else if(nView==1)
            {
                _oProductionSchedule.sWeek= "Week";
            }
            else if(nView==2)
            {
                _oProductionSchedule.sMonth="Month";
            }
            _bToolbarRefresh=true;

            var nIndex =parseInt(sessionStorage.getItem("SelectedRowIndex"));
            $('#tblSchedule').datagrid('selectRow', nIndex);
        }
        sessionStorage.setItem("View","");
    }

    function formatString(val,row)
    {

        return '<center>'+val+'</center>';
    }

    function formatDate(val,row)
    {

        return '<span style="color:blue">'+val+'</span>';
    }


    $('#btnOrderNoReset').click(function(e)
    {
        $("#txtOrderNo")[0].value='';
        document.getElementById('lblExeFound').innerHTML="";
        document.getElementById('divExeFound').style.display='none';
    });

    $('#btnOrderNoSearch').click(function(e)
    {
        var oPSDs=[];
        var sOrderNo= $('#txtOrderNo').val();
        if(isNaN(sOrderNo)==true && sOrderNo!="No")
        {
            alert("Please enter valid no.");
            return;
        }
        var oPSD={
            OrderNo: sOrderNo
        };
        oPSDs.push(oPSD);
        var nLocationID= $("#cboLocation").val();
        _oProductionSchedule.sWeek= "Week"; //--------------
        _oProductionSchedule.LocationID=nLocationID;
        _oProductionSchedule.ProductionScheduleList=[];
        _oProductionSchedule.ProductionScheduleDetails=oPSDs;
        _oProductionSchedule.CapitalResources=[];
        _oProductionSchedule.LocationList=[];
        $.ajax({
            type: "POST",
            dataType: "json",
            url : _sBaseAddress+  "/ProductionSchedule/SearchByJobNo",
            traditional: true,
            data:  JSON.stringify(_oProductionSchedule),
            contentType: "application/json; charset=utf-8",
            success: function (data)
            {
                //debugger;
                _oProductionSchedule = jQuery.parseJSON(data);
                if (_oProductionSchedule.ErrorMessage=="")
                {
                    if(_oProductionSchedule.ProductionScheduleList.length>0)
                    {
                        _nfirstLoad=0;
                        _JobPerMonths= _oProductionSchedule.JobPerMonths;
                        document.getElementById("divExeFound").style.display='';
                        document.getElementById('lblExeFound').innerHTML=_oProductionSchedule.TotalJobCount;
                        document.getElementById("dateHeader").innerHTML=_oProductionSchedule.ProductionScheduleList[0].StartTimeInPerfect.split(' ')[1]+" "+ _oProductionSchedule.ProductionScheduleList[0].StartTimeInPerfect.split(' ')[2];
                    }
                    TableColumnGeneration();
                    TableGeneration();
                }
                else
                {
                    alert(_oProductionSchedule.ErrorMessage);
                }
            },
            error: function (xhr, status, error)
            {
                alert(error);
            }


        });

    });

    $("#btnOrderFound").click(function(e)
    {
        debugger;
        if (parseInt(_JobPerMonths.length)> 0)
        {
            var tblColums = []; var  oColumn = { field: "MonthOfYear", title: "Month", width: 130, align: "left" }; tblColums.push(oColumn);
            oColumn = { field: "JobCount", title: "Total", width:60, align: "left" }; tblColums.push(oColumn);
            var oPickerParam = {
                winid: 'winJobs',
                winclass: 'clsJob',
                winwidth: 250,
                winheight:350,
                tableid: 'tblJobs',
                tablecolumns: tblColums,
                datalist:_JobPerMonths,
                multiplereturn: false,
                searchingbyfieldName: 'MonthOfYear',
                windowTittle: 'Job List'
            };
            $.icsPicker(oPickerParam);
            $('#btnOk').hide();
        }

    });


    function ChangeOnlaocation()
    {
        $('#tblMachineName').datagrid({selectOnCheck:false, checkOnSelect:false})
        FindMachineName();
    }

    function ChangeOnMachineType()
    {
        FindMachineName();
    }

    function DailyProduction(nMonth,nDate,nYear)
    {
        var Month=['Jan','Feb','Mar','Apr','May','Jun','Jul','Aug','Sep','Oct','Nov','Dec'];
        var currentDate=new Date(nMonth+"/"+ nDate+"/"+ nYear+" "+ 0 +":"+ 0);

        //alert(currentDate);

        document.getElementById("dateHeader").innerHTML= currentDate.getDate()+" "+ Month[currentDate.getMonth()] +" "+ currentDate.getFullYear();
        _oProductionSchedule.sDay= "Day";
        _oProductionSchedule.StartTime= currentDate;
        _bToolbarRefresh=true;
        search();

    }

    function AddNewSchedule(nLocationID,nCRID,nDate,nMonth,nYear,nHour,nMin,nView)
    {
        debugger;
        var Month=['Jan','Feb','Mar','Apr','May','Jun','Jul','Aug','Sep','Oct','Nov','Dec'];
        var sDate=nDate+' '+Month[parseInt(nMonth)-1]+' '+nYear+' '+nHour+':'+nMin;
        var oDate=new Date(sDate);
        if(nLocationID>0 && nCRID>0)
        {
            var nts=(new Date()).getTime()/1000;
            $.ajax({
                type: "Get",
                dataType: "json",
                url: _sBaseAddress + "/ProductionSchedule/GetMachine",
                traditional: true,
                data:  {nMachineID:nCRID, nts:nts},
                contentType: "application/json; charset=utf-8",
                success: function (data) {
                    var oCapitalResource= jQuery.parseJSON(data);
                    if(oCapitalResource.CRID>0)
                    {
                        ViewAddSchedule(oCapitalResource,oDate,nView);
                    }
                    else
                    {
                        alert(oCapitalResource.ErrorMessage);
                    }
                },
                error: function (xhr, status, error) {
                    alert(error);
                }
            });
        }
        else
        {
            alert("Invalid request.");
        }

    }

    function ViewAddSchedule(oDyeMachine,oDate,nView)
    {
        var oParameter=new Object();
        if(nView==1 || nView==2) // Week View && Month View
        {
            var currentDate=new Date();
            currentDate.setMinutes(currentDate.getMinutes()+5);
            var newDate=oDate.getMonth() +"/"+ oDate.getDate()+"/"+ oDate.getFullYear()+" "+currentDate.getHours()+":"+currentDate.getMinutes();
        }
        else if(nView==0) // day view
        {
            var currentDate=new Date();
            var newDate=oDate.getMonth() +"/"+ oDate.getDate()+"/"+ oDate.getFullYear()+" "+currentDate.getHours()+":"+currentDate.getMinutes();
            oParameter.DisableField="Add New Schedule From Day";
        }
        var oProductionSchedule= $('#tblSchedule').datagrid('getSelected');
        sessionStorage.setItem("ProductionSchedules", JSON.stringify([]));
        var SelectedRowIndex=$('#tblSchedule').datagrid('getRowIndex',oProductionSchedule);
        sessionStorage.setItem("SelectedRowIndex", SelectedRowIndex);
        sessionStorage.setItem("ProductionScheduleHeader", "Add New Schedule");
        sessionStorage.setItem("BackLink", window.location.href);
        sessionStorage.setItem("DyeMachine",JSON.stringify(oDyeMachine) );
        sessionStorage.setItem("View", nView);
        window.location.href =_sBaseAddress+ "/ProductionSchedule/ViewProductionSchedule?nPSID=0&nMID="+oDyeMachine.CRID+"&nBUID="+sessionStorage.getItem('BUID');
    }
    function Delete()
    {
        debugger;
        if(_oPSIDs.length<=0){alert("Please select a schedule."); return;}
        else if(_oPSIDs.length>1){alert("Please select only one schedule."); return;}
        if(_oPS!=null && _oPS.ProductionScheduleID==_oPSIDs[0]){alert("Already done."); return;}
        _oPS=null;
        if (!confirm("Confirm to Delete?")) return ;
        var oProductionSchedule = {ProductionScheduleID:_oPSIDs[0]};
        $.ajax({
            type: "POST",
            dataType: "json",
            url: _sBaseAddress + "/ProductionSchedule/Delete",
            traditional: true,
            data:  JSON.stringify(oProductionSchedule),
            contentType: "application/json; charset=utf-8",
            success: function (data) {
                debugger;
                var sMessage= jQuery.parseJSON(data);
                if(sMessage=="Delete successfully")
                {
                    alert("Succefully Deleted.");
                    ToolbarRefresh();
                    _oPSIDs=[];
                }
                else
                {
                    alert(_oPS.ErrorMessage);
                }
            },
            error: function (xhr, status, error) {
                alert(error);
            }
        });

    }


    function Edit()
    {
        debugger;
        if(_oPSIDs.length<=0){alert("Please select a schedule."); return;}
        else if(_oPSIDs.length>1){alert("Please select only one schedule."); return;}
        if(_oPS!=null && _oPS.ProductionScheduleID==_oPSIDs[0]){alert("Already done."); return;}
        _oPS=null;
        var oProductionSchedule = {ProductionScheduleID:_oPSIDs[0]};
        var oSelectedSchedule= $('#tblSchedule').datagrid('getSelected');
        var SelectedRowIndex=$('#tblSchedule').datagrid('getRowIndex',oSelectedSchedule);
        sessionStorage.setItem("ProductionSchedules", JSON.stringify(oProductionSchedule));
        sessionStorage.setItem("SelectedRowIndex", SelectedRowIndex);
        sessionStorage.setItem("ProductionScheduleHeader", "Edit Production Schedule");
        sessionStorage.setItem("BackLink", window.location.href);
        window.location.href = _sBaseAddress+ "/ProductionSchedule/ViewEditProductionSchedule?id="+oProductionSchedule.ProductionScheduleID+"&nBUID="+sessionStorage.getItem('BUID');
    }

    function View(nProductionScheduleID)
    {
        var oSelectedSchedule= $('#tblSchedule').datagrid('getSelected');
        var SelectedRowIndex=$('#tblSchedule').datagrid('getRowIndex',oSelectedSchedule);
        var oProductionSchedule = {ProductionScheduleID:nProductionScheduleID};
        sessionStorage.setItem("ProductionSchedule", JSON.stringify(oProductionSchedule));
        sessionStorage.setItem("SelectedRowIndex", SelectedRowIndex);
        sessionStorage.setItem("ProductionScheduleHeader", "Schedule Information");
        sessionStorage.setItem("BackLinkForPSView", window.location.href);
        sessionStorage.setItem("ModifiedValue", "Not Modified");
        sessionStorage.setItem("sMonth", "Month");
        window.location.href = _sBaseAddress+ "/ProductionSchedule/ViewScheduleInformation?id="+nProductionScheduleID;

    }

    function setDateTime(startDate)
    {
        var nYear=startDate.getFullYear();
        var nMonth=startDate.getMonth();
        var nDate=startDate.getDate();
        var nHour=startDate.getHours();
        var nMin=startDate.getMinutes();
        //        if(nMonth<10 )
        //        {
        //           nMonth="0"+nMonth;
        //        }
        if(nDate<10)
        {
            nDate="0"+nDate;
        }
        if(nHour<10)
        {
            nHour="0"+nHour;
        }
        if(nMin<10)
        {
            nMin="0"+nMin;
        }

        // var intervalMin=Number(nMin)+14;

        //var sDateTime= nMonth+"/"+nDate+"/"+nYear+" "+nHour+":"+nMin+" - "+nHour+":"+intervalMin;
        //var mthNames = ["Jan", "Feb", "Mar", "Apr", "May", "Jun", "Jul", "Aug", "Sep", "Oct", "Nov", "Dec"];
        //var sDateTime= nDate+"/"+mthNames[Number(nMonth)]+"/"+nYear+" "+nHour+":"+nMin;

        var sDateTime= nHour+":"+nMin;
        return sDateTime;
    }

    function Next()
    {
        var Month=['Jan','Feb','Mar','Apr','May','Jun','Jul','Aug','Sep','Oct','Nov','Dec'];
        var dateString=document.getElementById("dateHeader").innerHTML;

        var returnValue=dateChange();

        var nDate= new Date(returnValue[0]);
        var cSpace= returnValue[1];
        var sDateView=returnValue[2];


        if( sDateView=="viewAsDateMonth")
        {
            if(Number(cSpace)==1)
            {
                _nfirstLoad=0;
                nDate.setMonth(Number(nDate.getMonth())+1);
                document.getElementById("dateHeader").innerHTML= Month[nDate.getMonth()] +" "+ nDate.getFullYear();
                _oProductionSchedule.sMonth="Month";
                _oProductionSchedule.StartTime= nDate;
                // search();

            }
            else if(Number(cSpace)==2)
            {
                nDate.setDate(Number(nDate.getDate())+1);
                document.getElementById("dateHeader").innerHTML= nDate.getDate()+" "+ Month[nDate.getMonth()] +" "+ nDate.getFullYear();
                _oProductionSchedule.sDay= "Day";
                _oProductionSchedule.StartTime= nDate;
                // search();
            }
        }

        else if(sDateView=="viewAsWeek")
        {
            var tempDate=new Date(returnValue[0]);
            nDate.setDate(nDate.getDate()+7);

            if(nDate.getFullYear()==tempDate.getFullYear())
            {
                document.getElementById("dateHeader").innerHTML= (tempDate.getDate()+1)+" "+ Month[tempDate.getMonth()] +" - "+ nDate.getDate() +" "+ Month[nDate.getMonth()] +" "+ nDate.getFullYear();
            }
            else
            {
                //alert(tempDate.getDate()+1);
                tempDate.setDate(tempDate.getDate()+1);
                document.getElementById("dateHeader").innerHTML= (tempDate.getDate())+" "+ Month[tempDate.getMonth()] +" "+ tempDate.getFullYear()+" "+"-"+" "+ nDate.getDate() +" "+ Month[nDate.getMonth()] +" "+ nDate.getFullYear();
            }

            _oProductionSchedule.sWeek= "Week";
            _oProductionSchedule.StartTime= tempDate;
            //search();
        }




    }

    function Prevoius()
    {
        var Month=['Jan','Feb','Mar','Apr','May','Jun','Jul','Aug','Sep','Oct','Nov','Dec'];
        var dateString=document.getElementById("dateHeader").innerHTML;

        var returnValue=dateChange();
        var nDate= new Date(returnValue[0]);
        var cSpace= returnValue[1];
        var sDateView=returnValue[2];

        if( sDateView=="viewAsDateMonth")
        {
            if(Number(cSpace)==1)
            {
                _nfirstLoad=0;
                nDate.setMonth(Number(nDate.getMonth())-1);
                document.getElementById("dateHeader").innerHTML= Month[nDate.getMonth()] +" "+ nDate.getFullYear();
                _oProductionSchedule.sMonth="Month";
                _oProductionSchedule.StartTime= nDate;
                // search();

            }
            if(Number(cSpace)==2)
            {
                nDate.setDate(Number(nDate.getDate())-1);
                document.getElementById("dateHeader").innerHTML= nDate.getDate()+" "+ Month[nDate.getMonth()] +" "+ nDate.getFullYear();
                _oProductionSchedule.sDay= "Day";
                _oProductionSchedule.StartTime= nDate;
                //search();
            }
        }
        else if(sDateView=="viewAsWeek")
        {
            var tempDate=new Date(returnValue[0]);

            tempDate.setDate(Number(tempDate.getDate())-13);
            nDate.setDate(Number(nDate.getDate())-7);
            if(nDate.getFullYear()==tempDate.getFullYear())
            {
                document.getElementById("dateHeader").innerHTML= tempDate.getDate()+" "+ Month[tempDate.getMonth()] +" - "+nDate.getDate() +" "+ Month[nDate.getMonth()] +" "+ nDate.getFullYear();
            }
            else
            {
                document.getElementById("dateHeader").innerHTML= tempDate.getDate()+" "+ Month[tempDate.getMonth()] +" "+ tempDate.getFullYear()+" - "+ nDate.getDate() +" "+ Month[nDate.getMonth()] +" "+ nDate.getFullYear();
            }

            _oProductionSchedule.sWeek= "Week";
            _oProductionSchedule.StartTime= tempDate;
            //search();
        }

    }


    function dateChange()
    {

        debugger;
        var Month=['Jan','Feb','Mar','Apr','May','Jun','Jul','Aug','Sep','Oct','Nov','Dec'];
        var dateString=document.getElementById("dateHeader").innerHTML;
        var flag=0;
        var countSpace=0;
        var tempDate="";
        var sMonth="";
        var temp=0;
        var dateFormat="";
        var sDateView="";
        var sStartDate="";
        for(var i=0; i<dateString.length;i++)
        {
            if(dateString[i]=='-')
            {
                flag=1;
                i=dateString.length;
            }
        }

        if(flag==0)
        {

            for(var i=0; i<dateString.length;i++)
            {
                nflagWeekValue=0;
                if(dateString[i]!=" ")
                {
                    if(isNaN(dateString[i]))
                    {
                        sMonth += dateString[i];
                        if(dateString[Number(i)+1]==" ")
                        {
                            for(var j=0;j<Month.length;j++)
                            {
                                if(Month[j]==sMonth)
                                {
                                    temp=Number(j)+1;
                                    j=Month.length;
                                }
                            }
                        }

                    }

                    else
                    {
                        tempDate +=dateString[i];
                    }

                }
                if(dateString[i] ==" ")
                {
                    countSpace=Number(countSpace)+1;
                    tempDate +="/";
                }

            }

            if(tempDate.length>5)
            {
                dateFormat=temp+"/"+tempDate;
            }
            else
            {
                dateFormat=temp+"/"+"1"+"/"+tempDate;
            }

            sDateView="viewAsDateMonth";

        }

        else if(flag==1)
        {
            nflagWeekValue=1;
            var i=0;
            while(dateString[i]!='-')
            {
                sStartDate=sStartDate+dateString[i];
                i++;
            }
            debugger;
            sStartDate=$.trim(sStartDate.split('-')[0]);
            i++;
            for(var j=i; i<dateString.length;i++)
            {

                if(dateString[i]!=" ")
                {
                    if(isNaN(dateString[i]))
                    {
                        sMonth += dateString[i];
                        if(dateString[Number(i)+1]==" ")
                        {
                            for(var j=0;j<Month.length;j++)
                            {
                                if(Month[j]==sMonth)
                                {
                                    temp=Number(j)+1;
                                    j=Month.length;
                                }
                            }
                        }

                    }

                    else
                    {
                        tempDate +=dateString[i];
                    }

                }
                if(dateString[i] ==" ")
                {
                    countSpace=Number(countSpace)+1;
                    tempDate +="/";
                }

            }

            if(tempDate.length>5)
            {
                dateFormat=temp+"/"+tempDate;
            }
            else
            {
                dateFormat=temp+"/"+"1"+"/"+tempDate;
            }
            debugger;
            if(sStartDate.length<=6)
            {
                var oDate=new Date(dateFormat);
                sStartDate=sStartDate+' '+oDate.getFullYear();
            }
            sStartDate=new Date(sStartDate);
            sDateView="viewAsWeek";

        }


        var newDate=new Date(dateFormat);
        if($.trim(sStartDate)=='')
        {
            sStartDate=newDate;
        }
        return [newDate, countSpace,sDateView,sStartDate];
    }


    function TodayView()
    {

        var currentDate=new Date();

        var Month=['Jan','Feb','Mar','Apr','May','Jun','Jul','Aug','Sep','Oct','Nov','Dec'];
        document.getElementById("dateHeader").innerHTML= currentDate.getDate()+" "+ Month[currentDate.getMonth()] +" "+ currentDate.getFullYear();
        _oProductionSchedule.sDay= "Day";
        _oProductionSchedule.sPrintView="viewAsDateMonth";
        _oProductionSchedule.StartTime= currentDate;
        _bToolbarRefresh=true;
        search();
        _oPSIDs=[];
        _oCRIDs=[];
    }


    function DayView()
    {

        var returnValue=dateChange();
        var nDate=new Date(returnValue[0]);
        if(nflagWeekValue==1)
        {
            nDate.setDate(nDate.getDate()-6);
        }

        var Month=['Jan','Feb','Mar','Apr','May','Jun','Jul','Aug','Sep','Oct','Nov','Dec'];
        document.getElementById("dateHeader").innerHTML= nDate.getDate()+" "+ Month[nDate.getMonth()] +" "+ nDate.getFullYear();
        _oProductionSchedule.sDay= "Day";
        _oProductionSchedule.sPrintView="viewAsDateMonth";
        _oProductionSchedule.StartTime= nDate;
        _bToolbarRefresh=true;
        search();
        _oPSIDs=[];
        _oCRIDs=[];

    }

    function MonthView()
    {
        var returnValue=dateChange();
        var nDate=new Date(returnValue[0]);

        var Month=['Jan','Feb','Mar','Apr','May','Jun','Jul','Aug','Sep','Oct','Nov','Dec'];
        document.getElementById("dateHeader").innerHTML=Month[nDate.getMonth()] +" "+ nDate.getFullYear();
        _oProductionSchedule.sMonth= "Month";
        _oProductionSchedule.sPrintView="viewAsDateMonth";
        _oProductionSchedule.StartTime= nDate;
        _bToolbarRefresh=true;
        search();
        _oPSIDs=[];
        _oCRIDs=[];
    }

    function WeekView()
    {

        var Month=['Jan','Feb','Mar','Apr','May','Jun','Jul','Aug','Sep','Oct','Nov','Dec'];

        var returnValue=dateChange();

        var tempDate=new Date(returnValue[0]);
        var nDate=new Date(returnValue[0]);
        //  if(_nWeek==0)
        {
            nDate.setDate(nDate.getDate()+6);
            _nWeek=1;
        }
        //    else
        //    {
        //      //nDate.setDate(nDate.getDate()-6);
        //       tempDate.setDate(tempDate.getDate()-6);
        //    }

        if(nDate.getFullYear()==tempDate.getFullYear())
        {
            document.getElementById("dateHeader").innerHTML= tempDate.getDate()+" "+ Month[tempDate.getMonth()]+" "+"-"+" "+ nDate.getDate() +" "+ Month[nDate.getMonth()] +" "+ nDate.getFullYear();
        }
        else
        {
            document.getElementById("dateHeader").innerHTML= tempDate.getDate()+" "+ Month[tempDate.getMonth()] +" "+ tempDate.getFullYear()+" "+"-"+" "+ nDate.getDate() +" "+ Month[nDate.getMonth()] +" "+ nDate.getFullYear();
        }

        _oProductionSchedule.sWeek= "Week";
        _oProductionSchedule.sPrintView="viewAsWeek";
        _oProductionSchedule.StartTime= tempDate;
        _bToolbarRefresh=true;
        search();
        _oPSIDs=[];
        _oCRIDs=[];
    }


    function ToolbarRefresh()
    {
        debugger;
        var returnValue=dateChange();
        var nDate= new Date(returnValue[0]);
        var cSpace= returnValue[1];
        var sDateView=returnValue[2];
        if(sDateView=="viewAsDateMonth")
        {
            if(Number(cSpace)==1)
            {
                _oProductionSchedule.sMonth="Month";
            }
            else if(Number(cSpace)==2)
            {
                _oProductionSchedule.sDay= "Day";
            }
            _oProductionSchedule.StartTime=nDate;

        }
        else if(sDateView=="viewAsWeek")
        {
            _oProductionSchedule.sWeek= "Week";
            _oProductionSchedule.StartTime=new Date(nDate.setDate(nDate.getDate()-6));

        }
        _bToolbarRefresh=true;
        search();
        _oPSIDs=[];
        _oCRIDs=[];
    }

    function Refresh()
    {
        debugger;
        if($("#cboDateSelection").val()=="None")
        {
            alert("Select searching date type from schedule date.");
            document.getElementById('cboDateSelection').focus();
            return;
        }
        document.getElementById("divExeFound").style.display='none';
        var Month=['Jan','Feb','Mar','Apr','May','Jun','Jul','Aug','Sep','Oct','Nov','Dec'];

        var oStartDate=new Date($('#txtStartDate').datebox('getValue'));
        var oEndDate=new Date($('#txtEndDate').datebox('getValue'));
        _oProductionSchedule.StartTime= oStartDate;
        _oProductionSchedule.EndTime= oEndDate;
        _oProductionSchedule.sDay= "Day";
        _oProductionSchedule.sPrintView="viewAsDateMonth";
        _bToolbarRefresh=false;
        search();
        if($("#cboDateSelection").val()=="Equal")
        {
            document.getElementById("dateHeader").innerHTML= oStartDate.getDate()+" "+ Month[oStartDate.getMonth()] +" "+ oStartDate.getFullYear();
        }
        else if($("#cboDateSelection").val()=="Between")
        {
            if(oStartDate.getFullYear() != oEndDate.getFullYear())
            {
                document.getElementById("dateHeader").innerHTML= oStartDate.getDate()+" "+ Month[oStartDate.getMonth()] +" "+ oStartDate.getFullYear() +' - '+ oEndDate.getDate()+" "+ Month[oEndDate.getMonth()] +" "+ oEndDate.getFullYear() ;
            }
            else
            {
                document.getElementById("dateHeader").innerHTML= oStartDate.getDate()+" "+ Month[oStartDate.getMonth()] +' - '+ oEndDate.getDate()+" "+ Month[oEndDate.getMonth()] +" "+ oEndDate.getFullYear()  ;
            }

        }
        _oPSIDs=[];
        _oCRIDs=[];
    }

    function search()
    {
        debugger;
        var oPSDs=[];
        var sOrderNo= $('#txtOrderNo').val();
        if(isNaN(sOrderNo)==true && sOrderNo!="No")
        {
            alert("Please enter valid no.");
            return;
        }
        var oPSD=
        {
            OrderNo: sOrderNo
        };
        oPSDs.push(oPSD);
        var nLocationID= document.getElementById("cboLocation").value;
        var oMachines=$('#tblMachineName').datagrid('getChecked');
        if(oMachines.length>0)
        {
            _oSelectedDyeMachine=[];
            var CRIDs="";
            for(var i=0;i<oMachines.length;i++)
            {
                _oSelectedDyeMachine.push(oMachines[i]);
                CRIDs=CRIDs + oMachines[i].CRID+",";
            }
            CRIDs=CRIDs.substring(0,CRIDs.length-1);
        }

        else
        {
            FindMachineName();
        }

        _oProductionSchedule.MachineIDs=CRIDs;
        _oProductionSchedule.LocationID=nLocationID;
        _oProductionSchedule.BUID = sessionStorage.getItem('BUID');
        _oProductionSchedule.ProductionScheduleList=[];
        _oProductionSchedule.ProductionScheduleDetails=[];
        _oProductionSchedule.ProductionScheduleDetails=oPSDs;
        _oProductionSchedule.CapitalResources=[];
        _oProductionSchedule.LocationList=[];

        var bValue=true;
        if(document.getElementById('chkboxUptoUnloadDyeMachine').checked==true)
        {
            bValue=false;
        }

        document.getElementById("divContentWest").style.opacity=0.4;
        document.getElementById("divContentCenter").style.opacity=0.4;
        document.getElementById("divAjaxLoader").style.display='';

        var sScheduleDateType = "";
        if(_bToolbarRefresh==false)
        {
            sScheduleDateType = $("#cboDateSelection").val()
        }
        $.ajax({
            type: "POST",
            dataType: "json",
            url : _sBaseAddress+  "/ProductionSchedule/RefreshMachineWise",
            traditional: true,
            data:  JSON.stringify({oProductionSchedule: _oProductionSchedule, bUptoLoadDyeMachine:bValue, sScheduleDateType:sScheduleDateType}),
            contentType: "application/json; charset=utf-8",
            success: function (data)
            {
                debugger;
                oMPS = jQuery.parseJSON(data);
                if(_oProductionSchedule.sDay=="Day")
                {
                    _oProductionSchedule.sDay="";
                    _oProductionSchedule.sWeek="";
                    _oProductionSchedule.sMonth="";
                    SetUpdateNumberOfAssingScheduleOnMachine(oMPS.CapitalResources);
                    LoadIntoGrid(oMPS.MachineWiseProductionSchedules);

                }
                else if(_oProductionSchedule.sWeek=="Week")
                {
                    _oProductionSchedule.sDay="";
                    _oProductionSchedule.sWeek="";
                    _oProductionSchedule.sMonth="";
                    SetUpdateNumberOfAssingScheduleOnMachine(oMPS.CapitalResources);
                    LoadIntoGrid(oMPS.MachineWiseProductionSchedules);
                }
                else
                {
                    //TableGeneration();
                    SetUpdateNumberOfAssingScheduleOnMachine(oMPS.CapitalResources);
                    LoadIntoGrid(oMPS.MachineWiseProductionSchedules);
                }
                document.getElementById("divContentWest").style.opacity=1;
                document.getElementById("divContentCenter").style.opacity=1;
                document.getElementById("divAjaxLoader").style.display='none';

            },
            error: function (xhr, status, error)
            {
                alert(error);
            }


        });
    }


    function SetUpdateNumberOfAssingScheduleOnMachine(oDyeMachines)
    {
        debugger;
        var oTempSelectedMachines=[];
        for(var i=0; i<oDyeMachines.length;i++)
        {
            for(var j=0; j<_oSelectedDyeMachine.length;j++)
            {
                if(oDyeMachines[i].CRID==_oSelectedDyeMachine[j].CRID)
                {
                    oTempSelectedMachines.push(oDyeMachines[i]);
                }
            }
        }
        _oSelectedDyeMachine=oTempSelectedMachines;
        MakeTable(_oSelectedDyeMachine);

    }


    function print()
    {
        debugger;
        var returnValue=dateChange();
        var oEndTime = new Date(returnValue[0]);
        var oStartTime= new Date(returnValue[3]);
        var Month=['Jan','Feb','Mar','Apr','May','Jun','Jul','Aug','Sep','Oct','Nov','Dec'];
        var sStartTime=Month[oStartTime.getMonth()]+" "+ oStartTime.getDate() +" "+ oStartTime.getFullYear()+" "+0+":"+0;
        var sEndTime=Month[oEndTime.getMonth()]+" "+ oEndTime.getDate() +" "+ oEndTime.getFullYear()+" "+0+":"+0;
        var cSpace= returnValue[1];
        var sPrintView= returnValue[2];
        var CRIDs="";
        var ProductionScheduleIDs="";
        var nLocationID= document.getElementById("cboLocation").value;
        var oMachines=$('#tblMachineName').datagrid('getChecked');

        var bValue=true;
        if(document.getElementById('chkboxUptoUnloadDyeMachine').checked==true)
        {
            bValue=false;
        }

        if(_oPSIDs.length>0 && _oCRIDs.length>0)
        {
            bValue=false;
            for(var i=0; i<_oPSIDs.length;i++)
            {
                ProductionScheduleIDs=ProductionScheduleIDs+_oPSIDs[i]+",";
            }
            ProductionScheduleIDs=ProductionScheduleIDs.substring(0,ProductionScheduleIDs.length-1);
            var oTempArr=[];
            oTempArr.push(_oCRIDs[0]);
            CRIDs=_oCRIDs[0] +',';
            if(_oCRIDs.length>1)
            {
                for(var i=1; i<_oCRIDs.length;i++)
                {
                    for(var j=0; j<oTempArr.length;j++)
                    {
                        if(oTempArr[j]!=_oCRIDs[i] )
                        {

                            oTempArr.push(_oCRIDs[i]);
                            CRIDs=CRIDs+ _oCRIDs[i] +',';
                            break;
                        }
                        else
                        {
                            break;
                        }
                    }
                }
            }
            CRIDs=CRIDs.substring(0,CRIDs.length-1);

        }
        else
        {
            if(oMachines.length>0)
            {
                _oSelectedDyeMachine=[];
                for(var i=0;i<oMachines.length;i++)
                {
                    _oSelectedDyeMachine.push(oMachines[i]);
                    CRIDs=CRIDs + oMachines[i].CRID+",";
                }
                CRIDs=CRIDs.substring(0,CRIDs.length-1);
            }
            else
            {
                for(var i=0;i<_oSelectedDyeMachine.length;i++)
                {
                    CRIDs=CRIDs + _oSelectedDyeMachine[i].CRID+",";
                }
                CRIDs=CRIDs.substring(0,CRIDs.length-1);
            }
        }
        var psof=document.getElementById("dateHeader").innerHTML;
        var newstring=cSpace+'~'+sStartTime+'~'+sEndTime+'~'+nLocationID+'~'+CRIDs+'~'+psof+'~'+sPrintView+'~'+ProductionScheduleIDs+'~'+bValue+'~'+sessionStorage.getItem('BUID');
        $("#divPS").data("PrintParam",newstring);
        document.getElementById('chkLandScape').checked=true;
        document.getElementById('chkPortrait').checked=false;
        $("#winPrintTypeSelector").icsWindow('open', "Print Format");
    }

    $('#chkPortrait').change(function(e)
    {
        $("#divPS").data("PrintType","");
        if(document.getElementById('chkPortrait').checked==true)
        {
            document.getElementById('chkLandScape').checked=false;
            $("#divPS").data("PrintType","Portrait");
        }
        else
        {
            document.getElementById('chkPortrait').checked=false;
            document.getElementById('chkLandScape').checked=true;
            $("#divPS").data("PrintType","Landscape");
        }
    });

    $('#chkLandScape').change(function(e)
    {
        $("#divPS").data("PrintType","");
        if(document.getElementById('chkLandScape').checked==true)
        {
            document.getElementById('chkPortrait').checked=false;
            $("#divPS").data("PrintType","Landscape");
        }
        else
        {
            document.getElementById('chkLandScape').checked=false;
            document.getElementById('chkPortrait').checked=true;
            $("#divPS").data("PrintType","Portrait");
        }
    });
    function ClosePrintType()
    {
        $("#divPS").data("PrintType","");
        $("#divPS").data("PrintParam","");
        $("#winPrintTypeSelector").icsWindow('close');
    }
    function OkPrintTypeButtonClick()
    {
        if($("#divPS").data("PrintType")=="" || $("#divPS").data("PrintParam")=="")
        {
            alert("Select Page Type.");
            return;
        }
        $("#winPrintTypeSelector").icsWindow('close');
        var bPortrait = false;
        if($("#divPS").data("PrintType")=='Landscape'){ bPortrait=false;}else{ bPortrait=true;}
        window.open(_sBaseAddress + '/ProductionSchedule/PrintProductionSchedule?newstring='+$("#divPS").data("PrintParam")+'&bPortrait='+bPortrait, '_blank'); // Print in Portrait
    }


    function CheckBoxSelectionForPrint(nProductionScheduleID, nCRID)
    {
        debugger;
        //   _sProductionScheduleIDS=_sProductionScheduleID+nProductionScheduleID+',';
        //   _sCRIDS=_sCRIDS+nCRID+','
        if(document.getElementById(""+nProductionScheduleID+"").checked==true)
        {
            _oPSIDs.push(nProductionScheduleID);
            _oCRIDs.push(nCRID);
        }
        if(document.getElementById(""+nProductionScheduleID+"").checked==false)
        {
            var otempPSIDs=[];
            var otempCRIDs=[];
            if(_oPSIDs.length>0)
            {
                for(var i=0; i<_oPSIDs.length;i++)
                {
                    if(_oPSIDs[i]!=nProductionScheduleID)
                    {
                        otempPSIDs.push(_oPSIDs[i])
                    }

                }
            }

            if(_oCRIDs.length>0)
            {
                var bflag=false;
                for(var i=0; i<_oCRIDs.length;i++)
                {
                    if(bflag==false && _oCRIDs[i]!=nCRID )
                    {
                        otempCRIDs.push(_oCRIDs[i]);

                    }
                    else if(bflag==false && _oCRIDs[i]==nCRID)
                    {
                        bflag=true;
                    }
                    else if(bflag==true)
                    {
                        otempCRIDs.push(_oCRIDs[i]);
                    }

                }
            }

            _oPSIDs=otempPSIDs;
            _oCRIDs=otempCRIDs;
        }

    }

    function RefreshForUnloadDyemachine()
    {
        ToolbarRefresh();
    }

    $('#btnInComplete').click(function(e)
    {
        debugger;

        var nLocationID= document.getElementById("cboLocation").value;
        var oMachines=$('#tblMachineName').datagrid('getChecked');
        var sViewType="";
        var CRIDs="";
        if(oMachines.length>0)
        {
            _oSelectedDyeMachine=[];
            for(var i=0;i<oMachines.length;i++)
            {
                _oSelectedDyeMachine.push(oMachines[i]);
                CRIDs=CRIDs + oMachines[i].CRID+",";
            }
            CRIDs=CRIDs.substring(0,CRIDs.length-1);
        }
        else
        {
            FindMachineName();
        }
        if(_oProductionSchedule.sDay=="Day"){sViewType="Day";}
        else if(_oProductionSchedule.sWeek=="Week"){sViewType="Week";}
        else{sViewType="Month";}

        $.ajax({
            type: "POST",
            dataType: "json",
            url : _sBaseAddress+  "/ProductionSchedule/GetsInCompleteSchedule",
            traditional: true,
            data:  JSON.stringify({sMachineIDs:CRIDs, nLocationID:nLocationID, nBUID:sessionStorage.getItem('BUID'), sViewType:sViewType}),
            contentType: "application/json; charset=utf-8",
            success: function (data)
            {
                debugger;
                oMPS = jQuery.parseJSON(data);
                if(_oProductionSchedule.sDay=="Day")
                {
                    _oProductionSchedule.sDay="";
                    _oProductionSchedule.sWeek="";
                    _oProductionSchedule.sMonth="";
                    SetToolbarDate(new Date(oMPS.StartTimeInString),new Date(oMPS.EndTimeInString));
                    SetUpdateNumberOfAssingScheduleOnMachine(oMPS.CapitalResources);
                    LoadIntoGrid(oMPS.MachineWiseProductionSchedules);

                }
                else if(_oProductionSchedule.sWeek=="Week")
                {
                    _oProductionSchedule.sDay="";
                    _oProductionSchedule.sWeek="";
                    _oProductionSchedule.sMonth="";
                    SetToolbarDate(new Date(oMPS.StartTimeInString),new Date(oMPS.EndTimeInString));
                    SetUpdateNumberOfAssingScheduleOnMachine(oMPS.CapitalResources);
                    LoadIntoGrid(oMPS.MachineWiseProductionSchedules);
                }
                else
                {
                    //TableGeneration();
                    SetToolbarDate(new Date(oMPS.StartTimeInString),new Date(oMPS.EndTimeInString));
                    SetUpdateNumberOfAssingScheduleOnMachine(oMPS.CapitalResources);
                    LoadIntoGrid(oMPS.MachineWiseProductionSchedules);
                }
                document.getElementById("divContentWest").style.opacity=1;
                document.getElementById("divContentCenter").style.opacity=1;
                document.getElementById("divAjaxLoader").style.display='none';

            },
            error: function (xhr, status, error)
            {
                alert(error);
            }


        });
    });

    function SetToolbarDate(oStartDate,oEndDate)
    {
        debugger;
        var Month=['Jan','Feb','Mar','Apr','May','Jun','Jul','Aug','Sep','Oct','Nov','Dec'];
        if(oStartDate.getDate() == oEndDate.getDate() && oStartDate.getMonth() == oEndDate.getMonth() && oStartDate.getFullYear() == oEndDate.getFullYear())
        {
            document.getElementById("dateHeader").innerHTML= oStartDate.getDate()+" "+ Month[oStartDate.getMonth()] +" "+ oStartDate.getFullYear()  ;
        }
        else
        {
            if(oStartDate.getFullYear() != oEndDate.getFullYear())
            {
                document.getElementById("dateHeader").innerHTML= oStartDate.getDate()+" "+ Month[oStartDate.getMonth()] +" "+ oStartDate.getFullYear() +' - '+ oEndDate.getDate()+" "+ Month[oEndDate.getMonth()] +" "+ oEndDate.getFullYear() ;
            }
            else
            {
                document.getElementById("dateHeader").innerHTML= oStartDate.getDate()+" "+ Month[oStartDate.getMonth()] +' - '+ oEndDate.getDate()+" "+ Month[oEndDate.getMonth()] +" "+ oEndDate.getFullYear()  ;
            }
        }
    }

    function ScheduleCut(nLocationID,nCRID,nDate,nMonth,nYear,nHour,nMin,nView)
    {
        debugger;
        if(!_bCut){ _bCut=false; _bCopy=false; _oPS=null;  }
        if(_oPSIDs.length<=0){alert("Please select a schedule."); return;}
        else if(_oPSIDs.length>1){alert("Please select only one schedule."); return;}
        if(nCRID!=_oCRIDs[0]){alert("Please cut from you selected region."); return;}
        if(_oPS!=null && _oPS.ProductionScheduleID==_oPSIDs[0]){alert("Already done."); return;}
        _oPS=null;
        var nts=(new Date()).getTime()/1000;
        $.ajax({
            type: "Get",
            dataType: "json",
            url: _sBaseAddress + "/ProductionSchedule/GetProductionSchedule",
            traditional: true,
            data:  {nID : _oPSIDs[0], nts:nts},
            contentType: "application/json; charset=utf-8",
            success: function (data) {

                _oPS= jQuery.parseJSON(data);
                if(_oPS.ProductionScheduleID<0)
                {
                    alert(_oPS.ErrorMessage);
                }
                else
                {
                    _bUndoCutPaste=true;
                    _bUndoSwap=false;
                    _sUndoSwapPSIDs='';
                    _oOldPS=_oPS;
                    _oUndoPaste=
                    {
                        LocationID : nLocationID,
                        CRID : nCRID,
                        Date : nDate,
                        Month : nMonth,
                        Year : nYear,
                        Hour : nHour,
                        nMin : nMin,
                    };
                    var oPSDs=_oPS.ProductionScheduleDetails;
                    for(var i=0; i<oPSDs.length;i++)
                    {
                        if(oPSDs[i].RSState>=6)
                        {
                            if(oPSDs.length>1)
                            {
                                alert("Unable to modify. Because one of it's dyeline state is in "+oPSDs[i].RSStateInString);
                            }
                            else
                            {
                                alert("Unable to modify. Because it's dyeline state is in "+oPSDs[i].RSStateInString);
                            }
                            document.getElementById(""+_oPSIDs[0]+"").checked=false;
                            _oPSIDs=[];
                            _oCRIDs=[];
                            _oPS=null;
                            break;
                        }
                    }
                    _bCut=true;
                }
            },
            error: function (xhr, status, error) {
                alert(error);
            }
        });

    }

    function ScheduleCopy(nLocationID,nCRID,nDate,nMonth,nYear,nHour,nMin,nView)
    {
        if(!_bCopy){_bCut=false; _bCopy=false; _oPS=null;}
        if(_oPSIDs.length<=0){alert("Please select a schedule."); return;}
        else if(_oPSIDs.length>1){alert("Please select only one schedule."); return;}
        if(nCRID!=_oCRIDs[0]){alert("Please copy from you selected region."); return;}
        if(_oPS!=null && _oPS.ProductionScheduleID==_oPSIDs[0]){alert("Already done."); return;}
        _oPS=null;  _bCopy=true;
        var nts=(new Date()).getTime()/1000;
        $.ajax({
            type: "Get",
            dataType: "json",
            url: _sBaseAddress + "/ProductionSchedule/GetProductionSchedule",
            traditional: true,
            data:  {nID : _oPSIDs[0], nts:nts},
            contentType: "application/json; charset=utf-8",
            success: function (data) {

                _oPS= jQuery.parseJSON(data);
                if(_oPS.ProductionScheduleID<0)
                {
                    alert(_oPS.ErrorMessage);
                }
                else
                {
                    _bUndoCutPaste=false; _bRedoCutPaste=false;
                    _bUndoSwap=false; _bRedoSwap=false;
                    _sUndoSwapPSIDs='';
                    _oUndoPaste=[]; _oRedoPaste=[];
                    _bCopy=true;
                }
            },
            error: function (xhr, status, error) {
                alert(error);
            }
        });

    }

    function RefreshObjectForPaste(nLocationID,nCRID,nDate,nMonth,nYear,nHour,nMin)
    {
        var Month=['Jan','Feb','Mar','Apr','May','Jun','Jul','Aug','Sep','Oct','Nov','Dec'];
        var nTempStartHourMinute=_oPS.StartTimeInPerfect.split(" ")[3];
        var nTempMinute=_oPS.EndTimeInPerfect.split(":")[1];
        var sStartTime=nDate+' '+Month[parseInt(nMonth)-1]+' '+nYear+' '+nTempStartHourMinute;
        var sEndTime=nDate+' '+Month[parseInt(nMonth)-1]+' '+nYear+' '+'00:' +nTempMinute;
        var oStartTime=new Date(sStartTime);
        var oEndTime=new Date(sEndTime);
        oEndTime= new Date(oEndTime.setHours( oStartTime.getHours() +_oPS.TimeDiffInHours));
        oEndTime= new Date(oEndTime.setMinutes( oEndTime.getMinutes() +1));

        _oPS.LocationID=nLocationID;
        _oPS.MachineID=nCRID;
        _oPS.StartTime=oStartTime;
        _oPS.EndTime=oEndTime;
        return _oPS;

    }

    function SchedulePaste(nLocationID,nCRID,nDate,nMonth,nYear,nHour,nMin,nView)
    {
        debugger;
        if(_oPS==null){alert("Nothing found for paste."); return;}
        var oProductionSchedule=RefreshObjectForPaste(nLocationID,nCRID,nDate,nMonth,nYear,nHour,nMin);
        var nts=(new Date()).getTime()/1000;
        if(_bCopy)
        {

            $.ajax({
                type: "POST",
                dataType: "json",
                url: _sBaseAddress + "/ProductionSchedule/ScheduleInTimePeriod",
                data: JSON.stringify({oProductionSchedule:oProductionSchedule, nts: nts}),
                contentType: "application/json; charset=utf-8",
                success: function(data)
                {
                    //debugger;
                    nCount = jQuery.parseJSON(data);
                    if (nCount>0)
                    {
                        if(confirm("Are you sure to increase time from next all schedules."))
                        {
                            oProductionSchedule.bIncreaseTime=true;
                            CreateCopyProductionSchedule(oProductionSchedule);
                        }
                    }
                    else if(nCount==0)
                    {
                        oProductionSchedule.bIncreaseTime=false;
                        CreateCopyProductionSchedule(oProductionSchedule);
                    }

                },
                error: function(xhr, status, error)
                {
                    alert(error);
                }
            });
        }
        else if(_bCut)
        {
            _oRedoPaste=
            {
                LocationID : nLocationID,
                CRID : nCRID,
                Date : nDate,
                Month : nMonth,
                Year : nYear,
                Hour : nHour,
                nMin : nMin,
            };
            $.ajax({
                type: "POST",
                dataType: "json",
                url: _sBaseAddress + "/ProductionSchedule/ScheduleInTimePeriod",
                data: JSON.stringify({oProductionSchedule:oProductionSchedule, nts: nts}),
                contentType: "application/json; charset=utf-8",
                success: function(data)
                {
                    //debugger;
                    nCount = jQuery.parseJSON(data);
                    if (nCount>0)
                    {
                        if(confirm("Are you sure to increase time from next all schedules."))
                        {
                            _oUndoPaste.bIncreaseTime=true;
                            oProductionSchedule.bIncreaseTime=true;
                            SaveProductionSchedule(oProductionSchedule);
                        }
                    }
                    else if(nCount==0)
                    {
                        oProductionSchedule.bIncreaseTime=false;
                        SaveProductionSchedule(oProductionSchedule);
                    }

                },
                error: function(xhr, status, error)
                {
                    alert(error);
                }
            });
        }
        else
        {
            alert("Unable to paste"); return;
        }
    }

    function CreateCopyProductionSchedule(oProductionSchedule)
    {
        _oPSCopy=null;
        var bIsCreate=true;
        var nts=(new Date()).getTime()/1000;
        _oOldPS=oProductionSchedule;
        $.ajax({
            type: "POST",
            dataType: "json",
            url : _sBaseAddress+  "/ProductionSchedule/CopyProductionSchedule",
            traditional: true,
            data:  JSON.stringify({oPS:oProductionSchedule, IsCreate:bIsCreate,nts:nts}),
            contentType: "application/json; charset=utf-8",
            success: function (data) {
                debugger;
                oProductionSchedule = jQuery.parseJSON(data);
                if(_oPSIDs.length>0)
                {
                    document.getElementById(""+_oPSIDs[0]+"").checked=false;
                    _oPSIDs=[];
                    _oCRIDs=[];
                }
                _oPS=null;
                if (oProductionSchedule.ErrorMessage=="")
                {
                    debugger;
                    _oPSCopy=oProductionSchedule;
                    _oPSCopy.CheckTime=new Date(oProductionSchedule.CheckTimeInString);
                    _oPSCopy.IncDecTime=new Date(oProductionSchedule.IncDecTimeInString);
                    _bRedoCopyPaste=false;
                    _bUndoCopyPaste=true;
                    $('#btnUndo').linkbutton('enable');
                    $('#btnRedo').linkbutton('disable');
                    alert("Coppied successfully");
                    ToolbarRefresh();
                    _oPSIDs=[];
                    _oCRIDs=[];
                }
                else
                {
                    alert(oProductionSchedule.ErrorMessage);
                }

            },
            error: function (xhr, status, error) {
                alert(error);
            }
        });
    }

    function SaveProductionSchedule(oProductionSchedule)
    {
        $.ajax({
            type: "POST",
            dataType: "json",
            url : _sBaseAddress+  "/ProductionSchedule/Save",
            traditional: true,
            data:  JSON.stringify(oProductionSchedule),
            contentType: "application/json; charset=utf-8",
            success: function (data) {
                debugger;
                oProductionSchedule = jQuery.parseJSON(data);
                document.getElementById(""+_oPSIDs[0]+"").checked=false;
                _oPSIDs=[];
                _oCRIDs=[];
                _oPS=null;
                if (oProductionSchedule.ErrorMessage=="")
                {
                    _sCheckTime=oProductionSchedule.CheckTimeInString;
                    _sIncDecTime=oProductionSchedule.IncDecTimeInString;
                    _bRedoCutPaste=false;
                    _bUndoCutPaste=true;
                    $('#btnUndo').linkbutton('enable');
                    $('#btnRedo').linkbutton('disable');
                    alert("Data Saved successfully");
                    ToolbarRefresh();
                    _oPSIDs=[];
                    _oCRIDs=[];
                }
                else
                {
                    alert(oProductionSchedule.ErrorMessage);
                }

            },
            error: function (xhr, status, error) {
                alert(error);
            }


        });
    }

    function ScheduleSwap(nLocationID,nCRID,nDate,nMonth,nYear,nHour,nMin,nView)
    {
        var sType="Swap";
        if(_oPSIDs.length<=0){alert("Please select two schedules for swaping."); return;}
        else if(_oPSIDs.length!=2){alert("Please select only two schedules for swaping."); return;}
        if(_oCRIDs[0]!=nCRID && _oCRIDs[1]!=nCRID){alert("Please choose from you selected region."); return;}
        if(confirm("Are you sure to swap these sechdule?"))
        {
            var sPSIDs="";
            for(var i=0; i<_oPSIDs.length;i++) { sPSIDs=sPSIDs+_oPSIDs[i]+','; }
            sPSIDs=sPSIDs.substring(0,sPSIDs.length-1);
            Swapping(sPSIDs, sType);
            _bUndoSwap=true;
            _bRedoSwap=false;
            $('#btnUndo').linkbutton('enable');
            $('#btnRedo').linkbutton('disable');
        }

    }

    function Swapping(sPSIDs , sType)
    {
        var nts=(new Date()).getTime()/1000;
        {
            $.ajax({
                type: "Post",
                dataType: "json",
                url: _sBaseAddress + "/ProductionSchedule/SwapProductionSchedule",
                traditional: true,
                data:   JSON.stringify({sPSIDs : sPSIDs, nts:nts}),
                contentType: "application/json; charset=utf-8",
                success: function (data)
                {
                    _sUndoSwapPSIDs=sPSIDs;
                    _bRedoCutPaste=false;
                    _bUndoCutPaste=false;
                    _oUndoPaste=[];
                    _oRedoPaste=[];
                    _oOldPS=[];
                    var sMessage=jQuery.parseJSON(data);
                    if(sType=="Swap"){ alert(sMessage); }
                    else if(sType=="Undo"){ alert("Undo Successfully"); }
                    else if(sType=="Redo"){ alert("Redo Successfully"); }
                    if(_oPSIDs.length>0)
                    {
                        document.getElementById(""+_oPSIDs[0]+"").checked=false;
                        document.getElementById(""+_oPSIDs[1]+"").checked=false;
                        _oPSIDs=[];
                        _oCRIDs=[];
                    }

                    if(sMessage=="Swap Successfully") { ToolbarRefresh(); }

                },
                error: function (xhr, status, error) {alert(error);}
            });
        }
    }

    function UndoCopyPaste()
    {
        if(confirm("Are you sure to undo?"))
        {
            ChangeUndoRedoForCopyPaste(_oPSCopy,"Undo")
            _bRedoCopyPaste=true;
            _bUndoCopyPaste=false;
            $('#btnUndo').linkbutton('disable');
            $('#btnRedo').linkbutton('enable');
        }
    }

    function RedoCopyPaste()
    {
        if(confirm("Are you sure to redo?"))
        {
            ChangeUndoRedoForCopyPaste(_oOldPS,"Redo")
            _bRedoCopyPaste=false;
            _bUndoCopyPaste=true;
            $('#btnUndo').linkbutton('enable');
            $('#btnRedo').linkbutton('disable');
        }
    }

    function UndoCutPaste()
    {
        if(confirm("Are you sure to undo?"))
        {
            _oPS =_oOldPS;
            _oPS.IncDecCRID=_oOldPS.CRID;
            _oPS.IncDecTime=new Date(_sIncDecTime);
            _oPS.CheckTime=new Date(_sCheckTime);
            ChangeUndoRedo(_oUndoPaste,'Undo');
            _bRedoCutPaste=true;
            _bUndoCutPaste=false;
            $('#btnUndo').linkbutton('disable');
            $('#btnRedo').linkbutton('enable');
        }
    }

    function RedoCutPaste()
    {
        if(confirm("Are you sure to redo?"))
        {
            _oPS =_oOldPS;
            _oPS.IncDecCRID=_oOldPS.CRID;
            _oPS.IncDecTime=new Date(_sIncDecTime);
            _oPS.CheckTime=new Date(_sCheckTime);
            ChangeUndoRedo(_oRedoPaste, 'Redo');
            _bRedoCutPaste=false;
            _bUndoCutPaste=true;
            $('#btnUndo').linkbutton('enable');
            $('#btnRedo').linkbutton('disable');
        }
        _nIncDecCRID=nCRID;
    }

    function UndoSwap()
    {
        if($.trim(_sUndoSwapPSIDs)=="" || !_bUndoSwap){alert("Nothing found for undo."); return;}
        var sType="Undo";
        if(confirm("Are you sure to undo?"))
        {
            Swapping(_sUndoSwapPSIDs,sType);
            _bUndoSwap=false;
            _bRedoSwap=true;
            $('#btnUndo').linkbutton('disable');
            $('#btnRedo').linkbutton('enable');
        }

    }

    function RedoSwap()
    {
        if($.trim(_sUndoSwapPSIDs)=="" || !_bRedoSwap){alert("Nothing found for redo."); return;}
        var sType="Redo";
        if(confirm("Are you sure to redo?"))
        {
            Swapping(_sUndoSwapPSIDs,sType);
            _bUndoSwap=true;
            _bRedoSwap=false;
            $('#btnUndo').linkbutton('enable');
            $('#btnRedo').linkbutton('disable');
        }
    }

    function ChangeUndoRedoForCopyPaste(oProductionSchedule,sType)
    {
        if(sType=="Undo" || sType=="Redo")
        {
            _oPSCopy=null;
            var bIsCreate=false;
            if(sType=="Undo"){ bIsCreate=false; }
            else if(sType=="Redo"){ bIsCreate=true; }
            var nts=(new Date()).getTime()/1000;
            $.ajax({
                type: "POST",
                dataType: "json",
                url : _sBaseAddress+  "/ProductionSchedule/CopyProductionSchedule",
                traditional: true,
                data:  JSON.stringify({oPS:oProductionSchedule, IsCreate:bIsCreate,nts:nts}),
                contentType: "application/json; charset=utf-8",
                success: function (data) {
                    debugger;
                    oProductionSchedule = jQuery.parseJSON(data);
                    if (oProductionSchedule.ErrorMessage=="")
                    {
                        if(sType=='Undo'){ alert("Undo Successfully.");}
                        else if(sType=='Redo')
                        {
                            _oPSCopy=oProductionSchedule;
                            _oPSCopy.CheckTime=new Date(oProductionSchedule.CheckTimeInString);
                            _oPSCopy.IncDecTime=new Date(oProductionSchedule.IncDecTimeInString);
                            alert("Redo Successfully.");
                        }
                        ToolbarRefresh();
                    }
                    else
                    {
                        alert(oProductionSchedule.ErrorMessage);
                    }

                },
                error: function (xhr, status, error) {
                    alert(error);
                }
            });
        }
    }
    function ChangeUndoRedo(oUndoRedo,sType)
    {
        var oProductionSchedule=RefreshObjectForPaste(oUndoRedo.LocationID,oUndoRedo.CRID,oUndoRedo.Date,oUndoRedo.Month,oUndoRedo.Year,oUndoRedo.Hour,oUndoRedo.Min);
        $.ajax({
            type: "POST",
            dataType: "json",
            url : _sBaseAddress+  "/ProductionSchedule/Save",
            traditional: true,
            data:  JSON.stringify(oProductionSchedule),
            contentType: "application/json; charset=utf-8",
            success: function (data) {
                debugger;
                oProductionSchedule = jQuery.parseJSON(data);
                if (oProductionSchedule.ErrorMessage=="")
                {
                    _sCheckTime=oProductionSchedule.CheckTimeInString;
                    _sIncDecTime=oProductionSchedule.IncDecTimeInString;
                    _oPS=null;
                    if(sType=='Undo'){ alert("Undo Successfully.");}
                    else if(sType=='Redo'){ alert("Redo Successfully.");}
                    ToolbarRefresh();
                }
                else
                {
                    alert(oProductionSchedule.ErrorMessage);
                }

            },
            error: function (xhr, status, error) {
                alert(error);
            }
        });
    }

    function UndoRedoReset()
    {
        _bCopy=false;
        _bCut=false;
        _bRedoCopyPaste=false;
        _bUndoCopyPaste=false;
        _bUndoSwap=false;
        _bRedoSwap=false;
        _bRedoCutPaste=false;
        _bUndoCutPaste=false;
        _oUndoPaste=null;
        _oRedoPaste=null;
        _oOldPS=null;
        _oPS=null;
        _sUndoSwapPSIDs="";
        $('#btnUndo').linkbutton('disable');
        $('#btnRedo').linkbutton('disable');
        _oPSIDs=[];
        _oCRIDs=[];
    }

    $('#btnUndo').click(function(e)
    {
        if(!_bUndoSwap && !_bUndoCutPaste && !_bUndoCopyPaste ){return;}
        if(_bUndoSwap){UndoSwap();}
        else if(_bUndoCutPaste){UndoCutPaste();}
        else if(_bUndoCopyPaste){UndoCopyPaste();}

    });

    $('#btnRedo').click(function(e)
    {
        if(!_bRedoSwap && !_bRedoCutPaste && !_bRedoCopyPaste){return;}
        if(_bRedoSwap){RedoSwap();}
        else if(_bRedoCutPaste){RedoCutPaste();}
        else if(_bRedoCopyPaste){RedoCopyPaste();}

    });


    //////////////
    $("#btnPickOrderNo").click(function () {

        if (parseInt($("#cboOrderType").val())<=0 ) {

            alert("Please Select Order Type.");
            $('#cboOrderType').focus();
            $('#cboOrderType').removeClass("errorFieldBorder");
            return;
        }
       

        var oRouteSheetDO = {
            OrderTypeInt:$('#cboOrderType').val(),
            OrderNo:$('#txtOrderNo').val(),
            LabDipDetailID:_nLabDipDetailID
        };

        GetOrders(oRouteSheetDO);
    });

    $("#txtOrderNo").keydown(function (e) {
        var nkeyCode = e.keyCode || e.which;
        if(nkeyCode==13){
            var sorderNo=$.trim($("#txtOrderNo").val());
            if (parseInt($("#cboOrderType").val())<=0 ) {

                alert("Please Select Order Type.");
                $('#cboOrderType').focus();
                $('#cboOrderType').removeClass("errorFieldBorder");
                return;
            }

            var oRouteSheetDO = {
                OrderTypeInt:$('#cboOrderType').val(),
                OrderNo:sorderNo,
                LabDipDetailID:_nLabDipDetailID
            };
            GetOrders(oRouteSheetDO);
        }
        else if(nkeyCode==8){
            $("#txtOrderNo").val("");
           
        }
    });
    function GetOrders(oRouteSheetDO){

        var obj = {
            BaseAddress: _sBaseAddress,
            Object: oRouteSheetDO,
            ControllerName: "RouteSheet",
            ActionName: "GetsDyeingOrder",
            IsWinClose: false
        };
        //$("#progressbar").progressbar({ value: 0 });
        //$("#progressbarParent").show();
        $.icsDataGets(obj, function (response) {
            //clearInterval(intervalID);
            //$("#progressbarParent").hide();
            if (response.status && response.objs.length > 0) {
                if (response.objs[0].DyeingOrderDetailID > 0) {
                    debugger;
                    var tblColums = [];
                    var ncboOrderType=parseInt($("#cboOrderType").val());
                    var oColumn = { field: "OrderNoFull", title: "OrderNo", width: 100, align: "left" };tblColums.push(oColumn);
                    if( ncboOrderType===5)
                    {
                        oColumn = { field: "ClaimOrderNo", title: "ClaimOrderNo", width: 75, align: "left" };tblColums.push(oColumn);
                    }
                    oColumn = { field: "OrderQty", title: "OrderQty", width: 75, align: "right",formatter:formatPrice };tblColums.push(oColumn);
                    oColumn = { field: "Qty_Pro", title: "Prod Qty", width: 75, align: "right",formatter:formatPrice };tblColums.push(oColumn);
                    oColumn = { field: "Qty_RS", title: "Yet To Pro", width: 75, align: "right" };tblColums.push(oColumn);
                    oColumn = { field: "ProductName", title: "Yarn", width: 225, align: "left" };tblColums.push(oColumn);
                    oColumn = { field: "ColorName", title: "ColorName", width: 100, align: "left" };tblColums.push(oColumn);
                    oColumn = { field: "ShadeSt", title: "Shade", width: 40, align: "left" };tblColums.push(oColumn);
                    oColumn = { field: "ColorNo", title: "ColorNo", width: 80, align: "left" };tblColums.push(oColumn);
                    oColumn = { field: "LabdipNo", title: "LabdipNo", width: 100, align: "left" };tblColums.push(oColumn);
                    oColumn = { field: "OrderTypeSt", title: "OrderType", width: 100, align: "left" };tblColums.push(oColumn);
                    var oPickerParam = {
                        winid: 'winOrderPicker',
                        winclass:'clsOrderPicker',
                        winwidth: 1000,
                        winheight: 660,
                        tableid: 'tblOrderPicker',
                        tablecolumns: tblColums,
                        datalist: response.objs,
                        multiplereturn: true,
                        searchingbyfieldName:'OrderNo',
                        windowTittle: 'Order List'
                    };
                    $.icsPicker(oPickerParam);
                    IntializePickerbutton(oPickerParam);//multiplereturn, winclassName
                }
                else { alert(response.objs[0].ErrorMessage); }
            }
            else{
                alert("No order found.");
            }
        });


    }
    function IntializePickerbutton(oPickerobj) {
        $("#" + oPickerobj.winid).find("#btnOk").click(function () {
            //for Single Select
            SetPickerValueAssign(oPickerobj);
        });
        $(document).find('.' + oPickerobj.winclass).keydown(function (e) {
            if (e.which == 13)//enter=13
            {
                SetPickerValueAssign(oPickerobj);

            }
        });
    }
    function SetPickerValueAssign(oPickerobj) {
        debugger;
        var oreturnObj = null, oreturnobjs = [];
        if (oPickerobj.multiplereturn) {
            oreturnobjs = $('#' + oPickerobj.tableid).datagrid('getChecked');
        } else {
            oreturnObj = $('#' + oPickerobj.tableid).datagrid('getSelected');
        }
        $("#" + oPickerobj.winid).icsWindow("close");
        $("#" + oPickerobj.winid).remove();

        if (oPickerobj.winid == 'winLabDipPicker')
        {
            if (oreturnObj != null && oreturnObj.LabDipDetailID > 0)
            {
                $('#txtColorNo').val(oreturnObj.ColorNo);
                //$('#txtColorName').val(oreturnObj.ColorName);
                $('#txtLabdipNo').val(oreturnObj.LabdipNo);
                _nLabDipDetailID= oreturnObj.LabDipDetailID;
            }
            else{
                alert("Data Not Found.");
                return;
            }
        }
        else if (oPickerobj.winid == 'winOrderPicker')
        {
            if (oreturnobjs != null && oreturnobjs.length > 0)
            {
                debugger;
                for (i=0; i<oreturnobjs.length;i++)
                {
                    var bExists= IsExist(oreturnobjs[i].LabDipDetailID)
                    if(bExists)
                    {
                        alert("Color must be same")
                        return;
                    }
                    bExists= IsExist_DOD(oreturnobjs[i].LabDipDetailID)
                    if(bExists)
                    {
                        alert("This Order already exists.")
                        return;
                    }
                  
                    $('#tblRouteSheetDO').datagrid('appendRow',oreturnobjs[i]);
                    
                   
                    $('#txtColorNo').val(oreturnobjs[0].ColorNo);
                    $('#txtLabdipNo').val(oreturnobjs[0].LabdipNo);
                    //_oRouteSheet.LabDipDetailID= oreturnobjs[0].LabDipDetailID;
                    $('#txtBuyerName').val(oreturnobjs[0].ContractorName);
                    $('#txtProductPTU').val(oreturnobjs[0].ProductName);
                    //$('#txtColorNo').val(oPTU.ColorNo);
                    $('#txtColorShade').val(oreturnobjs[0].ColorName);
                    _nLabDipDetailID= oreturnobjs[0].LabDipDetailID;
                    _nPTUID= oreturnobjs[0].PTUID;
                    _nProductID= oreturnobjs[0].ProductID;
                    $('#txtColorNo').val(oreturnobjs[0].ColorNo);
                    $('#txtOrderNo').val(oreturnobjs[0].OrderNo);
                    $('#txtProduct').val(oreturnobjs[0].ProductName);
                    RefreshRSDO();
                }


            }
            else{
                alert("Data Not Found.");
                return;
            }
        }
       
        
    }
    $("#btnRefreshRSDO").click(function () {
       
        endEditing();
    });
    function IsExist(nLabDipDetailID)
    {
        var oRSDOs = $('#tblRouteSheetDO').datagrid('getRows');
        for (var i = 0; i < oRSDOs.length; i++)
        {
            if (parseInt(oRSDOs[i].LabDipDetailID) != parseInt(nLabDipDetailID))
            {
                return true;
            }
        }

        return false;
    }
    function IsExist_DOD(nDyeingOrderDetailID)
    {
        var oRSDOs = $('#tblRouteSheetDO').datagrid('getRows');
        for (var i = 0; i < oRSDOs.length; i++) {
            if (parseInt(oRSDOs[i].DyeingOrderDetailID) == parseInt(nDyeingOrderDetailID))
            {
                return true;
            }
        }

        return false;
    }
    $("#btnDeleteRSDO").click(function () {

        var oRSDO = $('#tblRouteSheetDO').datagrid('getSelected');
      
        if (!confirm("Confirm to Remove?")) return false;
        var sOperation=sessionStorage.getItem('Operation');

        if(sOperation=="Copy")
        {
            oRSDO.RouteSheetDOID=0;
        }
        if (oRSDO == null || oRSDO.RouteSheetDOID<=0)
        {
            var SelectedRowIndex = $('#tblRouteSheetDO').datagrid('getRowIndex', oRSDO);
            $('#tblRouteSheetDO').datagrid('deleteRow',SelectedRowIndex);
        }
        else{
            var obj =
            {
                BaseAddress: _sBaseAddress,
                Object: oRSDO,
                ControllerName: "RouteSheet",
                ActionName: "DeleteRSDO",
                TableId: "tblRouteSheetDO",
                IsWinClose: false,
                Message:''
            };
            $.icsDelete(obj);
        }

    });
    ///
</script>