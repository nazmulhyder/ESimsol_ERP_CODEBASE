 @{
     ViewBag.Title = "FDBP Receive";
  }
<html>
<body>
    @model ESimSol.BusinessObjects.CommercialBS
<div style="font-family: Tahoma" class="menuMainCollectionTable">
    <fieldset>
        <legend style="font-weight: bold">Commercial Bank Submition Info : </legend>
        <table border="0" cellspacing="2" cellpadding="2" style="font-size: 11px; width:100%; font-weight: bold" >
            <tr>
                <td style="width:15%; text-align: right">
                    Ref No :
                </td>
                <td style="width:35%;">
                    @Html.TextBoxFor(model => model.RefNo, new { style = "width:100%;", id = "txtRefNo", disabled = "disabled" })
                </td>
                <td style="width: 15%; text-align: right">
                    Issue Date :
                </td>
                <td style="width: 35%">
                    <table border="0" cellpadding="0" cellspacing="0" width="100%">
                        <tr>
                            <td style="width:50%">@Html.TextBoxFor(model => model.IssueDateInString, new { style = "width: 100%;", id = "txtIssueDate", disabled = "disabled" })</td>
                            <td style="width:20%;text-align:right;">B.Currency:</td>
                            <td style="width:30%">@Html.TextBoxFor(model => model.BCurrencySymbol, new { style = "width: 100%;", id = "txtBCurrencySymbol", disabled = "disabled" })</td>
                        </tr>
                    </table>
                </td>
            </tr>
            <tr>
                <td style="width:15%; text-align: right">
                    Master LC No :
                </td>
                <td style="width: 35%">
                    @Html.TextBoxFor(model => model.MasterLCNo, new { style = "width: 100%;", id = "txtMasterLCNo", disabled = "disabled" })
                </td>
                <td style="width:15%; text-align: right">
                    Bill Amount :
                </td>
                <td style="width: 35%">
                    <table border="0" cellpadding="0" cellspacing="0" width="100%">
                        <tr>
                            <td style="width:40%">@Html.TextBoxFor(model => model.BSAmount, new { style = "width: 100%;text-align: right", id = "txtBSAmount", disabled = "disabled"})</td>
                            <td style="width:10%">@Html.TextBoxFor(model => model.CurrencySymbol, new { style = "width: 100%;text-align:left", id = "txtCurrencySymbol", disabled = "disabled" })</td>
                            <td style="width:20%;text-align:right;">C.Rate:</td>
                            <td style="width:30%">@Html.TextBoxFor(model => model.CRate, new { style = "width: 100%;", id = "txtCRate" })</td>
                        </tr>
                    </table>
                    
                </td>
            </tr>
            
            <tr>
                <td style="width:15%; text-align: right">
                    Buyer Name :
                </td>
                <td style="width:35%" >
                    @Html.TextBoxFor(model => model.BuyerName, new { style = "width: 100%;", id = "txtBuyerName", disabled = "disabled" })
                </td>  
                <td style="width:15%; text-align: right">
                    Amount In (B.C):
                </td>
                <td style="width: 35%">
                    <table border="0" cellpadding="0" cellspacing="0" width="100%">
                        <tr>
                            <td style="width:90%">@Html.TextBoxFor(model => model.BSAmountBC, new { style = "width: 100%;text-align: right", id = "txtBSAmountBC", disabled = "disabled" })</td>
                            <td style="width:10%">@Html.TextBoxFor(model => model.BCurrencySymbol, new { style = "width: 100%;text-align:left", id = "txtBCurrencySymbol", disabled = "disabled" })</td>
                        </tr>
                    </table>
                </td>             
            </tr>
            <tr>
                <td style="width:15%; text-align: right">
                    Bank Ref No :
                </td>
                <td style="width: 35%">
                    @Html.TextBoxFor(model => model.BankRefNo, new { style = "width: 100%;", id = "txtBankRefNo" })
                </td>
                <td style="width:15%; text-align: right">
                    FDBP No :
                </td>
                <td style="width: 35%">
                    @Html.TextBoxFor(model => model.FDBPNo, new { style = "width: 100%;", id = "txtFDBPNo" })
                </td>
            </tr>   

            <tr>
                <td style="width:15%; text-align: right">
                    Remark :
                </td>
                <td style="width: 35%">
                    @Html.TextBoxFor(model => model.FDBPRemarks, new { style = "width: 100%;", id = "txtFDBPRemarks" })
                </td>
                <td style="width:15%; text-align: right">
                    FDBP Receive Date :
                </td>
                <td style="width: 35%">
                    <input id="txtFDBPReceiveDate" type="text" class="easyui-datebox" data-options="formatter:icsdateformat,parser:icsdateparser" style="width: 100%;" />
                </td>
            </tr>   
         
        </table>
    </fieldset>
    <fieldset>
        <legend style="font-weight: bold">Action : </legend>
        <table border="0" cellspacing="2" cellpadding="2" style="font-size: 11px;width:100%; font-weight: bold">
            <tr>
                <td style="width:85%; text-align: right">
                </td>
                <td style="width:15%;text-align:right">
                    <a id="btnCommit" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-save" plain="true">Commit</a>
                    <a id="btnClose" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-cancel" plain="true">Close</a>
                </td>
            </tr>
        </table>
    </fieldset>
    </div>
</body>
</html>
<script type="text/javascript">
    var _oCommercialBS =null;
    var _sBaseAddress="";
    $(document).ready(function () {
        //debugger;
        _sBaseAddress =@Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(HttpContext.Current.Session[SessionInfo.BaseAddress]));
        _oCommercialBS =@Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(Model));      
        $('#txtBSAmountBC,#txtCRate,#txtBSAmount').icsCurrencyBox(null, null, 2);
        $('#txtFDBPReceiveDate').datebox('setValue', icsdateformat(new Date()));
        if(_oCommercialBS.BCurrencyID==_oCommercialBS.CurrencyID)
        {
            $('#txtCRate').attri('disabled',true);
        }
        $('#txtBSAmount').val(icsFormatPrice(_oCommercialBS.BSAmount,null,2));
        $('#txtCRate').val(icsFormatPrice(_oCommercialBS.CRate,null,2));
 });

    $('#txtCRate').change(function(){
        $('#txtBSAmountBC').val(icsFormatPrice(parseFloat(icsRemoveComma($('#txtCRate').val()))*parseFloat(icsRemoveComma($('#txtBSAmount').val()))), null, 2);
    });
 $('#btnCommit').click(function (e) {
 debugger;
     var oCommercialBS = _oCommercialBS;
     if(oCommercialBS.BSStatus!=2)
     {
        alert("Please select only 'Submit To Bank' item ");
        return;
     }
     if(parseFloat($('#txtCRate').val())<=0)
     {
         alert("Convertion Rate Should be greater than 0.");
         return;
     }
     if (!confirm("Confirm to FDBP Receive?")) return ;
     oCommercialBS.Remark = document.getElementById("txtFDBPRemarks").value;
     oCommercialBS.DynamicDate =$('#txtFDBPReceiveDate').datebox('getValue');
     oCommercialBS.BankRefNo =$.trim($('#txtBankRefNo').val()),
     oCommercialBS.FDBPNo =$.trim($('#txtFDBPNo').val()),
     oCommercialBS.ActionTypeInString="FDBPRcv";
     oCommercialBS.CRate=parseFloat(icsRemoveComma($('#txtCRate').val()));
     oCommercialBS.BSAmountBC=parseFloat(icsRemoveComma($('#txtBSAmountBC').val()));
     oCommercialBS.BSStatusInInt = 2;
     $.ajax({
                type: "POST",
                dataType: "json",
                url : _sBaseAddress+"/CommercialBS/ChangeStatus",
                traditional: true,
                data:  JSON.stringify(oCommercialBS),
                contentType: "application/json; charset=utf-8",
                success: function (data) {
               debugger;
               var oCommercialBS= jQuery.parseJSON(data);
               if (oCommercialBS.ErrorMessage=="")
                {
                   alert("Successfully Received FDBP.");
                   var oCommercialBSs = sessionStorage.getItem("CommercialBSs");
                   var nIndex = parseInt(sessionStorage.getItem("SelectedRowIndex"));
                   oCommercialBSs = jQuery.parseJSON(oCommercialBSs);
                   oCommercialBSs[nIndex] = oCommercialBS;
                   sessionStorage.setItem("CommercialBSs", JSON.stringify(oCommercialBSs));
                   window.location.href = sessionStorage.getItem("BackLink");
                 }else
                 {
                   alert(oCommercialBSs.ErrorMessage);
                 }
               },
               error: function (xhr, status, error)
                {
                    alert(error);
                }
            });

 });

 $('#btnClose').click(function (e) {
     window.location.href =sessionStorage.getItem("BackLink");
 });


</script>
