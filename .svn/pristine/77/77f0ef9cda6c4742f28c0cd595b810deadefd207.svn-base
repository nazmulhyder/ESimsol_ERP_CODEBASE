@model ESimSol.BusinessObjects.MaterialTransactionRule
@{
    ViewBag.Title = "MTR Setup";
}

 @Html.ValidationSummary(true)

<html>
<body>
    <div class="PageHeading">
        <table border="0">
            <tr>

                <td style="width:900px" class="Headline"> Material Transaction Rule Setup</td>
            </tr>
        </table>
    </div>

    <div class="PageBody" style="overflow:auto;height:600px; margin-left:20px;margin-right:20px" ">
        <fieldset>
            <table>
                <tr>
                    <td>
                        <fieldset>
                            <legend>Location</legend>
                            <table id="tblLocation" title="" class="easyui-datagrid" style="width:150px;height:200px" toolbar="#toolbarLoc" pagination="false" rownumbers="false" fitcolumns="true" singleselect="false">
                                <thead>
                                    <tr>

                                        <th field="ck" checkbox="true"></th>
                                        <th field="Name" width="120">Location</th>
                                        <th field="btn" button="true"></th>

                                    </tr>
                                </thead>
                            </table>
                        </fieldset>
                    </td>
                    <td style="width:10px"> </td>

                    <td>
                        <fieldset>
                            <legend>Workstation</legend>
                            <table id="tblWorkingUnit" title="" class="easyui-datagrid" style="width:150px;height:200px" toolbar="#toolbarWU" pagination="false" rownumbers="false" fitcolumns="true" singleselect="false">
                                <thead>
                                    <tr>

                                        <th field="ck" checkbox="true"></th>
                                        <th field="OperationUnitName" width="120">Working Unit</th>


                                    </tr>
                                </thead>
                            </table>
                        </fieldset>
                    </td>
                    <td style="width:10px"> </td>
                    <td>
                        <fieldset>
                            <legend>Action</legend>
                            <table id="tblTrigerParent" title="" class="easyui-datagrid" style="width:150px;height:200px" toolbar="#toolbarTP" pagination="false" rownumbers="false" fitcolumns="true" singleselect="false">
                                <thead>
                                    <tr>

                                        <th field="ck" checkbox="true"></th>
                                        <th field="Name" width="120">Action Name</th>


                                    </tr>
                                </thead>
                            </table>
                        </fieldset>
                    </td>
                    <td style="width:10px"> </td>
                    <td id="tdDirection">
                        <fieldset>
                            <legend>Direction</legend>
                            <fieldset>
                                <table id="tblDirection" title="" class="easyui-datagrid" style="width:150px;height:100px" toolbar="#toolbarDir" pagination="false" rownumbers="false" fitcolumns="true" singleselect="false">
                                    <thead>
                                        <tr>

                                            <th field="ck" checkbox="true"></th>
                                            <th field="name" width="120">Direction</th>


                                        </tr>
                                    </thead>
                                </table>
                            </fieldset>
                            <fieldset>
                                <table id="tblInOut" title="" class="easyui-datagrid" style="width:150px;height:100px" toolbar="#toolbarIO" pagination="false" rownumbers="false" fitcolumns="true" singleselect="false">
                                    <thead>
                                        <tr>

                                            <th field="ck" checkbox="true"></th>
                                            <th field="TypeName" width="120">Path</th>



                                        </tr>
                                    </thead>
                                </table>
                            </fieldset>
                        </fieldset>
                    </td>

                </tr>
                <tr>
                    <td> Product Category: @Html.TextBox("txtProductCategory", "", new { style = "width: 100px ; text-align:left", id = "txtProductCategory" }) </td>
                    <td> @Html.TextBox("txtProductCategoryID", "", new { style = "width: 10px; visibility:hidden", id = "txtProductCategoryID" })</td>
                    <td> </td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td><input type="submit" value="Refresh" id="btnRefresh" /><input type="submit" value="Save" id="btnSave" /></td>

                </tr>
            </table>

            <div id="toolbarLoc"><a href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-add" plain="true" onclick="AddLoc()">Add</a></div>
            <div id="toolbarWU"><a href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-add" plain="true" onclick="AddWU()">Add</a></div>
            <div id="toolbarTP"><a href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-add" plain="true" onclick="AddTP()">Add</a></div>
            <div id="toolbarDir"><a href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-add" plain="true" onclick="AddDir()">Add</a></div>
            <div id="toolbarIO"><a href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-add" plain="true" onclick="AddIO()">Add</a></div>
            <div style="overflow:auto;height:600px; margin-left:20px;margin-right:20px" ">
                <fieldset>
                    <table>
                        <tr>
                            <td>

                                <legend>Selected Items</legend>
                                <table id="tblSelectedItems" title="" class="easyui-datagrid" style="width:800px;height:80px" toolbar="#toolbar" pagination="false" rownumbers="false" fitcolumns="true" singleselect="false">
                                    <thead>
                                        <tr>
                                            <th data-options="field:'IsActive',checkbox:true">Activity</th>
                                            <th field="LocationName" width="150">Location</th>
                                            <th field="OperationUnitName" width="120">Workstation</th>
                                            <th field="TriggerParentTypeInString" width="130">Action</th>
                                            <th field="DirectionName" width="100">Direction</th>
                                            <th field="InOutName" width="100">Path</th>
                                            <th field="ProductCategoryName" width="100">Product</th>


                                        </tr>
                                    </thead>
                                </table>

                            </td>
                        </tr>

                        <tr>
                            <td>

                                <legend>Bi Directional Rule</legend>
                                <table id="tblBiDirectionalRule" title="" class="easyui-datagrid" style="width:800px;height:200px" toolbar="#toolbarBiTable" pagination="false" rownumbers="false" fitcolumns="true" singleselect="false">
                                    <thead>
                                        <tr>
                                            <th data-options="field:'IsActive',checkbox:true">Activity</th>
                                            <th field="LocationName" width="150">Location</th>
                                            <th field="OperationUnitName" width="120">Workstation</th>
                                            <th field="TriggerParentTypeInString" width="130">Action</th>
                                            <th field="DirectionName" width="100">Direction</th>
                                            <th field="InOutName" width="100">Path</th>
                                            <th field="ProductCategoryName" width="100">Product</th>

                                        </tr>
                                    </thead>
                                </table>

                            </td>
                        </tr>

                        <tr>
                            <td>

                                <legend>Selected Rules</legend>
                                <table id="tblRefreshedItems" title="" class="easyui-datagrid" style="width:800px;height:200px" toolbar="#toolbarRefreshTable" pagination="false" rownumbers="false" fitcolumns="true" singleselect="true">
                                    <thead>
                                        <tr>
                                            <th data-options="field:'IsActive',checkbox:true">Activity</th>
                                            <th field="LocationName" width="150">Location</th>
                                            <th field="OperationUnitName" width="120">Workstation</th>
                                            <th field="TriggerParentTypeInString" width="130">Action</th>
                                            <th field="DirectionName" width="100">Direction</th>
                                            <th field="InOutName" width="100">Path</th>
                                            <th field="Activity" width="100">Activity</th>
                                            <th field="ProductCategoryName" width="100">Product</th>


                                        </tr>
                                    </thead>
                                </table>
                                <div id="toolbarBiTable">
                                    <a href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-save" plain="true" onclick="Update()">Save</a>
                                </div>
                                <div id="toolbarRefreshTable">
                                    <a href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-edit" plain="true" onclick="Edit()">Edit</a>
                                    <a href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-edit" plain="true" onclick="EditOthers()">Edit Others</a>
                                    <a id="btnActive" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-tip" plain="true" onclick="Action()">Active</a>
                                </div>

                            </td>
                        </tr>
                    </table>
                </fieldset>
            </div>
        </fieldset>
    </div>

</body>
</html>


        
 
<script type="text/javascript">
    var _oItems = [];
    var _oLocations = [];
    var _oWorkstations = [];
    var _oWorkstationsByLocation = [];
    var _oTriggerParents = [];
    var _oDirections = [];
    var _oPaths = [];
    var _oLocation = "";
    var _oWorkstation = "";
    var _oTriggerParent = "";
    var _oDirection = "";
    var _oPath = "";  
    var _sBaseAddress='';  
    $(document).ready(function () {
        debugger;
        _sBaseAddress =@Html.Raw( new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(HttpContext.Current.Session[SessionInfo.BaseAddress]));
//        initializeDatepicker();
        RefreshtblLocation();
        RefreshtblWorkstation();
        RefreshTriggerParentsType();
        RefreshDirectionType();
        RefreshDirection();
        
        $("#txtProductCategory")[0].value = 'Press Enter';
        $('#tblRefreshedItems').datagrid({ onSelect: function (rowIndex, rowData) { RowSelect(rowIndex, rowData); } });
        $('#tblWorkingUnit').datagrid({ onCheck: function (rowIndex, rowData) { CheckWorkingUnit(rowIndex, rowData); } });
        $('#tblWorkingUnit').datagrid({ onUncheck: function (rowIndex, rowData) { UncheckWorkingUnit(rowIndex, rowData); } });
        
    });

        function RowSelect(rowIndex, rowData)
       {
            if (rowData.Activity== 'Active')
            {
                document.getElementById("btnActive").innerHTML = 'Deactive';
                        
            }
            else if (rowData.Activity== 'Deactive')
            {
                document.getElementById("btnActive").innerHTML = 'Active';
                        
            }
            else
            {
                document.getElementById("btnActive").innerHTML = 'Active';
                        
            }
       }

   

        $('#txtProductCategory').keydown(function (e) {
            ////debugger;
            var keyCode = e.keyCode || e.which;
            if (keyCode != 13) {
                return false;
            }

        });

        $('#txtProductCategory').keypress(function (e) {
            ////debugger;
            var oWorkingUnits = $('#tblWorkingUnit').datagrid('getSelections');
            if (oWorkingUnits.length != 1) {
                alert("Please select a single item from the Workstation list!");
                return;
            } 
            var oWU = $('#tblWorkingUnit').datagrid('getSelected');
            var id = oWU.WorkingUnitID;
            var keyCode = e.keyCode || e.which;
            if (keyCode == 13) {
                var oParameter = new Object();
                oParameter.WUID = id;
                oParameter.MultipleReturn = false;
                var url = _sBaseAddress+"/MaterialTransactionRule/OperationUnitProductPikerWithCheckBox";
                var oReturnObject = window.showModalDialog(url, oParameter, 'dialogHeight:510px;dialogWidth:300px;dialogLeft:500;dialogTop:100;center:yes;resizable:no;status:no;scroll:no');
                debugger;
                if (oReturnObject.id > 0) {
                    document.getElementById('txtProductCategory').value = oReturnObject.text;
                    document.getElementById('txtProductCategoryID').value = oReturnObject.id;
                    var orow = $('#tblSelectedItems').datagrid('selectRow', 0);
                    var smtr = $('#tblSelectedItems').datagrid('getSelected');
                    debugger;
                    if (smtr.InOutName == "") {


                    }
                    var oMTR = {
                        LocationID: smtr.LocationID,
                        LocationName: smtr.LocationName,
                        WorkingUnitID: smtr.WorkingUnitID,
                        OperationUnitName: smtr.OperationUnitName,
                        TriggerParentType: smtr.TriggerParentType,
                        TriggerParentTypeInString: smtr.TriggerParentTypeInString,
                        InOutType: smtr.InOutType,
                        InOutName: smtr.InOutName,
                        Direction: smtr.Direction,
                        DirectionName: smtr.DirectionName,
                        ProductType: 0,
                        ProductCategoryID: oReturnObject.id,
                        ProductCategoryName: oReturnObject.text
                    };
                    $('#tblSelectedItems').datagrid('updateRow', { index: 0, row: oMTR });
                }
                else {
                    $('#txtProductCategoryName').focus();
                }
                return false;
            }

        });

    function RefreshtblWorkstationForSelectedLocation() {
        ////debugger;
        $('#tblWorkingUnit').empty();
        var oSelectedLocations = $('#tblLocation').datagrid('getChecked');               
        _oWorkstationsByLocation = [];
        for (var j = 0; j < oSelectedLocations.length; j++) {
            for (var i = 0; i < _oWorkstations.length; i++) {
                if (_oWorkstations[i].LocationID == oSelectedLocations[j].LocationID) {
                    _oWorkstationsByLocation.push(_oWorkstations[i]);
                }
            }
        }

        data = _oWorkstationsByLocation;
        data = { "total": "" + data.length + "", "rows": data };
        $('#tblWorkingUnit').datagrid('loadData', data);
        for (i = 0; i < _oWorkstationsByLocation.length; ++i)
        {
            $('#tblWorkingUnit').datagrid('checkAll');

        }       
    }

    function RefreshDirection() {
        $('#tblDirection').empty();
                    data = [{ id: 0, name: 'Uni Directional' }, { id: 1, name: 'Bi Directional'}];
                    data = { "total": "" + data.length + "", "rows": data };
                    $('#tblDirection').datagrid('loadData', data);
               
    }
    function RefreshTriggerParentsType() {
        $('#tblTrigerParent').empty();

        $.ajax({
            type: "GET",
            dataType: "json",
            url: '@Url.Action("GetsTriggerParent", "MaterialTransactionRule")',
            //data: { id: nID },
            contentType: "application/json; charset=utf-8",
            success: function (data) {
                ////debugger;
                _oTriggerParents = jQuery.parseJSON(data);
                if (_oTriggerParents != null) {

                    data = _oTriggerParents;
                    data = { "total": "" + data.length + "", "rows": data };
                    $('#tblTrigerParent').datagrid('loadData', data);
                    for (i = 0; i < _oTriggerParents.length; ++i) {
                        $('#tblTrigerParent').datagrid('checkRow', i);

                    }
                }
            },
            error: function (xhr, status, error) {
                alert(error);
            }
        });
    }


    function RefreshtblLocation() {
        $('#tblLocation').empty();
        debugger;
        $.ajax({
            type: "GET",
            dataType: "json",
            url: '@Url.Action("GetsLocation", "MaterialTransactionRule")',
            //data: { id: nID },
            contentType: "application/json; charset=utf-8",
            success: function (data) {
               // //debugger;
                _oLocations = jQuery.parseJSON(data);
                if (_oLocations != null) {

                    data = _oLocations;
                    data = { "total": "" + data.length + "", "rows": data };
                    $('#tblLocation').datagrid('loadData', data);
                    for (i = 0; i < _oLocations.length; ++i) {
                        $('#tblLocation').datagrid('checkRow', i);

                    }
                    $('#tblLocation').datagrid({ onCheck: function (rowIndex, rowData) { Checklocation(rowIndex, rowData); } });
                    $('#tblLocation').datagrid({ onUncheck: function (rowIndex, rowData) { Unchecklocation(rowIndex, rowData); } });
                    $('#tblLocation').datagrid({ onCheckAll: function (rows) { CheckAllLocation(rows); } });
                    $('#tblLocation').datagrid({ onUncheckAll: function (rows) { UncheckAllLocation(rows); } });

                }
            },
            error: function (xhr, status, error) {
                alert(error);
            }
        });
    }
    var bCheckLocation = false;
    var bCheckLocations = false;
    function CheckAllLocation(rows) {
        ////debugger;
        bCheckLocations = true;
        if (bCheckLocation) {
            bCheckLocations = false;
            return;
        }
       if (bCheckLocations) {
            for (i = 0; i < rows.length; ++i) {
                $('#tblLocation').datagrid('checkRow', i);
            }
            RefreshtblWorkstationForSelectedLocation();
            bCheckLocation = false;
           
        }
    }

    function UncheckAllLocation(rows) {
        if (bCheckLocation) {
            bCheckLocations = false;
            return;
        }
        else {
            bCheckLocations = true;
        }

        if (bCheckLocations) {
            for (i = 0; i < rows.length; ++i) {
                $('#tblLocation').datagrid('uncheckRow', i);
            }
            RefreshtblWorkstationForSelectedLocation();
            bCheckLocation = false;
            bCheckLocations = false;
        }
       
    }


    function Checklocation(rowIndex, rowData) {
       // debugger;
        if (bCheckLocations) {
            bCheckLocation = false;
            return;
        }
        bCheckLocation = true;
        if (bCheckLocation) {
            RefreshtblWorkstationForSelectedLocation();
        }
        bCheckLocation = false;
    }


    function Unchecklocation(rowIndex, rowData) {
        ////debugger;
        bCheckLocation = true;
        if (rowData.LocationID > 0) {
            RefreshtblWorkstationForSelectedLocation();
        }

    }

    function RefreshtblWorkstation() {
        $('#tblWorkingUnit').empty();

        $.ajax({
            type: "GET",
            dataType: "json",
            url: '@Url.Action("GetsWorkstation", "MaterialTransactionRule")',
            //data: { id: nID },
            contentType: "application/json; charset=utf-8",
            success: function (data) {
                ////debugger;
                _oWorkstations = jQuery.parseJSON(data);
                if (_oWorkstations != null) {

                    data = _oWorkstations;
                    data = { "total": "" + data.length + "", "rows": data };
                    $('#tblWorkingUnit').datagrid('loadData', data);
                    for (i = 0; i < _oWorkstations.length; ++i) {
                        $('#tblWorkingUnit').datagrid('checkRow', i);

                    }
                    
                }
            },
            error: function (xhr, status, error) {
                alert(error);
            }
        });
    }
    
    var bCheckWorkingUnit = false;
    
    function CheckWorkingUnit(rowIndex, rowData) {
//             debugger;
        document.getElementById("tdDirection").style.display = '';
        var oWorkingUnit = $('#tblWorkingUnit').datagrid('getSelections');
        var oWUnit = $('#tblWorkingUnit').datagrid('getSelected');
        if (oWorkingUnit.length == 1) {
            if (!oWUnit.IsStore) {
                document.getElementById("tdDirection").style.display = 'none';
            }
        }
        
           
       
//        bCheckWorkingUnit = true;
//        if (bCheckWorkingUnit) {
//            RefreshtblWorkstationForSelectedLocation();
//        }
//        bCheckLocation = false;
    }


    function UncheckWorkingUnit(rowIndex, rowData) {
        ////debugger;

        document.getElementById("tdDirection").style.display = '';
        RefreshDirectionType();
        RefreshDirection();
//        bCheckLocation = true;
//        if (rowData.LocationID > 0) {
//            RefreshtblWorkstationForSelectedLocation();
//        }

    }
    function RefreshDirectionType() {
        $('#tblInOut').empty();

        $.ajax({
            type: "GET",
            dataType: "json",
            url: '@Url.Action("GetsDirection", "MaterialTransactionRule")',
            //data: { id: nID },
            contentType: "application/json; charset=utf-8",
            success: function (data) {
                ////debugger;
                _oPaths = jQuery.parseJSON(data);
                if (_oPaths != null) {

                    data = _oPaths;
                    data = { "total": "" + data.length + "", "rows": data };
                    $('#tblInOut').datagrid('loadData', data);
                   
                }
            },
            error: function (xhr, status, error) {
                alert(error);
            }
        });
    }


//    function CheckedLocationList() {
//        data = _oLocations;
//        data = { "total": "" + data.length + "", "rows": data };
//        $('#tblLocation').datagrid('loadData', data);
//        $('#tblLocation').datagrid({ selectOnCheck: false, checkOnSelect: false })

//        //debugger;
//        var rows = $('#tblLocation').datagrid('getRows');
//        for (i = 0; i < rows.length; ++i) {
//            $('#tblLocation').datagrid('checkRow', i);

//        }
//    }



    function AddLoc() {
       // //debugger;
        var oLocation = $('#tblLocation').datagrid('getSelections');
        if (oLocation.length != 1) {
            alert("Please select a single item from list!");
            return;
        }
        var oLoc = $('#tblLocation').datagrid('getSelected');
        var oMTR = {
            LocationID: oLoc.LocationID,
            LocationName: oLoc.Name,
            WorkingUnitID: 0,
            OperationUnitName: '',
            TriggerParentType: 0,
            TriggerParentTypeInString: '',
            InOutType: 0,
            InOutName: '',
            Direction: 0,
            DirectionName: '',
            ProductType: 0,
            ProductCategoryID: 0,
            ProductCategoryName: ''
        };
        ////debugger;    
        $('#tblSelectedItems').datagrid('appendRow', oMTR);

       
    }


    var DirectionForNonStore = 0;
    var InOutForNonStore = 0;
    
    function AddWU() {
        var oWorkingUnit = $('#tblWorkingUnit').datagrid('getSelections');
        if (oWorkingUnit.length != 1) {
            alert("Please select a single item from list!");
            return;
        }
       //debugger;
        var orow = $('#tblSelectedItems').datagrid('selectRow', 0);
        var oLoc = $('#tblSelectedItems').datagrid('getSelected');
        if (oLoc.LocationID == null || oLoc.LocationID <= 0) {
            alert("Please Select a Location first!");
            $('#tblLocation').focus();
            return false;
           
        }
        //debugger;
        var oWU = $('#tblWorkingUnit').datagrid('getSelected');
        if (!oWU.IsStore) {
            var oMTR = {
                LocationID: oLoc.LocationID,
                LocationName: oLoc.LocationName,
                WorkingUnitID: oWU.WorkingUnitID,
                OperationUnitName: oWU.OperationUnitName,
                TriggerParentType: 0,
                TriggerParentTypeInString: '',
                InOutType: 100,
                InOutName: 'None',
                Direction: 0,
                DirectionName: 'Uni-Directional',
                ProductType: 0,
                ProductCategoryID: 0,
                ProductCategoryName: ''
            };
        }
        else{
//        debugger;
            var oMTR = {
                LocationID: oLoc.LocationID,
                LocationName: oLoc.LocationName,
                WorkingUnitID: oWU.WorkingUnitID,
                OperationUnitName: oWU.OperationUnitName,
                TriggerParentType: 0,
                TriggerParentTypeInString: '',
                InOutType: 0,
                InOutName: '',
                Direction: 0,
                DirectionName: '',
                ProductType: 0,
                ProductCategoryID: 0,
                ProductCategoryName: ''

            };
        }
        ////debugger;    
        $('#tblSelectedItems').datagrid('updateRow', { index: 0, row: oMTR });


    }
    function AddTP() {
        var oTrigerParent = $('#tblTrigerParent').datagrid('getSelections');
        if (oTrigerParent.length != 1) {
            alert("Please select a single item from list!");
            return;
        }
//        debugger; 
        var orow = $('#tblSelectedItems').datagrid('selectRow', 0);
        var oLoc = $('#tblSelectedItems').datagrid('getSelected');
        if (oLoc.WorkingUnitID == null || oLoc.WorkingUnitID <= 0) {
            alert("Please Select a Working Unit first!");
            $('#tblWorkingUnit').focus();
            return false;

        }
        var oTR = $('#tblTrigerParent').datagrid('getSelected');
        var oMTR = {
            LocationID: oLoc.LocationID,
            LocationName: oLoc.LocationName,
            WorkingUnitID: oLoc.WorkingUnitID,
            OperationUnitName: oLoc.OperationUnitName,
            TriggerParentType: oTR.id,
            TriggerParentTypeInString: oTR.Name,
            InOutType: oLoc.InOutType,
            InOutName: oLoc.InOutName,
            Direction: oLoc.Direction,
            DirectionName: oLoc.DirectionName,
            ProductType: 0,
            ProductCategoryID: 0,
            ProductCategoryName: ''
        };
        ////debugger;    
        $('#tblSelectedItems').datagrid('updateRow', { index: 0, row: oMTR });


    }
    function AddDir() {
        var oDirection = $('#tblDirection').datagrid('getSelections');
        if (oDirection.length != 1) {
            alert("Please select a single item from list!");
            return;
        }

       // //debugger;
        var orow = $('#tblSelectedItems').datagrid('selectRow', 0);
        var oLoc = $('#tblSelectedItems').datagrid('getSelected');
        if (oLoc.TriggerParentType == null || oLoc.TriggerParentType <= 0) {
            alert("Please Select a Trigger Parent first!");
            $('#tblTrigerParent').focus();
            return false;

        }
        var oDir = $('#tblDirection').datagrid('getSelected');
        var oMTR = {
            LocationID: oLoc.LocationID,
            LocationName: oLoc.LocationName,
            WorkingUnitID: oLoc.WorkingUnitID,
            OperationUnitName: oLoc.OperationUnitName,
            TriggerParentType: oLoc.TriggerParentType,
            TriggerParentTypeInString: oLoc.TriggerParentTypeInString,
            InOutType: 0,
            InOutName: '',
            Direction: oDir.id,
            DirectionName: oDir.name,
            ProductType: 0,
            ProductCategoryID: 0,
            ProductCategoryName: ''
        };
        ////debugger;    
        $('#tblSelectedItems').datagrid('updateRow', { index: 0, row: oMTR });


    }

    function AddIO() {
        var oInOut = $('#tblInOut').datagrid('getSelections');
        if (oInOut.length != 1) {
            alert("Please select a single item from list!");
            return;
        }
       // //debugger;
        var orow = $('#tblSelectedItems').datagrid('selectRow', 0);
        var oLoc = $('#tblSelectedItems').datagrid('getSelected');
        if (oLoc.DirectionName == null || oLoc.DirectionName == '') {
            alert("Please Select a Direction first!");
            $('#tblDirection').focus();
            return false;

        }
        var oIO = $('#tblInOut').datagrid('getSelected');
//        debugger;
        var oMTR = {
            LocationID: oLoc.LocationID,
            LocationName: oLoc.LocationName,
            WorkingUnitID: oLoc.WorkingUnitID,
            OperationUnitName: oLoc.OperationUnitName,
            TriggerParentType: oLoc.TriggerParentType,
            TriggerParentTypeInString: oLoc.TriggerParentTypeInString,
            InOutType: oIO.id,
            InOutName: oIO.TypeName,
            Direction: oLoc.Direction,
            DirectionName: oLoc.DirectionName,
            ProductType: 0,
            ProductCategoryID: 0,
            ProductCategoryName: ''
        };
        ////debugger;    
        $('#tblSelectedItems').datagrid('updateRow', { index: 0, row: oMTR });


    }

    function ValidateInput() {
        var oRow = $('#tblSelectedItems').datagrid('getSelected');
        if (oRow == null) {
            alert("Please Insert rule component before save!");
            $('#tblSelectedItems').focus();
            return false;
        }

        if (oRow.LocationID <= 0) {
            alert("Please Add a Location!");
            $('#tblLocation').focus();
            return false;
        }
        if (oRow.WorkingUnitID <= 0) {
            alert("Please Add a Working Unit!");
            $('#tblWorkingUnit').focus();
            return false;
        }
        if (oRow.TriggerParentType <= 0) {
            alert("Please Add a Action!");
            $('#tblTrigerParent').focus();
            return false;
        }
        if (oRow.InOutType <= 0) {
            alert("Please Add a In Out Type!");
            $('#tblInOut').focus();
            return false;
        }
        if (oRow.Direction == null) {
            alert("Please Add a Direction!");
            $('#tblDirection').focus();
            return false;
        }
        if (document.getElementById('txtProductCategoryID').value < 0) {
            alert("Please Add a Product Category!");
            $('#txtProductCategory').focus();
            return false;
        }
        return true;
    }

    function RefreshObject() {
        var oRow = $('#tblSelectedItems').datagrid('getSelected');
        var oMTRSave = {
            
            LocationID: oRow.LocationID,
            WorkingUnitID: oRow.WorkingUnitID,
            TriggerParentTypeInt: oRow.TriggerParentType,
            InOutTypeInt: oRow.InOutType,
            Direction: oRow.Direction,
            ProductCategoryID: document.getElementById("txtProductCategoryID").value,
            IsActive: true,
            Note: document.getElementById("txtProductCategory").value,
            ProductTypeInt: 101
            //RecipeDetails:$('#tblRecipeDetail').datagrid('getRows')

        };
        return oMTRSave;
    } 

    function Save() {
      //  //debugger;
        if (!ValidateInput()) return;
        var oMTR = RefreshObject();
        var oRow = $('#tblSelectedItems').datagrid('getSelected');
        var SelectedRowIndex = $('#tblSelectedItems').datagrid('getRowIndex', oRow);

        $.ajax({
            type: "POST",
            dataType: "json",
            url: '@Url.Action("Save", "MaterialTransactionRule")',
            traditional: true,
            data: JSON.stringify(oMTR),
            contentType: "application/json; charset=utf-8",
            success: function (data) {
                debugger;
                oMTR = jQuery.parseJSON(data);
                
                if (oMTR.ErrorMessage == '' || oMTR.ErrorMessage == null) {
                    alert("MTR Saved sucessfully");
                    window.returnValue = oMTR;
                    data = oMTR;
                    data = { "total": "" + data.length + "", "rows": data };
                    $('#tblRefreshedItems').datagrid('loadData', data);
                    $('#tblSelectedItems').datagrid('deleteRow', SelectedRowIndex);

                   
                }
                else {
                    alert(oMTR.ErrorMessage);
                }
            },
            error: function (xhr, status, error) {
                alert(error);
            }

        });
    }

    var sIDs = "";
    function Gets() {
//        //debugger;
        $('#tblSelectedItems').empty();
        $.ajax({
            type: "GET",
            dataType: "json",
            url: '@Url.Action("Gets", "MaterialTransactionRule")',
            traditional: true,
            data: { sIDs: sIDs},
            
            contentType: "application/json; charset=utf-8",
            success: function (data) {
//                //debugger;

                _oItems = jQuery.parseJSON(data);
                if (_oItems != null) {

                    data = _oItems;
                    data = { "total": "" + data.length + "", "rows": data };
                    $('#tblRefreshedItems').datagrid('loadData', data);

                }
               
                else {
                    alert(_oItems.ErrorMessage);
                }
            },
            error: function (xhr, status, error) {
                alert(error);
            }

        });
    }
    

 // Add or refresh into DataGrid but not in Database
    $('#btnRefresh').click(function () {

//        //debugger;

        var oSelectedLocations = $('#tblLocation').datagrid('getSelections');
        if (oSelectedLocations == null) {
            alert("please select a Location");
            return;
        }
        var sLocationIDs = "";
        for (i = 0; i < oSelectedLocations.length; ++i) {
            var LocationID = oSelectedLocations[i].LocationID;
            sLocationIDs = sLocationIDs + LocationID + ',';

        }
        sLocationIDs = sLocationIDs.substring(0, sLocationIDs.length - 1);

        var oSelectedWorkingUnits = $('#tblWorkingUnit').datagrid('getSelections');
        if (oSelectedWorkingUnits == null) {
            alert("please select a Working Unit");
            return;
        }
        var sWorkingUnitIDs = "";
        for (i = 0; i < oSelectedWorkingUnits.length; ++i) {
            var WorkingUnitID = oSelectedWorkingUnits[i].WorkingUnitID;
            sWorkingUnitIDs = sWorkingUnitIDs + WorkingUnitID + ',';

        }
        sWorkingUnitIDs = sWorkingUnitIDs.substring(0, sWorkingUnitIDs.length - 1);


        var oSelectedTrigerParents = $('#tblTrigerParent').datagrid('getSelections');
        if (oSelectedTrigerParents == null) {
            alert("please select a Triger Parent");
            return;
        }
        var sTPs = "";
        for (i = 0; i < oSelectedTrigerParents.length; ++i) {
            var TPNum = oSelectedTrigerParents[i].id;
            sTPs = sTPs + TPNum + ',';

        }
        sTPs = sTPs.substring(0, sTPs.length - 1);

        var oSelectedInOuts = $('#tblInOut').datagrid('getSelections');

        var sIOs = "";
        for (i = 0; i < oSelectedInOuts.length; ++i) {
            var IONum = oSelectedInOuts[i].id;
            sIOs = sIOs + IONum + ',';

        }
        sIOs = sIOs.substring(0, sIOs.length - 1);

        var oSelectedDirections = $('#tblDirection').datagrid('getSelections');
        if (oSelectedDirections == null) {
            alert("please select a Direction");
            return;
        }

        var sDirections = "";
        for (i = 0; i < oSelectedDirections.length; ++i) {
            var Dir = oSelectedDirections[i].id;
            sDirections = sDirections + Dir + ',';

        }
        sDirections = sDirections.substring(0, sDirections.length - 1);

//        //debugger;
        if (confirm('Are you sure you want to search this selected things into the database?')) {
            sIDs = sLocationIDs + '~' + sWorkingUnitIDs + '~' + sTPs + '~' + sIOs + '~' + sDirections;
            Gets();
            
        }

    })
    var sSelections = '';
    function GetsPerSelection() {
        //        //debugger;
        $('#tblBiDirectionalRule').empty();
        $.ajax({
            type: "GET",
            dataType: "json",
            url: '@Url.Action("GetsPerSelection", "MaterialTransactionRule")',
            traditional: true,
            data: { sIDs: sSelections },

            contentType: "application/json; charset=utf-8",
            success: function (data) {
                               //debugger;

                _oItems = jQuery.parseJSON(data);
                if (_oItems != null) {

                    data = _oItems;
                    data = { "total": "" + data.length + "", "rows": data };
                    $('#tblBiDirectionalRule').datagrid('loadData', data);
                    for (i = 0; i < _oItems.length; ++i) {
                        if (_oItems[i]['MAP'] == 'Ase') {
                            $('#tblBiDirectionalRule').datagrid('checkRow', i);
                        }

                    }
                }

                else {
                    alert("Nothing Found For Mapping");
                }
            },
            error: function (xhr, status, error) {
                alert(error);
            }

        });
    }

    function Edit() {
//        debugger;
        var oItem = $('#tblRefreshedItems').datagrid('getSelected');
        if (oItem == null || oItem.MaterialTransactionRuleID <= 0) {
            alert("Please select a item from list!");
            return;
        }
        if (oItem.DirectionName != 'Bi') {
            alert("Please select a Bi directional rule!");
            return;
        }
        else {

            sSelections = oItem.WorkingUnitID + '~' + oItem.TriggerParentType + '~' + oItem.InOutType + '~' + 1 + '~' + oItem.ProductCategoryID + '~' + oItem.MaterialTransactionRuleID;
            GetsPerSelection();

        }


    }
    function EditOthers() {

     debugger;
        var oItem = $('#tblRefreshedItems').datagrid('getSelected');
        if (oItem == null || oItem.MaterialTransactionRuleID <= 0) {
            alert("Please select a item from list!");
            return;
        }

        if (oItem.DirectionName != 'Bi') {
            alert("Please select a Bi directional rule!");
            return;
        }
        else if (oItem.TriggerParentType != 111) {
            alert("Trigger Parent Type Must be Product Transfer !!!!");
            return;
        }
        else {

            sSelections = oItem.WorkingUnitID + '~' + oItem.TriggerParentType + '~' + oItem.InOutType + '~' + 1 + '~' + oItem.ProductCategoryID + '~' + oItem.MaterialTransactionRuleID;
            GetsPerOtherSelection();

        }

    }
    function GetsPerOtherSelection() {
        //        //debugger;
        $('#tblBiDirectionalRule').empty();
        $.ajax({
            type: "GET",
            dataType: "json",
            url: '@Url.Action("GetsPerOtherSelection", "MaterialTransactionRule")',
            traditional: true,
            data: { sIDs: sSelections },

            contentType: "application/json; charset=utf-8",
            success: function (data) {
                debugger;

                _oItems = jQuery.parseJSON(data);
                if (_oItems != null) {

                    data = _oItems;
                    data = { "total": "" + data.length + "", "rows": data };
                    $('#tblBiDirectionalRule').datagrid('loadData', data);
                    for (i = 0; i < _oItems.length; ++i) {
                        if (_oItems[i]['MAP'] == 'Ase') {
                            $('#tblBiDirectionalRule').datagrid('checkRow', i);
                        }

                    }
                }

                else {
                    alert(_oItems.ErrorMessage);
                }
            },
            error: function (xhr, status, error) {
                alert(error);
            }

        });
    }
    function Remove() {

        //debugger;
        var oItem = $('#tblRefreshedItems').datagrid('getSelected');
        var SelectedRowIndex = $('#tblRefreshedItems').datagrid('getRowIndex', oItem);
        if (oItem == null || oItem.MaterialTransactionRuleID <= 0) {
            alert("Please select a item from list!");
            return;
        }

        if (oItem.MaterialTransactionRuleID > 0) {
            
            $.ajax({
                type: "GET",
                dataType: "json",
                url: '@Url.Action("Delete", "MaterialTransactionRule")',
                data: { id: oItem.MaterialTransactionRuleID },
                contentType: "application/json; charset=utf-8",
                success: function (data) {
                    //                        //debugger;
                    sErrorMease = jQuery.parseJSON(data);
                    if (sErrorMease == "Delete sucessfully") {
                        alert("Delete sucessfully");
                        $('#tblRefreshedItems').datagrid('deleteRow', SelectedRowIndex);
                        RefreshGrid();
                    }
                    else {
                        alert(sErrorMease);
                    }
                },
                error: function (xhr, status, error) {
                    alert(error);
                }

            });
        }

    }
    function RefreshGrid() {
        data = $('#tblRefreshedItems').datagrid('getRows');
        data = { "total": "" + data.length + "", "rows": data };
        $('#tblRefreshedItems').datagrid('loadData', data);
       
    }       
    
    function Update() {

        //debugger;
        sMapIDs = "";
        var oItems = $('#tblBiDirectionalRule').datagrid('getSelections');
        
        for (i = 0; i < oItems.length; ++i) {
            var ID = oItems[i].MaterialTransactionRuleID;
            sMapIDs = sMapIDs + ID + ',';

        }
        sMapIDs = sMapIDs.substring(0, sMapIDs.length - 1);
        SaveMAP();
    }


    var sMapIDs = "";
    function SaveMAP() {
           //debugger;
          var MTR = $('#tblRefreshedItems').datagrid('getSelected');
          var MTRID = MTR.MaterialTransactionRuleID;
        $.ajax({
            type: "GET",
            dataType: "json",
            url: '@Url.Action("SaveMAP", "MaterialTransactionRule")',
            traditional: true,
            data: { IDs: sMapIDs, nMTRID: MTRID },
            contentType: "application/json; charset=utf-8",
            success: function (data) {
                //debugger;
                value = jQuery.parseJSON(data);
                if (value == 'Data Save Successfully') {
                    alert("Data Saved sucessfully");
                   
                }
                else {
                    alert(value);
                }
            },
            error: function (xhr, status, error) {
                alert(error);
            }

        });
    }




    function Action() {
        //debugger;
        var oItem = $('#tblRefreshedItems').datagrid('getSelected');
        if (oItem == null || oItem.MaterialTransactionRuleID <= 0) {
            alert("Please select a item from list!");
            return;
        }

       ChangeActivity();

    }

    function ChangeActivity() {
          //debugger;
        var oRow = $('#tblRefreshedItems').datagrid('getSelected');

        var SelectedRowIndex = $('#tblRefreshedItems').datagrid('getRowIndex', oRow);
        var oMTR = {

            MaterialTransactionRuleID: oRow.MaterialTransactionRuleID,
            LocationID: oRow.LocationID,
            WorkingUnitID: oRow.WorkingUnitID,
            TriggerParentTypeInt: oRow.TriggerParentType,
            InOutTypeInt: oRow.InOutType,
            Direction: oRow.Direction,
            ProductCategoryID: oRow.ProductType,
            IsActive: oRow.IsActive,
            Note: oRow.ProductType,
            ProductTypeInt: oRow.ProductTypeInt
           

        };

        $.ajax({
            type: "POST",
            dataType: "json",
            url: '@Url.Action("Activation", "MaterialTransactionRule")',
            traditional: true,
            data: JSON.stringify(oMTR),
            contentType: "application/json; charset=utf-8",
            success: function (data) {
                debugger;
                oMTR = jQuery.parseJSON(data);
                if (oMTR.ErrorMessage == '' || oMTR.ErrorMessage == null) {
                    alert("Activity changed sucessfully");
                    $('#tblRefreshedItems').datagrid('updateRow', { index: SelectedRowIndex, row: oMTR });
//                    window.returnValue = oMTR;
//                    window.close();
                }
                else {
                    alert(oMTR.ErrorMessage);
                }
            },
            error: function (xhr, status, error) {
                alert(error);
            }

        });
    }




    $('#btnSave').click(function () {

        ////debugger
        if (confirm('Are you sure you want to save this thing into the database?')) {
            Save();
        } else {
            return;
        }


    })

    function SelectedMTR() {
        //debugger;
        var oItem = $('#tblRefreshedItems').datagrid('getSelected');
        if (oItem == null || oItem.MaterialTransactionRuleID <= 0) {
            alert("Please select a item from list!");
            return;
        }
        var oMTR = {
            LocationID: oLoc.LocationID,
            LocationName: oLoc.Name,
            WorkingUnitID: 0,
            OperationUnitName: '',
            TriggerParentType: 0,
            TriggerParentTypeInString: '',
            InOutType: 0,
            InOutName: '',
            Direction: 0,
            DirectionName: '',
            ProductType: 0,
            ProductCategoryID: 0,
            ProductCategoryName: ''
        };
        

    }
    </script>