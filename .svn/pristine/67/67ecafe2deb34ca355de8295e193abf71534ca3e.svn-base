<html>
<body>
   
    @model ESimSol.BusinessObjects.ImportLC
    <div class="menuMainCollectionTable" id="divImportLC" class="easyui-panel" title="Request For LC Open" style="font-family:Tahoma; height:100%; width:100%">
               <div title="Request For LC Open" style="width:100%;">
                 <div style="float:left; width:100%">
                         <table style="width:100% ;height:150px">
                             <tr>
                                 <td style="width:65%;height:150px">
                                     <fieldset>
                                         <legend style="text-align:left; font-weight:bold;">Select P/I : </legend>
                                         <table style="width: 100%;height:150px; font-size: 12px;">
                                             <tr>
                                                 <td style="width:15%;">
                                                     <span style="float: right; padding-right: 10px;">Supplier</span>
                                                 </td>
                                                 <td style="width: 85%;">
                                                     <input id="txtContractor" class="reset-text" style="width:85%"  placeholder="Search by Supplier Name" />
                                                     <a id="btnPickContractor" href="javascript:void(0)" class="easyui-linkbutton ics-pick" iconcls="icon-pick" plain="true"></a>
                                                     <a id="btnResetContractor" href="javascript:void(0)" class="easyui-linkbutton ics-pick" iconcls="icon-clear" plain="true"></a>
                                                 </td>
                                             </tr>
                                             <tr>
                                                 <td colspan="2">
                                                     <table id="tblImportLCDetails" class="easyui-datagrid" style="width:100%; height:185px;"fitcolumns="ture" rownumbers="true" singleselect="true" autorowheight="false" toolbar="#toolbar">
                                                         <thead>
                                                             <tr>
                                                                 <th field="ImportPINo" width="145" align="left">
                                                                     PI No
                                                                 </th>
                                                                 <th field="DateOfApprovedInString" width="130" align="left">
                                                                     Date of Approve
                                                                 </th>
                                                                 <th field="IsPartShipmentAllowInString" width="150" align="left">
                                                                     Partial Shipment Allow
                                                                 </th>
                                                                 
                                                                 <th field="AmountSt" width="150" align="right">
                                                                     Amount
                                                                 </th>
                                                             </tr>
                                                         </thead>
                                                     </table>
                                                     <div id="toolbar">
                                                         Import PI : <input id="txtPINo" class="reset-text" style="width:150px;" placeholder="Search by P/I No" />
                                                         <a id="btnPickPI" href="javascript:void(0)" class="easyui-linkbutton ics-pick" iconcls="icon-pick" plain="true"></a>
                                                         <a href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-remove" plain="true"onclick="Delete()" id="btnDelete">Delete</a>
                                                     </div>
                                                 </td>
                                             </tr>
                                         </table>
                                     </fieldset>
                                 </td>
                                 <td style="width:35% ;height:150px">
                                     <fieldset>
                                         <legend style="text-align:left; font-weight:bold;"> P/I Information : </legend>
                                         <table style="width: 100%;height:225px; font-size: 13px; padding-top: 1px; vertical-align:top">
                                             <tr>
                                                 <td style="width: 30%;">  <div style="float: right;">  Supplier Name :</div></td>
                                                 <td style="width: 65%; padding-left: 5%;"><label id="lblContractorName" /></td>
                                             </tr>
                                             <tr>
                                                 <td style="width: 30%;">
                                                     <div style="float: right;">Advice Bank :</div>
                                                 </td>
                                                 <td style="width: 65%; padding-left: 5%;"><label id="lblAdviceBank" /></td>
                                             </tr>
                                             <tr>
                                                 <td style="width: 30%;"><div style="float: right;">Payment Terms:</div></td>
                                                 <td style="width: 65%; padding-left: 5%;"><label id="lblPaymentTrans" /></td>
                                             </tr>
                                             <tr>
                                                 <td style="width: 30%;"><div style="float: right;">LC Value :</div></td>
                                                 <td style="width: 65%; padding-left: 5%;"><label id="lblLCAmount" /></td>
                                             </tr>
                                             <tr>
                                                 <td style="width: 30%;"><div style="float: right;">File No:</div></td>
                                                 <td style="width: 65%; padding-left: 5%;"><input type="text" id="txtFileNo" style="width:80%;" /></td>
                                             </tr>
                                         </table>
                                     </fieldset>
                                 </td>
                             </tr>
                         </table>
                  </div>
                 <fieldset>
                    <legend><span style="font-size: 12px; font-weight: bold; color: Gray;">Payment Method</span></legend>
                    <table cellpadding="2" cellspacing="2" style="font-size: 12px; width: 100%;">
                        <tr>
                            <td style="width:15%;text-align:right">
                                LC Issuing Bank
                            </td>
                            <td style="width: 25%;text-align:left">
                                <select id="cboNegotiateBank" style="width: 100%;"></select>
                            </td>

                            <td style="width: 15%;text-align:right">
                                Asking LC Open Date
                            </td>
                            <td style="width: 8%;text-align:left">
                                <input id="dateOfAskingLCOpen" type="text" class="easyui-datebox" required="required"
                                       data-options="formatter:icsdateformat,parser:icsdateparser" style="width: 100%;" />
                            </td>
                            <td style="width: 15%;text-align:right">
                               LC Term
                            </td>
                            <td style="width: 22%;text-align:left">
                                <select id="cboLCTerm" style="width:100%;float:left;"></select>
                            </td>
                        </tr>
                        <tr>
                            <td style="width:15%;text-align:right">
                                Conversion Rate
                            </td>
                            <td style="width: 25%;text-align:left">
                                <input type="text" id="txtCRate" style="width:72%;" />
                                <span>
                                    <input type="text" id="txtCurrency" style="width: 20%;" disabled />
                                </span>
                            </td>

                            <td style="width: 15%;text-align:right">
                                LC Payment Type
                            </td>
                            <td style="width: 8%;text-align:left">
                                <select id="cboLCPaymentType" style="width: 100%;"></select>

                            </td>
                            <td style="width: 15%;text-align:right">
                                From
                            </td>
                            <td style="width: 22%;text-align:left">
                                <select id="cboPaymentInstruction" style="width:100%;float:right;"></select>
                              

                            </td>
                        </tr>
                        <tr>
                            <td style="width:15%;text-align:right">
                                Insurance Company
                            </td>
                            <td style="width: 25%;text-align:left">
                                <input id="txtInsurances" type="text" style="width: 65%" placeholder="Enter Name and press enter" />
                                <input id="btnInsurances" type="button" style="width: 30%;" value="Pick" />
                            </td>

                            <td style="width: 15%;text-align:right">
                                LCA Form No
                            </td>
                            <td style="width: 8%;text-align:left">
                                <input type="text" id="txtLCANo" style="width:97%;" />
                            </td>
                            <td style="width: 15%;text-align:right">
                                Trans Shipment
                            </td>
                            <td style="width: 23%;text-align:left">
                                <table>
                                    <tr>
                                        <td>
                                            <input type="checkbox" id="chkBoxTransAllowed" onchange="checkTransShipmentAllowed()" />Allowed
                                            <input type="checkbox" id="chkBoxTransNotAllowed" onchange="checkTransShipmentNotAllowed()" />Not Allowed
                                        </td>
                                    </tr>
                                </table>
                            </td>
                        </tr>
                        <tr>
                            <td style="width:15%;text-align:right">
                                Cover Note No
                            </td>
                            <td style="width: 25%;text-align:left">
                                <input type="text" id="txtCoverNoteNo" style="width:97%;" />
                            </td>

                            <td style="width: 15%;text-align:right">
                                Shipment Date
                            </td>
                            <td style="width: 8%;text-align:left">
                                <input id="dateOfShipment" type="text" class="easyui-datebox" required="required"
                                       data-options="formatter:icsdateformat,parser:icsdateparser" style="width: 160px;" />
                            </td>
                            <td style="width: 15%;text-align:right">
                                Part Shipment
                            </td>
                            <td style="width: 22%;text-align:left">
                                <input type="checkbox" id="chkBoxPartAllowed" onchange="checkPartShipmentAllowed()" /> Allowed
                                <input type="checkbox" id="chkBoxPartNotAllowed" onchange="checkPartShipmentNotAllowed()" />Not Allowed
                            </td>
                        </tr>
                        <tr>
                            <td style="width:15%;text-align:right">
                                Cover Note Date
                            </td>
                            <td style="width: 25%;text-align:left">
                                <input id="dateOfCoverNote" type="text" class="easyui-datebox" required="required"
                                       data-options="formatter:icsdateformat,parser:icsdateparser" style="width:240px;" />
                            </td>

                            <td style="width: 15%;text-align:right">
                                Expire Date
                            </td>
                            <td style="width: 8%;text-align:left">
                                <input id="dateOfExpire" type="text" class="easyui-datebox" required="required" data-options="formatter:icsdateformat,parser:icsdateparser"
                                       style="width: 160px;" />
                            </td>
                            <td style="width: 15%;text-align:right">
                                Shipment By
                            </td>
                            <td style="width: 22%;text-align:left">
                                <select id="cboShipmentBy" style="width:100%;"></select>
                            </td>
                        </tr>
                    </table>
                </fieldset>
                 <fieldset>
                         <legend style="font-weight: bold">Action : </legend>
                         <table border="0" cellspacing="2" cellpadding="2" style="font-size: 11px; width: 100%;height:8%;font-weight: bold; font-size: 12px">
                             <tr>
                                 <td style="width: 10%; font-size: 13px"></td>
                                 <td style="width: 10%; font-size: 13px"></td>
                                 <td style="width: 65%; text-align:right;"></td>
                                 <td style="width: 10%; font-size: 13px">
                                     <a id="btnSave" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-save" plain="true" onclick="Commit()">Commit</a>
                                 </td>
                                 <td style="width: 5%; font-size: 13px">
                                     <a id="btnClose" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-closed" plain="true" onclick="Close()">Close</a>
                                 </td>
                             </tr>
                         </table>
                     </fieldset>
               </div>

     </div>
</body>
</html>
<script type="text/javascript">
    var _sBaseAddress="";
    $(document).ready(function ()
    {
        _sBaseAddress =@Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(HttpContext.Current.Session[SessionInfo.BaseAddress]));
        var oImportLC =@Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(Model));
        var oCompany= @Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(ViewBag.Company));
        var oLCPaymentTypes= @Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(ViewBag.LCPaymentTypes));
        var oShipmentByObj= @Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(ViewBag.ShipmentByObj));
        var oLCTerms = @Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(ViewBag.LCTerms));
        var oPaymentInstructionObj= @Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(ViewBag.PaymentInstructionObj));
        var oCurrencys = @Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(ViewBag.Currencys));
        debugger;
        $('#divImportLC').data('ImportLC', oImportLC);
        $('#divImportLC').data('ImportLCDetails', oImportLC.ImportLCDetails);
        $('#divImportLC').data('Company', oCompany);
        $("#cboNegotiateBank").icsLoadCombo({List: oImportLC.BankBranchs,OptionValue: "BankBranchID",DisplayText: "BankBranchName"});
        $("#cboLCPaymentType").icsLoadCombo({List: oLCPaymentTypes,OptionValue: "id",DisplayText: "Value"});
        $("#cboShipmentBy").icsLoadCombo({List: oShipmentByObj,OptionValue: "id",DisplayText: "Value"});
        $("#cboLCTerm").icsLoadCombo({List: oLCTerms,OptionValue: "LCTermID",DisplayText: "NameDaysInString"});
        $("#cboPaymentInstruction").icsLoadCombo({List: oPaymentInstructionObj,OptionValue: "id",DisplayText: "Value"});
         $('#divImportLC').panel({ title:sessionStorage.getItem("ImportLCHeader")});
         RefreshControl();

 });


    $("#txtCRate").keypress(function (e) {
        if (e.which != 8 && e.which != 0  && e.which != 46  && (e.which < 48 || e.which > 57)) {
            return false;
        }
    });
  
    $("#btnPickContractor").click(function () {

        var sContractorName=$.trim($("#txtContractor").val());
        GetContractors(sContractorName);
    });
    $("#txtContractor").keydown(function (e) {
        var nkeyCode = e.keyCode || e.which;
        if(nkeyCode==13){
            var sContractorName=$.trim($("#txtContractor").val());
         
            GetContractors(sContractorName);
        }
        else if(nkeyCode==8){
            $("#txtContractor").val("");
            $('#txtContractor').removeClass('fontColorOfPickItem');
            $('#divImportLC').data('ImportLC').ContractorID=0;
            $("#cboCPIssueTo").empty();
        }
    });
    $("#btnResetContractor").click(function () {
        $("#txtContractor").val("");
        $('#divImportLC').data('ImportLC').ContractorID=0;
    });
    function GetContractors(sContractorName){

        var oContractor = {
            Params: '1' +'~'+sContractorName+'~'+sessionStorage.getItem('BUID'),
        };
        var obj = {
            BaseAddress: _sBaseAddress,
            Object: oContractor,
            ControllerName: "Contractor",
            ActionName: "ContractorSearchByNameType",
            IsWinClose: false
        };

        $.icsDataGets(obj, function (response) {

            if (response.status && response.objs.length > 0) {
                if (response.objs[0].ContractorID > 0) {
                    debugger;
                    var tblColums = [];
                    var oColumn = { field: "ContractorID", title: "Code", width: 50, align: "center" };tblColums.push(oColumn);
                    oColumn = { field: "Name", title: "Name", width: 190, align: "left" };tblColums.push(oColumn);
                    oColumn = { field: "Phone", title: "Phone", width: 140, align: "left" };tblColums.push(oColumn);

                    var oPickerParam = {
                        winid: 'winContractorPicker',
                        winclass:'clsContractorPicker',
                        winwidth: 460,
                        winheight: 460,
                        tableid: 'tblContractorPicker',
                        tablecolumns: tblColums,
                        datalist: response.objs,
                        multiplereturn: false,
                        searchingbyfieldName:'Name',
                        windowTittle: 'Contractor List'
                    };
                    $.icsPicker(oPickerParam);
                    IntializePickerbutton(oPickerParam);//multiplereturn, winclassName
                }
                else { alert(response.objs[0].ErrorMessage); }
            }
            else{
                alert("No contractor found.");
            }
        });


    }

    $("#btnInsurances").click(function () 
    {
        var stxtInsurances=$.trim($("#txtInsurances").val());
        GetInsurances(stxtInsurances);
    });
    $("#txtInsurances").keydown(function (e) {
        var nkeyCode = e.keyCode || e.which;
        if(nkeyCode==13)
        {
            var stxtInsurances=$.trim($("#txtInsurances").val());
            GetInsurances(stxtInsurances);
        }
        else if(nkeyCode==8)
        {
            $("#txtInsurances").val("");
            $('#txtInsurances').removeClass('fontColorOfPickItem');
            $('#divImportLC').data('ImportLC').InsuranceCompanyID=0;
            $("#cboCPIssueTo").empty();
        }
    });
    $("#btnResetInsurance").click(function () {
        $("#txtInsurances").val("");
        $('#divImportLC').data('ImportLC').InsuranceCompanyID=0;
    });
    function GetInsurances(stxtInsurances){

        var oContractor = {
            Params: '5' +'~'+stxtInsurances+'~'+sessionStorage.getItem('BUID'),
        };
        var obj = {
            BaseAddress: _sBaseAddress,
            Object: oContractor,
            ControllerName: "Contractor",
            ActionName: "ContractorSearchByNameType",
            IsWinClose: false
        };

        $.icsDataGets(obj, function (response) {

            if (response.status && response.objs.length > 0) {
                if (response.objs[0].ContractorID > 0) {
                    debugger;
                    var tblColums = [];
                    var oColumn = { field: "ContractorID", title: "Code", width: 50, align: "center" };tblColums.push(oColumn);
                    oColumn = { field: "Name", title: "Name", width: 190, align: "left" };tblColums.push(oColumn);
                    oColumn = { field: "Phone", title: "Phone", width: 140, align: "left" };tblColums.push(oColumn);

                    var oPickerParam = {
                        winid: 'winInsurances',
                        winclass:'clsInsurances',
                        winwidth: 460,
                        winheight: 460,
                        tableid: 'tblContractorPicker',
                        tablecolumns: tblColums,
                        datalist: response.objs,
                        multiplereturn: false,
                        searchingbyfieldName:'Name',
                        windowTittle: 'Contractor List'
                    };
                    $.icsPicker(oPickerParam);
                    IntializePickerbutton(oPickerParam);//multiplereturn, winclassName
                }
                else { alert(response.objs[0].ErrorMessage); }
            }
            else{
                alert("No contractor found.");
            }
        });


    }
  

    $("#btnPickPI").click(function () {
        debugger;
        if(parseInt($('#divImportLC').data('ImportLC').ContractorID)<=0)
        {
            alert("Please Pick Supplier.");
            return;
        }
        var oImportPI = {SupplierID:$('#divImportLC').data('ImportLC').ContractorID,BUID:sessionStorage.getItem('BUID'),ImportLCID:$('#divImportLC').data('ImportLC').ImportLCID};
        GetsPIs(oImportPI);
    });
    $("#txtPINo").keydown(function (e) {
        var nkeyCode = e.keyCode || e.which;
        if(nkeyCode==13){
           
            if(parseInt($('#divImportLC').data('ImportLC').ContractorID)<=0)
            {
                alert("Please Pick Supplier.");
                return;
            }
            var oImportPI = { ImportPINo: document.getElementById('txtPINo').value,SupplierID:$('#divImportLC').data('ImportLC').ContractorID,BUID:sessionStorage.getItem('BUID'),ImportLCID:$('#divImportLC').data('ImportLC').ImportLCID};
            GetsPIs(oImportPI);;
        }
        else if(nkeyCode==8){
            $("#txtPINo").val("");
            $('#divImportLC').data('ImportLC').ContractorID=0;
           
        }
    });
    $("#btnResetImportPI").click(function () {
        $("#txtPINo").val("");
        $('#divImportLC').data('ImportLC').ContractorID=0;
    });
    function GetsPIs(oImportPI)
    {
        var obj = {
            BaseAddress: _sBaseAddress,
            Object: oImportPI,
            ControllerName: "ImportLC",
            ActionName: "GetsImportPIs",
            IsWinClose: false
        };

        $.icsDataGets(obj, function (response) {

            if (response.status && response.objs.length > 0) 
            {
                if (response.objs[0].ImportPIID > 0) {
                    debugger;
                    var tblColums = [];
                    var tblColums = [];var oColumn = { field: "ImportPINo", title: "No", width: 150, align: "left" };tblColums.push(oColumn);
                    oColumn = { field: "AmountSt", title: "Amount", width: 150, align: "right" };tblColums.push(oColumn);
                    oColumn = { field: "ContractorName", title: "Name", width: 150, align: "left" };tblColums.push(oColumn);
                    var oPickerParam = {
                        winid: 'winImportPI',
                        winclass:'clsImportPI',
                        winwidth: 600,
                        winheight: 460,
                        tableid: 'tblImportPIs',
                        tablecolumns: tblColums,
                        datalist: response.objs,
                        multiplereturn: true,
                        searchingbyfieldName:'ImportPINo',
                        windowTittle: 'P/I List'
                    };
                    $.icsPicker(oPickerParam);
                    IntializePickerbutton(oPickerParam);//multiplereturn, winclassName
                }
                else { alert(response.objs[0].ErrorMessage); }
            }
            else{
                alert("Data not found.");
            }
        });
    }
    //End PI LC Pick
    function IntializePickerbutton(oPickerobj) {
        $("#" + oPickerobj.winid).find("#btnOk").click(function () {
            //for Single Select
            SetPickerValueAssign(oPickerobj);
        });
        $(document).find('.' + oPickerobj.winclass).keydown(function (e) {
            if (e.which == 13)//enter=13
            {
                SetPickerValueAssign(oPickerobj);

            }
        });
    }
    function SetPickerValueAssign(oPickerobj) {
        debugger;
        var oreturnObj = null, oreturnobjs = [];
        if (oPickerobj.multiplereturn) {
            oreturnobjs = $('#' + oPickerobj.tableid).datagrid('getChecked');
        } else {
            oreturnObj = $('#' + oPickerobj.tableid).datagrid('getSelected');
        }
        $("#" + oPickerobj.winid).icsWindow("close");
        $("#" + oPickerobj.winid).remove();
        if (oPickerobj.winid == 'winContractorPicker') {
            if (oreturnObj != null && oreturnObj.ContractorID > 0) {
                
                $('#divImportLC').data('ImportLC').ContractorID = oreturnObj.ContractorID;
                $('#txtContractor').val(oreturnObj.Name);
                $('#txtContractor').addClass('fontColorOfPickItem');
                $('#txtContractor').focus();
            }
        }
        if (oPickerobj.winid == 'winInsurances') {
            if (oreturnObj != null && oreturnObj.ContractorID > 0) 
            {
                $('#divImportLC').data('ImportLC').InsuranceCompanyID = oreturnObj.ContractorID;
                $('#txtContractor').val(oreturnObj.Name);
                $('#txtContractor').addClass('fontColorOfPickItem');
                $('#txtInsurances').focus();
            }
        }
        if (oPickerobj.winid === 'winBranch') {
            if (oreturnObj != null && parseInt(oreturnObj.BankBranchID) > 0) {
                var txtBranchName = document.getElementById("txtBranchName");
                txtBranchName.value = oreturnObj.BankBranchName;
                txtBranchName.style.color = "blue";
                txtBranchName.style.fontWeight = "bold";
                $('#divImportLC').data('ImportLC').BankBranchID= parseInt(oreturnObj.BankBranchID);
            }
        }
        else if (oPickerobj.winid == 'winImportPI')
        {
            if (oreturnobjs.length>0 && oreturnobjs[0].ImportPIID > 0) {
                var txtPINo = document.getElementById("txtPINo");
                txtPINo.value = "";
             
                AppendImportLCDetail(oreturnobjs);
                $('#txtPINo').focus();
            }
        }
    }
    
 function RefreshControl()
 {

     document.getElementById('txtCurrency').value =$('#divImportLC').data('Company').CurrencyNameSymbol;
     var oImportLCDetails= $('#divImportLC').data('ImportLCDetails');
     var oTempImportLC = $('#divImportLC').data('ImportLC');
     if(oImportLCDetails.length>0)
     {
         document.getElementById('lblAdviceBank').innerHTML   =   oImportLCDetails[0].BankName;
         $('#divImportLC').data('ImportLC').Currency=  oImportLCDetails[0].Currency;
         document.getElementById('lblPaymentTrans').innerHTML =  oImportLCDetails[0].LCTermsName;
     }
     LoadintoGrid(oImportLCDetails);
     document.getElementById('lblContractorName').innerHTML   =   oTempImportLC.ContractorName;
     $("#cboLCPaymentType").val( oTempImportLC.LCPaymentTypeInt);
     $('#dateOfAskingLCOpen').datebox('setValue', oTempImportLC.LCRequestDateInString);
     $('#dateOfShipment').datebox('setValue', oTempImportLC.ShipmentDateInString);
     $('#dateOfExpire').datebox('setValue', oTempImportLC.ExpireDateInString);
     $('#dateOfCoverNote').datebox('setValue', oTempImportLC.CoverNoteDateInString);

     $('#txtContractor').val( oTempImportLC.ContractorName);
     $('#txtInsurances').val( oTempImportLC.InsuranceName);
     $('#txtContractor,#txtInsurances').addClass('fontColorOfPickItem');

     $('#cboNegotiateBank').val( oTempImportLC.BankBranchID_Nego);
     $('#txtCRate').val( oTempImportLC.CCRate);
     $('#txtLCANo').val( oTempImportLC.LCANo);
     $('#txtCoverNoteNo').val( oTempImportLC.LCCoverNoteNo);
     $('#txtFileNo').val(oTempImportLC.FileNo);
     $('#cboShipmentBy').val(oTempImportLC.ShipmentBy);
     $('#cboLCTerm').val(oTempImportLC.LCTermID);
     $('#cboPaymentInstruction').val(oTempImportLC.PaymentInstructionInt);
     if(oTempImportLC.IsTransShipmentAllow==true)
     {
         document.getElementById('chkBoxTransAllowed').checked=true;
     }
     else
     {
         document.getElementById('chkBoxTransNotAllowed').checked=true;
     }
     if(oTempImportLC.IsPartShipmentAllow==true)
     {
         document.getElementById('chkBoxPartAllowed').checked=true;
     }
     else
     {
         document.getElementById('chkBoxPartNotAllowed').checked=true;
     }
     if(sessionStorage.getItem("ImportLCHeader")=='View Import LC')
     {
         $('#btnSave,#btnSaveLetter').hide();
     }
     NewTotal();
     RefresgCRate();
 }

 function RefresgCRate()
 {
     var oTempImportLC = $('#divImportLC').data('ImportLC');
     if(oTempImportLC.CurrencyID=== parseInt($('#divImportLC').data('Company').BaseCurrencyID))
     {
         $('#txtCRate').val(parseFloat(1).toFixed(3));
         $("#txtCRate").prop("disabled", true);
     }
     else
     {
         $('#txtCRate').val(parseFloat(oTempImportLC.CCRate).toFixed(3));
         $("#txtCRate").prop("disabled", false);
     }
 }

 function LoadintoGrid(oImportLCDetails)
 {
            data=oImportLCDetails;
            data={"total":""+data.length+"","rows":data};
            $('#tblImportLCDetails').datagrid('loadData',data);
 }

 function RefreshObject()
 {
     var getRows=$('#tblImportLCDetails').datagrid('getRows');
     var oTempImportLC = $('#divImportLC').data('ImportLC');
     var oImportLC={
                    ImportLCID                  :    oTempImportLC.ImportLCID,
                    VersionNo                     :  '',
                    ContractorID                  :   oTempImportLC.ContractorID,
                    BankBranchID_Nego             :  document.getElementById('cboNegotiateBank').value,
                    InsuranceCompanyID            : oTempImportLC.InsuranceCompanyID,
                    Amount                        :  oTempImportLC.Amount,
                    CCRate                        :  parseFloat($('#txtCRate').val()),
                    CurrencyID                    : oTempImportLC.CurrencyID,
                    LCPaymentType                 :  $('#cboLCPaymentType').val(),
                    LCCurrentStatus               :  8,
                    ExpireDate                    :  new Date($('#dateOfExpire').datebox('getValue')),
                    ShipmentDate                  :  new Date($('#dateOfShipment').datebox('getValue')),
                    LCCoverNoteNo                 :  document.getElementById('txtCoverNoteNo').value,
                    CoverNoteDate                 :  new Date($('#dateOfCoverNote').datebox('getValue')),
                    LCRequestDate                 :  new Date($('#dateOfAskingLCOpen').datebox('getValue')),
                    LCANo                         :  document.getElementById('txtLCANo').value,
                    FileNo                        :$('#txtFileNo').val(),
                    ImportLCDetails              :  $('#tblImportLCDetails').datagrid('getRows'),
                    LCTermID                 :  $('#cboLCTerm').val(),
                    IsTransShipmentAllow     :  oTempImportLC.IsTransShipmentAllow,
                    IsPartShipmentAllow      :  oTempImportLC.IsPartShipmentAllow,
                    PaymentInstructionInt : $('#cboPaymentInstruction').val(),
                    BUID                    :sessionStorage.getItem('BUID'),
                    ShipmentBy               :  $('#cboShipmentBy').val()

     }
     return oImportLC;
 }

 function Commit()
 {
     var oTempImportLC = $('#divImportLC').data('ImportLC');
     if( oTempImportLC.ContractorID  == 0)
    {
         alert("Please Pick a Suppiler");
         $("#txtContractor").focus();
        return false;
    }
    
    var getRows=$('#tblImportLCDetails').datagrid('getRows');

    if(getRows.length == 0)
    {
        alert("Please Add a Purchase Contract");
        return false;
    }
    if($("#cboNegotiateBank").val() == "0")
    {
        alert("Please Select a Negotiate Bank");
        $("#cboNegotiateBank").focus();
        return false;
    }
    if(parseInt($("#txtCRate").val()) == 0)
    {
        alert("Please Give Conversion Rate");
        $("#txtCRate").focus();
        return false;
    }
    if($("#txtCRate").val() == "")
    {
        alert("Please Give Conversion Rate");
        $("#txtCRate").focus();
        return false;
    }
    if(oTempImportLC.InsuranceCompanyID<=0)
    {
        alert("Please Select an Insurance Company");
        $("#txtInsurances").focus();
        return false;
    }
    if($("#txtLCANo").val() == "")
    {
        alert("Please Give LCA No");
        $("#txtLCANo").focus();
        return false;
    }
    if($("#txtCoverNoteNo").val() == "")
    {
        alert("Please Give Cover Note No");
        $("#txtCoverNoteNo").focus();
        return false;
    }
    if($('#txtFileNo').val()!="" && $('#txtFileNo').val()!=null)
    {
        var FileNo = $('#txtFileNo').val().split('/');
        if(FileNo.length>2)
        {
            alert("Please Type Correct format for File No.");
            $("#txtFileNo").focus();
            return false;
        }
        if(parseInt(FileNo[0].length)!=4)
        {
            alert("Please Type Correct format for First part of File No.");
            $("#txtFileNo").focus();
            return false;
        }
        if(parseInt(FileNo[1].length)!=2)
        {
            alert("Please Type Correct format for Last part of File No.");
            $("#txtFileNo").focus();
            return false;
        }
    }


    if($("#cboLCPaymentType option:selected").text() == "None")
    {
        alert("Please Select a LC Payment Type");
        $("#cboLCPaymentType").focus();
        return false;
    }
    var oImportLC=RefreshObject();
    $.ajax({
            type: "POST",
            dataType: "json",
            url : _sBaseAddress+"/ImportLC/SaveLog",
            traditional: true,
            data:  JSON.stringify(oImportLC),
            contentType: "application/json; charset=utf-8",
            success: function (data) {
                debugger;
              var  oImportLC = jQuery.parseJSON(data);
              if (oImportLC.ErrorMessage=="") 
              {
                    $('#divImportLC').data('ImportLC',oImportLC);//set LC
                    var oImportLCs =sessionStorage.getItem("ImportLCs");
                    var nIndex= parseInt(sessionStorage.getItem("SelectedRowIndex"));
                    if(oImportLCs!=null)
                    {
                        oImportLCs = jQuery.parseJSON(oImportLCs);
                    }
                    else
                    {
                        oImportLCs=[];
                    }
                    if(nIndex!=-1)
                    {
                        oImportLCs[nIndex]=oImportLC;
                    }
                    else
                    {
                        sessionStorage.setItem("SelectedRowIndex", oImportLCs.length);
                        oImportLCs.push(oImportLC);
                    }
                    sessionStorage.setItem("ImportLCs", JSON.stringify(oImportLCs));
                    alert("Data Saved successfully");
                    window.location.href = sessionStorage.getItem("BackLink");
    
                }
                else
                 {
                    alert(oImportLC.ErrorMessage);
                }
            },
            error: function (xhr, status, error) {
                alert(error);
            }


        });

 }

 function Delete()
 {
     var oImportLCDetail= $('#tblImportLCDetails').datagrid('getSelected');
     if(oImportLCDetail==null || oImportLCDetail.ImportPIID<=0)
     {
         alert("Please Select a Item from List");  
     }
     if (!confirm("Confirm to Delete?")) return ;
     var nSelectedRowIndex=$('#tblImportLCDetails').datagrid('getRowIndex',oImportLCDetail);
     $('#tblImportLCDetails').datagrid('deleteRow',nSelectedRowIndex);
     alert("Delete sucessfully");
     NewTotal();

 }
 function NewTotal()
 {
     var getRows=$('#tblImportLCDetails').datagrid('getRows');
     var nTotalValue=0;
     for(var i=0; i<getRows.length;i++)
     {
         nTotalValue=nTotalValue+getRows[i].Amount;
     }
     if($('#divImportLC').data('ImportLC').Currency==null)
     {
         $('#divImportLC').data('ImportLC').Currency="";
     }
     $('#divImportLC').data('ImportLC').Amount = nTotalValue;
     document.getElementById('lblLCAmount').innerHTML= $('#divImportLC').data('ImportLC').Currency+" "+parseFloat(nTotalValue).toFixed(2);

 }

 function AppendImportLCDetail(oNewImportLCDetails)
{
     debugger;
     var oImportLCDetails=$('#tblImportLCDetails').datagrid('getRows');
     for (var i = 0;i<oNewImportLCDetails.length;i++)
     {
         if(!ICS_IsExist(oImportLCDetails,'ImportPIID',oNewImportLCDetails[i].ImportPIID))
         {
             $('#tblImportLCDetails').datagrid('appendRow', oNewImportLCDetails[i]);
             document.getElementById('lblPaymentTrans').innerHTML =  oNewImportLCDetails[i].LCTermsName;
             document.getElementById('lblContractorName').innerHTML= oNewImportLCDetails[i].ContractorName;
             document.getElementById('lblAdviceBank').innerHTML=oNewImportLCDetails[i].BankName;
             $('#divImportLC').data('ImportLC').Currency=oNewImportLCDetails[i].Currency;
             $('#divImportLC').data('ImportLC').CurrencyID=oNewImportLCDetails[i].CurrencyID;
             $('#divImportLC').data('ImportLC').ContractorID=oNewImportLCDetails[i].SupplierID;
             $('#divImportLC').data('ImportLC').ContractorName=oNewImportLCDetails[i].SupplierName;
             $('#divImportLC').data('ImportLC').LCTermID=oNewImportLCDetails[i].LCTermID;
             $('#divImportLC').data('ImportLC').PaymentInstructionInt =oNewImportLCDetails[i].PaymentInstructionInt;
             $('#divImportLC').data('ImportLC').LCTermsName=oNewImportLCDetails[i].LCTermsName;
         }
     }
    RefreshControl();
}


function Close()
{
    window.location.href = sessionStorage.getItem("BackLink");
}


    /////End Letter Print
function checkTransShipmentAllowed()
{
    if(document.getElementById("chkBoxTransAllowed").checked==true)
    {
        document.getElementById("chkBoxTransNotAllowed").checked=false;
        $('#divImportLC').data('ImportLC').IsTransShipmentAllow=true;
    }
}
function checkTransShipmentNotAllowed()
{
    if(document.getElementById("chkBoxTransNotAllowed").checked==true)
    {
        document.getElementById("chkBoxTransAllowed").checked=false;
        $('#divImportLC').data('ImportLC').IsTransShipmentAllow=false;
    }
}

function checkPartShipmentAllowed()
{
    if(document.getElementById("chkBoxPartAllowed").checked==true)
    {
        document.getElementById("chkBoxPartNotAllowed").checked=false;
        $('#divImportLC').data('ImportLC').IsPartShipmentAllow=true;
    }
}
function checkPartShipmentNotAllowed()
{
    if(document.getElementById("chkBoxPartNotAllowed").checked==true)
    {
        document.getElementById("chkBoxPartAllowed").checked=false;
        $('#divImportLC').data('ImportLC').IsPartShipmentAllow=false;
    }
}

function AddClause()
{

    var oImportLCClauseSetups = [];
    var oParameter = new Object();
    var url = _sBaseAddress + "/ImportLCClauseSetup/ViewImportLCClauseSetups";
    oImportLCClauseSetups = window.showModalDialog(url, oParameter, 'dialogHeight:400px;dialogWidth:710px;dialogLeft:400;dialogTop:150;center:yes;resizable:no;status:no;scroll:no');
}



$(document).keydown(function(e) {
    if(e.which == 27)//escape=27
    {
        window.location.href = sessionStorage.getItem("BackLink");
    }
});

  ////Start Non LC Invoice
</script>


