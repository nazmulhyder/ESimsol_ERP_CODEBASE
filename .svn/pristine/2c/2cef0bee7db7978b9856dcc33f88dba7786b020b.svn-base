@model IEnumerable<ESimSol.BusinessObjects.LabDip>
    @{
        ViewBag.Title = "In Lab";
    }
   
    <div id="progressbarParent" style="width:100%;height:100%;margin:0 auto;text-align:center; margin-left: auto;margin-right: auto;left: 0;right: 0;z-index: 1;">
        <div style="margin: 0px auto;margin-top: 251px;text-align:center;width:390px;">
            <label style="font-size:18px;">Please wait</label>
            <div id="progressbar" style="width:100%;height:37px;"></div>
        </div>
    </div>
    <div class="menuMainCollectionTable">
        @*<table id="tblLabDips" title="PO(s)" class="easyui-datagrid" style="width:100%; height:100%" singleselect="true" data-options="fitColumns:false, rownumbers:true, pagination:false, autoRowHeight:false, toolbar: '#toolbarLabDip'">*@
            <table id="tblLabDips" title="PO(s)" style="width:100%; height:100%" class="easyui-datagrid" fit="true" fitcolumns="false" rownumbers="true" pagination="false" singleselect="false" autorowheight="true" toolbar="#toolbarLabDip" data-options="rowStyler: function(index,row){

                                        if (row.CurrentStatusSt=='Received'){
                                            return 'color:#265a88; font-weight:bold;';
                                        }
                                        else if (row.CurrentStatusSt==''){
                                            return 'color:#f21443; font-weight:bold;';
                                        }
                                    }
                    ">
                <thead>
                @*LabdipNo, SeekingDate, OrderDate, FSCDetailID, FabricNo, ProductName, ActualConstruction, FSCID, Construction, SCNo,*@ 
                @*ContractorName, MktPerson, LightSource, ProcessTypeName, FabricWeaveName, FinishTypeName*@

                <th data-options="field:'checked',checkbox:true"> </th>
                <th field="ExeNo" width="11%" align="left">H/L No</th>
                @*<th field="RelabCount" width="4%" align="left">V No</th>*@
                
                <th field="OrderDateStr" width="8%" align="center">Order Date</th>
                @*<th field="SeekingDateStr" width="8%" align="center">Seeking Date</th>*@
                @*<th field="SCDateSt" width="8%" align="center">PO Issue Date</th>*@
                <th field="SCNo" width="11%" align="left">PO No</th>
               
                <th field="ContractorName" width="15%" align="left">Buying House</th>
                @*<th field="MKTGroup" width="8%" align="left"> MKT Team</th>*@
                <th field="MktPerson" width="12%" align="left"> Concern Person</th>
                <th field="FabricNo" width="10%" align="left"> MKT Ref</th>
                <th field="OrderStatusStr" width="10%" align="left">Order Status</th>
                <th field="Construction" width="10%" align="left"> Construction</th>
                <th field="ActualConstruction" width="10%" align="left"> Actual Construction</th>
                <th field="LabStatusSt" width="10%" align="left">Lab Status</th>
                @*<th field="FabricReceiveDateStr" width="8%" align="left">Receive Date</th>*@
                @*<th field="ExeNo" width="10%" align="left"> <span id="lblDispoHLGrd">H/L No</span> </th>*@
                @*<th field="StyleNo" width="10%" align="left">Style No</th>*@
                @*<th field="BuyerReference" width="10%" align="left">Buyer Ref</th>*@
                @*<th field="HLReference" width="10%" align="left"> Dispo No/ H/L Ref</th>*@
                @*<th field="ColorInfo" width="10%" align="left"> Color</th>*@
                <th field="ProductName" width="10%" align="left">Composition</th>
                <th field="ProcessTypeName" width="10%" align="left"> Fabric type </th>
                <th field="FabricWeaveName" width="10%" align="left"> Weave</th>
                <th field="LightSourceName" width="10%" align="left"> LightSource</th>
                @*<th field="Size" width="10%" align="left"> Size</th>*@
                <th field="FinishTypeName" width="10%" align="left">Finish Type</th>
                @*<th field="FabricWidth" width="15%" align="left">Width</th>*@
                </thead>
            </table>

        <div id="toolbarLabDip">
            <input id="txtHLNO" type="text" placeholder="Search by HL/Dispo No" style="width:120px" />
            <input id="txtSearchbyPONo" type="text" placeholder="Search by PO No" style="width:120px" />
            <input id="txtSearchbyFabricNo" type="text" placeholder="Search by Ref No" style="width:120px" />
            <a id="btnAdvSearch" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-search" plain="true">Adv. Search</a>
            @*<a id="btnReceive" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-ok" plain="true">Receive</a>
            <a id="btnExeNoEntry" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-ok" plain="true"><span id="lblDispoHL">Entry No</span></a>*@
            @*<a id="btnReceive" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-ok" plain="true">Receive</a>*@
            @*<a id="btnEditFabric" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-ok" plain="true">Edit Fabric</a>*@
            @*<a id="btnExeNoEntry" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-ok" plain="true"><span id="lblDispoHL">Dispo No</span></a>*@
            @*<a id="btnDyeingOrder" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-ok" plain="true"><span id="lblDispoHL">Dyeing Order</span></a>*@
            @*<a id="btnRequestForLabdipTemp" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-ok" plain="true">Req For Labdip</a>*@
            @*<a id="btnRequestForLabdip" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-ok" plain="true">Labdip</a>*@


            <a id="btnAddLabDip" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-ok" plain="true">Create Labdip</a>
            <a id="btnViewPO" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-ok" plain="true">Add Color</a>
            <a id="btnLabDone" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-ok" plain="true">Labdip Done</a>
            
            
            <a id="btnPrintPO" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-print" plain="true">Preview(PO)</a>
            <a id="btnPrintLD" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-print" plain="true">Preview(Labdip)</a>        
            @*<a id="btnPrint" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-print" plain="true">Print</a>*@
            <a id="btnPrintXL" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-excel" plain="true">ExportXL</a>
            @*<a id="btnPrintHLDelivery" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-print" plain="true">HL Delivery</a>*@
            @*<a id="btnPrintHLSwatch" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-print" plain="true">HL Swatch</a>
            <a id="btnFabricPattern" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-ok" plain="true">Pattern</a>
            <a id="btnSubmitFabricInFabricPattern" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-ok" plain="true">Submit to HO</a>
            <a id="btnSpecification" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-details" plain="true">Specification</a>
            <a id="btnFabricHistory" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-details" plain="true">Fabric History</a>*@
        </div>
    </div>
    <div id="winAdvSearch" class="easyui-window winClass" style="width:620px" title="Adv. Search" data-options="modal:true,closed:true,collapsible:false,minimizable:false,maximizable:false,closable:false">
        <div>
            <fieldset style="margin-bottom: 0px;">
                <legend>Searching Criteria</legend>
                <table style="width:100%;text-align:right;">
                    <tr>
                        <td style="width:20%;text-align:right;">
                            <label>P/I No :</label>
                        </td>
                        <td style=" width:30%;text-align:left;">
                            <input id="txtPINo" style="width:100%;" type="text" />
                        </td>
                        <td style=" width:20%;text-align:right;">
                            <label id="lblFabricNoAdv"> Mkt Ref No :</label>
                        </td>
                        <td style=" width:30%;text-align:left;">
                            <input id="txtFabricID" style="width:80%;" type="text" />
                        </td>
                    </tr>

                    <tr>
                        <td style=" width:20%;text-align:right;">
                            <label>Issue To :</label>
                        </td>
                        <td colspan="3" style=" width:80%;text-align:left;">
                            <input id="txtContractorAdvS" style="width:80%;" type="text" placeholder="Type & Press Enter" />
                            <a id="btnPickContractorAdvS" href="javascript:void(0)" class="easyui-linkbutton ics-pick" iconcls="icon-pick" plain="true"></a>
                            <a id="btnClrContractorAdvS" href="javascript:void(0)" class="easyui-linkbutton ics-pick" iconcls="icon-clear" plain="true"></a>
                        </td>
                    </tr>

                    <tr>
                        <td style=" width:20%;text-align:right;">
                            <label>Buying House :</label>
                        </td>
                        <td colspan="3" style=" width:80%;text-align:left;">
                            <input id="txtDeliverTo" style="width:80%;" type="text" placeholder="Type & Press Enter" />
                            <a id="btnPickDeliverTo" href="javascript:void(0)" class="easyui-linkbutton ics-pick" iconcls="icon-pick" plain="true"></a>
                            <a id="btnClrDeliverTo" href="javascript:void(0)" class="easyui-linkbutton ics-pick" iconcls="icon-clear" plain="true"></a>
                        </td>
                    </tr>
                    <tr>
                        <td style=" width:20%;text-align:right;">
                            <label>Mkt Account:</label>
                        </td>
                        <td colspan="3" style=" width:80%;text-align:left;">
                            <input id="txtMktAccount" class="reset-text" placeholder="Search Concern Person" style="width:80%" />
                            <a id="btnPickMktAccount" href="javascript:void(0)" class="easyui-linkbutton ics-pick" iconcls="icon-pick" plain="true"></a>
                            <a id="btnResetMktPerson" href="javascript:void(0)" class="easyui-linkbutton ics-pick" iconcls="icon-clear" plain="true"></a>
                        </td>
                    </tr>
                    <tr>
                        <td style=" width:20%;text-align:right;">
                            <label>PO Date:</label>
                        </td>
                        <td colspan="3" style=" width:80%;text-align:right;">
                            <div style="float:left; width:100%">
                                <div style="float:left; width:30%">
                                    <select style="width:95%;" id="cboPODate" onchange="DateActions_OPDate(); "></select>
                                </div>
                                <div style="float:left; width:25%; padding-left:5px;">
                                    <input id="txtFromPODate" type="text" style="width: 110px;" class="easyui-datebox" required="required" data-options="formatter:icsdateformat,parser:icsdateparser" />
                                </div>
                                <div style="float:left; width:5%; text-align:center">to</div>
                                <div style="float:left; width:25%; padding-left:5px;">
                                    <input id="txtToPODate" type="text" style="width: 110px;" class="easyui-datebox" required="required" data-options="formatter:icsdateformat,parser:icsdateparser" />
                                </div>
                            </div>
                        </td>
                    </tr>
                    <tr>
                        <td style=" width:20%;text-align:right;">
                            <label>Approve Date:</label>
                        </td>
                        <td colspan="3" style=" width:80%;text-align:right;">
                            <div style="float:left; width:100%">
                                <div style="float:left; width:30%">
                                    <select style="width:95%;" id="cboApproveDate" onchange="DateActions_ApproveDate(); "></select>
                                </div>
                                <div style="float:left; width:25%; padding-left:5px;">
                                    <input id="txtFromApproveDate" type="text" style="width: 110px;" class="easyui-datebox" required="required" data-options="formatter:icsdateformat,parser:icsdateparser" />
                                </div>
                                <div style="float:left; width:5%; text-align:center">to</div>
                                <div style="float:left; width:25%; padding-left:5px;">
                                    <input id="txtToApproveDate" type="text" style="width: 110px;" class="easyui-datebox" required="required" data-options="formatter:icsdateformat,parser:icsdateparser" />
                                </div>
                            </div>
                        </td>
                    </tr>
                    <tr>
                        <td style=" width:20%;text-align:right;">
                            <label>Production Type:</label>
                        </td>
                        <td style=" width:30%;text-align:left;">
                            <select id="cboProductionType" style="width:90%;"><option value="0">All</option><option value="1">In House</option><option value="2">Sub Contract</option></select>
                        </td>
                        <td style=" width:20%;text-align:right;">
                            <label>Print PO:</label>
                        </td>
                        <td style=" width:30%;text-align:left;">
                            <select style="width:80%;" id="cboIsPrinting">
                                <option value="0">Default</option>
                                <option value="1">Print</option>
                                <option value="2">Not Print</option>
                            </select>
                        </td>
                    </tr>
                
                    <tr>
                     
                        <td colspan="4" style="width:95%;text-align:left;">
                            <div>
                                <fieldset>
                                    <legend>Lab :</legend>
                                    <div style="float:left; width:100%">
                                        <div style="float:left; width:10%">
                                            <label>Status:</label>
                                        </div>
                                        <div style="float:left; width:20%">
                                            <select style="width:95%;" id="cboLabStatus"></select>
                                        </div>
                                        <div style="float:left; width:25%">
                                            <label>Date:</label>
                                            <select style="width:70%;" id="cboLabDate" onchange="DateActions_LabDate(); "></select>
                                        </div>
                                        <div style="float:left; width:20%; padding-left:5px;">
                                            <input id="txtFromLabDate" type="text" style="width: 110px;" class="easyui-datebox" required="required" data-options="formatter:icsdateformat,parser:icsdateparser" />
                                        </div>
                                        <div style="float:left; width:5%; text-align:center">to</div>
                                        <div style="float:left; width:20%; padding-left:5px;">
                                            <input id="txtToLabDate" type="text" style="width: 110px;" class="easyui-datebox" required="required" data-options="formatter:icsdateformat,parser:icsdateparser" />
                                        </div>
                                    </div>
                                </fieldset>
                            </div>
                            <div style="margin-top: 2px;">
                                <table style="width:100%; height: 150px;">
                                    <tr>
                                        <td style="width:35%;">
                                            <table id="tblOrderTypes" class="easyui-datagrid" title="Order Type" style="width:99%; height: 150px;" data-options="singleSelect: false,fitColumns:false, rownumbers:true, pagination:false, autoRowHeight:false, ">
                                                <thead>
                                                    <tr>
                                                        <th data-options="field:'Selected',checkbox:true"></th>
                                                        <th field="Value" width="80%"></th>
                                                    </tr>
                                                </thead>
                                            </table>
                                        </td>
                                        <td style="width:30%;">
                                            <table id="tblCurrentStatuss" class="easyui-datagrid" title="Order Status" style="width:99%; height: 150px;" data-options="singleSelect: false,fitColumns:false, rownumbers:true, pagination:false, autoRowHeight:false, ">
                                                <thead>
                                                    <tr>
                                                        <th data-options="field:'Selected',checkbox:true"></th>
                                                        <th field="Value" width="80%"></th>
                                                    </tr>
                                                </thead>
                                            </table>
                                        </td>
                                        <td style="width:35%;">
                                            <table id="tblLabStatuss" class="easyui-datagrid" title="Lab Status" style="width:99%; height: 150px;" data-options="singleSelect: false,fitColumns:false, rownumbers:true, pagination:false, autoRowHeight:false, ">
                                                <thead>
                                                    <tr>
                                                        <th data-options="field:'Selected',checkbox:true"></th>
                                                        <th field="Value" width="80%"></th>
                                                    </tr>
                                                </thead>
                                            </table>
                                        </td>
                                    </tr>
                                </table>


                            </div>
                        </td>
                    </tr>
                    <tr> 

                        <td colspan="4" style="width:50%;text-align:left;">
                            <div style="margin-top: 0px;">
                                <table style="width:100%;">
                                    <tr>
                                        <td style=" width:20%;text-align:right;"></td>
                                        <td style="width:40%; text-align:left;">
                                            <div><input type="checkbox" id="chkReceived" /> <span><label>Received</label></span></div>
                                            <div><input type="checkbox" id="chkSubmittedHO" /><span><label>Submitted HO</label></span></div>
                                           
                                        </td>

                                        <td style="width:40%;text-align:left;">
                                            <div><input type="checkbox" id="chkWatingForLab" /> <span><label>Waiting For Lab</label></span></div>
                                            <div><input type="checkbox" id="chkYetToSubmittedHO" /> <span><label>Yet To Submit HO</label></span></div>
                                        </td>
                                    </tr>
                                </table>


                            </div>
                        </td>

                        
                        
                    </tr>

                </table>
            </fieldset>

            <fieldset>
                <legend>Actions : </legend>
                <table style="width:100%;text-align:right;">
                    <tr>
                        <td style="width:20%;text-align:right;">
                            <a id="btnResetAdvSearch" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-reload" plain="true">Reset</a>
                        </td>
                        <td style="width:80%;text-align:right;">
                            <label class="lblLoadingMessage" style="float: left;">Loading Please Wait...</label>
                            <a id="btnSearchAdvSearch" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-search" plain="true">Search</a>
                            <a id="btnCloseAdvSearch" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-cancel" plain="true">Close</a>
                        </td>
                    </tr>
                </table>

            </fieldset>
        </div>
    </div>
    <div id="winExeEntry" class="easyui-window" title="Dispo No" data-options="modal:true,closed:true,collapsible:false,minimizable:false,maximizable:false,closable:true">

        <div>
            <div style="margin-left:0px; margin-top:0px">
                <fieldset>
                    <legend> </legend>
                    <table cellpadding="2" cellspacing="2" style="width:100%;">
                        <tr>
                            <td style="width:15%;text-align:right">
                                PO No:
                            </td>

                            <td style="width:20%">
                                <input type="text" id="txtSCNo_ExC" style="width:100%" disabled="disabled" />
                            </td>
                            <td style="width:20%;text-align:right">
                                Mkt Ref:
                            </td>
                            <td style="width:20%">
                                <input type="text" id="txtFabricID_Exc" style="width:100%" disabled="disabled" />
                            </td>
                            <td style="width:25%;text-align:right"></td>

                        </tr>

                        <tr>
                            <td style="width:15%;text-align:right">
                                Issue To:
                            </td>

                            <td colspan="3" style="width:60%;text-align:left">
                                <input type="text" style="width:100%;" id="txtContractor_EXC" disabled="disabled" />
                            </td>
                            <td style="width:25%;text-align:right"></td>
                        </tr>
                    </table>
                </fieldset>
            </div>
            <div style="margin-left:0px; margin-top:0px">
                <fieldset>
                    <legend>Entry/Change No : </legend>
                    <table cellpadding="2" cellspacing="2" style="width:100%;">
                        <tr>
                            <td style="width:20%;text-align:right">
                                Order Type:
                            </td>

                            <td style="width:20%">
                                <input type="text" id="txtOrderType" style="width:100%" disabled="disabled" />
                            </td>

                            <td style="width:10%;text-align:right">
                                Process type:
                            </td>

                            <td style="width:40%">
                                <select id="cboProcessTypeEnt"></select>
                            </td>
                            <td style="width:10%;text-align:right"></td>

                        </tr>
                        <tr>
                            <td style="width:20%;text-align:right">
                                Receive Date:
                            </td>

                            <td style="width:20%">
                                <input id="txtReceiveDate" type="text" style="width: 110px;" class="easyui-datebox" required="required" data-options="formatter:icsdateformat,parser:icsdateparser" />
                            </td>

                            <td style="width:10%;text-align:right">
                            H/L No:
                            </td>

                            <td style="width:40%">
                                <input type="text" id="txtExcNo" style="width:100%" />
                            </td>
                            <td style="width:10%;text-align:right"></td>
                        </tr>
                    </table>
                </fieldset>
            </div>
        </div>
        <fieldset class="actionfieldsetstyle">
            <legend>Actions : </legend>
            <a id="btnSaveExeNo" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-save" plain="true">Save</a>
            <a id="btnCloseExeNo" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-cancel" plain="true">Close</a>
        </fieldset>
    </div>
    <div id="winFabric" style="width:900px;" class="easyui-window winstyle" title="Fabric" data-options="modal:true,closed:true,collapsible:false,minimizable:false,maximizable:false,closable:false">
                          <fieldset>
                              <table class="tbl">
                                  <tr style="vertical-align:top">
                                      <td style="width:50%">
                                          <table cellspacing="1" cellpadding="1" border="0" class="tbl">
                                              <tr>
                                                  <td class="tdLabel">
                                                      <label id="lblFabricNoTwo"></label>:
                                                  </td>
                                                  <td class="tdInput">
                                                      <div style="float:left">
                                                          <div style="float:left; width:6%">
                                                              <input id="txtP" placeholder="P" type="text" disabled="disabled" />
                                                          </div>
                                                          <div style="float:left; width:29%">
                                                              <input id="txtFabricNoFabric" type="text" disabled="disabled" />
                                                          </div>
                                                          <div style="float:left; width:25%" class="text-right">
                                                              <label>Issue Date :</label>
                                                          </div>
                                                          <div style="float:left; width:35%">
                                                              <input id="txtDateFabric" type="text" style="width: 100%;" class="easyui-datebox" required="required" data-options="formatter:icsdateformat,parser:icsdateparser" />
                                                          </div>
                                                      </div>

                                                  </td>
                                              </tr>
                                              <tr class="oneTextTwoButton">
                                                  <td class="tdLabel">
                                                      <label class="lblStar">*</label>
                                                      <label>Mkt. Person :</label>
                                                  </td>
                                                  <td class="tdInput">
                                                      @*<select id="cboMktPersonsFabric"></select>*@
                                                      <input id="txtMktPersonsFabric" class="reset-text" style="width:100%;" placeholder="Type & Press Enter" />
                                                  </td>
                                              </tr>
                                              <tr class="oneTextTwoButton">
                                                  <td class="tdLabel">
                                                      <label class="lblStar">*</label>
                                                      <label>Buyer :</label>
                                                  </td>
                                                  <td class="tdInput">
                                                      <input id="txtContractorName" class="reset-text" style="width:100%;" placeholder="Type & Press Enter" />
                                                  </td>
                                              </tr>
                                              <tr>
                                                  <td class="tdLabel">
                                                      <label>Buyer Ref :</label>
                                                  </td>
                                                  <td class="tdInput">
                                                      <input id="txtBuyerReferenceFabric" type="text" />
                                                  </td>
                                              </tr>
                                              <tr>
                                                  <td class="tdLabel">
                                                      <label>Style No :</label>
                                                  </td>
                                                  <td class="tdInputC">
                                                      <input id="txtStyleNoFabric" type="text" />
                                                  </td>
                                              </tr>
                                              <tr>
                                                  <td class="tdLabel">
                                                      <label>Color :</label>
                                                  </td>
                                                  <td class="tdInputC">
                                                      <input id="txtColorFabric" type="text" />
                                                  </td>
                                              </tr>
                                              <tr class="oneTextTwoButton">
                                                  <td class="tdLabel">
                                                      <label class="lblStar">*</label>
                                                      <label>Composition :</label>
                                                  </td>
                                                  <td class="tdInput">
                                                      <select id="cboProductFabric"></select>
                                                  </td>
                                              </tr>

                                              <tr>
                                                  <td class="tdLabel">
                                                      <label>Construction(PI):</label>
                                                  </td>
                                                  <td class="tdInput">
                                                      <input id="txtConstructionFabricPI" type="text"/>
                                                  </td>
                                              </tr>
                                              <tr>
                                                  <td class="tdLabel">
                                                      <label>Construction(Sugg):</label>
                                                  </td>
                                                  <td class="tdInput">
                                                      <input id="txtConstructionFabric" type="text"/>
                                                  </td>
                                              </tr>
                                              <tr>
                                                  <td class="tdLabel">
                                                      <label>Construction(Actual):</label>
                                                  </td>
                                                  <td class="tdInputC">
                                                      <input id="txtWarpCount" style="width:20%" placeholder="Warp" type="text" /><label>x</label>
                                                      <input id="txtWeftCount" style="width:20%" placeholder="Weft" type="text" /><label>/</label>
                                                      <input id="txtEPI" style="width:20%" placeholder="EPI" type="text" /><label>x</label>
                                                      <input id="txtPPI" style="width:20%" placeholder="PPI" type="text" />
                                                  </td>
                                              </tr>
                                             
                                              <tr>
                                                  <td class="tdLabel">
                                                      <label>Width :</label>
                                                  </td>
                                                  <td class="tdInput">
                                                      <input id="txtFabricWidthFabric" type="text" />
                                                  </td>
                                              </tr>
                                              <tr>
                                                  <td class="tdLabel">
                                                      <label>Process Type :</label>
                                                  </td>
                                                  <td class="tdInput">
                                                      <select id="cboProcessTypeFabric"></select>
                                                  </td>
                                              </tr>
                                              <tr>
                                                  <td class="tdLabel">
                                                      <label>Fabric Design :</label>
                                                  </td>
                                                  <td class="tdInput">
                                                      <select id="cboFabricDesign"></select>
                                                  </td>
                                              </tr>
                                              <tr>
                                                  <td class="tdLabel">
                                                      <label>Weave:</label>
                                                  </td>
                                                  <td class="tdInput">
                                                      <select id="cboWeaveFabric"></select>
                                                  </td>
                                              </tr>
                                              <tr>
                                                  <td class="tdLabel">
                                                      <label>Finish Type :</label>
                                                  </td>
                                                  <td class="tdInput">
                                                      <select id="cboFinishTypeFabric"></select>
                                                  </td>
                                              </tr>
                                              <tr>
                                                  <td class="tdLabel">
                                                      <label>No of Frame:</label>
                                                  </td>
                                                  <td class="tdInput">
                                                      <div style="float:left; width:100%">
                                                          <div style="float:left; width:30%">
                                                              <input id="txtNoOfFrame" class="numberFormat" type="text" style="width:100%;" />
                                                          </div>
                                                          <div class="fabricWeftColor" style="float:left; width:25%; text-align:right">
                                                              <label>Weft Color:</label>
                                                          </div>
                                                          <div class="fabricWeftColor" style="float:left; width:40%">
                                                              <input id="txtWeftColor" type="text" style="width:100%;" />
                                                          </div>
                                                      </div>
                                                  </td>
                                              </tr>



                                          </table>
                                      </td>
                                      <td style="vertical-align:top; width:50%">
                                          <table class="tbl">

                                              <tr style="vertical-align:top">
                                                  <td style="width:32%"></td>
                                                  <td class="tdLabel">
                                                      <table style="width:100%;border:1px solid grey; border-collapse:collapse;text-align:left" border="1" cellpadding="0" cellspacing="0">
                                                          <tr>
                                                              <td style="width:40%;font-size:13px; font-weight: bold;text-align:center">Buyer Request</td>
                                                              <td style="width:30%;font-size:13px; font-weight: bold;text-align:center">Seeking Date</td>
                                                              <td style="width:30%;font-size:13px; font-weight: bold;text-align:center">Sets</td>
                                                          </tr>
                                                          <tr style="text-align:left;">
                                                              <td style="text-align:left; width:40%;"><input id="chkIsHandLoom" type="checkbox" />Hand Loom</td>
                                                              <td class="tdInputDateBox" style="width:30%;">
                                                                  <input id="txtHandLoomDate" type="text" style="width: 100px;" class="easyui-datebox" data-options="formatter:icsdateformat,parser:icsdateparser" />
                                                              </td>
                                                              <td style="text-align:left; width:30%;"><input id="txtHandLommSet" class="numberField" type="text" style="width:100%;" /></td>
                                                          </tr>
                                                          <tr class="regionFabricStage">
                                                              <td style="text-align:left; width:40%;"><input id="chkIsSample" type="checkbox" />Sample</td>
                                                              <td class="tdInputDateBox" style="width:30%;">
                                                                  <input id="txtSampleDate" type="text" style="width: 100px;" class="easyui-datebox" data-options="formatter:icsdateformat,parser:icsdateparser" />
                                                              </td>
                                                              <td style="text-align:left; width:30%;"><input id="txtSampleSet" class="numberField" type="text" style="width:100%;" /></td>
                                                          </tr>
                                                          <tr class="regionFabricStage">
                                                              <td style="text-align:left; width:40%;"><input id="chkIsBulk" type="checkbox" />Bulk</td>
                                                              <td class="tdInputDateBox" style="width:30%;">
                                                                  <input id="txtBulkDate" type="text" style="width: 100px;" class="easyui-datebox" required="required" data-options="formatter:icsdateformat,parser:icsdateparser" />
                                                              </td>
                                                              <td style="text-align:left; width:30%;"><input id="txtBulkSet" class="numberField" type="text" style="width:100%;" /></td>
                                                          </tr>
                                                          <tr>
                                                              <td style="text-align:left; width:40%;"><input id="chkIsAnalysis" type="checkbox" />Analysis</td>
                                                              <td class="tdInputDateBox" style="width:30%;">
                                                                  <input id="txtAnalysis" type="text" style="width: 100px;" class="easyui-datebox" required="required" data-options="formatter:icsdateformat,parser:icsdateparser" />
                                                              </td>
                                                              <td style="text-align:left; width:30%;"><input id="txtAnalysisSet" class="numberField" type="text" style="width:100%;" /></td>
                                                          </tr>
                                                          <tr class="regionFabricStage">
                                                              <td style="text-align:left; width:40%;"><input id="chkIsCAD" type="checkbox" />CAD</td>
                                                              <td class="tdInputDateBox" style="width:30%;">
                                                                  <input id="txtCADDate" type="text" style="width: 100px;" class="easyui-datebox" required="required" data-options="formatter:icsdateformat,parser:icsdateparser" />
                                                              </td>
                                                              <td style="text-align:left; width:30%;"><input id="txtCadSet" class="numberField" type="text" style="width:100%;" /></td>
                                                          </tr>
                                                          <tr class="regionFabricStage">
                                                              <td style="text-align:left; width:40%;"><input id="chkIsColor" type="checkbox" />Color Standard</td>
                                                              <td class="tdInputDateBox" style="width:30%;">
                                                                  <input id="txtColorDate" type="text" style="width: 100px;" class="easyui-datebox" required="required" data-options="formatter:icsdateformat,parser:icsdateparser" />
                                                              </td>
                                                              <td style="text-align:left; width:30%;"><input id="txtColorSet" class="numberField" type="text" style="width:100%;" /></td>
                                                          </tr>
                                                          <tr>
                                                              <td style="text-align:left; width:40%;"><input id="chkIsLabdip" type="checkbox" />Labdip</td>
                                                              <td class="tdInputDateBox" style="width:30%;">
                                                                  <input id="txtLabdipDate" type="text" style="width: 100px;" class="easyui-datebox" required="required" data-options="formatter:icsdateformat,parser:icsdateparser" />
                                                              </td>
                                                              <td style="text-align:left; width:30%;"><input id="txtLabdipSet" class="numberField" type="text" style="width:100%;" /></td>
                                                          </tr>
                                                          <tr>
                                                              <td style="text-align:left; width:40%;"><input id="chkIsYarnSkein" type="checkbox" />YarnSkein</td>
                                                              <td class="tdInputDateBox" style="width:30%;">
                                                                  <input id="txtYarnSkein" type="text" style="width: 100px;" class="easyui-datebox" required="required" data-options="formatter:icsdateformat,parser:icsdateparser" />
                                                              </td>
                                                              <td style="text-align:left; width:30%;"><input id="txtYarnSkeinSet" class="numberField" type="text" style="width:100%;" /></td>
                                                          </tr>
                                                      </table>

                                                  </td>
                                              </tr>
                                              <tr>
                                                  <td style="width:32%"></td>
                                                  <td class="tdInputChk">

                                                      <ul style="margin-left:0px;">
                                                          <li><input id="chkWashFabric" type="checkbox" />Wash</li>
                                                          <li><input id="chkFinishFabric" type="checkbox" />Finish</li>
                                                          <li><input id="chkDyeingFabric" type="checkbox" />Dyeing</li>
                                                          <li><input id="chkPrintFabric" type="checkbox" />Print</li>
                                                      </ul>

                                                  </td>
                                              </tr>
                                              <tr>
                                                  <td class="tdLabel">
                                                      <label>Priority Level :</label>
                                                  </td>
                                                  <td class="tdInput">
                                                      <select id="cboPriorityLevelFabric"></select>
                                                  </td>
                                              </tr>

                                              <tr>
                                                  <td class="tdLabel">
                                                      <label>H/L No:</label>
                                                  </td>
                                                  <td class="tdInputC">
                                                      <input id="txtHLNo" type="text" style="width:100%;" />
                                                  </td>
                                              </tr>
                                              <tr>
                                                  <td class="tdLabel">
                                                      <label>End Use:</label>
                                                  </td>
                                                  <td class="tdInputC">
                                                      <input id="txtEndUse" type="text" style="width:100%;" />
                                                  </td>
                                              </tr>
                                              <tr>
                                                  <td class="tdLabel">
                                                      <label>Primary Light Src. :</label>
                                                  </td>
                                                  <td class="tdInputC">
                                                      <select id="cboPrimaryLightSource" style="width:100%;"></select>
                                                  </td>
                                              </tr>
                                              <tr>
                                                  <td class="tdLabel">
                                                      <label>Secondary Light Src. :</label>
                                                  </td>
                                                  <td class="tdInputC">
                                                      <select id="cboSecondaryLightSource" style="width:100%;"></select>
                                                  </td>
                                              </tr>

                                              <tr>
                                                  <td class="tdLabel">
                                                      <label>Note :</label>
                                                  </td>
                                                  <td class="tdInput">
                                                      <textarea rows="1" id="txtNoteFabric" style="text-align:left; width:96%; height:40px; font-family:Tahoma; font-size:12px" placeholder="Narration"></textarea>
                                                  </td>
                                              </tr>

                                          </table>
                                      </td>
                                  </tr>
                              </table>
                          </fieldset>
                          <fieldset class="actionfieldsetstyle">
                              <legend>Actions : </legend>
                              <table border="0" cellpadding="0" cellspacing="0" style="float:right; width:100%;">
                                  <tr>
                                      <td style="text-align:left"></td>
                                      <td>
                                          <a id="btnSave_submit" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-save" plain="true">Save</a>
                                          <a id="btnCloseFabric" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-cancel" plain="true">Close</a>
                                      </td>
                                  </tr>
                              </table>
                          </fieldset>
                      </div>
    <div id="winFabricHistory" class="easyui-window" title="Fabric Suggestion History" data-options="modal:true,closed:true,collapsible:false,minimizable:false,maximizable:false,closable:true">
        <table id="tblFabricHistory" class="easyui-datagrid" style="width:100%;height:298px;" fitcolumns="false" rownumbers="true" pagination="false" singleselect="true" autorowheight="false">
            <thead>
                <tr>
                    <th field="ModifiedTimeStr" width="12%">Modified Time</th>
                    <th field="ModifiedByName" width="10%">Modified By</th>
                    <th field="FabricNo" width="10%" align="left">Mkt. Ref. No</th>
                    <th field="ProductName" width="12%" align="left">Composition</th>
                    <th field="Construction" width="10%">Construction</th>
                    <th field="ColorInfo" width="10%">Color Info</th>
                    <th field="FabricWidth" width="10%">Fabric Width</th>
                    <th field="WeftColor" width="10%">Weft Color</th>
                    <th field="ActualConstruction" width="12%">Actual Construction</th>
                    <th field="FinishTypeName" width="10%">Finish Type</th>
                    <th field="ProcessTypeName" width="10%">Process Type</th>
                    <th field="CreatedByName" width="10%">Created By</th>
                </tr>
            </thead>
        </table>
        <fieldset class="actionfieldsetstyle">
            <legend>Actions : </legend>
            <a id="btnCloseFabricHistory" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-cancel" plain="true">Close</a>
        </fieldset>
    </div>
    <div id="winLabDip" style="width:80%;text-align:left" class="easyui-window" title="LabDip" data-options="modal:true,closed:true,collapsible:false,minimizable:false,maximizable:false,closable:true">

                          <div>

                              <div style="margin-left:0px; margin-top:0px">
                                  <fieldset style="height:50%">
                                      <legend style="font-weight:bold">Fabric Information :</legend>
                                      <table cellpadding="2" cellspacing="2" style="width:100%;">
                                          <tr>
                                              <td style="width:15%;text-align:right">
                                                  Dispo No :
                                              </td>

                                              <td style="width:20%">
                                                  <input type="text" id="txtDispoNo " style="width:100%" disabled="disabled" />
                                              </td>
                                              <td style="width:15%;text-align:right">
                                                  Mkt Ref No:
                                              </td>

                                              <td style="width:20%">
                                                  <input type="text" id="txtFabricNo_Lab" style="width:100%" disabled="disabled" />
                                              </td>
                                              <td style="width:10%;text-align:right">
                                                  PO No:
                                              </td>
                                              <td style="width:20%">
                                                  <input type="text" id="txtSCNo_Lab" style="width:100%" disabled="disabled" />
                                              </td>

                                          </tr>
                                          <tr>
                                              <td style="width:15%;text-align:right">
                                                  Composition :
                                              </td>
                                              <td style="width:20%">
                                                  <input type="text" id="txtComposition" style="width:100%" disabled="disabled" />
                                              </td>
                                              <td style="width:15%;text-align:right">
                                                  Construction :
                                              </td>
                                              <td style="width:20%">
                                                  <input type="text" id="txtConstruction" style="width:100%" disabled="disabled" />
                                              </td>
                                              <td style="width:10%;text-align:right">
                                                  Fabric type :
                                              </td>
                                              <td style="width:20%">
                                                  <input type="text" id="txtFabrictype" style="width:100%" disabled="disabled" />
                                              </td>

                                          </tr>
                                      </table>
                                  </fieldset>
                                  <div>
                                      <fieldset style="height:50%">
                                          <legend style="font-weight:bold">Lab Operation :</legend>
                                          <table  cellpadding="2" cellspacing="2" style="width:100%;font-size:12px; font-weight:normal">
                                              
                                                  <tr>
                                                      
                                                      <td style="width:55% ;height:150px">
                                                          <table id="tblLabdipHistory" class="easyui-datagrid" style="width:100%;height:150px;" fitcolumns="false" rownumbers="true" pagination="false" singleselect="true" autorowheight="false">
                                                              <thead>
                                                                  <tr>
                                                                      <th field="DateTimeSt" width="20%" align="left">Date</th>
                                                                      <th field="StatusSt" width="25%" align="left">Status</th>
                                                                      <th field="UserName" width="30%" align="left">User</th>
                                                                      <th field="Days" width="18%">Days</th>
                                                                      
                                                                  </tr>
                                                              </thead>
                                                          </table>
                                                          @*<div id="toolbarLDH">
                                                              <a id="btnRefreshLDH" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-reload" plain="true">Refresh</a>
                                                          </div>*@
                                                          </td>
                                                        <td style="width:5% ;height:150px">
                                                            </td>
                                                      <td style="width:40% ;height:150px;vertical-align:top;">
                                                          <table cellpadding="2"cellspacing="5" style="width:100%;border-top:1px solid black;border-right:1px solid black;border-left:1px solid black;border-bottom:1px solid black">
                                                              <tr style="width:40%; vertical-align:top; ">
                                                                  <td style="width:40%; text-align:left; ">Labdip Order No:</td>
                                                                  <td style="width:60%;"><input id="txtLabDipOrderNo" type="text" style="width:100%;" disabled="disabled" /></td>
                                                                
                                                              </tr>
                                                              <tr>
                                                                  <td style="width:40%; text-align:left;"> Labdip Status:</td>
                                                                  <td style="width:60%;"><input id="txtLabdipStatus" type="text" style="width:100%;" disabled="disabled" /></td>
                                                              </tr>
                                                              <tr>
                                                                  <td style="width:17%; text-align:left; "></td>
                                                                  <td style="width:10%;"></td>
                                                              </tr>
                                                              <tr style ="height:30px">
                                                                  <td style="width:17%; text-align:left; "></td>
                                                                  <td style="width:10%;"></td>
                                                              </tr>
                                                              <tr id="trLabdipRequest">
                                                                  <td style="width:17%; text-align:left; ">Request For Lab Dip:</td>
                                                                  <td style="width:10%;"><input id="btnSaveLabDip" type="button" value="Update" style="width:100%;" /></td>
                                                              </tr>
                                                              <tr id="trLabdipReceive">
                                                                  <td style="width:17%; text-align:left; ">Receive From Lab:</td>
                                                                  <td style="width:10%;"><input id="btnSaveLabRecd" type="button" value="Update" style="width:100%;" /></td>
                                                              </tr>
                                                              <tr style="height:30px">
                                                                  <td style="width:17%; text-align:left; "></td>
                                                                  <td style="width:10%;"></td>
                                                              </tr>
                                                             <tr id="trLabdipSubmit">
                                                                  <td style="width:17%; text-align:left; ">Submit To HO:</td>
                                                                  <td style="width:10%;"><input id="btnSaveLabdipSubmit" type="button" value="Update" style="width:100%;" /></td>
                                                              </tr>
                                                              <tr style="height:20px">
                                                                  <td style=" width:17%; text-align:left; "></td>
                                                                  <td style="width:10%;"></td>
                                                              </tr>
                                                          </table>
                                                      </td>
</tr>
                                          


                                          </table>
                                      </fieldset>
                                  </div>
                                 

                              </div>

                          </div>
                          <fieldset class="actionfieldsetstyle">
                              <legend>Actions : </legend>
                              @*<a id="btnSaveExeNo" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-save" plain="true">Save</a>*@
                              <a id="btnCloseLabDip" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-cancel" plain="true">Close</a>
                          </fieldset>
                      </div>
    <div id="winPO" style="width:90%;height: 420px;" class="easyui-window winstyle" title="Add PO" data-options="modal:true,closed:true,collapsible:false,minimizable:false,maximizable:false,closable:false">
        <fieldset>
            <legend>PO</legend>
            <div class="col-md-12">
                <table id="tblLabDipDetailFabric" class="easyui-datagrid" style="height:300px;"
                       data-options="selectOnCheck:false, checkOnSelect:false, singleSelect: true, fitColumns:true, rownumbers:true, pagination:false, autoRowHeight:false,onClickRow: onClickRow, onLoadSuccess: onLoadSuccess, toolbar: '#toolbarFabric' ">
                    <thead>
                        <tr>
                            <th data-options="field:'Selected',checkbox:true"> </th>
                            <th field="LabDipNo" width="10%" align="center">Lab No</th>
                            <th field="ColorNo" width="12%" align="center">Color No</th>
                            <th field="ColorName" width="8%" align="center" editor="{type:'text'}">Color Name</th>
                            <th field="PantonNo" width="12%" align="center">Panton No</th>
                            <th field="WarpWeftType" width="8%" align="center" formatter="loadGridCombo" editor="{
                                                                                            type:'combobox',
                                                                                            options:
                                                                                                {   valueField:'id',
                                                                                                    textField:'Value',
                                                                                                    data:_cboWarpWeftTypes,
                                                                                                    required:true
                                                                                                 }
                                                                                         }">Type</th>
                            <th field="SCNoFull" width="8%" align="center">PO No</th>
                            <th field="FabricNo" width="8%" align="center"><label id="lblLabdipOrderNo">P Number</label></th>
                            <th field="TwistedGroup" width="6%" align="center" formatter="formatTwisted">Twisted</th>
                            <th field="ExeNo" width="8%" align="left">Dispo/HL No</th>
                            <th field="ProductName" width="20%" align="left">Yarn Type</th>
                            <th field="Remarks" width="8%" align="left" editor="{type:'text'}">Remarks</th>
                            <th field="Update" width="6%" align="left" formatter="gridAction">Update</th>
                        </tr>
                    </thead>
                </table>
                <div id="toolbarFabric">
                    @*Is For All? <input type="checkbox" id="chkForAll">*@
                    <label style="padding-left:10px">Lab/Color No:</label>
                    <input id="txtLD" style="width:20%;" class="reset-text" placeholder="Search Lab/Color No" />
                    <a id="btnPickLD" href="javascript:void(0)" class="easyui-linkbutton ics-pick" iconcls="icon-pick" plain="true"></a>
                    @*<a id="btnResetLD" href="javascript:void(0)" class="easyui-linkbutton ics-pick" iconcls="icon-clear" plain="true"></a>*@

                    <input id="txtPT" style="width:20%;" class="reset-text" placeholder="Search Panton No" />
                    <a id="btnPickPT" href="javascript:void(0)" class="easyui-linkbutton ics-pick" iconcls="icon-pick" plain="true"></a>

                    <a id="btnMakeTwisted" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-ok" plain="true">Create Twisted</a>
                    <a id="btnRemoveTwisted" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-ok" plain="true">Remove Twisted</a>

                    <a id="btnChanheProduct" href="javascript:void(0)" class="easyui-linkbutton ics-pick" iconcls="icon-pick" plain="true">Change Product</a>
                    <a id="btnRemoveDetailFabric" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-remove" plain="true">Remove</a>
              </div>
            </div>
        </fieldset>
        <fieldset class="actionfieldsetstyle">
            <legend>Actions : </legend>
            <a id="btnClosePO" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-cancel" plain="true">Close</a>
        </fieldset>
    </div>
    <div id="winProductChange" style="width:50%;text-align:left" class="easyui-window" title="LabDip" data-options="modal:true,closed:true,collapsible:false,minimizable:false,maximizable:false,closable:true">
        <div style="margin-left:0px; margin-top:0px">
            <fieldset style="height:50%">
                <legend style="font-weight:bold">Yarn Information :</legend>
                <table cellpadding="2" cellspacing="2" style="width:100%;">
                    <tr>
                        <td style="width:20%;text-align:right">
                            Currenct (Yarn) :
                        </td>

                        <td style="width:80%">
                            <input type="text" id="txtYarnName" style="width:100%" disabled />
                        </td>
                    </tr>
                    <tr>
                        <td style="width:20%;text-align:right">
                            Change To (Yarn) :
                        </td>

                        <td style="width:80%">
                           <div>
                               <input type="text" id="txtYarnNameChange" placeholder="Type Yarn Name & press enter" style="width:89%" />
                               <a id="btnPickProduct" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-pick" style="width:10%" plain="true">Pick</a>
                           </div>
                        </td>
                    </tr>
                </table>
            </fieldset>
        </div>
    
        <fieldset class="actionfieldsetstyle">
            <legend>Actions : </legend>
            <a id="btnSaveYarn" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-save" plain="true">Save</a>
            <a id="btnCloseYarn" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-cancel" plain="true">Close</a>
        </fieldset>
    </div>
    <style type="text/css">
        .lines-no .datagrid-body td {
            border-right: 1px dotted transparent;
            border-bottom: 1px dotted transparent;
        }
        .lblStar {
            color: red;
            font-weight: bold;
        }
        .tdInputChk {
            width: 100%;
        }
        .tdInputChk ul{
            padding: 0;
            margin: 0;
        }
        .tdInputChk ul li{
            display: inline;
            list-style-type: none;
            margin:0 9px 0 0;   
        }
        /*.tdInputChk ul li input{
            margin: 0 2px 0 0;
        }*/
        .tdInput input {
            width: 96%;
        }
        .tdInputC input {
            width: 96%;
        }
        .tdInput select {
            width: 96%;
        }
    </style>

    <script type="text/javascript">
    var _sBaseAddress="";
    var _oLabDip=null;
    var _oLabDips=[];
    var _oCompareOperators=[];
    var _oFabricPOStatus = [];
    var _oOrderTypes=[];
    var _nBUID = 0;
    var _sContractorIds = '';
    var _sBuyerIds = '';
    var _sMAccountIds='';
    var _oBU = null;
    var _nReportType=0;
    var _sProductIds="";
    var _oProducts=[];
    var _oPriorityLevels=[];
    var _oFinishTypes=[];
    var _oProcessTypes=[];
    var _oFabricWeaves=[];
    var _oFabricDesigns=[];
    var _oLightSources=[];
    var _typeOfReceive =[];
    var _oLabdipStatus=[];
    _oCellRowSpans=[];
    var _cboWarpWeftTypes=[ {id: 0, Value: "None", Description: "Warp"},
                            {id: 1, Value: "Warp", Description: "Warp"},
                            {id: 2, Value: "Weft", Description: "Weft"},
                            {id: 3, Value: "Warp&Weft", Description: "Warp&Weft"}];
    var _oFabric=null;
    $(document).ready(function () {

        _sBaseAddress =@Html.Raw( new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(HttpContext.Current.Session[SessionInfo.BaseAddress]));
        _oLabDips =@Html.Raw( new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(Model));
        _oCompareOperators = @Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(ViewBag.CompareOperators));
        _nBUID = @Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(ViewBag.BUID));
        _oOrderTypes = @Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(ViewBag.OrderTypes));
        _oLabdipStatus = @Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(ViewBag.LabdipStatus));
        _oFabricPOStatus = @Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(ViewBag.FabricPOStatus));

        _oPriorityLevels = @Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(ViewBag.PriorityLevels));
        _oFinishTypes = @Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(ViewBag.FinishTypes));
        _oProcessTypes = @Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(ViewBag.ProcessTypes));
        _oFabricWeaves = @Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(ViewBag.FabricWeaves));
        _oFabricDesigns = @Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(ViewBag.FabricDesigns));
        _oLightSources = @Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(ViewBag.LightSources));
        _typeOfReceive = @Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(ViewBag.Type));
        _oProducts = @Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(ViewBag.Products));
        _cboWarpWeftTypes = @Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(ViewBag.cboEnumWarpWeft));
        console.log(_cboWarpWeftTypes);
        var oFabricPOSetup = @Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(ViewBag.FabricPOSetup));
        debugger;

        $('#winProductChange').data('Product',{});
        $('#tblLabDipDetail').datagrid({selectOnCheck:false, checkOnSelect:false});

        var nIndex=-1;
        if(sessionStorage.getItem("LabDips_InLab")!=null && sessionStorage.getItem("LabDips_InLab").length>0)
        {
            _oLabDips= jQuery.parseJSON(sessionStorage.getItem('LabDips_InLab'));
            nIndex= parseInt(sessionStorage.getItem('SelectedRowIndex_InLab'));
        }

        $('#tblLabDips').data('FDPs',_oLabDips);

        DynamicRefreshList(_oLabDips, 'tblLabDips');
        if(nIndex>-1)
        {
            $('#tblLabDips').datagrid('selectRow',nIndex);
        }
        SetGridData();
        
        $("#progressbar").progressbar({ value: 0 });
        $("#progressbarParent").hide();
        $(".lblLoadingMessage").hide();
        LoadComboAdv();
        LoadComboboxesFabric();
        RefreshSetup(oFabricPOSetup);
    });

    /* GRID EDITOR */
    var editIndex = undefined;
    function cboEditor()
    {
        var editor={
            type:'combobox',
            options:
                {
                    valueField:'id',
                    textField:'Value',
                    data:[{id:0,Value:"Test"},{id:1,Value:"Test2"},{id:2,Value:"Test3"}],
                    required:true
                }
        };
        return editor;
    }
    function endEditing() {
        debugger;
        if (editIndex == undefined) {
            return true;
        }
        debugger;
        if ($('#tblLabDipDetailFabric').datagrid('validateRow', editIndex)) {
            $('#tblLabDipDetailFabric').datagrid('endEdit', editIndex);
            $('#tblLabDipDetailFabric').datagrid('selectRow', editIndex);
            var oPIDetail = $('#tblLabDipDetailFabric').datagrid('getSelected');
            if (oPIDetail == null) {
                return;
            }
            $('#tblLabDipDetailFabric').datagrid('updateRow', { index: editIndex, row: oPIDetail });
            editIndex = undefined;
            return true;
        }
        else {
            return false;
        }
    }
    function onClickRow(index) {
        if (editIndex != index) {
            if (endEditing()) {
                $('#tblLabDipDetailFabric').datagrid('selectRow', index).datagrid('beginEdit', index);
                var oExportPIDetail = $('#tblLabDipDetailFabric').datagrid('getSelected');
                editIndex = index;
            }
            else {
                $('#tblLabDipDetailFabric').datagrid('selectRow', editIndex);
            }
        }
    }
    function loadGridCombo(value){
        console.log(value);
        var data=_cboWarpWeftTypes;

        for(var i=0; i<data.length;i++)
        {
            if(data[i].id== parseInt(value))
                return data[i].Value;
        }
        return 'None';
    }
    /* END GRID EDITOR */

    /* GRID ACTION*/
    function gridAction(value,row,index){
        return '<a href="javascript:void(0)" onclick="saverow(this)">Save</a> ';
    }
    function saverow(target)
    {
        $('#tblLabDipDetailFabric').datagrid('endEdit', getRowIndex(target))
        $('#tblLabDipDetailFabric').datagrid('selectRow', editIndex)
        debugger;   
       
        var obj = $('#tblLabDipDetailFabric').datagrid('getSelected');

        if (obj == null) {
            console.log(getRowIndex(target));
            alert("Please Select An Item And Try Again!"); 
            return false;
        }
        
        endEditing();

        if (obj.ColorName == "") {
            alert("Please Entry Color Name!");
            return false;
        }
        if (obj.WarpWeftType==undefined || obj.WarpWeftType == 0) {
            alert("Please Entry Warp/Weft Type!");
            return false;
        }
        if (!confirm("Confirm to Save?")) return false;

        if(Save_FabricDetail(obj))
        alert("Saved Successfully.");
    }
    function getRowIndex(target){
        var tr = $(target).closest('tr.datagrid-row');
        return parseInt(tr.attr('datagrid-row-index'));
    }
    /* END GRID*/
    $('#btnAddLabDip').click(function(e){

        var row = $('#tblLabDips').datagrid('getSelected');

        if(row==null || row.LabDipID<=0){
            alert("Select an item from list");
            return false;
        }
        var nRowIndexBank = $("#tblLabDips").datagrid("getRowIndex", row);
        SetGridData();
        sessionStorage.setItem("SelectedRowIndex_InLab", nRowIndexBank);
        //alert("Lab Dip is Created Successfully.");
        
        sessionStorage.setItem("BUID",_nBUID);
        sessionStorage.setItem("Approval","YES");
        sessionStorage.setItem("Operation", "Edit");
        sessionStorage.setItem("RelabCount", row.RelabCount);
        sessionStorage.setItem("LabDip", JSON.stringify(row));
        sessionStorage.setItem("LapdipHeader", "Edit Production");
        sessionStorage.setItem("BackLink", window.location.href);
        var tsv=((new Date()).getTime())/1000;
        window.location.href = _sBaseAddress+ "/LabDip/ViewWULabDipFSC?nId="+row.LabDipID+"&ts="+tsv;
    });
  

    $("#btnPickLD").click(function () {
        var sLDNo=$.trim($("#txtLD").val());
        //if(sLDNo==""){ alert("Type LD No to search."); return false; }
        var oLabDip= $('#tblLabDips').datagrid('getSelected');
        var oFabricSalesContract = 
        {
            LabDipDetailID:oLabDip.FSCDetailID,
            ColorNo: sLDNo,
            BuyerName:0,
            PINo:'',
            ApproveBy:1,
            OrderType: $("#cboLDType").val()
        };
        PickFabricSC(oFabricSalesContract);
    });
    $("#txtLD").keydown(function (e) {
        var nkeyCode = e.keyCode || e.which;
        if(nkeyCode==13){

            var sLDNo=$.trim($("#txtLD").val());

            if(sLDNo==""){ alert("Type LD No to search."); return false; }
            var oFabricSalesContract = {
                ColorNo: sLDNo, //LabDipNo
                BuyerName:0,
                PINo:'',
                ApproveBy:1,
                OrderType:$("#cboLDType").val()
            };
            PickFabricSC(oFabricSalesContract);
        }
        else if(nkeyCode==8){
            $("#txtLD").val("");
            _nFSCID=0;
        }
    });

    
    $("#btnPickPT").click(function () {
        var sPantonNo=$.trim($("#txtPT").val());
        //if(sLDNo==""){ alert("Type LD No to search."); return false; }
        var oLabDip= $('#tblLabDips').datagrid('getSelected');
        var oFabricSalesContract = 
        {
            LabDipDetailID:oLabDip.FSCDetailID,
            PantonNo: sPantonNo,
            BuyerName:0,
            PINo:'',
            ApproveBy:1,
            OrderType: $("#cboLDType").val()
        };
        PickFabricSC(oFabricSalesContract);
    });
    $("#txtPT").keydown(function (e) {
        var nkeyCode = e.keyCode || e.which;
        if(nkeyCode==13)
        {
            var sPantonNo=$.trim($("#txtPT").val());

            if(sPantonNo==""){ alert("Type Panton No to search."); return false; }
            var oFabricSalesContract = {
                PantonNo: sPantonNo, //sPantonNo
                BuyerName:0,
                PINo:'',
                ApproveBy:1,
                OrderType:$("#cboLDType").val()
            };
            PickFabricSC(oFabricSalesContract);
        }
        else if(nkeyCode==8){
            $("#txtPT").val("");
            _nFSCID=0;
        }
    });

    function PickFabricSC(oFabricSalesContract) {
        $.icsProgressBar(true);
        var obj = {
            BaseAddress: _sBaseAddress,
            Object: oFabricSalesContract,
            ControllerName: "LabDip",
            ActionName: "GetsLabDipDetailRnD",
            IsWinClose: false
        };

        $.icsDataGets(obj, function (response) {

            if (response.status && response.objs.length > 0) {
                if (response.objs[0].LabDipDetailID > 0) 
                {
                    debugger;
                    var tblColums = [];
                    var oColumn = { field: "LabdipNo", title: "LabdipNo", width: 110, align: "left" };tblColums.push(oColumn);
                    oColumn = { field: "ColorNo", title: "ColorNo", width: 110, align: "left" };tblColums.push(oColumn);
                    oColumn = { field: "ColorName", title: "ColorName", width: 160, align: "left" };tblColums.push(oColumn);
                    oColumn = { field: "PantonNo", title: "Panton No", width: 110, align: "left" };tblColums.push(oColumn);
                    oColumn = { field: "ProductName", title: "Yarn", width: 150, align: "left" };tblColums.push(oColumn);

                    var oPickerParam = {
                        winid: 'winLabDipPicker',
                        winclass:'clsLabDipPicker',
                        winwidth: 550,
                        winheight: 460,
                        tableid: 'tblLabDipPicker',
                        tablecolumns: tblColums,
                        datalist: response.objs,
                        multiplereturn: true,
                        searchingbyfieldName:'ColorNo',
                        windowTittle: 'LabDip List'
                    };
                    $.icsPicker(oPickerParam);
                    IntializePickerbutton(oPickerParam);//multiplereturn, winclassName

                    $.icsProgressBar(false);
                }
                else 
                { 
                    alert(response.objs[0].ErrorMessage); 
                    $.icsProgressBar(false);
                }
            }
            else{
                alert("No Color Found.");
                $.icsProgressBar(false);
            }
        });
    }
        
    $("#btnCloseYarn").click(function () {
        $("#winProductChange").icsWindow('close');
    });
    $("#btnSaveYarn").click(function () {
        var oLabDipDetailFabric= $('#tblLabDipDetailFabric').datagrid('getSelected');
        if(oLabDipDetailFabric==undefined || oLabDipDetailFabric.LDFID<=0)
        {
            alert('Please select an item and try again!!'); return false;
        }
        var oProduct= JSON.parse($('#winProductChange').data('Product'));
        oLabDipDetailFabric.ProductID=oProduct.ProductID;
        oLabDipDetailFabric.ProductName=oProduct.ProductName;
        saverow(oLabDipDetailFabric);
        $("#winProductChange").icsWindow('close');
    });
    $("#btnChanheProduct").click(function () {
    
        var oLabDipDetailFabric= $('#tblLabDipDetailFabric').datagrid('getSelected');
        if(oLabDipDetailFabric==undefined || oLabDipDetailFabric.LDFID<=0)
        {
            alert('Please select an item and try again!!'); return false;
        }
        
        $('#txtYarnName').val(oLabDipDetailFabric.ProductName);
        $('#txtYarnNameChange').val("");
        $("#winProductChange").icsWindow('open', "Change Yarn");
    });
    $("#btnPickProduct").click(function () {

        var sProductName=$.trim($("#txtYarnNameChange").val());
        GetProducts(sProductName);
    });
    $("#txtYarnNameChange").keydown(function (e) {
        var nkeyCode = e.keyCode || e.which;
        if(nkeyCode==13){
            var sProductName=$.trim($("#txtYarnNameChange").val());
            //if(sProductName==""){ alert("Type product name to search."); return false; }
            GetProducts(sProductName);
        }
        else if(nkeyCode==8){
            $("#txtProduct").val("");
            _nProductID=0;
        }
    });

    function GetProducts(sProductName){
        var oProduct = { BUID:_nBUID,ProductName:sProductName};
    
        var obj = {
            BaseAddress: _sBaseAddress,
            Object: oProduct,
            ControllerName: "Product",
            ActionName: "SearchByProductBUWise",
            IsWinClose: false
        };

        $.icsMaxDataGets(obj, function (response) {

            if (response.status && response.objs.length > 0) {
                if (response.objs[0].ProductID > 0) {
                   // if(!confirm(" Confirm to change product? "))return false;
                    var tblColums = [];
                    oColumn = { field: "ProductCode", title: "Code", width: 100, align: "left" };tblColums.push(oColumn);
                    oColumn = { field: "ProductName", title: "Yarn", width: 180, align: "left" };tblColums.push(oColumn);
                    oColumn = { field: "MUnit", title: "Unit", width: 80, align: "left" };tblColums.push(oColumn);

                    var oPickerParam = {
                        winid: 'winLDProduct',
                        winclass:'clsLDProduct',
                        winwidth: 550,
                        winheight: 460,
                        tableid: 'tblLDProduct',
                        tablecolumns: tblColums,
                        datalist: response.objs,
                        multiplereturn: false,
                        searchingbyfieldName:'ProductName',
                        windowTittle: 'Product List'
                    };
                    $.icsPicker(oPickerParam);
                    IntializePickerbutton(oPickerParam);//multiplereturn, winclassName
                }
                else { alert(response.objs[0].ErrorMessage); }
            }
            else{
                alert("No product found.");
            }
        });
    }
    function IsExistFabric(oLabDipDetail)
    {
        var oLDpDetail = $('#tblLabDipDetailFabric').datagrid('getRows');
        for (var i = 0; i < oLDpDetail.length; i++) {
            if (parseInt(oLDpDetail[i].LabDipDetailID) ==parseInt(oLabDipDetail.LabDipDetailID))
            {
                return true;
            }
        }
        return false;
    }
    function Save_FabricDetail(oLDDF)
    {
        debugger;
        endEditing();
        var obj = {
            BaseAddress: _sBaseAddress,
            Object: oLDDF,
            ObjectId: oLDDF.LDFID,
            ControllerName: "LabDip",
            ActionName: "Save_FabricDetail",
            TableId: "tblLabDipDetailFabric",
            IsWinClose: false,
            Message: ""// (oLDDF.LDFID>0)?"Update Successfully." : "Save Successfully."
        };
        $.icsSave(obj, function (response) {
            if (response.status && response.obj != null)
            {
                var oLDFs=$('#tblLabDipDetailFabric').datagrid('getRows');
                var oLabDipDetailFabric= $('#tblLabDipDetailFabric').datagrid('getSelected');
                var nIndex = $('#tblLabDipDetailFabric').datagrid('getRowIndex',oLabDipDetailFabric);
                
                if(nIndex==-1)
                    oLDFs[oLDFs.length]=response.obj;
                else  
                    oLDFs[nIndex]=response.obj;
                
                DynamicRefreshList(oLDFs, 'tblLabDipDetailFabric');
                return true;
                //if(response.obj.ErrorMessage!=null || response.obj.ErrorMessage!='')
                //{
                //    alert(response.obj.ErrorMessage); return;
                //}
                //$("#winPO").icsWindow("close");
            }return false;
        });
    }

    $("#btnRemoveDetailFabric").click(function ()
    {
        debugger;
        var oLabDipDetail = $("#tblLabDipDetailFabric").datagrid("getSelected");
        if (oLabDipDetail == null || oLabDipDetail.FSCDetailID <= 0) { alert("Please select an item from list!"); return false; }

        if (!confirm("Confirm to Delete?")) return false;

        editIndex=undefined;
        Delete_FabricDetail(oLabDipDetail);

    });
    function Delete_FabricDetail(oLDDF)
    {
        debugger;
        console.log(oLDDF);
        var obj = {
            BaseAddress: _sBaseAddress,
            Object: oLDDF,
            ObjectId: oLDDF.LDFID,
            ControllerName: "LabDip",
            ActionName: "Delete_FabricDetail",
            TableId: "",
            IsWinClose: false,
            Message: (oLDDF.LDFID>0)?"Update Successfully." : "Save Successfully."
        };
        $.icsSave(obj, function (response) {
            if (response.status && response.obj != null)
            {
                var index= $("#tblLabDipDetailFabric").datagrid("getRowIndex",oLDDF); console.log(index);
                $('#tblLabDipDetailFabric').datagrid('deleteRow', index);
            }
        });
    }

    //win PO
    $('#btnViewPO').click(function(e){
        var oLabDip= $('#tblLabDips').datagrid('getSelected');
        debugger;
        if(oLabDip==null || oLabDip.FSCDetailID<=0){
            alert("Please select an item from list.");
            return false;
        }
        if(oLabDip.LabStatus!=4){
            alert("Sorry, this item is not in Lab !!");
            return false;
        }
        DynamicRefreshList([],'tblLabDipDetailFabric');

        var Obj={Params:oLabDip.FSCDetailID, ReviseNo: oLabDip.RelabCount};
        GetLDDetailFabric(Obj);
    });
    function GetLDDetailFabric(oLabDipDetail)
    {
        $.ajax({
            type: "POST",
            dataType: "json",
            url : _sBaseAddress+  "/LabDip/GetLDDetailByFSC",
            traditional: true,
            data:  JSON.stringify(oLabDipDetail),
            contentType: "application/json; charset=utf-8",
            success: function (data) {
                debugger;
                var oresult = jQuery.parseJSON(data);          console.log(oresult);
                if(oresult.length>0)
                {
                    if(oresult[0].ErrorMessage!=null || oresult.ErrorMessage!="")
                    { 
                        _oCellRowSpans=oresult[0].CellRowSpans;
                        DynamicRefreshList(oresult,'tblLabDipDetailFabric');
                    }
                    else {
                        _oCellRowSpans=[];
                        alert(oresult[0].ErrorMessage); return;
                    }

                }
                $("#winPO").icsWindow('open', "View PO");
            },
            error: function (xhr, status, error) {
                alert(error);
            }

        });
    }

    $("#btnClosePO").click(function () {
        endEditing();
        $("#winPO").icsWindow("close");
    });



    function SetGridData(){

        var data=JSON.stringify($('#tblLabDips').data('FDPs'));
        sessionStorage.setItem("LabDips_InLab", data);
        //sessionStorage.setItem("CellRowSpans", JSON.stringify($('#tblLabDips').data('CellRowSpan')));
        sessionStorage.setItem("BackLink", window.location.href);
        
    }

    function SetSelectedRowIndex(oItem){
        var nSelectedIndex= $('#tblLabDips').datagrid('getRowIndex',oItem);
        sessionStorage.setItem("SelectedRowIndex_InLab", nSelectedIndex);
    }

    $(document).keydown(function (e) { if (e.keyCode == 27) { $('div').icsWindow('close'); } });

    $("#btnPrint").click(function () {

        var sParams=sessionStorage.getItem("ParamsP");
        window.open(_sBaseAddress + '/LabDip/Print_SampleOrderReport?sTempString=' + sParams, "_blank");
    });

    $("#btnPrintLD").click(function () {
        var oFabric= $('#tblLabDips').datagrid('getSelected');
        if(oFabric==null || oFabric.FabricID<=0){
            alert("Please select an item from list.");
            return false;
        }
        var tsv=((new Date()).getTime())/1000;
        window.open(_sBaseAddress+ "/LabDip/PrintLabDipWU_Fabric?nId="+oFabric.FSCDetailID+"&vno="+oFabric.RelabCount+"&nview=0&nts="+tsv, "_blank");
    });

    $("#btnPrintXL").click(function ()
    {
        var sParams=sessionStorage.getItem("ParamsP");
        window.open(_sBaseAddress + '/LabDip/Print_ReportRnDXL?sTempString=' + sParams+"&BUID="+_nBUID, "_blank");
    });

    $('#btnPrintHLDelivery').click(function(e){

        var oFSC = $('#tblLabDips').datagrid('getSelected');

        if(oFSC==null || oFSC.FSCDetailID<=0){
            alert("Select an item from list");
            return false;
        }
        var nts=(new Date()).getTime()/1000;
        window.open(_sBaseAddress + '/LabDip/PrintHandLoomDelivery?nId=' + oFSC.FSCDetailID+"&nBUID="+_nBUID+"&nts="+nts, "_blank");
    });

    $('#btnPrintHLSwatch').click(function(e){

        var oFSC = $('#tblLabDips').datagrid('getSelected');

        if(oFSC==null || oFSC.FSCDetailID<=0){
            alert("Select an item from list");
            return false;
        }
        var nts=(new Date()).getTime()/1000;
        window.open(_sBaseAddress + '/LabDip/PrintHandLoomSwatch?nId=' + oFSC.FSCDetailID+"&nBUID="+_nBUID+"&nts="+nts, "_blank");
    });

    $('#btnFabricPattern').click(function (e) {

        var data= $('#tblLabDips').datagrid('getSelected');
        if(data==null || data.FabricID<=0){
            alert("Please select an item from list.");
            return false;
        }
        if(data.FabricReceiveBy==0){
            alert("Sorry, Without receive this fabric's pattern cannot create.");
            return false;
        }
        SetSelectedRowIndex(data);
        var rnd = parseInt((Math.random()*1000)+1);
        window.location.href = _sBaseAddress + '/Fabric/ViewFabricPatterns?menuid=' + rnd+ "&nFSCDetailID=" + data.FSCDetailID+"&nFabricID=" + data.FabricID+"&nBUID="+_nBUID;

    });

    ////Start adv Searching

    function updateProgress() {
        var value =$('#progressbar').progressbar('getValue');
        if (value < 96){
            value += Math.floor(Math.random() * 10);
            $('#progressbar').progressbar('setValue', value);
        }
    }
    function hideShow(miliseconds) {
        $("#progressbarParent").hide();
    }
    //Account Of Picker

    $("#txtContractorAdvS").keydown(function (e) {
        if (e.keyCode === 13) // Enter Press
        {
            PickContractors_AdvS();
        }
        else if (e.keyCode === 08) {
            $("#txtContractorAdvS").removeClass("fontColorOfPickItem");
            _sContractorIds = '';
        }
    });

    $("#btnClrContractorAdvS").click(function () {
        $("#txtContractorAdvS").removeClass("fontColorOfPickItem");
        $("#txtContractorAdvS").val("");
        _sContractorIds = '';
    });

    $("#btnPickContractorAdvS").click(function () {
        PickContractors_AdvS();
    });
    function PickContractors_AdvS() {
        var oContractor = {
            Params: '2,3' + '~' + $.trim($("#txtContractorAdvS").val()+"~"+_nBUID)
        };
        var obj = {
            BaseAddress: _sBaseAddress,
            Object: oContractor,
            ControllerName: "Contractor",
            ActionName: "ContractorSearchByNameType",
            IsWinClose: false
        };

        $("#progressbar").progressbar({ value: 0 });
        $("#progressbarParent").show();
        var intervalID = setInterval(updateProgress, 250);

        DynamicRefreshList([], "tblAccountsPickerAdvSearch");
        $.icsDataGets(obj, function (response) {
            clearInterval(intervalID);
            $("#progressbarParent").hide();
            if (response.status && response.objs.length > 0) {
                if (response.objs[0].ContractorID > 0) {
                    var tblColums = []; var oColumn = { field: "ContractorID", title: "Code", width: 50, align: "left" }; tblColums.push(oColumn);
                    oColumn = { field: "Name", title: "Name", width: 280, align: "left" }; tblColums.push(oColumn);

                    var oPickerParam = {
                        winid: 'winContractorPicker',
                        winclass: 'clsAccountOf',
                        winwidth: 400,
                        winheight: 460,
                        tableid: 'tblAccountOfs',
                        tablecolumns: tblColums,
                        datalist: response.objs,
                        multiplereturn: true,
                        searchingbyfieldName: 'Name',
                        windowTittle: 'Contactor List'
                    };
                    $.icsPicker(oPickerParam);
                    IntializePickerbutton(oPickerParam);
                }
                else {
                    alert(response.objs[0].ErrorMessage);
                }
            }
            else {
                alert("Sorry, No Contactor Found.");
            }
        });
    }
    //End Account Of Picker
    $("#btnClrDeliverTo").click(function () {
        $("#txtDeliverTo").val("");
        _sBuyerIds="";
    });

    $("#btnPickDeliverTo").click(function () {

        var oContractor = {
            Params: '2,3' + '~' + $.trim($("#txtDeliverTo").val()+'~'+_nBUID)
        };
        GetDeliverTo(oContractor);
    });

    $("#txtDeliverTo").keydown(function (e) {
        var nkeyCode = e.keyCode || e.which;
        if(nkeyCode==13){
            var sContractorName=$.trim($("#txtDeliverTo").val());
            if(sContractorName=="" || sContractorName==null)
            {
                alert("Please, Type name or part of Name");
                $("#txtDeliverTo").focus();
                $("#txtDeliverTo").addClass("errorFieldBorder");
                return;
            }
            var oContractor = {
                Params: '2,3' + '~' + $.trim($("#txtDeliverTo").val()+'~'+_nBUID)
            };
            GetDeliverTo(oContractor);
        }
        else if(nkeyCode==8){
            $("#txtDeliverTo").val("");
            _sBuyerIds="";

        }
    });

    function GetDeliverTo(oContractor){


        var obj = {
            BaseAddress: _sBaseAddress,
            Object: oContractor,
            ControllerName: "Contractor",
            ActionName: "ContractorSearchByNameType",
            IsWinClose: false
        };
        $("#progressbar").progressbar({ value: 0 });
        $("#progressbarParent").show();
        var intervalID = setInterval(updateProgress, 250);
        $.icsDataGets(obj, function (response) {
            clearInterval(intervalID);
            $("#progressbarParent").hide();
            if (response.status && response.objs.length > 0)
            {
                if (response.objs[0].ContractorID > 0) {
                    debugger;
                    var tblColums = [];
                    var oColumn = { field: "ContractorID", title: "Code", width: 50, align: "center" };tblColums.push(oColumn);
                    oColumn = { field: "Name", title: "Name", width: 190, align: "left" };tblColums.push(oColumn);
                    oColumn = { field: "Phone", title: "Phone", width: 140, align: "left" };tblColums.push(oColumn);

                    var oPickerParam = {
                        winid: 'winDeliverToPicker',
                        winclass:'clsDeliverToPicker',
                        winwidth: 460,
                        winheight: 460,
                        tableid: 'tblDeliverToPicker',
                        tablecolumns: tblColums,
                        datalist: response.objs,
                        multiplereturn: true,
                        searchingbyfieldName:'Name',
                        windowTittle: 'Deliver To List'
                    };
                    $.icsPicker(oPickerParam);
                    IntializePickerbutton(oPickerParam);//multiplereturn, winclassName
                }
                else { alert(response.objs[0].ErrorMessage); }
            }
            else{
                alert("No contractor found.");
            }
        });
    }

    $("#btnResetMktPerson").click(function () {

        $("#txtMktAccount").val("");
        _sMAccountIds="";
    });

    $("#btnPickMktAccount").click(function () {
        debugger;
        var sName=$.trim($("#txtMktAccount").val());
        GetMktPersons(sName);
    });

    $("#txtMktAccount").keydown(function (e) {
        var nkeyCode = e.keyCode || e.which;
        if(nkeyCode==13){
            var sName=$.trim($("#txtMktAccount").val());
            if($('#txtMktAccount').val()==null || $('#txtMktAccount').val()=="")
            {
                alert("Please Type Name or part Name and Press Enter.");
                $('#txtMktAccount').focus();
                return;
            }
            GetMktPersons(sName);
        }
        else if(nkeyCode==8){
            $("#txtMktAccount").val("");
            _sMAccountIds="";
        }
    });
    function GetMktPersons(sName){

        var oMarketingAccount_BU = {
            Name:sName,
            BUID:sessionStorage.getItem("BUID")
        };
        var obj = {
            BaseAddress: _sBaseAddress,
            Object: oMarketingAccount_BU,
            ControllerName: "MarketingAccount",
            ActionName: "MarketingAccountSearchByNameAndGroup",
            IsWinClose: false
        };

        $.icsDataGets(obj, function (response) {

            if (response.status && response.objs.length > 0) {
                if (response.objs[0].MarketingAccountID > 0) {
                    debugger;
                    var tblColums = [];
                    var oColumn = { field: "MarketingAccountID", title: "Code", width: 50, align: "left" };tblColums.push(oColumn);
                    oColumn = { field: "Name", title: "Name", width: 180, align: "left" };tblColums.push(oColumn);
                    oColumn = { field: "GroupName", title: "GroupName", width: 120, align: "left" };tblColums.push(oColumn);
                    oColumn = { field: "Phone", title: "Phone", width: 100, align: "left" };tblColums.push(oColumn);

                    var oPickerParam = {
                        winid: 'winMktAccount',
                        winclass:'clsMktPersonPicker',
                        winwidth: 460,
                        winheight: 460,
                        tableid: 'tblMktPersonPicker',
                        tablecolumns: tblColums,
                        datalist: response.objs,
                        multiplereturn: true,
                        searchingbyfieldName:'Name',
                        windowTittle: 'MKT Person List'
                    };
                    $.icsPicker(oPickerParam);
                    IntializePickerbutton(oPickerParam);//multiplereturn, winclassName
                }
                else { alert(response.objs[0].ErrorMessage); }
            }
            else{
                alert("No marketing person found.");
            }
        });


    }
    //End Pick Mkt

    function IntializePickerbutton(oPickerobj) {
        $("#" + oPickerobj.winid).find("#btnOk").click(function () {
            SetPickerValueAssign(oPickerobj);
        });
        $(document).find('.' + oPickerobj.winclass).keydown(function (e) {
            if (e.which === 13) {
                SetPickerValueAssign(oPickerobj);
            }
        });
    }
    function SetPickerValueAssign(oPickerobj) {
        var oreturnObj = null, oreturnObjs = [];
        if (oPickerobj.multiplereturn) {
            oreturnObjs = $('#' + oPickerobj.tableid).datagrid('getChecked');
        } else {
            oreturnObj = $('#' + oPickerobj.tableid).datagrid('getSelected');
        }

        if (oPickerobj.winid == 'winContractorPicker')
        {
            if (oreturnObjs != null && oreturnObjs.length> 0)
            {

                _sContractorIds=''; var sMessage='';
                sMessage=(oreturnObjs.length>1)? oreturnObjs.length +" Contractors Selected" : oreturnObjs[0].Name;
                $('#txtContractorAdvS').val(sMessage);
                $("#txtContractorAdvS").addClass("fontColorOfPickItem");

                for(var i=0;i<oreturnObjs.length;i++){
                    _sContractorIds=_sContractorIds+oreturnObjs[i].ContractorID+',';
                }
                _sContractorIds=_sContractorIds.substring(0,_sContractorIds.length-1);

            }
            else
            {
                alert("Please select a contractor.");
                return false;
            }
        }
        else if (oPickerobj.winid == 'winLDProduct')
        {
            if(oreturnObj!=null && oreturnObj.ProductID>0)
            {
                $('#txtYarnNameChange').val(oreturnObj.ProductName);
                $('#winProductChange').data('Product', JSON.stringify(oreturnObj));
            }
        }
        else if (oPickerobj.winid == 'winDeliverToPicker')
        {
            if (oreturnObjs != null && oreturnObjs.length> 0)
            {
                var sMessage='';
                _sBuyerIds="";
                sMessage=(oreturnObjs.length>1)? oreturnObjs.length +" Buying House(s) Selected" : oreturnObjs[0].Name;
                $('#txtDeliverTo').val(sMessage);
                $("#txtDeliverTo").addClass("fontColorOfPickItem");

                for(var i=0;i<oreturnObjs.length;i++){
                    _sBuyerIds=_sBuyerIds+oreturnObjs[i].ContractorID+',';
                }
                _sBuyerIds=_sBuyerIds.substring(0,_sBuyerIds.length-1);

            }
            else
            {
                alert("Please select a Buying House.");
                return false;
            }
        }
        else if (oPickerobj.winid == 'winMktAccount')
        {
            if (oreturnObjs != null && oreturnObjs.length> 0)
            {
                var sMessage='';
                _sMAccountIds="";
                sMessage=(oreturnObjs.length>1)? oreturnObjs.length +"MKT Account(s) Selected" : oreturnObjs[0].Name;
                $('#txtMktAccount').val(sMessage);
                $("#txtMktAccount").addClass("fontColorOfPickItem");
                for(var i=0;i<oreturnObjs.length;i++){
                    _sMAccountIds=_sMAccountIds+oreturnObjs[i].MarketingAccountID+',';
                }
                _sMAccountIds=_sMAccountIds.substring(0,_sMAccountIds.length-1);
            }
            else
            {
                alert("Please select a MKt Account.");
                return false;
            }
        }

        else if (oPickerobj.winid == 'winLabDipPicker')
        {
            if (oreturnObjs!= null && oreturnObjs.length> 0)
            {
                var oFSCReport= $('#tblLabDips').datagrid('getSelected');

                for(var i=0; i<oreturnObjs.length;i++)
                {
                    var oItem=oreturnObjs[i];debugger;

                    //if(oItem.ProductID>!0){ alert("Invalid Yarn Type For: "+oFSCReport.ProductName); return; }

                    var obj=
                    {
                        LDFID:0,
                        LabDipID: oItem.LabDipID,
                        LabDipDetailID:oItem.LabDipDetailID,
                        ReviseNo:oFSCReport.RelabCount,
                        FabricID: oFSCReport.FabricID,
                        LabDipNo: oItem.LabdipNo,
                        ColorNo:oItem.ColorNo,
                        ColorName:oItem.ColorName,
                        PantonNo:oItem.PantonNo,
                        WarpWeftType:oItem.WarpWeftType,
                        WarpWeftTypeSt:oItem.WarpWeftTypeSt,
                        FabricNo: oFSCReport.FabricNo,
                        FSCDetailID: oFSCReport.FSCDetailID,
                        Construction:oFSCReport.Construction,
                        ProductID:oItem.ProductID,
                        ProductName:oFSCReport.ProductName,
                      
                        LDNo:oFSCReport.LDNo,
                        SCNoFull:oFSCReport.SCNoFull,
                        Remarks:'',
                        Params: oItem.LabDipDetailID
                    };

                    //if(!IsExistFabric(obj))
                    //{
                        Save_FabricDetail(obj);
                        //$('#tblLabDipDetailFabric').datagrid('appendRow',obj);
                    //}
                }

                alert(" Saved Successfully. ");
                //$('#txtFabricNo').val('');
                $('#txtLD').val('');
                $('#txtLD').focus();
            }
        }


        $("#" + oPickerobj.winid).icsWindow("close");
        $("#" + oPickerobj.winid).remove();
    }

    //End Buyer Search
    $("#btnResetAdvSearch").click(function () {
        ResetAdvSearchWindow();
        LoadComboAdv();
    });
    $("#btnSearchAdvSearch").click(function ()
    {
        $(".lblLoadingMessage").show();
        var sOrderTypeIDs = "";

        var oOrderType = $("#tblOrderTypes").datagrid("getChecked");
        if (oOrderType.length > 0)
        {
            for (var i = 0;i<oOrderType.length; i++){
                sOrderTypeIDs = oOrderType[i].id + "," + sOrderTypeIDs;
            }
            sOrderTypeIDs = sOrderTypeIDs.substring(0, sOrderTypeIDs.length - 1);
        }
        var sPONo="";
        var sCurrentStatus = "";
        var oCurrentStatuss = $("#tblCurrentStatuss").datagrid("getChecked");
        if (oCurrentStatuss.length > 0)
        {
            for (var i = 0;i<oCurrentStatuss.length; i++){
                sCurrentStatus = oCurrentStatuss[i].id + "," + sCurrentStatus;
            }
            sCurrentStatus = sCurrentStatus.substring(0, sCurrentStatus.length - 1);
        }

        var sLabStatus = "";
        var oLabStatus = $("#tblLabStatuss").datagrid("getChecked");
        if (oLabStatus.length > 0)
        {
            for (var i = 0;i<oLabStatus.length; i++){
                sLabStatus = oLabStatus[i].id + "," + sLabStatus;
            }
            sLabStatus = sLabStatus.substring(0, sLabStatus.length - 1);
        }

        var sTempString = $.trim($("#txtPINo").val()) + '~'
                        + $.trim($("#txtFabricID").val()) + '~'
                        + _sContractorIds + '~'
                        + _sBuyerIds + '~'
                        + _sMAccountIds + '~'
                        + $("#cboPODate").val() + '~'
                        + $("#txtFromPODate").datebox("getValue") + '~'
                        + $("#txtToPODate").datebox("getValue") + '~'
                        + $("#cboApproveDate").val() + '~'
                        + $("#txtFromApproveDate").datebox("getValue") + '~'
                        + $("#txtToApproveDate").datebox("getValue") + '~'
                        + $("#cboProductionType").val() + '~'
                         + $("#cboIsPrinting").val() + '~'
                        + sOrderTypeIDs  + '~'
                        + sCurrentStatus  + '~'
                        + _nBUID + '~'
                        + sPONo +'~'
                        + _typeOfReceive+'~'
                        +''+'~'
                        + $('#chkReceived').is(':checked')+'~'
                        + $('#chkSubmittedHO').is(':checked')+'~'
                        + $('#chkWatingForLab').is(':checked')+'~'
                        + $('#chkYetToSubmittedHO').is(':checked')+'~'
                        + sLabStatus+'~'
                        +'~'
                        +'~'
                        +'~'
                        +'~'
                        +'~'
                        +'~'
                        + $("#cboLabStatus").val() + '~'
                        + $("#cboLabDate").val() + '~'
                        + $("#txtFromLabDate").datebox("getValue") + '~'
                        + $("#txtToLabDate").datebox("getValue") + '~'  ;


        var oLabDip = {
            ErrorMessage: sTempString
        }
        sessionStorage.setItem("ParamsP", sTempString);
        
        DynamicRefreshList([],'tblLabDips');

        $.ajax({
            type: "POST",
            dataType: "json",
            url: _sBaseAddress + "/LabDip/AdvanchSearchTwo",
            traditional: true,
            data: JSON.stringify(oLabDip),
            contentType: "application/json; charset=utf-8",
            success: function (data) {
                debugger;
                var oResult = data;


                var oResult = data;
                if(oResult.length<=0){
                    alert("No data found");
                }
                else{
                    $('#tblLabDips').data('FDPs',oResult)
                    DynamicRefreshList(oResult,'tblLabDips');
                    SetGridData();
                    $("#winAdvSearch").icsWindow("close");
                    $(".lblLoadingMessage").hide();

                }


            }
        });
    });
    ////Start adv Searching
    /// Search By No and Date
    $('#txtSearchbyPONo').keypress(function (e) {

        var code = (e.keyCode ? e.keyCode : e.which);
        if (code == 13)//Enter key-13
        {
            if ($.trim($("#txtSearchbyPONo").val()) == "")
            {
                alert("Please give PO No.");
                return false;
            }
            var sPONo=$.trim($("#txtSearchbyPONo").val());
            var sOrderTypeIDs = "";
            var sCurrentStatus = "";
            _sContractorIds="";
            debugger;
            var sTempString = "" + '~'
                            + "" + '~'//$.trim($("#txtFabricID").val()) + '~'
                            + _sContractorIds + '~'
                            + _sBuyerIds + '~'
                            + _sMAccountIds + '~'
                            + 0 + '~'
                            + icsdateformat(new Date())+ '~'
                            + icsdateformat(new Date())+ '~'
                            + 0+ '~'
                            + icsdateformat(new Date()) + '~'
                            + icsdateformat(new Date())+ '~'
                            + 0 + '~'
                            + 0 + '~'
                            + sOrderTypeIDs  + '~'
                            + sCurrentStatus  + '~'
                            + _nBUID  + '~'
                            + sPONo+'~'
                            + _typeOfReceive +'~'
                            + "";




            var oLabDip = {
                SCNoFull:$.trim($("#txtSearchbyPONo").val()),
                ErrorMessage: sTempString
            }
            sessionStorage.setItem("ParamsP", sTempString);
            DynamicRefreshList([],'tblLabDips');

            $.ajax({
                type: "POST",
                dataType: "json",
                url: _sBaseAddress + "/LabDip/AdvanchSearchTwo",
                traditional: true,
                data: JSON.stringify(oLabDip),
                contentType: "application/json; charset=utf-8",
                success: function (data)
                {
                    var oResult = data;
                    if(oResult.length<=0){
                        alert("No data found");
                    }
                    else{
                        $('#tblLabDips').data('FDPs',oResult)
                        DynamicRefreshList(oResult,'tblLabDips');
                        SetGridData();
                        $(".lblLoadingMessage").hide();

                    }



                }
            });
        }
    });
    $('#txtSearchbyFabricNo').keypress(function (e) {

        var code = (e.keyCode ? e.keyCode : e.which);
        if (code == 13)//Enter key-13
        {
            if ($.trim($("#txtSearchbyFabricNo").val()) == "")
            {
                alert("Please give Ref No.");
                return false;
            }
            var sOrderTypeIDs = "";
            var sCurrentStatus = "";
            _sContractorIds="";
            var sPONo="";
            debugger;
            var sTempString = "" + '~'
                            + $.trim($("#txtSearchbyFabricNo").val()) + '~'
                            + _sContractorIds + '~'
                            + _sBuyerIds + '~'
                            + _sMAccountIds + '~'
                            + 0 + '~'
                            + icsdateformat(new Date())+ '~'
                            + icsdateformat(new Date())+ '~'
                            + 0+ '~'
                            + icsdateformat(new Date()) + '~'
                            + icsdateformat(new Date())+ '~'
                            + 0 + '~'
                              + 0 + '~'
                            + sOrderTypeIDs  + '~'
                            + sCurrentStatus  + '~'
                            + _nBUID  + '~'
                            + sPONo+'~'
                            + _typeOfReceive +'~'
                            + "";




            var oLabDip = {
                SCNoFull:"",
                ErrorMessage: sTempString
            }
            DynamicRefreshList([],'tblLabDips');
            sessionStorage.setItem("ParamsP", sTempString);
            $.ajax({
                type: "POST",
                dataType: "json",
                url: _sBaseAddress + "/LabDip/AdvanchSearchTwo",
                traditional: true,
                data: JSON.stringify(oLabDip),
                contentType: "application/json; charset=utf-8",
                success: function (data)
                {
                    var oResult = data;
                    if(oResult.length<=0){
                        alert("No data found");
                    }
                    else{
                        $('#tblLabDips').data('FDPs',oResult)
                        DynamicRefreshList(oResult,'tblLabDips');
                        SetGridData();
                        $(".lblLoadingMessage").hide();

                    }


                }
            });
        }
    });
    $('#txtHLNO').keypress(function (e) {

        var code = (e.keyCode ? e.keyCode : e.which);
        if (code == 13)//Enter key-13
        {
            if ($.trim($("#txtHLNO").val()) == "")
            {
                alert("Please give HL No.");
                return false;
            }
            var sOrderTypeIDs = "";
            var sCurrentStatus = "";
            _sContractorIds="";
            var sPONo="";
            debugger;
            var sTempString = "" + '~'
                            + "" + '~'
                            + _sContractorIds + '~'
                            + _sBuyerIds + '~'
                            + _sMAccountIds + '~'
                            + 0 + '~'
                            + icsdateformat(new Date())+ '~'
                            + icsdateformat(new Date())+ '~'
                            + 0+ '~'
                            + icsdateformat(new Date()) + '~'
                            + icsdateformat(new Date())+ '~'
                            + 0 + '~'
                              + 0 + '~'
                            + sOrderTypeIDs  + '~'
                            + sCurrentStatus  + '~'
                            + _nBUID  + '~'
                            + sPONo+'~'
                            + _typeOfReceive +'~'
                            + $.trim($("#txtHLNO").val());

            console.log(sTempString.split('~'))
            var oLabDip = {
                SCNoFull:"",
                ErrorMessage: sTempString
            }
            sessionStorage.setItem("ParamsP", sTempString);
            DynamicRefreshList([],'tblLabDips');
            $.ajax({
                type: "POST",
                dataType: "json",
                url: _sBaseAddress + "/LabDip/AdvanchSearchTwo",
                traditional: true,
                data: JSON.stringify(oLabDip),
                contentType: "application/json; charset=utf-8",
                success: function (data)
                {
                    var oResult = data;
                    if(oResult.length<=0){
                        alert("No data found");
                    }
                    else{
                        $('#tblLabDips').data('FDPs',oResult)
                        DynamicRefreshList(oResult,'tblLabDips');
                        SetGridData();
                        $(".lblLoadingMessage").hide();

                    }


                }
            });
        }
    });

    function RefreshSetup(oFabricPOSetup)
    {
        $('#lblFabricNoTwo,#lblFabricNo,#lblFabricNoAdv').html(oFabricPOSetup.FabricCode);
        $("#txtSearchbyFabricNo,#txtFabricID").attr("placeholder","Search by "+oFabricPOSetup.NoCode+" No");
        $("#txtFabricID").attr("placeholder",""+oFabricPOSetup.NoCode+" No");
        $("#txtP").attr("placeholder",oFabricPOSetup.NoCode);
        //if(oFabricPOSetup.IsLDApply==false)
        //{
        //    $('#btnAddFNLabdipDetail,#btnAddFNLabdipColor').hide();
        //}

    }

    function LoadComboboxesFabric() {

        //$('#txtDateFabric,#txtFabricNoFabric,#txtDateFabric,#txtMktPersonsFabric,#txtContractorName,#txtBuyerReferenceFabric,#txtStyleNoFabric,#txtConstructionFabricPI,#cboPriorityLevelFabric,#txtHLNo,#txtNoteFabric,#tdInputDateBox,#txtHandLoomDate,#chkIsSample,#chkIsHandLoom, #chkIsBulk,#chkIsAnalysis ,#chkIsCAD,,#chkIsColor,#chkIsLabdip ,#chkIsYarnSkein').prop('disabled',true);

        $("#cboFinishTypeFabric").icsLoadCombo({ List: _oFinishTypes,OptionValue: "FabricProcessID",   DisplayText: "Name" });
        $("#cboProductFabric").icsLoadCombo({    List: _oProducts,    OptionValue: "ProductID",    DisplayText: "ProductName"   });
        $("#cboPriorityLevelFabric").icsLoadCombo({    List: _oPriorityLevels,    OptionValue: "Value",   DisplayText: "Text" });
        $("#cboProcessTypeFabric").icsLoadCombo({  List: _oProcessTypes, OptionValue: "FabricProcessID",  DisplayText: "Name" });
        $("#cboWeaveFabric").icsLoadCombo({  List: _oFabricWeaves,   OptionValue: "FabricProcessID",   DisplayText: "Name" });
        $("#cboFabricDesign").icsLoadCombo({  List: _oFabricDesigns,   OptionValue: "FabricProcessID",    DisplayText: "Name"  });
        $("#cboPrimaryLightSource,#cboSecondaryLightSource").icsLoadCombo({ List: _oLightSources,   OptionValue: "LightSourceID",   DisplayText: "Descriptions" });
    }
    function LoadComboAdv()
    {
        DynamicRefreshList(_oOrderTypes, "tblOrderTypes");
        DynamicRefreshList(_oLabdipStatus, "tblLabStatuss");
        DynamicRefreshList(_oFabricPOStatus, "tblCurrentStatuss");
        $("#cboPODate,#cboApproveDate,#cboLabDate").icsLoadCombo({
            List: _oCompareOperators,
            OptionValue: "id",
            DisplayText: "Value"
        });
        $("#cboLabStatus").icsLoadCombo({
            List: _oLabdipStatus,
            OptionValue: "id",
            DisplayText: "Value"
        });
    }
    function CheckFromAndToDateValidation(OperationComboId, FromDateId, ToDateId) {
        $("#" + OperationComboId).parent().parent().parent().find("select").removeClass("errorFieldBorder");
        var nCboVal = $("#" + OperationComboId).val();
        if (parseInt(nCboVal) == 5 || parseInt(nCboVal) == 6) {
            var fromDate = $("#" + FromDateId).datebox("getValue");
            var toDate = $("#" + ToDateId).datebox("getValue");
            if (new Date(fromDate) > new Date(toDate)) {
                $("#" + ToDateId).focus();
                $("#" + OperationComboId).addClass("errorFieldBorder");
                $(".lblLoadingMessage").hide();
                return false;
            } else {
                $("#" + OperationComboId).removeClass("errorFieldBorder");
                return true;
            }
        } else {
            return true;
        }
    }

    function ResetAdvSearchWindow() {
        _sContractorIds = '';
        _sBankBranch_IssueIds = "";
        $(".lblLoadingMessage").hide();
        $("#winAdvSearch input").not("input[type='button']").val("");
        $("#winAdvSearch input").removeClass("fontColorOfPickItem");
        $("#winAdvSearch select").val(0);
        DateActions_OPDate();
        DateActions_ApproveDate();
        $("#txtFromPODate,#txtToPODate").datebox({ disabled: true });
        $("#txtFromPODate,#txtToPODate").datebox("setValue", icsdateformat(new Date()));

        $("#txtFromApproveDate,#txtToApproveDate").datebox({ disabled: true });
        $("#txtFromApproveDate,#txtToApproveDate").datebox("setValue", icsdateformat(new Date()));

        $('#chkReceived,#chkSubmittedHO,#chkWatingForLab').prop('checked',false);
    }

    function DateActions_OPDate() {
        DynamicDateActions("cboPODate", "txtFromPODate", "txtToPODate");
    }
    function DateActions_ApproveDate() {
        DynamicDateActions("cboApproveDate", "txtFromApproveDate", "txtToApproveDate");
    }
    function DateActions_LabDate() {
        debugger;

        if($('#cboLabStatus').val()<=0)
        {
            $('#cboLabDate').val(0);
            alert("Please select a lab status and try again!");return;
        }
        else
            DynamicDateActions("cboLabDate", "txtFromLabDate", "txtToLabDate");
    }

    $("#btnCloseAdvSearch").click(function () {
        $("#winAdvSearch").icsWindow("close");
    });
    $("#btnAdvSearch").click(function () {
        debugger;
        $(".lblLoadingMessage").hide();
        $("#winAdvSearch").icsWindow("open", "Production Request Advance Search");
        //DynamicRefreshList([], "tblExportPIAdvSearch");
        DynamicResetAdvSearchWindow("winAdvSearch");
        ResetAdvSearchWindow();
        LoadComboAdv();
    });

    /// end Adv Searching

    /// Update H/L No

    ///Update Exc No
    $("#btnExeNoEntry ").click(function () {
        debugger;
        var oFSC = $('#tblLabDips').datagrid('getSelected');
        var nSelectedIndex= $('#tblLabDips').datagrid('getRowIndex',oFSC);
        $('#tblLabDips').data('Index', nSelectedIndex);
        if (oFSC ==null || oFSC.FSCID<=0) { alert("Please select an item from list."); return ; }

        //alert(data.CurrentStatus);
        if(oFSC.CurrentStatus!=3 && oFSC.CurrentStatus!=4)
        {
            alert("Yet Not Approve.");
            return false;
        }
        $('#txtSCNo_ExC').val(oFSC.SCNoFull);
        $('#txtFabricID_Exc').val(oFSC.FabricNo);
        $('#txtContractor_EXC').val(oFSC.ContractorName);
        $('#txtOrderType').val(oFSC.OrderTypeSt);
        $('#cboProcessTypeEnt').val(oFSC.ProcessType);
        if(oFSC.FabricReceiveDateStr=="" || oFSC.FabricReceiveDateStr==null ){        $('#txtReceiveDate').datebox('setValue',icsdateformat(new Date()));}
        else {$('#txtReceiveDate').datebox('setValue',oFSC.FabricReceiveDateStr);}
        $('#txtExcNo').val(oFSC.ExeNo);
        //$('#txtPINo_Cur').prop('disabled',true);
        $("#winExeEntry").icsWindow("open", "Receive & Issue No");
    });
    $("#btnSaveExeNo").click(function (e) {
        SaveExeNo();
    });
    function SaveExeNo()
    {
        var oFSC = $('#tblLabDips').datagrid('getSelected');
        var nSelectedIndex= $('#tblLabDips').datagrid('getRowIndex',oFSC);
        $('#tblLabDips').data('Index', nSelectedIndex);
        if (oFSC ==null || oFSC.FSCID<=0) { alert("Please select an item from list."); return ; }

        //alert(data.CurrentStatus);
        if(oFSC.CurrentStatus!=3 && oFSC.CurrentStatus!=4)
        {
            alert("Yet Not Approve.");
            return false;
        }
        oFSC.ExeNo=  $.trim($('#txtExcNo').val());
        oFSC.ProcessType= $('#cboProcessTypeEnt').val();
        oFSC.FabricReceiveDate= $("#txtReceiveDate").datebox("getValue");
        //if(oFSC.ExeNo=="" || oFSC.ExeNo==null)
        //{
        //    alert("Please entry valid No");
        //    return;
        //}
        var obj =
            {
                BaseAddress: _sBaseAddress,
                Object: oFSC,
                ObjectId: oFSC.FSCDetailID,
                ControllerName: "LabDip",
                ActionName: "SaveExcNo",
                TableId: "tblLabDips",
                IsWinClose: true
            };
        $.icsSave(obj, function (response)
        {
            if (response.status && response.obj != null)
            {
                if (response.obj.ErrorMessage=="")
                {
                    SetGridData();
                    $("#winExeEntry").icsWindow("close");
                }
                else {
                    alert(response.obj.ErrorMessage);
                }
            }
            else {
                alert("No information found.");
            }
        });
    }

    $("#btnCloseExeNo").click(function () {
        $("#winExeEntry").icsWindow("close");
    });
    ///New PI No
    $("#txtExcNo").keypress(function (e) {

        if (e.which != 8 && e.which != 0  && e.which != 46  && (e.which < 48 || e.which > 57)) {
            return false;
        }

    });

    function RefreshTotalSummery() {
        var nTotalQty = 0;
        var nTotalValue = 0;
        var sCurrency = "";
        sCurrency = "";
        var oFSCDetails = $('#tblLabDipDetailFabric').datagrid('getRows');
        for (var i = 0; i < oFSCDetails.length; i++) {
            nTotalQty = nTotalQty + parseFloat(oFSCDetails[i].Qty);
        }
        document.getElementById("lblTotalQty").innerHTML = formatPrice(nTotalQty)+' Y';
    }
    ///

    /*---------------- Receive Fabric---------*/
    $('#btnLabDone').click(function(e){
        debugger;
        var oLabDip= $('#tblLabDips').datagrid('getSelected');
        if(oLabDip==null || oLabDip.LabDipID<=0)
        {
            alert("Please select an item from list.");
            return false;
        }
        if(oLabDip.LabStatus!=4)
        {
            alert("Sorry, this item is not in Lab !!");
            return false;
        }
        if (!confirm("Confirm to Lab Done?")) return;

        var oFabricSCReport = { FabricSalesContractID:  oLabDip.FSCID,  FabricSalesContractDetailID: oLabDip.FSCDetailID,   LabStatus: 5 };
        LabDip_Operation(oFabricSCReport, "Lab Done");
    });
    function LabDip_Operation(obj, sMsg)
    {
        $.ajax({
            type: "POST",
            url: _sBaseAddress + "/FabricSCReport/LabOperation",
            traditional: true,
            data: JSON.stringify(obj),
            contentType: "application/json; charset=utf-8",
            success: function (data) {
                debugger;
                var oResult = jQuery.parseJSON(data);
                if (oResult.ErrorMessage == '' || oResult.ErrorMessage == null)
                {
                    var oRows=$("#tblLabDips").datagrid('getRows');
                    var oLabDip= $('#tblLabDips').datagrid('getSelected');
                   
                    var nIndex=oRows.indexOf(oLabDip);
                    $('#tblLabDips').datagrid('updateRow', { index: nIndex, row: oResult});
                    //for(var i=0;i<oRows.length;i++)
                    //{
                    //    if(parseInt(oRows[i].FSCID)==parseInt(oResult.FSCID))
                    //    {
                    //        oRows[i].LabStatus=oResult.LabStatus;
                    //        oRows[i].LabStatusST=oResult.LabStatusST;

                    //        $('#tblLabDips').datagrid('updateRow', { index: i, row: oRows[i] });
                    //    }
                    //}
                    SetGridData();
                    alert(sMsg+" Successfully.");
                }
                else{
                    alert(oResult.ErrorMessage);
                }
            }
        });

    }
    $('#btnReceive').click(function(e){

        debugger;

        var oLabDip= $('#tblLabDips').datagrid('getSelected');

        if(oLabDip==null || oLabDip.FSCID<=0){
            alert("Please select an item from list.");
            return false;
        }
        //if(oLabDip.FabricReceiveBy!=0){
        //    alert("Already Received.");
        //    return false;
        //}
        if (!confirm("Confirm to Receive?")) return;
        //alert(data.CurrentStatus);
        //if(data.CurrentStatus!=3 && data.CurrentStatus!=4)
        //{
        //    alert("Yet Not Approve.");
        //    return false;
        //}
        var nIndex=0;
        var oRows=$("#tblLabDips").datagrid('getRows');
        var indexLists = [];

        for(var i=0;i<oRows.length;i++){
            if(parseInt(oRows[i].FSCID)==parseInt(oLabDip.FSCID))
            {
                //alert("ff -"+oRows[i].FSCID+"  gg-"+oLabDip.FSCID);
                nIndex=$('#tblLabDips').datagrid('getRowIndex',oRows[i]);
                indexLists.push(nIndex);
            }
        }

        $.ajax({
            type: "POST",
            url: _sBaseAddress + "/FabricSCReport/Received",
            traditional: true,
            data: JSON.stringify(oLabDip),
            contentType: "application/json; charset=utf-8",
            success: function (data) {
                debugger;
                var oLabDips = jQuery.parseJSON(data);
                if (oLabDips[0].ErrorMessage == '' || oLabDips[0].ErrorMessage == null)
                {
                    if(oLabDips.length>0)
                    {
                        for (i = 0; i < oLabDips.length; ++i) {
                            $('#tblLabDips').datagrid('updateRow', { index: indexLists[i], row: oLabDips[i] });
                            $('#tblLabDips').datagrid('selectRow', indexLists[i]);
                        }
                    }
                    SetGridData();
                    alert("Receive Successfully.");
                }
                else{
                    alert(oLabDips[0].ErrorMessage);
                }

            }
        });

    });

    /*---------------- Edit Fabric---------*/
    $("#btnEditFabric").click(function () {
        var oLabDip= $('#tblLabDips').datagrid('getSelected');

        if(oLabDip==null || oLabDip.FabricID<=0){
            alert("Please select an item from list.");
            return false;
        }

        if(oLabDip.LabStatus!=4){
            alert("Sorry, this item is not in Lab !!");
            return false;
        }
        //alert(data.CurrentStatus);
        if(oLabDip.CurrentStatus!=3 && oLabDip.CurrentStatus!=4)
        {
            alert("Yet Not Approve.");
            return false;
        }

        if(oLabDip.FabricReceiveBy==0){
            alert("Yet not receive, Receive first.");
            return false;
        }


        $("#winFabric").icsWindow('open', "Fabric Info");

        GetFabricInformation(oLabDip);
    });
    $("#btnViewFabric").click(function () {

        var oLabDip= $('#tblLabDips').datagrid('getSelected');

        if(oLabDip==null || oLabDip.FabricID<=0){
            alert("Please select an item from list.");
            return false;
        }


        $('#btnSave_submit').hide();
        $('input,select').prop('disabled',true);
        $("#winFabric").icsWindow('open', "View Fabric");

        GetFabricInformation(oLabDip);

    });
    $('#btnCloseFabric').click(function(e){
        $('#winFabric').icsWindow('close');
    });
    function GetFabricInformation(oFabricTemp) {
        var oFabric={FabricID:oFabricTemp.FabricID};
        var obj =
        {
            BaseAddress: _sBaseAddress,
            Object: oFabric,
            ControllerName: "Fabric",
            ActionName: "Get",
            IsWinClose: false
        };

        $.icsDataGet(obj, function (response) {
            if (response.status && response.obj != null) {
                if (response.obj.FabricID > 0) {
                    RefreshFabricControl(response.obj);
                }
                else {
                    alert(response.obj.ErrorMessage);
                }
            }
            else { alert("No information found."); }
        });
    }
    function RefreshFabricControl(oFabric) {
        debugger;
        _oFabric = oFabric;
        //if (oFabric.FabricNo.length > 0)
        //{
        //    oFabric.FabricNo = oFabric.FabricNo.substring(oFabric.FabricNo.length, 1);
        //}

        if (oFabric.FabricID>0)
            $('#btnShowHistory').show();
        //else
        //    $('#btnShowHistory').hide();

        $("#txtFabricNoFabric").val(oFabric.FabricNum);
        $("#txtBuyerReferenceFabric").val(oFabric.BuyerReference);
        //  $("#txtProduct").val(oFabric.ProductName);
        //_nProductId = oFabric.ProductID;
        $("#txtConstructionFabric").val(oFabric.Construction);
        $("#txtConstructionFabricPI").val(oFabric.ConstructionPI);
        $("#txtFabricWidthFabric").val(oFabric.FabricWidth);
        $("#cboFinishTypeFabric").val(oFabric.FinishType);
        $("#txtContractorName").val(oFabric.BuyerName);
        $("#txtMktPersonsFabric").val(oFabric.MKTPersonName);

        $("#txtStyleNoFabric").val(oFabric.StyleNo);
        $("#txtColorFabric").val(oFabric.ColorInfo);
        $("#chkWashFabric").prop("checked", oFabric.IsWash);
        $("#chkFinishFabric").prop("checked", oFabric.IsFinish);
        $("#chkDyeingFabric").prop("checked", oFabric.IsDyeing);
        $("#chkPrintFabric").prop("checked", oFabric.IsPrint);
        $("#txtNoteFabric").val(oFabric.Remarks);
        $("#txtDateFabric").datebox("setValue", oFabric.IssueDateInString);
        //$("#txtSeekingDateFabric").datebox("setValue", oFabric.SeekingSubmissionDateInString);
        $("#txtSubDateFabric").datebox("setValue", oFabric.SubmissionDateInString);
        $("#cboPriorityLevelFabric").val(oFabric.PriorityLevelInInt);
        $('#txtHLNo').val(oFabric.HandLoomNo);
        $('#txtWarpCount').val(oFabric.WarpCount);
        $('#txtWeftCount').val(oFabric.WeftCount);
        $('#txtEPI').val(oFabric.EPI);
        $('#txtPPI').val(oFabric.PPI);
        $('#cboPrimaryLightSource').val(oFabric.PrimaryLightSourceID);
        $('#cboSecondaryLightSource').val(oFabric.SecondaryLightSourceID);
        $('#txtEndUse').val(oFabric.EndUse);
        $('#txtNoOfFrame').val(oFabric.NoOfFrame);
        $('#txtWeftColor').val(oFabric.WeftColor);

        $("#txtReceiveDateFabric").datebox("setValue", oFabric.ReceiveDateInString);
        $("#cboProcessTypeFabric").val(oFabric.ProcessType);
        $("#cboFabricDesign").val(oFabric.FabricDesignID);
        $("#cboWeaveFabric").val(oFabric.FabricWeave);
        $("#cboProductFabric").val(oFabric.ProductID);
    }

    function RefreshObjectFabric() {
        debugger;
        var oFabric = {
            FabricID: (_oFabric == null ? 0 : _oFabric.FabricID),
            FabricNo: _oFabric.FabricNo,
            BuyerReference:_oFabric.BuyerReference,
            ProductID: parseInt($("#cboProductFabric").val()),     //Composition
            Construction: $.trim($("#txtConstructionFabric").val()),
            ConstructionPI: $.trim($("#txtConstructionFabricPI").val()),
            FabricWidth: $.trim($("#txtFabricWidthFabric").val()),
            FinishType: parseInt($("#cboFinishTypeFabric").val()),
            IssueDate: $('#txtDateFabric').datebox('getValue'),
            BuyerID:_oFabric.BuyerID,
            MKTPersonID: _oFabric.MKTPersonID,
            StyleNo: $.trim($("#txtStyleNoFabric").val()),
            ColorInfo: $.trim($("#txtColorFabric").val()),
            IsWash: $("#chkWashFabric").is(':checked'),
            IsFinish: $("#chkFinishFabric").is(':checked'),
            IsDyeing: $("#chkDyeingFabric").is(':checked'),
            IsPrint: $("#chkPrintFabric").is(':checked'),
            Remarks: $.trim($("#txtNoteFabric").val()),
            PriorityLevelInInt: parseInt($("#cboPriorityLevelFabric").val()),
            SeekingSubmissionDate: $('#txtBulkDate').datebox('getValue'),
            ProcessType: parseInt($("#cboProcessTypeFabric").val()),
            FabricWeave: parseInt($("#cboWeaveFabric").val()),
            FabricDesignID: parseFloat($("#cboFabricDesign").val()),
            FabricSeekingDates: [],
            PrimaryLightSourceID: $('#cboPrimaryLightSource').val(),
            SecondaryLightSourceID: $('#cboSecondaryLightSource').val(),
            EndUse: $.trim($('#txtEndUse').val()),
            NoOfFrame: $('#txtNoOfFrame').val(),
            WeftColor: $('#txtWeftColor').val(),
            WarpCount: $('#txtWarpCount').val(),
            WeftCount: $('#txtWeftCount').val(),
            EPI: $('#txtEPI').val(),
            PPI: $('#txtPPI').val()
        };
        return oFabric;
    }
    $("#btnSave_submit").click(function () {

        debugger;
        //if (!ValidateInputFabric()) return;
        var oLabDip= $('#tblLabDips').datagrid('getSelected');

        if(oLabDip==null || oLabDip.FabricID<=0){
            alert("Please select an item from list.");
            return false;
        }


        //var oFabric= $('#tblFabrics').datagrid('getSelected');
        //_oFabric=oFabric;

        if(_oFabric==null || _oFabric.FabricID<=0){
            alert("Please select an item from list.");
            return false;
        }
        if(_oFabric.ApprovedBy==0){
            alert("Yet Not Approve.");
            return false;
        }
        //if(oFabric.HandLoomNo==null || oFabric.HandLoomNo==''){
        //    alert("Yet Not Received.");
        //    return false;
        //}
        var nSelectedRowIndex=$('#tblLabDips').datagrid('getRowIndex',oLabDip);
        var oFabric = RefreshObjectFabric();

        oFabric.IssueDate = icsdateformat(new Date());
        oFabric.SeekingSubmissionDate = icsdateformat(new Date());
        oFabric.SubmissionDate = icsdateformat(new Date());
        oFabric.ReceiveDate = icsdateformat(new Date());
        debugger;
        $.ajax({
            type: "POST",
            dataType: "json",
            url: _sBaseAddress + "/Fabric/SaveSubmission",
            traditional: true,
            data: JSON.stringify(oFabric),
            contentType: "application/json; charset=utf-8",
            success: function (data) {
                var oFabric = jQuery.parseJSON(data);
                if (oFabric.ErrorMessage == "") {
                    if (oFabric.FabricID > 0) {
                        alert("Re Febric Submit Successful.");
                        $("#winFabric").icsWindow("close");

                        $('#tblLabDips').datagrid('updateRow', { index: nSelectedRowIndex, row: tblLabDips });
                        $("#tblLabDips").datagrid("selectRow", nSelectedRowIndex);
                    }
                }
                else {
                    alert(oFabric.ErrorMessage);
                }
            },
            error: function (xhr, status, error) {
                alert(error);
            }
        });
    });
    /*---------end edit Fabric---------*/

    $("#btnSubmitFabricInFabricPattern").click(function () {
        var data = $("#tblLabDips").datagrid("getSelected");
        if (data == null || data.FabricID <= 0) { alert("Please select an item from list!"); return; }
        if (data.SubmissionDateSt != "-") {
            alert("Already Submited.");
            return false;
        }
        if (data.FabricReceiveBy == 0) {
            alert("Sorry, Only Received fabric can Submit.");
            return false;
        }

        $("#winFabric").icsWindow('open', "Fabric Request");
        $("#winFabric").data('FSCD', data);

        var obj =
         {
             BaseAddress: _sBaseAddress,
             Object: data,
             ControllerName: "Fabric",
             ActionName: "GetForSubmitDate",
             IsWinClose: false
         };

        $.icsDataGet(obj, function (response) {
            if (response.status && response.obj != null) {
                if (response.obj.FabricID > 0) {
                    RefreshFabricLayout("btnSubmitFabricInFabricPattern");
                    RefreshFabricControl(response.obj);
                }
                else {
                    alert(response.obj.ErrorMessage);
                }
            }
            else { alert("No information found."); }
        });
    });
    $("#btnSubmitFabricInFabric").click(function () {
        if (!ValidateInputFabric()) return;

        var dIssueDate = $('#txtDateFabric').datebox('getValue');
        var dSubDate = $('#txtSubDateFabric').datebox('getValue');

        if (new Date(dSubDate) < new Date(dIssueDate)) {
            alert("Submission Date must greater than Issue Date.");
            return false;
        }

        var obj = {
            FabricID: RefreshObjectFabric().FabricID,
            SubmissionDate: $('#txtSubDateFabric').datebox('getValue')
        };



        $.ajax({
            type: "POST",
            url: _sBaseAddress + "/Fabric/SaveSubmissionDate",
            traditional: true,
            data: JSON.stringify(obj),
            contentType: "application/json; charset=utf-8",
            success: function (data) {
                debugger;
                var oFabric = jQuery.parseJSON(data);
                if(oFabric.FabricID>0)
                {
                    var oFSCD =  $("#winFabric").data('FSCD');
                    var nRowIndexBank = $("#tblLabDips").datagrid("getRowIndex", oFSCD);
                    var oRows=$("#tblLabDips").datagrid('getRows');

                    oRows[nRowIndexBank].SubmissionDate = oFabric.SubmissionDate;
                    oRows[nRowIndexBank].SubmissionDateSt = oFabric.SubmissionDateSt;

                    $('#tblLabDips').data('FDPs',oRows)
                    DynamicRefreshList(oRows,'tblLabDips');
                    alert("Submission Successfully.");

                    $("#tblLabDips").datagrid("selectRow", nRowIndexBank);
                }
                else{
                    alert(oFabric.ErrorMessage);
                }
                $('#winFabric').icsWindow('close');
            }
        });
    });
    //Sales Contract Specification


    //Fabric History
    $('#btnFabricHistory,#btnShowHistory').click(function(e){

        var row = $('#tblLabDips').datagrid('getSelected');

        if(row==null || row.FSCDetailID<=0){
            alert("Select an item from list");
            return false;
        }

        $.ajax({
            type: "POST",
            url: _sBaseAddress + "/Fabric/GetsFabricHistory",
            traditional: true,
            data: JSON.stringify({FabricID:row.FabricID}),
            contentType: "application/json; charset=utf-8",
            success: function (data) {
                debugger;
                var results = jQuery.parseJSON(data);
                if(results!=null  && results.any())
                {
                    $("#winFabricHistory").icsWindow("open");
                    DynamicRefreshList(results,'tblFabricHistory');
                }
                else{
                    alert("No history found.");
                }
            }
        });



    });
    $('#btnCloseFabricHistory').click(function(e){
        $('#winFabricHistory').icsWindow('close');
    });

    /// LabdipOperation
    $("#btnRequestForLabdip").click(function () {
        debugger;
        var oFSC = $('#tblLabDips').datagrid('getSelected');
        var nSelectedIndex= $('#tblLabDips').datagrid('getRowIndex',oFSC);
        $('#tblLabDips').data('Index', nSelectedIndex);
        if (oFSC ==null || oFSC.FSCDetailID<=0) { alert("Please select an item from list."); return ; }
        $('#txtDispoNo').val(oFSC.ExeNo);
        $('#txtSCNo_Lab').val(oFSC.SCNoFull);
        $('#txtFabricNo_Lab').val(oFSC.FabricNo);
        $('#txtComposition').val(oFSC.ProductName);
        $('#txtConstruction').val(oFSC.Construction);
        $('#txtFabrictype').val(oFSC.FinishTypeName);

        $.ajax({
            type: "POST",
            url: _sBaseAddress + "/FabricSCReport/GetLDByFabric",
            traditional: true,
            data: JSON.stringify(oFSC),
            contentType: "application/json; charset=utf-8",
            success: function (data) {
                debugger;
                var oLabDip = jQuery.parseJSON(data);
                if(oLabDip!=null )
                {
                    LoadLabdip(oLabDip);
                    $('#winLabDip').data('LabDip', oLabDip);

                }
                $("#winLabDip").icsWindow("open", "Labdip Request");

            }
        });

    });
    $("#btnSaveLabDip").click(function (e) {

        var oFSCD = $('#tblLabDips').datagrid('getSelected');
        var nSelectedIndex= $('#tblLabDips').datagrid('getRowIndex',oFSCD);
        $('#tblLabDips').data('Index', nSelectedIndex);
        if (oFSCD ==null || oFSCD.FSCDetailID<=0) { alert("Please select an item from list."); return ; }
        var obj =
            {
                BaseAddress: _sBaseAddress,
                Object: oFSCD,
                ObjectId: oFSCD.FSCDetailID,
                ControllerName: "LabDip",
                ActionName: "SaveByFabric",
                TableId: "",
                IsWinClose: false,
                Message:''
            };
        $.icsSave(obj, function (response) {
            if (response.status) {
                debugger;
                if(response.obj.LabDipID>0){
                    LoadLabdip(response.obj);
                    alert("LabDip Request done successfully.");
                }
                //OperationPerformsExportLC(nRowIndex, response.obj);
            }
        });
    });
    $("#btnSaveLabRecd").click(function () {
        ChangeOrderState(7,"Receive From Lab");
    });

    $("#btnSaveLabdipSubmit").click(function () {
        ChangeOrderState(8,"Submit To HO ");
    });

    function ChangeOrderState(sStatus,sMessage)
    {
        var oLabDip = $('#winLabDip').data('LabDip');
        if (oLabDip ==null || oLabDip.LabDipID <=0 ) { alert("Please select an item from list."); return ; }

        if(!confirm("Confirm to "+sMessage)) return false;
        oLabDip.Params=sStatus;

        var obj = {
            BaseAddress: _sBaseAddress,
            Object: oLabDip,
            ObjectId: oLabDip.LabDipID,
            ControllerName: "LabDip",
            ActionName: "ChangeStatusFromFabric",
            TableId: "",
            IsWinClose: false,
            Message: sMessage.charAt(0).toUpperCase()+sMessage.slice(1) +" Successfully."
        };
        $.icsSave(obj, function (response) {
            if (response.status && response.obj != null) {
                if (response.obj.LabDipID > 0) {
                    LoadLabdip(response.obj);
                }
            }
        });
    }
    function LoadLabdip(oLabdip)
    {
        debugger;

        $('#trLabdipReceive,#trLabdipSubmit').hide();
        if(oLabdip.OrderStatus>1)
        {
            $('#trLabdipRequest').hide();
        }
        if(oLabdip.OrderStatus>=5&&oLabdip.OrderStatus<7)
        {
            $('#trLabdipReceive').show();
        }
        if(oLabdip.OrderStatus>=7&&oLabdip.OrderStatus<=8)
        {
            $('#trLabdipSubmit').show();

        }
        $('#txtLabDipOrderNo').val(oLabdip.LabdipNo);
        $('#txtLabdipStatus').val(oLabdip.OrderStatusStr);
        DynamicRefreshList(oLabdip.LabdipHistorys,'tblLabdipHistory');
    }

    $("#btnCloseLabDip").click(function () {
        $("#winLabDip").icsWindow("close");
    });
    ///End Labdip Operation

    ///// MARGE COLUMN
        
    function onLoadSuccess(data)
    {
        debugger;
        var nIndex=0;
        var nSpan=0;
        for(var i=0;i<_oCellRowSpans.length;i++){
            var oMCell=[_oCellRowSpans[i].mergerCell];
            nIndex=oMCell[0][0];
            nSpan= oMCell[0][1];
            if(_oCellRowSpans[i].FieldName=="TwistedGroup"){
                $(this).datagrid('mergeCells',{index: nIndex, field: 'TwistedGroup', rowspan: nSpan});
            }
        }
    }
    function PickTwistedParent(oLabDipDetails)
    {
        var oRows= $('#tblLabDipDetailFabric').datagrid('getRows'); console.log(oLabDipDetails);
        var oLDDs=[];

        for(var i=0;i<oRows.length;i++)
        {
            console.log(oLabDipDetails.indexOf(oRows[i]));
            if(oRows[i].ParentID==0 && oLabDipDetails.indexOf(oRows[i])==-1)
            {
                oLDDs.push(oRows[i]);
            }
        }
        MakeTwistedGroup(0);
    }
    $('#btnMakeTwisted').click(function(e){
        var oLabDipDetails= $('#tblLabDipDetailFabric').datagrid('getChecked');

        if(oLabDipDetails.length<=0){
            alert("No items found to be twisted."); return false;
        }
        PickTwistedParent(oLabDipDetails);
    });
    function MakeTwistedGroup(nParent)
    {
        var oLabDipDetails= $('#tblLabDipDetailFabric').datagrid('getChecked');

        if(oLabDipDetails.length<=0){
            alert("No items found to be twisted."); return false;
        }

        var sLabDipDetailIDs="";
        for(var i=0; i<oLabDipDetails.length; i++){
            sLabDipDetailIDs = sLabDipDetailIDs + oLabDipDetails[i].LDFID +",";
        }
        sLabDipDetailIDs=sLabDipDetailIDs.substring(0,sLabDipDetailIDs.length-1);

        var oLabDipDetail={
            LabDipID: oLabDipDetails[0].LabDipID,
            FSCDetailID: oLabDipDetails[0].FSCDetailID,
            TwistedGroup: 0,
            Params: sLabDipDetailIDs,
            ParentID: nParent
        }
        debugger;
        var obj = {
            BaseAddress: _sBaseAddress,
            Object: oLabDipDetail,
            ObjectId: oLabDipDetail.LabDipDetailID,
            ControllerName: "LabDip",
            ActionName: "MakeTwistedGroup_Fabric",
            TableId: "",
            IsWinClose: false,
            Message: ""// (oLabDipDetail.LabDipDetailID>0)?"Update Successfully." : "Save Successfully."
        };
        $.icsSave(obj, function (response) {
            if (response.status && response.obj != null) {
                debugger;
                if (response.obj.LabDipDetailFabrics.length > 0 && response.obj.LabDipDetailFabrics[0].LDFID>0) {
                    //_oLabDip.ISTwisted=$('#chkIsTwisted').is(':checked');
                    _oCellRowSpans=response.obj.LabDipDetailFabrics[0].CellRowSpans;
                    DynamicRefreshList(response.obj.LabDipDetailFabrics, 'tblLabDipDetailFabric');

                }
                else if(response.obj.LabDipDetailFabrics.length > 0 && response.obj.LabDipDetailFabrics[0].LDFID<=0){
                    alert(response.obj.LabDipDetailFabrics[0].ErrorMessage);
                }
                else{
                    alert(response.obj.ErrorMessage);
                }
            }
        });
    }

    $('#btnRemoveTwisted').click(function(e){
        var oLabDipDetails= $('#tblLabDipDetailFabric').datagrid('getChecked');

        if(oLabDipDetails.length<=0){
            alert("No items found to be twisted."); return false;
        }
        var sLabDipDetailIDs="";
        for(var i=0; i<oLabDipDetails.length; i++){
            sLabDipDetailIDs = sLabDipDetailIDs + oLabDipDetails[i].LDFID +",";
        }
        sLabDipDetailIDs=sLabDipDetailIDs.substring(0,sLabDipDetailIDs.length-1);

        var oLabDipDetail={
            LabDipID: oLabDipDetails[0].LabDipID,
            FSCDetailID: oLabDipDetails[0].FSCDetailID,
            TwistedGroup: 0,
            Params: sLabDipDetailIDs
        }

        var obj = {
            BaseAddress: _sBaseAddress,
            Object: oLabDipDetail,
            ObjectId: oLabDipDetail.LabDipDetailID,
            ControllerName: "LabDip",
            ActionName: "RemoveTwistedGroup_Fabric",
            TableId: "",
            IsWinClose: false,
            Message: ""// (oLabDipDetail.LabDipDetailID>0)?"Update Successfully." : "Save Successfully."
        };
        $.icsSave(obj, function (response) {
            if (response.status && response.obj != null) {
                debugger;
                if (response.obj.LabDipDetailFabrics.length > 0 && response.obj.LabDipDetailFabrics[0].LDFID>0) {
                    _oCellRowSpans=response.obj.LabDipDetailFabrics[0].CellRowSpans;
                    DynamicRefreshList(response.obj.LabDipDetailFabrics, 'tblLabDipDetailFabric');
                }
                else{
                    alert(response.obj.LabDipDetailFabrics[0].ErrorMessage);
                }
            }
        });
    });
    function formatTwisted(value){

        if(value>0){
            return "Twisted";
        }
        else{
            return "";
        }
    }
    ///

    $("#btnDyeingOrder").click(function(){
        debugger;
        var oFSC = $('#tblLabDips').datagrid('getSelected');
        var nSelectedIndex= $('#tblLabDips').datagrid('getRowIndex',oFSC);
        $('#tblLabDips').data('Index', nSelectedIndex);
        if (oFSC ==null || oFSC.FSCID<=0) { alert("Please select an item from list."); return ; }

        var SelectedRowIndex=$('#tblLabDips').datagrid('getRowIndex',oFSC);
        var oLabDips= $('#tblLabDips').datagrid('getRows');
        sessionStorage.setItem("LabDips_InLab", JSON.stringify(oLabDips));
        sessionStorage.setItem("SelectedRowIndex", SelectedRowIndex);
        sessionStorage.setItem("ExportSCHeader", "View ExportSC");

        sessionStorage.setItem("BackLink", window.location.href);
        var nts=((new Date()).getTime())/1000;
        window.location.href = _sBaseAddress+ "/DyeingOrder/ViewFNSaleOrder?nId=0&nFSCDID="+oFSC.FSCDetailID+"&IsInHouse=true&buid="+_nBUID+"&ts="+nts;
        //window.location.href = _sBaseAddress+  "/DyeingOrder/ViewFNSaleOrder?nId=0&nFSCDID="+oFSC.FSCID+"&buid="+_nBUID+"&ts="+nts;
    });
    $('#btnPrintPO').click(function (e)
    {
        var oFabricSalesContract = $("#tblLabDips").datagrid("getSelected");
        if (oFabricSalesContract == null || oFabricSalesContract.FSCID <= 0) {
            alert("Invalid Field!!! please select a valid Field!");
            return false;
        }
        var tsv=((new Date()).getTime())/1000;
     // window.open(_sBaseAddress+ "/FabricSalesContract/PrintPreview?nID="+oFabricSalesContract.FSCID+"&bIsRnd=true&nts="+tsv, "_blank");
        window.open(_sBaseAddress+ "/FabricSalesContract/PrintPreview?nID="+oFabricSalesContract.FSCID+"&bIsRnd=true&nts="+tsv+"&bPrintFormat=true&nTitleTypeInImg=1", "_blank");

    });
</script>


