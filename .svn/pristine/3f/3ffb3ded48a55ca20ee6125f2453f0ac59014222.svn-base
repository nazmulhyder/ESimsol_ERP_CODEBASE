@model IEnumerable<ESimSol.BusinessObjects.DUDeliveryLot>
    @{
        ViewBag.Title = "Daily Fresh Dyed Yarn Receive Report(For Production)";
    }
   
 <div id="progressbarParent" style="width:100%;height:100%;margin:0 auto;text-align:center; margin-left: auto;margin-right: auto;left: 0;right: 0;z-index: 1;">
    <div style="margin: 0px auto;margin-top: 251px;text-align:center;width:390px;">
        <label style="font-size:18px;">Please wait</label>
        <div id="progressbar" style="width:100%;height:37px;"></div>
    </div>
 </div>
 
 <div class="menuMainCollectionTable">
      <table border="0" cellpadding="2" cellspacing="2" style="width:100%;">
          @*<tr>
              <td style="width:25%;  font-size:12px; text-align:left;vertical-align:top">
                  Store<select id="cboWorkingUnit" style="width:70%;"></select>
              </td>
              <td style="width:25%;  font-size:12px; text-align:left">
                  Order Type <select id="cboOrderType" style="width:50%" />
              </td>
              <td style="width:50%;  font-size:12px; text-align:left"></td>
          </tr>*@

      </table>
      <div id="tabLot" class="easyui-tabs" style="width:100%; height:98%">
            <div title="Lot View" id="divLotView" style="width:100%;height:95%">
                <div style="width:100%;height:100%">
                    <table id="tblLotView" style="width:100%; height:100%" class="easyui-datagrid" fit="true" fitcolumns="false" rownumbers="true" pagination="false" singleselect="true" autorowheight="false" toolbar="#toolbarRSWise" data-options="rowStyler: function(index,row){
                if (row.Product=='Total'){
                return 'color:#016B18; font-weight:bold;';
            }
        }
">
                        <thead>
                            <tr>
                                <th field="LotNo" width="8%">Batch No</th>
                                <th field="OrderNoFull" width="12%">Order No</th>
                                <th field="Contractor" width="20%">Buyer Name</th>
                                <th field="Product" width="15%">Yarn</th>
                                <th field="ColorName" width="10%">Color</th>
                                <th field="Qty_Order" width="8%" align="right" formatter="formatPrice">Order Qty</th>
                                <th field="Balance" width="8%" align="right" formatter="formatPrice">Stock in Hand</th>
                                <th field="Qty_DC" width="8%" align="right" formatter="formatPrice">Delivered Qty</th>
                                <th field="BagNo" width="5%">Bag No</th>
                                <th field="LocationName" width="10%">LocationName</th>
                                <th field="PINo" width="12%">P/I No</th>
                                <th field="LCNo" width="12%">L/C No</th>
                                <th field="OrderTypeSt" width="12%">OrderType</th>
                            </tr>
                        </thead>
                    </table>
                    <div id="toolbarRSWise">
                        <a id="btnAdvanceSearch_Lot" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-search" plain="true">Adv. Search</a>

                        <a id="btnLotLocation" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-add" plain="true">Lot Location</a>
                        @*<a href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-reload" plain="true" id="btnSearch_Lot">Refresh</a>*@
                        <a id="btnPrintXL1" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-print"  plain="true">ExportXL</a>
                    </div>
                </div>
            </div>
            <div title="Product View" id="divProductView" style="width:100%;height:95%">
                <table id="tblProductView" style="width:100%; height:100%" class="easyui-datagrid" fit="true" fitcolumns="false" rownumbers="true" pagination="false" singleselect="true" autorowheight="false" toolbar="#toolbarProduct" data-options="rowStyler: function(index,row){
            if (row.Product=='Total'){
                return 'color:#016B18; font-weight:bold;';
            }
        }
">
                    <thead>
                        <tr>
                            <th field="Product" width="30%">Yarn</th>
                            <th field="Balance" width="10%" align="right" formatter="formatPrice"> Balance Qty(LBS)</th>
                            <th field="Qty_DC" width="10%" align="right" formatter="formatPrice">Delivered Qty</th>
                                                      
                        </tr>
                    </thead>
                </table>

                <div id="toolbarProduct">
                    <a id="btnAdvanceSearch_Pro" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-search" plain="true">Adv. Search</a>
                    @*<a href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-reload" plain="true" id="btnSearch_Pro">Refresh</a>*@
                    <a id="btnPrint" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-print" plain="true">Print</a>
                    <a id="btnPrintXL2" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-print" plain="true">Export XL</a>
                </div>
            </div>
            <div title="Buyer View" id="divBuyerView" style="width:100%;height:95%">
                <table id="tblBuyerView" style="width:100%; height:100%" class="easyui-datagrid" fit="true" fitcolumns="false" rownumbers="true" pagination="false" singleselect="true" autorowheight="false" toolbar="#toolbarBuyer" data-options="rowStyler: function(index,row){
            if (row.Contractor=='Total'){
                return 'color:#016B18; font-weight:bold;';
            }
        }
">
                    <thead>
                        <tr>
                            <th field="Contractor" width="30%">Buyer Name</th>
                            <th field="Balance" width="10%" align="right" formatter="formatPrice"> Balance Qty(LBS)</th>
                            <th field="Qty_DC" width="10%" align="right" formatter="formatPrice">Delivered Qty</th>

                        </tr>
                    </thead>
                </table>

                <div id="toolbarBuyer">
                    <a id="btnAdvanceSearch_Buyer" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-search" plain="true">Adv. Search</a>
                    @*<a href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-reload" plain="true" id="btnSearch_Buyer">Refresh</a>*@
                    @*<a id="btnView" href="javascript:void(0)" class="easyui-linkbutton initial-state" iconcls="icon-details" plain="true">View</a>*@

                    @*<a id="btnPrint" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-print" plain="true">Print</a>*@
                    <a id="btnPrintXL3" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-print" plain="true">Export XL</a>
                </div>
            </div>
        </div>
 </div>

 <div id="winAdvSearchOrderTracker" style="width:510px" class="easyui-window winClass" title="Adv. Search" data-options="modal:true,closed:true,collapsible:false,minimizable:false,maximizable:false,closable:false">
    <table style="width:100%">
        <tr>
            <td>
                <fieldset>
                    <legend>Searching Criteria</legend>
                    <table style="width:100%">
                        <tr>
                            <td style="width:20%;text-align:right;">
                                <label>Lot issue Date </label>
                            </td>
                            <td colspan="3" style=" width:75%;text-align:left;">
                                <select id="cboDODate" style="width:30%;" onchange="DateActions_DO();"></select>
                                <input id="txtFromDODate" type="text" style="width: 100px;" class="easyui-datebox" required="required" data-options="formatter:icsdateformat,parser:icsdateparser" />To
                                <input id="txtToDODate" type="text" style="width: 100px;" class="easyui-datebox" required="required" data-options="formatter:icsdateformat,parser:icsdateparser" />
                            </td>
                        </tr>

                        <tr>
                            <td style=" width:25%;text-align:right;">
                                <label>Buyer Name :</label>
                            </td>
                            <td colspan="3" style=" width:75%;text-align:left;">
                                <input id="txtContractorAdvS" style="width:75%;" type="text" placeholder="Type & Press Enter" />
                                <a id="btnPickContractorAdvS" href="javascript:void(0)" class="easyui-linkbutton ics-pick" iconcls="icon-pick" plain="true"></a>
                                <a id="btnClrContractorAdvS" href="javascript:void(0)" class="easyui-linkbutton ics-pick" iconcls="icon-clear" plain="true"></a>
                            </td>
                        </tr>
                        <tr>
                            <td style=" width:25%;text-align:right;">
                                <label>Product Name :</label>
                            </td>
                            <td colspan="3" style=" width:75%;text-align:left;">
                                <input id="txtProductName" style="width:75%;" type="text" placeholder="Type & Press Enter" />
                                <a id="btnProductPiker" href="javascript:void(0)" class="easyui-linkbutton ics-pick" iconcls="icon-pick" plain="true"></a>
                                <a id="btnClrProductPiker" href="javascript:void(0)" class="easyui-linkbutton ics-pick" iconcls="icon-clear" plain="true"></a>
                            </td>
                        </tr>
                        <tr>
                            <td style=" width:25%;text-align:right;">
                                <label>Order Type: </label>
                            </td>
                            <td style=" width:25%;text-align:left;">
                                <select id="cboOrderTypeSearch" style="width: 100%;"></select>
                            </td>
                            <td style=" width:25%;text-align:right;">
                                <label>Store: </label>
                            </td>
                            <td style=" width:25%;text-align:left;">
                                <select id="cboWorkingUnit" style="width:100%;"></select>
                            </td>
                        </tr>
                        <tr>
                            <td style=" width:25%;text-align:right;">
                                <label>Order No: </label>
                            </td>
                            <td style=" width:25%;text-align:left;">
                                <input id="txtOrderNo" type="text" style="width:100%" />
                            </td>
                            <td style=" width:25%;text-align:right;">
                                <label>Lot No: </label>
                            </td>
                            <td style=" width:25%;text-align:left;">
                                <input id="txtLotNo" type="text" style="width:100%" />
                            </td>

                        </tr>


                    </table>
                </fieldset>

            </td>
        </tr>
    </table>

    <fieldset>
        <legend>Actions : </legend>
        <table border="0" cellspacing="2" cellpadding="2" style="width:100%;font-size:11px; font-weight:bold;">
            <tr>
                <td style="width:60%;text-align:left">
                    <a id="btnAdvSearchReset" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-reload" plain="true"> Reset</a>
                    <label class="lblLoadingMessage" style="float: left;">Loading Please Wait...</label>
                </td>
                <td style="width:40%; text-align: right">
                    <a id="btnSearch" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-search" plain="true">Search</a>
                    <a id="btnAdvSearchClose" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-cancel" plain="true">Close</a>
                </td>
            </tr>
        </table>
    </fieldset>
</div>
  
 <div id="winReportDetail" class=" easyui-window winclass" title="Production Order List" data-options="modal:true,closed:true,collapsible:false,minimizable:false,maximizable:false,closable:false">
    <table style="width: 99%;" cellspacing="2" cellpadding="2">
        <tr>
            <td style="width:5%; text-align:right"></td>
            <td style="width:10%; text-align:right">
                <label>
                    Yarn
                </label>
            </td>
            <td colspan="3" style="width:80%; text-align:left">
                <input type="text" id="txtProductNamePTU" style="width:100%;" readonly="readonly" />
            </td>
            <td style="width:5%; text-align:right">
                                      
            </td>

        </tr>
        <tr>
            <td style="width:5%; text-align:right"></td>
            <td style="width:10%; text-align:right">
                <label>
                    Stock Qty
                </label><span class="lblMUnit"></span>
            </td>
            <td style="width:15%; text-align:left">
                <input type="text" id="txtStockQty" style="width:100%;" readonly="readonly" />
            </td>

            <td style="width:25%; text-align:right">
                <label>
                    Production Booking
                </label><span class="lblMUnit"></span>
            </td>
            <td style="width:15%; text-align:left">
                <input type="text" id="txtProBookingQty" style="width:100%;" readonly="readonly" />
            </td>
            <td style="width:10%; text-align:right">
                <label>
                    Usable Qty
                </label><span class="lblMUnit"></span>
            </td>
            <td style="width:15%; text-align:left">
                <input type="text" id="txtBalance" style="width:100%;" readonly="readonly" />
            </td>
            <td style="width:5%; text-align:right"></td>
        </tr>
    </table>
    <div id="tabReportDetail" class="easyui-tabs" style="width:100%">
        <div title="Stock Order" style="padding:2px">
            <div style="width:100%">
                <fieldset>
                    <table style="width:100%;height:300px;" id="tblLots" class="easyui-datagrid" toolbar="#toolbarLot">
                        <thead>
                            <tr>
                                <th field="LotNo" width="20%">Lot No</th>
                                <th field="StockQty" width="10%" align="right" formatter="formatPrice">Stock Qty</th>
                                <th field="RSQty" width="12%" align="right" formatter="formatPrice">Issue Qty</th>
                                <th field="WUnit" width="20%">Store</th>
                                <th field="RSCount" width="5%" align="right">Dye line Count</th>
                                <th field="MUName" width="10%">Unit</th>
                                <th field="StockQty" width="10%" align="right" formatter="formatPrice">Stock Qty</th>
                                <th field="RSQty" width="12%" align="right" formatter="formatPrice">Issue Qty</th>
                                <th field="Qty_Booking" width="10%" align="right" formatter="formatPrice">Booking Qty</th>
                                <th field="Balance" width="10%" align="right">Usable Qty</th>
                                                    
                            </tr>
                        </thead>
                    </table>
                </fieldset>
                <div id="toolbarLot">
                    <table>
                        <tr>
                            <td>
                                <a id="btnLoad_Lot" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-reload" plain="true"></a>
                            </td>

                        </tr>
                    </table>
                </div>

            </div>
        </div>
        <div title="Dyeing Card " style="padding:2px">
            <div style="width:100%">
                <fieldset>
                    <table style="width:100%;height:300px;" id="tblRSs" class="easyui-datagrid" toolbar="#toolbarRS">
                        <thead>
                            <tr>
                                <th field="RouteSheetNo" width="20%">Dye Line No</th>
                                <th field="Qty" formatter="formatPrice" width="10%" align="right">Balance</th>
                                <th field="LotNo" width="10%">Lot No</th>
                                <th field="RSStateStr" width="10%">Status</th>
                            </tr>
                        </thead>
                    </table>
                </fieldset>
                <div id="toolbarRS">
                    <table>
                        <tr>
                            <td>
                                <a id="btnLoad_RS" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-reload" plain="true"></a>
                            </td>

                        </tr>
                    </table>
                </div>

            </div>
        </div>
    </div>
    <div style="width:100%;">
        <fieldset>
            <legend style="font-weight: bold">Action : </legend>
            <table border="0" cellspacing="2" cellpadding="2" style="font-size: 11px; font-weight: bold; width:100%">
                <tr>
                    <td style="width:85%; text-align:right"></td>
                    <td style="width: 15%; text-align:right">
                        <a id="btnClose_Detail" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-cancel" plain="true">Close</a>
                    </td>
                </tr>
            </table>
        </fieldset>
    </div>
</div>

<div id="winLotLocation" style="width:580px" class="easyui-window winclass" title="Lot Location Entry" data-options="modal:true,closed:true,collapsible:false,minimizable:false,maximizable:false,closable:false">

    <div style="width:100%">
        <fieldset>
            <div class="col-md-12">
                <div class="col-md-3">
                    <label class="text-right">Lot No:</label>
                </div>
                <div class="col-md-8">
                    <input id="txtLotNo_LotLocation" type="text" class="form-control" disabled />
                </div>
            </div>
            <div class="col-md-12">
                <div class="col-md-3">
                    <label class="text-right">Location Name:</label>
                </div>
                <div class="col-md-8">
                    <input id="txtLocationName_LotLocation" type="text" class="form-control" />
                </div>
            </div>
            @*<div class="col-md-12">
<div class="col-md-3">
    <label class="text-right">Note:</label>
</div>
<div class="col-md-6">
    <input id="txtRemarks_LotLocation" type="text" class="form-control" />
</div>
</div>*@
        </fieldset>
    </div>

    <div style="width:100%;">
        <fieldset>
            <legend style="font-weight: bold">Action : </legend>
            <table border="0" cellspacing="2" cellpadding="2" style="font-size: 11px; font-weight: bold; width:100%">
                <tr>
                    <td style="width:65%; text-align:right"></td>
                    <td style="width: 35%; text-align:right">
                        <a id="btnSave_LotLocation" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-ok" plain="true">Save</a>
                        <a id="btnClose_LotLocation" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-cancel" plain="true">Close</a>
                    </td>
                </tr>
            </table>
        </fieldset>
    </div>
</div>

 <style type="text/css">
    .lines-no .datagrid-body td {
        border-right: 1px dotted transparent;
        border-bottom: 1px dotted transparent;
    }
  .form-control {
        height: 22px;
        padding: 2px 4px;
        font-size: 12px;
    }
</style>

 <script type="text/javascript">
    var _sBaseAddress="";
    var _oDUDeliveryLot=null;
    var _oDUDeliveryLots=[];
    var _oCompanys=[];
    var _oCompareOperators=[];
    var _nBUID = 0;
    var _oBU = null;
    var _sMessage="";
    var _nReportType=0;
    var _oOrderTypes = [];
    var _sProductIDs = "";
    var _sContractorIds = "";
    var _sPID = "";
    $(document).ready(function () 
    {
        _sBaseAddress =@Html.Raw( new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(HttpContext.Current.Session[SessionInfo.BaseAddress]));
        _oDUDeliveryLots =@Html.Raw( new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(Model));
        _oCompareOperators = @Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(ViewBag.CompareOperators));
        var OrderTypes = @Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(ViewBag.OrderTypes));
        _nBUID = @Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(ViewBag.BUID));

        debugger;
        $("#progressbar").progressbar({ value: 0 });
        $("#progressbarParent").hide();
        $(".lblLoadingMessage").hide();
        $('#txtFromDODate').datebox('setValue', icsdateformat(new Date()));
        $('#txtToDODate').datebox('setValue', icsdateformat(new Date()));


        $("#cboOrderType").icsLoadCombo({
            List: OrderTypes,
            OptionValue: "OrderType",
            DisplayText: "ShortName",
        });
        RefreshWU();
        _oOrderTypes = OrderTypes;
        RefreshSearchComboBoxControls();
    });

     function RefreshWU()
     {
         $('#cboWorkingUnit').empty();
         var listDates = "<option value='"+0+"'>" + "--Select Store--" + "</option>";
         listDates+= "<option value='"+8+"'>" + "Delivery Store" + "</option>";
         $("#cboWorkingUnit").html(listDates);
         $("#cboWorkingUnit").val(8);
     }

     $(document).keydown(function (e) { if (e.keyCode == 27) { $('div').icsWindow('close'); } });



    ////Start adv Searching

    function updateProgress() {
        var value =$('#progressbar').progressbar('getValue');
        if (value < 96){
            value += Math.floor(Math.random() * 10);
            $('#progressbar').progressbar('setValue', value);
        }
    }
    function hideShow(miliseconds) {
        $("#progressbarParent").hide();
    }

    function RefreshSearchComboBoxControls()
    {
        $("#cboDODate").icsLoadCombo({
            List: _oCompareOperators,
            OptionValue: "id",
            DisplayText: "Value"
        });

        $("#cboOrderTypeSearch").icsLoadCombo({
            List: _oOrderTypes,
            OptionValue: "OrderType",
            DisplayText: "ShortName"
        });
        $('#cboWorkingUnit').empty();
        var listDates = "<option value='"+0+"'>" + "--Select Store--" + "</option>";
        listDates+= "<option value='"+8+"'>" + "[Delivery Store]" + "</option>";
        $("#cboWorkingUnit").html(listDates);
        $("#cboWorkingUnit").val(8);

    }
    $('#btnAdvSearchReset').click(function(e){
        $("#winAdvSearchOrderTracker input").not("input[type='button']").val("");
        RefreshSearchComboBoxControls();
        _sContractorIds ="";
        _sProductIDs="";
        _sPID = "";
        $('#txtFromDODate').datebox({ disabled : true });
        $('#txtToDODate').datebox({ disabled : true });
        $('#txtFromDODate').datebox('setValue', icsdateformat(new Date()));
        $('#txtToDODate').datebox('setValue', icsdateformat(new Date()));

        //$('#txtFromPIDate').datebox({ disabled : true });
        //$('#txtToPIDate').datebox({ disabled : true });
        //$('#txtFromPIDate').datebox('setValue', icsdateformat(new Date()));
        //$('#txtToPIDate').datebox('setValue', icsdateformat(new Date()));

        $('#cboDODate').val(0);
        //$('#cboPIDate').val(0);
        $('#cboOrderType').val(0);

    });

    $("#btnSearch_Lot").click(function () {

        var ncboWorkingUnit = parseInt($("#cboWorkingUnit").val());
        var nOrderType = parseInt($("#cboOrderType").val());
        _nReportType =1;
        var sParams =
                     ncboWorkingUnit + "~" +
                     nOrderType + "~" +
                     _nReportType
        sessionStorage.setItem("ParamsInvPro", sParams);
        var oDUDeliveryLot = {
            ErrorMessage : sParams
        };
        Search(oDUDeliveryLot);
    });
    $("#btnSearch_Pro").click(function () {
        var ncboWorkingUnit = parseInt($("#cboWorkingUnit").val());
        var nOrderType = parseInt($("#cboOrderType").val());
        _nReportType =2;
        var sParams =
                     ncboWorkingUnit + "~" +
                     nOrderType + "~" +
                     _nReportType
        sessionStorage.setItem("ParamsInvPro", sParams);
        var oDUDeliveryLot = {
            ErrorMessage : sParams
        };
        Search(oDUDeliveryLot);
    });
    $("#btnAdvanceSearch_Lot").click(function () {
        $(".lblLoadingMessage").hide();
        $("#winAdvSearchOrderTracker").icsWindow("open", "Advance Search");
        _nReportType=1;
    });
    $("#btnAdvanceSearch_Pro").click(function () {
        $(".lblLoadingMessage").hide();
        $("#winAdvSearchOrderTracker").icsWindow("open", "Advance Search");
        _nReportType=2;
    });
    $("#btnAdvanceSearch_Buyer").click(function () {
        $(".lblLoadingMessage").hide();
        $("#winAdvSearchOrderTracker").icsWindow("open", "Advance Search");
        _nReportType=3;
    });
    //$("#btnAdvanceSearch_ProductView").click(function () {
    //    $(".lblLoadingMessage").hide();
    //    $("#winAdvSearchOrderTracker").icsWindow("open", "Advance Search");
    //    _nReportLevel=3;
     //});
    $('#btnAdvSearchClose').click(function(e){
        $("#winAdvSearchOrderTracker").icsWindow('close');
        _sPID = "";
    });

    $("#btnLotLocation").click(function () 
    {    
        var oRSA= $('#tblLotView').datagrid('getSelected');
        if(oRSA==null || oRSA.LotID<=0)
        {
            alert("Please select a item from list!");
            return;
        }
        var nIndex = $('#tblLotView').datagrid('getRowIndex',oRSA);
        $('#txtLotNo_LotLocation').data('Lot',oRSA);
        $('#txtLotNo_LotLocation').data('LotIndex',nIndex);

        $('#txtLotNo_LotLocation').val(oRSA.LotNo);
        $('#txtLocationName_LotLocation').val(oRSA.LocationName);
        //$('#txtRemarks_LotLocation').val(oRSA.LotNo);
        $("#winLotLocation").icsWindow("open", "Lot Location Entry");
    });
    $("#btnClose_LotLocation").click(function () {
        debugger;
        $("#winLotLocation").icsWindow('close');
    });

     
    $("#btnSave_LotLocation").click(function (){
        
        var txtLotLocationName = $('#txtLocationName_LotLocation').val();
        if(txtLotLocationName==null || txtLotLocationName==undefined)
        {
            alert("Please type a name and try again!!");
            return;
        }

        var oLot = $('#txtLotNo_LotLocation').data('Lot');
       
        var oLotLocation=
            {
                LotLocationID:oLot.LotLocationID,
                LotID: oLot.LotID,
                LotLocationName: txtLotLocationName
            }

        $.ajax({
            type: "POST",
            dataType: "json",
            url : sessionStorage.getItem('BaseAddress')+"/Lot/SaveLotLocation",
            traditional: true,
            data:  JSON.stringify(oLotLocation),
            contentType: "application/json; charset=utf-8",
            success: function (data) {
                var oLotLocation = jQuery.parseJSON(data);
                if (oLotLocation.ErrorMessage=="" || oLotLocation.ErrorMessage==null)
                {
                    alert("Data Save Succesfully!!");
                    var nIndex=  $('#txtLotNo_LotLocation').data('LotIndex');
                    
                    oLot.LocationName= txtLotLocationName;
                    oLot.LotLocationID = oLotLocation.LotLocationID;
                    $('#tblLotView').datagrid('updateRow',{index: nIndex,   row:oLot});
                    $("#winLotLocation").icsWindow('close');
                }
                else
                {
                    alert(oLotLocation.ErrorMessage);
                }
            },
            error: function (xhr, status, error)
            {
                alert(error);
            }
        });
    });


    //$('#btnAdvSearchReset').click(function(e){
    //    $("#winAdvSearchOrderTracker input").not("input[type='button']").val("");
    //    RefreshSearchComboBoxControls();
    //    _sContractorIds ="";
    //    _sProductIDs="";
    //    $('#txtFromDODate').datebox({ disabled : true });
    //    $('#txtToDODate').datebox({ disabled : true });
    //    $('#txtFromDODate').datebox('setValue', icsdateformat(new Date()));
    //    $('#txtToDODate').datebox('setValue', icsdateformat(new Date()));

    //    //$('#txtFromPIDate').datebox({ disabled : true });
    //    //$('#txtToPIDate').datebox({ disabled : true });
    //    //$('#txtFromPIDate').datebox('setValue', icsdateformat(new Date()));
    //    //$('#txtToPIDate').datebox('setValue', icsdateformat(new Date()));

    //    $('#cboDODate').val(0);
    //    //$('#cboPIDate').val(0);
    //    $('#cboOrderType').val(0);

    //});
    $("#btnSearch_Buyer").click(function () {
        var ncboWorkingUnit = parseInt($("#cboWorkingUnit").val());
        var nOrderType = parseInt($("#cboOrderType").val());
        _nReportType =3;
        var sParams =
                     ncboWorkingUnit + "~" +
                     nOrderType + "~" +
                     _nReportType
        sessionStorage.setItem("ParamsInvPro", sParams);
        var oDUDeliveryLot = {
            ErrorMessage : sParams
        };
        Search(oDUDeliveryLot);
    });
    function Search(oDUDeliveryLot)
    {

        $.ajax({
            type: "POST",
            dataType: "json",
            url: _sBaseAddress + "/DUDeliveryLot/AdvSearch",
            traditional: true,
            data: JSON.stringify(oDUDeliveryLot),
            contentType: "application/json; charset=utf-8",
            success: function (data) {
                var oDUDeliveryLots = data;
                debugger;
                if (oDUDeliveryLots != null)
                {
                    if (oDUDeliveryLots.length > 0)
                    {
                        if(_nReportType==1)
                        {
                            DynamicRefreshList(oDUDeliveryLots, "tblLotView");

                        }
                        else  if(_nReportType==2)
                        {
                            DynamicRefreshList(oDUDeliveryLots, "tblProductView");
                        }
                        else  if(_nReportType==3)
                        {
                            DynamicRefreshList(oDUDeliveryLots, "tblBuyerView");
                        }
                        RefreshSummary(_nReportType);
                    }
                    else
                    {
                        alert("Sorry, No data found.");
                        if(_nReportType==1)
                        {
                            DynamicRefreshList([], "tblLotView");
                        }
                        else  if(_nReportType==2)
                        {
                            DynamicRefreshList([], "tblProductView");
                        }
                        else  if(_nReportType==3)
                        {
                            DynamicRefreshList([], "tblBuyerView");
                        }

                    }
                }
                $(".lblLoadingMessage").hide();
            }
        });
    }



    $("#btnView_Detail").click(function () {
        debugger;
        var oIRP= $('#tblProductView').datagrid('getSelected');
        if(oIRP==null)
        {
            alert("Please select a item from list!");
            return ;
        }
        DynamicRefreshList([], 'tblLots');
        GetsLots(oIRP);
        RefreshControl(oIRP);
        $("#winReportDetail").icsWindow('open', "Color Information");
        $('#tabReportDetail').tabs({ onSelect: function () {TabClick();} });
    });


    function RefreshControl(oIRP)
    {
        $('#txtProductNamePTU').val(oIRP.ProductName);
        $('#txtStockQty').val(formatPrice(oIRP.StockQty,null));
        $('#txtProBookingQty').val(formatPrice(oIRP.RSQty,null));
        $('#txtBalance').val(oIRP.Balance);
    }
    $("#btnClose_Detail").click(function () {
        debugger;

        $("#winReportDetail").icsWindow('close');
    });
     //// Lots Gets
    $("#btnLoad_Lot").click(function () {
        debugger;
        var oIRP= $('#tblProductView').datagrid('getSelected');
        if(oIRP==null)
        {
            alert("Please select a item from list!");
            return ;
        }
        DynamicRefreshList([], 'tblLots');
        GetsLots(oIRP);
        RefreshControl(oIRP)
    });
    function GetsLots(oIRP)
    {
        var obj = {
            BaseAddress: _sBaseAddress,
            Object: oIRP,
            ControllerName: "DUDeliveryLot",
            ActionName: "GetsLots",
            IsWinClose: false
        };
        $.icsDataGets(obj, function (response) {
            debugger;
            if (response.status && response.objs.length > 0)
            {
                var oLotDetails= response.objs;
                DynamicRefreshList(oLotDetails, 'tblLots');
            }
        });
    }
          //RS Gets
    $("#btnLoad_RS").click(function () {
        LoadRS();
    });
    function CheckFromAndToDateValidation(OperationComboId, FromDateId, ToDateId) {
        $("#" + OperationComboId).parent().parent().parent().find("select").removeClass("errorFieldBorder");
        var nCboVal = $("#" + OperationComboId).val();
        if (parseInt(nCboVal) == 5 || parseInt(nCboVal) == 6) {
            var fromDate = $("#" + FromDateId).datebox("getValue");
            var toDate = $("#" + ToDateId).datebox("getValue");
            if (new Date(fromDate) > new Date(toDate)) {
                $("#" + ToDateId).focus();
                $("#" + OperationComboId).addClass("errorFieldBorder");
                $(".lblLoadingMessage").hide();
                return false;
            } else {
                $("#" + OperationComboId).removeClass("errorFieldBorder");
                return true;
            }
        } else {
            return true;
        }
    }
    $('#btnSearch').click(function(e){
        debugger;
        $(".lblLoadingMessage").show();
        var checkDate = CheckFromAndToDateValidation("cboDODate", "txtFromDODate", "txtToDODate");
        if (!checkDate) {
            alert("Start date must be greater than end date.");
            return false;
        }

        //var checkDate = CheckFromAndToDateValidation("cboPIDate", "txtFromPIDate", "txtToPIDate");
        //if (!checkDate) {
        //    alert("Start date must be greater than end date.");
        //    return false;
        //}

        var ncboDODate = parseInt($('#cboDODate').val());
        var dFromDODate   = $('#txtFromDODate').datebox('getValue');
        var dToDODate   = $('#txtToDODate').datebox('getValue');

        //var cboPIDate = 0;
        //var dFromPIDate   = $('#txtFromDODate').datebox('getValue');
        //var dToPIDate   = $('#txtToDODate').datebox('getValue');
        //var nOrderType=parseInt($("#cboOrderType").val());
        var nOrderType = parseInt($("#cboOrderTypeSearch").val());
        var nWorkingUnit = parseInt($("#cboWorkingUnit").val());




        var sLotNo=$("#txtLotNo").val();
        var sOrderNo=$("#txtOrderNo").val();

        var sParams =    ncboDODate + "~" +
                         dFromDODate + "~" +
                         dToDODate + "~" +
                         //cboPIDate + "~" +
                         //dFromPIDate + "~" +
                         //dToPIDate + "~" +
                         _sContractorIds + "~" +
                         _sPID + "~" +
                         nOrderType + "~" +
                         nWorkingUnit + "~" +
                         sLotNo+ "~" +
                         sOrderNo+ "~" +
                         _nBUID;

        var oExportLCReport = {
            ErrorMessage : sParams,
            BUID : parseInt(sessionStorage.getItem("BUID")),
            ReportType : _nReportType
        };
        sessionStorage.setItem("Params", sParams);
        $.ajax({
            type: "POST",
            dataType: "JSON",
            url: sessionStorage.getItem("BaseAddress")+"/DUDeliveryLot/AdvanchSearch",
            data:  JSON.stringify(oExportLCReport),
            contentType: "application/json; charset=utf-8",
            success: function (data) {
                debugger;
                var  oDUDeliveryLots = data;
                if (oDUDeliveryLots != null) {
                    if(oDUDeliveryLots.length>0)
                    {
                        if(_nReportType==1)
                        {
                            DynamicRefreshList(oDUDeliveryLots, "tblLotView");

                        }
                        else  if(_nReportType==2)
                        {
                            DynamicRefreshList(oDUDeliveryLots, "tblProductView");
                        }
                        else  if(_nReportType==3)
                        {
                            DynamicRefreshList(oDUDeliveryLots, "tblBuyerView");
                        }
                        RefreshSummary(_nReportType);
                        
                        $("#winAdvSearchOrderTracker").icsWindow('close');
                    }
                    else
                    {
                        alert("Data not found!!");
                    }
                }
                $(".lblLoadingMessage").hide();
            },
            error: function (xhr, status, error) {
                alert(error);
            }
        });
    });
    function LoadRS()
        {
        var oIRP= $('#tblProductView').datagrid('getSelected');
        if(oIRP==null)
        {
            alert("Please select a item from list!");
            return ;
        }
        DynamicRefreshList([], 'tblLots');
        GetsRS(oIRP);
        RefreshControl(oIRP)
    }
    function GetsRS(oIRP)
    {
        var obj = {
            BaseAddress: _sBaseAddress,
            Object: oIRP,
            ControllerName: "DUDeliveryLot",
            ActionName: "GetsRSs",
            IsWinClose: false
        };
        $.icsDataGets(obj, function (response) {
            debugger;
            if (response.status && response.objs.length > 0)
            {
                var oRSs= response.objs;
                DynamicRefreshList(oRSs, 'tblRSs');
            }
        });
    }
    function TabClick()
    {
        debugger;
        var tab = $('#tabReportDetail').tabs('getSelected');
        var index = $('#tabReportDetail').tabs('getTabIndex', tab);
        if (parseInt(index)==1)
        {
            LoadRS();
        }
    }

     /// print
    $('#btnPrintXL1').click(function()
    {
        debugger;
        _nReportType = 1;
        var sParams=sessionStorage.getItem("Params");
        if(sParams=="" || sParams == null)
        {
            alert("Please Enter The Searching Field !!");
            return;
        }
        window.open(_sBaseAddress + '/DUDeliveryLot/PrintRpt_Excel?sTempString=' + sParams + "&nReportType= " + _nReportType);
    });
    $('#btnPrintXL2').click(function()
    {
        debugger;
        _nReportType = 2;
        var sParams=sessionStorage.getItem("Params");
        if(sParams=="" || sParams == null)
        {
            alert("Please Enter The Searching Field !!");
            return;
        }
        window.open(_sBaseAddress + '/DUDeliveryLot/PrintRpt_Excel?sTempString=' + sParams + "&nReportType= " + _nReportType);
    });
    $('#btnPrintXL3').click(function()
    {
        debugger;
        _nReportType = 3;
        var sParams=sessionStorage.getItem("Params");
        if(sParams=="" || sParams == null)
        {
            alert("Please Enter The Searching Field !!");
            return;
        }
        window.open(_sBaseAddress + '/DUDeliveryLot/PrintRpt_Excel?sTempString=' + sParams + "&nReportType= " + _nReportType);
    });

    function FormatStyle(value){
        var values=value.split("~");
        var nRSCount = values[0];
        var nProductID = values[1];

        var s = '<label id="lblOpening~'+nProductID+'" style="color:Blue;cursor:pointer" class="lblOpening'+nProductID+'" onclick="ShowDetail('+nProductID+')">'+nRSCount+'</label>';
        return s;
    }
    function ShowDetail(nProductID)
    {
        var oRSA= $('#tblLotView').datagrid('getSelected');
        if(nProductID==null || nProductID<=0)
        {
            alert("Please select a item from list!");
            return;
        }
        var oRSAs= $('#tblLotView').datagrid('getRows');
        for (i = 0; i < oRSA.length; ++i)
        {
            if(oRSA[i].ProductID==nProductID)
            {
                oRSA=oRSA[i];
                break;
            }
        }
        var nIndex=$('#tblLotView').datagrid('getRowIndex',oRSA);
        sessionStorage.setItem("Operation", "Approve");
        sessionStorage.setItem("SelectedRowIndexLot", nIndex);
        sessionStorage.setItem("RouteSheetHeader", "Approve Production");
        sessionStorage.setItem("RouteSheetsApprove", JSON.stringify($('#tblLotView').datagrid('getRows')));
        sessionStorage.setItem("BackLinkLot", window.location.href);
        var tsv=((new Date()).getTime())/1000;
        window.location.href = _sBaseAddress+ "/DUDeliveryLot/View_DUDeliveryLot_Lot?nID="+oRSA.ProductID+"&ts="+tsv;
    }

     ////First Tab
    $('#btnView').click(function (e)
    {
        var oRouteSheet = $('#tblLotView').datagrid('getSelected');
        if (oRouteSheet ==null || oRouteSheet.RouteSheetID <=0 ) { alert("Please select an item from list."); return ; }
        var nIndex=$('#tblLotView').datagrid('getRowIndex',oRouteSheet);
        //sessionStorage.clear();
        sessionStorage.setItem("Operation", "View");
        sessionStorage.setItem("SelectedRowIndex", nIndex);
        sessionStorage.setItem("RouteSheetHeader", "View Production");
        sessionStorage.setItem("RouteSheets", JSON.stringify($('#tblLotView').datagrid('getRows')));
        sessionStorage.setItem("BackLink", window.location.href);
        var tsv=((new Date()).getTime())/1000;
        window.location.href = _sBaseAddress+ "/RouteSheet/ViewRouteSheet?nId="+oRouteSheet.RouteSheetID+"&ts="+tsv;;
    });

    $('#btnPrint').click(function (e)
    {
        var oRouteSheet = $('#tblLotView').datagrid('getSelected');
        if (oRouteSheet ==null || oRouteSheet.RouteSheetID <=0 ) { alert("Please select an item from list."); return ; }
        var tsv=((new Date()).getTime())/1000;
        window.open(_sBaseAddress+ "/RouteSheet/PrintRouteSheet?nId="+oRouteSheet.RouteSheetID+"&bIsCommon="+$("#chkIsCommon").is(":checked")+"&nts="+tsv, "_blank");

    });

    function RefreshSummary(nPeportType)
    {
        if(nPeportType==1)
        {
            var oRows = $('#tblLotView').datagrid('getRows');

        }
        else if(nPeportType==2)
        {
            var oRows = $('#tblProductView').datagrid('getRows');
        }
        else
        {
            var oRows = $('#tblBuyerView').datagrid('getRows');
        }
        if(oRows.length>0)
        {
            var nQty_DC = 0,nBalance=0;
            for(var i=0;i<oRows.length;i++)
            {
                nQty_DC = parseFloat(nQty_DC)+parseFloat(oRows[i].Qty_DC);
                nBalance = parseFloat(nBalance)+parseFloat(oRows[i].Balance);
            }

            nQty_DC = parseFloat(nQty_DC).toFixed(2);
            nBalance = parseFloat(nBalance).toFixed(2);

            if(nPeportType==1)
            {
                var oRow ={ Product : 'Total', Qty_DC:nQty_DC,  Balance:nBalance}
                $('#tblLotView').datagrid('appendRow',oRow);
            }
            else  if(nPeportType==2)
            {
                var oRow ={Product : 'Total',  Qty_DC:nQty_DC,Balance:nBalance }
                $('#tblProductView').datagrid('appendRow',oRow);
            }
            else
            {
                var oRow = {
                    Contractor : 'Total',  Qty_DC:nQty_DC, Balance:nBalance }
                $('#tblBuyerView').datagrid('appendRow',oRow);
            }
        }

    }
     //-------------Picker Code--------------------//
    $("#txtContractorAdvS").keydown(function (e) {
        if (e.keyCode === 13) // Enter Press
        {
            PickContractors_AdvS();
        }
        else if (e.keyCode === 08) {
            $("#txtContractorAdvS").removeClass("fontColorOfPickItem");
            _sContractorIds = '';
        }
    });

    $("#btnClrContractorAdvS").click(function () {
        $("#txtContractorAdvS").removeClass("fontColorOfPickItem");
        $("#txtContractorAdvS").val("");
        _sContractorIds = '';
    });

    $("#btnPickContractorAdvS").click(function () {
        PickContractors_AdvS();
    });
    function PickContractors_AdvS() {
        var oContractor = {
            Params: '2,3' + '~' + $.trim($("#txtContractorAdvS").val()+"~"+_nBUID)
        };
        var obj = {
            BaseAddress: _sBaseAddress,
            Object: oContractor,
            ControllerName: "Contractor",
            ActionName: "ContractorSearchByNameType",
            IsWinClose: false
        };

        $("#progressbar").progressbar({ value: 0 });
        $("#progressbarParent").show();
        var intervalID = setInterval(updateProgress, 250);

        DynamicRefreshList([], "tblAccountsPickerAdvSearch");
        $.icsDataGets(obj, function (response) {
            clearInterval(intervalID);
            $("#progressbarParent").hide();
            if (response.status && response.objs.length > 0) {
                if (response.objs[0].ContractorID > 0) {
                    var tblColums = []; var oColumn = { field: "ContractorID", title: "Code", width: 50, align: "left" }; tblColums.push(oColumn);
                    oColumn = { field: "Name", title: "Name", width: 280, align: "left" }; tblColums.push(oColumn);

                    var oPickerParam = {
                        winid: 'winContractorPicker',
                        winclass: 'clsAccountOf',
                        winwidth: 400,
                        winheight: 460,
                        tableid: 'tblAccountOfs',
                        tablecolumns: tblColums,
                        datalist: response.objs,
                        multiplereturn: true,
                        searchingbyfieldName: 'Name',
                        windowTittle: 'Contactor List'
                    };
                    $.icsPicker(oPickerParam);
                    IntializePickerbutton(oPickerParam);
                }
                else {
                    alert(response.objs[0].ErrorMessage);
                }
            }
            else {
                alert("Sorry, No Contactor Found.");
            }
        });
    }
    //End Account Of Picker


    //Start Product
    //Product Pick
    $("#txtProductName").keydown(function (e) {
        debugger;
        var code = (e.keyCode ? e.keyCode : e.which);
        if (code == 13) // Enter Press
        {
            if($('#txtProductName').val()==null || $('#txtProductName').val()=="")
            {
                alert("Please Type Product and Press Enter.");
                $('#txtProductName').focus();
                return;
            }
            PickProduct($('#txtProductName').val());
        }
        if (code == 8) //backspace=8
        {
            //debugger;
            $("#txtProductName").removeClass("fontColorOfPickItem");
            _sProductIds = "";
            _sPID = "";
        }
    });
    $("#btnProductPiker").click(function () {
        PickProduct("");
    });
    $("#btnClrProductPiker").click(function () {
        $("#txtProductName").val('');
        $("#txtProductName").removeClass("fontColorOfPickItem");
        _sProductIds= "";
        _sPID = "";
    });
    function PickProduct(sProductName)
    {
        var oProduct = { BUID:sessionStorage.getItem("BUID"),ProductName:sProductName};
        var obj = {
            BaseAddress: _sBaseAddress,
            Object: oProduct,
            ControllerName: "Product",
            ActionName: "SearchByProductBUWise",
            IsWinClose: false
        };
        $.icsDataGets(obj, function (response) {
            debugger;
            if (response.status && response.objs.length > 0) {
                if (response.objs[0].ProductID > 0) {
                    var tblColums = [];
                    var oColumn = { field: "ProductCode", title: "Code", width: 100, align: "left" }; tblColums.push(oColumn);
                    oColumn = { field: "ProductName", title: "Name", width: 300, align: "left" }; tblColums.push(oColumn);
                    oColumn = { field: "MUnit", title: "Unit", width: 70, align: "left" }; tblColums.push(oColumn);
                    var oPickerParam = {
                        winid: 'winProductPicker',
                        winclass: 'clsProductPicker',
                        winwidth: 600,
                        winheight: 460,
                        tableid: 'tblProductPicker',
                        tablecolumns: tblColums,
                        datalist: response.objs,
                        multiplereturn: true,
                        searchingbyfieldName: 'NameCode',
                        windowTittle: 'Product List'
                    };
                    $.icsPicker(oPickerParam);
                    IntializePickerbutton(oPickerParam);
                }
                else {
                    alert(response.objs[0].ErrorMessage);
                }

            }else{
                alert("Data Not Found.");
            }
        });
    }


    function IntializePickerbutton(oPickerobj) {
        $("#" + oPickerobj.winid).find("#btnOk").click(function () {
            SetPickerValueAssign(oPickerobj);
        });
        $(document).find('.' + oPickerobj.winclass).keydown(function (e) {
            if (e.which === 13) {
                SetPickerValueAssign(oPickerobj);
            }
        });
    }

    function SetPickerValueAssign(oPickerobj) {
        var oreturnObj = null, oreturnObjs = [];
        if (oPickerobj.multiplereturn) {
            oreturnObjs = $('#' + oPickerobj.tableid).datagrid('getChecked');
        } else {
            oreturnObj = $('#' + oPickerobj.tableid).datagrid('getSelected');
        }

        if (oPickerobj.winid == 'winContractorPicker')
        {
            if (oreturnObjs != null && oreturnObjs.length> 0)
            {

                _sContractorIds=''; var sMessage='';
                sMessage=(oreturnObjs.length>1)? oreturnObjs.length +" Contractors Selected" : oreturnObjs[0].Name;
                $('#txtContractorAdvS').val(sMessage);
                $("#txtContractorAdvS").addClass("fontColorOfPickItem");

                for(var i=0;i<oreturnObjs.length;i++){
                    _sContractorIds=_sContractorIds+oreturnObjs[i].ContractorID+',';
                }
                _sContractorIds=_sContractorIds.substring(0,_sContractorIds.length-1);

            }
            else
            {
                alert("Please select a contractor.");
                return false;
            }
        }
        else if (oPickerobj.winid == 'winProductPicker')
        {
            debugger;

            if (oreturnObjs!= null && oreturnObjs.length> 0)
            {
                _sProductIds=''; var sMessage='';
                sMessage=(oreturnObjs.length>1)? oreturnObjs.length +" ProductName Selected" : oreturnObjs[0].ProductName;
                $('#txtProductName').val(sMessage);
                $("#txtProductName").addClass("fontColorOfPickItem");

                for(var i=0;i<oreturnObjs.length;i++){
                    _sProductIds=_sProductIds+oreturnObjs[i].ProductID+',';
                }
                _sProductIds=_sProductIds.substring(0,_sProductIds.length-1);
                _sPID = _sProductIds;


            }
            else
            {
                alert("Please select a Product.");
                return false;
            }

        }

        $("#" + oPickerobj.winid).icsWindow("close");
        $("#" + oPickerobj.winid).remove();
    }



 </script>


