
@model IEnumerable<ESimSol.BusinessObjects.ReportingObject.FabricFSStatus>
    @{
        ViewBag.Title = "Delivery Log Report";
    }
    <div class="menuMainCollectionTable" style="margin-left: 0px; height: 565px">
        <table id="tblFabricFSState" title="Fabric Status Report" class="easyui-datagrid"
               style="width: 100%; height: 565px" fitcolumns="false" rownumbers="true" pagination="false"
               singleselect="true" autorowheight="false" toolbar="#toolbar" showFooter="true">
            <thead>
                <tr>
                    <th field="SCNo" width="12%" align="left" data-options="formatter:cellFormatterFirstCell">
                        PO
                    </th>
                    <th field="SCDateInString" width="12%" align="left">
                        PO Date
                    </th>
                    <th field="ApproveDateInString" width="12%" align="left">
                        Approve Date
                    </th>
                    <th field="AppDCDateInString" width="12%" align="left">
                        App. Delivery Date
                    </th>
                    <th field="TimeSpan" width="8%" align="left">
                        Lead Time
                    </th> 
                    <th field="LastDCDateInString" width="12%" align="left">
                        Last  Delivery Date
                    </th> 
                    <th field="OrderName" width="12%" align="left">
                        Order Type
                    </th>
                    <th field="BuyerName" width="15%" align="left">
                        Buyer
                    </th>
                    <th field="MktPersonName" width="15%" align="left">
                        Mkt.Person
                    </th>              
                    <th field="NoofDispo" width="12%" align="Left">
                        No of Dispo
                    </th>       
                    <th field="Qty" width="12%" formatter="formatPrice" align="right">
                       Order Qty (Y)
                    </th>
                    <th field="QtyDC" width="12%" formatter="formatPrice" align="right">
                        Delivery Qty(Y)
                    </th> 
                </tr>
            </thead>
        </table>
        <div id="toolbar" style="height: auto">
            <table>
                <tr>
                    <td>     
                        <input type="text" id="txtPONo" placeholder="Search by PO No" style="width:100px;text-align:left" />                
                        <a id="btnAdvSearch" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-search" plain="true"> Adv. Search</a>
                        <a id="btnPOPreview" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-print" plain="true">Preview(PO)</a>
                        <a id="btnPrintPreview" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-print" plain="true">Preview List</a>
                        <a id="btnExcelPreview" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-excel" plain="true">Excel</a>
                        <a id="btnDetail" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-details" plain="true">Show Detail</a>
                        <a id="btnStatement" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-print" plain="true">Statement</a>
                    </td>
                </tr>
            </table>
        </div>
    </div>
    <div id="winAdvSearch" class="easyui-window winClass" style="width:650px;height:500px" title="Adv. Search" data-options="modal:true,closed:true,collapsible:false,minimizable:false,maximizable:false,closable:false">
        <fieldset style="margin-bottom: 0px;">
            <legend>Searching Criteria</legend>
            <table style="width:100%;text-align:right;">
                <tr>
                    <td style="width:20%;text-align:right;">
                        <label>P/I No :</label>
                    </td>
                    <td style=" width:30%;text-align:left;">
                        <input id="txtPINo" style="width:100%;" type="text" />
                    </td>
                    <td style=" width:20%;text-align:right;">
                        <label id="lblFabricAdv">Fabric No :</label>:
                    </td>
                    <td style=" width:30%;text-align:left;">
                        <input id="txtFabricID" style="width:80%;" type="text" />
                    </td>
                </tr>

                <tr>
                    <td style=" width:20%;text-align:right;">
                        <label>Issue To :</label>
                    </td>
                    <td colspan="3" style=" width:80%;text-align:left;">
                        <input id="txtContractorAdvS" style="width:80%;" type="text" placeholder="Type & Press Enter" />
                        <a id="btnPickContractorAdvS" href="javascript:void(0)" class="easyui-linkbutton ics-pick" iconcls="icon-pick" plain="true"></a>
                        <a id="btnClrContractorAdvS" href="javascript:void(0)" class="easyui-linkbutton ics-pick" iconcls="icon-clear" plain="true"></a>
                    </td>
                </tr>

                <tr>
                    <td style=" width:20%;text-align:right;">
                        <label>Buying House :</label>
                    </td>
                    <td colspan="3" style=" width:80%;text-align:left;">
                        <input id="txtDeliverTo" style="width:80%;" type="text" placeholder="Type & Press Enter" />
                        <a id="btnPickDeliverTo" href="javascript:void(0)" class="easyui-linkbutton ics-pick" iconcls="icon-pick" plain="true"></a>
                        <a id="btnClrDeliverTo" href="javascript:void(0)" class="easyui-linkbutton ics-pick" iconcls="icon-clear" plain="true"></a>
                    </td>
                </tr>
                <tr>
                    <td style=" width:20%;text-align:right;">
                        <label>Mkt Account:</label>
                    </td>
                    <td colspan="3" style=" width:80%;text-align:left;">
                        <input id="txtMktAccount" class="reset-text" placeholder="Search Concern Person" style="width:80%" />
                        <a id="btnPickMktAccount" href="javascript:void(0)" class="easyui-linkbutton ics-pick" iconcls="icon-pick" plain="true"></a>
                        <a id="btnResetMktPerson" href="javascript:void(0)" class="easyui-linkbutton ics-pick" iconcls="icon-clear" plain="true"></a>
                    </td>
                </tr>
                <tr>
                    <td style=" width:20%;text-align:right;">
                        <label>Mkt Group:</label>
                    </td>
                    <td colspan="3" style=" width:80%;text-align:left;">
                        <input id="txtMktGroup" class="reset-text" placeholder="Search Concern Person" style="width:80%" />
                        <a id="btnPickMktGroup" href="javascript:void(0)" class="easyui-linkbutton ics-pick" iconcls="icon-pick" plain="true"></a>
                        <a id="btnResetMktGroup" href="javascript:void(0)" class="easyui-linkbutton ics-pick" iconcls="icon-clear" plain="true"></a>
                    </td>
                </tr>
                <tr>
                    <td style=" width:20%;text-align:right;">
                        <label>PO Date:</label>
                    </td>
                    <td colspan="3" style=" width:80%;text-align:right;">
                        <table style=" width:100%;text-align:left;">
                            <tr>
                                <td style=" width:100%;text-align:left;">
                                    <select style="width:30%;" id="cboPODate" onchange="DateActions_OPDate(); "></select>
                                    <input id="txtFromPODate" type="text" style="width: 110px;" class="easyui-datebox" required="required" data-options="formatter:icsdateformat,parser:icsdateparser" />To
                                    <input id="txtToPODate" type="text" style="width: 110px;" class="easyui-datebox" required="required" data-options="formatter:icsdateformat,parser:icsdateparser" />
                                </td>
                            </tr>
                        </table>
                    </td>
                </tr>
                <tr>
                    <td style=" width:20%;text-align:right;">
                        <label>Approve Date:</label>
                    </td>
                    <td colspan="3" style=" width:80%;text-align:right;">
                        <table style=" width:100%;text-align:left;">
                            <tr>
                                <td style=" width:100%;text-align:left;">
                                    <select style="width:30%;" id="cboApproveDate" onchange="DateActions_ApproveDate(); "></select>
                                    <input id="txtFromApproveDate" type="text" style="width: 110px;" class="easyui-datebox" required="required" data-options="formatter:icsdateformat,parser:icsdateparser" />To
                                    <input id="txtToApproveDate" type="text" style="width: 110px;" class="easyui-datebox" required="required" data-options="formatter:icsdateformat,parser:icsdateparser" />
                                </td>
                            </tr>
                        </table>
                    </td>
                </tr>
                <tr>
                    <td style=" width:20%;text-align:right;">
                        <label>Production Type:</label>
                    </td>
                    <td style=" width:30%;text-align:left;">
                        <select id="cboProductionType" style="width:90%;"><option value="0">All</option><option value="1">In House</option><option value="2">Sub Contract</option></select>

                    </td>
                    <td style=" width:20%;text-align:right;">
                        <label>Print PO:</label>
                    </td>
                    <td style=" width:30%;text-align:left;">
                        <select style="width:80%;" id="cboIsPrinting">
                            <option value="0">Default</option>
                            <option value="1">Print</option>
                            <option value="2">Not Print</option>
                        </select>
                    </td>

                </tr>
                <tr>
                    <td style=" width:20%;text-align:right;">
                        <input type="checkbox" id="chkWithClose" />
                    </td>
                    <td style=" width:30%;text-align:left;">
                        <span><label>With Close</label></span>
                    </td>
                    <td style=" width:20%;text-align:right;">
                       
                    </td>
                    <td style=" width:30%;text-align:left;">
                        
                    </td>

                </tr>
                <tr>
                    <td style=" width:20%;text-align:right;">
                        <label>Order Type : </label>
                    </td>
                    <td colspan="3" style="width:80%;text-align:left;">
                        <div style="margin-top: 1px;">
                            <table style="width:100%; height: 150px;">
                                <tr>
                                    <td style="width:50%;">
                                        <table id="tblOrderTypes" class="easyui-datagrid" title="" style="width:95%; height: 150px;" data-options="singleSelect: false,fitColumns:false, rownumbers:true, pagination:false, autoRowHeight:false, ">
                                            <thead>
                                                <tr>
                                                    <th data-options="field:'Selected',checkbox:true"></th>
                                                    <th field="OrderName" width="80%"></th>
                                                </tr>
                                            </thead>
                                        </table>
                                    </td>
                                    <td style="width:50%;">
                                        <table id="tblCurrentStatuss" class="easyui-datagrid" title="" style="width:95%; height: 150px;" data-options="singleSelect: false,fitColumns:false, rownumbers:true, pagination:false, autoRowHeight:false, ">
                                            <thead>
                                                <tr>
                                                    <th data-options="field:'Selected',checkbox:true"></th>
                                                    <th field="Value" width="80%"></th>
                                                </tr>
                                            </thead>
                                        </table>
                                    </td>
                                </tr>
                            </table>
                        </div>
                    </td>
                </tr>

            </table>
        </fieldset>

        <fieldset>
            <legend>Actions : </legend>
            <table style="width:100%;text-align:right;">
                <tr>
                    <td style="width:20%;text-align:right;">

                        <a id="btnResetAdvSearch" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-reload" plain="true">Reset</a>

                    </td>
                    <td style="width:80%;text-align:right;">
                        <label class="lblLoadingMessage" style="float: left;">Loading Please Wait...</label>
                        <a id="btnSearchAdvSearch" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-search" plain="true">Search</a>
                        <a id="btnCloseAdvSearch" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-cancel" plain="true">Close</a>
                    </td>
                </tr>
            </table>
        </fieldset>
    </div>    
    <script type="text/javascript">

        var _sBaseAddress="";
        var _nMachineID=0;
        var _nLocationID=0;
        var _IsDateSelected=false;
        var _nBUID=0;
        var _oOrderTypes=[];
        var _nBUID = 0;
        var _oPaymentInstructions=[];
        var _sContractorIds="";
        var _sMAccountIds="";
        var _sMAGroupIds="";
        var _sBuyerIds="";
        var _oFabricPOStatus=[];
        $(document).ready(function ()
        {
            _sBaseAddress =@Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(HttpContext.Current.Session[SessionInfo.BaseAddress]));
            _nBUID = @Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(ViewBag.BUID));
            _oCompareOperators = @Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(ViewBag.CompareOperators));
            _oOrderTypes = @Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(ViewBag.OrderTypes));
            _oFabricPOStatus = @Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(ViewBag.FabricPOStatus));
            DynamicRefreshList(_oOrderTypes, "tblOrderTypes");
            DynamicRefreshList(_oFabricPOStatus, "tblCurrentStatuss");
            $("#cboPODate,#cboApproveDate").icsLoadCombo({
                List: _oCompareOperators,
                OptionValue: "id",
                DisplayText: "Value"
            });
        });

        function cellFormatterFirstCell(value,row,index) {
            if (parseFloat(row.QtyDC)==0)
                return "<table  style='width:20px;'><tr><td style='border: 0px;background-color:#F17D64;color:white;'> " + row.SCNo + " </td></tr></table>";
            else if (parseFloat(row.Qty) > parseFloat(row.QtyDC))
                return "<table  style='width:20px;'><tr><td style='border: 0px;background-color:#E5F60A;'> " + row.SCNo + " </td></tr></table>";
            else if (parseFloat(row.Qty) == parseFloat(row.QtyDC))
                return "<table  style='width:20px;'><tr><td style='border: 0px;background-color:#20A448;color:white;'> " + row.SCNo + " </td></tr></table>";
            else
                return row.SCNo;
        }

        $("#btnAdvSearch").click(function () {
            debugger;         
            $("#winAdvSearch").icsWindow("open", " FS Status");                        
        });    
        function RefreshList(oRPCAs)
        {
            data = oRPCAs;
            data = { "total": "" + data.length + "", "rows": data };
            $('#tblFabricFSState').datagrid('loadData', data);
            $.icsMakeFooterColumn('tblFabricFSState',['SCNo','Qty','QtyDC']);
        }
      

        ////Start adv Searching
        function updateProgress() {
            var value =$('#progressbar').progressbar('getValue');
            if (value < 96){
                value += Math.floor(Math.random() * 10);
                $('#progressbar').progressbar('setValue', value);
            }
        }
        function hideShow(miliseconds) {
            $("#progressbarParent").hide();
        }
        //Account Of Picker

        $("#txtContractorAdvS").keydown(function (e) {
            if (e.keyCode === 13) // Enter Press
            {
                PickContractors_AdvS();
            }
            else if (e.keyCode === 08) {
                $("#txtContractorAdvS").removeClass("fontColorOfPickItem");
                _sContractorIds = '';
            }
        });
        $("#btnClrContractorAdvS").click(function () {
            $("#txtContractorAdvS").removeClass("fontColorOfPickItem");
            $("#txtContractorAdvS").val("");
            _sContractorIds = '';
        });
        $("#btnPickContractorAdvS").click(function () {
            PickContractors_AdvS();
        });
        function PickContractors_AdvS() {
            var oContractor = {
                Params: '2,3' + '~' + $.trim($("#txtContractorAdvS").val()+"~"+_nBUID)
            };
            var obj = {
                BaseAddress: _sBaseAddress,
                Object: oContractor,
                ControllerName: "Contractor",
                ActionName: "ContractorSearchByNameType",
                IsWinClose: false
            };

            $("#progressbar").progressbar({ value: 0 });
            $("#progressbarParent").show();
            var intervalID = setInterval(updateProgress, 250);

            DynamicRefreshList([], "tblAccountsPickerAdvSearch");
            $.icsDataGets(obj, function (response) {
                clearInterval(intervalID);
                $("#progressbarParent").hide();
                if (response.status && response.objs.length > 0) {
                    if (response.objs[0].ContractorID > 0) {
                        var tblColums = []; var oColumn = { field: "ContractorID", title: "Code", width: 50, align: "left" }; tblColums.push(oColumn);
                        oColumn = { field: "Name", title: "Name", width: 280, align: "left" }; tblColums.push(oColumn);

                        var oPickerParam = {
                            winid: 'winContractorPicker',
                            winclass: 'clsAccountOf',
                            winwidth: 400,
                            winheight: 460,
                            tableid: 'tblAccountOfs',
                            tablecolumns: tblColums,
                            datalist: response.objs,
                            multiplereturn: true,
                            searchingbyfieldName: 'Name',
                            windowTittle: 'Contactor List'
                        };
                        $.icsPicker(oPickerParam);
                        IntializePickerbutton(oPickerParam);
                    }
                    else {
                        alert(response.objs[0].ErrorMessage);
                    }
                }
                else {
                    alert("Sorry, No Contactor Found.");
                }
            });
        }
        //End Account Of Picker
        $("#btnClrDeliverTo").click(function () {
            $("#txtDeliverTo").val("");
            _sBuyerIds="";
        });
        $("#btnPickDeliverTo").click(function () {

            var oContractor = {
                Params: '2,3' + '~' + $.trim($("#txtDeliverTo").val()+'~'+_nBUID)
            };
            GetDeliverTo(oContractor);
        });
        $("#txtDeliverTo").keydown(function (e) {
            var nkeyCode = e.keyCode || e.which;
            if(nkeyCode==13){
                var sContractorName=$.trim($("#txtDeliverTo").val());
                if(sContractorName=="" || sContractorName==null)
                {
                    alert("Please, Type name or part of Name");
                    $("#txtDeliverTo").focus();
                    $("#txtDeliverTo").addClass("errorFieldBorder");
                    return;
                }
                var oContractor = {
                    Params: '2,3' + '~' + $.trim($("#txtDeliverTo").val()+'~'+_nBUID)
                };
                GetDeliverTo(oContractor);
            }
            else if(nkeyCode==8){
                $("#txtDeliverTo").val("");
                _sBuyerIds="";

            }
        });  
        function GetDeliverTo(oContractor){
            var obj = {
                BaseAddress: _sBaseAddress,
                Object: oContractor,
                ControllerName: "Contractor",
                ActionName: "ContractorSearchByNameType",
                IsWinClose: false
            };
            $("#progressbar").progressbar({ value: 0 });
            $("#progressbarParent").show();
            var intervalID = setInterval(updateProgress, 250);
            $.icsDataGets(obj, function (response) {
                clearInterval(intervalID);
                $("#progressbarParent").hide();
                if (response.status && response.objs.length > 0)
                {
                    if (response.objs[0].ContractorID > 0) {
                        debugger;
                        var tblColums = [];
                        var oColumn = { field: "ContractorID", title: "Code", width: 50, align: "center" };tblColums.push(oColumn);
                        oColumn = { field: "Name", title: "Name", width: 190, align: "left" };tblColums.push(oColumn);
                        oColumn = { field: "Phone", title: "Phone", width: 140, align: "left" };tblColums.push(oColumn);

                        var oPickerParam = {
                            winid: 'winDeliverToPicker',
                            winclass:'clsDeliverToPicker',
                            winwidth: 460,
                            winheight: 460,
                            tableid: 'tblDeliverToPicker',
                            tablecolumns: tblColums,
                            datalist: response.objs,
                            multiplereturn: true,
                            searchingbyfieldName:'Name',
                            windowTittle: 'Deliver To List'
                        };
                        $.icsPicker(oPickerParam);
                        IntializePickerbutton(oPickerParam);//multiplereturn, winclassName
                    }
                    else { alert(response.objs[0].ErrorMessage); }
                }
                else{
                    alert("No contractor found.");
                }
            });
        }
        $("#btnResetMktPerson").click(function () {

            $("#txtMktAccount").val("");
            _sMAccountIds="";
        });
        $("#btnPickMktAccount").click(function () {
            debugger;
            var sName=$.trim($("#txtMktAccount").val());
            GetMktPersons(sName);
        });
        $("#txtMktAccount").keydown(function (e) {
            var nkeyCode = e.keyCode || e.which;
            if(nkeyCode==13){
                var sName=$.trim($("#txtMktAccount").val());
                if($('#txtMktAccount').val()==null || $('#txtMktAccount').val()=="")
                {
                    alert("Please Type Name or part Name and Press Enter.");
                    $('#txtMktAccount').focus();
                    return;
                }
                GetMktPersons(sName);
            }
            else if(nkeyCode==8){
                $("#txtMktAccount").val("");
                _sMAccountIds="";
            }
        });
        function GetMktPersons(sName){

            var oMarketingAccount_BU = {
                Name:sName,
                BUID:sessionStorage.getItem("BUID")
            };
            var obj = {
                BaseAddress: _sBaseAddress,
                Object: oMarketingAccount_BU,
                ControllerName: "MarketingAccount",
                ActionName: "MarketingAccountSearchByNameAndGroup",
                IsWinClose: false
            };

            $.icsDataGets(obj, function (response) {

                if (response.status && response.objs.length > 0) {
                    if (response.objs[0].MarketingAccountID > 0) {
                        debugger;
                        var tblColums = [];
                        var oColumn = { field: "MarketingAccountID", title: "Code", width: 50, align: "left" };tblColums.push(oColumn);
                        oColumn = { field: "Name", title: "Name", width: 180, align: "left" };tblColums.push(oColumn);
                        oColumn = { field: "GroupName", title: "GroupName", width: 120, align: "left" };tblColums.push(oColumn);
                        oColumn = { field: "Phone", title: "Phone", width: 100, align: "left" };tblColums.push(oColumn);

                        var oPickerParam = {
                            winid: 'winMktAccount',
                            winclass:'clsMktPersonPicker',
                            winwidth: 460,
                            winheight: 460,
                            tableid: 'tblMktPersonPicker',
                            tablecolumns: tblColums,
                            datalist: response.objs,
                            multiplereturn: true,
                            searchingbyfieldName:'Name',
                            windowTittle: 'MKT Person List'
                        };
                        $.icsPicker(oPickerParam);
                        IntializePickerbutton(oPickerParam);//multiplereturn, winclassName
                    }
                    else { alert(response.objs[0].ErrorMessage); }
                }
                else{
                    alert("No marketing person found.");
                }
            });
        }
        //End Pick Mkt
        // Mkt Group
        $("#btnResetMktGroup").click(function () {

            $("#txtMktGroup").val("");
            _sMAGroupIds="";
        });
        $("#btnPickMktGroup").click(function () {
            debugger;
            var sName=$.trim($("#txtMktGroup").val());
            GetMktGroups(sName);
        });
        $("#txtMktGroup").keydown(function (e) {
            var nkeyCode = e.keyCode || e.which;
            if(nkeyCode==13){
                var sName=$.trim($("#txtMktGroup").val());
                if($('#txtMktGroup').val()==null || $('#txtMktGroup').val()=="")
                {
                    alert("Please Type Name or part Name and Press Enter.");
                    $('#txtMktGroup').focus();
                    return;
                }
                GetMktGroups(sName);
            }
            else if(nkeyCode==8){
                $("#txtMktGroup").val("");
                _sMAGroupIds="";
            }
        });
        function GetMktGroups(sName){

            var oMarketingAccount_BU = {
                Name:sName,
                BUID:sessionStorage.getItem("BUID")
            };
            var obj = {
                BaseAddress: _sBaseAddress,
                Object: oMarketingAccount_BU,
                ControllerName: "MarketingAccount",
                ActionName: "GetsAllGroup",
                IsWinClose: false
            };

            $.icsDataGets(obj, function (response) {

                if (response.status && response.objs.length > 0) {
                    if (response.objs[0].MarketingAccountID > 0) {
                        debugger;
                        var tblColums = [];
                        var oColumn = { field: "MarketingAccountID", title: "Code", width: 50, align: "left" };tblColums.push(oColumn);
                        oColumn = { field: "Name", title: "Name", width: 180, align: "left" };tblColums.push(oColumn);
                        oColumn = { field: "GroupName", title: "GroupName", width: 120, align: "left" };tblColums.push(oColumn);
                        oColumn = { field: "Phone", title: "Phone", width: 100, align: "left" };tblColums.push(oColumn);

                        var oPickerParam = {
                            winid: 'winMktGroup',
                            winclass:'clsMktGroupPicker',
                            winwidth: 460,
                            winheight: 460,
                            tableid: 'tblMktGroupicker',
                            tablecolumns: tblColums,
                            datalist: response.objs,
                            multiplereturn: true,
                            searchingbyfieldName:'Name',
                            windowTittle: 'MKT Group List'
                        };
                        $.icsPicker(oPickerParam);
                        IntializePickerbutton(oPickerParam);//multiplereturn, winclassName
                    }
                    else { alert(response.objs[0].ErrorMessage); }
                }
                else{
                    alert("No marketing person found.");
                }
            });
        }

        // Mkt Group
        function IntializePickerbutton(oPickerobj) {
            $("#" + oPickerobj.winid).find("#btnOk").click(function () {
                SetPickerValueAssign(oPickerobj);
            });
            $(document).find('.' + oPickerobj.winclass).keydown(function (e) {
                if (e.which === 13) {
                    SetPickerValueAssign(oPickerobj);
                }
            });
        }
        function SetPickerValueAssign(oPickerobj) {
            var oreturnObj = null, oreturnObjs = [];
            if (oPickerobj.multiplereturn) {
                oreturnObjs = $('#' + oPickerobj.tableid).datagrid('getChecked');
            } else {
                oreturnObj = $('#' + oPickerobj.tableid).datagrid('getSelected');
            }

            if (oPickerobj.winid == 'winContractorPicker')
            {
                if (oreturnObjs != null && oreturnObjs.length> 0)
                {

                    _sContractorIds=''; var sMessage='';
                    sMessage=(oreturnObjs.length>1)? oreturnObjs.length +" Contractors Selected" : oreturnObjs[0].Name;
                    $('#txtContractorAdvS').val(sMessage);
                    $("#txtContractorAdvS").addClass("fontColorOfPickItem");

                    for(var i=0;i<oreturnObjs.length;i++){
                        _sContractorIds=_sContractorIds+oreturnObjs[i].ContractorID+',';
                    }
                    _sContractorIds=_sContractorIds.substring(0,_sContractorIds.length-1);

                }
                else
                {
                    alert("Please select a contractor.");
                    return false;
                }
            }

            else if (oPickerobj.winid == 'winDeliverToPicker') 
            {
                if (oreturnObjs != null && oreturnObjs.length> 0)
                {
                    var sMessage='';
                    _sBuyerIds="";
                    sMessage=(oreturnObjs.length>1)? oreturnObjs.length +" Buying House(s) Selected" : oreturnObjs[0].Name;
                    $('#txtDeliverTo').val(sMessage);
                    $("#txtDeliverTo").addClass("fontColorOfPickItem");

                    for(var i=0;i<oreturnObjs.length;i++){
                        _sBuyerIds=_sBuyerIds+oreturnObjs[i].ContractorID+',';
                    }
                    _sBuyerIds=_sBuyerIds.substring(0,_sBuyerIds.length-1);
               
                }
                else
                {
                    alert("Please select a Buying House.");
                    return false;
                }
            }
            else if (oPickerobj.winid == 'winMktAccount') 
            {
                if (oreturnObjs != null && oreturnObjs.length> 0)
                {
                    var sMessage='';
                    _sMAccountIds="";
                    sMessage=(oreturnObjs.length>1)? oreturnObjs.length +"MKT Account(s) Selected" : oreturnObjs[0].Name;
                    $('#txtMktAccount').val(sMessage);
                    $("#txtMktAccount").addClass("fontColorOfPickItem");
                    for(var i=0;i<oreturnObjs.length;i++){
                        _sMAccountIds=_sMAccountIds+oreturnObjs[i].MarketingAccountID+',';
                    }
                    _sMAccountIds=_sMAccountIds.substring(0,_sMAccountIds.length-1);
                }
                else
                {
                    alert("Please select a MKt Account.");
                    return false;
                }
            }
            else if (oPickerobj.winid == 'winMktGroup') 
            {
                if (oreturnObjs != null && oreturnObjs.length> 0)
                {
                    var sMessage='';
                    _sMAGroupIds="";
                    sMessage=(oreturnObjs.length>1)? oreturnObjs.length +"MKT Group(s) Selected" : oreturnObjs[0].Name;
                    $('#txtMktGroup').val(sMessage);
                    $("#txtMktGroup").addClass("fontColorOfPickItem");
                    for(var i=0;i<oreturnObjs.length;i++){
                        _sMAGroupIds=_sMAGroupIds+oreturnObjs[i].MarketingAccountID+',';
                    }
                    _sMAGroupIds=_sMAGroupIds.substring(0,_sMAGroupIds.length-1);
                }
                else
                {
                    alert("Please select a MKt Group.");
                    return false;
                }
            }

        

            $("#" + oPickerobj.winid).icsWindow("close");
            $("#" + oPickerobj.winid).remove();
        }
        //End Buyer Search
        $("#btnResetAdvSearch").click(function () {
            ResetAdvSearchWindow();
            LoadComboAdv();
        });

        $('#txtPONo').keypress(function (e) {
            var code = (e.keyCode ? e.keyCode : e.which);
            var sOrderTypeIDs = "";
            var sCurrentStatus = "";
            if (code == 13)//Enter key-13
            {
                debugger;
                if($("#txtPONo").val()==null && $("#txtPONo").val()=="")
                {
                    alert("Please Type a PO no");
                    $("#txtPONo").focus();
                    return;
                }
                var nRpeortType = 1;
                var sTempString = $.trim($("#txtPINo").val()) + '~'
                                + $.trim($("#txtFabricID").val()) + '~'
                                + _sContractorIds + '~'
                                + _sBuyerIds + '~'
                                + _sMAccountIds + '~'
                                + $("#cboPODate").val() + '~'
                                + $("#txtFromPODate").datebox("getValue") + '~'
                                + $("#txtToPODate").datebox("getValue") + '~'
                                 + $("#cboApproveDate").val() + '~'
                                + $("#txtFromApproveDate").datebox("getValue") + '~'
                                + $("#txtToApproveDate").datebox("getValue") + '~'
                                + $("#cboProductionType").val() + '~'
                                + sOrderTypeIDs  + '~'
                                  + sCurrentStatus  + '~'
                                    + $("#cboIsPrinting").val() + '~'
                                      + _sMAGroupIds+'~'+_nBUID+'~'+nRpeortType+'~'+$("#txtPONo").val()+'~'+0;

                var oFabricSalesContract = {
                    ErrorMessage: sTempString
                }

                sessionStorage.setItem("ParamsP", sTempString);
                $.ajax({
                    type: "POST",
                    dataType: "json",
                    url: _sBaseAddress +"/FabricFSStatus/AdvanchSearch",
                    traditional: true,
                    data: JSON.stringify(oFabricSalesContract),
                    contentType: "application/json; charset=utf-8",
                    success: function (data) {
                        debugger;
                        var oFabricSalesContracts = data;
                        if (oFabricSalesContracts.length > 0) 
                        {
                            DynamicRefreshList(oFabricSalesContracts, "tblFabricFSState");
                            RefreshList(oFabricSalesContracts);                       
                            $("#winAdvSearch").icsWindow("close");
                            $.icsMakeFooterColumn('tblFabricFSState',['SCNo','Qty','QtyDC']);
                        } else {
                            alert("Sorry, No data found.");
                            DynamicRefreshList([], "tblFabricFSState");
                        }
                        $(".lblLoadingMessage").hide();
                 
                    }
                });
            }
        });

        $("#btnSearchAdvSearch").click(function () {
            debugger;
            $(".lblLoadingMessage").show();
            var sOrderTypeIDs = "";
     
            var oOrderType = $("#tblOrderTypes").datagrid("getChecked");
            if (oOrderType.length > 0)
            {
                for (var i = 0;i<oOrderType.length; i++){
                    sOrderTypeIDs = oOrderType[i].FabricOrderType + "," + sOrderTypeIDs;
                }
                sOrderTypeIDs = sOrderTypeIDs.substring(0, sOrderTypeIDs.length - 1);
            }

            var sCurrentStatus = "";
            var oCurrentStatuss = $("#tblCurrentStatuss").datagrid("getChecked");
            if (oCurrentStatuss.length > 0)
            {
                for (var i = 0;i<oCurrentStatuss.length; i++){
                    sCurrentStatus = oCurrentStatuss[i].id + "," + sCurrentStatus;
                }
                sCurrentStatus = sCurrentStatus.substring(0, sCurrentStatus.length - 1);
            }
            var nRpeortType = 1;
            var IsWithClose = $('#chkWithClose').is(':checked');
            if(IsWithClose == true){
                IsWithClose = 1;
            }
            else{
                IsWithClose = 0;
            }

            var sTempString = $.trim($("#txtPINo").val()) + '~'
                            + $.trim($("#txtFabricID").val()) + '~'
                            + _sContractorIds + '~'
                            + _sBuyerIds + '~'
                            + _sMAccountIds + '~'
                            + $("#cboPODate").val() + '~'
                            + $("#txtFromPODate").datebox("getValue") + '~'
                            + $("#txtToPODate").datebox("getValue") + '~'
                             + $("#cboApproveDate").val() + '~'
                            + $("#txtFromApproveDate").datebox("getValue") + '~'
                            + $("#txtToApproveDate").datebox("getValue") + '~'
                            + $("#cboProductionType").val() + '~'
                            + sOrderTypeIDs  + '~'
                              + sCurrentStatus  + '~'
                                + $("#cboIsPrinting").val() + '~'
                                  + _sMAGroupIds+'~'+_nBUID+'~'+nRpeortType+'~'+$("#txtPONo").val()+'~'+IsWithClose;
                            
            var oFabricSalesContract = {
                ErrorMessage: sTempString
            }
            sessionStorage.setItem("ParamsP", sTempString);
            $.ajax({
                type: "POST",
                dataType: "json",
                url: _sBaseAddress +"/FabricFSStatus/AdvanchSearch",
                traditional: true,
                data: JSON.stringify(oFabricSalesContract),
                contentType: "application/json; charset=utf-8",
                success: function (data) {
                    debugger;
                    var oFabricSalesContracts = data;
                    if (oFabricSalesContracts.length > 0) 
                    {
                        DynamicRefreshList(oFabricSalesContracts, "tblFabricFSState");
                        RefreshList(oFabricSalesContracts);                       
                        $("#winAdvSearch").icsWindow("close");
                        $.icsMakeFooterColumn('tblFabricFSState',['SCNo','Qty','QtyDC']);
                    } else {
                        alert("Sorry, No data found.");
                        DynamicRefreshList([], "tblFabricFSState");
                    }
                    $(".lblLoadingMessage").hide();
                 
                }
            });
        });

      


        function LoadComboAdv()
        {
            DynamicRefreshList(_oOrderTypes, "tblOrderTypes");
            DynamicRefreshList(_oFabricPOStatus, "tblCurrentStatuss");
            $("#cboPODate,#cboApproveDate").icsLoadCombo({
                List: _oCompareOperators,
                OptionValue: "id",
                DisplayText: "Value"
            });
        }
        function CheckFromAndToDateValidation(OperationComboId, FromDateId, ToDateId) {
            $("#" + OperationComboId).parent().parent().parent().find("select").removeClass("errorFieldBorder");
            var nCboVal = $("#" + OperationComboId).val();
            if (parseInt(nCboVal) == 5 || parseInt(nCboVal) == 6) {
                var fromDate = $("#" + FromDateId).datebox("getValue");
                var toDate = $("#" + ToDateId).datebox("getValue");
                if (new Date(fromDate) > new Date(toDate)) {
                    $("#" + ToDateId).focus();
                    $("#" + OperationComboId).addClass("errorFieldBorder");
                    $(".lblLoadingMessage").hide();
                    return false;
                } else {
                    $("#" + OperationComboId).removeClass("errorFieldBorder");
                    return true;
                }
            } else {
                return true;
            }
        }
        function ResetAdvSearchWindow() {
            _sContractorIds = '';
            _sBankBranch_IssueIds = "";
            $(".lblLoadingMessage").hide();
            $("#winAdvSearch input").not("input[type='button']").val("");
            $("#winAdvSearch input").removeClass("fontColorOfPickItem");
            $("#winAdvSearch select").val(0);
            DateActions_OPDate();
            DateActions_ApproveDate();
            $("#txtFromPODate,#txtToPODate").datebox({ disabled: true });
            $("#txtFromPODate,#txtToPODate").datebox("setValue", icsdateformat(new Date()));

            $("#txtFromApproveDate,#txtToApproveDate").datebox({ disabled: true });
            $("#txtFromApproveDate,#txtToApproveDate").datebox("setValue", icsdateformat(new Date()));
            $("#chkWithClose").prop("checked", false);
             _sContractorIds="";
            _sMAccountIds="";
             _sMAGroupIds="";
            _sBuyerIds="";
        }
        function DateActions_OPDate() {
            DynamicDateActions("cboPODate", "txtFromPODate", "txtToPODate");
        }
        function DateActions_ApproveDate() {
            DynamicDateActions("cboApproveDate", "txtFromApproveDate", "txtToApproveDate");
        }
        $("#btnCloseAdvSearch").click(function () {
            $("#winAdvSearch").icsWindow("close");
        });
        $("#btnAdvSearch").click(function () {
            debugger;
            $(".lblLoadingMessage").hide();
            $("#winAdvSearch").icsWindow("open", "Production Request Advance Search");
            //DynamicRefreshList([], "tblExportPIAdvSearch");
            DynamicResetAdvSearchWindow("winAdvSearch");
            ResetAdvSearchWindow();
            LoadComboAdv();
        });    
        $('#btnPrintPreview').click(function (e)
        {     
            $(".lblLoadingMessage").show();
            var sOrderTypeIDs = "";
     
            var oOrderType = $("#tblOrderTypes").datagrid("getChecked");
            if (oOrderType.length > 0)
            {
                for (var i = 0;i<oOrderType.length; i++){
                    sOrderTypeIDs = oOrderType[i].FabricOrderType + "," + sOrderTypeIDs;
                }
                sOrderTypeIDs = sOrderTypeIDs.substring(0, sOrderTypeIDs.length - 1);
            }
            var sCurrentStatus = "";
            var oCurrentStatuss = $("#tblCurrentStatuss").datagrid("getChecked");
            if (oCurrentStatuss.length > 0)
            {
                for (var i = 0;i<oCurrentStatuss.length; i++){
                    sCurrentStatus = oCurrentStatuss[i].id + "," + sCurrentStatus;
                }
                sCurrentStatus = sCurrentStatus.substring(0, sCurrentStatus.length - 1);
            }
            var nRpeortType = 1;
            var IsWithClose = $('#chkWithClose').is(':checked');
            if(IsWithClose == true){
                IsWithClose = 1;
            }
            else{
                IsWithClose = 0;
            }
            var sTempString = $.trim($("#txtPINo").val()) + '~'
                            + $.trim($("#txtFabricID").val()) + '~'
                            + _sContractorIds + '~'
                            + _sBuyerIds + '~'
                            + _sMAccountIds + '~'
                            + $("#cboPODate").val() + '~'
                            + $("#txtFromPODate").datebox("getValue") + '~'
                            + $("#txtToPODate").datebox("getValue") + '~'
                             + $("#cboApproveDate").val() + '~'
                            + $("#txtFromApproveDate").datebox("getValue") + '~'
                            + $("#txtToApproveDate").datebox("getValue") + '~'
                            + $("#cboProductionType").val() + '~'
                            + sOrderTypeIDs  + '~'
                              + sCurrentStatus  + '~'
                                + $("#cboIsPrinting").val() + '~'
                                 + _sMAGroupIds+'~'+_nBUID+'~'+nRpeortType+'~'+$("#txtPONo").val()+'~'+IsWithClose;

            var nts=(new Date()).getTime()/1000;
            window.open(_sBaseAddress+"/FabricFSStatus/FabricFSStatusPreview?sValue="+sTempString+"&nts="+nts);
        });
        $('#btnExcelPreview').click(function (e)
        {     
            $(".lblLoadingMessage").show();
            var sOrderTypeIDs = "";
     
            var oOrderType = $("#tblOrderTypes").datagrid("getChecked");
            if (oOrderType.length > 0)
            {
                for (var i = 0;i<oOrderType.length; i++){
                    sOrderTypeIDs = oOrderType[i].FabricOrderType + "," + sOrderTypeIDs;
                }
                sOrderTypeIDs = sOrderTypeIDs.substring(0, sOrderTypeIDs.length - 1);
            }
            var sCurrentStatus = "";
            var oCurrentStatuss = $("#tblCurrentStatuss").datagrid("getChecked");
            if (oCurrentStatuss.length > 0)
            {
                for (var i = 0;i<oCurrentStatuss.length; i++){
                    sCurrentStatus = oCurrentStatuss[i].id + "," + sCurrentStatus;
                }
                sCurrentStatus = sCurrentStatus.substring(0, sCurrentStatus.length - 1);
            }
            var nRpeortType = 1;
            var IsWithClose = $('#chkWithClose').is(':checked');
            if(IsWithClose == true){
                IsWithClose = 1;
            }
            else{
                IsWithClose = 0;
            }
            var sTempString = $.trim($("#txtPINo").val()) + '~'
                            + $.trim($("#txtFabricID").val()) + '~'
                            + _sContractorIds + '~'
                            + _sBuyerIds + '~'
                            + _sMAccountIds + '~'
                            + $("#cboPODate").val() + '~'
                            + $("#txtFromPODate").datebox("getValue") + '~'
                            + $("#txtToPODate").datebox("getValue") + '~'
                             + $("#cboApproveDate").val() + '~'
                            + $("#txtFromApproveDate").datebox("getValue") + '~'
                            + $("#txtToApproveDate").datebox("getValue") + '~'
                            + $("#cboProductionType").val() + '~'
                            + sOrderTypeIDs  + '~'
                              + sCurrentStatus  + '~'
                                + $("#cboIsPrinting").val() + '~'
                                 + _sMAGroupIds+'~'+_nBUID+'~'+nRpeortType+'~'+$("#txtPONo").val()+'~'+IsWithClose;

            var nts=(new Date()).getTime()/1000;
            window.open(_sBaseAddress+"/FabricFSStatus/FabricFSStatusPreviewExcel?sValue="+sTempString+"&nts="+nts);
        });
        $('#btnPOPreview').click(function (e)
        {     
            debugger;
            var oFabricFSState = $('#tblFabricFSState').datagrid('getSelected');
            if (oFabricFSState ==null || oFabricFSState.FabricSalesContractID <=0 ) { alert("Please select an item from list."); return ; }
            var nts=((new Date()).getTime())/1000;
            window.open(_sBaseAddress+ "/FabricSalesContract/PrintPreview?nID="+oFabricFSState.FabricSalesContractID+"&bIsRnd=true&nts="+nts+"&bPrintFormat=true&nTitleTypeInImg=1", "_blank");
        });
        $('#btnStatement').click(function (e)
        {
            debugger;
            var oFabricFSState = $('#tblFabricFSState').datagrid('getSelected');
            if (oFabricFSState ==null || oFabricFSState.FabricSalesContractID <=0 ) { alert("Please select an item from list."); return ; }
            var nts=((new Date()).getTime())/1000;
            window.open(_sBaseAddress+ "/FabricFSStatus/PrintStatementForDeliveryLog?nFSCID="+oFabricFSState.FabricSalesContractID+"&nts="+nts+"&nBUID="+_nBUID, "_blank");
        });

        /// end Adv Searching

        $('#btnDetail').click(function(){        
            debugger;
            var oFabricFSState = $('#tblFabricFSState').datagrid('getSelected');
            if(oFabricFSState==null || oFabricFSState.FabricSalesContractID<=0)
            {
                alert("Please select a item from list!");
                return;
            }
            var SelectedRowIndex=$('#tblFabricFSState').datagrid('getRowIndex',oFabricFSState);
            var oFabricFSStates= $('#tblFabricFSState').datagrid('getRows');
            sessionStorage.setItem("_FabricFSStates", JSON.stringify(oFabricFSStates));
            sessionStorage.setItem("SelectedRowIndex", SelectedRowIndex);
            sessionStorage.setItem("BackLink", window.location.href);
            //window.location.href =  _sBaseAddress+"/FabricFSStatus/ViewFabricFSStatusDetail?FSCID="+oFabricFSState.FabricSalesContractID;
            window.open(_sBaseAddress+"/FabricFSStatus/ViewFabricFSStatusDetail?FSCID="+oFabricFSState.FabricSalesContractID,"_blank");
        });
            </script>
