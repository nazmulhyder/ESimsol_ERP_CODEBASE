@model IEnumerable<ESimSol.BusinessObjects.MarketingAccount>
    @{
        ViewBag.Title = "MarketingAccounts List";
    }
    <div class="menuMainCollectionTable">
        <div class="easyui-panel" fit="true" style="margin-left:0px; height:100%;width:100%">
            <table border="0" cellpadding="0" cellspacing="0" style="height:100%;width:100%;">
                <tr>
                    <td style="height:100%; width:20%">
                        <div style="height:99%;">
                            <table id="tblMarketingHeads" title="Group Head List" class="easyui-datagrid" fit="true" fitcolumns="true" rownumbers="true" pagination="false" singleselect="true" autorowheight="false" toolbar="#toolbarGroup">
                                <thead>
                                    <tr>
                                        <th field="Name" width="120" align="left"> Name </th>
                                        <th field="ActivitySt" width="30" align="left"> Activity </th>
                                    </tr>
                                </thead>
                            </table>
                            <div id="toolbarGroup">
                                <table>
                                    <tr>
                                        <td>
                                            <a id="btnAddG" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-add" plain="true">Add</a>
                                            <a id="btnEditG" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-edit" plain="true">Edit</a>
                                            @*<a id="btnViewG" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-details" plain="true">View</a>*@
                                            <a id="btnDeleteG" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-remove" plain="true">Delete</a>
                                            <a id="btnGetMarketingAcccounts" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-reload" plain="true">Refresh</a>
                                            <a id="btnGrpActivity" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-ok" plain="true">Activity</a>
                                            @*<a id="btnGetsGroup" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-reload" plain="true">Show Group</a>*@
                                        </td>
                                    </tr>
                                </table>
                            </div>
                        </div>
                    </td>
                    <td style="height:100%;width:65%">
                        <div style="height:99%;">
                            <table id="tblMarketingAccounts" title="MarketingAccount List" class="easyui-datagrid" fit="true" fitcolumns="true" rownumbers="true" pagination="true" singleselect="true" autorowheight="false" toolbar="#toolbar">
                                <thead>
                                    <tr>
                                        <th field="Name" width="150" align="left"> Name </th>
                                        <th field="ShortName" width="150" align="left">Short Name </th>
                                        @*<th field="MarketingAccountTypeInString" width="140" align="left">MarketingAccount Type</th>*@
                                        <th field="GroupName" width="130" align="left">Group Name</th>
                                        <th field="GroupHeadSt" width="120" align="left">Group Head</th>
                                        <th field="ActivitySt" width="110" align="left">Is Active</th>
                                        <th field="UserName" width="140" align="left">Log in User Name</th>
                                        <th field="Email" width="100" align="left">Email Address</th>
                                    </tr>
                                </thead>
                            </table>
                            <div id="toolbar">
                                <table>
                                    <tr>
                                        <td>
                                            @*<a href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-reload" plain="true" id="btnReload"></a>*@
                                            <input type="text" id="txtSearchByName" placeholder="Search by name" style="width:200px" />
                                            <a id="btnAdd" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-add" plain="true">Add</a>
                                            <a id="btnEdit" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-edit" plain="true">Edit</a>
                                            <a id="btnView" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-details" plain="true">View</a>
                                            <a id="btnDelete" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-remove" plain="true">Delete</a>
                                            <a id="btnActiveInActive" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-ok" plain="true">Activity</a>
                                            <a id="btnMktSaleTarget" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-add" plain="true">Mkt Sale Target</a>
                                        </td>
                                    </tr>
                                </table>
                            </div>
                        </div>
                    </td>
                </tr>
            </table>
        </div>

        <div id="winAddGroup" style="width:500px;height:180px;" class=" easyui-window" title="Add Group Name" data-options="modal:true,closed:true,collapsible:false,minimizable:false,maximizable:false,closable:false">
            <div>
                <fieldset>
                    <legend style="font-weight:bold"> Group : </legend>
                    <table border="0" cellspacing="2" cellpadding="2" style="font-size:11px; font-weight:bold">
                        <tr>
                            <td style="width:125px; text-align:right">
                                Group Name :
                            </td>

                            <td style="width:200px">
                                <input type="text" style="width: 200px;" id="txtName_Group" />
                            </td>

                        </tr>

                    </table>
                </fieldset>
            </div>
            <fieldset style="vertical-align:top;">
                <legend style="font-weight:bold"> Action : </legend>
                <table border="0" cellspacing="2" cellpadding="2" style="font-size:11px; font-weight:bold;">
                    <tr>
                        <td style="width:7%;text-align:right;">
                            <a id="btnSaveGroup" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-save" plain="true">Save</a>
                            <a id="btnCloseGroup" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-cancel" plain="true">Close</a>
                        </td>

                    </tr>
                </table>
            </fieldset>
        </div>
    </div>

    <!--NAZMUL 24/09/2019 -->
    <div id="winMktSaleTarget" class="easyui-window winstyle" style=" height:auto;width:60%" data-options="modal:true,closed:true,collapsible:false,minimizable:false,maximizable:false,closable:false">
        <div class="menuMainCollectionTable">
            <div style="overflow:hidden;display:block;">
                <fieldset style="height:10%">
                    <legend style="font-weight: bold">Marketing Sale Target </legend>
                    <div style="overflow:hidden;display:block">
                        <div style="overflow:hidden;float:left; width:32%">
                            <div style="overflow:hidden;float:left;width:30%;text-align:right">
                                Order Type:
                            </div>
                            <div style="overflow:hidden;float:left;width:70%">
                                <select id="cboOrderType" style="float:left;width:100%"> </select>
                            </div>
                        </div>
                        <div style="overflow:hidden;float:left; width:32%">
                            <div style="overflow:hidden;float:left;width:30%;text-align:right">
                                Date:
                            </div>
                            <div style="overflow:hidden;float:left;width:70%">
                                <input id="txtDate" type="text" class="easyui-datebox" required="required" data-options="formatter:icsdateformat,parser:icsdateparser" style=" width:100%;" />
                            </div>
                        </div>
                        <div style="overflow:hidden;float:left; width:32%">
                            <div style="overflow:hidden;float:left;width:30%;text-align:right">
                                Value:
                            </div>
                            <div style="overflow:hidden;float:left;width:70%">
                                <input id="txtValue" type="text" style=" width:100%;" />
                            </div>
                        </div>
                    </div>
                    <div style="overflow:hidden;display:block;margin-top:5px">
                        <div style="overflow:hidden;float:left; width:32%">
                            <div style="overflow:hidden;float:left;width:30%;text-align:right">
                                Order Qty:
                            </div>
                            <div style="overflow:hidden;float:left;width:70%">
                                <input id="txtOrderQty" type="text" style=" width:100%;" />
                            </div>
                        </div>
                        <div style="overflow:hidden;float:left; width:64%">
                            <div style="overflow:hidden;float:left;width:15%;text-align:right">
                                Note:
                            </div>
                            <div style="overflow:hidden;float:left;width:85%">
                                <input id="txtNote" type="text" style=" width:100%;" />
                            </div>
                        </div>
                    </div>
                    <div style="overflow:hidden;display:block;margin-top:5px">
                        <div style="overflow:hidden;float:left; width:64%">

                        </div>
                        <div style="overflow:hidden;float:right; width:10%">
                            <input id="btnAddMktSaleTarget" type="button" style="width:59%" value="Add" />
                        </div>
                    </div>
                </fieldset>
            </div>
            <div title="Mkt Sale Target" style="display:block;overflow:hidden;height:200px">
                <table id="tblMktSaleTarget" title="@ViewBag.MarketingAccountName" class="easyui-datagrid" fit="true" fitcolumns="false" rownumbers="true" pagination="false" singleselect="true" autorowheight="false" toolbar="#toolbarKnittingConsumption" style="height:310px" showfooter="true">
                    <thead>
                        <tr>
                            <th field="OrderTypeST" width="10%">Order Type</th>
                            <th field="DateInString" width="15%">Date</th>
                            <th field="Value" width="10%">Value</th>
                            <th field="OrderQty" width="10%">Order Qty</th>
                            <th field="BuyerPosition" width="20%">Buyer Position</th>
                        </tr>
                    </thead>
                </table>
                <div id="toolbarKnittingConsumption">
                    <a id="btnMktSaleTargetDelete" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-remove" plain="true">Delete</a>
                </div>
            </div>
            <div style="display:block;overflow:hidden;">
                <fieldset style="height:10%">
                    <legend style="font-weight: bold">Action : </legend>
                    <table border="0" cellspacing="2" cellpadding="2" style="font-size: 11px; font-weight: bold; width:100%">
                        <tr>
                            <td style="width:60%; text-align:right"></td>
                            <td style="width:40%;text-align:right;">
                                <a id="btnMktSaleTargetClose" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-cancel" plain="true">Close</a>
                            </td>
                        </tr>
                    </table>
                </fieldset>
            </div>
        </div>
    </div>

    <script type="text/javascript">
        var _oMarketingAccounts=[];
        var _sBaseAddress="";
        var _sMenuID=0;
        var _nMarketingAccountID=0;
        var _oAuthorizationRolesMapping =[];
        $(document).ready(function () {
            _oMarketingAccounts =@Html.Raw( new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(Model));
            _sBaseAddress =@Html.Raw( new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(HttpContext.Current.Session[SessionInfo.BaseAddress]));
            _sMenuID =@Html.Raw( new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(HttpContext.Current.Session[SessionInfo.MenuID]));
            _oAuthorizationRolesMapping =@Html.Raw( new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(HttpContext.Current.Session[SessionInfo.AuthorizationRolesMapping]));
            var nBUID =@Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(ViewBag.BUID));
            var  oOrderTypes = @Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(ViewBag.OrderType));
            $("#cboOrderType").icsLoadCombo({List: oOrderTypes, OptionValue: "id", DisplayText: "Value", InitialValue:"-Select One-" });
            sessionStorage.setItem("BUID", nBUID);
            debugger
            $('#txtDate').datebox('setValue',icsdateformat(new Date()));
            var oMarketingAccounts =sessionStorage.getItem("MarketingAccounts");
            var nIndex =sessionStorage.getItem("SelectedRowIndex");
            if(oMarketingAccounts!=null)
            {
                oMarketingAccounts = jQuery.parseJSON(oMarketingAccounts)===null?_oMarketingAccounts:jQuery.parseJSON(oMarketingAccounts);
            }
            else
            {
                oMarketingAccounts=_oMarketingAccounts;
            }
            DynamicRefreshList(oMarketingAccounts, 'tblMarketingAccounts');
            //  RefreshControlLayout();
            if(nIndex!=null)
            {
                $('#tblMarketingAccounts').datagrid('selectRow', nIndex);
            }
            SetGroup();
            $('#txtValue').icsCurrencyBox();
            $('#txtOrderQty').icsCurrencyBox();
        });


        //// Add Group
        $("#btnAddG").click(function(){
            _nMarketingAccountID=0;
            $("#winAddGroup").icsWindow('open', "Add Group");
            $("#winAddGroup input").not("input[type='button']").val("");
        });
        //// Edit Group
        $("#btnEditG").click(function(){
            var oMarketingAccount= $('#tblMarketingHeads').datagrid('getSelected');
            if(oMarketingAccount==null || oMarketingAccount.MarketingAccountID<=0)
            {
                alert("Please select a item from list!");
                return;
            }
            _nMarketingAccountID=oMarketingAccount.MarketingAccountID;
            var SelectedGroupIndex=$('#tblMarketingHeads').datagrid('getRowIndex',oMarketingAccount);
            sessionStorage.setItem('SelectedGroupIndex',SelectedGroupIndex);
            $("#winAddGroup").icsWindow('open', "Edit Group");
            $("#winAddGroup input").not("input[type='button']").val("");
            $("#txtName_Group").val(oMarketingAccount.Name);
        });
        function RefreshObjectGroup()
        {
            var oMarketingAccount= {
                MarketingAccountID : _nMarketingAccountID,
                EmployeeID :0,
                GroupID: 0,
                Name :$("#txtName_Group").val(),
                Phone: "",
                Phone2: "",
                Email: "",
                Fax : "",
                Note : "",
                UserID:0,
                Activity:true,
                IsGroup:true,
                IsGroupHead:false,
                BusinessUnits: parseInt(sessionStorage.getItem("BUID"))
            };
            return oMarketingAccount;
        }
        $("#btnSaveGroup").click(function(){
            var sEmployeeName=$.trim($("#txtName_Group").val());
            if(sEmployeeName=="" || sEmployeeName==null)
            {
                alert("Please, Type name");
                $("#txtName_Group").focus();
                $("#txtName_Group").addClass("errorFieldBorder");
                return;
            }
            var oMarketingAccount=RefreshObjectGroup();
            $.ajax({
                type: "POST",
                dataType: "json",
                url : _sBaseAddress+  "/MarketingAccount/Save",
                traditional: true,
                data:  JSON.stringify(oMarketingAccount),
                contentType: "application/json; charset=utf-8",
                success: function (data) {
                    oMarketingAccount = jQuery.parseJSON(data);
                    if (oMarketingAccount.MarketingAccountID>0 && (oMarketingAccount.ErrorMessage=="" || oMarketingAccount.ErrorMessage==null)) {
                        alert("Data Saved sucessfully");
                        if(_nMarketingAccountID>0)
                        {
                            $('#tblMarketingHeads').datagrid('updateRow',{
                                index: parseInt(sessionStorage.getItem('SelectedGroupIndex')),
                                row: oMarketingAccount
                            });
                        }
                        else
                            $('#tblMarketingHeads').datagrid('appendRow',oMarketingAccount);
                        $("#winAddGroup").icsWindow('close');
                    }
                    else {
                        alert(oMarketingAccount.ErrorMessage);
                        return;
                    }
                },
                error: function (xhr, status, error) {
                    alert(error);
                }
            });
        });
        $("#btnCloseGroup").click(function(){
            $("#winAddGroup").icsWindow('close');
        });


        $('#txtSearchByName').keypress(function (e) {
            var c = String.fromCharCode(e.which);
            var txtSearchByName = document.getElementById('txtSearchByName').value;
            txtSearchByName = txtSearchByName + c;
            var bFlag=false;
            var sTempName="";
            var rows = $('#tblMarketingAccounts').datagrid('getRows');
            for(i=0;i<rows.length;++i){
                sTempName=rows[i]['Name'].substring(0, txtSearchByName.length);
                if(txtSearchByName.toUpperCase()==sTempName.toUpperCase())
                {
                    bFlag=true;
                    break;
                }
            }
            if(bFlag)
            {
                $('#tblMarketingAccounts').datagrid('selectRow', i);
            }
        });

        $("#btnActiveInActive").click(function(){
            var bIsActive = null;
            var oMarketingAccount = $('#tblMarketingAccounts').datagrid('getSelected');
            if(oMarketingAccount==null || parseInt(oMarketingAccount.MarketingAccountID)<=0)
            {
                alert("Please select a item from list!");
                return;
            }
            debugger;
            if(oMarketingAccount.Activity)
            {
                if (!confirm("Confirm to In Active?")) return ;
                bIsActive =false;
            }
            else
            {
                if (!confirm("Confirm to Active?")) return ;
                bIsActive =true;
            }
            var SelectedRowIndex=$('#tblMarketingAccounts').datagrid('getRowIndex',oMarketingAccount);
            $.ajax
            ({
                type: "GET",
                dataType: "json",
                url : _sBaseAddress+ "/MarketingAccount/CommitActivity",
                data: { id: oMarketingAccount.MarketingAccountID, IsActive:bIsActive},
                contentType: "application/json; charset=utf-8",
                success: function (data) {
                    var oMarketingAccount = jQuery.parseJSON(data);
                    if (parseInt(oMarketingAccount.MarketingAccountID)>0)
                    {
                        if(bIsActive ==true)
                        {
                            alert("Active sucessfully");
                        }else
                        {
                            alert("In Active sucessfully");
                        }
                        $('#tblMarketingAccounts').datagrid('updateRow',{index: SelectedRowIndex,row: oMarketingAccount});
                    }
                    else
                    {
                        alert(oMarketingAccount.ErrorMessage);
                    }
                },
                error: function (xhr, status, error)
                {
                    alert(error);
                }
            });
        });
        $("#btnGrpActivity").click(function(){
            debugger;
            var bIsActive = null;
            var oMarketingAccountHead = $('#tblMarketingHeads').datagrid('getSelected');
            if(oMarketingAccountHead==null || parseInt(oMarketingAccountHead.MarketingAccountID)<=0)
            {
                alert("Please select a item from list!");
                return;
            }
            debugger;
            if(oMarketingAccountHead.Activity)
            {
                if (!confirm("Confirm to In Active?")) return ;
                bIsActive =false;
            }
            else
            {
                if (!confirm("Confirm to Active?")) return ;
                bIsActive =true;
            }
            var SelectedRowIndex=$('#tblMarketingHeads').datagrid('getRowIndex',oMarketingAccountHead);
            $.ajax
            ({
                type: "GET",
                dataType: "json",
                url : _sBaseAddress+ "/MarketingAccount/GroupActivity",
                data: { id: oMarketingAccountHead.MarketingAccountID, IsActive:bIsActive},
                contentType: "application/json; charset=utf-8",
                success: function (data) {
                    var oMarketingAccount = jQuery.parseJSON(data);
                    if (parseInt(oMarketingAccount.MarketingAccountID)>0)
                    {
                        if(bIsActive ==true)
                        {
                            alert("Active sucessfully");
                        }else
                        {
                            alert("In Active sucessfully");
                        }
                        $('#tblMarketingHeads').datagrid('updateRow',{index: SelectedRowIndex,row: oMarketingAccount});
                    }
                    else
                    {
                        alert(oMarketingAccount.ErrorMessage);
                    }
                },
                error: function (xhr, status, error)
                {
                    alert(error);
                }
            });
        });
        //$("#btnReload").click(function() {
        //    var nBUID= sessionStorage.getItem('BUID')
        //    window.location.href = _sBaseAddress+ '/MarketingAccount/ViewMarketingAccounts?'+"buid="+nBUID+"&menuid="+_sMenuID;
        //});
        $("#btnAdd").click(function(){
            var oMarketingHead= $('#tblMarketingHeads').datagrid('getSelected');
            if(oMarketingHead==null || oMarketingHead.MarketingAccountID==0)
            {
                oMarketingHead=new Object();
                oMarketingHead.MarketingAccountID=0;
                oMarketingHead.Name='Open Group';
            }
            var SelectedGroupIndex=$('#tblMarketingHeads').datagrid('getRowIndex',oMarketingHead);
            sessionStorage.setItem('SelectedGroupIndex',SelectedGroupIndex);
            sessionStorage.setItem("MarketingHead", JSON.stringify(oMarketingHead));

            var oMarketingAccounts= $('#tblMarketingAccounts').datagrid('getRows');
            var sURL=window.location.href;
            sessionStorage.setItem("MarketingAccountBackTo", sURL);
            sessionStorage.setItem("MarketingAccounts", JSON.stringify(oMarketingAccounts));
            sessionStorage.setItem("SelectedRowIndex", -1);
            sessionStorage.setItem("MarketingAccountHeader", "Add MarketingAccount");
            var tsv=((new Date()).getTime())/1000;
            window.location.href = _sBaseAddress+ "/MarketingAccount/ViewMarketingAccount?id=0&ts="+tsv;

        });
        $("#btnEdit").click(function(){
            var oMarketingAccount= $('#tblMarketingAccounts').datagrid('getSelected');
            if(oMarketingAccount==null || oMarketingAccount.MarketingAccountID<=0)
            {
                alert("Please select a item from list!");
                return;
            }
            var oMarketingHead=null;
            var oMarketingHeads= $('#tblMarketingHeads').datagrid('getRows');
            for(var i=0; i<oMarketingHeads.length;i++)
            {
                if(oMarketingHeads[i].MarketingAccountID==oMarketingAccount.GroupID){
                    oMarketingHead=oMarketingHeads[i];
                }
            }

            var SelectedGroupIndex=$('#tblMarketingHeads').datagrid('getRowIndex',oMarketingHead);
            sessionStorage.setItem('SelectedGroupIndex',SelectedGroupIndex);
            sessionStorage.setItem("MarketingHead", JSON.stringify(oMarketingHead));

            var SelectedRowIndex=$('#tblMarketingAccounts').datagrid('getRowIndex',oMarketingAccount);
            var tsv=((new Date()).getTime())/1000;
            var SelectedRowIndex=$('#tblMarketingAccounts').datagrid('getRowIndex',oMarketingAccount);
            var oMarketingAccounts= $('#tblMarketingAccounts').datagrid('getRows');
            var sURL=window.location.href;
            sessionStorage.setItem("MarketingAccountBackTo", sURL);
            sessionStorage.setItem("MarketingAccounts", JSON.stringify(oMarketingAccounts));
            sessionStorage.setItem("SelectedRowIndex", SelectedRowIndex);
            sessionStorage.setItem("MarketingAccountHeader", "Edit MarketingAccount");
            window.location.href = _sBaseAddress+  "/MarketingAccount/ViewMarketingAccount?id="+oMarketingAccount.MarketingAccountID+"&ts="+tsv;

        });
        $("#btnView").click(function(){
            var oMarketingAccount= $('#tblMarketingAccounts').datagrid('getSelected');
            if(oMarketingAccount==null || oMarketingAccount.MarketingAccountID<=0)
            {
                alert("Please select a item from list!");
                return;
            }
            var SelectedRowIndex=$('#tblMarketingAccounts').datagrid('getRowIndex',oMarketingAccount);
            var tsv=((new Date()).getTime())/1000;
            var SelectedRowIndex=$('#tblMarketingAccounts').datagrid('getRowIndex',oMarketingAccount);
            var oMarketingAccounts= $('#tblMarketingAccounts').datagrid('getRows');
            var sURL=window.location.href;
            sessionStorage.setItem("MarketingAccountBackTo", sURL);
            sessionStorage.setItem("MarketingAccounts", JSON.stringify(oMarketingAccounts));
            sessionStorage.setItem("SelectedRowIndex", SelectedRowIndex);
            sessionStorage.setItem("MarketingAccountHeader", "View MarketingAccount");
            window.location.href = _sBaseAddress+  "/MarketingAccount/ViewMarketingAccount?id="+oMarketingAccount.MarketingAccountID+"&ts="+tsv;
        });

        $("#btnGetMarketingAcccounts").click(function(){
            GetMarketingAcccounts();
        });
        function GetMarketingAcccounts()
        {
            var oMarketingAccount= $('#tblMarketingHeads').datagrid('getSelected');
            //if(oMarketingAccount==null || oMarketingAccount.MarketingAccountID<=0)
            //{
            //    alert("Please select a item from list!");
            //    return;
            //}

            var nBUID= sessionStorage.getItem('BUID')
            var oMarketingAccount = {
                Name: "",
                MarketingAccountID: oMarketingAccount.MarketingAccountID,
                BUID: nBUID
            };

            $.ajax
                ({
                    type: "POST",
                    dataType: "json",
                    url : _sBaseAddress+  "/MarketingAccount/GetsMarketingAccountByID",
                    traditional: true,
                    data:  JSON.stringify(oMarketingAccount),
                    contentType: "application/json; charset=utf-8",
                    success: function (data) {
                        var oMarketingAccounts = jQuery.parseJSON(data);
                        if (oMarketingAccounts.length>0)
                        {
                            DynamicRefreshList(oMarketingAccounts, "tblMarketingAccounts");
                            //$('#tblMarketingAccounts').datagrid('hideColumn', 'GroupName');
                            //$('#tblMarketingAccounts').datagrid('hideColumn', 'Email');
                            //$('#tblMarketingAccounts').datagrid('hideColumn', 'Phone');
                        }
                        else
                        {
                            alert("Data not found");
                        }
                    },
                    error: function (xhr, status, error)
                    {
                        alert(error);
                    }
                });
        }

        function SetGroup()
        {
            var nBUID= sessionStorage.getItem('BUID')
            var oMarketingAccount_BU = {
                Name: "",
                BUID:nBUID
            };

            $.ajax
                ({
                    type: "POST",
                    dataType: "json",
                    url : _sBaseAddress+  "/MarketingAccount/GetsGroup",
                    traditional: true,
                    data:  JSON.stringify(oMarketingAccount_BU),
                    contentType: "application/json; charset=utf-8",
                    success: function (data) {
                        var oMarketingAccounts = jQuery.parseJSON(data);
                        if (oMarketingAccounts.length>0)
                        {
                            DynamicRefreshList(oMarketingAccounts, "tblMarketingHeads");
                            //$('#tblMarketingAccounts').datagrid('hideColumn', 'GroupName');
                            //$('#tblMarketingAccounts').datagrid('hideColumn', 'Email');
                            //$('#tblMarketingAccounts').datagrid('hideColumn', 'Phone');
                        }
                        else
                        {
                            alert("Data not found");
                        }
                    },
                    error: function (xhr, status, error)
                    {
                        alert(error);
                    }
                });
        }

        $("#btnDelete").click(function(){
            var oMarketingAccount= $('#tblMarketingAccounts').datagrid('getSelected');
            if (!confirm("Confirm to Delete?")) return ;

            if(oMarketingAccount==null || oMarketingAccount.MarketingAccountID<=0)
            {
                alert("Invalid Field!!! please select a valid Field!");
                return false;
            }
            var SelectedRowIndex=$('#tblMarketingAccounts').datagrid('getRowIndex',oMarketingAccount);
            if (oMarketingAccount.MarketingAccountID > 0)
            {
                $.ajax
                ({
                    type: "POST",
                    dataType: "json",
                    url : _sBaseAddress+  "/MarketingAccount/Delete",
                    traditional: true,
                    data:  JSON.stringify(oMarketingAccount),
                    contentType: "application/json; charset=utf-8",
                    success: function (data) {
                        var feedbackmessage = jQuery.parseJSON(data);
                        if (feedbackmessage == "Deleted")
                        {
                            alert("Delete sucessfully");
                            $('#tblMarketingAccounts').datagrid('deleteRow',SelectedRowIndex);
                        }
                        else
                        {
                            alert(feedbackmessage);
                        }
                    },
                    error: function (xhr, status, error)
                    {
                        alert(error);
                    }
                });
            }
        });

        $("#btnDeleteG").click(function(){
            var oMarketingAccount= $('#tblMarketingHeads').datagrid('getSelected');
            if (!confirm("Confirm to Delete?")) return ;

            if(oMarketingAccount==null || oMarketingAccount.MarketingAccountID<=0)
            {
                alert("Invalid Field!!! please select a valid Field!");
                return false;
            }
            var SelectedRowIndex=$('#tblMarketingHeads').datagrid('getRowIndex',oMarketingAccount);
            if (oMarketingAccount.MarketingAccountID > 0)
            {
                $.ajax
                ({
                    type: "POST",
                    dataType: "json",
                    url : _sBaseAddress+  "/MarketingAccount/Delete",
                    traditional: true,
                    data:  JSON.stringify(oMarketingAccount),
                    contentType: "application/json; charset=utf-8",
                    success: function (data) {
                        var feedbackmessage = jQuery.parseJSON(data);
                        if (feedbackmessage == "Deleted")
                        {
                            alert("Delete sucessfully");
                            $('#tblMarketingHeads').datagrid('deleteRow',SelectedRowIndex);
                        }
                        else
                        {
                            alert(feedbackmessage);
                        }
                    },
                    error: function (xhr, status, error)
                    {
                        alert(error);
                    }
                });
            }
        });

        function RefreshControlLayout()
        {
            var nBUID = parseInt(sessionStorage.getItem("BUID"));
            if(nBUID>0)
            {
                document.getElementById('btnAdd').style.display = 'none';
                document.getElementById('btnEdit').style.display = 'none';
                document.getElementById('btnView').style.display = '';
                document.getElementById('btnDelete').style.display = 'none';
                document.getElementById('btnContactPersonal').style.display = 'none';
                document.getElementById('btnPrintList').style.display = 'none';
                document.getElementById('btnActiveInActive').style.display = 'none';
                document.getElementById('btnImport').style.display = 'none';
                document.getElementById('btnIssueFigure').style.display = 'none';
                document.getElementById('btnConPaymentSetup').style.display = 'none';
                document.getElementById('btnExcelTest').style.display = 'none';
            }

            //document.getElementById('btnAdd').style.display = 'none';
            //document.getElementById('btnEdit').style.display = 'none';
            //document.getElementById('btnView').style.display = 'none';
            //document.getElementById('btnDelete').style.display = 'none';
            //document.getElementById('btnContactPersonal').style.display = 'none';
            //document.getElementById('btnPrintList').style.display = 'none';
            //document.getElementById('btnActiveInActive').style.display = 'none';

            //if(HavePermission('Add','MarketingAccount')){document.getElementById('btnAdd').style.display = '';}
            //if(HavePermission('Edit','MarketingAccount')){document.getElementById('btnEdit').style.display = '';}
            //if(HavePermission('View','MarketingAccount')){document.getElementById('btnView').style.display = '';}
            //if(HavePermission('Delete','MarketingAccount')){document.getElementById('btnDelete').style.display = '';}
            //if(HavePermission('Add','MarketingAccount')){document.getElementById('btnContactPersonal').style.display = '';}//if User has MarketingAccount add permission then he authrize for Buyer Contact Person Add
            //if(HavePermission('PrintList','MarketingAccount')){document.getElementById('btnPrintList').style.display = '';}
            //if(HavePermission('ActiveInActive','MarketingAccount')){document.getElementById('btnActiveInActive').style.display = '';}
        }

        function HavePermission(sOperationType, sDbObject)
        {
            var nSessionID =@Html.Raw( new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(HttpContext.Current.Session[SessionInfo.currentUserID]));
            if(nSessionID == -9) //check SuperUser
            {
                return true;
            }
            else
            {
                for(var i =0;i<_oAuthorizationRolesMapping.length;i++)
                {
                    if(_oAuthorizationRolesMapping[i].OperationTypeInString == sOperationType && _oAuthorizationRolesMapping[i].DBObjectName == sDbObject)
                        return  true;
                }
                return false;
            }
        }

        //Nazmul 24/09/2019
        $("#btnMktSaleTarget").click(function(){
            debugger;
            RefreshMktSalePerson();
            var oMktSaleTarget = $('#tblMarketingAccounts').datagrid('getSelected');

            if(oMktSaleTarget==null || oMktSaleTarget.MarketingAccountID<=0)
            {
                alert("Please select a item from list!");
                return;
            }
            $('MktPersonName').data('MktPersonName', oMktSaleTarget.Name+", Group Name"+oMktSaleTarget.GroupName);
            var oMktSaleTarget={
                MarketingAccountID : parseInt(oMktSaleTarget.MarketingAccountID)
            }
            $.ajax({
                type: "POST",
                dataType: "json",
                url :  _sBaseAddress+ "/MarketingAccount/GetAllMktSaleTarget",
                traditional: true,
                data:  JSON.stringify(oMktSaleTarget),
                contentType: "application/json; charset=utf-8",
                success: function (data)
                {
                    debugger;
                    _oMktSaleTarget = jQuery.parseJSON(data);
                    if (_oMktSaleTarget.length>0)
                    {
                        RefreshMktSalePerson();
                        DynamicRefreshList(_oMktSaleTarget,'tblMktSaleTarget');
                    }
                    else
                    {
                        DynamicRefreshList([],'tblMktSaleTarget');
                        //alert(_oMktSaleTarget.ErrorMessage);
                    }
                },
                error: function (xhr, status, error) {
                    alert(error);
                }
            });

            $("#winMktSaleTarget").icsWindow('open',"Add Mkt Sales Target");
        });

        $("#btnMktSaleTargetDelete").click(function(){
            debugger;
            var oMktSaleTarget = $('#tblMktSaleTarget').datagrid('getSelected');
            if(oMktSaleTarget==null || oMktSaleTarget.MktSaleTargetID<=0)
            {
                alert("Please select a item from list!");
                return;
            }
            var SelectedRowIndex=$('#tblMktSaleTarget').datagrid('getRowIndex',oMktSaleTarget);
            $.ajax({
                type: "GET",
                dataType: "json",
                url :  _sBaseAddress+ "/MarketingAccount/MktSaleTargetDelete",
                data: {id: oMktSaleTarget.MktSaleTargetID},
                contentType: "application/json; charset=utf-8",
                success: function (data)
                {
                    debugger;
                    feedbackmessage = jQuery.parseJSON(data);
                    if (feedbackmessage == "Deleted")
                    {
                        alert("Delete sucessfully");
                        $('#tblMktSaleTarget').datagrid('deleteRow',SelectedRowIndex);

                    }
                    else
                    {
                        alert(feedbackmessage);
                    }
                },
                error: function (xhr, status, error) {
                    alert(error);
                }
            });

        });

        $("#btnMktSaleTargetClose").click(function(){
            $("#winMktSaleTarget").icsWindow('close');
        })

        function RefreshMktSalePerson(){
            $('#txtDate').datebox('setValue',icsdateformat(new Date()));
            $("#cboOrderType").val(0);
            $("#txtValue").val('');
        }

        function ValidateInput()
        {
            debugger;
            if($("#cboOrderType").val() == 0)
            {
                alert("Please Select Order Type.");
                $("#cboOrderType").focus();
                return false;
            }
            if($.trim($("#txtValue").val()) == "")
            {
                alert("Please Type Value.");
                $("#txtValue").focus();
                return false;
            }
            if($.trim($("#txtOrderQty").val()) == "")
            {
                alert("Please Type Order Qty.");
                $("#txtOrderQty").focus();
                return false;
            }
            return true;
        }
        $('#btnAddMktSaleTarget').click(function(){
            debugger;
            var oMktSaleTarget = $('#tblMarketingAccounts').datagrid('getSelected');
            var oMktSaleTarget =
                {
                    MktSaleTargetID : 0,
                    MarketingAccountID: parseInt(oMktSaleTarget.MarketingAccountID),
                    OrderType : $("#cboOrderType option:selected").text(),
                    Date :  $('#txtDate').datebox('getValue'),
                    Value : parseFloat(TempRemoveComma($("#txtValue").val())),
                    OrderQty : parseFloat(TempRemoveComma($("#txtOrderQty").val())),
                    BuyerPosition : $('#txtNote').val(),
                }
            debugger;
            if(!ValidateInput()){return;}
            $.ajax({
                type: "POST",
                dataType: "json",
                url :  _sBaseAddress+ "/MarketingAccount/MktSaleTargetSave",
                traditional: true,
                data:  JSON.stringify(oMktSaleTarget),
                contentType: "application/json; charset=utf-8",
                success: function (data)
                {
                    debugger;
                    oMktSaleTarget = jQuery.parseJSON(data);
                    if (oMktSaleTarget.ErrorMessage=="" || oMktSaleTarget.ErrorMessage==null)
                    {
                        alert("Data Saved sucessfully");
                        RefreshMktSalePerson();
                        $('#tblMktSaleTarget').datagrid('appendRow',oMktSaleTarget);
                        var oData = $('#tblMktSaleTarget').datagrid('getRows');
                        $('#tblMktSaleTarget').datagrid('selectRow',oData.length-1);
                    }
                    else
                    {
                        alert(oFabricQCParName.ErrorMessage);
                    }
                },
                error: function (xhr, status, error) {
                    alert(error);
                }

            });

            //$('#tblMktSaleTarget').datagrid('appendRow',oMktSaleTarget);
            //var oMktSaleTargets = $('#tblMktSaleTarget').datagrid('getRows');
            //$('#tblMktSaleTarget').datagrid('selectRow', (oMktSaleTargets.length-1));
            //$("#txtValue").val("");
            //$("#cboOrderType").val(0);
            //$('#txtDate').datebox('setValue',icsdateformat(new Date()));

        });

        //REMOVE COMMA
        function TempRemoveComma(userInput) {
            //debugger;
            var amountInString = "";
            if (userInput === null || userInput === "") {
                amountInString = "0.00";
            }
            else {
                amountInString = "";
                for (var i = 0; i < userInput.length; i++) {
                    var char = userInput.charAt(i);
                    var charForCheck = char;
                    char = char.match(/\d+/g);
                    if (char != null) {
                        amountInString = amountInString + userInput.charAt(i);
                        count = 1;
                    }
                    else if (charForCheck == ",") {
                        continue;
                    }
                    else if (charForCheck == ".") {
                        amountInString = amountInString + userInput.charAt(i);
                    }
                }
            }
            //debugger;
            return (isNaN(parseFloat(amountInString)) ? parseFloat(0.00) : parseFloat(amountInString)).toFixed(3);
        }

        function TempAddComma(nStr) {
            nStr += '';
            x = nStr.split('.');
            x1 = x[0];
            x2 = x.length > 1 ? '.' + x[1] : '';
            var process = /(\d+)(\d{3})/;
            while (process.test(x1)) {
                x1 = x1.replace(process, '$1' + ',' + '$2');
            }
            return x1 + x2;
        }
    </script>
