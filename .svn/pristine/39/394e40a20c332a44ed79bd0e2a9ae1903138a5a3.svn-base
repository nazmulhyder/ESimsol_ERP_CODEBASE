@model IEnumerable<ESimSol.BusinessObjects.RouteSheetDCOut>
    @{
        ViewBag.Title = "Inventory Report(CHEMICAL & DYESTAFF ISSUE)";
    }
   
 <div id="progressbarParent" style="width:100%;height:100%;margin:0 auto;text-align:center; margin-left: auto;margin-right: auto;left: 0;right: 0;z-index: 1;">
    <div style="margin: 0px auto;margin-top: 251px;text-align:center;width:390px;">
        <label style="font-size:18px;">Please wait</label>
        <div id="progressbar" style="width:100%;height:37px;"></div>
    </div>
 </div>
 
 <div class="menuMainCollectionTable">
     <table id="tblRouteSheetDCOut" title="CHEMICAL & DYESTAFF REPORT" class="easyui-datagrid" style="width: 100%; height:100%; margin: 0;" showfooter="true" data-options="singleSelect: true,fitColumns:false, rownumbers:true, pagination:false, autoRowHeight:false, toolbar: '#toolbarRouteSheetDCOut' ">
         <thead>
             <tr>
                 @*<th field="DateTime" width="10%">Date</th>*@
                 @*<th field="RouteSheetNo" width="10%">Dye Lot No</th>*@
                 <th field="ProductCode" width="8%">Code</th>
                 <th field="ProductTypeSt" width="20%">Category</th>
                 <th field="ProductName" width="20%">Dyes/Chemical</th>
                 @*<th field="LotNo" width="15%">Lot No</th>*@

                 <th field="MUName" width="8%" align="right">Unit</th>
                 <th field="Qty" width="10%" align="right" formatter="formatPrice"> Qty</th>
                 <th field="QtyAdd" width="10%" align="right" formatter="formatPrice">Addition Qty</th>
                 <th field="QtyRet" width="10%" align="right" formatter="formatPrice">Return Qty</th>
                 <th field="Balance" width="10%" align="right" formatter="formatPrice">Total Qty</th>

                 @*QtyAdd, QtyRet, Balance*@

                 @*<th field="MUName" width="5%">Unit</th>
                    <th field="OperationUnitName" width="10%">Store Name</th>*@
             </tr>
         </thead>
     </table>
   
     <div id="toolbarRouteSheetDCOut">
         @*<input type="text" id="txtSearchByRSNo" placeholder="Search by Dye Line No " style="width:130px;text-align:left" />*@
         <select id="cboProductCategory" style="height:22px;"></select>
         <input id="txtStartDate" type="text" style="width: 100px;" class="easyui-datebox" required="required" data-options="formatter:icsdateformat,parser:icsdateparser" />
         <input id="txtStartTime" class="easyui-timespinner" style="width:60px;" required="required" />
         <input id="txtEndDate" type="text" style="width: 100px;" class="easyui-datebox" required="required" data-options="formatter:icsdateformat,parser:icsdateparser" />
         <input id="txtEndTime" class="easyui-timespinner" style="width:60px;" required="required" />
         <a id="btnSummarySearch" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-search" plain="true">Search</a>
         @*<a id="btnAdvSearch" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-search" plain="true">Adv. Search</a>*@
         <a id="btnPrint" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-print" plain="true">Print List</a>
         @*<a id="btnPrintXL" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-print" plain="true">ExportXL</a>*@
         <a id="btnPrint_V2" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-print" plain="true">Print (V2)</a>
         <a id="btnPrintXL_V2" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-print" plain="true">XL (V2)</a>
     </div>
 </div>

 <div id="winAdvSearch" class="easyui-window winClass" title="Adv. Search" data-options="modal:true,closed:true,collapsible:false,minimizable:false,maximizable:false,closable:false">
    <table style="width:500px;">
        <tr>
            <td style="width:100%;">
                <fieldset style="margin-bottom: 0px;">
                    <legend>Searching Criteria</legend>
                    <table style="width:100%;">
                        <tr>
                            <td style=" width:30%;text-align:right;">
                                <label>Product :</label>
                            </td>
                            <td colspan="3" style=" width:70%;text-align:left;">
                                <input id="txtProductName" style="width:75%;" type="text" placeholder="Type & Press Enter" />
                                <a id="btnProductPiker" href="javascript:void(0)" class="easyui-linkbutton ics-pick" iconcls="icon-pick" plain="true"></a>
                                <a id="btnClrProductPiker" href="javascript:void(0)" class="easyui-linkbutton ics-pick" iconcls="icon-clear" plain="true"></a>
                            </td>
                        </tr>
                        <tr>
                            <td style=" width:30%;text-align:right;">
                                <label>Store Name :</label>
                            </td>
                            <td style=" width:70%;text-align:left;">
                                <select id="cboWorkingUnits" style="width:100%">
                                    <option value="0">--select--</option>
                                </select>
                            </td>
                        </tr>
                        <tr>
                            <td style=" width:30%;text-align:right;">
                                <label>Shift :</label>
                            </td>
                            <td style=" width:70%;text-align:left;">
                                <select id="cboRSShifts" style="width:100%">
                                    <option value="0">--select--</option>
                                </select>
                            </td>
                        </tr>
                        @*<tr>
                            <td style=" width:30%;text-align:right;">
                                <label>Yarn Count</label>
                            </td>
                            <td colspan="3" style=" width:70%;text-align:left;">
                                <input id="txtProductName" style="width:75%;" type="text" placeholder="Type & Press Enter" />
                                <a id="btnProductPiker" href="javascript:void(0)" class="easyui-linkbutton ics-pick" iconcls="icon-pick" plain="true"></a>
                                <a id="btnClrProductPiker" href="javascript:void(0)" class="easyui-linkbutton ics-pick" iconcls="icon-clear" plain="true"></a>
                            </td>
                        </tr>*@
                        <tr>
                            <td style=" width:30%;text-align:right;">
                                <label>Batch/Dye Lot No :</label>
                            </td>
                            <td style=" width:70%;text-align:left;">
                                <input id="txtDyeLotNo" type="text" style="width:100%" />
                            </td>
                        </tr>
                        <tr>
                            <td style=" width:30%;text-align:right;">
                                <label>Date :</label>
                            </td>
                            <td style=" width:70%;text-align:left;">
                                <select id="cboDateSearch" style="width:100px" onchange=" DateActionsStatusDateAdvSearch()">
                                    <option value=" 0">--select--</option>
                                </select>
                                <input id="txtAdvStartDate" type="text" style="width: 100px;" class="easyui-datebox" required="required" data-options="formatter:icsdateformat,parser:icsdateparser" />
                                to
                                <input id="txtAdvEndDate" type="text" style="width: 100px;" class="easyui-datebox" required="required" data-options="formatter:icsdateformat,parser:icsdateparser" />
                            </td>
                        </tr>
                    </table>
                </fieldset>
            </td>
        </tr>
    </table>

    <fieldset class="actionfieldsetstyle">
        <legend>Actions : </legend>
        <label class="lblLoadingMessage" style="float: left;">Loading Please Wait...</label>
        <a id="btnResetAdvSearch" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-reload" plain="true">Reset</a>
        <a id="btnSearchAdvSearch" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-search" plain="true">Search</a>
        <a id="btnCloseAdvSearch" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-cancel" plain="true">Close</a>
    </fieldset>
</div>
  
 <style type="text/css">

    .lines-no .datagrid-body td 
    {
        border-right: 1px dotted transparent;
        border-bottom: 1px dotted transparent;
    }
 
</style>

 <script type="text/javascript">
    var _sBaseAddress="";
    var _oRouteSheetDCOut=null;
    var _oRouteSheetDCOuts=[];
    var _oCompanys=[];
    var _oCompareOperators=[];

    var _sControllerName="";
    var _nBUID = 0;
    var _oBU = null;
    var _sWorkingUnitIDs=[];
    var _sLotIds=[];
    var _sProductIds="";
    var oCompareOperator = [];
    var sStoreName = "";
    var sShift = "";
    var sDyeLotNo = "";
    var nDateSearch = 0;

    var dAdvStartDate = "";
    var dAdvEndDate = "";
    $(document).ready(function () {

        _sBaseAddress =@Html.Raw( new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(HttpContext.Current.Session[SessionInfo.BaseAddress]));
        _oRouteSheetDCOuts =@Html.Raw( new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(Model));

        oCompareOperator = @Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(ViewBag.CompareOperator));
        var oWorkingUnits = @Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(ViewBag.WorkingUnits));
        var oRSShifts = @Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(ViewBag.RSShifts));
        var oProductTypes = @Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(ViewBag.ProductTypes));

        $("#cboDateSearch").icsLoadCombo({
            List: oCompareOperator,
            OptionValue: "id",
            DisplayText: "Value"
        });
        $("#cboWorkingUnits").icsLoadCombo({
            List: oWorkingUnits,
            OptionValue: "WorkingUnitID",
            DisplayText: "OperationUnitName"
        });
        $("#cboRSShifts").icsLoadCombo({
            List: oRSShifts,
            OptionValue: "RSShiftID",
            DisplayText: "Name"
        });
        $("#cboProductCategory").icsLoadCombo({
            List: oProductTypes,
            OptionValue: "id",
            DisplayText: "Value"
        });
       $('#txtAdvStartDate').datebox('setValue', icsdateformat(new Date()));
       $('#txtAdvEndDate').datebox('setValue', icsdateformat(new Date()));
       dAdvStartDate = $('#txtAdvEndDate').val();
       dAdvEndDate = $('#txtAdvEndDate').val();
        debugger;
        $("#tblCurrentStatusAdvSearch").datagrid("checkAll");
        $("#progressbar").progressbar({ value: 0 });
        $("#progressbarParent").hide();
        $(".lblLoadingMessage").hide();
      //  LoadComboAdv();
        if (_oRouteSheetDCOuts.length > 0)
        {
            DynamicRefreshList(_oRouteSheetDCOuts, "tblRouteSheetDCOut");
        }
        else
        {
            DynamicRefreshList([], "tblRouteSheetDCOut");
        }


        var nCurrentDate = new Date();
        var nStartDate = new Date(nCurrentDate.getFullYear(), nCurrentDate.getMonth(), 1);
        var nEndDate = new Date(nCurrentDate.getFullYear(), nCurrentDate.getMonth()+1, 1);
        nEndDate = new Date(nEndDate.setDate( nEndDate.getDate() - 1))
        //$('#txtStartDate').datebox('setValue', icsdateformat(nStartDate));
        //$('#txtEndDate').datebox('setValue', icsdateformat(nEndDate));
        $('#txtEndDate').datebox('setValue', icsdateformat(nCurrentDate));
        nCurrentDate.setDate(nCurrentDate.getDate()-30);
        $('#txtStartDate').datebox('setValue', icsdateformat(nCurrentDate));
        //$('#txtStartTime,#txtEndTime').timespinner('setValue', "00:00");
        var nHour=new Date().getHours();
        var nMin=new Date().getMinutes();
        if(isNaN(nHour))
        {
            nHour=0;
        }
        if(isNaN(nMin))
        {
            nMin=0;
        }
        $('#txtStartTime').timespinner('setValue', nHour+":"+nMin);
        $('#txtEndTime').timespinner('setValue', nHour+":"+nMin);

        $('#txtAdvStartDate').datebox('setValue', icsdateformat(new Date()));
        $('#txtAdvEndDate').datebox('setValue', icsdateformat(new Date()));

        sessionStorage.setItem("ParamsLD", "");
        $.icsMakeFooterColumn('tblRouteSheetDCOut',['ProductCode','Qty','QtyAdd','QtyRet','Balance']);
    });

    $(document).keydown(function (e) { if (e.keyCode == 27) { $('div').icsWindow('close'); } });

    ////Start adv Searching

    function updateProgress() {
        var value =$('#progressbar').progressbar('getValue');
        if (value < 96){
            value += Math.floor(Math.random() * 10);
            $('#progressbar').progressbar('setValue', value);
        }
    }
    function hideShow(miliseconds) {
        $("#progressbarParent").hide();
    }
    //Account Of Picker


    function DateActionsStatusDateAdvSearch() {
        DynamicDateActions("cboDateSearch", "txtAdvStartDate", "txtAdvEndDate");
    }
    //Product Pick
    $("#txtProductName").keydown(function (e) {
        debugger;
        var code = (e.keyCode ? e.keyCode : e.which);
        if (code == 13) // Enter Press
        {
            if($('#txtProductName').val()==null || $('#txtProductName').val()=="")
            {
                alert("Please Type Product and Press Enter.");
                $('#txtProductName').focus();
                return;
            }
            PickProduct($('#txtProductName').val());
        }
        if (code == 8) //backspace=8
        {
            //debugger;
            $("#txtProductName").removeClass("fontColorOfPickItem");
            _sProductIds= [];
        }
    });
    $("#btnProductPiker").click(function () {
        PickProduct("");
    });
    $("#btnClrProductPiker").click(function () {
        $("#txtProductName").val('');
        $("#txtProductName").removeClass("fontColorOfPickItem");
        _sProductIds= [];
    });
    function PickProduct(sProductName)
    {
        var oProduct = { BUID:sessionStorage.getItem("BUID"),ProductName:sProductName};
        var obj = {
            BaseAddress: _sBaseAddress,
            Object: oProduct,
            ControllerName: "Product",
            ActionName: "SearchByProductBUWise",
            IsWinClose: false
        };
        $.icsDataGets(obj, function (response) {
            debugger;
            if (response.status && response.objs.length > 0) {
                if (response.objs[0].ProductID > 0) {
                    var tblColums = [];
                    var oColumn = { field: "ProductCode", title: "Code", width: 100, align: "left" }; tblColums.push(oColumn);
                    oColumn = { field: "ProductName", title: "Name", width: 300, align: "left" }; tblColums.push(oColumn);
                    oColumn = { field: "MUnit", title: "Unit", width: 70, align: "left" }; tblColums.push(oColumn);
                    var oPickerParam = {
                        winid: 'winProductPicker',
                        winclass: 'clsProductPicker',
                        winwidth: 600,
                        winheight: 460,
                        tableid: 'tblProductPicker',
                        tablecolumns: tblColums,
                        datalist: response.objs,
                        multiplereturn: true,
                        searchingbyfieldName: 'NameCode',
                        windowTittle: 'Product List'
                    };
                    $.icsPicker(oPickerParam);
                    IntializePickerbutton(oPickerParam);
                }
                else {
                    alert(response.objs[0].ErrorMessage);
                }

            }else{
                alert("Data Not Found.");
            }
        });
    }


    //End Buyer Search
    $("#btnResetAdvSearch").click(function () {
         _sProductIds='';
        _sProductBaseIDs='';
        $('#txtProductName').val("");
        $('#cboWorkingUnits').val(0);
        $('#cboRSShifts').val(0);
        $('#txtDyeLotNo').val("") ;
        $('#cboDateSearch').val(0);
        ResetAdvSearchWindow();
        DateActionsOrderDateAdvSearch();
        DateActionsInvoiceDateAdvSearch();
        DateActionsDeliveryDateAdvSearch();
        DateActionsStatusDateAdvSearch();
        $('#tblOrderStatus').datagrid('uncheckAll');
    });

    $("#btnSearchAdvSearch").click(function () {
        debugger;

        $(".lblLoadingMessage").show();
        var sProductName =  $.trim($("#txtSearchByProductName").val());
        var sProductBaseName ="";
        var sRSNo ="";
        var dFromOrderDate = $('#txtStartDate').datebox('getValue');
        var dToOrderDate = $('#txtStartDate').datebox('getValue');


        var sStoreName =  $('#cboWorkingUnits').val();
        var sShift =  $('#cboRSShifts').val();
        var sDyeLotNo =  $.trim($("#txtDyeLotNo").val());
        var nDateSearch =  $('#cboDateSearch').val();
         dAdvStartDate = $('#txtAdvStartDate').datebox('getValue');
         dAdvEndDate = $('#txtAdvEndDate').datebox('getValue');

        var sParams =
                       _sProductIds + "~" +
                       _sLotIds + "~" +
                       _sWorkingUnitIDs+"~"+
                       0 + "~" +
                       dFromOrderDate + "~" +
                       dToOrderDate + "~" +
                       sRSNo+"~"+

                       sStoreName+"~"+
                       sShift+"~"+
                       sDyeLotNo+"~"+
                       nDateSearch+"~"+
                       dAdvStartDate+"~"+
                       dAdvEndDate+"~"+

                       _nBUID;
        sessionStorage.setItem("ParamsLD", sParams);
        var oRouteSheetDCOut = {
            ErrorMessage : sParams
        };

        $.ajax({
            type: "POST",
            dataType: "json",
            url: _sBaseAddress + "/RouteSheetDCOut/AdvSearch",
            traditional: true,
            data: JSON.stringify(oRouteSheetDCOut),
            contentType: "application/json; charset=utf-8",
            success: function (data) {
                var oRouteSheetDCOuts = data;
                debugger;
                if (oRouteSheetDCOuts != null) {
                    if (oRouteSheetDCOuts.length > 0)
                    {

                        DynamicRefreshList(oRouteSheetDCOuts, "tblRouteSheetDCOut");
                        $('#btnResetAdvSearch').click();
                        $("#winAdvSearch").icsWindow("close");

                    }
                    else
                    {
                        alert("Sorry, No data found.");
                        DynamicRefreshList([], "tblRouteSheetDCOut");
                    }

                } else {
                    alert("Sorry, No data found.");
                    DynamicRefreshList([], "tblRouteSheetDCOut");
                }
                $(".lblLoadingMessage").hide();
            }
        });
    });

    $("#btnSummarySearch").click(function () {
        debugger;

        var dFromOrderDate = $('#txtStartDate').datebox('getValue');
        var dToOrderDate = $('#txtEndDate').datebox('getValue');

        var nhr=$('#txtStartTime').timespinner('getHours');
        var nmin=$('#txtStartTime').timespinner('getMinutes');
        var oStartDate=new Date(dFromOrderDate);
        oStartDate.setHours(oStartDate.getHours()+nhr);
        oStartDate.setMinutes(oStartDate.getMinutes()+nmin);
        oStartDate = icsdatetimeformat(oStartDate);

        nhr=$('#txtEndTime').timespinner('getHours');
        nmin=$('#txtEndTime').timespinner('getMinutes');
        var oEndDate=new Date(dToOrderDate);
        oEndDate.setHours(oEndDate.getHours()+nhr);
        oEndDate.setMinutes(oEndDate.getMinutes()+nmin);
        oEndDate = icsdatetimeformat(oEndDate);

        var nCategory=$('#cboProductCategory').val();

        if(new Date(oStartDate) > new Date(oEndDate) )
        {
            alert(" Start date can not be greater than end date!! "); return;
        }

        var sParams =  0 + "~" +
                       oStartDate + "~" +
                       oEndDate + "~" +
                       _nBUID+ "~" +
                       nCategory;
        var oRouteSheetDCOut = {
            ErrorMessage : sParams
        };
        $("#progressbar").progressbar({ value: 0 });
        $("#progressbarParent").show();
        var intervalID = setInterval(updateProgress, 250);

        $.ajax({
            type: "POST",
            dataType: "json",
            url: _sBaseAddress + "/RouteSheetDCOut/AdvSearch_Summary",
            traditional: true,
            data: JSON.stringify(oRouteSheetDCOut),
            contentType: "application/json; charset=utf-8",
            success: function (data) {
                var oRouteSheetDCOuts = data;
                clearInterval(intervalID);
                $("#progressbar").progressbar({ value: 0 });//hide
                $("#progressbarParent").hide();
                debugger;
                if (oRouteSheetDCOuts != null) {
                    if (oRouteSheetDCOuts.length > 0 && oRouteSheetDCOuts[0].ErrorMessage==null)
                    {
                        DynamicRefreshList(oRouteSheetDCOuts, "tblRouteSheetDCOut");
                        $.icsMakeFooterColumn('tblRouteSheetDCOut',['ProductCode','Qty','QtyAdd','QtyRet','Balance']);
                    }
                    else
                    {
                        alert("Sorry, No data found.");
                        //DynamicRefreshList([], "tblRouteSheetDCOut");
                    }
                }
                else
                {
                    alert("Sorry, No data found.");
                    //DynamicRefreshList([], "tblRouteSheetDCOut");
                }
            }
        });
    });



    $("#txtSearchByRSNo").keydown(function (e) {
        var nkeyCode = e.keyCode || e.which;
        if(nkeyCode==13){

            _sProductIds='';
            _sLotIds='';
            _sWorkingUnitIDs='';
            debugger;
            var nCboOrderDate = 1;
            var dFromOrderDate = $('#txtStartDate').datebox('getValue');
            var dToOrderDate = $('#txtStartDate').datebox('getValue');
            var sRSNo = $('#txtSearchByRSNo').val();

            var sParams =
                           _sProductIds + "~" +
                           _sLotIds + "~" +
                           _sWorkingUnitIDs+"~"+
                           0 + "~" +
                           dFromOrderDate + "~" +
                           dToOrderDate + "~" +
                           sRSNo+"~"+

                           0+"~"+
                           0+"~"+
                           sDyeLotNo+"~"+
                           0+"~"+
                           dFromOrderDate+"~"+
                           dFromOrderDate+"~"+

                          _nBUID;
            sessionStorage.setItem("ParamsLD", sParams);
            var oLabDipReport = {
                ErrorMessage : sParams
            };
            Search(oLabDipReport);
        }
        else if(nkeyCode==8){
            $("#txtSearchByRSNo").val("");

        }
    });
    $("#btnSearchByDate").click(function () {
        //var nBuyerID = parseInt(_sDeliverToIDs);
        _sProductIds='';
        _sLotIds='';
        _sWorkingUnitIDs='';
        debugger;
        var nCboOrderDate = 1;
        var dFromOrderDate = $('#txtStartDate').datebox('getValue');
        var dToOrderDate = $('#txtStartDate').datebox('getValue');
        var sRSNo = "";

        var sParams =
                       _sProductIds + "~" +
                       _sLotIds + "~" +
                       _sWorkingUnitIDs+"~"+
                       nCboOrderDate + "~" +
                       dFromOrderDate + "~" +
                       dToOrderDate + "~" +
                       sRSNo+"~"+

                       0+"~"+
                       0+"~"+
                       sDyeLotNo+"~"+
                       0+"~"+
                       dFromOrderDate+"~"+
                       dToOrderDate+"~"+

                      _nBUID;
        sessionStorage.setItem("ParamsLD", sParams);
        var oLabDipReport = {
            ErrorMessage : sParams
        };
        Search(oLabDipReport);
    });
    function Search(oRouteSheetDCOut)
    {

        $.ajax({
            type: "POST",
            dataType: "json",
            url: _sBaseAddress + "/RouteSheetDCOut/AdvSearch",
            traditional: true,
            data: JSON.stringify(oRouteSheetDCOut),
            contentType: "application/json; charset=utf-8",
            success: function (data) {
                var oRouteSheetDCOuts = data;
                debugger;
                if (oRouteSheetDCOuts != null) {
                    if (oRouteSheetDCOuts.length > 0)
                    {
                        DynamicRefreshList(oRouteSheetDCOuts, "tblRouteSheetDCOut");
                        $("#winAdvSearch").icsWindow("close");
                    }
                    else
                    {
                        alert("Sorry, No data found.");
                        DynamicRefreshList([], "tblRouteSheetDCOut");
                    }

                } else {
                    alert("Sorry, No data found.");
                    DynamicRefreshList([], "tblRouteSheetDCOut");
                }
                $(".lblLoadingMessage").hide();
            }
        });
    }
    function LoadComboAdv()
    {
        DynamicRefreshList(_oLabdipStatus, 'tblOrderStatus');

        $("#cboOrderDateAdvS, #cboSeekingDateAdvSearch, #cboStatusDateAdvS").icsLoadCombo({
            List: _oCompareOperators,
            OptionValue: "id",
            DisplayText: "Value"
        });
        $("#cboMkPersonAdvSearch").icsLoadCombo({
            List: _oMktPersons,
            OptionValue: "MarketingAccountID",
            DisplayText: "Name"
        });
    }
    function CheckFromAndToDateValidation(OperationComboId, FromDateId, ToDateId) {
        $("#" + OperationComboId).parent().parent().parent().find("select").removeClass("errorFieldBorder");
        var nCboVal = $("#" + OperationComboId).val();
        if (parseInt(nCboVal) == 5 || parseInt(nCboVal) == 6) {
            var fromDate = $("#" + FromDateId).datebox("getValue");
            var toDate = $("#" + ToDateId).datebox("getValue");
            if (new Date(fromDate) > new Date(toDate)) {
                $("#" + ToDateId).focus();
                $("#" + OperationComboId).addClass("errorFieldBorder");
                $(".lblLoadingMessage").hide();
                return false;
            } else {
                $("#" + OperationComboId).removeClass("errorFieldBorder");
                return true;
            }
        } else {
            return true;
        }
    }

    function ResetAdvSearchWindow() {
        _sProductBaseIDs = '';
        _sDeliverToIDs = "";
        $("#winAdvSearch input").not("input[type='button']").val("");
        $("#winAdvSearch input").removeClass("fontColorOfPickItem");
        $("#winAdvSearch select").val(0);
        DateActionsOrderDateAdvSearch();
        DateActionsInvoiceDateAdvSearch();
        DateActionsDeliveryDateAdvSearch();
        $("#txtFromOrderDateAdvSearch,#txtToOrderDateAdvSearch,#txtFromSeekingDate,#txtToSeekingDate,#txtFromStatusDate,#txtToStatusDate").datebox({ disabled: true });
        $("#txtFromOrderDateAdvSearch,#txtToOrderDateAdvSearch,#txtFromSeekingDate,#txtToSeekingDate,#txtFromStatusDate,#txtToStatusDate").datebox("setValue", icsdateformat(new Date()));
    }

    function PickContractors_AdvS() {
        var oContractor = {
            Params: '2,3' + '~' + $.trim($("#txtContractorAdvS").val()+"~"+_nBUID)
        };
        var obj = {
            BaseAddress: _sBaseAddress,
            Object: oContractor,
            ControllerName: "Contractor",
            ActionName: "ContractorSearchByNameType",
            IsWinClose: false
        };

        $("#progressbar").progressbar({ value: 0 });
        $("#progressbarParent").show();
        var intervalID = setInterval(updateProgress, 250);

        DynamicRefreshList([], "tblAccountsPickerAdvSearch");
        $.icsDataGets(obj, function (response) {
            clearInterval(intervalID);
            $("#progressbarParent").hide();
            if (response.status && response.objs.length > 0) {
                if (response.objs[0].ContractorID > 0) {
                    var tblColums = []; var oColumn = { field: "ContractorID", title: "Code", width: 50, align: "left" }; tblColums.push(oColumn);
                    oColumn = { field: "Name", title: "Name", width: 280, align: "left" }; tblColums.push(oColumn);

                    var oPickerParam = {
                        winid: 'winContractorPicker',
                        winclass: 'clsAccountOf',
                        winwidth: 400,
                        winheight: 460,
                        tableid: 'tblAccountOfs',
                        tablecolumns: tblColums,
                        datalist: response.objs,
                        multiplereturn: true,
                        searchingbyfieldName: 'Name',
                        windowTittle: 'Contactor List'
                    };
                    $.icsPicker(oPickerParam);
                    IntializePickerbutton(oPickerParam);
                }
                else {
                    alert(response.objs[0].ErrorMessage);
                }
            }
            else {
                alert("Sorry, No Contactor Found.");
            }
        });
    }

    function PickDeliverTo_AdvS() {
        var oContractor = {
            Params: '2' + '~' + $.trim($("#txtDeliverToAdvS").val()+"~"+_nBUID)
        };
        var obj = {
            BaseAddress: _sBaseAddress,
            Object: oContractor,
            ControllerName: "Contractor",
            ActionName: "ContractorSearchByNameType",
            IsWinClose: false
        };
        $("#progressbar").progressbar({ value: 0 });
        $("#progressbarParent").show();
        var intervalID = setInterval(updateProgress, 250);
        DynamicRefreshList([], "tblContractorsPickerAdvSearch");
        $.icsDataGets(obj, function (response) {
            clearInterval(intervalID);
            $("#progressbarParent").hide();
            if (response.status && response.objs.length > 0) {
                if (response.objs[0].ContractorID > 0) {
                    var tblColums = []; var oColumn = { field: "ContractorID", title: "Code", width: 50, align: "left" }; tblColums.push(oColumn);
                    oColumn = { field: "Name", title: "Name", width: 280, align: "left" }; tblColums.push(oColumn);
                    var oPickerParam = {
                        winid: 'winBuyers',
                        winclass: 'clsBuyer',
                        winwidth: 400,
                        winheight: 460,
                        tableid: 'tblBuyers',
                        tablecolumns: tblColums,
                        datalist: response.objs,
                        multiplereturn: true,
                        searchingbyfieldName: 'Name',
                        windowTittle: 'Buyer List'
                    };
                    $.icsPicker(oPickerParam);
                    IntializePickerbutton(oPickerParam);
                }
                else {
                    alert(response.objs[0].ErrorMessage);
                }
            }
            else {
                alert("Sorry, No Contactor Found.");
            }
        });
    }

    function DateActionsOrderDateAdvSearch() {
        DynamicDateActions("cboOrderDateAdvS", "txtFromOrderDateAdvSearch", "txtToOrderDateAdvSearch");
    }
    function DateActionsInvoiceDateAdvSearch() {
        DynamicDateActions("cboSeekingDateAdvSearch", "txtFromSeekingDate", "txtToSeekingDate");
    }
    function DateActionsDeliveryDateAdvSearch() {
        DynamicDateActions("cboStatusDateAdvS", "txtFromStatusDate", "txtToStatusDate");
    }

    $("#btnCloseAdvSearch").click(function () {
        _sProductIds='';
        _sProductBaseIDs='';
        $('#txtProductName').val("");
        $('#cboWorkingUnits').val(0);
        $('#cboRSShifts').val(0);
        $('#txtDyeLotNo').val("") ;
        $('#cboDateSearch').val(0);
        $('#txtAdvStartDate').datebox('setValue', icsdateformat(new Date()));
        $('#txtAdvEndDate').datebox('setValue', icsdateformat(new Date()));
        $("#winAdvSearch").icsWindow("close");
    });
    $("#btnAdvSearch").click(function () {
        debugger;
        $("#winAdvSearch").icsWindow("open", "Sample Order Advance Search");
        //DynamicRefreshList([], "tblExportPIAdvSearch");
        $('#txtAdvStartDate').datebox('setValue', icsdateformat(new Date()));
        $('#txtAdvEndDate').datebox('setValue', icsdateformat(new Date()));
        DynamicDateActions("cboDateOptionAdvSearch", "txtFromDateAdvSearch", "txtToDateAdvSearch");
        DynamicDateActions("cboSeekingDateAdvSearch", "txtFromSeekingDate", "txtToSeekingDate");
        DynamicDateActions("cboStatusDateAdvS", "txtFromStatusDate", "txtToStatusDate");
    });

    function IntializePickerbutton(oPickerobj) {
        $("#" + oPickerobj.winid).find("#btnOk").click(function () {
            SetPickerValueAssign(oPickerobj);
        });
        $(document).find('.' + oPickerobj.winclass).keydown(function (e) {
            if (e.which === 13) {
                SetPickerValueAssign(oPickerobj);
            }
        });
    }

    function SetPickerValueAssign(oPickerobj) {
        var oreturnObj = null, oreturnObjs = [];
        if (oPickerobj.multiplereturn) {
            oreturnObjs = $('#' + oPickerobj.tableid).datagrid('getChecked');
        } else {
            oreturnObj = $('#' + oPickerobj.tableid).datagrid('getSelected');
        }

        if (oPickerobj.winid == 'winContractorPicker')
        {
            if (oreturnObjs != null && oreturnObjs.length> 0)
            {

                _sProductBaseIDs=''; var sMessage='';
                sMessage=(oreturnObjs.length>1)? oreturnObjs.length +" Contractors Selected" : oreturnObjs[0].Name;
                $('#txtContractorAdvS').val(sMessage);
                $("#txtContractorAdvS").addClass("fontColorOfPickItem");

                for(var i=0;i<oreturnObjs.length;i++){
                    _sProductBaseIDs=_sProductBaseIDs+oreturnObjs[i].ContractorID+',';
                }
                _sProductBaseIDs=_sProductBaseIDs.substring(0,_sProductBaseIDs.length-1);

            }
            else
            {
                alert("Please select a contractor.");
                return false;
            }
        }

        else if (oPickerobj.winid == 'winBuyers') {
            if (oreturnObjs != null && oreturnObjs.length> 0)
            {
                _sDeliverToIDs='';
                var sMessage='';
                sMessage=(oreturnObjs.length>1)? oreturnObjs.length +" Contractors Selected" : oreturnObjs[0].Name;
                $('#txtDeliverToAdvS').val(sMessage);
                $("#txtDeliverToAdvS").addClass("fontColorOfPickItem");

                for(var i=0;i<oreturnObjs.length;i++){
                    _sDeliverToIDs=_sDeliverToIDs+oreturnObjs[i].ContractorID+',';
                }
                _sDeliverToIDs=_sDeliverToIDs.substring(0,_sDeliverToIDs.length-1);



            }
            else
            {
                alert("Please select a buyer.");
                return false;
            }
        }
        else if (oPickerobj.winid == 'winProductPicker')
        {
            if (oreturnObjs!= null && oreturnObjs.length> 0)
            {
                _sProductIds=''; var sMessage='';
                sMessage=(oreturnObjs.length>1)? oreturnObjs.length +" ProductName Selected" : oreturnObjs[0].ProductName;
                $('#txtProductName').val(sMessage);
                $("#txtProductName").addClass("fontColorOfPickItem");

                for(var i=0;i<oreturnObjs.length;i++){
                    _sProductIds=_sProductIds+oreturnObjs[i].ProductID+',';
                }
                _sProductIds=_sProductIds.substring(0,_sProductIds.length-1);

            }
            else
            {
                alert("Please select a Product.");
                return false;
            }

        }
        $("#" + oPickerobj.winid).icsWindow("close");
        $("#" + oPickerobj.winid).remove();
    }


     ///


     /// print

    //$('#btnPrint').click(function (e)
    //{
    //    var sParams=sessionStorage.getItem("ParamsLD");
    //    window.open(_sBaseAddress+ "/RouteSheetDCOut/Print_DCOut?sParams="+sParams, "_blank");

    //});


    $("#btnPrintXL").click(function ()
    {
        var oRSDCOut = $('#tblRouteSheetDCOut').datagrid('getSelected');
        if(oRSDCOut == null || oRSDCOut.ProductID<=0)
        {
            alert("Please select an item and try again!"); return;
        }

        var dFromOrderDate = $('#txtStartDate').datebox('getValue');
        var dToOrderDate = $('#txtEndDate').datebox('getValue');

        if(new Date(dFromOrderDate) > new Date(dToOrderDate) )
        {
            alert(" Start date can not be greater than end date!! "); return;
        }

        var sParams =  oRSDCOut.ProductID + "~" +
                       dFromOrderDate + "~" +
                       dToOrderDate + "~" +
                       _nBUID;
        window.open(_sBaseAddress + '/RouteSheetDCOut/PrintRpt_Excel_Summary?sTempString=' + sParams, "_blank");
    });

    $("#btnPrint").click(function ()
    {
        var dFromOrderDate = $('#txtStartDate').datebox('getValue');
        var dToOrderDate = $('#txtEndDate').datebox('getValue');

        var nhr=$('#txtStartTime').timespinner('getHours');
        var nmin=$('#txtStartTime').timespinner('getMinutes');
        var oStartDate=new Date(dFromOrderDate);
        oStartDate.setHours(oStartDate.getHours()+nhr);
        oStartDate.setMinutes(oStartDate.getMinutes()+nmin);
        oStartDate = icsdatetimeformat(oStartDate);

        nhr=$('#txtEndTime').timespinner('getHours');
        nmin=$('#txtEndTime').timespinner('getMinutes');
        var oEndDate=new Date(dToOrderDate);
        oEndDate.setHours(oEndDate.getHours()+nhr);
        oEndDate.setMinutes(oEndDate.getMinutes()+nmin);
        oEndDate = icsdatetimeformat(oEndDate);

        var nCategory=$('#cboProductCategory').val();

        if(new Date(oStartDate) > new Date(oEndDate) )
        {
            alert(" Start date can not be greater than end date!! "); return;
        }

        var sParams =  0 + "~" +
                       oStartDate + "~" +
                       oEndDate + "~" +
                       _nBUID+ "~" +
                       nCategory;

        window.open(_sBaseAddress + '/RouteSheetDCOut/Print_RSDC_Summary?sTempString=' + sParams, "_blank");
    });

    $("#btnPrint_V2").click(function ()
    {
        var oRSDCOut = $('#tblRouteSheetDCOut').datagrid('getSelected');
        if(oRSDCOut == null || oRSDCOut.ProductID<=0)
        {
            alert("Please select an item and try again!"); return;
        }
        var dFromOrderDate = $('#txtStartDate').datebox('getValue');
        var dToOrderDate = $('#txtEndDate').datebox('getValue');

        var nhr=$('#txtStartTime').timespinner('getHours');
        var nmin=$('#txtStartTime').timespinner('getMinutes');
        var oStartDate=new Date(dFromOrderDate);
        oStartDate.setHours(oStartDate.getHours()+nhr);
        oStartDate.setMinutes(oStartDate.getMinutes()+nmin);
        oStartDate = icsdatetimeformat(oStartDate);

        nhr=$('#txtEndTime').timespinner('getHours');
        nmin=$('#txtEndTime').timespinner('getMinutes');
        var oEndDate=new Date(dToOrderDate);
        oEndDate.setHours(oEndDate.getHours()+nhr);
        oEndDate.setMinutes(oEndDate.getMinutes()+nmin);
        oEndDate = icsdatetimeformat(oEndDate);

        if(new Date(oStartDate) > new Date(oEndDate) )
        {
            alert(" Start date can not be greater than end date!! ");
            return;
        }

        var sParams =  oRSDCOut.ProductID + "~" +
                       "" + "~" +
                       ""+"~"+
                       5 + "~" +
                       oStartDate + "~" +
                       oEndDate + "~" +
                       ""+"~"+

                       0+"~"+
                       0+"~"+
                       ""+"~"+
                       0+"~"+
                       dFromOrderDate+"~"+
                       dToOrderDate+"~"+
                       _nBUID+"~"+
                       0;

        window.open(_sBaseAddress+ "/RouteSheetDCOut/Print_DCOut?sParams="+sParams, "_blank");
    });

    $("#btnPrintXL_V2").click(function ()
    {
        var oRSDCOut = $('#tblRouteSheetDCOut').datagrid('getSelected');
        if(oRSDCOut == null || oRSDCOut.ProductID<=0)
        {
            alert("Please select an item and try again!"); return;
        }
        var dFromOrderDate = $('#txtStartDate').datebox('getValue');
        var dToOrderDate = $('#txtEndDate').datebox('getValue');

        var nhr=$('#txtStartTime').timespinner('getHours');
        var nmin=$('#txtStartTime').timespinner('getMinutes');
        var oStartDate=new Date(dFromOrderDate);
        oStartDate.setHours(oStartDate.getHours()+nhr);
        oStartDate.setMinutes(oStartDate.getMinutes()+nmin);
        oStartDate = icsdatetimeformat(oStartDate);

        nhr=$('#txtEndTime').timespinner('getHours');
        nmin=$('#txtEndTime').timespinner('getMinutes');
        var oEndDate=new Date(dToOrderDate);
        oEndDate.setHours(oEndDate.getHours()+nhr);
        oEndDate.setMinutes(oEndDate.getMinutes()+nmin);
        oEndDate = icsdatetimeformat(oEndDate);

        if(new Date(oStartDate) > new Date(oEndDate) )
        {
            alert(" Start date can not be greater than end date!! ");
            return;
        }

        var sParams =  oRSDCOut.ProductID + "~" +
                       "" + "~" +
                       ""+"~"+
                       5 + "~" +
                       oStartDate + "~" +
                       oEndDate + "~" +
                       ""+"~"+

                       0+"~"+
                       0+"~"+
                       ""+"~"+
                       0+"~"+
                       dFromOrderDate+"~"+
                       dToOrderDate+"~"+
                       _nBUID+"~"+
                       0;

        window.open(_sBaseAddress + '/RouteSheetDCOut/PrintRpt_Excel_V2?sTempString=' + sParams, "_blank");
    });


 </script>


