<html>
<body>
  
    @model ESimSol.BusinessObjects.ImportBL
    <div style="font-family: Tahoma;overflow: hidden;">
        <div class="heading" style="background:#CFB53B;text-align: center;color:#fff;height: 30px; border:0;width:100%;">
            <label id="lblHeaderName" style="line-height: 30px;font-size: 15px;font-weight: bold;text-decoration: underline;"></label>
        </div>
        <div style="font-size:12px;">
            <fieldset>
                <legend style="font-weight: bold"> Invoice Informations : </legend>
                <table border="0" cellspacing="3" cellpadding="3" style="width:100%;  font-size:11px; font-weight:bold">
                    <tr>
                        <td style="width:10%; text-align:right">
                            Invoice No :
                        </td>
                        <td style="width:15%; text-align:left">
                            <label id="lblInvoiceNo" />
                        </td>
                        <td style="width:10%; text-align:right">
                            Invoice Date :
                        </td>
                        <td style="width:15%; text-align:left">
                            <label id="lblInvoiceDate" />
                        </td>
                        <td style="width:10%; text-align:right">
                            L/C No :
                        </td>
                        <td style="width:15%; text-align:left">
                            <label id="lblLCNo" />
                        </td>
                        <td style="width:10%; text-align:right">
                            L/C Date :
                        </td>
                        <td style="width:15%; text-align:left">
                            <label id="lblLCDate" />
                        </td>
                    </tr>
                    <tr>
                        <td style="width:10%; text-align:right">
                            Supplier Name:
                        </td>
                        <td colspan="3" style="width:40%; text-align:left">
                            <label id="lblSupplierName" />
                        </td>
                        <td style="width:10%; text-align:right">
                            Bank Name :
                        </td>
                        <td colspan="3" style="width:40%; text-align:left">
                            <label id="lblBankName" />
                        </td>
                    </tr>


                    <tr>
                        <td style="width:10%; text-align:right">
                            Invoice Value :
                        </td>
                        <td style="width:15%; text-align:left">
                            <label id="lblInvoiceValue" />
                        </td>
                        <td style="width:10%; text-align:right">
                            L/C Value :
                        </td>
                        <td style="width:15%; text-align:left">
                            <label id="lblLCValue" />
                        </td>
                        <td style="width:10%; text-align:right">
                            PaymentType :
                        </td>
                        <td style="width:15%; text-align:left">
                            <label id="lblLCPaymentType" />
                        </td>
                        <td style="width:10%; text-align:right">
                            L/C Status :
                        </td>
                        <td style="width:15% ; text-align:left">
                            <label id="lblLCStatus" />
                        </td>

                    </tr>

                </table>
            </fieldset>
        </div>
        <div style="font-size:12px;">
            <fieldset id="ImportBL" >
                <legend> <span style=" font-weight:bold; color:gray; ">Import BL</span></legend>
                <table border="0" cellspacing="2" cellpadding="2" style="width: 100%;font-weight: bold; font-size: 12px">
                    <tr style="height:40px">
                        <td style="width:20%;text-align:right" >
                            <label style="margin: 4px 16px 0 91px;float:right;">BL No</label>
                        </td>
                        <td style="width:25%;text-align:left" >
                            <input type="text" style="float: left;width: 180px;" id="txtBlNo" />
                        </td>
                        <td style="width:20%;text-align:right" >
                            <div><span style="margin:4px 14px 0 88px;float:right"> BL Date </span></div>
                        </td>
                        <td style="width:25%;text-align:left" >
                            <input id="txtBlDate" type="text" class="easyui-datebox" required="required" data-options="formatter:icsdateformat,parser:icsdateparser" style="width: 180px;float:left" />
                        </td>

                    </tr>
                    <tr style="height:40px">
                        <td style="width:20%;text-align:right" >
                            <label style="margin: 4px 19px 0 41px;float:right;">Shipping Line</label>
                        </td>
                        <td style="width:25%;text-align:left" >
                            <select id="cboShippingLine" style="float: left;width: 180px;"></select>
                        </td>
                        <td style="width:20%;text-align:right">
                            <div><span style="padding-right:5px;margin: 4px 9px 0 79px;float:right;"> ETA Date </span></div>
                        </td>
                        <td style="width:25%;text-align:left" >
                            <div><input id="txtETADate" type="text" class="easyui-datebox" required="required" data-options="formatter:icsdateformat,parser:icsdateparser" style="width: 180px;float:left" /> </div>
                        </td>

                    </tr>

                    <tr style="height:40px">
                        <td style="width:20%;text-align:right" >
                            <label style="margin: 4px 19px 0 28px;float:right;">Port of Loading</label>
                        </td>
                        <td style="width:25%;text-align:left" >
                            <select id="cboPortOfLoading" style="float: left;width: 180px;"></select>
                        </td>
                        <td style="width:20%;text-align:right" >
                            <div><span style="padding-right:5px;margin: 4px 10px 0 69px;float:right;"> Issue Date </span></div>
                        </td>
                        <td style="width:25%;text-align:left" >
                            <div><input id="txtIssueDate" type="text" class="easyui-datebox" required="required" data-options="formatter:icsdateformat,parser:icsdateparser" style="width: 180px;float:left" /> </div>
                        </td>
                    </tr>

                    <tr style="height:40px">
                        <td style="width:20%;text-align:right" >
                            <label style="margin: 4px 19px 0 24px;float:right;">Destination Port</label>
                        </td>
                        <td style="width:25%;text-align:left" >
                            <select id="cboDestinationPort" style="float: left;width: 180px;"></select>
                        </td>
                        <td style="width:20%;text-align:right" >
                            <div><span style="padding-right:5px;margin: 4px 12px 0 40px;float:right;"> Shipment Date </span></div>
                        </td>
                        <td style="width:25%;text-align:left" >
                            <div><input id="txtShipmentDate" type="text" class="easyui-datebox" required="required" data-options="formatter:icsdateformat,parser:icsdateparser" style="width: 180px;float:left" /> </div>
                        </td>
                    </tr>
                    <tr style="height:40px">
                        <td style="width:20%;text-align:right">
                            <label style="margin: 4px 19px 0 34px;float:right;">Place Of Issues</label>
                        </td>
                        <td style="width:25%;text-align:left">
                            <select id="cboPlaceOfIssues" style="float: left;width: 180px;"></select>
                        </td>
                        <td style="width:20%;text-align:right" >
                            <label style="margin: 4px 16px 0 74px;float:right;">Container</label>
                        </td>
                        <td style="width:25%;text-align:left" >
                            <input type="text" id="txtContainer" style="float: left;width: 180px;" />
                        </td>
                    </tr>


                    <tr style="height:40px">
                        <td style="width:20%;text-align:right">
                            <label style="margin: 4px 19px 0 58px;">Vessel Info</label>
                        </td>
                        <td style="width:25%;text-align:left">
                            <input type="text" id="txtVesselInfo" style="width: 180px;" />
                        </td>
                        <td style="width:20%;text-align:right">
                            
                        </td>
                        <td style="width:25%">
                            
                        </td>
                    </tr>
                    <tr style="height:80px">
                        <td style="width:20%;text-align:right">
                            
                        </td>
                        <td style="width:25%;text-align:left">
                           
                        </td>
                        <td style="width:20%;text-align:right"></td>
                        <td style="width:25%"></td>
                    </tr>
                </table>
            </fieldset>
        </div>
        <fieldset id="Action">
            <legend style="font-weight: bold">Action : </legend>
            <table border="0" cellspacing="2" cellpadding="2" style=" width: 100%;font-weight: bold; font-size: 12px">
                <tr>
                    <td style="width: 80%; text-align: right"></td>
                    <td style="width:10%; font-size:13px">
                        <a id="btnSave" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-save" plain="true" onclick="Save()">Save</a>
                    </td>
                    <td style="width: 10%; font-size:13px">
                        <a id="btnClose" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-closed" plain="true" onclick="Close()">Close</a>
                    </td>
                </tr>
            </table>
        </fieldset>
    </div>
</body>
</html>
<script>
    var _sBaseAddress = "";
    var _obj = [];
    var _oImportBL = null;
    var _oRouteLocations = [];
    var _oShippingLines = [];
    var _oPortOfLoadings = [];
    var _oDestinationPorts = [];
    var _oPlaceOfIssues = [];
    var _oOtherLocations = [];
    var _oPIM = [];
    var _sBackLink="";
    $(document).ready(function () {
        _sBaseAddress = @Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(HttpContext.Current.Session[SessionInfo.BaseAddress]));
        _oImportBL = @Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(Model));
        _oRouteLocations = @Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(Model.RouteLocations));
        _oPIM=_oImportBL.PIM;

        LoadAllCbos();
        debugger;
        LoadImportBLInfos();
        RefreshLabel();
        _sBackLink=sessionStorage.getItem("BackLink");
    });

    function LoadAllCbos()
    {
        GetAllLocationLists(_oRouteLocations);
        LoadShippingLines(_oShippingLines);
        LoadPortOfLoadings(_oPortOfLoadings);
        LoadDestinationPorts(_oDestinationPorts);
        LoadPlaceOfIssues(_oPlaceOfIssues);
        //LoadOtherLocations(_oOtherLocations);
    }
    
    function RefreshLabel()
    {
        document.getElementById('lblInvoiceNo').innerHTML =_oPIM.ImportInvoiceNo;
        document.getElementById('lblLCNo').innerHTML  =_oPIM.ImportLCNo;
        document.getElementById('lblSupplierName').innerHTML  =_oPIM.ContractorName;
        document.getElementById('lblInvoiceDate').innerHTML = _oPIM.InvoiceDateInString;
        document.getElementById('lblLCDate').innerHTML = _oPIM.ImportLCDateInString;
        document.getElementById('lblBankName').innerHTML   =_oPIM.BankName_Nego;
        document.getElementById('lblInvoiceValue').innerHTML =_oPIM.AmountSt;
        document.getElementById('lblLCValue').innerHTML =_oPIM.AmountLCInSt;
        document.getElementById('lblLCPaymentType').innerHTML  =_oPIM.LCPaymentType;
        // document.getElementById('lblInvoiceStatus').innerHTML  =_oPIM.CurrentStatusInSt;
        document.getElementById('lblLCStatus').innerHTML  =_oPIM.LCCurrentStatusSt;
    }

    function  LoadAllDates()
    {
        var oCurrentDate = new Date();
        $('#txtBlDate').datebox('setValue', icsdateformat(oCurrentDate));
        $('#txtETADate').datebox('setValue', icsdateformat(oCurrentDate));
        $('#txtIssueDate').datebox('setValue', icsdateformat(oCurrentDate));
        $('#txtShipmentDate').datebox('setValue', icsdateformat(oCurrentDate));
    }
    function LoadImportBLInfos()
    {
       
        $("#lblInvoiceNo").text(_oPIM.ImportInvoiceNo);
        $("#lblInvoiceDate").text(_oPIM.InvoiceDateInString);
        $("#lblSupplierName").text(_oPIM.SupplierName);

        $("#txtBlNo").val(_oImportBL.BLNo);
        $("#txtContainer").val(_oImportBL.ContainerCount);
        $("#txtVesselInfo").val(_oImportBL.VesselInfo);

        LoadAllDates();
        $('#txtBlDate').datebox('setValue',_oImportBL.BLDateInString);
        $('#txtETADate').datebox('setValue',_oImportBL.ETAInString);
        $('#txtIssueDate').datebox('setValue',_oImportBL.IssueDateInString);
        $('#txtShipmentDate').datebox('setValue',_oImportBL.ShipmentDateInString);

        $("#cboShippingLine").val(_oImportBL.ShippingLine);
        $("#cboPortOfLoading").val(_oImportBL.LandingPort);
        $("#cboDestinationPort").val(_oImportBL.DestinationPort);
        $("#cboPlaceOfIssues").val(_oImportBL.PlaceOfIssue);
    }

    function RefreshObject() {

        var oImportBL = {
            ImportBLID          :           _oImportBL.ImportBLID,
            BLNo                :           $("#txtBlNo").val(),
            BLDate              :           new Date($('#txtBlDate').datebox('getValue')),
            ShippingLine        :           parseInt($("#cboShippingLine").val()),
            ETA                 :           new Date($('#txtETADate').datebox('getValue')),
            LandingPort         :           parseInt($("#cboPortOfLoading").val()),
            IssueDate           :           new Date($('#txtIssueDate').datebox('getValue')),
            DestinationPort     :           parseInt($("#cboDestinationPort").val()),
            ShipmentDate        :           new Date($('#txtShipmentDate').datebox('getValue')),
            PlaceOfIssue        :           parseInt($("#cboPlaceOfIssues").val()),
            ContainerCount      :           parseInt($("#txtContainer").val()),
            VesselInfo          :           $("#txtVesselInfo").val(),
            ImportInvoiceID     :           _oImportBL.ImportInvoiceID
        };
        return oImportBL;
    }

    function Save()
    {
        if($("#txtBlNo").val() == "")
        {
            alert("Please Give BL No");
            return false;
        }
        if($("#cboShippingLine").val() == "0")
        {
            alert("Please Select Shipping Line");
            return false;
        }
        if($("#cboPortOfLoading").val() == "0")
        {
            alert("Please Select Port Of Loading");
            return false;
        }
        if($("#cboDestinationPort").val() == "0")
        {
            alert("Please Select Destination Port");
            return false;
        }
        if($("#cboPlaceOfIssues").val() == "0")
        {
            alert("Please Select Place Of Issues");
            return false;
        }
        if($("#txtContainer").val() == "")
        {
            alert("Please Give Container.");
            return false;
        }
        debugger;
     

        var oImportBL = RefreshObject();

     

        if(oImportBL.ImportInvoiceID<=0)
        {
            alert("Invalid Invoice.");
            return false;
        }

    
        $.ajax({
            type: "POST",
            dataType: "json",
            url : _sBaseAddress+  "/ImportBL/Save",
            traditional: true,
            data:  JSON.stringify(oImportBL),
            contentType: "application/json; charset=utf-8",
            success: function (data) {
               var oImportBL = jQuery.parseJSON(data);
               if(oImportBL.ImportBLID>0){

                   _oImportBL=oImportBL;

                   alert("Data Saved successfully");
                   _oPIM.CurrentStatusInSt="ShipmentDone";
                   var oImportInvoices =sessionStorage.getItem("ImportInvoices");
                   var nIndex= parseInt(sessionStorage.getItem("SelectedRowIndexInvoice"));

                   if(oImportInvoices!=null)
                   {
                       oImportInvoices = jQuery.parseJSON(oImportInvoices);
                   }
                   else
                   {
                       oImportInvoices=[];
                   }
                   if(nIndex!=-1)
                   {
                       oImportInvoices[nIndex]=_oPIM;
                   }
                   else
                   {
                       sessionStorage.setItem("SelectedRowIndexInvoice", oImportInvoices.length);
                       oImportInvoices.push(oImportInvoices);
                   }
                   sessionStorage.setItem("ImportInvoices", JSON.stringify(oImportInvoices));
                 
                   window.location.href = _sBackLink;

                 
                }
                else{
                   alert(oImportBL.ErrorMessage);
                }
            },
            error: function (xhr, status, error) {
                alert(error);
            }
        });
    }

    function LoadShippingLines(oShippingLines)
    {
        var listItems="";
        listItems += "<option value=0>" +"--Select Route Location--" +"</option>";
        for (i = 0; i < oShippingLines.length; i++)
        {
            listItems += "<option value='" + oShippingLines[i].RouteLocationID+"'>" + oShippingLines[i].Name+"</option>";
        }
        $("#cboShippingLine").html(listItems);
    }

    function LoadPortOfLoadings(oPortOfLoadings)
    {
        var listItems="";
        listItems += "<option value=0>" +"--Select Route Location--" +"</option>";
        for (i = 0; i < oPortOfLoadings.length; i++)
        {
            listItems += "<option value='" + oPortOfLoadings[i].RouteLocationID+"'>" + oPortOfLoadings[i].Name+"</option>";
        }
        $("#cboPortOfLoading").html(listItems);
    }

    function LoadDestinationPorts(oDestinationPorts)
    {
        var listItems="";
        listItems += "<option value=0>" +"--Select Route Location--" +"</option>";
        for (i = 0; i < oDestinationPorts.length; i++)
        {
            listItems += "<option value='" + oDestinationPorts[i].RouteLocationID+"'>" + oDestinationPorts[i].Name+"</option>";
        }
        $("#cboDestinationPort").html(listItems);
    }

    function LoadPlaceOfIssues(oPlaceOfIssues)
    {
        var listItems="";
        listItems += "<option value=0>" +"--Select Route Location--" +"</option>";
        for (i = 0; i < oPlaceOfIssues.length; i++)
        {
            listItems += "<option value='" + oPlaceOfIssues[i].RouteLocationID+"'>" + oPlaceOfIssues[i].Name+"</option>";
        }
        $("#cboPlaceOfIssues").html(listItems);
    }

    function LoadOtherLocations(oOtherLocations)
    {
        var listItems="";
        listItems += "<option value=0>" +"--Select Route Location--" +"</option>";
        for (i = 0; i < oOtherLocations.length; i++)
        {
            listItems += "<option value='" + oOtherLocations[i].RouteLocationID+"'>" + oOtherLocations[i].Name+"</option>";
        }
        $("#cboLandingPort").html(listItems);
    }

    function GetAllLocationLists(oRouteLocations)
    {
        for(var i=0;i<oRouteLocations.length;i++)
        {
            if(oRouteLocations[i].LocationType == 1)
            {
                _oShippingLines.push(oRouteLocations[i]);
            }
            else if(oRouteLocations[i].LocationType == 2)
            {
                _oPortOfLoadings.push(oRouteLocations[i]);
            }
            else if(oRouteLocations[i].LocationType == 3)
            {
                _oDestinationPorts.push(oRouteLocations[i]);
            }
            else if(oRouteLocations[i].LocationType == 4)
            {
                _oPlaceOfIssues.push(oRouteLocations[i]);
            }
            else if(oRouteLocations[i].LocationType == 5)
            {
                _oOtherLocations.push(oRouteLocations[i]);
            }
        }
    }


    function Close()
    {
        window.location.href = _sBackLink;
    }

    $(document).keydown(function(e) {
        if(e.which == 27)//escape=27
        {
            window.location.href = _sBackLink
        }
    });

</script>

