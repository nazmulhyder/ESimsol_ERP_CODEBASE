@{
    ViewBag.Title = "Fabric Batch List";
}
@model ESimSol.BusinessObjects.FabricBatchQC
    <body>
        <div class="menuMainCollectionTable">
            <table id="tblFBPs" style="width:100%;height:100%" title="Fabric Batch QC Report" class="easyui-datagrid" fit="false" showfooter="true" fitcolumns="false" rownumbers="true" pagination="false" singleselect="true" autorowheight="false" toolbar="#toolbarFBs">
                <thead>
                    <tr>
                        <th field="LoomNo" width="10%">Loom No</th>
                        <th field="BatchNo" width="10%">Batch No</th>
                        <th field="DispoNo" width="10%">Dispo No</th>
                        <th field="BuyerName" width="15%" align="left">Customer</th>
                        <th field="Construction" width="15%" align="left">Construction</th>
                        <th field="ShiftName" width="10%" align="left">Shift</th>
                        <th field="DBServerDateTimeStr" width="12%">Issue Date</th>
                        <th field="ProDateStr" width="12%">Production Date</th>
                        <th field="DeliveryDateSt" width="12%">Delivery Date</th>
                        <th field="StoreRcvDateInString" width="12%">Receive Date</th>
                        <th field="Qty" width="10%" align="right">Quantity</th>
                        <th field="Remark" width="15%">Remarks</th>
                    </tr>
                </thead>
            </table>
            <div id="toolbarFBs">
                <table>
                    <tr>
                        <td>
                            <input type="text" id="txtSearchByLoomNo" style="width:100px;" maxlength="10" placeholder="Loom No" />
                            <input type="text" id="txtSearchDispoNo" style="width:100px;" placeholder="Dispo No" />
                            <a id="btnAdvSearch" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-search" plain="true">Adv. Search</a>
                            <a id="btnPrintExcel" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-excel" plain="true">Excel</a>
                            <a id="btnPrint" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-print" plain="true">Print</a>
                            <a id="btnGreigeReport" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-print" plain="true">Greige Report</a>
                        </td>
                    </tr>
                </table>
            </div>
        </div>

        <div id="winAdvSearch" class="easyui-window winClass" style=" width:630px;" title=" adv. search" data-options="modal:true,closed:true,collapsible:false,minimizable:false,maximizable:false,closable:false">
            <table style="width:100%;">
                <tr>
                    <td>
                        <fieldset style="margin-bottom: 0px;">
                            <legend>Searching Criteria</legend>
                            <table style="width:100%">
                                <tr>
                                    <td style=" width:20%;text-align:right;">
                                        <label>Issue Date : </label>
                                    </td>
                                    <td colspan="3" style=" width:80%;">
                                        <select id="cboIssueDate" style=" width:90px;height:22px;"></select>
                                        <input id="txtFromIssueDateAdvSearch" type="text" style="width: 95px;" class="easyui-datebox" required="required" data-options="formatter:icsdateformat,parser:icsdateparser" />
                                        <input id="txtIssueStartTime" class="easyui-timespinner" style="width:60px;" required="required" />To
                                        <input id="txtToIssueDateAdvSearch" type="text" style="width: 95px" class="easyui-datebox" required="required" data-options="formatter:icsdateformat,parser:icsdateparser" />
                                        <input id="txtIssueEndTime" class="easyui-timespinner" style="width:60px;" required="required" />
                                    </td>
                                </tr>
                                <tr>
                                    <td style=" width:20%;text-align:right;">
                                        <label>Production Date : </label>
                                    </td>
                                    <td colspan="3" style=" width:80%;">
                                        <span>
                                            <select id="cboProductionDate" style=" width:90px;height:22px;"></select>
                                            <input id="txtFromProDateAdvSearch" type="text" style="width: 95px;" class="easyui-datebox" required="required" data-options="formatter:icsdateformat,parser:icsdateparser" />
                                            <input id="txtProStartTime" class="easyui-timespinner" style="width:60px;" required="required" />To
                                            <input id="txtToProDateAdvSearch" type="text" style="width: 95px" class="easyui-datebox" required="required" data-options="formatter:icsdateformat,parser:icsdateparser" />
                                            <input id="txtProEndTime" class="easyui-timespinner" style="width:60px;" required="required" />
                                        </span>
                                    </td>
                                </tr>
                                <tr>
                                    <td style=" width:20%;text-align:right;">
                                        <label>Delivery Date : </label>
                                    </td>
                                    <td colspan="3" style=" width:80%;">
                                        <span>
                                            <select id="cboDeliveryDate" style=" width:90px;height:22px;"></select>
                                            <input id="txtFromDeliveryDateAdvSearch" type="text" style="width: 95px;" class="easyui-datebox" required="required" data-options="formatter:icsdateformat,parser:icsdateparser" />
                                            <input id="txtDeliveryStartTime" class="easyui-timespinner" style="width:60px;" required="required" />To
                                            <input id="txtToDeliveryDateAdvSearch" type="text" style="width: 95px" class="easyui-datebox" required="required" data-options="formatter:icsdateformat,parser:icsdateparser" />
                                            <input id="txtDeliveryEndTime" class="easyui-timespinner" style="width:60px;" required="required" />
                                        </span>
                                    </td>
                                </tr>
                                <tr>
                                    <td style=" width:20%;text-align:right;">
                                        <label>Store Rcv. Date : </label>
                                    </td>
                                    <td colspan="3" style=" width:80%;">
                                        <select id="cboStoreDate" style=" width:90px;height:22px;"></select>
                                        <input id="txtFromStoreDateAdvSearch" type="text" style="width: 95px;" class="easyui-datebox" required="required" data-options="formatter:icsdateformat,parser:icsdateparser" />
                                        <input id="txtStoreStartTime" class="easyui-timespinner" style="width:60px;" required="required" />To
                                        <input id="txtToStoreDateAdvSearch" type="text" style="width: 95px" class="easyui-datebox" required="required" data-options="formatter:icsdateformat,parser:icsdateparser" />
                                        <input id="txtStoreEndTime" class="easyui-timespinner" style="width:60px;" required="required" />
                                    </td>
                                </tr>
                                                            
                                <tr>
                                    <td style=" width:20%;text-align:right;">
                                        <label>Pick QC Grade: </label>
                                    </td>
                                    <td colspan="3" style=" width:80%;text-align:left;">
                                        <input id="txtQCGrade" style="width:75%;" type="text" placeholder="Type Status & Press Enter" />
                                        <a id="btnPickQCGrade" href="javascript:void(0)" class="easyui-linkbutton ics-pick" iconcls="icon-pick" plain="true"></a>
                                        <a id="btnClrPickQCGrade" href="javascript:void(0)" class="easyui-linkbutton ics-pick" iconcls="icon-clear" plain="true"></a>
                                    </td>
                                </tr>
                                <tr>
                                    <td style=" width:20%;text-align:right;">
                                        <label>Shift : </label>
                                    </td>
                                    <td colspan="3" style=" width:80%;text-align:left;">
                                        <select id="cboShift" style="width:90%"></select>                     
                                    </td>
                                </tr>
                                <tr>
                                    <td height="5px" colspan="4"></td>
                                </tr>
                            </table>
                        </fieldset>
                    </td>
                </tr>
            </table>

            <fieldset class="actionfieldsetstyle">
                <legend>Actions : </legend>
                <label class="lblLoadingMessage" style="float: left;">Loading Please Wait...</label>
                <a id="btnSearchAdvSearch" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-search" plain="true">Search</a>
                <a id="btnCloseAdvSearch" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-cancel" plain="true">Close</a>
            </fieldset>
        </div>

    </body>

    <script type="text/javascript">
    var _sBaseAddress = "";
    var _oFabricBatchProductions = [];
    var _nBUID=0;
    var _oFB=null;
    var _oFBStatus=[];
    var _oCompareOperators=[];
    var _oMachineTypes=[];
    var _oWeavingProcess = [];
    $(document).ready(function() {
        _sBaseAddress = @Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(HttpContext.Current.Session[SessionInfo.BaseAddress]));
        _oFabricBatchProductions = @Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(Model));
        var oShifts = @Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(@ViewBag.Shifts));
        _nBUID =@Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(ViewBag.BUID));
        _oCompareOperators = @Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(ViewBag.CompareOperators));
        _oMachineTypes = @Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(ViewBag.MachineTypes));
        _oFBStatus = @Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(ViewBag.FabricBatchStates));
        _oWeavingProcess = @Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(ViewBag.WeavingProcess));
        var oCompareOperators =@Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(ViewBag.CompareOperators)); 

        $("#cboProductionDate").icsLoadCombo({List:oCompareOperators,OptionValue: "id",DisplayText: "Value",});
        $("#cboDeliveryDate").icsLoadCombo({List:oCompareOperators,OptionValue: "id",DisplayText: "Value",});
        $("#cboStoreDate").icsLoadCombo({List:oCompareOperators,OptionValue: "id",DisplayText: "Value",});
        $("#cboIssueDate").icsLoadCombo({List:oCompareOperators,OptionValue: "id",DisplayText: "Value",});


        $("#cboShift").icsLoadCombo({List: oShifts,OptionValue: "ShiftID", DisplayText: "ShiftWithDuration"});
        $("#cboMachineTypes").icsLoadCombo({List:_oMachineTypes, OptionValue:"id", DisplayText:"Value",InitialValue:"Warping" });
        $("#cboWeavingPricess").icsLoadCombo({List:_oWeavingProcess, OptionValue:"id", DisplayText:"Value",InitialValue:"Warping" });
        $("#cboissuedateadvsearch").icsLoadCombo({List:_oCompareOperators,OptionValue: "id",DisplayText: "Value"});
       
        $('#txtFromProDateAdvSearch').datebox('setValue',icsdateformat(new Date()));
        $('#txtToProDateAdvSearch').datebox('setValue',icsdateformat(new Date()));

        $('#txtFromDeliveryDateAdvSearch').datebox('setValue',icsdateformat(new Date()));
        $('#txtToDeliveryDateAdvSearch').datebox('setValue',icsdateformat(new Date()));

        $('#txtFromStoreDateAdvSearch').datebox('setValue',icsdateformat(new Date()));
        $('#txtToStoreDateAdvSearch').datebox('setValue',icsdateformat(new Date()));

        $('#txtFromIssueDateAdvSearch').datebox('setValue',icsdateformat(new Date()));
        $('#txtToIssueDateAdvSearch').datebox('setValue',icsdateformat(new Date()));


        //$("#winAdvSearch").data('FabricBatchStates',_oFabricBatchStates);
        $('#txtProStartTime,#txtProEndTime').timespinner('setValue', "09:00");
        $('#txtDeliveryStartTime,#txtDeliveryEndTime').timespinner('setValue', "09:00");
        $('#txtStoreStartTime,#txtStoreEndTime').timespinner('setValue', "09:00");
        $('#txtIssueStartTime,#txtIssueEndTime').timespinner('setValue', "09:00");

        var oFabricBatchProductions =sessionStorage.getItem("FabricBatchProductions");
        if(oFabricBatchProductions!=null)
        {
            oFabricBatchProductions = jQuery.parseJSON(oFabricBatchProductions);
        }
        else
        {
            oFabricBatchProductions=_oFabricBatchProductions;
        }
        RefreshList(oFabricBatchProductions);
        //Adv search
        $(".lblLoadingMessage").hide();
        sessionStorage.setItem("ParamsSO", "");
    });

        //$('#cboProductionDate').change(function(e){
        //    debugger;
        //    //EqualTo = 1, NotEqualTo = 2, GreaterThen = 3, SmallerThen = 4, Between = 5, NotBetween = 6
        //    var nCompareOperator =   parseInt($('#cboProductionDate').val());
        //    if(nCompareOperator===0)
        //    {
        //        $('#txtFromProDateAdvSearch').datebox({ disabled : true });
        //        $('#txtToProDateAdvSearch').datebox({ disabled : true });
        //    }
        //    else if (nCompareOperator===1 || nCompareOperator===2 || nCompareOperator===3 || nCompareOperator===4)
        //    {
        //        $('#txtFromProDateAdvSearch').datebox({ disabled : false });
        //        $('#txtToProDateAdvSearch').datebox({ disabled : true });
        //    }
        //    else
        //    {
        //        $('#txtFromProDateAdvSearch').datebox({ disabled : false });
        //        $('#txtToProDateAdvSearch').datebox({ disabled : false });
        //    }
        //    $('#txtFromProDateAdvSearch').datebox('setValue', icsdateformat(new Date()));
        //    $('#txtToProDateAdvSearch').datebox('setValue', icsdateformat(new Date()));
        //});
        //$('#cboDeliveryDate').change(function(e){
        //    debugger;
        //    //EqualTo = 1, NotEqualTo = 2, GreaterThen = 3, SmallerThen = 4, Between = 5, NotBetween = 6
        //    var nCompareOperator =   parseInt($('#cboProductionDate').val());
        //    if(nCompareOperator===0)
        //    {
        //        $('#txtFromDeliveryDateAdvSearch').datebox({ disabled : true });
        //        $('#txtToDeliveryDateAdvSearch').datebox({ disabled : true });
        //    }
        //    else if (nCompareOperator===1 || nCompareOperator===2 || nCompareOperator===3 || nCompareOperator===4)
        //    {
        //        $('#txtFromDeliveryDateAdvSearch').datebox({ disabled : false });
        //        $('#txtToDeliveryDateAdvSearch').datebox({ disabled : true });
        //    }
        //    else
        //    {
        //        $('#txtFromDeliveryDateAdvSearch').datebox({ disabled : false });
        //        $('#txtToDeliveryDateAdvSearch').datebox({ disabled : false });
        //    }
        //    $('#txtFromDeliveryDateAdvSearch').datebox('setValue', icsdateformat(new Date()));
        //    $('#txtToDeliveryDateAdvSearch').datebox('setValue', icsdateformat(new Date()));
        //});
        //$('#cboStoreDate').change(function(e){
        //    debugger;
        //    //EqualTo = 1, NotEqualTo = 2, GreaterThen = 3, SmallerThen = 4, Between = 5, NotBetween = 6
        //    var nCompareOperator =   parseInt($('#cboProductionDate').val());
        //    if(nCompareOperator===0)
        //    {
        //        $('#txtFromStoreDateAdvSearch').datebox({ disabled : true });
        //        $('#txtToStoreDateAdvSearch').datebox({ disabled : true });
        //    }
        //    else if (nCompareOperator===1 || nCompareOperator===2 || nCompareOperator===3 || nCompareOperator===4)
        //    {
        //        $('#txtFromStoreDateAdvSearch').datebox({ disabled : false });
        //        $('#txtToStoreDateAdvSearch').datebox({ disabled : true });
        //    }
        //    else
        //    {
        //        $('#txtFromStoreDateAdvSearch').datebox({ disabled : false });
        //        $('#txtToStoreDateAdvSearch').datebox({ disabled : false });
        //    }
        //    $('#txtFromStoreDateAdvSearch').datebox('setValue', icsdateformat(new Date()));
        //    $('#txtToStoreDateAdvSearch').datebox('setValue', icsdateformat(new Date()));
        //});


        //QCGrade Picker
        $("#btnPickQCGrade").click(function () {
            debugger;
            GetQCGrade();

        });
        $("#btnClrPickQCGrade").click(function () {
            debugger;
            $('#txtQCGrade').data('FabricQCGradeID', '');
            $('#txtQCGrade').val("");

        });
        $("#txtQCGrade").keydown( function(e){
        debugger;        
        var code = (e.keyCode ? e.keyCode : e.which);
        if (code == 13) //enter
        {            
            GetQCGrade();
        }
        else if(code == 8) // backspace
        {
            $('#txtQCGrade').data('FabricQCGradeID', '');
        }
        
        });  
        function  GetQCGrade()
        {          
            var oGetQCGrade= {Name: $("#txtQCGrade").val()};
            var obj = {
                BaseAddress: _sBaseAddress,
                Object: oGetQCGrade,
                ControllerName: "FabricBatch",
                ActionName: "GetsQCGrades",
                IsWinClose: false
            };
            debugger;
            var tblColums = [];
            oColumn = { field: "Name", title: "Fabric QC Grade", width: 300, align: "left" }; tblColums.push(oColumn);
            var oPickerFabricQCGrade = {
                winid: 'winQCGrade',
                winclass: 'clsQCGrade',
                winwidth: 600,
                winheight: 460,
                tableid: 'tblQCGrade',
                tablecolumns: tblColums,
                multiplereturn: true,
                searchingbyfieldName: 'Name',
                windowTittle: 'QCGrade List',
                paramObj: obj,
                pkID: 'FabricQCGradeID',
                callBack: SetFabricQCGrades
            };
            $.icsDynamicPicker(oPickerFabricQCGrade);
        }
        function SetFabricQCGrades(oSelectedQCGrades)
        {
            debugger;
            if(oSelectedQCGrades!=null && oSelectedQCGrades.length>0)
            {
                var sQCGradeIDs = ICS_PropertyConcatation(oSelectedQCGrades, 'FabricQCGradeID');            
           
                $('#txtQCGrade').data('FabricQCGradeID', sQCGradeIDs);
                $('#txtQCGrade').val(oSelectedQCGrades.length+" Item(s) Selected.");
                $('#txtQCGrade').addClass('fontColorOfPickItem');
            }
            else
            {
                $('#txtQCGrade').val('');
                $('#txtQCGrade').data('FabricQCGradeID', '');
                $('#txtQCGrade').removeClass('fontColorOfPickItem');
            }        
        }


    $('#btnCloseAdvSearch').click(function(e) {
        $("#winAdvSearch").icsWindow('close');
    });

    function ValidateInput()
    {
        debugger;;
        var nOrderDate = parseInt($('#cboissuedateadvsearch').val());
        if (nOrderDate == 1 || nOrderDate == 2 || nOrderDate == 3 || nOrderDate == 4) {
            var sOrderStartDate = $('#txtFromIssueDateAdvSearch').datebox('getValue');
            if(sOrderStartDate==null || sOrderStartDate==undefined || sOrderStartDate =="")
            {
                alert("Please select Order Start Date!");
                $('#txtFromIssueDateAdvSearch').focus();
                return false;
            }
        }
        else if (nOrderDate == 5 || nOrderDate == 6)
        {
            var sOrderStartDate = $('#txtFromIssueDateAdvSearch').datebox('getValue');
            if(sOrderStartDate==null || sOrderStartDate==undefined || sOrderStartDate =="")
            {
                alert("Please select Order Start Date!");
                $('#txtFromIssueDateAdvSearch').focus();
                return false;
            }

            var sOrderEndDate = $('#txtToIssueDateAdvSearch').datebox('getValue');
            if(sOrderEndDate==null || sOrderEndDate == undefined || sOrderEndDate == "")
            {
                alert("Please select Order End Date!");
                $('#txtToIssueDateAdvSearch').focus();
                return false;
            }
            if((new Date(sOrderStartDate))>(new Date(sOrderEndDate)))
            {
                alert("Please Order End Date Must Be Grater Then Start Date!");
                $('#txtToIssueDateAdvSearch').focus();
                return false;
            }
        }

        return true;
    }

    function RefreshList(oFabricBatchProduction)
    {
        data=oFabricBatchProduction;
        data={"total":""+data.length+"","rows":data};
        $('#tblFBPs').datagrid('loadData',data);
        var nIndex= parseInt(sessionStorage.getItem("SelectedRowIndex"));
        $('#tblFBPs').datagrid('selectRow',nIndex);
    }

    $("#btnSearchFB").click(function () {
        SearchFB();
    });
 
    //Nazmul 28/08/2019
    $('#txtSearchByOrderNoFB').keydown(function (e)
    {
        debugger;
        var code = (e.keyCode ? e.keyCode : e.which);
        if (code== 13) {
            var SearchByOrderNoFB = $.trim($('#txtSearchByOrderNoFB').val());
            if(SearchByOrderNoFB!="")
            {
                var oFabricBatchProduction = {FEONo:SearchByOrderNoFB,BatchNo:''};
                SearchByDispoNO(oFabricBatchProduction);
            }else{
                alert("Type Dispo No and Press Enter.");
                return;
            }
        }
    });
    $('#txtSearchByBatchFB').keydown(function (e)
    {
        debugger;
        var code = (e.keyCode ? e.keyCode : e.which);
        if (code== 13) {
            var SearchByBatchNoFB = $.trim($('#txtSearchByBatchFB').val());
            if(SearchByBatchNoFB!="")
            {
                //debugger;
                var oFabricBatchProduction = {FEONo:'',BatchNo:SearchByBatchNoFB};
                SearchByDispoNO(oFabricBatchProduction);
            }else{
                alert("Type Batch No and Press Enter.");
                return;
            }
        }

    });

    function SearchByDispoNO(oFabricBatchProduction)
    {
        $.ajax
            ({
                type: "POST",
                dataType: "json",
                url : _sBaseAddress+"/FabricBatchProduction/SearchByDispoNO",
                traditional: true,
                data:  JSON.stringify(oFabricBatchProduction),
                contentType: "application/json; charset=utf-8",
                success: function (data) {
                    //debugger;
                    var oFabricBatchProductions = jQuery.parseJSON(data);
                    if (oFabricBatchProductions.length>0)
                    {
                        DynamicRefreshList(oFabricBatchProductions, 'tblFBPs');
                    }
                    else
                    {
                        alert("Data Not found");
                        DynamicRefreshList([], 'tblFBPs');
                    }
                },
                error: function (xhr, status, error)
                {
                    alert(error);
                }
            });
    }




    function ResetAdvSearchWindow(){
        //$("#txtFromIssueDateAdvSearch").datebox({ disabled: true });
        //$("#txtToIssueDateAdvSearch").datebox({ disabled: true });
        //$("#txtFromIssueDateAdvSearch").datebox("setValue", icsdateformat(new Date()));
        //$("#txtToIssueDateAdvSearch").datebox("setValue", icsdateformat(new Date()));
        //$("#cboissuedateadvsearch").val(0);

        //$("#txtStatusAdvSearch").val("");
        //$("#winAdvSearch").data("StatusIDs","");
        //$("#txtMachineAdvSearch").val("");
        //$("#winAdvSearch").data("MachineIDs","");
    }

    $("#btnAdvSearch").click(function () {
        debugger;
        ResetAdvSearchWindow();
        $("#winAdvSearch").icsWindow("open", " Advance Search");

    });

    function ValidateInput1()
    {
        var nOrderDate = parseInt($('#cboProductionDate').val());
        if (nOrderDate == 1 || nOrderDate == 2 || nOrderDate == 3 || nOrderDate == 4) {
            var sOrderStartDate = $('#txtFromProDateAdvSearch').datebox('getValue');
            if(sOrderStartDate==null || sOrderStartDate==undefined || sOrderStartDate =="")
            {
                alert("Please select Production Start Date!");
                $('#txtFromProDateAdvSearch').focus();
                return false;
            }
        }
        else if (nOrderDate == 5 || nOrderDate == 6)
        {
            var sOrderStartDate = $('#txtFromProDateAdvSearch').datebox('getValue');
            if(sOrderStartDate==null || sOrderStartDate==undefined || sOrderStartDate =="")
            {
                alert("Please select Production Start Date!");
                $('#txtFromProDateAdvSearch').focus();
                return false;
            }

            var sOrderEndDate = $('#txtToProDateAdvSearch').datebox('getValue');
            if(sOrderEndDate==null || sOrderEndDate == undefined || sOrderEndDate == "")
            {
                alert("Please select Production End Date!");
                $('#txtToProDateAdvSearch').focus();
                return false;
            }
            if((new Date(sOrderStartDate))>(new Date(sOrderEndDate)))
            {
                alert("Please Production End Date Must Be Grater Then Start Date!");
                $('#txtToProDateAdvSearch').focus();
                return false;
            }
        }     
       
        return true;
    }

    function ValidateInput2()
    {
        var nOrderDate = parseInt($('#cboDeliveryDate').val());
        if (nOrderDate == 1 || nOrderDate == 2 || nOrderDate == 3 || nOrderDate == 4) {
            var sOrderStartDate = $('#txtFromDeliveryDateAdvSearch').datebox('getValue');
            if(sOrderStartDate==null || sOrderStartDate==undefined || sOrderStartDate =="")
            {
                alert("Please select Delivery Start Date!");
                $('#txtFromDeliveryDateAdvSearch').focus();
                return false;
            }
        }
        else if (nOrderDate == 5 || nOrderDate == 6)
        {
            var sOrderStartDate = $('#txtFromDeliveryDateAdvSearch').datebox('getValue');
            if(sOrderStartDate==null || sOrderStartDate==undefined || sOrderStartDate =="")
            {
                alert("Please select Delivery Start Date!");
                $('#txtFromDeliveryDateAdvSearch').focus();
                return false;
            }

            var sOrderEndDate = $('#txtToDeliveryDateAdvSearch').datebox('getValue');
            if(sOrderEndDate==null || sOrderEndDate == undefined || sOrderEndDate == "")
            {
                alert("Please select Delivery End Date!");
                $('#txtToDeliveryDateAdvSearch').focus();
                return false;
            }
            if((new Date(sOrderStartDate))>(new Date(sOrderEndDate)))
            {
                alert("Please Delivery End Date Must Be Grater Then Start Date!");
                $('#txtToDeliveryDateAdvSearch').focus();
                return false;
            }
        }     
       
        return true;
    }

    function ValidateInput3()
    {
        var nOrderDate = parseInt($('#cboStoreDate').val());
        if (nOrderDate == 1 || nOrderDate == 2 || nOrderDate == 3 || nOrderDate == 4) {
            var sOrderStartDate = $('#txtFromStoreDateAdvSearch').datebox('getValue');
            if(sOrderStartDate==null || sOrderStartDate==undefined || sOrderStartDate =="")
            {
                alert("Please select Store Rcv Start Date!");
                $('#txtFromStoreDateAdvSearch').focus();
                return false;
            }
        }
        else if (nOrderDate == 5 || nOrderDate == 6)
        {
            var sOrderStartDate = $('#txtFromStoreDateAdvSearch').datebox('getValue');
            if(sOrderStartDate==null || sOrderStartDate==undefined || sOrderStartDate =="")
            {
                alert("Please select Store Rcv Start Date!");
                $('#txtFromStoreDateAdvSearch').focus();
                return false;
            }

            var sOrderEndDate = $('#txtToStoreDateAdvSearch').datebox('getValue');
            if(sOrderEndDate==null || sOrderEndDate == undefined || sOrderEndDate == "")
            {
                alert("Please select Store Rcv End Date!");
                $('#txtToStoreDateAdvSearch').focus();
                return false;
            }
            if((new Date(sOrderStartDate))>(new Date(sOrderEndDate)))
            {
                alert("Please Store Rcv End Date Must Be Grater Then Start Date!");
                $('#txtToStoreDateAdvSearch').focus();
                return false;
            }
        }     
       
        return true;
    }

    $("#btnSearchAdvSearch").click(function () {
        debugger;
        //if(!ValidateInput1()){ return; }  
        //if(!ValidateInput2()){ return; }  
        //if(!ValidateInput3()){ return; }  
        var nShift = parseInt($('#cboShift').val());       
        //var dOrderDateStart = $('#txtOrderDateStart').datebox('getValue');
        //var dOrderDateEnd = $('#txtOrderDateEnd').datebox('getValue');
        //start datetime start
      
        var nCboProductionDate = parseInt($("#cboProductionDate").val());
        var StartDate= $('#txtFromProDateAdvSearch').datebox('getValue');
        var nhr=$('#txtProStartTime').timespinner('getHours');
        var nmin=$('#txtProStartTime').timespinner('getMinutes');
        var oProStartDate=new Date(StartDate);            
        oProStartDate.setHours(oProStartDate.getHours()+nhr);
        oProStartDate.setMinutes(oProStartDate.getMinutes()+nmin);
        oProStartDate = icsdatetimeformat(oProStartDate);
           
        //end datetime start
        var EndDate= $('#txtToProDateAdvSearch').datebox('getValue');
        var nhr=$('#txtProEndTime').timespinner('getHours');
        var nmin=$('#txtProEndTime').timespinner('getMinutes');
        var oProEndDate=new Date(EndDate);
        oProEndDate.setHours(oProEndDate.getHours()+nhr);
        oProEndDate.setMinutes(oProEndDate.getMinutes()+nmin);
        oProEndDate = icsdatetimeformat(oProEndDate);

        //Delivery Date       
        var cboDeliveryDate = parseInt($("#cboDeliveryDate").val());
        //start datetime start
        var StartDate= $('#txtFromDeliveryDateAdvSearch').datebox('getValue');
        var nhr=$('#txtDeliveryStartTime').timespinner('getHours');
        var nmin=$('#txtDeliveryStartTime').timespinner('getMinutes');
        var oDeliveryStartDate=new Date(StartDate);            
        oDeliveryStartDate.setHours(oDeliveryStartDate.getHours()+nhr);
        oDeliveryStartDate.setMinutes(oDeliveryStartDate.getMinutes()+nmin);
        oDeliveryStartDate = icsdatetimeformat(oDeliveryStartDate);
           
        //end datetime start
        var EndDate= $('#txtToDeliveryDateAdvSearch').datebox('getValue');
        var nhr=$('#txtDeliveryEndTime').timespinner('getHours');
        var nmin=$('#txtDeliveryEndTime').timespinner('getMinutes');
        var oDeliveryEndDate=new Date(EndDate);
        oDeliveryEndDate.setHours(oDeliveryEndDate.getHours()+nhr);
        oDeliveryEndDate.setMinutes(oDeliveryEndDate.getMinutes()+nmin);
        oDeliveryEndDate = icsdatetimeformat(oDeliveryEndDate);

        //Store Date
        var cboStoreDate = parseInt($("#cboStoreDate").val());
        //start datetime start
        var StartDate= $('#txtFromStoreDateAdvSearch').datebox('getValue');
        var nhr=$('#txtStoreStartTime').timespinner('getHours');
        var nmin=$('#txtStoreStartTime').timespinner('getMinutes');
        var oStoreStartDate=new Date(StartDate);            
        oStoreStartDate.setHours(oStoreStartDate.getHours()+nhr);
        oStoreStartDate.setMinutes(oStoreStartDate.getMinutes()+nmin);
        oStoreStartDate = icsdatetimeformat(oStoreStartDate);
           
        //end datetime start
        var EndDate= $('#txtToStoreDateAdvSearch').datebox('getValue');
        var nhr=$('#txtStoreEndTime').timespinner('getHours');
        var nmin=$('#txtStoreEndTime').timespinner('getMinutes');
        var oStoreEndDate=new Date(EndDate);
        oStoreEndDate.setHours(oStoreEndDate.getHours()+nhr);
        oStoreEndDate.setMinutes(oStoreEndDate.getMinutes()+nmin);
        oStoreEndDate = icsdatetimeformat(oStoreEndDate);

        //Issue Date
        var cboIssueDate = parseInt($("#cboIssueDate").val());
        //start datetime start
        var StartDate= $('#txtFromIssueDateAdvSearch').datebox('getValue');
        var nhr=$('#txtIssueStartTime').timespinner('getHours');
        var nmin=$('#txtIssueStartTime').timespinner('getMinutes');
        var oIssueStartDate=new Date(StartDate);            
        oIssueStartDate.setHours(oIssueStartDate.getHours()+nhr);
        oIssueStartDate.setMinutes(oIssueStartDate.getMinutes()+nmin);
        oIssueStartDate = icsdatetimeformat(oIssueStartDate);
           
        //end datetime start
        var EndDate= $('#txtToIssueDateAdvSearch').datebox('getValue');
        var nhr=$('#txtIssueEndTime').timespinner('getHours');
        var nmin=$('#txtIssueEndTime').timespinner('getMinutes');
        var oIssueEndDate=new Date(EndDate);
        oIssueEndDate.setHours(oIssueEndDate.getHours()+nhr);
        oIssueEndDate.setMinutes(oIssueEndDate.getMinutes()+nmin);
        oIssueEndDate = icsdatetimeformat(oIssueEndDate);


        var sQCGrades = $('#txtQCGrade').data('FabricQCGradeID');
        

        var sSearchParam1  = '';
        sSearchParam1 = sSearchParam1 + nCboProductionDate + '~';
        sSearchParam1 = sSearchParam1 + oProStartDate + '~';
        sSearchParam1 = sSearchParam1 + oProEndDate ;

        var sSearchParam2  = '';
        sSearchParam2 = sSearchParam2 + cboDeliveryDate + '~';
        sSearchParam2 = sSearchParam2 + oDeliveryStartDate + '~';
        sSearchParam2 = sSearchParam2 + oDeliveryEndDate ;

        var sSearchParam3  = '';
        sSearchParam3 = sSearchParam3 + cboStoreDate + '~';
        sSearchParam3 = sSearchParam3 + oStoreStartDate + '~';
        sSearchParam3 = sSearchParam3 + oStoreEndDate ;

        var sSearchParam4  = '';
        sSearchParam4 = sSearchParam4 + cboIssueDate + '~';
        sSearchParam4 = sSearchParam4 + oIssueStartDate + '~';
        sSearchParam4 = sSearchParam4 + oIssueEndDate 

        if(sQCGrades == undefined){
            sQCGrades = "";
        }
        if(sQCGrades == "" && nCboProductionDate == 0 && cboDeliveryDate == 0 && cboStoreDate == 0 &&cboIssueDate==0){
            alert("Please Search at lest One Criteria!");return;
        }

        var oFabricBatchQCDetail = {                                          
            ErrorMessage :sQCGrades+"~"+sSearchParam1+"~"+sSearchParam2+"~"+sSearchParam3+"~"+sSearchParam4+"~"+nShift,
        }
        sessionStorage.setItem("ParamsSO", sQCGrades+"~"+sSearchParam1+"~"+sSearchParam2+"~"+sSearchParam3+"~"+sSearchParam4+"~"+nShift);
        debugger;
        $.ajax({
            type: "POST",
            dataType: "json",
            url: _sBaseAddress+ "/FabricBatch/SearchFabricBatchQCDetail",
            data:JSON.stringify(oFabricBatchQCDetail),
            contentType: "application/json; charset=utf-8",
            success: function (data)
            {
                debugger;
                var oRPCAs=[];
                oRPCAs = jQuery.parseJSON(data);
                if(oRPCAs.length>0 && oRPCAs[0].ErrorMessage=="")
                {
                    RefreshList(oRPCAs);
                    $("#winAdvSearch").icsWindow('close');                 
                    $.icsMakeFooterColumn('tblFBPs',['LoomNo','Qty']);
                }
                else
                {

                    RefreshList([]);
                    alert("Data not found");
                }
               
            },
        });
    });

    //End Adv search
    //pickers
    $("#btnClrStatusPikerAdvSearch").click(function () {

        $("#txtStatusAdvSearch").val("");
        $("#winAdvSearch").data("StatusIDs","-1");
    });
    $("#btnStatusPikerAdvSearch").click(function () {
        GetStatus();
    });
    $("#txtStatusAdvSearch").keydown(function (e) {
        var nkeyCode = e.keyCode || e.which;
        if(nkeyCode==13){
            GetStatus();
        }
        else if(nkeyCode==8){
            $("#txtStatusAdvSearch").val("");
            $("#winAdvSearch").data("StatusIDs","-1");
        }
    });
    function GetStatus(){
        debugger;
        if (_oFBStatus.length > 0) {
            //$("#winAdvSearch").data('FabricBatchStates'
            if (_oFBStatus[0].id > -1) {
                //debugger;
                var tblColums = [];
                oColumn = { field: "Value", title: "Status", width: 200, align: "left" };tblColums.push(oColumn);

                var oPickerParam = {
                    winid: 'winStatussPicker',
                    winclass:'clsStatussPicker',
                    winwidth: 480,
                    winheight: 460,
                    tableid: 'tblStatussPicker',
                    tablecolumns: tblColums,
                    datalist: _oFBStatus,
                    multiplereturn: true,
                    searchingbyfieldName:'Value',
                    windowTittle: 'Status List'
                };
                $.icsPicker(oPickerParam);
                IntializePickerbutton(oPickerParam);//multiplereturn, winclassName
            }
            else { alert("No Status found."); }
        }
        else{
            alert("No Status found.");
        }
    }
    //end pickers
    $('#btnPrintExcel').click(function(){
        debugger;
        debugger;
        var Values = $('#tblFBPs').datagrid('getRows');
        var cboIssueDate = parseInt($("#cboIssueDate").val());
        var issueStartDate= $('#txtFromIssueDateAdvSearch').datebox('getValue');
        var issueEndDate= $('#txtToIssueDateAdvSearch').datebox('getValue');
        //
        var nCboProductionDate = parseInt($("#cboProductionDate").val());
        var ProdStartDate= $('#txtFromProDateAdvSearch').datebox('getValue');
        var ProdEndDate= $('#txtToProDateAdvSearch').datebox('getValue');
        //
        var cboDeliveryDate = parseInt($("#cboDeliveryDate").val());
        var deliveryStartDate= $('#txtFromDeliveryDateAdvSearch').datebox('getValue');
        var deliveryEndDate= $('#txtToDeliveryDateAdvSearch').datebox('getValue');
        //
        var cboStoreDate = parseInt($("#cboStoreDate").val());
        var storeStartDate= $('#txtFromStoreDateAdvSearch').datebox('getValue');
        var storeEndDate= $('#txtToStoreDateAdvSearch').datebox('getValue');
        var Values = $('#tblFBPs').datagrid('getRows');
        var oFabricBatchProductions = {
            sSearchParams : cboIssueDate+'~'+issueStartDate+'~'+issueEndDate+'~'+nCboProductionDate+'~'+ProdStartDate+'~'+ProdEndDate+'~'+cboDeliveryDate+'~'+deliveryStartDate+'~'+deliveryEndDate+'~'+cboStoreDate+'~'+storeStartDate+'~'+storeEndDate,
            ErrorMessage : ICS_PropertyConcatation(Values, 'FBQCDetailID')
        };
        $.ajax({
            type: "POST",
            dataType: "json",
            url : _sBaseAddress+"/FabricBatch/SetSessionSearchCriterias",
            traditional: true,
            data:  JSON.stringify(oFabricBatchProductions),
            contentType: "application/json; charset=utf-8",
            success: function (data) {
                debugger;
                var sFeedBackMessage = jQuery.parseJSON(data);
                if (sFeedBackMessage==="Successful") {
                    window.open(_sBaseAddress+'/FabricBatch/FPBatchByWeavingProcessExcel');
                }
            },
            error: function (xhr, status, error) {
                alert(error);
            }
        });

    });

    $('#btnPrint').click(function(){
        debugger;
        var Values = $('#tblFBPs').datagrid('getRows');
        var cboIssueDate = parseInt($("#cboIssueDate").val());
        var issueStartDate= $('#txtFromIssueDateAdvSearch').datebox('getValue');
        var issueEndDate= $('#txtToIssueDateAdvSearch').datebox('getValue');
        //
        var nCboProductionDate = parseInt($("#cboProductionDate").val());
        var ProdStartDate= $('#txtFromProDateAdvSearch').datebox('getValue');
        var ProdEndDate= $('#txtToProDateAdvSearch').datebox('getValue');
        //
        var cboDeliveryDate = parseInt($("#cboDeliveryDate").val());
        var deliveryStartDate= $('#txtFromDeliveryDateAdvSearch').datebox('getValue');
        var deliveryEndDate= $('#txtToDeliveryDateAdvSearch').datebox('getValue');
        //
        var cboStoreDate = parseInt($("#cboStoreDate").val());
        var storeStartDate= $('#txtFromStoreDateAdvSearch').datebox('getValue');
        var storeEndDate= $('#txtToStoreDateAdvSearch').datebox('getValue');
       

        var oFabricBatchProductions = {
            sSearchParams : cboIssueDate+'~'+issueStartDate+'~'+issueEndDate+'~'+nCboProductionDate+'~'+ProdStartDate+'~'+ProdEndDate+'~'+cboDeliveryDate+'~'+deliveryStartDate+'~'+deliveryEndDate+'~'+cboStoreDate+'~'+storeStartDate+'~'+storeEndDate,
            ErrorMessage : ICS_PropertyConcatation(Values, 'FBQCDetailID')
        };
        $.ajax({
            type: "POST",
            dataType: "json",
            url : _sBaseAddress+"/FabricBatch/SetSessionSearchCriterias",
            traditional: true,
            data:  JSON.stringify(oFabricBatchProductions),
            contentType: "application/json; charset=utf-8",
            success: function (data) {
                debugger;
                var sFeedBackMessage = jQuery.parseJSON(data);
                if (sFeedBackMessage==="Successful") {
                    window.open(_sBaseAddress+'/FabricBatch/PrintLists');
                }
            },
            error: function (xhr, status, error) {
                alert(error);
            }
        });
    });
        
    $('#txtSearchByLoomNo').keydown(function (e)
    {
        var code = (e.keyCode ? e.keyCode : e.which);
        if (code== 13) {
            var txtLoomNo = $.trim($('#txtSearchByLoomNo').val());
            if(txtLoomNo!="")
            {
                var oLoomNo={LoomNo:txtLoomNo,DispoNo:''};
                SearchByLoomNoDispoNo(oLoomNo);
            }else{
                alert("Type Loom No and Press Enter.");
                return;
            }
        }

    });
    $('#txtSearchDispoNo').keydown(function (e)
    {
        var code = (e.keyCode ? e.keyCode : e.which);
        if (code== 13) {
            var txtDispoNo = $.trim($('#txtSearchDispoNo').val());
            if(txtDispoNo!="")
            {
                var oDispoNo={LoomNo:'',DispoNo:txtDispoNo};
                SearchByLoomNoDispoNo(oDispoNo);
            }else{
                alert("Type Dispo No and Press Enter.");
                return;
            }
        }

    });
    function SearchByLoomNoDispoNo(oData)
    {
        $.ajax
            ({
                type: "POST",
                dataType: "json",
                url : _sBaseAddress+"/FabricBatch/SearchByLoomNoDispoNo",
                traditional: true,
                data:  JSON.stringify(oData),
                contentType: "application/json; charset=utf-8",
                success: function (data) {
                    //debugger;
                    var oResults = jQuery.parseJSON(data);
                    if (oResults.length>0)
                    {
                        DynamicRefreshList(oResults, 'tblFBPs');
                    }
                    else
                    {
                        alert("Data Not found");
                        DynamicRefreshList([], 'tblFBPs');
                    }
                },
                error: function (xhr, status, error)
                {
                    alert(error);
                }
            });             

    }

    $('#btnGreigeReport').click(function(){
        var sParams = "";
        sParams = sessionStorage.getItem("ParamsSO");
        if(sParams == "" || sParams == undefined){
            alert("Please search first!!");
            return;
        }
        window.open(_sBaseAddress+ "/FabricBatch/GreigeReport?sParams="+sParams+"&bIsFromReport="+true);
    });

    </script>
