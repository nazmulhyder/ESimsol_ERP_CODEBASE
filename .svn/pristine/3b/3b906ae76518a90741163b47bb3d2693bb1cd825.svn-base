@{
ViewBag.Title = "Time Action Plan List";
}
@model IEnumerable<ESimSol.BusinessObjects.TAP>
<div id="winTAPAdvanceSearch" class="easyui-window winClass" title="Advance Search" data-options="modal:true,closed:true,collapsible:false,minimizable:false,maximizable:false,closable:false">
    <div style="width:760px;float: left;">
        <table border="0" cellpadding="0" cellspacing="0" style="font-size:12px">
            <tr style="height:240px">
                <td style="width:500px">
                    <table border="0" cellpadding="0" cellspacing="0" style="font-size:12px">
                        <tr style="height:230px">
                            <td style="width:400px; vertical-align:top;height:310px">
                                <fieldset>
                                    <legend style="font-weight:bold; font-size:12px"> Searching Criteria : </legend>
                                    <table border="0" cellpadding="0" cellspacing="0" style=" width:340px; font-size:12px">
                                        <tr>
                                            <td style="width:130px; text-align:left; font-weight:bold">
                                                Plan No:
                                            </td>
                                        </tr>

                                        <tr>
                                            <td style="width:325px;text-align:left">
                                                @Html.TextBox("txtPlanNo", "", new { style = "width: 325px", id = "txtPlanNo" })
                                            </td>
                                        </tr>


                                        <tr>
                                            <td style="width:130px; text-align:left; font-weight:bold">
                                                Recap No:
                                            </td>
                                        </tr>

                                        <tr>
                                            <td style="width:325px;text-align:left">
                                                @Html.TextBox("txtOrderRecapNo", "", new { style = "width: 270px", id = "txtOrderRecapNo", placeholder = "Type & Press Enter" }) <input type="button" id="btnOrderRecap" value="Pick" onclick="PickOrderRecap()" style="width:50px; text-align:left;" />
                                            </td>
                                        </tr>

                                        <tr>
                                            <td style="width:130px; text-align:left; font-weight:bold">
                                                Style No:
                                            </td>
                                        </tr>

                                        <tr>
                                            <td style="width:325px;text-align:left">
                                                @Html.TextBox("txtStyle", "", new { style = "width: 270px", id = "txtStyle", placeholder = "Type Style No & Press Enter" }) <input type="button" id="btnStyle" value="Pick" onclick="PickStyle()" style="width:50px; text-align:left;" />
                                            </td>
                                        </tr>

                                        <tr>
                                            <td style="width:130px;text-align:left; font-weight:bold">
                                                Buyer :
                                            </td>
                                        </tr>
                                        <tr>
                                            <td style="width:325px;text-align:left">

                                                @Html.TextBox("txtBuyer", "", new { style = "width: 252px", id = "txtBuyer", placeholder = "Type Buyer Name & press Enter" })<input type="button" style="width:70px; font-size:12px" onclick="BuyerPicker()" value="Pick" />
                                            </td>
                                        </tr>

                                        <tr>
                                            <td style="width:130px;text-align:left; font-weight:bold">
                                                Brand :
                                            </td>
                                        </tr>
                                        <tr>
                                            <td style="width:325px;text-align:left">
                                                <select id="cboBrand" style="width:325px;"></select>
                                            </td>
                                        </tr>
                                        <tr>
                                            <td style="width:130px;text-align:left; font-weight:bold">
                                                Session :
                                            </td>
                                        </tr>
                                        <tr>
                                            <td style="width:325px;text-align:left">
                                                <select id="cboSession" style="width:325px;"></select>
                                            </td>
                                        </tr>
                                        <tr>
                                            <td style="width:130px;text-align:left; font-weight:bold">
                                                Factory :
                                            </td>
                                        </tr>
                                        <tr>
                                            <td style="width:325px;text-align:left">

                                                @Html.TextBox("txtFactory", "", new { style = "width: 252px", id = "txtFactory", placeholder = "Type Factory Name & press Enter" })<input type="button" style="width:70px; font-size:12px" onclick="FactoryPicker()" value="Pick" />
                                            </td>
                                        </tr>
                                        <tr>
                                            <td style="width:130px;text-align:left; font-weight:bold">
                                                Plan Date:
                                            </td>
                                        </tr>
                                        <tr>
                                            <td style="width:325px;text-align:left; font-size:12px">
                                                <table border="0" style="font-size:12px">
                                                    <tr>
                                                        <td style="width:100px;font-size:12px;text-align:left">@Html.DropDownList("cboPlanDate", new SelectList(Enum.GetValues(typeof(ESimSol.BusinessObjects.EnumCompareOperator))), new { id = "cboPlanDate", style = "width: 100px;font-size:12px;text-align:left", @class = "_select_changeA" })</td>
                                                        <td style="width:98px;font-size:12px"><input id="txtStartPlanDate" type="text" class="easyui-datebox" required="required" data-options="formatter:icsdateformat,parser:icsdateparser" style="width: 98px;" /></td>
                                                        <td style="width:9px; font-size:12px" id="enddateT">To</td>
                                                        <td style="width:97px;font-size:12px" id="enddate"><input id="txtEndPlanDate" type="text" class="easyui-datebox" required="required" data-options="formatter:icsdateformat,parser:icsdateparser" style="width: 97px;" /></td>
                                                    </tr>
                                                </table>
                                            </td>
                                        </tr>


                                        <tr>
                                            <td style="width:130px;text-align:left; font-weight:bold">
                                                Approve By:
                                            </td>
                                        </tr>
                                        <tr>
                                            <td style="width:325px;text-align:left; font-size:12px">
                                                <select id="cboApproveBy" style="width:325px;font-size:12px" />
                                            </td>
                                        </tr>
                                        <tr>
                                            <td style="width:130px;text-align:left; font-weight:bold">
                                                Merchandiser:
                                            </td>
                                        </tr>
                                        <tr>
                                            <td style="width:325px;text-align:left; font-size:12px">
                                                <select id="cboMerchandiser" style="width:325px;font-size:12px" />
                                            </td>
                                        </tr>
                                        <tr>
                                            <td style="width:130px;text-align:left; font-weight:bold">
                                                <input type="checkbox" style="font-weight:bold; color:green; text-align:right;" id="chkIsrunning"><label id="lblRunning" style="font-weight:bold; color:green; font-size:12px;"> Running</label>
                                            </td>
                                        </tr>
                                        
                                        <tr style="height:30px; vertical-align:bottom">

                                            <td style=" text-align:left; width:325px;">
                                                <table border="0" cellpadding="0" cellspacing="0">
                                                    <tr>
                                                        <td style=" text-align:left;"><input type="button" value="Reset" id="btnReset" onclick="SearchReset()" style="width:70px; text-align:left;" /></td>
                                                        <td style=" text-align:right; width:255px;"><input type="button" value="Search" id="btnRefresh" style="width:70px; text-align:right;" /></td>
                                                    </tr>
                                                </table>
                                            </td>
                                        </tr>
                                    </table>
                                </fieldset>
                            </td>
                            <td style="width:323px; height:445px;vertical-align:top">
                                <div style=" margin-top:6px;">
                                    <table id="tblTAP" title="Time Action Plan List" class="easyui-datagrid" style="width:368px;height:445px;font-size:12px" fitcolumns="false" rownumbers="true" pagination="false" singleselect="false" , autorowheight="false">
                                        <thead>
                                            <tr>
                                                <th data-options="field:'Selected',checkbox:true"></th>
                                                <th field="PlanNo" width="90">Plan No</th>
                                                <th field="OrderRecapNo" width="90">Recap No</th>
                                                <th field="StyleNo" width="70">Style No</th>
                                                <th field="BuyerName" width="60">Buyer</th>
                                                <th field="PlanDateInString" width="100">Plan Date</th>
                                            </tr>
                                        </thead>
                                    </table>
                                </div>
                            </td>

                        </tr>
                    </table>
                </td>
            </tr>
            <tr style="height:50px">
                <td style="width:650px; text-align:right">
                    <a href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-ok" plain="true" onclick="OkButtonClick()">Ok</a>
                    <a href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-cancel" plain="true" onclick="Close()">Close</a>
                </td>
            </tr>
        </table>
    </div>
</div>

  <div class="menuMainCollectionTable">
        <table id="tblTAPs" title="Time Action Plan List" class="easyui-datagrid" fit="true" fitcolumns="true" rownumbers="true" pagination="true" singleselect="true" autorowheight="false" toolbar="#toolbar">
            <thead>
                <tr>
                    <th field="PlanNo" width="120">Plan No</th>
                    <th field="StyleNo" width="100">Style No</th>
                    <th field="OrderRecapNo" width="80">Recap No</th>
                    <th field="TAPStatusInString" width="80">Status</th>
                    <th field="BuyerName" width="100">Buyer Name</th>
                    <th field="PlanDateInString" width="100">O/Con Date</th>
                    <th field="ShipmentDateInString" width="100">Delivery Date</th>
                    <th field="LeadTime" formatter="formatPricewithoutdecimal" align="right" width="110">Lead Time(Dys)</th>
                    <th field="OrderQty" formatter="formatPrice" align="right" width="80">Qty</th>
                    <th field="PlanByName" width="100">Plan By</th>
                    <th field="ApprovedByName" width="100">Approved By</th>
                </tr>
            </thead>
        </table>
        <div id="toolbar">
            <input type="text" id="txtStyleNo" placeholder="Type Style No & Press Enter" style="width: 150px;" />
            <input type="text" id="txtBuyerName" placeholder="Type Buyer & Press Enter" style="width: 150px;" />
            <a id="btnSearch" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-search" plain="true">Search</a>
            <a id="btnAdd" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-add" plain="true" onclick="Add()">Add</a>
            <a id="btnEdit" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-edit" plain="true" onclick="Edit()">Edit</a>
            <a id="btnView" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-details" plain="true" onclick="Details()">View</a>
            <a id="btnDelete" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-remove" plain="true" onclick="Delete()">Delete</a>                              
            <a id="btnWaitforApproval" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-waitforapproval" plain="true" onclick="WaitForApproval()"> Wait For Approval</a>
            <a id="btnApproved" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-approved" plain="true" onclick="Approve()">Approve</a>
            <a id="btnUndoApproved" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-undo" plain="true" onclick="UndoApprove()">Undo App.</a>
            <a id="btnRequestforRevise" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-redo" plain="true" onclick="RequestforRevise()">Rqst for Revise</a>
            <a id="btnAcceptRevise" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-approved" plain="true" onclick="AcceptRevise()">Accept Revise</a>
            <a id="btnPreview" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-print" plain="true" onclick="Preview()">Preview</a>
            @*<a id="btnOrderFollowUp" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-print" plain="true" onclick="OrderFollowUp()">Order Follow Up</a>
            <a id="btnPendingTask" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-print" plain="true" onclick="PendingTask()">Pending Task</a>*@
            <a id="btnPrintList" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-print" plain="true" onclick="PrintList()">Print List</a>
            @*<a id="btnFactoryTAP" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-add" plain="true" onclick="FactoryTAP()">Factory TAP</a>*@
        </div>
    </div>


<script type="text/javascript">

    $(document).ready(function () {
        debugger;
        var oTAPs =@Html.Raw( new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(Model));
        var sBaseAddress =@Html.Raw( new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(HttpContext.Current.Session[SessionInfo.BaseAddress]));
        var oAuthorizationRolesMapping =@Html.Raw( new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(HttpContext.Current.Session[SessionInfo.AuthorizationRolesMapping]));
        var oUserList=@Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(ViewBag.Users));
        var oBrands = @Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(ViewBag.Brands));
        var oMerchandisers = @Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(ViewBag.Merchandisers));
        var oBusinessSessions =@Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(ViewBag.BusinessSessions));
        $('#tblTAPs').data('Brands',oBrands);
        $('#tblTAPs').data('Merchandisers',oMerchandisers);
        $('#tblTAPs').data('BusinessSessions',oBusinessSessions);
        $('#tblTAPs').data('UserList',oUserList);

        $('#tblTAPs').data('TechnicalSheetID',0);
        $('#tblTAPs').data('OrderRecapID',0);
        $('#tblTAPs').data('FactoryIDs',"");
        $('#tblTAPs').data('BuyerIDs',"");

        var oTempTAPs =sessionStorage.getItem("TAPs");
        if(oTempTAPs!=null)
        {
            oTempTAPs = jQuery.parseJSON(oTempTAPs);
        }
        else
        {
            oTempTAPs=oTAPs;
        }

        RefreshList(oTempTAPs);
        RefreshControlLayout(oAuthorizationRolesMapping);
    });

    /*Search Start*/
    $("#btnSearch").click(function () {
        SearchReset();
        $("#winTAPAdvanceSearch").icsWindow('open', "Advance Search");
        $("#winTAPAdvanceSearch input").not("input[type='button']").val("");
        $("#winTAPAdvanceSearch select").val(0);
        SetTodayDate();
        $("#cboApproveBy").icsLoadCombo({ List: $('#tblTAPs').data('UserList'), OptionValue: "UserID", DisplayText: "EmployeeNameCode" });
        $("#cboBrand").icsLoadCombo({ List:  $('#tblTAPs').data('Brands'), OptionValue: "BrandID", DisplayText: "BrandName" });
        $("#cboSession").icsLoadCombo({ List: $('#tblTAPs').data('BusinessSessions'), OptionValue: "BusinessSessionID", DisplayText: "SessionName" });
        $("#cboMerchandiser").icsLoadCombo({ List: $('#tblTAPs').data('Merchandisers'), OptionValue: "EmployeeID", DisplayText: "Name" });
    });
    function SetTodayDate()
    {
        $('#txtStartPlanDate').datebox('setValue', icsdateformat(new Date()));
        $('#txtEndPlanDate').datebox('setValue',icsdateformat(new Date()));
    }

    $('._select_changeA').change(function () {
        debugger;
        var x = $("#cboPlanDate").val();
        if (x == "EqualTo" || x == "NotEqualTo" || x == "GreaterThen" || x == "SmallerThen") {
            document.getElementById("enddate").style.display = 'none';
            document.getElementById("enddateT").style.display = 'none';
        }
        else {
            document.getElementById("enddate").style.display = '';
            document.getElementById("enddateT").style.display = '';
        }
    });

    function PickOrderRecap()
    {
        var oOrderRecap = { OrderRecapNo: '',BUID:sessionStorage.getItem('BUID')};
        var obj = {
            BaseAddress: sessionStorage.getItem('BaseAddress'),
            Object: oOrderRecap,
            ControllerName: "OrderRecap",
            ActionName: "GetOrderRecaps",
            IsWinClose: false
        };
        $.icsDataGets(obj, function (response) {
            debugger;
            if (response.status && response.objs.length > 0) {
                if (response.objs[0].OrderRecapID > 0) {
                    debugger;
                    var tblColums = []; var oColumn = { field: "OrderRecapNo", title: "Recap No", width: 150, align: "left" }; tblColums.push(oColumn);
                    oColumn = { field: "StyleNo", title: "Style No", width: 150, align: "left" }; tblColums.push(oColumn);
                    var oPickerParam = {
                        winid: 'winOrderRecap',
                        winclass: 'clsOrderRecap',
                        winwidth: 600,
                        winheight: 460,
                        tableid: 'tblOrderRecaps',
                        tablecolumns: tblColums,
                        datalist: response.objs,
                        multiplereturn: false,
                        searchingbyfieldName: 'OrderRecapNo',
                        windowTittle: 'Recap List'
                    };
                    $.icsPicker(oPickerParam);
                    IntializePickerbutton(oPickerParam);
                }
                else { alert(response.objs[0].ErrorMessage); }
            }
        });
    }

    $('#txtOrderRecapNo').keydown(function (e) {
        //debugger;
        var code = (e.keyCode ? e.keyCode : e.which);
        if (code == 13) // Enter Press
        {
            var oOrderRecap = {OrderRecapNo: $('#txtOrderRecapNo').val(), BUID:sessionStorage.getItem('BUID')};
            var obj = {
                BaseAddress: sessionStorage.getItem('BaseAddress'),
                Object: oOrderRecap,
                ControllerName: "OrderRecap",
                ActionName: "GetOrderRecaps",
                IsWinClose: false
            };
            $.icsDataGets(obj, function (response) {
                debugger;
                if (response.status && response.objs.length > 0) {
                    if (response.objs[0].OrderRecapID > 0) {
                        debugger;
                        var tblColums = []; var oColumn = { field: "OrderRecapNo", title: "Recap No", width: 150, align: "left" }; tblColums.push(oColumn);
                        oColumn = { field: "StyleNo", title: "Style No", width: 150, align: "left" }; tblColums.push(oColumn);
                        var oPickerParam = {
                            winid: 'winOrderRecap',
                            winclass: 'clsOrderRecap',
                            winwidth: 600,
                            winheight: 460,
                            tableid: 'tblOrderRecaps',
                            tablecolumns: tblColums,
                            datalist: response.objs,
                            multiplereturn: false,
                            searchingbyfieldName: 'OrderRecapNo',
                            windowTittle: 'Recap List'
                        };
                        $.icsPicker(oPickerParam);
                        IntializePickerbutton(oPickerParam);
                    }
                    else { alert(response.objs[0].ErrorMessage); }
                }
            });
        }else if (code == 8) //backspace=8
        {
            //debugger;
            var txtOrderRecapNo=document.getElementById("txtOrderRecapNo");
            txtOrderRecapNo.style.color="black";
            txtOrderRecapNo.style.fontWeight="normal";
            $('#tblTAPs').data('OrderRecapID',0);
        }
    });


    $('#btnRefresh').click(function () {
        debugger;
        var cboPlanDate = document.getElementById("cboPlanDate");
        var ncboPlanDate=cboPlanDate.options[cboPlanDate.selectedIndex].index;

        var cboApproveBy=document.getElementById("cboApproveBy");
        var nApproveByID=cboApproveBy.options[cboApproveBy.selectedIndex].value;

        var cboMerchandiser=document.getElementById("cboMerchandiser");
        var nMerchandiserID=cboMerchandiser.options[cboMerchandiser.selectedIndex].value;


        var sPlanNo= $("#txtPlanNo").val();
        var sStyleNo= $("#txtStyleNo").val();
        var sRecapNo= $("#txtOrderRecapNo").val();

        var dissueStartDate=$('#txtStartPlanDate').datebox('getValue');
        var dIssueEndDate=$('#txtEndPlanDate').datebox('getValue');
        var nBrandID = $('#cboBrand').val();
        var nSessionID = $('#cboSession').val();
        var bIsRunning =  false;
        if(document.getElementById("chkIsrunning").checked == true)
        {
            bIsRunning = true;
        }
        var chkResult = CheckEmpty();
        if(chkResult!=true)
        {
            alert("Please Select at least one Criteria !!");
            return;
        }
        var sTempString = ncboPlanDate+'~'+dissueStartDate+'~'+dIssueEndDate+'~'+sPlanNo+'~'+$('#tblTAPs').data('TechnicalSheetID')+'~'+nApproveByID+'~'+$('#tblTAPs').data('BuyerIDs')+'~'+$('#tblTAPs').data('OrderRecapID')+'~'+nBrandID+'~'+ $('#tblTAPs').data('FactoryIDs')+'~'+nMerchandiserID+'~'+nSessionID+'~'+bIsRunning+'~false'+'~'+sessionStorage.getItem('BUID');

        $.ajax({
            type: "GET",
            dataType: "json",
            url: '@Url.Action("Gets", "TAP")',
            data: { sTemp: sTempString },
            contentType: "application/json; charset=utf-8",
            success: function (data) {
                //debugger;
                var  oTAPs = jQuery.parseJSON(data);
                if (oTAPs != null) {
                    if(oTAPs.length>0)
                    {
                        RefreshListForSearch(oTAPs);
                    }
                    else
                    {
                        alert("Data not found!!");
                        RefreshListForSearch(oTAPs);
                    }
                }
            },
            error: function (xhr, status, error) {
                alert(error);
            }
        });

    });


    function RefreshListForSearch(oTAPs)
    {
        data =oTAPs;
        data={"total":""+data.length+"","rows":data};
        $('#tblTAP').datagrid('loadData',data);
    }

    function SearchReset() {
        debugger;
        $("#txtPlanNo").val('');
        $("#txtOrderRecapNo").val('');
        $("#txtStyle").val('');
        $("#txtBuyer").val('');
        $("#txtFactory").val('');

        var txtBuyer=document.getElementById("txtBuyer");
        txtBuyer.style.color="black";
        txtBuyer.style.fontWeight="normal";

        var txtFactory=document.getElementById("txtFactory");
        txtFactory.style.color="black";
        txtFactory.style.fontWeight="normal";

        var txtStyle=document.getElementById("txtStyle");
        txtStyle.style.color="black";
        txtStyle.style.fontWeight="normal";

        var txtOrderRecapNo=document.getElementById("txtOrderRecapNo");
        txtOrderRecapNo.style.color="black";
        txtOrderRecapNo.style.fontWeight="normal";
        
        document.getElementById("enddate").style.display = '';
        document.getElementById("enddateT").style.display = '';
        $('#cboMerchandiser').val(0);
        $('#cboApproveBy').val(0);
        $('#cboBrand').val(0);
        $('#cboSession').val(0);
        
        $('#tblTAPs').data('BuyerIDs','');
        $('#tblTAPs').data('FactoryIDs','');
        $('#tblTAPs').data('OrderRecapID',0);
        $('#tblTAPs').data('TechnicalSheetID',0);
        $('#cboPlanDate').val('None');
        document.getElementById("chkIsrunning").checked = false;
        SetTodayDate();
        var oTAPs=[];
        RefreshListForSearch(oTAPs);
    }

    function CheckEmpty()
    {
        var cboPlanDate = document.getElementById("cboPlanDate");
        var ncboPlanDate=cboPlanDate.options[cboPlanDate.selectedIndex].index;
        var cboApproveBy=document.getElementById("cboApproveBy");
        var nApproveByID=cboApproveBy.options[cboApproveBy.selectedIndex].value;
        var sPlanNo= document.getElementById("txtPlanNo").value;
        var sStyleNo= document.getElementById("txtStyleNo").value;
        var sRecapNo= document.getElementById("txtOrderRecapNo").value;

        var cboMerchandiser=document.getElementById("cboMerchandiser");
        var nMerchandiserID=cboMerchandiser.options[cboMerchandiser.selectedIndex].value;
        var bIsRunning =  false;
        if(document.getElementById("chkIsrunning").checked == true)
        {
            bIsRunning = true;
        }

        var nBrandID = $('#cboBrand').val();
        var nSessionID = $('#cboSession').val();
        if( ncboPlanDate==0 && nApproveByID==0  && $('#tblTAPs').data('BuyerIDs')=="" &&  $('#tblTAPs').data('FactoryIDs')==""  && sPlanNo==""  && $('#tblTAPs').data('OrderRecapID')==0 && $('#tblTAPs').data('TechnicalSheetID') == 0 && nBrandID==0 && nMerchandiserID ==0 && nSessionID==0 && bIsRunning==false)
        {
            return false;
        }
        return true;
    }

    function Close()
    {
        $("#winTAPAdvanceSearch").icsWindow('close');
    }

    function OkButtonClick() {
        debugger;
        var oTAPs=[];
        var oTAPs = $('#tblTAP').datagrid('getChecked');
        if(oTAPs.length<=0)
        {
            alert("please select at least one item");
            return;
        }
        RefreshList(oTAPs);
        $("#winTAPAdvanceSearch").icsWindow('close');
    }


    // Search Style Start
    function PickStyle()
    {
        //debugger;
        var oTechnicalSheet = { StyleNo:'',BUID:sessionStorage.getItem('BUID')};
        var obj = {
            BaseAddress: sessionStorage.getItem('BaseAddress'),
            Object: oTechnicalSheet,
            ControllerName: "TechnicalSheet",
            ActionName: "StyleSearch",
            IsWinClose: false
        };
        $.icsDataGets(obj, function (response) {
            debugger;
            if (response.status && response.objs.length > 0) {
                if (response.objs[0].TechnicalSheetID > 0) {
                    debugger;
                    var tblColums = []; var oColumn = { field: "StyleNo", title: "Style No", width: 150, align: "left" }; tblColums.push(oColumn);
                    oColumn = { field: "BuyerName", title: "Buyer", width: 150, align: "left" }; tblColums.push(oColumn);
                    var oPickerParam = {
                        winid: 'winStyles',
                        winclass: 'clsStyle',
                        winwidth: 600,
                        winheight: 460,
                        tableid: 'tblStyles',
                        tablecolumns: tblColums,
                        datalist: response.objs,
                        multiplereturn: false,
                        searchingbyfieldName: 'StyleNo',
                        windowTittle: 'Style List'
                    };
                    $.icsPicker(oPickerParam);
                    IntializePickerbutton(oPickerParam);
                }
                else { alert(response.objs[0].ErrorMessage); }
            }else
            {
                alert("Data Not Found.");
                return;
            }
        });
    }
    $('#txtStyle').keydown(function (e) {
        //debugger;
        var code = (e.keyCode ? e.keyCode : e.which);
        if (code == 13) // Enter Press
        {
            var oTechnicalSheet = { StyleNo: $('#txtStyle').val(),BUID:sessionStorage.getItem('BUID')};
            var obj = {
                BaseAddress: sessionStorage.getItem('BaseAddress'),
                Object: oTechnicalSheet,
                ControllerName: "TechnicalSheet",
                ActionName: "StyleSearch",
                IsWinClose: false
            };
            $.icsDataGets(obj, function (response) {
                debugger;
                if (response.status && response.objs.length > 0) {
                    if (response.objs[0].TechnicalSheetID > 0) {
                        debugger;
                        var tblColums = []; var oColumn = { field: "StyleNo", title: "Style No", width: 150, align: "left" }; tblColums.push(oColumn);
                        oColumn = { field: "BuyerName", title: "Buyer", width: 150, align: "left" }; tblColums.push(oColumn);
                        var oPickerParam = {
                            winid: 'winStyles',
                            winclass: 'clsStyle',
                            winwidth: 600,
                            winheight: 460,
                            tableid: 'tblStyles',
                            tablecolumns: tblColums,
                            datalist: response.objs,
                            multiplereturn: false,
                            searchingbyfieldName: 'StyleNo',
                            windowTittle: 'Style List'
                        };
                        $.icsPicker(oPickerParam);
                        IntializePickerbutton(oPickerParam);
                    }
                    else { alert(response.objs[0].ErrorMessage); }
                }else
                {
                    alert("Data Not Found.");
                    return;
                }
            });
        }else if (code == 8) //backspace=8
        {
            //debugger;
            var txtStyle=document.getElementById("txtStyle");
            txtStyle.style.color="black";
            txtStyle.style.fontWeight="normal";
            $('#tblTAPs').data('TechnicalSheetID',0);

        }
    });
    // Search Style End


    // Search Buyer Start
    function BuyerPicker(){
        debugger;
        var oContractor = { Params:2+'~'+''+'~'+sessionStorage.getItem('BUID')};
        var obj = {
            BaseAddress: sessionStorage.getItem('BaseAddress'),
            Object: oContractor,
            ControllerName: "Contractor",
            ActionName: "ContractorSearchByNameType",
            IsWinClose: false
        };
        $.icsDataGets(obj, function (response) {
            debugger;
            if (response.status && response.objs.length > 0) {
                if (response.objs[0].ContractorID > 0) {
                    var tblColums = [];var oColumn = { field: "Name", title: "Name", width: 200, align: "left" }; tblColums.push(oColumn);
                    oColumn = { field: "Address", title: "Address", width: 120, align: "left" }; tblColums.push(oColumn);
                    oColumn = { field: "Email", title: "Email", width: 90, align: "left" }; tblColums.push(oColumn);
                    oColumn = { field: "ShortName", title: "Short Name", width: 90, align: "left" }; tblColums.push(oColumn);
                    var oPickerParam = {
                        winid: 'winBuyers',
                        winclass: 'clsBuyer',
                        winwidth: 600,
                        winheight: 460,
                        tableid: 'tblBuyers',
                        tablecolumns: tblColums,
                        datalist: response.objs,
                        multiplereturn: true,
                        searchingbyfieldName: 'Name',
                        windowTittle: 'Buyer List'
                    };
                    $.icsPicker(oPickerParam);
                    IntializePickerbutton(oPickerParam);
                }
                else { alert(response.objs[0].ErrorMessage); }
            }else
            {
                alert("Data Not Found.");
                return;
            }
        });

    }
    $("#txtBuyer").keydown(function (e) {
        debugger;
        var code = (e.keyCode ? e.keyCode : e.which);
        if (code == 13) // Enter Press
        {
            var oContractor = { Params: 2 + '~' + $('#txtBuyer').val()+'~'+sessionStorage.getItem('BUID') };
            var obj = {
                BaseAddress: sessionStorage.getItem('BaseAddress'),
                Object: oContractor,
                ControllerName: "Contractor",
                ActionName: "ContractorSearchByNameType",
                IsWinClose: false
            };
            $.icsDataGets(obj, function (response) {
                debugger;
                if (response.status && response.objs.length > 0) {
                    if (response.objs[0].ContractorID > 0) {
                        debugger;
                        var tblColums = [];var oColumn = { field: "Name", title: "Name", width: 200, align: "left" }; tblColums.push(oColumn);
                        oColumn = { field: "Address", title: "Address", width: 120, align: "left" }; tblColums.push(oColumn);
                        oColumn = { field: "Email", title: "Email", width: 90, align: "left" }; tblColums.push(oColumn);
                        oColumn = { field: "ShortName", title: "Short Name", width: 90, align: "left" }; tblColums.push(oColumn);
                        var oPickerParam = {
                            winid: 'winBuyers',
                            winclass: 'clsBuyer',
                            winwidth: 600,
                            winheight: 460,
                            tableid: 'tblBuyers',
                            tablecolumns: tblColums,
                            datalist: response.objs,
                            multiplereturn: false,
                            searchingbyfieldName: 'Name',
                            windowTittle: 'Buyer List'
                        };
                        $.icsPicker(oPickerParam);
                        IntializePickerbutton(oPickerParam);
                    }
                    else { alert(response.objs[0].ErrorMessage); }
                }else
                {
                    alert("Data Not Found.");
                    return;
                }
            });
        }else  if (code == 8) //backspace=8
        {
            //debugger;
            var txtBuyer=document.getElementById("txtBuyer");
            txtBuyer.style.color="black";
            txtBuyer.style.fontWeight="normal";
            $('#tblTAPs').data('BuyerIDs','');

        }
    });
    // Search Buyer End



    // Search Factory Start
    $("#txtFactory").keydown(function (e) {
        debugger;
        var code = (e.keyCode ? e.keyCode : e.which);
        if (code == 13) // Enter Press
        {
            var oContractor = { Params: 3 + '~' + $('#txtFactory').val()+'~'+sessionStorage.getItem('BUID') };
            var obj = {
                BaseAddress: sessionStorage.getItem('BaseAddress'),
                Object: oContractor,
                ControllerName: "Contractor",
                ActionName: "ContractorSearchByNameType",
                IsWinClose: false
            };
            $.icsDataGets(obj, function (response) {
                debugger;
                if (response.status && response.objs.length > 0) {
                    if (response.objs[0].ContractorID > 0) {
                        debugger;
                        var tblColums = [];var oColumn = { field: "Name", title: "Name", width: 200, align: "left" }; tblColums.push(oColumn);
                        oColumn = { field: "Address", title: "Address", width: 120, align: "left" }; tblColums.push(oColumn);
                        oColumn = { field: "Email", title: "Email", width: 90, align: "left" }; tblColums.push(oColumn);
                        oColumn = { field: "ShortName", title: "Short Name", width: 90, align: "left" }; tblColums.push(oColumn);
                        var oPickerParam = {
                            winid: 'winFactorys',
                            winclass: 'clsFactory',
                            winwidth: 600,
                            winheight: 460,
                            tableid: 'tblFactorys',
                            tablecolumns: tblColums,
                            datalist: response.objs,
                            multiplereturn: false,
                            searchingbyfieldName: 'Name',
                            windowTittle: 'Factory List'
                        };
                        $.icsPicker(oPickerParam);
                        IntializePickerbutton(oPickerParam);
                    }
                    else { alert(response.objs[0].ErrorMessage); }
                }else
                {
                    alert("Data Not Found.");
                    return;
                }
            });
        }else  if (code == 8) //backspace=8
        {
            //debugger;
            var txtFactory=document.getElementById("txtFactory");
            txtFactory.style.color="black";
            txtFactory.style.fontWeight="normal";
            $('#tblTAPs').data('FactoryIDs','');
        }
    });
    function FactoryPicker(){
        //debugger;
        var oContractor = { Params: 3 +'~'+''+'~'+sessionStorage.getItem('BUID')};
        var obj = {
            BaseAddress: sessionStorage.getItem('BaseAddress'),
            Object: oContractor,
            ControllerName: "Contractor",
            ActionName: "ContractorSearchByNameType",
            IsWinClose: false
        };
        $.icsDataGets(obj, function (response) {
            debugger;
            if (response.status && response.objs.length > 0) {
                if (response.objs[0].ContractorID > 0) {
                    debugger;
                    var tblColums = [];var oColumn = { field: "Name", title: "Name", width: 200, align: "left" }; tblColums.push(oColumn);
                    oColumn = { field: "Address", title: "Address", width: 120, align: "left" }; tblColums.push(oColumn);
                    oColumn = { field: "Email", title: "Email", width: 90, align: "left" }; tblColums.push(oColumn);
                    oColumn = { field: "ShortName", title: "Short Name", width: 90, align: "left" }; tblColums.push(oColumn);
                    var oPickerParam = {
                        winid: 'winFactorys',
                        winclass: 'clsFactory',
                        winwidth: 600,
                        winheight: 460,
                        tableid: 'tblFactorys',
                        tablecolumns: tblColums,
                        datalist: response.objs,
                        multiplereturn: false,
                        searchingbyfieldName: 'Name',
                        windowTittle: 'Factory List'
                    };
                    $.icsPicker(oPickerParam);
                    IntializePickerbutton(oPickerParam);
                }
                else { alert(response.objs[0].ErrorMessage); }
            }else
            {
                alert("Data Not Found.");
                return;
            }
        });
    }
  
    // Search Factory End

    function IntializePickerbutton(oPickerobj) {
        debugger;
        $("#" + oPickerobj.winid).find("#btnOk").click(function () {
            debugger;
            //for Single Select
            PickerEvents(oPickerobj);
        });
        $(document).find('.' + oPickerobj.winclass).keydown(function (e) {
            if (e.which == 13)//enter=13
            {
                PickerEvents(oPickerobj);
            }
        });
    }
    function PickerEvents(oPickerobj) {
        var oreturnobj = null, oreturnobjs = [];
        if (oPickerobj.multiplereturn)
        {
            oreturnobjs = $('#' + oPickerobj.tableid).datagrid('getChecked');
        } else
        {
            oreturnobj = $('#' + oPickerobj.tableid).datagrid('getSelected');
        }

        $("#" + oPickerobj.winid).icsWindow("close");
        $("#" + oPickerobj.winid).remove();
        if (oPickerobj.winclass == 'clsBuyer')
        {
           var nBuyerIDs = "";
            if (oPickerobj.multiplereturn)
            {
                var ncount = 0;
                for (var i = 0; i <oreturnobjs.length; i++) {
                    var nSupplierID = oreturnobjs[i].ContractorID;
                    nBuyerIDs = nBuyerIDs + nSupplierID + ',';
                    ncount++;
                }
                if (ncount > 1)
                {
                    $('#txtBuyer').val("Select " + ncount + " Buyer's");
                } else
                {
                    $('#txtBuyer').val(oreturnobjs[0].Name);
                }
                nBuyerIDs = nBuyerIDs.substring(0, nBuyerIDs.length - 1);

            } else
            {
                $('#txtBuyer').val(oreturnobj.Name);
                nBuyerIDs = "" + oreturnobj.ContractorID + "";
                $('#txtBuyer').focus();
            }
            var txtBuyerName = document.getElementById("txtBuyer");
            txtBuyerName.style.color = "blue";
            txtBuyerName.style.fontWeight = "bold";
            $('#tblTAPs').data('BuyerIDs',nBuyerIDs);

        } else if (oPickerobj.winclass == 'clsFactory')
        {
            var nFactoryIDs = "";
            if (oPickerobj.multiplereturn)
            {
                var ncount = 0;
                for (var i = 0; i <oreturnobjs.length; i++) {
                    var nSupplierID = oreturnobjs[i].ContractorID;
                    nFactoryIDs = nFactoryIDs + nSupplierID + ',';
                    ncount++;
                }
                if (ncount > 1)
                {
                    $('#txtFactory').val("Select " + ncount + " Factory's");
                } else
                {
                    $('#txtFactory').val(oreturnobjs[0].Name);
                }
                nFactoryIDs = nFactoryIDs.substring(0, nFactoryIDs.length - 1);

            } else
            {
                $('#txtFactory').val(oreturnobj.Name);
                nFactoryIDs = "" + oreturnobj.ContractorID + "";
                $('#txtFactory').focus();
            }
            var txtFactory = document.getElementById("txtFactory");
            txtFactory.style.color = "blue";
            txtFactory.style.fontWeight = "bold";
            $('#tblTAPs').data('FactoryIDs',nFactoryIDs);
        }else if (oPickerobj.winclass == 'clsStyle')
        {
            $('#txtStyle').val(oreturnobj.StyleNo);
            $('#tblTAPs').data('TechnicalSheetID',oreturnobj.TechnicalSheetID);
            $('#txtStyle').focus();
            var txtStyle = document.getElementById("txtStyle");
            txtStyle.style.color = "blue";
            txtStyle.style.fontWeight = "bold";
        }else if (oPickerobj.winclass == 'clsOrderRecap')
        {
            $('#txtOrderRecapNo').val(oreturnobj.StyleNo+"/"+ oreturnobj.OrderRecapNo);
            $('#tblTAPs').data('OrderRecapID',oreturnobj.OrderRecapID);
            $('#txtOrderRecapNo').focus();
            var txtOrderRecapNo = document.getElementById("txtOrderRecapNo");
            txtOrderRecapNo.style.color = "blue";
            txtOrderRecapNo.style.fontWeight = "bold";
        }
    }

    /*search End*/



    //Style wise Start
    $('#txtStyleNo').keypress(function (e)
    {
        var code = (e.keyCode ? e.keyCode : e.which);
        if (code == 13) {
            var txtStyleNo = document.getElementById('txtStyleNo').value;
            if(txtStyleNo!="")
            {
                document.getElementById("txtBuyerName").value='';
                //debugger;
                var tsv=((new Date()).getTime())/1000;
                $.ajax
            ({
                type: "GET",
                dataType: "json",
                url : sessionStorage.getItem('BaseAddress')+  "/TAP/SearchStyleAndBuyer",
                data: {sTempData:txtStyleNo,bIsStyle:true,buid:sessionStorage.getItem('BUID'),ts:tsv},
                contentType: "application/json; charset=utf-8",
                success: function (data) {
                    //debugger;
                    var oTAPs = jQuery.parseJSON(data);
                    if (oTAPs.length>0)
                    {
                        var  data=oTAPs;
                        data={"total":""+data.length+"","rows":data};
                        $('#tblTAPs').datagrid('loadData',data);
                    }
                    else
                    {
                        alert("Data Not found");
                        RefreshList([]);
                    }
                },
                error: function (xhr, status, error)
                {
                    alert(error);
                }
            });             //debugger;

            }
        }

    });

    $('#txtStyleNo').keydown(function (e) {
        var code = (e.keyCode ? e.keyCode : e.which);
        if (code == 8) //backspace=8
        {
            var txtStyleNo=document.getElementById("txtStyleNo");
            txtStyleNo.value='';
            txtStyleNo.style.color="Normal";
            txtStyleNo.style.fontWeight="Black";

        }
    });
    //style Wise End


    //Buyer wise Start
    $('#txtBuyerName').keypress(function (e)
    {
        var code = (e.keyCode ? e.keyCode : e.which);
        if (code == 13) {
            var txtBuyerName = document.getElementById('txtBuyerName').value;
            if(txtBuyerName!="")
            {
                document.getElementById("txtStyleNo").value='';
                //debugger;
                var tsv=((new Date()).getTime())/1000;
                $.ajax
            ({
                type: "GET",
                dataType: "json",
                url : sessionStorage.getItem('BaseAddress')+ "/TAP/SearchStyleAndBuyer",
                data: {sTempData:txtBuyerName,bIsStyle:false,buid:sessionStorage.getItem('BUID'), ts:tsv},
                contentType: "application/json; charset=utf-8",
                success: function (data) {
                    //debugger;
                    var oTAPs = jQuery.parseJSON(data);
                    if (oTAPs.length>0)
                    {
                        var  data=oTAPs;
                        data={"total":""+data.length+"","rows":data};
                        $('#tblTAPs').datagrid('loadData',data);
                    }
                    else
                    {
                        alert("Data Not found");
                        RefreshList([]);
                    }
                },
                error: function (xhr, status, error)
                {
                    alert(error);
                }
            });             //debugger;

            }
        }

    });

    $('#txtBuyerName').keydown(function (e) {
        var code = (e.keyCode ? e.keyCode : e.which);
        if (code == 8) //backspace=8
        {
            var txtBuyerName=document.getElementById("txtBuyerName");
            txtBuyerName.value='';
            txtBuyerName.style.color="Normal";
            txtBuyerName.style.fontWeight="Black";

        }
    });
    //Buyer Wise End

    function Printer()
    {
        window.open(sessionStorage.getItem('BaseAddress')+'/TAP/Printer', "_blank");
    }

    $('#txtRefNo').keypress(function (e) {
        //debugger;
        var c = String.fromCharCode(e.which);
        var txtRefNo = document.getElementById('txtRefNo').value;
        txtRefNo = txtRefNo + c;
        //if(txtSearchByName.length<3)return;

        var bFlag=false;
        var sTempName="";
        var rows = $('#tblTAPs').datagrid('getRows');
        for(i=0;i<rows.length;++i){
            sTempName=rows[i]['RefNo'].substring(0, txtRefNo.length);
            if(txtRefNo.toUpperCase()==sTempName.toUpperCase())
            {
                bFlag=true;
                break;
            }
        }
        if(bFlag)
        {
            $('#tblTAPs').datagrid('selectRow', i);
        }
    });

    function RequestforRevise()
    {
        //debugger;
        var oTAP = $('#tblTAPs').datagrid('getSelected');
        if(oTAP==null || oTAP.TAPID<=0)
        {
            alert("Please select a item from list!");
            return;
        }else if(parseInt(oTAP.TAPStatus)!=2)
        {
            alert("Please select only approved item from list");
            return;
        }
        if (!confirm("Confirm to Request for Revise?")) return ;
        oTAP.ActionTypeExtra="RequestForRevise";
        StatusChange(oTAP,"Request For Revise");

    }

    function AcceptRevise()
    {
        //debugger;
        var oTAP = $('#tblTAPs').datagrid('getSelected');
        if(oTAP==null || oTAP.TAPID<=0)
        {
            alert("Please select a item from list!");
            return;
        }
        if(parseInt(oTAP.TAPStatus)!=3)
        {
            alert("Please select only Revise Requested  item from list");
            return;
        }
        var SelectedRowIndex=$('#tblTAPs').datagrid('getRowIndex',oTAP);
        var tsv=((new Date()).getTime())/1000;
        var oTAPs= $('#tblTAPs').datagrid('getRows');
        sessionStorage.setItem("TAPs", JSON.stringify(oTAPs));
        sessionStorage.setItem("SelectedRowIndex", SelectedRowIndex);
        sessionStorage.setItem("TAPHeader", 'Accept Time Action Plan');
        var oBackLink = window.location.href;
        sessionStorage.setItem("BackLink", oBackLink);
        window.location.href =sessionStorage.getItem('BaseAddress')+  "/TAP/ViewTAPAcceptRevise?id="+parseInt(oTAP.TAPID)+"&ts="+tsv;
    }

    function WaitForApproval()
    {
        $.ajax
        ({
            type: "GET",
            dataType: "json",
            url : sessionStorage.getItem('BaseAddress')+  "/TAP/WaitingSearch",
            data: {},
            contentType: "application/json; charset=utf-8",
            success: function (data) {
                //debugger;
                var oTAPs = jQuery.parseJSON(data);
                if (oTAPs.length>0)
                {
                    var  data=oTAPs;
                    data={"total":""+data.length+"","rows":data};
                    $('#tblTAPs').datagrid('loadData',data);

                }
                else
                {
                    alert("Data Not found");
                }
            },
            error: function (xhr, status, error)
            {
                alert(error);
            }
        });
    }

    function Approve()
    {

        debugger;
        var oTAP = $('#tblTAPs').datagrid('getSelected');
        if(oTAP==null || oTAP.TAPID<=0)
        {
            alert("Please select a item from list!");
            return;
        }
        if(parseInt(oTAP.TAPStatus)!=0)
        {
            alert("Please select only Requested  item from list");
            return;
        }
        var SelectedRowIndex=$('#tblTAPs').datagrid('getRowIndex',oTAP);
        var tsv=((new Date()).getTime())/1000;
        var oTAPs= $('#tblTAPs').datagrid('getRows');
        sessionStorage.setItem("TAPs", JSON.stringify(oTAPs));
        sessionStorage.setItem("SelectedRowIndex", SelectedRowIndex);
        sessionStorage.setItem("TAPHeader", 'Approved Time Action Plan');
        var oBackLink = window.location.href;
        sessionStorage.setItem("BackLink", oBackLink);
        window.location.href =sessionStorage.getItem('BaseAddress')+  "/TAP/ViewTAP?id="+oTAP.TAPID+"&ts="+tsv;
    }

    function UndoApprove()
    {
        //debugger;
        var oTAP = $('#tblTAPs').datagrid('getSelected');
        if(oTAP==null || oTAP.TAPID<=0)
        {
            alert("Please select a item from list!");
            return;
        }else if(parseInt(oTAP.TAPStatus)!=2)
        {
            alert("Please select only Approved item from list");
            return;
        }
        if (!confirm("Confirm to Undo Approve?")) return ;
        oTAP.ActionTypeExtra="UndoApprove";
        StatusChange(oTAP,"Undo Approve");
    }

    function StatusChange(oTAP,sParamIdentifier)
    {        
        var SelectedRowIndex=$('#tblTAPs').datagrid('getRowIndex',oTAP);
        $.ajax({
            type: "POST",
            dataType: "json",
            url : sessionStorage.getItem('BaseAddress')+"/TAP/ChangeStatus",
            traditional: true,
            data:  JSON.stringify(oTAP),
            contentType: "application/json; charset=utf-8",
            success: function (data) {
                //debugger;
                var oTAP= jQuery.parseJSON(data);
                if (oTAP.ErrorMessage=="" || oTAP.ErrorMessage == null)
                {
                    if(sParamIdentifier=="Approve")
                    {
                        alert("Approved Successfully!!");
                    }
                    else  if(sParamIdentifier=="Undo Approve")
                    {
                        alert("Successfully Undo Approve !");
                    }
                    else  if(sParamIdentifier=="Request For Revise")
                    {
                        alert("Successfully Request For Revise!");
                    }                    
                    $('#tblTAPs').datagrid('updateRow',{index: SelectedRowIndex,	row: oTAP});
                }else
                {
                    alert(oTAP.ErrorMessage);
                }
            },
            error: function (xhr, status, error)
            {
                alert(error);
            }
        });


    }
    
    function Add()
    {
        //debugger;

        var oTAPs= $('#tblTAPs').datagrid('getRows');
        sessionStorage.setItem("TAPs", JSON.stringify(oTAPs));
        sessionStorage.setItem("SelectedRowIndex", -1);
        sessionStorage.setItem("TAPHeader", 'Add Time Action Plan');
        var oBackLink = window.location.href;
        sessionStorage.setItem("BackLink", oBackLink);
        window.location.href =sessionStorage.getItem('BaseAddress')+ "/TAP/ViewTAP?id=0";
    }

    function Edit()
    {
        //debugger;
        var oTAP= $('#tblTAPs').datagrid('getSelected');
        if(oTAP==null || oTAP.TAPID<=0)
        {
            alert("Please select a item from list!");
            return;
        }
        if(parseInt(oTAP.ApprovedBy)!=0)
        {
            alert("Already Approved");
            return;
        }
        var SelectedRowIndex=$('#tblTAPs').datagrid('getRowIndex',oTAP);
        var oTAPs= $('#tblTAPs').datagrid('getRows');
        sessionStorage.setItem("TAPs", JSON.stringify(oTAPs));
        sessionStorage.setItem("SelectedRowIndex", SelectedRowIndex);
        sessionStorage.setItem("TAPHeader", 'Edit Time Action Plan');
        var oBackLink = window.location.href;
        sessionStorage.setItem("BackLink", oBackLink);
        window.location.href =sessionStorage.getItem('BaseAddress')+  "/TAP/ViewTAP?id="+oTAP.TAPID;
    }

    function FactoryTAP()
    {
        var oTAP= $('#tblTAPs').datagrid('getSelected');
        if(oTAP==null || oTAP.TAPID<=0)
        {
            alert("Please select a item from list!");
            return;
        }
        var SelectedRowIndex=$('#tblTAPs').datagrid('getRowIndex',oTAP);
        var oTAPs= $('#tblTAPs').datagrid('getRows');
        sessionStorage.setItem("TAPs", JSON.stringify(oTAPs));
        sessionStorage.setItem("SelectedRowIndex", SelectedRowIndex);
        sessionStorage.setItem("TAPHeader", 'Factory Time Action Plan');
        var oBackLink = window.location.href;
        sessionStorage.setItem("BackLink", oBackLink);
        window.location.href =sessionStorage.getItem('BaseAddress')+  "/TAP/ViewFactoryTAP?id="+oTAP.TAPID;
    }

    function Details()
    {
        debugger;
        var oTAP= $('#tblTAPs').datagrid('getSelected');
        if(oTAP==null || oTAP.TAPID<=0)
        {
            alert("Please select a item from list!");
            return;
        }
        var SelectedRowIndex=$('#tblTAPs').datagrid('getRowIndex',oTAP);
        var oTAPs= $('#tblTAPs').datagrid('getRows');
        sessionStorage.setItem("TAPs", JSON.stringify(oTAPs));
        sessionStorage.setItem("SelectedRowIndex", SelectedRowIndex);
        sessionStorage.setItem("TAPHeader", 'View Time Action Plan');
        var oBackLink = window.location.href;
        sessionStorage.setItem("BackLink", oBackLink);
        window.location.href =sessionStorage.getItem('BaseAddress')+  "/TAP/ViewTAP?id="+oTAP.TAPID;
    }

    function Delete()
    {
        //debugger;
        var oTAP= $('#tblTAPs').datagrid('getSelected');
        if(oTAP==null || parseInt(oTAP.TAPID)<=0)
        {
            alert("Invalid Field!!! please select a valid Field!");
            return false;
        }
        if(parseInt(oTAP.TAPStatus)!=0)
        {
            alert("Please select Initialize Item form List");
            return;
        }
        if (!confirm("Confirm to Delete?")) return ;
        var SelectedRowIndex=$('#tblTAPs').datagrid('getRowIndex',oTAP);
        if (oTAP.TAPID > 0)
        {
            $.ajax
            ({
                type: "GET",
                dataType: "json",
                url : sessionStorage.getItem('BaseAddress')+  "/TAP/Delete",
                data: { id: oTAP.TAPID},
                contentType: "application/json; charset=utf-8",
                success: function (data) {
                    //debugger;
                    feedbackmessage = jQuery.parseJSON(data);
                    if (feedbackmessage == "Data delete successfully")
                    {
                        alert("Delete sucessfully");
                        $('#tblTAPs').datagrid('deleteRow',SelectedRowIndex);
                    }
                    else
                    {
                        alert(feedbackmessage);
                    }
                },
                error: function (xhr, status, error)
                {
                    alert(error);
                }

            });
        }
    }

    function RefreshList(oTAPs)
    {
        data=oTAPs;
        data={"total":""+data.length+"","rows":data};
        $('#tblTAPs').datagrid('loadData',data);
        var nIndex= parseInt(sessionStorage.getItem("SelectedRowIndex"));
        $('#tblTAPs').datagrid('selectRow',nIndex);
    }

    function PrintList()
    {
        var oTAPs= $('#tblTAPs').datagrid('getRows');
        var ids ="";
        if(oTAPs.length>0)
        {
            for(var i =0;i<oTAPs.length;i++)
            {
                ids =ids+oTAPs[i].TAPID+",";
            }
            ids= ids.substring(0, parseInt(ids.length - 1));
        }
        if(ids =="" || ids==null)
        {
            alert("Data not found ");
            return;
        }
        window.open(sessionStorage.getItem('BaseAddress') + '/TAP/PrintTAPs?sParam='+ids);


    }

    function Preview()
    {
        var oTAP= $('#tblTAPs').datagrid('getSelected');
        if(oTAP==null || oTAP.TAPID<=0)
        {
            alert("Please select a item from list!");
            return;
        }
        window.open(sessionStorage.getItem('BaseAddress') + '/TAP/TAPPreview?id='+oTAP.TAPID);
    }

    
    function OrderFollowUp()
    {
        var oTAP= $('#tblTAPs').datagrid('getSelected');
        if(oTAP==null || oTAP.TAPID<=0)
        {
            alert("Please select a item from list!");
            return;
        }
        window.open(sessionStorage.getItem('BaseAddress') +'/TAP/OrderFollowUpPreview?id='+oTAP.TAPID);
    }

    function PendingTask()
    {
        var oTAP= $('#tblTAPs').datagrid('getSelected');
        if(oTAP==null || oTAP.TAPID<=0)
        {
            alert("Please select a item from list!");
            return;
        }
        if(parseInt(oTAP.TAPStatus)!=2)
        {
            alert("Please select Approved Item form List");
            return;
        }
        window.open(sessionStorage.getItem('BaseAddress') + '/TAP/PendingTask?id='+parseInt(oTAP.TAPID));
    }

    function RefreshControlLayout(oAuthorizationRolesMapping)
    {
        $('#btnAdd,#btnEdit,#btnDelete,#btnView,#btnRequestforRevise,#btnAcceptRevise,#btnApproved,#btnUndoApproved,#btnPreview,#btnPrintList').hide();
                
        
        if(PermissionChecker('Add','TAP',oAuthorizationRolesMapping)){$('#btnAdd').show(); }
        if(PermissionChecker('Edit','TAP',oAuthorizationRolesMapping)){$('#btnEdit').show(); }
        if(PermissionChecker('Delete','TAP',oAuthorizationRolesMapping)){ $('#btnDelete').show(); }
        if(PermissionChecker('View','TAP',oAuthorizationRolesMapping)){$('#btnView').show(); }

        if(PermissionChecker('Add','TAP',oAuthorizationRolesMapping)){$('#btnRequestforRevise').show(); }
        if(PermissionChecker('Add','TAP',oAuthorizationRolesMapping)){$('#btnAcceptRevise').show(); }
        if(PermissionChecker('Approved','TAP',oAuthorizationRolesMapping)){ $('#btnApproved').show(); }
        if(PermissionChecker('Approved','TAP',oAuthorizationRolesMapping)){$('#btnUndoApproved').show(); }

        if(PermissionChecker('Preview','TAP',oAuthorizationRolesMapping)){ $('#btnPreview').show(); }
        if(PermissionChecker('PrintList','TAP',oAuthorizationRolesMapping)){ $('#btnPrintList').show(); }
        

    }

    
</script>
