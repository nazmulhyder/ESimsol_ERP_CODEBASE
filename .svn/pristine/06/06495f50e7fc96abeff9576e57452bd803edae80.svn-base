<html>
@{
    ViewBag.Title = "Sale Invoice Entry";
}
<body>
    @model ESimSol.BusinessObjects.SaleInvoice
    <div class="menuMainCollectionTable" ng-app="SaleInvoiceApp" ng-controller="SaleInvoiceController as MLCC" id="divSaleInvoice" style="height:97%">
        <div style="height:5%; overflow:hidden; padding-left:5px;" class="ui-grid-top-panel">
            <label style="">Sale Invoice Entry :</label>
        </div>
        <div style="height:87%; overflow:scroll; padding-top:10px">
            <div style="font-family:Tahoma;text-align:center;height:90%" class="regionVR">
                @*CLIENT DETAILS & Image*@
                <div class="col-md-12 text-left">
                     <fieldset style="padding: 2% 2% 2% 10%">
                            <legend>Client Details: </legend>
                         <div class="row">
                             <div class="col-md-12">
                                 <div class="col-md-5 align-left">
                                     <div class="col-md-4 text-right">
                                         <label class="control-label">Invoice No:</label>
                                     </div>
                                     <div class="col-md-8 align-left">
                                         <input ng-model="SaleInvoice.InvoiceNO" class="form-control" disabled />
                                     </div>
                                 </div>
                                 <div class="col-md-5 align-left">
                                     <div class="col-md-4 text-right">
                                         <label class="control-label">Invoice Date:</label>
                                     </div>
                                     <div class="col-md-8 align-left">
                                         <div class="input-group date date-container">
                                             <input type="text" class="form-control" ng-model="SaleInvoice.InvoiceDateST"><span class="input-group-addon"><i class="glyphicon glyphicon-th"></i></span>
                                         </div>
                                     </div>
                                 </div>
                             </div>
                             <div class="col-md-12">
                                 <div class="col-md-5 align-left">
                                     <div class="col-md-2 text-right" style="width:30%">
                                         <label class="control-label">Customer:</label>
                                     </div>
                                     <div class="col-md-8 align-left">
                                         <div class="input-group">
                                             <input type="text" ng-model="SaleInvoice.CustomerName" class="form-control" ng-keydown="SearchKeyDownBuyer($event)" placeholder="Type Customer Name & Press Enter" required />
                                             <span class="input-group-btn">
                                                 <button style="margin-left:3px" type="button" class="btn btn-sm" aria-label="left Align" ng-click="ClearBuyer()">C </button>
                                                 <button style="margin-left:3px" type="button" class="btn btn-sm" aria-label="Left Align" ng-click="PickBuyer()"> <span class="glyphicon glyphicon-search" aria-hidden="true"></span></button>
                                             </span>
                                         </div>
                                     </div>
                                 </div>
                                 <div class="col-md-5 align-left">
                                     <div class="col-md-4 text-right">
                                         <label class="control-label">CT Person:</label>
                                     </div>
                                     <div class="col-md-8 align-left">
                                         @*<select ng-model="SaleInvoice.ContactPersonID" class="form-control" ng-options="oItem.ContactPersonnelID as oItem.Name for oItem in ContactPersons">
                                             <option value="">--Contact Person--</option>
                                         </select>*@
                                         <div class="input-group">
                                             <select class="form-control" ng-model="SaleInvoice.ContactPersonID" ng-options="oItem.ContactPersonnelID as oItem.Name for oItem in ContactPersonnels" ng-disabled="disabled">
                                                 <option value="">---Select Type---</option>
                                             </select>
                                             <span class="input-group-btn">
                                                 <button type="button" class="btn btn-sm" aria-label="left Align" ng-click="NewContactPerson()" ng-disabled="disabled">
                                                     <span class="glyphicon glyphicon-plus" aria-hidden="true"></span>
                                                 </button>
                                                 <button type="button" class="btn btn-sm" aria-label="left Align" ng-click="GetContactPersonel()" ng-disabled="disabled">
                                                     <span class="glyphicon glyphicon-refresh" aria-hidden="true"></span>
                                                 </button>
                                                 <span style="margin-left:2px;"></span>

                                             </span>
                                         </div>
                                     </div>
                                 </div>
                             </div>
                             <div class="col-md-12">
                                 <div class="col-md-5 align-left">
                                     <div class="col-md-4 text-right">
                                         <label class="control-label">PI No:</label>
                                     </div>
                                     <div class="col-md-8 align-left">
                                         <div class="input-group">
                                             <input type="text" ng-model="SaleInvoice.PINo" class="form-control" ng-keydown="SearchKeyDownSQ($event)" placeholder="Type PI No & Press Enter" required />
                                             <span class="input-group-btn">
                                                 <button style="margin-left:3px" type="button" class="btn btn-sm" aria-label="left Align" ng-click="ClearSalesQuotation()">C </button>
                                                 <button style="margin-left:3px" type="button" class="btn btn-sm" aria-label="Left Align" ng-click="PickSalesQuotation()"> <span class="glyphicon glyphicon-search" aria-hidden="true"></span></button>
                                             </span>
                                         </div>
                                     </div>
                                 </div>
                                 <div class="col-md-5 align-left">
                                     <div class="col-md-4 text-right">
                                         <label class="control-label">MKT Person:</label>
                                     </div>
                                     <div class="col-md-8 align-left">
                                         <input type="text" ng-model="SaleInvoice.ReceivedOnName" class="form-control" placeholder="Marketing Person" required />
                                     </div>
                                 </div>
                             </div>
                             <div class="col-md-12">
                                 <div class="col-md-5 align-left">
                                     <div class="col-md-4 text-right">
                                         <label class="control-label">Quotation:</label>
                                     </div>
                                     <div class="col-md-8 align-left">
                                         <input ng-model="SaleInvoice.SQNo" class="form-control" disabled />
                                     </div>
                                 </div>
                                 <div class="col-md-5 align-left">
                                     <div class="col-md-4 text-right">
                                         
                                     </div>
                                     <div class="col-md-8 align-left">
                                        
                                     </div>
                                 </div>
                             </div>
                         </div>
                      </fieldset>
                </div>

                @*VEHICLE DETAILS*@
                <div class="col-md-12 align-left">
                    <fieldset style="padding: 2% 2% 2% 10%">
                        <legend style="padding-left:-40px">Vehicle Details: </legend>
                        <div class="row">
                            <div class="col-md-12">
                                <div class="col-md-5 align-left">
                                    <div class="col-md-4 text-right">
                                        <label class="control-label">Chassis No:</label>
                                    </div>
                                    <div class="col-md-8 align-left">
                                        <input ng-model="SaleInvoice.ChassisNo" class="form-control" placeholder="Chasiss No" disabled />
                                    </div>
                                </div>
                                <div class="col-md-5 align-left">
                                    <div class="col-md-4 text-right">
                                        <label class="control-label">Engine No:</label>
                                    </div>
                                    <div class="col-md-8 align-left">
                                        <input ng-model="SaleInvoice.EngineNo" class="form-control" placeholder="Engine No" disabled />
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-12">
                                <div class="col-md-5 align-left">
                                    <div class="col-md-4 text-right">
                                        <label class="control-label">Komm No:</label>
                                    </div>
                                    <div class="col-md-8 align-left">
                                        <input ng-model="SaleInvoice.KommNo" class="form-control" placeholder="Komm No" disabled />
                                    </div>
                                </div>
                                <div class="col-md-5 align-left">
                                    <div class="col-md-4 text-right">
                                        <label class="control-label">Model No:</label>
                                    </div>
                                    <div class="col-md-8 align-left">
                                        <input ng-model="SaleInvoice.ModelNo" class="form-control" placeholder="Model No" disabled />
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-12">
                                <div class="col-md-5">
                                    <div class="col-md-4 text-right">
                                        <label class="control-label">Exterior Color:</label>
                                    </div>
                                    <div class="col-md-8 text-left">
                                        <input ng-model="SaleInvoice.ExteriorColorName" placeholder="Exterior Color Name" class="form-control" disabled />
                                    </div>
                                </div>
                                <div class="col-md-5">
                                    <div class="col-md-4 text-right">
                                        <label class="control-label">Interior Color:</label>
                                    </div>
                                    <div class="col-md-8 text-left">
                                        <input ng-model="SaleInvoice.InteriorColorName" placeholder="Interior Color Name" class="form-control" disabled />
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-12">
                                <div class="col-md-5 align-left">
                                    <div class="col-md-2 text-right" style="width:30%">
                                        <label class="control-label">Product:</label>
                                    </div>
                                    <div class="col-md-8 align-left">
                                        <div class="input-group">
                                            <input type="text" ng-model="SaleInvoice.ProductName" class="form-control" ng-keydown="SearchKeyDownProduct($event)" placeholder="Type Product Name & Press Enter" required />
                                            <span class="input-group-btn">
                                                <button style="margin-left:3px" type="button" class="btn btn-sm" aria-label="left Align" ng-click="ClearProduct()">C </button>
                                                <button style="margin-left:3px" type="button" class="btn btn-sm" aria-label="Left Align" ng-click="PickProduct()"> <span class="glyphicon glyphicon-search" aria-hidden="true"></span></button>
                                            </span>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-5">
                                    <div class="col-md-4 text-right">
                                        <label class="control-label">Location:</label>
                                    </div>
                                    <div class="col-md-8 text-left">
                                        <select ng-model="SaleInvoice.VehicleLocation" class="form-control" ng-options="oItem.id as oItem.Value for oItem in VehicleLocations">
                                            <option value="">--Vehicle Location--</option>
                                        </select>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-12">
                                <div class="col-md-5">
                                    <div class="col-md-4 text-right">
                                        <label class="control-label">Order PR-No:</label>
                                    </div>
                                    <div class="col-md-8 text-left">
                                        <input type="text" ng-model="SaleInvoice.PRNo" class="form-control" placeholder="Order PR-No" />
                                    </div>
                                </div>
                                <div class="col-md-5">
                                    <div class="col-md-4 text-right">
                                        <label class="control-label">Instruction:</label>
                                    </div>
                                    <div class="col-md-8 text-left">
                                        <input type="text" ng-model="SaleInvoice.SpecialInstruction" class="form-control" placeholder="Special Instruction" />
                                    </div>
                                </div>
                            </div>
                        </div>
                    </fieldset>
                </div>

                @*DELIVERY AHREEMENT*@
                <div class="col-md-12 align-left">
                    <fieldset style="padding: 2% 2% 2% 10%">
                        <legend>Delivery Agreement: </legend>
                        <div class="row">
                            <div class="col-md-12">
                                <div class="col-md-3 text-right" style="margin-left:-8%">
                                    <label class="control-label">ETA Agreement:</label>
                                </div>
                                <div class="col-md-8 text-left" style="padding-right:3%">
                                    <input type="text" ng-model="SaleInvoice.ETAAgreement" class="form-control" placeholder="ETA Agreement" />
                                </div>
                            </div>
                            <div class="col-md-12">
                                <div class="col-md-3 text-right" style="margin-left:-8%">
                                    <label class="control-label">ETA Weeks:</label>
                                </div>
                                <div class="col-md-8 text-left" style="padding-right:3%">
                                    <input type="text" ng-model="SaleInvoice.ETAWeeks" class="form-control number" placeholder="ETA Weeks" />
                                </div>
                            </div>
                        </div>
                    </fieldset>
                </div>

                @*PRICE*@
                <div class="col-md-12 align-left">
                    <fieldset style="padding: 2% 2% 2% 10%">
                        <legend>Price : </legend>
                        <div class="col-md-12">
                            <div class="col-md-3 text-right" style="margin-left:-8%">
                                <label class="control-label">Currency :</label>
                            </div>
                            <div class="input-group col-md-4 text-left">
                                <select style="width:40%" ng-model="SaleInvoice.CurrencyID" class="form-control" ng-options="oItem.CurrencyID as oItem.CurrencyName for oItem in CurrencyList" ng-change="CurrencyChange()">
                                    <option value="">--Select Currency--</option>
                                </select>
                                <input type="text" ng-model="SaleInvoice.CRate" class="form-control input-sm text-right number" style="height:25px; width:60%" placeholder="Convertion Rate" ng-disabled="BaseCurrencyID==SaleInvoice.CurrencyID" />
                            </div>
                        </div>
                        <div class="col-md-12">
                            <div class="col-md-3 text-right" style="margin-left:-8%">
                                <label class="control-label">Vat Amount:</label>
                            </div>
                            <div class="col-md-4 text-left">
                                <input type="text" ng-model="SaleInvoice.VatAmount" class="form-control input-sm text-right number" ng-change="SetNetAmount()" style="height:25px" />
                            </div>
                            <div class="col-md-6 text-left">
                                <input ng-model="SaleInvoice.VatAmountInWord" class="form-control input-sm text-left" style="height:25px; width:124%" disabled />
                            </div>
                        </div>
                        <div class="col-md-12">
                            <div class="col-md-3 text-right" style="margin-left:-8%">
                                <label class="control-label">TDS Amount:</label>
                            </div>
                            <div class="col-md-4 text-left">
                                <input type="text" ng-model="SaleInvoice.TDSAmount" class="form-control input-sm text-right number" ng-change="SetNetAmount()" style="height:25px" />
                            </div>
                            <div class="col-md-6 text-left">
                                <input ng-model="SaleInvoice.TDSAmountInWord" class="form-control input-sm text-left" style="height:25px; width:124%" disabled />
                            </div>
                        </div>
                        <div class="col-md-12">
                            <div class="col-md-3 text-right" style="margin-left:-8%">
                                <label class="control-label">Registration Fee:</label>
                            </div>
                            <div class="col-md-4 text-left">
                                <input type="text" ng-model="SaleInvoice.RegistrationFee" class="form-control input-sm text-right number" ng-change="SetNetAmount()" style="height:25px" />
                            </div>
                            <div class="col-md-6 text-left">
                                <input ng-model="SaleInvoice.RegistrationFeeInWord" class="form-control input-sm text-left" style="height:25px; width:124%" disabled />
                            </div>
                        </div>
                        <div class="col-md-12">
                            <div class="col-md-3 text-right" style="margin-left:-8%">
                                <label class="control-label">OTR Amount:</label>
                            </div>
                            <div class="col-md-4 text-left">
                                <input type="text" ng-model="SaleInvoice.OTRAmount | number:2" class="form-control input-sm text-right number" ng-change="SetNetAmount()" style="height:25px" />
                            </div>
                            <div class="col-md-6 text-left">
                                <input ng-model="SaleInvoice.OTRAmountInWord" class="form-control input-sm text-left" style="height:25px; width:124%" disabled />
                            </div>
                        </div>
                        <div class="col-md-12">
                            <div class="col-md-3 text-right" style="margin-left:-8%">
                                <label class="control-label">Discount Amount:</label>
                            </div>
                            <div class="col-md-4 text-left">
                                <input type="text" ng-model="SaleInvoice.DiscountAmount" class="form-control input-sm text-right number" ng-change="SetNetAmount()" style="height:25px" />
                            </div>
                            <div class="col-md-6 text-left">
                                <input ng-model="SaleInvoice.DiscountAmountInWord" class="form-control input-sm text-left" style="height:25px; width:124%" disabled />
                            </div>
                        </div>
                        <div class="col-md-12">
                            <div class="col-md-3 text-right" style="margin-left:-8%">
                                <label class="control-label">Sale Amount:</label>
                            </div>
                            <div class="col-md-4 text-left">
                                <input type="text" ng-model="SaleInvoice.NetAmount | number:2" class="form-control input-sm text-right number" ng-change="SetNetAmount()" style="height:25px" />
                            </div>
                            <div class="col-md-6 text-left">
                                <input ng-model="SaleInvoice.NetAmountInWord" class="form-control input-sm text-left" style="height:25px; width:124%" disabled />
                            </div>
                        </div>

                        <div class="col-md-12">
                            <div class="col-md-3 text-right" style="margin-left:-8%">
                                <label class="control-label">PDI Charge:</label>
                            </div>
                            <div class="col-md-4 text-left">
                                <input type="text" ng-model="SaleInvoice.PDIChargeAmount" class="form-control input-sm text-right number" ng-change="SetNetAmount()" style="height:25px" />
                            </div>
                            <div class="col-md-6 text-left">
                                <input ng-model="SaleInvoice.PDIChargeAmountInWord" class="form-control input-sm text-left" style="height:25px; width:124%" disabled />
                            </div>
                        </div>
                        <div class="col-md-12">
                            <div class="col-md-3 text-right" style="margin-left:-8%">
                                <label class="control-label">Free Service Charge:</label>
                            </div>
                            <div class="col-md-4 text-left">
                                <input type="text" ng-model="SaleInvoice.FreeServiceChargeAmount" class="form-control input-sm text-right number" ng-change="SetNetAmount()" style="height:25px" />
                            </div>
                            <div class="col-md-6 text-left">
                                <input ng-model="SaleInvoice.FreeServiceChargeAmountInWord" class="form-control input-sm text-left" style="height:25px; width:124%" disabled />
                            </div>
                        </div>

                    </fieldset>
                </div>

                @*Sales Terms*@
                <div class="col-md-12 align-left">
                    <fieldset style="padding: 2% 2% 2% 10%">
                        <legend>Seals Terms :</legend>
                        <div class="col-md-12" style="margin-left:-8%">
                            <div class="col-md-3 align-right">
                                <label class="control-label">Advance Date:</label>
                            </div>
                            <div class="col-md-8">
                                <div class="col-md-6" style="text-align:right;" style="margin-left: -2%; padding-left:5%">
                                    <div class="input-group date date-container">
                                        <input type="text" class="form-control" ng-model="SaleInvoice.AdvanceDateST"><span class="input-group-addon"><i class="glyphicon glyphicon-th"></i></span>
                                    </div>
                                </div>
                                <div class="col-md-2" style="text-align:right;">

                                </div>
                                <div class="col-md-4">

                                </div>
                            </div>
                        </div>
                        <div class="col-md-12" style="margin-left:-8%">
                            <div class="col-md-2 text-right">
                                <label class="control-label">Advance Amount :</label>
                            </div>
                            <div class="col-md-9 align-left">
                                <div class="col-md-3 text-right">
                                    <input type="text" ng-model="SaleInvoice.AdvanceAmount" id="AdvanceAmount" ng-change="AdvanceAmountChange(1)" ng-keyup="AdvanceAmountChange(1)" class="form-control number" />
                                </div>
                                <div class="col-md-2 text-left">
                                    <div class="col-md-3">
                                        <input type="text" value="%" style="width:130%"class="form-control" disabled></input>
                                    </div>
                                    <div class="col-md-9">
                                        <input type="text" id="AdvanceAmountInPercent" ng-model="SaleInvoice.AdvanceAmountInPercent" ng-change="AdvanceAmountChange(0)" ng-keyup="AdvanceAmountChange(0)" class="form-control number" />
                                    </div>
                                </div>
                                <div class="col-md-7 text-left" style="padding-right:1.5%; margin-left:-1.2%">
                                    <input ng-model="SaleInvoice.AdvanceAmountInWord" style="width:118.7%" class="form-control" disabled />
                                </div>
                            </div>
                        </div>
                        <div class="col-md-12" style="margin-left:-8%">
                            <div class="col-md-2 text-right">
                                <label class="control-label">Due Amount :</label>
                            </div>
                            <div class="col-md-9 align-left">
                                <div class="col-md-5 align-left" style="margin-left:-0.6%">
                                    <input ng-model="SaleInvoice.DueAmount" class="form-control number" disabled />
                                </div>
                                <div class="col-md-7 align-left" style="padding-right:1.5%; margin-left:-0.5%">
                                    <input ng-model="SaleInvoice.DueAmountInWord" style="width:118.7%" class="form-control" disabled />
                                </div>
                            </div>
                        </div>
                        <div class="col-md-12 text-right" style="margin-left:-8%">
                            <div class="col-md-2">
                                <label class="control-label">Payment Mode :</label>
                            </div>
                            <div class="col-md-9">
                                <div class="col-md-5" style="margin-left:-0.4%">
                                    <select ng-model="SaleInvoice.PaymentMode" class="form-control" ng-change="PaymentMode()" ng-options="oItem.id as oItem.Value for oItem in PaymentModes">
                                        <option value="">--Payment Modes--</option>
                                    </select>
                                </div>
                                <div class="col-md-1 text-right" style="margin-left:-0.7%">
                                    <input class="form-control text-right" ng-model="lblPaymantMode" style="font-weight:bold;" disabled />
                                </div>
                                <div class="col-md-3 text-right" >
                                    <input type="text" id="SaleInvoice.ChequeNo" ng-model="SaleInvoice.ChequeNo" class="form-control" />
                                </div>
                                <div class="col-md-4">
                                    <div class="col-md-5  text-right">
                                        <input class="form-control" ng-model="lblPaymantDate" style="font-weight:bold" disabled/>
                                    </div>
                                    <div class="col-md-10" style="text-align:right; margin-right:-40%; width:100%">
                                        <div class="input-group date date-container">
                                            <input type="text" class="form-control" ng-model="SaleInvoice.AdvanceDateST">
                                            <span class="input-group-addon"><i class="glyphicon glyphicon-th"></i></span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-12" style="margin-left:-8%">
                            <div class="col-md-2 text-right">
                                <label class="control-label">Bank :</label>
                            </div>
                            <div class="col-md-8 align-left">
                                <div class="col-md-6 align-left" style="margin-left:-0.4%">
                                    <div class="input-group">
                                        <input type="text" ng-model="SaleInvoice.BankName" class="form-control" ng-keydown="SearchKeyDownBank($event)" placeholder="Type Sales Quotation No & Press Enter" required />
                                        <span class="input-group-btn">
                                            <button style="margin-left:3px" type="button" class="btn btn-sm" aria-label="left Align" ng-click="ClearBank()">C </button>
                                            <button style="margin-left:3px" type="button" class="btn btn-sm" aria-label="Left Align" ng-click="PickBank()"> <span class="glyphicon glyphicon-search" aria-hidden="true"></span></button>
                                        </span>
                                    </div>
                                </div>
                                <div class="col-md-1 text-right">
                                    <input id="ReceviedBy" class="form-control text-right" value="R/By:"  style="font-weight:bold; width:113% "disabled />
                                </div>
                                <div class="col-md-5 align-left" style="padding-left:1.7%;">
                                    <div class="input-group" style=" width: 181%">
                                        <input type="text" ng-model="SaleInvoice.ReceivedByName" class="form-control" ng-keydown="SearchKeyDownReceivedBy($event)" placeholder="Type Sales Quotation No & Press Enter" required />
                                        <span class="input-group-btn">
                                            <button style="margin-left:3px" type="button" class="btn btn-sm" aria-label="left Align" ng-click="ClearReceivedBy()">C </button>
                                            <button style="margin-left:3px" type="button" class="btn btn-sm" aria-label="Left Align" ng-click="PickReceivedBy()"> <span class="glyphicon glyphicon-search" aria-hidden="true"></span></button>
                                        </span>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-12" style="margin-left:-8%">
                            <div class="col-md-2 text-right">
                                <label class="control-label">Comments :</label>
                            </div>
                            <div class="col-md-8 align-left" style="margin-left:0%; padding-right:4.5%">
                                <input type="text" ng-model="SaleInvoice.Remarks" class="form-control" style=" width: 132%;"/>
                            </div>
                        </div>
                    </fieldset>
                </div>

                <div class="col-md-12 align-left">
                    <fieldset style="padding: 2% 2% 2% 10%">
                        <legend>Attachments:</legend>
                        <div class="col-md-12">
                            <div class="col-md-2 align-left">
                            </div>
                            <div class="col-md-8">
                                <div class="col-md-6" style="text-align:left;">
                                    <input type="radio" ng-model="SaleInvoice.AttachmentDoc" name="AttachmentDoc" value="1">Proforma Invoice
                                    @*<label class="control-label">Attachments:</label>*@
                                </div>
                                <div class="col-md-2" style="text-align:right;">
                                    @*<input type="radio" ng-model="myVar" value="Proforma Invoice">*@
                                </div>
                                <div class="col-md-4">
                                    @*<input type="radio" ng-model="myVar" value="Cheque/PO">Cheque/PO*@
                                    <input type="radio" ng-model="SaleInvoice.AttachmentDoc" value="2" name="AttachmentDoc">Cheque/PO
                                </div>
                            </div>
                        </div>
                </div>
            </div>
        </div>
        <div style="font-family:Tahoma;text-align:center;height:10%" class="regionVR">
            <fieldset style="height:60px;">
                <legend>Action</legend>
                <div class="row col-md-12 text-right">
                    <button type="button" class="btn btn-sm" aria-label="Left Align" ng-hide="btnSave" ng-click="Save()"> <span class="glyphicon glyphicon-floppy-disk" aria-hidden="true"> <label id="lblSave">Save</label></span> </button>
                    <button type="button" id="btnclose" class="btn btn-sm" aria-label="Left Align" ng-click="Close()"> <span class="glyphicon glyphicon-remove" aria-hidden="true"> Close</span> </button>
                </div>
            </fieldset>
        </div>
    </div>
   
</body>
</html>
<style type="text/css">
    .regionVR .form-horizontal .control-label {
        padding-top: 1px;
    }
    .regionVR .form-control {
        height: 24px;
        padding: 0px 6px;
        font-size: 12px;
    }

    .regionVR .col-md-12 {
        width: 100%;
        padding-right: 5px;
        padding-left: 5px;
        margin-bottom: 3px;
    }

    .regionVR .col-md-7 {
        width: 60%;
        padding-right: 5px;
        padding-left: 5px;
    }
    .regionVR .col-md-5 {
        width: 40%;
        padding-right: 5px;
        padding-left: 5px;
    }

     .regionVR .col-md-4 {
        width: 30%;
        padding-right: 5px;
        padding-left: 5px;
    }
    
      .regionVR .col-md-2 {
        width: 20%;
        padding-right:5px;
        padding-left:5px;
    }
         .regionVR .col-md-1 {
        width: 10%;
        padding-right:5px;
        padding-left:5px;
    }
       .regionVR .col-md-10 {
        width: 84%;
        padding-right:8px;
        padding-left: 5px;
    }
    
    .regionVR .col-md-8 {
        width: 70%;
        padding-right: 5px;
        padding-left: 5px;
    }
    
    .regionVR .col-md-9 {
        width: 80%;
        padding-right: 5px;
        padding-left: 5px;
    }
 
     .regionVR .col-md-3 {
        width: 20%;
        padding-right:3px;
        padding-left:3px;
    }
     .regionVR .col-md-6 {
        width: 45%;
        padding-right:3px;
        padding-left:3px;
    }
     
    .regionVR .btn-sm {
        padding: 2px 8px;
    }

    .regionVR .input-group-addon {
        padding: 2px 5px;
    }

    .ui-grid-top-panel {
        background: linear-gradient(to bottom,#EFF5FF 0,#E0ECFF 100%);
    }
</style>
<script type="text/javascript">
    var oSaleInvoice =@Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(Model));
    var oQuotationTypes = @Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(ViewBag.QuotationTypes));
    var oCurrencyList = @Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(ViewBag.CurrencyList));
    var oPaymentModes = @Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(ViewBag.PaymentModes));
    var oVehicleLocations = @Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(ViewBag.VehicleLocations));
    var oPaymentMethods = @Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(ViewBag.PaymentMethods));
    var nBaseCurrencyID = @Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(ViewBag.BaseCurrencyID));
    $(".number-int").icsNumberField({ min: 0, precision: 0 });
    $(".number-precision").icsNumberField({ min: 0,precision: 2 });

    var SaleInvoiceApp = angular.module('SaleInvoiceApp', ['ngAnimate', 'ui.bootstrap','ui.grid', 'ui.grid.selection', 'ui.grid.edit', 'ui.grid.rowEdit','ui.grid.cellNav', 'ms.service']);
    SaleInvoiceApp.controller('SaleInvoiceController', function ($scope,$http,$uibModal,$log,uiGridConstants,msModal,userSession,icsMethod,msGridControl) {
        debugger;
        $('#AdvanceAmount').icsCurrencyBox();
        $('#AdvanceAmountInPercent').icsCurrencyBox();
        //$('#txtVatAmount').icsCurrencyBox(2);
        //$('#DueAmount').icsCurrencyBox();

        $('.date-container').datepicker({
            format: "dd M yyyy",
            calendarWeeks: true,
            autoclose: true,
            todayHighlight: true
        });

        $scope.BaseCurrencyID=nBaseCurrencyID;
        $scope.SaleInvoice=oSaleInvoice;
        $scope.SaleInvoice.BUID=sessionStorage.getItem('BUID');
        if(sessionStorage.getItem("SaleInvoiceHeader")=="Approve Sale Invoice")
        {
            $('#lblSave').html('Approve');
        }
        if(sessionStorage.getItem("SaleInvoiceHeader")=="View Sales Invocie")
        {
            $('#lblSave').hide(); $scope.btnSave=true;
        }

        $scope.QuotationTypes = oQuotationTypes;
        $scope.CurrencyList = oCurrencyList;
        $scope.PaymentModes = oPaymentMethods;
        $scope.VehicleLocations = oVehicleLocations;

        $scope.lblPaymantMode="C/No: ";
        $scope.lblPaymantDate="C/Date: ";
        
        $scope.CurrencyChange=function()
        {
            if($scope.BaseCurrencyID==$scope.SaleInvoice.CurrencyID)
                $scope.SaleInvoice.CRate=1;
        }
        $scope.CurrencyChange();

        $scope.PaymentMode= function()
        {
            debugger;
            if($scope.SaleInvoice.PaymentMode==2)
            {
                $scope.lblPaymantMode="C/No: ";
                $scope.lblPaymantDate="C/Date: ";
            }
            else
            {
                $scope.lblPaymantMode="P/No: ";
                $scope.lblPaymantDate="P/Date: ";
            }
        }
        debugger;

        $scope.AdvanceAmountChange= function(nAPC)
        {
            debugger;
            
            var nCRate= ($scope.SaleInvoice.CRate<=0? 1 : $scope.SaleInvoice.CRate);

            if(nAPC==0)
                $scope.SaleInvoice.AdvanceAmount= $scope.SaleInvoice.OTRAmount*($scope.SaleInvoice.AdvanceAmountInPercent/100);
            if(nAPC==1)
                $scope.SaleInvoice.AdvanceAmountInPercent= parseFloat($scope.SaleInvoice.AdvanceAmount/$scope.SaleInvoice.OTRAmount)*100;
            $scope.SaleInvoice.AdvanceAmountInWord= TakaWords(parseFloat($scope.SaleInvoice.AdvanceAmount*nCRate));

            $scope.SaleInvoice.DueAmount= parseFloat($scope.SaleInvoice.OTRAmount)-parseFloat($scope.SaleInvoice.AdvanceAmount);
            $scope.SaleInvoice.DueAmountInWord= TakaWords(parseFloat($scope.SaleInvoice.DueAmount*nCRate));
        }
        $scope.AdvanceAmountChange(1);

        $scope.SetNetAmount=function ()
        {
            debugger;
            var nCRate= ($scope.SaleInvoice.CRate<=0? 1 : $scope.SaleInvoice.CRate);

            $scope.SaleInvoice.VatAmountInWord= TakaWords(parseFloat($scope.SaleInvoice.VatAmount));
            $scope.SaleInvoice.RegistrationFeeInWord= TakaWords(parseFloat($scope.SaleInvoice.RegistrationFee));
            $scope.SaleInvoice.TDSAmountInWord= TakaWords(parseFloat($scope.SaleInvoice.TDSAmount));
            $scope.SaleInvoice.OTRAmountInWord= TakaWords(parseFloat($scope.SaleInvoice.OTRAmount*nCRate));
            $scope.SaleInvoice.DiscountAmountInWord= TakaWords(parseFloat($scope.SaleInvoice.DiscountAmount*nCRate));
            $scope.SaleInvoice.NetAmount =  parseFloat($scope.SaleInvoice.OTRAmount)-parseFloat($scope.SaleInvoice.DiscountAmount);
            $scope.SaleInvoice.NetAmountInWord= TakaWords(parseFloat($scope.SaleInvoice.NetAmount*nCRate));
            $scope.SaleInvoice.PDIChargeAmountInWord= TakaWords(parseFloat($scope.SaleInvoice.PDIChargeAmount));
            $scope.SaleInvoice.FreeServiceChargeAmountInWord= TakaWords(parseFloat($scope.SaleInvoice.FreeServiceChargeAmount));
        }
        $scope.SetNetAmount(0);
        $scope.GetContractPersons= function()
        {
            debugger;
            if($scope.SaleInvoice.ContractorID<=0)
            {
                //alert('Please Pick a Contact Person!!');
                return;
            }

            var oMarketing= {
                ContractorID:$scope.SaleInvoice.ContractorID
            };
            var config = { headers: { 'Content-Type': 'application/x-www-form-urlencoded;charset=utf-8;' } };
            $http.post(sessionStorage.getItem('BaseAddress')+'/ContractorPersonal/GetsByBuyer',$.param(oMarketing), config).then(
                                function (response)
                                {
                                    debugger;
                                    result=jQuery.parseJSON(response.data);
                                    $scope.ContactPersons=result;
                                }, function () {
                                    $log.info('GetSaleInvoiceDetails Dismissed at: ' + new Date());
                                });
        }
        $scope.GetContractPersons();

        //Contact Personnal 
        $scope.NewContactPerson = function NewContactPerson(nConType) {
            if ($scope.SaleInvoice.ContractorID <= 0) {
                alert("Please Pick A Customer And Try Again!")
                return;
            }

            sessionStorage.setItem("ContractorBackTo", "");
            sessionStorage.setItem("SelectedRowIndex", 0);
            sessionStorage.setItem("ContractorHeader", "Add Contact Personnel");
            window.open(_sBaseAddress + "/Contractor/ViewContactPersonnel?id=" + $scope.SaleInvoice.ContractorID, "_blank");
        }
        $scope.GetContactPersonel = function ()
        {
            $scope.ContactPersonnels = [];
            debugger;
            var oContractor = {
                ContractorID: $scope.SaleInvoice.ContractorID
            };
            var config = { headers: { 'Content-Type': 'application/x-www-form-urlencoded;charset=utf-8;' } };
            $http.post(sessionStorage.getItem('BaseAddress') + '/Contractor/GetContactPersonnels', $.param(oContractor), config).then(
                                function (response) {
                                    debugger;
                                    result = JSON.parse(response.data);
                                    $scope.ContactPersonnels = result;
                                }, function () {
                                    $log.info('GetVehicleOrderDetails Dismissed at: ' + new Date());
                                });
        }
        $scope.GetContactPersonel();
        //Vechile Parts
        $scope.PickProduct= function ()
        {
            var sProductName =  $.trim($scope.SaleInvoice.ProductName);

            var nBUID = parseInt(sessionStorage.getItem("BUID"));
            var oProduct = { BUID: nBUID, ProductName: sProductName};
            debugger;
            var config = { headers: { 'Content-Type': 'application/x-www-form-urlencoded;charset=utf-8;' } };
            $http.post(sessionStorage.getItem('BaseAddress')+'/SaleInvoice/GetProducts',$.param(oProduct), config).then(
                        function (response)
                        {
                            debugger;
                            var oColumns = [];
                            var oColumn = { field: 'ProductCode', name: 'Code',width: '25%'  };oColumns.push(oColumn);
                            oColumn = { field: 'ProductName', name: 'Name',width: '40%', enableSorting: false  };oColumns.push(oColumn);
                            oColumn = { field: 'ProductCategoryName', name: 'Category',width: '24%', enableSorting: false  };oColumns.push(oColumn);
                    
                            var results=(response.data);
                            var modalObj={
                                size:'md',
                                modalcontroller:'',
                                appcontroller:'',
                                objs:results,
                                multiSelect:false,
                                pickertitle:'Product List',
                                searchingbyfieldName:'ProductName',
                                columns:oColumns
                            }
                            var modalInstance=msModal.Instance(modalObj);
                            modalInstance.result.then(function (result)
                            {
                                $scope.SaleInvoice.ProductID = result.ProductID;
                                $scope.SaleInvoice.ProductName=result.ProductName;
                            }, function () {
                                $log.info('Modal dismissed at: ' + new Date());
                            });
                        },
                            function (response) { alert(jQuery.parseJSON(response.data).Message);}
                    );

        };
        $scope.SearchKeyDownProduct = function (e) {
            //debugger;
            var code = (e.keyCode ? e.keyCode : e.which);
            if (code == 13) {
                var Product = $.trim($scope.SaleInvoice.ProductName);
                if(Product=="" || Product==null)
                {
                    alert("Type Product Name/Code and Press Enter");
                    return;
                }
                $scope.PickProduct();
            }else if (code == 8) //backspace=8
            {
                //debugger;
                $scope.SaleInvoice.ProductID = 0;
                $scope.SaleInvoice.ProductName = "";
            }
        }
        $scope.ClearProduct= function ()
        {
            $scope.SaleInvoice.ProductID = 0;
            $scope.SaleInvoice.ProductName = "";
        }
        //customer
        $scope.PickBuyer= function ()
        {
            var oContractor = {
                Params: '2' + '~' + $.trim($scope.SaleInvoice.CustomerName)+'~'+sessionStorage.getItem('BUID')
            };
            var config = { headers: { 'Content-Type': 'application/x-www-form-urlencoded;charset=utf-8;' } };
            $http.post(_sBaseAddress+'/Contractor/ContractorSearchByNameType',$.param(oContractor), config).then(
                                function (response)
                                {
                                    var oColumns = [];
                                    var oColumn = { field: 'ContractorID', name: 'Code',width: '20%'  };oColumns.push(oColumn);
                                    oColumn = { field: 'Name', name: 'Applicant Name',width: '50%', enableSorting: false  };oColumns.push(oColumn);
                                    oColumn = { field: 'Address', name: 'Address',width: '30%', enableSorting: false  };oColumns.push(oColumn);
                                    var results=response.data;
                                    var modalObj={
                                        size:'md',
                                        modalcontroller:'ModalCommonListCtrl',
                                        appcontroller:'SaleInvoiceController',
                                        objs:results,
                                        multiSelect:false,
                                        pickertitle:'Applicant List',
                                        searchingbyfieldName:'Name',
                                        columns:oColumns
                                    }
                                    var modalInstance=msModal.Instance(modalObj);
                                    modalInstance.result.then(function (result)
                                    {
                                        debugger;
                                        $scope.SaleInvoice.CustomerName=result.Name;
                                        $scope.SaleInvoice.ContractorID=result.ContractorID;
                                        $scope.GetContractPersons();
                                    }, function () {
                                        $log.info('Modal dismissed at: ' + new Date());
                                    });
                                },
                                  function (response) { alert(jQuery.parseJSON(response.data).Message);}
                            );

        };
        $scope.SearchKeyDownBuyer = function (e){
            //debugger;
            var code = (e.keyCode ? e.keyCode : e.which);
            if (code == 13) {
                var RefNo = $.trim($scope.SaleInvoice.CustomerName);
                if(RefNo=="" || RefNo==null)
                {
                    alert("Type Customer Name and Press Enter");
                    return;
                }
                $scope.PickBuyer();
            }else if (code == 8) //backspace=8
            {
                //debugger;
                $scope.SaleInvoice.BuyerID=0;
            }
        };
        $scope.ClearBuyer= function ()
        {
            $scope.SaleInvoice.ContractorID=0;
            $scope.SaleInvoice.CustomerName='';
        }
        //koomfile
        $scope.PickSalesQuotation= function ()
        {
            if($scope.SaleInvoice.ContractorID<=0)
            {
                alert('Please Pick a Customer!!');
                return;
            }

            var oPI = {
                ContractorID:$scope.SaleInvoice.ContractorID
            };
            var config = { headers: { 'Content-Type': 'application/x-www-form-urlencoded;charset=utf-8;' } };
            $http.post(_sBaseAddress+'/PreInvoice/GetsPIByCustomer',$.param(oPI), config).then(
                                function (response)
                                {
                                    var oColumns = [];
                                    debugger;
                                    var oColumn = { field: 'SQNo', name: 'Quotation',width: '20%'  };oColumns.push(oColumn);
                                    oColumn = { field: 'InvoiceNo', name: 'Invoice No',width: '30%', enableSorting: false  };oColumns.push(oColumn);
                                    //oColumn = { field: 'InteriorColorName', name: 'Interior Color',width: '25%', enableSorting: false  };oColumns.push(oColumn);
                                    //oColumn = { field: 'ExteriorColorName', name: 'Exterior Color',width: '25%', enableSorting: false  };oColumns.push(oColumn);
                                    var results=jQuery.parseJSON(response.data);
                                    var modalObj={
                                        size:'md',
                                        modalcontroller:'ModalCommonListCtrl',
                                        appcontroller:'SaleInvoiceController',
                                        objs:results,
                                        multiSelect:false,
                                        pickertitle:'PI List',
                                        searchingbyfieldName:'SQNo',
                                        columns:oColumns
                                    }
                                    var modalInstance=msModal.Instance(modalObj);
                                    modalInstance.result.then(function (result)
                                    {
                                        debugger;
                                        console.log($scope.SaleInvoice);
                                        $scope.SaleInvoice.PINo=result.InvoiceNo;
                                        $scope.SaleInvoice.PIID=result.PreInvoiceID;

                                        $scope.SaleInvoice.SQNo=result.SQNo;
                                        $scope.SaleInvoice.KommNo=result.KommNo;
                                        $scope.SaleInvoice.SalesQuotationID=result.SalesQuotationID;
                                        //model
                                        $scope.SaleInvoice.ModelNo=result.ModelNo;
                                        $scope.SaleInvoice.VehicleModelID=result.VehicleModelID;
                                        //color
                                        $scope.SaleInvoice.ExteriorColorName=result.ExteriorColorName;
                                        $scope.SaleInvoice.InteriorColorName=result.InteriorColorName;
                                        $scope.SaleInvoice.ReceivedOnName=result.MarketingAccountName;
                                        $scope.SaleInvoice.ReceivedOn=result.MarketingPerson;
                                        //VehicleChassis
                                        $scope.SaleInvoice.VehicleChassisID=result.ChassisID;
                                        $scope.SaleInvoice.ChassisNo=result.ChassisNo;
                                        //VehicleEngine
                                        $scope.SaleInvoice.VehicleEngineID=result.EngineID;
                                        $scope.SaleInvoice.EngineNo=result.EngineNo;
                                        $scope.SaleInvoice.VatAmount = result.VatInPercent;
                                        $scope.SaleInvoice.RegistrationFee = result.RegistrationFeePercent;
                                        $scope.SaleInvoice.OTRAmount = result.OTRAmount;
                                        $scope.SaleInvoice.VatAmount = result.VatAmount;
                                        $scope.SaleInvoice.TDSAmount = result.TDSAmount;
                                        $scope.SaleInvoice.RegistrationFee = result.RegistrationFee;
                                        $scope.SaleInvoice.AdvanceAmount = result.AdvancePayment;
                                        $scope.SaleInvoice.SalesQuotationImageID=result.SalesQuotationImageID;
                                        // $scope.SaleInvoice.TotalAmount = result.TotalAmount;
                                        $scope.GetVehicleOrderImage(result.SalesQuotationImageID);
                                        //$scope.GetSaleInvoiceDetails();
                                        $scope.SetNetAmount();

                                    }, function () {
                                        $log.info('Modal dismissed at: ' + new Date());
                                    });
                                },
                                  function (response) { alert(jQuery.parseJSON(response.data).Message);}
                            );

        };
        $scope.SearchKeyDownSQ = function (e) {
            //debugger;
            var code = (e.keyCode ? e.keyCode : e.which);
            if (code == 13) {
                var RefNo = $.trim($scope.SaleInvoice.PINo);
                if(RefNo=="" || RefNo==null)
                {
                    alert("Type PI and Press Enter");
                    return;
                }
                $scope.PickSalesQuotation();
            }else if (code == 8) //backspace=8
            {
                //debugger;
                $scope.ClearSalesQuotation();
            }
        };
        $scope.ClearSalesQuotation= function ()
        {
            $scope.SaleInvoice.KommNo='';
            $scope.SaleInvoice.SalesQuotationID=0;
            $scope.SaleInvoice.ModelNo='';
            $scope.SaleInvoice.VehicleModelID=0;
            $scope.SaleInvoice.ExteriorColorName='';
            $scope.SaleInvoice.InteriorColorName='';
            //VehicleChassis
            $scope.SaleInvoice.ChassisNo='';
            //VehicleEngine
            $scope.SaleInvoice.EngineNo='';
            $scope.GetVehicleOrderImage(0);
        }
        //bank
        $scope.SearchKeyDownBank = function (e) {
            //debugger;
            var code = (e.keyCode ? e.keyCode : e.which);
            if (code == 13) {
                var BankName = $.trim($scope.SaleInvoice.BankName);
                if(BankName=="" || BankName==null)
                {
                    alert("Type Bank Name and Press Enter");
                }
                $scope.PickBank();
            }else if (code == 8) //backspace=8
            {
                //debugger;
                $scope.SaleInvoice.BankName='';
                $scope.SaleInvoice.BankID=0;
            }
        };
        $scope.PickBank=   function ()
        {
            var oBankBranch = {
                BranchName: $.trim($scope.SaleInvoice.BankName)
            };
            var config = { headers: { 'Content-Type': 'application/x-www-form-urlencoded;charset=utf-8;' } };
            $http.post(sessionStorage.getItem('BaseAddress')+'/BankBranch/GetsBankByBranchkName',$.param(oBankBranch), config).then(
                        function (response)
                        {
                            var oColumns = [];
                            var oColumn = { field: 'BankName', name: 'Bank Name',width: '20%'  };oColumns.push(oColumn);
                            oColumn = { field: 'BranchName', name: 'Branch Name',width: '50%', enableSorting: false  };oColumns.push(oColumn);
                            oColumn = { field: 'Address', name: 'Address',width: '30%', enableSorting: false  };oColumns.push(oColumn);
                            var results=jQuery.parseJSON(response.data);
                            var modalObj={
                                size:'md',
                                modalcontroller:'ModalCommonListCtrl',
                                appcontroller:'SaleInvoiceController',
                                objs:results,
                                multiSelect:false,
                                pickertitle:'Bank List',
                                searchingbyfieldName:'Name',
                                columns:oColumns
                            }
                            var modalInstance=msModal.Instance(modalObj);
                            modalInstance.result.then(function (result)
                            {
                                debugger;
                                $scope.SaleInvoice.BankName=result.BankName;
                                $scope.SaleInvoice.BankID=result.BankID;

                            }, function () {
                                $log.info('Modal dismissed at: ' + new Date());
                            });
                        },
                            function (response) { alert(jQuery.parseJSON(response.data).Message);}
                    );

        };
        $scope.ClearBank= function ()
        {
            $scope.SaleInvoice.BankID=0;
            $scope.SaleInvoice.BankName='';
        }

        //Received By
        $scope.PickReceivedBy= function ()
        {
            var oContractor = {
                Params: '2' + '~' + $.trim($scope.SaleInvoice.ReceivedByName)+'~'+sessionStorage.getItem('BUID')
            };
            var config = { headers: { 'Content-Type': 'application/x-www-form-urlencoded;charset=utf-8;' } };
            $http.post(_sBaseAddress+'/Contractor/ContractorSearchByNameType',$.param(oContractor), config).then(
                                function (response)
                                {
                                    debugger;
                                    var results=(response.data);
                                    if(results.length<=0 && (results[0].ErrorMessage!=null || results[0].ErrorMessage!=""))
                                    {
                                        alert(results[0].ErrorMessage); return;
                                    }
                                    console.log(results);
                                    var oColumns = [];
                                    var oColumn = { field: 'ContractorID', name: 'Code',width: '20%'  };oColumns.push(oColumn);
                                    oColumn = { field: 'Name', name: 'Applicant Name',width: '50%', enableSorting: false  };oColumns.push(oColumn);
                                    oColumn = { field: 'Address', name: 'Address',width: '30%', enableSorting: false  };oColumns.push(oColumn);

                                    var modalObj={
                                        size:'md',
                                        modalcontroller:'ModalCommonListCtrl',
                                        appcontroller:'SaleInvoiceController',
                                        objs:results,
                                        multiSelect:false,
                                        pickertitle:'Applicant List',
                                        searchingbyfieldName:'Name',
                                        columns:oColumns
                                    }
                                    var modalInstance=msModal.Instance(modalObj);
                                    modalInstance.result.then(function (result)
                                    {
                                        debugger;
                                        $scope.SaleInvoice.ReceivedByName=result.Name;
                                        $scope.SaleInvoice.ReceivedBy=result.ContractorID;
                                    }, function () {
                                        $log.info('Modal dismissed at: ' + new Date());
                                    });
                                },
                                  function (response) { alert((response.data).Message);}
                            );

        };
        $scope.SearchKeyDownReceivedBy = function (e){
            //debugger;
            var code = (e.keyCode ? e.keyCode : e.which);
            if (code == 13) {
                var RefNo = $.trim($scope.SaleInvoice.ReceivedByName);
                if(RefNo=="" || RefNo==null)
                {
                    alert("Type Customer Name and Press Enter");
                    return;
                }
                $scope.PickReceivedBy();
            }else if (code == 8) //backspace=8
            {
                //debugger;
                $scope.SaleInvoice.BuyerID=0;
            }
        };
        $scope.ClearReceivedBy= function ()
        {
            $scope.SaleInvoice.ReceivedBy=0;
            $scope.SaleInvoice.ReceivedByName='';
        }


        $scope.Save = function ()
        {
            debugger;
            if(!$scope.ValidateInput()) return;
            var oSaleInvoice= $scope.SaleInvoice;
            oSaleInvoice.InvoiceDate = new Date($scope.SaleInvoice.InvoiceDateST);
            oSaleInvoice.AdvanceDate = new Date($scope.SaleInvoice.AdvanceDateST);
            oSaleInvoice.ChequeDate = new Date($scope.SaleInvoice.ChequeDateST);
            oSaleInvoice.InvoiceStatusInInt = 1;//intialize
            //console.log(oSaleInvoice); return;
            $http.post(sessionStorage.getItem('BaseAddress')+'/SaleInvoice/Save',oSaleInvoice).then(
                        function (response)
                        {
                            debugger;
                            var oSaleInvoice= jQuery.parseJSON(response.data);
                            if (oSaleInvoice.ErrorMessage=="" || oSaleInvoice.ErrorMessage==null)
                            {
                                debugger;
                                alert("Data Save Successfully!!");
                                userSession.setData('SaleInvoiceList',oSaleInvoice);
                                userSession.previousPage();
                                //var oSaleInvoices = sessionStorage.getItem("SaleInvoiceList");
                                //var nIndex = parseInt(sessionStorage.getItem("SelectedRowIndex"));
                                //if (oSaleInvoices != null) {
                                //    oSaleInvoices = jQuery.parseJSON(oSaleInvoices);
                                //}
                                //else {
                                //    oSaleInvoices = [];
                                //}
                                //if (nIndex != -1) {
                                //    oSaleInvoices[nIndex] = oSaleInvoice;
                                //}
                                //else {
                                //    sessionStorage.setItem("SelectedRowIndex", oSaleInvoices.length);
                                //    oSaleInvoices.push(oSaleInvoice);
                                //}
                                //sessionStorage.setItem("SaleInvoices", JSON.stringify(oSaleInvoices));
                                //window.location.href = sessionStorage.getItem("BackLink");
                            }
                            else
                            {
                                alert(oSaleInvoice.ErrorMessage);
                            }

                        },
                            function (response) { alert(jQuery.parseJSON(response.data).Message);$scope.MeasurementUnits=[];}
                    );

        };
        $scope.ValidateInput =  function ()
        {
            debugger;
            if($scope.SaleInvoice.ContractorID==0)
            {
                alert('Please Pick Customer');
                return false;
            }
            if($scope.SaleInvoice.SalesQuotationID==0)
            {
                alert('Please Pick Sales Quotation');
                return false;
            }
            if($scope.SaleInvoice.CurrencyID==0)
            {
                alert('Please Select Currency');
                return false;
            }

            if($scope.SaleInvoice.AttachmentDoc=="" || $scope.SaleInvoice.AttachmentDoc=="")
            {
                alert('Please Select Attachment Type');
                return false;
            }
            return true;
        };

        if(sessionStorage.getItem("SaleInvoiceHeader")=="View Sale Invoice")
        {
            $("#divSaleInvoice :input").prop('disabled', true);
            $('#btnclose').prop('disabled', false);
        }
        $scope.Close=function ()
        {
            debugger;
            window.location.href = sessionStorage.getItem("BackLink");
        };

        $scope.GetVehicleOrderImage =function (nVehicleOrderImageID)
        {
            debugger;
            $.ajax({
                cache:true,
                type: "GET",
                url: "@(Url.Action("GetImageInBase64", "VehicleOrder"))",
                data: "id=" + nVehicleOrderImageID,
                success: function (data) {
                    $('#imgOrderImage').attr('src', "data:image/jpg;base64," + data.base64imgage );
                }
            });
        }

    });

</script>