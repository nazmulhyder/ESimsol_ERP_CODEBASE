@{
    ViewBag.Title = "Dispo Production List";
}
@model IEnumerable<ESimSol.BusinessObjects.DispoProduction>
    <div id="progressbarParent" style="width:100%;height:100%;margin:0 auto;text-align:center; margin-left: auto;margin-right: auto;left: 0;right: 0;z-index: 1;">
        <div style="margin: 0px auto;margin-top: 251px;text-align:center;width:390px;">
            <label style="font-size:18px;">Please wait</label>
            <div id="progressbar" style="width:100%;height:37px;"></div>
        </div>
    </div>
    
    <div class="menuMainCollectionTable" id="regionDispoProduction">
        <table id="tblDispoProductions" title="Dispo Production List" class="easyui-datagrid" fit="true" fitcolumns="false" rownumbers="true" pagination="true" singleselect="true" autorowheight="false" toolbar="#toolbar">
            <thead>
                <tr>
                    <th field="SCNoFull" width="11%" align="left">PO No</th>
                    <th field="SCDateSt" width="6%" align="center">PO Issue Date</th>
                    <th field="BuyerName" width="15%" align="left">Buying House</th>
                    <th field="MKTGroup" width="8%" align="left"> MKT Team</th>
                    <th field="MKTPName" width="8%" align="left"> Concern Person</th>
                    <th field="FabricNo" width="10%" align="left"> MKT Ref</th>
                    <th field="FabricReceiveDateStr" width="8%" align="left">Receive Date</th>
                    <th field="ExeNo" width="10%" align="left"> Dispo No</th>
                    <th field="StyleNo" width="10%" align="left">Style No</th>
                    <th field="BuyerReference" width="10%" align="left">Buyer Ref</th>
                    <th field="HLReference" width="10%" align="left"> Dispo No/ H/L Ref</th>
                    <th field="ColorInfo" width="10%" align="left"> Color</th>
                    <th field="Construction" width="10%" align="left"> Construction</th>
                    <th field="ProductName" width="10%" align="left">Composition</th>
                    <th field="ProcessTypeName" width="10%" align="left"> Fabric type </th>
                    <th field="FabricWeaveName" width="10%" align="left"> Weave</th>
                    <th field="Size" width="10%" align="left"> Size</th>
                    <th field="FinishTypeName" width="10%" align="left">Finish Type</th>
                    <th field="FabricWidth" width="15%" align="left">Width</th>
                    <th field="CurrentStatusSt" width="6%" align="left"> Status</th>
                    <th field="LabStatusST" width="10%" align="left">Lab Status</th>

                    <th field="Qty" width="10%" align="right" formatter="formatPrice">Qty</th>
                    <th field="QtyDispo" width="10%" align="right" formatter="formatPrice">Dispo Qty</th>
                    <th field="QtyWarp" width="10%" align="right" formatter="formatPrice">Warp Qty</th>
                    <th field="QtySizing" width="10%" align="right" formatter="formatPrice">Sizing Qty</th>
                    <th field="QtyWeaving" width="10%" align="right" formatter="formatPrice">Loom Qty</th>
                    <th field="GreyRecd" width="10%" align="right" formatter="formatPrice">Grey Rec.</th>
                    <th field="StoreRcvQty" width="10%" align="right" formatter="formatPrice">Store Rec. Qty</th>
                    <th field="DCQty" width="10%" align="right" formatter="formatPrice">Delivery Qty</th>
                    <th field="RCQty" width="10%" align="right" formatter="formatPrice">Return Qty</th>
                    <th field="StockInHand" width="10%" align="right" formatter="formatPrice">Stock in Hand</th>
                </tr>
            </thead>
        </table>
        <div id="toolbar">
            <input id="txtSearchbyPONo" type="text" placeholder="Search By PO No" style="width:120px" />
            <input id="txtSearchbyFabricNo" type="text" placeholder="Search by Ref No" style="width:120px" />
            <input id="txtHLNO" type="text" placeholder="Search by Dispo No" style="width:120px" />  @*S1810457*@
            <a id="btnAdvSearch" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-search" plain="true">Adv. Search</a>            
            <a id="btnComment" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-add" plain="true">Comments</a>
            <a id="btnSeenUnseenComment" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-search" plain="true">Seen/Unseen</a>
            <a id="btnPreviewDispo" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-print" plain="true">Preview (Dispo)</a>
            <a id="btnPreviewPO" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-print" plain="true">Preview (PO)</a>
            <a id="btnPrintXL" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-excel" plain="true">Export XL</a>
        </div>
    </div>

    <div id="winAdvSearch" class="easyui-window winClass" style="width:620px" title="Adv. Search" data-options="modal:true,closed:true,collapsible:false,minimizable:false,maximizable:false,closable:false">
        <div>
            <fieldset style="margin-bottom: 0px;">
                <legend>Searching Criteria</legend>
                <table style="width:100%;text-align:right;">
                    <tr>
                        <td style="width:20%;text-align:right;">
                            <label>P/I No :</label>
                        </td>
                        <td style=" width:30%;text-align:left;">
                            <input id="txtPINo" style="width:100%;" type="text" />
                        </td>
                        <td style=" width:20%;text-align:right;">
                            <label id="lblFabricNoAdv"> Mkt Ref No :</label>
                        </td>
                        <td style=" width:30%;text-align:left;">
                            <input id="txtFabricID" style="width:80%;" type="text" />
                        </td>
                    </tr>
                    <tr>
                        <td style="width:20%;text-align:right;">
                            <label>Construction :</label>
                        </td>
                        <td style=" width:30%;text-align:left;">
                            <input id="txtConstruction" style="width:100%;" type="text" />
                        </td>
                        <td style=" width:20%;text-align:right;">
                            <label> Composition :</label>
                        </td>
                        <td style=" width:30%;text-align:left;">
                            <input id="txtComposition" style="width:80%;" type="text" />
                        </td>
                    </tr>
                    <tr>
                        <td style="width:20%;text-align:right;">
                            <label>Finish Type :</label>
                        </td>
                        <td style=" width:30%;text-align:left;">
                            <input id="txtFinishType" style="width:100%;" type="text" />
                        </td>
                        <td style=" width:20%;text-align:right;">
                            <label> Weave :</label>
                        </td>
                        <td style=" width:30%;text-align:left;">
                            <input id="txtWeave" style="width:80%;" type="text" />
                        </td>
                    </tr>
                    <tr>
                        <td style=" width:20%;text-align:right;">
                            <label>Issue To :</label>
                        </td>
                        <td colspan="3" style=" width:80%;text-align:left;">
                            <input id="txtContractorAdvS" style="width:80%;" type="text" placeholder="Type & Press Enter" />
                            <a id="btnPickContractorAdvS" href="javascript:void(0)" class="easyui-linkbutton ics-pick" iconcls="icon-pick" plain="true"></a>
                            <a id="btnClrContractorAdvS" href="javascript:void(0)" class="easyui-linkbutton ics-pick" iconcls="icon-clear" plain="true"></a>
                        </td>
                    </tr>
                    <tr>
                        <td style=" width:20%;text-align:right;">
                            <label>Buying House :</label>
                        </td>
                        <td colspan="3" style=" width:80%;text-align:left;">
                            <input id="txtDeliverTo" style="width:80%;" type="text" placeholder="Type & Press Enter" />
                            <a id="btnPickDeliverTo" href="javascript:void(0)" class="easyui-linkbutton ics-pick" iconcls="icon-pick" plain="true"></a>
                            <a id="btnClrDeliverTo" href="javascript:void(0)" class="easyui-linkbutton ics-pick" iconcls="icon-clear" plain="true"></a>
                        </td>
                    </tr>
                    <tr>
                        <td style=" width:20%;text-align:right;">
                            <label>Mkt Account:</label>
                        </td>
                        <td colspan="3" style=" width:80%;text-align:left;">
                            <input id="txtMktAccount" class="reset-text" placeholder="Search Concern Person" style="width:80%" />
                            <a id="btnPickMktAccount" href="javascript:void(0)" class="easyui-linkbutton ics-pick" iconcls="icon-pick" plain="true"></a>
                            <a id="btnResetMktPerson" href="javascript:void(0)" class="easyui-linkbutton ics-pick" iconcls="icon-clear" plain="true"></a>
                        </td>
                    </tr>
                    <tr>
                        <td style=" width:20%;text-align:right;">
                            <label>PO Date:</label>
                        </td>
                        <td colspan="3" style=" width:80%;text-align:right;">
                            <div style="float:left; width:100%">
                                <div style="float:left; width:30%">
                                    <select style="width:95%;" id="cboPODate" onchange="DateActions_OPDate(); "></select>
                                </div>
                                <div style="float:left; width:25%; padding-left:5px;">
                                    <input id="txtFromPODate" type="text" style="width: 110px;" class="easyui-datebox" required="required" data-options="formatter:icsdateformat,parser:icsdateparser" />
                                </div>
                                <div style="float:left; width:5%; text-align:center">to</div>
                                <div style="float:left; width:25%; padding-left:5px;">
                                    <input id="txtToPODate" type="text" style="width: 110px;" class="easyui-datebox" required="required" data-options="formatter:icsdateformat,parser:icsdateparser" />
                                </div>
                            </div>
                        </td>
                    </tr>
                    <tr>
                        <td style=" width:20%;text-align:right;">
                            <label>Approve Date:</label>
                        </td>
                        <td colspan="3" style=" width:80%;text-align:right;">
                            <div style="float:left; width:100%">
                                <div style="float:left; width:30%">
                                    <select style="width:95%;" id="cboApproveDate" onchange="DateActions_ApproveDate(); "></select>
                                </div>
                                <div style="float:left; width:25%; padding-left:5px;">
                                    <input id="txtFromApproveDate" type="text" style="width: 110px;" class="easyui-datebox" required="required" data-options="formatter:icsdateformat,parser:icsdateparser" />
                                </div>
                                <div style="float:left; width:5%; text-align:center">to</div>
                                <div style="float:left; width:25%; padding-left:5px;">
                                    <input id="txtToApproveDate" type="text" style="width: 110px;" class="easyui-datebox" required="required" data-options="formatter:icsdateformat,parser:icsdateparser" />
                                </div>
                            </div>
                        </td>
                    </tr>
                    <tr>
                        <td style=" width:20%;text-align:right;">
                            <label>Received Date:</label>
                        </td>
                        <td colspan="3" style=" width:80%;text-align:right;">
                            <div style="float:left; width:100%">
                                <div style="float:left; width:30%">
                                    <select style="width:95%;" id="cboReceivedDate" onchange="DateActions_ReceivedDate(); "></select>
                                </div>
                                <div style="float:left; width:25%; padding-left:5px;">
                                    <input id="txtFromReceivedDate" type="text" style="width: 110px;" class="easyui-datebox" required="required" data-options="formatter:icsdateformat,parser:icsdateparser" />
                                </div>
                                <div style="float:left; width:5%; text-align:center">to</div>
                                <div style="float:left; width:25%; padding-left:5px;">
                                    <input id="txtToReceivedDate" type="text" style="width: 110px;" class="easyui-datebox" required="required" data-options="formatter:icsdateformat,parser:icsdateparser" />
                                </div>
                            </div>
                        </td>
                    </tr>
                    <tr>
                        <td style=" width:20%;text-align:right;">
                            <label>Exc Date:</label>
                        </td>
                        <td colspan="3" style=" width:80%;text-align:right;">
                            <div style="float:left; width:100%">
                                <div style="float:left; width:30%">
                                    <select style="width:95%;" id="cboExcDate" onchange="DateActions_ExcDate(); "></select>
                                </div>
                                <div style="float:left; width:25%; padding-left:5px;">
                                    <input id="txtFromExcDate" type="text" style="width: 110px;" class="easyui-datebox" required="required" data-options="formatter:icsdateformat,parser:icsdateparser" />
                                </div>
                                <div style="float:left; width:5%; text-align:center">to</div>
                                <div style="float:left; width:25%; padding-left:5px;">
                                    <input id="txtToExcDate" type="text" style="width: 110px;" class="easyui-datebox" required="required" data-options="formatter:icsdateformat,parser:icsdateparser" />
                                </div>
                            </div>
                        </td>
                    </tr>
                    <tr>
                        <td style=" width:20%;text-align:right;">
                            <label>Production Type:</label>
                        </td>
                        <td style=" width:30%;text-align:left;">
                            <select id="cboProductionType" style="width:90%;"><option value="0">All</option><option value="1">In House</option><option value="2">Sub Contract</option></select>
                        </td>
                        <td style=" width:20%;text-align:right;">
                            <label>Print PO:</label>
                        </td>
                        <td style=" width:30%;text-align:left;">
                            <select style="width:80%;" id="cboIsPrinting">
                                <option value="0">Default</option>
                                <option value="1">Print</option>
                                <option value="2">Not Print</option>
                            </select>
                        </td>
                    </tr>
                    <tr>

                        <td colspan="4" style="width:95%;text-align:left;">
                            <div style="margin-top: 2px;">
                                <table style="width:100%; height: 160px;">
                                    <tr>
                                        <td style="width:35%;">
                                            <table id="tblOrderTypes" class="easyui-datagrid" title="Order Type" style="width:99%; height: 160px;" data-options="singleSelect: false,fitColumns:false, rownumbers:true, pagination:false, autoRowHeight:false, ">
                                                <thead>
                                                    <tr>
                                                        <th data-options="field:'Selected',checkbox:true"></th>
                                                        @*<th field="Value" width="80%"></th>*@
                                                        <th field="OrderName" width="80%"></th>
                                                    </tr>
                                                </thead>
                                            </table>
                                        </td>
                                        <td style="width:30%;">
                                            <table id="tblCurrentStatuss" class="easyui-datagrid" title="Order Status" style="width:99%; height: 160px;" data-options="singleSelect: false,fitColumns:false, rownumbers:true, pagination:false, autoRowHeight:false, ">
                                                <thead>
                                                    <tr>
                                                        <th data-options="field:'Selected',checkbox:true"></th>
                                                        <th field="Value" width="72%"></th>
                                                    </tr>
                                                </thead>
                                            </table>
                                        </td>
                                        <td style="width:35%;">
                                            <table id="tblLabStatuss" class="easyui-datagrid" title="Lab Status" style="width:99%; height: 160px;" data-options="singleSelect: false,fitColumns:false, rownumbers:true, pagination:false, autoRowHeight:false, ">
                                                <thead>
                                                    <tr>
                                                        <th data-options="field:'Selected',checkbox:true"></th>
                                                        <th field="Value" width="80%"></th>
                                                    </tr>
                                                </thead>
                                            </table>
                                        </td>
                                    </tr>
                                </table>


                            </div>
                        </td>
                    </tr>
                    @*<tr>
                        <td colspan="4" style="width:50%;text-align:left;">
                            <div style="margin-top: 0px;">
                                <table style="width:100%;">
                                    <tr>
                                        <td style=" width:20%;text-align:right;"></td>
                                        <td style="width:40%; text-align:left;">
                                            <div><input type="checkbox" id="chkReceived" /> <span><label>Received</label></span></div>
                                            <div><input type="checkbox" id="chkSubmittedHO" /><span><label>Submitted HO</label></span></div>

                                        </td>

                                        <td style="width:40%;text-align:left;">
                                            <div><input type="checkbox" id="chkWatingForLab" /> <span><label>Waiting For Lab</label></span></div>
                                            <div><input type="checkbox" id="chkYetToSubmittedHO" /> <span><label>Excess Dispo</label></span></div>
                                        </td>
                                    </tr>
                                </table>


                            </div>
                        </td>
                    </tr>*@

                </table>
            </fieldset>

            <fieldset>
                <legend>Actions : </legend>
                <table style="width:100%;text-align:right;">
                    <tr>
                        <td style="width:20%;text-align:right;">
                            <a id="btnResetAdvSearch" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-reload" plain="true">Reset</a>
                        </td>
                        <td style="width:80%;text-align:right;">
                            <label class="lblLoadingMessage" style="float: left;">Loading Please Wait...</label>
                            <a id="btnSearchAdvSearch" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-search" plain="true">Search</a>
                            <a id="btnCloseAdvSearch" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-cancel" plain="true">Close</a>
                        </td>
                    </tr>
                </table>

            </fieldset>
        </div>
    </div>

    <script type="text/javascript">
 debugger;
    var _oDispoProduction=null;
    var _oDispoProductions=[];
    var _sBaseAddress="";
    var _oAuthorizationRolesMapping=[];
    var _oCompareOperators=[];
    var _oFabricPOStatus = [];
    var _oOrderTypes=[];
    var _nBUID = 0;
    var _sContractorIds = '';
    var _sBuyerIds = '';
    var _sMAccountIds='';
    var _oBU = null;
    var _nReportType=0;
    var _sProductIds="";
    var _oProducts=[];
    var _oPriorityLevels=[];
    var _oFinishTypes=[];
    var _oProcessTypes=[];
    var _oFabricWeaves=[];
    var _oFabricDesigns=[];
    var _oLightSources=[];
    var _typeOfReceive =[];
    var _oLabdipStatus=[];
    var _oFabric=null;
    $(document).ready(function () {
        debugger;
        _oDispoProductions =@Html.Raw( new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(Model));
        _sBaseAddress =@Html.Raw( new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(HttpContext.Current.Session[SessionInfo.BaseAddress]));
        _oAuthorizationRolesMapping =@Html.Raw( new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(HttpContext.Current.Session[SessionInfo.AuthorizationRolesMapping]));
        _oCompareOperators = @Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(ViewBag.CompareOperators));
        _nBUID = @Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(ViewBag.BUID));
        _oOrderTypes = @Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(ViewBag.OrderTypes));
        _oLabdipStatus = @Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(ViewBag.LabdipStatus));
        _oFabricPOStatus = @Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(ViewBag.FabricPOStatus));
        _oPriorityLevels = @Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(ViewBag.PriorityLevels));
        _oFinishTypes = @Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(ViewBag.FinishTypes));
        _oProcessTypes = @Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(ViewBag.ProcessTypes));
        _oFabricWeaves = @Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(ViewBag.FabricWeaves));
        _oFabricDesigns = @Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(ViewBag.FabricDesigns));
        _typeOfReceive = @Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(ViewBag.Type));
        _oProducts = @Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(ViewBag.Products));
        var oFabricPOSetup = @Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(ViewBag.FabricPOSetup));
        sessionStorage.setItem("BUID",_nBUID);
        var oDispoProductions =sessionStorage.getItem("DispoProductions");
        if(oDispoProductions!=null)
        {
            oDispoProductions = jQuery.parseJSON(oDispoProductions);
        }
        else
        {
            oDispoProductions=_oDispoProductions;
        }
        RefreshList(oDispoProductions);
        $("#progressbar").progressbar({ value: 0 });
        $("#progressbarParent").hide();
        sessionStorage.setItem("ParamsP", "");

    });
    function updateProgress() {
        var value =$('#progressbar').progressbar('getValue');
        if (value < 96){
            value += Math.floor(Math.random() * 10);
            $('#progressbar').progressbar('setValue', value);
        }
    }
    function hideShow(miliseconds) {
        $("#progressbarParent").hide();
    }
    function RefreshList(oDispoProductions)
    {
        debugger;
        var data=oDispoProductions;
        data={"total":""+data.length+"","rows":data};
        $('#tblDispoProductions').datagrid('loadData',data);
        var nIndex= parseInt(sessionStorage.getItem("SelectedRowIndex"));
        $('#tblDispoProductions').datagrid('selectRow',nIndex);
    }

    function DateActions_OPDate() {
        DynamicDateActions("cboPODate", "txtFromPODate", "txtToPODate");
    }
    function DateActions_ApproveDate() {
        DynamicDateActions("cboApproveDate", "txtFromApproveDate", "txtToApproveDate");
    }
    function DateActions_ReceivedDate() {
        DynamicDateActions("cboReceivedDate", "txtFromReceivedDate", "txtToReceivedDate");
    }
    function DateActions_ExcDate() {
        DynamicDateActions("cboExcDate", "txtFromExcDate", "txtToExcDate");
    }

    $('#txtSearchbyPONo').keypress(function (e) {
        var code = (e.keyCode ? e.keyCode : e.which);
        if (code == 13)//Enter key-13
        {
            if ($.trim($("#txtSearchbyPONo").val()) == "")
            {
                alert("Please give PO No.");
                return false;
            }
            var sPONo=$.trim($("#txtSearchbyPONo").val());
            var sOrderTypeIDs = "";
            var sCurrentStatus = "";
            _sContractorIds="";
            debugger;
            var sTempString = "" + '~'
                            + "" + '~'//$.trim($("#txtFabricID").val()) + '~'
                            + _sContractorIds + '~'
                            + _sBuyerIds + '~'
                            + _sMAccountIds + '~'
                            + 0 + '~'
                            + icsdateformat(new Date())+ '~'
                            + icsdateformat(new Date())+ '~'
                            + 0+ '~'
                            + icsdateformat(new Date()) + '~'
                            + icsdateformat(new Date())+ '~'
                            + 0 + '~'
                            + 0 + '~'
                            + sOrderTypeIDs  + '~'
                            + sCurrentStatus  + '~'
                            + _nBUID  + '~'
                            + sPONo+'~'
                            + _typeOfReceive +'~'
                            + "";

            var oFabricSCReport = {
                SCNoFull:$.trim($("#txtSearchbyPONo").val()),
                ErrorMessage: sTempString
            }
            sessionStorage.setItem("ParamsP", sTempString);
            $.ajax({
                type: "POST",
                dataType: "json",
                url: _sBaseAddress + "/DispoProduction/AdvanchSearch",
                traditional: true,
                data: JSON.stringify(oFabricSCReport),
                contentType: "application/json; charset=utf-8",
                success: function (data)
                {
                    var oResult = data;
                    if(oResult.length<=0){
                        alert("No data found");
                    }
                    else{
                        //$('#tblDispoProductions').data('DispoProductions',oResult)
                        DynamicRefreshList(oResult,'tblDispoProductions');
                        //SetGridData();
                        $(".lblLoadingMessage").hide();
                    }



                }
            });
        }
    });

    $('#txtSearchbyFabricNo').keypress(function (e) {

        var code = (e.keyCode ? e.keyCode : e.which);
        if (code == 13)//Enter key-13
        {
            if ($.trim($("#txtSearchbyFabricNo").val()) == "")
            {
                alert("Please give Ref No.");
                return false;
            }
            var sOrderTypeIDs = "";
            var sCurrentStatus = "";
            _sContractorIds="";
            var sPONo="";
            debugger;
            var sTempString = "" + '~'
                            + $.trim($("#txtSearchbyFabricNo").val()) + '~'
                            + _sContractorIds + '~'
                            + _sBuyerIds + '~'
                            + _sMAccountIds + '~'
                            + 0 + '~'
                            + icsdateformat(new Date())+ '~'
                            + icsdateformat(new Date())+ '~'
                            + 0+ '~'
                            + icsdateformat(new Date()) + '~'
                            + icsdateformat(new Date())+ '~'
                            + 0 + '~'
                              + 0 + '~'
                            + sOrderTypeIDs  + '~'
                            + sCurrentStatus  + '~'
                            + _nBUID  + '~'
                            + sPONo+'~'
                            + _typeOfReceive +'~'
                            + "";

            var oFabricSCReport = {
                SCNoFull:"",
                ErrorMessage: sTempString
            }
            sessionStorage.setItem("ParamsP", sTempString);
            $.ajax({
                type: "POST",
                dataType: "json",
                url: _sBaseAddress + "/DispoProduction/AdvanchSearch",
                traditional: true,
                data: JSON.stringify(oFabricSCReport),
                contentType: "application/json; charset=utf-8",
                success: function (data)
                {
                    var oResult = data;
                    if(oResult.length<=0){
                        alert("No data found");
                    }
                    else{
                        //$('#tblDispoProductions').data('DispoProductions',oResult)
                        DynamicRefreshList(oResult,'tblDispoProductions');
                        //SetGridData();
                        $(".lblLoadingMessage").hide();
                    }


                }
            });
        }
    });

    $('#txtHLNO').keypress(function (e) {
        var code = (e.keyCode ? e.keyCode : e.which);
        if (code == 13)//Enter key-13
        {
            if ($.trim($("#txtHLNO").val()) == "")
            {
                alert("Please give HL No.");
                return false;
            }
            var sOrderTypeIDs = "";
            var sCurrentStatus = "";
            _sContractorIds="";
            var sPONo="";
            debugger;
            var sTempString = "" + '~'
                            + "" + '~'
                            + _sContractorIds + '~'
                            + _sBuyerIds + '~'
                            + _sMAccountIds + '~'
                            + 0 + '~'
                            + icsdateformat(new Date())+ '~'
                            + icsdateformat(new Date())+ '~'
                            + 0+ '~'
                            + icsdateformat(new Date()) + '~'
                            + icsdateformat(new Date())+ '~'
                            + 0 + '~'
                              + 0 + '~'
                            + sOrderTypeIDs  + '~'
                            + sCurrentStatus  + '~'
                            + _nBUID  + '~'
                            + sPONo+'~'
                            + _typeOfReceive +'~'
                            + $.trim($("#txtHLNO").val());

            console.log(sTempString.split('~'))
            var oFabricSCReport = {
                SCNoFull:"",
                ErrorMessage: sTempString
            }
            sessionStorage.setItem("ParamsP", sTempString);
            $.ajax({
                type: "POST",
                dataType: "json",
                url: _sBaseAddress + "/DispoProduction/AdvanchSearch",
                traditional: true,
                data: JSON.stringify(oFabricSCReport),
                contentType: "application/json; charset=utf-8",
                success: function (data)
                {
                    var oResult = data;
                    if(oResult.length<=0){
                        alert("No data found");
                    }
                    else{
                        //$('#tblDispoProductions').data('DispoProductions',oResult)
                        DynamicRefreshList(oResult,'tblDispoProductions');
                        //SetGridData();
                        $(".lblLoadingMessage").hide();
                    }
                }
            });
        }
    });

        /////Adv Search
    $("#btnCloseAdvSearch").click(function () {
        $("#winAdvSearch").icsWindow("close");
    });

    $("#btnResetAdvSearch").click(function () {
        ResetAdvSearchWindow();
        LoadComboAdv();
    });

    function ResetAdvSearchWindow() {
        _sContractorIds = '';
        _sBankBranch_IssueIds = "";
        $(".lblLoadingMessage").hide();
        $("#winAdvSearch input").not("input[type='button']").val("");
        $("#winAdvSearch input").removeClass("fontColorOfPickItem");
        $("#winAdvSearch select").val(0);
        DateActions_OPDate();
        DateActions_ApproveDate();
        DateActions_ReceivedDate();
        $("#txtFromPODate,#txtToPODate,#txtFromApproveDate,#txtToApproveDate,#txtFromReceivedDate,#txtToReceivedDate,#txtFromExcDate,#txtToExcDate").datebox({ disabled: true });
        $("#txtFromPODate,#txtToPODate,#txtFromApproveDate,#txtToApproveDate,#txtFromReceivedDate,#txtToReceivedDate,#txtFromExcDate,#txtToExcDate").datebox("setValue", icsdateformat(new Date()));

        //$('#chkReceived,#chkSubmittedHO,#chkWatingForLab').prop('checked',false);
    }

    function LoadComboAdv()
    {
        DynamicRefreshList(_oOrderTypes, "tblOrderTypes");
        DynamicRefreshList(_oLabdipStatus, "tblLabStatuss");
        DynamicRefreshList(_oFabricPOStatus, "tblCurrentStatuss");
        $("#cboPODate,#cboApproveDate,#cboReceivedDate,#cboExcDate").icsLoadCombo({ List: _oCompareOperators, OptionValue: "id", DisplayText: "Value" });
    }

    $("#btnAdvSearch").click(function () {
        debugger;
        $(".lblLoadingMessage").hide();
        //DynamicRefreshList([], "tblExportPIAdvSearch");
        DynamicResetAdvSearchWindow("winAdvSearch");
        ResetAdvSearchWindow();
        LoadComboAdv();
        $("#winAdvSearch").icsWindow("open", "Dispo Production Advance Search");
    });

    $("#btnSearchAdvSearch").click(function ()
    {
        $(".lblLoadingMessage").show();
        var sOrderTypeIDs = "";
        var oOrderType = $("#tblOrderTypes").datagrid("getChecked");
        if (oOrderType.length > 0)
        {
            for (var i = 0;i<oOrderType.length; i++){
                //sOrderTypeIDs = oOrderType[i].id + "," + sOrderTypeIDs;
                sOrderTypeIDs = oOrderType[i].FabricOrderType + "," + sOrderTypeIDs;
            }
            sOrderTypeIDs = sOrderTypeIDs.substring(0, sOrderTypeIDs.length - 1);
        }
        var sPONo="";
        var sCurrentStatus = "";
        var oCurrentStatuss = $("#tblCurrentStatuss").datagrid("getChecked");
        if (oCurrentStatuss.length > 0)
        {
            for (var i = 0;i<oCurrentStatuss.length; i++){
                sCurrentStatus = oCurrentStatuss[i].id + "," + sCurrentStatus;
            }
            sCurrentStatus = sCurrentStatus.substring(0, sCurrentStatus.length - 1);
        }
        var sLabStatus = "";
        var oLabStatus = $("#tblLabStatuss").datagrid("getChecked");
        if (oLabStatus.length > 0)
        {
            for (var i = 0;i<oLabStatus.length; i++){
                sLabStatus = oLabStatus[i].id + "," + sLabStatus;
            }
            sLabStatus = sLabStatus.substring(0, sLabStatus.length - 1);
        }

        var sTempString = $.trim($("#txtPINo").val()) + '~'
                        + $.trim($("#txtFabricID").val()) + '~'
                        + _sContractorIds + '~'
                        + _sBuyerIds + '~'
                        + _sMAccountIds + '~'
                        + $("#cboPODate").val() + '~'
                        + $("#txtFromPODate").datebox("getValue") + '~'
                        + $("#txtToPODate").datebox("getValue") + '~'
                        + $("#cboApproveDate").val() + '~'
                        + $("#txtFromApproveDate").datebox("getValue") + '~'
                        + $("#txtToApproveDate").datebox("getValue") + '~'
                        + $("#cboProductionType").val() + '~'
                         + $("#cboIsPrinting").val() + '~'
                        + sOrderTypeIDs  + '~'
                        + sCurrentStatus  + '~'
                        + _nBUID + '~'
                        + sPONo +'~'
                        + _typeOfReceive+'~'
                        +''+'~'
                        //+ $('#chkReceived').is(':checked')+'~'
                        //+ $('#chkSubmittedHO').is(':checked')+'~'
                        //+ $('#chkWatingForLab').is(':checked')+'~'
                        //+ $('#chkYetToSubmittedHO').is(':checked')+'~'
                        + sLabStatus+'~'+
                        + $("#cboReceivedDate").val() + '~'
                        + $("#txtFromReceivedDate").datebox("getValue") + '~'
                        + $("#txtToReceivedDate").datebox("getValue") + '~'
                        + $("#cboExcDate").val() + '~'
                        + $("#txtFromExcDate").datebox("getValue") + '~'
                        + $("#txtToExcDate").datebox("getValue") + '~'
                        + $("#txtConstruction").val() + '~'
                        + $("#txtComposition").val() + '~'
                        + $("#txtFinishType").val() + '~'
                        + $("#txtWeave").val();

        debugger;
        var oFabricSCReport = {
            ErrorMessage: sTempString
        }
        sessionStorage.setItem("ParamsP", sTempString);
        $.ajax({
            type: "POST",
            dataType: "json",
            url: _sBaseAddress + "/DispoProduction/AdvanchSearch",
            traditional: true,
            data: JSON.stringify(oFabricSCReport),
            contentType: "application/json; charset=utf-8",
            success: function (data) {
                debugger;
                var oResult = data;
                var oResult = data;
                if(oResult.length<=0){
                    alert("No data found");
                    $(".lblLoadingMessage").hide();
                }
                else{
                    //$('#tblDispoProductions').data('DispoProductions',oResult)
                    DynamicRefreshList(oResult,'tblDispoProductions');
                    //SetGridData();
                    $("#winAdvSearch").icsWindow("close");
                    $(".lblLoadingMessage").hide();

                }

            }
        });
    });

        ////Pickers
    $("#btnClrContractorAdvS").click(function () {
        $("#txtContractorAdvS").removeClass("fontColorOfPickItem");
        $("#txtContractorAdvS").val("");
        _sContractorIds = '';
    });
    $("#txtContractorAdvS").keydown(function (e) {
        if (e.keyCode === 13) // Enter Press
        {
            PickContractors_AdvS();
        }
        else if (e.keyCode === 08) {
            $("#txtContractorAdvS").removeClass("fontColorOfPickItem");
            _sContractorIds = '';
        }
    });    
    $("#btnPickContractorAdvS").click(function () {
        PickContractors_AdvS();
    });
    function PickContractors_AdvS() {
        var oContractor = {
            Params: '2,3' + '~' + $.trim($("#txtContractorAdvS").val()+"~"+_nBUID)
        };
        var obj = {
            BaseAddress: _sBaseAddress,
            Object: oContractor,
            ControllerName: "Contractor",
            ActionName: "ContractorSearchByNameType",
            IsWinClose: false
        };

        $("#progressbar").progressbar({ value: 0 });
        $("#progressbarParent").show();
        var intervalID = setInterval(updateProgress, 250);

        DynamicRefreshList([], "tblAccountsPickerAdvSearch");
        $.icsDataGets(obj, function (response) {
            clearInterval(intervalID);
            $("#progressbarParent").hide();
            if (response.status && response.objs.length > 0) {
                if (response.objs[0].ContractorID > 0) {
                    var tblColums = []; var oColumn = { field: "ContractorID", title: "Code", width: 50, align: "left" }; tblColums.push(oColumn);
                    oColumn = { field: "Name", title: "Name", width: 280, align: "left" }; tblColums.push(oColumn);

                    var oPickerParam = {
                        winid: 'winContractorPicker',
                        winclass: 'clsAccountOf',
                        winwidth: 400,
                        winheight: 460,
                        tableid: 'tblAccountOfs',
                        tablecolumns: tblColums,
                        datalist: response.objs,
                        multiplereturn: true,
                        searchingbyfieldName: 'Name',
                        windowTittle: 'Contactor List'
                    };
                    $.icsPicker(oPickerParam);
                    IntializePickerbutton(oPickerParam);
                }
                else {
                    alert(response.objs[0].ErrorMessage);
                }
            }
            else {
                alert("Sorry, No Contactor Found.");
            }
        });
    }

    $("#btnClrDeliverTo").click(function () {
        $("#txtDeliverTo").val("");
        _sBuyerIds="";
    });
    $("#btnPickDeliverTo").click(function () {
        var oContractor = {
            Params: '2,3' + '~' + $.trim($("#txtDeliverTo").val()+'~'+_nBUID)
        };
        GetDeliverTo(oContractor);
    });
    $("#txtDeliverTo").keydown(function (e) {
        var nkeyCode = e.keyCode || e.which;
        if(nkeyCode==13){
            var sContractorName=$.trim($("#txtDeliverTo").val());
            if(sContractorName=="" || sContractorName==null)
            {
                alert("Please, Type name or part of Name");
                $("#txtDeliverTo").focus();
                $("#txtDeliverTo").addClass("errorFieldBorder");
                return;
            }
            var oContractor = {
                Params: '2,3' + '~' + $.trim($("#txtDeliverTo").val()+'~'+_nBUID)
            };
            GetDeliverTo(oContractor);
        }
        else if(nkeyCode==8){
            $("#txtDeliverTo").val("");
            _sBuyerIds="";

        }
    });
    function GetDeliverTo(oContractor){
        var obj = {
            BaseAddress: _sBaseAddress,
            Object: oContractor,
            ControllerName: "Contractor",
            ActionName: "ContractorSearchByNameType",
            IsWinClose: false
        };
        $("#progressbar").progressbar({ value: 0 });
        $("#progressbarParent").show();
        var intervalID = setInterval(updateProgress, 250);
        $.icsDataGets(obj, function (response) {
            clearInterval(intervalID);
            $("#progressbarParent").hide();
            if (response.status && response.objs.length > 0)
            {
                if (response.objs[0].ContractorID > 0) {
                    debugger;
                    var tblColums = [];
                    var oColumn = { field: "ContractorID", title: "Code", width: 50, align: "center" };tblColums.push(oColumn);
                    oColumn = { field: "Name", title: "Name", width: 190, align: "left" };tblColums.push(oColumn);
                    oColumn = { field: "Phone", title: "Phone", width: 140, align: "left" };tblColums.push(oColumn);

                    var oPickerParam = {
                        winid: 'winDeliverToPicker',
                        winclass:'clsDeliverToPicker',
                        winwidth: 460,
                        winheight: 460,
                        tableid: 'tblDeliverToPicker',
                        tablecolumns: tblColums,
                        datalist: response.objs,
                        multiplereturn: true,
                        searchingbyfieldName:'Name',
                        windowTittle: 'Deliver To List'
                    };
                    $.icsPicker(oPickerParam);
                    IntializePickerbutton(oPickerParam);//multiplereturn, winclassName
                }
                else { alert(response.objs[0].ErrorMessage); }
            }
            else{
                alert("No contractor found.");
            }
        });
    }

    $("#btnResetMktPerson").click(function () {
        $("#txtMktAccount").val("");
        _sMAccountIds="";
    });
    $("#btnPickMktAccount").click(function () {
        debugger;
        var sName=$.trim($("#txtMktAccount").val());
        GetMktPersons(sName);
    });
    $("#txtMktAccount").keydown(function (e) {
        var nkeyCode = e.keyCode || e.which;
        if(nkeyCode==13){
            var sName=$.trim($("#txtMktAccount").val());
            if($('#txtMktAccount').val()==null || $('#txtMktAccount').val()=="")
            {
                alert("Please Type Name or part Name and Press Enter.");
                $('#txtMktAccount').focus();
                return;
            }
            GetMktPersons(sName);
        }
        else if(nkeyCode==8){
            $("#txtMktAccount").val("");
            _sMAccountIds="";
        }
    });
    function GetMktPersons(sName){
        var oMarketingAccount_BU = {
            Name:sName,
            BUID:sessionStorage.getItem("BUID")
        };
        var obj = {
            BaseAddress: _sBaseAddress,
            Object: oMarketingAccount_BU,
            ControllerName: "MarketingAccount",
            ActionName: "MarketingAccountSearchByNameAndGroup",
            IsWinClose: false
        };
        $.icsDataGets(obj, function (response) {

            if (response.status && response.objs.length > 0) {
                if (response.objs[0].MarketingAccountID > 0) {
                    debugger;
                    var tblColums = [];
                    var oColumn = { field: "MarketingAccountID", title: "Code", width: 50, align: "left" };tblColums.push(oColumn);
                    oColumn = { field: "Name", title: "Name", width: 180, align: "left" };tblColums.push(oColumn);
                    oColumn = { field: "GroupName", title: "GroupName", width: 120, align: "left" };tblColums.push(oColumn);
                    oColumn = { field: "Phone", title: "Phone", width: 100, align: "left" };tblColums.push(oColumn);

                    var oPickerParam = {
                        winid: 'winMktAccount',
                        winclass:'clsMktPersonPicker',
                        winwidth: 460,
                        winheight: 460,
                        tableid: 'tblMktPersonPicker',
                        tablecolumns: tblColums,
                        datalist: response.objs,
                        multiplereturn: true,
                        searchingbyfieldName:'Name',
                        windowTittle: 'MKT Person List'
                    };
                    $.icsPicker(oPickerParam);
                    IntializePickerbutton(oPickerParam);//multiplereturn, winclassName
                }
                else { alert(response.objs[0].ErrorMessage); }
            }
            else{
                alert("No marketing person found.");
            }
        });


    }

    function IntializePickerbutton(oPickerobj) {
        $("#" + oPickerobj.winid).find("#btnOk").click(function () {
            SetPickerValueAssign(oPickerobj);
        });
        $(document).find('.' + oPickerobj.winclass).keydown(function (e) {
            if (e.which === 13) {
                SetPickerValueAssign(oPickerobj);
            }
        });
    }
    function SetPickerValueAssign(oPickerobj) {
        var oreturnObj = null, oreturnObjs = [];
        if (oPickerobj.multiplereturn) {
            oreturnObjs = $('#' + oPickerobj.tableid).datagrid('getChecked');
        } else {
            oreturnObj = $('#' + oPickerobj.tableid).datagrid('getSelected');
        }

        if (oPickerobj.winid == 'winContractorPicker')
        {
            if (oreturnObjs != null && oreturnObjs.length> 0)
            {

                _sContractorIds=''; var sMessage='';
                sMessage=(oreturnObjs.length>1)? oreturnObjs.length +" Contractors Selected" : oreturnObjs[0].Name;
                $('#txtContractorAdvS').val(sMessage);
                $("#txtContractorAdvS").addClass("fontColorOfPickItem");

                for(var i=0;i<oreturnObjs.length;i++){
                    _sContractorIds=_sContractorIds+oreturnObjs[i].ContractorID+',';
                }
                _sContractorIds=_sContractorIds.substring(0,_sContractorIds.length-1);

            }
            else
            {
                alert("Please select a contractor.");
                return false;
            }
        }

        else if (oPickerobj.winid == 'winDeliverToPicker')
        {
            if (oreturnObjs != null && oreturnObjs.length> 0)
            {
                var sMessage='';
                _sBuyerIds="";
                sMessage=(oreturnObjs.length>1)? oreturnObjs.length +" Buying House(s) Selected" : oreturnObjs[0].Name;
                $('#txtDeliverTo').val(sMessage);
                $("#txtDeliverTo").addClass("fontColorOfPickItem");

                for(var i=0;i<oreturnObjs.length;i++){
                    _sBuyerIds=_sBuyerIds+oreturnObjs[i].ContractorID+',';
                }
                _sBuyerIds=_sBuyerIds.substring(0,_sBuyerIds.length-1);

            }
            else
            {
                alert("Please select a Buying House.");
                return false;
            }
        }
        else if (oPickerobj.winid == 'winMktAccount')
        {
            if (oreturnObjs != null && oreturnObjs.length> 0)
            {
                var sMessage='';
                _sMAccountIds="";
                sMessage=(oreturnObjs.length>1)? oreturnObjs.length +"MKT Account(s) Selected" : oreturnObjs[0].Name;
                $('#txtMktAccount').val(sMessage);
                $("#txtMktAccount").addClass("fontColorOfPickItem");
                for(var i=0;i<oreturnObjs.length;i++){
                    _sMAccountIds=_sMAccountIds+oreturnObjs[i].MarketingAccountID+',';
                }
                _sMAccountIds=_sMAccountIds.substring(0,_sMAccountIds.length-1);
            }
            else
            {
                alert("Please select a MKt Account.");
                return false;
            }
        }

        $("#" + oPickerobj.winid).icsWindow("close");
        $("#" + oPickerobj.winid).remove();
    }
        ////Pickers
        //Adv Search

    $("#btnPrintXL").click(function ()
    {
        var sParams=sessionStorage.getItem("ParamsP");
        if(sParams == ""){
            alert("Please search first!!");
            return;
        }
        window.open(_sBaseAddress + '/DispoProduction/ExportXL?sTempString=' + sParams+"&nBUID="+_nBUID, "_blank");
    });

    $("#btnPreviewDispo").click(function ()
    {
        var oDP= $('#tblDispoProductions').datagrid('getSelected');
        if(oDP == null || oDP.FabricSalesContractDetailID <= 0){
            alert("Please Select a Valid Item!!");
            return;
        }
        var nts = ((new Date()).getTime()) / 1000;
        window.open(_sBaseAddress + '/FabricExecutionOrderSpecification/PrintFabricSpecification?nId=' +oDP.FEOSID + "&nts=" + nts, "_blank");
    });

    $("#btnPreviewPO").click(function ()
    {
        var oDP= $('#tblDispoProductions').datagrid('getSelected');
        if(oDP == null || oDP.FabricSalesContractDetailID <= 0){
            alert("Please Select a Valid Item!!");
            return;
        }
        var nts = ((new Date()).getTime()) / 1000;
        window.open(_sBaseAddress+ "/FabricSalesContract/PrintPreview?nID="+oDP.FabricSalesContractID+"&bIsRnd=true&nts="+nts+"&bPrintFormat=true&nTitleTypeInImg=1", "_blank");
    });

    $("#btnComment").click(function ()
    {
        var oDP= $('#tblDispoProductions').datagrid('getSelected');
        if(oDP == null || oDP.FabricSalesContractDetailID <= 0){
            alert("Please Select a Valid Item!!");
            return;
        }
        window.open(_sBaseAddress + '/DispoProduction/ViewDispoProductionComments?nFabricSalesContractDetailID='+ oDP.FabricSalesContractDetailID +"&nBUID="+_nBUID, "_blank");
    });

    $("#btnSeenUnseenComment").click(function ()
    {
        window.open(_sBaseAddress + '/DispoProduction/ViewDispoProductionSeenUnseenComments?nBUID='+_nBUID, "_blank");
    });

    </script>
