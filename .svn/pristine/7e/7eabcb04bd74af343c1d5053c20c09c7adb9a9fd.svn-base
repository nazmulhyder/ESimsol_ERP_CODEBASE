@model IEnumerable<ESimSol.BusinessObjects.AttendanceProcessManagement>
    @{
        ViewBag.Title = "Attendance Process";
    }
    <div class="menuMainCollectionTable" id="progressbarParent" style="width:100%;height:100%;margin:0 auto;text-align:center; margin-left: auto;margin-right: auto;left: 0;right: 0;z-index: 1;">
        <div style="margin: 0px auto;margin-top: 251px;text-align:center;width:390px;">
            <label style="font-size:18px;">Please wait</label>
            <div id="progressbar" style="width:100%;height:37px;"></div>
        </div>
    </div>

    <div style="margin-left:0px; height:530px" id="main-body">
        <table id="tblAttendanceProcessManagement" title="Attendance Process Management List" class="easyui-datagrid" style="height:525px" fitcolumns="false" rownumbers="true" pagination="false" singleselect="false" autorowheight="false" toolbar="#toolbar">
            <thead>
                <tr>
                    <th data-options="field:'Selected',checkbox:true"></th>
                    <th field="LocationName" width="200" align="left">Location</th>
                    <th field="ShiftName" width="150" align="left">ShiftName</th>
                    <th field="StatusInString" width="150" align="left">Status</th>
                    <th field="AttendanceDateInString" width="100" align="left">Date</th>
                </tr>
            </thead>
        </table>

        <div id="toolbar" style="height:auto;">

                <input id="txtBusinessUnit_Collection" style="width:13%;" placeholder="Pick Business Unit" type="text" />
                <input id="btnBusinessUnitPicker_Collection" type="button" value="P" />
                <input id="btnResetBusinessUnitPicker_Collection" type="button" value="C" />

                <input id="txtLocation_Colection" style="width:14%;" placeholder="Pick Location" type="text" />
                <input id="btnLocationPicker_Colection" type="button" value="P" />
                <input id="btnResetLocationPicker_Colection" type="button" value="C" />
                
                Shift :
                @*<select id="cboShift" style="width:13%;"></select>*@
                <input id="txtShift_Collection" style="width:14%;" placeholder="Pick Shift" type="text" />
                <input id="btnShift_Collection" type="button" value="P" />
                <input id="btnResetShift_Collection" type="button" value="C" />

                <span id="regionDateFrom">
                    <span>
                        <select id="cboYear" style="width:70px;"></select>
                    </span><span>
                        <select id="cboMonth"></select>
                    </span><span>
                        <select id="cboDay" style="width:60px;"></select>
                    </span>
                </span>
                <a id="btnSrc" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-search" plain="true" onclick="Search()">Search</a>
                &nbsp;&nbsp;&nbsp;
                <!--<a id="btnCollectRTData" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-ok" plain="true" onclick="RTData()">Collect RT Data</a>
            <a id="btnNew" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-ok" plain="true" onclick="ProcessAttendance()">Process</a>-->
                <a href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-ok" plain="true" onclick="ProcessAttendance_V1()">Process</a>
                <!--<a id="btnRollBack" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-ok" plain="true" onclick="RollBack()">RollBack</a>-->
                <a id="btnRollBack" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-ok" plain="true" onclick="RollBack_Freeze('RollBack')">RollBack</a>
                @*<a id="btnReProcess" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-ok" plain="true" onclick="ReProcess()">Re-Processed</a>*@
                <a id="btnReProcess_V1" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-ok" plain="true" onclick="ReProcess_V1()">Re-Processed</a>
                <a id="btnFreeze" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-ok" plain="true" onclick="RollBack_Freeze('Freeze')">Freeze</a>
                <a id="btnUnFreeze" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-ok" plain="true" onclick="RollBack_Freeze('UnFreeze')">Un Freeze</a>
                <!--<a id="btnFreeze" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-ok" plain="true" onclick="Freeze()">Freeze</a>-->
                <!--<a id="btnCollectData" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-ok" plain="true">Collect Data</a>-->
                <br />

                <select id="cboEnumPunchFormat" style="width:150PX;"></select>
                <a id="btnPunchLogImportFormatSave" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-save" plain="true">Save</a>

                @using (Html.BeginForm("ViewAttendanceProcessManagements", "ProcessManagement", FormMethod.Post, new { enctype = "multipart/form-data" }))
                {

                    @*<table style="width:100%;">
                     <tr style="width:100%;">
                         <td style="width:100%;text-align:left;">
                             <input id="txtEnumPunchFormat" name="txtEnumPunchFormat" type="hidden" />
                             <input type="file" id="filePunchLogs" name="filePunchLogs" />
                             <input type="submit" id="btnImportXL" value="Import Punch" class="icon-up PrintList" />
                         </td>
                     </tr>
                    </table>*@

                    <table border="0" cellpadding="0" cellspacing="0">
                        <tr>
                            <td style="width:150px;">
                                <input id="txtEnumPunchFormat" name="txtEnumPunchFormat" type="hidden" />
                                <input type="file" id="filePunchLogs" name="filePunchLogs" />
                            </td>
                            <td style="width:150px;"><input type="submit" id="btnImportXL" style="vertical-align:central;" value="Import Punch" /></td>
                        </tr>
                    </table>
                }
            </div>

            @*<div style="float:left;">
            <div style="float:left;">
                <select id="cboEnumPunchFormat" style="width:150PX;"></select>
                <a id="btnPunchLogImportFormatSave" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-save" plain="true">Save</a>
            </div>
            @using (Html.BeginForm("ViewAttendanceProcessManagements", "ProcessManagement", FormMethod.Post, new { enctype = "multipart/form-data" }))
            {

                @*<table style="width:100%;">
                     <tr style="width:100%;">
                         <td style="width:100%;text-align:left;">
                             <input id="txtEnumPunchFormat" name="txtEnumPunchFormat" type="hidden" />
                             <input type="file" id="filePunchLogs" name="filePunchLogs" />
                             <input type="submit" id="btnImportXL" value="Import Punch" class="icon-up PrintList" />
                         </td>
                     </tr>
                    </table>*@

            @*<table border="0" cellpadding="0" cellspacing="0">
                        <tr>
                            <td style="width:150px;">
                                <input id="txtEnumPunchFormat" name="txtEnumPunchFormat" type="hidden" />
                                <input type="file" id="filePunchLogs" name="filePunchLogs" />
                            </td>
                            <td style="width:150px;"><input type="submit" id="btnImportXL" style="vertical-align:central;" value="Import Punch" /></td>
                        </tr>
                    </table>
                }
            </div>*@


        </div>
        <div id="winLocationPicker" class="easyui-window winstyle" title="Location Picker" style="width:350px; height:400px" data-options="modal:true,closed:true,collapsible:false,minimizable:false,maximizable:false,closable:false">
            <div style="font-family:Tahoma">
                <div class="easyui-panel" style="width:335px;height:300px;overflow:auto">
                    <ul id="locationtree" data-options="checkbox:true" singleselect="false"></ul>
                </div>

                <fieldset>
                    <legend style="font-weight:bold"> Action : </legend>
                    <table border="0" cellspacing="2" cellpadding="2" style="font-size:11px; font-weight:bold">
                        <tr>
                            <td style="width:400px; text-align:right"></td>

                            <td style="width:50px">
                                <a id="btnLocationPickerOk" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-ok" plain="true">Ok</a>
                            </td>
                            <td style="width:50px">
                                <a id="btnLocationPickerClose" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-cancel" plain="true">Close</a>
                            </td>
                        </tr>
                    </table>
                </fieldset>
            </div>
        </div>

        <div id="winProcessAttendance" class="easyui-window winstyle" title="Process Attendance" style="height:380px" data-options="modal:true,closed:true,collapsible:false,minimizable:false,maximizable:false,closable:false">
            <fieldset>
                <legend style="font-weight: bold">Daily Attendance Information : </legend>
                <table border="0" cellspacing="2" cellpadding="2" style="font-size: 11px; font-weight: bold; width:100%">
                    <tr style="width:100%;">
                        <td style="width:35%; text-align: right">
                            Business Unit :
                        </td>
                        <td style="width: 180px;width:65%;">
                            <select id="cboBU" style="width:180px;"></select>
                        </td>
                    </tr>
                    <tr style="width:100%;">
                        <td style="width:35%; text-align: right">
                            Location :
                        </td>
                        <td style="width: 180px;width:65%;">
                            <select id="cboLocation" style="width:180px;"></select>
                        </td>
                    </tr>
                    <tr style="width:100%;">
                        <td style="width:35%; text-align: right">
                            Shift :
                        </td>
                        <td style="width: 65%">
                            <select id="cboShift" style="width:180px;"></select>
                        </td>
                    </tr>
                    <tr style="width:100%;">
                        <td style="width: 35%; text-align: right">
                            Process Type :
                        </td>
                        <td style="width: 65%">
                            <select id="cboProcesType" style="width:180px;"></select>
                        </td>
                    </tr>
                    <tr style="width:100%;">
                        <td style="width: 35%; text-align: right">
                            Date :
                        </td>
                        <td style="width: 65%;">
                            <input id="dtProcess" type="text" style="width: 180px" class="easyui-datebox"
                                   data-options="formatter:icsdateformat,parser:icsdateparser" />
                        </td>
                    </tr>
                </table>
            </fieldset>
            <fieldset>
                <legend style="font-weight: bold">Action : </legend>
                <table border="0" cellspacing="2" cellpadding="2" style="font-size: 11px; font-weight: bold; width:100%">
                    <tr>
                        <td style="width: 35%; text-align: right"></td>
                        <td style="width: 65%;text-align: right;">
                            <a id="btnAttProcess" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-ok" plain="true"
                               onclick="Process()">Process</a>
                            <a href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-cancel" plain="true"
                               onclick="ProcessAttendanceClose()">Close</a>
                        </td>
                    </tr>
                </table>
            </fieldset>
        </div>

        <div id="winCollectData" class="easyui-window winstyle" title="Data Collection" style="width:370px; height:400px" data-options="modal:true,closed:true,collapsible:false,minimizable:false,maximizable:false,closable:false">
            <table id="tblAAPs" class="easyui-datagrid" style="width:350px; height:260px" fitcolumns="false" rownumbers="true" pagination="false" singleselect="true" autorowheight="false" selectoncheck="false" checkonselect="false">
                <thead>
                    <tr>
                        <th data-options="field:'Selected',checkbox:true"></th>
                        <th field="Name" width="270" align="left">AAP Name</th>
                    </tr>
                </thead>
            </table>
            <br />
            Date :
            <input id="dtDate" type="text" style="width: 150px;" class="easyui-datebox" data-options="formatter:icsdateformat,parser:icsdateparser" />
            <fieldset>
                <legend style="font-weight:bold"> Action : </legend>
                <table border="0" cellspacing="2" cellpadding="2" style="font-size:11px; font-weight:bold">
                    <tr style="text-align:right">
                        <td style="text-align:right; width:170px;"></td>
                        <td style="text-align:right">
                            <a id="btnProcess" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-ok" plain="true">Process</a>
                            <a id="btnCloseProcess" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-cancel" plain="true">Close</a>
                        </td>
                    </tr>
                </table>
            </fieldset>
        </div>

        <div id="winProcessAttendance_V1" class="easyui-window winstyle" title="Attendance Process" style="height:450px; width:42%" data-options="modal:true,closed:true,collapsible:false,minimizable:false,maximizable:false,closable:false">
            <fieldset style="width:99%">
                <legend style="font-weight: bold">Daily Attendance Process : </legend>
                <table style="width:100%">
                    <tr style="width:100%">
                        <td style="width:55%">
                            <table border="0" cellspacing="2" cellpadding="2" style="font-size: 11px; font-weight: bold; width:100%;margin-top:-5%;">
                                <tr style="width:100%;">
                                    <td style="width:35%; text-align: right">
                                        Business Unit :
                                    </td>
                                    <td style="width: 100%;width:65%;">
                                        <select id="cboBU_V1" style="width:100%;"></select>
                                    </td>
                                </tr>
                                <tr style="width:100%;">
                                    <td style="width:35%; text-align: right">
                                        Location :
                                    </td>
                                    <td style="width:35%;">
                                        @*<select id="cboLocation_V1" style="width:180px;"></select>*@
                                        <table id="tblLocation_V1" class="easyui-datagrid" style="width:100%;height:200px" fitcolumns="false" rownumbers="true" pagination="false" singleselect="false" autorowheight="false">
                                            <thead>
                                                <tr>
                                                    <th data-options="field:'Selected',checkbox:true"></th>
                                                    <th field="LocationName" width="150" align="left">Location</th>
                                                </tr>
                                            </thead>
                                        </table>
                                    </td>
                                </tr>
                                <tr style="width:100%;">
                                    <td style="width: 35%; text-align: right">
                                        Date :
                                    </td>
                                    <td style="width: 65%;">
                                        <input id="dtProcess_V1" type="text" style="width: 100%" class="easyui-datebox"
                                               data-options="formatter:icsdateformat,parser:icsdateparser" />
                                    </td>
                                </tr>
                            </table>
                        </td>
                        <td style="width:42%">
                            <a id="btnRefreshShift" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-ok" plain="true">Refresh</a>
                            <table id="tblShift_V1" title="Shift" class="easyui-datagrid" style="width:100%;height:250px" fitcolumns="false" rownumbers="true" pagination="false" singleselect="false" autorowheight="false">
                                <thead>
                                    <tr>
                                        <th data-options="field:'Selected',checkbox:true"></th>
                                        <th field="Name" width="150" align="left">Shift</th>
                                    </tr>
                                </thead>
                            </table>
                        </td>
                    </tr>
                </table>
            </fieldset>
            <fieldset>
                <legend style="font-weight: bold">Action : </legend>
                <table border="0" cellspacing="2" cellpadding="2" style="font-size: 11px; font-weight: bold; width:100%">
                    <tr>
                        <td style="width: 35%; text-align: right"></td>
                        <td style="width: 65%;text-align: right;">
                            <a id="btnAttProcess_V1" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-ok" plain="true"
                               onclick="Process_V1()">Process</a>
                            <a href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-cancel" plain="true"
                               onclick="ProcessAttendanceClose_V1()">Close</a>
                        </td>
                    </tr>
                </table>
            </fieldset>
        </div>
    </div>

    <script type="text/javascript">
    var _oAttendanceProcessManagements=[];
    var _sBaseAddress="";
    var _oAAPs=[];
    var _sFeedBack=null;
    var _oEnumPunchFormats=[];
    var _oPunchLogImportFormat=null;
    var _oLocations=[];
    var _oBUs=[];
    var _sLocationID = "";
    var _sBusinessUnitIds="";
    var oShifts = [];
    var _sShiftIDs = "";

    $(document).ready(function () {
        debugger;
        _oAttendanceProcessManagements =@Html.Raw( new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(Model));
        _sBaseAddress =@Html.Raw( new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(HttpContext.Current.Session[SessionInfo.BaseAddress]));
        _oAAPs= @Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(@ViewBag.AAPs));
        _sFeedBack=@Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(ViewBag.FeedBack));
        _oPunchLogImportFormat= @Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(@ViewBag.PunchLogImportFormats));
        _oEnumPunchFormats= @Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(@ViewBag.EnumPunchFormats));

        oShifts = @Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(@ViewBag.Shifts));
        _oLocations = @Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(@ViewBag.Locations));
        var oProcessTypes = @Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(@ViewBag.ProcessTypes));
        _oBUs = @Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(@ViewBag.BusinessUnits));
        DynamicRefreshList(_oAttendanceProcessManagements, "tblAttendanceProcessManagement");
        SetDateTime();
        var oDate=new Date();
        SetStartTime(oDate);
        $('#dtDate').datebox('setValue',icsdateformat(new Date()));
        if(_sFeedBack!=null){alert(_sFeedBack);}
        $("#cboEnumPunchFormat").icsLoadCombo({
            List:_oEnumPunchFormats,
            OptionValue: "Value",
            DisplayText: "Text"
            //InitialValue:""
        });

        if(_oPunchLogImportFormat!= null && _oPunchLogImportFormat.PLIFID>0)
        {
            $("#cboEnumPunchFormat").val(_oPunchLogImportFormat.PunchFormat);
        }

        //ProcessAttendance start
        LoadBU(_oBUs);
        LoadShift(oShifts);
        DynamicRefreshList(oShifts, "tblShift_V1");
        //LoadLocation(_oLocations);
        LoadProcesType(oProcessTypes);
        //document.getElementById('cboLocation').value = 2;
        document.getElementById('cboShift').value = 1;
        $("#progressbar").progressbar({ value: 0 });
        $("#progressbarParent").hide();
        //$("#cboShift").icsLoadCombo({
        //    List: oShifts,
        //    OptionValue: "ShiftID",
        //    DisplayText: "ShiftWithDuration"
        //});
        //ProcessAttendance end
    });

    /*-------------Start Business Unit Picker----------------*/
    $("#btnBusinessUnitPicker_Collection").click(function(e){
        BusinessUnitPicker();
    });

    $("#txtBusinessUnit_Collection").keypress(function(e){
        if (e.which == 13)//enter=13
        {
            BusinessUnitPicker();
        }
    });

    function BusinessUnitPicker()
    {
        var oBusinessUnit={
            BusinessUnitID:0
        };
        var obj = {
            BaseAddress: _sBaseAddress,
            Object: oBusinessUnit,
            ControllerName: "BusinessUnit",
            ActionName: "GetsBusinessUnitWithPermission",
            IsWinClose: false
        };
        $.icsDataGets(obj, function (response) {
            if (response.status && response.objs.length > 0) {
                if (response.objs[0].BusinessUnitID > 0) {
                    var tblColums = [];
                    var oColumn = { field: "Code", title: "Code", width: 50, align: "left" };tblColums.push(oColumn);
                    oColumn = { field: "Name", title: "Name", width: 170, align: "left" };tblColums.push(oColumn);

                    var bmultiplereturn=true;

                    var oPickerParam = {
                        winid: 'winBusinessUnit',
                        winclass:'clsBusinessUnit',
                        winwidth: 320,
                        winheight: 400,
                        tableid: 'tblBusinessUnit',
                        tablecolumns: tblColums,
                        datalist: response.objs,
                        multiplereturn: bmultiplereturn,
                        searchingbyfieldName:'Name',
                        windowTittle: 'Business Unit List'
                    };
                    $.icsPicker(oPickerParam);
                    IntializeBusinessUnitPickerbutton(oPickerParam);//multiplereturn, winclassName
                }
                else { alert(response.objs[0].ErrorMessage); }
            }
        });
    }

    function IntializeBusinessUnitPickerbutton(oPickerobj)
    {
        $("#" + oPickerobj.winid).find("#btnOk").click(function () {
            var oBusinessUnits=[];
            oBusinessUnits = $('#'+oPickerobj.tableid).datagrid('getChecked');
            if (oPickerobj.winid == 'winBusinessUnit')
            {
                if(oBusinessUnits!=null && oBusinessUnits.length>0)
                {
                    $("#"+oPickerobj.winid).icsWindow("close");
                    $("#" + oPickerobj.winid).remove();
                    var sBusinessUnitName = "";
                    for(var i=0; i<oBusinessUnits.length; i++)
                    {
                        sBusinessUnitName+=oBusinessUnits[i].Name+",";
                        _sBusinessUnitIds+=oBusinessUnits[i].BusinessUnitID+",";
                    }

                    sBusinessUnitName=sBusinessUnitName.substring(0,sBusinessUnitName.length-1);
                    _sBusinessUnitIds=_sBusinessUnitIds.substring(0,_sBusinessUnitIds.length-1);
                    $("#txtBusinessUnit_Collection").val(sBusinessUnitName);
                }
                else
                {
                    alert("Please select a Business Unit.");
                }
            }
        });
    }

    $("#btnResetBusinessUnitPicker_Collection").click(function(e){
        $('#txtBusinessUnit_Collection').val("");
        _sBusinessUnitIds="";
    });
    /*-------------End Business Unit Picker----------------*/

    /*-------------Location Picker----------------*/
    var btnLocation="";
    $("#btnLocationPicker,#btnLocationPicker_Colection").click(function(e){
        debugger;
        btnLocation = $(this).attr("id");
        var sBusinessUnitIDs ="";
        var nBusinessUnitID=0;
        if(btnLocation=="btnLocationPicker")
        {
            nBusinessUnitID = $("#cboBU").val();
            sBusinessUnitIDs = String(nBusinessUnitID);
        }
        else{sBusinessUnitIDs=_sBusinessUnitIds;}
        $("#winLocationPicker").icsWindow('open');
        var oLocation={LocationID:0,BusinessUnitIDs:sBusinessUnitIDs};
        var obj = {
            BaseAddress: _sBaseAddress,
            Object: oLocation,
            ControllerName: "Location",
            ActionName: "GetsLocationMenuTree",
            IsWinClose: false
        };

        $.icsDataGet(obj, function (response) {
            if (response.status && response.obj!=null) {
                if (response.obj.TLocation.id > 0) {
                    $('#locationtree').tree({ data: [response.obj.TLocation] });
                }
            }
        });
    });

    $("#btnLocationPickerOk").click(function(e){
        if(btnLocation=="btnLocationPicker")
        {
            var oLocation = $('#locationtree').tree('getSelected');
            if(oLocation!=null && oLocation.id>0){
                $("#winLocationPicker").icsWindow('close');
                _sLocationID=oLocation.id;
                $('#txtLocation').val(oLocation.text);
            }
            else{
                alert("Please select a location.");
            }
        }
        else
        {
            var oLocations = $('#locationtree').tree('getChecked');
            if(oLocations!=null && oLocations.length>0)
            {
                var LocationName="";
                for(var i=0; i<oLocations.length; i++)
                {
                    if(oLocations[i].id !=1)
                    {
                        LocationName+=oLocations[i].text+",";
                        _sLocationID+=oLocations[i].id+",";
                    }
                }

                LocationName=LocationName.substring(0,LocationName.length-1);
                _sLocationID=_sLocationID.substring(0,_sLocationID.length-1);
                $("#winLocationPicker").icsWindow('close');
                $('#txtLocation_Colection').val(LocationName);
            }
            else
            {
                alert("Please select a location.");
            }
        }
    });

    $('#txtLocation_Colection').keypress(function (e)
    {
        var code = (e.keyCode ? e.keyCode : e.which);
        if (code == 13)//Enter key-13
        {
            var sBusinessUnitIDs ="";
            sBusinessUnitIDs=_sBusinessUnitIds;
            $("#winLocationPicker").icsWindow('open');
            var oLocation={LocationID:0,BusinessUnitIDs:sBusinessUnitIDs};
            var obj = {
                BaseAddress: _sBaseAddress,
                Object: oLocation,
                ControllerName: "Location",
                ActionName: "GetsLocationMenuTree",
                IsWinClose: false
            };
            $.icsDataGet(obj, function (response) {

                if (response.status && response.obj!=null) {
                    if (response.obj.TLocation.id > 0) {
                        $('#locationtree').tree({ data: [response.obj.TLocation] });
                    }
                }
            });
        }
    });

    $("#btnLocationPickerClose").click(function(e){
        $("#winLocationPicker").icsWindow('close');
    });

    $("#btnResetLocationPicker,#btnResetLocationPicker_Colection").click(function(e){
        $('#txtLocation').val("");
        $('#txtLocation_Colection').val("");
        _sLocationID="";
    });


        /*-------------shift picker------------*/
    $("#btnShift_Collection").click(function(e){
        ShiftPicker();
    });

    $("#txtShift_Collection").keypress(function(e){
        if (e.which == 13)//enter=13
        {
            ShiftPicker();
        }
    });

    function ShiftPicker()
    {
        
        var tblColums = [];
        var oColumn = { field: "ShiftWithDuration", title: "Shift", width: 200, align: "left" };tblColums.push(oColumn);

        var bmultiplereturn=true;

        var oPickerParam = {
            winid: 'winShift',
            winclass:'clsShift',
            winwidth: 320,
            winheight: 400,
            tableid: 'tblBusinessUnit',
            tablecolumns: tblColums,
            datalist: oShifts,
            multiplereturn: bmultiplereturn,
            searchingbyfieldName:'Name',
            windowTittle: 'Shift List'
        };
        $.icsPicker(oPickerParam);
        IntializeShiftPickerbutton(oPickerParam);//multiplereturn, winclassName
    }  

    function IntializeShiftPickerbutton(oPickerobj)
    {
        $("#" + oPickerobj.winid).find("#btnOk").click(function () {
            var oShiftTemps=[]; debugger;
            oShiftTemps = $('#'+oPickerobj.tableid).datagrid('getChecked');
            if (oPickerobj.winid == 'winShift')
            {
                if(oShiftTemps!=null && oShiftTemps.length>0)
                {
                    $("#"+oPickerobj.winid).icsWindow("close");
                    $("#" + oPickerobj.winid).remove();
                    var sShiftName = "";
                    for(var i=0; i<oShiftTemps.length; i++)
                    {
                        sShiftName+=oShiftTemps[i].Name+",";
                        _sShiftIDs+=oShiftTemps[i].ShiftID+",";
                    }

                    sShiftName=sShiftName.substring(0,sShiftName.length-1);
                    _sShiftIDs=_sShiftIDs.substring(0,_sShiftIDs.length-1);
                    $("#txtShift_Collection").val(sShiftName);
                }
                else
                {
                    alert("Please select a Shift.");
                }
            }
        });
    }

    $("#btnResetShift_Collection").click(function(e){
        $('#txtShift_Collection').val("");
        _sShiftIDs="";
    });


    function ProgressBar(bHide)
    {
        if(bHide)
        {
            $("#progbarParent").hide();
        }
        else{
            $("#progbarParent").show();
        }
    }

    function updateProgress()
    {
        var value =$('#progressbar').progressbar('getValue');
        if (value < 96){
            value += Math.floor(Math.random() * 5);
            $('#progressbar').progressbar('setValue', value);
        }
    }

    function hideShow(miliseconds)
    {
        $("#progressbarParent").hide();
    }

    //ProcessAttendance start

    //function ProcessAttendance()
    //{
    //    var oParameter = new Object();
    //    oParameter.Name = " Attendance Process ";
    //    var tsv = ((new Date()).getTime()) / 1000;
    //    var url = _sBaseAddress + "/ProcessManagement/ViewAttendanceProcessManagement?nId=0&ts=" + tsv;
    //    var nLeft = (window.screen.width / 2) - (300 / 2);
    //    var nHeight = (window.screen.height / 2) - (345 / 2);
    //    var oAttendanceProcessManagement = window.showModalDialog(url, oParameter, 'dialogHeight:345px;dialogWidth:300px;dialogLeft:' + nLeft + ';dialogTop:' + nHeight + ';center:yes;resizable:no;status:no;scroll:yes');

    //    if (oAttendanceProcessManagement != null) {
    //        if (oAttendanceProcessManagement.AttendanceProcessManagementID > 0) {
    //            var oAttendanceProcessManagements = $('#tblAttendanceProcessManagement').datagrid('getRows');
    //            var nIndex = oAttendanceProcessManagements.length;
    //            $('#tblAttendanceProcessManagement').datagrid('appendRow', oAttendanceProcessManagement);
    //            $('#tblAttendanceProcessManagement').datagrid('selectRow', nIndex);
    //        }
    //    }
    //}
    function LoadBU(oBUs)
    {
        $("#cboBU").icsLoadCombo({
            List:oBUs,
            OptionValue: "BusinessUnitID",
            DisplayText: "Name"
            //InitialValue:""
        });
        $("#cboBU_V1").icsLoadCombo({
            List:oBUs,
            OptionValue: "BusinessUnitID",
            DisplayText: "Name"
            //InitialValue:""
        });
    }

    function LoadLocation(oLocations)
    {
        $("#cboLocation").icsLoadCombo({
            List:oLocations,
            OptionValue: "LocationID",
            DisplayText: "LocationName"
            //InitialValue:""
        });
    }

    function LoadShift(oShifts)
    {
        $("#cboShift").icsLoadCombo({
            List:oShifts,
            OptionValue: "ShiftID",
            DisplayText: "Name"
            //InitialValue:""
        });
    }

    function LoadProcesType(oProcesTypes)
    {
        $("#cboProcesType").icsLoadCombo({
            List:oProcesTypes,
            OptionValue: "Value",
            DisplayText: "Text"
            //InitialValue:""
        });
    }

    function ProcessAttendance()
    {
        $('#dtProcess').datebox('setValue', icsdateformat(new Date()));
        //document.getElementById("cboProcesType").selectedIndex = 2;
        $("#cboProcesType").val(1);
        $("#cboLocation").val(0);
        $("#cboBU").val(0);
        $("#winProcessAttendance").icsWindow("open");
    }

    function RefreshObject()
    {
        var sDate=new Date($('#dtProcess').datebox('getValue'));
        var oAttendanceProcessManagement =
        {
            APMID :0,
            BusinessUnitID:$('#cboBU').val(),
            LocationID:$('#cboLocation').val(),
            DepartmentID:0,//$("#txtDepartmentID").val(),
            ShiftID:$("#cboShift").val(),
            ProcessTypeInt:$("#cboProcesType").val(),
            StatusInt:1,//Process
            AttendanceDate:sDate
        };
        return oAttendanceProcessManagement;
    }

    function Validate()
    {
        var BusinessUnitID = $('#cboBU').val();
        if(BusinessUnitID <=0)
        {
            alert("Please select a Business Unit");
            $('#cboBU').focus();
            return false;
        }
        var LocationID = $('#cboLocation').val();
        if(LocationID <=0)
        {
            alert("Please select a Location");
            $('#cboLocation').focus();
            return false;
        }
        return true;
    }

    function Process()
    {
        debugger;
        if(!Validate()) return;
        var oAttendanceProcessManagement = RefreshObject();
        document.getElementById('btnAttProcess').style.display='none';
        $.ajax({
            type: "POST",
            dataType: "json",
            url: _sBaseAddress + "/ProcessManagement/AttendanceProcessManagement_IU",
            traditional: true,
            data: JSON.stringify(oAttendanceProcessManagement),
            contentType: "application/json; charset=utf-8",

            success: function(data)
            {
                oAttendanceProcessManagement = jQuery.parseJSON(data);
                if (oAttendanceProcessManagement.APMID > 0)
                {
                    document.getElementById('btnAttProcess').style.display='';
                    alert("Data Saved sucessfully");
                    window.returnValue = oAttendanceProcessManagement;
                    window.close();
                }
                else
                {
                    alert(oAttendanceProcessManagement.ErrorMessage);
                    document.getElementById('btnAttProcess').style.display='';
                }
            },
            error: function(xhr, status, error)
            {
                alert(error);
            }
        });
    }

    function ProcessAttendanceClose()
    {
        $("#winProcessAttendance").icsWindow("close");
    }

    //ProcessAttendance end

    function RollBack() {
        if (!confirm("Confirm to Rollback?")) return ;
        var oAttendanceProcessManagement = $('#tblAttendanceProcessManagement').datagrid('getSelected');
        if (oAttendanceProcessManagement == null || oAttendanceProcessManagement.AttendanceProcessManagementID <= 0) {
            alert("Please select an item from list!");
            return;
        }
        if (oAttendanceProcessManagement.StatusInString=='Freeze' || oAttendanceProcessManagement.StatusInString=='Rollback')
        {
            alert('Status must be in "Process" or "Re-Process" to Rollback.!');
            return;
        }
        document.getElementById("btnRollBack").style.display ='none' ;
        oAttendanceProcessManagement.StatusInt=2;//RollBack
        APMIUD("Rollback",oAttendanceProcessManagement);
    }

    function ReProcess() {
        if (!confirm("Confirm to Reprocess?")) return ;
        var oAttendanceProcessManagement = $('#tblAttendanceProcessManagement').datagrid('getSelected');
        if (oAttendanceProcessManagement == null || oAttendanceProcessManagement.AttendanceProcessManagementID <= 0) {
            alert("Please select an item from list!");
            return;
        }
        if (oAttendanceProcessManagement.StatusInString!='Rollback')
        {
            alert('Status must be in "Rollback" to Re-Process.!');
            return;
        }
        document.getElementById("btnReProcess").style.display='none'
        oAttendanceProcessManagement.StatusInt=3;//Re-Process
        APMIUD("Re-Process",oAttendanceProcessManagement);
    }

    function Freeze() {
        if (!confirm("Confirm to Freeze?")) return ;
        var oAttendanceProcessManagement = $('#tblAttendanceProcessManagement').datagrid('getSelected');
        if (oAttendanceProcessManagement == null || oAttendanceProcessManagement.AttendanceProcessManagementID <= 0) {
            alert("Please select an item from list!");
            return;
        }
        if (oAttendanceProcessManagement.StatusInString=='Rollback' || oAttendanceProcessManagement.StatusInString=='Freeze')
        {
            alert('Status must be in "Process" or "ReProcessed" to Freeze.!');
            return;
        }
        document.getElementById("btnFreeze").style.display='none';
        oAttendanceProcessManagement.StatusInt=4;//freeze
        APMIUD("Freeze",oAttendanceProcessManagement);
    }

    function APMIUD(sAction,oAttendanceProcessManagement)
    {
        oAttendanceProcessManagement.ProcessTypeInt=1;//Daily Process
        var SelectedRowIndex = $('#tblAttendanceProcessManagement').datagrid('getRowIndex', oAttendanceProcessManagement);
        $.ajax({
            type: "POST",
            dataType: "json",
            url: _sBaseAddress + "/ProcessManagement/AttendanceProcessManagement_IU",
            traditional: true,
            data: JSON.stringify(oAttendanceProcessManagement),
            contentType: "application/json; charset=utf-8",
            success: function(data)
            {
                document.getElementById("btnRollBack").style.display = '';
                document.getElementById("btnReProcess").style.display = '';
                document.getElementById("btnFreeze").style.display = '';
                var oAPM = jQuery.parseJSON(data);
                if (oAPM.ErrorMessage =="")
                {
                    alert(sAction+" sucessfully.!!");
                    $('#tblAttendanceProcessManagement').datagrid('updateRow', { index: SelectedRowIndex, row: oAPM });
                }
                else
                {
                    alert(oAPM.ErrorMessage);
                }
            },
            error: function(xhr, status, error)
            {
                alert(error);
            }
        });
    }

    function RTData()
    {
        var tsv = ((new Date()).getTime()) / 1000;
        var oParameter=new Object();
        var url = _sBaseAddress + "/ProcessManagement/ViewDataCollectionRT?ts=" + tsv;
        window.showModalDialog(url, oParameter, 'dialogHeight:195px;dialogWidth:300px;dialogLeft:450;dialogRight:250;dialogTop:200;center:yes;resizable:no;status:no;scroll:no');
    }

    //function  icsdateformat(date)
    //{
    //     var mthNames = ["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];
    //     var y = date.getFullYear();
    //     var m = date.getMonth();
    //     var d = date.getDate();
    //     var result= d +' '+ mthNames[m]+' '+ y;
    //     return result;
    //}

    //sagor datetime start
    function SetDateTime()
    {
        var oDate=new Date();
        oDate.setFullYear(2014);
        /*---------------------------------------- Start Set Year-------------------------------------------*/
        var sYear="";
        sYear +="<option value='0'>"+'Year'+"</option>";
        for(var i=0; i<=10; i++)
        {
            sYear += "<option value='" + (parseInt(oDate.getFullYear()) + parseInt(i)) +"'>" + (parseInt(oDate.getFullYear()) + parseInt(i)) +"</option>";
        }
        $('#cboYear').html(sYear);
        /*---------------------------------------- End Set Year-------------------------------------------*/

        /*---------------------------------------- Start Set Month-------------------------------------------*/
        var sMonth="";
        var oMonths=['Jan','Feb','Mar','Apr','May','Jun','Jul','Aug','Sep','Oct','Nov','Dec'];
        sMonth +="<option value='0'>"+'Month'+"</option>";
        for(var i=0; i<oMonths.length; i++)
        {
            sMonth += "<option value='" +(parseInt(i)+1)+"'>" + oMonths[i] +"</option>";
        }
        $('#cboMonth').html(sMonth);
        /*---------------------------------------- End Set Month-------------------------------------------*/

        /*---------------------------------------- Start Set Date-------------------------------------------*/
        var sDay ="<option value='0'>"+'Day'+"</option>";
        $('#cboDay').html(sDay);
        /*---------------------------------------- End Set Date-------------------------------------------*/
    }

    $('#cboYear').change(function(e)
    {
        var nYear=$('#cboYear').val();
        var nMonth=$('#cboMonth').val();
        if(nYear>0 && nMonth>0)
        {
            $('#cboDay').html(SetDateEvent(nYear, nMonth));
        }
    });

    $('#cboMonth').change(function(e)
    {
        var nYear=$('#cboYear').val();
        var nMonth=$('#cboMonth').val();
        if(nYear>0 && nMonth>0)
        {
            $('#cboDay').html(SetDateEvent(nYear, nMonth));
        }
    });

    function SetDateEvent(nYear, nMonth)
    {
        var oDate=new Date();
        var sDay="";
        if( parseInt(nMonth)>0)
        {
            var nDay= new Date(parseInt(nYear), parseInt(nMonth), 0).getDate();
            sDay +="<option value='0'>"+'Day'+"</option>";
            for(var i=1; i<=parseInt(nDay); i++)
            {
                if(i<10)
                {
                    sDay += "<option value='" +i+"'>" + '0'+i +"</option>";
                }
                else
                {
                    sDay += "<option value='" +i+"'>" + i +"</option>";
                }
            }
        }
        return sDay;
    }

    function SetStartTime(oDate)
    {
        var nyear=oDate.getFullYear();
        var nmonth=oDate.getMonth()+1;
        var nday=oDate.getDate();
        $('#cboYear').val(nyear);
        $('#cboMonth').val(nmonth);
        $('#cboDay').html(SetDateEvent(nyear,nmonth));
        $('#cboDay').val(nday);
    }

    function GenerateStartTimeInString()
    {
        var sDate=  $('#cboMonth').val() +'/'+ $('#cboDay').val() +'/'+ $('#cboYear').val() + "~"+ _sBusinessUnitIds + "~" + _sLocationID + "~" + _sShiftIDs;
        return sDate;
    }

    function ValidationOfStartTime()
    {
        if($('#cboYear').val()==0)
        {
            alert("Please select a year.");
            document.getElementById('cboYear').focus();
            return false;
        }
        if($('#cboMonth').val()==0)
        {
            alert("Please select a month.");
            document.getElementById('cboMonth').focus();
            return false;
        }
        if($('#cboDay').val()==0)
        {
            alert("Please select a day.");
            document.getElementById('cboDay').focus();
            return false;
        }
        return true;
    }
    //sagor datetime end

    function Search()
    {
        debugger;
        if(!ValidationOfStartTime()) return;
        var sDate = GenerateStartTimeInString();

        $.ajax({
            type: "GET",
            dataType: "json",
            url: '@Url.Action("GetAPMs", "ProcessManagement")',
            data: { sParam: sDate },
            contentType: "application/json; charset=utf-8",
            success: function (data) {
                debugger;
                var  oAPMs = jQuery.parseJSON(data);
                if(oAPMs.length>0)
                {
                    _oAttendanceProcessManagements=[];
                    _oAttendanceProcessManagements=oAPMs;
                    DynamicRefreshList(_oAttendanceProcessManagements, "tblAttendanceProcessManagement");
                }
                else
                {
                    alert("Data not found by this date!!");
                    _oAttendanceProcessManagements=[];
                    _oAttendanceProcessManagements=oAPMs;
                    DynamicRefreshList(_oAttendanceProcessManagements, "tblAttendanceProcessManagement");
                }
            },
            error: function (xhr, status, error) {
                alert(error);
            }
        });
    }

        
        $('#cboBU_V1').change(function(e)
        {
            DynamicRefreshList([], "tblShift_V1");
        });
        $('#cboLocation_V1').change(function(e)
        {
            DynamicRefreshList([], "tblShift_V1");
        });

    $('#btnRefreshShift').click(function (e)
    {
        
        var oLocations= $('#tblLocation_V1').datagrid('getChecked');
        
        var sLocIDs="";
        for(var i=0; i<oLocations.length; i++)
        {
            sLocIDs+=oLocations[i].LocationID+",";
        }
        sLocIDs=sLocIDs.substring(0,sLocIDs.length-1);

        debugger;
        if($('#cboBU_V1').val() <= 0 || oLocations.length <= 0) {
            alert("Both BusinessUnit and Location needed.");
            return;
        }

        var Param = $('#cboBU_V1').val() + "~" + sLocIDs;

        $.ajax({
            type: "GET",
            dataType: "json",
            url: '@Url.Action("GetsShiftRefresh", "ProcessManagement")',
            data: { sParam: Param },
            contentType: "application/json; charset=utf-8",
            success: function (data) {
                debugger;
                var  objShift = jQuery.parseJSON(data);
                if(objShift.length>0)
                {
                    DynamicRefreshList(objShift, "tblShift_V1");
                }
                else
                {
                    alert("Data not found by this date!!");
                    DynamicRefreshList([], "tblShift_V1");
                }
            },
            error: function (xhr, status, error) {
                alert(error);
            }
        });
    });

    $('#btnCollectData').click(function (e)
    {
        DynamicRefreshList(_oAAPs, "tblAAPs");
        $("#winCollectData").icsWindow("open");
    });

    $('#btnCloseProcess').click(function (e)
    {
        $("#winCollectData").icsWindow("close");
    });

    $('#btnProcess').click(function (e)
    {
        var oAAPs = $('#tblAAPs').datagrid('getRows');
        if(oAAPs== null || oAAPs.length<=0)
        {
            alert("Please select an attendance access point!");
            return;
        }
        var sAAPIDs="";
        for(var i=0; i<oAAPs.length; i++)
        {
            sAAPIDs+=oAAPs[i].AAPID+",";
        }
        sAAPIDs=sAAPIDs.substring(0,sAAPIDs.length-1);
        var sDate=$('#dtDate').datebox('getValue');
        var tsv = ((new Date()).getTime()) / 1000;
        $.ajax({
            type: "POST",
            dataType: "json",
            url: _sBaseAddress + "/ProcessManagement/ProcessDataCollection",
            traditional: true,
            data: JSON.stringify({sAAPIDs:sAAPIDs,sDate:sDate}),
            contentType: "application/json; charset=utf-8",
            success: function(data)
            {
                var sMessage = jQuery.parseJSON(data);
                alert(sMessage);
                $("#winCollectData").icsWindow("close");
            },
            error: function(xhr, status, error)
            {
                alert(error);
            }
        });
    });

    $('#btnImportXL').click( function ()
    {
        var PunchDateFormat=$("#cboEnumPunchFormat").val();
        $("#txtEnumPunchFormat").val(PunchDateFormat);

        if ($.trim($("#filePunchLogs").val()) == "") {
            alert("Please select a file.");
            $("#filePunchLogs").addClass("errorFieldBorder");
            $("#filePunchLogs").focus();
            return false;
        } else {
            $("#filePunchLogs").removeClass("errorFieldBorder");
        }
        return true;
    });

    $('#btnPunchLogImportFormatSave').click(function(e) {
        var PunchDateFormat=$("#cboEnumPunchFormat").val();
        var oPunchLogImportFormat ={PLIFID:0,PunchFormat:PunchDateFormat}
        var obj = {
            BaseAddress: _sBaseAddress,
            Object: oPunchLogImportFormat,
            ObjectId: oPunchLogImportFormat.PLIFID,
            ControllerName: "PunchLog",
            ActionName: "PunchLogImportFormat_IU",
            TableId: "",
            IsWinClose: false,
        };
        $.icsSave(obj);
    });

    $('#cboBU').change(function(e)
    {
        var nBUID =$('#cboBU').val();
        var oList =[];
        for(var i = 0; i<_oLocations.length; i++)
        {
            if(_oLocations[i].BusinessUnitID == nBUID)
            {
                oList.push(_oLocations[i]);
            }
        }
        LoadLocation(oList);
    });

    /*------------- Process V1 Start -------------------*/
    function ProcessAttendance_V1()
    {
        $('#dtProcess_V1').datebox('setValue', icsdateformat(new Date($('#cboYear').val(), $('#cboMonth').val()-1, $('#cboDay').val())));
        $("#cboLocation_V1").val(0);
        $("#cboBU_V1").val(0);
        $("#winProcessAttendance_V1").icsWindow("open");
    }
    function ProcessAttendanceClose_V1()
    {
        $("#winProcessAttendance_V1").icsWindow("close");
    }

    $('#cboBU_V1').change(function(e)
    {
        var nBUID =$('#cboBU_V1').val();
        var oList =[];
        for(var i = 0; i<_oLocations.length; i++)
        {
            if(_oLocations[i].BusinessUnitID == nBUID)
            {
                oList.push(_oLocations[i]);
            }
        }
        //LoadLocation_V1(oList);
        DynamicRefreshList(oList, "tblLocation_V1");
    });

    function LoadLocation_V1(oLocations)
    {
        $("#cboLocation_V1").icsLoadCombo({
            List:oLocations,
            OptionValue: "LocationID",
            DisplayText: "LocationName"
        });
    }

    function RefreshObject_V1()
    {
        var sDate=new Date($('#dtProcess_V1').datebox('getValue'));
        var oShifts= $('#tblShift_V1').datagrid('getChecked');

        var oLocations= $('#tblLocation_V1').datagrid('getChecked');
        
        //var sLocIDs="";
        //for(var i=0; i<oLocations.length; i++)
        //{
        //    sLocIDs+=sLocIDs[i].sLocIDs+",";
        //}
        //sLocIDs=sLocIDs.substring(0,sLocIDs.length-1);

        var oAttendanceProcessManagement =
        {
            APMID :0,
            BusinessUnitID:$('#cboBU_V1').val(),
            //LocationID:$('#cboLocation_V1').val(),
            Locations:oLocations,
            DepartmentID:0,
            Shifts:oShifts,
            ProcessTypeInt:1,//daily
            StatusInt:1,//Process
            AttendanceDate:sDate
        };
        return oAttendanceProcessManagement;
    }

    function Validate_V1()
    {
        var BusinessUnitID = $('#cboBU_V1').val();
        if(BusinessUnitID <=0)
        {
            alert("Please select a Business Unit");
            $('#cboBU_V1').focus();
            return false;
        }
        //var LocationID = $('#cboLocation_V1').val();
        
        var oLocations= $('#tblLocation_V1').datagrid('getChecked');

        if(oLocations.length <=0)
        {
            alert("Please select a Location");
            return false;
        }
        var oShifts= $('#tblShift_V1').datagrid('getChecked');
        if(oShifts== null || oShifts.length<=0)
        {
            alert("Please select at least one shift !");
            return false;
        }
        return true;
    }

    function Process_V1()
    {
        if(!Validate_V1()) return;
        var oAttendanceProcessManagement = RefreshObject_V1();
        document.getElementById('btnAttProcess_V1').style.display='none';
        $("#progressbar").progressbar({ value: 0 });
        $("#progressbarParent").show();
        $("#winProcessAttendance_V1").icsWindow("close");
        var intervalID = setInterval(updateProgress, 250);
        $.ajax({
            type: "POST",
            dataType: "json",
            url: _sBaseAddress + "/ProcessManagement/AttendanceProcessManagement_Process_V1",
            traditional: true,
            data: JSON.stringify(oAttendanceProcessManagement),
            contentType: "application/json; charset=utf-8",

            success: function(data)
            {
                var oAttendanceProcessManagements = jQuery.parseJSON(data);
                if (oAttendanceProcessManagements.length > 0 && oAttendanceProcessManagements[0].ErrorMessage=="")
                {
                    document.getElementById('btnAttProcess_V1').style.display='';
                    alert("Data Saved sucessfully");
                    DynamicRefreshList([], "tblShift_V1");
                    DynamicRefreshList([], "tblLocation_V1");

                    DynamicRefreshList(oAttendanceProcessManagements, "tblAttendanceProcessManagement");
                    $("#winProcessAttendance_V1").icsWindow("close");
                }
                else
                {
                    alert(oAttendanceProcessManagements[0].ErrorMessage);
                    document.getElementById('btnAttProcess_V1').style.display='';
                }
                clearInterval(intervalID);
                $("#progressbarParent").hide();
            },
            error: function(xhr, status, error)
            {
                alert(error);
                clearInterval(intervalID);
                $("#progressbarParent").hide();
                $("#main-body").show();
            }
        });
    }

    function ReProcess_V1()
    {
        var oAPMs = $('#tblAttendanceProcessManagement').datagrid('getChecked');
        if(oAPMs==null || oAPMs.length<=0 )
        {
            alert('Please select at least one item from the list !');
            return;
        }

        var nIndexes = [];
        for (var i = 0; i < oAPMs.length; i++) {
            var SelectedRowIndex = $('#tblAttendanceProcessManagement').datagrid('getRowIndex', oAPMs[i]);
            nIndexes.push(SelectedRowIndex);
        }

        $("#progressbar").progressbar({ value: 0 });
        $("#progressbarParent").show();
        var intervalID = setInterval(updateProgress, 250);

        var oAttendanceProcessManagement={AttendanceProcessManagements:oAPMs};

        $.ajax({
            type: "POST",
            dataType: "json",
            url: _sBaseAddress + "/ProcessManagement/AttendanceProcessManagement_ReProcess_V1",
            traditional: true,
            data: JSON.stringify(oAttendanceProcessManagement),
            contentType: "application/json; charset=utf-8",

            success: function(data)
            {
                var oAttendanceProcessManagements = jQuery.parseJSON(data);
                if (oAttendanceProcessManagements.length > 0 && oAttendanceProcessManagements[0].ErrorMessage=="")
                {
                    alert("Reprocessed sucessfully");
                    for (var i = 0; i < oAttendanceProcessManagements.length; i++) {
                        $('#tblAttendanceProcessManagement').datagrid('updateRow', { index: nIndexes[i], row: oAttendanceProcessManagements[i] });
                    }
                }
                else
                {
                    alert(oAttendanceProcessManagements[0].ErrorMessage);
                }
                clearInterval(intervalID);
                $("#progressbarParent").hide();
            },
            error: function(xhr, status, error)
            {
                alert(error);
                clearInterval(intervalID);
                $("#progressbarParent").hide();
                $("#main-body").show();
            }
        });
    }

    function RollBack_Freeze(sType)
    {
        var oAPMs = $('#tblAttendanceProcessManagement').datagrid('getChecked');
        if(oAPMs==null || oAPMs.length<=0 )
        {
            alert('Please select at least one item from the list !');
            return;
        }

        var nIndexes = [];
        for (var i = 0; i < oAPMs.length; i++) {
            var SelectedRowIndex = $('#tblAttendanceProcessManagement').datagrid('getRowIndex', oAPMs[i]);
            nIndexes.push(SelectedRowIndex);
        }

        $("#progressbar").progressbar({ value: 0 });
        $("#progressbarParent").show();
        var intervalID = setInterval(updateProgress, 250);

        var nStatusInt=0;
        if(sType=='RollBack')
        {
            nStatusInt=2;
        }
        else if(sType=='Freeze')
        {
            nStatusInt=4;
        }
        else if(sType=='UnFreeze')
        {
            nStatusInt=5;
        }

        var oAttendanceProcessManagement={AttendanceProcessManagements:oAPMs,StatusInt:nStatusInt};

        $.ajax({
            type: "POST",
            dataType: "json",
            url: _sBaseAddress + "/ProcessManagement/AttendanceProcessManagement_Rollback_Freeze",
            traditional: true,
            data: JSON.stringify(oAttendanceProcessManagement),
            contentType: "application/json; charset=utf-8",

            success: function(data)
            {
                var oAttendanceProcessManagement = jQuery.parseJSON(data);
                if (oAttendanceProcessManagement.ErrorMessage=="")
                {
                    alert(sType+"ed sucessfully");
                    for (var i = 0; i < oAPMs.length; i++) {

                        if(sType=='UnFreeze')
                        {
                            sType='Processed';
                        }

                        oAPMs[i].StatusInString=sType;
                        $('#tblAttendanceProcessManagement').datagrid('updateRow', { index: nIndexes[i], row: oAPMs[i] });
                    }
                }
                else
                {
                    alert(oAttendanceProcessManagement.ErrorMessage);
                }
                clearInterval(intervalID);
                $("#progressbarParent").hide();
            },
            error: function(xhr, status, error)
            {
                alert(error);
                clearInterval(intervalID);
                $("#progressbarParent").hide();
                $("#main-body").show();
            }
        });
    }

    /*------------- Process V1 End ---------------------*/

    </script>
