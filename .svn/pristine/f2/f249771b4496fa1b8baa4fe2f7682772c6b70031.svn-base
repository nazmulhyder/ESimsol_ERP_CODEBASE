<html>
<head>  
    <link href="@Url.Content("~/Content/CSS/icon.css")" rel="stylesheet" type="text/css" />
    <link href="@Url.Content("~/Content/CSS/easyui.css")" rel="stylesheet" type="text/css" />
    <link href="@Url.Content("~/Content/CSS/Pikerstyle.css")" rel="stylesheet" type="text/css" />

    <script src="@Url.Content("~/Scripts/jquery-1.7.1.min.js")" type="text/javascript"></script>
    <script src="@Url.Content("~/Scripts/jquery.ics.customize.js")" type="text/javascript"></script>
    <script src="@Url.Content("~/Scripts/jquery.easyui.min.js")" type="text/javascript"></script>

    <script src="@Url.Content("~/Scripts/jquery-ui.min.js")" type="text/javascript"></script>
    <script src="@Url.Content("~/Scripts/json2.js")" type="text/javascript"></script>
    
</head>
<body>

@model ESimSol.BusinessObjects.DataCollectionSetup
<div style="font-family:Tahoma">           
<table border="0" cellspacing="2" cellpadding="2">
    <tr>
        <td style="background-color:#CFB53B; text-align:center; width:620px; color:White">
            <label id="lblHeaderName" style="font-size:15px; font-weight:bold; text-decoration:Underline"> Configure Voucher Setup</label>
        </td>
    </tr>
</table>
<fieldset>
    
    <table border="0" cellspacing="2" cellpadding="2" style="font-size:11px; font-weight:bold">
         <tr>
            <td style="width:125px; text-align:right">
            </td>
            <td style="width:450px">
                <input type ="checkbox" id="chkBoxManual" onClick = "ManualCheck()" /> Manual Data&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <input type ="checkbox" id="chkBoxAutomated" onClick = "AutomatedCheck()" /> Automated Data
            </td>
        </tr>   
        <tr>
            <td style="width:125px; text-align:right">
                Query For Value :
            </td>
            <td style="width:450px">
                @Html.TextBoxFor(model => model.QueryForValue, new { style = "width: 390px;", id = "txtQueryForValue" }) <input type ="button" id ="btnDBView" style=" width:55px; font-size:12px;" onclick = "DBViewPicker()" value ="DB View" />
            </td>
        </tr>   
        
        <tr>
            <td style="width:125px; text-align:right">
                 Ref Value Field(s):
            </td>
            <td style="width:450px">
              @Html.TextBoxFor(model => model.ReferenceValueFields, new { style = "width: 450px;", id = "txtReferenceValueFields" }) 
             </td>
        </tr>      
        <tr>
            <td style="width:125px; text-align:right">
                Note :
            </td>
            <td style="width:450px">
              @Html.TextBoxFor(model => model.Note, new { style = "width: 450px;", id = "txtNote" }) 
            </td>
        </tr>     
    </table>
</fieldset>
    
    <fieldset>
        <legend style="font-weight:bold"> Action : </legend>
        <table border="0" cellspacing="2" cellpadding="2" style="font-size:11px; font-weight:bold">
            <tr>
                <td style="width:500px; text-align:right"></td>
                <td style="width:50px">
                   <a id="btnSave" href="javascript:void(0)" class="easyui-linkbutton" iconCls="icon-save" plain="true" onclick="Save()">Save</a>
                </td>
                <td style="width:50px">
                   <a href="javascript:void(0)" class="easyui-linkbutton" iconCls="icon-cancel" plain="true" onclick="Close()">Close</a>
                </td>
            </tr>       
        </table>
    </fieldset>
</div>
</body>
</html>


<script type="text/javascript"> 
 var _oDataCollectionSetup=null;
 var _sBaseAddress="";
 var _nDataReferenceType = 0;
 var _nDataReferenceID = 0;
 var _nDataSetupTypeInInt = 0;
 $(document).ready(function () {
        //debugger;     
        _sBaseAddress =@Html.Raw( new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(HttpContext.Current.Session[SessionInfo.BaseAddress]));                  
        _oDataCollectionSetup =@Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(Model)); 
        var obj = window.dialogArguments;
        document.getElementById('lblHeaderName').innerHTML=obj.Name;
        _oDataCollectionSetup =obj.DataCollectionSetup; 
        document.getElementById('chkBoxAutomated').checked=true;        
        if(parseInt(_oDataCollectionSetup.DataGenerateTypeInInt) == 1)
        {
            document.getElementById('txtQueryForValue').disabled = true;
            document.getElementById('btnDBView').disabled = true;
            document.getElementById('txtReferenceValueFields').disabled = true;
            document.getElementById('chkBoxAutomated').checked=false;
            document.getElementById('chkBoxManual').checked=true;
        }
        else if(parseInt(_oDataCollectionSetup.DataGenerateTypeInInt) == 2)
        {
            document.getElementById('txtQueryForValue').disabled = false;
            document.getElementById('btnDBView').disabled = false;
            document.getElementById('txtReferenceValueFields').disabled = false;
            document.getElementById('chkBoxManual').checked=false;
        }
        $('#txtQueryForValue')[0].value = _oDataCollectionSetup.QueryForValue;
        $('#txtReferenceValueFields')[0].value = _oDataCollectionSetup.ReferenceValueFields;
        $('#txtNote')[0].value = _oDataCollectionSetup.Note;
 }); 



 
 function ManualCheck()
 {
     if(document.getElementById("chkBoxManual").checked == true)
      {
        document.getElementById('txtQueryForValue').disabled = true;
        document.getElementById("txtQueryForValue").value = '';
        document.getElementById('btnDBView').disabled = true;
        document.getElementById('txtReferenceValueFields').disabled = true;
        document.getElementById("txtReferenceValueFields").value = '';
        document.getElementById('chkBoxAutomated').checked=false;
      }
 }
  
 function AutomatedCheck()
 {
     if(document.getElementById("chkBoxAutomated").checked)
      {
        document.getElementById('txtQueryForValue').disabled = false;
        document.getElementById('btnDBView').disabled = false;
        document.getElementById('txtReferenceValueFields').disabled = false;
        document.getElementById('chkBoxManual').checked=false;
      }
 }

     function DBViewPicker()
     {
           var oParameter = new Object();
           oParameter.Name = "Database Tables & Columns";
           var tsv=((new Date()).getTime())/1000;
           var url = _sBaseAddress+"/IntegrationSetup/ViewDatabasePicker?ts="+tsv;
           var oDataCollectionSetup = window.showModalDialog(url, oParameter, 'dialogHeight:410px;dialogWidth:520px;dialogLeft:300;dialogTop:100;center:yes;resizable:yes;status:no;scroll:no');

     }

    function ValidateInput()
    {  
        if(document.getElementById("chkBoxAutomated").checked == false && document.getElementById("chkBoxManual").checked == false)
        {
            alert("Please select any one between Automated & Manual Data!");
            $('#chkBoxAutomated').focus();
            return false;
        }
          
        if(document.getElementById("chkBoxAutomated").checked)
        {
            if(document.getElementById("txtQueryForValue").value==null || document.getElementById("txtQueryForValue").value=="")
            {   
                alert("Please type Query or Pick Value");
                $('#txtQueryForValue').focus();
                return false;
            }    
            if(document.getElementById("txtReferenceValueFields").value==null || document.getElementById("txtReferenceValueFields").value=="")
            {
                alert("Please type Reference Field Value");
                $('#txtReferenceValueFields').focus();
                return false;
            }
            var sQueryForValue = document.getElementById("txtQueryForValue").value;
            var aQueryForValue= sQueryForValue.split(" ");
            if(aQueryForValue.length<4)
            {
                alert("Incomplete Query! Please check your Query.");
                $('#txtQueryForValue').focus();
                return false;
            }
        }
        return true;
    }


    function RefreshObject()
    {    
      //debugger; 
      var nDataGenerateType = 0;
      var sDataGenerateTypeInString = "None";
      if(document.getElementById("chkBoxManual").checked)
      {
        nDataGenerateType = 1;
        sDataGenerateTypeInString ="ManualData";
      }else if(document.getElementById("chkBoxAutomated").checked)
      {
        nDataGenerateType = 2;
        sDataGenerateTypeInString ="AutomatedData";
      }
        var oDataCollectionSetup= {     
                        DataCollectionSetupID : _oDataCollectionSetup.DataCollectionSetupID,
                        DataReferenceTypeInInt :_oDataCollectionSetup.DataReferenceTypeInInt,
                        DataReferenceID : _oDataCollectionSetup.DataReferenceID,
                        DataSetupTypeInInt : _oDataCollectionSetup.DataSetupTypeInInt,
                        DataGenerateTypeInInt : nDataGenerateType,
                        QueryForValue : $("#txtQueryForValue").val(),
                        ReferenceValueFields : $("#txtReferenceValueFields").val(),
                        Note : $("#txtNote").val(),
                        DataGenerateTypeInString : sDataGenerateTypeInString,
                        SetupText : GetSetupText()
                    };
        return oDataCollectionSetup;
    } 

    function GetSetupText()
    {
        var sSetupText="";
        if(document.getElementById("chkBoxManual").checked)
        {
            sSetupText= "Manual Data";          
        }
        else if(document.getElementById("chkBoxAutomated").checked)
        {
            var sQueryForValue = document.getElementById("txtQueryForValue").value;
            var aQueryForValue= sQueryForValue.split(" ");            
            sSetupText = aQueryForValue[1] + " of "+ aQueryForValue[3];
        }
        return sSetupText;
    }

    function Save()
    {
        //debugger;
        if(!ValidateInput()) return;
        var oDataCollectionSetup=RefreshObject();
        window.returnValue = oDataCollectionSetup;
        window.close();     
    }
          
    function Close()
    {
        window.close();
    }
</script>