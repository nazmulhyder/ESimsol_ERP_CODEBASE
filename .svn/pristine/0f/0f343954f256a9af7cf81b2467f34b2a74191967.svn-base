@{
    ViewBag.Title = "Terms & Conditions";
}
@model IEnumerable<ESimSol.BusinessObjects.POTandCSetup>

<div style="margin-left:0px; height:100%;width:100%">
            <table id="tblPOTandCSetups" title="Terms & Condition List"  class="easyui-datagrid" style="width:100%;height:100%" fitColumns="true"  rownumbers="true" pagination="true" singleSelect="true", autoRowHeight="false" toolbar="#toolbar">
                <thead>  
                    <tr>  
                        
                        <th field="ClauseTypeSt" width="80">Apply Module </th> 
                        <th field="Clause" width="350">Terms & Conditions</th>  
                        <th field="ActivityInString" width="50">Active / In-Active</th>  
                        <th field="Note" width="50" >Note</th>                                                      
                    </tr>  
                </thead> 
            </table>​  
            <div id="toolbar"> 
                <a href="javascript:void(0)" class="easyui-linkbutton" iconCls="icon-reload" plain="true" onclick="Refresh()">Refresh</a>                
                <a id="btnAdd" href="javascript:void(0)" class="easyui-linkbutton" iconCls="icon-add" plain="true" onclick="Add()">Add</a>  
                <a id="btnEdit" href="javascript:void(0)" class="easyui-linkbutton" iconCls="icon-edit" plain="true" onclick="Edit()">Edit</a>                
                <a id="btnView" href="javascript:void(0)" class="easyui-linkbutton" iconCls="icon-details" plain="true" onclick="Details()">View</a>
                <a href="javascript:void(0)" class="easyui-linkbutton" iconCls="icon-remove" plain="true" onclick="Delete()">Delete</a>
                <a href="javascript:void(0)" class="easyui-linkbutton" iconCls="icon-ok" plain="true" onclick="ActiveInActive()">Active/In-Active</a>                 
            </div>  
</div>



<script type="text/javascript">
    var _oPOTandCSetups=[];
    var _sBaseAddress="";
    $(document).ready(function () {
        //debugger;
        _oPOTandCSetups =@Html.Raw( new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(Model));
        _sBaseAddress =@Html.Raw( new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(HttpContext.Current.Session[SessionInfo.BaseAddress]));
        var nBUID = @Html.Raw( new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(ViewBag.BUID));
        sessionStorage.setItem('BUID',nBUID);
    _nID =parseInt(sessionStorage.getItem("SelectedRowIndex"));
    var oPOTandCSetups =sessionStorage.getItem("POTandCSetups");
    if(oPOTandCSetups!=null)
    {
        oPOTandCSetups = jQuery.parseJSON(oPOTandCSetups);
    }
    else
    {
        oPOTandCSetups=_oPOTandCSetups;
    }

    DynamicRefreshList(oPOTandCSetups, 'tblPOTandCSetups');
    if(_nID!=-1)
    {
        $('#tblPOTandCSetups').datagrid('selectRow', _nID);
    }

});

function Refresh()
{
    var oPOTandCSetups = $('#tblPOTandCSetups').datagrid('getRows');
    data=oPOTandCSetups;
    data={"total":""+data.length+"","rows":data};
    $('#tblPOTandCSetups').datagrid('loadData',data);
}

function Add()
{

    var oPOTandCSetups= $('#tblPOTandCSetups').datagrid('getRows');
    sessionStorage.setItem("POTandCSetups", JSON.stringify(oPOTandCSetups));
    sessionStorage.setItem("SelectedRowIndex", -1);
    sessionStorage.setItem("POTandCSetupHeader", "Add POTandCSetup");
    sessionStorage.setItem("BackLink", window.location.href);
    //var tsv=((new Date()).getTime())/1000;
    window.location.href = _sBaseAddress+ "/POTandCSetup/ViewPOTandCSetup?id=0";
    //debugger;

}



function Edit()
{
    var oPOTandCSetup= $('#tblPOTandCSetups').datagrid('getSelected');
    if(oPOTandCSetup==null || oPOTandCSetup.POTandCSetupID<=0)
    {
        alert("Please select a item from list!");
        return;
    }

    var SelectedRowIndex=$('#tblPOTandCSetups').datagrid('getRowIndex',oPOTandCSetup);
    var oPOTandCSetups= $('#tblPOTandCSetups').datagrid('getRows');
    sessionStorage.setItem("POTandCSetups", JSON.stringify(oPOTandCSetups));
    sessionStorage.setItem("SelectedRowIndex", SelectedRowIndex);
    sessionStorage.setItem("POTandCSetupHeader", "Edit POTandCSetup");
    sessionStorage.setItem("BackLink", window.location.href);
    window.location.href = _sBaseAddress+  "/POTandCSetup/ViewPOTandCSetup?id="+oPOTandCSetup.POTandCSetupID;

    ////debugger;
    //var oPOTandCSetup= $('#tblPOTandCSetups').datagrid('getSelected');
    //if(oPOTandCSetup==null || oPOTandCSetup.POTandCSetupID<=0)
    //{
    //    alert("Please select a item from list!");
    //    return;
    //}
    //var SelectedRowIndex=$('#tblPOTandCSetups').datagrid('getRowIndex',oPOTandCSetup);
    //var oParameter = new Object();
    //oParameter.Name = "Edit Terms & Condition";
    //var tsv=((new Date()).getTime())/1000;
    //var url =_sBaseAddress+  "/POTandCSetup/ViewPOTandCSetup?id="+oPOTandCSetup.POTandCSetupID+"&ts="+tsv;
    //oPOTandCSetup = window.showModalDialog(url, oParameter, 'dialogHeight:220px;dialogWidth:705px;dialogLeft:500;dialogTop:200;center:yes;resizable:no;status:no;scroll:no');
    ////debugger
    //if(oPOTandCSetup!=null)
    //{
    //    if(oPOTandCSetup.POTandCSetupID>0)
    //    {

    //        $('#tblPOTandCSetups').datagrid('updateRow',{index: SelectedRowIndex,	row: oPOTandCSetup});
    //    }
    //}
}


function Details()
{
    var oPOTandCSetup= $('#tblPOTandCSetups').datagrid('getSelected');
    if(oPOTandCSetup==null || oPOTandCSetup.POTandCSetupID<=0)
    {
        alert("Please select a item from list!");
        return;
    }

    var SelectedRowIndex=$('#tblPOTandCSetups').datagrid('getRowIndex',oPOTandCSetup);
    var oPOTandCSetups= $('#tblPOTandCSetups').datagrid('getRows');
    sessionStorage.setItem("POTandCSetups", JSON.stringify(oPOTandCSetups));
    sessionStorage.setItem("SelectedRowIndex", SelectedRowIndex);
    sessionStorage.setItem("POTandCSetupHeader", "View POTandCSetup");
    sessionStorage.setItem("BackLink", window.location.href);
    window.location.href = _sBaseAddress+  "/POTandCSetup/ViewPOTandCSetup?id="+oPOTandCSetup.POTandCSetupID;
//debugger;

}

function Delete()
{
    debugger;
    var oPOTandCSetup= $('#tblPOTandCSetups').datagrid('getSelected');
    if(oPOTandCSetup==null || oPOTandCSetup.POTandCSetupID<=0)
    {
        alert("Invalid Field!!! please select a valid Field!");
        return false;
    }
    if (!confirm("Confirm to Delete?")) return ;
    var SelectedRowIndex=$('#tblPOTandCSetups').datagrid('getRowIndex',oPOTandCSetup);
    if (oPOTandCSetup.POTandCSetupID > 0)
    {
        $.icsDelete({
            BaseAddress: _sBaseAddress,
            Object: oPOTandCSetup,
            ControllerName: "POTandCSetup",
            ActionName: "Delete",
            TableId: "tblPOTandCSetups",
            IsWinClose: false
        });
    }
}


function ActiveInActive()
{
        //debugger;
        var oPOTandCSetup= $('#tblPOTandCSetups').datagrid('getSelected');
        if(oPOTandCSetup==null || oPOTandCSetup.POTandCSetupID<=0)
        {
            alert("Please select a item from list!");
            return;
        }
        if(oPOTandCSetup.Activity==true)
        {
            if (!confirm("Confirm to In-Active?")) return ;
            oPOTandCSetup.Activity=false;
        }
        else
        {
            if (!confirm("Confirm to Active?")) return ;
            oPOTandCSetup.Activity=true;
        }
        var SelectedRowIndex=$('#tblPOTandCSetups').datagrid('getRowIndex',oPOTandCSetup);
        if (oPOTandCSetup.POTandCSetupID > 0)
        {
             $.ajax({
                type: "POST",
                dataType: "json",
                url : _sBaseAddress+  "/POTandCSetup/Save",
                traditional: true,
                data:  JSON.stringify(oPOTandCSetup),
                contentType: "application/json; charset=utf-8",
                success: function (data) {
                    //debugger;
                    oPOTandCSetup = jQuery.parseJSON(data);
                    if (oPOTandCSetup.POTandCSetupID>0) {
                        alert("Update sucessfully");
                        $('#tblPOTandCSetups').datagrid('updateRow',{index: SelectedRowIndex,	row: oPOTandCSetup});
                    }
                    else {
                        alert(oPOTandCSetup.ErrorMessage);
                    }
                },
                error: function (xhr, status, error) {
                    alert(error);
                }

            });
        }
}


function RefreshList(oPOTandCSetups)
{
    data=oPOTandCSetups;
    data={"total":""+data.length+"","rows":data};
    $('#tblPOTandCSetups').datagrid('loadData',data);
}
</script>