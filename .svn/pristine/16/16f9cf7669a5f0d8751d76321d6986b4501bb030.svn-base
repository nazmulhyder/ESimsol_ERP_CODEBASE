<html>
<head>
    <title>Sample Order </title>
</head>
<body>

    @model ESimSol.BusinessObjects.SampleInvoice
    <div class="menuMainCollectionTable">

        <fieldset>
            <legend style="font-weight:bold"> Sample Adjustment entry: </legend>
            <table style="width:100%" cellpadding="2"cellspacing="2">
              
                <tr>
                    <td style="width: 10%; text-align: right">
                        <label>P/I No</label>
                    </td>
                    <td style="width: 30%; text-align: left">
                        <input id="txtExportPINo" style="width: 60%" class="reset-text" placeholder="" />
                        <a id="btnPickExportPI" href="javascript:void(0)" class="easyui-linkbutton ics-pick" iconcls="icon-pick" plain="true"></a>
                        <a id="btnResetExportPI" href="javascript:void(0)" class="easyui-linkbutton ics-pick" iconcls="icon-clear" plain="true"></a>
                    </td>
                    <td style="width: 10%; text-align: right">
                        <label>Date</label>
                    </td>
                    <td style="width: 15%; text-align: left">
                        <input id="txtSampleInvoiceDate" type="date" class="easyui-datebox" style="width: 105px;" data-options="formatter:icsdateformat,parser:icsdateparser" />
                    </td>
                    <td style="width:10%; text-align: right">
                        <label>Invoice No</label>
                    </td>
                    <td style="width: 25%; text-align: right">
                        <input id="txtSampleInvoiceNo" class="reset-text" style="width: 100%" placeholder="Auto Generate" readonly="readonly" />
                    </td>

                </tr>
                <tr>
                    <td style="width: 10%; text-align: right">
                        <label>PI Issue</label>
                    </td>
                    <td style="width: 30%; text-align: left">
                        <input id="txtPIIssue" style="width: 100%" class="reset-text" />
                    </td>
                    <td style="width: 10%; text-align: right">
                        <label>L/C No</label>
                    </td>
                    <td style="width: 15%; text-align: left">
                        <input id="txtLCNo" style="width: 100%" class="reset-text" placeholder="" />
                    </td>
                    <td style="width:10%; text-align: right">
                        <label>Con Person</label>
                    </td>
                    <td style="width: 25%; text-align: left">
                        <input id="txtMktAccount" class="reset-text" placeholder="Search Concern Person" style="width:62%" />
                        <a id="btnPickMktAccount" href="javascript:void(0)" class="easyui-linkbutton ics-pick" iconcls="icon-pick" plain="true"></a>
                        <a id="btnResetMktPerson" href="javascript:void(0)" class="easyui-linkbutton ics-pick" iconcls="icon-clear" plain="true"></a>
                    </td>

                </tr>
                <tr>
                    <td style="width: 10%; text-align: right">
                        <label>Buying House</label>
                    </td>
                    <td style="width: 30%; text-align: left">
                        <input id="txtBuyingHouse" style="width: 100%" class="reset-text" placeholder="" />
                    </td>
                    <td style="width: 10%; text-align: right">
                        <label>L/C Status</label>
                    </td>
                    <td style="width: 15%; text-align: left">
                        <input id="txtLCStatus" style="width: 100%" class="reset-text" placeholder="" />
                    </td>
                    <td style="width:10%; text-align: right">
                        <label> Value</label>
                    </td>
                    <td style="width: 25%; text-align: right">
                        <input id="txtPIValue" class="reset-text" style="width: 100%" placeholder="Auto Generate" readonly="readonly" />
                    </td>

                </tr>

              

            </table>

        </fieldset>
        <fieldset>
            <legend style="font-weight:bold"> Sample Adjustment entry: </legend>
            <table border="0" cellspacing="1" cellpadding="1" style="width:100%; font-size:11px; font-weight:bold">
                <tr>
                    <td style="width: 10%; text-align: right">
                        <label>Account Of</label>
                    </td>
                    <td style="width: 50%; text-align: left">
                        <input id="txtIssueTo" style="width: 80%;" class=" reset-text" placeholder="Search Issue To" />
                        <a id="btnPickIssueTo" href="javascript:void(0)" class="easyui-linkbutton ics-pick" iconcls="icon-pick" plain="true"></a>
                        <a id="btnResetIssueTo" href="javascript:void(0)" class="easyui-linkbutton ics-pick" iconcls="icon-clear" plain="true"></a>
                    </td>
                    <td style="width: 15%; text-align: right">
                        <label>Concern Person</label>
                    </td>
                    <td style="width: 25%; text-align: left">
                        <select id="cboCPIssueTo" style="width:60%"></select>
                        <a id="btnLoadIssueToCP" href=" javascript:void(0)" class="easyui-linkbutton" iconcls="icon-reload" plain="false"></a>
                        <a id="btnNewIssueToCP" href=" javascript:void(0)" class="easyui-linkbutton" iconcls="icon-add" plain="false"></a>
                    </td>
                </tr>


            </table>
        </fieldset>
            <fieldset>
                <table border="0" cellspacing="1" cellpadding="1" style="width:100%; font-size:11px; font-weight:bold">

                    <tr>
                        <td style="width:10%; text-align:left">
                            Invoice Type
                        </td>
                        <td style="width:15%">
                            <select id="cboInvoiceType" onchange="cboInvoiceTypeChange()" style="width:100%; "></select>
                        </td>
                        <td style="width:10%; text-align:right">
                            Currency
                        </td>
                        <td style="width:20%;">
                            <select id="cboCurrency" style="width:40%; " onchange="ChangeCurrency()"></select>
                            <input id="txtConversionRate" class="reset-text" style="width: 55%; text-align:right" />
                        </td>
                        <td style="width:45%; text-align:right">
                            Amount <span class="lblCurrency"></span>
                            <input id="txtAmountWithCRate" style="width: 25%" class="reset-text number type-diabaled" disabled />
                            Amount (USD)
                            <input id="txtAmount" style="width: 25%" class="reset-text number type-diabaled" disabled />
                            
                        </td>
                      
                    </tr>
                    <tr>

                        <td style="width:10%; text-align:left">
                            Remarks
                        </td>
                        <td colspan="4" style="width:90%">
                            <input id="txtRemark" class="reset-text" style="width: 100%" placeholder="Type Note" />
                        </td>
                    </tr>

                </table>
            </fieldset>

        <fieldset>
            <legend>Sample Order Detail</legend>
            
            <table id="tblSampleInvoiceDetail" class="easyui-datagrid" style="width:100%;height:200px;"
                   data-options="singleSelect: true,fitColumns:false, rownumbers:true, pagination:false, autoRowHeight:false, toolbar: '#toolbarDetail',onClickRow:onClickRow ">
                <thead>
                    <tr>

                        <th field="ProductCode" width="10%" align="left"> Code</th>
                        <th field="ProductName" width="40%" align="left">Product Name</th>
                        <th data-options="field:'Qty',align:'right',editor:{type:'numberbox',options:{precision:2}}" width="12%">Edit Qty(LBS)</th>
                        <th data-options="field:'UnitPrice',align:'right',editor:{type:'numberbox',options:{precision:4}}" width="10%"> Edit UnitPrice($)</th>
                        <th field="AmountSt" width="10%" align="left">Amount</th>
                        <th data-options="field:'Description',width:150,height:60 ,align:'Left',editor:{type:'text'}" align="Left">Remark</th>
                    </tr>
                </thead>
            </table>
            <div id="toolbarDetail">
                <a id="btnPickSCDetail" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-pick" plain="true">Pick Yet to PO</a>
                <label id="lblProduct">Product</label>
                <input type="text" id="txtProduct" placeholder="Enter Product" style="width:130px;" /><a id="btnPickProduct" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-pick" plain="true">Pick</a>
                <a id="btnDeleteDetail" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-remove" plain="true">Remove</a>
                <a id="btnRefresh" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-remove" plain="true">Refresh</a>
            </div>
            <table border="0" cellpadding="0" cellspacing="0" style="width:100%;">
                <tr>
                    <td style="width:65%;  text-align:right;font-weight:bold;">Total:</td>
                    <td style="width:10%;  text-align:right;font-weight:bold;"><label id="lblTotalQty">0</label> </td>
                    <td style="width:5%;  text-align:right;font-weight:bold;"> </td>
                    <td style="width:10%; text-align:right; font-weight:bold;"><label id="lblTotalAmount"> </label> </td>
                    <td style="width:5%;  text-align:right;font-weight:bold;"> </td>
                </tr>
            </table>
        </fieldset>
        <fieldset>
            <legend>Action</legend>
            <table border="0" cellpadding="0" cellspacing="0" style="float:right; width:100%;">
                <tr>
                    
                    <td style="float:left;  width:10%; ">
                        <a id="btnPrint" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-print" plain="true">Preview</a>
                    </td>
                    <td style="float:right;  width:50%; "></td>
                    <td style="float:left;  width:10%; ">
                    </td>
                    <td style="text-align:right; width:30%;">
                        <a  id="btnSave" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-save" plain="true">Save</a>
                        <a id="btnCancel" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-cancel" plain="true">Cancel</a>
                        <a id="btnApprove" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-approved" plain="true">Approve</a>
                        <a id="btnClose" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-cancel" plain="true">Close</a>
                    </td>
                </tr>
            </table>        
        </fieldset>
    </div>
    
</body>
</html>

<style type="text/css">
  
   
    
    .td-col-6 input {
        width: 70%;
    }

    .td-col-14 input {
        width: 86%;
    }

    .send-to .td-col-14 input {
        width: 85.7%;
    }


    .hp-ph .td-col-8 input {
        width: 66%;
    }

    .hp-ph .td-col-8 select {
        width: 96%;
    }

    .td-Note input {
        width: 97.5%;
    }

    .td-col-14 select {
        width: 15%;
    }

    .td-product input {
        width: 60%;
    }

   

    
</style>

<script type="text/javascript">

    var _sBaseAddress = "";
    var _oSampleInvoice=null;
   
    var _nContractorID=0;
    var _nDeliveryToID=0;
    var _bIsIssueTo=true;
    var _oCPIssueTos=[];
    var _oCPDeliveryTos=[];
    var _oInvoiceTypes=[];
    var _oCurrencys=[];
    var _oIsAdd=false;
    var _nSampleInvoiceDetailID=0;
    var _nSelectedRowIndex=0;
    var _sBackLink="";
    var _nBUID=0;
    var _IsWillVoucherEffect = 0;
    $(document).ready(function () {

        _sBaseAddress =@Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(HttpContext.Current.Session[SessionInfo.BaseAddress]));
        _oSampleInvoice =@Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(Model));
        _oCPIssueTos =@Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(@ViewBag.CPIssueTos));
        _oCPDeliveryTos =@Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(@ViewBag.CPDeliveryTos));
     
        _oInvoiceTypes =@Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(@ViewBag.InvoiceTypes));
        var oExportSCDO =@Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(@ViewBag.ExportSCDO));
        _oCurrencys = @Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(ViewBag.Currencys));
        _nBUID = @Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(ViewBag.BUID));
        _IsWillVoucherEffect = _oSampleInvoice.IsWillVoucherEffect;
        debugger;
       
       
        CboLoad();
        Initialization(_oSampleInvoice,((sessionStorage.length>0)?sessionStorage.getItem('Operation'):'New'));
        _sBackLink=sessionStorage.getItem("BackLink");
        ChangeCurrency();
        $('.number').icsCurrencyBox();
        $('.number').val("0.00");
        RefreshSummary();
        RefreshPIInfo(oExportSCDO);
        Control_disabled();
    });

    function CboLoad()
    {
       
        $("#cboCurrency").icsLoadCombo({
            List: _oCurrencys,
            OptionValue: "CurrencyID",
            DisplayText: "CurrencyName"
        });

        $("#cboInvoiceType").icsLoadCombo({
            List: _oInvoiceTypes,
            OptionValue: "id",
            DisplayText: "Value",
            //InitialValue:""
        });
    }
    function ChangeCurrency()
    {
        var nCurrencyID = parseInt($('#cboCurrency').val());
        for(var i=0; i<_oCurrencys.length; i++)
        {
            if(parseInt(_oCurrencys[i].CurrencyID) === nCurrencyID)
            {
                $(".lblCurrency").html("("+_oCurrencys[i].Symbol+")");
                break;
            }
        }
        if(nCurrencyID=== 2)
        {
            $('#txtConversionRate').val(parseFloat(1).toFixed(3));
            $("#txtConversionRate").prop("disabled", true);
        }
        else
        {
            $('#txtConversionRate').val(parseFloat(_oSampleInvoice.ConversionRate).toFixed(3));
            $("#txtConversionRate").prop("disabled", false);
        }
    }

 

    function Initialization(oSampleInvoice, sOperation){
        ResetControll();
      
        RefreshControl(oSampleInvoice);
    
        if(sOperation=="View")
        {
            $('#toolbar,#btnSave,#btnCancel,#btnPickProduct,#btnRefresh,#btnDeleteDetail,#btnApprove,.ics-pick').hide();
            $('input,select').not('#txtSampleInvoiceNo').prop('disabled',true);
        }
      
        else  if(sOperation=="Cancel")
        {
            $('#btnSave,#btnApprove,#btnPickProduct,#btnRefresh,#btnDeleteDetail').hide();
            $('#btnCancel').show();
            $('input,select').not('#txtSampleInvoiceNo').prop('disabled',false);
        }
        else  if(sOperation=="Approve")
        {
            $('#toolbar,#btnSave,#btnCancel,#btnPickProduct,#btnRefresh,#btnDeleteDetail,.ics-pick').hide();
            $('#btnApprove').show();
            $('input,select').not('#txtSampleInvoiceNo').prop('disabled',true);
        }
        else{
            $('#btnCancel,#btnApprove').hide();
            $('#toolbar,#btnSave,.ics-pick').show();
            $('input,select').not('#txtSampleInvoiceNo').prop('disabled',false);
            
        }
    }
   

    function LoadIssueContactPersonnel(oCPs){
        $("#cboCPIssueTo").icsLoadCombo({
            List: oCPs,
            OptionValue: "ContactPersonnelID",
            DisplayText: "Name",
           
        });
    }


    function ResetControll(){
        _oSampleInvoice=null;
        _nDeliveryToID=0;
    
        $('.reset-text').val("");
        $('#txtSampleInvoiceDate').datebox('setValue', icsdateformat(new Date()));
        LoadIssueContactPersonnel(_oCPIssueTos);
        //LoadDeliveredContactPersonnel(_oCPDeliveryTos);
        $('.number').val("0.00");
        DynamicRefreshList([], 'tblSampleInvoiceDetail');
        RefreshSummary();
       
    }
    function Control_disabled()
    {
        document.getElementById("txtPIIssue").disabled = true;
        document.getElementById("txtBuyingHouse").disabled = true;
        document.getElementById("txtLCNo").disabled = true;
        document.getElementById("txtPIValue").disabled = true;
        document.getElementById("txtLCStatus").disabled = true;
    }
    function RefreshPIInfo(oExportSCDO){
        debugger;
        $('#txtPIIssue').val(oExportSCDO.ContractorName);
        $('#txtBuyingHouse').val(oExportSCDO.BuyerName);
        
        $('#txtLCNo').val(oExportSCDO.ELCNo);
        $('#txtPIValue').val(oExportSCDO.Amount_PISt);
        $('#txtLCStatus').val(oExportSCDO.ExportLCStatusSt);
        $('#txtMktAccount').val(oExportSCDO.MKTPName);
        $('#txtExportPINo').val(oExportSCDO.PINo);
    }

    function cboInvoiceTypeChange()
    {
        if(parseInt($("#cboInvoiceType").val())==5 || parseInt($("#cboInvoiceType").val())==6)// Commission Invoice
        {
            _oSampleInvoice.ExportPIID=0;
            $('#txtPIValue').val(0);
            $('#txtLCStatus').val("");
            $('#txtExportPINo').val("");
        }
    }
    function RefreshControl(oSampleInvoice){
        debugger;
        _oSampleInvoice=oSampleInvoice;
   
        if(_oSampleInvoice.CurrencyID<=0)
        {
            _oSampleInvoice.CurrencyID=2; // Sample Order Rate is USD , It change after change SampleOrder
        }
        $('#txtSampleInvoiceDate').datebox('setValue',_oSampleInvoice.SampleInvoiceDateST);
        //$('#txtPaymentDate').datebox('setValue',_oSampleInvoice.PaymentDateST);
        //$('#txtRequirementDate').datebox('setValue',_oSampleInvoice.RequirementDateST);
        $("#txtSampleInvoiceNo")[0].value=_oSampleInvoice.SampleInvoiceNo;
        $("#cboCurrency").val(_oSampleInvoice.ExchangeCurrencyID);
        $("#txtIssueTo").val(_oSampleInvoice.ContractorName);
        $('#txtMktAccount').val(oSampleInvoice.MKTPName);
        $('#txtIssueTo').val(oSampleInvoice.ContractorName);
        $('#cboCPIssueTo').val(oSampleInvoice.ContractorPersopnnalID);
        $('#cboInvoiceType').val(oSampleInvoice.InvoiceType);
        $('#txtRemark').val(oSampleInvoice.Remark);

        if(oSampleInvoice.SampleInvoiceDetails!==null && oSampleInvoice.SampleInvoiceDetails.length>0)
        {
            DynamicRefreshList(oSampleInvoice.SampleInvoiceDetails, 'tblSampleInvoiceDetail');
        }
        else{
            DynamicRefreshList([], 'tblSampleInvoiceDetail');
        }
      
        RefreshSummary();
    }

  
    function Validation(){

        if(_oSampleInvoice.MKTEmpID<=0){
            $('#txtMktAccount').focus();
            $('#txtMktAccount').addClass("errorFieldBorder");
            alert('Mkt person required.');
            return false;
        }
        else{
            $('#txtMktAccount').removeClass("errorFieldBorder");
        }

        if(_oSampleInvoice.ContractorID<=0){
            $('#txtIssueTo').focus();
            $('#txtIssueTo').addClass("errorFieldBorder");
            alert('SampleInvoice issue to required.');
            return false;
        }
        else{
            $('#txtIssueTo').removeClass("errorFieldBorder");
        }

        if(parseInt($("#cboInvoiceType").val())==5 || parseInt($("#cboInvoiceType").val())==6)
        {
            _oSampleInvoice.ExportPIID=0;
            if(parseInt($("#cboCPIssueTo").val())<=0)
            {
                $('#cboCPIssueTo').focus();
                $('#cboCPIssueTo').addClass("errorFieldBorder");
            alert('Buyer Concern person required.');
            return false;
            }
        }
     
        return true;
    }

    function RefreshObject()
    {
        if(parseInt($("#cboInvoiceType").val())==5)
        {
            _oSampleInvoice.ExportPIID=0;
        }

        var oSampleInvoice={
          
            SampleInvoiceID : (_oSampleInvoice!=null && _oSampleInvoice.SampleInvoiceID>0)? _oSampleInvoice.SampleInvoiceID:0,
            SampleInvoiceNo:_oSampleInvoice.SampleInvoiceNo,
            CurrencyID: _oSampleInvoice.CurrencyID,
            ExchangeCurrencyID: $("#cboCurrency").val(),
            SampleInvoiceDate  : $('#txtSampleInvoiceDate ').datebox('getValue'),
            ContractorID  : _oSampleInvoice.ContractorID,
            MKTEmpID:_oSampleInvoice.MKTEmpID,
            ExportPIID:   _oSampleInvoice.ExportPIID,
            PaymentType : 0,
            MRNo : "" ,
            ConversionRate  : $('#txtConversionRate ').val() ,
            Remark  : $('#txtRemark').val() ,
            Amount: parseFloat(icsRemoveComma($('#txtAmount').val())),
            CurrentStatusInt:1,
            ContractorPersopnnalID  : $('#cboCPIssueTo').val(),
            OrderType:0,
            IsWillVoucherEffect : _IsWillVoucherEffect,
            InvoiceType : $('#cboInvoiceType').val(),
            BUID:sessionStorage.getItem('BUID'),
            SampleInvoiceDetails:$('#tblSampleInvoiceDetail').datagrid('getRows')

        };
        return oSampleInvoice;
    }

   
   
    $("#btnSave").click(function (){
        debugger;
        endEditing();
        if(!Validation()) return false;

        var oSampleInvoice=RefreshObject();

      
            $.ajax({
                type: "POST",
                dataType: "json",
                url : _sBaseAddress+  "/SampleInvoice/Save",
                traditional: true,
                data:  JSON.stringify(oSampleInvoice),
                contentType: "application/json; charset=utf-8",
                success: function (data) {

                    var  oSampleInvoice = jQuery.parseJSON(data);
                    if (oSampleInvoice.ErrorMessage=="" || oSampleInvoice.ErrorMessage==null) {
                        alert("Data Save successfully");
                        _oSampleInvoice=oSampleInvoice;

                        var oSampleInvoices =sessionStorage.getItem("SampleInvoices");
                        var nIndex= parseInt(sessionStorage.getItem("SelectedRowIndex"));

                        if(oSampleInvoices!=null)
                        {
                            oSampleInvoices = jQuery.parseJSON(oSampleInvoices);
                        }
                        else
                        {
                            oSampleInvoices=[];
                        }
                        if(nIndex!=-1)
                        {
                            oSampleInvoices[nIndex]=_oSampleInvoice;
                        }
                        else
                        {
                            sessionStorage.setItem("SelectedRowIndex", oSampleInvoices.length);
                            oSampleInvoices.push(_oSampleInvoice);
                        }
                        sessionStorage.setItem("SampleInvoices", JSON.stringify(oSampleInvoices));
                        window.location.href = _sBackLink;
                    }
                    else
                    {
                        alert(oSampleInvoice.ErrorMessage);
                    }
                },
                error: function (xhr, status, error) {
                    alert(error);
                }


            });
        


    });
    $("#btnApprove").click(function (){
        debugger;
        endEditing();
        if(!Validation()) return false;

        if(parseInt($("#cboInvoiceType").val())==5)
        {
            _oSampleInvoice.ExportPIID=0;
            alert('This adjustment for Commission Settle. Its approve from Acount');
           return ;
        }
        var oSampleInvoice=RefreshObject();

      
        $.ajax({
            type: "POST",
            dataType: "json",
            url : _sBaseAddress+  "/SampleInvoice/Approve",
            traditional: true,
            data:  JSON.stringify(oSampleInvoice),
            contentType: "application/json; charset=utf-8",
            success: function (data) {

                var  oSampleInvoice = jQuery.parseJSON(data);
                if (oSampleInvoice.ErrorMessage=="" || oSampleInvoice.ErrorMessage==null) {
                    alert("Data Save successfully");
                    _oSampleInvoice=oSampleInvoice;

                    var oSampleInvoices =sessionStorage.getItem("SampleInvoices");
                    var nIndex= parseInt(sessionStorage.getItem("SelectedRowIndex"));

                    if(oSampleInvoices!=null)
                    {
                        oSampleInvoices = jQuery.parseJSON(oSampleInvoices);
                    }
                    else
                    {
                        oSampleInvoices=[];
                    }
                    if(nIndex!=-1)
                    {
                        oSampleInvoices[nIndex]=_oSampleInvoice;
                    }
                    else
                    {
                        sessionStorage.setItem("SelectedRowIndex", oSampleInvoices.length);
                        oSampleInvoices.push(_oSampleInvoice);
                    }
                    sessionStorage.setItem("SampleInvoices", JSON.stringify(oSampleInvoices));
                    window.location.href = _sBackLink;
                }
                else
                {
                    alert(oSampleInvoice.ErrorMessage);
                }
            },
            error: function (xhr, status, error) {
                alert(error);
            }


        });
        


    });

    $("#btnResetMktPerson").click(function () {

        $("#txtMktAccount").val("");
        _oSampleInvoice.MKTEmpID=0;
    });

    $("#btnPickMktAccount").click(function () {
        debugger;
        var sName=$.trim($("#txtMktAccount").val());
        GetMktPersons(sName);
    });

    $("#txtMktAccount").keydown(function (e) {
        var nkeyCode = e.keyCode || e.which;
        if(nkeyCode==13){
            var sName=$.trim($("#txtMktAccount").val());
            GetMktPersons(sName);
        }
        else if(nkeyCode==8){
            $("#txtMktAccount").val("");
            _oSampleInvoice.MKTEmpID=0;
        }
    });

    function GetMktPersons(sName){

        var oMarketingAccount_BU = {
            Name:sName,
            BUID:sessionStorage.getItem("BUID")
        };
        var obj = {
            BaseAddress: _sBaseAddress,
            Object: oMarketingAccount_BU,
            ControllerName: "MarketingAccount",
            ActionName: "MarketingAccountSearchByName",
            IsWinClose: false
        };

        $.icsDataGets(obj, function (response) {

            if (response.status && response.objs.length > 0) {
                if (response.objs[0].MarketingAccountID > 0) {
                    debugger;
                    var tblColums = [];
                    var oColumn = { field: "MarketingAccountID", title: "Code", width: 50, align: "left" };tblColums.push(oColumn);
                    oColumn = { field: "Name", title: "Name", width: 250, align: "left" };tblColums.push(oColumn);
                    oColumn = { field: "Phone", title: "Phone", width: 100, align: "left" };tblColums.push(oColumn);

                    var oPickerParam = {
                        winid: 'winMktAccount',
                        winclass:'clsMktPersonPicker',
                        winwidth: 460,
                        winheight: 460,
                        tableid: 'tblMktPersonPicker',
                        tablecolumns: tblColums,
                        datalist: response.objs,
                        multiplereturn: false,
                        searchingbyfieldName:'Name',
                        windowTittle: 'MKT Person List'
                    };
                    $.icsPicker(oPickerParam);
                    IntializePickerbutton(oPickerParam);//multiplereturn, winclassName
                }
                else { alert(response.objs[0].ErrorMessage); }
            }
            else{
                alert("No marketing person found.");
            }
        });


    }



    $("#btnResetIssueTo").click(function () {
        $("#txtIssueTo").val("");
        _oSampleInvoice.ContractorID=0;
    });
    $("#btnPickIssueTo").click(function () {

        var sContractorName=$.trim($("#txtIssueTo").val());
        _bIsIssueTo=true;
        GetContractors(sContractorName, _bIsIssueTo);
    });
    $("#txtIssueTo").keydown(function (e) {
        var nkeyCode = e.keyCode || e.which;
        if(nkeyCode==13){
            var sContractorName=$.trim($("#txtIssueTo").val());
            _bIsIssueTo=true;
            GetContractors(sContractorName,_bIsIssueTo);
        }
        else if(nkeyCode==8){
            $("#txtIssueTo").val("");
            _oSampleInvoice.ContractorID=0;
            $("#cboCPIssueTo").empty();
        }
    });
    function GetContractors(sContractorName, bIsIssueTo){

        var oContractor = {
            Params: '2,3' +'~'+sContractorName+'~'+sessionStorage.getItem('BUID')
        };
        var obj = {
            BaseAddress: _sBaseAddress,
            Object: oContractor,
            ControllerName: "Contractor",
            ActionName: "ContractorSearchByNameType",
            IsWinClose: false
        };

        $.icsDataGets(obj, function (response) {

            if (response.status && response.objs.length > 0) {
                if (response.objs[0].ContractorID > 0) {
                    debugger;
                    var tblColums = [];
                    var oColumn = { field: "ContractorID", title: "Code", width: 50, align: "center" };tblColums.push(oColumn);
                    oColumn = { field: "Name", title: "Name", width: 190, align: "left" };tblColums.push(oColumn);
                    oColumn = { field: "Phone", title: "Phone", width: 140, align: "left" };tblColums.push(oColumn);

                    var oPickerParam = {
                        winid: 'winContractorPicker',
                        winclass:'clsContractorPicker',
                        winwidth: 460,
                        winheight: 460,
                        tableid: 'tblContractorPicker',
                        tablecolumns: tblColums,
                        datalist: response.objs,
                        multiplereturn: false,
                        searchingbyfieldName:'Name',
                        windowTittle: 'Contractor List'
                    };
                    $.icsPicker(oPickerParam);
                    IntializePickerbutton(oPickerParam);//multiplereturn, winclassName
                }
                else { alert(response.objs[0].ErrorMessage); }
            }
            else{
                alert("No contractor found.");
            }
        });


    }
    function GetContactPersonel(nContractorID,bIsIssueTo){

        var oContractor = {
            ContractorID: nContractorID
        };
        var obj = {
            BaseAddress: _sBaseAddress,
            Object: oContractor,
            ControllerName: "Contractor",
            ActionName: "GetContactPersonnels",
            IsWinClose: false
        };

        $.icsDataGets(obj, function (response) {

            if (response.status && response.objs.length > 0) {
                if (response.objs[0].ContactPersonnelID > 0) {
                    LoadIssueContactPersonnel(response.objs);
                }
                else
                {
                    LoadIssueContactPersonnel([]);
                }
            }
        });
    }


    $("#btnResetProduct").click(function () {

        $("#txtProduct").val("");
    });
    $("#btnPickProduct").click(function () {

       
        if(parseInt($("#cboInvoiceType").val())<=0)
        {
            alert("Invalid Selection!!! please select a valid invoice Type!");
            $('#cboInvoiceType').focus();
            return ;
        }
        if(parseInt($("#cboInvoiceType").val())==1 || parseInt($("#cboInvoiceType").val())==2 || parseInt($("#cboInvoiceType").val())==3 || parseInt($("#cboInvoiceType").val())==4  || parseInt($("#cboInvoiceType").val())==10)
        {
            if(parseInt(_oSampleInvoice.ExportPIID)<=0)
            {
                alert("Invalid Selection!!! please select a valid PI!");
                return ;
            }
        }

        var sProductName=$.trim($("#txtProduct").val());
        if(sProductName==""){ alert("Type product name to search."); return false; }
        GetProducts(sProductName);
    });
    $("#txtProduct").keydown(function (e) {
        var nkeyCode = e.keyCode || e.which;
        if(nkeyCode==13){
          
            if(parseInt($("#cboInvoiceType").val())<=0)
            {
                alert("Invalid Selection!!! please select a valid invoice Type!");
                $('#cboInvoiceType').focus();
                return ;
            }
            if(parseInt($("#cboInvoiceType").val())==1 || parseInt($("#cboInvoiceType").val())==2 || parseInt($("#cboInvoiceType").val())==3 || parseInt($("#cboInvoiceType").val())==4  || parseInt($("#cboInvoiceType").val())==10)
            {
                if(parseInt(_oSampleInvoice.ExportPIID)<=0)
                {
                    alert("Invalid Selection!!! please select a valid PI!");
                    return ;
                }
            }

            var sProductName=$.trim($("#txtProduct").val());
            if(sProductName==""){ alert("Type product name to search."); return false; }
            GetProducts(sProductName);
        }
        else if(nkeyCode==8){
            $("#txtProduct").val("");
        }
    });
    function GetProducts(sProductName){

        var oProduct = {
            ProductName:sProductName,
            ProductCode:sProductName
        };
        var obj = {
            BaseAddress: _sBaseAddress,
            Object: oProduct,
            ControllerName: "Product",
            ActionName: "SearchByProductNameCode",
            IsWinClose: false
        };

        $.icsDataGets(obj, function (response) {

            if (response.status && response.objs.length > 0) {
                if (response.objs[0].ProductID > 0) {
                    debugger;
                    var tblColums = [];
                    var oColumn = { field: "ProductCode", title: "Code", width: 80, align: "left" };tblColums.push(oColumn);
                    oColumn = { field: "ProductName", title: "Name", width: 300, align: "left" };tblColums.push(oColumn);
                    oColumn = { field: "MUnit", title: "Unit", width: 70, align: "left" };tblColums.push(oColumn);

                    var oPickerParam = {
                        winid: 'winProductPicker',
                        winclass:'clsProductPicker',
                        winwidth: 560,
                        winheight: 460,
                        tableid: 'tblProductPicker',
                        tablecolumns: tblColums,
                        datalist: response.objs,
                        multiplereturn: true,
                        searchingbyfieldName:'ProductName',
                        windowTittle: 'Product List'
                    };
                    $.icsPicker(oPickerParam);
                    IntializePickerbutton(oPickerParam);//multiplereturn, winclassName
                }
                else { alert(response.objs[0].ErrorMessage); }
            }
            else{
                alert("No product found.");
            }
        });


    }

    $("#btnPickSCDetail").click(function () {

       
        if(parseInt($("#cboInvoiceType").val())<=0)
        {
            alert("Invalid Selection!!! please select a valid invoice Type!");
            $('#cboInvoiceType').focus();
            return ;
        }
        if(parseInt($("#cboInvoiceType").val())==1 || parseInt($("#cboInvoiceType").val())==2 || parseInt($("#cboInvoiceType").val())==3 || parseInt($("#cboInvoiceType").val())==4  || parseInt($("#cboInvoiceType").val())==10)
        {
            if(_oSampleInvoice.ExportPIID<=0)
            {
                alert("Invalid Selection!!! please select a valid PI!");
                return ;
            }
        }
        if(parseInt($("#cboInvoiceType").val())==5)
        {
            alert("This option for Qty/Rate Adjustment!");
            return ;
        }
        _oSampleInvoice.BUID=sessionStorage.getItem("BUID");
        GetsOrderDetailForAdjs(_oSampleInvoice);
    });
    function GetsOrderDetailForAdjs(oSampleInvoice){

     
        var obj = {
            BaseAddress: _sBaseAddress,
            Object: oSampleInvoice,
            ControllerName: "SampleInvoice",
            ActionName: "GetsOrderDetailForAdjs",
            IsWinClose: false
        };

        $.icsDataGets(obj, function (response) {

            if (response.status && response.objs.length > 0) {
                if (response.objs[0].ProductID > 0) {
                    debugger;
                    var tblColums = [];
                    var oColumn = { field: "ProductCode", title: "Code", width: 80, align: "left" };tblColums.push(oColumn);
                    oColumn = { field: "ProductName", title: "Name", width: 300, align: "left" };tblColums.push(oColumn);
                    oColumn = { field: "MUnit", title: "Unit", width: 70, align: "left" };tblColums.push(oColumn);
                    oColumn = { field: "Qty", title: "Qty", width: 70, align: "left" };tblColums.push(oColumn);
                    oColumn = { field: "UnitPrice", title: "UnitPrice", width: 70, align: "left" };tblColums.push(oColumn);
                    oColumn = { field: "Amount", title: "Amount", width: 70, align: "left" };tblColums.push(oColumn);

                    var oPickerParam = {
                        winid: 'winExportSCDetailPicker',
                        winclass:'clsSampleInvoicePicker',
                        winwidth: 560,
                        winheight: 460,
                        tableid: 'tblSampleInvoicePicker',
                        tablecolumns: tblColums,
                        datalist: response.objs,
                        multiplereturn: true,
                        searchingbyfieldName:'ProductName',
                        windowTittle: 'Product List'
                    };
                    $.icsPicker(oPickerParam);
                    IntializePickerbutton(oPickerParam);//multiplereturn, winclassName
                }
                else { alert(response.objs[0].ErrorMessage); }
            }
            else{
                alert("No product found.");
            }
        });


    }

    $("#btnPickExportPI").click(function () {

    

        var sNo=$.trim($("#txtExportPINo").val());
        var oExportSCDO = {
            PINo:sNo,
            LCNo:'',
            ContractorID:_oSampleInvoice.ContractorID,
            BuyerID:_nDeliveryToID,
            BUID:sessionStorage.getItem('BUID'),
            IsRevisePI:true
        };
        GetsExportPIs(oExportSCDO);
    });

    $("#txtExportPINo").keydown(function (e) {
        var nkeyCode = e.keyCode || e.which;
        if(nkeyCode==13){
          

            var sNo=$.trim($("#txtExportPINo").val());
            if(sNo.length<=0)
            {
                alert("Please, Type valid P/I No. ")
                $("#txtExportPINo").focus();
                $('#txtExportPINo').addClass("errorFieldBorder");
                return;
            }
            var oExportSCDO = {
                PINo:sNo,
                LCNo:'',
                ContractorID:_oSampleInvoice.ContractorID,
                BuyerID:_nDeliveryToID,
                BUID:sessionStorage.getItem('BUID'),
                IsRevisePI:true
            };
            GetsExportPIs(oExportSCDO);
        }
        else if(nkeyCode==8){
            $("#txtExportPINo").val("");
            _oSampleInvoice.ExportPIID=0;
           
        }
    });
    $("#btnResetExportPI").click(function () {
        $("#txtExportPINo").val("");
        _oSampleInvoice.ExportPIID=0;
    });
    function GetsExportPIs(oExportSCDO){

       
        var obj = {
            BaseAddress: _sBaseAddress,
            Object: oExportSCDO,
            ControllerName: "SampleInvoice",
            ActionName: "GetExportPIs",
            IsWinClose: false
        };

        $.icsDataGets(obj, function (response) {

            if (response.status && response.objs.length > 0) 
            {
                if (response.objs[0].ExportPIID > 0) {
                    debugger;
                    var tblColums = [];
                    var oColumn = { field: "PINo", title: "P/I No", width: 160, align: "left" };tblColums.push(oColumn);
                    oColumn = { field: "ELCNo", title: "L/C No", width: 200, align: "left" };tblColums.push(oColumn);
                    oColumn = { field: "Amountst", title: "Amount", width: 120, align: "right" };tblColums.push(oColumn);
                    oColumn = { field: "ExportLCStatusSt", title: "P/I. Qty", width: 120, align: "left" };tblColums.push(oColumn);
                    var oPickerParam = {
                        winid: 'winExportPIPicker',
                        winclass:'clsExportPIPicker',
                        winwidth: 660,
                        winheight: 460,
                        tableid: 'tblExportPIPicker',
                        tablecolumns: tblColums,
                        datalist: response.objs,
                        multiplereturn: false,
                        searchingbyfieldName:'PINo',
                        windowTittle: 'P/I List'
                    };
                    $.icsPicker(oPickerParam);
                    IntializePickerbutton(oPickerParam);//multiplereturn, winclassName
                }
                else { alert(response.objs[0].ErrorMessage); }
            }
            else{
                alert("Data not found.");
            }
        });


    }

  

   


    function IntializePickerbutton(oPickerobj) {
        $("#" + oPickerobj.winid).find("#btnOk").click(function () {
            //for Single Select
            SetPickerValueAssign(oPickerobj);
        });
        $(document).find('.' + oPickerobj.winclass).keydown(function (e) {
            if (e.which == 13)//enter=13
            {
                SetPickerValueAssign(oPickerobj);

            }
        });
    }

    function SetPickerValueAssign(oPickerobj) {
        debugger;
        var oreturnObj = null, oreturnobjs = [];
        if (oPickerobj.multiplereturn) {
            oreturnobjs = $('#' + oPickerobj.tableid).datagrid('getChecked');
        } else {
            oreturnObj = $('#' + oPickerobj.tableid).datagrid('getSelected');
        }
        $("#" + oPickerobj.winid).icsWindow("close");
        $("#" + oPickerobj.winid).remove();
        if (oPickerobj.winid == 'winContractorPicker') {
            if (oreturnObj != null && oreturnObj.ContractorID > 0)
            {
                debugger;
                $('#txtIssueTo').val(oreturnObj.Name);
                _oSampleInvoice.ContractorID= oreturnObj.ContractorID;

                GetContactPersonel(oreturnObj.ContractorID, _bIsIssueTo);
              
            }
            else{
                alert("Data not found");
            }
        } 
        else if (oPickerobj.winid == 'winProductPicker')
        {
            debugger;

            if (oreturnobjs!=null && oreturnobjs.length > 0) {
                $("#txtProductName").val(oreturnobjs.length+' item(s) selected');
                $("#txtProductName").addClass('fontColorOfPickItem');
                ProductMapping(oreturnobjs);
            }
        }
        else if (oPickerobj.winid == 'winExportSCDetailPicker')
        {
            debugger;

            if (oreturnobjs!=null && oreturnobjs.length > 0) {
               
                for (i=0; i<oreturnobjs.length;i++)
                {
                    $('#tblSampleInvoiceDetail').datagrid('appendRow',oreturnobjs[i]);
                }
                RefreshSummary();
            }
        }
        else if (oPickerobj.winid=='winMktAccount')
        {
            if(oreturnObj!=null && parseInt(oreturnObj.MarketingAccountID)>0)
            {
                var txtMktAccount = document.getElementById("txtMktAccount");
                txtMktAccount.style.color = "blue";
                txtMktAccount.style.fontWeight = "bold";
                $('#txtMktAccount').val(oreturnObj.Name);
                _oSampleInvoice.MKTEmpID= oreturnObj.MarketingAccountID;
            } 
            else{
                alert("Data Not Found.");
            }
        }
        else if (oPickerobj.winid=='winExportPIPicker')
        {
            if(oreturnObj!=null && parseInt(oreturnObj.ExportPIID)>0)
            {
                debugger;
                var txtExportPINo = document.getElementById("txtExportPINo");
                txtExportPINo.style.color = "blue";
                txtExportPINo.style.fontWeight = "bold";
                $('#txtExportPINo').val(oreturnObj.PINo);
                _oSampleInvoice.ExportPIID=oreturnObj.ExportPIID;
                _oSampleInvoice.MKTEmpID=oreturnObj.MKTEmpID;
                _oSampleInvoice.ContractorID=oreturnObj.ContractorID;
                $('#txtMktAccount').val(oreturnObj.MKTPName);
                $('#txtIssueTo').val(oreturnObj.ContractorName);
                RefreshPIInfo(oreturnObj);
               
            
            }
            else
            {
                alert("Data Not Found.");
            }
        }
    }
  
    function ProductMapping(oProducts)
    {
        debugger;
      
        var oSampleInvoiceDetail=null;
       
        if(parseInt($("#cboInvoiceType").val())<=0)
        {
            alert("Invalid Selection!!! please select a valid invoice Type!");
            $('#cboInvoiceType').focus();
            return ;
        }
        if(parseInt($("#cboInvoiceType").val())==1 || parseInt($("#cboInvoiceType").val())==2 || parseInt($("#cboInvoiceType").val())==3 || parseInt($("#cboInvoiceType").val())==4  || parseInt($("#cboInvoiceType").val())==10)
        {
            if(_oSampleInvoice.ExportPIID<=0)
            {
                alert("Invalid Selection!!! please select a valid Type!");
                return ;
            }
        }
        for (i=0; i<oProducts.length;i++)
        {
            oSampleInvoiceDetail={ SampleInvoiceDetailID: 0,
                SampleInvoiceID:0,
                ProductID:oProducts[i].ProductID,
                ProductCode :oProducts[i].ProductCode,
                ProductName:oProducts[i].ProductName,
                MUnitID :oProducts[i].MeasurementUnitID,
                MUName :oProducts[i].MUnit,
                Qty:0,
                UnitPrice:0,
                Amount:0,
                AmountSt:""
            };

            $('#tblSampleInvoiceDetail').datagrid('appendRow',oSampleInvoiceDetail);
       
        }


    }

    var editIndex = undefined;
    function endEditing() {
        if (editIndex == undefined) { return true }
        if ($('#tblSampleInvoiceDetail').datagrid('validateRow', editIndex)) {
            $('#tblSampleInvoiceDetail').datagrid('endEdit', editIndex);
            $('#tblSampleInvoiceDetail').datagrid('selectRow', editIndex);
            var oSIDetail = $('#tblSampleInvoiceDetail').datagrid('getSelected');

            debugger;
            oSIDetail.AmountSt='$'+(oSIDetail.Qty* oSIDetail.UnitPrice);
            $('#tblSampleInvoiceDetail').datagrid('updateRow', { index: editIndex, row: oSIDetail });

            RefreshSummary();
            editIndex = undefined;
            return true;
        }
        else {
            return false;
        }
    }

    function onClickRow(index) {

        if (editIndex != index) {
            if (endEditing()) {
                $('#tblSampleInvoiceDetail').datagrid('selectRow', index).datagrid('beginEdit', index);
                var oPRDetail= $('#tblSampleInvoiceDetail').datagrid('getSelected');

                editIndex = index;
            }
            else {
                $('#tblSampleInvoiceDetail').datagrid('selectRow', editIndex);
            }
        }
    }


    $('#btnClose').click(function(e){
        window.location.href = sessionStorage.getItem("BackLink");
    });

  

    $("#btnDeleteDetail").click(function () {


        var oSampleInvoiceDetail = $("#tblSampleInvoiceDetail").datagrid("getSelected");
        if (oSampleInvoiceDetail == null) { alert("Please select an item from list!"); return false; }
        var nIndex=$('#tblSampleInvoiceDetail').datagrid('getRowIndex',oSampleInvoiceDetail);
        if (!confirm("Confirm to Delete?")) return false;
        if (oSampleInvoiceDetail.SampleInvoiceDetailID > 0)
        {
            $.ajax
            ({
                type: "POST",
                dataType: "json",
                url : _sBaseAddress+  "/SampleInvoice/DeleteDetail_Adj",
                traditional: true,
                data:  JSON.stringify(oSampleInvoiceDetail),
                contentType: "application/json; charset=utf-8",
                success: function (data) {
                    var feedbackmessage = jQuery.parseJSON(data);
                    if (feedbackmessage == "Deleted")
                    {
                        alert("Delete sucessfully");
                        $('#tblSampleInvoiceDetail').datagrid('deleteRow',nIndex);
                        RefreshSummary();
                       
                    }
                    else
                    {
                        alert(feedbackmessage);
                    }
                },
                error: function (xhr, status, error)
                {
                    alert(error);
                }
            });
        }
        else{
            alert("Delete sucessfully");
            $('#tblSampleInvoiceDetail').datagrid('deleteRow',nIndex);
            RefreshSummary();
        }
    });

    $("#btnRefresh").click(function () {
        endEditing();
    });
  
    function RefreshSummary()
    {
        var oDODetails = $('#tblSampleInvoiceDetail').datagrid('getRows');
        var nTotalQty = 0, nTotalAmount= 0;
        for(var i = 0; i<oDODetails.length;i++)
        {
            nTotalQty+=parseFloat(oDODetails[i].Qty);
            nTotalAmount+=parseFloat(oDODetails[i].Qty*oDODetails[i].UnitPrice);
        }
        document.getElementById('lblTotalQty').innerHTML = formatPrice(nTotalQty,0)+"LBS";
        document.getElementById('lblTotalAmount').innerHTML = "$"+formatPrice(nTotalAmount,0);
        var CRate=1;
        CRate=  $("#txtConversionRate").val();
        $("#txtAmount").val(formatPrice(parseFloat(nTotalAmount)));
        $("#txtAmountWithCRate").val(formatPrice(parseFloat(nTotalAmount)*parseFloat(CRate)));
    }

    $('#txtConversionRate').keyup(function ()
    {
        var nAmount= icsRemoveComma($("#txtAmount").val());
        var nBDTAmount=parseFloat($('#txtConversionRate').val()) * parseFloat(nAmount);
        document.getElementById("txtAmountWithCRate").value= formatPrice(nBDTAmount.toFixed(2));
    });


  

    $("#btnCancel").click(function (){
        debugger;
        if(!Validation()) return false;
        var oSampleInvoice=RefreshObject();
        if( oSampleInvoice==null)
        {
            alert(" Something Wrong. Please Check!!");
        }

        if(oSampleInvoice.SampleInvoiceID>0)
        {
            $.ajax({
                type: "POST",
                dataType: "json",
                url : _sBaseAddress+  "/SampleInvoice/DOCancel",
                traditional: true,
                data:  JSON.stringify(oSampleInvoice),
                contentType: "application/json; charset=utf-8",
                success: function (data) {

                    var  oSampleInvoice = jQuery.parseJSON(data);
                    if (oSampleInvoice.ErrorMessage=="" || oSampleInvoice.ErrorMessage==null) {
                        alert("Cancel successfully");
                        _oSampleInvoice=oSampleInvoice;

                        var oSampleInvoices =sessionStorage.getItem("SampleInvoices");
                        var nIndex= parseInt(sessionStorage.getItem("SelectedRowIndex"));

                        if(oSampleInvoices!=null)
                        {
                            oSampleInvoices = jQuery.parseJSON(oSampleInvoices);
                        }
                        else
                        {
                            oSampleInvoices=[];
                        }
                        if(nIndex!=-1)
                        {
                            oSampleInvoices[nIndex]=_oSampleInvoice;
                        }
                        else
                        {
                            sessionStorage.setItem("SelectedRowIndex", oSampleInvoices.length);
                            oSampleInvoices.push(oSampleInvoices);
                        }
                        sessionStorage.setItem("SampleInvoices", JSON.stringify(oSampleInvoices));
                        window.location.href = _sBackLink;
                    }
                    else
                    {
                        alert(oSampleInvoice.ErrorMessage);
                    }
                },
                error: function (xhr, status, error) {
                    alert(error);
                }


            });
        }

        else
        {
            alert("Please Select valid Order.");
        }


    });


    $("#btnLoadIssueToCP").click(function () {        
        if(_oSampleInvoice.ContractorID===null ||parseInt(_oSampleInvoice.ContractorID) <=0)
        {
            alert("Please Pick a Issue To!");
            return;
        }
        GetContactPersonel(parseInt(_oSampleInvoice.ContractorID), true);
    });

    $('#btnNewIssueToCP').click(function(e){        
        if(_oSampleInvoice.ContractorID===null ||parseInt(_oSampleInvoice.ContractorID) <=0)
        {
            alert("Please Pick a Issue To!");
            return;
        }
        sessionStorage.setItem("ContractorBackTo", "");
        sessionStorage.setItem("SelectedRowIndex", 0);
        sessionStorage.setItem("ContractorHeader", "Add Contact Personnel");
        window.open(_sBaseAddress+"/Contractor/ViewContactPersonnel?id="+parseInt(_oSampleInvoice.ContractorID),"_blank");
    });

    $('#btnPrint').click(function(e){        
        if(_oSampleInvoice==null || _oSampleInvoice.SampleInvoiceID<=0)
        {
            alert("Please select a item from list!");
            return;
        }
        window.open(_sBaseAddress+ "/SampleInvoice/PrintSampleInvoice_AdjInvoice?id="+_oSampleInvoice.SampleInvoiceID+"&bIsSample="+false, "_blank");
    });
</script>