@model IEnumerable<ESimSol.BusinessObjects.FabricSCReport>
    @{
        ViewBag.Title = "PO Register";
    }
   

 <div id="progressbarParent" style="width:100%;height:100%;margin:0 auto;text-align:center; margin-left: auto;margin-right: auto;left: 0;right: 0;z-index: 1;">
                          <div style="margin: 0px auto;margin-top: 251px;text-align:center;width:390px;">
                              <label style="font-size:18px;">Please wait</label>
                              <div id="progressbar" style="width:100%;height:37px;"></div>
                          </div>
                      </div>
 
 <div class="menuMainCollectionTable">
     <table id="tblFabricSCReports" title="PO List" style="width:100%; height:100%" class="easyui-datagrid" fit="true" fitcolumns="false" rownumbers="true" pagination="false" singleselect="true" autorowheight="false" toolbar="#toolbarFabricSCReport" data-options="rowStyler: function(index,row){
                                         if (row.ContractorName=='Total'){
                                            return 'color:#016B18; font-weight:bold;';
                                        }
                                    }
                    ">
         @*<table id="tblFabricSCReports" title="PO(s)" class="easyui-datagrid" style="width: 100%; height:100%; margin: 0;" data-options="singleSelect: true,fitColumns:false, rownumbers:true, pagination:false, autoRowHeight:false, toolbar: '#toolbarFabricSCReport' ">*@
         <thead data-options="frozen:true">
             <tr>
                 <th field="SCNoFull" width="8%" align="left">PO No</th>
                 <th field="ExeNo" width="10%" align="left"> Exe No</th>
                 <th field="PINo" width="10%" align="left">PI No</th>
    @*<th field="SCDateSt" width="6%" align="center">PO Issue Date</th>*@
                 @*<th field="OrderTypeSt" width="10%" align="center"> Order Type</th>*@
                 <th field="BuyerName" width="15%" align="left">Buying House</th>
                 <th field="ContractorName" width="15%" align="left">Issue To</th>
                 @*<th field="MKTGroup" width="8%" align="left"> MKT Team</th>*@
                 @*<th field="MKTPName" width="8%" align="left"> Concern Person</th>*@
                 @*<th field="OrderTypeSt" width="6%" align="center"> Order Type</th>*@
             </tr>
         </thead>
         <thead>
             <tr>
                 <th field="FabricNo" width="10%" align="left"> MKT Ref</th>
                 <th field="Construction" width="10%" align="left"> Construction</th>
                 <th field="FabricWidth" width="15%" align="left">Width</th>
                <th field="FabricDesignName" width="10%" align="left">Design</th>
                 <th field="ColorInfo" width="10%" align="left"> Color</th>
                 @*<th field="ApproveByName" width="10%" align="left"> Approve By</th>
                    <th field="ApprovedDateSt" width="8%" align="left"> Approve Date</th>
                    <th field="CurrentStatusSt" width="6%" align="left"> Status</th>*@
                 @*<th field="PINo" width="10%" align="left">PI No</th>
                    <th field="PIDateSt" width="10%" align="left"> PI Date</th>
                    <th field="LCNo" width="10%" align="left">L/C No</th>*@
                 @*<th field="PIDateSt" width="20%" align="left"> Status</th>*@
                 @*<th field="LCStatusSt" width="5%" align="left"> L/C Status</th>*@

               
                 <th field="Qty" formatter="formatPrice" width="8%" align="right">Order Qty(Y)</th>
                 <th field="StockInHand" formatter="formatPrice" width="8%" align="right">Ready Stock(Y)</th>
                 <th field="UnitPrice" formatter="formatPrice" width="6%" align="right">U/P</th>
                 <th field="AmountSt" width="8%" align="right">Amount</th>
                 <th field="Qty_DO" formatter="formatPrice" width="8%" align="right">DO Qty(Y)</th>
                 <th field="Qty_DC" formatter="formatPrice" width="8%" align="right">DC Qty(Y)</th>
                 <th field="Qty_DCBal" formatter="formatPrice" width="8%" align="right">Balance(Y)</th>


                 @*<th field="Construction" width="10%" align="left"> Construction</th>
                    <th field="ProductName" width="10%" align="left">Composition</th>
                    <th field="ProcessTypeName" width="10%" align="left"> Fabric type </th>
                    <th field="FabricWeaveName" width="10%" align="left"> Weave</th>*@
                 @*<th field="Size" width="10%" align="left"> Size</th>*@
                 @*<th field="FinishTypeName" width="10%" align="left">Finish Type</th>
                    <th field="ColorInfo" width="10%" align="left"> Color</th>
                    <th field="FabricWidth" width="15%" align="left">Width</th>
                    <th field="FabricDesignName" width="10%" align="left">FabricDesignName</th>*@

                 @*<th field="AttCount" width="8%">Attachment Count</th>*@

             </tr>
         </thead>
     </table>

         <div id="toolbarFabricSCReport">
             <input id="txtSearchbyPONo" type="text" placeholder="Search by PO No" style="width:120px" />
             @*<input id="txtStartDate" type="text" style="width: 95px;" class="easyui-datebox" required="required" data-options="formatter:icsdateformat,parser:icsdateparser" />
                <a id="btnSearchByDate" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-search" plain="true">Search</a>*@
             <a id="btnAdvSearch" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-search" plain="true">Adv. Search</a>
             @*<a id="btnPrint" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-print" plain="true">Print</a>
                <a id="btnPartyWisePrint" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-print" plain="true">Print(Party Wise) </a>
                <a id="btnProductWisePrint" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-print" plain="true">Print(Product Wise) </a>*@

             <a id="btnPrintXL" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-excel" plain="true">ExportXL</a>
         </div>
</div>
                      <div id="winAdvSearch" class="easyui-window winClass" style="width:720px" title="Adv. Search" data-options="modal:true,closed:true,collapsible:false,minimizable:false,maximizable:false,closable:false">
                          <div>
                              <fieldset style="margin-bottom: 0px;">
                                  <legend>Searching Criteria</legend>
                                  <table style="width:100%;text-align:right;">
                                      <tr>
                                          <td style="width:20%;text-align:right;">
                                              <label>P/I No :</label>
                                          </td>
                                          <td style=" width:30%;text-align:left;">
                                              <input id="txtPINo" style="width:100%;" type="text" />
                                          </td>
                                          <td style=" width:20%;text-align:right;">
                                              <label>Fabric No :</label>
                                          </td>
                                          <td style=" width:30%;text-align:left;">
                                              <input id="txtFabricID" style="width:80%;" type="text" />
                                          </td>
                                      </tr>

                                      <tr>
                                          <td style=" width:20%;text-align:right;">
                                              <label>Issue To :</label>
                                          </td>
                                          <td colspan="3" style=" width:80%;text-align:left;">
                                              <input id="txtContractorAdvS" style="width:80%;" type="text" placeholder="Type & Press Enter" />
                                              <a id="btnPickContractorAdvS" href="javascript:void(0)" class="easyui-linkbutton ics-pick" iconcls="icon-pick" plain="true"></a>
                                              <a id="btnClrContractorAdvS" href="javascript:void(0)" class="easyui-linkbutton ics-pick" iconcls="icon-clear" plain="true"></a>
                                          </td>
                                      </tr>

                                      <tr>
                                          <td style=" width:20%;text-align:right;">
                                              <label>Buying House :</label>
                                          </td>
                                          <td colspan="3" style=" width:80%;text-align:left;">
                                              <input id="txtDeliverTo" style="width:80%;" type="text" placeholder="Type & Press Enter" />
                                              <a id="btnPickDeliverTo" href="javascript:void(0)" class="easyui-linkbutton ics-pick" iconcls="icon-pick" plain="true"></a>
                                              <a id="btnClrDeliverTo" href="javascript:void(0)" class="easyui-linkbutton ics-pick" iconcls="icon-clear" plain="true"></a>
                                          </td>
                                      </tr>
                                      <tr>
                                          <td style=" width:20%;text-align:right;">
                                              <label>Mkt Account:</label>
                                          </td>
                                          <td colspan="3" style=" width:80%;text-align:left;">
                                              <input id="txtMktAccount" class="reset-text" placeholder="Search Concern Person" style="width:80%" />
                                              <a id="btnPickMktAccount" href="javascript:void(0)" class="easyui-linkbutton ics-pick" iconcls="icon-pick" plain="true"></a>
                                              <a id="btnResetMktPerson" href="javascript:void(0)" class="easyui-linkbutton ics-pick" iconcls="icon-clear" plain="true"></a>
                                          </td>
                                      </tr>
                                      <tr>
                                          <td style=" width:20%;text-align:right;">
                                              <label>PO Date:</label>
                                          </td>
                                          <td colspan="3" style=" width:80%;text-align:right;">
                                              <table>
                                                  <tr>
                                                      <td style=" width:100%;text-align:left;">
                                                          <select style="width:25%;" id="cboPODate" onchange="DateActions_OPDate(); "></select>
                                                          <input id="txtFromPODate" type="text" style="width: 110px;" class="easyui-datebox" required="required" data-options="formatter:icsdateformat,parser:icsdateparser" />To
                                                          <input id="txtToPODate" type="text" style="width: 110px;" class="easyui-datebox" required="required" data-options="formatter:icsdateformat,parser:icsdateparser" />
                                                      </td>
                                                  </tr>
                                              </table>
                                          </td>
                                      </tr>
                                      <tr>
                                          <td style=" width:20%;text-align:right;">
                                              <label>Approve Date:</label>
                                          </td>
                                          <td colspan="3" style=" width:80%;text-align:right;">
                                              <table>
                                                  <tr>
                                                      <td style=" width:100%;text-align:left;">
                                                          <select style="width:25%;" id="cboApproveDate" onchange="DateActions_ApproveDate(); "></select>
                                                          <input id="txtFromApproveDate" type="text" style="width: 110px;" class="easyui-datebox" required="required" data-options="formatter:icsdateformat,parser:icsdateparser" />To
                                                          <input id="txtToApproveDate" type="text" style="width: 110px;" class="easyui-datebox" required="required" data-options="formatter:icsdateformat,parser:icsdateparser" />
                                                      </td>
                                                  </tr>
                                              </table>
                                          </td>
                                      </tr>
                                      <tr>
                                          <td style=" width:20%;text-align:right;">
                                              <label>Production Type:</label>
                                          </td>
                                          <td colspan="3" style=" width:80%;text-align:left;">
                                              <select id="cboProductionType" style="width:28%;"><option value="0">All</option><option value="1">In House</option><option value="2">Sub Contract</option></select>

                                          </td>
                                      </tr>
                                      <tr>
                                          <td style=" width:20%;text-align:right;">
                                              <label>Order Type : </label>
                                          </td>
                                          <td colspan="3" style="width:95%;text-align:left;">
                                              <div style="margin-top: 2px;">
                                                  <table style="width:100%; height: 150px;">
                                                      <tr>
                                                          <td style="width:50%;">
                                                              <table id="tblOrderTypes" class="easyui-datagrid" title="" style="width:95%; height: 150px;" data-options="singleSelect: false,fitColumns:false, rownumbers:true, pagination:false, autoRowHeight:false, ">
                                                                  <thead>
                                                                      <tr>
                                                                          <th data-options="field:'Selected',checkbox:true"></th>
                                                                          <th field="Value" width="80%"></th>
                                                                      </tr>
                                                                  </thead>
                                                              </table>
                                                          </td>
                                                          <td style="width:50%;">
                                                              <table id="tblCurrentStatuss" class="easyui-datagrid" title="" style="width:95%; height: 150px;" data-options="singleSelect: false,fitColumns:false, rownumbers:true, pagination:false, autoRowHeight:false, ">
                                                                  <thead>
                                                                      <tr>
                                                                          <th data-options="field:'Selected',checkbox:true"></th>
                                                                          <th field="Value" width="80%"></th>
                                                                      </tr>
                                                                  </thead>
                                                              </table>
                                                          </td>
                                                      </tr>
                                                  </table>


                                              </div>
                                          </td>
                                      </tr>

                                  </table>
                              </fieldset>

                              <fieldset>
                                  <legend>Actions : </legend>
                                  <table style="width:100%;text-align:right;">
                                      <tr>
                                          <td style="width:20%;text-align:right;">

                                              <a id="btnResetAdvSearch" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-reload" plain="true">Reset</a>

                                          </td>
                                          <td style="width:80%;text-align:right;">
                                              <label class="lblLoadingMessage" style="float: left;">Loading Please Wait...</label>
                                              <a id="btnSearchAdvSearch" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-search" plain="true">Search</a>
                                              <a id="btnCloseAdvSearch" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-cancel" plain="true">Close</a>
                                          </td>
                                      </tr>
                                  </table>

                              </fieldset>
                          </div>
                      </div>
 <style type="text/css">
    .lines-no .datagrid-body td {
        border-right: 1px dotted transparent;
        border-bottom: 1px dotted transparent;
    }
 
</style>

 <script type="text/javascript">
    var _sBaseAddress="";
    var _oFabricSCReport=null;
    var _oFabricSCReports=[];
    var _oBankBranchs=[];
    var _oCurrencys=[];
    var _oLCTerms=[];
    var _oCompanys=[];
    var _oLCTerms=[];
    var _oCompareOperators=[];
    var _oPaymentInstructions=[];
    var _oFabricPOStatus = [];
    var _oOrderTypes=[];
    var _nBUID = 0;
    var _sContractorIds = '';
    var _sBuyerIds = '';
    var _sMAccountIds='';
    var _oBU = null;
    var _nReportType=0;
    var _sProductIds="";
    $(document).ready(function () {

        _sBaseAddress =@Html.Raw( new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(HttpContext.Current.Session[SessionInfo.BaseAddress]));
        _oFabricSCReports =@Html.Raw( new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(Model));
        _oCurrencys = @Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(ViewBag.Currencys));
        _oLCTerms = @Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(ViewBag.LCTerms));
        _oCompareOperators = @Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(ViewBag.CompareOperators));
        _nBUID = @Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(ViewBag.BUID));
        _oPaymentInstructions = @Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(ViewBag.PaymentInstructions));
        var oAuthorizationRolesMapping = @Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(HttpContext.Current.Session[SessionInfo.AuthorizationRolesMapping]));
        _oOrderTypes = @Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(ViewBag.OrderTypes));
        _oFabricPOStatus = @Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(ViewBag.FabricPOStatus));

        //$("#txtFromIssueDateAdvSearch,#txtToIssueDateAdvSearch").datebox({ disabled: false });
        //$("#txtFromIssueDateAdvSearch,#txtToIssueDateAdvSearch").datebox("setValue", icsdateformat(new Date()));
        //$("#txtFromValidityDateAdvSearch,#txtToValidityDateAdvSearch").datebox({ disabled: false });
        //$("#txtFromValidityDateAdvSearch,#txtToValidityDateAdvSearch").datebox("setValue", icsdateformat(new Date()));
        debugger;
        //$("#tblCurrentStatusAdvSearch").datagrid("checkAll");
        $("#progressbar").progressbar({ value: 0 });
        $("#progressbarParent").hide();
        $(".lblLoadingMessage").hide();
        LoadComboAdv();
        debugger;
        RefreshDate()
    });

    $(document).keydown(function (e) { if (e.keyCode == 27) { $('div').icsWindow('close'); } });

    function RefreshDate()
    {
        $('#txtStartDate').datebox('setValue', icsdateformat(new Date()));
    }


    $("#btnPrint").click(function () {

        var sParams=sessionStorage.getItem("ParamsP");
        window.open(_sBaseAddress + '/FabricSCReport/Print_SampleOrderReport?sTempString=' + sParams, "_blank");
    });

    $("#btnPrintXL").click(function ()
    {
        var sParams=sessionStorage.getItem("ParamsP");
        window.open(_sBaseAddress + '/FabricSCReport/Print_ReportXL_Order?sTempString=' + sParams+"&BUID="+_nBUID, "_blank");
    });



    ////Start adv Searching
    /// Search By No and Date
    $('#txtSearchbyPONo').keypress(function (e) {

        var code = (e.keyCode ? e.keyCode : e.which);
        if (code == 13)//Enter key-13
        {
            if ($.trim($("#txtSearchbyPONo").val()) == "")
            {
                alert("Please give PO No.");
                return false;
            }
            var oFabricSCReport =
            {
                FabricSalesContractID: 0,
                BUID:_nBUID,
                SCNoFull: $.trim($("#txtSearchbyPONo").val())
            };
            Gets_bySCNo(oFabricSCReport);
        }

    });
   
    function Gets_bySCNo(oFabricSCReport)
    {
        sessionStorage.setItem("ParamsP", "");
        $.ajax({
            type: "POST",
            dataType: "json",
            url: _sBaseAddress + "/FabricSCReport/GetbySCNoMKT",
            traditional: true,
            data: JSON.stringify(oFabricSCReport),
            contentType: "application/json; charset=utf-8",
            success: function (data) {
                debugger;
                var oFabricSCReports = data;
                if (oFabricSCReports.length > 0) 
                {
                    DynamicRefreshList(oFabricSCReports, "tblFabricSCReports");
                    RefreshSummary();
                    $("#winAdvSearch").icsWindow("close");
                } else {
                    alert("Sorry, No data found.");
                    DynamicRefreshList([], "tblFabricSCReports");
                }

                $(".lblLoadingMessage").hide();

            }
        }); 

    }



   
    ////Start adv Searching

    function updateProgress() {
        var value =$('#progressbar').progressbar('getValue');
        if (value < 96){
            value += Math.floor(Math.random() * 10);
            $('#progressbar').progressbar('setValue', value);
        }
    }
    function hideShow(miliseconds) {
        $("#progressbarParent").hide();
    }
    //Account Of Picker

    $("#txtContractorAdvS").keydown(function (e) {
        if (e.keyCode === 13) // Enter Press
        {
            PickContractors_AdvS();
        }
        else if (e.keyCode === 08) {
            $("#txtContractorAdvS").removeClass("fontColorOfPickItem");
            _sContractorIds = '';
        }
    });

    $("#btnClrContractorAdvS").click(function () {
        $("#txtContractorAdvS").removeClass("fontColorOfPickItem");
        $("#txtContractorAdvS").val("");
        _sContractorIds = '';
    });

    $("#btnPickContractorAdvS").click(function () {
        PickContractors_AdvS();
    });
    function PickContractors_AdvS() {
        var oContractor = {
            Params: '2,3' + '~' + $.trim($("#txtContractorAdvS").val()+"~"+_nBUID)
        };
        var obj = {
            BaseAddress: _sBaseAddress,
            Object: oContractor,
            ControllerName: "Contractor",
            ActionName: "ContractorSearchByNameType",
            IsWinClose: false
        };

        $("#progressbar").progressbar({ value: 0 });
        $("#progressbarParent").show();
        var intervalID = setInterval(updateProgress, 250);

        DynamicRefreshList([], "tblAccountsPickerAdvSearch");
        $.icsDataGets(obj, function (response) {
            clearInterval(intervalID);
            $("#progressbarParent").hide();
            if (response.status && response.objs.length > 0) {
                if (response.objs[0].ContractorID > 0) {
                    var tblColums = []; var oColumn = { field: "ContractorID", title: "Code", width: 50, align: "left" }; tblColums.push(oColumn);
                    oColumn = { field: "Name", title: "Name", width: 280, align: "left" }; tblColums.push(oColumn);

                    var oPickerParam = {
                        winid: 'winContractorPicker',
                        winclass: 'clsAccountOf',
                        winwidth: 400,
                        winheight: 460,
                        tableid: 'tblAccountOfs',
                        tablecolumns: tblColums,
                        datalist: response.objs,
                        multiplereturn: true,
                        searchingbyfieldName: 'Name',
                        windowTittle: 'Contactor List'
                    };
                    $.icsPicker(oPickerParam);
                    IntializePickerbutton(oPickerParam);
                }
                else {
                    alert(response.objs[0].ErrorMessage);
                }
            }
            else {
                alert("Sorry, No Contactor Found.");
            }
        });
    }
    //End Account Of Picker
    $("#btnClrDeliverTo").click(function () {
        $("#txtDeliverTo").val("");
        _sBuyerIds="";
    });

    $("#btnPickDeliverTo").click(function () {

        var oContractor = {
            Params: '2,3' + '~' + $.trim($("#txtDeliverTo").val()+'~'+_nBUID)
        };
        GetDeliverTo(oContractor);
    });

    $("#txtDeliverTo").keydown(function (e) {
        var nkeyCode = e.keyCode || e.which;
        if(nkeyCode==13){
            var sContractorName=$.trim($("#txtDeliverTo").val());
            if(sContractorName=="" || sContractorName==null)
            {
                alert("Please, Type name or part of Name");
                $("#txtDeliverTo").focus();
                $("#txtDeliverTo").addClass("errorFieldBorder");
                return;
            }
            var oContractor = {
                Params: '2,3' + '~' + $.trim($("#txtDeliverTo").val()+'~'+_nBUID)
            };
            GetDeliverTo(oContractor);
        }
        else if(nkeyCode==8){
            $("#txtDeliverTo").val("");
            _sBuyerIds="";

        }
    });
   
    function GetDeliverTo(oContractor){


        var obj = {
            BaseAddress: _sBaseAddress,
            Object: oContractor,
            ControllerName: "Contractor",
            ActionName: "ContractorSearchByNameType",
            IsWinClose: false
        };
        $("#progressbar").progressbar({ value: 0 });
        $("#progressbarParent").show();
        var intervalID = setInterval(updateProgress, 250);
        $.icsDataGets(obj, function (response) {
            clearInterval(intervalID);
            $("#progressbarParent").hide();
            if (response.status && response.objs.length > 0)
            {
                if (response.objs[0].ContractorID > 0) {
                    debugger;
                    var tblColums = [];
                    var oColumn = { field: "ContractorID", title: "Code", width: 50, align: "center" };tblColums.push(oColumn);
                    oColumn = { field: "Name", title: "Name", width: 190, align: "left" };tblColums.push(oColumn);
                    oColumn = { field: "Phone", title: "Phone", width: 140, align: "left" };tblColums.push(oColumn);

                    var oPickerParam = {
                        winid: 'winDeliverToPicker',
                        winclass:'clsDeliverToPicker',
                        winwidth: 460,
                        winheight: 460,
                        tableid: 'tblDeliverToPicker',
                        tablecolumns: tblColums,
                        datalist: response.objs,
                        multiplereturn: true,
                        searchingbyfieldName:'Name',
                        windowTittle: 'Deliver To List'
                    };
                    $.icsPicker(oPickerParam);
                    IntializePickerbutton(oPickerParam);//multiplereturn, winclassName
                }
                else { alert(response.objs[0].ErrorMessage); }
            }
            else{
                alert("No contractor found.");
            }
        });
    }

    $("#btnResetMktPerson").click(function () {

        $("#txtMktAccount").val("");
        _sMAccountIds="";
    });

    $("#btnPickMktAccount").click(function () {
        debugger;
        var sName=$.trim($("#txtMktAccount").val());
        GetMktPersons(sName);
    });

    $("#txtMktAccount").keydown(function (e) {
        var nkeyCode = e.keyCode || e.which;
        if(nkeyCode==13){
            var sName=$.trim($("#txtMktAccount").val());
            if($('#txtMktAccount').val()==null || $('#txtMktAccount').val()=="")
            {
                alert("Please Type Name or part Name and Press Enter.");
                $('#txtMktAccount').focus();
                return;
            }
            GetMktPersons(sName);
        }
        else if(nkeyCode==8){
            $("#txtMktAccount").val("");
            _sMAccountIds="";
        }
    });
    function GetMktPersons(sName){

        var oMarketingAccount_BU = {
            Name:sName,
            BUID:sessionStorage.getItem("BUID")
        };
        var obj = {
            BaseAddress: _sBaseAddress,
            Object: oMarketingAccount_BU,
            ControllerName: "MarketingAccount",
            ActionName: "MarketingAccountSearchByNameAndGroup",
            IsWinClose: false
        };

        $.icsDataGets(obj, function (response) {

            if (response.status && response.objs.length > 0) {
                if (response.objs[0].MarketingAccountID > 0) {
                    debugger;
                    var tblColums = [];
                    var oColumn = { field: "MarketingAccountID", title: "Code", width: 50, align: "left" };tblColums.push(oColumn);
                    oColumn = { field: "Name", title: "Name", width: 180, align: "left" };tblColums.push(oColumn);
                    oColumn = { field: "GroupName", title: "GroupName", width: 120, align: "left" };tblColums.push(oColumn);
                    oColumn = { field: "Phone", title: "Phone", width: 100, align: "left" };tblColums.push(oColumn);

                    var oPickerParam = {
                        winid: 'winMktAccount',
                        winclass:'clsMktPersonPicker',
                        winwidth: 460,
                        winheight: 460,
                        tableid: 'tblMktPersonPicker',
                        tablecolumns: tblColums,
                        datalist: response.objs,
                        multiplereturn: true,
                        searchingbyfieldName:'Name',
                        windowTittle: 'MKT Person List'
                    };
                    $.icsPicker(oPickerParam);
                    IntializePickerbutton(oPickerParam);//multiplereturn, winclassName
                }
                else { alert(response.objs[0].ErrorMessage); }
            }
            else{
                alert("No marketing person found.");
            }
        });


    }
    //End Pick Mkt

    function IntializePickerbutton(oPickerobj) {
        $("#" + oPickerobj.winid).find("#btnOk").click(function () {
            SetPickerValueAssign(oPickerobj);
        });
        $(document).find('.' + oPickerobj.winclass).keydown(function (e) {
            if (e.which === 13) {
                SetPickerValueAssign(oPickerobj);
            }
        });
    }

    function SetPickerValueAssign(oPickerobj) {
        var oreturnObj = null, oreturnObjs = [];
        if (oPickerobj.multiplereturn) {
            oreturnObjs = $('#' + oPickerobj.tableid).datagrid('getChecked');
        } else {
            oreturnObj = $('#' + oPickerobj.tableid).datagrid('getSelected');
        }

        if (oPickerobj.winid == 'winContractorPicker')
        {
            if (oreturnObjs != null && oreturnObjs.length> 0)
            {

                _sContractorIds=''; var sMessage='';
                sMessage=(oreturnObjs.length>1)? oreturnObjs.length +" Contractors Selected" : oreturnObjs[0].Name;
                $('#txtContractorAdvS').val(sMessage);
                $("#txtContractorAdvS").addClass("fontColorOfPickItem");

                for(var i=0;i<oreturnObjs.length;i++){
                    _sContractorIds=_sContractorIds+oreturnObjs[i].ContractorID+',';
                }
                _sContractorIds=_sContractorIds.substring(0,_sContractorIds.length-1);

            }
            else
            {
                alert("Please select a contractor.");
                return false;
            }
        }

        else if (oPickerobj.winid == 'winDeliverToPicker') 
        {
            if (oreturnObjs != null && oreturnObjs.length> 0)
            {
                var sMessage='';
                _sBuyerIds="";
                sMessage=(oreturnObjs.length>1)? oreturnObjs.length +" Buying House(s) Selected" : oreturnObjs[0].Name;
                $('#txtDeliverTo').val(sMessage);
                $("#txtDeliverTo").addClass("fontColorOfPickItem");

                for(var i=0;i<oreturnObjs.length;i++){
                    _sBuyerIds=_sBuyerIds+oreturnObjs[i].ContractorID+',';
                }
                _sBuyerIds=_sBuyerIds.substring(0,_sBuyerIds.length-1);
               
            }
            else
            {
                alert("Please select a Buying House.");
                return false;
            }
        }
        else if (oPickerobj.winid == 'winMktAccount') 
        {
            if (oreturnObjs != null && oreturnObjs.length> 0)
            {
                var sMessage='';
                _sMAccountIds="";
                sMessage=(oreturnObjs.length>1)? oreturnObjs.length +"MKT Account(s) Selected" : oreturnObjs[0].Name;
                $('#txtMktAccount').val(sMessage);
                $("#txtMktAccount").addClass("fontColorOfPickItem");
                for(var i=0;i<oreturnObjs.length;i++){
                    _sMAccountIds=_sMAccountIds+oreturnObjs[i].MarketingAccountID+',';
                }
                _sMAccountIds=_sMAccountIds.substring(0,_sMAccountIds.length-1);
            }
            else
            {
                alert("Please select a MKt Account.");
                return false;
            }
        }

        $("#" + oPickerobj.winid).icsWindow("close");
        $("#" + oPickerobj.winid).remove();
    }


    //End Buyer Search
    $("#btnResetAdvSearch").click(function () {
        ResetAdvSearchWindow();
        LoadComboAdv();
    });


    $("#btnSearchAdvSearch").click(function () {
        //$(".lblLoadingMessage").show();
        //var sOrderTypeIDs = "";
        //var sPONo="";
        //var oOrderType = $("#tblOrderTypes").datagrid("getChecked");
        //if (oOrderType.length > 0)
        //{
        //    for (var i = 0;i<oOrderType.length; i++){
        //        sOrderTypeIDs = oOrderType[i].id + "," + sOrderTypeIDs;
        //    }
        //    sOrderTypeIDs = sOrderTypeIDs.substring(0, sOrderTypeIDs.length - 1);
        //}

        //var sCurrentStatus = "";
        //var oCurrentStatuss = $("#tblCurrentStatuss").datagrid("getChecked");
        //if (oCurrentStatuss.length > 0)
        //{
        //    for (var i = 0;i<oCurrentStatuss.length; i++){
        //        sCurrentStatus = oCurrentStatuss[i].id + "," + sCurrentStatus;
        //    }
        //    sCurrentStatus = sCurrentStatus.substring(0, sCurrentStatus.length - 1);
        //}

        //var sTempString = $.trim($("#txtPINo").val()) + '~'
        //                + $.trim($("#txtFabricID").val()) + '~'
        //                + _sContractorIds + '~'
        //                + _sBuyerIds + '~'
        //                + _sMAccountIds + '~'
        //                + $("#cboPODate").val() + '~'
        //                + $("#txtFromPODate").datebox("getValue") + '~'
        //                + $("#txtToPODate").datebox("getValue") + '~'
        //                 + $("#cboApproveDate").val() + '~'
        //                + $("#txtFromApproveDate").datebox("getValue") + '~'
        //                + $("#txtToApproveDate").datebox("getValue") + '~'
        //                + $("#cboProductionType").val() + '~'
        //                + sOrderTypeIDs  + '~'
        //                  + sCurrentStatus  + '~'
        //                +_nBUID + '~'
        //                 +sPONo
  
        $(".lblLoadingMessage").show();
        var sOrderTypeIDs = "";
        debugger;
        var oOrderType = $("#tblOrderTypes").datagrid("getChecked");
        if (oOrderType.length > 0)
        {
            for (var i = 0;i<oOrderType.length; i++){
                sOrderTypeIDs = oOrderType[i].id + "," + sOrderTypeIDs;
            }
            sOrderTypeIDs = sOrderTypeIDs.substring(0, sOrderTypeIDs.length - 1);
        }
        var sPONo="";
        var sCurrentStatus = "";
        var oCurrentStatuss = $("#tblCurrentStatuss").datagrid("getChecked");
        if (oCurrentStatuss.length > 0)
        {
            for (var i = 0;i<oCurrentStatuss.length; i++){
                sCurrentStatus = oCurrentStatuss[i].id + "," + sCurrentStatus;
            }
            sCurrentStatus = sCurrentStatus.substring(0, sCurrentStatus.length - 1);
        }

        var sTempString = $.trim($("#txtPINo").val()) + '~'
                        + $.trim($("#txtFabricID").val()) + '~'
                        + _sContractorIds + '~'
                        + _sBuyerIds + '~'
                        + _sMAccountIds + '~'
                        + $("#cboPODate").val() + '~'
                        + $("#txtFromPODate").datebox("getValue") + '~'
                        + $("#txtToPODate").datebox("getValue") + '~'
                        + $("#cboApproveDate").val() + '~'
                        + $("#txtFromApproveDate").datebox("getValue") + '~'
                        + $("#txtToApproveDate").datebox("getValue") + '~'
                        + $("#cboProductionType").val() + '~'
                          + $("#cboIsPrinting").val() + '~'
                        + sOrderTypeIDs  + '~'
                        + sCurrentStatus  + '~'
                        + _nBUID + '~'
                        + sPONo + '~'+ 0
                     
                     

        var oFabricSCReport = {
            ErrorMessage: sTempString
        }
        sessionStorage.setItem("ParamsP", sTempString);
        $.ajax({
            type: "POST",
            dataType: "json",
            url: _sBaseAddress + "/FabricSCReport/AdvanchSearchTwo",
            traditional: true,
            data: JSON.stringify(oFabricSCReport),
            contentType: "application/json; charset=utf-8",
            success: function (data) {
                debugger;
                var oFabricSCReports = data;
                if (oFabricSCReports.length > 0) 
                {
                    DynamicRefreshList(oFabricSCReports, "tblFabricSCReports");
                    RefreshSummary();
                    $("#winAdvSearch").icsWindow("close");
                } else {
                    alert("Sorry, No data found.");
                    DynamicRefreshList([], "tblFabricSCReports");
                }

                $(".lblLoadingMessage").hide();

            }
        });
    });
    $('#txtSearchbyPONo').keypress(function (e) {

        var code = (e.keyCode ? e.keyCode : e.which);
        if (code == 13)//Enter key-13
        {
            if ($.trim($("#txtSearchbyPONo").val()) == "")
            {
                alert("Please give PO No.");
                return false;
            }
            var sPONo=$.trim($("#txtSearchbyPONo").val());
            var sOrderTypeIDs = "";
            var sCurrentStatus = "";
            _sContractorIds="";
            debugger;
            var sTempString = "" + '~'
                            + "" + '~'//$.trim($("#txtFabricID").val()) + '~'
                            + _sContractorIds + '~'
                            + _sBuyerIds + '~'
                            + _sMAccountIds + '~'
                            + 0 + '~'
                            + icsdateformat(new Date())+ '~'
                            + icsdateformat(new Date())+ '~'
                            + 0+ '~'
                            + icsdateformat(new Date()) + '~'
                            + icsdateformat(new Date())+ '~'
                            + 0 + '~'
                            + sOrderTypeIDs  + '~'
                            + sCurrentStatus  + '~'
                            +_nBUID  + '~'
                            +sPONo;
  
        
                     

            var oFabricSCReport = {
                SCNoFull:$.trim($("#txtSearchbyPONo").val()),
                ErrorMessage: sTempString
            }
            sessionStorage.setItem("ParamsP", sTempString);
            $.ajax({
                type: "POST",
                dataType: "json",
                url: _sBaseAddress + "/FabricSCReport/AdvanchSearch",
                traditional: true,
                data: JSON.stringify(oFabricSCReport),
                contentType: "application/json; charset=utf-8",
                success: function (data)
                {
                    debugger;
                    var oFabricSCReports = data;
                    if (oFabricSCReports.length > 0) 
                    {
                        DynamicRefreshList(oFabricSCReports, "tblFabricSCReports");
                        // RefreshSummary();
                      
                    } else {
                        alert("Sorry, No data found.");
                        DynamicRefreshList([], "tblFabricSCReports");
                    }

                    $(".lblLoadingMessage").hide();

                }
            });
        }
    });
    $('#txtSearchbyFabricNo').keypress(function (e) {

        var code = (e.keyCode ? e.keyCode : e.which);
        if (code == 13)//Enter key-13
        {
            if ($.trim($("#txtSearchbyFabricNo").val()) == "")
            {
                alert("Please give P No.");
                return false;
            }
            var sOrderTypeIDs = "";
            var sCurrentStatus = "";
            _sContractorIds="";
            var sPONo="";
            debugger;
            var sTempString = "" + '~'
                            + $.trim($("#txtSearchbyFabricNo").val()) + '~'
                            + _sContractorIds + '~'
                            + _sBuyerIds + '~'
                            + _sMAccountIds + '~'
                            + 0 + '~'
                            + icsdateformat(new Date())+ '~'
                            + icsdateformat(new Date())+ '~'
                            + 0+ '~'
                            + icsdateformat(new Date()) + '~'
                            + icsdateformat(new Date())+ '~'
                            + 0 + '~'
                            + sOrderTypeIDs  + '~'
                              + sCurrentStatus  + '~'
                            +_nBUID + '~'
                            +sPONo
  
        
                     

            var oFabricSCReport = {
                SCNoFull:"",
                ErrorMessage: sTempString
            }
            sessionStorage.setItem("ParamsP", sTempString);
            $.ajax({
                type: "POST",
                dataType: "json",
                url: _sBaseAddress + "/FabricSCReport/AdvanchSearch",
                traditional: true,
                data: JSON.stringify(oFabricSCReport),
                contentType: "application/json; charset=utf-8",
                success: function (data)
                {
                    debugger;
                    var oFabricSCReports = data;
                    if (oFabricSCReports.length > 0) 
                    {
                        DynamicRefreshList(oFabricSCReports, "tblFabricSCReports");
                        // RefreshSummary();
                      
                    } else {
                        alert("Sorry, No data found.");
                        DynamicRefreshList([], "tblFabricSCReports");
                    }

                    $(".lblLoadingMessage").hide();

                }
            });
        }
    });
  
    function LoadComboAdv()
    {
        DynamicRefreshList(_oOrderTypes, "tblOrderTypes");
        DynamicRefreshList(_oFabricPOStatus, "tblCurrentStatuss");
        $("#cboPODate,#cboApproveDate").icsLoadCombo({
            List: _oCompareOperators,
            OptionValue: "id",
            DisplayText: "Value"
        });
    }
    function CheckFromAndToDateValidation(OperationComboId, FromDateId, ToDateId) {
        $("#" + OperationComboId).parent().parent().parent().find("select").removeClass("errorFieldBorder");
        var nCboVal = $("#" + OperationComboId).val();
        if (parseInt(nCboVal) == 5 || parseInt(nCboVal) == 6) {
            var fromDate = $("#" + FromDateId).datebox("getValue");
            var toDate = $("#" + ToDateId).datebox("getValue");
            if (new Date(fromDate) > new Date(toDate)) {
                $("#" + ToDateId).focus();
                $("#" + OperationComboId).addClass("errorFieldBorder");
                $(".lblLoadingMessage").hide();
                return false;
            } else {
                $("#" + OperationComboId).removeClass("errorFieldBorder");
                return true;
            }
        } else {
            return true;
        }
    }

    function ResetAdvSearchWindow() {
        _sContractorIds = '';
        _sBankBranch_IssueIds = "";
        $(".lblLoadingMessage").hide();
        $("#winAdvSearch input").not("input[type='button']").val("");
        $("#winAdvSearch input").removeClass("fontColorOfPickItem");
        $("#winAdvSearch select").val(0);
        DateActions_OPDate();
        DateActions_ApproveDate();
        $("#txtFromPODate,#txtToPODate").datebox({ disabled: true });
        $("#txtFromPODate,#txtToPODate").datebox("setValue", icsdateformat(new Date()));

        $("#txtFromApproveDate,#txtToApproveDate").datebox({ disabled: true });
        $("#txtFromApproveDate,#txtToApproveDate").datebox("setValue", icsdateformat(new Date()));
    }

    function DateActions_OPDate() {
        DynamicDateActions("cboPODate", "txtFromPODate", "txtToPODate");
    }
    function DateActions_ApproveDate() {
        DynamicDateActions("cboApproveDate", "txtFromApproveDate", "txtToApproveDate");
    }


    $("#btnCloseAdvSearch").click(function () {
        $("#winAdvSearch").icsWindow("close");
    });
    $("#btnAdvSearch").click(function () {
        debugger;
        $(".lblLoadingMessage").hide();
        $("#winAdvSearch").icsWindow("open", "Production Request Advance Search");
        //DynamicRefreshList([], "tblExportPIAdvSearch");
        DynamicResetAdvSearchWindow("winAdvSearch");
        ResetAdvSearchWindow();
        LoadComboAdv();
    });

     /// end Adv Searching

    function RefreshSummary()
    {
        var oRows = $('#tblFabricSCReports').datagrid('getRows');
        if(oRows.length>0)
        {
            var nQty = 0,nAmount=0,nQty_DO=0,nStockInHand=0,nQty_DC=0,nQty_DCBal=0;
            for(var i=0;i<oRows.length;i++)
            {
                nQty = parseFloat(nQty)+parseFloat(oRows[i].Qty);
                nAmount = parseFloat(nAmount)+parseFloat(oRows[i].Amount);
                nStockInHand = parseFloat(nStockInHand)+parseFloat(oRows[i].StockInHand);
                nQty_DO = parseFloat(nQty_DO)+parseFloat(oRows[i].Qty_DO);
                nQty_DC = parseFloat(nQty_DC)+parseFloat(oRows[i].Qty_DC);
                nQty_DCBal = parseFloat(nQty_DCBal)+parseFloat(oRows[i].Qty_DCBal);
            }
            nQty = parseFloat(nQty).toFixed(2);
            nAmount = parseFloat(nAmount).toFixed(2);
            debugger
            var oRow =
            {
                ContractorName : 'Total',
                Qty:nQty,
                AmountSt:"$"+nAmount,
                Qty_DO:parseFloat(nQty_DO).toFixed(2),
                StockInHand:parseFloat(nStockInHand).toFixed(2),
                Qty_DC:parseFloat(nQty_DC).toFixed(2),
                Qty_DCBal:parseFloat(nQty_DCBal).toFixed(2)

            }
            $('#tblFabricSCReports').datagrid('appendRow',oRow); 
        } 
    }
 </script>


