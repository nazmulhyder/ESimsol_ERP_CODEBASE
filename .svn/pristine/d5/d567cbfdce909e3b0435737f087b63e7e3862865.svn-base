<html>
<head>
    @{
        ViewBag.Title = "Knitting Order";
    }
</head>
<body>
    @model ESimSol.BusinessObjects.KnittingOrder
    <div id="progressbarParent" style="width:100%;height:100%;margin:0 auto;text-align:center; margin-left: auto;margin-right: auto;left: 0;right: 0;z-index: 1;">
        <div style="margin: 0px auto;margin-top: 251px;text-align:center;width:390px;">
            <label style="font-size:18px;">Please wait</label>
            <div id="progressbar" style="width:100%;height:37px;"></div>
        </div>
    </div>
    <div id="winKnittingOrderDetail" class="easyui-window" title="Knitting Order Detail" style="width:950px;height:320px;padding:4px;" data-options="modal:true,closed:true,collapsible:false,minimizable:false,maximizable:false,closable:false">
        <div style="overflow:hidden;display:block;height:70%">
            <fieldset style="height:100%">
                <legend style="font-weight: bold">Knitting Order Detail Info</legend>
                <div style="overflow:hidden;display:block;">
                    <div style="overflow:hidden;float:left; width:33%">
                        <div style="overflow:hidden;float:left;width:30%;text-align:right">
                            Style:
                        </div>
                        <div style="overflow:hidden;float:left;width:70%">
                            <table border="0" cellpadding="0" cellspacing="0">
                                <tr>
                                    <td style="width:88%">
                                        <input id="txtStyle" type="text" style="float:left;width:100%" onkeydown="StyleKeyDown(event)" />
                                    </td>
                                    <td style="width:10%">
                                        <input type="button" value="P" id="btnPickStyleNo" onclick="PickStyle()" style="width:100%" />
                                    </td>
                                </tr>
                            </table>
                        </div>
                    </div>
                    <div style="overflow:hidden;float:left;  width:33%">
                        <div style="overflow:hidden;float:left;width:30%;text-align:right">
                            Order Recap:
                        </div>
                        <div style="overflow:hidden;float:left;width:70%">
                            <input id="txtOrderRecap" type="text" style="float:left;width:100%" disabled />
                        </div>
                    </div>
                    <div style="overflow:hidden;float:left; width:33%">
                        <div style="overflow:hidden;float:left;width:30%;text-align:right">
                            Buyer:
                        </div>
                        <div style="overflow:hidden;float:left;width:70%">
                            <input id="txtBuyer" type="text" style="float:left;width:100%" disabled />
                        </div>
                    </div>
                </div>

                <div style="overflow:hidden;display:block;padding-top:2px;">
                    <div style="overflow:hidden;float:left; width:33%">
                        <div style="overflow:hidden;float:left;width:30%;text-align:right">
                            Fabric:
                        </div>
                        <div style="overflow:hidden;float:left;width:70%">
                            <input id="txtFabric" type="text" style="float:left;width:100%" disabled /> 
                        </div>
                    </div>
                    <div style="overflow:hidden;float:left;  width:33%">
                        <div style="overflow:hidden;float:left;width:30%;text-align:right">
                            Color:
                        </div>
                        <div style="overflow:hidden;float:left;width:70%">
                            <input id="txtColor" type="text" style="float:left;width:100%" disabled />
                        </div>
                    </div>
                    <div style="overflow:hidden;float:left; width:33%">
                        <div style="overflow:hidden;float:left;width:30%;text-align:right">
                            Order Qty:
                        </div>
                        <div style="overflow:hidden;float:left;width:70%">
                            <input type="text" style="width:70%" id="txtOrderQty" /><select id="cboOrderUnit" style="width:30%;height:22px;"></select>
                        </div>
                    </div>
                </div>

                <div style="overflow:hidden;display:block;padding-top:2px;">
                    <div style="overflow:hidden;float:left;  width:33%">
                        <div style="overflow:hidden;float:left;width:30%;text-align:right">
                            GSM:
                        </div>
                        <div style="overflow:hidden;float:left;width:70%">
                            <input id="txtGSM" type="text" style="float:left;width:100%" disabled />
                        </div>
                    </div>
                    <div style="overflow:hidden;float:left; width:33%">
                        <div style="overflow:hidden;float:left;width:30%;text-align:right">
                            Finish DIA:
                        </div>
                        <div style="overflow:hidden;float:left;width:70%">
                            <input id="txtFinishDIA" type="text" style="float:left;width:100%" disabled />
                        </div>
                    </div>
                    <div style="overflow:hidden;float:left; width:33%">
                        <div style="overflow:hidden;float:left;width:30%;text-align:right">
                            Mic DIA:
                        </div>
                        <div style="overflow:hidden;float:left;width:70%">
                            <table border="0" cellpadding="0" cellspacing="0">
                                <tr>
                                    <td style="width:88%">
                                        <input id="txtMicDia" type="text" style="float:left;width:100%" onkeydown="MicDiaKeyDown(event)" />
                                    </td>
                                    <td style="width:10%">
                                        <input type="button" value="P" id="btnPickMicDia" onclick="PickMicDia()" style="width:100%" />
                                    </td>
                                </tr>
                            </table>
                        </div>
                    </div>
                </div>

                <div style="overflow:hidden;display:block;padding-top:2px;">
                    <div style="overflow:hidden;float:left;  width:33%">
                        <div style="overflow:hidden;float:left;width:30%;text-align:right">
                            PAM:
                        </div>
                        <div style="overflow:hidden;float:left;width:70%">
                            <input id="txtPAM" type="text" style="float:left;width:100%" />
                        </div>
                    </div>
                    <div style="overflow:hidden;float:left; width:33%">
                        <div style="overflow:hidden;float:left;width:30%;text-align:right">
                            Brand:
                        </div>
                        <div style="overflow:hidden;float:left;width:70%">
                            <input id="txtBrand" type="text" style="float:left;width:100%" />
                        </div>
                    </div>
                    <div style="overflow:hidden;float:left; width:33%">
                        <div style="overflow:hidden;float:left;width:30%;text-align:right">
                            Stratch Length:
                        </div>
                        <div style="overflow:hidden;float:left;width:70%">
                            <input id="txtStratchLength" type="text" style="float:left;width:100%" />
                        </div>
                    </div>
                </div>

                <div style="overflow:hidden;display:block;padding-top:2px;">
                    <div style="overflow:hidden;float:left; width:33%">
                        <div style="overflow:hidden;float:left;width:30%;text-align:right">
                            Qty:
                        </div>
                        <div style="overflow:hidden;float:left;width:70%">
                            <input type="text" style="width:70%" id="txtQty" /><select id="cboUnit" style="width:30%;height:22px;"></select>
                        </div>
                    </div>
                    <div style="overflow:hidden;float:left; width:33%">
                        <div style="overflow:hidden;float:left;width:30%;text-align:right">
                            U. Price:
                        </div>
                        <div style="overflow:hidden;float:left;width:70%">
                            <input id="txtUPrice" type="text" style="float:left;width:100%" />
                        </div>
                    </div>
                    <div style="overflow:hidden;float:left;  width:33%">
                        <div style="overflow:hidden;float:left;width:30%;text-align:right">
                            Amount:
                        </div>
                        <div style="overflow:hidden;float:left;width:70%">
                            <input id="txtAmount" type="text" style="float:left;width:100%" disabled />
                        </div>
                    </div>
                    
                </div>

                <div style="overflow:hidden;display:block;padding-top:2px;">
                    <div style="overflow:hidden;float:left; width:33%">
                        <div style="overflow:hidden;float:left;width:30%;text-align:right">
                            Lot No:
                        </div>
                        <div style="overflow:hidden;float:left;width:70%">
                            <input id="txtLotNo" type="text" style="float:left;width:100%" />
                        </div>
                    </div>
                    <div style="overflow:hidden;float:left;  width:67%">
                        <div style="overflow:hidden;float:left;width:15%;text-align:right">
                            Remarks :
                        </div>
                        <div style="overflow:hidden;float:left;width:85%">
                            <input type="text" id="txtRemarksDetail" style="float:left;width:98%;" />
                        </div>
                    </div>
                </div>

            </fieldset>
        </div>
        <fieldset style="width:100%; vertical-align:top;">
            <legend style="font-weight:bold"> Action : </legend>
            <table border="0" cellspacing="2" cellpadding="2" style="font-size:11px; font-weight:bold;width:100%;">
                <tr>
                    <td style="width:80%;text-align:right;"></td>
                    <td style="width:20%;text-align:right;">
                        <a id="btnAddKnittingOrderDetail" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-save" plain="true">Add</a>
                        <a id="btnCloseKnittingOrderDetail" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-cancel" plain="true">Close</a>
                    </td>
                </tr>
            </table>
        </fieldset>
    </div>

    <div class="menuMainCollectionTable">
        <div id="MainDiv" class="easyui-panel" title="" style="font-family:Tahoma;text-align:center;height:90%;">
            <div id="Dashboardtabs" class="easyui-tabs" style="width:100%;height:100%;">

                <div title="Knitting Order" style="font-family:Tahoma;height:99%">
                    <table style="width:100%;">
                        <tr style="width:100%;height:145px;">
                            <td style="width:64%;">
                                <fieldset>
                                    <legend>Knitting Order Info</legend>
                                    <table style="width:95%; margin: 0 auto">
                                        <tr>
                                            <td class="align-right" style="width:10%">Order No</td>
                                            <td style="width:20%">
                                                @Html.TextBoxFor(model => model.OrderNo, new { style = "width: 45%;", id = "txtOrderNo", disabled = "true" })
                                                <span>
                                                    <select id="cboBusinessSession" style="width:49%;height:22px;"></select>
                                                </span>
                                            </td>
                                            <td class="align-right" style="width:10%">Order Dt</td>
                                            <td style="width:20%">
                                                <input type="text" style="width:100%;" id="txtOrderDate" class="easyui-datebox" data-options="formatter:icsdateformat,parser:icsdateparser" />
                                            </td>
                                            <td class="align-right" style="width:15%">Order Type</td>
                                            <td style="width:25%">
                                                <select id="cboOrderType" style="width:100%;height:22px;"></select>
                                            </td>
                                        </tr>
                                        <tr>
                                            <td class="align-right" style="width:10%">Factory </td>
                                            <td style="width:50%" colspan="3">
                                                @Html.TextBoxFor(model => model.FactoryName, new { onkeydown = "FactoryKeyDown(event);", style = "width:80%;", id = "txtFactory", @placeholder = "" })
                                                <input type="button" id="btnFactory" onclick="PickFactory()" style="width:18%;float:right;" value="Pick" />
                                            </td>
                                            <td class="align-right" style="width:15%">Start Dt</td>
                                            <td width="25%">
                                                <input type="text" style="width:100%;" id="txtStartDate" class="easyui-datebox" data-options="formatter:icsdateformat,parser:icsdateparser" />
                                                
                                            </td>
                                        </tr>
                                        <tr>
                                            <td class="align-right" style="width:10%">Approx Dt</td>
                                            <td style="width:20%">
                                                <input type="text" style="width:100%;" id="txtApproxCompleteDate" class="easyui-datebox" data-options="formatter:icsdateformat,parser:icsdateparser" />
                                            </td>
                                            <td class="align-right" style="width:10%">Currency </td>
                                            <td style="width:20%">
                                                <select id="cboCurrency" style="width:100%;height:22px;"></select>
                                            </td>
                                            <td class="align-right" style="width:15%">Remarks:</td>
                                            <td width="25%">
                                                @Html.TextBoxFor(model => model.Remarks, new { style = "width: 100%;", id = "txtRemarks", @placeholder = "", @class = "cls-txt" })

                                            </td>
                                        </tr>
                                        <tr>
                                            <td class="align-right" style="width:10%">Instruction </td>
                                            <td style="width:90%" colspan="5">
                                                @Html.TextBoxFor(model => model.KnittingInstruction, new { style = "width: 100%;", id = "txtKnittingInstruction", @placeholder = "", @class = "cls-txt" })
                                            </td>
                                        </tr>
                                    </table>
                                </fieldset>
                            </td>
                        </tr>
                    </table>
                    <table id="tblKnittingOrderDetail" title="Knitting Order Details" class="easyui-datagrid" style="height:330px; width:100%;" fit="false" fitcolumns="true" rownumbers="true" pagination="false" singleselect="true" autorowheight="false" toolbar="#toolbar" data-options="onClickRow:onClickRow,onEndEdit: onEndEdit" showfooter="true">
                        <thead>
                            <tr>
                                <th field="StyleNo" width="10%" align="left">Style No</th>
                                <th field="OrderQty" width="10%" align="left">Order Qty</th>
                                <th field="OrderUnitName" width="10%" align="left">Order Unit</th>
                                <th field="FabricName" width="15%" align="left">Fabric</th>
                                <th field="ColorName" width="10%" align="left">Color</th>
                                <th field="MUnitName" width="8%" align="left">M. Unit</th>
                                <th data-options="field:'Qty',align:'right',editor:{type:'numberbox',options:{precision:2}}" width="8%">Qty</th>
                                <th data-options="field:'UnitPrice',align:'right',editor:{type:'numberbox',options:{precision:2}}" width="8%">U. Price</th>
                                <th field="Amount" width="8%" align="right">Amount</th>
                                <th data-options="field:'PAM',align:'right',editor:{type:'numberbox',options:{precision:2}}" width="8%">PAM</th>
                                <th data-options="field:'GSM',align:'left'" width="10%">GSM</th>
                                <th data-options="field:'MICDia',align:'left'" width="10%">MIC Dia</th>
                                <th data-options="field:'FinishDia',align:'left'" width="10%">Finish Dia</th>
                                <th data-options="field:'StratchLength',align:'left',editor:{type:'text'}" width="10%">Stratch Length</th>
                                <th data-options="field:'BrandName',align:'left',editor:{type:'text'}" width="10%">Brand</th>
                                <th data-options="field:'LotNo',align:'left',editor:{type:'text'}" width="10%">Lot No</th>
                            </tr>
                        </thead>
                    </table>
                    <div id="toolbar">
                        @*Style : <input type="text" id="txtStyle" style="width:130px;" onkeydown="StyleKeyDown(event)" />
                        <input type="button" id="btnStyle" style="width:25px;" onclick="PickStyle()" value="..." />
                        Order Qty : <input type="text" id="txtOrderQty" style="width:70px;" />
                        Order Unit : <select id="cboOrderUnit" style="width:100px;height:22px;"></select>
                        Fabric : <input type="text" id="txtFabric" style="width:130px;" onkeydown="FabricKeyDown(event)" />
                        <input type="button" id="btnFabric" style="width:25px;" onclick="PickFabric()" value="..." />
                        Color : <input type="text" id="txtColor" style="width:130px;" onkeydown="ColorKeyDown(event)" />
                        <input type="button" id="btnColor" style="width:25px;" onclick="PickColor()" value="..." />
                        Unit : <select id="cboUnit" style="width:100px;height:22px;"></select>
                        Qty : <input type="text" id="txtQty" style="width:70px;" />
                        U. Price : <input type="text" id="txtUPrice" style="width:70px;" />*@
                        <a id="btnAddDetail" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-add" plain="true">Add</a>
                        <a id="btnRemoveDetail" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-remove" plain="true">Remove</a>
                        <a id="btnRefreshDetail" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-reload" plain="true">Refresh</a>

                    </div>
                </div>
                <div id="divTermsAndCondition" title="Terms and conditions" style="font-family:Tahoma;height:99%">
                    <table id="tblTermsAndCondition" class="easyui-datagrid" style="height:100%; width:100%;" fit="false" fitcolumns="true" rownumbers="true" pagination="false" singleselect="true" autorowheight="false" toolbar="#toolbarForTermsAndCondition" data-options="onClickRow:onClickRowTermsAndCondition,onEndEdit: onEndEditTermsAndCondition">
                        <thead>
                            <tr>
                                @*<th data-options="field:'TermsAndCondition',align:'left',editor:{type:'text'}" width="90%">Terms And Condition</th>*@
                                <th field="ClauseTypeSt" width="15%" align="left"> Type </th>
                                <th field="TermsAndCondition" width="80%" align="left" data-options="field:'TermsAndCondition',editor:{type:'text',options:{precision:0}}"> Terms & Condition </th>
                            </tr>
                        </thead>
                    </table>
                    <div id="toolbarForTermsAndCondition">
                        @*<a id="btnAddTermsAndCondition" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-add" plain="true">Add</a>
                        <a id="btnRemoveTermsAndCondition" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-remove" plain="true">Remove</a>
                        <a id="btnRefreshTermsAndCondition" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-reload" plain="true">Refresh</a>*@
                        <input type="button" id="btnPickPOTandC" value="Pick Term And Condition" style="width: 150px; font-size: 12px" />
                        <input type="button" id="btnRemovePOTandC" value="Remove" style="width: 80px; font-size: 12px" />
                        <input type="button" id="btnRefreshPOTandC" value="Refresh" style="width: 80px; font-size: 12px" />

                    </div>
                </div>

            </div>
        </div>

        <fieldset style="height:10%">
            <legend style="font-weight: bold">Action : </legend>
            <table border="0" cellspacing="2" cellpadding="2" style="font-size: 11px; font-weight: bold; width:100%">
                <tr>
                    <td style="width:60%; text-align:right"></td>
                    <td style="width:35%;text-align:right;">
                        <a id="btnSave" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-save" plain="true">Save</a>
                        <a id="btnClose" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-cancel" onclick="Close()" plain="true">Close</a>
                    </td>
                    <td style="width:4%; text-align:right"></td>
                </tr>
            </table>
        </fieldset>
    </div>
</body>
</html>
<style type="text/css">
    td, th {
        padding: 2px;
    }
</style>
<script type="text/javascript">
    var _sBaseAddress = "";
    var _oKnittingOrder = [];
    var TypeList = [];
    var _oKnittingOrderDetails = [];
    var _oKnittingOrderTermsAndConditions = [];
    var _oKnittingYarns = [];
    var _oCurrencys = [];
    var _oBusinessSessions = [];
    var _oKnittingOrderTypes=[];
    $(document).ready(function () {
        debugger;
        _sBaseAddress =@Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(HttpContext.Current.Session[SessionInfo.BaseAddress]));
        _oKnittingOrder =@Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(Model));
        @*TypeList = @Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(ViewBag.EnumType));*@
        _oCurrencys = @Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(ViewBag.Currencys));
        _oBusinessSessions = @Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(ViewBag.BusinessSessions));
        _oKnittingOrderTypes = @Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(ViewBag.EnumKnittingOrderTypes));
        var oMUnits = @Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(ViewBag.MUnits));
        var oMWeightUnits = @Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(ViewBag.MWeightUnits));
        $('#MainDiv').data('MUnits',oMUnits);
        $('#MainDiv').data('MWeightUnits',oMWeightUnits);
        if(sessionStorage.getItem('Action')=='View')
        {
            $('#tblKnittingOrderDetail').data("GridEditable",false);
            $('#btnSave, #toolbar').hide();
        }
        debugger;
        if(parseInt(_oKnittingOrder.KnittingOrderID)>0)
        {
            $('#txtPINo, #txtContractorName').addClass('fontColorOfPickItem');
            _oKnittingOrderDetails = _oKnittingOrder.KnittingOrderDetails;
            //RefreshList(_oKnittingOrderDetails);
            DynamicRefreshList(_oKnittingOrderDetails, "tblKnittingOrderDetail");
            _oKnittingYarns = _oKnittingOrder.KnittingYarns;
            _oKnittingOrderTermsAndConditions = _oKnittingOrder.KnittingOrderTermsAndConditions;
            DynamicRefreshList(_oKnittingOrderTermsAndConditions, "tblTermsAndCondition");
        }

        //LoadType();
        LoadCombos();
        $("#progressbar").progressbar({ value: 0 });
        $("#progressbarParent").hide();

        $('#txtOrderQty,#txtQty,#txtUPrice,#txtAmount,#txtPAM').icsCurrencyBox();
        $('#txtOrderDate').datebox('setValue',_oKnittingOrder.OrderDateInString);
        $('#txtApproxCompleteDate').datebox('setValue',_oKnittingOrder.ApproxCompleteDateInString);
        $('#txtStartDate').datebox('setValue',_oKnittingOrder.StartDateInString);
        $("#MainDiv").data("FabricID",0);
        $("#MainDiv").data("ColorID",0);
        $("#MainDiv").data("KnitDyeingProgramDetail",null);
        $("#MainDiv").data("MicDia",null);
        $.icsMakeFooterColumn('tblKnittingOrderDetail',['StyleNo','Qty','UnitPrice','Amount']);
    });

    
    function LoadType(){
        $("#cboType").icsLoadCombo({
            List:TypeList,
            OptionValue: "id",
            DisplayText: "Value",

        });
        $('#cboType').val(_oKnittingOrder.RequestType);
    }
    function LoadCombos(){
        $("#cboOrderUnit").icsLoadCombo({ List:$('#MainDiv').data('MUnits'), OptionValue: "MeasurementUnitID", DisplayText: "Symbol" });
        $("#cboUnit").icsLoadCombo({ List:$('#MainDiv').data('MWeightUnits'), OptionValue: "MeasurementUnitID", DisplayText: "Symbol" });
        $("#cboCurrency").icsLoadCombo({
            List: _oCurrencys,
            OptionValue: "CurrencyID",
            DisplayText: "CurrencyName"
        });
        $('#cboCurrency').val(_oKnittingOrder.CurrencyID);

        for (var i = 0; i < _oBusinessSessions.length; i++) {
            $('#cboBusinessSession').append(new Option(_oBusinessSessions[i].SessionName, _oBusinessSessions[i].BusinessSessionID));
        }
        $('#cboBusinessSession').val(_oKnittingOrder.BusinessSessionID);

        $("#cboOrderType").icsLoadCombo({
            List: _oKnittingOrderTypes,
            OptionValue: "id",
            DisplayText: "Description"
        });
        $('#cboOrderType').val(_oKnittingOrder.OrderType);
    }

    function StyleKeyDown(event) {
        //return;
        if (event.which == 13) {
            var oTxtName=$("#txtStyle").val();
            if (oTxtName != null) {
                PickStyle(oTxtName);
            }
        }
        if (event.which == 8) {
            txtStyle.style.color="Black";
            $("#MainDiv").data("KnitDyeingProgramDetail",null);
        }
    }
    function PickStyle(oTxtName)
    {
        debugger;
        var oTempObj = {
            StyleNo : oTxtName,
            BUID : sessionStorage.getItem('BUID'),
            ProgramTypeInt:parseInt($('#cboOrderType').val())>2?2:1  //Bulk or Sample
        }

        debugger;
        var obj = {
            BaseAddress:_sBaseAddress,
            Object: (oTempObj) ,
            ControllerName: "KnitDyeingProgram",
            ActionName: "GetsProgramDetails",
            IsWinClose: false
        };
        var tblColums = []; var oColumn = { field: "RefObjectNo", title: "Recap/PAM No", width: 100, align: "left" }; tblColums.push(oColumn);
        oColumn = { field: "StyleNo", title: "Style No", width: 140, align: "left" }; tblColums.push(oColumn);
        oColumn = { field: "BuyerName", title: "Buyer Name", width: 140, align: "left" }; tblColums.push(oColumn);
        oColumn = { field: "TotalGarmentsQtySt", title: "Order Qty", width: 80, align: "right" }; tblColums.push(oColumn);
        oColumn = { field: "CompositionName", title: "Composition", width: 100, align: "left" }; tblColums.push(oColumn);
        oColumn = { field: "ColorName", title: "Color", width: 100, align: "left" }; tblColums.push(oColumn);
        oColumn = { field: "FabricTypeName", title: "Fabric Type", width: 100, align: "left" }; tblColums.push(oColumn);
        oColumn = { field: "GSMName", title: "GSM", width: 70, align: "left" }; tblColums.push(oColumn);
        oColumn = { field: "FinishDiaName", title: "Finish Dia", width: 70, align: "left" }; tblColums.push(oColumn);        
        oColumn = { field: "ReqFabricQty", title: "Req. Fabric Qty", width: 90, align: "right" }; tblColums.push(oColumn);
        oColumn = { field: "YetReqFabricQty", title: "Yet to Knitting", width: 90, align: "right" }; tblColums.push(oColumn);
        DynamicPiker('Style',obj,tblColums,false,'StyleNo','KnitDyeingProgramID',1150); //pickerName(unique),obj,table,multiReturn,SearchingField, pkID
    }

    function SetStyle(oSelectedStyle) {
        debugger;
        document.getElementById("txtStyle").value = oSelectedStyle.StyleNo;
        $("#MainDiv").data("KnitDyeingProgramDetail",oSelectedStyle);
        //txtStyle.style.color="Blue";
        $("#txtOrderRecap").val(oSelectedStyle.RefObjectNo);
        $("#txtBuyer").val(oSelectedStyle.BuyerName);
        $("#txtFabric").val(oSelectedStyle.FabricTypeName);
        $("#txtColor").val(oSelectedStyle.ColorName);
        $("#txtOrderQty").val(oSelectedStyle.GarmentsQty);
        $("#txtGSM").val(oSelectedStyle.GSMName);
        $("#txtFinishDIA").val(oSelectedStyle.FinishDiaName);
        $("#txtMicDia").val("");
        $("#txtPAM").val(0);
        $("#txtBrand").val("");
        $("#txtStratchLength").val("");
        $("#txtQty").val(oSelectedStyle.YetReqFabricQty);
        $("#txtUPrice").val(0);
        $("#txtAmount").val(0);
        $("#txtlotNo").val("");
        $("#txtRemarksDetail").val("");

        $("#cboOrderUnit").val(oSelectedStyle.GarmentsMUnitID);
        $("#cboUnit").val(oSelectedStyle.MUnitID);
    }
    function FabricKeyDown(event) {
        //return;
        if (event.which == 13) {
            var oTxtName=$("#txtFabric").val();
            if (oTxtName != null) {
                PickFabric(oTxtName);
            }
        }
        if (event.which == 8) {
            txtFabric.style.color="Black";
            $("#MainDiv").data("FabricID",0);
        }
    }

    function PickFabric(oTxtName)
    {
        debugger;
        var oStyleSearch = {
            BUID:sessionStorage.getItem("BUID"),
            ProductName: $("#txtFabric").val()
        };

        debugger;
        var obj = {
            BaseAddress:_sBaseAddress,
            Object: (oStyleSearch) ,
            ControllerName: "KnittingOrder", //Product
            ActionName: "GetFabricCategory",//SearchByProductBUWise
            IsWinClose: false
        };
        var tblColums = []; var oColumn = []; var oColumn = { field: "ProductName", title: "Product Name", width: 150, align: "left" }; tblColums.push(oColumn);
        oColumn = { field: "ProductCode", title: "Code", width: 150, align: "left" }; tblColums.push(oColumn);
        DynamicPiker('Fabric',obj,tblColums,false,'ProductName','ProductID',500); //pickerName(unique),obj,table,multiReturn,SearchingField, pkID
    }

    function SetFabric(oSelectedStyle) {
        debugger;
        document.getElementById("txtFabric").value = oSelectedStyle.ProductName;
        $("#MainDiv").data("FabricID",oSelectedStyle.ProductID);
        txtFabric.style.color="Blue";
        //$('#cboUnit').val(oSelectedStyle.MeasurementUnitID);
        var oProduct = {
            ProductID: oSelectedStyle.ProductID
        }
        $.ajax({
            type: "POST",
            dataType: "json",
            url : _sBaseAddress+"/MeasurementUnit/GetsMUnits",
            traditional: true,
            data:  JSON.stringify(oProduct),
            contentType: "application/json; charset=utf-8",
            success: function (data) {
                //debugger;
                var oMUs = jQuery.parseJSON(data);
                if (oMUs.length > 0) {
                    $("#cboUnit").icsLoadCombo({
                        List:oMUs,
                        OptionValue: "MeasurementUnitID",
                        DisplayText: "UnitName",

                    });

                }
                else {
                    alert("Data not found!!");
                }
            },
            error: function (xhr, status, error) {
                alert(error);
            }

        });
    }
    
    function MicDiaKeyDown(event) {
        //return;
        if (event.which == 13) {
            var oTxtName=$("#txtMicDia").val();
            if (oTxtName != null) {
                PickMicDia(oTxtName);
            }
        }
        if (event.which == 8) {
            txtMicDia.style.color="Black";
            $("#MainDiv").data("MicDia",null);
        }
    }
    
    function SetMicDia(oSelectedStyle) {
        debugger;
        document.getElementById("txtMicDia").value = oSelectedStyle.SourcingConfigHeadName;
        $("#MainDiv").data("MicDia",oSelectedStyle);
    }

    function PickMicDia(oTxtName)
    {
        debugger;
        var oGSMSearch = { SourcingConfigHeadName:oTxtName,SourcingConfigHeadType:4};
        debugger;
        var obj = {
            BaseAddress:_sBaseAddress,
            Object: (oGSMSearch) ,
            ControllerName: "KnitDyeingProgram",
            ActionName: "GSMSearch",
            IsWinClose: false
        };
        var tblColums = []; var oColumn = { field: "SourcingConfigHeadName", title: "Name", width: 200, align: "left" }; tblColums.push(oColumn);
        DynamicPiker('MicDia',obj,tblColums,false,'SourcingConfigHeadName','SourcingConfigHeadID',300); //pickerName(unique),obj,table,multiReturn,SearchingField, pkID
    }


    function ColorKeyDown(event) {
        //return;
        if (event.which == 13) {
            var oTxtName=$("#txtColor").val();
            if (oTxtName != null) {
                PickColor(oTxtName);
            }
        }
        if (event.which == 8) {
            $("#MainDiv").data("ColorID",0);
            txtColor.style.color="Black";
        }
    }

    function PickColor(oTxtName)
    {
        var oStyleSearch = {
            ColorName:$("#txtColor").val()

        };

        console.log(oStyleSearch);
        debugger;
        var obj = {
            BaseAddress:_sBaseAddress,
            Object: (oStyleSearch) ,
            ControllerName: "ColorCategory", //TechnicalSheet
            ActionName: "getColorByColorName",//ViewStyleSearch
            IsWinClose: false
        };
        var tblColums = []; var oColumn = []; var oColumn = { field: "ColorName", title: "Color Name", width: 200, align: "left" }; tblColums.push(oColumn);
        //oColumn = { field: "Name", title: "Name", width: 280, align: "left" }; tblColums.push(oColumn);
        DynamicPiker('Color',obj,tblColums,false,'ColorName','ColorCategoryID',400); //pickerName(unique),obj,table,multiReturn,SearchingField, pkID
    }

    function SetColor(oSelectedStyle) {
        debugger;
        console.log(document.getElementById("txtColor").innerHTML);
        document.getElementById("txtColor").value = oSelectedStyle.ColorName;
        $("#MainDiv").data("ColorID",oSelectedStyle.ColorCategoryID);
        txtColor.style.color="Blue";
    }


    function FactoryKeyDown(event) {
        //return;
        if (event.which == 13) {
            var oTxtName=$("#txtFactory").val();
            if (oTxtName != null) {
                PickFactory(oTxtName);
            }
        }
        if (event.which == 8) {
            _oKnittingOrder.FactoryID = 0;
            txtFactory.style.color="Black";
        }
    }

    function PickFactory(oTxtName)
    {
        var oStyleSearch = {
            ColorName:(typeof(oTxtName) != 'undefined'?oTxtName:""),
            Params: '1,3' + '~' + (typeof(oTxtName) != 'undefined'?oTxtName:"")+'~'+sessionStorage.getItem("BUID")
        };

        console.log(oStyleSearch);
        debugger;
        var obj = {
            BaseAddress:_sBaseAddress,
            Object: (oStyleSearch) ,
            ControllerName: "Contractor", //
            ActionName: "ContractorSearchByNameType",//
            IsWinClose: false
        };
        var tblColums = []; var oColumn = { field: "Name", title: "Name", width: 200, align: "left" }; tblColums.push(oColumn);
        oColumn = { field: "Address", title: "Address", width: 120, align: "left" }; tblColums.push(oColumn);
        oColumn = { field: "Email", title: "Email", width: 90, align: "left" }; tblColums.push(oColumn);
        oColumn = { field: "ShortName", title: "Short Name", width: 90, align: "left" }; tblColums.push(oColumn);
        DynamicPiker('Factory',obj,tblColums,false,'Name','ContractorID',600); //pickerName(unique),obj,table,multiReturn,SearchingField, pkID
    }

    function SetFactory(oSelectedStyle) {
        debugger;
        document.getElementById("txtFactory").value = oSelectedStyle.Name;
        //$("#MainDiv").data("FactoryID",oSelectedStyle.ContractorID);
        _oKnittingOrder.FactoryID = oSelectedStyle.ContractorID;
        txtFactory.style.color="Blue";
    }

    $("#btnPickPOTandC").click(function () {
        var oPOTandCSetup = {BUID:sessionStorage.getItem("BUID") };
        var obj = {
            BaseAddress: _sBaseAddress,
            Object: oPOTandCSetup,
            ControllerName: "POTandCSetup",
            ActionName: "Gets",
            IsWinClose: false
        };

        var tblColums = []; var oColumn = { field: "ClauseAndType", title: "Term and Condition", width: 490, align: "left" }; tblColums.push(oColumn);
        DynamicPiker('POTandCSetupPicker',obj,tblColums,true,'NameCode','POTandCSetupID',500); //pickerName(unique),obj,table,multiReturn,SearchingField, pkID

    });

    function SavePOTnC(oPOTandCSetups)
    {
        if (oPOTandCSetups != null && oPOTandCSetups.length > 0)
        {
            var oPOTandCClauses = $('#tblTermsAndCondition').datagrid('getRows');
            if (oPOTandCSetups.length > 0)
            {
                for (var i = 0; i < oPOTandCSetups.length; i++)
                {
                    if(!ExistTAndC(oPOTandCSetups[i].ClauseType, oPOTandCSetups[i].Clause,oPOTandCClauses))
                    {
                        var oPOTandCClausesTemp = {
                            POTandCClauseID: 0,
                            POID: 0,
                            ClauseType:oPOTandCSetups[i].ClauseType,
                            ClauseTypeSt:oPOTandCSetups[i].ClauseTypeSt,
                            TermsAndCondition: oPOTandCSetups[i].Clause
                        };
                        $('#tblTermsAndCondition').datagrid('appendRow', oPOTandCClausesTemp);
                    }

                }

            }

        }
    }

    function ExistTAndC(nClauseType,sClause, oPOTandCClauses )
    {
        if(oPOTandCClauses==null || oPOTandCClauses.length<0)
        {
            return false;
        }
        for(var i = 0;i<oPOTandCClauses.length;i++)
        {
            if(parseInt(oPOTandCClauses[i].ClauseType)== parseInt(nClauseType) && oPOTandCClauses[i].TermsAndCondition == sClause)
            {
                return true;
            }
        }
        return false;
    }

    function SetPickerValueAssign(oPickerobj)
    {
        debugger;
        var oResult;
        if (oPickerobj.multiplereturn)
        {
            oResult = $('#'+oPickerobj.tableid).datagrid('getChecked');
        }
        else
        {
            oResult = $('#'+oPickerobj.tableid).datagrid('getSelected');
        }


        if (oPickerobj.winid == 'winFactory')
        {
            SetFactory(oResult);
        }
        else if (oPickerobj.winid == 'winFabric')
        {
            SetFabric(oResult);
        }
        else if (oPickerobj.winid == 'winColor')
        {
            SetColor(oResult);
        }
        else if (oPickerobj.winid == 'winStyle')
        {
            SetStyle(oResult);
        }
        else if (oPickerobj.winid == 'winPOTandCSetupPicker')
        {
            if (oResult!=null && oResult.length > 0) {
                SavePOTnC(oResult);
            }
        }
        else if (oPickerobj.winid == 'winMicDia')
        {
            SetMicDia(oResult);
        }
        

        $("#" + oPickerobj.winid).icsWindow("close");
        $("#" + oPickerobj.winid).remove();
    }

    function updateProgress() {
        var value =$('#progressbar').progressbar('getValue');
        if (value < 90){
            value += Math.floor(Math.random() * 10);
            $('#progressbar').progressbar('setValue', value);
        }
    }
    ////
    function hideShow(miliseconds) {
        $("#progressbarParent").hide();
    }
    /////
    function DynamicPiker(pickerName,obj,pTblColums,pMultiReturn,pSearchField,pID,nWidth)
    {
        $("#progressbar").progressbar({ value: 0 });
        $("#progressbarParent").show();
        setInterval(updateProgress,250);

        $.icsDataGets(obj, function (response) {
            if (response.status && response.objs.length > 0) {
                if (response.objs[0][pID] > 0) {
                    var tblColums = pTblColums;
                    var oPickerParam = {
                        winid: 'win'+pickerName,
                        winclass: 'cls'+pickerName,
                        winwidth: nWidth,
                        winheight: 460,
                        tableid: 'tbl'+pickerName+'s',
                        tablecolumns: tblColums,
                        datalist: response.objs,
                        multiplereturn: pMultiReturn,
                        searchingbyfieldName: pSearchField,
                        windowTittle: pickerName+' List',
                        colsable:true
                    };
                    $.icsPicker(oPickerParam);
                    $("#progressbar").progressbar({ value: 0 });//hide
                    $("#progressbarParent").hide();
                    IntializePickerbutton(oPickerParam);
                }
                else {
                    alert(response.objs[0].ErrorMessage);
                    $("#progressbar").progressbar({ value: 0 });//hide
                    $("#progressbarParent").hide();
                }
            }
            else{
                alert("Data Not Found.");
                $("#progressbar").progressbar({ value: 0 });//hide
                $("#progressbarParent").hide();
                return;
            }
        });
    }
    ////
    function IntializePickerbutton(oPickerobj) {
        $("#" + oPickerobj.winid).find("#btnOk").click(function () {
            debugger;
            //for Single Select
            SetPickerValueAssign(oPickerobj);
        });
        $(document).find('.' + oPickerobj.winclass).keydown(function (e) {
            if (e.which == 13)//enter=13
            {
                SetPickerValueAssign(oPickerobj);
            }
        });
    }


    function RefreshList(oKnittingOrderDetails)
    {
        debugger;
        var data=oKnittingOrderDetails;
        data={"total":""+data.length+"","rows":data};
        $('#tblKnittingOrderDetail').datagrid('loadData',data);
    }


    function Validation(){

        if(parseInt(sessionStorage.getItem("BUID"))<=0)
        {
            alert('No business unit found.');
            return false;
        }

        if($("#txtOrderDate").datebox('getValue') == '' || $("#txtOrderDate").datebox('getValue') == null){
            alert('Please Enter Order date!!');
            $("#txtOrderDate").focus();
            return false;
        }

        if(parseInt($("#cboBusinessSession").val())<=0)
        {
            $('#cboBusinessSession').focus();
            alert("Please Select Business Session!!");
            return false;
        }
        if(parseInt($("#cboOrderType").val())<=0)
        {
            $('#cboOrderType').focus();
            alert("Please Select Order Type!!");
            return false;
        }
        if(_oKnittingOrder.FactoryID<=0)
        {
            $('#txtFactory').focus();
            alert("Please Enter Factory!!");
            return false;
        }
        if($("#txtApproxCompleteDate").datebox('getValue') == '' || $("#txtApproxCompleteDate").datebox('getValue') == null){
            alert('Please Enter Approx Complete Date!!');
            $("#txtApproxCompleteDate").focus();
            return false;
        }
        if($("#txtStartDate").datebox('getValue') == '' || $("#txtStartDate").datebox('getValue') == null){
            alert('Please Enter Start Date!!');
            $("#txtStartDate").focus();
            return false;
        }
        if(parseInt($("#cboCurrency").val())<=0)
        {
            $('#cboCurrency').focus();
            alert("Please Select Currency!!");
            return false;
        }
        if($("#txtKnittingInstruction").val() == "" && $("#txtKnittingInstruction").val() == null)
        {
            $('#txtKnittingInstruction').focus();
            alert("Please Enter Knitting Instruction!!");
            return false;
        }



        var oRows=$('#tblKnittingOrderDetail').datagrid('getRows');
        if(oRows.length<=0){
            alert("Atleast onen Knitting Order detail required!!");
            return false;
        }

        var oTermsAndConditions=$('#tblTermsAndCondition').datagrid('getRows');
        if(oTermsAndConditions.length<=0){
            alert("Atleast onen Terms and Condition required!!");
            $('#tblTermsAndCondition').tabs('select');
            return false;
        }

        return true;
    }

    function RefreshObject()
    {
        debugger;
        var oRows=$('#tblKnittingOrderDetail').datagrid('getRows');
        var nAmount = 0;
        var nIssueQty = 0;
        for(var i=0;i<oRows.length;i++){
            nAmount += oRows[i].Amount;
            nIssueQty += oRows[i].Qty;
            oRows[i].PAM = parseFloat(oRows[i].PAM);
        }
        var oKnittingOrder={
            KnittingOrderID : _oKnittingOrder.KnittingOrderID,
            BUID : parseInt(sessionStorage.getItem("BUID")),
            OrderNo : $('#txtOrderNo').val(),
            OrderDate:$('#txtOrderDate').datebox('getValue'),
            BusinessSessionID:$("#cboBusinessSession").val(),
            FactoryID : _oKnittingOrder.FactoryID,
            ApproxCompleteDate : $('#txtApproxCompleteDate').datebox('getValue'),
            StartDate : $('#txtStartDate').datebox('getValue'),
            CurrencyID:$("#cboCurrency").val(),
            Remarks : $.trim($('#txtRemarks').val()),
            KnittingInstruction: $.trim($('#txtKnittingInstruction').val()),
            Amount: nAmount,
            IssueQty: nIssueQty,
            KnittingOrderDetails: oRows,
            KnittingOrderTermsAndConditions: $('#tblTermsAndCondition').datagrid('getRows'),
            OrderType:$("#cboOrderType").val()
        };

        return oKnittingOrder;
    }

    $("#btnSave").click(function (){
        debugger;
        endEditing();
        endEditingTermsAndCondition();
        if(!Validation()) return false;
        var oKnittingOrder=RefreshObject();
        //return;
        $("#progressbar").progressbar({ value: 0 });
        $("#progressbarParent").show();
        var intervalID = setInterval(updateProgress, 250);
        $.ajax({
            type: "POST",
            dataType: "json",
            url : _sBaseAddress+"/KnittingOrder/Save",
            traditional: true,
            data:  JSON.stringify(oKnittingOrder),
            contentType: "application/json; charset=utf-8",
            success: function (data) {
                debugger;
                oKnittingOrder = jQuery.parseJSON(data);
                clearInterval(intervalID);
                $("#progressbarParent").hide();
                if (oKnittingOrder.ErrorMessage==null || oKnittingOrder.ErrorMessage=="") {
                    alert("Data Saved successfully");
                    var oKnittingOrders = sessionStorage.getItem("KnittingOrders");
                    var nIndex = parseInt(sessionStorage.getItem("SelectedRowIndex"));
                    if (oKnittingOrders != null) {
                        oKnittingOrders = jQuery.parseJSON(oKnittingOrders);
                    }
                    else
                    {
                        oKnittingOrders = [];
                    }
                    if (nIndex != -1)
                    {
                        oKnittingOrders[nIndex] = oKnittingOrder;
                    }
                    else
                    {
                        sessionStorage.setItem("SelectedRowIndex", oKnittingOrders.length);
                        oKnittingOrders.push(oKnittingOrder);
                    }
                    sessionStorage.setItem("KnittingOrders", JSON.stringify(oKnittingOrders));
                    window.location.href = sessionStorage.getItem("BackLink");
                }
                else {
                    alert(oKnittingOrder.ErrorMessage);
                }
            },
            error: function (xhr, status, error) {
                alert(error);
            }

        });
    });

    $('#txtQty,#txtUPrice').keyup(function(){
        var nUPrice = parseFloat(TempRemoveComma($('#txtUPrice').val()));
        var nQty = parseFloat(TempRemoveComma($('#txtQty').val()));
        $('#txtAmount').val(nUPrice*nQty);
    });

    function ResetDetail(){
        $("#txtStyle").val("");
        $("#txtOrderRecap").val("");
        $("#txtBuyer").val("");
        $("#txtFabric").val("");
        $("#txtColor").val("");
        $("#txtOrderQty").val(0);
        $("#txtGSM").val("");
        $("#txtFinishDIA").val("");
        $("#txtMicDia").val("");
        $("#txtPAM").val(0);
        $("#txtBrand").val("");
        $("#txtStratchLength").val("");
        $("#txtQty").val(0);
        $("#txtUPrice").val(0);
        $("#txtAmount").val(0);
        $("#txtlotNo").val("");
        $("#txtRemarksDetail").val("");

        $("#cboOrderUnit").val(0);
        $("#cboUnit").val(0);
        $("#MainDiv").data("KnitDyeingProgramDetail",null);
        $("#MainDiv").data("MicDia",null);
    }

    $("#btnAddDetail").click(function ()
    {
        debugger;        
        $("#winKnittingOrderDetail input").not("input[type='button']").val("");
        ResetDetail();
        $.icsMakeFooterColumn('tblKnittingOrderDetail',['StyleNo','Qty','UnitPrice','Amount']);
        $("#winKnittingOrderDetail").icsWindow('open', "Knitting Order Detail");
    });

    $('#btnCloseKnittingOrderDetail').click(function(e){
        $("#winKnittingOrderDetail").icsWindow('close');
    });

    $("#btnAddKnittingOrderDetail").click(function ()
    {
        debugger;
        if($("#MainDiv").data("KnitDyeingProgramDetail") == null){
            alert("No Knit Dyeing Program Found!");
            $("#txtStyle").focus();
            return;
        }

        if(parseInt($("#MainDiv").data("KnitDyeingProgramDetail").KnitDyeingProgramDetailID) <= 0){
            alert("No Knit Dyeing Program Found!");
            $("#txtStyle").focus();
            return;
        }
        if(parseInt($("#MainDiv").data("KnitDyeingProgramDetail").StyleID) <= 0){
            alert("No Style Found!");
            $("#txtStyle").focus();
            return;
        }
        if(parseInt($("#cboOrderUnit").val()) <= 0){
            alert("Please enter Order Unit!!");
            $("#cboOrderUnit").focus();
            return;
        }
        if(parseInt($("#txtOrderQty").val()) <= 0){
            alert("Please enter Order Qty!!");
            $("#txtOrderQty").focus();
            return;
        }
        if(parseInt($("#MainDiv").data("KnitDyeingProgramDetail").CompositionID) <= 0){
            alert("No Fabric Found!");
            $("#txtStyle").focus();
            return;
        }
        if(parseInt($("#MainDiv").data("KnitDyeingProgramDetail").ColorID) <= 0){
            alert("No Color Found!");
            $("#txtStyle").focus();
            return;
        }
        if(parseInt($("#cboUnit").val()) <= 0){
            alert("Please enter M. Unit!!");
            $("#cboUnit").focus();
            return;
        }
        if(parseFloat(TempRemoveComma($('#txtQty').val())) <= 0){
            alert("Please enter Qty!!");
            $("#txtQty").focus();
            return;
        }
        if(parseFloat(TempRemoveComma($('#txtUPrice').val())) <= 0){
            alert("Please enter Unit Price!!");
            $("#txtUPrice").focus();
            return;
        }

        if($("#MainDiv").data("MicDia") == null){
            alert("No Mic Dia Found!");
            $("#txtMicDia").focus();
            return;
        }

        if(parseFloat($("#MainDiv").data("KnitDyeingProgramDetail").YetReqFabricQty) < parseFloat(TempRemoveComma($('#txtQty').val()))){
            alert("Qty can not be greater than Yet Qty: "+$("#MainDiv").data("KnitDyeingProgramDetail").YetReqFabricQty+" !");
            $("#txtQty").focus();
            return;
        }

        var oDetails = $('#tblKnittingOrderDetail').datagrid('getRows');
        for(var i=0;i<oDetails.length;i++){
            if(parseInt(oDetails[i].KnitDyeingProgramDetailID) == parseInt(parseInt($("#MainDiv").data("KnitDyeingProgramDetail").KnitDyeingProgramDetailID))){
                alert("One detail already exist with this Style, Fabric and Color!!");
                return;
            }
        }

        var oKnittingOrderDetail={
            KnittingOrderDetailID: 0,
            KnitDyeingProgramDetailID: parseInt(parseInt($("#MainDiv").data("KnitDyeingProgramDetail").KnitDyeingProgramDetailID)),
            StyleID: parseInt(parseInt($("#MainDiv").data("KnitDyeingProgramDetail").StyleID)),
            OrderUnitID: parseInt($("#cboOrderUnit").val()),
            OrderUnitName: $("#cboOrderUnit option:selected").text(),
            OrderQty: parseFloat(TempRemoveComma($('#txtOrderQty').val())),
            StyleNo: $("#txtStyle").val(),
            FabricID: parseInt(parseInt($("#MainDiv").data("KnitDyeingProgramDetail").FabricTypeID)),
            FabricName:  $("#txtFabric").val(),
            ColorID: parseInt(parseInt($("#MainDiv").data("KnitDyeingProgramDetail").ColorID)),
            ColorName: $("#txtColor").val(),
            MUnitID:parseInt($("#cboUnit").val()),
            MUnitName: $("#cboUnit option:selected").text(),
            Qty: parseFloat(TempRemoveComma($('#txtQty').val())),
            UnitPrice: parseFloat(TempRemoveComma($('#txtUPrice').val())),
            Amount: parseFloat(TempRemoveComma($('#txtQty').val())) * parseFloat(TempRemoveComma($('#txtUPrice').val())),
            PAM: parseFloat(TempRemoveComma($('#txtPAM').val())),
            GSMID: parseInt(parseInt($("#MainDiv").data("KnitDyeingProgramDetail").GSMID)),
            MICDiaID: parseInt(parseInt($("#MainDiv").data("MicDia").SourcingConfigHeadID)),
            FinishDiaID: parseInt(parseInt($("#MainDiv").data("KnitDyeingProgramDetail").FinishDiaID)),
            GSM: $("#txtGSM").val(),
            MICDia: $("#txtMicDia").val(),
            FinishDia: $("#txtFinishDIA").val(),
            StratchLength: $("#txtStratchLength").val(),
            LotNo: $("#txtLotNo").val(),
            BrandName: $("#txtBrand").val(),
            Remarks: $("#txtRemarksDetail").val(),
        };

        $('#tblKnittingOrderDetail').datagrid('appendRow',oKnittingOrderDetail);
        $.icsMakeFooterColumn('tblKnittingOrderDetail',['StyleNo','Qty','UnitPrice','Amount']);
        $("#winKnittingOrderDetail").icsWindow('close');
        ResetDetail();
    });

    $("#btnRemoveDetail").click(function ()
    {
        endEditing();
        var oKnittingOrderDetail=$('#tblKnittingOrderDetail').datagrid('getSelected');
        if(oKnittingOrderDetail==null)
        {
            alert("Please select a valid item from list.");
            return;
        }
        var nIndex= $('#tblKnittingOrderDetail').datagrid('getRowIndex',oKnittingOrderDetail);
        $('#tblKnittingOrderDetail').datagrid('deleteRow',nIndex);
        $.icsMakeFooterColumn('tblKnittingOrderDetail',['StyleNo','Qty','UnitPrice','Amount']);
    });
    $("#btnRefreshDetail").click(function ()
    {
        endEditing();
        var data= $('#tblKnittingOrderDetail').datagrid('getRows');
        data={"total":""+data.length+"","rows":data};
        $('#tblKnittingOrderDetail').datagrid('loadData',data);
    });

    $('#btnClose').click(function(e){
        window.location.href = sessionStorage.getItem("BackLink");
    })

    function TempRemoveComma(userInput) {
        //debugger;
        var amountInString = "";
        if (userInput === null || userInput === "") {
            amountInString = "0.00";
        }
        else {
            amountInString = "";
            for (var i = 0; i < userInput.length; i++) {
                var char = userInput.charAt(i);
                var charForCheck = char;
                char = char.match(/\d+/g);
                if (char != null) {
                    amountInString = amountInString + userInput.charAt(i);
                    count = 1;
                }
                else if (charForCheck == ",") {
                    continue;
                }
                else if (charForCheck == ".") {
                    amountInString = amountInString + userInput.charAt(i);
                }
            }
        }
        //debugger;
        return (isNaN(parseFloat(amountInString)) ? parseFloat(0.00) : parseFloat(amountInString)).toFixed(3);
    }

    var editIndex = undefined;
    function endEditing() {
        //debugger;
        if (editIndex == undefined) { return true }
        if ($('#tblKnittingOrderDetail').datagrid('validateRow', editIndex)) {
            $('#tblKnittingOrderDetail').datagrid('endEdit', editIndex);
            //RefreshSummery();
            //$('#tblKnittingOrderDetail').datagrid('selectRow', editIndex);
            //var oKOD = $('#tblKnittingOrderDetail').datagrid('getSelected');
            //var nIndex = $('#tblKnittingOrderDetail').datagrid('getRowIndex', oKOD);

            editIndex = undefined;
            return true;
        }
        else {
            return false;
        }
    }

    function onClickRow(index) {
        debugger;
        if (editIndex != index) {
            if (endEditing()) {
                $('#tblKnittingOrderDetail').datagrid('selectRow', index).datagrid('beginEdit', index);
                editIndex = index;
            }
            else {
                $('#tblKnittingOrderDetail').datagrid('selectRow', editIndex);
            }
        }
    }

    function onEndEdit(index, row) {
        debugger;
        row.Amount = parseFloat(row.Qty) * parseFloat(row.UnitPrice);
        $('#tblKnittingOrderDetail').datagrid('updateRow',{index:index, row : row});
        $.icsMakeFooterColumn('tblKnittingOrderDetail',['StyleNo','Qty','UnitPrice','Amount']);
    }


    var editIndexTermsAndCondition = undefined;
    function endEditingTermsAndCondition() {
        //debugger;
        if (editIndexTermsAndCondition == undefined) { return true }
        if ($('#tblTermsAndCondition').datagrid('validateRow', editIndexTermsAndCondition)) {
            $('#tblTermsAndCondition').datagrid('endEdit', editIndexTermsAndCondition);
            //RefreshSummery();
            editIndexTermsAndCondition = undefined;
            return true;
        }
        else {
            return false;
        }
    }

    function onClickRowTermsAndCondition(index) {
        debugger;
        if (editIndexTermsAndCondition != index) {
            if (endEditingTermsAndCondition()) {
                $('#tblTermsAndCondition').datagrid('selectRow', index).datagrid('beginEdit', index);
                editIndexTermsAndCondition = index;
            }
            else {
                $('#tblTermsAndCondition').datagrid('selectRow', editIndexTermsAndCondition);
            }
        }
    }

    function onEndEditTermsAndCondition(index, row) {
        debugger;
    }


    $("#btnRemovePOTandC").click(function (e) {
        var oPOTandCClauses = $('#tblTermsAndCondition').datagrid('getSelected');
        if(oPOTandCClauses==null)
        {
            alert("Please select a item from list!");
            return;
        }
        if (!confirm("Confirm to Delete?")) return ;
        var SelectedRowIndex=$('#tblTermsAndCondition').datagrid('getRowIndex',oPOTandCClauses);
        alert("Delete sucessfully");
        $('#tblTermsAndCondition').datagrid('deleteRow',SelectedRowIndex);
        var oPOTandCClauses = $('#tblTermsAndCondition').datagrid('getRows');
        DynamicRefreshList(oPOTandCClauses, "tblTermsAndCondition");
    });

    $("#btnRefreshPOTandC").click(function (e) {
        endEditingTermsAndCondition();
        var oPOTandCClauses = $('#tblTermsAndCondition').datagrid('getRows');
        DynamicRefreshList(oPOTandCClauses, "tblTermsAndCondition");
    });

</script>