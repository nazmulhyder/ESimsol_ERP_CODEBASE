@model IEnumerable<ESimSol.BusinessObjects.LabDipReport>
    @{
        ViewBag.Title = "Lab Dip Order Register";
    }
   
 <div id="progressbarParent" style="width:100%;height:100%;margin:0 auto;text-align:center; margin-left: auto;margin-right: auto;left: 0;right: 0;z-index: 1;">
                          <div style="margin: 0px auto;margin-top: 251px;text-align:center;width:390px;">
                              <label style="font-size:18px;">Please wait</label>
                              <div id="progressbar" style="width:100%;height:37px;"></div>
                          </div>
                      </div>
 
 <div class="menuMainCollectionTable">
     <table id="tblLabDipReports" title="LabDip(s)" class="easyui-datagrid" style="width: 100%; height:100%; margin: 0;" data-options="singleSelect: true,fitColumns:false, rownumbers:true, pagination:false, autoRowHeight:false, toolbar: '#toolbarLabDipReport' ">
         <thead>
             <tr>
                 <th field="OrderDateStr" width="9%">Issue Date</th>
                 <th field="LabdipNo" width="8%"><label id="lblLabdipNo">Labdip No</label></th>
                 <th field="ContractorName" width="15%">Buyer Name</th>
                 <th field="EndBuyer" width="12%">End Buyer</th>
                 <th field="ProductName" width="20%" align="left">Yarn</th>
                 <th field="NoOfColor" width="6%" align="center">NoOfColor</th>
                 <th field="ContractorCPName" width="12%">Buyer Concern Person</th>
                 <th field="OrderStatusStr" width="14%">Status</th>
                 <th field="SeekingDateStr" width="9%">Requirement Date</th>
                 @*<th field="DeliveryToName" width="15%">Delivered To</th>*@
                 <th field="MktPerson" width="12%">Concern Person</th>
                 <th field="DeliveyDateStr" width="9%">Delivey Date</th>
                 <th field="TwistedStr" width="8%">Twisted</th>
                 <th field="PriorityLevelStr" width="8%">Priority</th>
                 <th field="OrderReferenceTypeStr" width="8%">Source</th>
                 @*<th field="ColorNo" width="10%" align="center">Color No</th>
                    <th field="ColorName" width="8%" align="center">Color Name</th>
                    <th field="PantonNo" width="9%" align="center">Panton No</th>
                    <th field="RGB" width="6%" align="center">Kint Style</th>
                    <th field="ColorSet" width="6%" align="center">Color Set</th>
                    <th field="ShadeCount" width="6%" align="center">Shade</th>
                    <th field="Gauge" width="6%" align="center">Gauge</th>
                    <th field="KnitPlyYarnSt" width="8%" align="center">Knit Ply</th>
                    <th field="RefNo" width="9%" align="center">Remarks</th>
                    <th field="Note" width="9%" align="center">Note</th>
                    <th field="DeliveyDate_LabStr" width="9%">Delivey Date</th>*@


             </tr>
         </thead>
     </table>
   
     <div id="toolbarLabDipReport">
         <input id="txtSearchByLabdipNo" type="text" placeholder="Search by Labdip No" style="width: 100px" />
         <input type="text" id="txtSearchByColorNo" placeholder="Search by Color No" style="width:120px;text-align:left" />
         @*<input id="txtStartDate" type="text" style="width: 95px;" class="easyui-datebox" required="required" data-options="formatter:icsdateformat,parser:icsdateparser" />
         <a id="btnSearchByDate" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-search" plain="true">Search</a>*@
         <a id="btnAdvSearch" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-search" plain="true">Adv. Search</a>
         <a id="btnPrintShowDetail" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-print" plain="true">History Detail</a>
         <a id="btnPrint" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-print" plain="true">Print Preview</a>
         <a id="btnExcel" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-excel" plain="true">Print Excel</a>

         

        
     </div>
 </div>
  <div id="winAdvSearch" class="easyui-window winClass" title="Adv. Search" data-options="modal:true,closed:true,collapsible:false,minimizable:false,maximizable:false,closable:false">
                          <table style="width:100%;">
                              <tr>
                                  <td>
                                      <fieldset style="margin-bottom: 0px;">
                                          <legend>Searching Criteria</legend>
                                          <table>
                                              <tr>
                                                  <td style=" width:20%;text-align:right;">
                                                      <label>Issue To </label>
                                                  </td>
                                                  <td colspan="3" style=" width:80%;text-align:left;">
                                                      <input id="txtContractorAdvS" style="width:75%;" type="text" placeholder="Type & Press Enter" />
                                                      <a id="btnPickContractorAdvS" href="javascript:void(0)" class="easyui-linkbutton ics-pick" iconcls="icon-pick" plain="true"></a>
                                                      <a id="btnClrContractorAdvS" href="javascript:void(0)" class="easyui-linkbutton ics-pick" iconcls="icon-clear" plain="true"></a>

                                                  </td>
                                              </tr>
                                              <tr>
                                                  <td style=" width:20%;text-align:right;">
                                                      <label>Deliver To </label>
                                                  </td>
                                                  <td colspan="3" style=" width:80%;text-align:left;">
                                                      <input id="txtDeliverToAdvS" style="width:75%;" type="text" placeholder="Type & Press Enter" />
                                                      <a id="btnPickDeliverToAdvS" href="javascript:void(0)" class="easyui-linkbutton ics-pick" iconcls="icon-pick" plain="true"></a>
                                                      <a id="btnClrDeliverToAdvS" href="javascript:void(0)" class="easyui-linkbutton ics-pick" iconcls="icon-clear" plain="true"></a>
                                                  </td>
                                              </tr>
                                              <tr>
                                                  <td style=" width:20%;text-align:right;">
                                                      <label>Yarn </label>
                                                  </td>
                                                  <td colspan="3" style=" width:80%;text-align:left;">
                                                      <input id="txtProductName" style="width:75%;" type="text" placeholder="Type & Press Enter" />
                                                      <a id="btnProductPiker" href="javascript:void(0)" class="easyui-linkbutton ics-pick" iconcls="icon-pick" plain="true"></a>
                                                      <a id="btnClrProductPiker" href="javascript:void(0)" class="easyui-linkbutton ics-pick" iconcls="icon-clear" plain="true"></a>
                                                  </td>
                                              </tr>
                                              <tr>
                                                  <td style=" width:20%;text-align:right;">
                                                      <label>Order Date </label>
                                                  </td>
                                                  <td colspan="3">
                                                      <select id="cboOrderDateAdvS" style="width:30%;" onchange="DateActionsOrderDateAdvSearch();"></select>
                                                      <input id="txtFromOrderDateAdvSearch" type="text" style="width: 100px;" class="easyui-datebox" required="required" data-options="formatter:icsdateformat,parser:icsdateparser" />To
                                                      <input id="txtToOrderDateAdvSearch" type="text" style="width: 100px;" class="easyui-datebox" required="required" data-options="formatter:icsdateformat,parser:icsdateparser" />
                                                  </td>
                                              </tr>
                                              <tr>
                                                  <td style=" width:20%;text-align:right;">
                                                      <label>Requirement Date </label>
                                                  </td>
                                                  <td colspan="3">
                                                      <select id="cboSeekingDateAdvSearch" style="width:30%;" onchange=" DateActionsInvoiceDateAdvSearch(); "></select>
                                                      <input id="txtFromSeekingDate" type="text" style="width: 100px;" class="easyui-datebox" required="required" data-options="formatter:icsdateformat,parser:icsdateparser" />To
                                                      <input id="txtToSeekingDate" type="text" style="width: 100px;" class="easyui-datebox" required="required" data-options="formatter:icsdateformat,parser:icsdateparser" />
                                                  </td>
                                              </tr>
                                             
                                              <tr>
                                                  <td style=" width:20%;text-align:right;">
                                                      <label>Concern Person </label>
                                                  </td>
                                                  <td colspan="3" style=" width:80%;text-align:left;">
                                                      <select id="cboMkPersonAdvSearch" style="width:100%;"></select>
                                                  </td>
                                              </tr>
                                              <tr>
                                                  <td style=" width:20%;text-align:right;">
                                                      <label>Buyer Concern </label>
                                                  </td>
                                                  <td colspan="3" style=" width:80%;text-align:left;">
                                                      <input id="txtContactPersonnel" style="width:75%;" type="text" placeholder="Type & Press Enter" />
                                                      <a id="btnPickContactPersonnel" href="javascript:void(0)" class="easyui-linkbutton ics-pick" iconcls="icon-pick" plain="true"></a>
                                                      <a id="btnClrContactPersonnel" href="javascript:void(0)" class="easyui-linkbutton ics-pick" iconcls="icon-clear" plain="true"></a>

                                                  </td>
                                              </tr>
                                              <tr>
                                                  <td style=" width:20%;text-align:right;">
                                                      <label id="lblLabdipNoAdv">Labdip No </label>
                                                  </td>
                                                  <td style=" width:30%;text-align:left;">
                                                      <input id="txtLabdipNo" type="text" style="width:100%" />
                                                  </td>
                                                  <td style=" width:20%;text-align:right;">
                                                      <label id="lblColorNoAdv">Color No </label>
                                                  </td>
                                                  <td style=" width:30%;text-align:left;">
                                                      <input id="txtColorNo" type="text" style="width:95%" />
                                                  </td>
                                              </tr>
                                              <tr>
                                                  <td style=" width:20%;text-align:right;">
                                                      <label>Color Name </label>
                                                  </td>
                                                  <td style=" width:30%;text-align:left;">
                                                      <input id="txtColorName" type="text" style="width:100%" />
                                                  </td>
                                                  <td style=" width:20%;text-align:right;">
                                                      <label>Panton No </label>
                                                  </td>
                                                  <td style=" width:30%;text-align:left;">
                                                      <input id="txtPantonNo" type="text" style="width:95%" />
                                                  </td>
                                              </tr>
                                              <tr>
                                                  <td style=" width:20%;text-align:right; ">
                                                      Labdip Status 
                                                  </td>
                                                  <td colspan="3" style=" width:80%;text-align:left;">
                                                      <table id="tblOrderStatus" class="easyui-datagrid" style="height:130px;" fitcolumn="true" rownumbers="true" pagination="false" multiselect="true" autorowheight="false">
                                                          <thead>
                                                              <tr>
                                                                  <th data-options="field:'Selected',checkbox:true"> </th>
                                                                  <th field="Value" width="80%">Status</th>
                                                              </tr>
                                                          </thead>

                                                      </table>
                                                  </td>
                                              </tr>
                                              <tr>
                                                  <td style=" width:20%;text-align:right;">
                                                      <label>Status Date </label>
                                                  </td>
                                                  <td colspan="3">
                                                      <select id="cboStatusDateAdvS" style="width:30%;" onchange=" DateActionsDeliveryDateAdvSearch(); "></select>
                                                      <input id="txtFromStatusDate" type="text" style="width: 100px;" class="easyui-datebox" required="required" data-options="formatter:icsdateformat,parser:icsdateparser" />To
                                                      <input id="txtToStatusDate" type="text" style="width: 100px;" class="easyui-datebox" required="required" data-options="formatter:icsdateformat,parser:icsdateparser" />
                                                  </td>
                                              </tr>
                                              <tr>
                                                  <td height="5px" colspan="4"></td>
                                              </tr>
                                           
                                          </table>
                                      </fieldset>
                                  </td>
                              </tr>
                          </table>

                          <fieldset class="actionfieldsetstyle">
                              <legend>Actions : </legend>
                              <label class="lblLoadingMessage" style="float: left;">Loading Please Wait...</label>
                              <a id="btnPrintSummary" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-print" plain="true">Preview(Summary)</a>
                              <a id="btnPrintTwo" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-print" plain="true">Preview</a>
                              <a id="btnExcelTwo" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-excel" plain="true">XL</a>
                              <a id="btnResetAdvSearch" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-reload" plain="true">Reset</a>
                              <a id="btnSearchAdvSearch" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-search" plain="true">Search</a>
                              <a id="btnCloseAdvSearch" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-cancel" plain="true">Close</a>
                          </fieldset>
                      </div>
 <style type="text/css">
    .lines-no .datagrid-body td {
        border-right: 1px dotted transparent;
        border-bottom: 1px dotted transparent;
    }
 
</style>

 <script type="text/javascript">
    var _sBaseAddress="";
    var _oLabDipReport=null;
    var _oLabDipReports=[];
    var _oCompanys=[];
    var _oCompareOperators=[];
    var _oMktPersons=[];

    var _sControllerName="";
    var _nBUID = 0;
    var _sContractorIds = '';
    var _sBuyerIDsAdvSearch = '';
    var _oBU = null;
    var _oLightSources=[];
    var _oLabdipFormats=[];
    var _oLabdipStatus=[];
    var _sProductIds="";
    var _sCPersonnelIds="";
    $(document).ready(function () {

        _sBaseAddress =@Html.Raw( new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(HttpContext.Current.Session[SessionInfo.BaseAddress]));
        _oLabDipReports =@Html.Raw( new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(Model));
        _oCompareOperators = @Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(ViewBag.CompareOperators));
        @*_nBUID = @Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(ViewBag.BUID));*@
        _oMktPersons = @Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(ViewBag.MktPersons));
        _oLightSources=@Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(@ViewBag.LightSources));
        _oLabdipFormats=@Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(@ViewBag.LabdipFormats));
        _oLabdipStatus=@Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(@ViewBag.LabdipStatus));
        var oLabDipSetup =@Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(@ViewBag.LabDipSetup));
        LabdipSetup(oLabDipSetup);
        debugger;
        $("#tblCurrentStatusAdvSearch").datagrid("checkAll");
        $("#progressbar").progressbar({ value: 0 });
        $("#progressbarParent").hide();
        $(".lblLoadingMessage").hide();
        LoadComboAdv();
        debugger;
        RefreshDate()
    });

    $(document).keydown(function (e) { if (e.keyCode == 27) { $('div').icsWindow('close'); } });

    function LabdipSetup(oLabDipSetup)
    {
        $('#lblLabdipNo,#lblLabdipNoAdv').html(oLabDipSetup.OrderName);
        $('#lblColorNoAdv').html(oLabDipSetup.ColorNoName);
        $("#txtSearchByLabdipNo").attr("placeholder", "Search By "+oLabDipSetup.OrderName);
        $("#txtSearchByColorNo").attr("placeholder","Search by "+oLabDipSetup.ColorNoName);
    }

    function RefreshDate()
    {
        $('#txtStartDate').datebox('setValue', icsdateformat(new Date()));
    }


    $("#btnPrint").click(function () {

        var sParams=sessionStorage.getItem("ParamsLD");
        window.open(_sBaseAddress + '/LabDipReport/Print_LabdipReportReport_Product?sTempString=' + sParams, "_blank");
    });
    $("#btnPartyWisePrint").click(function () {
        var sParams=sessionStorage.getItem("ParamsLD");
        window.open(_sBaseAddress + '/LabDipReport/Print_PartyWiseSOReport_Product?sTempString=' + sParams, "_blank");
    });
    $("#btnProductWisePrint").click(function () {

        var sParams=sessionStorage.getItem("ParamsLD");
        window.open(_sBaseAddress + '/LabDipReport/Print_ProductWiseSOReport_Product?sTempString=' + sParams, "_blank");
    });

    $("#btnExcel").click(function () {

        var sParams=sessionStorage.getItem("ParamsLD");
        window.open(_sBaseAddress + '/LabDipReport/PrintExcel_LabdipReportReport_Product?sTempString=' + sParams, "_blank");
    });
    $("#btnPrintSummary").click(function () {

        var sParams=GetsSearch();
        window.open(_sBaseAddress + '/LabDipReport/Print_LabdipReportReport_Summary?sTempString=' + sParams, "_blank");
        $(".lblLoadingMessage").hide();
    });
    $("#btnPrintTwo").click(function () {

        var sParams=GetsSearch();
        window.open(_sBaseAddress + '/LabDipReport/Print_LabdipReportReport_Product?sTempString=' + sParams, "_blank");
        $(".lblLoadingMessage").hide();
    });
    $("#btnExcelTwo").click(function () {

        var sParams=GetsSearch();
        window.open(_sBaseAddress + '/LabDipReport/PrintExcel_LabdipReportReport_Product?sTempString=' + sParams, "_blank");
        $(".lblLoadingMessage").hide();
    });

    ////Start adv Searching

    function updateProgress() {
        var value =$('#progressbar').progressbar('getValue');
        if (value < 96){
            value += Math.floor(Math.random() * 10);
            $('#progressbar').progressbar('setValue', value);
        }
    }
    function hideShow(miliseconds) {
        $("#progressbarParent").hide();
    }
    //Account Of Picker

    $("#txtContractorAdvS").keydown(function (e) {
        if (e.keyCode === 13) // Enter Press
        {
            PickContractors_AdvS();
        }
        else if (e.keyCode === 08) {
            $("#txtContractorAdvS").removeClass("fontColorOfPickItem");
            _sContractorIds = '';
        }
    });

    $("#btnClrContractorAdvS").click(function () {
        $("#txtContractorAdvS").removeClass("fontColorOfPickItem");
        $("#txtContractorAdvS").val("");
        _sContractorIds = '';
    });

    $("#btnPickContractorAdvS").click(function () {
        PickContractors_AdvS();
    });
    $("#txtSearchByAccountNamePickerAdvSearch").keydown(function (e) {
        var obj = {
            Event: e,
            SearchProperty: "Name",
            GlobalObjectList: _oAccountsOf,
            TableId: "tblAccountsPickerAdvSearch"
        };
        $('#txtSearchByAccountNamePickerAdvSearch').icsSearchByText(obj);
    });
    //End Account Of Picker
    $("#txtDeliverToAdvS").keydown(function (e) {
        if (e.keyCode === 13) // Enter Press
        {
            PickDeliverTo_AdvS();
        }
        else if (e.keyCode === 08) {
            $("#txtDeliverToAdvS").removeClass("fontColorOfPickItem");
            _sDeliverToIDs ="";
        }
    });

    $("#btnClrDeliverToAdvS").click(function () {
        $("#txtDeliverToAdvS").removeClass("fontColorOfPickItem");
        $("#txtDeliverToAdvS").val("");
        _sDeliverToIDs ="";
    });

    $("#btnPickDeliverToAdvS").click(function () {
        PickDeliverTo_AdvS();
    });

    //Product Pick
    $("#txtProductName").keydown(function (e) {
        debugger;
        var code = (e.keyCode ? e.keyCode : e.which);
        if (code == 13) // Enter Press
        {
            if($('#txtProductName').val()==null || $('#txtProductName').val()=="")
            {
                alert("Please Type Product and Press Enter.");
                $('#txtProductName').focus();
                return;
            }
            PickProduct($('#txtProductName').val());
        }
        if (code == 8) //backspace=8
        {
            //debugger;
            $("#txtProductName").removeClass("fontColorOfPickItem");
            _sProductIds= [];
        }
    });
    $("#btnProductPiker").click(function () {
        PickProduct("");
    });
    $("#btnClrProductPiker").click(function () {
        $("#txtProductName").val('');
        $("#txtProductName").removeClass("fontColorOfPickItem");
        _sProductIds= [];
    });
    function PickProduct(sProductName)
    {
        var oProduct = { BUID:sessionStorage.getItem("BUID"),ProductName:sProductName};
        var obj = {
            BaseAddress: _sBaseAddress,
            Object: oProduct,
            ControllerName: "Product",
            ActionName: "SearchByProductBUWise",
            IsWinClose: false
        };
        $.icsDataGets(obj, function (response) {
            debugger;
            if (response.status && response.objs.length > 0) {
                if (response.objs[0].ProductID > 0) {
                    var tblColums = [];
                    var oColumn = { field: "ProductCode", title: "Code", width: 100, align: "left" }; tblColums.push(oColumn);
                    oColumn = { field: "ProductName", title: "Name", width: 300, align: "left" }; tblColums.push(oColumn);
                    oColumn = { field: "MUnit", title: "Unit", width: 70, align: "left" }; tblColums.push(oColumn);
                    var oPickerParam = {
                        winid: 'winProductPicker',
                        winclass: 'clsProductPicker',
                        winwidth: 600,
                        winheight: 460,
                        tableid: 'tblProductPicker',
                        tablecolumns: tblColums,
                        datalist: response.objs,
                        multiplereturn: true,
                        searchingbyfieldName: 'NameCode',
                        windowTittle: 'Product List'
                    };
                    $.icsPicker(oPickerParam);
                    IntializePickerbutton(oPickerParam);
                }
                else {
                    alert(response.objs[0].ErrorMessage);
                }

            }else{
                alert("Data Not Found.");
            }
        });
    }


     //End Buyer Search

    //// Con Person Search
    $("#txtContactPersonnel").keydown(function (e) {
        if (e.keyCode === 13) // Enter Press
        {
            if($.trim($("#txtContactPersonnel").val())==null || $.trim($("#txtContactPersonnel").val())=="")
            {
                alert("Please select at least one Buyer, or Type name or part Name!");
                return false;
            }

            PickCPersonnel();
        }
        else if (e.keyCode === 08) {
            $("#txtContactPersonnel").removeClass("fontColorOfPickItem");
            _sCPersonnelIds = '';
        }
    });

    $("#btnClrContactPersonnel").click(function () {
        $("#txtContactPersonnel").removeClass("fontColorOfPickItem");
        $("#txtContactPersonnel").val("");
        _sCPersonnelIds = '';
    });

    $("#btnPickContactPersonnel").click(function () {

        if(_sContractorIds === ""&& _sDeliverToIDs === "" && $.trim($("#txtContactPersonnel").val())=="")
        {
            alert("Please select at least one Buyer, or Type name or part Name!");
            return false;
        }

        PickCPersonnel();
    });
    function PickCPersonnel() {

        var sContractorID='';
        if(_sContractorIds.length>0)
        {
            sContractorID=_sContractorIds;
        }
        else if(_sContractorIds.length>0 && _sDeliverToIDs.length>0)
        {
            sContractorID=_sContractorIds+','+_sDeliverToIDs;
        }
        else if(_sContractorIds.length<0 && _sDeliverToIDs.length>0)
        {
            sContractorID=_sDeliverToIDs;
        }

        var oContactPersonnel = { ContractorName:sContractorID,Name:$.trim($("#txtContactPersonnel").val())};
        var obj = {
            BaseAddress: _sBaseAddress,
            Object: oContactPersonnel,
            ControllerName: "ContractorPersonal",
            ActionName: "GetsByContractors",
            IsWinClose: false
        };

        $("#progressbar").progressbar({ value: 0 });
        $("#progressbarParent").show();
        var intervalID = setInterval(updateProgress, 250);

        DynamicRefreshList([], "tblAccountsPickerAdvSearch");
        $.icsDataGets(obj, function (response) {
            clearInterval(intervalID);
            $("#progressbarParent").hide();
            if (response.status && response.objs.length > 0) {
                if (response.objs[0].ContactPersonnelID > 0)
                {
                    var tblColums = [];var oColumn ={};
                    oColumn= { field: "ContactPersonnelID", title: "Code", width: 60, align: "left" }; tblColums.push(oColumn);
                    oColumn = { field: "Name", title: "Name", width: 180, align: "left" }; tblColums.push(oColumn);
                    oColumn = { field: "ContractorName", title: "ContractorName", width: 150, align: "left" }; tblColums.push(oColumn);
                    var oPickerParam = {
                        winid: 'winCPersonPicker',
                        winclass: 'clsCPersinPicker',
                        winwidth: 600,
                        winheight: 460,
                        tableid: 'tblCPersonPicker',
                        tablecolumns: tblColums,
                        datalist: response.objs,
                        multiplereturn: true,
                        searchingbyfieldName: 'Name',
                        windowTittle: 'Person List'
                    };
                    $.icsPicker(oPickerParam);
                    IntializePickerbutton(oPickerParam);//multiple return
                }
                else {
                    alert("Data Not Found");
                }
            }
            else {
                alert("Data Not Found.");
            }
        });
    }

    /////

    $("#btnResetAdvSearch").click(function () {
        ResetAdvSearchWindow();
        DateActionsOrderDateAdvSearch();
        DateActionsInvoiceDateAdvSearch();
        DateActionsDeliveryDateAdvSearch();
        DateActionsStatusDateAdvSearch();
        $('#tblOrderStatus').datagrid('uncheckAll');
    });
    function GetsSearch(){
        $(".lblLoadingMessage").show();

        var checkDate = CheckFromAndToDateValidation("cboOrderDateAdvS", "txtFromOrderDateAdvSearch", "txtToOrderDateAdvSearch");
        if (!checkDate) {
            alert("Start date must be greater than end date.");
            return false;
        }
        checkDate = CheckFromAndToDateValidation("cboSeekingDateAdvSearch", "txtFromOrderDateAdvSearch", "txtToSeekingDate");
        if (!checkDate) {
            alert("Start date must be greater than end date.");
            return false;
        }
        checkDate = CheckFromAndToDateValidation("cboStatusDateAdvS", "txtFromStatusDate", "txtToStatusDate");
        if (!checkDate) {
            alert("Start date must be greater than end date.");
            return false;
        }


        //var nContractorID = parseInt(_sContractorIds);
        //var nBuyerID = parseInt(_sDeliverToIDs);
        var nCboOrderDate = parseInt($("#cboOrderDateAdvS").val());
        var dFromOrderDate = $('#txtFromOrderDateAdvSearch').datebox('getValue');
        var dToOrderDate = $('#txtToOrderDateAdvSearch').datebox('getValue');

        var ncboSeekingDate = parseInt($("#cboSeekingDateAdvSearch").val());
        var dFromSeekingDate = $('#txtFromSeekingDate').datebox('getValue');
        var dToSeekingDate = $('#txtToSeekingDate').datebox('getValue');

        var ncboStatusDate = parseInt($("#cboStatusDateAdvS").val());
        var dFromStatusDate = $('#txtFromStatusDate').datebox('getValue');
        var dToStatusDate = $('#txtToStatusDate').datebox('getValue');
        var nCboMkPerson = parseInt($("#cboMkPersonAdvSearch").val());

        var sColorNo = $.trim($("#txtColorNo").val());
        var sLabdipNo = $.trim($("#txtLabdipNo").val());
        var sColorName = $.trim($("#txtColorName").val());
        var sPantonNo = $.trim($("#txtPantonNo").val());

        var sStatus =GetOrderStatus();
        var sParams =
                      _sContractorIds + "~" +
                      _sDeliverToIDs + "~" +
                      _sProductIds+"~"+
                      nCboOrderDate + "~" +
                      dFromOrderDate + "~" +
                      dToOrderDate + "~" +
                      ncboSeekingDate + "~" +
                      dFromSeekingDate + "~" +
                      dToSeekingDate + "~" +
                       ncboStatusDate + "~" +
                      dFromStatusDate + "~" +
                      dToStatusDate + "~" +
                      nCboMkPerson + "~" +
                      sStatus+"~"+
                      sLabdipNo+"~"+
                      sColorNo+"~"+
                      sColorName+"~"+
                      sPantonNo+"~"+
                      _sCPersonnelIds+"~"+
                      _nBUID;
        sessionStorage.setItem("ParamsLD", sParams);
       
        return sParams;
    }
    $("#btnSearchAdvSearch").click(function () {
        debugger;

     
        var sParams=GetsSearch();
        var oLabDipReport = {
            ErrorMessage : sParams
        };

        $.ajax({
            type: "POST",
            dataType: "json",
            url: _sBaseAddress + "/LabDipReport/AdvSearch_Product",
            traditional: true,
            data: JSON.stringify(oLabDipReport),
            contentType: "application/json; charset=utf-8",
            success: function (data) {
                var oLabDipReports = data;
                debugger;
                if (oLabDipReports != null) {
                    if (oLabDipReports.length > 0)
                    {

                        DynamicRefreshList(oLabDipReports, "tblLabDipReports");
                        $("#winAdvSearch").icsWindow("close");

                    }
                    else
                    {
                        alert("Sorry, No data found.");
                        DynamicRefreshList([], "tblLabDipReports");
                    }

                } else {
                    alert("Sorry, No data found.");
                    DynamicRefreshList([], "tblLabDipReports");
                }
                $(".lblLoadingMessage").hide();
            }
        });
    });
    function GetOrderStatus(){

        var sOrderStatus="";

        var oOrderStatus=$('#tblOrderStatus').datagrid('getChecked');

        if(oOrderStatus.length>0){
            for(var i=0;i<oOrderStatus.length;i++){
                sOrderStatus= sOrderStatus + oOrderStatus[i].id+","
            }
            sOrderStatus=sOrderStatus.substring(0,sOrderStatus.length-1);
        }
        return sOrderStatus;
    }
    $("#btnSearchByDate").click(function () {
        //var nBuyerID = parseInt(_sDeliverToIDs);
        _sProductIds='';
        _sContractorIds='';
        _sDeliverToIDs='';
        debugger;
        var nCboOrderDate = 1;
        var dFromOrderDate = $('#txtStartDate').datebox('getValue');
        var dToOrderDate = $('#txtStartDate').datebox('getValue');

        var ncboSeekingDate = 0;
        var dFromSeekingDate = $('#txtStartDate').datebox('getValue');
        var dToSeekingDate = $('#txtStartDate').datebox('getValue');

        var ncboStatusDate = 0;
        var dFromStatusDate = $('#txtStartDate').datebox('getValue');
        var dToStatusDate = $('#txtStartDate').datebox('getValue');

        var nCboMkPerson = 0;
        var sColorNo = "";
        var sLabdipNo = "";
        var sColorName ="";
        var sPantonNo = "";
        var sStatus ='';

        var sParams =
                       _sContractorIds + "~" +
                       _sDeliverToIDs + "~" +
                       _sProductIds+"~"+
                       nCboOrderDate + "~" +
                       dFromOrderDate + "~" +
                       dToOrderDate + "~" +
                       ncboSeekingDate + "~" +
                       dFromSeekingDate + "~" +
                       dToSeekingDate + "~" +
                        ncboStatusDate + "~" +
                       dFromStatusDate + "~" +
                       dToStatusDate + "~" +
                       nCboMkPerson + "~" +
                       sStatus+"~"+
                       sLabdipNo+"~"+
                       sColorNo+"~"+
                       sColorName+"~"+
                       sPantonNo+"~"+
                       _sCPersonnelIds+"~"+
                       _nBUID;
        sessionStorage.setItem("ParamsLD", sParams);
        var oLabDipReport = {
            ErrorMessage : sParams
        };
        Search(oLabDipReport);
    });
    $("#txtSearchByLabdipNo").keydown(function (e) {
        var nkeyCode = e.keyCode || e.which;
        if(nkeyCode==13){

            _sProductIds='';
            _sContractorIds='';
            _sDeliverToIDs='';
            debugger;
            var nCboOrderDate = 0;
            var dFromOrderDate = icsdateformat(new Date());
            var dToOrderDate = icsdateformat(new Date());

            var ncboSeekingDate = 0;
            var dFromSeekingDate = icsdateformat(new Date());
            var dToSeekingDate =icsdateformat(new Date());

            var ncboStatusDate = 0;
            var dFromStatusDate = icsdateformat(new Date());
            var dToStatusDate = icsdateformat(new Date());

            var nCboMkPerson = 0;
            var sColorNo = "";
            var sLabdipNo =  $.trim($("#txtSearchByLabdipNo").val());
            var sColorName ="";
            var sPantonNo = "";
            var sStatus ='';

            var sParams =
                           _sContractorIds + "~" +
                           _sDeliverToIDs + "~" +
                           _sProductIds+"~"+
                           nCboOrderDate + "~" +
                           dFromOrderDate + "~" +
                           dToOrderDate + "~" +
                           ncboSeekingDate + "~" +
                           dFromSeekingDate + "~" +
                           dToSeekingDate + "~" +
                            ncboStatusDate + "~" +
                           dFromStatusDate + "~" +
                           dToStatusDate + "~" +
                           nCboMkPerson + "~" +
                           sStatus+"~"+
                           sLabdipNo+"~"+
                           sColorNo+"~"+
                           sColorName+"~"+
                           sPantonNo+"~"+
                           _sCPersonnelIds+"~"+
                           _nBUID;
            sessionStorage.setItem("ParamsLD", sParams);

            var oLabDipReport = {
                ErrorMessage : sParams
            };
            Search(oLabDipReport);
        }
        else if(nkeyCode==8){
            $("#txtSearchByLabdipNo").val("");

        }
    });
    $("#txtSearchByColorNo").keydown(function (e) {
        var nkeyCode = e.keyCode || e.which;
        if(nkeyCode==13){

            _sProductIds='';
            _sContractorIds='';
            _sDeliverToIDs='';
            debugger;
            var nCboOrderDate = 0;
            var dFromOrderDate = icsdateformat(new Date());
            var dToOrderDate = icsdateformat(new Date());

            var ncboSeekingDate = 0;
            var dFromSeekingDate =icsdateformat(new Date());
            var dToSeekingDate = icsdateformat(new Date());

            var ncboStatusDate = 0;
            var dFromStatusDate =icsdateformat(new Date());
            var dToStatusDate = icsdateformat(new Date());

            var nCboMkPerson = 0;
            var sColorNo =  $.trim($("#txtSearchByColorNo").val());
            var sLabdipNo = "";
            var sColorName ="";
            var sPantonNo = "";
            var sStatus ='';

            var sParams =
                           _sContractorIds + "~" +
                           _sDeliverToIDs + "~" +
                           _sProductIds+"~"+
                           nCboOrderDate + "~" +
                           dFromOrderDate + "~" +
                           dToOrderDate + "~" +
                           ncboSeekingDate + "~" +
                           dFromSeekingDate + "~" +
                           dToSeekingDate + "~" +
                            ncboStatusDate + "~" +
                           dFromStatusDate + "~" +
                           dToStatusDate + "~" +
                           nCboMkPerson + "~" +
                           sStatus+"~"+
                           sLabdipNo+"~"+
                           sColorNo+"~"+
                           sColorName+"~"+
                           sPantonNo+"~"+
                           _sCPersonnelIds+"~"+
                           _nBUID;
            sessionStorage.setItem("ParamsLD", sParams);
            var oLabDipReport = {
                ErrorMessage : sParams
            };
            Search(oLabDipReport);
        }
        else if(nkeyCode==8){
            $("#txtSearchByLabdipNo").val("");

        }
    });

    function Search(oLabDipReport)
    {

        $.ajax({
            type: "POST",
            dataType: "json",
            url: _sBaseAddress + "/LabDipReport/AdvSearch_Product",
            traditional: true,
            data: JSON.stringify(oLabDipReport),
            contentType: "application/json; charset=utf-8",
            success: function (data) {
                var oLabDipReports = data;
                debugger;
                if (oLabDipReports != null) {
                    if (oLabDipReports.length > 0)
                    {
                        DynamicRefreshList(oLabDipReports, "tblLabDipReports");
                        $("#winAdvSearch").icsWindow("close");
                    }
                    else
                    {
                        alert("Sorry, No data found.");
                        DynamicRefreshList([], "tblLabDipReports");
                    }

                } else {
                    alert("Sorry, No data found.");
                    DynamicRefreshList([], "tblLabDipReports");
                }
                $(".lblLoadingMessage").hide();
            }
        });
    }
    function LoadComboAdv()
    {
        DynamicRefreshList(_oLabdipStatus, 'tblOrderStatus');

        $("#cboOrderDateAdvS, #cboSeekingDateAdvSearch, #cboStatusDateAdvS").icsLoadCombo({
            List: _oCompareOperators,
            OptionValue: "id",
            DisplayText: "Value"
        });
        $("#cboMkPersonAdvSearch").icsLoadCombo({
            List: _oMktPersons,
            OptionValue: "MarketingAccountID",
            DisplayText: "Name"
        });
    }
    function CheckFromAndToDateValidation(OperationComboId, FromDateId, ToDateId) {
        $("#" + OperationComboId).parent().parent().parent().find("select").removeClass("errorFieldBorder");
        var nCboVal = $("#" + OperationComboId).val();
        if (parseInt(nCboVal) == 5 || parseInt(nCboVal) == 6) {
            var fromDate = $("#" + FromDateId).datebox("getValue");
            var toDate = $("#" + ToDateId).datebox("getValue");
            if (new Date(fromDate) > new Date(toDate)) {
                $("#" + ToDateId).focus();
                $("#" + OperationComboId).addClass("errorFieldBorder");
                $(".lblLoadingMessage").hide();
                return false;
            } else {
                $("#" + OperationComboId).removeClass("errorFieldBorder");
                return true;
            }
        } else {
            return true;
        }
    }

    function ResetAdvSearchWindow() {
        _sContractorIds = '';
        _sDeliverToIDs = "";
        _sCPersonnelIds="";
        _sProductIds="";
        $("#winAdvSearch input").not("input[type='button']").val("");
        $("#winAdvSearch input").removeClass("fontColorOfPickItem");
        $("#winAdvSearch select").val(0);
        DateActionsOrderDateAdvSearch();
        DateActionsInvoiceDateAdvSearch();
        DateActionsDeliveryDateAdvSearch();
        $("#txtFromOrderDateAdvSearch,#txtToOrderDateAdvSearch,#txtFromSeekingDate,#txtToSeekingDate,#txtFromStatusDate,#txtToStatusDate").datebox({ disabled: true });
        $("#txtFromOrderDateAdvSearch,#txtToOrderDateAdvSearch,#txtFromSeekingDate,#txtToSeekingDate,#txtFromStatusDate,#txtToStatusDate").datebox("setValue", icsdateformat(new Date()));
    }

    function PickContractors_AdvS() {
        var oContractor = {
            Params: '2,3' + '~' + $.trim($("#txtContractorAdvS").val()+"~"+_nBUID)
        };
        var obj = {
            BaseAddress: _sBaseAddress,
            Object: oContractor,
            ControllerName: "Contractor",
            ActionName: "ContractorSearchByNameType",
            IsWinClose: false
        };

        $("#progressbar").progressbar({ value: 0 });
        $("#progressbarParent").show();
        var intervalID = setInterval(updateProgress, 250);

        DynamicRefreshList([], "tblAccountsPickerAdvSearch");
        $.icsDataGets(obj, function (response) {
            clearInterval(intervalID);
            $("#progressbarParent").hide();
            if (response.status && response.objs.length > 0) {
                if (response.objs[0].ContractorID > 0) {
                    var tblColums = []; var oColumn = { field: "ContractorID", title: "Code", width: 50, align: "left" }; tblColums.push(oColumn);
                    oColumn = { field: "Name", title: "Name", width: 280, align: "left" }; tblColums.push(oColumn);

                    var oPickerParam = {
                        winid: 'winContractorPicker',
                        winclass: 'clsAccountOf',
                        winwidth: 400,
                        winheight: 460,
                        tableid: 'tblAccountOfs',
                        tablecolumns: tblColums,
                        datalist: response.objs,
                        multiplereturn: true,
                        searchingbyfieldName: 'Name',
                        windowTittle: 'Contactor List'
                    };
                    $.icsPicker(oPickerParam);
                    IntializePickerbutton(oPickerParam);
                }
                else {
                    alert(response.objs[0].ErrorMessage);
                }
            }
            else {
                alert("Sorry, No Contactor Found.");
            }
        });
    }

    function PickDeliverTo_AdvS() {
        var oContractor = {
            Params: '2' + '~' + $.trim($("#txtDeliverToAdvS").val()+"~"+_nBUID)
        };
        var obj = {
            BaseAddress: _sBaseAddress,
            Object: oContractor,
            ControllerName: "Contractor",
            ActionName: "ContractorSearchByNameType",
            IsWinClose: false
        };
        $("#progressbar").progressbar({ value: 0 });
        $("#progressbarParent").show();
        var intervalID = setInterval(updateProgress, 250);
        DynamicRefreshList([], "tblContractorsPickerAdvSearch");
        $.icsDataGets(obj, function (response) {
            clearInterval(intervalID);
            $("#progressbarParent").hide();
            if (response.status && response.objs.length > 0) {
                if (response.objs[0].ContractorID > 0) {
                    var tblColums = []; var oColumn = { field: "ContractorID", title: "Code", width: 50, align: "left" }; tblColums.push(oColumn);
                    oColumn = { field: "Name", title: "Name", width: 280, align: "left" }; tblColums.push(oColumn);
                    var oPickerParam = {
                        winid: 'winBuyers',
                        winclass: 'clsBuyer',
                        winwidth: 400,
                        winheight: 460,
                        tableid: 'tblBuyers',
                        tablecolumns: tblColums,
                        datalist: response.objs,
                        multiplereturn: true,
                        searchingbyfieldName: 'Name',
                        windowTittle: 'Buyer List'
                    };
                    $.icsPicker(oPickerParam);
                    IntializePickerbutton(oPickerParam);
                }
                else {
                    alert(response.objs[0].ErrorMessage);
                }
            }
            else {
                alert("Sorry, No Contactor Found.");
            }
        });
    }

    function DateActionsOrderDateAdvSearch() {
        DynamicDateActions("cboOrderDateAdvS", "txtFromOrderDateAdvSearch", "txtToOrderDateAdvSearch");
    }
    function DateActionsInvoiceDateAdvSearch() {
        DynamicDateActions("cboSeekingDateAdvSearch", "txtFromSeekingDate", "txtToSeekingDate");
    }
    function DateActionsDeliveryDateAdvSearch() {
        DynamicDateActions("cboStatusDateAdvS", "txtFromStatusDate", "txtToStatusDate");
    }

    $("#btnCloseAdvSearch").click(function () {
        $("#winAdvSearch").icsWindow("close");
    });
    $("#btnAdvSearch").click(function () {
        debugger;
        $("#winAdvSearch").icsWindow("open", "Sample Order Advance Search");
        //DynamicRefreshList([], "tblExportPIAdvSearch");
        DynamicResetAdvSearchWindow("winAdvSearch");
        DynamicDateActions("cboDateOptionAdvSearch", "txtFromDateAdvSearch", "txtToDateAdvSearch");
        DynamicDateActions("cboSeekingDateAdvSearch", "txtFromSeekingDate", "txtToSeekingDate");
        DynamicDateActions("cboStatusDateAdvS", "txtFromStatusDate", "txtToStatusDate");
        ResetAdvSearchWindow();
    });

    function IntializePickerbutton(oPickerobj) {
        $("#" + oPickerobj.winid).find("#btnOk").click(function () {
            SetPickerValueAssign(oPickerobj);
        });
        $(document).find('.' + oPickerobj.winclass).keydown(function (e) {
            if (e.which === 13) {
                SetPickerValueAssign(oPickerobj);
            }
        });
    }

    function SetPickerValueAssign(oPickerobj) {
        var oreturnObj = null, oreturnObjs = [];
        if (oPickerobj.multiplereturn) {
            oreturnObjs = $('#' + oPickerobj.tableid).datagrid('getChecked');
        } else {
            oreturnObj = $('#' + oPickerobj.tableid).datagrid('getSelected');
        }

        if (oPickerobj.winid == 'winContractorPicker')
        {
            if (oreturnObjs != null && oreturnObjs.length> 0)
            {

                _sContractorIds=''; var sMessage='';
                sMessage=(oreturnObjs.length>1)? oreturnObjs.length +" Contractors Selected" : oreturnObjs[0].Name;
                $('#txtContractorAdvS').val(sMessage);
                $("#txtContractorAdvS").addClass("fontColorOfPickItem");

                for(var i=0;i<oreturnObjs.length;i++){
                    _sContractorIds=_sContractorIds+oreturnObjs[i].ContractorID+',';
                }
                _sContractorIds=_sContractorIds.substring(0,_sContractorIds.length-1);

            }
            else
            {
                alert("Please select a contractor.");
                return false;
            }
        }

        else if (oPickerobj.winid == 'winBuyers') {
            if (oreturnObjs != null && oreturnObjs.length> 0)
            {
                _sDeliverToIDs='';
                var sMessage='';
                sMessage=(oreturnObjs.length>1)? oreturnObjs.length +" Contractors Selected" : oreturnObjs[0].Name;
                $('#txtDeliverToAdvS').val(sMessage);
                $("#txtDeliverToAdvS").addClass("fontColorOfPickItem");

                for(var i=0;i<oreturnObjs.length;i++){
                    _sDeliverToIDs=_sDeliverToIDs+oreturnObjs[i].ContractorID+',';
                }
                _sDeliverToIDs=_sDeliverToIDs.substring(0,_sDeliverToIDs.length-1);



            }
            else
            {
                alert("Please select a buyer.");
                return false;
            }
        }
        else if (oPickerobj.winid == 'winProductPicker')
        {
            if (oreturnObjs!= null && oreturnObjs.length> 0)
            {
                _sProductIds=''; var sMessage='';
                sMessage=(oreturnObjs.length>1)? oreturnObjs.length +" ProductName Selected" : oreturnObjs[0].ProductName;
                $('#txtProductName').val(sMessage);
                $("#txtProductName").addClass("fontColorOfPickItem");

                for(var i=0;i<oreturnObjs.length;i++){
                    _sProductIds=_sProductIds+oreturnObjs[i].ProductID+',';
                }
                _sProductIds=_sProductIds.substring(0,_sProductIds.length-1);

            }
            else
            {
                alert("Please select a Product.");
                return false;
            }

        }
        else if (oPickerobj.winid == 'winCPersonPicker')
        {
            debugger;

            if (oreturnObjs!=null && oreturnObjs.length > 0) {

                _sCPersonnelIds=''; var sMessage='';
                sMessage=(oreturnObjs.length>1)? oreturnObjs.length +" Con Person Selected" : oreturnObjs[0].Name;
                $('#txtContactPersonnel').val(sMessage);
                $("#txtContactPersonnel").addClass("fontColorOfPickItem");

                for(var i=0;i<oreturnObjs.length;i++){
                    _sCPersonnelIds=_sCPersonnelIds+oreturnObjs[i].ContactPersonnelID+',';
                }
                _sCPersonnelIds=_sCPersonnelIds.substring(0,_sCPersonnelIds.length-1);
            }
        }
        $("#" + oPickerobj.winid).icsWindow("close");
        $("#" + oPickerobj.winid).remove();
    }
     /// end Adv Searching

    $('#btnPrintShowDetail').click(function (e)
    {
        var oLabDip = $('#tblLabDipReports').datagrid('getSelected');
        if (oLabDip ==null || oLabDip.LabDipID <=0 ) { alert("Please select an item from list."); return ; }
        var tsv=((new Date()).getTime())/1000;
        window.open(_sBaseAddress+ "/LabDipReport/PrintShowDetail?nId="+oLabDip.LabDipID+"&nts="+tsv, "_blank");
    });
 </script>


