@{
    ViewBag.Title = "Fabric Machine Dashboard";
}
@model IEnumerable<ESimSol.BusinessObjects.FabricMachine>
    <html>
    <head>
        <title>Fabric Machine Dashboard</title>
    </head>
    <body class="menuMainCollectionTable">
        <div id="divMainTabs" class="easyui-tabs" style="width: 100%;">
            <div title="Warping" class="div-title">
                <div class="div-statusWiseTabs">
                    <div id="Warping-Total" class="div-totalStatus total">
                        <label>Total</label>
                        <br />
                        <span></span>
                    </div>
                    <div id="Warping-Planning" class="div-totalStatus planning hide">
                        <label>Planning</label>
                        <br />
                        <span></span>
                    </div>
                    <div id="Warping-Running" class="div-totalStatus running">
                        <label>Running</label>
                        <br />
                        <span></span>
                    </div>
                    <div id="Warping-Break" class="div-totalStatus break">
                        <label>Break</label>
                        <br />
                        <span></span>
                    </div>
                    <div id="Warping-Free" class="div-totalStatus free">
                        <label>Free</label>
                        <br />
                        <span></span>
                    </div>
                </div>
                <div class="div-machine-body">
                    <div id="Warping" class="easyui-panel div-circles" title="Fabric Machines" style="width:100%; height:100%; background:#fafafa;">
                    </div>
                </div>
            </div> 
            <div title="Sizing" class="div-title">
                <div class="div-statusWiseTabs">
                    <div id="Sizing-Total" class="div-totalStatus total">
                        <label>Total</label>
                        <br />
                        <span></span>
                    </div>
                    <div id="Sizing-Planning" class="div-totalStatus planning hide">
                        <label>Planning</label>
                        <br />
                        <span></span>
                    </div>
                    <div id="Sizing-Running" class="div-totalStatus running">
                        <label>Running</label>
                        <br />
                        <span></span>
                    </div>
                    <div id="Sizing-Break" class="div-totalStatus break">
                        <label>Break</label>
                        <br />
                        <span></span>
                    </div>
                    <div id="Sizing-Free" class="div-totalStatus free">
                        <label>Free</label>
                        <br />
                        <span></span>
                    </div>
                </div>
                <div class="div-machine-body">
                    <div id="Sizing" class="easyui-panel div-circles" title="Fabric Machines" style="width:100%; height:100%; background:#fafafa;">
                    </div>
                </div>
            </div>
            <div title="Loom" class="div-title">
                <div class="div-statusWiseTabs">
                    <div id="Loom-Total" class="div-totalStatus total">
                        <label>Total</label>
                        <br />
                        <span></span>
                    </div>
                    <div id="Loom-Planning" class="div-totalStatus planning hide">
                        <label>Planning</label>
                        <br />
                        <span></span>
                    </div>
                    <div id="Loom-Running" class="div-totalStatus running">
                        <label>Running</label>
                        <br />
                        <span></span>
                    </div>
                    <div id="Loom-Break" class="div-totalStatus break">
                        <label>Break</label>
                        <br />
                        <span></span>
                    </div>
                    <div id="Loom-Free" class="div-totalStatus free">
                        <label>Free</label>
                        <br />
                        <span></span>
                    </div>
                </div>
                <div class="div-machine-body">
                    <div id="Loom" class="easyui-panel div-circles" title="Fabric Machines" style="width:100%; height:100%; background:#fafafa;">
                    </div>
                </div>
            </div>
        </div>
    </body>
</html>
<style type="text/css">
    .div-statusWiseTabs {
        width: 60%;
        margin: 10px auto;
        height: 60px;
    }

    .div-totalStatus {
        width: 12%;
        margin-right: 20px;
        height: 41px;
        float: left;
        border-radius: 30px;
        text-align: center;
        padding: 8px;
        cursor: pointer;
    }

        .div-totalStatus:hover {
            background-color: #D0D70D;
        }

        .div-totalStatus label {
            font-size: 12px;
        }

        .div-totalStatus span {
            font-size: 22px;
        }

    .total {
        background-color: #DDDDD8;
        border: 1px solid #9E9E9B;
    }

    .planning {
        background-color: #F5B940;
        border: 1px solid #AB770E;
    }

    .running {
        background-color: #7FAFFC;
        border: 1px solid #2760BC;
    }

    .break {
        background-color: #F01D1D;
        border: 1px solid #B50909;
    }

    .free {
        background-color: #32DA78;
        border: 1px solid #02A144;
    }

    .div-machine-body {
        width: 98%;
        margin: 10px auto;
        margin-top: 10px;
        height: 420px;
        clear: both;
    }

    .div-circles {
        margin: 0 auto;
        width: 100%;
    }

    .div-circle {
        height: 121px;
        width: 22%;
        border-radius: 80px;
        float: left;
        margin: 10px;
        cursor: pointer;
        overflow: hidden;
    }
    /*.div-totalStatus label, .div-totalStatus span {
        cursor:pointer;
    }*/

    .div-TextWrapper {
        margin-left: 25px;
    }

    .div-h2-MachineName {
        width: 80%;
        margin-bottom: 10px;
        margin: 0 auto;
    }

        .div-h2-MachineName h2 {
            font-size: 16px;
            text-align: center;
        }

    .bold {
        font-weight: bold;
    }

    .div-title {
        width: 100%;
        margin: 0 auto;
    }
</style>
<script type="text/javascript">
    var _oFabricMachines=[];
    var _sBaseAddress="";
    $(document).ready(function () {
        _sBaseAddress = @Html.Raw( new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(HttpContext.Current.Session[SessionInfo.BaseAddress]));
        _oFabricMachines = @Html.Raw( new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(Model));
        var oFMD = @Html.Raw( new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(@ViewBag.FMD));
        //$(".hide").hide();

        $('#Warping-Break, #Sizing-Break, #Loom-Break').hide();
        SetCircles("Warping-Total");
        SetCounts(oFMD);

        $('#divMainTabs').tabs({
            onSelect:function(title){
                if(title=="Warping")
                {
                    SetCircles("Warping-Total");
                }
                else if(title=="Sizing")
                {
                    SetCircles("Sizing-Total");
                }
                else if(title=="Loom")
                {
                    SetCircles("Loom-Total");
                }
            }
        });

    });

    function SetCounts(oFMD)
    {
        $("#Warping-Total span").text(oFMD.WarpingTotal);
        $("#Warping-Planning span").text(oFMD.WarpingPlanning);
        $("#Warping-Running span").text(oFMD.WarpingRunning);
        $("#Warping-Break span").text(oFMD.WarpingBreak);
        $("#Warping-Free span").text(oFMD.WarpingFree);

        $("#Sizing-Total span").text(oFMD.SizingTotal);
        $("#Sizing-Planning span").text(oFMD.SizingPlanning);
        $("#Sizing-Running span").text(oFMD.SizingRunning);
        $("#Sizing-Break span").text(oFMD.SizingBreak);
        $("#Sizing-Free span").text(oFMD.SizingFree);

        $("#Loom-Total span").text(oFMD.LoomTotal);
        $("#Loom-Planning span").text(oFMD.LoomPlanning);
        $("#Loom-Running span").text(oFMD.LoomRunning);
        $("#Loom-Break span").text(oFMD.LoomBreak);
        $("#Loom-Free span").text(oFMD.LoomFree);
    }

    $(".div-totalStatus").click(function(){
        var sDivId = $(this).attr("id");
        SetCircles(sDivId);
    });
    function SetCircles(sDivId)
    {
        $(".div-circles").empty();
        var nWeavingProcess = GetWeavingProcessType(sDivId);
        var nMachineStatus = GetMachineStatus(sDivId);
        var oFabricMachine={
            WeavingProcess  :   nWeavingProcess,
            MachineStatus   :   nMachineStatus
        };

        if(nMachineStatus == -1)
        {
            oFabricMachine.RPM = -1;
        }

        var obj = {
            BaseAddress: _sBaseAddress,
            Object: oFabricMachine,
            ControllerName: "FabricMachine",
            ActionName: "GetsStatusWise",
            IsWinClose: false
        };
        $.icsMaxDataGets(obj, function (response) {
            if (response.status && response.objs.length > 0) {
                if($.trim(response.objs[0].ErrorMessage) == "")
                {
                    if (response.objs[0].FMID > 0) {
                        MakeEverySingleMachineCircles(response.objs, sDivId.split('-')[0]);
                    }
                    else {
                        alert("Error Found.");
                    }
                }
                else
                {
                    alert(response.objs[0].ErrorMessage);
                }
            }
        });
    }
    function MakeEverySingleMachineCircles(oFMs, sWeavingProcessType)
    {
        debugger;
        var nLength = oFMs.length
        if(nLength > 0)
        {
            /*By following below enum

            public enum EnumMachineStatus
            {
                Planning = 0, Running = 1, Break = 2, Free = 3
            }*/
            var sClassName = "";
            for(var i = 0; i < nLength ; i++)
            {
                var sMachineStatus = oFMs[i].MachineStatus;
                if(sMachineStatus == 0) sClassName = "planning hide";
                else if(sMachineStatus == 1) sClassName = "running";
                else if(sMachineStatus == 2) sClassName = "break";
                else sClassName = "free hide"; //3

                $("#" + sWeavingProcessType).append('<div class="div-circle ' + sClassName + ' ' + oFMs[i].FMID + '">'+
                                                        '<div class="div-h2-MachineName">'+
                                                            '<h2 class="h2-MachineName">' + oFMs[i].Name +"("+ oFMs[i].Code +")" + '</h2>'+
                                                        '</div>'+
                                                        '<div class="div-TextWrapper">'+
                                                            '<label class="bold">Fabric Batch : </label>'+
                                                            '<label class="lbl-FabricBatchNo">' + oFMs[i].BatchNo + '</label>'+
                                                            '<br />'+
                                                            '<label class="bold">Order No : </label>'+
                                                            '<label class="lbl-OrderNo">' + oFMs[i].OrderNo + '</label>'+
                                                            '<br />'+
                                                            '<label class="bold">Duration : </label>'+
                                                            '<label class="lbl-Duration">' + oFMs[i].Duration + '</label>'+
                                                        '</div>'+
                                                    '</div>');
            }

            //Click circle and open picker list.
            $(".div-machine-body .div-circle").click(function(){
                var nFMId = parseInt($(this).attr('class').split(' ')[2]);
                var oFM = {
                    FMID : nFMId
                };

            });
        }
    }
    function GetWeavingProcessType(sDivId)
    {
        /*
          By following below enum

          public enum EnumWeavingProcess
          {
                Warping = 0, Sizing= 1, Drawing_IN = 2, Loom = 3
          }
        */

        var sWeavingProcess = sDivId.split("-")[0];
        if(sWeavingProcess == "Warping") return 0;
        else if(sWeavingProcess == "Sizing") return 1;
        else if(sWeavingProcess == "Drawing_IN") return 2;
        else if(sWeavingProcess == "Loom") return 3;
    }
    function GetMachineStatus(sDivId)
    {
        /*
          By following below enum

          public enum EnumMachineStatus
          {
                Planning = 0, Running = 1, Break = 2, Free = 3
          }
        */

        var sMachineStatus = sDivId.split("-")[1];
        if(sMachineStatus == "Planning") return 0;
        else if(sMachineStatus == "Running") return 1;
        else if(sMachineStatus == "Break") return 2;
        else if(sMachineStatus == "Free") return 3;
        else if(sMachineStatus == "Total") return -1;
    }
</script>
