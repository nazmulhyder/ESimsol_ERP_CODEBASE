@{
    Layout = "~/Views/Shared/_Layout.cshtml";
}
@model IEnumerable<ESimSol.BusinessObjects.ExportPI>

    <body>
        <div id="progressbarParent" style="width:100%;height:100%;margin:0 auto;text-align:center; margin-left: auto;margin-right: auto;left: 0;right: 0;z-index: 1;">
            <div style="margin: 0px auto;margin-top: 251px;text-align:center;width:390px;">
                <label style="font-size:18px;">Please wait</label>
                <div id="progressbar" style="width:100%;height:37px;"></div>
            </div>
        </div>
        <div id="winExportPIInfo" class="easyui-window" title="Update Export PI Info" data-options="modal:true,closed:true,collapsible:false,minimizable:false,maximizable:false,closable:false">
            <table border="0" cellpadding="1" cellspacing="1" style="width:99%">
                <tr>
                    <td style="width:20%;text-align:right;">Party Name:</td>
                    <td style="width:80%">
                        <input type="text" id="txtPartyName" style="width:100%; text-align:left;" />
                    </td>
                </tr>
                <tr>
                    <td style="width:20%;text-align:right;">Party Address:</td>
                    <td style="width:80%">
                        <textarea id="txtPartyAddress" rows="2" cols="30" style="width:100%;"></textarea>
                    </td>
                </tr>
                <tr>
                    <td style="width:20%;text-align:right;">S.C. Remarks:</td>
                    <td style="width:80%">
                        <table border="0" cellspacing="0" cellpadding="0" style="width:99%">
                            <tr>
                                <td style="width:93%"><textarea id="txtSCRemarks" style="width:100%;"></textarea> </td>
                                <td style="width:7%;text-align:right;"><input type="button" value="Refresh" style="width:98%; height:55px;" id="btnloadPriviousRemarks" /></td>
                            </tr>
                        </table>
                    </td>
                </tr>
                <tr>
                    <td style="width:20%;text-align:right;">PO & Master Contact No:</td>
                    <td style="width:80%"><input type="text" id="txtMasterContactNo" style="width:100%" /></td>
                </tr>
                <tr>
                    <td style="width:20%;text-align:right;">Bank Charge Caption:</td>
                    <td style="width:80%"><input type="text" id="txtBankChargeInfo" style="width:100%" /></td>
                </tr>
                <tr>
                    <td style="width:20%;text-align:right;">Exchange Rate:</td>
                    <td style="width:80%">
                        <table border="0" cellspacing="0" cellpadding="0" style="width:100%">
                            <tr>
                                <td style="width:40%"><input type="text" id="txtConversionRate" style="width:95%; text-align:right;" /></td>
                                <td style="width:2%;"></td>
                                <td style="width:20%;text-align:right;">Bank Charge:</td>
                                <td style="width:38%"><input type="text" id="txtBankCharge" style="width:100%;text-align:right;" /></td>
                            </tr>
                        </table>
                    </td>
                </tr>
            </table>
            <fieldset class="actionfieldsetstyle">
                <legend>Actions : </legend>
                <a id="btnUpdatePIInfo" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-save" plain="true">Update</a>
                <a id="btnClosePIInfo" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-cancel" plain="true">Close</a>
            </fieldset>
        </div>


        <div id="winAdvSearchExportPI" class="easyui-window winClass" title="Adv. Search" data-options="modal:true,closed:true,collapsible:false,minimizable:false,maximizable:false,closable:false">
            <table style="width:100%;">
                <tr>
                    <td>
                        <fieldset style="margin-bottom: 0px;">
                            <legend>Searching Criteria</legend>
                            <table>
                                <tr>
                                    <td style=" width:20%;text-align:right;">
                                        <label>Account Of :</label>
                                    </td>
                                    <td colspan="3" style=" width:80%;text-align:left;">
                                        <input id="txtContractorAdvS" style="width:75%;" type="text" placeholder="Type & Press Enter" />
                                        <a id="btnPickContractorAdvS" href="javascript:void(0)" class="easyui-linkbutton ics-pick" iconcls="icon-pick" plain="true"></a>
                                        <a id="btnClrContractorAdvS" href="javascript:void(0)" class="easyui-linkbutton ics-pick" iconcls="icon-clear" plain="true"></a>

                                    </td>
                                </tr>
                                <tr>
                                    <td style=" width:20%;text-align:right;">
                                        <label>Buying House :</label>
                                    </td>
                                    <td colspan="3" style=" width:80%;text-align:left;">
                                        <input id="txtSearchByBuyersAdvSearch" style="width:75%;" type="text" placeholder="Type & Press Enter" />
                                        <a id="btnPickSearchByBuyersAdvSearch" href="javascript:void(0)" class="easyui-linkbutton ics-pick" iconcls="icon-pick" plain="true"></a>
                                        <a id="btnClrSearchByBuyersAdvSearch" href="javascript:void(0)" class="easyui-linkbutton ics-pick" iconcls="icon-clear" plain="true"></a>
                                    </td>
                                </tr>
                                <tr>
                                    <td style=" width:20%;text-align:right;">
                                        <label>Issue Date :</label>
                                    </td>
                                    <td colspan="3">
                                        <select id="cboIssueDateAdvSearch" style="width:30%;" onchange="DateActionsIssueDateAdvSearch();"></select>
                                        <input id="txtFromIssueDateAdvSearch" type="text" style="width: 100px;" class="easyui-datebox" required="required" data-options="formatter:icsdateformat,parser:icsdateparser" />To
                                        <input id="txtToIssueDateAdvSearch" type="text" style="width: 100px;" class="easyui-datebox" required="required" data-options="formatter:icsdateformat,parser:icsdateparser" />
                                    </td>
                                </tr>
                                <tr>
                                    <td style=" width:20%;text-align:right;">
                                        <label>Validity Date :</label>
                                    </td>
                                    <td colspan="3">
                                        <select id="cboValidityDateAdvSearch" style="width:30%;" onchange=" DateActionsValidityDateAdvSearch(); "></select>
                                        <input id="txtFromValidityDateAdvSearch" type="text" style="width: 100px;" class="easyui-datebox" required="required" data-options="formatter:icsdateformat,parser:icsdateparser" />To
                                        <input id="txtToValidityDateAdvSearch" type="text" style="width: 100px;" class="easyui-datebox" required="required" data-options="formatter:icsdateformat,parser:icsdateparser" />
                                    </td>
                                </tr>
                                <tr>
                                    <td style=" width:20%;text-align:right;">
                                        <label>LC Date :</label>
                                    </td>
                                    <td colspan="3">
                                        <select id="cboLCDateAdvSearch" style="width:30%;" onchange=" DateActionsLCDateAdvSearch(); "></select>
                                        <input id="txtFromLCDateAdvSearch" type="text" style="width: 100px;" class="easyui-datebox" required="required" data-options="formatter:icsdateformat,parser:icsdateparser" />To
                                        <input id="txtToLCDateAdvSearch" type="text" style="width: 100px;" class="easyui-datebox" required="required" data-options="formatter:icsdateformat,parser:icsdateparser" />
                                    </td>
                                </tr>
                                <tr>
                                    <td style=" width:20%;text-align:right;">
                                        <label>Payment Type </label>
                                    </td>
                                    <td>
                                        <select id="cboPaymentType" style="width: 100%;"></select>
                                    </td>
                                    <td style="text-align:right;">
                                        <label>PI Type :</label>
                                    </td>
                                    <td>
                                        <select id="cboPITypeAdv" style="width: 100%;float:right;"><option value="-1">None</option><option value="0">Open</option><option value="1">Order Sheet</option></select>
                                    </td>
                                </tr>
                                <tr>
                                    <td style=" width:20%;text-align:right;">
                                        <label>Bank :</label>
                                    </td>
                                    <td colspan="3">
                                        <select id="cboPIBankAdvSearch" style="width:100%;"></select>
                                    </td>
                                </tr>
                                <tr>
                                    <td style=" width:20%;text-align:right;">
                                        <label>Mkt. Person :</label>
                                    </td>
                                    <td colspan="3">
                                        <select id="cboMkPersonAdvSearch" style="width:100%;"></select>
                                    </td>
                                </tr>

                                <tr>
                                    <td style="text-align:right;">
                                        <label>PO No :</label>
                                    </td>
                                    <td>
                                        <input id="txtSearchByPOSearch" type="text" style="width:100%" />
                                    </td>
                                    <td style="text-align:right;">
                                        <label>Style No :</label>
                                    </td>
                                    <td>
                                        <input id="txtSearchByStyleNoAdvSearch" type="text" style="width:100%" />
                                    </td>
                                </tr>
                                <tr>
                                    <td style=" width:20%;text-align:right;">
                                        <label>Status By Date :</label>
                                    </td>
                                    <td colspan="3">
                                        <select id="cboStatusAdvSearch" style="width:30%;" onchange=" DateActionsStatusDateAdvSearch(); "></select>
                                        <input id="txtFromStatusDateAdvSearch" type="text" style="width: 100px;" class="easyui-datebox" required="required" data-options="formatter:icsdateformat,parser:icsdateparser" />To
                                        <input id="txtToStatusDateAdvSearch" type="text" style="width: 100px;" class="easyui-datebox" required="required" data-options="formatter:icsdateformat,parser:icsdateparser" />
                                    </td>
                                </tr>
                                <tr>
                                    <td style="text-align:right;">
                                        <label>Status :</label>
                                    </td>
                                    <td colspan="3">
                                        <table id="tblCurrentStatusAdvSearch" class="easyui-datagrid" title="" style="width:100%; height: 130px;" data-options="singleSelect: false,fitColumns:false, rownumbers:true, pagination:false, autoRowHeight:false">
                                            <thead>
                                                <tr>
                                                    <th data-options="field:'Selected',checkbox:true"></th>
                                                    <th field="Value" width="80%">Status Name</th>
                                                </tr>
                                            </thead>
                                        </table>
                                    </td>
                                </tr>
                                <tr>
                                    <td height="5px" colspan="4"></td>
                                </tr>
                            </table>
                        </fieldset>
                    </td>
                </tr>
            </table>

            <fieldset class="actionfieldsetstyle">
                <legend>Actions : </legend>
                <label class="lblLoadingMessage" style="float: left;">Loading Please Wait...</label>
                <a id="btnResetAdvSearch" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-reload" plain="true">Reset</a>
                <a id="btnSearchAdvSearch" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-search" plain="true">Search</a>
                <a id="btnCloseAdvSearch" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-cancel" plain="true">Close</a>
            </fieldset>
        </div>
        <div id="winPrintFormat2" style="width:550px;" class="easyui-window winstyle" title="Adv. Search" data-options="modal:true,closed:true,collapsible:false,minimizable:false,maximizable:false,closable:false">
            <fieldset>
                <legend>Print Setup</legend>
                <table style="width:100%;">
                    <tr>
                        <td style="text-align:right;">
                            Qty Fromat :
                        </td>
                        <td>
                            <input id="chkInKg" type="checkbox" onclick="if(this.checked){IsLBSFormat(false)}else{IsLBSFormat(true)}" /> In M
                        </td>
                        <td>
                            <input id="chkInLBS" type="checkbox" checked onclick="if(this.checked){IsLBSFormat(true)}else{IsLBSFormat(false)}" /> In Y
                        </td>
                        <td style="width:30%;">
                            &nbsp;&nbsp;&nbsp;
                        </td>
                    </tr>
                    <tr>
                        <td style="text-align:right;">
                            Print Title :
                        </td>
                        <td>
                            <input id="chkPrintTitleInNormalFormat" type="checkbox" checked onclick="if(this.checked){PrintTitleFormat(1)}" /> Normal Format
                        </td>
                        <td>
                            <input id="chkPrintTitlePadFormat" type="checkbox" onclick="if(this.checked){PrintTitleFormat(2)}" /> Pad Format
                        </td>
                        <td>
                            <input id="chkPrintTitleImageFormat" type="checkbox" onclick="if(this.checked){PrintTitleFormat(3)}" /> Image Format
                        </td>

                    </tr>
                </table>
            </fieldset>
            <fieldset class="actionfieldsetstyle">
                <legend>Actions : </legend>
                <a id="btnOkPrintFormat2" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-ok" plain="true">Ok</a>
                <a id="btnClosePrintFormat2" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-cancel" plain="true">Close</a>
            </fieldset>
        </div>
        <div id="winExportPIHistory" class="easyui-window" title="Export PI History" data-options="modal:true,closed:true,collapsible:false,minimizable:false,maximizable:false,closable:false">
            <div id="divExportPIHistory" tabindex="-1">
                <table id="tblExportPIHistory" class="easyui-datagrid" style="width:900px;height:350px;margin:0;" data-options="singleSelect: true,fitColumns:false, rownumbers:true, pagination:false, autoRowHeight:false ">
                    <thead>
                        <tr>
                            <th field="DBServerDateTimeInString" width="18%" align="center">Date</th>
                            <th field="PreviousStatusInString" width="20%" align="left">Previous Status</th>
                            <th field="CurrentStatusInString" width="20%" align="left">Current Status</th>
                            <th field="Note" width="20%" align="left">Note</th>
                            <th field="OperateByName" width="20%" align="left">Operate By</th>
                        </tr>
                    </thead>
                </table>

            </div>
            <fieldset class="actionfieldsetstyle">
                <legend>Actions : </legend>
                <a id="btnCloseExportPIHistory" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-cancel" plain="true">Close</a>
            </fieldset>
        </div>
        <div id="winReviseHistory" class="easyui-window" title="Revise History" data-options="modal:true,closed:true,collapsible:false,minimizable:false,maximizable:false,closable:false">
            <table id="tblReviseHistory" class="easyui-datagrid" style="width: 900px; height: 350px; margin: 0;" data-options="singleSelect: true,fitColumns:false, rownumbers:true, pagination:false, autoRowHeight:false, toolbar: '#toolbarReviseHistory' ">
                <thead>
                    <tr>
                        <th field="PINo" width="18%">PI No</th>
                        <th field="PIStatusSt" width="15%">Status</th>
                        <th field="IssueDateInString" width="15%" align="center">Issue Date</th>
                        <th field="ContractorNameCode" width="15%">Account of</th>
                        <th field="BuyerName" width="18%">Buying House</th>
                        <th field="AmountSt" width="15%" align="right">Total Value</th>
                    </tr>
                </thead>
            </table>
            <div id="toolbarReviseHistory">
                <a id="btnPISwap" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-redo" plain="true">Active</a>
                <a id="btnPrintReviseHistory" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-print" plain="true">Print</a>
            </div>
            <fieldset class="actionfieldsetstyle">
                <legend>Actions : </legend>
                <a id="btnCloseReviseHistory" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-cancel" plain="true">Close</a>
            </fieldset>
        </div>
        <div class="menuMainCollectionTable">
            <table id="tblExportPIs" title="PI List" style="width:100%; height:100%" class="easyui-datagrid" fit="true" fitcolumns="false" rownumbers="true" pagination="false" singleselect="true" autorowheight="false" toolbar="#toolbarExportPI" data-options="rowStyler: function(index,row){
                                         if (row.MKTPName=='Total'){
                                            return 'color:#016B18; font-weight:bold;';
                                        }
                                    }
                    ">

                @*<table id="tblExportPIs" title="Export PIs" class="easyui-datagrid" fit="true" fitcolumns="true" rownumbers="true" pagination="false" singleselect="true" autorowheight="false" toolbar="#toolbarExportPI">*@
                <thead>
                    <tr>
                        <th field="PINo_Full" width="12%">PI No</th>
                        <th field="PIStatusSt" width="10%">Status</th>
                        <th field="PITypeInString" width="8%">PI Type</th>
                        <th field="IssueDateInString" width="10%" align="center">Issue Date</th>
                        <th field="ContractorNameCode" width="20%">Account of</th>
                        <th field="BuyerName" width="20%">Buying House</th>
                        <th field="QtySt" width="10%" align="right">Qty(Y)</th>
                        <th field="AmountSt" width="10%" align="right">Total Value</th>
                        <th field="ELCNo" width="16%">L/C No</th>
                        <th field="PaymentTypeSt" width="8%">Payment Type</th>

                        <th field="AttCount" width="8%">Attachment Count</th>
                    </tr>
                </thead>
            </table>
            <div id="toolbarExportPI" style="height:60px;">
                <input id="txtSearchByExportPI" type="text" placeholder="Search by PI No" style="width: 120px" />
                <a id="btnAdvSearchExportPI" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-search" plain="true">Adv. Search</a>
                <select id="cboBUType" style=" width:100px;"></select>
                <a id="btnViewExportPI" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-details" plain="true">Details</a>
                @*<a id="btnPickUpdatePIInfo" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-edit" plain="true">Update PI Info</a>*@
                <a id="btnReqForApprovePI" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-redo" plain="true">Req For App</a>
                <a id="btnUndoReqPI" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-undo" plain="true">Undo Req</a>
                <a id="btnApprovePI" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-approved" plain="true">Approve</a>
                <a id="btnUndoApprovePI" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-undo" plain="true">Undo App</a>
                <a id="btnPIIssuePI" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-add" plain="true">PI Issue</a>
                <a id="btnReqForRevisePI" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-redo" plain="true">Req For Revise</a>
                <a id="btnAcceptRevisePI" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-approved" plain="true">Accept Revise</a>
                <a id="btnHistoryPI" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-details" plain="true">History</a>
                @*<a id="btnApproved" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-approved" plain="true" onclick="Approve()">Approval View </a>*@
                <a id="btnReviseHistoryPI" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-details" plain="true">Revise History</a>
                @*<a id="btnAddPO" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-add" plain="true">Create PO</a>*@
                @*<a id="btnCopyPI" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-copy" plain="true">Copy</a>*@
                @*<a id="btnCancelPI" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-cancel" plain="true">Cancel</a>*@
                @*<a id="btnPrintBill" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-print" plain="true">Bill</a>*@
                @*<a id="btnPrintSalesContract" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-print" plain="true">Sales Contract</a>*@
                @*<a id="btnPreViewPI" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-print" plain="true">Print PI</a>*@
                <a id="btnPreViewPITwo" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-print" plain="true">Preview</a>
                <input type="submit" id="btnPrintExportPI" value="Print List" class="icon-print PrintList" style="margin-top: 4px;" />
                <a id="btnPrintFormat" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-setting" plain="true">Print Format</a>
                <a id="btnPaymentTypeUpdate" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-add" plain="true">Change Payment Type</a>
                <a id="btnAddAttachment" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-attachment" plain="true">Attachment</a>
                @*<a id="btnUpdatePINo" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-add" plain="true">Change PI No</a>*@
                <a id="btnRequestFor" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-approved" plain="true">Request</a>
                <a id="btnApproveNew" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-approved" plain="true">Approve</a>

            </div>
        </div>
        <div id="winPINoChange" style="width:350px;" class="easyui-window" title="PI No Change" data-options="modal:true,closed:true,collapsible:false,minimizable:false,maximizable:false,closable:true">
            <div>
                <table style="width:100%;text-align:left">

                    <tr>
                        <td style="width:30%;text-align:right">
                            PI No:
                        </td>
                        <td style="width:70%">
                            <input id="txtPINo_Cur" class="reset-text" style="width:100%;" placeholder="Code search" />
                        </td>
                    </tr>
                    <tr>
                        <td style="width:30%;text-align:right">
                            New PI No:
                        </td>
                        <td style="width:70%">
                            <input type="text" style="width:100%;" id="txtPINo_New" placeholder="0000" />
                        </td>
                    </tr>
                    <tr>
                        <td style="width:30%;text-align:right"></td>
                        <td style="width:70%">
                            (Last Four digit)
                        </td>
                    </tr>
                </table>

            </div>
            <fieldset class="actionfieldsetstyle">
                <legend>Actions : </legend>
                <a id="btnSavePINo" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-save" plain="true">Save</a>
                <a id="btnClosePINo" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-cancel" plain="true">Close</a>
            </fieldset>
        </div>
        <div id="winPaymentTypeUpdate" class="easyui-window" title="Invoice Status Change" data-options="modal:true,closed:true,collapsible:false,minimizable:false,maximizable:false,closable:true">

            <div id="divInvoiceStatusUpdate">
                <table>
                    <tr>
                        <td style="width:120px; text-align:right">
                            PaymentType
                        </td>
                        <td style="width:150px;text-align:left">
                            <select id="cboPaymentTypeTwo" style="width: 150px;"></select>
                        </td>
                    </tr>

                </table>

            </div>
            <fieldset class="actionfieldsetstyle">
                <legend>Actions : </legend>
                <a id="btnSavePaymentType" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-save" plain="true">Save</a>
                <a id="btnClosePaymentType" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-cancel" plain="true">Close</a>
            </fieldset>
        </div>
    </body>
    <style type="text/css">
        #winPrintFormat2 {
            width: 70%;
        }

        #winExportPIInfo {
            width: 750px;
        }
    </style>
    <script type="text/javascript">
    var _sBaseAddress="";
    var _oExportPI=null;
    var _oExportPIs=[];
    var _oPIPaymentTypes=[];
    var _oBankBranchs=[];
    var _oCurrencys=[];
    var _oLCTerms=[];
    var _oLIBORRates=[];
    var _oBankFDDs=[];
    var _oCompareOperators = [];
    var _oMktPersons = [];
    var _oPIStatusObjs = [];
    var _oShipmentTerms=[];
    var _bIsAcceptRevise = false;
    var _sControllerName="";
    var _oExportPIDescriptions=[];
    var _oDepthOfShades=[];
    var _oProcessTypes=[];
    var _nBUID = 0;
    var _sContractorIds = '';
    var _sBuyerIDsAdvSearch = '';
    var _nProductNature = 0;
    var _oBUs = null;
    var _oAuthorizationRolesMappings=[];
    $(document).ready(function () {
        debugger;
        _sBaseAddress =@Html.Raw( new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(HttpContext.Current.Session[SessionInfo.BaseAddress]));
        _oExportPIs =@Html.Raw( new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(Model));
        _oCompareOperators = @Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(ViewBag.CompareOperators));
        _nBUID = @Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(ViewBag.BUID));
        _oPIStatusObjs = @Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(ViewBag.PIStatusObjs));
        _oBankBranchs = @Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(ViewBag.BankBranchs));
        _oMktPersons = @Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(ViewBag.MktPersons));
        _oPIPaymentTypes = @Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(ViewBag.PIPaymentTypes));
        _nProductNature = @Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(ViewBag.ProductNature));
        _oBUs = @Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(ViewBag.BUs));
        _oAuthorizationRolesMappings =@Html.Raw( new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(HttpContext.Current.Session[SessionInfo.AuthorizationRolesMapping]));
        //RefreshControlLayout();
        $("#txtFromIssueDateAdvSearch,#txtToIssueDateAdvSearch").datebox({ disabled: false });
        $("#txtFromIssueDateAdvSearch,#txtToIssueDateAdvSearch").datebox("setValue", icsdateformat(new Date()));
        $("#txtFromValidityDateAdvSearch,#txtToValidityDateAdvSearch").datebox({ disabled: false });
        $("#txtFromValidityDateAdvSearch,#txtToValidityDateAdvSearch").datebox("setValue", icsdateformat(new Date()));
        $('#tblExportPIs').datagrid({ onSelect: function (rowIndex, rowData) { OperationPerformsEPI(rowIndex, rowData); } });
        $("#tblCurrentStatusAdvSearch").datagrid("checkAll");
        $("#cboPaymentTypeTwo").icsLoadCombo({
            List: _oPIPaymentTypes,
            OptionValue: "id",
            DisplayText: "Value"
        });
        $("#progressbar").progressbar({ value: 0 });
        $("#progressbarParent").hide();
        if(_nBUID>0)
        {
            $('#cboBUType').hide();
        }

        sessionStorage.setItem("QtyFormat",true);//default set
        sessionStorage.setItem("ImageFormat",1);//default set
        var oExportPIs =sessionStorage.getItem("ExportPIs");
        if(oExportPIs!=null)
        {
            oExportPIs = jQuery.parseJSON(oExportPIs);
        }
        else
        {
            oExportPIs=_oExportPIs;
        }
        RefreshList(oExportPIs);
        $(".lblLoadingMessage").hide();
        $('#tblExportPIAdvSearch').datagrid({ selectOnCheck: false, checkOnSelect: true });
        DynamicRefreshList(_oPIStatusObjs, "tblCurrentStatusAdvSearch");
        LoadAllComboExportPIAdv();
        DateActionsIssueDateAdvSearch();
        DateActionsValidityDateAdvSearch();
        DateActionsLCDateAdvSearch();
        DateActionsStatusDateAdvSearch();
    });


    function RefreshControlLayout()
    {
        $('#btnApprovePI,#btnUndoApprovePI,#btnReqForApprovePI,#btnReqForRevisePI,#btnAcceptRevisePI,#btnUndoReqPI,#btnCancelPI,#btnPreview,#btnUpdatePINo').hide();
        if(PermissionChecker('Search','ExportPI',_oAuthorizationRolesMappings)){$("#btnAdvSearchExportPI").show();}
        if(PermissionChecker('Approved','ExportPI',oAuthorizationRolesMappings)){$('#btnApprovePI,#btnUndoApprovePI,#btnReqForApprovePI').show();  }
        if(PermissionChecker('Revise','ExportPI',oAuthorizationRolesMappings)){$('#btnReqForRevisePI,#btnAcceptRevisePI,#btnUndoReqPI').show();  }
        if(PermissionChecker('Cancel','ExportPI',oAuthorizationRolesMappings)){$('#btnCancelPI').show();  }
        if(PermissionChecker('Preview','ExportPI',_oAuthorizationRolesMappings)){$('#btnPreview').show();  }
        if(PermissionChecker('ChangeNo','ExportPI',_oAuthorizationRolesMappings)){$('#btnUpdatePINo').show();  }
    }
    //Search Control

    function updateProgress() {
        var value =$('#progressbar').progressbar('getValue');
        if (value < 96){
            value += Math.floor(Math.random() * 10);
            $('#progressbar').progressbar('setValue', value);
        }
    }
    function hideShow(miliseconds) {
        $("#progressbarParent").hide();
    }
    //Account Of Picker

    $("#txtContractorAdvS").keydown(function (e) {
        if (e.keyCode === 13) // Enter Press
        {
            PickAccountOfPIAdvSearch();
        }
        else if (e.keyCode === 08) {
            $("#txtContractorAdvS").removeClass("fontColorOfPickItem");
            _sContractorIds = '';
        }
    });

    $("#btnClrContractorAdvS").click(function () {
        $("#txtContractorAdvS").removeClass("fontColorOfPickItem");
        $("#txtContractorAdvS").val("");
        _sContractorIds = '';
    });

    $("#btnPickContractorAdvS").click(function () {
        PickAccountOfPIAdvSearch();
    });
    $("#txtSearchByAccountNamePickerAdvSearch").keydown(function (e) {
        var obj = {
            Event: e,
            SearchProperty: "Name",
            GlobalObjectList: _oAccountsOf,
            TableId: "tblAccountsPickerAdvSearch"
        };
        $('#txtSearchByAccountNamePickerAdvSearch').icsSearchByText(obj);
    });

    //End Account Of Picker
    $("#txtSearchByBuyersAdvSearch").keydown(function (e) {
        if (e.keyCode === 13) // Enter Press
        {
            PickBuyerPIAdvSearch();
        }
        else if (e.keyCode === 08) {
            $("#txtSearchByBuyersAdvSearch").removeClass("fontColorOfPickItem");
            _sBuyerIDsAdvSearch ="";
        }
    });

    $("#btnClrSearchByBuyersAdvSearch").click(function () {
        $("#txtSearchByBuyersAdvSearch").removeClass("fontColorOfPickItem");
        $("#txtSearchByBuyersAdvSearch").val("");
        _sBuyerIDsAdvSearch ="";
    });

    $("#btnPickSearchByBuyersAdvSearch").click(function () {
        PickBuyerPIAdvSearch();
    });

    $("#txtSearchByBuyerNamePickerAdvSearch").keydown(function (e) {
        var obj = {
            Event: e,
            SearchProperty: "Name",
            GlobalObjectList: _oBuyers,
            TableId: "tblBuyersPickerAdvSearch"
        };
        $('#txtSearchByBuyerNamePickerAdvSearch').icsSearchByText(obj);
    });

    //End Buyer Search
    $("#btnResetAdvSearch").click(function () {
        ResetAdvSearchWindow();
        DateActionsIssueDateAdvSearch();
        DateActionsValidityDateAdvSearch();
        DateActionsLCDateAdvSearch();
        DateActionsStatusDateAdvSearch();
    });

    $("#btnSearchAdvSearch").click(function () {
        debugger;
        $('#tblExportPIAdvSearch').datagrid({ selectOnCheck: false, checkOnSelect: true });

        $(".lblLoadingMessage").show();
        DynamicRefreshList([], "tblExportPIAdvSearch");
        var checkDate = CheckFromAndToDateValidation("cboIssueDateAdvSearch", "txtFromIssueDateAdvSearch", "txtToIssueDateAdvSearch");
        if (!checkDate) {
            alert("Start date must be greater than end date.");
            return false;
        }
        checkDate = CheckFromAndToDateValidation("cboValidityDateAdvSearch", "txtFromIssueDateAdvSearch", "txtToValidityDateAdvSearch");
        if (!checkDate) {
            alert("Start date must be greater than end date.");
            return false;
        }
        checkDate = CheckFromAndToDateValidation("cboLCDateAdvSearch", "txtFromLCDateAdvSearch", "txtToLCDateAdvSearch");
        if (!checkDate) {
            alert("Start date must be greater than end date.");
            return false;
        }
        checkDate = CheckFromAndToDateValidation("cboStatusAdvSearch", "txtFromStatusDateAdvSearch", "txtToStatusDateAdvSearch");
        if (!checkDate) {
            alert("Start date must be greater than end date.");
            return false;
        }

        //var nContractorID = parseInt(_sContractorIds);
        //var nBuyerID = parseInt(_sBuyerIDsAdvSearch);
        var nCboIssueDate = parseInt($("#cboIssueDateAdvSearch").val());
        var dFromIssueDate = $('#txtFromIssueDateAdvSearch').datebox('getValue');
        var dToIssueDate = $('#txtToIssueDateAdvSearch').datebox('getValue');

        var nCboValidityDate = parseInt($("#cboValidityDateAdvSearch").val());
        var dFromValidityDate = $('#txtFromValidityDateAdvSearch').datebox('getValue');
        var dToValidityDate = $('#txtToValidityDateAdvSearch').datebox('getValue');

        var nCboLCDate = parseInt($("#cboLCDateAdvSearch").val());
        var dFromLCDate = $('#txtFromLCDateAdvSearch').datebox('getValue');
        var dToLCDate = $('#txtToLCDateAdvSearch').datebox('getValue');

        var nCboPIBank = parseInt($("#cboPIBankAdvSearch").val());
        var ncboPaymentType = parseInt($("#cboPaymentType").val());
        var nCboMkPerson = parseInt($("#cboMkPersonAdvSearch").val());

        var sCurrentStatus = "";
        var oPIStatus = $("#tblCurrentStatusAdvSearch").datagrid("getChecked");
        for (var i = 0; i < oPIStatus.length; i++) {
            sCurrentStatus = oPIStatus[i].id + "," +sCurrentStatus;
        }
        sCurrentStatus = sCurrentStatus.substring(0, sCurrentStatus.length - 1);

        //var bExportLCIsntCreateYet = $("#chkExportLCIsntCreateYet").is(':checked');

        var nPIType = parseInt($("#cboPITypeAdv").val());
        var sFEONo = $.trim($("#txtSearchByFEONoAdvSearch").val());
        var sConstruction = $.trim($("#txtSearchByConstructionAdvSearch").val());

        var sStyleNo = $.trim($("#txtSearchByStyleNoAdvSearch").val());
        var sPONo = $.trim($("#txtSearchByPOSearch").val());

        var nCboStatusDate = parseInt($("#cboStatusAdvSearch").val());
        var dFromStatusDate = $('#txtFromStatusDateAdvSearch').datebox('getValue');
        var dToStatusDate = $('#txtToStatusDateAdvSearch').datebox('getValue');
        var _nProductNature=0;
        //var bYetNotMakeFEO = $("#chkYetNotMakeFEO").is(':checked');
        var sParams = _sContractorIds + "~" +
                      _sBuyerIDsAdvSearch + "~" +
                      nCboIssueDate + "~" +
                      dFromIssueDate + "~" +
                      dToIssueDate + "~" +
                      nCboValidityDate + "~" +
                      dFromValidityDate + "~" +
                      dToValidityDate + "~" +
                      nCboLCDate + "~" +
                      dFromLCDate + "~" +
                      dToLCDate + "~" +
                      nCboPIBank + "~" +
                      nCboMkPerson + "~" +
                      sCurrentStatus + "~" +
                      ncboPaymentType + "~" +
                      nPIType + "~" +
                      sStyleNo+"~"+
                      nCboStatusDate + "~" +
                      dFromStatusDate + "~" +
                      dToStatusDate + "~" +
                      _nBUID+"~"+
                      _nProductNature+"~"+
                      sPONo;
        var oExportPI = {
            Note : sParams
        };

        $.ajax({
            type: "POST",
            dataType: "json",
            url: _sBaseAddress + "/ExportPI/AdvSearch",
            traditional: true,
            data: JSON.stringify(oExportPI),
            contentType: "application/json; charset=utf-8",
            success: function (data) {
                var oExportPIs = jQuery.parseJSON(data);
                if (oExportPIs != null) {
                    if (oExportPIs.length > 0) {
                        if ($.trim(oExportPIs[0].ErrorMessage) == "") {
                            DynamicRefreshList(oExportPIs, "tblExportPIs");
                            RefreshSummary();
                            $("#winAdvSearchExportPI").icsWindow("close");
                        }
                        else {
                            alert(oExportPIs[0].ErrorMessage);
                        }
                    } else {
                        alert("Sorry, No data found.");
                        DynamicRefreshList([], "tblExportPIs");
                    }

                } else {
                    alert("Sorry, No data found.");
                    DynamicRefreshList([], "tblExportPIs");
                }
                $(".lblLoadingMessage").hide();
            }
        });
    });

    $("#btnOkAdvSearch").click(function() {
        var oExportPIs = $("#tblExportPIAdvSearch").datagrid('getChecked');
        if (oExportPIs.length > 0) {
            $("#winAdvSearchExportPI").icsWindow("close");
            if (_sControllerName == "ExportPIReport") {
                DynamicRefreshList(oExportPIs, "tblExportPIReports");
            }
            else {
                DynamicRefreshList(oExportPIs, "tblExportPIs");
            }
        }
        else {
            alert("Please select minimum one item from list.");
            return false;
        }
    });


    function LoadAllComboExportPIAdv()
    {
        //$("#cboPITypeAdv").icsLoadCombo({
        //    List: _oPIPaymentTypes,
        //    OptionValue: "id",
        //    DisplayText: "Value"
        //});

        $('#cboPITypeAdv').val(-1);//reset None

        $("#cboPaymentType").icsLoadCombo({
            List: _oPIPaymentTypes,
            OptionValue: "id",
            DisplayText: "Value"
        });

        $("#cboIssueDateAdvSearch, #cboValidityDateAdvSearch, #cboLCDateAdvSearch,#cboStatusAdvSearch").icsLoadCombo({
            List: _oCompareOperators,
            OptionValue: "id",
            DisplayText: "Value"
        });

        $("#cboPIBankAdvSearch").icsLoadCombo({
            List: _oBankBranchs,
            OptionValue: "BankBranchID",
            DisplayText: "BankBranchName"
        });

        $("#cboMkPersonAdvSearch").icsLoadCombo({
            List: _oMktPersons,
            OptionValue: "MarketingAccountID",
            DisplayText: "Name"
        });

        $("#cboBUType").icsLoadCombo({
            List: _oBUs,
            OptionValue: "BusinessUnitID",
            DisplayText: "BUTypeSt"
        });
    }
    function CheckFromAndToDateValidation(OperationComboId, FromDateId, ToDateId) {
        $("#" + OperationComboId).parent().parent().parent().find("select").removeClass("errorFieldBorder");
        var nCboVal = $("#" + OperationComboId).val();
        if (parseInt(nCboVal) == 5 || parseInt(nCboVal) == 6) {
            var fromDate = $("#" + FromDateId).datebox("getValue");
            var toDate = $("#" + ToDateId).datebox("getValue");
            if (new Date(fromDate) > new Date(toDate)) {
                $("#" + ToDateId).focus();
                $("#" + OperationComboId).addClass("errorFieldBorder");
                $(".lblLoadingMessage").hide();
                return false;
            } else {
                $("#" + OperationComboId).removeClass("errorFieldBorder");
                return true;
            }
        } else {
            return true;
        }
    }

    function ResetAdvSearchWindow() {
        _sContractorIds = '';
        _sBuyerIDsAdvSearch = "";
        $("#winAdvSearchExportPI input").not("input[type='button']").val("");
        $("#winAdvSearchExportPI input").removeClass("fontColorOfPickItem");
        $("#winAdvSearchExportPI select").val(0);
        $('#cboPITypeAdv').val(-1);//reset None
        DateActionsIssueDateAdvSearch();
        DateActionsValidityDateAdvSearch();
        DateActionsLCDateAdvSearch();
        DynamicRefreshList([],"tblExportPIAdvSearch");
        //$('#chkExportLCIsntCreateYet,#chkYetNotMakeFEO').prop('checked', false);
        $("#txtFromIssueDateAdvSearch,#txtToIssueDateAdvSearch,#txtFromValidityDateAdvSearch,#txtToValidityDateAdvSearch,#txtFromLCDateAdvSearch,#txtToLCDateAdvSearch").datebox({ disabled: true });
        $("#txtFromIssueDateAdvSearch,#txtToIssueDateAdvSearch,#txtFromValidityDateAdvSearch,#txtToValidityDateAdvSearch,#txtFromLCDateAdvSearch,#txtToLCDateAdvSearch").datebox("setValue", icsdateformat(new Date()));
        DynamicRefreshList([], "tblCurrentStatusAdvSearch");
        DynamicRefreshList(_oPIStatusObjs, "tblCurrentStatusAdvSearch");
    }

    function PickAccountOfPIAdvSearch() {
        var oContractor = {
            Params: '2,3' + '~' + $.trim($("#txtContractorAdvS").val()+"~"+_nBUID)
        };
        var obj = {
            BaseAddress: _sBaseAddress,
            Object: oContractor,
            ControllerName: "Contractor",
            ActionName: "ContractorSearchByNameType",
            IsWinClose: false
        };

        $("#progressbar").progressbar({ value: 0 });
        $("#progressbarParent").show();
        var intervalID = setInterval(updateProgress, 250);

        DynamicRefreshList([], "tblAccountsPickerAdvSearch");
        $.icsDataGets(obj, function (response) {
            clearInterval(intervalID);
            $("#progressbarParent").hide();
            if (response.status && response.objs.length > 0) {
                if (response.objs[0].ContractorID > 0) {
                    var tblColums = []; var oColumn = { field: "ContractorID", title: "Code", width: 50, align: "left" }; tblColums.push(oColumn);
                    oColumn = { field: "Name", title: "Name", width: 280, align: "left" }; tblColums.push(oColumn);

                    var oPickerParam = {
                        winid: 'winAccountOfs',
                        winclass: 'clsAccountOf',
                        winwidth: 400,
                        winheight: 460,
                        tableid: 'tblAccountOfs',
                        tablecolumns: tblColums,
                        datalist: response.objs,
                        multiplereturn: true,
                        searchingbyfieldName: 'Name',
                        windowTittle: 'Contactor List'
                    };
                    $.icsPicker(oPickerParam);
                    IntializePickerbuttonPI(oPickerParam);
                }
                else {
                    alert(response.objs[0].ErrorMessage);
                }
            }
            else {
                alert("Sorry, No Contactor Found.");
            }
        });
    }

    function PickBuyerPIAdvSearch() {
        var oContractor = {
            Params: '2' + '~' + $.trim($("#txtSearchByBuyersAdvSearch").val()+"~"+_nBUID)
        };
        var obj = {
            BaseAddress: _sBaseAddress,
            Object: oContractor,
            ControllerName: "Contractor",
            ActionName: "ContractorSearchByNameType",
            IsWinClose: false
        };
        $("#progressbar").progressbar({ value: 0 });
        $("#progressbarParent").show();
        var intervalID = setInterval(updateProgress, 250);
        DynamicRefreshList([], "tblContractorsPickerAdvSearch");
        $.icsDataGets(obj, function (response) {
            clearInterval(intervalID);
            $("#progressbarParent").hide();
            if (response.status && response.objs.length > 0) {
                if (response.objs[0].ContractorID > 0) {
                    var tblColums = []; var oColumn = { field: "ContractorID", title: "Code", width: 50, align: "left" }; tblColums.push(oColumn);
                    oColumn = { field: "Name", title: "Name", width: 280, align: "left" }; tblColums.push(oColumn);
                    var oPickerParam = {
                        winid: 'winBuyers',
                        winclass: 'clsBuyer',
                        winwidth: 400,
                        winheight: 460,
                        tableid: 'tblBuyers',
                        tablecolumns: tblColums,
                        datalist: response.objs,
                        multiplereturn: true,
                        searchingbyfieldName: 'Name',
                        windowTittle: 'Buyer List'
                    };
                    $.icsPicker(oPickerParam);
                    IntializePickerbuttonPI(oPickerParam);
                }
                else {
                    alert(response.objs[0].ErrorMessage);
                }
            }
            else {
                alert("Sorry, No Contactor Found.");
            }
        });
    }

    function DateActionsIssueDateAdvSearch() {
        DynamicDateActions("cboIssueDateAdvSearch", "txtFromIssueDateAdvSearch", "txtToIssueDateAdvSearch");
    }

    function DateActionsValidityDateAdvSearch() {
        DynamicDateActions("cboValidityDateAdvSearch", "txtFromValidityDateAdvSearch", "txtToValidityDateAdvSearch");
    }

    function DateActionsLCDateAdvSearch() {
        DynamicDateActions("cboLCDateAdvSearch", "txtFromLCDateAdvSearch", "txtToLCDateAdvSearch");
    }
    function DateActionsStatusDateAdvSearch() {
        DynamicDateActions("cboStatusAdvSearch", "txtFromStatusDateAdvSearch", "txtToStatusDateAdvSearch");
    }

    $("#btnCloseAdvSearch").click(function () {
        $("#winAdvSearchExportPI").icsWindow("close");
    });

    //Operations
    $("#txtSearchByExportPI").keyup(function (e) {
        if (e.keyCode == 13) {

            var sName=$.trim($("#txtSearchByExportPI").val());
            if(sName==null ||sName=="")
            {
                alert("Please Type PI No or part of No and Press Enter.");
                $('#txtSearchByExportPI').focus();
                return;
            }

            var oExportPI = {
                PINo : sName,
                BUID:_nBUID,
                ProductNatureInt:_nProductNature
            };

            $.ajax({
                type: "POST",
                dataType: "json",
                url: _sBaseAddress + "/ExportPI/GetsBySearchKey",
                traditional: true,
                data: JSON.stringify(oExportPI),
                contentType: "application/json; charset=utf-8",
                success: function (data) {
                    var oExportPIs = data;
                    if (oExportPIs != null) {
                        if (oExportPIs.length > 0) {
                            DynamicRefreshList(oExportPIs, "tblExportPIs");
                            RefreshSummary();
                        }
                        else {
                            DynamicRefreshList([], "tblExportPIs");
                        }
                    } else {
                        DynamicRefreshList([], "tblExportPIs");
                    }
                },
                error: function (xhr, status, error) {
                    alert(error);
                }
            });
        }
        else {

            var txtSearchBy = $("#txtSearchByExportPI").val();
            var oCurrentLists = $("#tblExportPIs").datagrid("getRows");
            var sTempSearchString = "";
            var oSearchedLists = [];
            if (e.keyCode == 8) {
                oCurrentLists = _oExportPIs;
            }
            for (var i = 0; i < oCurrentLists.length; i++) {
                sTempSearchString = oCurrentLists[i].PINo;
                var n = sTempSearchString.toUpperCase().indexOf(txtSearchBy.toUpperCase());
                if (n != -1) {
                    if (parseInt(nTextileUnitInInt) > 0) {
                        if (oCurrentLists[i].TextileUnitInInt == parseInt(nTextileUnitInInt)) {
                            oSearchedLists.push(oCurrentLists[i]);
                        }
                    }
                    else {
                        oSearchedLists.push(oCurrentLists[i]);
                    }
                }
            }
            DynamicRefreshList(oSearchedLists, "tblExportPIs");
        }
    });


    $("#btnViewExportPI").click(function () {
        var oExportPI = $("#tblExportPIs").datagrid("getSelected");
        if (oExportPI == null || oExportPI.ExportPIID <= 0) { alert("Please select an item from list!"); return; }
        var oExportPIs= $('#tblExportPIs').datagrid('getRows');
        sessionStorage.setItem("ExportPIs", JSON.stringify(oExportPIs));
        var SelectedRowIndex=$('#tblExportPIs').datagrid('getRowIndex',oExportPI);
        sessionStorage.setItem("SelectedRowIndex", SelectedRowIndex);
        sessionStorage.setItem("ExportPIHeader", "View Export PI");
        sessionStorage.setItem("BUID", oExportPI.BUID);
        sessionStorage.setItem("ProductNature", _nProductNature);
        sessionStorage.setItem("BackLink", window.location.href);
        window.location.href = _sBaseAddress+ "/ExportPI/ViewExportPI_Tex?id="+parseInt(oExportPI.ExportPIID)+"&buid="+oExportPI.BUID;
    });


    //Pi info update start
    $("#btnPickUpdatePIInfo").click(function(){
        var oExportPI= $('#tblExportPIs').datagrid('getSelected');
        if(oExportPI==null || oExportPI.ExportPIID<=0)
        {
            alert("Invalid Field!!! please select a valid Field!");
            return false;
        }
        if (oExportPI.ExportPIID > 0)
        {
            $.ajax
            ({
                type: "POST",
                dataType: "json",
                url : _sBaseAddress+"/ExportPI/GetExportPI",
                data: JSON.stringify(oExportPI),
                contentType: "application/json; charset=utf-8",
                success: function (data) {
                    var oExportPI = jQuery.parseJSON(data);
                    if (parseInt(oExportPI.ExportPIID)>0)
                    {
                        $('#txtSCRemarks').val(oExportPI.SCRemarks);
                        $('#txtMasterContactNo').val(oExportPI.MasterContactNo);
                        $('#txtPartyName').val(oExportPI.PartyName==""?oExportPI.ContractorName:oExportPI.PartyName);
                        $('#txtPartyAddress').val(oExportPI.PartyAddress==""?oExportPI.ContractorAddress:oExportPI.PartyAddress);
                        $('#txtConversionRate').val(oExportPI.ConversionRate);
                        $('#txtBankChargeInfo').val(oExportPI.BankChargeInfo);
                        $('#txtBankCharge').val(oExportPI.BankCharge);
                        $("#winExportPIInfo").icsWindow("open", "Export PI Update Info");
                    }
                    else
                    {
                        alert(oExportPI.ErrorMessage);
                    }
                },
                error: function (xhr, status, error)
                {
                    alert(error);
                }
            });
        }
    });

    $("#btnloadPriviousRemarks").click(function(){
        var oExportPI={};
        $.ajax
            ({
                type: "POST",
                dataType: "json",
                url : _sBaseAddress+"/ExportPI/GetPriviousSCRemarks",
                data: JSON.stringify(oExportPI),
                contentType: "application/json; charset=utf-8",
                success: function (data) {
                    var oExportPI = jQuery.parseJSON(data);
                    if (parseInt(oExportPI.ExportPIID)>0)
                    {
                        $('#txtSCRemarks').val(oExportPI.SCRemarks);
                    }
                    else
                    {
                        alert(oExportPI.ErrorMessage);
                    }
                },
                error: function (xhr, status, error)
                {
                    alert(error);
                }
            });

    });

    $("#btnUpdatePIInfo").click(function(){
        var oNewExportPI= $('#tblExportPIs').datagrid('getSelected');
        if(oNewExportPI==null || oNewExportPI.ExportPIID<=0)
        {
            alert("Invalid Field!!! please select a valid Field!");
            return ;
        }
        if(($('#txtBankChargeInfo').val()==""||$('#txtBankChargeInfo').val()==null ) && parseFloat(icsRemoveComma($('#txtBankCharge').val()))>0)
        {
            alert("Please Type Both Bank Charge Info and Bank Charge.");
            return;
        }
        if($('#txtBankChargeInfo').val()!="" && parseFloat(icsRemoveComma($('#txtBankCharge').val()))<=0)
        {
            alert("Please Type Both Bank Charge Info and Bank Charge.");
            return;
        }

        var SelectedRowIndex=$('#tblExportPIs').datagrid('getRowIndex',oNewExportPI);
        var oExportPI = {
            ExportPIID:oNewExportPI.ExportPIID,
            ConversionRate:parseFloat(icsRemoveComma($('#txtConversionRate').val())),
            SCRemarks  :$('#txtSCRemarks').val(),
            MasterContactNo:$('#txtMasterContactNo').val(),
            PartyName:$('#txtPartyName').val(),
            PartyAddress:$('#txtPartyAddress').val(),
            BankChargeInfo :$('#txtBankChargeInfo').val(),
            BankCharge :parseFloat(icsRemoveComma($('#txtBankCharge').val()))
        };
        $.ajax({
            type: "POST",
            dataType: "json",
            url: _sBaseAddress + "/ExportPI/UpdateExportPI",
            traditional: true,
            data: JSON.stringify(oExportPI),
            contentType: "application/json; charset=utf-8",
            success: function (data) {
                var oExportPI = jQuery.parseJSON(data);
                if (parseInt(oExportPI.ExportPIID)>0 && (oExportPI.ErrorMessge==null || oExportPI.ErrorMessge==""))
                {
                    alert("Successfully Updated.");
                    $('#tblExportPIs').datagrid('updateRow',{index: SelectedRowIndex,	row: oExportPI});
                    $("#winExportPIInfo").icsWindow("close");

                } else {
                    alert(oExportPI.ErrorMessge);
                }

            },
            error: function (xhr, status, error) {
                alert(error);
            }
        });

    });

    $("#btnClosePIInfo").click(function(){
        $("#winExportPIInfo").icsWindow("close");
    });
    //pi info updte end

    $("#btnReqForApprovePI").click(function () {
        var oExportPI = $("#tblExportPIs").datagrid("getSelected");
        if (oExportPI == null || parseInt(oExportPI.ExportPIID) <= 0) { alert("Please select an item from list!"); return; }
        if (parseInt(oExportPI.PIStatusInInt) != 0) { alert("Please select an initialize item!"); return; }
        if (!confirm("Confirm to Request for Approved?")) return false;
        var nRowIndex = $('#tblExportPIs').datagrid('getRowIndex', oExportPI);
        var sSuccessMessage = "Successfully Request for Approved";
        oExportPI.ExportPIActionInInt = 1;
        UpdatePIStatus(oExportPI, sSuccessMessage, nRowIndex);
    });

    $("#btnUndoReqPI").click(function () {
        var oExportPI = $("#tblExportPIs").datagrid("getSelected");
        if (oExportPI == null || parseInt(oExportPI.ExportPIID) <= 0) { alert("Please select an item from list!"); return; }
        if (parseInt(oExportPI.PIStatusInInt) != 1) { alert("Please select an Req for Approved item!"); return; }
        if (!confirm("Confirm to Undo Request?")) return false;
        var nRowIndex = $('#tblExportPIs').datagrid('getRowIndex', oExportPI);
        var sSuccessMessage = "Successfully Undo Request";
        oExportPI.ExportPIActionInInt = 2;
        UpdatePIStatus(oExportPI, sSuccessMessage, nRowIndex);
    });

    $("#btnApprovePI").click(function () {
        var oExportPI = $("#tblExportPIs").datagrid("getSelected");
        if (oExportPI == null || parseInt(oExportPI.ExportPIID) <= 0) { alert("Please select an item from list!"); return; }
        if (parseInt(oExportPI.PIStatusInInt) != 1) { alert("Please select an Req for Approved item!"); return; }
        if (!confirm("Confirm to Approved?")) return false;
        var nRowIndex = $('#tblExportPIs').datagrid('getRowIndex', oExportPI);
        var sSuccessMessage = "Successfully Approved";
        oExportPI.ExportPIActionInInt = 3;
        UpdatePIStatus(oExportPI, sSuccessMessage, nRowIndex);
    });

    $("#btnUndoApprovePI").click(function () {
        //Ratin
        var oExportPI = $("#tblExportPIs").datagrid("getSelected");
        if (oExportPI == null || parseInt(oExportPI.ExportPIID) <= 0) { alert("Please select an item from list!"); return; }
        if (parseInt(oExportPI.PIStatusInInt) != 2) { alert("Please select an Approved item!"); return; }
        if (!confirm("Confirm to Undo Approved?")) return false;
        var nRowIndex = $('#tblExportPIs').datagrid('getRowIndex', oExportPI);
        var sSuccessMessage = "Successfully Undo Approved";
        oExportPI.ExportPIActionInInt = 4;
        UpdatePIStatus(oExportPI, sSuccessMessage, nRowIndex);
    });

    $("#btnPIIssuePI").click(function () {
        var oExportPI = $("#tblExportPIs").datagrid("getSelected");
        if (oExportPI == null || parseInt(oExportPI.ExportPIID) <= 0) { alert("Please select an item from list!"); return; }
        if (parseInt(oExportPI.PIStatusInInt) != 2) { alert("Please select an Approved item!"); return; }
        if (!confirm("Confirm to PI Issue?")) return false;
        var nRowIndex = $('#tblExportPIs').datagrid('getRowIndex', oExportPI);
        var sSuccessMessage = "Successfully PI Issue";
        oExportPI.ExportPIActionInInt = 5;
        UpdatePIStatus(oExportPI, sSuccessMessage, nRowIndex);
    });
    $("#btnApproveNew").click(function(){
        debugger;
        var oExportPI = $("#tblExportPIs").datagrid("getSelected");
        if (oExportPI == null || parseInt(oExportPI.ExportPIID) <= 0) { alert("Please select an item from list!"); return; }
        
        var SelectedRowIndex=$('#tblExportPIs').datagrid('getRowIndex',oExportPI);
        if (oExportPI) 
        {
            $.ajax
            ({
                type: "POST",
                dataType: "json",                
                url : _sBaseAddress+  "/ExportPI/Approve",
                data: JSON.stringify(oExportPI),
                contentType: "application/json; charset=utf-8",
                success: function (data) {
                    debugger;
                    var oExportPI = data;
                    if (oExportPI.ErrorMessage == "") 
                    {
                        alert("Approved Successfully");                        
                        $('#tblExportPIs').datagrid('updateRow', { index: SelectedRowIndex, row: oExportPI });
                    }
                    else
                    {
                        alert(oExportPI.ErrorMessage);
                    }
                },
                error: function (xhr, status, error) 
                {
                    alert(error);
                }
            });
        }
    });
    $("#btnReqForRevisePI").click(function () {
        var oExportPI = $("#tblExportPIs").datagrid("getSelected");
        if (oExportPI == null || parseInt(oExportPI.ExportPIID) <= 0) { alert("Please select an item from list!"); return; }
        if (parseInt(oExportPI.PIStatusInInt) == 0 || parseInt(oExportPI.PIStatusInInt) == 1 || parseInt(oExportPI.PIStatusInInt) == 5 || parseInt(oExportPI.PIStatusInInt) == 6) { alert("In this stage Export PI Can't Revise!"); return; }
        if (!confirm("Confirm to Req for Revise?")) return false;
        var nRowIndex = $('#tblExportPIs').datagrid('getRowIndex', oExportPI);
        var sSuccessMessage = "Successfully Req for Revise";
        oExportPI.ExportPIActionInInt = 7;
        UpdatePIStatus(oExportPI, sSuccessMessage, nRowIndex);
    });

    $("#btnCancelPI").click(function () {
        var oExportPI = $("#tblExportPIs").datagrid("getSelected");
        if (oExportPI == null || parseInt(oExportPI.ExportPIID) <= 0) { alert("Please select an item from list!"); return; }
        if (parseInt(oExportPI.PIStatusInInt) == 4 || parseInt(oExportPI.PIStatusInInt) == 5 || parseInt(oExportPI.PIStatusInInt) == 6) { alert("In this stage Export PI Can't Cancle!"); return; }
        if (!confirm("Confirm to Cancel Export PI?")) return false;
        var nRowIndex = $('#tblExportPIs').datagrid('getRowIndex', oExportPI);
        var sSuccessMessage = "Successfully Export PI Cancel";
        oExportPI.ExportPIActionInInt = 8;
        UpdatePIStatus(oExportPI, sSuccessMessage, nRowIndex);
    });

    $("#btnPreViewPI").click(function () {
        debugger;
        var oExportPI = $('#tblExportPIs').datagrid('getSelected');
        if (oExportPI == null || oExportPI.ExportPIID <= 0) {
            alert("Please select an item from list!");
            return;
        }
        window.open(_sBaseAddress + '/ExportPI/PrintoExportPIPreview?id='+oExportPI.ExportPIID+ "&bPrintFormat="+sessionStorage.getItem("QtyFormat") + "&nTitleTypeInImg="+sessionStorage.getItem("ImageFormat"), "_blank");
    });


    $("#btnPreViewPITwo").click(function () {
        debugger;
        var oExportPI = $('#tblExportPIs').datagrid('getSelected');
        if (oExportPI == null || oExportPI.ExportPIID <= 0) {
            alert("Please select an item from list!");
            return;
        }
        window.open(_sBaseAddress + '/ExportPI/PrintoExportPIPreviewTwo?id='+oExportPI.ExportPIID+ "&bPrintFormat="+sessionStorage.getItem("QtyFormat") + "&nTitleTypeInImg="+sessionStorage.getItem("ImageFormat"), "_blank");
    });

    $("#btnPrintBill").click(function () {
        debugger;
        var oExportPI = $('#tblExportPIs').datagrid('getSelected');
        if (oExportPI == null || oExportPI.ExportPIID <= 0) {
            alert("Please select an item from list!");
            return;
        }
        window.open(_sBaseAddress + '/ExportPI/PrintBillPreview?id='+oExportPI.ExportPIID+ "&bPrintFormat="+sessionStorage.getItem("QtyFormat") + "&nTitleTypeInImg="+sessionStorage.getItem("ImageFormat"), "_blank");
    });

    $("#btnPrintSalesContract").click(function () {
        debugger;
        var oExportPI = $('#tblExportPIs').datagrid('getSelected');
        if (oExportPI == null || oExportPI.ExportPIID <= 0) {
            alert("Please select an item from list!");
            return;
        }
        window.open(_sBaseAddress + '/ExportPI/PrintSalesContractPreview?id='+oExportPI.ExportPIID+ "&bPrintFormat="+sessionStorage.getItem("QtyFormat") + "&nTitleTypeInImg="+sessionStorage.getItem("ImageFormat"), "_blank");
    });

    $("#btnAdvSearchExportPI").click(function () {
        debugger;
        $("#winAdvSearchExportPI").icsWindow("open", "Export PI Advance Search");
        DynamicRefreshList([], "tblExportPIAdvSearch");
        DynamicResetAdvSearchWindow("winAdvSearchExportPI");
        DynamicDateActions("cboDateOptionAdvSearch", "txtFromDateAdvSearch", "txtToDateAdvSearch");
        DynamicDateActions("cboValidityDateAdvSearch", "txtFromValidityDateAdvSearch", "txtToValidityDateAdvSearch");
        DynamicDateActions("cboLCDateAdvSearch", "txtFromLCDateAdvSearch", "txtToLCDateAdvSearch");
        DynamicDateActions("cboStatusAdvSearch", "txtFromStatusDateAdvSearch", "txtToStatusDateAdvSearch");
        ResetAdvSearchWindow();
    });

    $("#btnAcceptRevisePI").click(function () {
        debugger;

        var oExportPI = $("#tblExportPIs").datagrid("getSelected");
        if (oExportPI == null || oExportPI.ExportPIID <= 0) { alert("Please select an item from list!"); return; }
        var oExportPIs= $('#tblExportPIs').datagrid('getRows');
        sessionStorage.setItem("ExportPIs", JSON.stringify(oExportPIs));
        var SelectedRowIndex=$('#tblExportPIs').datagrid('getRowIndex',oExportPI);
        sessionStorage.setItem("SelectedRowIndex", SelectedRowIndex);
        sessionStorage.setItem("ExportPIHeader", "Revise Export PI");
        sessionStorage.setItem("BUID",oExportPI.BUID);
        sessionStorage.setItem("BackLink", window.location.href);
        window.location.href = _sBaseAddress+ "/ExportPI/ViewExportPI_Tex?id="+parseInt(oExportPI.ExportPIID)+"&buid="+oExportPI.BUID;

    });

    $('#btnAddPO').click(function(e){
        debugger;
        var oExportPI = $("#tblExportPIs").datagrid("getSelected");
        if (oExportPI == null || oExportPI.ExportPIID <= 0) { alert("Please select an item from list!"); return; }
        var SelectedRowIndex=$('#tblExportPIs').datagrid('getRowIndex',oExportPI);
        if( oExportPI.ApprovedBy==0)
        {
            alert("This P/I Yet Not Approve.");
            return;
        }
        if(!confirm("Confirm To Create Invoice")) return false;

        $.ajax({
            type: "POST",
            dataType: "json",
            url : _sBaseAddress+"/ExportPI/CreateAutoPO",
            traditional: true,
            data:  JSON.stringify(oExportPI),
            contentType: "application/json; charset=utf-8",
            success: function (data) {
                var  oExportPI = jQuery.parseJSON(data);
                debugger;
                if (oExportPI.ErrorMessage == '' || oExportPI.ErrorMessage == null)
                {
                    debugger;
                    $('#tblExportPIs').datagrid('updateRow', { index: nSelectedIndex, row: oExportPI });

                }
                else
                {
                    alert(oExportPI.ErrorMessage);

                }
            },
            error: function (xhr, status, error)
            {
                alert(xhr+'~' +status+'~'+error);
            }
        });
    });

    $("#btnHistoryPI").click(function () {
        var oExportPI = $("#tblExportPIs").datagrid("getSelected");
        if (oExportPI == null || oExportPI.ExportPIID <= 0) {
            alert("Please select an item from list.");
            return false;
        }
        var oExportPIHistory = {
            ExportPIID: oExportPI.ExportPIID
        };

        $.ajax({
            type: "POST",
            dataType: "json",
            url: _sBaseAddress + "/ExportPI/GetExportPIHistory",
            traditional: true,
            data: JSON.stringify(oExportPIHistory),
            contentType: "application/json; charset=utf-8",
            success: function (data) {
                var oExportPIHistorys = jQuery.parseJSON(data);
                if (oExportPIHistorys != null) {
                    if (oExportPIHistorys.length > 0) {
                        DynamicRefreshList(oExportPIHistorys, "tblExportPIHistory");
                    }
                    else {
                        DynamicRefreshList([], "tblExportPIHistory");
                    }
                } else {
                    DynamicRefreshList([], "tblExportPIHistory");
                }
                $("#winExportPIHistory").icsWindow("open", "Export PI History For PI No : " + oExportPI.PINo);
            },
            error: function (xhr, status, error) {
                alert(error);
            }
        });

    });

    $("#btnCloseExportPIHistory").click(function () {
        $("#winExportPIHistory").icsWindow("close");
    });

    function IntializePickerbuttonPI(oPickerobj) {
        $("#" + oPickerobj.winid).find("#btnOk").click(function () {
            SetPickerValueAssignPI(oPickerobj);
        });
        $(document).find('.' + oPickerobj.winclass).keydown(function (e) {
            if (e.which === 13) {
                SetPickerValueAssignPI(oPickerobj);
            }
        });
    }

    function SetPickerValueAssignPI(oPickerobj) {
        var oreturnObj = null, oreturnObjs = [];
        if (oPickerobj.multiplereturn) {
            oreturnObjs = $('#' + oPickerobj.tableid).datagrid('getChecked');
        } else {
            oreturnObj = $('#' + oPickerobj.tableid).datagrid('getSelected');
        }

        if (oPickerobj.winid == 'winAccountOfs')
        {
            if (oreturnObjs != null && oreturnObjs.length> 0)
            {

                _sContractorIds=''; var sMessage='';
                sMessage=(oreturnObjs.length>1)? oreturnObjs.length +" Contractors Selected" : oreturnObjs[0].Name;
                $('#txtContractorAdvS').val(sMessage);
                $("#txtContractorAdvS").addClass("fontColorOfPickItem");

                for(var i=0;i<oreturnObjs.length;i++){
                    _sContractorIds=_sContractorIds+oreturnObjs[i].ContractorID+',';
                }
                _sContractorIds=_sContractorIds.substring(0,_sContractorIds.length-1);

            }
            else
            {
                alert("Please select a contractor.");
                return false;
            }
        }
        else if (oPickerobj.winid == 'winBuyers') {
            if (oreturnObjs != null && oreturnObjs.length> 0)
            {
                _sBuyerIDsAdvSearch='';
                var sMessage='';
                sMessage=(oreturnObjs.length>1)? oreturnObjs.length +" Contractors Selected" : oreturnObjs[0].Name;
                $('#txtSearchByBuyersAdvSearch').val(sMessage);
                $("#txtSearchByBuyersAdvSearch").addClass("fontColorOfPickItem");

                for(var i=0;i<oreturnObjs.length;i++){
                    _sBuyerIDsAdvSearch=_sBuyerIDsAdvSearch+oreturnObjs[i].ContractorID+',';
                }
                _sBuyerIDsAdvSearch=_sBuyerIDsAdvSearch.substring(0,_sBuyerIDsAdvSearch.length-1);



            }
            else
            {
                alert("Please select a buyer.");
                return false;
            }
        }

        $("#" + oPickerobj.winid).icsWindow("close");
        $("#" + oPickerobj.winid).remove();
    }
    $("#btnRequestFor").click(function(){
        var oExportPI= $('#tblExportPIs').datagrid('getSelected');
        if(oExportPI==null || oExportPI.ExportPIID<=0)
        {
            alert("Please select a item from list!");
            return;
        }
        var SelectedRowIndex=$('#tblExportPIs').datagrid('getRowIndex',oExportPI);
        var tsv=((new Date()).getTime())/1000;
        var oExportPIs= $('#tblExportPIs').datagrid('getRows');
        sessionStorage.setItem("ExportPIs", JSON.stringify(oExportPIs));
        sessionStorage.setItem("SelectedRowIndex", SelectedRowIndex);
        sessionStorage.setItem("ExportPIHeader", "Approve ExportPI");
        sessionStorage.setItem("BackLink", window.location.href);
        window.location.href = _sBaseAddress+  "/ExportPI/ViewExportPISignatorys?id="+oExportPI.ExportPIID+"&ts="+tsv;
    });

    $("#btnPrintFormat").click(function () {
        debugger;
        if(sessionStorage.getItem("QtyFormat")=="true")
        {
            $("#chkInKg").prop( "checked", false );
            $("#chkInLBS").prop( "checked", true );
        }else{
            $("#chkInLBS").prop( "checked", false );
            $("#chkInKg").prop( "checked", true );
        }
        if(parseInt(sessionStorage.getItem("ImageFormat"))==1)
        {
            $("#chkPrintTitleInNormalFormat").prop( "checked",true);
            $("#chkPrintTitlePadFormat").prop( "checked", false );
            $("#chkPrintTitleImageFormat").prop( "checked", false );
        }else if(parseInt(sessionStorage.getItem("ImageFormat"))==2)
        {
            $("#chkPrintTitleInNormalFormat").prop( "checked",false);
            $("#chkPrintTitlePadFormat").prop( "checked", true );
            $("#chkPrintTitleImageFormat").prop( "checked", false );
        }else
        {
            $("#chkPrintTitleInNormalFormat").prop( "checked",false);
            $("#chkPrintTitlePadFormat").prop( "checked", false );
            $("#chkPrintTitleImageFormat").prop( "checked", true );
        }
        $("#winPrintFormat2").icsWindow("open","PI Print Format Setup");
    });

    $("#btnClosePrintFormat2").click(function () {
        $("#winPrintFormat2").icsWindow("close");
    });

    $("#btnOkPrintFormat2").click(function () {
        debugger;
        $("#winPrintFormat2").icsWindow("close");

        if ($("#chkInLBS").is(':checked'))
        {
            sessionStorage.setItem("QtyFormat",true);
        }else{
            sessionStorage.setItem("QtyFormat",false);
        }

        if ($("#chkPrintTitleInNormalFormat").is(':checked'))
        {
            sessionStorage.setItem("ImageFormat",1);//normal
        }else if ($("#chkPrintTitlePadFormat").is(':checked'))
        {
            sessionStorage.setItem("ImageFormat",2);//pad
        }else if ($("#chkPrintTitleImageFormat").is(':checked'))
        {
            sessionStorage.setItem("ImageFormat",3);//with Image
        }
    });


    //Start Revise History
    $("#btnReviseHistoryPI").click(function () {
        var oExportPI = $("#tblExportPIs").datagrid("getSelected");
        if (oExportPI == null || oExportPI.ExportPIID <= 0) {
            alert("Please select an item from list.");
            return false;
        }
        $("#winReviseHistory").icsWindow("open", "Revise History of PI No : " + oExportPI.PINo);
        $.ajax({
            type: "POST",
            dataType: "json",
            url: _sBaseAddress + "/ExportPI/GetReviseHistory",
            traditional: true,
            data: JSON.stringify(oExportPI),
            contentType: "application/json; charset=utf-8",
            success: function (data) {
                var oExportPIs = jQuery.parseJSON(data);
                if(oExportPIs!=null){
                    if(oExportPIs.length>0){
                        DynamicRefreshList(oExportPIs,"tblReviseHistory");
                    }
                    else{
                        DynamicRefreshList([],"tblReviseHistory");
                    }
                }
            },
            error: function (xhr, status, error) {
                alert(error);
            }
        });
    });
    $("#btnPISwap").click(function () {

        var oExportPI = $("#tblExportPIs").datagrid("getSelected");
        if (oExportPI == null || oExportPI.ExportPIID <= 0) {
            alert("Please select an item from list.");
            return ;
        }
        var SelectedRowIndex=$('#tblExportPIs').datagrid('getRowIndex',oExportPI);

        var oExportPILog = $("#tblReviseHistory").datagrid("getSelected");
        if (oExportPILog == null || oExportPILog.ExportPILogID <= 0) {
            alert("Please select an item from list.");
            return ;
        }
        var SelectedRowIndexLog=$('#tblReviseHistory').datagrid('getRowIndex',oExportPILog);

        if (!confirm("Confirm to exchange this PI?")) return false;
        $.ajax({
            type: "POST",
            dataType: "json",
            url: _sBaseAddress + "/ExportPI/PISWAP",
            traditional: true,
            data: JSON.stringify(oExportPILog),
            contentType: "application/json; charset=utf-8",
            success: function (data) {
                var oExportPILogNew = jQuery.parseJSON(data);

                if(oExportPILogNew.ErrorMessage=="" || oExportPILogNew.ErrorMessage==null)
                {
                    $('#tblExportPIs').datagrid('updateRow',{index: SelectedRowIndex,	row: oExportPILogNew});
                    $('#tblReviseHistory').datagrid('updateRow',{index: SelectedRowIndexLog,	row: oExportPI});
                }
                else
                {
                    alert(oExportPILogNew.ErrorMessage);
                    return;
                }
            },
            error: function (xhr, status, error) {
                alert(error);
            }
        });
    });

    $("#btnCloseReviseHistory").click(function () {
        $("#winReviseHistory").icsWindow("close");
    });

    $("#btnPrintReviseHistory").click(function () {
        var oExportPILog = $("#tblReviseHistory").datagrid("getSelected");
        if (oExportPILog == null || oExportPILog.ExportPILogID <= 0) {
            alert("Please select an item from list.");
            return false;
        }
        window.open(_sBaseAddress + '/ExportPI/PrintExportPIPreviewLog?id='+oExportPILog.ExportPILogID+ "&bPrintFormat="+sessionStorage.getItem("QtyFormat") + "&nTitleTypeInImg="+sessionStorage.getItem("ImageFormat"), "_blank");
    });
    //End Revise History

    $("#btnDeliveryBill").click(function () {
        var oExportPI = $("#tblExportPIs").datagrid("getSelected");
        if (oExportPI == null || oExportPI.ExportPIID <= 0) {
            alert("Invalid Field!!! please select a valid Field!");
            return false;
        }
        SetExportPIInfoToDeliveryBill(oExportPI);

    });

    $("#btnDOPI").click(function () {

        var oExportPI = $("#tblExportPIs").datagrid("getSelected");
        if (oExportPI == null || oExportPI.ExportPI <= 0) {
            alert("Please select an item from list.");
            return false;
        }
        if (oExportPI.PIStatusInInt < 2) // 2 = Approve
        {
            alert("Please select an approve Export PI");
            return false;
        }
        if (oExportPI.PIStatusInInt == 6) // 6 = Cancel
        {
            alert("This PI already Cancel.");
            return false;
        }
        if (oExportPI.TextileUnitInInt != 2 && oExportPI.TextileUnitInInt != 1) // 2 = Weaving
        {
            alert("Please select PI which Type is Weaving or Spinning");
            return false;
        }

        //
        //var oExportPIs = $("#tblExportPIs").datagrid("getRows");
        //var abc = JSON.prune(oExportPIs);
        //sessionStorage.setItem("ExportPIs", JSON.prune(oExportPIs));

        if (oExportPI.TextileUnitInInt == 2) // Weaving = 2
        {
            var oFabricDeliveryOrder = {
                FDOID: 0,
                FEOID: oExportPI.ExportPIID
            };

            var obj = {
                BaseAddress: _sBaseAddress,
                TableId: "",
                OpenedPageTitle: "Add Fabric Delivery Order",
                Object: oFabricDeliveryOrder,
                ObjectId: oFabricDeliveryOrder.FDOID + "~" + oFabricDeliveryOrder.FEOID,
                PrimaryKeyName: "FDOID",
                ControllerName: "FabricDeliveryOrder",
                ActionName: "ViewFabricDeliveryOrder",
                BtnID: $(this).attr("id")
            };
            $.icsOpenPickerInNewPage(obj);
        }
        else if (oExportPI.TextileUnitInInt == 1)  //Spinning = 1
        {
            var oSUDeliveryOrder = {
                SUDeliveryOrderID: 0,
                ExportPIID: oExportPI.ExportPIID
            };

            var obj = {
                BaseAddress: _sBaseAddress,
                TableId: "",
                OpenedPageTitle: "Add SU Delivery Order",
                Object: oSUDeliveryOrder,
                ObjectId: oSUDeliveryOrder.SUDeliveryOrderID + "~" + oSUDeliveryOrder.ExportPIID,
                PrimaryKeyName: "SUDeliveryOrderID",
                ControllerName: "SUDeliveryOrder",
                ActionName: "View_SUDeliveryOrder",
                BtnID: $(this).attr("id")
            };
            $.icsOpenPickerInNewPage(obj);
        }
    });

    $("#btnCopyPI").click(function () {
        var oExportPI = $("#tblExportPIs").datagrid("getSelected");
        if (oExportPI == null || oExportPI.ExportPIID <= 0) {
            alert("Please select an item from list.");
            return false;
        }
        var oExportPIs= $('#tblExportPIs').datagrid('getRows');
        sessionStorage.setItem("ExportPIs", JSON.stringify(oExportPIs));
        sessionStorage.setItem("SelectedRowIndex", -1);
        sessionStorage.setItem("ExportPIHeader", "Copy Export PI");
        sessionStorage.setItem("BUID", oExportPI.BUID);
        sessionStorage.setItem("BackLink", window.location.href);
        window.location.href = _sBaseAddress+ "/ExportPI/ViewExportPI?id="+oExportPI.ExportPIID+"&buid="+oExportPI.BUID;
    });

    function RefreshList(oExportPIs)
    {
        debugger;
        var data=oExportPIs;
        data={"total":""+data.length+"","rows":data};
        $('#tblExportPIs').datagrid('loadData',data);
        var nIndex= parseInt(sessionStorage.getItem("SelectedRowIndex"));
        $('#tblExportPIs').datagrid('selectRow',nIndex);
    }

    function GetExportPIInformation(oExportPI,sBtnId) {
        var obj =
        {
            BaseAddress: _sBaseAddress,
            Object: oExportPI,
            ControllerName: "ExportPI",
            ActionName: "GetExportPI",
            IsWinClose: false
        };

        $.icsDataGet(obj, function (response) {
            if (response.status && response.obj != null) {
                if (response.obj.ExportPIID > 0)
                {
                    RefreshExportPIControl(response.obj, sBtnId);
                }
                else {
                    alert(response.obj.ErrorMessage);
                }
            }
            else {
                alert("No information found.");
            }
        });
    }

    function RefreshExportPILayout(buttonId) {
        $("#btnProductFormDeliveryBill").hide();
        if (buttonId === "btnViewExportPI") {
            $("#winExportPI :input").prop("disabled", true);
            $("#btnSaveExportPI").hide();
            $("#btnPIIssue").hide();
            $("#btnAddTermsAndConditon").hide();
            $("#btnRemoveTermsAndCondition").hide();
            // $("#btnProductAdd").hide();
            $("#btnProductRemove").hide();
        }
        else {
            $("#winExportPI :input").not("#txtPINo").prop("disabled", false);
            $("#btnSaveExportPI").show();
            $("#btnPIIssue").show();
            $("#btnAddTermsAndConditon").show();
            $("#btnRemoveTermsAndCondition").show();
            //  $("#btnProductAdd").show();
            $("#btnProductRemove").show();
        }

        $("#btnAcceptReviseExportPI, #btnAcceptRevisePITAndC").hide();
        setInterval(function () { ReloadTableExportPIDetail(); }, 1000);
        _sBtnId = buttonId;

        if (buttonId == "btnCopyPI") {
            $("#btnCopyExportPI,#btnCopy2ndTab").show();
            $("#btnSaveExportPI,#btnPIIssue").hide();
        } else {
            $("#btnCopyExportPI,#btnCopy2ndTab").hide();
            $("#btnSaveExportPI,#btnPIIssue").show();
        }

        if (buttonId == "btnViewExportPI")
        {
            $("#btnSaveExportPI").hide();
            $("#btnPIIssue").hide();
        }
    }

    function DisabledEnabledAccRevEPI()
    {
        $("#winExportPI :input").not("#txtPINo").prop("disabled", false);
        $("#btnSaveExportPI").show();
        $("#btnPIIssue").show();
        $("#btnAddTermsAndConditon").show();
        $("#btnRemoveTermsAndCondition").show();
        //  $("#btnProductAdd").show();
        $("#btnProductRemove").show();
        //  $("#txtIssueDate").datebox({ disabled: true });
        setInterval(function () { ReloadTableExportPIDetail(); }, 1000);
    }
    function Approve()
    {
        //debugger;
        var oExportPI= $('#tblExportPIs').datagrid('getSelected');
        if(oExportPI==null || oExportPI.ExportPIID<=0)
        {
            alert("Please select a item from list!");
            return;
        }
        var SelectedRowIndex=$('#tblExportPIs').datagrid('getRowIndex',oExportPI);
        var tsv=((new Date()).getTime())/1000;
        var oExportPIs= $('#tblExportPIs').datagrid('getRows');
        sessionStorage.setItem("ExportPIs", JSON.stringify(oExportPIs));
        sessionStorage.setItem("SelectedRowIndex", SelectedRowIndex);
        sessionStorage.setItem("ExportPIHeader", "Approve ExportPI");
        sessionStorage.setItem("BackLink", window.location.href);
        window.location.href = _sBaseAddress+  "/ExportPI/ViewExportPI_Approve?id="+oExportPI.ExportPIID+"&ts="+tsv;
    }
    function RefreshExportPIControl(oExportPI, sBtnId) {

        _oExportPI = oExportPI;
        if (_oExportPI.TextileUnitInInt == 3) {
            $("#btnProductFormDeliveryBill").show();
        } else {
            $("#btnProductFormDeliveryBill").hide();
        }
        DynamicRefreshList(_oExportPI.ExportPIDetails, "tblPIDetails");
        DynamicRefreshList(_oExportPI.ExportPITandCClauses, "tblPITandCClauses");
        DynamicRefreshList(_oExportPI.ExportPITandCClauses, "tblPITandCClausesTwo");
        RefreshTotalSummery();
        $('#cboTextileUnit').val(_oExportPI.TextileUnitInInt);
        $('#cboPaymentType').val(_oExportPI.PaymentTypeInInt);
        $('#txtPINo').val(_oExportPI.PINo);
        $('#txtIssueDate').datebox('setValue', _oExportPI.IssueDateInString);
        $('#txtValidateDate').datebox('setValue', _oExportPI.ValidityDateInString);
        if (_oExportPI.ContractorID > 0) {
            $("#txtSearchByAccountOfPI").addClass("fontColorOfPickItem");
        } else {
            $("#txtSearchByAccountOfPI").removeClass("fontColorOfPickItem");
        }
        $('#txtSearchByAccountOfPI').val(_oExportPI.ContractorName);
        if (_oExportPI.BuyerID > 0) {
            $("#txtSearchByBuyerPI").addClass("fontColorOfPickItem");
        } else {
            $("#txtSearchByBuyerPI").removeClass("fontColorOfPickItem");
        }
        $('#txtSearchByBuyerPI').val(_oExportPI.BuyerName);
        if (_oExportPI.DeliveryToID > 0) {
            $("#txtSearchByDeliveryToPI").addClass("fontColorOfPickItem");
        } else {
            $("#txtSearchByDeliveryToPI").removeClass("fontColorOfPickItem");
        }
        $('#txtSearchByDeliveryToPI').val(_oExportPI.DeliveryToName);
        $('#txtMktPersonPI').val(_oExportPI.MKTPName);
        $('#cboBank').val(_oExportPI.BankBranchID);
        LoadBankBranchAccounts(_oExportPI.BankBranchID, _oExportPI.BankAccountID);
        $('#cboCurrency').val(_oExportPI.CurrencyID);
        $('#cboLiborRate').val(_oExportPI.IsLIBORRateInInt);
        $('#cboLCTerm').val(_oExportPI.LCTermID);
        $('#cboBankFDD').val(_oExportPI.IsBBankFDDInInt);
        $('#txtOverDueRate').numberbox('setValue', parseFloat(_oExportPI.OverdueRate));
        $('#txtLCOpenDate').datebox('setValue', _oExportPI.LCOpenDateInST);
        $('#txtDeliveryDate').datebox('setValue', _oExportPI.DeliveryDateInST);
        $("#cboMktPersons").val(_oExportPI.MKTEmpID);
        $('#cboShipmentTermFDD').val(_oExportPI.ShipmentTermInInt);
        $("#txtNote").val(_oExportPI.Note);
        $("#txtColorInfo").val(_oExportPI.ColorInfo);
        $("#cboDepthOfShade option:contains(" + _oExportPI.DepthOfShade + ")").attr('selected', 'selected');
        $("#txtYarnCount").val(_oExportPI.YarnCount);

        if (_oExportPI.TextileUnitInInt == 3)
        {
            $("#btnProductFormDeliveryBill").show();
            $("#trDyingField").show();
        } else {
            $("#btnProductFormDeliveryBill").hide();
            $("#trDyingField").hide();
        }


        ChnagePaymentType();


        if (sBtnId == "btnCopyPI") {
            if (parseInt($("#cboPaymentType").val()) == 1) {
                $("#cboBankAccount").prop("disabled", true);
            } else {
                $("#cboBankAccount").prop("disabled", false);
            }

            $('#txtLCOpenDate,#txtDeliveryDate').datebox('setValue', '');
        }
    }

    function NewExportPIObj()
    {

        var dt = new Date();
        dt.setDate(dt.getDate() + 10);

        var oExportPI = {
            ExportPIID: 0,
            TextileUnitInInt: 3,
            PINo: "",
            PIStatusInInt: 0,
            IssueDate: new Date(),
            ValidityDate: dt,
            ContractorID: 0,
            BuyerID: 0,
            MKTEmpID: 0,
            BankBranchID: 0,
            CurrencyID: 2,
            Qty: 0.00,
            Amount: 0.00,
            IsLIBORRate: false,
            IsBBankFDD: false,
            LCTermID: 0,
            OverdueRate: 0,
            LCOpenDate: new Date(),
            DeliveryDate: new Date(),
            Note: "N/A",
            ApprovedBy: 0,
            ApprovedDate: new Date(),
            LCID: 0,
            IssueDateInString: icsdateformat(new Date()),
            ValidityDateInString: icsdateformat(dt),
            LCOpenDateInString:icsdateformat(new Date()),
            DeliveryDateInString: icsdateformat(new Date()),
            ExportPIPrintSetupID: 0,
            ExportPIDetails:[],
            ExportPITandCClauses:[],
            ExportPITandCClauses:[]
        };
        return oExportPI;
    }

    function UpdatePIStatus(oExportPI, sSuccessMessage, nRowIndex) {
        $.ajax({
            type: "POST",
            dataType: "json",
            url: _sBaseAddress + "/ExportPI/UpdatePIStatus",
            traditional: true,
            data: JSON.stringify(oExportPI),
            contentType: "application/json; charset=utf-8",
            success: function (data) {
                var oExportPI = jQuery.parseJSON(data);
                if (oExportPI.ErrorMessage == "" || oExportPI.ErrorMessage == null) {
                    alert(sSuccessMessage);
                    $('#tblExportPIs').datagrid('updateRow', { index: nRowIndex, row: oExportPI });
                    OperationPerformsEPI(nRowIndex, oExportPI);
                } else {
                    alert(oExportPI.ErrorMessage);
                }
            },
            error: function (xhr, status, error) {
                alert(error);
            }
        });
    }


    //btnPrintExportPI
    $("#btnPrintExportPI").click(function (){
        var oExportPIs= $('#tblExportPIs').datagrid('getRows');
        if(oExportPIs.length<=0)
        {
            alert("Data not found ");
            return;
        }
        var sExportPIIDs = "";
        for(var i = 0;i<oExportPIs.length;i++)
        {
            sExportPIIDs+= oExportPIs[i].ExportPIID+",";
        }
        sExportPIIDs = sExportPIIDs.substring(0, sExportPIIDs.length-1);
        var oExportPI = {Note:sExportPIIDs};
        $.ajax({
            type: "POST",
            dataType: "json",
            url : _sBaseAddress+  "/ExportPI/SetExportPIListData",
            traditional: true,
            data:  JSON.stringify(oExportPI),
            contentType: "application/json; charset=utf-8",
            success: function (data) {
                var sFeedBackMessage = jQuery.parseJSON(data);
                if (sFeedBackMessage==="Successful")
                {
                    window.open (_sBaseAddress+ "/ExportPI/PrintExportPIs");
                }
            },
            error: function (xhr, status, error) {
                alert(error);
            }
        });
    });

    function OperationPerformsEPI(rowIndex, oExportPI)
    {
        debugger;
        $("#btnEditExportPI,#btnReqForApprovePI,#btnUndoReqPI,#btnApprovePI,#btnUndoApprovePI,#btnPIIssuePI,#btnReqForRevisePI,#btnAcceptRevisePI,#btnReviseHistoryPI,#btnDOPI").hide();

        if (oExportPI != null && oExportPI.ExportPIID > 0) {
            var nCurrentObjStatus = parseInt(oExportPI.PIStatusInInt);
            if (nCurrentObjStatus == 1) //RequestForApproved
            {
                $("#btnUndoReqPI,#btnApprovePI").show();
            }
            else if (nCurrentObjStatus == 2) //Approved
            {
                $("#btnPIIssuePI,#btnUndoApprovePI").show();
                if (oExportPI.TextileUnitInInt == 1 || oExportPI.TextileUnitInInt == 2) {
                    $("#btnDOPI").show();
                } else {
                    $("#btnDOPI").hide();
                }
                $("#btnReqForRevisePI").show();
            }
            else if (nCurrentObjStatus == 3) //PIIssue
            {
                $("#btnReqForRevisePI").show();
            }
            else if (nCurrentObjStatus == 4) //BindWithLC
            {
                $("#btnReqForRevisePI").show();
            }
            else if (nCurrentObjStatus == 5) //RequestForRevise
            {
                $("#btnAcceptRevisePI").show();
            }
            //if(parseInt(oExportPI.ReviseNo)>0)
            //{
                $("#btnReviseHistoryPI").show();
            //}
                //RefreshControlLayout();
        }
    }

    function IsLBSFormat(bIstrue)
    {
        if(bIstrue)
        {
            $("#chkInKg").prop( "checked", false );
            $("#chkInLBS").prop( "checked", true );
        }else{
            $("#chkInKg").prop( "checked", true );
            $("#chkInLBS").prop( "checked", false );
        }
    }

    function PrintTitleFormat(nPrintTitleFormat)
    {
        if(parseInt(nPrintTitleFormat)==1)//normal
        {
            $("#chkPrintTitleInNormalFormat").prop( "checked", true );
            $("#chkPrintTitlePadFormat").prop( "checked", false );
            $("#chkPrintTitleImageFormat").prop( "checked", false );
        }else  if(parseInt(nPrintTitleFormat)==2)//pad
        {
            $("#chkPrintTitleInNormalFormat").prop( "checked", false );
            $("#chkPrintTitlePadFormat").prop( "checked", true );
            $("#chkPrintTitleImageFormat").prop( "checked", false );
        }else
        {
            $("#chkPrintTitleInNormalFormat").prop( "checked", false );
            $("#chkPrintTitlePadFormat").prop( "checked", false );
            $("#chkPrintTitleImageFormat").prop( "checked", true );
        }
    }

    $(document).keydown(function (e) { if (e.keyCode == 27) { $('div').icsWindow('close'); } });

    $('#btnAddAttachment').click(function (e)
    {
        var oExportPI = $("#tblExportPIs").datagrid("getSelected");
        if (oExportPI == null || oExportPI.ExportPIID <= 0) {
            alert("Please select an item from list.");
            return false;
        }
        window.open(_sBaseAddress + '/AttachDocument/Attachment?id='+parseInt( oExportPI.ExportPIID)+'&RefType=7&OperationInfo= Selected P/I No : '+ oExportPI.PINo, '_blank');
    });

    ///Update PI No
    $("#btnUpdatePINo ").click(function () {
        debugger;

        var oExportPI = $("#tblExportPIs").datagrid("getSelected");
        if (oExportPI == null || parseInt(oExportPI.ExportPIID) <= 0) { alert("Please select an item from list!"); return; }
       // if (parseInt(oExportPI.PIStatusInInt) == 2 || parseInt(oExportPI.PIStatusInInt) == 3 || parseInt(oExportPI.PIStatusInInt) == 4 || parseInt(oExportPI.PIStatusInInt) == 5) { alert("In this stage PI No Can't Change!"); return; }
       // var nRowIndex = $('#tblExportPIs').datagrid('getRowIndex', oExportPI);
        $('#txtPINo_Cur,#txtPINo_New').val("");
        $('#txtPINo_Cur').val(oExportPI.PINo);
        $('#txtPINo_Cur').prop('disabled',true);
        $("#winPINoChange").icsWindow('open', "Change P/I No");
    });
    $("#btnSavePINo").click(function (e) {
        SavePINo();
    });
    function SavePINo()
    {
        var oExportPI = $("#tblExportPIs").datagrid("getSelected");
        var nSelectedIndex= $('#tblExportPIs').datagrid('getRowIndex',oExportPI);
        if (oExportPI == null || parseInt(oExportPI.ExportPIID) <= 0) { alert("Please select an item from list!"); return; }
        oExportPI.PINo=  $.trim($('#txtPINo_New').val());
        if(oExportPI.PINo=="" || oExportPI.PINo==null)
        {
            alert("Please entry valid No");
            return;
        }

        var obj =
            {
                BaseAddress: _sBaseAddress,
                Object: oExportPI,
                ObjectId: oExportPI.ExportPIID,
                ControllerName: "ExportPI",
                ActionName: "UpdatePINo",
                TableId: "tblExportPIs",
                IsWinClose: true
            };
        $.icsSave(obj, function (response)
        {
            if (response.status && response.obj != null)
            {
                if (response.obj.ErrorMessage=="")
                {
                    $("#winPINoChange").icsWindow("close");
                }
                else {
                    alert(response.obj.ErrorMessage);
                }
            }
            else {
                alert("No information found.");
            }
        });
    }
    $("#btnClosePINo").click(function () {
        $("#winPINoChange").icsWindow("close");
    });
    ///New PI No
    $("#txtPINo_New").keypress(function (e) {

        if (e.which != 8 && e.which != 0  && e.which != 46  && (e.which < 48 || e.which > 57)) {
            return false;
        }

    });
    // End Update PI No
    /// Stary Update PI PaymentType
    $("#btnPaymentTypeUpdate").click(function () {
        var oExportPI = $("#tblExportPIs").datagrid("getSelected");
        if (oExportPI == null || oExportPI.ExportPIID <= 0) {
            alert("Please select an item from list.");
            return false;
        }
        var nSelectedIndex= $('#tblExportPIs').datagrid('getRowIndex',oExportPI);
        $('#cboPaymentTypeTwo').val(oExportPI.PaymentTypeInInt);
        $("#winPaymentTypeUpdate").icsWindow('open', "Update PI PaymentType");

    });


    $("#btnSavePaymentType").click(function (e) {
        var oExportPI=$('#tblExportPIs').datagrid('getSelected');
        var nSelectedIndex= $('#tblExportPIs').datagrid('getRowIndex',oExportPI);
        if(oExportPI==null || oExportPI.ExportPIID<=0)
        {
            alert("Please select a item from list!");
            return;
        }

        var nSelectedIndex= $('#tblExportPIs').datagrid('getRowIndex',oExportPI);
        if( parseInt($("#cboPaymentTypeTwo").val())<=0)
        {
            alert("Please select a Payment Type!");
            return;
        }
        var oExportPITemp = {
            ExportPIID:oExportPI.ExportPIID,
            PaymentTypeInInt: parseInt($("#cboPaymentTypeTwo").val()),

        };
        var obj =
            {
                BaseAddress: _sBaseAddress,
                Object: oExportPITemp,
                ObjectId: oExportPITemp.ExportPIID,
                ControllerName: "ExportPI",
                ActionName: "UpdatePaymentType",
                TableId: "tblExportPIs",
                IsWinClose: true
            };
        $.icsSave(obj, function (response) {
            if (response.status) {
                //OperationPerformsExportLC(nRowIndex, response.obj);
            }
        });
    });
    $("#btnClosePaymentType").click(function () {
        $("#winPaymentTypeUpdate").icsWindow("close");
    });
    /// end Update PI PaymentType

    function RefreshSummary()
    {
        var oRows = $('#tblExportPIs').datagrid('getRows');
        if(oRows.length>0)
        {
            var nQty = 0,nAmount=0;
            for(var i=0;i<oRows.length;i++)
            {
               if( oRows[i].ConversionRate<=0){oRows[i].ConversionRate=1}

                nQty = parseFloat(nQty)+parseFloat(oRows[i].Qty);
                nAmount = parseFloat(nAmount)+parseFloat(oRows[i].Amount);
            }

            nQty = parseFloat(nQty).toFixed(2);
            nAmount = parseFloat(nAmount).toFixed(2);
            debugger
            var oRow =
            {
                MKTPName : 'Total',
                QtySt:icsFormatPrice(nQty,2),
                AmountSt:"$"+icsFormatPrice(nAmount,2)
            }
            $('#tblExportPIs').datagrid('appendRow',oRow);
        }
    }
    </script>



