@{
    ViewBag.Title = "Accounting Session";  
}

@model ESimSol.BusinessObjects.AccountingSession  
    <div class="PageHeading">Accounting Session</div>    
    <div class="PageBody" style="overflow:auto">
       <table border="0">
            <tr>
                <td style="width:50px"></td>
                <td style="width:800px">
                           <div id="treeDiv">
                           </div>              
                </td>
                <td style="width:50px"></td>
            </tr>
             <tr>
                 <td style="width:50px"></td>
                 <td style="width:800px">
                    <div style="color: red;font-weight:900; margin-top:10px">@TempData["message"]</div>
                 </td>
                 <td style="width:50px"></td>
            </tr>            
        </table>     
    </div>
    <div class="PageFooter">
            <div style="margin-left:20px">
                    @Html.ActionLink("Add", "Add", new { ParentID = 0 }, new { id = "lblAddNode" })                
                ||  @Html.ActionLink("Delete", "Delete", new { id = 0 }, new { id = "lblDeleteNode" })   
                ||  @Html.ActionLink("Refresh", "RefreshList")  
            </div>    
    </div>


<script type="text/javascript">

    var tree;
    var initialData;
    var jtree; 
    var oNode;
    var oNodeID;
    var obj; 
    var ParentID=0;   
    $(document).ready(function () {
//    debugger;      
        initialData = @Html.Raw( new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(Model));
        treewithJavascript();
       // debugger;
    });


  
    function MakeTree(TempchildNodes, otempNode){
//    debugger;
         for(var item in TempchildNodes)
         {                
             obj = {
                label:TempchildNodes[item].DisplayNode,
                oNodeID: TempchildNodes[item].AccountingSessionID
            };
             
            var jNode = new YAHOO.widget.TextNode(obj, otempNode);          
            if(TempchildNodes[item].ChildNodes !=null)
            {
                MakeTree(TempchildNodes[item].ChildNodes, jNode);
            }
         }
    }


    function treewithJavascript() {
//    debugger;
            jtree = new YAHOO.widget.TreeView("treeDiv");
            var root = jtree.getRoot();

                obj = {
                label: initialData.DisplayNode,
                oNodeID: initialData.AccountingSessionID
            };
            var TempNode = new YAHOO.widget.TextNode(obj, root);
//            debugger;
            
     
            if(initialData.ChildNodes!=null)
            {              
                MakeTree(initialData.ChildNodes, TempNode);
            }

            // By default, trees with TextNodes will fire an event for when the label is clicked:
            jtree.subscribe("labelClick", function (node) {
            ParentID=node.data.oNodeID ;
//          alert(node.data.oNodeID + " label was clicked");
            });
            jtree.render();
        }



     $("#lblDeleteNode").click(function () {
//        debugger;
        if(ParentID==null || ParentID<=0)
        {
            window.alert('Please select an account head');
            return;
        }

        var lblNode = document.getElementById("lblDeleteNode");
        var sTemp=lblNode.href;
        lblNode.href=sTemp.replace("/0","/"+ParentID);
    })



</script>





