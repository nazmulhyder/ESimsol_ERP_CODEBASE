<html>
<head>  
 <link href="@Url.Content("~/Content/CSS/icon.css")" rel="stylesheet" type="text/css" />
    <link href="@Url.Content("~/Content/CSS/easyui.css")" rel="stylesheet" type="text/css" /> 
    <link href="@Url.Content("~/Content/CSS/Pikerstyle.css")" rel="stylesheet" type="text/css" />  

    <script src="@Url.Content("~/Scripts/jquery-1.7.1.min.js")" type="text/javascript"></script>            
    <script src="@Url.Content("~/Scripts/jquery.ics.customize.js")" type="text/javascript"></script>  
    <script src="@Url.Content("~/Scripts/jquery.easyui.min.js")" type="text/javascript"></script>    

    <script src="@Url.Content("~/Scripts/jquery-ui.min.js")" type="text/javascript"></script> 
    <script src="@Url.Content("~/Scripts/json2.js")" type="text/javascript"></script> 
    
</head>
<body>

@model IEnumerable<ESimSol.BusinessObjects.User>
<div style="font-family:Tahoma">           
<table border="0" cellspacing="2" cellpadding="2">
    <tr>
        <td style="background-color:#CFB53B; text-align:center; width:445px; color:White">
            <label id="lblHeaderName" style="font-size:15px; font-weight:bold; text-decoration:Underline; width:445px">Copy Authorization</label>
        </td>
    </tr>
</table>
<div style="margin-left:2px">
    <table id="tblUser" title="Authorized User List" class="easyui-datagrid"  style="width:448px; height:382px"; fitColumns="false"; rownumbers="true"; pagination="false"; singleSelect="true"; autoRowHeight="false">
        <thead> 
                <th field="LogInID" width="200">Login ID</th>
                <th field="UserName" width="200">User Name</th>
        </thead> 
    </table>
</div>
<fieldset>
    <legend style="font-weight:bold"> Action : </legend>
        <table border="0" cellspacing="2" cellpadding="2" style="font-size:11px;width:430px; font-weight:bold">
            <tr>
                <td style="width:330px; text-align:right">
                </td>
                <td style="width:50px">
                   <a href="javascript:void(0)" class="easyui-linkbutton" iconCls="icon-save" plain="true" onclick="Commit()">Commit</a>
                </td>
                <td style="width:50px">
                   <a href="javascript:void(0)" class="easyui-linkbutton" iconCls="icon-cancel" plain="true" onclick="Close()">Close</a>
                </td>
             </tr>       
         </table>
</fieldset>
</div>
</body>
</html>

<script type="text/javascript"> 
 var _oUsers=[];
 var _value ="";
 var _sBaseAddress="";
 var _nAssignUserID = 0;
 $(document).ready(function () {
    debugger;     
    _sBaseAddress =@Html.Raw( new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(HttpContext.Current.Session[SessionInfo.BaseAddress]));                  
    _oUsers =@Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(Model)); 
     var obj = window.dialogArguments;    
    _nAssignUserID = obj.AssignUserID;
    document.getElementById('lblHeaderName').innerHTML=obj.Name;
    RefreshList(_oUsers);
 });

 function RefreshList(oUser)
    {    
          data=oUser;
          data={"total":""+data.length+"","rows":data};
          $('#tblUser').datagrid('loadData',data);
    }



 function Commit()
{
   debugger;
     var oUser = $('#tblUser').datagrid('getSelected');
     if(oUser==null || parseInt(oUser.UserID)<=0 )
     {
        alert("Please Select At leas on Item!!");
        return;
     }
       $.ajax
         ({
            type: "GET",
            dataType: "json",            
            url : _sBaseAddress+ "/AuthorizationRole/CommitAuthorization",
            data: { id:oUser.UserID,nAssignUserID:_nAssignUserID},
            contentType: "application/json; charset=utf-8",
            success: function (data) {
                //debugger;
                sFeedbackMessage = jQuery.parseJSON(data);
                if (sFeedbackMessage == "Commit sucessfully") 
                {
                    alert("Commit sucessfully");                        
                     window.close();     
                }
                else
                {
                    alert(sFeedbackMessage);
                }
            },
            error: function (xhr, status, error) 
            {
                alert(error);
            }
                      
        });
}


    
function Close()
{
    
    window.close();
}


$(document).keydown(function(e) {    
    //debugger;
    if(e.which == 27)//escape=27
    {
        //debugger;        
        window.close();
    }
});
</script>