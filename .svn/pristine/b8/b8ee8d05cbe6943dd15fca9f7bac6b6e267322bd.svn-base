@{
    ViewBag.Title = "Fabric Batch QC";
}
<html>
<body>
@model ESimSol.BusinessObjects.FabricBatchQC
    <div class="menuMainCollectionTable ms-custom-control region-lot">
        <div id="tab-QC-Declaration" class="easyui-tabs" style="height:560px;">
            <div title="QC-Declaration" style="padding: 1px;">
                <div id="divFBInfo">
                    <fieldset>
                        <legend>Fabric Batch Info </legend>
                        <div style="margin:0 auto;width:90%;">
                            <table border="0" cellpadding="1" cellspacing="1">
                                <tr>
                                    <td style="width:15%; text-align:right;">Batch No:</td>
                                    <td style="width:40%;text-align:left;">
                                        <input type="text" style="width:104px;" id="txtBatchNo" />
                                        @*<a id="btnSearchBatch" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-search" plain="true"></a>*@
                                        <input type="text" style="width:128px;" id="txtFEONo" placeholder="Type Dispo No" />
                                        <a id="btnSearchFEONo" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-search" plain="true"></a>
                                    </td>
                                    <td style="width:15%; text-align:right;">Dispo No :</td>
                                    <td style="width:30%;text-align:left;">
                                        <input type="text" style="width:119px; text-align:left;" id="txtOrderNo" disabled />
                                        Status:
                                        <input type="text" style="width:90px;" id="txtStatus" disabled />
                                    </td>
                                </tr>
                                <tr>
                                    <td style="width:10%; text-align:right;">Construction :</td>
                                    <td style="width:40%;text-align:left;">
                                        <input type="text" style="width:106px;" id="txtConstruction" disabled />
                                        Reed Count
                                        <input type="text" style="width:88px;" id="txtReedCount" disabled />

                                    </td>
                                    <td style="width:15%; text-align:right;">Buyer :</td>
                                    <td style="width:30%;text-align:left;">
                                        <input type="text" style="width:254px;" id="txtBuyer" disabled />
                                    </td>
                                </tr>
                                <tr>
                                    <td style="width:10%; text-align:right;">Fabric Type:</td>
                                    <td style="width:40%;text-align:left;">
                                        <input type="text" style="width:106px;" id="txtFabricType" disabled />
                                        @*Grey Width
                                        <input type="text" style="width:90px;" id="txtGreyWidth" class="number" />*@
                                        <span style="padding-left:24px;">Weave</span>
                                        <input type="text" style="width:90px;" id="txtWeave" disabled />
                                    </td>
                                    <td style="width:10%; text-align:right;">Order Qty :</td>
                                    <td style="width:30%;text-align:left;">
                                        <input type="text" style="width:97px;" id="txtOrderQtyInY" class="number" disabled /> &nbsp;(Y) &nbsp;
                                        <input type="text" style="width:98px;" id="txtOrderQtyInM" class="number" disabled />&nbsp;(M)
                                    </td>
                                </tr>
                                <tr>
                                    <td style="width:10%; text-align:right;">Process Type:</td>
                                    <td style="width:40%;text-align:left;">
                                        <input type="text" style="width:106px;" id="txtProcessType" disabled />
                                        @*<span style="padding-left:24px;">Weave</span>
                                        <input type="text" style="width:90px;" id="txtWeave" disabled />*@
                                    </td>
                                    <td style="width:10%; text-align:right;">Beam Length:</td>
                                    <td style="width:30%;text-align:left;">
                                        <input type="text" style="width:97px;" id="txtQCLengthY" class="number" disabled /> &nbsp;(Y) &nbsp;
                                        <input type="text" style="width:98px;" id="txtQCLengthM" class="number" disabled />&nbsp;(M)
                                    </td>
                                </tr>
                            </table>
                        </div>
                    </fieldset>
                </div>
                <div style="height:63%;width:65%;float:left;margin-right:2px;">
                    <table id="tblFabricBatchQCDetail" title="QC Detail" class="easyui-datagrid" style="height:96%;width:100%" fitcolumns="true" rownumbers="true" pagination="false" singleselect="true" autorowheight="false" toolbar="#toolbarQCDetail" data-options="onClickRow: onClickRow">
                        <thead>
                            <tr>
                                <th data-options="field:'Selected',checkbox:true"></th>
                                @*<th field="LotNo" width="150">Roll No</th>*@
                                <th data-options="field:'LotNo',align:'left',editor:{type:'text'}" width="140px;">Roll No</th>
                                <th field="QCGrade" width="70">Grade</th>
                                <th field="Qty" width="135" align="right">Length(Y)</th>
                                @*<th field="QtyInMeter" width="150" align="right">Length(M)</th>*@
                                <th data-options="field:'QtyInMeter',align:'right',editor:{type:'numberbox',options:{precision:6}}" width="135;" align="right">Length(M)</th>
                                @*<th field="Width" width="100" align="right">Width(Y)</th>*@
                                <th data-options="field:'Width',align:'right',editor:{type:'numberbox',options:{precision:6}}" width="135;" align="right">Width(M)</th>
                                <th field="DBServerDateTimeStr" width="120">Issue Date</th>
                                <th field="ProDateStr" width="115">Production Date</th>
                                @*<th field="LockInString" width="100">Delivered</th>*@
                                <th field="DeliveryDateSt" width="130">Delivery Date</th>
                                @*<th field="ReedCountWithDent" width="110">ReedCount</th>*@
                                @*<th field="ProductionTiming" width="120">Production Time</th>*@
                                <th field="Remark" width="100">Remark</th>
                            </tr>
                        </thead>
                    </table>
                    <div id="toolbarQCDetail">
                        Grade : <select id="cboGrade" style="width:100px;"></select>&nbsp;
                        Roll No : <input type="text" id="txtBatchNoInRollNo" style="width:56px;" placeholder="Batch No" disabled /> -
                        <input type="text" id="txtRollNo" style="width:45px;" placeholder="Roll No" />
                        @*Length: <input type="text" id="txtLengthY" style="width:39px;display:none;" class="number" placeholder="Yard" />&nbsp;<label style="display:none;">(Y)</label>*@
                        Length: <input type="text" id="txtLengthM" style="width:38px;" class="number" placeholder="Meter" />&nbsp;(M)
                        <input type="text" id="txtLengthY" style="width:39px;" class="number" placeholder="Yard" />&nbsp;(Y)
                        <input type="text" id="txtRemark" style="width:120px;" placeholder="Remark" />   
                        <br />
                        @*<input type="text" id="txtWidthM" style="width:38px;" class="number" placeholder="Meter" />&nbsp;(M)*@
                        Width: <input type="text" id="txtWidthY" style="width:39px;" class="number" placeholder="Width" />
                        Shift : <select id="cboShift" style="width:100px;"></select>                      
                        <a id="btnAddQCDetail" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-add" plain="true" onclick="AddQCDetail()">Add</a>
                        <a id="btnDeleteQCDetail" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-remove" plain="true" onclick="DeleteQCDetail()">Remove</a>
                        <a id="btnLock" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-disburse" plain="true" onclick="Lock()">Transfer</a>
                        @*<a id="btnPrint" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-print" plain="true" onclick="Print()">Print</a>
                        <input id="chkDateSearch" type="checkbox" />
                        <input id="dtDateSearch" type="text" style="width: 120px;" class="easyui-datebox" required="required" data-options="formatter:icsdateformat,parser:icsdateparser" />*@
                        <a id="btnLoadAll" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-reload" plain="true">Load All</a>
                        @*<a id="btnTransferSlip" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-print" plain="true">Transfer Slip</a>*@
                    </div>
                    <div style="width:100%;text-align:left;font-weight:bold;">
                        <label style="margin-right:10px; margin-left: 16px;">Total : </label>
                        <label id="lblTotalLotNo"></label>
                        <label id="nTotalLengthY" style="margin-left: 114px;">0.00</label>&nbsp;(Y)
                        <label id="nTotalLengthM" style="margin-left: 25px;">0.00</label>&nbsp;(M)
                    </div>
                    @*<div style="width:100%;text-align:left;font-weight:bold;">
                    <label style="margin-right:10px; margin-left: 16px;">Total : </label>
                    <label id="lblTotalLotNo"></label>
                    <label id="nTotalLengthY" style="margin-left: 114px;">0.00</label>&nbsp;(Y)
                    <label id="nTotalLengthM" style="margin-left: 25px;">0.00</label>&nbsp;(M)
                </div>*@
                    @*<div style="width:100%; ">
                        <table>
                            <tr>
                                <td style="width:20px"><div style="background-color:lightgreen;height:20px;width:100%;"></div></td>
                                <td style="width:400px">Already Delivered /Received</td>
                            </tr>
                        </table>
                    </div>*@
                </div>
                <div style="height:63%;width:34%;float:right;">
                    <table id="tblFBQCFault" title="FB QC Fault Detail" class="easyui-datagrid" style="height:96%;width:100%" fitcolumns="true" rownumbers="true" pagination="false" singleselect="true" showfooter="true" autorowheight="false" toolbar="#toolbarFBQCFault" data-options="onClickRow:onClickRowFault">
                        <thead>
                            <tr>
                                <th field="FPFName" width="45%">Name</th>
                                <th data-options="field:'FaultPoint',align:'right',editor:{type:'numberbox',options:{precision:2}}" formatter="formatPrice" width="15%" align="right">Point</th>
                                <th data-options="field:'NoOfFault',align:'right',editor:{type:'numberbox',options:{precision:2}}" formatter="formatPrice" width="18%" align="right">No Of Fault</th>
                                <th field="FaultTotal" formatter="formatPrice" width="18%" align="right">Total</th>
                            </tr>
                        </thead>
                    </table>
                    <div id="toolbarFBQCFault">
                        <a id="btnSave" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-save" plain="true">Save</a>
                        <a id="btnDeleteFault" href="javascript:void(0)" class="easyui-linkbutton initial-state" iconcls="icon-remove" plain="true">Delete</a>
                        <a id="btnReloadFault" href="javascript:void(0)" class="easyui-linkbutton initial-state" iconcls="icon-reload" plain="true">Reload</a>
                        @*<label>Fault Type:</label>
                        <select id="cboFaultType" style="width:20%;"></select>
                        <label style="padding-left:1%">Fault:</label>
                        <select id="cboFault" style="width:25%;"></select>
                        <label style="padding-left:1%">Point:</label>
                        <select id="cboNoOfFault" style="width:10%;">
                            <option value="1">1</option>
                            <option value="2">2</option>
                            <option value="3">3</option>
                            <option value="4">4</option>
                        </select>
                        <br />
                        <label style="padding-left:3%;">Fault No:</label>
                        <input type="text" id="txtFaultNo" class="number" value="1" style="width:20%;" />
                        <label style="padding-left:1%;">Value:</label>
                        <input type="text" id="txtNoOfFault" class="number" style="width:18.5%;" />
                        <input id="dtFaultDate" type="text" style="width: 120px;" class="easyui-datebox" required="required" data-options="formatter:icsdateformat,parser:icsdateparser" />
                        <a id="btnAddFBQCFault" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-add" plain="true"></a>
                        <a id="btnRemoveFBQCFault" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-remove" plain="true"></a>*@
                    </div>
                    @*<table border="0" cellpadding="0" cellspacing="0">
                        <tr style="font-weight:bold;">
                            <td style="width:400px;"></td>
                            <td style="width:200px;"></td>
                            <td style="width:200px;">Total : <label id="lblTotalValue">0.00</label></td>
                        </tr>
                    </table>*@
                </div>
                <fieldset style="min-height:11%">
                    <legend style="font-weight:bold">Actions</legend>
                    <table border="0" cellspacing="0" cellpadding="1" style="font-size:11px; font-weight:bold;width:100%">
                        <tr>
                            <td style="width:60%; text-align:right;padding-left:80px;">
                                <a id="btnCheckingParameter" style="float:left;" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-pick" plain="true">Checking Parameter</a>
                                <a id="btnPrintFabricBatchQC" style="float:left;" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-print" plain="true">Preview</a>
                                <a id="btnPrintFabricBatchQC2" style="float:left;" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-print" plain="true">Preview 2</a>
                            </td>
                            <td style="width:40%; text-align:right;" id="btnQCDone">
                                <input id="txtPercentage" type="text" value="80" style="width:25px;" class="number" />%
                                <label style="margin-left:10px;"> Charge:</label>
                                <select id="cboEmployee" style="min-width:100px;"></select>
                                <a href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-save" plain="true" onclick="QCDone()">QC Done</a>
                            </td>
                        </tr>
                    </table>
                </fieldset>
            </div>
           
            <div title="Transfer Slip" style="padding:2px" class="region-TS">

                <table id="tblTS" title="Transfer Slip List" class="easyui-datagrid" fit="true" fitcolumns="true" rownumbers="true" pagination="false" singleselect="true" autorowheight="false" toolbar="#toolbarTransferSlip">
                    <thead>
                        <tr>
                            <th field="TransferNoWithRoleCount" width="20%">Transfer Slip No</th>
                            <th field="BatchNo" width="12%" align="left">Batch No</th>
                            <th field="IssueDateInString" width="12%" align="left">Delivery Date</th>
                            <th field="TSIssueName" width="20%" align="left">Issued By</th>
                          
                        </tr>
                    </thead>
                </table>
              
              <div id="toolbarTransferSlip">
                    <a id="btnTransferSlipFromTabTS" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-print" plain="true">Transfer Slip</a>
                  <input type="radio" name="TransferSlipSelection" value="ProductionTransferSlip"> Production Transfer Slip
                  <input type="radio" name="TransferSlipSelection" value="BatchTransferSlip"> Batch Transfer Slip
                  <input type="radio" name="TransferSlipSelection" value="OrderTransferSlip"> All Transfer Slip
                </div>
            </div>
        </div>
       
        <div id="winFabricQCLockDateWindow" style="width:300px;" class="easyui-window" title="" data-options="modal:true,closed:true,collapsible:false,minimizable:false,maximizable:false,closable:false">
            <div id="divwinFabricBatch" tabindex="-1">
                <fieldset>
                    <table style="width:100%;">
                        <tr>
                            <td>
                                <label>Production Date</label>
                            </td>
                            <td>
                                <input id="dtProDate" type="text" style="width: 120px;" class="easyui-datebox" required="required" data-options="formatter:icsdateformat,parser:icsdateparser" />
                            </td>
                        </tr>
                        <tr>
                            <td>
                                <label>Delivery Date</label>
                            </td>
                            <td>
                                <input id="dtDeliveryDate" type="text" style="width: 120px;" class="easyui-datebox" required="required" data-options="formatter:icsdateformat,parser:icsdateparser" />
                            </td>
                        </tr>
                    </table>
                </fieldset>
                <fieldset>
                    <legend>Actions</legend>
                    <div style="float:right;">
                        <a id="btnOKTransfer" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-save" plain="true"> OK </a>
                        <a id="btnCloseWindowLockDate" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-cancel" plain="true">Close</a>
                    </div>
                </fieldset>
            </div>
        </div>
    </div>
</body>
</html>

<div id="winCheckingParameters" class="easyui-window winstyle" title="Checking Parameters" style=" height:40%;width:30%" data-options="modal:true,closed:true,collapsible:false,minimizable:false,maximizable:false,closable:false">
    <div  style="overflow:hidden;display:block;height:70%">
        <table id="tblFabricBatchQCChecks" class="easyui-datagrid" style="height:100%" fit="true" fitcolumns="true" rownumbers="true" pagination="false" singleselect="true" autorowheight="false" toolbar="#toolbar" data-options="onClickRow:onclickrowCheckingParameter">
            <thead>
                <tr>
                    <th field="Name" width="80">Parameter Name</th>
                    <th data-options="field:'Note',width:160, align:'Left',editor:{type:'text'}">Comment</th>
                </tr>
            </thead>
        </table>
        <div id="toolbar">
            <a id="btnCPRefresh" href="javascript:void(0)" class="easyui-linkbutton easyui-tooltip" title="Delete" iconcls="icon-reload" plain="true">Refresh</a>
            <a id="btnCPDelete" href="javascript:void(0)" class="easyui-linkbutton easyui-tooltip" title="Delete" iconcls="icon-remove" plain="true">Delete</a>
            <a id="btnCPReload" href="javascript:void(0)" class="easyui-linkbutton easyui-tooltip" title="Delete" iconcls="icon-reload" plain="true">Reload</a>
            
        </div>
    </div> 
    <div style="display:block;overflow:hidden;">
        <fieldset style="height:10%">
            <legend style="font-weight: bold">Action : </legend>
            <table border="0" cellspacing="2" cellpadding="2" style="font-size: 11px; font-weight: bold; width:100%">
                <tr>
                    <td style="width:60%; text-align:right"></td>
                    <td style="width:40%;text-align:right;">
                        <a id="btnCPSave" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-save" plain="true">Save</a>
                        <a id="btnCPClose" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-cancel" plain="true">Close</a>
                    </td>
                </tr>
            </table>
        </fieldset>
    </div>
</div>
<script type="text/javascript">
    var _oFabricBatchQC=null;
    var _sBaseAddress="";
    var _objName = "";
    var _oEmployees = [];
    var _oFabricQCGrades = [];
    var _nFEOID=0;
    var _nFBID=0;
    var _oFaults = [];
    var _oFabricQCParNames = [];
    $(document).ready(function () {
        _sBaseAddress =@Html.Raw( new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(HttpContext.Current.Session[SessionInfo.BaseAddress]));
        _oFabricBatchQC =@Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(Model));
        _oEmployees = @Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(@ViewBag.Employees));
        _oFabricQCGrades = @Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(@ViewBag.FabricQCGrades));
        var oShifts = @Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(@ViewBag.Shifts));
        _oFaults = @Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(@ViewBag.Faults));
        _oFabricQCParNames = @Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(@ViewBag.FabricQCParNames));
        var oFaultTypes=@Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(@ViewBag.FaultTypes));
        //SetNoOfFault();
        $('#txtBatchNo').data('FBPID',0);
        $(".easyui-datebox").datebox({ disabled: true });
        $("#dtFaultDate").datebox({ disabled: false });
        $(".easyui-datebox").datebox("setValue", icsdateformat(new Date()));
        $("#cboEmployee").icsLoadCombo({List: _oEmployees,OptionValue: "EmployeeID",DisplayText: "Name"});
        $("#cboGrade").icsLoadCombo({List: _oFabricQCGrades,OptionValue: "FabricQCGradeID", DisplayText: "Name"});
        $("#cboShift").icsLoadCombo({List: oShifts,OptionValue: "ShiftID", DisplayText: "ShiftWithDuration"});
       // $("#cboFault").icsLoadCombo({List: oFaults,OptionValue: "FPFID", DisplayText: "Name"});
        $("#cboFaultType").icsLoadCombo({List: oFaultTypes,OptionValue: "id", DisplayText: "Value", InitialValue:""});
        $("#cboFault").data('Fault',_oFaults);
        
        $('#btnQCDone').hide();
        DynamicRefreshList([] ,'tblTS');

       // $("#btnPrintFabricBatchQC,#btnPrintFabricBatchQC2").hide();

    });
    $(document).keydown(function (e) { if (e.keyCode == 27) { $('div').icsWindow('close'); } });


    $('#cboFaultType').change(function(e){
        var faultType=$('#cboFaultType').val();
        if( faultType>0){
            var faults=$("#cboFault").data('Fault');
            var tfaults=[];
            for(var i=0;i<faults.length;i++){
                if(faults[i].FabricFaultType==faultType){
                    tfaults.push(faults[i]);
                }
            }
            $("#cboFault").icsLoadCombo({List: tfaults,OptionValue: "FPFID", DisplayText: "Name"});
        }
        else{
            $("#cboFault").icsLoadCombo({List: [],OptionValue: "FPFID", DisplayText: "Name"});
        }
    });

    $("#chkDateSearch").change(function(){
        $("#dtDateSearch").datebox({ disabled: (this.checked ? false : true) });
        $("#dtDateSearch").datebox("setValue", icsdateformat(new Date()));
    });

    $("#btnLoadAll").click(function(){
        if(_oFabricBatchQC!=null && _oFabricBatchQC.FBID > 0)
        {
            var obj = {
                BaseAddress: _sBaseAddress,
                Object: _oFabricBatchQC,
                ControllerName: "FabricBatch",
                ActionName: "GetsFabricBatchQCDetails",
                IsWinClose: false
            };
            $.icsMaxDataGets(obj, function (response) {

                if (response.status && response.objs.length > 0) {
                    if (response.objs[0].FBQCDetailID > 0) {
                        DynamicRefreshList(response.objs, "tblFabricBatchQCDetail");
                    }
                    else {
                        alert(response.objs[0].ErrorMessage);
                        DynamicRefreshList([], "tblFabricBatchQCDetail");
                    }
                }else{
                    DynamicRefreshList([], "tblFabricBatchQCDetail");
                }
                SetTotal();
            });
        }else{
            alert("Select fabric batch!!!");
            $("#txtBatchNo").focus();
        }
    });

    $('#dtDateSearch').datebox({ onSelect: function (date) { GetsByDBServerDate(); } });
    function GetsByDBServerDate()
    {
        if( $("#chkDateSearch").is(':checked'))
        {
            if(_oFabricBatchQC!=null && _oFabricBatchQC.FBID > 0)
            {
                var oFabricBatchQC = {
                    FBID : _oFabricBatchQC.FBID,
                    QCStartDateTime : $("#dtDateSearch").datebox('getValue'), //QCStartDateTime used for DBServerDateTime
                };
                var obj = {
                    BaseAddress: _sBaseAddress,
                    Object: oFabricBatchQC,
                    ControllerName: "FabricBatch",
                    ActionName: "GetsByDBServerDate",
                    IsWinClose: false
                };
                $.icsMaxDataGets(obj, function (response) {

                    if (response.status && response.objs.length > 0) {
                        DynamicRefreshList(response.objs, "tblFabricBatchQCDetail");
                    }else{
                        DynamicRefreshList([], "tblFabricBatchQCDetail");
                    }
                    SetTotal();
                });
            }
            else{
                alert("Select fabric batch!!!");
                $("#txtBatchNo").focus();
            }
        }
    }

    $("#txtRollNo").keydown(function(e){
        if(e.keyCode===13)
        {
            if($.trim($(this).val()) == "")
            {
                alert("Give roll no.");
                $(this).focus();
                return false;
            }

            $("#txtLengthM").focus();
            $("#txtLengthY").val("");
            $("#txtLengthM").val("");
        }
    });

    $("#btnSearchFEONo").click(function(){
        EFOPicker();
    });

    function EFOPicker()
    {
        var oFabricBatch={
            FEONo : $.trim($("#txtFEONo").val()),
            IsNotWarpDone:false,
            WeavingProcessType : -1
        };

        var obj = {
            BaseAddress: _sBaseAddress,
            Object: oFabricBatch,
            ControllerName: "FabricBatch",
            ActionName: "SearchForQC",
            IsWinClose: false
        };
        $('#btnAddQCDetail,#btnDeleteQCDetail,#btnLock').show();
        $.icsMaxDataGets(obj, function (response) {
            if (response.status && response.objs.length > 0) {
                if (response.objs[0].FBID > 0) {
                    var tblColums = [];
                    var oColumn = { field: "BeamNo", title: "Beam No", width: "10%", align: "left" }; tblColums.push(oColumn);
                    oColumn = { field: "FEONo", title: "Dispo No", width: "12%", align: "left" }; tblColums.push(oColumn);
                  
                    //oColumn = { field: "ReedCountWithDent", title: "Reed Count", width: "15%", align: "left" }; tblColums.push(oColumn);
                    oColumn = { field: "BatchNo", title: "Batch No", width: "12%", align: "left" }; tblColums.push(oColumn);
                    oColumn = { field: "Qty", title: "Qty (Y)", width: "12%", align: "right", formatter:formatPrice }; tblColums.push(oColumn);
                    oColumn = { field: "QtyInMtr", title: "Qty (M)", width: "12%", align: "right",formatter:formatPrice }; tblColums.push(oColumn);
                    oColumn = { field: "FabricBatchStatusInString", title: "Status", width: "20%", align: "left" }; tblColums.push(oColumn);
                    var oPickerParam = {
                        winid: 'winFabricBatchs',
                        winclass: 'clsFabricBatch',
                        winwidth: 600,
                        winheight: 460,
                        tableid: 'tblFabricBatchs',
                        tablecolumns: tblColums,
                        datalist: response.objs,
                        multiplereturn: false,
                        searchingbyfieldName: 'FEONo',
                        windowTittle: 'Fabric Batch List',
                        placeholder : "Search By Batch No & Reed Count & Loom No"
                    };
                    $.icsPicker(oPickerParam);
                    IntializePickerbutton(oPickerParam);

                }
                else {
                    alert(response.objs[0].ErrorMessage);
                }
            }
            else
            {
                alert("Sorry, No Data Found.");
            }
        });

        
    }

    $("#txtFEONo").keydown(function(e){
        if(e.keyCode === 13)
        {
            EFOPicker();
        }
    });

    var _sLotNo = ""; //Roll No
    var _nQtyMeterFDOD = 0;
    var _nWidthFDOD = 0;
    var editIndex = undefined;

    function onClickRow(index) {
        if (endEditing()) {
            $('#tblFabricBatchQCDetail').datagrid('selectRow', index).datagrid('beginEdit', index);
            var oFBQCDetail = $('#tblFabricBatchQCDetail').datagrid('getSelected');
            _sLotNo = oFBQCDetail.LotNo;
            _nQtyMeter = oFBQCDetail.QtyInMeter;
            _nWidthFDOD = oFBQCDetail.Width;
            GetFabricBatchQCFault(oFBQCDetail)

            editIndex = index;
        }
        else {
            $('#tblFabricBatchQCDetail').datagrid('selectRow', editIndex);
        }
    }
    function endEditing() {

        if (editIndex == undefined) {
            return true;
        }
        if ($('#tblFabricBatchQCDetail').datagrid('validateRow', editIndex)) {

            $('#tblFabricBatchQCDetail').datagrid('endEdit', editIndex);
            $('#tblFabricBatchQCDetail').datagrid('selectRow', editIndex);
            var oFBQCDetail = $('#tblFabricBatchQCDetail').datagrid('getSelected');
            var sTempLotNo = _sLotNo;
            var nTempIndex = editIndex;
            debugger;
            if(_sLotNo != oFBQCDetail.LotNo || _nQtyMeter != parseFloat(oFBQCDetail.QtyInMeter) || _nWidthFDOD != parseFloat(oFBQCDetail.Width))
            {

                oFBQCDetail.Qty = GetYard(oFBQCDetail.QtyInMeter,8);
                oFBQCDetail.Qty = parseFloat(parseFloat(oFBQCDetail.Qty).toFixed(6));
                oFBQCDetail.QtySt = formatPrice(oFBQCDetail.Qty,6);
                oFBQCDetail.Width = parseFloat(parseFloat(oFBQCDetail.Width).toFixed(6));
                $("#tblFabricBatchQCDetail").datagrid("updateRow", { index: editIndex, row: oFBQCDetail });

                var obj = {
                    BaseAddress: _sBaseAddress,
                    Object: oFBQCDetail,
                    ObjectId: oFBQCDetail.FBQCDetailID,
                    ControllerName: "FabricBatch",
                    ActionName: "SaveQCDetail",
                    TableId: "",
                    IsWinClose: false,
                    Message: ""
                };
                $.icsSave(obj, function (response) {
                    if (response.status && response.obj != null) {
                        if($.trim(response.obj.ErrorMessage) != "")
                        {
                            oFBQCDetail.LotNo = sTempLotNo;
                            $("#tblFabricBatchQCDetail").datagrid("updateRow", { index: nTempIndex, row: oFBQCDetail });
                            $('#tblFabricBatchQCDetail').datagrid('selectRow', nTempIndex);
                        }
                    }
                });
            }
            editIndex = undefined;
            return true;
        }
        else {
            return false;
        }
    }

    function SetNoOfFault(){
        var nFaultNo=parseInt(icsRemoveComma($('#txtFaultNo').val()));
        var nPoint=parseInt($('#cboNoOfFault').val());
        var result=nFaultNo*nPoint;
        $('#txtNoOfFault').val(result);
    }

    $('#cboNoOfFault').change(function(e){
        SetNoOfFault();
    });

    $('#txtFaultNo').keyup(function(e){
        SetNoOfFault();
    });

    $('#txtNoOfFault').keyup(function(e){
        var nFaultValue=parseInt(icsRemoveComma($('#txtNoOfFault').val()));
        var nPoint=parseInt($('#cboNoOfFault').val());
        var result=nFaultValue/nPoint;
        $('#txtFaultNo').val(result);
    });

    $("#btnAddFBQCFault").click(function(){
        if($("#cboFault").val() == 0)
        {
            alert("Select Fault.");
            $("#cboFault").focus();
            return false;
        }
        if($("#cboNoOfFault").val() == 0)
        {
            alert("Select Point.");
            $("#cboNoOfFault").focus();
            return false;
        }
        if($.trim($("#txtNoOfFault").val()) == "" || parseInt($("#txtNoOfFault").val()) <= 0)
        {
            alert("Give Value.");
            $("#txtNoOfFault").focus();
            return false;
        }
        var oFabricBatchQCDetail = $("#tblFabricBatchQCDetail").datagrid("getSelected");
        if(oFabricBatchQCDetail == null || oFabricBatchQCDetail.FBQCID <= 0)
        {
            alert("Select a Fabric Batch QC from QC Detail table.");
            return false;
        }

        var oFabricBatchQCFault={
            FBQCFaultID : 0,
            FBQCDetailID : oFabricBatchQCDetail.FBQCDetailID,
            FPFID : $("#cboFault").val(),
            FaultPoint : $("#cboNoOfFault").val(),
            NoOfFault : parseInt($("#txtNoOfFault").val()),
            FaultDate : $("#dtFaultDate").datebox("getValue")
            
        };

        var obj = {
            BaseAddress: _sBaseAddress,
            Object: oFabricBatchQCFault,
            ObjectId: oFabricBatchQCFault.FBQCFaultID,
            ControllerName: "FabricBatch",
            ActionName: "SaveFabricBatchQCFault",
            TableId: "tblFBQCFault",
            IsWinClose: false,
            Message:""
        };
        $.icsSave(obj, function (response) {
            if (response.status && response.obj != null) {
                if($.trim(response.obj.ErrorMessage) == "")
                {
                    SetTotalFabricBatchQCFaults();
                }
                else{
                    alert(response.obj.ErrorMessage);
                }
            }
        });
    });

    $("#btnRemoveFBQCFault").click(function(){

        var oFBQCFault = $("#tblFBQCFault").datagrid("getSelected");
        if(oFBQCFault == null || oFBQCFault.FBQCFaultID <= 0)
        {
            alert("Please Select an item from list.");
            return false;
        }

        if (!confirm("Confirm to Delete?")) return false;

        var obj = {
            BaseAddress: _sBaseAddress,
            Object: oFBQCFault,
            ControllerName: "FabricBatch",
            ActionName: "DeleteFabricBatchQCFault",
            TableId: "tblFBQCFault",
            IsWinClose: false
        };
        $.icsDelete(obj, function (response) {
            SetTotalFabricBatchQCFaults();
        });
    });

    $("#txtLengthY").keyup(function (e) {
        var nVal =  $(this).val();
        $('#txtLengthM').val(GetMeter(nVal,6));
        if (nVal == "" || nVal == null) {
            $(this).val("");
        }
    });

    $("#txtLengthM").keyup(function (e) {
        var nVal = $(this).val();
        $('#txtLengthY').val(GetYard(nVal,6));
        if (nVal == "" || nVal == null) {
            $(this).val("");
        }
    });

    
    function IntializePickerbutton(oPickerobj)
    {
        $("#" + oPickerobj.winid).find("#btnOk").click(function () {
            ButtonEvents(oPickerobj);
        });
        $(document).find('.' +oPickerobj.winclass).keydown(function (e) {
            if (e.which == 13)//enter=13
            {
                ButtonEvents(oPickerobj);
            }
        });
    }

    function ButtonEvents(oPickerobj)
    {
        debugger;
        var oreturnobj = "";var oreturnobjs = [];
        if(oPickerobj.multiplereturn){
            oreturnobjs = $('#'+oPickerobj.tableid).datagrid('getChecked');
        }else{
            oreturnobj = $('#'+oPickerobj.tableid).datagrid('getSelected');
        }

        if(oPickerobj.winid == 'winBatchs')
        {
            if (oreturnobj != null && oreturnobj.FBID> 0)
            {
                PickBatch(oreturnobj.BatchNo);
            }
            else{
                alert("Please select a batch.");
                return false;
            }
        }
        else if(oPickerobj.winid == 'winFabricBatchs')
        {
            if (oreturnobj != null && oreturnobj.FBID>0)
            {
                debugger;
                $("#txtQCLengthY").data('Qty',oreturnobj.Qty)
                $("#txtBatchNo").data('FabricBatchLoomID',oreturnobj.FabricBatchLoomID);
                $("#txtFEONo,#txtOrderNo").val(oreturnobj.FEONo);
                _oFabricBatchQC.FBQCID = 0;
                _oFabricBatchQC.FabricBatchLoomID=oreturnobj.FabricBatchLoomID;
                _nFEOID=oreturnobj.FSCDID;
                _nFBID = oreturnobj.FBID;
                PickBatch(oreturnobj.BatchNo);//change
            }
            else
            {
                alert("Please select an item from list.");
                return false;
            }
        }
        $("#" + oPickerobj.winid).icsWindow("close");
        $("#" + oPickerobj.winid).remove();
    }

    function PickBatch(sBatchNo)
    {
        var oFabricBatch={
            BatchNo:$.trim(sBatchNo),
            FBID: _nFBID,
            WeavingProcessTypeTemp : 3,
            IsFromQcMenu: true,
            Params: $("#txtBatchNo").data('FabricBatchLoomID')
        };
        //var obj = {
        //    BaseAddress: _sBaseAddress,
        //    Object: oFabricBatch,
        //    ControllerName: "FabricBatch",
        //    ActionName: "SearchByBatchNo",
        //    IsWinClose: false
        //};
        var obj = {
            BaseAddress: _sBaseAddress,
            Object: oFabricBatch,
            ControllerName: "FabricBatch",
            ActionName: "SearchBatchNoByFBP",
            IsWinClose: false
        };
        $.icsDataGet(obj, function (response) {
            if (response.status && response.obj!=null) {
                if (parseInt(response.obj.FBID) > 0) {
                    SetFabricBatchInfo(response.obj);
                }
                else {  alert("Data Not Found"); }
            }
        });
    }

    $("#txtBatchNo").keydown(function (e){
        //if (e.keyCode === 13) // Enter Press
        //{
        //    if($("#txtBatchNo").val()==null || $("#txtBatchNo").val()=="")
        //    {
        //        alert("Please type Batch No");
        //        return;
        //    }
        //    PickBatch($("#txtBatchNo").val());
        //}
        if (e.keyCode == 8 || e.keyCode==27) // Back spce
        {
            $("#txtBatchNo").removeClass("fontColorOfPickItem");
            _oFabricBatch = "";
            $('#divFBInfo').find('input').not("#txtBatchNo").val('');//all field will be empty
            var oList = [];
            DynamicRefreshListForMultipleSelection([],"tblFabricBatchQCDetail");
            _oFabricBatchQC.FBQCID = 0;
            $('#txtBatchNo').focus();
            $("#txtStatus").val("");
            $('#btnAddQCDetail').show();
            $('#btnDeleteQCDetail').show();
            $('#btnLock').show();
            $("#txtBatchNoInRollNo").val("");
            DynamicRefreshList([],"tblFBQCFault");
            $('#txtBatchNo').data('FabricBatchLoomID',0);
            $("[name=TransferSlipSelection]").val(["ProductionTransferSlip"]);
            _nFEOID=0;
            _nFBID=0;
            DynamicRefreshList([] ,'tblTS');

        }
    });

    function SetFabricBatchInfo(oFabricBatch)//change set
    {
        debugger;
        $("#txtBatchNo,#txtBatchNoInRollNo").val(oFabricBatch.BatchNo);
        $("#txtBatchNo").addClass("fontColorOfPickItem");
        $("#txtOrderNo").val(oFabricBatch.FEONo);
        //$("#txtStatus").val(oFabricBatch.StatusSt);
        $("#txtStatus").val(oFabricBatch.StatusInSt);
        
        $("#txtConstruction").val(oFabricBatch.Construction);
        $("#txtReedCount").val(oFabricBatch.ReedCountWithDent);

        $("#txtFabricType").val(oFabricBatch.FinishTypeInString);

        $("#txtProcessType").val(oFabricBatch.ProcessTypeName);
        $("#txtWeave").val(oFabricBatch.Weave);
        $("#txtOrderQtyInY").val(formatPrice(oFabricBatch.OrderQty.toFixed(2)));
        $("#txtOrderQtyInM").val(formatPrice(GetMeter(oFabricBatch.OrderQty,2)));

        $("#txtBuyer").val(oFabricBatch.BuyerName);
        $("#txtQCLengthY").val(formatPrice(parseFloat($("#txtQCLengthY").data('Qty').toFixed(2))));
        $("#txtQCLengthM").val(formatPrice(GetMeter(parseFloat($("#txtQCLengthY").data('Qty').toFixed(2)),2)));
        _oFabricBatchQC.FBID = oFabricBatch.FBID;
        _oFabricBatchQC.StatusInInt = oFabricBatch.StatusInInt;

        ResetAllTables("tblFBQCFault","tblFabricBatchQCDetail");
        _oFabricBatchQC.FBQCID = 0;

        if(parseInt(oFabricBatch.StatusInInt)>0)
        {
            _nFBID=oFabricBatch.FBID;
            GetQCInformation(oFabricBatch.FBID);
        }
        if(parseInt(oFabricBatch.StatusInInt)==10)//In QC
        {
            $('#cboShift').val(0);
            $('#btnQCDone').show();
        }
        if(parseInt(oFabricBatch.StatusInInt)>10 && parseInt(oFabricBatch.StatusInInt)!=13)//QC Done, 13 = InStore
        {
            //$('#cboBreakage').show();
            $('#cboShift').val(0);
            $('#btnAddQCDetail,#btnDeleteQCDetail,#btnLock').hide();
        }
        $('#txtBatchNo').focus();
    }

    function GetQCInformation(nFBID)
    {
        if (parseInt(nFBID) > 0)
        {
            $.ajax
            ({
                type: "GET",
                dataType: "json",
                //url : _sBaseAddress+  "/FabricBatch/GetFabricBatchInQC",
                url : _sBaseAddress+  "/FabricBatch/GetQCByProduction",
                //data: { id:nFBID},
                data: { id:nFBID}, //$("#txtBatchNo").data('FabricBatchLoomID')
                contentType: "application/json; charset=utf-8",
                success: function (data) {
                    debugger;
                    var oFabricBatchQC = jQuery.parseJSON(data);
                    if (parseInt(oFabricBatchQC.FBID)>0)
                    {
                        if(parseInt(oFabricBatchQC.FBQCID)>0)
                        {
                            _oFabricBatchQC = oFabricBatchQC;
                            $('#cboEmployee').val(_oFabricBatchQC.QCInCharge);
                            if(parseInt(oFabricBatchQC.FabricBatchStatusInInt)==10)
                            {
                                $('#btnQCDone').show();
                            }
                            $("#btnCheckingParameter,#btnPrintFabricBatchQC,#btnPrintFabricBatchQC2").show();
                            //$("[name=TransferSlipSelection]").val(["ProductionTransferSlip"]);
                            //DynamicRefreshList(oFabricBatchQC.FabricBatchQCTransfers,'tblTS');
                        }
                      
                        DynamicRefreshListForMultipleSelection(oFabricBatchQC.FabricBatchQCDetails,"tblFabricBatchQCDetail");
                        //DynamicRefreshList(oFabricBatchQC.FabricBatchQCFaults,"tblFBQCFault");
                        if(oFabricBatchQC.FabricBatchQCDetails.length > 0)
                        {
                            _oFabricBatchQC.FBQCID = oFabricBatchQC.FabricBatchQCDetails[0].FBQCID;
                            $('#cboShift').val(oFabricBatchQC.FabricBatchQCDetails[oFabricBatchQC.FabricBatchQCDetails.length-1].ShiftID);
                        }
                        SetTotal();
                        //SetTotalFabricBatchQCFaults();
                       
                    }
                    //debugger;
                    //$("[name=TransferSlipSelection]").val(["ProductionTransferSlip"]);
                    //DynamicRefreshList(oFabricBatchQC.FabricBatchQCTransfers,'tblTS');
                },
                error: function (xhr, status, error)
                {
                    alert(error);
                }

            });
        }
    }

    function SetTotalFabricBatchQCFaults()     
    {
        SetNoOfFault();
        var nTotalValue=0;
        var oFBQCFaults = $("#tblFBQCFault").datagrid("getRows");
        var nLength = oFBQCFaults.length;
        if(nLength>0)
        {
            for(var i=0;i<nLength;i++)
            {
                nTotalValue = parseFloat(nTotalValue) + parseFloat(oFBQCFaults[i].NoOfFault);
            }
        }
        $("#lblTotalValue").text(formatPrice(nTotalValue,2));
    }

    $("#txtLengthM,#txtRemark").keydown(function(e){
        if(e.keyCode === 13)
        {
            AddQCDetail();
        }
    });

    //QCDetail Start
    function AddQCDetail()
    {
        debugger;

        if(parseInt(_oFabricBatchQC.FBID)<=0 || $('#txtBatchNo').data('FabricBatchLoomID')<=0)
        {
            alert("Please select Fabric Batch");
            return false;
        }
        //alert(_oFabricBatchQC.StatusInInt);
        //if(parseInt(_oFabricBatchQC.StatusInInt)!=3 && parseInt(_oFabricBatchQC.StatusInInt)!=5 && parseInt(_oFabricBatchQC.StatusInInt)!=8 && parseInt(_oFabricBatchQC.StatusInInt)!=9 && parseInt(_oFabricBatchQC.StatusInInt)!=10 && parseInt(_oFabricBatchQC.StatusInInt)!=13)
        //{
        //    alert("Please select only sizing finish or Weaving/ Weaving finish or in QC fabric batch or in store");
        //    return false;
        //}
        if (parseInt($("#cboGrade").val()) == 0) {
            alert("Please select Grade");
            $("#cboGrade").focus();
            $("#cboGrade").addClass("errorFieldBorder");
            return false;
        } else {
            $("#cboGrade").removeClass("errorFieldBorder");
        }

        if($.trim($("#txtRollNo").val()) == "")
        {
            alert("Give roll no.");
            $("#txtRollNo").focus();
            return false;
        }

        if (parseFloat($("#txtLengthY").val())<= 0) {
            alert("Length should be greater than 0");
            $("#txtLengthY").focus();
            $("#txtLengthY").addClass("errorFieldBorder");
            return false;
        } else {
            $("#txtLengthY").removeClass("errorFieldBorder");
        }

        if (parseFloat($("#txtWidthY").val())<= 0) {
            alert("Width should be greater than 0");
            $("#txtWidthY").focus();
            $("#txtWidthY").addClass("errorFieldBorder");
            return false;
        } else {
            $("#txtWidthY").removeClass("errorFieldBorder");
        }

        if ($("#cboShift").val()<= 0) {
            alert("Select shift");
            $("#cboShift").focus();
            $("#cboShift").addClass("errorFieldBorder");
            return false;
        } else {
            $("#cboShift").removeClass("errorFieldBorder");
        }


        var nGrade =$("#cboGrade").val();
        var sGrade =$("#cboGrade option:selected").text();


        var oFBQCDetail = {
            FBQCID : _oFabricBatchQC.FBQCID,
            FBQCDetailID :0,
            LotNo : $.trim($("#txtRollNo").val()), //sDynamicLotNo
            Qty : $("#txtLengthY").val(),
            QtyInMeter:GetMeter($("#txtLengthY").val(),8),//get meter
            //Grade :$("#cboGrade").val(),
            FabricQCGradeID :$("#cboGrade").val(),
            ShiftID : $("#cboShift").val(),
            FabricBatchLoomID : $('#txtBatchNo').data('FabricBatchLoomID'),
            Remark : $.trim($("#txtRemark").val()),
            Width : $("#txtWidthY").val()
        };
        Save(oFBQCDetail,-1);//add
    }

    function DeleteQCDetail()
    {
        var oFBQCDetail= $("#tblFabricBatchQCDetail").datagrid("getSelected");
        if (oFBQCDetail == null || parseInt(oFBQCDetail.FBQCDetailID) <= 0) {
            alert("Please select an item from list!");
            return false;
        }
        if (oFBQCDetail.DeliveryBy!=0) {
            alert("Sorry, This item already delivered!");
            return false;
        }

        if (!confirm("Confirm to Delete?")) return false;
        var nRowIndex = $("#tblFabricBatchQCDetail").datagrid("getRowIndex", oFBQCDetail);
        if (parseInt(oFBQCDetail.FBQCDetailID) > 0)
        {
            $.ajax
            ({
                type: "GET",
                dataType: "json",
                url : _sBaseAddress+  "/FabricBatch/DeleteQCDetail",
                data: { id: oFBQCDetail.FBQCDetailID},
                contentType: "application/json; charset=utf-8",
                success: function (data) {
                    //
                    feedbackmessage = jQuery.parseJSON(data);
                    if (feedbackmessage == "Deleted")
                    {
                        alert("Delete sucessfully");
                        $("#tblFabricBatchQCDetail").datagrid("deleteRow", nRowIndex);
                        SetTotal();
                    }
                    else
                    {
                        alert(feedbackmessage);
                    }
                },
                error: function (xhr, status, error)
                {
                    alert(error);
                }

            });
        }

    }

    function GetDynamicIndexForExistingGrade(nGradeID)
    {
        var oQCDetails =$("#tblFabricBatchQCDetail").datagrid("getRows");
        var nCount = 0;
        if(oQCDetails.length>0)
        {
            for(var i=0;i<oQCDetails.length;i++)
            {
                if(parseInt(oQCDetails[i].GradeInInt) == parseInt(nGradeID) && oQCDetails[i].DeliveryBy==0)
                {
                    return i;
                }
            }

        }
        return -1;
    }

    function RefreshObject()
    {
        var oFabricBatchQC= {
            FBQCID: _oFabricBatchQC.FBQCID,
            FBID:_oFabricBatchQC.FBID,
            QCStartDateTime:new Date(),
            FabricBatchLoomID :_oFabricBatchQC.FabricBatchLoomID
        };
        return oFabricBatchQC;
    }

    function Save(oFabricBatchQCDetail,nSelectedIndex)
    {
        oFabricBatchQCDetail.FabricBatchQC = RefreshObject();
        $.ajax({
            type: "POST",
            dataType: "json",
            url : _sBaseAddress+"/FabricBatch/SaveQCDetail",
            traditional: true,
            data:  JSON.stringify(oFabricBatchQCDetail),
            contentType: "application/json; charset=utf-8",
            success: function (data) {

                oFabricBatchQCDetail = jQuery.parseJSON(data);
                if (parseInt(oFabricBatchQCDetail.FBQCDetailID) >0 && (oFabricBatchQCDetail.ErrorMessage==null || oFabricBatchQCDetail.ErrorMessage==""))
                {
                    if(nSelectedIndex==-1)
                    {
                        var nRowLength = $("#tblFabricBatchQCDetail").datagrid("getRows").length;
                        $("#tblFabricBatchQCDetail").datagrid("appendRow", oFabricBatchQCDetail);
                        $("#tblFabricBatchQCDetail").datagrid("selectRow", nRowLength);
                    }else{
                        $('#tblFabricBatchQCDetail').datagrid('updateRow', { index: nSelectedIndex, row: oFabricBatchQCDetail });
                        $("#tblFabricBatchQCDetail").datagrid("selectRow", nSelectedIndex);
                    }
                    _oFabricBatchQC = oFabricBatchQCDetail.FabricBatchQC;
                    $('#btnQCDone').show();
                    $("#txtStatus").val(_oFabricBatchQC.StatusSt);
                    SetTotal();

                    $('#cboShift').val(oFabricBatchQCDetail.ShiftID);
                    $("#txtLengthY").val(0);
                    $("#txtLengthM").val(0);
                    $("#txtRemark,#txtRollNo").val("");
                    $("#txtRollNo").focus();
                }
                else {
                    alert(oFabricBatchQCDetail.ErrorMessage);
                }
            },
            error: function (xhr, status, error) {
                alert(error);
            }

        });
    }


    $('#btnOKTransfer').click(function(e){
        var oFBQCDs=$("#tblFabricBatchQCDetail").datagrid("getChecked");
        debugger;
        if (oFBQCDs.length==0) {
            alert("Please check minimum one item!");
            return false;
        }
        var nLength = oFBQCDs.length;
        var bHasUnlockItem=false;
        var sFBQCDetailIDs="";
        for(var i=0;i<nLength;i++)
        {
            if(oFBQCDs[i].DeliveryBy == 0)
            {
                sFBQCDetailIDs = oFBQCDs[i].FBQCDetailID + "," + sFBQCDetailIDs;
                bHasUnlockItem=true;
            }
        }

        if(!bHasUnlockItem)
        {
            alert("Your selected item(s) already delivered.");
            return false;
        }
        if($.trim(sFBQCDetailIDs) == "")
        {
            alert("Select item(s) from list.");
            return false;
        }
        sFBQCDetailIDs = sFBQCDetailIDs.substring(0, sFBQCDetailIDs.length - 1);


        if (!confirm("Confirm send to delivery store?")) return false;

        debugger;

      
        var oFabricBatchQCDetail={
            FBQCDetailIDs : sFBQCDetailIDs,
            FBQCID : oFBQCDs[0].FBQCID,
            ProDate :  $("#dtProDate").datebox("getValue"),
            DeliveryDate: $("#dtDeliveryDate").datebox("getValue")
        };

      
        var obj =
        {
            BaseAddress: _sBaseAddress,
            Object: oFabricBatchQCDetail,
            ObjectId: oFabricBatchQCDetail.FBQCDetailID,
            ControllerName: "FabricBatch",
            ActionName: "LockFabricBatchQCDetail",
            TableId: "",
            IsWinClose: false,
            Message: ""
        };
        $.icsSave(obj, function (response) {
            if (response.status && response.obj != null) {
                if ($.trim(response.obj.ErrorMessage) == "")
                {
                    alert("Successfully Sent.");
                    $("#winFabricQCLockDateWindow").icsWindow("close");
                    DynamicRefreshListForMultipleSelection(response.obj.FabricBatchQCDetails,"tblFabricBatchQCDetail");
                    $("[name=TransferSlipSelection]").val(["ProductionTransferSlip"]);
                    DynamicRefreshList(response.obj.FabricBatchQCTransfers ,'tblTS');
                }
            }
        });
            
      
       
    });

    $('#btnCloseWindowLockDate').click(function(e){
        $("#winFabricQCLockDateWindow").icsWindow("close");
    });

    $('#btnExcelDailyLog').click(function(e){

            
        $("#txtComingBeam").val(200);
        $("#winComingBeamFinished").icsWindow("open");
    });


    function Lock(oFBQCD)
    {
        var oFBQCDs=$("#tblFabricBatchQCDetail").datagrid("getChecked");

        if (oFBQCDs.length==0) {
            alert("Please check minimum one item!");
            return false;
        }
        $("#dtProDate").datebox({ disabled:  false  });
        $("#dtProDate").datebox("setValue", icsdateformat(new Date()));

        $("#dtDeliveryDate").datebox({ disabled:  false  });
        $("#dtDeliveryDate").datebox("setValue", icsdateformat(new Date()));
        $("#winFabricQCLockDateWindow").icsWindow("open");
    }

    //QCDone Start
    function QCDone()
    {
        debugger;
        if(parseInt(_oFabricBatchQC.FBQCID)<=0)
        {
            alert("Sorry, there is no fabric batch QC!");
            return false;
        }
        if(parseInt(_oFabricBatchQC.StatusInInt)!=10)
        {
            alert("Sorry, This batch card not yet in QC!");
            return false;
        }
        if($('#cboEmployee').val()<=0)
        {
            alert("Select in charge.");
            $('#cboEmployee').focus();
            return false;
        }

        var nTotalLength = parseFloat($("#txtQCLengthM").val());
        var nTotalQcDetailQty=0;
        var oQCDetails = $("#tblFabricBatchQCDetail").datagrid("getRows");
        if(oQCDetails.length > 0 && nTotalLength > 0)
        {
            debugger;
            $.map(oQCDetails,function(oQCDetail){
                nTotalQcDetailQty = parseFloat(oQCDetail.QtyInMeter) + parseFloat(nTotalQcDetailQty)
            });
            var nCurrentPercentage = parseFloat(((nTotalQcDetailQty / nTotalLength) * 100).toFixed(2));
            if(parseFloat($("#txtPercentage").val()) >= nCurrentPercentage)
            {
                alert("Fabric QC qty ("+nCurrentPercentage+"%) must be greater than " + parseFloat($("#txtPercentage").val()) + "%");
                return false;
            }
        }

        var oFabricBatchQC = {
            FBQCID:_oFabricBatchQC.FBQCID,
            FBID:_oFabricBatchQC.FBID,
            QCEndDateTime:new Date(),
            QCInCharge:$('#cboEmployee').val(),
            TotalLength:$('#txtQCLengthY').val()
        };

        $.ajax({
            type: "POST",
            dataType: "json",
            url : _sBaseAddress+"/FabricBatch/QCDone",
            traditional: true,
            data:  JSON.stringify(oFabricBatchQC),
            contentType: "application/json; charset=utf-8",
            success: function (data) {
               var  oFabricBatchQC = jQuery.parseJSON(data);
               if (parseInt(oFabricBatchQC.StatusInInt)==11)
                {
                   alert("Successfully done QC.");
                   DynamicRefreshListForMultipleSelection(oFabricBatchQC.FabricBatchQCDetails,"tblFabricBatchQCDetail");
                   if(oFabricBatchQC.FabricBatchQCDetails.length > 0)
                   {
                       _oFabricBatchQC.FBQCID = oFabricBatchQC.FabricBatchQCDetails[0].FBQCID;
                   }
                    $('#btnQCDone').hide();
                    $("#txtStatus").val(oFabricBatchQC.StatusSt);
                    $('#btnAddQCDetail').hide();
                    $('#btnDeleteQCDetail').hide();
                    $('#btnLock').hide();
                    return false;
                }
                else {
                    alert(oFabricBatchQC.ErrorMessage);
                }
            },
            error: function (xhr, status, error) {
                alert(error);
            }

        });
    }
    //QCDone End

    function Print()
    {
        var oFBQCDetail= $("#tblFabricBatchQCDetail").datagrid("getSelected");
        if (oFBQCDetail == null || parseInt(oFBQCDetail.FBQCDetailID) <= 0) {
            alert("Please select an item from list!");
            return false;
        }
        var nts = ((new Date()).getTime()) / 1000;
        window.open(_sBaseAddress + '/FabricBatch/PrintFinalInspectionSticker?nFBQCDetailID=' + oFBQCDetail.FBQCDetailID + "&nts=" + nts, "_blank");
    }

    $("#btnTransferSlip").click(function(){

        var oFabricBatchQCDetails = $("#tblFabricBatchQCDetail").datagrid("getChecked");
        if(oFabricBatchQCDetails.length <= 0)
        {
            alert("Please select item(s) from list.");
            return false;
        }
        var sFBQCDetailIDs = "";
        var sFBQCRollNos = "";
        var bHasNotReceivedItem = false;
        var bHasReceivedItem = false;
        var bIsUnlock = false;
        for(var i=oFabricBatchQCDetails.length - 1; i >= 0; i--)
        {
            sFBQCDetailIDs += oFabricBatchQCDetails[i].FBQCDetailID +',';
            //if(oFabricBatchQCDetails[i].IsLock == true && oFabricBatchQCDetails[i].ReceiveBy == 0)
            //{
            //    bHasNotReceivedItem=true;
            //    sFBQCDetailIDs = oFabricBatchQCDetails[i].FBQCDetailID + "," + sFBQCDetailIDs;

            //}
            //else if(oFabricBatchQCDetails[i].IsLock == true)
            //{
            //    bHasReceivedItem=true;
            //    sFBQCRollNos = oFabricBatchQCDetails[i].LotNo + "," + sFBQCRollNos;
            //}
        }
        sFBQCDetailIDs = sFBQCDetailIDs.substring(0, sFBQCDetailIDs.length - 1);

        //if(bHasReceivedItem)
        //{
        //    sFBQCRollNos = sFBQCRollNos.substring(0, sFBQCRollNos.length - 1);
        //    alert("Roll No " + sFBQCRollNos + " already received, So these rolls are avoid to make slip.");
        //    return false;
        //}

        //if(!bHasNotReceivedItem){
        //    alert("No list found (Only delivered and also not received item consider).");
        //    return false;
        //}

        var nFBPID=$("#txtBatchNo").data('FabricBatchLoomID')

        var nts = ((new Date()).getTime()) / 1000;
        window.open(_sBaseAddress + '/FabricBatch/PrintTransferSlip?sFBQCDetailIDs=' + sFBQCDetailIDs +  " &nFBID=" + _oFabricBatchQC.FBID + " &nFBPID=" + nFBPID+ " &nts=" + nts+" &TransferSlipID=" +0, "_blank");
    });

    $("#btnTransferSlipFromTabTS").click(function(){
        var oSelectedTS = $("#tblTS").datagrid("getSelected");
        if(oSelectedTS==null ){
            alert("Please Select one Transfer slip");
            return false;
        }
        var nFBPID=$("#txtBatchNo").data('FabricBatchLoomID')

        var nts = ((new Date()).getTime()) / 1000;
        window.open(_sBaseAddress + '/FabricBatch/PrintTransferSlip?sFBQCDetailIDs=' + "" +  " &nFBID=" + _oFabricBatchQC.FBID + " &nFBPID=" + nFBPID+ " &nts=" + nts+" &TransferSlipID=" +oSelectedTS.FBQCTransferID, "_blank");
    });

    function RefreshList(oList)
    {
        var data=oList;
        data={"total":""+data.length+"","rows":data};
        $('#tblFabricBatchQCDetail').datagrid('loadData',data);
    }

    function SetTotal()
    {
        var oFBQDetails = $('#tblFabricBatchQCDetail').datagrid('getRows');
        var nTotalLengthY = 0;
        var nLength = oFBQDetails.length;
        for(var i = 0;i<nLength;i++)
        {
            nTotalLengthY = parseFloat(nTotalLengthY)+ parseFloat(oFBQDetails[i].Qty);
        }
        $("#lblTotalLotNo").html(nLength);
        $('#nTotalLengthY').html(nTotalLengthY.toFixed(2));
        debugger;
        var QtyInMtr=parseFloat(GetMeter(nTotalLengthY,2)).toFixed(2);

        $('#nTotalLengthM').html(QtyInMtr);
    }

    $('#tblFabricBatchQCDetail').datagrid({
        rowStyler:function(index,row){
            if (row.DeliveryBy!=0){
                return 'background-color:lightgreen;color:blue;font-weight:bold;';
            }
           
        }
    });

    //$('#tblFabricBatchQCDetail').datagrid({        
    //    onSelect: function (rowIndex, rowData)
    //    {
    //        endEditing();
    //        GetFabricBatchQCFault(rowData)
    //    }
    //});

    $('input:radio[name=TransferSlipSelection]').change(function() {
        if (this.value == 'BatchTransferSlip') {
            if (_nFBID > 0)
            {
                $.ajax
                ({
                    type: "GET",
                    dataType: "json",
                    url : _sBaseAddress+  "/FabricBatch/GetFabricBatchWiseTransferSlip",
                    data: { id:_nFBID,isBatch:true},
                    contentType: "application/json; charset=utf-8",
                    success: function (data) {
                   
                        var oFabricBatchQC = jQuery.parseJSON(data);
                        $("[name=TransferSlipSelection]").val(["BatchTransferSlip"]);
                        DynamicRefreshList(oFabricBatchQC.FabricBatchQCTransfers ,'tblTS');
                

                    },
                    error: function (xhr, status, error)
                    {
                        alert(error);
                    }

                });
            }
        }
        else if (this.value == 'OrderTransferSlip') {
            if (_nFEOID > 0)
            {
                $.ajax
                ({
                    type: "GET",
                    dataType: "json",
                    url : _sBaseAddress+  "/FabricBatch/GetOrderWiseTransferSlip",
                    data: { id:_nFEOID},
                    contentType: "application/json; charset=utf-8",
                    success: function (data) {
                   
                        var oFabricBatchQC = jQuery.parseJSON(data);
                        $("[name=TransferSlipSelection]").val(["OrderTransferSlip"]);
                        DynamicRefreshList(oFabricBatchQC.FabricBatchQCTransfers ,'tblTS');
                

                    },
                    error: function (xhr, status, error)
                    {
                        alert(error);
                    }

                });
            }
        }
        else if (this.value == 'ProductionTransferSlip') {
            
            if ( parseInt($("#txtBatchNo").data('FabricBatchLoomID')) > 0)
            {
                $.ajax
                ({
                    type: "GET",
                    dataType: "json",
                    url : _sBaseAddress+  "/FabricBatch/GetFabricBatchWiseTransferSlip",
                    data: { id:parseInt($("#txtBatchNo").data('FabricBatchLoomID')) ,isBatch:false},
                    contentType: "application/json; charset=utf-8",
                    success: function (data) {
                   
                        var oFabricBatchQC = jQuery.parseJSON(data);
                        $("[name=TransferSlipSelection]").val(["ProductionTransferSlip"]);
                        DynamicRefreshList(oFabricBatchQC.FabricBatchQCTransfers ,'tblTS');
                

                    },
                    error: function (xhr, status, error)
                    {
                        alert(error);
                    }

                });
            }
        }
    });

    function GetFabricBatchQCFault(oFNBQCD)
    {
        debugger;
        endEditingFault();
        var oFabricBatchQCDetail = {
            FBQCDetailID: oFNBQCD.FBQCDetailID,
            FBQCID: oFNBQCD.FBQCID
        }

        $.ajax({
            type: "POST",
            dataType: "json",
            url : _sBaseAddress+  "/FabricBatch/GetFabricBatchQCFalults",
            traditional: true,
            data:  JSON.stringify(oFabricBatchQCDetail),
            contentType: "application/json; charset=utf-8",
            success: function (data) {
                var oFabricBatchQCFaults = jQuery.parseJSON(data);
                if(oFabricBatchQCFaults.length > 0){
                    DynamicRefreshList(oFabricBatchQCFaults,'tblFBQCFault');
                }else{
                    DynamicRefreshList([],'tblFBQCFault');
                    for(var i=0;i<_oFaults.length;i++){
                        var oDetail = {
                            FBQCFaultID: 0,
                            FBQCDetailID: oFNBQCD.FBQCDetailID,
                            FPFID: _oFaults[i].FPFID,
                            FPFName: _oFaults[i].Name,
                            FaultPoint: 1,
                            NoOfFault: 0,
                            FaultTotal: 0
                        }
                        $('#tblFBQCFault').datagrid('appendRow',oDetail);
                    }

                }
                $.icsMakeFooterColumn('tblFBQCFault',['FPFName','FaultPoint','NoOfFault','FaultTotal']);
            },
            error: function (xhr, status, error) {
                alert(error);
            }
        });
    }

    var editIndexFault = undefined;
    function endEditingFault(){
        if (editIndexFault == undefined){return true}
        if ($('#tblFBQCFault').datagrid('validateRow', editIndexFault)){
            $('#tblFBQCFault').datagrid('endEdit', editIndexFault);
            $('#tblFBQCFault').datagrid('selectRow',editIndexFault);
            var oQCFault=$('#tblFBQCFault').datagrid('getSelected');
            if(oQCFault!=null)
            {
                oQCFault.NoOfFault = parseFloat(oQCFault.NoOfFault);
                oQCFault.FaultPoint = parseFloat(oQCFault.FaultPoint);
                oQCFault.FaultTotal = parseFloat(oQCFault.NoOfFault)*parseFloat(oQCFault.FaultPoint);
                $('#tblFBQCFault').datagrid('updateRow',{index: editIndexFault,	row: oQCFault});
            }
            editIndexFault = undefined;
            return true;
        }
        else
        {
            return false;
        }
    }
    function onClickRowFault(index){
        if (editIndexFault != index){
            if (endEditingFault())
            {
                $('#tblFBQCFault').datagrid('selectRow', index).datagrid('beginEdit', index);
                editIndexFault = index;
            }
            else
            {
                $('#tblFBQCFault').datagrid('selectRow', editIndexFault);
            }
        }
    }

    $("#btnDeleteFault").click(function ()
    {
        endEditingFault();
        var oQCFault=$('#tblFBQCFault').datagrid('getSelected');
        if(oQCFault==null)
        {
            alert("Please select a valid item from list.");
            return;
        }
        if (!confirm("Confirm to Delete?")) return false;
        var nIndex= $('#tblFBQCFault').datagrid('getRowIndex',oQCFault);
        if(oQCFault.FBQCFaultID<=0){
            $('#tblFBQCFault').datagrid('deleteRow',nIndex);
        }
        else{
            var obj = {
                BaseAddress: _sBaseAddress,
                Object: oQCFault,
                ControllerName: "FabricBatch",
                ActionName: "DeleteFabricBatchQCFault",
                TableId: "tblFBQCFault",
                IsWinClose: false
            };
            $.icsDelete(obj, function (response) {
                $.icsMakeFooterColumn('tblFBQCFault',['FPFName','FPFName','NoOfFault','FaultTotal']);
            });
        }

    });

    $("#btnReloadFault").click(function ()
    {
        endEditingFault();
        var oFNBQCD = $('#tblFabricBatchQCDetail').datagrid('getSelected');
        var oRows=$('#tblFBQCFault').datagrid('getRows');
        for(var i=0;i<_oFaults.length;i++){
            var isExist = false;
            for(var j=0;j<oRows.length;j++){
                if(_oFaults[i].FPFID == oRows[j].FPFID){
                    isExist=true;
                    break;
                }
            }
            if(isExist == false){
                var oDetail = {
                    FBQCFaultID: 0,
                    FBQCDetailID: oFNBQCD.FBQCDetailID,
                    FPFID: _oFaults[i].FPFID,
                    FPFName: _oFaults[i].Name,
                    FaultPoint: 1,
                    NoOfFault: 0,
                    FaultTotal: 0
                }
                $('#tblFBQCFault').datagrid('appendRow',oDetail);
            }
            $.icsMakeFooterColumn('tblFBQCFault',['FPFName','FaultPoint','NoOfFault','FaultTotal']);
        }
    });

    $("#btnSave").click(function (){
        debugger;
        endEditingFault();
        if(!Validation()) return false;
        var oFBQCFaults = [];
        var oRows=$('#tblFBQCFault').datagrid('getRows');
        for(var i= 0 ;i <oRows.length; i++){
            if(parseFloat(oRows[i].NoOfFault) > 0){
                oFBQCFaults.push(oRows[i]);
            }
        }

        if(oFBQCFaults.length <= 0){
            alert("Please enter No Of fault atleast one Detail!!");
            return;
        }
        $.ajax({
            type: "POST",
            dataType: "json",
            url : _sBaseAddress+"/FabricBatch/SaveMultipleFBQCFault",
            traditional: true,
            data:  JSON.stringify(oFBQCFaults),
            contentType: "application/json; charset=utf-8",
            success: function (data) {
                //debugger;
                oDatas = jQuery.parseJSON(data);
                if(oDatas.length > 0){
                    alert("Data Saved Successfully!!");
                    DynamicRefreshList(oDatas,'tblFBQCFault');
                    $.icsMakeFooterColumn('tblFBQCFault',['FPFName','FaultPoint','NoOfFault','FaultTotal']);
                }
            },
            error: function (xhr, status, error) {
                alert(error);
            }

        });
    });

    function Validation(){

        if(_oFabricBatchQC.FBQCID <= 0){
            alert("Please Select Dispo!!");
            return false;
        }

        var oRows=$('#tblFBQCFault').datagrid('getRows');
        if(oRows.length<=0){
            alert("Atleast one detail required!!");
            return false;
        }

        return true;
    }

    $('#btnPrintFabricBatchQC').click(function(){
        if(_oFabricBatchQC==null || parseInt(_oFabricBatchQC.FBQCID)<=0)
        {
            alert("Please Select Dispo!!");
            $('#txtFEONo').focus();
            return;
        }
        window.open(_sBaseAddress+ "/FabricBatch/PrintFabricBatchQC?nFBQCID="+_oFabricBatchQC.FBQCID);
    });

    $('#btnPrintFabricBatchQC2').click(function(){
        if(_oFabricBatchQC==null || parseInt(_oFabricBatchQC.FBID)<=0)
        {
            alert("Please Select Dispo!!");
            $('#txtFEONo').focus();
            return;
        }
        debugger;
        window.open(_sBaseAddress+ "/FabricBatch/PrintFabricBatchQC2?nFBQCID="+_oFabricBatchQC.FBQCID);
    });

    //NAZMUL 10/09/2019
    $('#btnCheckingParameter').click(function(){
        debugger;
        if(_oFabricBatchQC.FBQCID<=0){
            alert("Please put QC detail first!");
            return;
        }
        var oFabricBatchQCChecks = {
            FabricBatchQCID : _oFabricBatchQC.FBQCID
        }        
        $.ajax({
            type: "POST",
            dataType: "json",
            url:  _sBaseAddress+'/FabricBatch/GetAllCheckingParameter',
            data:  JSON.stringify(oFabricBatchQCChecks),
            contentType: "application/json; charset=utf-8",
            success: function (data) {                
                var oCheckingParameters = jQuery.parseJSON(data);
                if (oCheckingParameters != null && oCheckingParameters.length > 0) {
                    if (oCheckingParameters[0].ErrorMessage == "") {
                        DynamicRefreshList(oCheckingParameters,'tblFabricBatchQCChecks');
                        $('#winCheckingParameters').icsWindow('open', "Checking Parameter");   
                    } 
                    else 
                    {
                        alert(oCheckingParameters[0].ErrorMessage);    
                    }
                }
                else 
                {
                    alert("Data Not Found!");    
                }
            },
            error: function (xhr, status, error) {
                alert(error);
            }
        });      
    })
    // Edit checking parameter
    function onclickrowCheckingParameter(index){
        if (editIndexCheckingParameter != index){
            if (endEditingCheckingParameter())
            {
                $('#tblFabricBatchQCChecks').datagrid('selectRow', index).datagrid('beginEdit', index);
                editIndexCheckingParameter = index;
            }
            else
            {
                $('#tblFabricBatchQCChecks').datagrid('selectRow', editIndexCheckingParameter);
            }
        }
    }
    var editIndexCheckingParameter = undefined;
    function endEditingCheckingParameter(){
        if (editIndexCheckingParameter == undefined){return true}
        if ($('#tblFabricBatchQCChecks').datagrid('validateRow', editIndexCheckingParameter)){
            $('#tblFabricBatchQCChecks').datagrid('endEdit', editIndexCheckingParameter);
            editIndexCheckingParameter = undefined;
            return true;
        }
        else
        {
            return false;
        }
    }

    $('#btnCPRefresh').click(function(){
        endEditingCheckingParameter();
    });
    $("#btnCPClose").click(function(){
        $("#winCheckingParameters").icsWindow('close');
    })
    $('#btnCPSave').click(function() {
        debugger;
        endEditingCheckingParameter();
        var CheckingParameters = $('#tblFabricBatchQCChecks').datagrid('getRows');
        var _CheckingParameters = [];      
        for (var i = 0; i <CheckingParameters.length; i++) {
             CheckingParameters[i].FabricBatchQCID = _oFabricBatchQC.FBQCID;
            _CheckingParameters.push(CheckingParameters[i]);               
        }
        debugger;
        $.ajax({
            type: "POST",
            dataType: "json",
            url : _sBaseAddress+ "/FabricBatch/CheckingParameterSave",
            traditional: true,
            data:  JSON.stringify(_CheckingParameters),
            contentType: "application/json; charset=utf-8",
            success: function (data)
            {
                var oCheckingParameters = jQuery.parseJSON(data);
                if (oCheckingParameters[0] != null && oCheckingParameters[0].ErrorMessage=="")
                {      
                    alert("Saved Successfully");
                    $("#winCheckingParameters").icsWindow('close');
                }
                else
                {
                    alert(oCheckingParameters[0].ErrorMessage);
                }
                    
            },
            error: function (xhr, status, error) {
                alert(error);
            }

        });
    });

    $("#btnCPDelete").click(function ()
    {
        debugger;
        endEditingCheckingParameter();
        var oFabricBatchQCCheck=$('#tblFabricBatchQCChecks').datagrid('getSelected');
        if(oFabricBatchQCCheck==null)
        {
            alert("Please select a valid item from list.");
            return;
        }
        if (!confirm("Confirm to Delete?")) return false;
        var nIndex= $('#tblFabricBatchQCChecks').datagrid('getRowIndex',oFabricBatchQCCheck);
        if(oFabricBatchQCCheck.FabricBatchQCCheckID<=0){
            $('#tblFabricBatchQCChecks').datagrid('deleteRow',nIndex);
        }
        else{
            var obj = {
                BaseAddress: _sBaseAddress,
                Object: oFabricBatchQCCheck,
                ControllerName: "FabricBatch",
                ActionName: "DeleteFabricBatchQCCheck",
                TableId: "tblFabricBatchQCChecks",
                IsWinClose: false
            };
            $.icsDelete(obj, function (response) {
                
            });
        }

    });

    $("#btnCPReload").click(function ()
    {
        debugger;
        endEditingCheckingParameter();
        //var oFabricBatchQCCheck=$('#tblFabricBatchQCChecks').datagrid('getSelected');
        var oRows=$('#tblFabricBatchQCChecks').datagrid('getRows');
        for(var i=0;i<_oFabricQCParNames.length;i++){
            var isExist = false;
            for(var j=0;j<oRows.length;j++){
                if(_oFabricQCParNames[i].FabricQCParNameID == oRows[j].FabricQCParNameID){
                    isExist=true;
                    break;
                }
            }
            if(isExist == false){
                var oDetail = {
                    FabricBatchQCCheckID: 0,
                    FabricQCParNameID: _oFabricQCParNames[i].FabricQCParNameID,
                    FabricBatchQCID: _oFabricBatchQC.FBQCID,
                    Name: _oFabricQCParNames[i].Name, 
                    Note: _oFabricQCParNames[i].Note 
                }
                $('#tblFabricBatchQCChecks').datagrid('appendRow',oDetail);
            }           
        }
    });


</script>