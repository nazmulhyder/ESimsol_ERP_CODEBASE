<html>
<head>  
    <link href="@Url.Content("~/Content/Site.css")" rel="stylesheet" type="text/css" />
    <link href="@Url.Content("~/Content/CSS/icon.css")" rel="stylesheet" type="text/css" />
    <link href="@Url.Content("~/Content/CSS/easyui.css")" rel="stylesheet" type="text/css" />
    <link href="@Url.Content("~/Content/CSS/Pikerstyle.css")" rel="stylesheet" type="text/css" />
    <link href="@Url.Content("~/Content/CSS/mainstyle.css")" rel="stylesheet" type="text/css" /> 
    <script src="@Url.Content("~/Scripts/jquery-1.7.1.min.js")" type="text/javascript"></script>
    <script src="@Url.Content("~/Scripts/jquery-latest.js")" type="text/javascript"></script>
    <link href="../../Content/CSS/newPikerview.css" rel="stylesheet" type="text/css" />
    <script src="@Url.Content("~/Scripts/jquery-ui-1.8.22.custom.min.js")" type="text/javascript"></script>
    <script src="@Url.Content("~/Scripts/UserControlScript/GlobalScript.js")" type="text/javascript"></script>
    <link href="@Url.Content("~/Content/CSS/Control.css")" rel="stylesheet" type="text/css" />
    <link href="@Url.Content("~/Content/CSS/jquery-ui-1.8.22.custom.css")" rel="stylesheet" type="text/css" />  
    <script src="@Url.Content("~/Scripts/jquery.unobtrusive-ajax.js")" type="text/javascript"></script>

     @*for json stringify *@          
    <script src="@Url.Content("~/Scripts/jquery-ui.min.js")" type="text/javascript"></script> 
    <script src="@Url.Content("~/Scripts/json2.js")" type="text/javascript"></script> 
</head>
<body>

@{
    ViewBag.Title = "Add Measurement Unit";
}
@model ESimSol.BusinessObjects.MeasurementUnit


<div style="font-family:Tahoma">           
<table border="0" cellspacing="2" cellpadding="2">
    <tr>
        <td style="background-color:#CFB53B; text-align:center; width:450px; color:White">
            <label id="lblHeaderName" style="font-size:15px; font-weight:bold; text-decoration:Underline; width:450px"> Add Measurement Unit</label>
        </td>
    </tr>
</table>

<fieldset style="width:430px; text-align:right">   
     <table border="0"> 
           <tr>
                <td style="width:155px; font-size:13px; text-align:right">
                     Unit Name:
                </td> 
                 <td style="width:240px; text-decoration:underline; text-align:right">
                      @Html.TextBoxFor(model => model.UnitName, new { style = "width: 215px;", id = "txtUnitName" }) 
                </td>  
                <td></td>                
          </tr>
          <tr>
                <td style="width:155px; font-size:13px; text-align:right">
                     Unit Type:
                </td> 
                 <td style="width:240px; text-decoration:underline; text-align:right">
                      @Html.DropDownListFor(model => model.UnitType, new SelectList(Enum.GetValues(typeof(ESimSol.BusinessObjects.EnumUniteType))), new { id = "cboUnitType", style = "width: 215px;" }) 
                </td>  
                <td></td>                
          </tr>
           <tr>
                <td style="width:155px; font-size:13px; text-align:right">
                     Symbol:
                </td> 
                 <td style="width:240px; text-decoration:underline; text-align:right">
                     @Html.TextBoxFor(model => model.Symbol, new { style = "width: 215px;", id = "txtSymbol" })
                </td>  
                <td></td>                
          </tr>
          <tr>
                <td style="width:155px; font-size:13px; text-align:right">
                     Note:
                </td> 
                 <td style="width:240px; text-decoration:underline; text-align:right">
                      @Html.TextBoxFor(model => model.Note, new { style = "width: 215px;", id = "txtNote" }) 
                </td> 
                <td></td>                 
          </tr>
     </table>
</fieldset>
    <table>
        <tr>
            <td>
                <table border="0">
                    <tr>
                        <td style="width:10Px">@Html.CheckBoxFor(model => model.IsRound, new { id = "chkIsRound" })</td>
                        <td style="width:80Px; font-size:13px;">Is Round</td>
                        <td style="width:10Px">@Html.CheckBoxFor(model => model.IsSmallUnit, new { id = "chkIsSmallUnit" })</td>
                        <td style="width:80Px; font-size:13px;">Is Small Unit</td>
                </table>
            </td>
        </tr>
        <tr style="height:50px">
            <td style="width:500px">
                <table>
                    <tr>
                        <td style="width:240px"></td>
                        <td style="width:80px; text-align:right">
                            <input type="button" value="Save" id="btnOk" style="width:70px;" /> 
                        </td>
                        <td style="width:80px; text-align:right">
                            <input type="button" value="Cancel" id="btnClose" style="width:70px;" />
                        </td>
                    </tr>
                </table>
            </td>
        </tr>
    </table>
  </div>
</body>
</html>

<script type="text/javascript">
    var _ActionName;
    var _oMeasurementUnit = null;
    var _obj = JSON.parse(sessionStorage.getItem("Parameter"));

    $(document).ready(function () {
        _oMeasurementUnit =@Html.Raw( new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(Model)); 
        document.getElementById('lblHeaderName').innerHTML=_obj.Name;
        chkIsChecked(); 
    });

     function chkIsChecked() {
         _ActionName = _obj.Name;
        if (_ActionName == "View Measurement Unit") {
             document.getElementById("btnOk").style.display ='none';
             $("#txtUnitName").attr("disabled", "disabled");   
             $("#cboUnitType").attr("disabled", "disabled");  
             $("#txtSymbol").attr("disabled", "disabled"); 
             $("#txtNote").attr("disabled", "disabled");  
             $("#chkIsRound").attr("disabled", "disabled");
             $("#chkIsSmallUnit").attr("disabled", "disabled");
        }                 
    }

    $('#btnClose').click(function(e) {
        window.close();
    });
    
   function ValidateInput()
   {
        var sUnitName = $("#txtUnitName").val();
        var sUnitType = document.getElementById("cboUnitType");
        var nUnitType = sUnitType.options[sUnitType.selectedIndex].innerHTML;
        var sSymbol = $("#txtSymbol").val();
        var sNote = $("#txtNote").val();   
        var bIsRound = document.getElementById("chkIsRound").checked;
        var bIsSU = document.getElementById("chkIsSmallUnit").checked;
        if (sUnitName == "") {
            alert("Please Enter the Unit Name");
            document.getElementById("txtUnitName").style.borderColor ='red';
            document.getElementById("txtUnitName").focus();
            return false;
        }
            if (nUnitType == "None") {
            alert("Please Enter the Unit Name");
            document.getElementById("cboUnitType").style.borderColor ='red';
            document.getElementById("cboUnitType").focus();
            return false;
        }

            if (sSymbol == "") {
            alert("Please Enter the Symbol");
            document.getElementById("txtSymbol").style.borderColor ='red';
            document.getElementById("txtSymbol").focus();
            return false;
        }
        return true;
    }


    function RefreshObject()
    {
        var sUnitType = document.getElementById("cboUnitType");
        var oMUnit= {
            MeasurementUnitID : _oMeasurementUnit.MeasurementUnitID,
            UnitName : $("#txtUnitName").val(),
            UnitTypeInt : document.getElementById("cboUnitType").selectedIndex, 
            UnitType : document.getElementById("cboUnitType").selectedIndex,                            
            Symbol : $("#txtSymbol").val(),
            Note : $("#txtNote").val(),
            IsRound : document.getElementById("chkIsRound").checked,
            IsSmallUnit : document.getElementById("chkIsSmallUnit").checked,
            UnitTypeInString: sUnitType.options[sUnitType.selectedIndex].innerHTML
        };
        return oMUnit;
    } 


     $('#btnOk').click(function (e) {
        if(!ValidateInput()) return;
        var oMeasurementUnit=RefreshObject();       
        $.ajax({
            type: "POST",
            dataType: "json",
            url: '@Url.Action("Save", "MeasurementUnit")',
            traditional: true,
            data:  JSON.stringify(oMeasurementUnit),
            contentType: "application/json; charset=utf-8",
            success: function (data) {
                var oMeasurementUnit = jQuery.parseJSON(data);
                if (oMeasurementUnit.ErrorMessage == '' || oMeasurementUnit.ErrorMessage == null) {
                    alert("Data Saved sucessfully");
                    //window.returnValue = oMeasurementUnit;
                    debugger;
                    window.opener.WinReturnMU(oMeasurementUnit);
                    window.close();
                }
                else {
                    alert(oMeasurementUnit.ErrorMessage);
                }
            },
            error: function (xhr, status, error) {
                alert(error);
            }
        });
    })

    $(document).keydown(function(e) {    
        if(e.which == 27)//escape=27
        {
            window.close();
        }
    });
  </script>