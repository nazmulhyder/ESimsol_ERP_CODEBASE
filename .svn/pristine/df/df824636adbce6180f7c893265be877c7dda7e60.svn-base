@{
    ViewBag.Title = "PAM List";
}
@model  ESimSol.BusinessObjects.PAM

    <div class="menuMainCollectionTable">
        <div id="MainDiv" class="easyui-panel" title="Add Multi PAM" style="font-family:Tahoma;height:88%">
     
            <div style="width:100%; overflow:auto">
                <div style="width:100%; margin-top:4px">
                    <table id="tblAddMultiPAMHeader" class="tablebordaer" cellpadding="0" cellspacing="0" style="width:100%">
                        <tr>
                            <td style="width:3%; text-align:left">Del</td>
                            <td style="width:8%; text-align:center">Style</td>
                            <td style="width:8%; text-align:center">Colour</td>
                            <td style="width:8%; text-align:center">Quantity(Min)</td>
                            <td style="width:8%; text-align:center">Quantity</td>
                            <td style="width:8%; text-align:center">Quantity(Max)</td>
                            <td style="width:8%; text-align:center">Confirm Week</td>
                            <td style="width:8%; text-align:center">Designation Week</td>
                            <td style="width:8%; text-align:center">Forwarded Week</td>
                            <td style="width:8%; text-align:center">WH Delivery week</td>
                            <td style="width:8%; text-align:center">Remarks</td>
                        </tr>
                    </table>

                    <div class="tablebordaer" id="divAddMultiPAMDetails" style="height:420px; width:99.80%; overflow:auto">
                        <table class="tablebordaer" id="tblAddMultiPAMDetail" border="0" cellpadding="0" cellspacing="0"></table>
                    </div>
                    <div style="width:100%">
                        <table border="0" cellpadding="0" cellspacing="0" style="width:100%">
                            <tr>
                                <td style="width:16%; text-align:left; font-size:12px; font-weight:bold"></td>
                                <td colspan="4" style="width:28%; text-align:right; font-size:12px; font-weight:bold"></td>
                            </tr>
                            <tr style="vertical-align:bottom">
                                <td style="width:8%; text-align:left; font-size:10px; font-weight:bold"></td>
                                <td style="width:8%; text-align:left; font-size:10px; font-weight:bold"></td>
                                <td style="width:8%; text-align:right; font-size:11px; font-weight:bold"><span style="margin-right:2px;"></span><label id="lblTotalMinQty"> 0.00</label>&nbsp;&nbsp;</td>
                                <td style="width:8%; text-align:right; font-size:11px; font-weight:bold"><span style="margin-right:2px;"></span><label id="lblTotalQty">0.00</label></td>
                                <td style="width:8%; text-align:right; font-size:11px; font-weight:bold"><span style="margin-right:2px;"></span><label id="lblTotalMaxQty"> 0.00</label>&nbsp;&nbsp;</td>
                                <td colspan="5" style="width:60%; text-align:left; font-size:10px; font-weight:bold"></td>

                            </tr>
                        </table>
                    </div>

                </div>
            </div>
        </div>
        <fieldset style="height:10%">
            <legend style="font-weight: bold">Action : </legend>
            <table border="0" cellspacing="2" cellpadding="2" style="font-size: 11px; font-weight: bold; width:100%">
                <tr>
                    <td style="width:60%; text-align:right"></td>
                    <td style="width:40%;text-align:right;">
                        <a id="btnSave" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-save" plain="true">Save</a>
                        <a id="btnClose" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-cancel" plain="true">Close</a>
                    </td>
                </tr>
            </table>
        </fieldset>
    </div>

    <style type="text/css">
        .tablebordaer {
        border: 1px solid black;
    }
        
    #tblAddMultiPAMDetail td{
        border-left: 1px solid #D8D8D8;
        border-bottom: 1px solid #D8D8D8;
    }

    #tblAddMultiPAMHeader  td{
        border-left: 1px solid black;
    }

    .highlight {
        background-color: #CFB53B !important;
        color: white !important;
    }

    .textboxstyle {
        background-color: black !important;
        color: white !important;
        border: none !important;
        font-weight: bold !important;
    }

    .textboxstyle2 {
        background-color: #CFB53B !important;
        color: white !important;
        border: none !important;
    }

    .delClass, .Styleclass, .Colorclass,.MinQtyclass,.Qtyclass,.MaxQtyclass,.ConfirmWeekclass,.DesignationWeekclass,.ForwardWeekclass,.WearHouseWeekclass,.Remarksclass {
        border: none !important;
    }

    .MinQtyclass, .Qtyclass, .MaxQtyclass {
        border: none !important;
        text-align: right !important;
    }        

    .tableclass tr td {
        background-color: white !important;
    }

    .tableclass tr:hover td {
        background-color: #CFB53B !important;
        color: white !important;
    }
    </style>
  <script type="text/javascript">
      var _nInputBoxIndex=-1;
      var _sInputBoxClass='';
      $(document).ready(function () {
          debugger;
          var oPAMs =@Html.Raw( new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(Model));
          var oMultiPAMs = $("#tblAddMultiPAMDetail").data('rows');
          if(oMultiPAMs=='undefined'  || oMultiPAMs==null || oMultiPAMs.length<=0)
          {
              var oMultiPAM=NewObject();
              AddMultiPAMDetail(oMultiPAM);
          }
          RefreshSummery();
      });
      function NewObject()
      {
          debugger;
          var oTechnicalShet=jQuery.parseJSON(sessionStorage.getItem("TechnicalSheet"));
          var oMultiPAM={
              PAMDetailID : 0,
              PAMID : 0,
              ColorID : 0, 
              StyleNo:oTechnicalShet.StyleNo,
              StyleID:oTechnicalShet.TechnicalSheetID,
              ColorName:"",
              MinQuantity:0,
              Quantity:0,
              MaxQuantity:0,
              ConfirmWeek:"",
              DesignationWeek:"",
              ForwardWeek:"",
              WearHouseWeek:"",
              Remarks:""

          }
          return oMultiPAM;
      }

      function AddMultiPAMDetail(oMultiPAM)
      {
          debugger;
          var nRowIndex=0;
          var oMultiPAMs = $('#tblAddMultiPAMDetail').data('rows');
          if(oMultiPAMs=='undefined' || oMultiPAMs==null||oMultiPAMs.length<=0)
          {
              nRowIndex=0;
              oMultiPAMs =[];
          }
          else
          {
              nRowIndex=oMultiPAMs.length;
          }
          oMultiPAMs.push(oMultiPAM);
          $('#tblAddMultiPAMDetail').data('rows', oMultiPAMs);
          $("#tblAddMultiPAMDetail").data('selectedIndex',nRowIndex);
          var table = document.getElementById('tblAddMultiPAMDetail');
          var row = table.insertRow(nRowIndex);

          var cellDel = row.insertCell(0);
          cellDel.width= "3%";
          cellDel.innerHTML = '<label id="delClass'+nRowIndex+'" rowIndex="'+nRowIndex+'"onclick="DeleteRow('+nRowIndex+');"  class="delClass" style="width:100%;color:#c00;cursor:pointer;" >X</label>';

          var cellStyle = row.insertCell(1);
          cellStyle.width= "8%";
          cellStyle.innerHTML = '<input readonly type="text" rowIndex="'+nRowIndex+'" value="'+ oMultiPAM.StyleNo +'" class="Styleclass" style="width:100%;font-size:13px""/>';

          var cellColour = row.insertCell(2);
          cellColour.width= "8%";
          cellColour.innerHTML = '<input  type="text" rowIndex="'+nRowIndex+'" value="'+oMultiPAM.ColorName+'" class="Colorclass" style="width:100%;font-size:13px" />';

          var cellMinQty = row.insertCell(3);
          cellMinQty.width= "8%";
          cellMinQty.innerHTML = '<input  type="text" rowIndex="'+nRowIndex+'" value="'+oMultiPAM.MinQuantity+'" class="MinQtyclass number" style="width:100%;font-size:13px;text-align:right" />';

          var cellQty = row.insertCell(4);
          cellQty.width= "8%";
          cellQty.innerHTML = '<input  type="text" rowIndex="'+nRowIndex+'" value="'+oMultiPAM.Quantity+'" class="Qtyclass number" style="width:100%;font-size:13px;text-align:right" />';

          var cellMaxQty = row.insertCell(5);
          cellMaxQty.width= "8%";
          cellMaxQty.innerHTML = '<input  type="text" rowIndex="'+nRowIndex+'" value="'+oMultiPAM.MaxQuantity+'" class="MaxQtyclass number" style="width:100%;font-size:13px;text-align:right" />';

          var cellConfirmWeek = row.insertCell(6);
          cellConfirmWeek.width= "8%";
          cellConfirmWeek.innerHTML = '<input  type="text" rowIndex="'+nRowIndex+'" value="'+oMultiPAM.ConfirmWeek+'" class="ConfirmWeekclass number" style="width:100%;font-size:13px" />';

          var cellDesignationWeek = row.insertCell(7);
          cellDesignationWeek.width= "8%";
          cellDesignationWeek.innerHTML = '<input  type="text" rowIndex="'+nRowIndex+'" value="'+oMultiPAM.DesignationWeek+'" class="DesignationWeekclass number" style="width:100%;font-size:13px" />';

          var cellForwardWeek = row.insertCell(8);
          cellForwardWeek.width= "8%";
          cellForwardWeek.innerHTML = '<input  type="text" rowIndex="'+nRowIndex+'" value="'+oMultiPAM.ForwardWeek+'" class="ForwardWeekclass number" style="width:100%;font-size:13px"  />';

          var cellWearHouseWeek = row.insertCell(9);
          cellWearHouseWeek.width= "8%";
          cellWearHouseWeek.innerHTML = '<input   type="text" rowIndex="'+nRowIndex+'" value="'+oMultiPAM.WearHouseWeek+'" class="WearHouseWeekclass number" style="width:100%;font-size:13px" />';

          var cellRemarks = row.insertCell(10);
          cellRemarks.width= "8%";
          cellRemarks.innerHTML = '<input type="text"  rowIndex="'+nRowIndex+'" value="'+oMultiPAM.Remarks+'" class="Remarksclass" style="width:100%;font-size:13px" />';
          if(nRowIndex==0){
              ResetAllRows();
              var sClassName=".Colorclass";                      
              ResetAllInputBox(nRowIndex,  sClassName);                      
              InitializeKeyDownEvent(sClassName);
          }
          InitializeEvent();
      }

      function InitializeEvent()
      {
          $("#tblAddMultiPAMDetail tr").click(function() {
              ResetAllRows();
              $(this).addClass("highlight");
              $(this).find('input').addClass("textboxstyle2");
              $("#tblAddMultiPAMDetail").data("selectedIndex", this.rowIndex);
              ResetAllInputBox(_nInputBoxIndex, _sInputBoxClass);
          });
          $('.delClass').click(function (e) {
              _nInputBoxIndex = $('.delClass').index(this);
              _sInputBoxClass='.delClass';
              InitializeKeyDownEvent(".delClass"); return;
          });
          $('.Styleclass').click(function (e) {
              _nInputBoxIndex = $('.Styleclass').index(this);
              _sInputBoxClass='.Styleclass';
              InitializeKeyDownEvent(".Styleclass"); return;
          });

          $('.Colorclass').click(function (e) {
              _nInputBoxIndex = $('.Colorclass').index(this);
              _sInputBoxClass='.Colorclass';
              InitializeKeyDownEvent(".Colorclass"); return;
          });

          $('.MinQtyclass').click(function (e) {
              _nInputBoxIndex = $('.MinQtyclass').index(this);
              _sInputBoxClass='.MinQtyclass';
              InitializeKeyDownEvent(".MinQtyclass"); return;
          });

          $('.Qtyclass').click(function (e) {
              _nInputBoxIndex = $('.Qtyclass').index(this);
              _sInputBoxClass='.Qtyclass';
              InitializeKeyDownEvent(".Qtyclass"); return;
          });

          $('.MaxQtyclass').click(function (e) {
              _nInputBoxIndex = $('.MaxQtyclass').index(this);
              _sInputBoxClass='.MaxQtyclass';
              InitializeKeyDownEvent(".MaxQtyclass"); return;
          });

          $('.ConfirmWeekclass').click(function (e) {
              _nInputBoxIndex = $('.ConfirmWeekclass').index(this);
              _sInputBoxClass='.ConfirmWeekclass';
              InitializeKeyDownEvent(".ConfirmWeekclass"); return;
          });

          $('.DesignationWeekclass').click(function (e) {
              _nInputBoxIndex = $('.DesignationWeekclass').index(this);
              _sInputBoxClass='.DesignationWeekclass';
              InitializeKeyDownEvent(".DesignationWeekclass"); return;
          });

          $('.ForwardWeekclass').click(function (e) {
              _nInputBoxIndex = $('.ForwardWeekclass').index(this);
              _sInputBoxClass='.ForwardWeekclass';
              InitializeKeyDownEvent(".ForwardWeekclass"); return;
          });

          $('.WearHouseWeekclass').click(function (e) {
              _nInputBoxIndex = $('.WearHouseWeekclass').index(this);
              _sInputBoxClass='.WearHouseWeekclass';
              InitializeKeyDownEvent(".WearHouseWeekclass"); return;
          });

          $('.Remarksclass').click(function (e) {
              _nInputBoxIndex = $('.Remarksclass').index(this);
              _sInputBoxClass='.Remarksclass';
              InitializeKeyDownEvent(".Remarksclass"); return;
          });
      }


      function ResetAllRows()
      {
          var tblMultiPAMDetail=document.getElementById("tblAddMultiPAMDetail");
          if(tblMultiPAMDetail.rows!=null)
          {
              for(var i=0; i<tblMultiPAMDetail.rows.length; i++)
              {
                  $('#tblAddMultiPAMDetail tr').eq(i).removeClass("highlight");
                  $('#tblAddMultiPAMDetail tr').eq(i).find('input').removeClass("textboxstyle2");
              }
          }
      }
      function RefreshSummery()
      {
          var nTotalMinQty=0,nTotalQty=0,nTotalMaxQty=0;
          var oTempMultiPAMs= $("#tblAddMultiPAMDetail").data('rows');
          if(oTempMultiPAMs==null)oTempMultiPAMs=[];
          for(var i=0; i<oTempMultiPAMs.length; i++)
          {
              nTotalMinQty=nTotalMinQty+ parseFloat(oTempMultiPAMs[i].MinQuantity);
              nTotalQty=nTotalQty+ parseFloat(oTempMultiPAMs[i].Quantity);
              nTotalMaxQty=nTotalMaxQty+ parseFloat(oTempMultiPAMs[i].MaxQuantity);
          }
          $('#lblTotalMinQty').html(formatPrice(nTotalMinQty, null));
          $('#lblTotalQty').html(formatPrice(nTotalQty, null));
          $('#lblTotalMaxQty').html(formatPrice(nTotalMaxQty, null));
      }

      function InitializeKeyDownEvent(classname)
      {
          
          $('.delClass').unbind("keydown");
          $('.Styleclass').unbind("keydown");
          $('.Colorclass').unbind("keydown");
          $('.MinQtyclass').unbind("keydown");
          $('.Qtyclass').unbind("keydown");
          $('.MaxQtyclass').unbind("keydown");
          $('.ConfirmWeekclass').unbind("keydown");
          $('.DesignationWeekclass').unbind("keydown");
          $('.ForwardWeekclass').unbind("keydown");
          $('.WearHouseWeekclass').unbind("keydown");
          $('.Remarksclass').unbind("keydown");

          if(classname===".Colorclass")
          {
              $('.Colorclass').keydown(function (e) {
                  if (e.which === 13) {
                      var sClassName="";
                      var nRowIndex=$("#tblAddMultiPAMDetail").data('selectedIndex');
                      var oTechnicalSheetColor={
                          TechnicalSheetID:   $("#tblAddMultiPAMDetail").data('rows')[nRowIndex].StyleID
                      }
                      var obj = {
                          BaseAddress: sessionStorage.getItem('BaseAddress'),
                          Object: oTechnicalSheetColor,
                          ControllerName: "PAM",
                          ActionName: "GetsColor",
                          IsWinClose: false
                      };

                      $.icsDataGets(obj, function (response) {
                          if (response.status && response.objs.length > 0) {
                              if (parseInt(response.objs[0].TechnicalSheetColorID) > 0) {
                                  var tblColums = []; var oColumn = { field: "ColorName", title: "Color", width: 100, align: "left" }; tblColums.push(oColumn);
                                  var oPickerParam = {
                                      winid: 'winColor',
                                      winclass: 'clsItem',
                                      winwidth: 500,
                                      winheight: 420,
                                      tableid: 'tblColor',
                                      tablecolumns: tblColums,
                                      datalist: response.objs,
                                      multiplereturn: false,
                                      searchingbyfieldName: 'ColorName',
                                      windowTittle: 'Color List',
                                      
                                  };
                                  $.icsPicker(oPickerParam);
                                  IntializePickerbutton(oPickerParam);
                              }
                              else { alert(response.objs[0].ErrorMessage); }
                          }
                          else
                          {
                              alert("Data Not Found!");
                          }
                      });
                    
                  }
              });
          }
          
          if(classname===".MinQtyclass")
          {
              $('.MinQtyclass').keydown(function (e) {
                  if ( e.which === 13) {
                      var sClassName="";
                      var nRowIndex=$("#tblAddMultiPAMDetail").data('selectedIndex');

                          if($(this).val()<=0){
                              alert("Please give Minimum Quantity");
                              return;
                          }
                      $("#tblAddMultiPAMDetail").data('rows')[nRowIndex].MinQuantity = $(this).val();
                      var index = $('.MinQtyclass').index(this);
                      ResetAllInputBox(index, '.Qtyclass');
                      sClassName=".Qtyclass";
                      InitializeKeyDownEvent(sClassName); return;
                  }
              });
          }

          if(classname===".Qtyclass")
          {
              $('.Qtyclass').keydown(function (e) {
                  if ( e.which === 13) {
                      var sClassName="";
                      var nRowIndex=$("#tblAddMultiPAMDetail").data('selectedIndex');
                          if($(this).val()<=0){
                              alert("Please give  Quantity");
                              return;
                          }
                          if($(this).val()<parseFloat($("#tblAddMultiPAMDetail").data('rows')[nRowIndex].MinQuantity)){
                              alert("Quantity Cannot be smaller than Minimum Quantity");
                              return;
                          }
                      $("#tblAddMultiPAMDetail").data('rows')[nRowIndex].Quantity = $(this).val();
                      var index = $('.Qtyclass').index(this);
                      ResetAllInputBox(index, '.MaxQtyclass');
                      sClassName=".MaxQtyclass";
                      InitializeKeyDownEvent(sClassName); return;
                  }
              });
          }
          
          if(classname===".MaxQtyclass")
          {
              $('.MaxQtyclass').keydown(function (e) {
                  if ( e.which === 13) {
                      var sClassName="";
                      var nRowIndex=$("#tblAddMultiPAMDetail").data('selectedIndex');

                          if($(this).val()<=0){
                              alert("Please give  MaximumQuantity");
                              return;
                          }
                          if($(this).val()<parseFloat($("#tblAddMultiPAMDetail").data('rows')[nRowIndex].Quantity)){
                              alert("Quantity Cannot be Greater than Maximum Quantity");
                              return;
                          }

                      $("#tblAddMultiPAMDetail").data('rows')[nRowIndex].MaxQuantity = $(this).val();
                      var index = $('.MaxQtyclass').index(this);
                      ResetAllInputBox(index, '.ConfirmWeekclass');
                      sClassName=".ConfirmWeekclass";
                      InitializeKeyDownEvent(sClassName); return;
                  }
              });
          }
          
          if(classname===".ConfirmWeekclass")
          {
              $('.ConfirmWeekclass').keydown(function (e) {
                  if ( e.which === 13) {
                      var sClassName="";
                      var nRowIndex=$("#tblAddMultiPAMDetail").data('selectedIndex');


                      if(!CheckDateValidation( $(this).val()))return;

                      $("#tblAddMultiPAMDetail").data('rows')[nRowIndex].ConfirmWeek = $(this).val();
                      var index = $('.ConfirmWeekclass').index(this);
                      ResetAllInputBox(index, '.DesignationWeekclass');
                      sClassName=".DesignationWeekclass";
                      InitializeKeyDownEvent(sClassName); return;
                  }
              });
          }
          
          if(classname===".DesignationWeekclass")
          {
              $('.DesignationWeekclass').keydown(function (e) {
                  if ( e.which === 13) {
                      var sClassName="";
                      var nRowIndex=$("#tblAddMultiPAMDetail").data('selectedIndex');
                      if(!CheckDateValidation( $(this).val()))return;
                      if(!ValidationBetweenWeek($(this).val(),$("#tblAddMultiPAMDetail").data('rows')[nRowIndex].ConfirmWeek)){alert("DesignationWeek cannot be smaller than ConfirmWeek");return false;}
                      $("#tblAddMultiPAMDetail").data('rows')[nRowIndex].DesignationWeek = $(this).val();
                      var index = $('.DesignationWeekclass').index(this);
                      ResetAllInputBox(index, '.ForwardWeekclass');
                      sClassName=".ForwardWeekclass";
                      InitializeKeyDownEvent(sClassName); return;
                  }
              });
          }

          if(classname===".ForwardWeekclass")
          {
              $('.ForwardWeekclass').keydown(function (e) {
                  if ( e.which === 13) {
                      var sClassName="";
                      var nRowIndex=$("#tblAddMultiPAMDetail").data('selectedIndex');

  
                      if(!CheckDateValidation( $(this).val()))return;
                      if(!ValidationBetweenWeek($(this).val(),$("#tblAddMultiPAMDetail").data('rows')[nRowIndex].DesignationWeek)){alert("ForwardWeek cannot be smaller than DesignationWeek");return false;}

                      $("#tblAddMultiPAMDetail").data('rows')[nRowIndex].ForwardWeek = $(this).val();
                      var index = $('.ForwardWeekclass').index(this);
                      ResetAllInputBox(index, '.WearHouseWeekclass');
                      sClassName=".WearHouseWeekclass";
                      InitializeKeyDownEvent(sClassName); return;
                  }
              });
          }

          if(classname===".WearHouseWeekclass")
          {
              $('.WearHouseWeekclass').keydown(function (e) {
                  if ( e.which === 13) {
                      var sClassName="";
                      var nRowIndex=$("#tblAddMultiPAMDetail").data('selectedIndex');
                      
                      if(!CheckWearHouseDateValidation($(this).val()))return;
                      if($(this).val() != "")
                      {
                          if(!ValidationBetweenWeek($(this).val(),$("#tblAddMultiPAMDetail").data('rows')[nRowIndex].ForwardWeek))
                          {
                              alert("WearHouseWeek cannot be smaller than ForwardWeek");
                              return false;
                          }
                      }
                      $("#tblAddMultiPAMDetail").data('rows')[nRowIndex].WearHouseWeek = $(this).val();
                      var index = $('.WearHouseWeekclass').index(this);
                      ResetAllInputBox(index, '.Remarksclass');
                      sClassName=".Remarksclass";
                      InitializeKeyDownEvent(sClassName); return;
                  }
              });
          }

          if(classname===".Remarksclass")
          {
              $('.Remarksclass').keydown(function (e) {
                  if ( e.which === 13) {
                      debugger;
                      var sClassName="";
                      var nRowIndex=$("#tblAddMultiPAMDetail").data('selectedIndex');
                      $("#tblAddMultiPAMDetail").data('rows')[nRowIndex].Remarks = $(this).val();
                      if(($("#tblAddMultiPAMDetail").data('rows').length - 1) == nRowIndex)
                      {
                          debugger;
                   
                          var oMultiPAM= $("#tblAddMultiPAMDetail").data('rows')[nRowIndex];
                          if(!ValidateColorWeek(nRowIndex))return;
                            if(!ValidateeachRow(oMultiPAM))return;
                            var oTempMultiPAM = {
                                PAMDetailID : oMultiPAM.PAMDetailID,
                                PAMID : oMultiPAM.PAMID,
                                ColorID : oMultiPAM.ColorID, 
                                StyleNo : oMultiPAM.StyleNo,
                                StyleID : oMultiPAM.StyleID,
                                ColorName : oMultiPAM.ColorName,
                                MinQuantity : oMultiPAM.MinQuantity,
                                Quantity : oMultiPAM.Quantity,
                                MaxQuantity : oMultiPAM.MaxQuantity,
                                ConfirmWeek : oMultiPAM.ConfirmWeek,
                                DesignationWeek : oMultiPAM.DesignationWeek,
                                ForwardWeek : oMultiPAM.ForwardWeek,
                                WearHouseWeek : oMultiPAM.WearHouseWeek,
                                Remarks : oMultiPAM.Remarks
                            };
                            AddMultiPAMDetail(oTempMultiPAM);
                      }
                      var nNextRowIndex = (nRowIndex+1);
                      $("#tblAddMultiPAMDetail").data('selectedIndex',nNextRowIndex);
                      ResetAllRows();
                      var sClassName=".Colorclass";                      
                      ResetAllInputBox(nNextRowIndex,  sClassName);  
                      RefreshSummery();
                      InitializeKeyDownEvent(sClassName);
                  }
              });
          }

          
      }
      function ValidateColorWeek(nRowIndex)
      {
          var oTempMultiPAMs= $("#tblAddMultiPAMDetail").data('rows');
          for( var i=0; i<oTempMultiPAMs.length; i++)
          {
              if( parseInt(i) != parseInt(nRowIndex))
              { 
                  if(oTempMultiPAMs[i].ColorID==oTempMultiPAMs[nRowIndex].ColorID && oTempMultiPAMs[i].ForwardWeek==oTempMultiPAMs[nRowIndex].ForwardWeek)
                  {
                      alert("Sorry same color and forward week alredy exist");
                      return false;
                  }
              }
          }
          return true;
      }
      function IntializePickerbutton(oPickerobj) {

          $("#" + oPickerobj.winid).find("#btnOk").click(function () {

              SetPickerValueAssign(oPickerobj);
          });

          $(document).find('.' + oPickerobj.winclass).keydown(function (e) {
              if (e.which == 13)//enter=13
              {
                  SetPickerValueAssign(oPickerobj);

              }

          });
      }

      function SetPickerValueAssign(oPickerobj)
      {

          var oreturnObj = null, oreturnobjs = [];
          if (oPickerobj.multiplereturn)
          {
              oreturnobjs = $('#'+oPickerobj.tableid).datagrid('getChecked');
          } else {
              oreturnObj = $('#'+oPickerobj.tableid).datagrid('getSelected');
          }
          $("#" + oPickerobj.winid).icsWindow("close");
          $("#" + oPickerobj.winid).remove();
          if (oPickerobj.winid == 'winColor') {
              var nRowIndex=$("#tblAddMultiPAMDetail").data('selectedIndex');
              if (oreturnObj != null && parseInt(oreturnObj.TechnicalSheetColorID) > 0) {
                  debugger;
                
                  $("#tblAddMultiPAMDetail").data('rows')[nRowIndex].ColorID =oreturnObj.ColorCategoryID;
                  $("#tblAddMultiPAMDetail").data('rows')[nRowIndex].ColorName =oreturnObj.ColorName;
                  $('.Colorclass').eq(nRowIndex).val(oreturnObj.ColorName);
              }


              if(parseInt(nRowIndex)!=0){
                  if( $('.Colorclass').eq(nRowIndex).val()==null|| $('.Colorclass').eq(nRowIndex).val()==""){
                      if( $("#tblAddMultiPAMDetail").data('rows').length>1){
                          DeleteRow(nRowIndex);
                          $("#btnSave").focus();
                          return;
                      }
                     
                  }
                         
              }
              else if(($("#tblAddMultiPAMDetail").data('rows').length - 1)== nRowIndex)
              {
                  if( $('.Colorclass').eq(nRowIndex).val()==null|| $('.Colorclass').eq(nRowIndex).val()==""){
                      alert("Please give Color first");
                      return;
                  }
              }
              var index = $('.Colorclass').index($('.Colorclass').eq(nRowIndex));
              ResetAllInputBox(index, '.MinQtyclass');
              sClassName=".MinQtyclass";
              InitializeKeyDownEvent(sClassName); return;
              
          }
      }

      function ValidateeachRow(oMultiPAM)
      {
          if(parseFloat(oMultiPAM.MinQuantity)<=0){
              alert("Min Quantity can not be zero");
              return false;
          }
          if(parseFloat(oMultiPAM.Quantity)<=0){
              alert(" Quantity can not be zero");
              return false;
          }
          if(parseFloat(oMultiPAM.Quantity)<parseFloat(oMultiPAM.MinQuantity)){
              alert("Quantity can not be Smaller than Minimum Quantity");
              return false;
          }
          if(parseFloat(oMultiPAM.MaxQuantity)<=0){
              alert(" Quantity can not be zero");
              return false;
          }
          if(parseFloat(oMultiPAM.MaxQuantity)<parseFloat(oMultiPAM.Quantity)){
              alert("Quantity can not be Greater than Maximum Quantity");
              return false;
          }
          if(oMultiPAM.ConfirmWeek.length!=6){
              alert("Length should be 6");
              return false;
          }
          if(oMultiPAM.DesignationWeek.length!=6){
              alert("Length should be 6");
              return false;
          }
          if(oMultiPAM.ForwardWeek.length!=6){
              alert("Length should be 6");
              return false;
          }
          if(oMultiPAM.WearHouseWeek.length!=0)
          {
              if(oMultiPAM.WearHouseWeek.length!=6){
                  alert("Length should be 6");
                  return false;
              }
          }
          if(!CheckDateValidation(oMultiPAM.ConfirmWeek))return false;
          if(!CheckDateValidation(oMultiPAM.DesignationWeek))return false;
          if(!CheckDateValidation(oMultiPAM.ForwardWeek))return false;
          if(!CheckWearHouseDateValidation(oMultiPAM.WearHouseWeek))return false;
          if(!ValidationBetweenWeek(oMultiPAM.DesignationWeek,oMultiPAM.ConfirmWeek)){alert("Designationweek cannot be smaller than Confirm week");return false;}
          if(!ValidationBetweenWeek(oMultiPAM.ForwardWeek,oMultiPAM.DesignationWeek)){alert("ForwardWeek cannot be smaller than DesignationWeek");return false;}
          if(oMultiPAM.WearHouseWeek.length!=0)
          {
              if(!ValidationBetweenWeek(oMultiPAM.WearHouseWeek,oMultiPAM.ForwardWeek)){alert("WearHouseWeek cannot be smaller than ForwardWeek");return false;}
          }
          return true;
      }
      
      function  CheckWearHouseDateValidation(ConfirmWeek)
      {
          var d = new Date();
          var year = parseInt(d.getFullYear());
          var sConfirmWeekYear=ConfirmWeek.substring(0,4);
          var sConfirmWeek=ConfirmWeek.substring(4,6);
          var ConfirmWeek=ConfirmWeek;

          if(ConfirmWeek.length==0)
          {
              return true;
          }
          else
          {
              if(ConfirmWeek.length!=6){
                  alert("Length should be 6");
                  return false;
              }
              if(sConfirmWeek==0){
                  alert("Week can not be zero");
                  return false;
              }
              if(parseInt(sConfirmWeek)>53){
                  alert("Week can not be greater than 53");
                  return false;
              }
         
              if(parseInt(sConfirmWeekYear)>year+2){
                  alert("Year Should be Between "+(year-2)+" AND "+(year+2));
                  return false;
              }
              if(parseInt(sConfirmWeekYear)<year-2){
                  alert("Year Should be Between "+(year-2)+" AND "+(year+2));
                  return false;
              }
          }
          return true;
      }
      function  CheckDateValidation(ConfirmWeek)
      {
          var d = new Date();
          var year = parseInt(d.getFullYear());
          var sConfirmWeekYear=ConfirmWeek.substring(0,4);
          var sConfirmWeek=ConfirmWeek.substring(4,6);
          var ConfirmWeek=ConfirmWeek;
          if(ConfirmWeek.length!=6){
              alert("Length should be 6");
              return false;
          }
          if(sConfirmWeek==0){
              alert("Week can not be zero");
              return false;
          }
          if(parseInt(sConfirmWeek)>53){
              alert("Week can not be greater than 53");
              return false;
          }
         
          if(parseInt(sConfirmWeekYear)>year+2){
              alert("Year Should be Between "+(year-2)+" AND "+(year+2));
              return false;
          }
          if(parseInt(sConfirmWeekYear)<year-2){
              alert("Year Should be Between "+(year-2)+" AND "+(year+2));
              return false;
          }
          return true;
      }
      function ValidationBetweenWeek(currentWeek,previousWeek)
      {
          var scurrentWeekYear=currentWeek.substring(0,4);
          var scurrentWeek=currentWeek.substring(4,6);
          var spreviousWeekYear=previousWeek.substring(0,4);
          var spreviousWeek=previousWeek.substring(4,6);
          if(parseInt(scurrentWeekYear)<parseInt(spreviousWeekYear))
          {
              return false;
          }
          if(parseInt(scurrentWeek)<parseInt(spreviousWeek)&&parseInt(scurrentWeekYear)==parseInt(spreviousWeekYear))
          {
              return false;
          }
          return true;
      }
      function validation(oMultiPAMs)
      {
          if(oMultiPAMs==null||oMultiPAMs.length<=0){
              alert("Please give at least One item");
              return false;
          }
          for(var i=0;i<oMultiPAMs.length;i++)
          {
              if(oMultiPAMs[i].ColorName==null||oMultiPAMs[i].ColorName==""){
                  alert("Please give Color Name");
                  return false;
              }
              if(parseFloat(oMultiPAMs[i].MinQuantity)<=0){
                  alert("Please give Minimum Quantity");
                  return false;
              }
              if(parseFloat(oMultiPAMs[i].Quantity)<=0){
                  alert("Please give Quantity");
                  return false;
              }
              if(parseFloat(oMultiPAMs[i].MaxQuantity)<=0){
                  alert("Please give Maximum Quantity");
                  return false;
              }
              if(parseFloat(oMultiPAMs[i].MinQuantity)>parseFloat(oMultiPAMs[i].Quantity)){
                  alert("Minimum Qty cannot be greater than Quantity");
                  return false;
              }
              if(parseFloat(oMultiPAMs[i].MaxQuantity)<parseFloat(oMultiPAMs[i].Quantity)){
                  alert("Minimum Qty cannot be Less than Quantity");
                  return false;
              }
              if(oMultiPAMs[i].ConfirmWeek.length!=6){
                  alert("Length should be 6");
                  return false;
              }
              if(oMultiPAMs[i].DesignationWeek.length!=6){
                  alert("Length should be 6");
                  return false;
              }
              if(oMultiPAMs[i].ForwardWeek.length!=6){
                  alert("Length should be 6");
                  return false;
              }
              if(oMultiPAMs[i].WearHouseWeek.length!=0)
              {
                  if(oMultiPAMs[i].WearHouseWeek.length!=6){
                      alert("Length should be 6");
                      return false;
                  }
              }
              if(!CheckDateValidation(oMultiPAMs[i].ConfirmWeek))return false;
              if(!CheckDateValidation(oMultiPAMs[i].DesignationWeek))return false;
              if(!CheckDateValidation(oMultiPAMs[i].ForwardWeek))return false;
              if(!CheckWearHouseDateValidation(oMultiPAMs[i].WearHouseWeek))return false;
          }
          return true;
      }
      function RefreshObject()
      {
          debugger;
          var oMultiPAM={
              PAMDetailLst:$('#tblAddMultiPAMDetail').data('rows')
          };

          return oMultiPAM;
      }
      $('#btnSave').click(function(){
          debugger;
          var oMultiPAMs= $("#tblAddMultiPAMDetail").data('rows');
          if(!validation(oMultiPAMs))return;
          var oMultiPAM=RefreshObject();
          $.ajax({
              type: "POST",
              dataType: "json",
              url : sessionStorage.getItem("BaseAddress")+  "/PAM/SaveMultiPAM",
              traditional: true,
              data:  JSON.stringify(oMultiPAM),
              contentType: "application/json; charset=utf-8",
              success: function (data)
              {            
                  var feedbackmessage = jQuery.parseJSON(data);
                  if (feedbackmessage=="Success")
                  {
                      alert("Data Saved sucessfully");
                     
                      window.location.href = sessionStorage.getItem("BackLink");
                  }
                  else 
                  {
                      alert(feedbackmessage);
                  }
              },
              error: function (xhr, status, error) {
                  alert(error);
              }

          });
          
      });

      function ResetAllInputBox(index, sClass)
      {

          for(var i=0; i<$('.Styleclass').length; i++)
          {
              $('.delClass').eq(i).removeClass("highlight");
              $('.delClass').eq(i).removeClass("textboxstyle");


              $('.Styleclass').eq(i).removeClass("highlight");
              $('.Styleclass').eq(i).removeClass("textboxstyle");

              $('.Colorclass').eq(i).removeClass("highlight");
              $('.Colorclass').eq(i).removeClass("textboxstyle");

              $('.MinQtyclass').eq(i).removeClass("highlight");
              $('.MinQtyclass').eq(i).removeClass("textboxstyle");

              $('.Qtyclass').eq(i).removeClass("highlight");
              $('.Qtyclass').eq(i).removeClass("textboxstyle");

              $('.MaxQtyclass').eq(i).removeClass("highlight");
              $('.MaxQtyclass').eq(i).removeClass("textboxstyle");

              $('.ConfirmWeekclass').eq(i).removeClass("highlight");
              $('.ConfirmWeekclass').eq(i).removeClass("textboxstyle");

              
              $('.DesignationWeekclass').eq(i).removeClass("highlight");
              $('.DesignationWeekclass').eq(i).removeClass("textboxstyle");


              $('.ForwardWeekclass').eq(i).removeClass("highlight");
              $('.ForwardWeekclass').eq(i).removeClass("textboxstyle");

              
              $('.WearHouseWeekclass').eq(i).removeClass("highlight");
              $('.WearHouseWeekclass').eq(i).removeClass("textboxstyle");

              $('.Remarksclass').eq(i).removeClass("highlight");
              $('.Remarksclass').eq(i).removeClass("textboxstyle");

          }

          var nRowIndex= $("#tblAddMultiPAMDetail").data("selectedIndex");
          $('#tblAddMultiPAMDetail tr').eq(nRowIndex).find('input').addClass("highlight");
          $(sClass).eq(index).removeClass("textboxstyle2");
          $(sClass).eq(index).addClass("textboxstyle");
          $(sClass).eq(index).show();
          $(sClass).eq(index).focus();
          $(sClass).eq(index).select();
      }

      function DeleteRow(nRowIndex)
      {
          debugger;
          if(!confirm("Confirm to delete?")) return;
          var oTempMultiPAMs= $("#tblAddMultiPAMDetail").data('rows');
          if(oTempMultiPAMs.length==1){
              return;
          }
          var oMultiPAMs=[];var bFlag=false;
          for( var i=0; i<oTempMultiPAMs.length; i++)
          {
              if( parseInt(i) != parseInt(nRowIndex))
              {                  
                  oMultiPAMs.push(oTempMultiPAMs[i]);
              }
          }
          RemakeGrid(oMultiPAMs);
          RefreshSummery();
      }



      function RemakeGrid(oMultiPAMs)
      {
          $("#tblAddMultiPAMDetail").find("tr").remove();
          $('#tblAddMultiPAMDetail').data('rows', []);
          for( var i=0; i<oMultiPAMs.length; i++)
          {
              AddMultiPAMDetail(oMultiPAMs[i]);
          }
      }

      $('#btnClose').click(function(){
          window.location.href = sessionStorage.getItem("BackLink");
      });
</script>
